Released PSJ*5*113 SEQ #200
Extracted from mail message
**KIDS**:PSJ*5.0*113^

**INSTALL NAME**
PSJ*5.0*113
"BLD",6685,0)
PSJ*5.0*113^INPATIENT MEDICATIONS^0^3100331^y
"BLD",6685,1,0)
^^82^82^3090310^
"BLD",6685,1,1,0)
The purpose of this patch is to provide software enhancements for Order
"BLD",6685,1,2,0)
Validation defined by the BCMA-Inpatient Medications Request for
"BLD",6685,1,3,0)
Special Focus Group (SFG) Initial Request Analysis (IRA)
"BLD",6685,1,4,0)
 
"BLD",6685,1,5,0)
Currently, Inpatient Medications allows orders to be created with
"BLD",6685,1,6,0)
conflicting administration times, frequencies, schedules, and schedule
"BLD",6685,1,7,0)
types such that orders may not always display correctly on the Virtual
"BLD",6685,1,8,0)
Due List (VDL) in the Barcode Medication Administration (BCMA)
"BLD",6685,1,9,0)
application. This enhancement adds several new order validation checks
"BLD",6685,1,10,0)
to improve the data that is displayed on the VDL. These order
"BLD",6685,1,11,0)
validation requirements will apply to Unit Dose Medications and applied
"BLD",6685,1,12,0)
to intermittent IV orders schedules (IV orders do not have Schedule
"BLD",6685,1,13,0)
Type).
"BLD",6685,1,14,0)
 
"BLD",6685,1,15,0)
These enhancements are:
"BLD",6685,1,16,0)
 
"BLD",6685,1,17,0)
1.  Order Validation Check One
"BLD",6685,1,18,0)
For Intermittent IV orders, references to an order's Schedule Type will
"BLD",6685,1,19,0)
refer to either the TYPE OF SCHEDULE from the Administration Schedule
"BLD",6685,1,20,0)
file (#51.1), or PRN for schedule names in PRN format, or CONTINUOUS
"BLD",6685,1,21,0)
for schedule names in Day of Week format.
"BLD",6685,1,22,0)
 
"BLD",6685,1,23,0)
2.  Order Validation Check Two
"BLD",6685,1,24,0)
If an order has the Schedule Type of Continuous and the Schedule
"BLD",6685,1,25,0)
entered is NOT in Day of Week (Ex. MO-FR) or PRN (Ex. TID PC PRN)
"BLD",6685,1,26,0)
format, then the system shall prevent the number of administration
"BLD",6685,1,27,0)
times associated with the order from being greater than the number of
"BLD",6685,1,28,0)
administration times for that frequency, if the orders frequency is
"BLD",6685,1,29,0)
numeric (minutes).  The number of administration times can be less than
"BLD",6685,1,30,0)
but not equal to zero administration times.
"BLD",6685,1,31,0)
 
"BLD",6685,1,32,0)
3.  Order Validation Check Three
"BLD",6685,1,33,0)
If an order has a Schedule Type of Continuous and is an Odd Schedule, a
"BLD",6685,1,34,0)
schedule whose frequency is not evenly divisible by or into 1440
"BLD",6685,1,35,0)
minutes (1 day), then the system shall prevent the entry of
"BLD",6685,1,36,0)
administration times.
"BLD",6685,1,37,0)
 
"BLD",6685,1,38,0)
4.  Order Validation Check Four
"BLD",6685,1,39,0)
If an order has a Schedule Type of Continuous with a non-odd frequency
"BLD",6685,1,40,0)
of greater than of 1 day (1440 minutes) then the system shall prevent
"BLD",6685,1,41,0)
more than one administration time.
"BLD",6685,1,42,0)
 
"BLD",6685,1,43,0)
5.  Order Validation Check Five
"BLD",6685,1,44,0)
If an order has a Schedule Type of One Time or if an order is entered
"BLD",6685,1,45,0)
with a schedule that is defined in the schedule file as One Time then
"BLD",6685,1,46,0)
the system shall prevent the user from entering more than one
"BLD",6685,1,47,0)
administration time.
"BLD",6685,1,48,0)
 
"BLD",6685,1,49,0)
6.  Order Validation Check Six
"BLD",6685,1,50,0)
For an order with a Schedule Type of Continuous where no
"BLD",6685,1,51,0)
doses/administration times are scheduled between the order's Start
"BLD",6685,1,52,0)
Date/Time and the Stop Date/Time, then the system shall present a
"BLD",6685,1,53,0)
warning message to the user and not allow the order to be accepted or
"BLD",6685,1,54,0)
verified until the Start/Stop Date Times, schedule, and/or
"BLD",6685,1,55,0)
administration times are adjusted so that at least one dose is
"BLD",6685,1,56,0)
scheduled to be given.
"BLD",6685,1,57,0)
 
"BLD",6685,1,58,0)
7.  Change the Sequence of the Schedule Type and Schedule Prompts
"BLD",6685,1,59,0)
Currently the order of the prompts in inpatient meds order entry is
"BLD",6685,1,60,0)
Schedule Type followed by Schedule.  The sequence of the prompts will
"BLD",6685,1,61,0)
be changed so that the Schedule prompt falls before the Schedule Type
"BLD",6685,1,62,0)
prompt.
"BLD",6685,1,63,0)
 
"BLD",6685,1,64,0)
8.  Schedule Validation Requirement One
"BLD",6685,1,65,0)
When a schedule is selected at the Schedule Field the system shall
"BLD",6685,1,66,0)
default the Schedule Type for the schedule entered from the Schedule
"BLD",6685,1,67,0)
File into the order.
"BLD",6685,1,68,0)
 
"BLD",6685,1,69,0)
9.  Schedule Validation Requirement Two
"BLD",6685,1,70,0)
If the user changes the schedule, they will be given a warning message
"BLD",6685,1,71,0)
that the administration times and the schedule type for the schedule
"BLD",6685,1,72,0)
selected will be defaulted to this order.
"BLD",6685,1,73,0)
 
"BLD",6685,1,74,0)
10.  Schedule Validation Check Three
"BLD",6685,1,75,0)
If the schedule type is changed from Continuous to PRN the system shall
"BLD",6685,1,76,0)
automatically remove any administration times that were associated with
"BLD",6685,1,77,0)
the schedule so that the order will not include administration times.
"BLD",6685,1,78,0)
 
"BLD",6685,1,79,0)
11.  Modify VistA Help Text
"BLD",6685,1,80,0)
The Help Text in Inpatient Order Entry was modified to add additional
"BLD",6685,1,81,0)
text so the user is able to see the added constraints when entering
"BLD",6685,1,82,0)
Administration Times.
"BLD",6685,4,0)
^9.64PA^53.1^1
"BLD",6685,4,53.1,0)
53.1
"BLD",6685,4,53.1,2,0)
^9.641^53.1^1
"BLD",6685,4,53.1,2,53.1,0)
NON-VERIFIED ORDERS  (File-top level)
"BLD",6685,4,53.1,2,53.1,1,0)
^9.6411^39^1
"BLD",6685,4,53.1,2,53.1,1,39,0)
ADMIN TIMES
"BLD",6685,4,53.1,222)
y^y^p^^^^n^^n
"BLD",6685,4,53.1,224)

"BLD",6685,4,"APDD",53.1,53.1)

"BLD",6685,4,"APDD",53.1,53.1,39)

"BLD",6685,4,"B",53.1,53.1)

"BLD",6685,6)
9^
"BLD",6685,6.3)
63
"BLD",6685,"ABPKG")
n
"BLD",6685,"KRN",0)
^9.67PA^8989.52^19
"BLD",6685,"KRN",.4,0)
.4
"BLD",6685,"KRN",.401,0)
.401
"BLD",6685,"KRN",.402,0)
.402
"BLD",6685,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",6685,"KRN",.403,0)
.403
"BLD",6685,"KRN",.5,0)
.5
"BLD",6685,"KRN",.84,0)
.84
"BLD",6685,"KRN",3.6,0)
3.6
"BLD",6685,"KRN",3.8,0)
3.8
"BLD",6685,"KRN",9.2,0)
9.2
"BLD",6685,"KRN",9.8,0)
9.8
"BLD",6685,"KRN",9.8,"NM",0)
^9.68A^15^15
"BLD",6685,"KRN",9.8,"NM",1,0)
PSGOE4^^0^B30952598
"BLD",6685,"KRN",9.8,"NM",2,0)
PSGOE41^^0^B27908531
"BLD",6685,"KRN",9.8,"NM",3,0)
PSGOE8^^0^B43388920
"BLD",6685,"KRN",9.8,"NM",4,0)
PSIVEDT1^^0^B59446179
"BLD",6685,"KRN",9.8,"NM",5,0)
PSJBCMA^^0^B73076125
"BLD",6685,"KRN",9.8,"NM",6,0)
PSGS0^^0^B75413878
"BLD",6685,"KRN",9.8,"NM",7,0)
PSJDDUT^^0^B78117468
"BLD",6685,"KRN",9.8,"NM",8,0)
PSGOE81^^0^B36275295
"BLD",6685,"KRN",9.8,"NM",9,0)
PSGOE9^^0^B38035726
"BLD",6685,"KRN",9.8,"NM",10,0)
PSGOE91^^0^B41628067
"BLD",6685,"KRN",9.8,"NM",11,0)
PSJORPOE^^0^B36843911
"BLD",6685,"KRN",9.8,"NM",12,0)
PSIVCHK^^0^B22884839
"BLD",6685,"KRN",9.8,"NM",13,0)
PSJVOSR^^0^B19662050
"BLD",6685,"KRN",9.8,"NM",14,0)
PSIVCHK1^^0^B15557836
"BLD",6685,"KRN",9.8,"NM",15,0)
PSGOEF^^0^B83231206
"BLD",6685,"KRN",9.8,"NM","B","PSGOE4",1)

"BLD",6685,"KRN",9.8,"NM","B","PSGOE41",2)

"BLD",6685,"KRN",9.8,"NM","B","PSGOE8",3)

"BLD",6685,"KRN",9.8,"NM","B","PSGOE81",8)

"BLD",6685,"KRN",9.8,"NM","B","PSGOE9",9)

"BLD",6685,"KRN",9.8,"NM","B","PSGOE91",10)

"BLD",6685,"KRN",9.8,"NM","B","PSGOEF",15)

"BLD",6685,"KRN",9.8,"NM","B","PSGS0",6)

"BLD",6685,"KRN",9.8,"NM","B","PSIVCHK",12)

"BLD",6685,"KRN",9.8,"NM","B","PSIVCHK1",14)

"BLD",6685,"KRN",9.8,"NM","B","PSIVEDT1",4)

"BLD",6685,"KRN",9.8,"NM","B","PSJBCMA",5)

"BLD",6685,"KRN",9.8,"NM","B","PSJDDUT",7)

"BLD",6685,"KRN",9.8,"NM","B","PSJORPOE",11)

"BLD",6685,"KRN",9.8,"NM","B","PSJVOSR",13)

"BLD",6685,"KRN",19,0)
19
"BLD",6685,"KRN",19,"NM",0)
^9.68A^^
"BLD",6685,"KRN",19.1,0)
19.1
"BLD",6685,"KRN",101,0)
101
"BLD",6685,"KRN",409.61,0)
409.61
"BLD",6685,"KRN",771,0)
771
"BLD",6685,"KRN",870,0)
870
"BLD",6685,"KRN",8989.51,0)
8989.51
"BLD",6685,"KRN",8989.52,0)
8989.52
"BLD",6685,"KRN",8994,0)
8994
"BLD",6685,"KRN","B",.4,.4)

"BLD",6685,"KRN","B",.401,.401)

"BLD",6685,"KRN","B",.402,.402)

"BLD",6685,"KRN","B",.403,.403)

"BLD",6685,"KRN","B",.5,.5)

"BLD",6685,"KRN","B",.84,.84)

"BLD",6685,"KRN","B",3.6,3.6)

"BLD",6685,"KRN","B",3.8,3.8)

"BLD",6685,"KRN","B",9.2,9.2)

"BLD",6685,"KRN","B",9.8,9.8)

"BLD",6685,"KRN","B",19,19)

"BLD",6685,"KRN","B",19.1,19.1)

"BLD",6685,"KRN","B",101,101)

"BLD",6685,"KRN","B",409.61,409.61)

"BLD",6685,"KRN","B",771,771)

"BLD",6685,"KRN","B",870,870)

"BLD",6685,"KRN","B",8989.51,8989.51)

"BLD",6685,"KRN","B",8989.52,8989.52)

"BLD",6685,"KRN","B",8994,8994)

"BLD",6685,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",6685,"QUES",0)
^9.62^^
"BLD",6685,"REQB",0)
^9.611^2^2
"BLD",6685,"REQB",1,0)
PSJ*5.0*190^2
"BLD",6685,"REQB",2,0)
PSJ*5.0*222^2
"BLD",6685,"REQB","B","PSJ*5.0*190",1)

"BLD",6685,"REQB","B","PSJ*5.0*222",2)

"FIA",53.1)
NON-VERIFIED ORDERS
"FIA",53.1,0)
^PS(53.1,
"FIA",53.1,0,0)
53.1I
"FIA",53.1,0,1)
y^y^p^^^^n^^n
"FIA",53.1,0,10)

"FIA",53.1,0,11)

"FIA",53.1,0,"RLRO")

"FIA",53.1,0,"VR")
5.0^PSJ
"FIA",53.1,53.1)
1
"FIA",53.1,53.1,39)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
113^3100331^10000000067
"PKG",197,22,1,"PAH",1,1,0)
^^82^82^3100331
"PKG",197,22,1,"PAH",1,1,1,0)
The purpose of this patch is to provide software enhancements for Order
"PKG",197,22,1,"PAH",1,1,2,0)
Validation defined by the BCMA-Inpatient Medications Request for
"PKG",197,22,1,"PAH",1,1,3,0)
Special Focus Group (SFG) Initial Request Analysis (IRA)
"PKG",197,22,1,"PAH",1,1,4,0)
 
"PKG",197,22,1,"PAH",1,1,5,0)
Currently, Inpatient Medications allows orders to be created with
"PKG",197,22,1,"PAH",1,1,6,0)
conflicting administration times, frequencies, schedules, and schedule
"PKG",197,22,1,"PAH",1,1,7,0)
types such that orders may not always display correctly on the Virtual
"PKG",197,22,1,"PAH",1,1,8,0)
Due List (VDL) in the Barcode Medication Administration (BCMA)
"PKG",197,22,1,"PAH",1,1,9,0)
application. This enhancement adds several new order validation checks
"PKG",197,22,1,"PAH",1,1,10,0)
to improve the data that is displayed on the VDL. These order
"PKG",197,22,1,"PAH",1,1,11,0)
validation requirements will apply to Unit Dose Medications and applied
"PKG",197,22,1,"PAH",1,1,12,0)
to intermittent IV orders schedules (IV orders do not have Schedule
"PKG",197,22,1,"PAH",1,1,13,0)
Type).
"PKG",197,22,1,"PAH",1,1,14,0)
 
"PKG",197,22,1,"PAH",1,1,15,0)
These enhancements are:
"PKG",197,22,1,"PAH",1,1,16,0)
 
"PKG",197,22,1,"PAH",1,1,17,0)
1.  Order Validation Check One
"PKG",197,22,1,"PAH",1,1,18,0)
For Intermittent IV orders, references to an order's Schedule Type will
"PKG",197,22,1,"PAH",1,1,19,0)
refer to either the TYPE OF SCHEDULE from the Administration Schedule
"PKG",197,22,1,"PAH",1,1,20,0)
file (#51.1), or PRN for schedule names in PRN format, or CONTINUOUS
"PKG",197,22,1,"PAH",1,1,21,0)
for schedule names in Day of Week format.
"PKG",197,22,1,"PAH",1,1,22,0)
 
"PKG",197,22,1,"PAH",1,1,23,0)
2.  Order Validation Check Two
"PKG",197,22,1,"PAH",1,1,24,0)
If an order has the Schedule Type of Continuous and the Schedule
"PKG",197,22,1,"PAH",1,1,25,0)
entered is NOT in Day of Week (Ex. MO-FR) or PRN (Ex. TID PC PRN)
"PKG",197,22,1,"PAH",1,1,26,0)
format, then the system shall prevent the number of administration
"PKG",197,22,1,"PAH",1,1,27,0)
times associated with the order from being greater than the number of
"PKG",197,22,1,"PAH",1,1,28,0)
administration times for that frequency, if the orders frequency is
"PKG",197,22,1,"PAH",1,1,29,0)
numeric (minutes).  The number of administration times can be less than
"PKG",197,22,1,"PAH",1,1,30,0)
but not equal to zero administration times.
"PKG",197,22,1,"PAH",1,1,31,0)
 
"PKG",197,22,1,"PAH",1,1,32,0)
3.  Order Validation Check Three
"PKG",197,22,1,"PAH",1,1,33,0)
If an order has a Schedule Type of Continuous and is an Odd Schedule, a
"PKG",197,22,1,"PAH",1,1,34,0)
schedule whose frequency is not evenly divisible by or into 1440
"PKG",197,22,1,"PAH",1,1,35,0)
minutes (1 day), then the system shall prevent the entry of
"PKG",197,22,1,"PAH",1,1,36,0)
administration times.
"PKG",197,22,1,"PAH",1,1,37,0)
 
"PKG",197,22,1,"PAH",1,1,38,0)
4.  Order Validation Check Four
"PKG",197,22,1,"PAH",1,1,39,0)
If an order has a Schedule Type of Continuous with a non-odd frequency
"PKG",197,22,1,"PAH",1,1,40,0)
of greater than of 1 day (1440 minutes) then the system shall prevent
"PKG",197,22,1,"PAH",1,1,41,0)
more than one administration time.
"PKG",197,22,1,"PAH",1,1,42,0)
 
"PKG",197,22,1,"PAH",1,1,43,0)
5.  Order Validation Check Five
"PKG",197,22,1,"PAH",1,1,44,0)
If an order has a Schedule Type of One Time or if an order is entered
"PKG",197,22,1,"PAH",1,1,45,0)
with a schedule that is defined in the schedule file as One Time then
"PKG",197,22,1,"PAH",1,1,46,0)
the system shall prevent the user from entering more than one
"PKG",197,22,1,"PAH",1,1,47,0)
administration time.
"PKG",197,22,1,"PAH",1,1,48,0)
 
"PKG",197,22,1,"PAH",1,1,49,0)
6.  Order Validation Check Six
"PKG",197,22,1,"PAH",1,1,50,0)
For an order with a Schedule Type of Continuous where no
"PKG",197,22,1,"PAH",1,1,51,0)
doses/administration times are scheduled between the order's Start
"PKG",197,22,1,"PAH",1,1,52,0)
Date/Time and the Stop Date/Time, then the system shall present a
"PKG",197,22,1,"PAH",1,1,53,0)
warning message to the user and not allow the order to be accepted or
"PKG",197,22,1,"PAH",1,1,54,0)
verified until the Start/Stop Date Times, schedule, and/or
"PKG",197,22,1,"PAH",1,1,55,0)
administration times are adjusted so that at least one dose is
"PKG",197,22,1,"PAH",1,1,56,0)
scheduled to be given.
"PKG",197,22,1,"PAH",1,1,57,0)
 
"PKG",197,22,1,"PAH",1,1,58,0)
7.  Change the Sequence of the Schedule Type and Schedule Prompts
"PKG",197,22,1,"PAH",1,1,59,0)
Currently the order of the prompts in inpatient meds order entry is
"PKG",197,22,1,"PAH",1,1,60,0)
Schedule Type followed by Schedule.  The sequence of the prompts will
"PKG",197,22,1,"PAH",1,1,61,0)
be changed so that the Schedule prompt falls before the Schedule Type
"PKG",197,22,1,"PAH",1,1,62,0)
prompt.
"PKG",197,22,1,"PAH",1,1,63,0)
 
"PKG",197,22,1,"PAH",1,1,64,0)
8.  Schedule Validation Requirement One
"PKG",197,22,1,"PAH",1,1,65,0)
When a schedule is selected at the Schedule Field the system shall
"PKG",197,22,1,"PAH",1,1,66,0)
default the Schedule Type for the schedule entered from the Schedule
"PKG",197,22,1,"PAH",1,1,67,0)
File into the order.
"PKG",197,22,1,"PAH",1,1,68,0)
 
"PKG",197,22,1,"PAH",1,1,69,0)
9.  Schedule Validation Requirement Two
"PKG",197,22,1,"PAH",1,1,70,0)
If the user changes the schedule, they will be given a warning message
"PKG",197,22,1,"PAH",1,1,71,0)
that the administration times and the schedule type for the schedule
"PKG",197,22,1,"PAH",1,1,72,0)
selected will be defaulted to this order.
"PKG",197,22,1,"PAH",1,1,73,0)
 
"PKG",197,22,1,"PAH",1,1,74,0)
10.  Schedule Validation Check Three
"PKG",197,22,1,"PAH",1,1,75,0)
If the schedule type is changed from Continuous to PRN the system shall
"PKG",197,22,1,"PAH",1,1,76,0)
automatically remove any administration times that were associated with
"PKG",197,22,1,"PAH",1,1,77,0)
the schedule so that the order will not include administration times.
"PKG",197,22,1,"PAH",1,1,78,0)
 
"PKG",197,22,1,"PAH",1,1,79,0)
11.  Modify VistA Help Text
"PKG",197,22,1,"PAH",1,1,80,0)
The Help Text in Inpatient Order Entry was modified to add additional
"PKG",197,22,1,"PAH",1,1,81,0)
text so the user is able to see the added constraints when entering
"PKG",197,22,1,"PAH",1,1,82,0)
Administration Times.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
15
"RTN","PSGOE4")
0^1^B30952598^B26615644
"RTN","PSGOE4",1,0)
PSGOE4 ;BIR/CML3-REGULAR ORDER ENTRY ;06 Feb 2001  4:31 PM
"RTN","PSGOE4",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**2,50,64,58,111,113**;16 DEC 97;Build 63
"RTN","PSGOE4",3,0)
 ;
"RTN","PSGOE4",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGOE4",5,0)
 ;
"RTN","PSGOE4",6,0)
 K PSGOES S PSGMR=$S($P(PSGNEDFD,"^",2):$P(PSGNEDFD,"^",2),1:PSGOEDMR),PSGSCH=$P(PSGNEDFD,"^",4),PSGPR=PSGOEPR,(PSGSD,PSGFD,PSGSM,PSGHSM,PSGUD,PSGSI,PSGOROE1,PSGNEFD,PSGMRN)=""
"RTN","PSGOE4",7,0)
 S:PSGMR PSGMRN=$S('$P(PSGNEDFD,"^",2):"ORAL",'$D(^PS(51.2,PSGMR,0)):PSGMR,$P(^(0),"^")]"":$P(^(0),"^"),1:PSGMR) I PSGPR S PSGPRN=$P($G(^VA(200,PSGPR,0)),"^") S:PSGPRN="" PSGPRN=PSGPR
"RTN","PSGOE4",8,0)
 S PSGST=$S($P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C"),PSGSTN=$$ENSTN^PSGMI(PSGST),F1=53.1 K PSGFOK S PSGFOK(2)=""
"RTN","PSGOE4",9,0)
 S:$P(PSJSYSU,";",4) PSGFOK(2)="" K ^PS(53.45,PSJSYSP,1),^(2) I PSGDRG S ^(2,0)="^53.4502P^"_PSGDRG_"^1",^(1,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",PSGDRG,1)=""
"RTN","PSGOE4",10,0)
 ;
"RTN","PSGOE4",11,0)
109 ; dosage ordered
"RTN","PSGOE4",12,0)
 I $P(PSJSYSU,";",4) D GETDOSE^PSJDOSE(PSGDRG) G:PSGOROE1 DONE G:'$G(PSGOE3) 3
"RTN","PSGOE4",13,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",14,0)
 I X="" S X=PSGDO ;I X="" W $C(7),"  (Required)" G 109
"RTN","PSGOE4",15,0)
 S PSGF2=109 I X="@" S PSGDO="" ;W $C(7),"  (Required)" G 109
"RTN","PSGOE4",16,0)
 I X="@" D DEL G:%'=1 109 S (PSGDO,PSGFOK(109),PSGUD)="" G 3
"RTN","PSGOE4",17,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE4",18,0)
 I $E(X)="^" D FF G:Y>0 @Y G 109
"RTN","PSGOE4",19,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE4",20,0)
 I $S(X="":0,X?.E1C.E:1,$L(X)>20:1,X="":1,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE4",21,0)
 S PSGDO=X,PSGFOK(109)=""
"RTN","PSGOE4",22,0)
 ;
"RTN","PSGOE4",23,0)
13 ; units per dose
"RTN","PSGOE4",24,0)
 ;/** NO LONGER USE WITH POE
"RTN","PSGOE4",25,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",26,0)
 G:'$P(PSJSYSU,";",4) 3 I $D(PSGFOK(13)) S PSGFOK(13)=1 D 2^PSGOE42 S PSGFOK(13)="" G 3
"RTN","PSGOE4",27,0)
 ;
"RTN","PSGOE4",28,0)
A13 ;
"RTN","PSGOE4",29,0)
 W !,"UNITS PER DOSE: ",$S(PSGUD:PSGUD_"// ",1:"") R X:DTIME I X="^"!'$T S PSGOROE1=1 G DONE
"RTN","PSGOE4",30,0)
 I X="" W:'PSGUD "  (1)" G S13
"RTN","PSGOE4",31,0)
 S PSGF2=13 I X="@",'PSGUD W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,13) G A13
"RTN","PSGOE4",32,0)
 I X="@" D DEL G:%'=1 13 S PSGUD="" G S13
"RTN","PSGOE4",33,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,13) G A13
"RTN","PSGOE4",34,0)
 I $E(X)="^" D FF G:Y>0 @Y G A13
"RTN","PSGOE4",35,0)
 I X?1.2N1"/"1.2N S X=+$J(+X/$P(X,"/",2),0,2) W "  ("_$E("0",X<1)_X_")"
"RTN","PSGOE4",36,0)
 I $S($L(X)>12:1,X'=+X:1,X>50:1,X<0:1,1:X?.N1"."3.N) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,13) G 13
"RTN","PSGOE4",37,0)
 S PSGUD=X W:'X "  (1)"
"RTN","PSGOE4",38,0)
 ;
"RTN","PSGOE4",39,0)
S13 ;
"RTN","PSGOE4",40,0)
 S PSGFOK(13)="" I PSGDRG S $P(^PS(53.45,PSJSYSP,2,1,0),"^",2)=PSGUD
"RTN","PSGOE4",41,0)
 ;
"RTN","PSGOE4",42,0)
3 ; med route
"RTN","PSGOE4",43,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",44,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) S PSGFOK(3)="" G 26
"RTN","PSGOE4",45,0)
 S PSGF2=3 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,2) G 3
"RTN","PSGOE4",46,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE4",47,0)
 I $E(X)="^" D FF G:Y>0 @Y G 3
"RTN","PSGOE4",48,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G 3
"RTN","PSGOE4",49,0)
 S PSGMR=+Y,PSGMRN=$P(Y(0),"^") S PSGFOK(3)=""
"RTN","PSGOE4",50,0)
 ;
"RTN","PSGOE4",51,0)
26 ; schedule
"RTN","PSGOE4",52,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",53,0)
 S PSGF2=26 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",54,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",55,0)
 I $E(X)="^" D FF G:Y>0 @Y G 26
"RTN","PSGOE4",56,0)
 S DOW=0 I $$DOW^PSIVUTL(X) S DOW=1,PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST),PSGS0Y=$P(X,"@",2)
"RTN","PSGOE4",57,0)
 N PSJSLUP S PSJSLUP=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",58,0)
 I PSGSCH[" PRN",$$PRNOK^PSGS0(PSGSCH) S PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",59,0)
 S PSGSCH=X,$P(PSGNEDFD,"^",4)=X,PSGFOK(26)="" I PSGS0XT="O" S $P(PSGNEDFD,"^",3)="O",PSGST="O",PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",60,0)
 I $G(PSGOE3) D  Q
"RTN","PSGOE4",61,0)
 . S PSGSCH=X,PSGST=$S($G(DOW):"C",PSGS0XT="O":"O",PSGST="R":"R",X["PRN":"P",X="ON CALL":"OC",PSGST]"":PSGST,1:"C"),PSGFOK(26)=""
"RTN","PSGOE4",62,0)
 . S $P(PSGNEDFD,"^",3)=PSGST S:PSGSCH=""!(X?1." ") PSGSCH="PRN"
"RTN","PSGOE4",63,0)
 . S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",64,0)
 ;
"RTN","PSGOE4",65,0)
7 ; schedule type
"RTN","PSGOE4",66,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",67,0)
 D  ;Default Schedule Type from Schedule file - PSJ*5*113 - DRF
"RTN","PSGOE4",68,0)
 . N XX
"RTN","PSGOE4",69,0)
 . I $$DOW^PSIVUTL(PSGSCH) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE4",70,0)
 . I PSGSCH[" PRN",$$PRNOK^PSGS0(PSGSCH) S PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE4",71,0)
 . I PSGSCH]"" D
"RTN","PSGOE4",72,0)
 .. S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0))
"RTN","PSGOE4",73,0)
 .. S PSGST=$P($G(^PS(51.1,XX,0)),"^",5) I PSGST="D" S PSGST="C"
"RTN","PSGOE4",74,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",75,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOROE1=1 W $C(7) G DONE
"RTN","PSGOE4",76,0)
 I X="" S:PSGST="OC" PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" W "  "_PSGSTN S PSGFOK(7)="" S $P(PSGNEDFD,"^",3)=PSGST G ^PSGOE41
"RTN","PSGOE4",77,0)
 S PSGF2=7 I X="@"!(X?1."?") W:X="@" $C(7),"  ??  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G 7
"RTN","PSGOE4",78,0)
 I $E(X)="^" D FF G:Y>0 @Y G 7
"RTN","PSGOE4",79,0)
 S:X="F" X="R"
"RTN","PSGOE4",80,0)
 I X="OC"!(X="R") S PSGST=X,$P(PSGNEDFD,"^",3)=X,PSGSTN=$S(X="R":"FILL on REQUEST",1:"ON CALL") W "  "_PSGSTN S PSGFOK(7)="" G:X="R" 8^PSGOE41 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE4",81,0)
 F Y="C^CONTINUOUS","O^ONE TIME","OC^ON CALL","P^PRN","R^FILL on REQUEST" I $P($P(Y,"^",2),X)="" W $P($P(Y,"^",2),X,2) S PSGST=$P(Y,"^"),PSGSTN=$P(Y,"^",2),$P(PSGNEDFD,"^",3)=PSGST Q
"RTN","PSGOE4",82,0)
 E  W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,7) G 7
"RTN","PSGOE4",83,0)
 I PSGST="OC"!(PSGST="R") S PSGFOK(7)="" G:PSGST="R" 8^PSGOE41 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE4",84,0)
 S PSGFOK(7)=""
"RTN","PSGOE4",85,0)
 ;
"RTN","PSGOE4",86,0)
 G ^PSGOE41
"RTN","PSGOE4",87,0)
 ;
"RTN","PSGOE4",88,0)
DONE ;
"RTN","PSGOE4",89,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE4",90,0)
 K F,F0,F1,PSGF2,F3,PSG,PSGSD,SDT Q
"RTN","PSGOE4",91,0)
 ;
"RTN","PSGOE4",92,0)
FF ; up-arrow to another field
"RTN","PSGOE4",93,0)
 D ENFF^PSGOEM I Y>0,Y'=109,Y'=13,Y'=3,Y'=7,Y'=26 S:Y=2 FB=PSGF2_"^PSGOE4" S Y=Y_"^PSGOE4"_$S("^39^8^10^25^"[("^"_Y_"^"):1,1:2)
"RTN","PSGOE4",94,0)
 Q
"RTN","PSGOE4",95,0)
 ;
"RTN","PSGOE4",96,0)
DEL ; delete entry
"RTN","PSGOE4",97,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE4",98,0)
 Q
"RTN","PSGOE41")
0^2^B27908531^B15025855
"RTN","PSGOE41",1,0)
PSGOE41 ;BIR/CML3-REGULAR ORDER ENTRY (CONT.) ;09 JAN 97 / 9:13 AM 
"RTN","PSGOE41",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,63,64,69,58,111,136,113**;16 DEC 97;Build 63
"RTN","PSGOE41",3,0)
 ;
"RTN","PSGOE41",4,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSGOE41",5,0)
 ; Reference to %DT is supported by DBIA 10003.
"RTN","PSGOE41",6,0)
 ; Reference to %DTC is supported by DBIA 10000.
"RTN","PSGOE41",7,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE41",8,0)
 ;
"RTN","PSGOE41",9,0)
39 ; admin times
"RTN","PSGOE41",10,0)
 G:$P(PSGNEDFD,"^",3)="P"!($P(PSGNEDFD,"^",3)="OC") 8
"RTN","PSGOE41",11,0)
 I $$ODD^PSGS0(PSGS0XT) G 8
"RTN","PSGOE41",12,0)
 W !,"ADMIN TIMES: "_$S(PSGS0Y:PSGS0Y_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",13,0)
 I X="",PSGS0Y]"" S X=PSGS0Y
"RTN","PSGOE41",14,0)
 I X="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGS0Y)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",15,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",16,0)
 I X="@" D DEL G:%'=1 39 S (PSGFOK(39),PSGS0Y)="" G 39
"RTN","PSGOE41",17,0)
 S PSGF2=39 I $E(X)="^" D FF G:Y>0 @Y G 39
"RTN","PSGOE41",18,0)
 I (PSGS0XT="D")&('$G(X)!(X["@"&($P($G(X),"@",2)))) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G 39
"RTN","PSGOE41",19,0)
 . W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE41",20,0)
 I $G(PSGS0XT)'="D",$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC" D TIMES I '$D(X) G 39
"RTN","PSGOE41",21,0)
 I $G(PSGS0XT)="O",X="" S (PSGAT,PSGS0Y)=X,PSGFOK(39)="" G 8
"RTN","PSGOE41",22,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" G 39
"RTN","PSGOE41",23,0)
 S (PSGAT,PSGS0Y)=X,PSGFOK(39)=""
"RTN","PSGOE41",24,0)
 ;
"RTN","PSGOE41",25,0)
8 ; special instructions
"RTN","PSGOE41",26,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":$P(PSGSI,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",27,0)
 I X="" S X=PSGSI I X="" S PSGFOK(8)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",28,0)
 S PSGF2=8 I $E(X)="^" D FF G:Y>0 @Y G 8
"RTN","PSGOE41",29,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",30,0)
 I X="@" D DEL G:%'=1 8 S (PSGFOK(8),PSGSI)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",31,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",32,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",33,0)
 S PSGSI=X I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U"),PSGFOK(8)=""
"RTN","PSGOE41",34,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",35,0)
 ;
"RTN","PSGOE41",36,0)
10 ; start date/time
"RTN","PSGOE41",37,0)
 D ^PSGNE3
"RTN","PSGOE41",38,0)
 S:'$D(PSGNESDO) PSGNESDO=$$ENDD^PSGMI(PSGNESD) S PSGSD=PSGNESDO
"RTN","PSGOE41",39,0)
A10 W !,"START DATE/TIME: "_PSGSD_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",40,0)
 I X="",PSGNESD W "  "_PSGSD G O25
"RTN","PSGOE41",41,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGNESD=+X,PSGSD=$$ENDD^PSGMI(+X) W "  ",PSGSD G O25
"RTN","PSGOE41",42,0)
 S PSGF2=10 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE41",43,0)
 I $E(X)="^" D FF G:Y>0 @Y G A10
"RTN","PSGOE41",44,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE41",45,0)
 S PSGNESD=+Y,PSGSD=$$ENDD^PSGMI(+Y),(PSGNEFD,PSGFD)=""
"RTN","PSGOE41",46,0)
 ;
"RTN","PSGOE41",47,0)
O25 ;
"RTN","PSGOE41",48,0)
 S PSGFOK(10)="" I $P(PSGNEDFD,"^",3)="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" S PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",49,0)
 ;
"RTN","PSGOE41",50,0)
25 ; stop date
"RTN","PSGOE41",51,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",52,0)
 I 'PSGNEFD D ENFD^PSGNE3(PSGDT) S PSGFD=PSGNEFDO
"RTN","PSGOE41",53,0)
A25 W !,"STOP DATE/TIME: "_$S(PSGFD]"":PSGFD_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",54,0)
 I X="",PSGNEFD W "   "_PSGFD S PSGFOK(25)=""  G W25
"RTN","PSGOE41",55,0)
 S PSGF2=25 I $E(X)="^" D FF G:Y>0 @Y G A25
"RTN","PSGOE41",56,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE41",57,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D EN1^PSGDL
"RTN","PSGOE41",58,0)
 K %DT S %DT="ERTX",%DT(0)=PSGNESD D ^%DT K %DT G:Y'>0 A25 S PSGNEFD=+Y,PSGFD=$$ENDD^PSGMI(+Y),PSGFOK(25)=""
"RTN","PSGOE41",59,0)
W25 ;
"RTN","PSGOE41",60,0)
 N Z
"RTN","PSGOE41",61,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE41",62,0)
 . W !,"There must be an admin time that falls between the Start Date/Time"
"RTN","PSGOE41",63,0)
 . W !,"and the Stop Date/Time."
"RTN","PSGOE41",64,0)
 I PSGNEFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOE41",65,0)
 D EFDNEW^PSJUTL  ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE41",66,0)
NEXT ;
"RTN","PSGOE41",67,0)
 G 1^PSGOE42
"RTN","PSGOE41",68,0)
 ;
"RTN","PSGOE41",69,0)
DONE ;
"RTN","PSGOE41",70,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE41",71,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE41",72,0)
 ;
"RTN","PSGOE41",73,0)
FF ; up-arrow to another field
"RTN","PSGOE41",74,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE4"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:$P(Y,U)=2 FB=PSGF2_"^PSGOE41"
"RTN","PSGOE41",75,0)
 Q
"RTN","PSGOE41",76,0)
 ;
"RTN","PSGOE41",77,0)
DEL ; delete entry
"RTN","PSGOE41",78,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE41",79,0)
 Q
"RTN","PSGOE41",80,0)
TIMES    ;At least one admin time, not more than interval allows.
"RTN","PSGOE41",81,0)
 I $G(PSGS0XT)'="O",X="" W !,"This order requires at least one administration time." K X Q  ;No times
"RTN","PSGOE41",82,0)
 N H,I,MAX
"RTN","PSGOE41",83,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE41",84,0)
 I $G(PSGST)="O",$L(X,"-")>1 W !,"This is a One Time Order - only one admin time is permitted." K X Q
"RTN","PSGOE41",85,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE41",86,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE41",87,0)
 S MAX=1440/I
"RTN","PSGOE41",88,0)
 I MAX<1 D  Q
"RTN","PSGOE41",89,0)
 . I $L(X,"-")'=1 W !,"This order requires one admin time." K X Q
"RTN","PSGOE41",90,0)
 I MAX'<1,$L(X,"-")>MAX W !,"The number of admin times entered is greater than indicated by the schedule." K X Q  ;Too many times
"RTN","PSGOE41",91,0)
 I MAX'<1,$L(X,"-")<MAX W !,"The number of admin times entered is fewer than indicated by the schedule."  ;Too few times
"RTN","PSGOE41",92,0)
 Q
"RTN","PSGOE41",93,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE41",94,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE41",95,0)
 N INFO,X
"RTN","PSGOE41",96,0)
 S Z="",INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE41",97,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE41",98,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE41",99,0)
 Q
"RTN","PSGOE8")
0^3^B43388920^B39387831
"RTN","PSGOE8",1,0)
PSGOE8 ;BIR/CML3-EDIT ORDERS IN 53.1 ;25 SEP 97 / 10:58 AM
"RTN","PSGOE8",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**47,50,65,72,110,111,188,192,113**;16 DEC 97;Build 63
"RTN","PSGOE8",3,0)
 ;
"RTN","PSGOE8",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE8",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE8",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE8",7,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE8",8,0)
 ;
"RTN","PSGOE8",9,0)
101 ;Orderable Item
"RTN","PSGOE8",10,0)
 S MSG=0,F2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(F2) BACK="101^PSGOE8"
"RTN","PSGOE8",11,0)
 S %=1 I $P(PSJSYSU,";",3)>1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%
"RTN","PSGOE8",12,0)
 I %'=1 G DONE
"RTN","PSGOE8",13,0)
A101 ;
"RTN","PSGOE8",14,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",15,0)
 . W !!?5,"Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",16,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",17,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE8",18,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,101) G A101
"RTN","PSGOE8",19,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,101)
"RTN","PSGOE8",20,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A101
"RTN","PSGOE8",21,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE8",22,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE8",23,0)
 F  S %=2 D DH,YN^DICN Q:%
"RTN","PSGOE8",24,0)
 I %'=1 G A101
"RTN","PSGOE8",25,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE8",26,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE8",27,0)
 S PSGPDNX=1,PSGDO="",(PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG) K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) D
"RTN","PSGOE8",28,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)=""
"RTN","PSGOE8",29,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE8",30,0)
 G DONE
"RTN","PSGOE8",31,0)
 ;
"RTN","PSGOE8",32,0)
109 ; dosage ordered
"RTN","PSGOE8",33,0)
 S MSG=0,F2=109 S:PSGOEEF(F2) BACK="109^PSGOE8"
"RTN","PSGOE8",34,0)
A109 ;
"RTN","PSGOE8",35,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",36,0)
 . W !!?5,"Dosage may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",37,0)
 S PSGOEEF(F2)=PSGOEE
"RTN","PSGOE8",38,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE8",39,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",40,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE8",41,0)
 I $$CHECK(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE8",42,0)
 I $$CHECK(PSJSYSP)&(X="@") W $C(7),"      (Required) " G A109
"RTN","PSGOE8",43,0)
 I '$$CHECK(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE8",44,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",45,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A109
"RTN","PSGOE8",46,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE8",47,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",48,0)
 S PSGDO=X G DONE
"RTN","PSGOE8",49,0)
 ;
"RTN","PSGOE8",50,0)
3 ; med route
"RTN","PSGOE8",51,0)
 S MSG=0,F2=3 S:PSGOEEF(F2) BACK="3^PSGOE8"
"RTN","PSGOE8",52,0)
A3 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",53,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",54,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",55,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE8",56,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G A3
"RTN","PSGOE8",57,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",58,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A3
"RTN","PSGOE8",59,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE8",60,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE8",61,0)
 ;
"RTN","PSGOE8",62,0)
26 ; schedule
"RTN","PSGOE8",63,0)
 S MSG=0,F2=26 S:PSGOEEF(F2) BACK="26^PSGOE8"
"RTN","PSGOE8",64,0)
A26 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",65,0)
 . W !!?5,"Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",66,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",67,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",68,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE8",69,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",70,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A26
"RTN","PSGOE8",71,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE8",72,0)
 N PSGOES,PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",73,0)
 I X'=PSGSCH D
"RTN","PSGOE8",74,0)
 . N XX
"RTN","PSGOE8",75,0)
 . S PSGSCH=X
"RTN","PSGOE8",76,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE8",77,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE8",78,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",79,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE8",80,0)
 .. I PSGSCH]"" S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0))
"RTN","PSGOE8",81,0)
 .. S PSGOST=$G(PSGST),PSGST=$P($G(^PS(51.1,XX,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE8",82,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE8",83,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE8",84,0)
 . S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE8",85,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",86,0)
 I PSGST="O" S PSGOEEF(7)=1
"RTN","PSGOE8",87,0)
 G DONE
"RTN","PSGOE8",88,0)
 ;
"RTN","PSGOE8",89,0)
7 ; schedule type
"RTN","PSGOE8",90,0)
 S MSG=0,F2=7 S:PSGOEEF(F2) BACK="7^PSGOE8"
"RTN","PSGOE8",91,0)
A7 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE8",92,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE8",93,0)
 S:X="F" X="R"
"RTN","PSGOE8",94,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE8",95,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE8",96,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",97,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A7
"RTN","PSGOE8",98,0)
 S PSGOST=PSGST
"RTN","PSGOE8",99,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE8",100,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE8",101,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE8",102,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE8",103,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE8",104,0)
 ;
"RTN","PSGOE8",105,0)
DONE ;
"RTN","PSGOE8",106,0)
 I PSGOEE G:'PSGOEEF(F2) @BACK S PSGOEE=PSGOEEF(F2)
"RTN","PSGOE8",107,0)
 K F,F0,F2 Q
"RTN","PSGOE8",108,0)
 ;
"RTN","PSGOE8",109,0)
DEL ; delete entry
"RTN","PSGOE8",110,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE8",111,0)
 Q
"RTN","PSGOE8",112,0)
 ;
"RTN","PSGOE8",113,0)
DH ;
"RTN","PSGOE8",114,0)
 W !!?2,"When the drug of an order is changed, the Dosage Ordered and Dispense Drug(s)",!,"for the order are no longer valid, and therefore deleted from the order.",!,"If possible, a new corresponding dispense drug will be added to the order."
"RTN","PSGOE8",115,0)
 W !!?2,"Answer 'YES' to continue with this change.  Answer 'NO' to select another",!,"drug or to accept the drug as it was.  Enter an '^' the exit this edit." Q
"RTN","PSGOE8",116,0)
 ;
"RTN","PSGOE8",117,0)
CHECK(PSJSYSP) ; Check to see if multiple dispense drugs
"RTN","PSGOE8",118,0)
 ; Input  -     PSJSYSP
"RTN","PSGOE8",119,0)
 ; Returns  0 = only one.
"RTN","PSGOE8",120,0)
 ;          1 = more than one
"RTN","PSGOE8",121,0)
 ; Checks Inactive Date and doesn't count if < or = today.
"RTN","PSGOE8",122,0)
 N PSJRSB,PSJINACT,PSJRBCNT S PSJRBCNT=0
"RTN","PSGOE8",123,0)
 F PSJRSB=0:0 S PSJRSB=$O(^PS(53.45,PSJSYSP,2,PSJRSB)) Q:'PSJRSB  D
"RTN","PSGOE8",124,0)
 .S PSJINACT=$P(^PS(53.45,PSJSYSP,2,PSJRSB,0),"^",3)
"RTN","PSGOE8",125,0)
 .I (PSJINACT="")!((PSJINACT>0)&(PSJINACT>DT)) D
"RTN","PSGOE8",126,0)
 ..S PSJRBCNT=$S('$D(PSJRBCNT):1,1:PSJRBCNT+1)
"RTN","PSGOE8",127,0)
 Q $S(PSJRBCNT>1:1,1:0)
"RTN","PSGOE8",128,0)
 ;
"RTN","PSGOE8",129,0)
PNDREN(PNDON) ;
"RTN","PSGOE8",130,0)
 I PNDON'["P" Q 0
"RTN","PSGOE8",131,0)
 S RNWL="^PS(53.1,"_+PNDON_",0)" S RNWL=$G(@(RNWL)) S RNWL=$S($P(RNWL,"^",24)="R":1,1:0)
"RTN","PSGOE8",132,0)
 Q RNWL
"RTN","PSGOE81")
0^8^B36275295^B21221443
"RTN","PSGOE81",1,0)
PSGOE81 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;10 Mar 99 / 10:55 AM
"RTN","PSGOE81",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**26,50,64,58,82,110,111,136,113**;16 DEC 97;Build 63
"RTN","PSGOE81",3,0)
 ;
"RTN","PSGOE81",4,0)
39 ; admin times
"RTN","PSGOE81",5,0)
 S MSG=0,PSGF2=39 S:PSGOEEF(PSGF2) BACK="39^PSGOE81",ORIG=$G(PSGAT)
"RTN","PSGOE81",6,0)
A39 I $$ODD^PSGS0(PSGS0XT)!(PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE81",7,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=ORIG G DONE
"RTN","PSGOE81",8,0)
 I X="" S:(($G(PSGS0XT)="D")&'PSGS0Y) PSGOEE=0 S:$G(PSGAT) X=PSGAT
"RTN","PSGOE81",9,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A39
"RTN","PSGOE81",10,0)
 I X=" "!(X?1."?") D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",11,0)
 I PSGS0XT="D"&'$G(X) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G A39
"RTN","PSGOE81",12,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE81",13,0)
 I X="@" D DEL G:%'=1 A39 S PSGAT="",X=""
"RTN","PSGOE81",14,0)
 I $G(PSGS0XT),'$$ODD^PSGS0(PSGS0XT),$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC",'$$PRNOK^PSGS0(PSGSCH),($G(PSGST)'="O") D TIMES I '$D(X) G A39
"RTN","PSGOE81",15,0)
 I (($G(PSGST)="O")!($G(PSGST)="OC")) I (X="") S (PSGAT,PSGS0Y)=X G DONE
"RTN","PSGOE81",16,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7) G A39
"RTN","PSGOE81",17,0)
 S PSGOAT=PSGAT
"RTN","PSGOE81",18,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE81",19,0)
 ;
"RTN","PSGOE81",20,0)
8 ; special instructions
"RTN","PSGOE81",21,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE81"
"RTN","PSGOE81",22,0)
A8 N DIR S DIR(0)="FO^1:180^D ^PSGSICHK",DIR("A")="SPECIAL INSTRUCTIONS",DIR("??")="^D ENHLP^PSGOEM(53.1,8)" S:$G(PSGSI)]"" DIR("B")=$P(PSGSI,"^") D ^DIR I $D(DUOUT)!$D(DTOUT) S PSGOEE=0 G DONE
"RTN","PSGOE81",23,0)
 I $E(X)=U D ENFF^PSGOE82 G:Y>0 @Y G A8
"RTN","PSGOE81",24,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",25,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE81",26,0)
 I Y="",PSGSI="" G DONE
"RTN","PSGOE81",27,0)
 S PSGSI=$S(Y]"":Y,1:PSGSI),PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE81",28,0)
 Q
"RTN","PSGOE81",29,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":PSGSI_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",30,0)
 I X="" S X=PSGSI I X="" G DONE
"RTN","PSGOE81",31,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A8
"RTN","PSGOE81",32,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",33,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE81",34,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",35,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",36,0)
 S PSGSI=X G DONE
"RTN","PSGOE81",37,0)
 ;
"RTN","PSGOE81",38,0)
10 ; start date/time
"RTN","PSGOE81",39,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE81"
"RTN","PSGOE81",40,0)
A10 ;
"RTN","PSGOE81",41,0)
 K PSGSDX N DUR,DURMIN,TMPFD
"RTN","PSGOE81",42,0)
 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE81",43,0)
 . W !?5,"Start Date may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE81",44,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",45,0)
 I X="",PSGSD W "  "_$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",46,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",47,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE81",48,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A10
"RTN","PSGOE81",49,0)
 NEW TMPX S TMPX=X,X1=+$G(PSGLI),X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE81",50,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE81",51,0)
 S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD)
"RTN","PSGOE81",52,0)
 I $G(PSGORD)["P",$G(PSGP) S DUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,"P",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D
"RTN","PSGOE81",53,0)
 . S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",54,0)
 G DONE
"RTN","PSGOE81",55,0)
 ;
"RTN","PSGOE81",56,0)
25 ; stop date
"RTN","PSGOE81",57,0)
 S MSG=0,PSGF2=25 S:PSGOEEF(PSGF2) BACK="25^PSGOE81"
"RTN","PSGOE81",58,0)
A25 ;
"RTN","PSGOE81",59,0)
 K PSGFDX
"RTN","PSGOE81",60,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",61,0)
 I X="",PSGFD S X=$P(PSGFDN,"^") ;W "   "_$P(PSGFDN,"^")
"RTN","PSGOE81",62,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A25
"RTN","PSGOE81",63,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE81",64,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE81",65,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A25 S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",66,0)
W25 ;
"RTN","PSGOE81",67,0)
 N Z,MSG
"RTN","PSGOE81",68,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE81",69,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE81",70,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE81",71,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE81",72,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE81",73,0)
 ;
"RTN","PSGOE81",74,0)
DONE ;
"RTN","PSGOE81",75,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE81",76,0)
 D EFDNV^PSJUTL
"RTN","PSGOE81",77,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE81",78,0)
 K ORIG
"RTN","PSGOE81",79,0)
 Q
"RTN","PSGOE81",80,0)
 ;
"RTN","PSGOE81",81,0)
FF ; up-arrow to another field
"RTN","PSGOE81",82,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE8"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE81"
"RTN","PSGOE81",83,0)
 Q
"RTN","PSGOE81",84,0)
 ;
"RTN","PSGOE81",85,0)
DEL ; delete entry
"RTN","PSGOE81",86,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE81",87,0)
 Q
"RTN","PSGOE81",88,0)
 ;
"RTN","PSGOE81",89,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE81",90,0)
 I ($G(PSGS0XT)'="O"),($G(PSGST)'="OC"),'$$PRNOK^PSGS0(PSGSCH) I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE81",91,0)
 N H,I,MAX
"RTN","PSGOE81",92,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE81",93,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE81",94,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE81",95,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE81",96,0)
 S MAX=1440/I
"RTN","PSGOE81",97,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE81",98,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE81",99,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE81",100,0)
 Q
"RTN","PSGOE81",101,0)
 ;
"RTN","PSGOE81",102,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE81",103,0)
 N INFO,X
"RTN","PSGOE81",104,0)
 S Z="",INFO=$S($G(PSGNESD):PSGNESD,1:$G(PSGSD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE81",105,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE81",106,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE81",107,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE81",108,0)
 Q
"RTN","PSGOE9")
0^9^B38035726^B34837178
"RTN","PSGOE9",1,0)
PSGOE9 ;BIR/CML3-EDIT ORDERS IN 55 ;13 May 98 / 7:58 AM
"RTN","PSGOE9",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,47,50,72,110,111,188,192,207,113**;16 DEC 97;Build 63
"RTN","PSGOE9",3,0)
 ;
"RTN","PSGOE9",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE9",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGOE9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE9",7,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGOE9",8,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE9",9,0)
 ;
"RTN","PSGOE9",10,0)
101 ; Orderable Item (AKA primary drug)
"RTN","PSGOE9",11,0)
 S MSG=0,PSGF2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(PSGF2) BACK="101^PSGOE9"
"RTN","PSGOE9",12,0)
 S %=1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%  D DH^PSGOE8
"RTN","PSGOE9",13,0)
 I %'=1 G DONE
"RTN","PSGOE9",14,0)
A101 ;
"RTN","PSGOE9",15,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",16,0)
 . W !!?5,"Orderable Item may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",17,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",18,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE9",19,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,101) G A101
"RTN","PSGOE9",20,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,101)
"RTN","PSGOE9",21,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A101
"RTN","PSGOE9",22,0)
 ;BHW;PSJ*5.0*192;Modify ^DIC call to use MIX^DIC and only B/C cross-references
"RTN","PSGOE9",23,0)
 K DIC,D S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")",D="B^C" D MIX^DIC1 K DIC,D I Y'>0 G A101
"RTN","PSGOE9",24,0)
 F  S %=2 D DH^PSGOE8,YN^DICN Q:%
"RTN","PSGOE9",25,0)
 I %'=1 G A101
"RTN","PSGOE9",26,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE9",27,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE9",28,0)
 S PSGPDNX=1,PSGPD=+Y,PSGPDN=$$OINAME^PSJLMUTL(PSGPD),PSGDO="" K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)="" G DONE
"RTN","PSGOE9",29,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE9",30,0)
 G DONE
"RTN","PSGOE9",31,0)
 ;
"RTN","PSGOE9",32,0)
109 ; dosage ordered
"RTN","PSGOE9",33,0)
 S MSG=0,PSGF2=109 S:PSGOEEF(PSGF2) BACK="109^PSGOE9"
"RTN","PSGOE9",34,0)
A109 ;
"RTN","PSGOE9",35,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",36,0)
 . W !!?5,"Dosage may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",37,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE9",38,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",39,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE9",40,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE9",41,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="@") W $C(7),"  (Required)" G A109
"RTN","PSGOE9",42,0)
 I '$$CHECK^PSGOE8(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE9",43,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",44,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A109
"RTN","PSGOE9",45,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE9",46,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",47,0)
 S PSGDO=X G DONE
"RTN","PSGOE9",48,0)
 ;
"RTN","PSGOE9",49,0)
3 ; med route
"RTN","PSGOE9",50,0)
 S MSG=0,PSGF2=3 S:PSGOEEF(PSGF2) BACK="3^PSGOE9"
"RTN","PSGOE9",51,0)
A3 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",52,0)
 . W !!?5,"Med Route may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",53,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",54,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE9",55,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,3) G A3
"RTN","PSGOE9",56,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,3)
"RTN","PSGOE9",57,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A3
"RTN","PSGOE9",58,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE9",59,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE9",60,0)
 ;
"RTN","PSGOE9",61,0)
7 ; schedule type
"RTN","PSGOE9",62,0)
 S MSG=0,PSGF2=7 S:PSGOEEF(PSGF2) BACK="7^PSGOE9"
"RTN","PSGOE9",63,0)
A7 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE9",64,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE9",65,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE9",66,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE9",67,0)
 I X="" S X=PSGST,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE9",68,0)
 S:X="F" X="R"
"RTN","PSGOE9",69,0)
 I ",?,??,C,O,OC,P,R,"'[(","_X_",") W " ??" G A7
"RTN","PSGOE9",70,0)
 I $$PRNOK^PSGS0($G(PSGSCH)),X="C" W "  ??" G A7
"RTN","PSGOE9",71,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,7) G A7
"RTN","PSGOE9",72,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A7
"RTN","PSGOE9",73,0)
 S PSGOST=PSGST
"RTN","PSGOE9",74,0)
 S PSGST=X,PSGSTN=$$ENSTN^PSGMI(X) W:PSGSTN]"" "  ",PSGSTN
"RTN","PSGOE9",75,0)
 I X="P",$G(PSGAT)]"" S PSGOAT=PSGAT S PSGAT="" D
"RTN","PSGOE9",76,0)
 .W !!,"NOTE: This change in schedule type also changes the ADMIN TIMES.",!
"RTN","PSGOE9",77,0)
 .S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",78,0)
 .I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",79,0)
 G DONE
"RTN","PSGOE9",80,0)
 ;
"RTN","PSGOE9",81,0)
26 ; schedule
"RTN","PSGOE9",82,0)
 S MSG=0,PSGF2=26 S:PSGOEEF(PSGF2) BACK="26^PSGOE9"
"RTN","PSGOE9",83,0)
A26 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",84,0)
 . W !!?5,"Schedule may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",85,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",86,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",87,0)
 S DOW=0 I $$DOW^PSIVUTL($$ENLU^PSGMI(X)) S DOW=1
"RTN","PSGOE9",88,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",89,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A26
"RTN","PSGOE9",90,0)
 ;BHW;PSJ*5*188;Add flag and IEN return variable for PSGS0 (PSJ*5*134), Highlight Admin Times if they changed.
"RTN","PSGOE9",91,0)
 N PSJSLUP,PSGSFLG S PSJSLUP=1,PSGSFLG=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",92,0)
 I X'=PSGSCH D
"RTN","PSGOE9",93,0)
 . S PSGSCH=X
"RTN","PSGOE9",94,0)
 . I PSGS0Y'=PSGAT S PSGAT=PSGS0Y  ;Change so that any schedule change will adjust the type and default the admin times - DRF
"RTN","PSGOE9",95,0)
 . D  ;Change schedule type to agree with schedule
"RTN","PSGOE9",96,0)
 .. I $G(DOW) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",97,0)
 .. I (PSGSCH[" PRN")!(PSGSCH="PRN") I $$PRNOK^PSGS0(PSGSCH) S PSGOST=PSGST,PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE9",98,0)
 .. I PSGSCH]"" S X=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0))
"RTN","PSGOE9",99,0)
 .. S PSGST=$P($G(^PS(51.1,X,0)),"^",5) I PSGST="D" S PSGST="C"  ;DOW schedules are converted to Continuous
"RTN","PSGOE9",100,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE9",101,0)
 . W !!,"NOTE: This change in schedule also changes the ADMIN TIMES and SCHEDULE TYPE.",!
"RTN","PSGOE9",102,0)
 . S MSG=1,PSGOEEF(39)=1
"RTN","PSGOE9",103,0)
 . I $G(PSJNEWOE) D PAUSE^VALM1
"RTN","PSGOE9",104,0)
 I PSGST="O" S PSGOEEF(7)=1
"RTN","PSGOE9",105,0)
 ;
"RTN","PSGOE9",106,0)
DONE ;
"RTN","PSGOE9",107,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE9",108,0)
 K F,F0,PSGF2 Q
"RTN","PSGOE9",109,0)
 ;
"RTN","PSGOE9",110,0)
DEL ; delete entry
"RTN","PSGOE9",111,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE9",112,0)
 Q
"RTN","PSGOE91")
0^10^B41628067^B24153403
"RTN","PSGOE91",1,0)
PSGOE91 ;BIR/CML3-ACTIVE ORDER EDIT (CONT.) ;10 JUL 96 / 7:54 AM
"RTN","PSGOE91",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,64,58,110,111,136,113**;16 DEC 97;Build 63
"RTN","PSGOE91",3,0)
 ;
"RTN","PSGOE91",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE91",5,0)
 ;
"RTN","PSGOE91",6,0)
41 ; admin times
"RTN","PSGOE91",7,0)
 S MSG=0,PSGF2=41,ORIG=$G(PSGAT) S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",8,0)
 I $$ODD^PSGS0(PSGS0XT)!(PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE91",9,0)
A41 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",10,0)
 . W !!?5,"ADMIN TIMES may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",11,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=ORIG G DONE
"RTN","PSGOE91",12,0)
 I X="" S:$G(PSGAT) X=PSGAT
"RTN","PSGOE91",13,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A41
"RTN","PSGOE91",14,0)
 I X="@" I (PSGS0XT="D")!(PSGSCH["@") I ((",P,R,OC,O,")'[(","_$G(PSGST)_",")) D  G A41
"RTN","PSGOE91",15,0)
 .W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(55.06,41)
"RTN","PSGOE91",16,0)
 I X="@" D DEL G:%'=1 A41 S PSGAT="",X=""
"RTN","PSGOE91",17,0)
 I (PSGST="O")!($G(PSGST)="OC")!($G(PSGST)="P")!$$ODD^PSGS0($P(ZZND,"^",3))!($P(ZZND,"^",5)="O") I X="" S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",18,0)
 I $G(PSGS0XT) I '$$ODD^PSGS0(PSGS0XT),$G(PSGST)'="P",$G(PSGST)'="OC",'$$PRNOK^PSGS0(PSGSCH) I ($G(PSGST)'="O") D TIMES I '$D(X) G A41
"RTN","PSGOE91",19,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",20,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",21,0)
 S PSGOAT=PSGAT
"RTN","PSGOE91",22,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",23,0)
 ;
"RTN","PSGOE91",24,0)
8 ; special instructions
"RTN","PSGOE91",25,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE91"
"RTN","PSGOE91",26,0)
A8 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE91",27,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE91",28,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE91",29,0)
 N DIR S DIR(0)="FO^1:180^D ^PSGSICHK",DIR("A")="SPECIAL INSTRUCTIONS",DIR("??")="^D ENHLP^PSGOEM(55.06,8)" S:$G(PSGSI)]"" DIR("B")=$P(PSGSI,"^") D ^DIR I $D(DUOUT)!$D(DTOUT) S PSGOEE=0 G DONE
"RTN","PSGOE91",30,0)
 I $E(X)=U D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",31,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",32,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",33,0)
 I Y="",PSGSI="" G DONE
"RTN","PSGOE91",34,0)
 S PSGSI=$S(Y]"":Y,1:PSGSI),PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE91",35,0)
 Q
"RTN","PSGOE91",36,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":PSGSI_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",37,0)
 I X="" S X=PSGSI I X="" G DONE
"RTN","PSGOE91",38,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",39,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",40,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",41,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",42,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",43,0)
 S PSGSI=X G DONE
"RTN","PSGOE91",44,0)
 ;
"RTN","PSGOE91",45,0)
10 ; start date/time
"RTN","PSGOE91",46,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE91"
"RTN","PSGOE91",47,0)
A10 ;
"RTN","PSGOE91",48,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",49,0)
 . W !!?5,"Start Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",50,0)
 K PSGSDX
"RTN","PSGOE91",51,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",52,0)
 I X="",PSGSD W "  "_PSGSDN G DONE
"RTN","PSGOE91",53,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE91",54,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,10)
"RTN","PSGOE91",55,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A10
"RTN","PSGOE91",56,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(55.06,10) G A10
"RTN","PSGOE91",57,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE91",58,0)
 S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) G DONE
"RTN","PSGOE91",59,0)
 ;
"RTN","PSGOE91",60,0)
34 ; stop date
"RTN","PSGOE91",61,0)
 S MSG=0,PSGF2=34 S:PSGOEEF(PSGF2) BACK="34^PSGOE91"
"RTN","PSGOE91",62,0)
A34 ;
"RTN","PSGOE91",63,0)
 K PSGFDX
"RTN","PSGOE91",64,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",65,0)
 . W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",66,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I '$T W $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",67,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSGOE91",68,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSGOE91",69,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSGOE91",70,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE91",71,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A34 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE91",72,0)
W34 ;Compare to Start Date
"RTN","PSGOE91",73,0)
 N Z,MSG
"RTN","PSGOE91",74,0)
 D DOSE I $G(Z)]"",Z>$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)) D  G A34
"RTN","PSGOE91",75,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE91",76,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE91",77,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE91",78,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE91",79,0)
 ;
"RTN","PSGOE91",80,0)
DONE ;
"RTN","PSGOE91",81,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE91",82,0)
 D EFDACT^PSJUTL
"RTN","PSGOE91",83,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE91",84,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT,ORIG Q
"RTN","PSGOE91",85,0)
 ;
"RTN","PSGOE91",86,0)
FF ; up-arrow to another field
"RTN","PSGOE91",87,0)
 D ENFF^PSGOEM I Y>0,Y'=41,Y'=8,Y'=10,Y'=34 S Y=Y_"^PSGOE9"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE91"
"RTN","PSGOE91",88,0)
 Q
"RTN","PSGOE91",89,0)
 ;
"RTN","PSGOE91",90,0)
DEL ; delete entry
"RTN","PSGOE91",91,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE91",92,0)
 Q
"RTN","PSGOE91",93,0)
 ;
"RTN","PSGOE91",94,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE91",95,0)
 I $G(PSGST)'="O",($G(PSGST)'="OC"),($G(PSGST)'="R") I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE91",96,0)
 N H,I,MAX
"RTN","PSGOE91",97,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE91",98,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE91",99,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE91",100,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE91",101,0)
 S MAX=1440/I
"RTN","PSGOE91",102,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE91",103,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE91",104,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE91",105,0)
 Q
"RTN","PSGOE91",106,0)
 ;
"RTN","PSGOE91",107,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE91",108,0)
 N INFO,X
"RTN","PSGOE91",109,0)
 S Z="",INFO=($S($G(PSGSD):PSGSD,1:$G(PSGNESD)))_U_($S($G(PSGFD):PSGFD,1:$G(PSGNEFD)))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE91",110,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE91",111,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE91",112,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE91",113,0)
 Q
"RTN","PSGOEF")
0^15^B83231206^B79585607
"RTN","PSGOEF",1,0)
PSGOEF ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR ;14 May 98 / 2:17 PM
"RTN","PSGOEF",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,30,29,35,39,47,50,56,80,116,110,111,133,153,134,222,113**;16 DEC 97;Build 63
"RTN","PSGOEF",3,0)
 ;
"RTN","PSGOEF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOEF",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOEF",6,0)
 ; Reference to DOSE^PSSORPH is supported by DBIA 3234.
"RTN","PSGOEF",7,0)
 ;
"RTN","PSGOEF",8,0)
START ;
"RTN","PSGOEF",9,0)
 I '$D(^PS(53.1,+PSGORD)) W $C(7),!?3,"Cannot find this pending order (#",+PSGORD,")." Q
"RTN","PSGOEF",10,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12) K PSGFDX,PSGEFN,PSGOEEF,PSGOES,PSGONF,PSGRDTX S PSGOES=1,(PSGOEF,PSGOEEF)=0,PSGOEEG=3
"RTN","PSGOEF",11,0)
 I $D(PSJTUD) S PSGDO=$P($G(^PS(53.1,+PSGORD,.3)),U),(PSGPDRG,PSGPD)=PSJCOI,(PSGPDRGN,PSGPDN)=$$OINAME^PSJLMUTL(PSGPD)
"RTN","PSGOEF",12,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S X=PSGSCH D EN^PSGORS0 D
"RTN","PSGOEF",13,0)
 . S:($D(X)&($P($G(^PS(53.1,+PSGORD,2)),"^",5)="")&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="N")) PSGAT=PSGS0Y
"RTN","PSGOEF",14,0)
 . NEW PSJDOX,PSJDOSE,PSJPIECE,PSJUNIT,PSJX,X
"RTN","PSGOEF",15,0)
 . S X=$G(^PS(53.1,+PSGORD,1,1,0)) Q:'+X
"RTN","PSGOEF",16,0)
 . D DOSE^PSSORPH(.PSJDOX,+X,"U")
"RTN","PSGOEF",17,0)
 . I $S('$D(PSJDOX):1,1:+PSJDOX(1)=-1) Q
"RTN","PSGOEF",18,0)
 . S PSJPIECE=$S($P(PSJDOX(1),U)="":3,1:1)
"RTN","PSGOEF",19,0)
 . S X=^PS(53.1,+PSGORD,.2)
"RTN","PSGOEF",20,0)
 . S:PSJPIECE=3 PSJDOSE=$P(X,U,2)
"RTN","PSGOEF",21,0)
 . S:PSJPIECE=1 PSJDOSE=$P(X,U,5),PSJUNIT=$P(X,U,6)
"RTN","PSGOEF",22,0)
 . F X=0:0 S X=$O(PSJDOX(X)) Q:+$G(PSJX)!'X  D
"RTN","PSGOEF",23,0)
 .. I PSJPIECE=3,($P(PSJDOX(X),U,3)'=PSJDOSE) Q
"RTN","PSGOEF",24,0)
 .. I PSJPIECE=1,($P(PSJDOX(X),U,1)_$P(PSJDOX(X),U,2)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",25,0)
 .. S:+$P(PSJDOX(X),U,12) $P(^PS(53.45,PSJSYSP,2,1,0),U,2)=+$P(PSJDOX(X),U,12),PSJX=1
"RTN","PSGOEF",26,0)
 I PSGEB'=PSGOPR F X=7,11 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEF",27,0)
 D GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",28,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S PSGSD="" D:PSGS0Y]""
"RTN","PSGOEF",29,0)
 .N PSJX S PSJX=$P($G(^PS(53.1,+PSGORD,0)),U,25) I PSJX="" Q
"RTN","PSGOEF",30,0)
 .I PSJX["U" S PSGSD=$P($G(^PS(55,DFN,5,+PSJX,2)),U,2) Q
"RTN","PSGOEF",31,0)
 .I PSJX["V" S PSGSD=$P($G(^PS(55,DFN,"IV",+PSJX,0)),U,2) Q
"RTN","PSGOEF",32,0)
 .I PSJX["P" S PSGSD=$P($G(^PS(53.1,+PSJX,2)),U,2)
"RTN","PSGOEF",33,0)
 S:PSGSD="" PSGSD=PSGLI
"RTN","PSGOEF",34,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",+PSGPD)
"RTN","PSGOEF",35,0)
 S:$P($G(PSGNEDFD),U,3)="" $P(PSGNEDFD,U,3)=PSGST  ; N PSGOEA S PSGOEA="R"
"RTN","PSGOEF",36,0)
 S (PSGNESD,PSGSD)=$$ENSD^PSGNE3(PSGSCH,PSGS0Y,PSGLI,PSGSD)
"RTN","PSGOEF",37,0)
 ;if this is a renewal order, ignore any 'requested start date' received.  Use the system calculated start date.
"RTN","PSGOEF",38,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" D
"RTN","PSGOEF",39,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEF",40,0)
 E  D
"RTN","PSGOEF",41,0)
 . S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSD
"RTN","PSGOEF",42,0)
 D   ; Extend the Default Stop Date if needed for the first renewed order.
"RTN","PSGOEF",43,0)
 .N PSGOEAO,PSGWALLO
"RTN","PSGOEF",44,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEAO=PSGOEA,PSGOEA="R",PSGWALLO=$P(^PS(55,DFN,5.1),U)
"RTN","PSGOEF",45,0)
 .D ENFD^PSGNE3(PSGLI) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSGOEF",46,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEA=PSGOEAO,$P(^PS(55,DFN,5.1),U)=PSGWALLO
"RTN","PSGOEF",47,0)
 N DUR,PSGRNSD S PSGRNSD=+$$LASTREN^PSJLMPRI(DFN,PSGORD) I PSGRNSD S DUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,"P",1) I DUR]"" D
"RTN","PSGOEF",48,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSGFD=$$FMADD^XLFDT(PSGRNSD,,,DURMIN)
"RTN","PSGOEF",49,0)
 S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOEF",50,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSGOEF",51,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) N DRG,DRGCNT S DRGCNT=0 D
"RTN","PSGOEF",52,0)
 .F X=0:0 S X=$O(^PSDRUG("ASP",+PSGPD,X)) Q:'X!(DRGCNT>1)  S:$P($G(^PSDRUG(+X,2)),U,3)["U" DRGCNT=DRGCNT+1,DRG=+X
"RTN","PSGOEF",53,0)
 .I DRGCNT=1 K ^PS(53.45,PSJSYSP,2) S ^PS(53.45,PSJSYSP,2,1,0)=DRG_U_1,^PS(53.45,PSJSYSP,2,0)="^53.4502^1^1",PS(53.45,PSJSYSP,2,"B",+DRG,1)=""
"RTN","PSGOEF",54,0)
 Q
"RTN","PSGOEF",55,0)
FINISH ;
"RTN","PSGOEF",56,0)
 ; force display of second screen if CPRS order checks exist
"RTN","PSGOEF",57,0)
 N NSFF,PSGOEF39 S NSFF=1 K PSJNSS
"RTN","PSGOEF",58,0)
 I $G(PSGORD),$D(PSGRDTX(+PSGORD)) D  K PSGRDTX
"RTN","PSGOEF",59,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRSD")) PSGSD=PSGRDTX(+PSGORD,"PSGRSD")
"RTN","PSGOEF",60,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRFD")) PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGRFD")):PSGRDTX(+PSGORD,"PSGRFD"),1:$G(PSGNEFD))
"RTN","PSGOEF",61,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8)
"RTN","PSGOEF",62,0)
 ; 
"RTN","PSGOEF",63,0)
 ; PSJ*5*222
"RTN","PSGOEF",64,0)
 ; PSJCT1 is a counter variable.  Every piece of a complex order calls PSGOEF.
"RTN","PSGOEF",65,0)
 ; The only time this code is to look for overlapping admin times is when the
"RTN","PSGOEF",66,0)
 ; first part of a complex order is being finished.  This variable will keep track
"RTN","PSGOEF",67,0)
 ; of how many "parts" of the complex order have been checked.
"RTN","PSGOEF",68,0)
 ; 
"RTN","PSGOEF",69,0)
 ; Also, since the user can select multiple complex orders to finish, like selecting
"RTN","PSGOEF",70,0)
 ; orders 1-2 or 1-3 from the profile, PSJCT1A will keep track of whether the parent
"RTN","PSGOEF",71,0)
 ; order number is the same as the first parent order number selected for finishing.
"RTN","PSGOEF",72,0)
 ; Since the PSJCT1 counter variable will still be set if multiple complex orders
"RTN","PSGOEF",73,0)
 ; are selected, PSJCT1 will be re-set to 1 if the parent complex order number (PSJCT1A) is
"RTN","PSGOEF",74,0)
 ; not equal to the original parent order number (PSJCOM).
"RTN","PSGOEF",75,0)
 ; 
"RTN","PSGOEF",76,0)
 S PSJCT1=$G(PSJCT1)+1
"RTN","PSGOEF",77,0)
 I PSJCT1=1 S PSJCT1A=PSJCOM
"RTN","PSGOEF",78,0)
 I $G(PSJCT1A)'=PSJCOM S PSJCT1=1,PSJCT1A=PSJCOM
"RTN","PSGOEF",79,0)
 ; End of flag setting for PSJ*5*222
"RTN","PSGOEF",80,0)
 I $O(^PS(53.1,+PSGORD,12,0))!$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSGOEF",81,0)
 .Q:$G(PSJLMX)=1  ; there's no second screen to display
"RTN","PSGOEF",82,0)
 .S VALMBG=16 D RE^VALM4,PAUSE^VALM1
"RTN","PSGOEF",83,0)
 D FULL^VALM1
"RTN","PSGOEF",84,0)
 I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSGOEF",85,0)
 I $G(PSJCOM)'="",$G(PSJCT1)=1 D
"RTN","PSGOEF",86,0)
 . D OVERLAP^PSGOEF2 I $G(PSJOVRLP)=1 D
"RTN","PSGOEF",87,0)
 . . N X,X1,DIR
"RTN","PSGOEF",88,0)
 . . W !!,"**WARNING**"
"RTN","PSGOEF",89,0)
 . . W !,"The highlighted admin times for these portions of this complex order overlap.",!!
"RTN","PSGOEF",90,0)
 . . S (X,X1)="" F  S X=$O(^TMP("PSJATOVR",$J,X)) Q:X=""  D
"RTN","PSGOEF",91,0)
 . . . S X1=$G(^TMP("PSJATOVR",$J,X))
"RTN","PSGOEF",92,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),"Part "_X,IORVOFF," has a schedule of "_$P(X1,"^",2)_" and admin time(s) of "
"RTN","PSGOEF",93,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),$P(X1,"^",3),IORVOFF
"RTN","PSGOEF",94,0)
 . . . W !
"RTN","PSGOEF",95,0)
 . . . W $S($G(PSJOVR("CONJ",X))="A":"AND",$G(PSJOVR("CONJ",X))="T":"THEN",1:""),!
"RTN","PSGOEF",96,0)
 . . W !,"Please ensure the schedules and administration times are appropriate.",!
"RTN","PSGOEF",97,0)
 . . S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSGOEF",98,0)
 K ^TMP("PSJATOVR",$J)
"RTN","PSGOEF",99,0)
 I $G(PSJPROT)=3,'$D(PSJTUD),'$$ENIVUD^PSGOEF1(PSGORD) Q
"RTN","PSGOEF",100,0)
 I $G(PSGOSCH)]"" D  S:$G(PSGS0XT)'="" $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSGOEF",101,0)
 .N PSGOES,PSGS0Y,PSGSCH S X=PSGOSCH K:$G(PSJTUD) NSFF D ENOS^PSGS0
"RTN","PSGOEF",102,0)
 .I '($G(PSGORD)["P"&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="R")) I $G(X)]""&$G(PSGS0Y) S:$G(PSGAT)="" PSGAT=PSGS0Y
"RTN","PSGOEF",103,0)
 .I $G(PSJNSS) S PSGOSCH="" K PSJNSS
"RTN","PSGOEF",104,0)
 .I $G(PSGORD)["P",$G(PSGAT),$G(PSGS0Y),($G(PSGOSCH)]"") I PSGAT'=PSGS0Y D
"RTN","PSGOEF",105,0)
 ..S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSGOEF",106,0)
 ..W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSGOEF",107,0)
 ..W !?13," for this administration schedule (",PSGOSCH,")",!
"RTN","PSGOEF",108,0)
 ..S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSGOEF",109,0)
 I $G(PSGS0XT)="" S $P(^PS(53.1,+PSGORD,2),"^",6)=$S($P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:"")
"RTN","PSGOEF",110,0)
 S CHK=0 S:$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" PSGSI=$$ENPC^PSJUTL("U",+PSJSYSP,180,PSGSI)
"RTN","PSGOEF",111,0)
 I '$G(PSJTUD),$G(PSJNSS),($G(PSGOSCH)]"") D NSSCONT^PSGS0(PSGOSCH,PSGS0XT) K PSJNSS S PSGOSCH=""
"RTN","PSGOEF",112,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10)
"RTN","PSGOEF",113,0)
 I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")
"RTN","PSGOEF",114,0)
 I 'PSGOEFF I (($G(PSGS0XT)="D")&($G(PSGAT)="")) S X=" Admin Times",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",115,0)
 I PSGOEFF,X]"" S X=X_" before it can be finished."
"RTN","PSGOEF",116,0)
 I PSGOEFF S CHK=1 W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSGOEF",117,0)
 I $G(PSGOEF39) S PSGOEE=0,PSGOEFF=0 D  I 'PSGOEE D REFRESH^VALM G DONE
"RTN","PSGOEF",118,0)
 .S F1=53.1,MSG=0,Y=$T(39),@("PSGFN(39)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEEF,PSGOEE)=1 W ! D @$P($T(39),";",3) S CHK=0
"RTN","PSGOEF",119,0)
 I PSGOEFF=1 S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0 G:'PSGOEE DONE
"RTN","PSGOEF",120,0)
 I PSGOEFF=11 S F1=53.1,MSG=0,Y=$T(32),@("PSGFN(32)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(32),";",3) D  G:'PSGOEE DONE
"RTN","PSGOEF",121,0)
 .S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0
"RTN","PSGOEF",122,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(+PSGPD,0) I CHK D ABORTACC Q
"RTN","PSGOEF",123,0)
 I 'PSGOEFF D OC531^PSGOESF ; check every dispense drug from CPRS
"RTN","PSGOEF",124,0)
 S VALMBG=1
"RTN","PSGOEF",125,0)
 I 'PSGOEFF&($D(PSGORQF)) D RE^VALM4 Q
"RTN","PSGOEF",126,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEF",127,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",128,0)
 S PSJLMFIN=1
"RTN","PSGOEF",129,0)
 K PSJACEPT I $O(^PS(53.1,+PSGORD,12,0)) S PSJLMP2=1
"RTN","PSGOEF",130,0)
 S PSGOEENO=0,PSGSTAT=$S($P(PSJSYSP0,U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEF",131,0)
 NEW PSJDOSE,PSJDOX,PSJDSFLG
"RTN","PSGOEF",132,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEF",133,0)
 S:+$G(PSJDSFLG) VALMSG="Dosage Ordered & Dispense Drug are not compatible"
"RTN","PSGOEF",134,0)
 I PSGODO=PSGDO S PSGOEEF(109)=""
"RTN","PSGOEF",135,0)
 I PSGODO'=PSGDO S PSGOEENO=1,VALMSG="This change will cause a new order to be created  "
"RTN","PSGOEF",136,0)
 D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEF",137,0)
 I $G(PSJNSS) D  S PSGOEEF(26)="" K PSJACEPT,PSJNSS
"RTN","PSGOEF",138,0)
 .K DIR S DIR(0)="FOA",DIR("A")="Invalid Schedule" D ^DIR K DIR
"RTN","PSGOEF",139,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y),'$G(PSGAT),((",P,R,")'[(","_$G(PSGST)_",")) D  S PSGOEEF(39)="" K PSJACEPT
"RTN","PSGOEF",140,0)
 .K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules  " D ^DIR K DIR
"RTN","PSGOEF",141,0)
 I $G(PSGAT)="",(PSGST="C"!(PSGST="R")) D
"RTN","PSGOEF",142,0)
 .I $G(PSGS0XT) Q:$$ODD^PSGS0(PSGS0XT)
"RTN","PSGOEF",143,0)
 .Q:$$PRNOK^PSGS0($G(PSGSCH))
"RTN","PSGOEF",144,0)
 .Q:($P($G(ZZND),"^",5)'="C")
"RTN","PSGOEF",145,0)
 .K PSJACEPT
"RTN","PSGOEF",146,0)
 .K DIR S DIR(0)="FOA",DIR("A")="  WARNING - Admin times are required for CONTINUOUS orders " D ^DIR K DIR
"RTN","PSGOEF",147,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",148,0)
 I $G(PSJRNF),$G(^PS(53.1,+PSGORD,4)) D
"RTN","PSGOEF",149,0)
 . W $C(7),!!,"ACCEPTING THIS ORDER WILL CHANGE THE STATUS TO ACTIVE."
"RTN","PSGOEF",150,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to make this order Active",DIR("?",1)="Enter ""N"" if you wish to exit without Activating this order,"
"RTN","PSGOEF",151,0)
 . S DIR("?")="or ""Y"" to continue with the Activation process." D ^DIR S:'Y Y=-1 K DIR
"RTN","PSGOEF",152,0)
 I $G(PSJRNF),$G(Y)=-1 S PSJACEPT=0 D ABORTACC Q
"RTN","PSGOEF",153,0)
 I $G(PSJRNF),$G(Y)=1 S PSGOEAV=1
"RTN","PSGOEF",154,0)
 I PSGOEENO S PSJNOO=$$ENNOO^PSJUTL5("E"),PSJACEPT=$S(PSJNOO<0:0,1:1)
"RTN","PSGOEF",155,0)
ACCEPT ;
"RTN","PSGOEF",156,0)
 S VALMBCK=$S($G(PSJACEPT):"Q",1:"R")
"RTN","PSGOEF",157,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",158,0)
 K PSGOES,PSGRSD,PSGRSDN D:PSGOEENO NEW3^PSGOEE D:'PSGOEENO UPD^PSGOEF1 I $D(PSGOEF)!PSGOEENO S PSGCANFL=-1
"RTN","PSGOEF",159,0)
 D DONE1^PSGOEE
"RTN","PSGOEF",160,0)
 D DONE
"RTN","PSGOEF",161,0)
 Q
"RTN","PSGOEF",162,0)
BYPASS ;
"RTN","PSGOEF",163,0)
 S PSGCANFL=1
"RTN","PSGOEF",164,0)
 ;
"RTN","PSGOEF",165,0)
DONE ;
"RTN","PSGOEF",166,0)
 K CHK,DA,DIE,DR,DRG,MSG,Q1,Q2,PSGNSTAT
"RTN","PSGOEF",167,0)
 K PSJOVR
"RTN","PSGOEF",168,0)
 Q
"RTN","PSGOEF",169,0)
ABORTACC ; Abort Accept process.
"RTN","PSGOEF",170,0)
 K PSJCT1,PSJOVR,PSJOVRLP,PSJCT1A
"RTN","PSGOEF",171,0)
 D ABORT^PSGOEE K PSGOEEF D GETUD^PSJLMGUD(PSGP,PSGORD),^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD) S VALMBCK="R",PSGSD=PSGNESD,PSGFD=PSGNEFD Q
"RTN","PSGOEF",172,0)
 ;
"RTN","PSGOEF",173,0)
 ;
"RTN","PSGOEF",174,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEF",175,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEF",176,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEF",177,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEF",178,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEF",179,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEF",180,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEF",181,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1      
"RTN","PSGOEF",182,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEF",183,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEF",184,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEF",185,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEF",186,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEF",187,0)
 ;
"RTN","PSGOEF",188,0)
AH ;
"RTN","PSGOEF",189,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSGOEF",190,0)
 Q
"RTN","PSGS0")
0^6^B75413878^B53406443
"RTN","PSGS0",1,0)
PSGS0 ;BIR/CML3-SCHEDULE PROCESSOR ; 6/22/09 7:12am
"RTN","PSGS0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**12,25,26,50,63,74,83,116,110,111,133,138,174,134,213,207,190,113**;16 DEC 97;Build 63
"RTN","PSGS0",3,0)
 ;
"RTN","PSGS0",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGS0",5,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSGS0",6,0)
 ;
"RTN","PSGS0",7,0)
ENA ; entry point for train option
"RTN","PSGS0",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGS0",9,0)
 F  S (PSGS0Y,PSGS0XT)="" R !!,"Select STANDARD SCHEDULE: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" ENQ^PSGSH I X'?1."?" D EN W:$D(X)[0 $C(7),"  ??" I $D(X)#2,'PSGS0Y,PSGS0XT W "  Every ",PSGS0XT," minutes"
"RTN","PSGS0",10,0)
 K DIC,DIE,PSGS0XT,PSGS0Y,Q,X,Y,PSGDT Q
"RTN","PSGS0",11,0)
 ;
"RTN","PSGS0",12,0)
EN3 ;
"RTN","PSGS0",13,0)
 S PSGST=$P($G(^PS(53.1,DA,0)),"^",7) G EN
"RTN","PSGS0",14,0)
 ;
"RTN","PSGS0",15,0)
EN5 ;
"RTN","PSGS0",16,0)
 S PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7)
"RTN","PSGS0",17,0)
 ;
"RTN","PSGS0",18,0)
EN ; validate
"RTN","PSGS0",19,0)
 K PSGS0Y
"RTN","PSGS0",20,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X)>70)!($L(X)<1) K X Q
"RTN","PSGS0",21,0)
 S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSGS0",22,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) I '$D(PSGOES) D EN^DDIOL("  ("_X_")")
"RTN","PSGS0",23,0)
 ;
"RTN","PSGS0",24,0)
ENOS ; order set entry
"RTN","PSGS0",25,0)
 N X0,Y0,PSJXI,PSJDIC2,TMPAT
"RTN","PSGS0",26,0)
 I $G(X)="",$G(P(2)),$G(P(3)) S X=$G(P(9))
"RTN","PSGS0",27,0)
 I $G(X)="" Q
"RTN","PSGS0",28,0)
 S PSGXT=$G(PSGS0XT),(PSGS0XT,PSGS0Y,XT,Y,PSJNSS)=""
"RTN","PSGS0",29,0)
 S X0=X I X?2.4N1"-".E!(X?2.4N) D ENCHK S:$D(X) Y=X G Q
"RTN","PSGS0",30,0)
 ; * GUI 27 CHANGES * Check for admin times to be derived from 'base' schedule
"RTN","PSGS0",31,0)
 I X["@" S TMPAT=$P(X,"@",2) I TMPAT]"" D
"RTN","PSGS0",32,0)
 .I '$D(^PS(51.1,"AC","PSJ",TMPAT)) K TMPAT Q
"RTN","PSGS0",33,0)
 .I '$$DOW^PSIVUTL($P(X,"@")) K TMPAT Q
"RTN","PSGS0",34,0)
 .N LYN,ZZND,PSGS0XT,PSGS0Y,X S (PSGS0Y,PSGS0XT,X)=""
"RTN","PSGS0",35,0)
 .S X=TMPAT D DIC I $G(Y0)>0 S TMPAT=Y0
"RTN","PSGS0",36,0)
 I $G(TMPAT) S (PSGS0Y,$P(X,"@",2))=TMPAT,PSGS0XT="D"
"RTN","PSGS0",37,0)
 ; * GUI 27 CHANGES *
"RTN","PSGS0",38,0)
 I X["PRN",$$PRNOK(X),'$D(^PS(51.1,"AC","PSJ",X)) D  G Q
"RTN","PSGS0",39,0)
 .;PSJ*5*190 Check for One-time PRN
"RTN","PSGS0",40,0)
 .I $$ONE^PSJBCMA(DFN,$G(ON),X)="O" S XT="O" Q
"RTN","PSGS0",41,0)
 .I X["@"!$$DOW^PSIVUTL($P(X," PRN")) N DOW D  I $G(DOW) S (Y0,Y,PSGS0Y)=$P($P(X,"@",2)," ")
"RTN","PSGS0",42,0)
 ..N TMP S TMP=X N X S X=$P(TMP," PRN") D DW I $G(X)]"" S DOW=1
"RTN","PSGS0",43,0)
 ..I $G(DOW),$G(PSGST)]"" I ",P,R,"'[(","_PSGST_",") S (XT,PSGS0XT)="D"
"RTN","PSGS0",44,0)
 D DIC I $G(XT)]""!$G(Y0)!($G(X)]""&$G(PSJXI)) D  Q:'$D(X)  I $G(X)]"",PSGS0XT'="D" G:$D(^PS(51.1,"AC","PSJ",X)) Q3 I $P(X,"@")]"" G:$D(^PS(51.1,"AC","PSJ",$P(X,"@"))) Q3
"RTN","PSGS0",45,0)
 .S PSGS0XT=XT S:$G(Y0) (Y,PSGS0Y)=Y0 S:'PSGS0Y&((PSGS0XT)="D")&(X["@") PSGS0Y=$P(X,"@",2)
"RTN","PSGS0",46,0)
 .S PSGS0Y=$P(PSGS0Y," ")
"RTN","PSGS0",47,0)
 .; If entering from Verify action, and schedule exists in schedule file, and order's schedule is continuous,
"RTN","PSGS0",48,0)
 .; OR the order's schedule type is fill on request and the order's schedule is defined as continuous in schedule file,
"RTN","PSGS0",49,0)
 .; AND the order's schedule is not a PRN schedule, the order must have admin times.
"RTN","PSGS0",50,0)
 .Q:$G(PSGOES)'=2  Q:'$D(^PS(51.1,"AC","PSJ",X))
"RTN","PSGS0",51,0)
 .I $G(PSGST)="C"!($G(PSGST)="R"&($P($G(ZZND),"^",3))) I ($G(PSGST)'="P"),($G(PSGSCH)'[" PRN"),'$G(PSGAT),($P($G(ZZND),"^",5)'="O"),'$$ODD^PSGS0($G(PSGS0XT)),'$$ODD^PSGS0($P(ZZND,"^",3)) K X Q
"RTN","PSGS0",52,0)
 N TMPSCHX S TMPSCHX=X I $L(X,"@")<3 S TMPX=X D DW I $G(X)]"" K PSJNSS S (PSGS0XT,XT)="D" D  G Q
"RTN","PSGS0",53,0)
 .S Y=$S(($G(TMPSCHX)["@"):$P(TMPSCHX,"@",2),1:"")
"RTN","PSGS0",54,0)
 .I Y,(X'["@"),(TMPSCHX["@") S X=TMPSCHX
"RTN","PSGS0",55,0)
 S X=TMPSCHX
"RTN","PSGS0",56,0)
 I X'="" I $D(^PS(51.1,"AC","PSJ",X)) K PSJNSS G Q
"RTN","PSGS0",57,0)
 ;
"RTN","PSGS0",58,0)
NS I ($G(X)="^")!($G(X)="") K X S Y="" Q
"RTN","PSGS0",59,0)
 N NS S NS=0,PSJNSS=0
"RTN","PSGS0",60,0)
 I $G(Y)'>0 S X=X0,Y="",NS=1,PSJNSS=1
"RTN","PSGS0",61,0)
Q ;
"RTN","PSGS0",62,0)
 S PSGS0XT=$S(XT]"":XT,1:$G(PSGS0XT)),PSGS0Y=$S($G(Y):Y,$G(PSGS0Y):PSGS0Y,1:"") S:PSGS0XT<0 PSGS0XT=""
"RTN","PSGS0",63,0)
 I ('$G(PSGS0Y)&'$G(PSJDIC2)&$G(PSGAT))&'$G(PSJNEWOE)&$G(PSGS0XT) I PSGS0XT<1441 I ($L($G(PSGAT),"-")=PSGS0XT/1440)!($G(X)]""&($G(PSGSCH)=$G(X))) S PSGS0Y=$G(PSGAT)
"RTN","PSGS0",64,0)
Q2 K YY
"RTN","PSGS0",65,0)
 I '$G(PSJNSS),'$G(PSGS0Y),$G(YY) S PSGS0Y=YY
"RTN","PSGS0",66,0)
 I $G(X)]"",$$SCHREQ^PSJLIVFD(.P) D
"RTN","PSGS0",67,0)
 .I $$DOW^PSIVUTL(X)!$$PRNOK(X)!$D(^PS(51.1,"AC","PSJ",X)) S PSJNSS=0 Q
"RTN","PSGS0",68,0)
 .I $G(P(2))&$G(P(3)) D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",69,0)
 I ($G(PSJNSS)&($G(VALMBCK)'="Q"))!($G(PSJNSS)&$G(PSJLIFNI))!($G(PSJNSS)&$G(PSJTUD)) D
"RTN","PSGS0",70,0)
 .I $G(P(2))&$G(P(3)) Q
"RTN","PSGS0",71,0)
 .I ($G(X)]"") I ($G(PSGS0XT)'="D") D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",72,0)
Q3 I $G(X)]"" I $D(^PS(51.1,"AC","PSJ",X)) K PSJNSS
"RTN","PSGS0",73,0)
 K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSGS0",74,0)
 ;
"RTN","PSGS0",75,0)
NSSCONT(SCH,FREQ) ;
"RTN","PSGS0",76,0)
 Q:SCH=""!($G(VALMBCK)]"")!$G(PSGMARSD)!$G(PSIVFN1)
"RTN","PSGS0",77,0)
 I $G(PSGOES),'$G(NSFF) Q
"RTN","PSGS0",78,0)
 N PSGS0XT,PSGSCH,DIR,X,Y S PSGSCH=SCH,PSGS0XT=FREQ,PSJNSS=1
"RTN","PSGS0",79,0)
 D NSSMSG I ($L(PSJNSS)>2),'$G(PSJXI) W !!,PSJNSS,! S PSJNSS=1
"RTN","PSGS0",80,0)
 S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSGS0",81,0)
 K NSFF Q
"RTN","PSGS0",82,0)
 ;
"RTN","PSGS0",83,0)
NSSMSG ;
"RTN","PSGS0",84,0)
 Q:$G(PSJXI)
"RTN","PSGS0",85,0)
 I '(",O,"[(","_$G(PSGST)_",")),$G(PSJNSS),$G(PSGSCH)]"" D
"RTN","PSGS0",86,0)
 .S PSJNSS=" WARNING - "_PSGSCH_" is an invalid schedule."
"RTN","PSGS0",87,0)
 S PSGSCH="",PSGS0XT=""
"RTN","PSGS0",88,0)
 Q
"RTN","PSGS0",89,0)
 ;
"RTN","PSGS0",90,0)
NSO(FQ) ;
"RTN","PSGS0",91,0)
 Q:'FQ!(FQ<0)!(",D,O,"[(","_$G(PSGST)_",")) ""
"RTN","PSGS0",92,0)
 K FRQOUT S FRQOUT=$S(FQ<60:(FQ_"minute"),(FQ<1440)&(FQ#60):(FQ_" minute"),(FQ<1440)!(FQ#1440):(FQ/60_" hour"),1:(FQ/1440_" day")) D
"RTN","PSGS0",93,0)
 . S:(+FRQOUT'=1) FRQOUT=FRQOUT_"s"
"RTN","PSGS0",94,0)
 Q FRQOUT
"RTN","PSGS0",95,0)
 ;
"RTN","PSGS0",96,0)
ENCHK ;
"RTN","PSGS0",97,0)
 N H,I
"RTN","PSGS0",98,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSGS0",99,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSGS0",100,0)
 S X(1)=$L(X(1)) I X'["-"&((X>$E(2400,1,X(1))!($E(X,3,4)>59))) K X Q
"RTN","PSGS0",101,0)
 F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$E(2400,1,X(1)):1,$E(X(3),3,4)>59:1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSGS0",102,0)
 Q:'$D(X)
"RTN","PSGS0",103,0)
 F X(2)=1:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $E(X(3),3,4)>59 K X Q
"RTN","PSGS0",104,0)
 Q:'$D(X)
"RTN","PSGS0",105,0)
 S X(1)=$L(X,"-"),X(2)=$G(PSGS0XT),PSGSCH=$S($G(PSGSCH)]"":PSGSCH,1:$G(P(9)))
"RTN","PSGS0",106,0)
 I $G(PSGSCH)="" Q  ;No schedule info, so just validate the numbers and quit.
"RTN","PSGS0",107,0)
 I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",5)
"RTN","PSGS0",108,0)
 I $G(I)="" S I=$S(PSGSCH["PRN":"P",1:"C")
"RTN","PSGS0",109,0)
 I I="D",$L(X,"-")>0 K:$D(X) X(1),X(2),X(3) S I="C" Q  ;DOW schedules require at least one admin time
"RTN","PSGS0",110,0)
 I $G(I)="O" D  Q  ;One Time schedules
"RTN","PSGS0",111,0)
 . I $L(X,"-")>1 K X Q  ;One Time schedules allow one admin time
"RTN","PSGS0",112,0)
 I X(2)="" Q  ;No frequency - cannot validate admin times to frequency
"RTN","PSGS0",113,0)
 I X(2)>1439,$L(X,"-")>1 K X Q  ;PSJ*5*113 Schedules with frequency greater than 1 day can only have one admin time.
"RTN","PSGS0",114,0)
 I X(2)>0,X(2)<1440,X(1)>(1440/X(2)) K X Q  ;PSJ*5*113 Admin times must match frequency or fewer
"RTN","PSGS0",115,0)
 I X(2)>0,X(2)<1440,1440#X(2)'=0,X(1)>0 K X Q  ;PSJ*5*113 Odd schedules cannot have admin times
"RTN","PSGS0",116,0)
 I X(2)>0,X(2)>1440,X(2)#1440'=0,X(1)>1 K X Q  ;PSJ*5*113 Odd schedules cannot have admin times
"RTN","PSGS0",117,0)
 K:$D(X) X(1),X(2),X(3)
"RTN","PSGS0",118,0)
 Q
"RTN","PSGS0",119,0)
 ;
"RTN","PSGS0",120,0)
DIC ; Check for schedule's existence in ADMINISTRATION SCHEDULE file (#51.1)
"RTN","PSGS0",121,0)
 ; Input:    
"RTN","PSGS0",122,0)
 ;           X = Schedule Name
"RTN","PSGS0",123,0)
 ;     PSJSLUP = If $G(PSJSLUP), perform interactive fileman lookup (optional).
"RTN","PSGS0",124,0)
 ;     PSGSFLG = If $G(PSGSFLG), return schedule IEN in PSGSCIEN variable (optional)
"RTN","PSGS0",125,0)
 ;    PSJLIFNI = Flag indicating a U/D order is being finished as an IV (optional).
"RTN","PSGS0",126,0)
 ;      PSGOES = If PSGOES=1, IX^DIC is called silently. If PSGOES=2, IX^DIC is not called (optional).
"RTN","PSGS0",127,0)
 ;      PSJPWD = IEN of Inpatient Ward associated with the patient/order/schedule combination (optional).
"RTN","PSGS0",128,0)
 ; Output:
"RTN","PSGS0",129,0)
 ;           X = Schedule Name if valid Input Schedule X, undefined if invalid Input Schedule X.
"RTN","PSGS0",130,0)
 ;     PSGS0XT = Frequency of validated schedule.
"RTN","PSGS0",131,0)
 ;     PSGS0Y  = Default Admin Times of validated schedule.
"RTN","PSGS0",132,0)
 ;    PSGSCIEN = IEN of validated schedule, if PSGSLFG is passed in and is evaluated to TRUE.
"RTN","PSGS0",133,0)
 ;
"RTN","PSGS0",134,0)
 K Y0,PSJXI N Y,PSGS0ST
"RTN","PSGS0",135,0)
 S Z=0 F PSJXI=0:1 S Z=$O(^PS(51.1,"AC","PSJ",X,Z)) Q:'Z
"RTN","PSGS0",136,0)
 I $G(X)]"",'$G(PSJSLUP) D
"RTN","PSGS0",137,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) D  Q:$G(PSGS0Y)&($G(PSGS0XT)]"")
"RTN","PSGS0",138,0)
 ..I $$DOW^PSIVUTL(X) S PSGS0XT="D",PSJNSS=0 S:X["@" (Y0,PSGS0Y)=$P(X,"@",2) Q
"RTN","PSGS0",139,0)
 ..I $G(NSFF) S Y0=$S($G(PSGS0Y):PSGS0Y,$G(PSGAT)&'$G(PSJNEWOE):PSGAT,1:"") S:Y0 PSGS0Y=Y0
"RTN","PSGS0",140,0)
 .; Check for duplicate schedules - force selection
"RTN","PSGS0",141,0)
 .Q:PSJXI>1&('$G(PSGOES))&($G(PSGS0XT)]"")
"RTN","PSGS0",142,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) N FREQ,ADMATCH S FREQ=$G(PSGS0XT) D
"RTN","PSGS0",143,0)
 ..N PSGS0XT,PSGS0Y,PSGST D ADMIN^PSJORPOE S:$G(PSGS0XT) XT=PSGS0XT S:$G(PSGS0Y) (Y0,Y)=PSGS0Y I $G(PSGST)'="" S PSGS0ST=PSGST
"RTN","PSGS0",144,0)
 ..;Check flag PSGSFLG to determine whether to return the schedule IEN in PSGSCIEN.
"RTN","PSGS0",145,0)
 .S:$G(XT)]"" PSGS0XT=XT S:$G(Y) PSGS0Y=Y
"RTN","PSGS0",146,0)
 .I $$DOW^PSIVUTL(X) S:PSGS0XT="" (XT,PSGS0XT)="D" S:PSGS0Y="" (Y0,PSGS0Y)=$S($P(X,"@",2):$P(X,"@",2),1:"")
"RTN","PSGS0",147,0)
 I $G(PSJLIFNI)!($G(P(4))]""&($G(P(2))]"")) I '$D(^PS(51.1,"AC","PSJ",X))!($G(PSJXI)>1) S PSJSLUP=1
"RTN","PSGS0",148,0)
 I $G(NSFF),$G(PSJXI)>1 D
"RTN","PSGS0",149,0)
 .I $G(PSGS0XT)="",$G(NSFF),$G(PSGXT)]"" S PSGS0XT=PSGXT Q
"RTN","PSGS0",150,0)
 .I $G(PSGS0XT)=""!($G(PSGS0Y)="") S PSJSLUP=1
"RTN","PSGS0",151,0)
 I '$G(PSJSLUP) Q:$G(PSGS0XT)]""&($G(PSGS0Y)]"")  Q:($G(PSGS0XT)="D"&('$D(^PS(51.1,"AC","PSJ",X))))
"RTN","PSGS0",152,0)
 Q:$G(PSGOES)=2
"RTN","PSGS0",153,0)
 Q:$G(PSGS0XT)]""&(PSJXI=1)
"RTN","PSGS0",154,0)
 I $G(PSGS0ST)="O",PSJXI=1 Q  ;one-time order,exact match (PSJ*5*207)
"RTN","PSGS0",155,0)
 K PSJSLUP
"RTN","PSGS0",156,0)
 ;
"RTN","PSGS0",157,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSGOES))_"ISZ",DIC("W")="W ""  "","_$S('$D(PSJPWD):"$P(^(0),""^"",2)",'PSJPWD:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ"
"RTN","PSGS0",158,0)
 S PSJDIC2=1
"RTN","PSGS0",159,0)
 D IX^DIC K DIC S:$D(DIE)#2 DIC=DIE I Y'>0 D  Q
"RTN","PSGS0",160,0)
 .I '$$DOW^PSIVUTL(X),'$$PRNOK(X),'$$ODD($G(PSGS0XT)),'$$ODD($P($G(ZZND),"^",3)),($P($G(ZZND),"^",5)'="O") S X="",PSJNSS=1,XT="",PSJXI=""
"RTN","PSGS0",161,0)
 S XT=$S("C"[$P(Y(0),"^",5):$P(Y(0),"^",3),1:$P(Y(0),"^",5))
"RTN","PSGS0",162,0)
 S X=+Y,Y="" I $D(PSJPWD),$D(^PS(51.1,+X,1,+PSJPWD,0)) S Y=$P(^(0),"^",2)
"RTN","PSGS0",163,0)
 ;Check flag PSGSFLG to determine whether to return the schedule IEN in PSGSCIEN.
"RTN","PSGS0",164,0)
 I $G(PSGSFLG) S PSGSCIEN=X
"RTN","PSGS0",165,0)
 S (X,X0)=Y(0,0) S:$G(Y)="" Y=$P(Y(0),"^",2)
"RTN","PSGS0",166,0)
 S (PSGS0Y,Y0)=$G(Y),Y0(0)=Y(0) I $P(Y(0),"^",3) S XT=$P(Y(0),"^",3)
"RTN","PSGS0",167,0)
 I $G(PSGS0XT)="",$$DOW^PSIVUTL(X) S (XT,PSGS0XT)="D"
"RTN","PSGS0",168,0)
 Q
"RTN","PSGS0",169,0)
 ;
"RTN","PSGS0",170,0)
DW ;
"RTN","PSGS0",171,0)
 N Y
"RTN","PSGS0",172,0)
 Q:($L(X,"@")>2)
"RTN","PSGS0",173,0)
 N AT I X["@" S AT=$P(X,"@",2)
"RTN","PSGS0",174,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) N XABB S XABB=""
"RTN","PSGS0",175,0)
 I X]"" D ENCHK Q:'$D(X)
"RTN","PSGS0",176,0)
 S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-"  ;F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSGS0",177,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSGS0",178,0)
 I $D(X) F II=1:1:$L(X,X(1)) S XABB=$G(XABB)_$E($P(X,X(1),II),1,2)_"-"
"RTN","PSGS0",179,0)
 K X(1) S:$D(X) X=SDW I $G(X)]"" I $TR(XABB,"-")]"" S X=$E($G(XABB),1,$L(XABB)-1)
"RTN","PSGS0",180,0)
 I $G(AT) S PSGS0Y=AT
"RTN","PSGS0",181,0)
 Q
"RTN","PSGS0",182,0)
DWC I $L(Z)<2 K X Q
"RTN","PSGS0",183,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSGS0",184,0)
 E  K X
"RTN","PSGS0",185,0)
 Q
"RTN","PSGS0",186,0)
 ;
"RTN","PSGS0",187,0)
PRNOK(PSCH) ;
"RTN","PSGS0",188,0)
 Q:PSCH'["PRN" 0
"RTN","PSGS0",189,0)
 I $TR(PSCH," ")="PRN" Q 1
"RTN","PSGS0",190,0)
 N BASE,I,OK S OK=0 S I=$P(PSCH," PRN") I I]"",$D(^PS(51.1,"AC","PSJ",I)) S OK=1
"RTN","PSGS0",191,0)
 I 'OK D
"RTN","PSGS0",192,0)
 .I PSCH["@" I $D(^PS(51.1,"AC","PSJ",$P(PSCH,"@")))!$$DOW^PSIVUTL($P(PSCH,"@")) S OK=1 Q
"RTN","PSGS0",193,0)
 .I $$DOW^PSIVUTL($P(PSCH," PRN")) S OK=1
"RTN","PSGS0",194,0)
 Q OK
"RTN","PSGS0",195,0)
ODD(PSF) ;determine if this is an odd schedule
"RTN","PSGS0",196,0)
 I PSF>1439,PSF#1440 Q 1
"RTN","PSGS0",197,0)
 I PSF,PSF<1440,1440#PSF Q 1
"RTN","PSGS0",198,0)
 Q 0
"RTN","PSIVCHK")
0^12^B22884839^B15710201
"RTN","PSIVCHK",1,0)
PSIVCHK ;BIR/PR,MLM-CHECK ORDER FOR INTEGRITY ;12 DEC 97 / 10:16 AM
"RTN","PSIVCHK",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**54,58,81,111,213,113**;16 DEC 97;Build 63
"RTN","PSIVCHK",3,0)
 ;
"RTN","PSIVCHK",4,0)
 ; Reference to ^PS(51.1 supported by DBIA# 2177.
"RTN","PSIVCHK",5,0)
 ; Reference to ^DIE supported by DBIA# 2053.
"RTN","PSIVCHK",6,0)
 ;
"RTN","PSIVCHK",7,0)
 ;Need DFN and ON
"RTN","PSIVCHK",8,0)
 W ! S ERR=0,P("TYP")=P(4) S:P("TYP")="C" P("TYP")=P(23) I P("TYP")="S" S P("TYP")=$S(+P(5):"P",1:"A")
"RTN","PSIVCHK",9,0)
 I '+P("MR") W !,"*** You have not specified a med route! ",! S ERR=1
"RTN","PSIVCHK",10,0)
 I P(11)]"" S X=P(11),X(2)=$G(P(15)) D
"RTN","PSIVCHK",11,0)
 .N PSGSCH S PSGSCH=$G(P(9))
"RTN","PSIVCHK",12,0)
 .D ENCHK^PSGS0 K X(2)
"RTN","PSIVCHK",13,0)
 .I $G(P(15)) I $$ODD^PSGS0(P(15)) W !,"*** Administration times not permitted for Odd Schedules ***" S P(11)="",ERR=1 Q
"RTN","PSIVCHK",14,0)
 .I $G(P(9))]"" I $$PRNOK^PSGS0(P(9)) W !,"*** Administration times not permitted for PRN Schedules ***" S P(11)="",ERR=1 Q
"RTN","PSIVCHK",15,0)
 .I '$D(X) W !,"*** Your administration time(s) are in an invalid format, ",!,"*** or there are more times than indicated by the schedule !" S ERR=1
"RTN","PSIVCHK",16,0)
 ; If schedule exists in schedule file, and order's schedule is continuous,
"RTN","PSIVCHK",17,0)
 ; OR the order's schedule type is fill on request and the order's schedule is defined as continuous in schedule file,
"RTN","PSIVCHK",18,0)
 ; AND the order's schedule is not a PRN schedule, the order must have admin times.
"RTN","PSIVCHK",19,0)
 I $G(P(9))'="" I $D(^PS(51.1,"AC","PSJ",P(9))),'$G(ERR) D
"RTN","PSIVCHK",20,0)
 .N XC,XIEN,XTYP,XAR S (XC,XIEN)="" F XC=0:1 S XIEN=$O(^PS(51.1,"AC","PSJ",P(9),XIEN)) Q:XIEN=""  S XTYP=$P(^PS(51.1,XIEN,0),"^",5) S:XTYP'="" XAR(XTYP)=""
"RTN","PSIVCHK",21,0)
 .S XTYP="" F XC=0:1 S XTYP=$O(XAR(XTYP)) Q:XTYP=""
"RTN","PSIVCHK",22,0)
 .I $$ODD^PSGS0($G(P(15)))!($$PRNOK^PSGS0($G(P(9)))) S P(11)="" Q
"RTN","PSIVCHK",23,0)
 .I $G(P(15))]"" I XC<2,'$$PRNOK^PSGS0(P(9)),'$G(P(11)),($G(P(15))'="O"),'$$ONCALL^PSIVEDT1($G(P(9))),'$$ONETIME^PSIVEDT1($G(P(9))) S ERR=1 W !,"*** There are no administration times defined for this order!"
"RTN","PSIVCHK",24,0)
M I P(15)<0 S ERR=1 W !,"*** Time interval between doses is less than zero !"
"RTN","PSIVCHK",25,0)
 NEW X S X=0 S:P(9)]"" X=$O(^PS(51.1,"APPSJ",P(9),0))
"RTN","PSIVCHK",26,0)
 N XX F XX=2,3 I $P(P(XX),".",2)=""!($L(P(XX))>12) S ERR=1 W !,"*** ",$S(XX=2:"Start",1:"Stop")," date is in an invalid format or must contain time !"
"RTN","PSIVCHK",27,0)
 I P(2)>P(3) S ERR=1 W !,"*** Start date/time CANNOT be greater than the stop date/time"
"RTN","PSIVCHK",28,0)
 I $$SCHREQ^PSJLIVFD(.P),'X D
"RTN","PSIVCHK",29,0)
 .N PSJXSTMP S PSJXSTMP=P(9) I PSJXSTMP="" S ERR=1 Q
"RTN","PSIVCHK",30,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSJXSTMP D ENOS^PSGS0 I $G(X)]""&($G(X)=$G(PSJXSTMP)) Q
"RTN","PSIVCHK",31,0)
 .W !," *** WARNING -- Missing or Invalid Schedule ...",! S ERR=1
"RTN","PSIVCHK",32,0)
INF I P(8)="","AH"[P("TYP") S ERR=1 W !,"*** You have no infusion rate defined !"
"RTN","PSIVCHK",33,0)
 I "AH"[P("TYP"),P(8)'?1N.N.1".".1N1" ml/hr",P(8)'?.E1"@"1N.N,P(8)'?1"0."1N1" ml/hr" S ERR=1 W !,"*** Your infusion rate is in an invalid format !"
"RTN","PSIVCHK",34,0)
 I P(8)="",P("TYP")="P" S:'ERR ERR=2 W !,"*** WARNING -- You have not specified an infusion rate. "
"RTN","PSIVCHK",35,0)
 I '$$CODES1^PSIVUTL(P("TYP"),55.01,.04)!(P("TYP")="") S ERR=1 W !,"*** Type of order is invalid !"
"RTN","PSIVCHK",36,0)
 I '$$CODES1^PSIVUTL(P(17),55.01,100)!(P(17)="") S ERR=1 W !,"*** Status of order is invalid !"
"RTN","PSIVCHK",37,0)
AH ;
"RTN","PSIVCHK",38,0)
 I "HA"[P("TYP"),(P(11)]""!(P(9)]"")) W !,$C(7),"Order type is an admixture, hyperal, or continuous syringe, and you have",!,"a schedule and/or administration times defined!"
"RTN","PSIVCHK",39,0)
 I  F Q=0:0 W !,"Ok to delete these fields" S %=1 D YN^DICN D NULSET Q:%
"RTN","PSIVCHK",40,0)
 K % I P(6)="" S ERR=1 W !,"*** You have not entered a physician!"
"RTN","PSIVCHK",41,0)
 I P(6)]"",'$D(^VA(200,+P(6),"PS")) S ERR=1 W !,"*** Physician entered does not exist or is not authorized to write",!,"medication orders"
"RTN","PSIVCHK",42,0)
 I P(6)]"",$D(^VA(200,+P(6),"PS")),(+$P(^("PS"),U,4)),($P(^("PS"),U,4)'>DT) S ERR=1 W !,"*** Physician entered is no longer active."
"RTN","PSIVCHK",43,0)
 D ^PSIVCHK1
"RTN","PSIVCHK",44,0)
 Q
"RTN","PSIVCHK",45,0)
 ;
"RTN","PSIVCHK",46,0)
NULSET ;Delete admin/schedule fields for hyperals and/or admixtures
"RTN","PSIVCHK",47,0)
 I '% W !!?2,"Enter 'YES' to delete the schedule and/or administration times fields from",!,"this order.  Enter 'NO' (or '^') to leave the fields intact.",! Q
"RTN","PSIVCHK",48,0)
 S:%=1 P(9)="",P(11)=""
"RTN","PSIVCHK",49,0)
 Q
"RTN","PSIVCHK",50,0)
CKO S P16=0,PSIVEXAM=1,PSIVCT=1 D PSIVCHK S PSIVNOL=1 W ! D ^PSIVORLB K PSIVEXAM Q:'ERR
"RTN","PSIVCHK",51,0)
 I ERR=2 F J=0:0 W !!,"Since there is a warning with this order.",!,"do you wish to re-edit this order" S %=1 D YN^DICN Q:%  W !!,"Answer 'YES' to re-edit this order."
"RTN","PSIVCHK",52,0)
 I ERR=2,%=1 S PSIVOK="57^58^59^26^39^63^64^62^10^25^1" D ^PSIVORV2,GSTRING^PSIVORE1,GTFLDS^PSIVORFE K DA,DIE,DR G CKO
"RTN","PSIVCHK",53,0)
 Q
"RTN","PSIVCHK1")
0^14^B15557836^B16087678
"RTN","PSIVCHK1",1,0)
PSIVCHK1 ;BIR/PR,MLM-CHECK ORDER FOR INTEGRITY ;23 Oct 98 / 10:00 AM
"RTN","PSIVCHK1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**21,41,50,74,111,113**;16 DEC 97;Build 63
"RTN","PSIVCHK1",3,0)
 ;
"RTN","PSIVCHK1",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSIVCHK1",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSIVCHK1",6,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSIVCHK1",7,0)
 ;
"RTN","PSIVCHK1",8,0)
 ;Need DFN and ON
"RTN","PSIVCHK1",9,0)
 ;
"RTN","PSIVCHK1",10,0)
 I P(9)="",P("TYP")="P" S ERR=1 W !,"*** No schedule exists for this order!"
"RTN","PSIVCHK1",11,0)
 I P(11)="",P("TYP")="P",'P(15),$S(($G(P(15))="O"):0,($G(P(15))="OC"):0,$$DOW^PSIVUTL($P(P(9)," PRN")):1,1:P(9)'["PRN") D
"RTN","PSIVCHK1",12,0)
 . I $$DOW^PSIVUTL(P(9)) S P(15)="D"
"RTN","PSIVCHK1",13,0)
 . I P(15)="D" S ERR=1 W !,"*** This is a 'DAY OF THE WEEK' schedule and MUST have admin times!" Q
"RTN","PSIVCHK1",14,0)
 . I $G(P(15)) Q:$$ODD^PSGS0(P(15))
"RTN","PSIVCHK1",15,0)
 . I $$ONETIME^PSIVEDT1($G(P(9)))!$$PRNOK^PSGS0($G(P(9)))!$$ONCALL^PSIVEDT1($G(P(9))) Q
"RTN","PSIVCHK1",16,0)
 . S ERR=1 W !,"*** There are no administration times defined for this order!"
"RTN","PSIVCHK1",17,0)
 S PDM=11 S PDM=0 F DRGT="AD","SOL" I $D(DRG(DRGT)) F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!PDM  I $P(P("PD"),U)=$P(DRG(DRGT,DRGI),U,6) S PDM=11
"RTN","PSIVCHK1",18,0)
 I $E(P("OT"))'="I",'PDM D GTPD^PSIVORE2 S PDM=11
"RTN","PSIVCHK1",19,0)
 I $E(P("OT"))="I",'PDM W !!,"ERROR,",!,"The Orderable item does not match any of the additives or solutions entered.",!,"At least 1 additive or solution must match the Orderable item entered",!,"for this order!",!! S ERR=1
"RTN","PSIVCHK1",20,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  S CHK=DRG(DRGT,DRGI) D DRG,@DRGT
"RTN","PSIVCHK1",21,0)
 NEW DRGSOL,DRGAD,X S (DRGSOL,DRGAD)=0
"RTN","PSIVCHK1",22,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  S DRGSOL=DRGSOL+1
"RTN","PSIVCHK1",23,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  S DRGAD=DRGAD+1
"RTN","PSIVCHK1",24,0)
 I 'DRGAD,("P"[P("TYP")) S:'ERR ERR=2 W !,"WARNING, You have not defined an additive."
"RTN","PSIVCHK1",25,0)
 I DRGAD+DRGSOL<1 S ERR=1 W !,"ERROR, You have not defined any additives or solutions."
"RTN","PSIVCHK1",26,0)
 I 'DRGSOL,("P"'[P("TYP")) S ERR=1 W !,"ERROR, No solution entered for order."
"RTN","PSIVCHK1",27,0)
 I "AP"[P("TYP"),(DRGSOL'=1) S:'ERR ERR=2 W !,"WARNING, This order should have one solution defined, you have ",DRGSOL,!,"   solutions defined."
"RTN","PSIVCHK1",28,0)
 I ERR W $C(7) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSIVCHK1",29,0)
 K CHK,P("TYP")
"RTN","PSIVCHK1",30,0)
 Q
"RTN","PSIVCHK1",31,0)
 ;
"RTN","PSIVCHK1",32,0)
AD ; Check additives.
"RTN","PSIVCHK1",33,0)
 I '$D(^PS(FIL,+DRG(1),0)) S ERR=1 W !,"ERROR, Additive entered does not exist in additive file." Q
"RTN","PSIVCHK1",34,0)
 I $$ENU^PSIVUTL(DRG(1))'=$P(DRG(3)," ",2,99)!(+DRG(3)'>0) S ERR=1 W !,"ERROR, Invalid strength entered for ",DRG(2),!,"... should be in ",$$ENU^PSIVUTL(DRG(1))," ... please reenter."
"RTN","PSIVCHK1",35,0)
 I P("TYP")="P",DRG(4)]"" S ERR=1 W !,"ERROR, Piggyback or intermittent syringe type order and you have a bottle #",!,"defined for ",DRG(2)
"RTN","PSIVCHK1",36,0)
 Q
"RTN","PSIVCHK1",37,0)
 ;
"RTN","PSIVCHK1",38,0)
SOL ; Check solutions.
"RTN","PSIVCHK1",39,0)
 I '$D(^PS(FIL,+DRG(1),0)) S ERR=1 W !,"ERROR, Solution entered does not exist in solution file." Q
"RTN","PSIVCHK1",40,0)
 I DRG(3)>9999!(DRG(3)'>0) S ERR=1 W !,"ERROR, Volume on ",DRG(2)," is an invalid strength." Q
"RTN","PSIVCHK1",41,0)
 Q
"RTN","PSIVCHK1",42,0)
 ;
"RTN","PSIVCHK1",43,0)
DRG ; Put drug data in DRG and check if active.
"RTN","PSIVCHK1",44,0)
 F X=1:1:6 S DRG(X)=$P(CHK,U,X)
"RTN","PSIVCHK1",45,0)
 I $S('$G(^PS(FIL,+DRG(1),"I")):0,^("I")>DT:0,1:1)!($S('$G(^PSDRUG(+$P($G(^PS(FIL,DRG(1),0)),U,2),"I")):0,^("I")>DT:0,1:1)) S ERR=1 W !,"ERROR, ",DRG(2)," is an inactive drug!"
"RTN","PSIVCHK1",46,0)
 Q
"RTN","PSIVEDT1")
0^4^B59446179^B28421245
"RTN","PSIVEDT1",1,0)
PSIVEDT1 ;BIR/MLM-EDIT IV ORDER (CONT) ;10 Mar 98 / 2:36 PM
"RTN","PSIVEDT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,7,41,47,50,64,58,116,110,111,113**;16 DEC 97;Build 63
"RTN","PSIVEDT1",3,0)
 ;
"RTN","PSIVEDT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVEDT1",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSIVEDT1",6,0)
 ;
"RTN","PSIVEDT1",7,0)
10 ; Start Date
"RTN","PSIVEDT1",8,0)
 D:'P(2)&P("IVRM")!($G(PSJREN)) ENT^PSIVCAL
"RTN","PSIVEDT1",9,0)
A10 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",10,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",11,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",12,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",13,0)
 S Y=P(2) X ^DD("DD") W !,"START DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P(2)&X="") Q
"RTN","PSIVEDT1",14,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 10
"RTN","PSIVEDT1",15,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S F1=53.1,F2=10 S:X="@" X="?" D ENHLP^PSIVORC1 G A10
"RTN","PSIVEDT1",16,0)
 K %DT S:X="" X=P(2) S %DT="ERTX" D ^%DT K %DT G:Y'>0 A10
"RTN","PSIVEDT1",17,0)
 I $G(P("RES"))="R",(+Y<+$P($G(^PS(55,DFN,"IV",+$G(P("OLDON")),0)),U,2)) D  G 10
"RTN","PSIVEDT1",18,0)
 .; naked ref below refers to line above
"RTN","PSIVEDT1",19,0)
 .S Y=$P(^(0),U,2) X ^DD("DD") W $C(7),!!,"Start date of order being renewed is ",Y,".",!,"Start date of renewal order must be AFTER start date of order being renewed.",!
"RTN","PSIVEDT1",20,0)
 S X1=$G(P("LOG")),X2=-7 D C^%DTC I +Y<X W !!,"Start date/time may not be entered prior to 7 days from the order's LOGIN DATE.",! D A10
"RTN","PSIVEDT1",21,0)
 S P(2)=+Y,PSGSDX=1
"RTN","PSIVEDT1",22,0)
 Q
"RTN","PSIVEDT1",23,0)
 ;
"RTN","PSIVEDT1",24,0)
25 ; Stop Date
"RTN","PSIVEDT1",25,0)
 G:$D(PSGFDX) A25
"RTN","PSIVEDT1",26,0)
 I P("IVRM")]"",$S(P(3)<P(2):1,$G(PSIVAC)["E":0,1:1) S PSIVSITE=$G(^PS(59.5,+P("IVRM"),1)),$P(PSIVSITE,"^",20,21)=$G(^PS(59.5,+P("IVRM"),5)) D ENSTOP^PSIVCAL
"RTN","PSIVEDT1",27,0)
A25 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",28,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Stop Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",29,0)
 S Y=P(3) X ^DD("DD") W !,"STOP DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 Q:X=""&P(2)  I $E(X)=U!(X=""&P(2)) Q
"RTN","PSIVEDT1",30,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 25
"RTN","PSIVEDT1",31,0)
 I X="@"!(X["?") W $C(7),"  (Required)" S F1=53.1,F2=25,X="?" D ENHLP^PSIVORC1 G A25
"RTN","PSIVEDT1",32,0)
 K %DT S:X="" X=$G(Y) S:X="" X=P(3) S %DT="ERTX" D:X'=+X ^%DT
"RTN","PSIVEDT1",33,0)
 I X=+X,X>0,X'>2000000 G A25:'$$ENDL^PSGDL(P(9),X) D ENDL^PSIVSP
"RTN","PSIVEDT1",34,0)
 D DOSE
"RTN","PSIVEDT1",35,0)
 I $G(X)="" S X=Y
"RTN","PSIVEDT1",36,0)
 I $G(X)="" S X=P(3)
"RTN","PSIVEDT1",37,0)
 I $G(Z)]"",Z>X D  G A25
"RTN","PSIVEDT1",38,0)
 . W !,"There is no administration time that falls between the Start Date/Time"
"RTN","PSIVEDT1",39,0)
 . W !,"and Stop Date/Time.",!
"RTN","PSIVEDT1",40,0)
 S X=Y S:Y<1!Y'["." X="" G:Y'>0 A25 S P(3)=+Y,PSGFDX=1
"RTN","PSIVEDT1",41,0)
 Q
"RTN","PSIVEDT1",42,0)
 ;
"RTN","PSIVEDT1",43,0)
26 ; Schedule
"RTN","PSIVEDT1",44,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",45,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",46,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",47,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",48,0)
 W !,"SCHEDULE: ",$S(P(9)]"":P(9)_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X="") Q
"RTN","PSIVEDT1",49,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(9)="" G 26
"RTN","PSIVEDT1",50,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 26
"RTN","PSIVEDT1",51,0)
 I X?1."?"!($L(X)>22)!($L(X," ")>3) S F1=55.01,F2=.09 D ENHLP^PSIVORC1 G 26
"RTN","PSIVEDT1",52,0)
 S CHG=0 I P(9)]"",X'=P(9) S CHG=1
"RTN","PSIVEDT1",53,0)
 S P(7)="" K PSGOES D EN^PSIVSP S:XT<0 X="" I $G(X)="" W $C(7),"??" G 26
"RTN","PSIVEDT1",54,0)
 I CHG D
"RTN","PSIVEDT1",55,0)
 . S P(9)=X,P(11)=Y,P(15)=XT
"RTN","PSIVEDT1",56,0)
 . I $$ODD^PSGS0(P(15)) S P(11)=""
"RTN","PSIVEDT1",57,0)
 . W !!?5,"This change in schedule also changes the Administration Times and Schedule Type of this order."
"RTN","PSIVEDT1",58,0)
 . S DIR("A")="Enter RETURN to continue or '^' to exit:"
"RTN","PSIVEDT1",59,0)
 . D PAUSE^VALM1
"RTN","PSIVEDT1",60,0)
 K CHG
"RTN","PSIVEDT1",61,0)
 Q
"RTN","PSIVEDT1",62,0)
 ;
"RTN","PSIVEDT1",63,0)
39 ; Admin Times
"RTN","PSIVEDT1",64,0)
 S ORIG=$G(P(11))
"RTN","PSIVEDT1",65,0)
A39 I $G(P("RES"))="R" I $G(ON)["P",($P($G(^PS(53.1,+ON,0)),"^",24)="R") D  Q
"RTN","PSIVEDT1",66,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Administration times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",67,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",68,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Admin Times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",69,0)
 I $G(P(9))=""!($G(P(9))[" PRN")!($G(P(9))="PRN") Q  ;No schedule or PRN schedule
"RTN","PSIVEDT1",70,0)
 I $$ODD^PSGS0(P(15)) S P(11)="" Q
"RTN","PSIVEDT1",71,0)
 W !,"ADMINISTRATION TIMES: ",$S(P(11)]"":P(11)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I '($G(P(15))="D"&'DONE) I $E(X)=U S (X,P(11))=ORIG Q
"RTN","PSIVEDT1",72,0)
 I X="",P(11)]"" S X=P(11)
"RTN","PSIVEDT1",73,0)
 I ($G(P(15))="D"!($G(P(9))["@"))&('$G(X)!(X["@")) W $C(7),"  ??" S X="?" W:(P(15)="D"!(X["@")) !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." G A39
"RTN","PSIVEDT1",74,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(11)="" G A39
"RTN","PSIVEDT1",75,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSIVEDT1",76,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G A39
"RTN","PSIVEDT1",77,0)
 I $G(P(15))'="D",$G(P(15))'="P",'$$ONCALL(P(9)) D TIMES I '$D(X) G A39
"RTN","PSIVEDT1",78,0)
 K:X[""""!($A(X)=45) X W:$G(X)="^"!('$D(X)) $C(7),"  ??" G:$G(X)="^"!('$D(X)) A39 S P(11)=X D:$G(PSIVCAL) ENT^PSIVCAL,ENSTOP^PSIVCAL K PSIVCAL
"RTN","PSIVEDT1",79,0)
 Q
"RTN","PSIVEDT1",80,0)
 ;
"RTN","PSIVEDT1",81,0)
59 ; Infusion Rate
"RTN","PSIVEDT1",82,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",83,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Infusion Rate may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",84,0)
 W !,"INFUSION RATE: ",$S(P(8)]"":P(8)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $S($E(X)=U:1,X]"":0,1:P(8)]"") Q
"RTN","PSIVEDT1",85,0)
 I X=""&(("C^P"[P(4))!(("C^S"[P(4))&(P(5)=1))) Q
"RTN","PSIVEDT1",86,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(8)="" G 59
"RTN","PSIVEDT1",87,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 59
"RTN","PSIVEDT1",88,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVEDT1",89,0)
 I X]"" D ENI^PSIVSP W:'$D(X) $C(7)," ??" G:'$D(X) 59 S P(8)=X
"RTN","PSIVEDT1",90,0)
 I P(8)="" W $C(7),!!,"An infusion rate must be entered!" G 59
"RTN","PSIVEDT1",91,0)
 Q
"RTN","PSIVEDT1",92,0)
 ;
"RTN","PSIVEDT1",93,0)
63 ; Remarks
"RTN","PSIVEDT1",94,0)
 N DIR S X="",DIR(0)="53.1,63" S:P("REM")]"" DIR("B")=P("REM") D ^DIR I X="^"!$D(DTOUT) S DONE=1 Q
"RTN","PSIVEDT1",95,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P("REM")="" G 63
"RTN","PSIVEDT1",96,0)
 I X]"",$E(X)'="^" S P("REM")=X
"RTN","PSIVEDT1",97,0)
 Q
"RTN","PSIVEDT1",98,0)
 ;
"RTN","PSIVEDT1",99,0)
64 ; Other Print Info
"RTN","PSIVEDT1",100,0)
 N DIR S X="",DIR(0)="53.1,64" S:P("OPI")]"" DIR("B")=$P(P("OPI"),"^") D ^DIR I X="^"!$D(DTOUT) S DONE=1 Q
"RTN","PSIVEDT1",101,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P("OPI")="" G 64
"RTN","PSIVEDT1",102,0)
 I X]"",$E(X)'="^" S P("OPI")=X,P("OPI")=$$ENBCMA^PSJUTL("V")
"RTN","PSIVEDT1",103,0)
 Q
"RTN","PSIVEDT1",104,0)
 ;
"RTN","PSIVEDT1",105,0)
ORFLDS ; Display OE/RR fields during edit.
"RTN","PSIVEDT1",106,0)
 D FULL^VALM1
"RTN","PSIVEDT1",107,0)
 W !!,"Orderable Item: ",$P(P("PD"),U,2),!,"Give: ",$P(P("MR"),U,2)," ",P(9),!!
"RTN","PSIVEDT1",108,0)
 Q
"RTN","PSIVEDT1",109,0)
 ;
"RTN","PSIVEDT1",110,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSIVEDT1",111,0)
 I $G(P(15)) Q:$$ODD^PSGS0(P(15))
"RTN","PSIVEDT1",112,0)
 I $G(P(15))="C"!$$CONTIN($G(P(9))) I '$$ONCALL($G(P(9))),X="" W !,"This order requires at least one administration time." K X Q  ;No times
"RTN","PSIVEDT1",113,0)
 N H,I,MAX
"RTN","PSIVEDT1",114,0)
 I $G(P(15))="O"!$$ONETIME($G(P(9))) I $L(X,"-")>1 W !," This is a One Time Order - only one administration time is permitted." K X Q
"RTN","PSIVEDT1",115,0)
 I $G(P(15))="O"!$$ONETIME($G(P(9))) Q  ;Done validating One Time
"RTN","PSIVEDT1",116,0)
 I $G(P(9))]"" S H=+$O(^PS(51.1,"B",P(9),0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSIVEDT1",117,0)
 I +I=0 Q  ;No frequency - can not check frequency related items
"RTN","PSIVEDT1",118,0)
 S MAX=1440/I
"RTN","PSIVEDT1",119,0)
 I MAX<1,$L(X,"-")>1 W !,"This order requires one administration time." K X Q
"RTN","PSIVEDT1",120,0)
 I MAX'<1,$L(X,"-")>MAX W !,"The number of admin times entered is greater than indicated by the schedule." K X Q  ;Too many times
"RTN","PSIVEDT1",121,0)
 I MAX'<1,$L(X,"-")<MAX D  ;Too few times
"RTN","PSIVEDT1",122,0)
 . W !,"The number of admin times entered is fewer than indicated by the schedule."
"RTN","PSIVEDT1",123,0)
 . N X,DIR
"RTN","PSIVEDT1",124,0)
 . D PAUSE^VALM1
"RTN","PSIVEDT1",125,0)
 Q
"RTN","PSIVEDT1",126,0)
 ;
"RTN","PSIVEDT1",127,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSIVEDT1",128,0)
 N INFO,Y,PNINE
"RTN","PSIVEDT1",129,0)
 S PNINE=P(9)
"RTN","PSIVEDT1",130,0)
 S INFO=$G(P(2))_U_$G(P(3))_U_$G(P(9))_U_$P($G(PSGZZND),"^",5)_U_$P($G(P("PD")),"^")_U_$G(P(11))
"RTN","PSIVEDT1",131,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSIVEDT1",132,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSIVEDT1",133,0)
 S P(9)=PNINE
"RTN","PSIVEDT1",134,0)
 Q
"RTN","PSIVEDT1",135,0)
 ;
"RTN","PSIVEDT1",136,0)
ONCALL(SCHD) ; Check if a schedule is type On Call (all schedules with a given name must have the same schedule type)
"RTN","PSIVEDT1",137,0)
 N NXT,SCHARR
"RTN","PSIVEDT1",138,0)
 S OCCHK=0
"RTN","PSIVEDT1",139,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSIVEDT1",140,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSIVEDT1",141,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSIVEDT1",142,0)
 I '$D(SCHARR("OC")) S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",143,0)
 I $O(SCHARR("OC"))]""!($O(SCHARR("OC"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",144,0)
 I $D(SCHARR("OC")) S OCCHK=1
"RTN","PSIVEDT1",145,0)
 Q OCCHK
"RTN","PSIVEDT1",146,0)
 ;
"RTN","PSIVEDT1",147,0)
ONETIME(SCHD) ; Check if a schedule is type On Call (all schedules with a given name must have the same schedule type)
"RTN","PSIVEDT1",148,0)
 N NXT,SCHARR
"RTN","PSIVEDT1",149,0)
 S OCCHK=0
"RTN","PSIVEDT1",150,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSIVEDT1",151,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSIVEDT1",152,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSIVEDT1",153,0)
 I '$D(SCHARR("O")) S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",154,0)
 I $O(SCHARR("O"))]""!($O(SCHARR("O"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",155,0)
 I $D(SCHARR("O")) S OCCHK=1
"RTN","PSIVEDT1",156,0)
 Q OCCHK
"RTN","PSIVEDT1",157,0)
 ;
"RTN","PSIVEDT1",158,0)
CONTIN(SCHD) ; Check if a schedule is type On Call (all schedules with a given name must have the same schedule type)
"RTN","PSIVEDT1",159,0)
 N NXT,SCHARR
"RTN","PSIVEDT1",160,0)
 S OCCHK=0
"RTN","PSIVEDT1",161,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSIVEDT1",162,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSIVEDT1",163,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSIVEDT1",164,0)
 I '$D(SCHARR("C")) S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",165,0)
 I $O(SCHARR("C"))]""!($O(SCHARR("C"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",166,0)
 I $D(SCHARR("C")) S OCCHK=1
"RTN","PSIVEDT1",167,0)
 Q OCCHK
"RTN","PSJBCMA")
0^5^B73076125^B69693211
"RTN","PSJBCMA",1,0)
PSJBCMA ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;16 Mar 99 / 10:13 AM
"RTN","PSJBCMA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,69,58,81,91,104,111,112,186,159,173,190,113**;16 DEC 97;Build 63
"RTN","PSJBCMA",3,0)
 ;
"RTN","PSJBCMA",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA",5,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSJBCMA",6,0)
 ; Reference to ^PS(51.1 is supported by DIBA 2177.
"RTN","PSJBCMA",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA",10,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA",11,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 2828.
"RTN","PSJBCMA",13,0)
 ;
"RTN","PSJBCMA",14,0)
EN(DFN,BDT,OTDATE)         ; return condensed list of inpatient meds
"RTN","PSJBCMA",15,0)
 NEW CNT,DN,F,FON,ON,PST,WBDT,X,X1,X2,Y,%
"RTN","PSJBCMA",16,0)
 D:+$G(DFN) ORDER
"RTN","PSJBCMA",17,0)
 I '$D(^TMP("PSJ",$J,1,0)) S ^(0)=-1
"RTN","PSJBCMA",18,0)
 K PSJINX
"RTN","PSJBCMA",19,0)
 Q
"RTN","PSJBCMA",20,0)
ORDER ;Loop thru orders.
"RTN","PSJBCMA",21,0)
 I '+$G(BDT) D NOW^%DTC S BDT=%
"RTN","PSJBCMA",22,0)
 I BDT'["." S BDT=BDT_".0001"
"RTN","PSJBCMA",23,0)
 S PSJINX=0
"RTN","PSJBCMA",24,0)
 ;U/D orders
"RTN","PSJBCMA",25,0)
 S F="^PS(55,DFN,5,",WBDT=BDT
"RTN","PSJBCMA",26,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",27,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S FON=ON_"U",PSJON(FON)="" D UDVAR
"RTN","PSJBCMA",28,0)
 ;IV orders
"RTN","PSJBCMA",29,0)
 S F="^PS(55,DFN,""IV"",",WBDT=BDT
"RTN","PSJBCMA",30,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",31,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S FON=ON_"V",PSJON(FON)="" D IVVAR
"RTN","PSJBCMA",32,0)
 ;Pending orders
"RTN","PSJBCMA",33,0)
 S F="^PS(53.1,"
"RTN","PSJBCMA",34,0)
 F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBCMA",35,0)
 . S FON=ON_"P"
"RTN","PSJBCMA",36,0)
 . S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA",37,0)
 ;When a one-time order is found, check against PSJON(FON) array to
"RTN","PSJBCMA",38,0)
 ;make sure no duplicates return on ^TMP.
"RTN","PSJBCMA",39,0)
 I '+$G(OTDATE) D NOW^%DTC S X1=$E(%,1,12),X2=-30 D C^%DTC S OTDATE=X
"RTN","PSJBCMA",40,0)
 I OTDATE'["." S OTDATE=OTDATE_".0001"
"RTN","PSJBCMA",41,0)
 Q:BDT'>OTDATE
"RTN","PSJBCMA",42,0)
 S F="^PS(55,DFN,5,",WBDT=OTDATE
"RTN","PSJBCMA",43,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AU","O",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",44,0)
 .  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AU","O",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",45,0)
 .. S FON=ON_"U" D:'$D(PSJON(FON)) UDVAR
"RTN","PSJBCMA",46,0)
 S F="^PS(55,DFN,""IV"",",WBDT=OTDATE
"RTN","PSJBCMA",47,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",48,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",49,0)
 .. S X=$P($G(^PS(55,DFN,"IV",ON,0)),U,9)
"RTN","PSJBCMA",50,0)
 .. I X]"",$$ONE(DFN,ON_"V",X,$P(X,"^",2),$P(X,"^",3))="O" D
"RTN","PSJBCMA",51,0)
 ... S FON=ON_"V" D:'$D(PSJON(FON)) IVVAR
"RTN","PSJBCMA",52,0)
 K PSJON
"RTN","PSJBCMA",53,0)
 Q
"RTN","PSJBCMA",54,0)
UDVAR ;Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA",55,0)
 D UDPEND Q:'$$CLINICS($G(CLINIC)) 
"RTN","PSJBCMA",56,0)
 D TMP
"RTN","PSJBCMA",57,0)
 ;Setup Dispense drug for ^TMP
"RTN","PSJBCMA",58,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA",59,0)
 F X=0:0 S X=$O(@(F_ON_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA",60,0)
 . S PSJDD=@(F_ON_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA",61,0)
 . S CNT=CNT+1
"RTN","PSJBCMA",62,0)
 . S ^TMP("PSJ",$J,PSJINX,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((FON["U")&($P(PSJDD,U,2)=""):1,(FON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA",63,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,700,0)=CNT
"RTN","PSJBCMA",64,0)
 K PSJ,PSJDD
"RTN","PSJBCMA",65,0)
 Q
"RTN","PSJBCMA",66,0)
IVVAR ;Set variables for IV and pending orders
"RTN","PSJBCMA",67,0)
 NEW ND,X,Y
"RTN","PSJBCMA",68,0)
 I FON["P" D UDPEND Q:'$$CLINICS(CLINIC)  S PSJ("INFRATE")=$P($G(^PS(53.1,ON,8)),U,5)
"RTN","PSJBCMA",69,0)
 I FON["V" D  Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",70,0)
 . S X=$G(^PS(55,DFN,"IV",ON,0)),CLINIC=$G(^("DSS")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",71,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA",72,0)
 . S PSJ("INFRATE")=$P(X,U,8),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA",73,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA",74,0)
 . S PSJ("IVTYPE")=$P(X,U,4),PSJ("INSYR")=$P(X,U,5)
"RTN","PSJBCMA",75,0)
 . S PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA",76,0)
 . S X=$G(^PS(55,DFN,"IV",ON,.2))
"RTN","PSJBCMA",77,0)
 . S PSJ("DO")="",PSJ("MR")=$P(X,U,3),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",78,0)
 . I PSJ("FLG") D
"RTN","PSJBCMA",79,0)
 .. N S1,A,B,C
"RTN","PSJBCMA",80,0)
 .. S S1="" F  S S1=$O(^PS(55,DFN,"IV",ON,"A",S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,2),B=$P(C,U,4) Q:A="UG"  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",81,0)
 ... Q:A'="G"
"RTN","PSJBCMA",82,0)
 ... S PSJ("SRC")=$S(B["FLAGGED BY PHARM":"PHARMACIST",B["FLAGGED BY CPRS":"CPRS",1:"")
"RTN","PSJBCMA",83,0)
 ... S PSJ("COM")=$P(B," ",4,99)
"RTN","PSJBCMA",84,0)
 . S PSJ("OI")=+X
"RTN","PSJBCMA",85,0)
 . S X=$G(^PS(55,DFN,"IV",ON,2))
"RTN","PSJBCMA",86,0)
 . S PSJ("PREV")=$P(X,U,5) I PSJ("PREV")["V",(+PSJ("PREV")=+ON) S PSJ("PREV")=""
"RTN","PSJBCMA",87,0)
 . S PSJ("FOLLOW")=$P(X,U,6),PSJ("RFO")=$P(X,U,9) I PSJ("FOLLOW")["V",(+PSJ("FOLLOW")=+ON) S (PSJ("FOLLOW"),PSJ("RFO"))=""
"RTN","PSJBCMA",88,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2)&($P($G(^PS(55,DFN,"IV",+ON,3)),"^")'=""):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA",89,0)
 . N SCHD S SCHD=PSJ("SCHD")
"RTN","PSJBCMA",90,0)
 . S PSJ("STC")=$$ONE(DFN,ON_"V",SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA",91,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA",92,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S(SCHD["ON CALL":"OC",SCHD["ON-CALL":"OC",SCHD["ONCALL":"OC",1:"C")
"RTN","PSJBCMA",93,0)
 D TMP
"RTN","PSJBCMA",94,0)
 S CNT=0
"RTN","PSJBCMA",95,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA",96,0)
 . S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0))
"RTN","PSJBCMA",97,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3)
"RTN","PSJBCMA",98,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,850,0)=CNT,CNT=0
"RTN","PSJBCMA",99,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA",100,0)
 . S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0))
"RTN","PSJBCMA",101,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJBCMA",102,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,950,0)=CNT
"RTN","PSJBCMA",103,0)
 K PSJ
"RTN","PSJBCMA",104,0)
 S X1=0
"RTN","PSJBCMA",105,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA",106,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:ON'=$P(XX,"^",2)  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA",107,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",108,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,800,PSJBCID,0)=I-1
"RTN","PSJBCMA",109,0)
 . S X2=0
"RTN","PSJBCMA",110,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",111,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,900,PSJBCID,0)=I-1
"RTN","PSJBCMA",112,0)
 Q
"RTN","PSJBCMA",113,0)
UDPEND ;
"RTN","PSJBCMA",114,0)
 S X=$G(@(F_ON_",0)")) I $P(F,",")[53.1 S CLINIC=$G(@(F_ON_",""DSS"")")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",115,0)
 I $P(F,",")[55 S CLINIC=$G(@(F_ON_",8)")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",116,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA",117,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA",118,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26),PSJ("RFO")=$P(X,U,27)
"RTN","PSJBCMA",119,0)
 S:FON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA",120,0)
 S X=$G(@(F_ON_",.2)"))
"RTN","PSJBCMA",121,0)
 S PSJ("DO")=$P(X,U,2),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",122,0)
 I PSJ("FLG") D
"RTN","PSJBCMA",123,0)
 . N S1,A,B,C
"RTN","PSJBCMA",124,0)
 . S S1="" F  S S1=$O(^PS(55,DFN,5,ON,9,S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,3),B=$P(C,U,4) Q:A=7010!(A=7030)  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",125,0)
 .. Q:A'=7000&(A'=7020)
"RTN","PSJBCMA",126,0)
 .. S PSJ("SRC")=$S(A=7000:"PHARMACIST",A=7020:"CPRS",1:"")
"RTN","PSJBCMA",127,0)
 .. S PSJ("COM")=$G(@(F_ON_",13)"))
"RTN","PSJBCMA",128,0)
 S PSJ("OI")=+X
"RTN","PSJBCMA",129,0)
 S X=$G(@(F_ON_",2)"))
"RTN","PSJBCMA",130,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA",131,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA",132,0)
 S X=$G(@(F_ON_",4)"))
"RTN","PSJBCMA",133,0)
 S PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA",134,0)
 ;naked reference on line below refers to  full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA",135,0)
 S PSJ("SIOPI")=$S($P($G(@(F_ON_",6)")),"^",2)&($P($G(@(F_ON_",6)")),"^")'=""):"!",1:"")_$$ENSET($P($G(^(6)),"^"))
"RTN","PSJBCMA",136,0)
 D SIOPI
"RTN","PSJBCMA",137,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA",138,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P","^ONCALL^ON-CALL^ON CALL^"[("^"_PSJ("SCHD")_"^"):"OC",$$ONE(DFN,FON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA",139,0)
 Q 
"RTN","PSJBCMA",140,0)
TMP ;Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA",141,0)
 N A
"RTN","PSJBCMA",142,0)
 S PSJINX=PSJINX+1
"RTN","PSJBCMA",143,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA",144,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA",145,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA",146,0)
 S A=$G(^PS(51.2,+PSJ("MR"),0)),PSJ("MRABB")=$P(A,U,3),PSJ("MRNM")=$P(A,U)
"RTN","PSJBCMA",147,0)
 S ^TMP("PSJ",$J,PSJINX,0)=DFN_U_+ON_U_FON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")_U_$G(PSJ("RFO"))
"RTN","PSJBCMA",148,0)
 S ^TMP("PSJ",$J,PSJINX,1)=PSJ("MRABB")_U_PSJ("STC")_U_$G(PSJ("SCHD"))_U_PSJ("STARTDT")_U_PSJ("STOPDT")_U_PSJ("ADM")_U_PSJ("STATUS")_U_$G(PSJ("NGIVEN"))_U_$G(PSJ("ST"))_U_$G(PSJ("AUTO"))
"RTN","PSJBCMA",149,0)
 S ^TMP("PSJ",$J,PSJINX,1,0)=$P(A,U,8)_U_PSJ("MRNM")_U_$P(A,U,9)
"RTN","PSJBCMA",150,0)
 S ^TMP("PSJ",$J,PSJINX,2)=PSJ("DO")_U_$G(PSJ("INFRATE"))_U_$G(PSJ("SM"))_U_$G(PSJ("HSM"))
"RTN","PSJBCMA",151,0)
 S ^TMP("PSJ",$J,PSJINX,3)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("OIDF")
"RTN","PSJBCMA",152,0)
 S ^TMP("PSJ",$J,PSJINX,4)=PSJ("SIOPI")
"RTN","PSJBCMA",153,0)
 S A=$$SNDTSTA^PSJHL4A(PSJ("PRI"),PSJ("SCHD"))
"RTN","PSJBCMA",154,0)
 S ^TMP("PSJ",$J,PSJINX,5)=$S(A=1:0,1:1)_U_PSJ("FLG")_U_PSJ("SRC")_U_PSJ("COM")
"RTN","PSJBCMA",155,0)
 Q
"RTN","PSJBCMA",156,0)
SIOPI ; Use provider comments if order is pending and there is no SI
"RTN","PSJBCMA",157,0)
 NEW X,Y,Z
"RTN","PSJBCMA",158,0)
 I FON["P",(PSJ("SIOPI")=""),$O(^PS(53.1,+ON,12,0)) D
"RTN","PSJBCMA",159,0)
 . F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Z=$G(^(X,0)) D
"RTN","PSJBCMA",160,0)
 .. S Y=$L(PSJ("SIOPI"))
"RTN","PSJBCMA",161,0)
 .. S:Y+$L(Z)'>179 PSJ("SIOPI")=PSJ("SIOPI")_Z_""
"RTN","PSJBCMA",162,0)
 . I Y+$L(Z)>179 S PSJ("SIOPI")="SEE PROVIDER COMMENTS"
"RTN","PSJBCMA",163,0)
 Q
"RTN","PSJBCMA",164,0)
ENSET(X) ; expands SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSJBCMA",165,0)
 N X1,X2,Y S Y=""
"RTN","PSJBCMA",166,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) I X2]"" S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSJBCMA",167,0)
 S Y=$E(Y,1,$L(Y)-1)
"RTN","PSJBCMA",168,0)
 Q Y
"RTN","PSJBCMA",169,0)
ONE(DFN,ORD,SCH,START,STOP) ;Determine if order is one-time, and return schedule type
"RTN","PSJBCMA",170,0)
 ; Input:  DFN - patient's IEN
"RTN","PSJBCMA",171,0)
 ;         ORD - order number
"RTN","PSJBCMA",172,0)
 ;         SCH - schedule text (required)
"RTN","PSJBCMA",173,0)
 ;         START - order start date (optional)
"RTN","PSJBCMA",174,0)
 ;         STOP - order stop date (optional)
"RTN","PSJBCMA",175,0)
 N X,ONEFRQ,TYP,T
"RTN","PSJBCMA",176,0)
 I $G(PSJ("PREV")),$G(PSJ("FOLLOW")) I +PSJ("PREV")=+PSJ("FOLLOW") S (PSJ("PREV"),PSJ("FOLLOW"))=""
"RTN","PSJBCMA",177,0)
 ; PSJ*5*190 One-Time PRN
"RTN","PSJBCMA",178,0)
 I $G(SCH)="",$G(DFN),$G(ORD) D
"RTN","PSJBCMA",179,0)
 .I ORD["U" S SCH=$P($G(^PS(55,DFN,5,+ORD,2)),"^")
"RTN","PSJBCMA",180,0)
 .I ORD["V" S SCH=$P($G(^PS(55,DFN,"IV",+ORD,0)),"^",9)
"RTN","PSJBCMA",181,0)
 I $G(SCH)]"",$$OTPRN^PSJBCMA3(SCH)="O" Q "O"
"RTN","PSJBCMA",182,0)
 I $G(DFN)]"",$G(ORD)]"",ORD["U",$P(^PS(55,DFN,5,+ORD,0),"^",7)'="R" Q $P(^PS(55,DFN,5,+ORD,0),"^",7)
"RTN","PSJBCMA",183,0)
 I $G(SCH)="" Q ""
"RTN","PSJBCMA",184,0)
 ; PSJ*5*113 Determine schedule type from ^PS(51.1, not from schedule name.
"RTN","PSJBCMA",185,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="D":"C",1:X)
"RTN","PSJBCMA",186,0)
 I $G(START)]"",$G(STOP)]"",START=STOP Q "O"
"RTN","PSJBCMA",187,0)
 I $$DAY(SCH) Q "C"
"RTN","PSJBCMA",188,0)
 Q ""
"RTN","PSJBCMA",189,0)
CLINIC(CL) ;
"RTN","PSJBCMA",190,0)
 I $P(CL,"^",2)?7N!($P(CL,"^",2)?7N1".".N) Q 1
"RTN","PSJBCMA",191,0)
 Q 0
"RTN","PSJBCMA",192,0)
CLINICS(CL) ;
"RTN","PSJBCMA",193,0)
 Q:'$$CLINIC(CL) 1
"RTN","PSJBCMA",194,0)
 Q:'$D(^PS(53.46,"B",+CL)) 1
"RTN","PSJBCMA",195,0)
 N A
"RTN","PSJBCMA",196,0)
 S A=$O(^PS(53.46,"B",+CL,"")) Q:'A 1
"RTN","PSJBCMA",197,0)
 Q $P(^PS(53.46,A,0),"^",4)
"RTN","PSJBCMA",198,0)
DAY(SCH) ;determine if this is a 'day of the week' schedule
"RTN","PSJBCMA",199,0)
 I $G(SCH)="" Q 0
"RTN","PSJBCMA",200,0)
 N D,DAY,DAYS,I,X
"RTN","PSJBCMA",201,0)
 S DAYS="SUNDAY,MONDAY,TUESDAY,WEDNESDAY,THURSDAY,FRIDAY,SATURDAY"
"RTN","PSJBCMA",202,0)
 F I=1:1 S D=$P(SCH,"-",I) Q:D=""  D  Q:X=0
"RTN","PSJBCMA",203,0)
 . S X=0 F J=1:1:7 S DAY=$P(DAYS,",",J) D  Q:X=1
"RTN","PSJBCMA",204,0)
 .. I D=$E(DAY,1,$L(D)) S X=1
"RTN","PSJBCMA",205,0)
 Q X
"RTN","PSJDDUT")
0^7^B78117468^B55719712
"RTN","PSJDDUT",1,0)
PSJDDUT ;BIR/LDT-INPATIENT MEDICATIONS DD UTILITY ;21 AUG 97  7:55 AM
"RTN","PSJDDUT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**40,44,50,83,116,111,113**;16 DEC 97;Build 63
"RTN","PSJDDUT",3,0)
 ;
"RTN","PSJDDUT",4,0)
 ; Reference to ^PS(51 is supported by DBIA# 2176.
"RTN","PSJDDUT",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJDDUT",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJDDUT",7,0)
 ; 
"RTN","PSJDDUT",8,0)
SPCIN ;Called from Non-Verified Orders File (53.1), Special Instructions
"RTN","PSJDDUT",9,0)
 ;field 8
"RTN","PSJDDUT",10,0)
 S PSJHLP(1)="IF ABBREVIATIONS ARE USED, THE TOTAL LENGTH OF THE EXPANDED"
"RTN","PSJDDUT",11,0)
 S PSJHLP(2)="INSTRUCTIONS ALSO MAY NOT BE LONGER THAN 180 CHARACTERS."
"RTN","PSJDDUT",12,0)
 D WRITE
"RTN","PSJDDUT",13,0)
 Q
"RTN","PSJDDUT",14,0)
CHKSI ;Called from Non-Verified Orders File (53.1), Special Instructions
"RTN","PSJDDUT",15,0)
 ;field 8 (Replaces ^PSGSICHK)
"RTN","PSJDDUT",16,0)
 I $S(X'?.ANP:1,X["^":1,1:$L(X)>180) K X Q
"RTN","PSJDDUT",17,0)
 N Y S Y="" F Y(1)=1:1:$L(X," ") S Y(2)=$P(X," ",Y(1)) I Y(2)]"" D CHK1 Q:'$D(X)
"RTN","PSJDDUT",18,0)
 I $D(X),Y]"",X'=$E(Y,1,$L(Y)-1) D EN^DDIOL("EXPANDS TO:","","!?3") F Y(1)=1:1 S Y(2)=$P(Y," ",Y(1)) Q:Y(2)=""  D:$L(Y(2))+$X>78 EN^DDIOL("","","!") D EN^DDIOL(Y(2)_" ","","?0")
"RTN","PSJDDUT",19,0)
 K Y Q
"RTN","PSJDDUT",20,0)
CHK1 ;
"RTN","PSJDDUT",21,0)
 I $L(Y(2))<31,$D(^PS(51,+$O(^PS(51,"B",Y(2),0)),0)),$P(^(0),"^",2)]"",$P(^(0),"^",4) S Y(2)=$P(^(0),"^",2)
"RTN","PSJDDUT",22,0)
 I $L(Y)+$L(Y(2))>180 K X Q
"RTN","PSJDDUT",23,0)
 S Y=Y_Y(2)_" " Q
"RTN","PSJDDUT",24,0)
 ;
"RTN","PSJDDUT",25,0)
CHK F QQ=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",QQ) I WKD=$E(X,1,$L(WKD)) D TS Q
"RTN","PSJDDUT",26,0)
 Q
"RTN","PSJDDUT",27,0)
TS F Q1=1:1:$L(TS,"-") S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q1) Q
"RTN","PSJDDUT",28,0)
 Q
"RTN","PSJDDUT",29,0)
STRDT ;Called from Non-Verified Orders File (53.1),Start Date/Time field 10
"RTN","PSJDDUT",30,0)
 ;(Replaces ENPREV^PSGDL)
"RTN","PSJDDUT",31,0)
 D EN^DDIOL("REVIOUS","","?0") S (X,Y)=0 I '$D(PSGP)!'$D(PSGPDRG) G:$D(DA)[0 POUT S PSGP=$P($G(^PS(53.1,DA,0)),"^",15),PSGPDRG=+$G(^(.2)),Y=1 I 'PSGP!'PSGPDRG D:'PSGPDRG EN^DDIOL("Must have drug from formulary list.","","!?17") G POUT
"RTN","PSJDDUT",32,0)
 F Q=0:0 S Q=$O(^PS(53.1,"AC",PSGP,Q)) Q:'Q  I +$G(^PS(53.1,Q,.2))=PSGPDRG,$D(^PS(53.1,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSJDDUT",33,0)
 F Q=0:0 S Q=$O(^PS(55,PSGP,5,"C",PSGPDRG,Q)) Q:'Q  I $D(^PS(55,PSGP,5,Q,2)),$P(^(2),"^",4)>X S X=$P(^(2),"^",4)
"RTN","PSJDDUT",34,0)
 D:'X EN^DDIOL("No other order found with this drug.","","!?17")
"RTN","PSJDDUT",35,0)
 ;
"RTN","PSJDDUT",36,0)
POUT ;
"RTN","PSJDDUT",37,0)
 K:'X X K:Y PSGPDRG,PSGP,Q Q
"RTN","PSJDDUT",38,0)
 ;
"RTN","PSJDDUT",39,0)
UNPD ;Called from Non-Verified Orders File (53.1), Units Per Dose field 13
"RTN","PSJDDUT",40,0)
 S PSJHLP(1)="ONE (1) UNIT PER DOSE WILL BE ASSUMED IF THERE IS NO ENTRY (OR"
"RTN","PSJDDUT",41,0)
 S PSJHLP(2)="AN ENTRY OF ZERO (0)) INTO THIS FIELD."
"RTN","PSJDDUT",42,0)
 D WRITE
"RTN","PSJDDUT",43,0)
 Q
"RTN","PSJDDUT",44,0)
 ;
"RTN","PSJDDUT",45,0)
SCH ;Called from Non-Verified Orders File (53.1), Schedule field 26
"RTN","PSJDDUT",46,0)
 ;(Replaces EN^PSGS0)
"RTN","PSJDDUT",47,0)
 ;/I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>2)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") K X Q
"RTN","PSJDDUT",48,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") K X Q
"RTN","PSJDDUT",49,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) I '$D(PSGOES) D EN^DDIOL("  ("_X_")","","?0")
"RTN","PSJDDUT",50,0)
 I X["Q0" K X Q
"RTN","PSJDDUT",51,0)
 ;
"RTN","PSJDDUT",52,0)
ENOS ; order set entry
"RTN","PSJDDUT",53,0)
 S (PSGS0XT,PSGS0Y,XT,Y)="" I X["PRN"!(X="ON CALL")!(X="ONCALL")!(X="ON-CALL") G Q
"RTN","PSJDDUT",54,0)
 S X0=X I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK^PSGS0 S:$D(X) Y=X G Q
"RTN","PSJDDUT",55,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC^PSGS0 I XT]"" G Q
"RTN","PSJDDUT",56,0)
 I X["@" D DW^PSGS0 S:$D(X) Y=$P(X,"@",2) G Q
"RTN","PSJDDUT",57,0)
 I Y'>0,$S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="ONETIME":1,X="1TIME":1,X="1 TIME":1,X="T-TIME":1,1:X="ONE-TIME") D:'$D(PSGOES) EN^DDIOL("  (ONCE ONLY)","","?0") S Y="",XT="O" G Q
"RTN","PSJDDUT",58,0)
 I $G(PSGSCH)=X S PSGS0Y=$G(PSGAT) Q
"RTN","PSJDDUT",59,0)
 ;
"RTN","PSJDDUT",60,0)
NS K PSJNSS I Y'>0 D:'$D(PSGOES) EN^DDIOL("  (Nonstandard schedule)","","?0") S X=X0,Y="",PSJNSS=1
"RTN","PSJDDUT",61,0)
 I $E(X,1,2)="AD" K X Q
"RTN","PSJDDUT",62,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440/$F("BTQ",$E(X)) G Q
"RTN","PSJDDUT",63,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=1,X=$E(X,2,99)
"RTN","PSJDDUT",64,0)
 S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,Y'>0 K X G Q
"RTN","PSJDDUT",65,0)
 S X=X0 I XT S:X2 XT=XT\X1 I 'X2 S:$E(X,1,2)="QO" XT=XT*2 S XT=XT*X1
"RTN","PSJDDUT",66,0)
 ;
"RTN","PSJDDUT",67,0)
Q ;
"RTN","PSJDDUT",68,0)
 S PSGS0XT=$S(XT]"":XT,1:""),PSGS0Y=$S(Y:Y,1:"") K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSJDDUT",69,0)
 ;
"RTN","PSJDDUT",70,0)
SCH3 ;Called from Non-Verified Orders File (53.1), Schedule field 26
"RTN","PSJDDUT",71,0)
 ;(Replaces ENSH3^PSGSH)
"RTN","PSJDDUT",72,0)
 S:'$D(PSGST) PSGST=$P($G(^PS(53.1,DA,0)),"^",7),PSGDDFLG=1
"RTN","PSJDDUT",73,0)
 N D,DA,DIC,DIE,DZ,Y
"RTN","PSJDDUT",74,0)
 D EN^DDIOL("'STAT', 'ONCE', 'NOW', and 'DAILY' are acceptable schedules.") I X?1"???".E F Q=1:1 Q:$P($T(HT+Q),";",3)=""  S PSJHLP(Q)=$P($T(HT+Q),";",3)
"RTN","PSJDDUT",75,0)
 I X?1"???".E D EN^DDIOL(.PSJHLP) K PSJHLP
"RTN","PSJDDUT",76,0)
 I X?1"???".E R !,"(Press RETURN to continue.) ",Q:DTIME D:'$T EN^DDIOL("","","$C(7)") S:'$T Q="^" I Q="^" K:$D(PSGDDFLG) PSGDDFLG,PSGST Q
"RTN","PSJDDUT",77,0)
 K DIC S DIC="^PS(51.1,",DIC(0)="E",D="APPSJ",DIC("W")="W ""  ""," I $D(PSJPWD),PSJPWD S DIC("W")=DIC("W")_"$S($D(^PS(51.1,+Y,1,PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"
"RTN","PSJDDUT",78,0)
 ; Naked references on the following two lines refer to the full reference on the line above
"RTN","PSJDDUT",79,0)
 E  S DIC("W")=DIC("W")_"$P(^(0),""^"",2)"
"RTN","PSJDDUT",80,0)
 I $D(PSGST) S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSJDDUT",81,0)
 S DIC("?N",51.1)=12
"RTN","PSJDDUT",82,0)
 D IX^DIC K DIC K:$D(PSGDDFLG) PSGDDFLG,PSGST Q
"RTN","PSJDDUT",83,0)
 ;
"RTN","PSJDDUT",84,0)
HT ;
"RTN","PSJDDUT",85,0)
 ;;  This is the frequency (ONLY) with which the doses are to be
"RTN","PSJDDUT",86,0)
 ;;administered.  Several forms of entry are acceptable, such as
"RTN","PSJDDUT",87,0)
 ;;Q6H, 09-12-15, STAT, QOD, and MO-WE-FR@AD (where MO-WE-FR are
"RTN","PSJDDUT",88,0)
 ;;days of the week, and AD is the admin times).  The schedule
"RTN","PSJDDUT",89,0)
 ;;will show on the MAR, labels, etc.  No more than ONE space
"RTN","PSJDDUT",90,0)
 ;;(Q3H 4 or Q4H PRN) in the schedule is acceptable.  If the
"RTN","PSJDDUT",91,0)
 ;;letters PRN ;;are found as part of the schedule, no admin
"RTN","PSJDDUT",92,0)
 ;;times will print on the MAR or labels, and the PICK LIST will
"RTN","PSJDDUT",93,0)
 ;;always show a count of zero (0).
"RTN","PSJDDUT",94,0)
 ;;Avoid using notation such as W/F (with food) or WM (with meals)
"RTN","PSJDDUT",95,0)
 ;;in the schedule as it may cause erroneous calculations.  That
"RTN","PSJDDUT",96,0)
 ;;information should be entered into the SPECIAL INSTRUCTIONS.
"RTN","PSJDDUT",97,0)
 ;;  When using the MO-WE-FR@AD schedule, please remember that
"RTN","PSJDDUT",98,0)
 ;;this type of schedule will not work properly without the "@"
"RTN","PSJDDUT",99,0)
 ;;character and at least one admin time, and that at least the
"RTN","PSJDDUT",100,0)
 ;;first two letters of each weekday entered is needed.
"RTN","PSJDDUT",101,0)
 ;
"RTN","PSJDDUT",102,0)
ADTM2 ;Called from Non-Verified Orders File (53.1), Admin Times field 39    
"RTN","PSJDDUT",103,0)
 S PSJHLP(1)="All times must be the same length (2 or 4 characters), must be"
"RTN","PSJDDUT",104,0)
 S PSJHLP(2)="separated by dashes ( - ), and be in ascending order"
"RTN","PSJDDUT",105,0)
 S PSJHLP(3)=" "
"RTN","PSJDDUT",106,0)
 S PSJHLP(4)="This is the set of administration times for this order."
"RTN","PSJDDUT",107,0)
 S PSJHLP(5)="If the Schedule Type is CONTINUOUS the number of administration"
"RTN","PSJDDUT",108,0)
 S PSJHLP(6)="times cannot exceed that indicated by the schedule.  There can"
"RTN","PSJDDUT",109,0)
 S PSJHLP(7)="be less administration times then indicated by the schedule."
"RTN","PSJDDUT",110,0)
 S PSJHLP(8)="There must be at least one administration time entered."
"RTN","PSJDDUT",111,0)
 S PSJHLP(9)=" "
"RTN","PSJDDUT",112,0)
 S PSJHLP(10)="If the Schedule Type is CONTINUOUS and is an Odd Schedule"
"RTN","PSJDDUT",113,0)
 S PSJHLP(11)="(A schedule whose frequency is not evenly divisible by or"
"RTN","PSJDDUT",114,0)
 S PSJHLP(12)="into 1440 minutes or 1 day), Administration Times are not allowed."
"RTN","PSJDDUT",115,0)
 S PSJHLP(13)="For example Q5H, Q17H - these are not evenly divisible by 1440."
"RTN","PSJDDUT",116,0)
 S PSJHLP(14)=" "
"RTN","PSJDDUT",117,0)
 S PSJHLP(15)="If the Schedule Type is CONTINUOUS with a non-odd frequency of"
"RTN","PSJDDUT",118,0)
 S PSJHLP(16)="greater than 1 day (1440 minutes) then more than one"
"RTN","PSJDDUT",119,0)
 S PSJHLP(17)="administration time is not allowed.  For example schedules of"
"RTN","PSJDDUT",120,0)
 S PSJHLP(18)="Q72H, Q3Day, Q5Day."
"RTN","PSJDDUT",121,0)
 S PSJHLP(19)=" "
"RTN","PSJDDUT",122,0)
 S PSJHLP(20)="If the Schedule Type is ONE TIME it cannot have more than one"
"RTN","PSJDDUT",123,0)
 S PSJHLP(21)="administration time."
"RTN","PSJDDUT",124,0)
 D WRITE
"RTN","PSJDDUT",125,0)
 Q
"RTN","PSJDDUT",126,0)
 ;
"RTN","PSJDDUT",127,0)
WRDGP ;Called from Ward Group File (57.5), Ward Group field .01   
"RTN","PSJDDUT",128,0)
 S PSJHLP(1)="There is at least one PICK LIST for this WARD GROUP.  This WARD"
"RTN","PSJDDUT",129,0)
 S PSJHLP(1,"F")="$C(7),!!?2"
"RTN","PSJDDUT",130,0)
 S PSJHLP(2)="GROUP cannot be deleted until the PICK LIST(s) is purged or deleted."
"RTN","PSJDDUT",131,0)
 D WRITE
"RTN","PSJDDUT",132,0)
 Q
"RTN","PSJDDUT",133,0)
 ;
"RTN","PSJDDUT",134,0)
LBLS ;Called from Inpatient Ward Parameters file (59.6), field .11
"RTN","PSJDDUT",135,0)
 S PSJHLP(1)="ANY NEW LABELS OLDER THAN THE NUMBER OF DAYS SPECIFIED HERE WILL"
"RTN","PSJDDUT",136,0)
 S PSJHLP(2)="AUTOMATICALLY BE PURGED."
"RTN","PSJDDUT",137,0)
 D WRITE
"RTN","PSJDDUT",138,0)
 Q
"RTN","PSJDDUT",139,0)
 ;
"RTN","PSJDDUT",140,0)
SCHTP ;Called from the Unit Dose Multiple of file 55, Schedule Type field 7
"RTN","PSJDDUT",141,0)
 S PSJHLP(1)="CHOOSE FROM:"
"RTN","PSJDDUT",142,0)
 S PSJHLP(1,"F")="!!"
"RTN","PSJDDUT",143,0)
 S PSJHLP(2)="C - CONTINUOUS"
"RTN","PSJDDUT",144,0)
 S PSJHLP(2,"F")="!?3"
"RTN","PSJDDUT",145,0)
 S PSJHLP(3)="O - ONE-TIME"
"RTN","PSJDDUT",146,0)
 S PSJHLP(3,"F")="!?3"
"RTN","PSJDDUT",147,0)
 S PSJHLP(4)="OC - ON CALL"
"RTN","PSJDDUT",148,0)
 S PSJHLP(4,"F")="!?3"
"RTN","PSJDDUT",149,0)
 S PSJHLP(5)="P - PRN"
"RTN","PSJDDUT",150,0)
 S PSJHLP(5,"F")="!?3"
"RTN","PSJDDUT",151,0)
 S PSJHLP(6)="R - FILL ON REQUEST"
"RTN","PSJDDUT",152,0)
 S PSJHLP(6,"F")="!?3"
"RTN","PSJDDUT",153,0)
 D WRITE
"RTN","PSJDDUT",154,0)
 Q
"RTN","PSJDDUT",155,0)
 ;
"RTN","PSJDDUT",156,0)
EN ;Called from Non-Verified Orders file 53.1, Start/Date Time field 10
"RTN","PSJDDUT",157,0)
 ;and Stop Date/Time field 25 (Replaces EN^PSGDL)
"RTN","PSJDDUT",158,0)
 K PSGDLS S ND2=^PS(53.1,DA,2) I $P(ND2,"^",5)!$P(ND2,"^",6) D EN^DDIOL(" ...Dose Limit... ","","?0") G ENGO
"RTN","PSJDDUT",159,0)
 G DONE
"RTN","PSJDDUT",160,0)
 ;
"RTN","PSJDDUT",161,0)
ENGO ;
"RTN","PSJDDUT",162,0)
 N FD
"RTN","PSJDDUT",163,0)
 S SCH=$P(ND2,"^")
"RTN","PSJDDUT",164,0)
 S ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSJDDUT",165,0)
 S TS=$P(ND2,"^",5),MN=$P(ND2,"^",6)
"RTN","PSJDDUT",166,0)
 I $P(PSJSYSW0,U,5)=2 D
"RTN","PSJDDUT",167,0)
 . Q:'TS  S:TS'[$P(ST,".",2) $P(PSJSYSW0,U,5)=1 D
"RTN","PSJDDUT",168,0)
 .. N STRING,ND2,SCH,TS,MN S STRING=$G(PSGSD)_"^"_$G(PSGFD)_"^"_$G(PSGSCH)_"^"_$G(PSGST)_"^"_$G(PSGPDRG)_"^"_$G(PSGAT)
"RTN","PSJDDUT",169,0)
 .. S (FD,ST)=$$ENQ^PSJORP2(PSGP,STRING) S:'ST ST=$S($D(PSGDLS):PSGDLS,1:$P(ND2,"^",2))
"RTN","PSJDDUT",170,0)
 . S $P(PSJSYSW0,U,5)=2
"RTN","PSJDDUT",171,0)
 I $G(FD),$P(ND2,"^",4),FD>$P(ND2,"^",4) D  G DONE
"RTN","PSJDDUT",172,0)
 . W !,"There is no schedule and/or administration time that falls between the Start Date/Time"
"RTN","PSJDDUT",173,0)
 . W !,"and Stop Date/Time.  For the order to be valid the schedule and/or administration time"
"RTN","PSJDDUT",174,0)
 . W !,"must fall between the order's Start Date/Time and Stop Date/Time.",!
"RTN","PSJDDUT",175,0)
 S TS=$P(ND2,"^",5),MN=$P(ND2,"^",6)
"RTN","PSJDDUT",176,0)
 G MWF:SCH["@",DONE:'TS&'MN
"RTN","PSJDDUT",177,0)
 I 'TS S AM=MN*PSGDL,X=$$EN^PSGCT(ST,AM) G DONE
"RTN","PSJDDUT",178,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-")))
"RTN","PSJDDUT",179,0)
 F Q=1:1 Q:$P(TS,"-",Q)=""!(TM<$P(TS,"-",Q))
"RTN","PSJDDUT",180,0)
 S X=ST\1,C=0 F Q=Q:1 D:$P(TS,"-",Q)="" ADD S C=C+1 I C=PSGDL S X=X_"."_$P(TS,"-",Q) G DONE
"RTN","PSJDDUT",181,0)
 ;
"RTN","PSJDDUT",182,0)
MWF ; if schedule is similar to monday-wednesday-friday
"RTN","PSJDDUT",183,0)
 S TS=$P(SCH,"@",2),SCH=$P(SCH,"@"),X=$P(ST,"."),C=0 D SCHK G:C=PSGDL DONE F Q=1:1 S X1=$P(ST,"."),X2=Q D C^%DTC S X1=X D DW^%DTC D CHK G:C=PSGDL DONE
"RTN","PSJDDUT",184,0)
SCHK S X1=X D DW^%DTC F Q=1:1:$L(SCH,"-") S WKD=$P(SCH,"-",Q) I WKD=$E(X,1,$L(WKD)) Q
"RTN","PSJDDUT",185,0)
 E  Q
"RTN","PSJDDUT",186,0)
 S TM=$E(ST_"00000",9,8+$L($P(TS,"-"))) F Q=1:1:$L(TS,"-") I TM<$P(TS,"-",Q) S C=C+1 I C=PSGDL S X=X1_"."_$P(TS,"-",Q) Q
"RTN","PSJDDUT",187,0)
 Q
"RTN","PSJDDUT",188,0)
 ;
"RTN","PSJDDUT",189,0)
DONE ;
"RTN","PSJDDUT",190,0)
 K %H,%T,%Y,MN,ND2,ND4,PSGDLS,PSGDL,Q1,QQ,SCH,TM,WKD,TS,X1,X2 Q
"RTN","PSJDDUT",191,0)
 ;
"RTN","PSJDDUT",192,0)
ADD ;
"RTN","PSJDDUT",193,0)
 S X1=$P(X,"."),X2=$S(MN&'(MN#1440):MN\1440,1:1) D C^%DTC S Q=1 Q
"RTN","PSJDDUT",194,0)
 ;
"RTN","PSJDDUT",195,0)
WRITE ;Calls EN^DDIOL to write text
"RTN","PSJDDUT",196,0)
 D EN^DDIOL(.PSJHLP) K PSJHLP Q
"RTN","PSJORPOE")
0^11^B36843911^B37937868
"RTN","PSJORPOE",1,0)
PSJORPOE ;BIR/MLM,LDT-MISC. PROCEDURE CALLS FOR OE/RR 3.0 ;24 Feb 99 / 10:43 AM
"RTN","PSJORPOE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,56,92,80,110,127,133,134,113**;16 DEC 97;Build 63
"RTN","PSJORPOE",3,0)
 ;
"RTN","PSJORPOE",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJORPOE",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJORPOE",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJORPOE",7,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJORPOE",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJORPOE",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJORPOE",10,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJORPOE",11,0)
 ;
"RTN","PSJORPOE",12,0)
STARTSTP(PSGP,SCH,OI,PSJPWD,PSGORD,PSJADM) ;
"RTN","PSJORPOE",13,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",14,0)
 ; SCH=Schedule
"RTN","PSJORPOE",15,0)
 ; OI=Orderable Item        
"RTN","PSJORPOE",16,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",17,0)
 ; PSGORD=Pharmacy Order Number if the order being placed is a Renewal (Optional)
"RTN","PSJORPOE",18,0)
 ;
"RTN","PSJORPOE",19,0)
 Q:+PSGP'>0 ""
"RTN","PSJORPOE",20,0)
 Q:SCH']"" ""
"RTN","PSJORPOE",21,0)
 Q:+OI'>0 ""
"RTN","PSJORPOE",22,0)
 I SCH?.E1L.E S SCH=$$ENLU^PSGMI(SCH)
"RTN","PSJORPOE",23,0)
 K DFN,PSGNEFDO,PSGNEFD,PSGST,PSGSCH,PSGNEDFD,PSGNESD,PSJSYSW,PSJSYSW0 N RESULT
"RTN","PSJORPOE",24,0)
 S:'$D(PSGS0XT) PSGS0XT="" S:'$D(PSGS0Y) PSGSOY=""
"RTN","PSJORPOE",25,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",26,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",27,0)
 S RESULT=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",28,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",29,0)
 N %,PSGXSCH D NOW^%DTC S PSGDT=%,DFN=PSGP,(PSGSCH,PSGXSCH)=SCH
"RTN","PSJORPOE",30,0)
 S X=PSGSCH,PSGS0Y="" D ADMIN
"RTN","PSJORPOE",31,0)
 I $G(PSGORD)]"" D
"RTN","PSJORPOE",32,0)
 .S PSGNESD=$$DSTART^PSJDCU(PSGP,PSGORD) I PSGNESD]"" S $P(RESULT,"^",2)=PSGNESD Q
"RTN","PSJORPOE",33,0)
 .S ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,2)),1:$G(^PS(55,PSGP,"IV",+PSGORD,0)))
"RTN","PSJORPOE",34,0)
 .N PSJADM,PSJSTRT S PSJADM=$S(PSGORD["U":$P(ND,"^",5),1:$P(ND,"^",11)),PSJSTRT=$P(ND,"^",2),PSJREN=1
"RTN","PSJORPOE",35,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",36,0)
 N PSJTMPW0 S PSJTMPW0=PSJSYSW0 S $P(PSJSYSW0,"^",5)=1
"RTN","PSJORPOE",37,0)
 I $G(PSGNESD)="" S RESULT=RESULT_"^"_$$ENSD^PSGNE3(PSGSCH,$S($G(PSJADM)]"":$G(PSJADM),1:PSGS0Y),PSGDT,$S($G(PSJSTRT)]"":$G(PSJSTRT),1:PSGDT))
"RTN","PSJORPOE",38,0)
 S PSJSYSW0=PSJTMPW0
"RTN","PSJORPOE",39,0)
 S PSGNESD=$P(RESULT,"^",2)
"RTN","PSJORPOE",40,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",OI)
"RTN","PSJORPOE",41,0)
 K PSGODF,PSGOES,PSJREN
"RTN","PSJORPOE",42,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",43,0)
 D ENFD^PSGNE3(PSGDT) S RESULT=RESULT_"^"_$G(PSGNEFD) ;_"^"_$G(PSGNEFDO)
"RTN","PSJORPOE",44,0)
 N DATE S DATE=$$FMDIFF^XLFDT($P(RESULT,"^",3),$P(RESULT,"^",2),3)
"RTN","PSJORPOE",45,0)
 S $P(RESULT,"^",3)=$S($G(PSGST)="O":0,+DATE>0:+DATE_"D",$P($P(DATE," ",2),":")>0:$P($P(DATE," ",2),":")_"H",1:0)
"RTN","PSJORPOE",46,0)
 N STRING S STRING=PSGNESD_U_PSGNEFD_U_$G(PSGSCH)_U_$G(PSGST)_U_$G(OI) I ($P($G(ZZND),U,2)]"")&($P($G(ZZND),"^")=$G(PSGSCH)) S STRING=STRING_U_$P(ZZND,U,2)
"RTN","PSJORPOE",47,0)
 I $G(PSGSCH)]"" I $$DOW^PSIVUTL(PSGSCH) S:$G(PSGS0Y) $P(STRING,"^",6)=PSGS0Y
"RTN","PSJORPOE",48,0)
 I $G(PSJADM) S $P(STRING,"^",6)=PSJADM
"RTN","PSJORPOE",49,0)
 S RESULT=RESULT_"^"_$$ENQ^PSJORP2(PSGP,STRING) I ($G(PSGSCH)]"") I $$DOW^PSIVUTL(PSGSCH),(PSGSCH'["@"),'$G(PSGS0Y) S $P(RESULT,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",50,0)
 I ($G(PSGSCH)]"") I $$PRNOK^PSGS0(PSGSCH) S $P(RESULT,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",51,0)
 D KVAR^VADPT K LYN,ND,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ
"RTN","PSJORPOE",52,0)
 ;RESULT=WARD PARAMETER^DEFAULT START DATE/TIME^#_D(NUMBER OF DAYS ORDER LASTS) OR #_H(NUMBER OF HOURS ORDER LASTS)^EXPECTED FIRST DOSE
"RTN","PSJORPOE",53,0)
 Q RESULT
"RTN","PSJORPOE",54,0)
 ;
"RTN","PSJORPOE",55,0)
RESOLVE(PSGP,SCH,OI,PCH,PSJPWD,PSJADM) ;
"RTN","PSJORPOE",56,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",57,0)
 ; SCH=Schedule
"RTN","PSJORPOE",58,0)
 ; OI=Orderable Item
"RTN","PSJORPOE",59,0)
 ; PCH=Providers Choice
"RTN","PSJORPOE",60,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",61,0)
 ; PSJADM=Admin Times (Optional)
"RTN","PSJORPOE",62,0)
 ;
"RTN","PSJORPOE",63,0)
 N PSJSYSW0,PSJSYSW,PSGSCH,PSGOES,PSGS0Y,DFN,RESULT1
"RTN","PSJORPOE",64,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",65,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",66,0)
 S $P(PSJSYSW0,"^",5)=$S($$ONE(SCH):2,PCH="NEXT":1,1:0)
"RTN","PSJORPOE",67,0)
 S RESULT1=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",68,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",69,0)
 N % D NOW^%DTC S PSGDT=%,DFN=PSGP,PSGSCH=SCH
"RTN","PSJORPOE",70,0)
 S X=PSGSCH,PSGS0Y="" I $D(^PS(51.1,"AC","PSJ",X)) D ADMIN
"RTN","PSJORPOE",71,0)
 S:$G(PSJADM) PSGS0Y=PSJADM
"RTN","PSJORPOE",72,0)
 S RESULT1=RESULT1_"^"_$$ENSD^PSGNE3(SCH,PSGS0Y,PSGDT,PSGDT)
"RTN","PSJORPOE",73,0)
 I $G(PSGSCH)]"" I $$DOW^PSIVUTL(PSGSCH),(PSGSCH'["@"),'$G(PSGS0Y) S $P(RESULT,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",74,0)
 I $G(PSGSCH)]"" I $$PRNOK^PSGS0(PSGSCH) S $P(RESULT1,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",75,0)
 D KVAR^VADPT K LYN,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ,PSGS0XT,PSGS0Y
"RTN","PSJORPOE",76,0)
 Q RESULT1
"RTN","PSJORPOE",77,0)
 ;
"RTN","PSJORPOE",78,0)
SCHREQ(MR,OI,DD)  ;
"RTN","PSJORPOE",79,0)
 ; MR=Medication Route from 51.2 (Required)
"RTN","PSJORPOE",80,0)
 ; OI=Orderable Item from 50.7 (Optional)
"RTN","PSJORPOE",81,0)
 ; DD=Dispense Drug from 50 (Optional)
"RTN","PSJORPOE",82,0)
 N ADDITIVE,SOLUTION,REQ S REQ=0,(SOLUTION,ADDITIVE)=""
"RTN","PSJORPOE",83,0)
 I '+$G(MR) S REQ=1 Q REQ
"RTN","PSJORPOE",84,0)
 I '+$G(OI),'+$G(DD) S REQ=1 Q REQ
"RTN","PSJORPOE",85,0)
 I +$G(DD) S:$P($G(^PSDRUG(+DD,2)),U,3)["U" REQ=1 Q REQ
"RTN","PSJORPOE",86,0)
 I '$D(PS(51.2,+MR,0)) S REQ=1 Q REQ
"RTN","PSJORPOE",87,0)
 I $P($G(^PS(51.2,+MR,0)),"^",6)=1 D
"RTN","PSJORPOE",88,0)
 .I +$G(OI) D
"RTN","PSJORPOE",89,0)
 ..I '$D(^PS(50.7,+OI,0)) S REQ=1 Q
"RTN","PSJORPOE",90,0)
 ..F  S SOLUTION=$O(^PS(52.7,"AOI",+OI,SOLUTION)) Q:'SOLUTION  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.7,SOLUTION,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",91,0)
 ..F  S ADDITIVE=$O(^PS(52.6,"AOI",+OI,ADDITIVE)) Q:'ADDITIVE  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.6,ADDITIVE,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",92,0)
 Q REQ
"RTN","PSJORPOE",93,0)
 ;
"RTN","PSJORPOE",94,0)
ADMIN ; Get admin times associated with schedule
"RTN","PSJORPOE",95,0)
 S PSGS0Y="",ZZ=0
"RTN","PSJORPOE",96,0)
 I $$DOW^PSIVUTL($P(X,"@")),'$D(^PS(51.1,"AC","PSJ",X)) S PSGST="C" D  Q:$G(PSGS0Y)
"RTN","PSJORPOE",97,0)
 .I $P(X,"@",2) N PSJADBAD D  Q
"RTN","PSJORPOE",98,0)
 ..S PSGS0Y=$S($G(PSJADBAD):"",1:$P(X,"@",2))
"RTN","PSJORPOE",99,0)
 ..N ADMIN,TIME,II S ADMIN=$P(X,"@",2) F II=1:1:$L(ADMIN,"-") S TIME=$P(ADMIN,"-",II) I TIME'?2N&(TIME'?4N) S PSJADBAD=1
"RTN","PSJORPOE",100,0)
 .I $P(X,"@",2)]"",$D(^PS(51.1,"APPSJ",$P(X,"@",2))) S X=$P(X,"@",2)
"RTN","PSJORPOE",101,0)
 D FIND^DIC(51.1,,,,X,,"APPSJ",,,"LYN")
"RTN","PSJORPOE",102,0)
 S ZZ=$O(LYN("DILIST",2,ZZ)) I ZZ S ZZ=+LYN("DILIST",2,ZZ) I ZZ S ZZND=$G(^PS(51.1,ZZ,0)) S PSGST=$P(ZZND,U,5),PSGS0XT=$P(ZZND,U,3) S:$G(PSGSFLG) PSGSCIEN=$G(LYN("DILIST",2,ZZ)) I $G(PSJPWD) D
"RTN","PSJORPOE",103,0)
 . N ZZNDW S ZZNDW=$G(^PS(51.1,ZZ,1,PSJPWD,0)) I $P(ZZNDW,"^",2)]"" S PSGS0Y=$P(ZZNDW,"^",2),$P(ZZND,"^",2)=PSGS0Y I $G(PSGSFLG) S PSGSCIEN=$G(LYN("DILIST",2,ZZ))
"RTN","PSJORPOE",104,0)
 S ZZ=0 F  S ZZ=$O(LYN("DILIST",1,ZZ)) Q:'ZZ  I $G(LYN("DILIST",1,ZZ))'=X K LYN("DILIST",1,ZZ),LYN("DILIST",2,ZZ),LYN("DILIST","ID",ZZ,1)
"RTN","PSJORPOE",105,0)
 I $D(PSJPWD) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ!$G(PSGS0Y)  I $P($G(^PS(51.1,+LYN("DILIST",2,ZZ),1,+PSJPWD,0)),U,2)]"" S PSGS0Y=$P($G(^(0)),U,2) I $G(PSGSFLG) S PSGSCIEN=$G(LYN("DILIST",2,ZZ))
"RTN","PSJORPOE",106,0)
 Q:PSGS0Y]""  S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ!$G(PSGS0Y)  I $G(LYN("DILIST","ID",ZZ,1))]"" S PSGS0Y=$G(LYN("DILIST","ID",ZZ,1))
"RTN","PSJORPOE",107,0)
 Q
"RTN","PSJORPOE",108,0)
 ;
"RTN","PSJORPOE",109,0)
ONE(SCH) ;
"RTN","PSJORPOE",110,0)
 ; SCH=Admin Schedule
"RTN","PSJORPOE",111,0)
 ; Returns 0 = (zero) Not a one time schedule.
"RTN","PSJORPOE",112,0)
 ;         1 =  One time schedule. 
"RTN","PSJORPOE",113,0)
 Q:$G(SCH)="" 0
"RTN","PSJORPOE",114,0)
 N X
"RTN","PSJORPOE",115,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="O":1,1:0)
"RTN","PSJORPOE",116,0)
 Q 0
"RTN","PSJVOSR")
0^13^B19662050^n/a
"RTN","PSJVOSR",1,0)
PSJVOSR ;BIR/DRF-PRINT ACTIVE ORDER SCHEDULE VALIDATION ;13 APR 09 / 5:26 PM 
"RTN","PSJVOSR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**113**;16 DEC 97;Build 63
"RTN","PSJVOSR",3,0)
 ;
"RTN","PSJVOSR",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJVOSR",5,0)
 ; Reference to ^%ZTLOAD is supported by DBIA 10063.
"RTN","PSJVOSR",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSJVOSR",7,0)
 ; Reference to ^%ZIS is supported by DBIA 10086.
"RTN","PSJVOSR",8,0)
 ; Reference to ^%ZISC is supported by DBIA 10089.
"RTN","PSJVOSR",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJVOSR",10,0)
 ;
"RTN","PSJVOSR",11,0)
SELDEV ;Ask for device type for report to output to
"RTN","PSJVOSR",12,0)
 K IOP,%ZIS,POP,IO("Q")
"RTN","PSJVOSR",13,0)
 W ! S %ZIS("A")="Select output device: ",%ZIS("B")="",%ZIS="Q"
"RTN","PSJVOSR",14,0)
 D ^%ZIS I POP W !,"** No device selected **" G EXIT
"RTN","PSJVOSR",15,0)
 W:'$D(IO("Q")) !,"this may take a while...(you should QUEUE this report)",!
"RTN","PSJVOSR",16,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSJVOSR",17,0)
 . S XDESC="Problem Schedules on Orders"
"RTN","PSJVOSR",18,0)
 . S ZTRTN="START^PSJVOSR"
"RTN","PSJVOSR",19,0)
 . K IO("Q"),ZTSAVE,ZTDTH,ZTSK
"RTN","PSJVOSR",20,0)
 . S ZTDESC=XDESC,PSGIO=ION,ZTIO=PSGIO,ZTDTH=$H,ZTSAVE("PSJSORT")="",%ZIS="QN",IOP=PSGIO
"RTN","PSJVOSR",21,0)
 . D ^%ZIS,^%ZTLOAD
"RTN","PSJVOSR",22,0)
 ;
"RTN","PSJVOSR",23,0)
START ;Loop through open orders.
"RTN","PSJVOSR",24,0)
 D NOW^%DTC S UL132="",$P(UL132,"-",132)="",PSJDATE=$$ENDTC^PSGMI(%),PSJPTR=$E(IOST)'="C",PG=0,PSIVAC="PH",PSJPAG=0
"RTN","PSJVOSR",25,0)
 U IO
"RTN","PSJVOSR",26,0)
 D HEAD
"RTN","PSJVOSR",27,0)
 S PSJTYP="U"
"RTN","PSJVOSR",28,0)
 S STPDT=$P(%,".")-1 F  S STPDT=$O(^PS(55,"AUD",STPDT)) Q:STPDT=""  D
"RTN","PSJVOSR",29,0)
 . S D0="" F  S D0=$O(^PS(55,"AUD",STPDT,D0)) Q:D0=""  D
"RTN","PSJVOSR",30,0)
 .. S D1=""  F  S D1=$O(^PS(55,"AUD",STPDT,D0,D1)) Q:D1=""  D
"RTN","PSJVOSR",31,0)
 ... D TEST
"RTN","PSJVOSR",32,0)
 S PSJTYP="V"
"RTN","PSJVOSR",33,0)
 S STPDT=$P(%,".")-1 F  S STPDT=$O(^PS(55,"AIV",STPDT)) Q:STPDT=""  D
"RTN","PSJVOSR",34,0)
 . S D0="" F  S D0=$O(^PS(55,"AIV",STPDT,D0)) Q:D0=""  D
"RTN","PSJVOSR",35,0)
 .. S D1=""  F  S D1=$O(^PS(55,"AIV",STPDT,D0,D1)) Q:D1=""  D
"RTN","PSJVOSR",36,0)
 ... D TEST
"RTN","PSJVOSR",37,0)
EXIT ;Kill and exit.
"RTN","PSJVOSR",38,0)
 K %,%H,%I,%ZIS,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTRTN
"RTN","PSJVOSR",39,0)
 K D0,D1,DONE,ERR,NAME,PG,PSGAT,PSGIO,PSGS0XT,PSGSCH,PSGSSP,PSGSST,PSGST
"RTN","PSJVOSR",40,0)
 K PSIVAC,PSJDATE,PSJPAG,PSJPTR,PSJTYP,SPD,SSN,STD,STPDT,UL132,X,XDESC,Y
"RTN","PSJVOSR",41,0)
 K ZTQUEUED,ZTREQ
"RTN","PSJVOSR",42,0)
 W:$E(IOST)="C"&($Y) @IOF
"RTN","PSJVOSR",43,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSJVOSR",44,0)
 S IOP="HOME" D ^%ZISC
"RTN","PSJVOSR",45,0)
 Q
"RTN","PSJVOSR",46,0)
 ;
"RTN","PSJVOSR",47,0)
DISPLAY ;Display Name, last 4 of SS, order number, start date, stop date, schedule, schedule type, admin times, error.
"RTN","PSJVOSR",48,0)
 S NAME=$$GET1^DIQ(2,D0,.01,"O")
"RTN","PSJVOSR",49,0)
 S SSN="XXX-XX-"_$E($$GET1^DIQ(2,D0,.09,"O"),6,9)
"RTN","PSJVOSR",50,0)
 S Y=PSGSST D DD^%DT S STD=Y
"RTN","PSJVOSR",51,0)
 S Y=PSGSSP D DD^%DT S SPD=Y
"RTN","PSJVOSR",52,0)
 D:($Y+5)>IOSL HEAD
"RTN","PSJVOSR",53,0)
 W !,NAME,?20,SSN,?33,STD,?52,SPD,?71,PSGSCH,?91,$S(+PSGS0XT:"C",1:PSGS0XT),?96,PSGAT,!,ERR
"RTN","PSJVOSR",54,0)
 Q
"RTN","PSJVOSR",55,0)
 ;
"RTN","PSJVOSR",56,0)
PAUSE ;Hold screen.
"RTN","PSJVOSR",57,0)
 K DIR S DIR(0)="E" D ^DIR S:$D(DTOUT)!($D(DUOUT)) DONE=1
"RTN","PSJVOSR",58,0)
 Q
"RTN","PSJVOSR",59,0)
 ;
"RTN","PSJVOSR",60,0)
TEST ;Check for errors.
"RTN","PSJVOSR",61,0)
 N D12,MAX
"RTN","PSJVOSR",62,0)
 I PSJTYP="U" D
"RTN","PSJVOSR",63,0)
 . S D12=$G(^PS(55,D0,5,D1,2))
"RTN","PSJVOSR",64,0)
 . S PSGSCH=$P(D12,"^",1),(X,PSGAT)=$P(D12,"^",5),PSGS0XT=$P(D12,"^",6),PSGSST=$P(D12,"^",2),PSGSSP=$P(D12,"^",4)
"RTN","PSJVOSR",65,0)
 I PSJTYP="V" D
"RTN","PSJVOSR",66,0)
 . S D12=$G(^PS(55,D0,"IV",D1,0))
"RTN","PSJVOSR",67,0)
 . S PSGSCH=$P(D12,"^",9),(X,PSGAT)=$P(D12,"^",11),PSGS0XT=$P(D12,"^",15),PSGSST=$P(D12,"^",2),PSGSSP=$P(D12,"^",3)
"RTN","PSJVOSR",68,0)
 I PSGSCH[" PRN" S PSGS0XT="P"
"RTN","PSJVOSR",69,0)
 I PSGS0XT="P" D  Q  ;No times required or allowed for PRN
"RTN","PSJVOSR",70,0)
 . I X="" Q
"RTN","PSJVOSR",71,0)
 . S ERR="Admin times not permitted for PRN schedule"
"RTN","PSJVOSR",72,0)
 . D DISPLAY
"RTN","PSJVOSR",73,0)
 I PSGS0XT="D"!(PSGS0XT)="OC" Q
"RTN","PSJVOSR",74,0)
 S PSGST=$S(PSGS0XT?1.N:"C",1:PSGS0XT)
"RTN","PSJVOSR",75,0)
 S ERR="" D
"RTN","PSJVOSR",76,0)
 . I X="" S ERR="This order requires at least one administration time" Q
"RTN","PSJVOSR",77,0)
 . I $G(PSGS0XT)="O",$L(X,"-")>1 S ERR="This is a One Time Order - only one admin time is permitted." Q
"RTN","PSJVOSR",78,0)
 . I +PSGS0XT=0 Q  ;No frequency - can not check frequency related items
"RTN","PSJVOSR",79,0)
 . S MAX=1440/PSGS0XT
"RTN","PSJVOSR",80,0)
 . I MAX<1 D  Q
"RTN","PSJVOSR",81,0)
 .. I $L(X,"-")'=1 S ERR="This order requires one admin time." Q
"RTN","PSJVOSR",82,0)
 . I MAX'<1,$L(X,"-")>MAX S ERR="The number of admin times entered is greater than indicated by the schedule." Q  ;Too many times
"RTN","PSJVOSR",83,0)
 . I MAX'<1,$L(X,"-")<MAX S ERR="The number of admin times entered is fewer than indicated by the schedule." Q  ;Too few times
"RTN","PSJVOSR",84,0)
 I ERR]"" D DISPLAY Q
"RTN","PSJVOSR",85,0)
 D ENCHK^PSGS0
"RTN","PSJVOSR",86,0)
 I '$D(X) S ERR="Schedule/Admin times failed validation" D DISPLAY
"RTN","PSJVOSR",87,0)
 Q
"RTN","PSJVOSR",88,0)
 ;
"RTN","PSJVOSR",89,0)
HEAD ;Header.
"RTN","PSJVOSR",90,0)
 W:$Y @IOF S PSJPAG=PSJPAG+1
"RTN","PSJVOSR",91,0)
 W PSJDATE,?47,"Inpatient Medications Schedule Issues",?120,"PAGE: ",PSJPAG,!! W !,"PATIENT",?20,"SSN",?33,"START DATE",?52,"STOP DATE",?71,"SCHEDULE",?91,"TYPE",?96,"ADMIN TIMES"
"RTN","PSJVOSR",92,0)
 W !,UL132
"RTN","PSJVOSR",93,0)
 Q
"VER")
8.0^22.0
"^DD",53.1,53.1,39,0)
ADMIN TIMES^FX^^2;5^K:X[""""!($A(X)=45) X I $D(X) D ENCHK^PSGS0
"^DD",53.1,53.1,39,1,0)
^.1
"^DD",53.1,53.1,39,1,1,0)
53.1^AAT^MUMPS
"^DD",53.1,53.1,39,1,1,1)
S PSGS0Y=X
"^DD",53.1,53.1,39,1,1,2)
Q
"^DD",53.1,53.1,39,1,1,"%D",0)
^^3^3^2971211^^^^
"^DD",53.1,53.1,39,1,1,"%D",1,0)
 Used to ensure the variable PSGS0Y contains the admin times for the
"^DD",53.1,53.1,39,1,1,"%D",2,0)
order when the field is set using VA FileMan.
"^DD",53.1,53.1,39,1,1,"%D",3,0)
 S PSGS0Y=ADMIN TIMES
"^DD",53.1,53.1,39,1,2,0)
53.1^ADM^MUMPS
"^DD",53.1,53.1,39,1,2,1)
I $D(^PS(53.1,DA,2)),$P(^(2),"^")["@" S $P(^(2),"^")=$P($P(^(2),"^"),"@")_"@"_X
"^DD",53.1,53.1,39,1,2,2)
Q
"^DD",53.1,53.1,39,1,2,3)
NEEDED BY UNIT DOSE
"^DD",53.1,53.1,39,1,2,"%D",0)
^^3^3^2971211^
"^DD",53.1,53.1,39,1,2,"%D",1,0)
Used to update a DAY OF THE WEEK type schedule whenever the admin times are
"^DD",53.1,53.1,39,1,2,"%D",2,0)
changed.
"^DD",53.1,53.1,39,1,2,"%D",3,0)
S $P(^PS(53.1,ORDER NUMBER,2),"^")=$P(SCHEDULE,"@",2)_@_ADMIN TIMES
"^DD",53.1,53.1,39,3)
Enter a set of administration times for this order.
"^DD",53.1,53.1,39,4)
D ADTM2^PSJDDUT
"^DD",53.1,53.1,39,5,1,0)
53.1^26^1
"^DD",53.1,53.1,39,20,0)
^.3LA^1^1
"^DD",53.1,53.1,39,20,1,0)
PSJU
"^DD",53.1,53.1,39,21,0)
^.001^1^1^3080826^^^^
"^DD",53.1,53.1,39,21,1,0)
  This is the set of administration times for this order.
"^DD",53.1,53.1,39,"DEL",5,0)
I $D(^PS(53.1,DA,2)),$P(^(2),"^")["@" D EN^DDIOL("YOU CANNOT DELETE THE ADMIN TIMES FOR THIS TYPE OF SCHEDULE. ","","!?2")
"^DD",53.1,53.1,39,"DEL",41,0)
I $D(^PS(53.1,DA,2)),$P(^(2),"^",6)="D" D EN^DDIOL("This is a 'DAY OF THE WEEK' schedule, and must have admin times.","","!")
"^DD",53.1,53.1,39,"DT")
3090209
"BLD",6685,6)
^200
**END**
**END**
