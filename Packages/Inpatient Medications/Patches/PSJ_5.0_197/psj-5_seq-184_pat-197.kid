Released PSJ*5*197 SEQ #184
Extracted from mail message
**KIDS**:PSJ*5.0*197^

**INSTALL NAME**
PSJ*5.0*197
"BLD",6335,0)
PSJ*5.0*197^INPATIENT MEDICATIONS^0^3080807^y
"BLD",6335,1,0)
^^20^20^3080807^^^^
"BLD",6335,1,1,0)
This patch resolves two issues in the Inpatient Medications package.
"BLD",6335,1,2,0)

"BLD",6335,1,3,0)
1. When stat medications are ordered using Inpatient Medications for
"BLD",6335,1,4,0)
Outpatients (IMO), the resulting notification email lacked the
"BLD",6335,1,5,0)
name of the clinic. Ward names were included correctly. Clinic names
"BLD",6335,1,6,0)
were added. The mail group receiving the notification is PSJ STAT NOW
"BLD",6335,1,7,0)
ACTIVE or PSJ STAT NOW PENDING.
"BLD",6335,1,8,0)
 
"BLD",6335,1,9,0)
The routines PSJHL4 and PSJHL4A were modified to establish a value for CLINIC
"BLD",6335,1,10,0)
if the location is a clinic, and then set using the same variable as ward.
"BLD",6335,1,11,0)
 
"BLD",6335,1,12,0)
2. After the release of Patch PSJ*5*110, MAR labels do include the
"BLD",6335,1,13,0)
order/renewal date on the left side of the label, which is attached
"BLD",6335,1,14,0)
to the MAR. It only appears on the right side, which is discarded.
"BLD",6335,1,15,0)
The date has been placed on left side as well as the right side.
"BLD",6335,1,16,0)

"BLD",6335,1,17,0)
Routine PSGLOI was modified to correct this problem. If the order is not
"BLD",6335,1,18,0)
pending, the order/renewal date is set at the left hand side of the label.
"BLD",6335,1,19,0)

"BLD",6335,1,20,0)

"BLD",6335,4,0)
^9.64PA^^
"BLD",6335,6)
2^
"BLD",6335,6.3)
3
"BLD",6335,"ABPKG")
n
"BLD",6335,"KRN",0)
^9.67PA^8989.52^19
"BLD",6335,"KRN",.4,0)
.4
"BLD",6335,"KRN",.401,0)
.401
"BLD",6335,"KRN",.402,0)
.402
"BLD",6335,"KRN",.403,0)
.403
"BLD",6335,"KRN",.5,0)
.5
"BLD",6335,"KRN",.84,0)
.84
"BLD",6335,"KRN",3.6,0)
3.6
"BLD",6335,"KRN",3.8,0)
3.8
"BLD",6335,"KRN",9.2,0)
9.2
"BLD",6335,"KRN",9.8,0)
9.8
"BLD",6335,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6335,"KRN",9.8,"NM",1,0)
PSJHL4^^0^B74448907
"BLD",6335,"KRN",9.8,"NM",2,0)
PSGLOI^^0^B33839638
"BLD",6335,"KRN",9.8,"NM",3,0)
PSJHL4A^^0^B57752880
"BLD",6335,"KRN",9.8,"NM","B","PSGLOI",2)

"BLD",6335,"KRN",9.8,"NM","B","PSJHL4",1)

"BLD",6335,"KRN",9.8,"NM","B","PSJHL4A",3)

"BLD",6335,"KRN",19,0)
19
"BLD",6335,"KRN",19.1,0)
19.1
"BLD",6335,"KRN",101,0)
101
"BLD",6335,"KRN",409.61,0)
409.61
"BLD",6335,"KRN",771,0)
771
"BLD",6335,"KRN",870,0)
870
"BLD",6335,"KRN",8989.51,0)
8989.51
"BLD",6335,"KRN",8989.52,0)
8989.52
"BLD",6335,"KRN",8994,0)
8994
"BLD",6335,"KRN","B",.4,.4)

"BLD",6335,"KRN","B",.401,.401)

"BLD",6335,"KRN","B",.402,.402)

"BLD",6335,"KRN","B",.403,.403)

"BLD",6335,"KRN","B",.5,.5)

"BLD",6335,"KRN","B",.84,.84)

"BLD",6335,"KRN","B",3.6,3.6)

"BLD",6335,"KRN","B",3.8,3.8)

"BLD",6335,"KRN","B",9.2,9.2)

"BLD",6335,"KRN","B",9.8,9.8)

"BLD",6335,"KRN","B",19,19)

"BLD",6335,"KRN","B",19.1,19.1)

"BLD",6335,"KRN","B",101,101)

"BLD",6335,"KRN","B",409.61,409.61)

"BLD",6335,"KRN","B",771,771)

"BLD",6335,"KRN","B",870,870)

"BLD",6335,"KRN","B",8989.51,8989.51)

"BLD",6335,"KRN","B",8989.52,8989.52)

"BLD",6335,"KRN","B",8994,8994)

"BLD",6335,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",6335,"QUES",0)
^9.62^^
"BLD",6335,"REQB",0)
^9.611^3^1
"BLD",6335,"REQB",3,0)
PSJ*5.0*134^2
"BLD",6335,"REQB","B","PSJ*5.0*134",3)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
197^3080807^11882
"PKG",197,22,1,"PAH",1,1,0)
^^20^20^3080807
"PKG",197,22,1,"PAH",1,1,1,0)
This patch resolves two issues in the Inpatient Medications package.
"PKG",197,22,1,"PAH",1,1,2,0)

"PKG",197,22,1,"PAH",1,1,3,0)
1. When stat medications are ordered using Inpatient Medications for
"PKG",197,22,1,"PAH",1,1,4,0)
Outpatients (IMO), the resulting notification email lacked the
"PKG",197,22,1,"PAH",1,1,5,0)
name of the clinic. Ward names were included correctly. Clinic names
"PKG",197,22,1,"PAH",1,1,6,0)
were added. The mail group receiving the notification is PSJ STAT NOW
"PKG",197,22,1,"PAH",1,1,7,0)
ACTIVE or PSJ STAT NOW PENDING.
"PKG",197,22,1,"PAH",1,1,8,0)
 
"PKG",197,22,1,"PAH",1,1,9,0)
The routines PSJHL4 and PSJHL4A were modified to establish a value for CLINIC
"PKG",197,22,1,"PAH",1,1,10,0)
if the location is a clinic, and then set using the same variable as ward.
"PKG",197,22,1,"PAH",1,1,11,0)
 
"PKG",197,22,1,"PAH",1,1,12,0)
2. After the release of Patch PSJ*5*110, MAR labels do include the
"PKG",197,22,1,"PAH",1,1,13,0)
order/renewal date on the left side of the label, which is attached
"PKG",197,22,1,"PAH",1,1,14,0)
to the MAR. It only appears on the right side, which is discarded.
"PKG",197,22,1,"PAH",1,1,15,0)
The date has been placed on left side as well as the right side.
"PKG",197,22,1,"PAH",1,1,16,0)

"PKG",197,22,1,"PAH",1,1,17,0)
Routine PSGLOI was modified to correct this problem. If the order is not
"PKG",197,22,1,"PAH",1,1,18,0)
pending, the order/renewal date is set at the left hand side of the label.
"PKG",197,22,1,"PAH",1,1,19,0)

"PKG",197,22,1,"PAH",1,1,20,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSGLOI")
0^2^B33839638^B33789368
"RTN","PSGLOI",1,0)
PSGLOI ;BIR/CML3 - ORDER INFO (AND PRINT) FOR LABELS ;30 Apr 98 / 4:41 PM
"RTN","PSGLOI",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,44,58,110,111,138,197**;16 DEC 97;Build 3
"RTN","PSGLOI",3,0)
 ;
"RTN","PSGLOI",4,0)
 ;Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGLOI",5,0)
 ;Reference to ^PSD(58.8 is supported by DBIA 2283.
"RTN","PSGLOI",6,0)
 ;Reference to ^PSI(58.1 is supported by DBIA 2284.
"RTN","PSGLOI",7,0)
 ;Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGLOI",8,0)
 ;
"RTN","PSGLOI",9,0)
ENOI ;
"RTN","PSGLOI",10,0)
 S F="^PS("_$S(PSGORD["N":"53.1,",PSGORD["P":"53.1,",1:"55,"_PSGOP_",5,")_+PSGORD_","
"RTN","PSGLOI",11,0)
 ; the quit below corrects an error if the Order has been moved to 55
"RTN","PSGLOI",12,0)
 Q:'$D(@(F_"0)"))
"RTN","PSGLOI",13,0)
 S ND=$G(@(F_"0)")),PSGLPR=$P(ND,"^",2),PSGLMR=$P(ND,"^",3),PSGLST=$P(ND,"^",7),PSGLSTAT=$P(ND,"^",9),PSGLTD=$P(ND,"^",12),PSGLOD=$P(ND,"^",14),PSGLSM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),NG=$P(ND,"^",22)
"RTN","PSGLOI",14,0)
 S ND=$G(@(F_".2)")),PSGLDRG=$P(ND,"^"),PSGLDDA=+ND,PSGLDO=$P(ND,"^",2)
"RTN","PSGLOI",15,0)
 S PSGCLN=$S(F[53.1:$G(@(F_"""DSS"")")),1:$G(@(F_"8)"))) I PSGCLN]"" S PSGLWDN=$P(^SC($P(PSGCLN,"^"),0),"^")
"RTN","PSGLOI",16,0)
 ;
"RTN","PSGLOI",17,0)
SET ;
"RTN","PSGLOI",18,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",19,0)
 K PSGLAT S ND=$G(@(F_"2)")),(PSGLSSD,PSGLSD)=$P(ND,"^",2),(PSGLFFD,PSGLFD)=$P(ND,"^",4),PSGLAT=$P(ND,"^",5),PSGLMN=$P(ND,"^",6),PSGLSCH=$P(ND,"^"),ND=$G(^(7)),PSGLDT=+ND,PSGLR=$P(ND,"^",2)
"RTN","PSGLOI",20,0)
 I PSGLST'="R",PSGLMN="D",PSGLAT="" S PSGLAT=$E($P(PSGLSD,".",2)_"0000",1,4)
"RTN","PSGLOI",21,0)
 I PSGLAT,PSGLSCH["@" S PSGLSCH=$P(PSGLSCH,"@")
"RTN","PSGLOI",22,0)
 S (PSGLAT(0),X)=0 I PSGLFD]"",PSGLFD'>PSGDT S (PSGLAT(0),X)=5,(PSGLAT(1),PSGLAT(2),PSGLAT(4),PSGLAT(5))="****",PSGLAT(3)=$S(PSGLSTAT["D":"DC'D",1:"EX'D")
"RTN","PSGLOI",23,0)
 E  I $S(PSGLSTAT="P":1,PSGLSTAT="U":1,PSGLST="OC":1,PSGLST="P":1,1:PSGLSCH["PRN") S PSGLAT=""
"RTN","PSGLOI",24,0)
 E  I PSGLAT S PSGLAT(0)=$L(PSGLAT,"-"),X=0 D
"RTN","PSGLOI",25,0)
 .F Q=1:1:5 S PSGLAT(Q)=""
"RTN","PSGLOI",26,0)
 .S Q=PSGLAT(0),Y=PSGLAT I Q=1 S PSGLAT(3)=$P(Y,"-") Q
"RTN","PSGLOI",27,0)
 .I Q=2 S PSGLAT(1)=$P(Y,"-"),PSGLAT(5)=$P(Y,"-",2) Q
"RTN","PSGLOI",28,0)
 .I Q=3 S PSGLAT(1)=$P(Y,"-"),PSGLAT(3)=$P(Y,"-",2),PSGLAT(5)=$P(Y,"-",3) Q
"RTN","PSGLOI",29,0)
 .F Q=1:1:PSGLAT(0) S X=X+1,PSGLAT(X)=$P(PSGLAT,"-",Q) I PSGLAT(0)<4 S X=X+1 S:Q<5 PSGLAT(X)=""
"RTN","PSGLOI",30,0)
 I X<5 F Q=X+1:1:5 S:'$G(PSGLAT(Q)) PSGLAT(Q)=""
"RTN","PSGLOI",31,0)
 I $G(DFN),$G(PSGORD) N PSGLREN S PSGLREN=+$$LASTREN^PSJLMPRI(DFN,PSGORD)
"RTN","PSGLOI",32,0)
 S ND=$G(@(F_"4)")),PSGLRN=+ND,PSGLRPH=+$P(ND,"^",3) N PSGLRNDT S PSGLRNDT=$P(ND,"^",2) I PSGLRNDT,$G(PSGLREN) I $G(PSGLREN)>PSGLRNDT S PSGLRN=0
"RTN","PSGLOI",33,0)
 S:+$G(PSGLREN) PSGLREN=$$ENDTC^PSGMI(PSGLREN)
"RTN","PSGLOI",34,0)
 I NG S PSGLSI="*** NOT TO BE GIVEN ***"
"RTN","PSGLOI",35,0)
 E  S PSGLSI=$P($G(@(F_"6)")),"^") S:PSGLSI]"" PSGLSI=$$ENSET^PSGSICHK(PSGLSI)
"RTN","PSGLOI",36,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",37,0)
 I PSGLSI="",$P(@(F_"0)"),U,9)="P",$O(@(F_"12,0)")) S X=0 F  S X=$O(@(F_"12,"_X_")")) Q:'X  S Z=$G(^(X,0)),Y=$L(PSGLSI) S:Y+$L(Z)'>179 PSGLSI=PSGLSI_Z_" " I Y+$L(Z)>179 S PSGLSI="SEE PROVIDER COMMENTS" Q
"RTN","PSGLOI",38,0)
 S PSGLDT=$$ENDTC^PSGMI(PSGLDT),PSGLOD=$E($$ENDTC^PSGMI(PSGLOD),1,5)
"RTN","PSGLOI",39,0)
 I PSGLSTAT="P"!(PSGLSTAT="U") S PSGLSD="           ",PSGLFD="    ",PSGLST=" "
"RTN","PSGLOI",40,0)
 E  S PSGLSD=$$ENDTC1^PSGMI(PSGLSD),PSGLSD=$E(PSGLSD,1,5)_$E(PSGLSD,9,14),PSGLFD=$$ENDTC1^PSGMI(PSGLFD)
"RTN","PSGLOI",41,0)
 S:'PSGLRN PSGLRN="_____" I PSGLRN,$D(^VA(200,+PSGLRN,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRN=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSGLOI",42,0)
 S:'PSGLRPH PSGLRPH="_____" I PSGLRPH,$D(^VA(200,+PSGLRPH,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRPH=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSGLOI",43,0)
 I $P($G(^PS(51.2,+PSGLMR,0)),"^")]"" S PSGLMR=$E($S($P(^(0),"^",3)]"":$P(^(0),"^",3),1:$P(^(0),"^")),1,5)
"RTN","PSGLOI",44,0)
 I $P($G(^VA(200,+PSGLPR,0)),"^")]"" S PSGLPR=$P(^(0),"^")
"RTN","PSGLOI",45,0)
 S Q=32-$L(PSGLDO)-$L(PSGLMR) I $L(PSGLSCH)>Q S PSGLSCH=$E(PSGLSCH,1,Q-3)_"..."
"RTN","PSGLOI",46,0)
 NEW DRUGNAME
"RTN","PSGLOI",47,0)
 D DRGDISP^PSJLMUT1(DFN,$S(PSGORD["A":+PSGORD_"U",PSGORD["U":+PSGORD_"U",1:+PSGORD_"P"),40,34,.DRUGNAME,0)
"RTN","PSGLOI",48,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",49,0)
 N PSGNOW D NOW^%DTC S PSGNOW=% S (PSGLNF,PSGLWS)=0 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X!(PSGLWS)  S Y=$G(^(X,0)) I $P(Y,U,3)>PSGNOW!'$P(Y,U,3) S PSGLWS=$S($D(^PSI(58.1,"D",+Y,+PSGLWD)):1,$D(^PSD(58.8,"D",+Y,+PSGLWD)):1,1:0)
"RTN","PSGLOI",50,0)
 I $D(PSGLSTOP) Q
"RTN","PSGLOI",51,0)
 ;
"RTN","PSGLOI",52,0)
ENP ;
"RTN","PSGLOI",53,0)
 I PSGLSD["     ",+$G(@(F_"4)")) S X="P E N D I N G"
"RTN","PSGLOI",54,0)
 E  S X=$S(+$G(PSGLREN):PSGLREN,1:PSGLSD)_" |"_PSGLFD
"RTN","PSGLOI",55,0)
 W $C(13),?1,PSGLOD," |",X,?36,"(",PSGLBS5,")",?42,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",56,0)
 F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  D
"RTN","PSGLOI",57,0)
 . I X=1 W !?1,DRUGNAME(X),?42,PSGLST,?43,"|",PSGLAT(2),?52,PSGLSSN,?70,PSGLDOB,"  (",PSGLAGE,")",?85,$J($S(PSGLTM]"":PSGLTM,1:"NOT FOUND"),15)
"RTN","PSGLOI",58,0)
 . I X=2 W !?1,DRUGNAME(X),?43,"|",PSGLAT(3),?52,PSGLSEX,?65,"DX: ",PSGLDX
"RTN","PSGLOI",59,0)
 . S L=X+1
"RTN","PSGLOI",60,0)
 . I L=5,PSGLSI]"" W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",61,0)
 . I X>2 W !?1,DRUGNAME(X) D NXTLNE
"RTN","PSGLOI",62,0)
 I L=5,PSGLSI]"" W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",63,0)
 F Y=1:1:$L(PSGLSI," ") S Y1=$P(PSGLSI," ",Y) D
"RTN","PSGLOI",64,0)
 .I $L(Y1)>42 F  Q:$L(Y1)<42  D
"RTN","PSGLOI",65,0)
 ..S LEN=43-$X W $E(Y1,1,LEN) S Y1=$E(Y1,LEN+1,255) D NXTLNE
"RTN","PSGLOI",66,0)
 ..I L#5=0 W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",67,0)
 .I ($X+$L(Y1))>42 D NXTLNE I L#5=0 W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",68,0)
 .W Y1," "
"RTN","PSGLOI",69,0)
 D:PSGLSI]"" NXTLNE
"RTN","PSGLOI",70,0)
 I $D(PSGLAT(L+1)) F  Q:'$D(PSGLAT(L+1))  D
"RTN","PSGLOI",71,0)
 .I L#5=0 W ?1,"See next label for continuation" D NXTLNE W ! Q
"RTN","PSGLOI",72,0)
 .D NXTLNE
"RTN","PSGLOI",73,0)
 I L#5>0 F  Q:L#5=0  D NXTLNE
"RTN","PSGLOI",74,0)
 W $E("WS",1,PSGLWS*2) W:PSGLSM ?4,$E("HSM",PSGLSM,3) W ?8,$E("NF",1,PSGLNF*2),?24,"RPH:",PSGLRPH,?33," RN:",PSGLRN D NXTLNE
"RTN","PSGLOI",75,0)
 W !
"RTN","PSGLOI",76,0)
 Q
"RTN","PSGLOI",77,0)
 ;
"RTN","PSGLOI",78,0)
NXTLNE ; Print info to right of drug
"RTN","PSGLOI",79,0)
 W ?43,"|",$G(PSGLAT(L))
"RTN","PSGLOI",80,0)
 I L=4 D
"RTN","PSGLOI",81,0)
 .N Y S Y=PSGLR W ?52 W:+$G(PSGLREN)!(PSGLSD) $S(+$G(PSGLREN):PSGLREN,1:PSGLSD),?77,$S(Y="NR":"RENEWAL ",Y["N":"NEW ",1:""),"ORDER "
"RTN","PSGLOI",82,0)
 .W $S(Y="E":"EDITED",Y="DE":"DC'ED (EDIT)",Y["D":"DISCONTINUED",Y="NE":"(EDIT)",PSGLR="H1":"ON HOLD",PSGLR="H0":"OFF OF HOLD",PSGLR="RE":"REINSTATED",1:"")
"RTN","PSGLOI",83,0)
 .I PSGLFFD]"",PSGLFFD'>PSGDT,PSGLR'["D" W " (EXPIRED)"
"RTN","PSGLOI",84,0)
 W:L=5 ?52,$S(PSGLWGN]"":$E(PSGLWGN,1,21),1:"NOT FOUND"),?79,$J($S(PSGLWDN]"":$E(PSGLWDN,1,21),1:"NOT FOUND"),21)
"RTN","PSGLOI",85,0)
 W !,?1 S L=L+1
"RTN","PSGLOI",86,0)
 Q
"RTN","PSGLOI",87,0)
ENKV ;*** Kill var created from this routine
"RTN","PSGLOI",88,0)
 K PSGDT,PSGLAGE,PSGLAT,PSGLBS5,PSGLDDA,PSGLDO,PSGLDOB,PSGLDRG,PSGLDT,PSGLDX,PSGLFD,PSGLFFD,PSGLMN,PSGLMR,PSGLNF,PSGLOD,PSGLPN
"RTN","PSGLOI",89,0)
 K PSGLPR,PSGLR,PSGLRB,PSGLRN,PSGLRPH,PSGLSCH,PSGLSD,PSGLSEX,PSGLSI,PSGLSM,PSGLSSD,PSGLSSN,PSGLST
"RTN","PSGLOI",90,0)
 K PSGLSTAT,PSGLSTOP,PSGLTD,PSGLTM,PSGLWD,PSGLWDN,PSGLWGN,PSGLWS,PSGNOW,PSGOP,PSGORD
"RTN","PSGLOI",91,0)
 Q
"RTN","PSJHL4")
0^1^B74448907^B72457593
"RTN","PSJHL4",1,0)
PSJHL4 ;BIR/RLW-DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,12,27,34,40,42,55,47,50,56,58,98,85,105,107,110,111,154,134,197**;16 DEC 97;Build 3
"RTN","PSJHL4",3,0)
 ; Reference to $$EN^PSOHLNEW is supported by DBIA# 2188.
"RTN","PSJHL4",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJHL4",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJHL4",6,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJHL4",7,0)
 ; Reference to ^PS(59.7 supported by DBIA 2181.
"RTN","PSJHL4",8,0)
 ; Reference to ^ORHLESC is supported by DBIA 4922.
"RTN","PSJHL4",9,0)
 ; 
"RTN","PSJHL4",10,0)
EN(PSJMSG) ; Start
"RTN","PSJHL4",11,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",12,0)
 N ADCNT,SOLCNT,OCCNT
"RTN","PSJHL4",13,0)
 N ACKDATE,ADDITIVE,ADMINSTR,APPL,COMMENT,PSJHLDFN,DISPENSE,DOSE,DURATION,II,INSTR,J,JJ,JJJ,K,LOGIN,NEWORDER,NURSEACK,OBXFL,OCNARR,OCPROV,OCRSN,ORDER,PRIORITY,PSITEM,ORDCON,PROCOM,PSJORDER,PSREASON
"RTN","PSJHL4",14,0)
 N LOC,PROVIDER,PSPR,PSOC,PTR,QQ,REQST,ROUTE,RXON,RXORDER,SCHEDULE,SEGMENT,SOLUTION,STPDT,STRENGTH,TEXT,CLERK,INFRT,IVTYP,SCHTYP,PREON,NOO,ROC,FREQ,CLASS,PSJHLMTN,UNIT,UNITS,QFLG,VOLUME,TVOLUME,PSGP
"RTN","PSJHL4",15,0)
 N PSJASTP,FLDATE,FLCMNT,PSJFLAG,PSJYN,PRNTON,APPT,IVLIMIT,IVCAT,INTRMT
"RTN","PSJHL4",16,0)
 S (ADCNT,SOLCNT,OCCNT,II,TVOLUME)="",(OBXFL,QFLG)=0,PSJHLMTN="ORR" F  S II=$O(PSJMSG(II)) Q:'II  D DECODE Q:QFLG  D @FIELD(0) Q:$G(CLASS)="O"  Q:QFLG
"RTN","PSJHL4",17,0)
 I ($G(CLASS)'="I")!(QFLG) G END
"RTN","PSJHL4",18,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") N DIK,DA S DIK="^PS(53.1,",DA=NEWORDER D EN1^DIK L -^PS(53.1,NEWORDER)
"RTN","PSJHL4",19,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") D EN1^PSJHL2(PSJHLDFN,$S(PSOC="NW":"OK",1:"XR"),NEWORDER_"P")
"RTN","PSJHL4",20,0)
END ;
"RTN","PSJHL4",21,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",22,0)
 I (",S,A,")[(","_$G(PRIORITY)_",")!($G(SCHEDULE)="NOW")!($G(SCHEDULE)["STAT") D
"RTN","PSJHL4",23,0)
 . I $G(PRIORITY)="ZD",$G(PSGORD) D NOTIFY(PSGORD_$S(PSGORD["V":"V",PSGORD["U":"U",1:""),PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",24,0)
 . I $G(NEWORDER) D NOTIFY(NEWORDER_"P",PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",25,0)
 Q
"RTN","PSJHL4",26,0)
DECODE ; Parse into fields 
"RTN","PSJHL4",27,0)
 K FIELD
"RTN","PSJHL4",28,0)
 N PSJCTR1 S PSJCTR1=""
"RTN","PSJHL4",29,0)
 S SEGMENT=$G(PSJMSG(II))
"RTN","PSJHL4",30,0)
 I $D(PSJMSG(II,1)),$P(SEGMENT,"|",1)="ORC" F  S PSJCTR1=$O(PSJMSG(II,PSJCTR1)) Q:PSJCTR1=""  D
"RTN","PSJHL4",31,0)
 . S SEGMENT=SEGMENT_PSJMSG(II,PSJCTR1)  ;Handle CPRS "overflow" ORC nodes
"RTN","PSJHL4",32,0)
 S J=0
"RTN","PSJHL4",33,0)
 F  Q:$G(SEGMENT)=""  D
"RTN","PSJHL4",34,0)
 .I SEGMENT["|" S FIELD(J)=$P(SEGMENT,"|"),SEGMENT=$E(SEGMENT,$L(FIELD(J))+2,$L(SEGMENT)),J=J+1 Q
"RTN","PSJHL4",35,0)
 .I SEGMENT'["|" S FIELD(J)=SEGMENT,SEGMENT="" Q
"RTN","PSJHL4",36,0)
 K PSJCTR1
"RTN","PSJHL4",37,0)
 Q
"RTN","PSJHL4",38,0)
NOTIFY(ORDER,PSJHLDFN,PRIO,PSJSCHED) ; Send msg
"RTN","PSJHL4",39,0)
 N NTFYREAS,WARD,MGROUP,NTFSTAT,DRUG,DRIEN,PNAME,ORDATE,DO,PSG,XMY,VADPT,LASTFOUR,PSJSOK,CLINIC
"RTN","PSJHL4",40,0)
 Q:($G(PRIO)=""&($G(PSJSCHED)=""))
"RTN","PSJHL4",41,0)
 S DFN=PSJHLDFN D DEM^VADPT S LASTFOUR=$P($P(VADM(2),"^",2),"-",3)
"RTN","PSJHL4",42,0)
 S NTFYREAS=$S((",S,A,")[(","_PRIO_","):1,($G(PSJSCHED)="NOW"):2,($G(PSJSCHED)="STAT"):3,1:0) Q:'NTFYREAS
"RTN","PSJHL4",43,0)
 S PSJSOK=1
"RTN","PSJHL4",44,0)
 I ORDER["P" D PND
"RTN","PSJHL4",45,0)
 I ORDER["U" D UD
"RTN","PSJHL4",46,0)
 I ORDER["V" D IV
"RTN","PSJHL4",47,0)
 Q:PSJSOK=1
"RTN","PSJHL4",48,0)
 D XMD^PSJHL4A
"RTN","PSJHL4",49,0)
 Q
"RTN","PSJHL4",50,0)
PND ; Pending
"RTN","PSJHL4",51,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",52,0)
 Q:'$D(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",53,0)
 S CLINIC=$P($G(^PS(53.1,+ORDER,"DSS")),"^",1)
"RTN","PSJHL4",54,0)
 S WARD=$G(^DPT(PSJHLDFN,.1)) I WARD]"" D
"RTN","PSJHL4",55,0)
 .N DIC,X,Y S DIC="^DIC(42,",DIC(0)="BOXZ",X=WARD D ^DIC S WARD=+Y Q:WARD=0
"RTN","PSJHL4",56,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",57,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",58,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",59,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",60,0)
 S:'$$SNDTSTP^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW PENDING ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",61,0)
 S NTFSTAT="PENDING"
"RTN","PSJHL4",62,0)
 N NDP2,ND0 S NDP2=$G(^PS(53.1,+ORDER,.2)),ND0=$G(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",63,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",64,0)
 S SCHED=$P($G(^PS(53.1,+ORDER,2)),"^")
"RTN","PSJHL4",65,0)
 Q
"RTN","PSJHL4",66,0)
UD ; UD
"RTN","PSJHL4",67,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",68,0)
 Q:'$D(^PS(55,PSJHLDFN,5,+ORDER,0))
"RTN","PSJHL4",69,0)
 S CLINIC=$P($G(^PS(55,PSJHLDFN,5,+ORDER,8)),"^",1)
"RTN","PSJHL4",70,0)
 S WARD=$P($G(^PS(55,PSJHLDFN,5,+ORDER,0)),"^",23) I +WARD D
"RTN","PSJHL4",71,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",72,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",73,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",74,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",75,0)
 S:'$$SNDTSTA^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",76,0)
 S NTFSTAT="ACTIVE"
"RTN","PSJHL4",77,0)
 N ND2,ND0 S ND0=$G(^PS(55,PSJHLDFN,5,+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,5,+ORDER,2)),NDP2=$G(^PS(55,PSJHLDFN,5,+ORDER,.2))
"RTN","PSJHL4",78,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",79,0)
 S SCHED=$P(ND2,"^")
"RTN","PSJHL4",80,0)
 Q
"RTN","PSJHL4",81,0)
IV ; IV
"RTN","PSJHL4",82,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",83,0)
 Q:'$D(^PS(55,PSJHLDFN,"IV",+ORDER,0))
"RTN","PSJHL4",84,0)
 S CLINIC=$P($G(^PS(55,PSJHLDFN,"IV",+ORDER,"DSS")),"^",1)
"RTN","PSJHL4",85,0)
 S WARD=$P($G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),"^",22) I +WARD D
"RTN","PSJHL4",86,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",87,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",88,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",89,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",90,0)
 S:'$$SNDTSTA^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",91,0)
 S NTFSTAT="ACTIVE"
"RTN","PSJHL4",92,0)
 N ND2,NDP2,ND0 S ND0=$G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,2))
"RTN","PSJHL4",93,0)
 S NDP2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,.2))
"RTN","PSJHL4",94,0)
 S DRIEN=$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(NDP2,"^",3)
"RTN","PSJHL4",95,0)
 S ORDATE=$P(ND2,"^"),SCHED=$P(ND0,"^",9)
"RTN","PSJHL4",96,0)
 Q
"RTN","PSJHL4",97,0)
MSH ; Header
"RTN","PSJHL4",98,0)
 S PSOC=FIELD(8)
"RTN","PSJHL4",99,0)
 Q
"RTN","PSJHL4",100,0)
PID ; ID
"RTN","PSJHL4",101,0)
 S PSJHLDFN=$$UNESC^ORHLESC(FIELD(3))
"RTN","PSJHL4",102,0)
 Q
"RTN","PSJHL4",103,0)
PV1 ; Visit
"RTN","PSJHL4",104,0)
 N A
"RTN","PSJHL4",105,0)
 S CLASS=FIELD(2),LOC=$P(FIELD(3),"^"),APPT="" I $G(FIELD(44))]"" S APPT=+$$HL7TFM^XLFDT(FIELD(44))
"RTN","PSJHL4",106,0)
 I "IO"'[CLASS S PSREASON="Invalid patient class" Q
"RTN","PSJHL4",107,0)
 N QQ K PSJNVA S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  D  Q:$G(PSJNVA)
"RTN","PSJHL4",108,0)
 .S X=$G(PSJMSG(QQ))
"RTN","PSJHL4",109,0)
 .I $P(X,"|")="ZRN" S PSJNVA=1,CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",110,0)
 I $G(PSJNVA) K PSJNVA Q
"RTN","PSJHL4",111,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="OBR" D  Q:$P(PSJMSG(QQ),"|")="OBR"
"RTN","PSJHL4",112,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",113,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="ORC" D  Q:$P(PSJMSG(QQ),"|")="ORC"
"RTN","PSJHL4",114,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",115,0)
 I CLASS="O" N CHK,QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="RXO" D  Q:$P(PSJMSG(QQ),"|")="RXO"
"RTN","PSJHL4",116,0)
 .S CHK=$P(PSJMSG(QQ),"|",2),CHK=$S($P(CHK,"^",5)="IV":"IV",1:$P(CHK,"^",4))
"RTN","PSJHL4",117,0)
 .I CHK="IV" S CLASS="I" Q
"RTN","PSJHL4",118,0)
 .I 'CHK S PSREASON="Missing or Invalid Orderable Item",CLASS="I" Q
"RTN","PSJHL4",119,0)
 .I $P($G(^PS(50.7,CHK,0)),"^",3)=1 S CLASS="I" Q
"RTN","PSJHL4",120,0)
 D:CLASS="O" EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",121,0)
 Q
"RTN","PSJHL4",122,0)
ORC ; Order
"RTN","PSJHL4",123,0)
 S TMPAT=""
"RTN","PSJHL4",124,0)
 S PSOC=FIELD(1)
"RTN","PSJHL4",125,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",126,0)
 I $G(PSREASON)]"" D ERROR^PSJHL9 Q
"RTN","PSJHL4",127,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",128,0)
 I PSOC="NA" D ASSIGN^PSJHL5 Q
"RTN","PSJHL4",129,0)
 S CLERK=+$G(FIELD(10))
"RTN","PSJHL4",130,0)
 S PROVIDER=+$G(FIELD(12)) D:PSOC="NW"
"RTN","PSJHL4",131,0)
 .I PROVIDER=0 S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q 
"RTN","PSJHL4",132,0)
 .I PROVIDER>0 S PSPR=$G(^VA(200,+PROVIDER,"PS")) I '$D(PSPR)!'(PSPR)!$S($P(PSPR,"^",4)="":0,1:$P(PSPR,"^",4)'>DT) S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q
"RTN","PSJHL4",133,0)
 S UNITS=$P(FIELD(7),"^"),INSTR=$$UNESC^ORHLESC($P(FIELD(7),"^",8))
"RTN","PSJHL4",134,0)
 S:UNITS["&" DOSE=$P(UNITS,"&"),UNIT=$P(UNITS,"&",2),UNITS=$P(UNITS,"&",3) S:UNITS]"" UNITS=$$UNESC^ORHLESC(UNITS) S:$G(DOSE)]"" DOSE=$$UNESC^ORHLESC(DOSE)
"RTN","PSJHL4",135,0)
 S SCHEDULE=$P(FIELD(7),"^",2),PRIORITY=$P(FIELD(7),"^",6) S:SCHEDULE["PRN" SCHTYP="P"
"RTN","PSJHL4",136,0)
 I SCHEDULE["&" S ADMINS=$P(SCHEDULE,"&",2),SCHEDULE=$P(SCHEDULE,"&") S ADMINS=$TR(ADMINS," ","") S ADMINS=$S(ADMINS:ADMINS,1:"")
"RTN","PSJHL4",137,0)
 S SCHEDULE=$$UNESC^ORHLESC(SCHEDULE)
"RTN","PSJHL4",138,0)
 I SCHEDULE["@" S TMPAT=$$TMPAT^PSJHL4A(SCHEDULE)
"RTN","PSJHL4",139,0)
 I $G(TMPAT) S $P(SCHEDULE,"@",2)=TMPAT,ADMINS=TMPAT
"RTN","PSJHL4",140,0)
 S DURATION=$P(FIELD(7),"^",3),REQST=$P(FIELD(7),"^",4) S:REQST'="" REQST=+$E(+$$HL7TFM^XLFDT(REQST),1,12) S REQST=$$DATE2^PSJUTL2(REQST)
"RTN","PSJHL4",141,0)
 S PRIORITY=$S($G(PRIORITY)]"":PRIORITY,1:"R")
"RTN","PSJHL4",142,0)
 I $E(SCHEDULE,1)=" " S:$TR(SCHEDULE," ")="PRN" SCHEDULE="PRN" I '(SCHEDULE="PRN")  S PSREASON="Invalid Schedule" D ERROR^PSJHL9 Q
"RTN","PSJHL4",143,0)
 S SCHTYP=$P(FIELD(7),"^",7)
"RTN","PSJHL4",144,0)
 I $G(SCHTYP)="D" S SCHTYP="C"  ;Makes CPRS Day of Week consistent in behavior with backdoor order of Day of Week
"RTN","PSJHL4",145,0)
 S PRNTON=$P(FIELD(8),"^")
"RTN","PSJHL4",146,0)
 S NURSEACK=$G(FIELD(11))
"RTN","PSJHL4",147,0)
 S LOGIN=$G(FIELD(15)) S:LOGIN'="" LOGIN=+$E(+$$HL7TFM^XLFDT(FIELD(15)),1,12) S LOGIN=$$DATE2^PSJUTL2(LOGIN)
"RTN","PSJHL4",148,0)
 S:$G(NURSEACK)]"" ACKDATE=LOGIN
"RTN","PSJHL4",149,0)
 S ORDCON=$P($G(FIELD(16)),U) I ORDCON="A" S PSJASTP=$G(FIELD(9)) S:$G(PSJASTP)'="" PSJASTP=+$E(+$$HL7TFM^XLFDT(PSJASTP),1,12) S PSJASTP=$$DATE2^PSJUTL2(PSJASTP)
"RTN","PSJHL4",150,0)
 I (PSOC="CA")!(PSOC="DC") D CANCEL^PSJHL6 Q
"RTN","PSJHL4",151,0)
 I PSOC="HD" D HOLD^PSJHL6 Q
"RTN","PSJHL4",152,0)
 I PSOC="RL" D UNHOLD^PSJHL6 Q
"RTN","PSJHL4",153,0)
 I PSOC="ZV" D NURSEACK^PSJHL5 Q
"RTN","PSJHL4",154,0)
 I PSOC="SS" D STATUS^PSJHL5 Q
"RTN","PSJHL4",155,0)
 I PSOC="Z@" N X S X="PSJHL8" X ^%ZOSF("TEST") I  D PURGE^PSJHL8 Q
"RTN","PSJHL4",156,0)
 I PSOC="DE" S QFLG=1 Q
"RTN","PSJHL4",157,0)
 Q
"RTN","PSJHL4",158,0)
OBR ; Flagging from CPRS.
"RTN","PSJHL4",159,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",160,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",161,0)
 S PSJFLAG=FIELD(4)
"RTN","PSJHL4",162,0)
 S FLDATE=$G(FIELD(7)) S:FLDATE'="" FLDATE=+$E(+$$HL7TFM^XLFDT(FIELD(7)),1,12) S FLDATE=$$DATE2^PSJUTL2(FLDATE)
"RTN","PSJHL4",163,0)
 S CLERK=+$G(FIELD(16))
"RTN","PSJHL4",164,0)
 S PSJYN=$G(FIELD(24))
"RTN","PSJHL4",165,0)
 S FLCMNT=$$UNESC^ORHLESC($G(FIELD(13)))
"RTN","PSJHL4",166,0)
 I PSOC="ORU" D FLAG^PSJHL5
"RTN","PSJHL4",167,0)
 Q
"RTN","PSJHL4",168,0)
RXC ; IV 
"RTN","PSJHL4",169,0)
 D RXC^PSJHL4A
"RTN","PSJHL4",170,0)
 Q
"RTN","PSJHL4",171,0)
RXO ; OP
"RTN","PSJHL4",172,0)
 D RXO^PSJHL4A
"RTN","PSJHL4",173,0)
 Q
"RTN","PSJHL4",174,0)
RXR ; Route
"RTN","PSJHL4",175,0)
 S ROUTE=$P(FIELD(1),"^",4)
"RTN","PSJHL4",176,0)
 Q
"RTN","PSJHL4",177,0)
OBX ; Obs.
"RTN","PSJHL4",178,0)
 D OBX^PSJHL4A
"RTN","PSJHL4",179,0)
 Q
"RTN","PSJHL4",180,0)
NTE ; Note
"RTN","PSJHL4",181,0)
 D NTE^PSJHL4A
"RTN","PSJHL4",182,0)
 Q
"RTN","PSJHL4",183,0)
ZRX ; Custom
"RTN","PSJHL4",184,0)
 D ZRX^PSJHL4A
"RTN","PSJHL4",185,0)
 Q
"RTN","PSJHL4",186,0)
ZSC ;Service Connected - Not Used
"RTN","PSJHL4",187,0)
 Q
"RTN","PSJHL4",188,0)
ZRN ;Non-VA Med (Herbal/OTC)
"RTN","PSJHL4",189,0)
 S CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",190,0)
 Q
"RTN","PSJHL4",191,0)
DG1 ;Billing Awareness - Not used
"RTN","PSJHL4",192,0)
 Q
"RTN","PSJHL4A")
0^3^B57752880^B56736588
"RTN","PSJHL4A",1,0)
PSJHL4A ;BIR/RLW-CONTINUE DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4A",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**105,111,154,170,159,134,197**;16 DEC 97;Build 3
"RTN","PSJHL4A",3,0)
 ;
"RTN","PSJHL4A",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL4A",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL4A",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL4A",7,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSJHL4A",8,0)
 ; Reference to ^ORHLESC is supported by DBIA# 4922.
"RTN","PSJHL4A",9,0)
 ; Reference to ^SC( is supported by DBIA# 10040.
"RTN","PSJHL4A",10,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJHL4A",11,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJHL4A",12,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJHL4A",13,0)
 ;
"RTN","PSJHL4A",14,0)
RXC ; IV order
"RTN","PSJHL4A",15,0)
 N IVFL
"RTN","PSJHL4A",16,0)
 S APPL=FIELD(1)
"RTN","PSJHL4A",17,0)
 I APPL["B" S SOLCNT=SOLCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S VOLUME=+FIELD(3)_" ML" D  I '$D(^TMP("PSJNVO",$J,"SOL",SOLCNT,0)) D SOLSRCH
"RTN","PSJHL4A",18,0)
 .S SOLUTION="" F  S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) Q:'SOLUTION  S INACT=$G(^PS(52.7,SOLUTION,"I")) I 'INACT!(INACT>DT) I VOLUME=$P(^PS(52.7,SOLUTION,0),U,3) D
"RTN","PSJHL4A",19,0)
 ..S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",20,0)
 ..S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL4A",21,0)
 I $G(INFRT)]"" S X=INFRT D ENI^PSJHLU S INFRT=$G(X)
"RTN","PSJHL4A",22,0)
 I APPL="A" S ADCNT=ADCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S STRENGTH=$G(FIELD(3))_" "_$P($G(FIELD(4)),"^",5) D  I '$D(^TMP("PSJNVO",$J,"AD",ADCNT,0)) S PSREASON="Can't find matching additive" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",23,0)
 .S ADDITIVE="" F  S ADDITIVE=$O(^PS(52.6,"AOI",PTR,ADDITIVE)) Q:'ADDITIVE  S INACT=$G(^PS(52.6,ADDITIVE,"I")),IVFL=$P($G(^(0)),"^",13) I 'INACT!(INACT>DT),IVFL'=0 Q:$G(^PS(52.6,ADDITIVE,0))']""  D  Q:ADDITIVE
"RTN","PSJHL4A",24,0)
 ..I $G(PSITEM)="" S PSITEM=PTR
"RTN","PSJHL4A",25,0)
 ..S ^TMP("PSJNVO",$J,"AD",0)=ADCNT
"RTN","PSJHL4A",26,0)
 ..S ^TMP("PSJNVO",$J,"AD",ADCNT,0)=ADDITIVE_"^"_STRENGTH
"RTN","PSJHL4A",27,0)
 Q
"RTN","PSJHL4A",28,0)
 ;
"RTN","PSJHL4A",29,0)
RXO ;
"RTN","PSJHL4A",30,0)
 I $O(PSJMSG(II,0)) D
"RTN","PSJHL4A",31,0)
 .K SEGMENT
"RTN","PSJHL4A",32,0)
 .N KK,JJ,XX
"RTN","PSJHL4A",33,0)
 .S SEGMENT(1)=$G(PSJMSG(II))
"RTN","PSJHL4A",34,0)
 .S KK=1,JJ="" F  S JJ=$O(PSJMSG(II,JJ)) Q:'JJ  S KK=KK+1,SEGMENT(KK)=$G(PSJMSG(II,JJ))
"RTN","PSJHL4A",35,0)
 .S KK=1,JJ=0
"RTN","PSJHL4A",36,0)
 .F  Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",37,0)
 ..I SEGMENT(KK)["|" S FIELD(JJ)=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(FIELD(JJ))+2,$L(SEGMENT(KK))),JJ=JJ+1 Q
"RTN","PSJHL4A",38,0)
 ..I SEGMENT(KK)'["|" S FIELD(JJ)=SEGMENT(KK),KK=KK+1 Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",39,0)
 ...S XX=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(X)+2,$L(SEGMENT(KK))),FIELD(JJ)=FIELD(JJ)_XX,JJ=JJ+1
"RTN","PSJHL4A",40,0)
 S APPL="",PSITEM=$S($P(FIELD(1),"^",5)="IV":"",1:$P(FIELD(1),"^",4))
"RTN","PSJHL4A",41,0)
 S:$P(FIELD(1),"^",6)="ORD" PSITEM=""
"RTN","PSJHL4A",42,0)
 S:$P(FIELD(1),"^",5)="IV" IVTYP="A",SCHTYP="C",INFRT=$G(FIELD(2))
"RTN","PSJHL4A",43,0)
 S DISPENSE=$P($G(FIELD(10)),"^",4)
"RTN","PSJHL4A",44,0)
 S IVLIMIT=$P($G(PSJMSG(II)),"^",3)
"RTN","PSJHL4A",45,0)
 S:IVLIMIT["doses" IVLIMIT=$TR(IVLIMIT,"doses","a")
"RTN","PSJHL4A",46,0)
 Q
"RTN","PSJHL4A",47,0)
 ;
"RTN","PSJHL4A",48,0)
OBX ;
"RTN","PSJHL4A",49,0)
 S OBXFL=1,OCNARR=FIELD(5),OCPROV=CLERK,OCCNT=OCCNT+1
"RTN","PSJHL4A",50,0)
 S ^TMP("PSJNVO",$J,10,0)=OCCNT
"RTN","PSJHL4A",51,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,0)=OCNARR
"RTN","PSJHL4A",52,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,1)=$$UNESC^ORHLESC($P($G(^VA(200,+OCPROV,0)),"^"))
"RTN","PSJHL4A",53,0)
 Q
"RTN","PSJHL4A",54,0)
 ;
"RTN","PSJHL4A",55,0)
NTE ;
"RTN","PSJHL4A",56,0)
 S TEXT=$S((FIELD(1)=6)&('OBXFL):"PROCOM",(FIELD(1)=7)&('OBXFL):"ADMINSTR",1:"OCRSN")
"RTN","PSJHL4A",57,0)
 S @TEXT@(1)=$$UNESC^ORHLESC($G(FIELD(3)))
"RTN","PSJHL4A",58,0)
 S K=1,J="" F  S J=$O(PSJMSG(II,J)) Q:'J  S K=K+1,@TEXT@(K)=$G(PSJMSG(II,J))
"RTN","PSJHL4A",59,0)
 D:$D(OCRSN)
"RTN","PSJHL4A",60,0)
 .S QQ=0 F  S QQ=$O(OCRSN(QQ)) Q:'QQ  S ^TMP("PSJNVO",$J,10,OCCNT,2,QQ,0)=OCRSN(QQ)
"RTN","PSJHL4A",61,0)
 S OBXFL=0
"RTN","PSJHL4A",62,0)
 Q
"RTN","PSJHL4A",63,0)
 ;
"RTN","PSJHL4A",64,0)
ZRX ;
"RTN","PSJHL4A",65,0)
 N ND,ND2,CHK,FOLOR,STDT
"RTN","PSJHL4A",66,0)
 S PREON=$G(FIELD(1)),ROC=$G(FIELD(3)),IVCAT=$G(FIELD(6))
"RTN","PSJHL4A",67,0)
 S IVCAT=$S(",I,C,"[(","_IVCAT_","):IVCAT,1:"") I 'PREON S IVTYP=$S($G(PSGS0XT):"P",1:"A") S IVTYP=$S(IVCAT="I":"P",IVCAT="C":"A",1:$G(IVTYP))
"RTN","PSJHL4A",68,0)
 S ND=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,0)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,0)),1:$G(^PS(55,PSJHLDFN,5,+PREON,0)))
"RTN","PSJHL4A",69,0)
 S ND2=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,2)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),1:$G(^PS(55,PSJHLDFN,5,+PREON,2)))
"RTN","PSJHL4A",70,0)
 I 'ND I ROC'="N" S PSREASON="Invalid Pharmacy order number" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",71,0)
 I ND I ROC="R" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Duplicate Renewal Request" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",72,0)
 I ND I ROC="R" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "AE"'[CHK S PSREASON="Pharmacy orders with a status of "_CHK_" may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",73,0)
 I $G(CHK)="E" I PREON'["V" D NOW^%DTC S X1=+$E(%,1,12),X2=-4 D C^%DTC S STDT=$S(PREON["V":$P(ND,U,3),1:$P(ND2,U,4)) I STDT'>X S PSREASON="Pharmacy orders expired longer than 4 days may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",74,0)
 I ND I ROC="E" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Pharmacy orders may only be edited ONCE" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",75,0)
 I ND I ROC="E" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "DEHO"[CHK N CHKRTN S CHKRTN=CHK_"^PSJHL6" D @CHKRTN S PSREASON=PSREASON_" orders may not be edited" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",76,0)
 D:ROC'="R" VALID^PSJHL9 Q:QFLG
"RTN","PSJHL4A",77,0)
 I $G(PSITEM)="",$D(^TMP("PSJNVO",$J,"SOL",1,0)) S PSITEM=$P($G(^PS(52.7,+^TMP("PSJNVO",$J,"SOL",1,0),0)),"^",11)
"RTN","PSJHL4A",78,0)
 I PRIORITY="ZD" D VALID^PSJHL10 S QFLG=1 Q
"RTN","PSJHL4A",79,0)
 I (PREON]"")&(ROC="E") D EDITCK^PSJHL5 Q:QFLG
"RTN","PSJHL4A",80,0)
 D NVO^PSJHL9
"RTN","PSJHL4A",81,0)
 I (PREON]"")&(ROC="R") D RENEW^PSJHL7 Q
"RTN","PSJHL4A",82,0)
 I (PREON]"")&(ROC="E") D EDIT^PSJHL5
"RTN","PSJHL4A",83,0)
 Q
"RTN","PSJHL4A",84,0)
 ;
"RTN","PSJHL4A",85,0)
SOLSRCH ;Find solution
"RTN","PSJHL4A",86,0)
 N SSSS,SEG,ON,ROC,SOL,SOL2
"RTN","PSJHL4A",87,0)
 F SSSS=II:0 S SSSS=$O(PSJMSG(SSSS)) Q:'SSSS  I $P(PSJMSG(SSSS),"|")="ZRX" D  Q
"RTN","PSJHL4A",88,0)
 .S SEG=$G(PSJMSG(SSSS)),ON=$P(SEG,"|",2),ROC=$P(SEG,"|",4)
"RTN","PSJHL4A",89,0)
 I $G(ROC)'="N" F SOL=0:0 S SOL=$O(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL)) Q:'SOL  S SOL2=$G(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL,0)) I $D(^PS(52.7,"AOI",PTR,+SOL2))&($P(SOL2,U,2)=VOLUME) S SOLUTION=+SOL2 D SET Q
"RTN","PSJHL4A",90,0)
 I 'SOLUTION S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) D SET
"RTN","PSJHL4A",91,0)
 Q
"RTN","PSJHL4A",92,0)
SET ;Set solution tmp nodes
"RTN","PSJHL4A",93,0)
 Q:'+SOLUTION
"RTN","PSJHL4A",94,0)
 S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",95,0)
 S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL4A",96,0)
 Q
"RTN","PSJHL4A",97,0)
 ;
"RTN","PSJHL4A",98,0)
SNDTSTW(PRIO,PSJSCHED,WARD) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",99,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",100,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",101,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",102,0)
 S SNOPT=$P($G(^PS(59.6,WARD,0)),"^",32)
"RTN","PSJHL4A",103,0)
 S:SNOPT="" SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",104,0)
 Q:SNOPT="" 0
"RTN","PSJHL4A",105,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",106,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",107,0)
 Q 1
"RTN","PSJHL4A",108,0)
 ;
"RTN","PSJHL4A",109,0)
SNDTSTP(PRIO,PSJSCHED) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",110,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",111,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",112,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",113,0)
 S SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",114,0)
 Q:SNOPT="" 1
"RTN","PSJHL4A",115,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",116,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",117,0)
 Q 1
"RTN","PSJHL4A",118,0)
 ;
"RTN","PSJHL4A",119,0)
SNDTSTA(PRIO,PSJSCHED) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",120,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",121,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",122,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",123,0)
 S SNOPT=$P($G(^PS(59.7,1,27)),"^",2)
"RTN","PSJHL4A",124,0)
 S:SNOPT="" SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",125,0)
 Q:SNOPT="" 1
"RTN","PSJHL4A",126,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",127,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",128,0)
 Q 1
"RTN","PSJHL4A",129,0)
 ;
"RTN","PSJHL4A",130,0)
TMPAT(SCHEDULE) ; Extract admin times from schedule in format schedule@schedule
"RTN","PSJHL4A",131,0)
 S TMPAT="" I SCHEDULE'["@" Q TMPAT
"RTN","PSJHL4A",132,0)
 S TMPAT=$P(SCHEDULE,"@",2) I TMPAT]"" D
"RTN","PSJHL4A",133,0)
 .N WARD S WARD=$G(^DPT(PSJHLDFN,.1)) I WARD]"" D
"RTN","PSJHL4A",134,0)
 ..N DIC,X,Y S DIC="^DIC(42,",DIC(0)="BOXZ",X=WARD D ^DIC S WARD=+Y Q:WARD=0
"RTN","PSJHL4A",135,0)
 ..S WARD=$O(^PS(59.6,"B",WARD,0))
"RTN","PSJHL4A",136,0)
 .I '$D(^PS(51.1,"AC","PSJ",TMPAT)) S TMPAT="" Q
"RTN","PSJHL4A",137,0)
 .N II I '$$DOW^PSIVUTL($P(SCHEDULE,"@")) S TMPAT="" Q
"RTN","PSJHL4A",138,0)
 .N TMPIEN S TMPIEN=$O(^PS(51.1,"AC","PSJ",TMPAT,0)),TMPAT=$P($G(^PS(51.1,+TMPIEN,0)),"^",2) D
"RTN","PSJHL4A",139,0)
 ..I $P($G(^PS(51.1,+TMPIEN,1,+$G(WARD),0)),"^",2) S TMPAT=$P($G(^(0)),"^",2)
"RTN","PSJHL4A",140,0)
 Q TMPAT
"RTN","PSJHL4A",141,0)
 ;
"RTN","PSJHL4A",142,0)
XMD ; Mailman call for NOTIFY^PSJHL4
"RTN","PSJHL4A",143,0)
 ; Input - PNAME  = Patient Name
"RTN","PSJHL4A",144,0)
 ;         RTE    = Route
"RTN","PSJHL4A",145,0)
 ;         DRUG   = Drug Name
"RTN","PSJHL4A",146,0)
 ;         WARD   = Ward Name
"RTN","PSJHL4A",147,0)
 ;         CLINIC = Clinic Location Name
"RTN","PSJHL4A",148,0)
 ;         PRIO   = CPRS Order Priority
"RTN","PSJHL4A",149,0)
 S PNAME=$P($G(^DPT(+PSJHLDFN,0)),"^") S:$G(RTE) RTE=$P(^PS(51.2,+RTE,0),"^",3)
"RTN","PSJHL4A",150,0)
 S DRUG=$S(DRIEN:$P($G(^PS(50.7,+DRIEN,0)),"^"),1:""),WARD=$G(^DPT(PSJHLDFN,.1))
"RTN","PSJHL4A",151,0)
 I $G(CLINIC)'="" S CLINIC=$P($G(^SC(CLINIC,0)),"^",2) I CLINIC'="" S WARD=CLINIC
"RTN","PSJHL4A",152,0)
 S XMDUZ="MEDICATIONS,INPATIENT",XMSUB=$G(WARD)
"RTN","PSJHL4A",153,0)
 S XMSUB=XMSUB_"-"_NTFSTAT_" "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",$G(NTFYREAS)=3:"STAT",1:"")_"-"
"RTN","PSJHL4A",154,0)
 S XMSUB=XMSUB_$E(PNAME,1,65-$L(XMSUB))
"RTN","PSJHL4A",155,0)
 S XMTEXT="PSG("
"RTN","PSJHL4A",156,0)
 S PSG(1,0)="Inpatient Medications has received the following "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",1:"")_" order ("_NTFSTAT_")"
"RTN","PSJHL4A",157,0)
 S PSG(2,0)=""
"RTN","PSJHL4A",158,0)
 S PSG(3,0)="          Patient:     "_PNAME I $G(LASTFOUR) S PSG(3,0)=PSG(3,0)_"  ("_LASTFOUR_")"
"RTN","PSJHL4A",159,0)
 S PSG(4,0)="Order Information:     "_DRUG_" "_DO_" "_RTE_" "_$G(PSJSCHED)
"RTN","PSJHL4A",160,0)
 S PSG(5,0)="       Order Date:     "_$$ENDTC^PSGMI(ORDATE)
"RTN","PSJHL4A",161,0)
 D ^XMD
"RTN","PSJHL4A",162,0)
 Q
"VER")
8.0^22.0
"BLD",6335,6)
^184
**END**
**END**
