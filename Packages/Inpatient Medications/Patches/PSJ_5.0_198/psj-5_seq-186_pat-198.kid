Released PSJ*5*198 SEQ #186
Extracted from mail message
**KIDS**:PSJ*5.0*198^

**INSTALL NAME**
PSJ*5.0*198
"BLD",7599,0)
PSJ*5.0*198^INPATIENT MEDICATIONS^0^3081203^y
"BLD",7599,1,0)
^^11^11^3081203^
"BLD",7599,1,1,0)
DESCRIPTION
"BLD",7599,1,2,0)
============
"BLD",7599,1,3,0)
 
"BLD",7599,1,4,0)
This patch addresses the following Remedy Ticket(s):
"BLD",7599,1,5,0)
----------------------------------------------------
"BLD",7599,1,6,0)
HD200323 - <UNDEFINED>COPY+10^PSIVOD
"BLD",7599,1,7,0)
HD193154 - Inappropriate Remote Order Check message
"BLD",7599,1,8,0)
HD211655 - Nurse finishes order and its active 
"BLD",7599,1,9,0)
HD216471 - Renew single order routine setting the wrong node for the
"BLD",7599,1,10,0)
           PSGRFOUR variable
"BLD",7599,1,11,0)
HD210106 - Meds on extended profile do not match CPRS orders tab.
"BLD",7599,4,0)
^9.64PA^^
"BLD",7599,6)
2^
"BLD",7599,6.3)
7
"BLD",7599,"ABPKG")
n
"BLD",7599,"KRN",0)
^9.67PA^8989.52^19
"BLD",7599,"KRN",.4,0)
.4
"BLD",7599,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7599,"KRN",.401,0)
.401
"BLD",7599,"KRN",.401,"NM",0)
^9.68A^^
"BLD",7599,"KRN",.402,0)
.402
"BLD",7599,"KRN",.403,0)
.403
"BLD",7599,"KRN",.5,0)
.5
"BLD",7599,"KRN",.84,0)
.84
"BLD",7599,"KRN",3.6,0)
3.6
"BLD",7599,"KRN",3.8,0)
3.8
"BLD",7599,"KRN",9.2,0)
9.2
"BLD",7599,"KRN",9.8,0)
9.8
"BLD",7599,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",7599,"KRN",9.8,"NM",1,0)
PSJLMUTL^^0^B56399275
"BLD",7599,"KRN",9.8,"NM",2,0)
PSJDPT^^0^B7019925
"BLD",7599,"KRN",9.8,"NM",3,0)
PSGOER^^0^B73856519
"BLD",7599,"KRN",9.8,"NM",4,0)
PSJH1^^0^B16255146
"BLD",7599,"KRN",9.8,"NM","B","PSGOER",3)

"BLD",7599,"KRN",9.8,"NM","B","PSJDPT",2)

"BLD",7599,"KRN",9.8,"NM","B","PSJH1",4)

"BLD",7599,"KRN",9.8,"NM","B","PSJLMUTL",1)

"BLD",7599,"KRN",19,0)
19
"BLD",7599,"KRN",19,"NM",0)
^9.68A^7^7
"BLD",7599,"KRN",19,"NM",1,0)
PSJ PR^^0
"BLD",7599,"KRN",19,"NM",2,0)
PSJ EXTP^^0
"BLD",7599,"KRN",19,"NM",3,0)
PSJI PROFILE REPORT^^0
"BLD",7599,"KRN",19,"NM",4,0)
PSJU AP-1^^0
"BLD",7599,"KRN",19,"NM",5,0)
PSJU AP-2^^0
"BLD",7599,"KRN",19,"NM",6,0)
PSJU PR^^0
"BLD",7599,"KRN",19,"NM",7,0)
PSJU EPPD^^0
"BLD",7599,"KRN",19,"NM","B","PSJ EXTP",2)

"BLD",7599,"KRN",19,"NM","B","PSJ PR",1)

"BLD",7599,"KRN",19,"NM","B","PSJI PROFILE REPORT",3)

"BLD",7599,"KRN",19,"NM","B","PSJU AP-1",4)

"BLD",7599,"KRN",19,"NM","B","PSJU AP-2",5)

"BLD",7599,"KRN",19,"NM","B","PSJU EPPD",7)

"BLD",7599,"KRN",19,"NM","B","PSJU PR",6)

"BLD",7599,"KRN",19.1,0)
19.1
"BLD",7599,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7599,"KRN",101,0)
101
"BLD",7599,"KRN",101,"NM",0)
^9.68A^^
"BLD",7599,"KRN",409.61,0)
409.61
"BLD",7599,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",7599,"KRN",771,0)
771
"BLD",7599,"KRN",771,"NM",0)
^9.68A^^
"BLD",7599,"KRN",870,0)
870
"BLD",7599,"KRN",870,"NM",0)
^9.68A^^
"BLD",7599,"KRN",8989.51,0)
8989.51
"BLD",7599,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",7599,"KRN",8989.52,0)
8989.52
"BLD",7599,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",7599,"KRN",8994,0)
8994
"BLD",7599,"KRN",8994,"NM",0)
^9.68A^^
"BLD",7599,"KRN","B",.4,.4)

"BLD",7599,"KRN","B",.401,.401)

"BLD",7599,"KRN","B",.402,.402)

"BLD",7599,"KRN","B",.403,.403)

"BLD",7599,"KRN","B",.5,.5)

"BLD",7599,"KRN","B",.84,.84)

"BLD",7599,"KRN","B",3.6,3.6)

"BLD",7599,"KRN","B",3.8,3.8)

"BLD",7599,"KRN","B",9.2,9.2)

"BLD",7599,"KRN","B",9.8,9.8)

"BLD",7599,"KRN","B",19,19)

"BLD",7599,"KRN","B",19.1,19.1)

"BLD",7599,"KRN","B",101,101)

"BLD",7599,"KRN","B",409.61,409.61)

"BLD",7599,"KRN","B",771,771)

"BLD",7599,"KRN","B",870,870)

"BLD",7599,"KRN","B",8989.51,8989.51)

"BLD",7599,"KRN","B",8989.52,8989.52)

"BLD",7599,"KRN","B",8994,8994)

"BLD",7599,"QUES",0)
^9.62^^
"BLD",7599,"REQB",0)
^9.611^3^3
"BLD",7599,"REQB",1,0)
PSJ*5.0*174^1
"BLD",7599,"REQB",2,0)
PSJ*5.0*160^1
"BLD",7599,"REQB",3,0)
PSJ*5.0*141^1
"BLD",7599,"REQB","B","PSJ*5.0*141",3)

"BLD",7599,"REQB","B","PSJ*5.0*160",2)

"BLD",7599,"REQB","B","PSJ*5.0*174",1)

"KRN",19,953,-1)
0^3
"KRN",19,953,0)
PSJI PROFILE REPORT^Patient Profile Report (IV)^^R^^^^^^^^IV MEDICATIONS^^1^1
"KRN",19,953,1,0)
^^3^3^2910312^^^^
"KRN",19,953,1,1,0)
  This option will allow a patient profile to be printed to a printer.
"KRN",19,953,1,2,0)
With each profile printed a view of each order within the profile can
"KRN",19,953,1,3,0)
also be printed. 
"KRN",19,953,15)
K I1,PSJOL,PSJORL,PSIVSCR,PSJNODIS
"KRN",19,953,20)
S PSJNODIS=1
"KRN",19,953,25)
PSIVPR
"KRN",19,953,"U")
PATIENT PROFILE REPORT (IV)
"KRN",19,1559,-1)
0^6
"KRN",19,1559,0)
PSJU PR^PAtient Profile (Unit Dose)^^R^^^^^^^^UNIT DOSE MEDICATIONS^^1^1
"KRN",19,1559,1,0)
^19.06^7^7^3070921^^^^
"KRN",19,1559,1,1,0)
  Allows a user to print to any device a profile (list) of a patient's
"KRN",19,1559,1,2,0)
orders for the patient's current or last (if patient has been discharged)
"KRN",19,1559,1,3,0)
admission.  If the user's terminal is selected as the printing device,
"KRN",19,1559,1,4,0)
this option will allow the user to select any of the printed orders to be
"KRN",19,1559,1,5,0)
shown in complete detail, including the activity logs, if any.  The user
"KRN",19,1559,1,6,0)
may print patients' profiles for a single patient, or for an entire WARD
"KRN",19,1559,1,7,0)
GROUP or an entire WARD.
"KRN",19,1559,15)
K PSJNODIS
"KRN",19,1559,20)
S PSJNODIS=1
"KRN",19,1559,25)
PSGPR
"KRN",19,1559,99.1)
59015,44130
"KRN",19,1559,"U")
PATIENT PROFILE (UNIT DOSE)
"KRN",19,6784,-1)
0^4
"KRN",19,6784,0)
PSJU AP-1^Action Profile #1^^R^^^^^^^^UNIT DOSE MEDICATIONS^^1^1
"KRN",19,6784,1,0)
^^3^3^2910312^^^^
"KRN",19,6784,1,1,0)
  Allows the user to print a profile of patients' active orders for review
"KRN",19,6784,1,2,0)
by the physician.  Includes places for the physician to mark each order
"KRN",19,6784,1,3,0)
and sign the profile.  When possible, space is included for new orders.
"KRN",19,6784,15)
K PSJNODIS
"KRN",19,6784,20)
S PSJNODIS=1
"KRN",19,6784,25)
PSGAP
"KRN",19,6784,99.1)
57660,75042
"KRN",19,6784,"U")
ACTION PROFILE #1
"KRN",19,6791,-1)
0^5
"KRN",19,6791,0)
PSJU AP-2^Action Profile #2^^R^^^^^^^^UNIT DOSE MEDICATIONS^^1^1
"KRN",19,6791,1,0)
^^3^3^2910312^^^^
"KRN",19,6791,1,1,0)
  Allows the user to print a profile of patients' active orders for review
"KRN",19,6791,1,2,0)
by the physician.  Includes places for the physician to mark each order
"KRN",19,6791,1,3,0)
and sign the profile.  When possible, space is included for new orders.
"KRN",19,6791,15)
K PSJNODIS
"KRN",19,6791,20)
S PSJNODIS=1
"KRN",19,6791,25)
PSGCAP
"KRN",19,6791,99)
55626,33425
"KRN",19,6791,"U")
ACTION PROFILE #2
"KRN",19,6793,-1)
0^1
"KRN",19,6793,0)
PSJ PR^Inpatient Profile^^R^^^^^^^^INPATIENT MEDICATIONS^^1^1
"KRN",19,6793,1,0)
^19.06^2^2^3070921^^^^
"KRN",19,6793,1,1,0)
  This allows the user to print Inpatient Medications orders for selected
"KRN",19,6793,1,2,0)
patients.
"KRN",19,6793,15)
K DRGN,I1,NF,OD,ON55,PDRG,PSIVAC,PSIVUP,PSJORIFN,UL80,PSJNODIS
"KRN",19,6793,20)
S PSJNODIS=1
"KRN",19,6793,25)
PSJPR
"KRN",19,6793,99)
54808,38719
"KRN",19,6793,99.1)
57875,74982
"KRN",19,6793,"U")
INPATIENT PROFILE
"KRN",19,10398,-1)
0^7
"KRN",19,10398,0)
PSJU EPPD^Pharmacy Patient Data Edit^^R^^^^^^^^UNIT DOSE MEDICATIONS^^1^1
"KRN",19,10398,1,0)
^^3^3^2910312^^^^
"KRN",19,10398,1,1,0)
  Allows the user to edit data pertaining to a particular pharmacy
"KRN",19,10398,1,2,0)
patient.  This option is not tied to any menu, but if a site desires,
"KRN",19,10398,1,3,0)
may be used to edit the NARRATIVE, WEIGHT, and REACTIONS fields.
"KRN",19,10398,15)
K PSJNODIS
"KRN",19,10398,20)
S PSJNODIS=1
"KRN",19,10398,25)
ENPPD^PSGFILED
"KRN",19,10398,"U")
PHARMACY PATIENT DATA EDIT
"KRN",19,10402,-1)
0^2
"KRN",19,10402,0)
PSJ EXTP^Patient Profile (Extended)^^R^^^^^^^^UNIT DOSE MEDICATIONS^^1^1
"KRN",19,10402,1,0)
^19.06^3^3^3071009^^^
"KRN",19,10402,1,1,0)
This report allows viewing all of the orders on file for a patient (not 
"KRN",19,10402,1,2,0)
just since last discharge).  All orders that have not been purged can
"KRN",19,10402,1,3,0)
be viewed, or a date entered to start searching forward from.
"KRN",19,10402,15)
K PSJEXTP,PSJNODIS
"KRN",19,10402,20)
S (PSJEXTP,PSJNODIS)=1
"KRN",19,10402,25)
PSJPR
"KRN",19,10402,"U")
PATIENT PROFILE (EXTENDED)
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
198^3081203^33267
"PKG",203,22,1,"PAH",1,1,0)
^^11^11^3081203
"PKG",203,22,1,"PAH",1,1,1,0)
DESCRIPTION
"PKG",203,22,1,"PAH",1,1,2,0)
============
"PKG",203,22,1,"PAH",1,1,3,0)
 
"PKG",203,22,1,"PAH",1,1,4,0)
This patch addresses the following Remedy Ticket(s):
"PKG",203,22,1,"PAH",1,1,5,0)
----------------------------------------------------
"PKG",203,22,1,"PAH",1,1,6,0)
HD200323 - <UNDEFINED>COPY+10^PSIVOD
"PKG",203,22,1,"PAH",1,1,7,0)
HD193154 - Inappropriate Remote Order Check message
"PKG",203,22,1,"PAH",1,1,8,0)
HD211655 - Nurse finishes order and its active 
"PKG",203,22,1,"PAH",1,1,9,0)
HD216471 - Renew single order routine setting the wrong node for the
"PKG",203,22,1,"PAH",1,1,10,0)
           PSGRFOUR variable
"PKG",203,22,1,"PAH",1,1,11,0)
HD210106 - Meds on extended profile do not match CPRS orders tab.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSGOER")
0^3^B73856519^B72290048
"RTN","PSGOER",1,0)
PSGOER ;BIR/CML3-RENEW A SINGLE ORDER ; 12/3/08 10:26am
"RTN","PSGOER",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,30,29,35,70,58,95,110,111,133,141,198**;16 DEC 97;Build 7
"RTN","PSGOER",3,0)
 ;
"RTN","PSGOER",4,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSGOER",5,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOER",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOER",7,0)
 ; Reference to ^PSBAPIPM is supported by DBIA 3564.
"RTN","PSGOER",8,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181.
"RTN","PSGOER",9,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOER",10,0)
 ;
"RTN","PSGOER",11,0)
 ; renew a single order
"RTN","PSGOER",12,0)
 I $G(PSJCOM) D ^PSJCOMR Q
"RTN","PSGOER",13,0)
 N PSJEXPIR S PSJEXPIR=$$EXPIRED(PSGP,PSGORD) I PSJEXPIR D  Q
"RTN","PSGOER",14,0)
 .W !!?3,"  THIS ORDER" W:PSJEXPIR'=2 " HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED",!?8," ADMINISTRATIONS AND"
"RTN","PSGOER",15,0)
 .W " CANNOT BE RENEWED!" D PAUSE^VALM1
"RTN","PSGOER",16,0)
 I $G(PSGSCH)]"",($G(PSGS0XT)="D"),($G(PSGAT)="") D  Q
"RTN","PSGOER",17,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOER",18,0)
 .Q:((",P,R,")[(","_$G(PSGST)_","))
"RTN","PSGOER",19,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!?3,"This order contains a 'DAY OF THE WEEK' schedule without admin times"
"RTN","PSGOER",20,0)
 .W !?11," and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",21,0)
 I $G(PSGSCH)]"",'$$DOW^PSIVUTL(PSGSCH),'$$PRNOK^PSGS0(PSGSCH) I '$D(^PS(51.1,"AC","PSJ",PSGSCH)) D  Q
"RTN","PSGOER",22,0)
 .W !!?3,"This order contains an invalid schedule and CANNOT be renewed!" D PAUSE^VALM1
"RTN","PSGOER",23,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS ORDER",1:"MARK THIS ORDER FOR RENEWAL"),DIR("B")="YES"
"RTN","PSGOER",24,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this order",1:"mark this order for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR
"RTN","PSGOER",25,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSGOER",26,0)
 I '$D(DIRUT),PSJSYSU S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSGOER",27,0)
 D DONE,ABORT^PSGOEE
"RTN","PSGOER",28,0)
 Q
"RTN","PSGOER",29,0)
 ;
"RTN","PSGOER",30,0)
UNMARK ;  
"RTN","PSGOER",31,0)
 W !!,"THIS ORDER HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSGOER",32,0)
 S DIR("?",1)="  Answer 'YES' to unmark this order.  Answer 'NO' (or '^') to leave the order",DIR("?")="marked.  (An answer is required.)" D ^DIR
"RTN","PSGOER",33,0)
 I 'Y D ABORT^PSGOEE G DONE
"RTN","PSGOER",34,0)
 S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSGOER",35,0)
 ;
"RTN","PSGOER",36,0)
DONE ;
"RTN","PSGOER",37,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGOPR,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSGOER",38,0)
 ;
"RTN","PSGOER",39,0)
NEW ; get info, write record
"RTN","PSGOER",40,0)
EXTEND ; extend stop date on renewal order
"RTN","PSGOER",41,0)
 N DUOUT,PSJABT,PSGDRG,PSJREN,PSGOREAS S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSGOER",42,0)
 I $G(PSGST)="O" N ACT S ACT=$$EN^PSBAPIPM(PSGP,PSGORD) I $P(ACT,"^",2),($P(ACT,"^",3)="G") I $P(ACT,"^",2)>$P($G(^PS(55,PSGP,5,+PSGORD,2)),"^",2) D  Q
"RTN","PSGOER",43,0)
 . W !!?5,"THIS ONE-TIME ORDER HAS ALREADY BEEN GIVEN AND CANNOT BE RENEWED",! S (DIRUT,PSGORQF)=1 D READ
"RTN","PSGOER",44,0)
 D OC55
"RTN","PSGOER",45,0)
 Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSGOER",46,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSGOER",47,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSGOER",48,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSGOER",49,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I ($G(X)="^")!'$D(PSGFOK(106))!$G(DUOUT) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",50,0)
SPEED ;
"RTN","PSGOER",51,0)
 I +$G(PSJSYSU)=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOER",52,0)
 Q:$G(DUOUT)
"RTN","PSGOER",53,0)
 N PSGOEAV S PSGOEAV=+PSJSYSU
"RTN","PSGOER",54,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSGOER",55,0)
 I $$LS^PSSLOCK(PSGP,PSGORD) D UPDREN(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO),UPDRENOE(PSGP,PSGORD,PSGDT) D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOER",56,0)
 ;
"RTN","PSGOER",57,0)
 I 'PSGOERDP,$P(PSJSYSW0,"^",4),PSGFD'<PSGWLL S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSGOER",58,0)
 W ".DONE!" S VALMBCK="Q" Q
"RTN","PSGOER",59,0)
 ;
"RTN","PSGOER",60,0)
MARK ;
"RTN","PSGOER",61,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSGOER",62,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSGOER",63,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOER",64,0)
 Q
"RTN","PSGOER",65,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSGOER",66,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSGOER",67,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSGOER",68,0)
 Q
"RTN","PSGOER",69,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSGOER",70,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG
"RTN","PSGOER",71,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOER",72,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(55,PSGP,5,+PSGORD,1,1,0)))
"RTN","PSGOER",73,0)
 I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSGOER",74,0)
 . F PSGDDI=1:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0)) K PSJPDRG D IVSOL^PSGSICHK
"RTN","PSGOER",75,0)
 Q
"RTN","PSGOER",76,0)
UPDREN(PSGORD,RNWDT,PSGOEPR,PSGOFD,PSJNOO,RDUZ) ; update renewed order
"RTN","PSGOER",77,0)
 N DR,DA,DIC,DIE,DD,DO,PSGRZERO,PSGRFOUR,PSGOORD
"RTN","PSGOER",78,0)
 S DR="",PSGOEENO=0,PSGOORD=PSGORD,PSGNESD=PSGSD Q:'PSGORD!'RNWDT!'PSGOEPR!'PSGOFD  S PSJNOO=$S($G(PSJNOO)]"":$G(PSJNOO),1:"E")
"RTN","PSGOER",79,0)
 S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOEORD=$P(@PSGRZERO,"^",21)
"RTN","PSGOER",80,0)
 ; PSJ*5*141 - changed PSGOEPR to PSGPR for field 1 of the DR string below.
"RTN","PSGOER",81,0)
 S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5," S DR="34////^S X=PSGFD" S:$G(PSGPR) DR=DR_";1////"_PSGPR_";110////"_PSJNOO D ^DIE
"RTN","PSGOER",82,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(55,"_PSGP_",5,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="55.6114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSGOER",83,0)
 . S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$S($G(RDUZ):RDUZ,1:$G(DUZ))_";2////"_$G(PSGOEPR)_";3////"_$G(PSGOFD)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSGOER",84,0)
 K DR,DA,DIC,DIE,DD,DO S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="28////A;105////@;107////@"
"RTN","PSGOER",85,0)
 ;PSJ*5*198
"RTN","PSGOER",86,0)
 S PSGRFOUR="^PS(55,"_PSGP_",5,"_+PSGORD_",4)",PSGRFOUR=@PSGRFOUR I $P(PSGRFOUR,"^",2)<RNWDT S DR=DR_";16////@;17////@" I $G(PSJORD)["P",+PSJSYSU=1 S DR=DR_";18////@;19////@"
"RTN","PSGOER",87,0)
 I '$G(PSJSPEED) I $G(PSGAT)]"",$G(PSGAT)'=$P($G(@(DIE_+PSGORD_",2)")),"^",5) S DR=DR_";41////"_PSGAT
"RTN","PSGOER",88,0)
 D ^DIE
"RTN","PSGOER",89,0)
 Q
"RTN","PSGOER",90,0)
UPDRENOE(PSGP,PSGORD,RDATE) ;
"RTN","PSGOER",91,0)
 D EXPOE(PSGP,PSGORD,$G(RDATE)) ; expire original Orders File order
"RTN","PSGOER",92,0)
 I PSGORD'["P" K DA,DR,DIE S DA(1)=DFN,DA=+PSGORD,DIE="^PS(55,"_DFN_$S(PSGORD="U":",5,",1:",""IV"","),DR=$S(DIE["IV":110,1:66)_"////@" D ^DIE
"RTN","PSGOER",93,0)
 D ENUDTX^PSJOREN(PSGP,PSGORD,"NR")
"RTN","PSGOER",94,0)
 D EN1^PSJHL2(PSGP,"SN",PSGORD,"ORDER RENEWED")
"RTN","PSGOER",95,0)
 Q
"RTN","PSGOER",96,0)
READ ; hold screen
"RTN","PSGOER",97,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSGOER",98,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSGOER",99,0)
 Q
"RTN","PSGOER",100,0)
EXPOE(DFN,PSJORDER,EXPDT) ; expire old Orders File entry
"RTN","PSGOER",101,0)
 I PSJORDER["P" S FILE="^PS(53.1,"_+PSJORDER_",0)",PSJORDER=$P(@FILE,"^",25)
"RTN","PSGOER",102,0)
 I (PSJORDER'["U"),(PSJORDER'["V") Q
"RTN","PSGOER",103,0)
 N CURDAT D NOW^%DTC S CURDAT=$$DATE2^PSJUTL2(%)
"RTN","PSGOER",104,0)
 S PSJEXPOE=$S($G(EXPDT):EXPDT,1:CURDAT) D EN1^PSJHL2(DFN,"SC",PSJORDER) K PSJEXPOE
"RTN","PSGOER",105,0)
 Q
"RTN","PSGOER",106,0)
EXPIRED(PSJX,PSJY) ;
"RTN","PSGOER",107,0)
 ; INPUT 
"RTN","PSGOER",108,0)
 ;       PSJX - Pharmacy Patient, pointer to ^PS(55
"RTN","PSGOER",109,0)
 ;       PSJY - Inpatient Order Number (appended with "V" or "U")
"RTN","PSGOER",110,0)
 ; OUTPUT
"RTN","PSGOER",111,0)
 ;   0  -  Order has not exceeded the Expired Time Limit 
"RTN","PSGOER",112,0)
 ;   1  -  Order has exceeded the Expired Time Limit
"RTN","PSGOER",113,0)
 N STOP,STATUS,NOW,CUTOFF,FREQ,LAST,ST,X,DFN,U,PSGDT,SD,WD,PSJPSTO,PSGDW,PSGOC,ZZND,LASTAT,LSTSTR,PSBCNT S DFN=PSJX,U="^",CUTOFF=0
"RTN","PSGOER",114,0)
 S STATUS=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,0)),"^",9),PSJY["V":$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",17),1:"")
"RTN","PSGOER",115,0)
 S NOW=$S($G(PSGDT):PSGDT,1:$$DATE^PSJUTL2())
"RTN","PSGOER",116,0)
 S STOP=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,2)),U,4),1:$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",3))
"RTN","PSGOER",117,0)
 I NOW<STOP Q 0
"RTN","PSGOER",118,0)
 I PSJY["U" N ND2,ND0 S ND0=$G(^PS(55,PSJX,5,+PSJY,0)),ND2=$G(^PS(55,PSJX,5,+PSJY,2)),FREQ=$P(ND2,"^",6) D
"RTN","PSGOER",119,0)
 .N SCHED S SCHED=$P($G(^PS(55,PSJX,5,+PSJY,2)),"^") I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED)
"RTN","PSGOER",120,0)
 .S LSTSTR=$P(ND2,"^",2)_"^"_$P(ND2,"^",4)_"^"_SCHED_"^"_$P(ND0,"^",7)_"^^"_$P(ND2,"^",5)
"RTN","PSGOER",121,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,($P(ND0,"^",7)="O"),($P(LAST,"^",3)="G") I LAST>$P(ND2,"^",2) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",122,0)
 .I 'LAST!(LAST>$P(ND2,"^",4)) S LAST=$$LASTAT^PSJORP2(DFN,LSTSTR) S:LAST CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",123,0)
 .I SCHED["PRN",($P(LSTSTR,"^",6)="") S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",124,0)
 .I $$DOW^PSIVUTL(SCHED) S CUTOFF=$$NXTDOW(DFN,$P(LSTSTR,"^"),$P(LSTSTR,"^",2),$P(LSTSTR,"^",3),$P(LSTSTR,"^",6)) Q
"RTN","PSGOER",125,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND2,"^",4)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",126,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,,,FREQ) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",127,0)
 I PSJY["V" N LIMIT S LIMIT=$P($G(^PS(59.7,1,31)),"^",4) S LIMIT=$S((LIMIT]""):+LIMIT,1:24) S CUTOFF=$$FMADD^XLFDT(STOP,,LIMIT) D
"RTN","PSGOER",128,0)
 .I '($G(P(4))]"") N P,YP,XP S YP=$G(^PS(55,DFN,"IV",+PSJY,0)) F XP=1:1:23 S P(XP)=$P(YP,U,XP)
"RTN","PSGOER",129,0)
 .Q:'($G(P(4))]"")
"RTN","PSGOER",130,0)
 .Q:'$$SCHREQ^PSJLIVFD(.P)
"RTN","PSGOER",131,0)
 .N INTERVAL,LSTSTR,ND0,SCHED,IVSTYP S ND0=$G(^PS(55,PSJX,"IV",+PSJY,0)),INTERVAL=$P(ND0,"^",15),SCHED=$P(ND0,"^",9) Q:SCHED=""
"RTN","PSGOER",132,0)
 .S IVSTYP=$S($$DOW^PSIVUTL(SCHED):"D",INTERVAL="O":"O",1:"C"),LSTSTR=$P(ND0,"^",2)_"^"_$P(ND0,"^",3)_"^"_SCHED_"^"_IVSTYP_"^^"_$P(ND0,"^",11)
"RTN","PSGOER",133,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,IVSTYP="O",LAST>$P(ND0,"^",2),($P(LAST,"^",3)="G") S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",134,0)
 .I 'LAST!(LAST>$P(ND0,"^",3))!(LAST&(IVSTYP="O")) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",135,0)
 .I IVSTYP="D" S CUTOFF=$$NXTDOW(LAST,SCHED,$G(P(2)),$P($G(P(9)),"@"),$G(P(11))) Q
"RTN","PSGOER",136,0)
 .I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED) S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",137,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND0,"^",3)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",138,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,31) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",139,0)
 K LYN,PSBDT,PSBFLAG,PSBSTR
"RTN","PSGOER",140,0)
 Q $S(CUTOFF<NOW:1,1:0)
"RTN","PSGOER",141,0)
 ;
"RTN","PSGOER",142,0)
NXTDOW(DOWDFN,DOWSD,DOWFD,DOWSCH,DOWAT) ;
"RTN","PSGOER",143,0)
 N NXTADM,DOWSTR S DOWSTR=$$FMADD^XLFDT(DOWFD,,,,1)_"^"_$$FMADD^XLFDT(DOWFD,7)_"^"_DOWSCH_"^D^^"_DOWAT S NXTADM=$$ENQ^PSJORP2(DOWDFN,DOWSTR)
"RTN","PSGOER",144,0)
 Q $S(NXTADM:NXTADM,1:DOWSD)
"RTN","PSGOER",145,0)
 ;
"RTN","PSGOER",146,0)
PRNFREQ(SCHED) ;
"RTN","PSGOER",147,0)
 N ZZND,D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0XT,PSGS0Y,PSGDT
"RTN","PSGOER",148,0)
 F X=$P(SCHED,"PRN"),$P(SCHED,"PRN",2),$P(SCHED," PRN"),$P(SCHED,"PRN ",2) Q:$P($G(ZZND),"^",4)  D ADMIN^PSJORPOE
"RTN","PSGOER",149,0)
 Q $S($G(PSGS0XT):PSGS0XT,1:1440)
"RTN","PSJDPT")
0^2^B7019925^B6283782
"RTN","PSJDPT",1,0)
PSJDPT ;BIR/JLC - CENTRALIZED PATIENT LOOKUP FOR IPM ; 7/2/08 3:47pm
"RTN","PSJDPT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**53,124,166,160,198**;16 DEC 97;Build 7
"RTN","PSJDPT",3,0)
 ;
"RTN","PSJDPT",4,0)
 ; Reference to ^DPT is supported by DBIA 10035
"RTN","PSJDPT",5,0)
 ; Reference to ^DGSEC4 is supported by DBIA 3027
"RTN","PSJDPT",6,0)
 ; Reference to ^DIC is supported by DBIA 10006
"RTN","PSJDPT",7,0)
 ; Reference to ^DICN is supported by DBIA 10009
"RTN","PSJDPT",8,0)
 ; Reference to ^DPTLK is supported by DBIA 3787
"RTN","PSJDPT",9,0)
 ; Reference to ^DPTLK1 is supported by DBIA 3266
"RTN","PSJDPT",10,0)
 ; Reference to DISPPRF^DGPFAPI is supported by DBIA 4563
"RTN","PSJDPT",11,0)
 ; Reference to GETACT^DGPFAPI is supported by DBIA 3860
"RTN","PSJDPT",12,0)
 ; Reference to ^ORRDI1 is supported by DBIA 4659.
"RTN","PSJDPT",13,0)
 ; Reference to ^XTMP("ORRDI" is supported by DBIA 4660.
"RTN","PSJDPT",14,0)
 ;
"RTN","PSJDPT",15,0)
EN ; MAIN ENTRY POINT FOR PATIENT LOOKUP
"RTN","PSJDPT",16,0)
 K DIC S DIC="^DPT(",DIC("W")="D DPT^PSJDPT",DIC(0)="QEMZ" D ^DPTLK K DIC
"RTN","PSJDPT",17,0)
 I $$BADADR^DGUTL3(+Y) H 2
"RTN","PSJDPT",18,0)
 N Y
"RTN","PSJDPT",19,0)
 D
"RTN","PSJDPT",20,0)
 . ;PSJ*5.0*198;GMZ;Don't print remote data msg on view profile only menu options
"RTN","PSJDPT",21,0)
 . I $T(HAVEHDR^ORRDI1)]"",$$HAVEHDR^ORRDI1,$D(^XTMP("ORRDI","OUTAGE INFO","DOWN")),'$G(PSJNODIS) W !,"Remote data not available - Only local order checks processed." D PAUSE^PSJLMUT1
"RTN","PSJDPT",22,0)
 Q
"RTN","PSJDPT",23,0)
CHK(Y,DISP,PAUSE) N RESULT,RES,CHKY,PSGTEMP
"RTN","PSJDPT",24,0)
 S DISP=$G(DISP),PAUSE=$G(PAUSE)
"RTN","PSJDPT",25,0)
 I $G(XQY0)["PSJI COMPLETE",$$GETACT^DGPFAPI(+Y,"PSGTEMP") K PSGTEMP W @IOF,"PATIENT: ",$P(Y,U,2)
"RTN","PSJDPT",26,0)
 S CHKY=Y D DISPPRF^DGPFAPI(Y) S Y=CHKY K CHKY
"RTN","PSJDPT",27,0)
 D PTSEC^DGSEC4(.RESULT,$P(Y,"^"),1)
"RTN","PSJDPT",28,0)
 I RESULT(1)'=0 D
"RTN","PSJDPT",29,0)
 . W !! I DISP W ?(80-$L($P(Y,"^",2)))\2,$P(Y,"^",2),!
"RTN","PSJDPT",30,0)
 . F I=2:1:9 I $D(RESULT(I)) W ?(80-$L(RESULT(I)))\2,RESULT(I),!
"RTN","PSJDPT",31,0)
 . I RESULT(1)'=0,RESULT(1)'=2,PAUSE H 2
"RTN","PSJDPT",32,0)
 . Q:RESULT(1)=1
"RTN","PSJDPT",33,0)
 . I RESULT(1)=-1!(RESULT(1)=3)!(RESULT(1)=4) S Y=-1 Q
"RTN","PSJDPT",34,0)
 . I RESULT(1)=2 D ENCONT I Y=-1 Q
"RTN","PSJDPT",35,0)
 . D NOTICE^DGSEC4(.RES,Y,XQY0,$S(RESULT(1)=1:1,1:3)) I RES=0 S Y=-1 Q
"RTN","PSJDPT",36,0)
 Q
"RTN","PSJDPT",37,0)
ENCONT W !,"Do you want to continue processing this patient record"
"RTN","PSJDPT",38,0)
 S %=2 D YN^DICN I %<0!(%=2) S Y=-1
"RTN","PSJDPT",39,0)
 I '% W !!,"Enter 'YES' to continue processing, or 'NO' to quit processing this record." G ENCONT
"RTN","PSJDPT",40,0)
 Q
"RTN","PSJDPT",41,0)
DPT I $$DOB^DPTLK1(Y)["*SENSITIVE" G SENS
"RTN","PSJDPT",42,0)
 S ND=$S($D(^DPT(Y,0)):^(0),1:""),NB=$P(ND,"^",3),NS=$P(ND,"^",9)
"RTN","PSJDPT",43,0)
 I NS W ?42,$E(NS,1,3),"-",$E(NS,4,5),"-",$E(NS,6,10)," "
"RTN","PSJDPT",44,0)
 I NB W ?55,$E(NB,4,5),"/",$E(NB,6,7),"/",$E(NB,2,3)," "
"RTN","PSJDPT",45,0)
 I $D(^DPT(Y,.1)) W ?67,$P(^(.1),"^")
"RTN","PSJDPT",46,0)
 Q
"RTN","PSJDPT",47,0)
SENS W ?42,"*SENSITIVE* ",?55,"*SENSITIVE* ",?67,"*SENSITIVE*" Q
"RTN","PSJH1")
0^4^B16255146^B16117698
"RTN","PSJH1",1,0)
PSJH1 ;BIR/CML3,PR-GET UNIT DOSE/IV ORDERS FOR INPATIENT ; 11/15/07 4:21pm
"RTN","PSJH1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**35,47,58,85,174,198**;16 DEC 97;Build 7
"RTN","PSJH1",3,0)
 ;
"RTN","PSJH1",4,0)
 ;Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSJH1",5,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJH1",6,0)
 ;Reference to ^%DTC is supported by DBIA 10000
"RTN","PSJH1",7,0)
 ;Reference to ^%ZOSV is supported by DBIA 10097
"RTN","PSJH1",8,0)
 ;Reference to ^XLFDT is supported by DBIA 10103
"RTN","PSJH1",9,0)
 ;
"RTN","PSJH1",10,0)
ECHK ;
"RTN","PSJH1",11,0)
 S C="A",DRG=$P($G(^PS(55,PSGP,5,+O,.2)),"^") S:PSJOS START=-$P($G(^(2)),"^",2)
"RTN","PSJH1",12,0)
 S O=O_"U"
"RTN","PSJH1",13,0)
 G:SD>PSGDT SET S ND=$G(^PS(55,PSGP,5,+O,0)) G:$S($P(ND,"^",9)="":1,1:"DE"'[$P(ND,"^",9)) SET S ND4=$G(^(4)) I ST'="O",SD'<PSGODT,$S($P(ND,"^",9)="E":$P(ND4,"^",16),1:0)
"RTN","PSJH1",14,0)
 E  I ST="O",$P(ND,"^",9)="E",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16))
"RTN","PSJH1",15,0)
 E  Q:PSJOL="S"  S C="O"
"RTN","PSJH1",16,0)
 ;
"RTN","PSJH1",17,0)
SET ;
"RTN","PSJH1",18,0)
 S DN=$S(DRG="":"NOT FOUND",'$D(^PS(50.7,DRG,0)):"NOT FOUND ("_DRG_")",$P(^(0),"^")]"":$P(^(0),"^"),1:DRG_";PS(50.7,"),NF=$P(DN,"^",9),SUB=$S(PSJOS:START,1:$E(DN,1,50))
"RTN","PSJH1",19,0)
 S ^TMP("PSJ",$J,C,$S(PSJOS:SUB,1:ST),$S(PSJOS:ST,1:SUB),O)=DN_"^"_NF,PSJOCNT=PSJOCNT+1 Q
"RTN","PSJH1",20,0)
 ;
"RTN","PSJH1",21,0)
IVSET ; Set IV data in ^TMP("PSJ",$J,.
"RTN","PSJH1",22,0)
 N DRG,DRGT,ON55,ORTX,P,STAT,TYP,X,Y,ND
"RTN","PSJH1",23,0)
 ;GMZ;PSJ*5*198;Change date search criteria for IV orders to be consistent with the way unit dose orders work
"RTN","PSJH1",24,0)
 I ON["V" S ON55=ON,Y=$G(^PS(55,DFN,"IV",+ON,0)) Q:$D(PSJHDATE)&($P(Y,"^",3)<PSJHDATE)  F X=2,3,4,9,17 S P(X)=$P(Y,U,X)
"RTN","PSJH1",25,0)
 I ON'["V" S ND=$G(^PS(53.1,+ON,0)) I 'ND K ^PS(53.1,"AS",SD,PSGP,+ON) Q
"RTN","PSJH1",26,0)
 I ON'["V",ND S P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4),P(4)=$P($G(^PS(53.1,+ON,8)),U)
"RTN","PSJH1",27,0)
 G:PSJOS IVSET1 I P(4)="H" S ORTX="* TPN *" G IVSET1
"RTN","PSJH1",28,0)
 I P(4)="A" D @$S(ON["V":"GTDRG^PSIVORFB",1:"GTDRG^PSIVORFA"),GTOT^PSIVUTL(P(4)) I $E(P("OT"))="F" S DRGT=$O(DRG(0)),Y=$O(DRG(DRGT,0)),ORTX=$P(DRG(DRGT,Y),U,2) G IVSET1
"RTN","PSJH1",29,0)
 S ORTX=$$ENPDN^PSGMI(+$S(ON["V":$G(^PS(55,DFN,"IV",+ON,6)),1:$G(^PS(53.1,+ON,.1))))
"RTN","PSJH1",30,0)
 ;
"RTN","PSJH1",31,0)
IVSET1 ;
"RTN","PSJH1",32,0)
 S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJH1",33,0)
 S STAT=$S("ED"[P(17):"O",P(17)="P":"NZ",1:"A"),^TMP("PSJ",$J,STAT,$S(PSJOS:-P(2),1:TYP),$S(PSJOS:TYP,1:ORTX),ON)="",PSJOCNT=PSJOCNT+1
"RTN","PSJH1",34,0)
 Q
"RTN","PSJH1",35,0)
 ;
"RTN","PSJH1",36,0)
ENU ; update status field to reflect expired orders, if necessary
"RTN","PSJH1",37,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSJH1",38,0)
ENUNM ;
"RTN","PSJH1",39,0)
 F Q=+PSJPAD:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q!(Q>PSGDT)  S UPD=Q F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,0)),"DEH"'[$E($P(^(0),"^",9)) S $P(^(0),"^",9)="E"
"RTN","PSJH1",40,0)
 K UPD Q
"RTN","PSJH1",41,0)
 ;
"RTN","PSJH1",42,0)
EN ; enter here
"RTN","PSJH1",43,0)
 I PSJOL="L",$D(XRTL) D T0^%ZOSV
"RTN","PSJH1",44,0)
 K ^TMP("PSJ",$J) D NOW^%DTC S PSGDT=+$E(%,1,12),DT=$$DT^XLFDT,PSJOS=$P(PSJSYSP0,"^",11),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1) S:'$D(PSJHDATE) PSJHDATE=0
"RTN","PSJH1",45,0)
 S PSJOCNT=0 F PSJORD=0:0 S PSJORD=$O(^PS(55,DFN,"IV",PSJORD)) Q:'PSJORD  D
"RTN","PSJH1",46,0)
 .S X=$G(^PS(55,DFN,"IV",+PSJORD,0))
"RTN","PSJH1",47,0)
 .S Y=$P(X,U,17)
"RTN","PSJH1",48,0)
 .S ON=+PSJORD_"V" D IVSET
"RTN","PSJH1",49,0)
 D NOW^%DTC S PSJIVOF=PSJOCNT,PSGDT=%,X1=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT)
"RTN","PSJH1",50,0)
 F ST="C","O","OC","P","R" F SD=+PSJHDATE:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSJH1",51,0)
 Q:$D(PSGONNV)
"RTN","PSJH1",52,0)
 F SD="I","N" S O=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  D NVSET
"RTN","PSJH1",53,0)
 ;I $S(+PSJSYSU=3:1,1:$D(PSGLPF)) S SD="P",O=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P" D @$S($P($G(^PS(53.1,O,0)),U,4)="F":"IVSET",1:"NVSET")
"RTN","PSJH1",54,0)
 S SD="P",O=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P" D @$S($P($G(^PS(53.1,O,0)),U,4)="F":"IVSET",1:"NVSET")
"RTN","PSJH1",55,0)
 I PSJOL="L",$D(XRT0) S XRTN="PSJO1" D T1^%ZOSV
"RTN","PSJH1",56,0)
 Q
"RTN","PSJH1",57,0)
 ;
"RTN","PSJH1",58,0)
NVSET ; Set up orders from 53.1.
"RTN","PSJH1",59,0)
 N ND,OSAVE,PORD S ND=$G(^PS(53.1,O,0)) I 'ND D  Q
"RTN","PSJH1",60,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJH1",61,0)
 S ST=$P($G(^PS(53.1,O,0)),U,7),START=-$P($G(^(2)),U,2),DRG=$P($G(^(.2)),U),C="N"_$TR(SD,"NIP","XYZ") S:ST="" ST="z"
"RTN","PSJH1",62,0)
 S PORD=$P($G(^PS(53.1,O,.2)),U,8),OSAVE=O,O=$S(PORD:PORD,1:O_"P") D SET S O=+OSAVE
"RTN","PSJH1",63,0)
 Q
"RTN","PSJH1",64,0)
 ;
"RTN","PSJH1",65,0)
KILL ;
"RTN","PSJH1",66,0)
 K P,STAT,TYP,ORTX,N,JJ
"RTN","PSJH1",67,0)
 Q
"RTN","PSJLMUTL")
0^1^B56399275^B55033114
"RTN","PSJLMUTL",1,0)
PSJLMUTL ;BIR/MLM-INPATIENT LISTMAN UTILITIES ; 9/12/07 10:28am
"RTN","PSJLMUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,67,58,85,111,160,198**;16 DEC 97;Build 7
"RTN","PSJLMUTL",3,0)
 ;
"RTN","PSJLMUTL",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872.
"RTN","PSJLMUTL",5,0)
 ; Reference to ^PS(50.606 is supported by DBIA #2174.
"RTN","PSJLMUTL",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJLMUTL",7,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLMUTL",8,0)
 ; Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSJLMUTL",9,0)
 ; Reference to ^GMRAPEM0 is supported by DBIA #190.
"RTN","PSJLMUTL",10,0)
 ; Reference to ^SDAMA203 is supported by DBIA #4133.
"RTN","PSJLMUTL",11,0)
 ; Reference to ^VSIT is supported by DBIA #1905.
"RTN","PSJLMUTL",12,0)
 ;
"RTN","PSJLMUTL",13,0)
NEWALL(DFN) ; Enter Allergy info.
"RTN","PSJLMUTL",14,0)
 ;
"RTN","PSJLMUTL",15,0)
 D FULL^VALM1,EN2^GMRAPEM0
"RTN","PSJLMUTL",16,0)
 Q
"RTN","PSJLMUTL",17,0)
DISALL(DFN) ; Display brief patient info list.
"RTN","PSJLMUTL",18,0)
 K ^TMP("PSJALL",$J) N PSJLN,X,Y,PSGALG,PSGRALG,PSGLDR,PSJGMRAL,PSJWHERE S PSJWHERE="PSJLMUTL"
"RTN","PSJLMUTL",19,0)
 D ATS^PSJMUTL(57,57,2)
"RTN","PSJLMUTL",20,0)
 I (PSJGMRAL=0) S ^TMP("PSJALL",$J,1,0)=" Allergies/Reactions: "_"NKA",PSJLN=2 G NARRATIV
"RTN","PSJLMUTL",21,0)
 I (PSJGMRAL="") S ^TMP("PSJALL",$J,1,0)=" Allergies/Reactions: No Allergy Assessment",PSJLN=2 G NARRATIV
"RTN","PSJLMUTL",22,0)
 I ($G(PSGVALG(1))="NKA")!((PSGVALG=0)&(PSGALG=0)) D
"RTN","PSJLMUTL",23,0)
 .S ^TMP("PSJALL",$J,1,0)="           Allergies: "_$G(PSGVALG(1)),PSJLN=2,X=1
"RTN","PSJLMUTL",24,0)
 I ($G(PSGVALG(1))'="NKA")&((PSGVALG>0)!(PSGALG>0)) D
"RTN","PSJLMUTL",25,0)
 .S ^TMP("PSJALL",$J,1,0)="Allergies - Verified: "_$G(PSGVALG(1)),PSJLN=2,X=1
"RTN","PSJLMUTL",26,0)
 .F  S X=$O(PSGVALG(X)) Q:'X  S ^TMP("PSJALL",$J,PSJLN,0)="                        "_PSGVALG(X),PSJLN=PSJLN+1
"RTN","PSJLMUTL",27,0)
 .S ^TMP("PSJALL",$J,PSJLN,0)="        Non-Verified: "_$S($G(PSGALG(1))=0:"",1:$G(PSGALG(1))),PSJLN=PSJLN+1,X=1
"RTN","PSJLMUTL",28,0)
 .F  S X=$O(PSGALG(X)) Q:'X  S ^TMP("PSJALL",$J,PSJLN,0)="                        "_PSGALG(X),PSJLN=PSJLN+1
"RTN","PSJLMUTL",29,0)
 D RAD^PSJMUTL
"RTN","PSJLMUTL",30,0)
 I ($G(PSGVADR(1))="NKA")!((PSGVADR=0)&(PSGADR=0)) D
"RTN","PSJLMUTL",31,0)
 .S ^TMP("PSJALL",$J,PSJLN,0)="",^TMP("PSJALL",$J,PSJLN+1,0)="   Adverse Reactions: "_$G(PSGADR(1)),PSJLN=PSJLN+2,X=1
"RTN","PSJLMUTL",32,0)
 I ($G(PSGVADR(1))'="NKA")&((PSGVADR>0)!(PSGADR>0)) D
"RTN","PSJLMUTL",33,0)
 .S ^TMP("PSJALL",$J,PSJLN,0)="",^TMP("PSJALL",$J,PSJLN+1,0)="Reactions - Verified: "_$G(PSGVADR(1)),PSJLN=PSJLN+2,X=1
"RTN","PSJLMUTL",34,0)
 .F  S X=$O(PSGVADR(X)) Q:'X  S ^TMP("PSJALL",$J,PSJLN,0)="              "_PSGVADR(X),PSJLN=PSJLN+1
"RTN","PSJLMUTL",35,0)
 .S ^TMP("PSJALL",$J,PSJLN,0)="        Non-Verified: "_$G(PSGADR(1)),PSJLN=PSJLN+2,X=1
"RTN","PSJLMUTL",36,0)
 .F  S X=$O(PSGADR(X)) Q:'X  S ^TMP("PSJALL",$J,PSJLN,0)="              "_PSGADR(X),PSJLN=PSJLN+1
"RTN","PSJLMUTL",37,0)
 ;
"RTN","PSJLMUTL",38,0)
NARRATIV ; print inpatient/outpatient narratives
"RTN","PSJLMUTL",39,0)
 N PSJCLHD
"RTN","PSJLMUTL",40,0)
 S ^TMP("PSJALL",$J,PSJLN,0)="" D SETNAR("PSJALL",$G(^PS(55,DFN,5.3)),"In")
"RTN","PSJLMUTL",41,0)
 S ^TMP("PSJALL",$J,PSJLN+1,0)="" D SETNAR("PSJALL",$G(^PS(55,DFN,1)),"Out")
"RTN","PSJLMUTL",42,0)
 D SDA S PSJLN=0 F X=0:0 S X=$O(^TMP("PSJALL",$J,X)) Q:'X  S PSJLN=PSJLN+1
"RTN","PSJLMUTL",43,0)
 I '$G(PSJCLHD)!'$G(VALMCNT) S VALMCNT=PSJLN
"RTN","PSJLMUTL",44,0)
 Q
"RTN","PSJLMUTL",45,0)
 ;
"RTN","PSJLMUTL",46,0)
SDA N PSJPAD,PSJCLIN,PSJCLINO,PSJAPD,PSJSCI,PSJCLOK,VAERR K ^TMP("PSJVSIT"),PSJDBUN S $P(PSJPAD," ",26)=" "
"RTN","PSJLMUTL",47,0)
 Q:'$$PATCH^XPDUTL("SD*5.3*285")
"RTN","PSJLMUTL",48,0)
 D NOW^%DTC S VASD("F")=$P(%,".")-1
"RTN","PSJLMUTL",49,0)
 D SDA^VADPT S:$G(VAERR)=2 (PSJCLHD,PSJDBUN)=2 I $O(^UTILITY("VASD",$J,"")) M PSJUTL=^UTILITY("VASD",$J) D
"RTN","PSJLMUTL",50,0)
 . S PSJSCDT0=0
"RTN","PSJLMUTL",51,0)
 . F  S PSJSCDT0=$O(PSJUTL(PSJSCDT0)) Q:'PSJSCDT0  D
"RTN","PSJLMUTL",52,0)
 .. S PSJCLINO=$P($G(PSJUTL(PSJSCDT0,"E")),U,2),PSJCLIN=$P($G(PSJUTL(PSJSCDT0,"I")),U,2)
"RTN","PSJLMUTL",53,0)
 .. S PSJSCI=$G(PSJUTL(PSJSCDT0,"I")),PSJAPD=$$FMTE^XLFDT(+PSJSCI) Q:(PSJCLIN="")!(PSJAPD="")
"RTN","PSJLMUTL",54,0)
 .. S PSJCLOK=1 D SDAUTHCL^SDAMA203(PSJCLIN,.PSJCLOK) Q:(PSJCLOK<1)
"RTN","PSJLMUTL",55,0)
 .. S ^TMP("PSJVSIT",$J,+PSJSCI,PSJCLIN,"V")=$E(PSJCLINO_PSJPAD,1,25)_"  "_$TR(PSJAPD,"@","/"),PSJCLHD=1
"RTN","PSJLMUTL",56,0)
 .. D ENC(DFN,PSJCLIN)
"RTN","PSJLMUTL",57,0)
 I $G(PSJCLHD) S PSJLN=PSJLN+1 S ^TMP("PSJALL",$J,PSJLN,0)="Clinic:"_$E(PSJPAD,1,20)_"Date/Time of Appointment:",PSJLN=PSJLN+1 I $G(PSJCLHD)=2 D
"RTN","PSJLMUTL",58,0)
 . S ^TMP("PSJALL",$J,PSJLN,0)=" Scheduling database is unavailable",PSJLN=PSJLN+1
"RTN","PSJLMUTL",59,0)
 N VDAT S VDAT=0 F  S VDAT=$O(^TMP("PSJVSIT",$J,VDAT)) Q:'VDAT  S VCLIN=0 F  S VCLIN=$O(^TMP("PSJVSIT",$J,VDAT,VCLIN)) Q:'VCLIN  D
"RTN","PSJLMUTL",60,0)
 . F VTYP="E","V" S VDATA=$G(^TMP("PSJVSIT",$J,VDAT,VCLIN,VTYP)) I VDATA]"" S ^TMP("PSJALL",$J,PSJLN,0)=VDATA,PSJLN=PSJLN+1
"RTN","PSJLMUTL",61,0)
 I $G(PSJCLHD) S VALMCNT=((PSJLN+11\11)*11),PSJX=$O(^TMP("PSJALL",$J,9999),-1) ; F I=PSJX:1:VALMCNT S ^TMP("PSJALL",$J,I,0)=""
"RTN","PSJLMUTL",62,0)
 K PSJUTL,PSJCLHD
"RTN","PSJLMUTL",63,0)
 Q
"RTN","PSJLMUTL",64,0)
 ;
"RTN","PSJLMUTL",65,0)
ENC(SDPATDFN,SDCLIEN) ;
"RTN","PSJLMUTL",66,0)
 N SDFROM,DT,SUBVIS,VIS S SDSTART=$$FMADD^XLFDT($P(PSGDT,"."),-1),SDEND=$$FMADD^XLFDT($P(PSGDT,"."),+365) K ^TMP("VSIT",$J)
"RTN","PSJLMUTL",67,0)
 D SELECTED^VSIT(SDPATDFN,SDSTART,SDEND,SDCLIEN) N VIS S VIS=0 F  S VIS=$O(^TMP("VSIT",$J,VIS)) Q:'VIS  D
"RTN","PSJLMUTL",68,0)
 . S SUBVIS=0 F  S SUBVIS=$O(^TMP("VSIT",$J,VIS,SUBVIS)) Q:'SUBVIS  D
"RTN","PSJLMUTL",69,0)
 .. S PSJSCI=$P(^TMP("VSIT",$J,VIS,SUBVIS),U),PSJAPD=$$FMTE^XLFDT(PSJSCI,1) Q:PSJSCI<1!(PSJAPD="")
"RTN","PSJLMUTL",70,0)
 .. S ^TMP("PSJVSIT",$J,PSJSCI,PSJCLIN,"E")=$E(PSJCLINO_PSJPAD,1,25)_"  "_$TR(PSJAPD,"@","/")_" *Encounter",PSJCLHD=1
"RTN","PSJLMUTL",71,0)
 Q
"RTN","PSJLMUTL",72,0)
 ;
"RTN","PSJLMUTL",73,0)
SETNAR(SUB,NARR,TYPE) ; Set up Narrative info.
"RTN","PSJLMUTL",74,0)
 S NARR=TYPE_"patient Narrative: "_NARR,Y="" S:TYPE="In" NARR=" "_NARR
"RTN","PSJLMUTL",75,0)
 S START=1 F  D  Q:NARR=""
"RTN","PSJLMUTL",76,0)
 .I $L($P(NARR," "))>79 S PSJ=$E(NARR,START,START+79),NARR=$E(NARR,START+80,$L(NARR)) Q
"RTN","PSJLMUTL",77,0)
 .I $L(NARR)>79 S PSJ=$P(NARR," ",1,$L($E(NARR,1,80)," ")-1),NARR=$E($P(NARR,PSJ,2),2,$L(NARR)) D SET Q
"RTN","PSJLMUTL",78,0)
 .S PSJ=NARR,NARR="" D SET
"RTN","PSJLMUTL",79,0)
 Q
"RTN","PSJLMUTL",80,0)
 ;
"RTN","PSJLMUTL",81,0)
SET ; Set ^TMP for narratives.
"RTN","PSJLMUTL",82,0)
 S ^TMP(SUB,$J,PSJLN,0)=PSJ,PSJLN=PSJLN+1
"RTN","PSJLMUTL",83,0)
 Q
"RTN","PSJLMUTL",84,0)
 ;
"RTN","PSJLMUTL",85,0)
ACTIONS() ;
"RTN","PSJLMUTL",86,0)
 N DIC,X,Y
"RTN","PSJLMUTL",87,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLMUTL",88,0)
 I Y="PSJ LM DC" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",89,0)
 I Y="PSJU LM EDIT" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLMUTL",90,0)
 I Y="PSJU LM RENEW" Q $S(PSGACT["R":1,1:0)
"RTN","PSJLMUTL",91,0)
 I Y="PSJ LM HOLD" Q $S(PSGACT["H":1,1:0)
"RTN","PSJLMUTL",92,0)
 I Y="PSJU LM VERIFY" Q $S(PSGACT["V":1,1:0)
"RTN","PSJLMUTL",93,0)
 I Y="PSJ LM EDIT NEW" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLMUTL",94,0)
 I Y="PSJ LM FLAG" Q $S(PSGACT["G":1,1:0)
"RTN","PSJLMUTL",95,0)
 Q 1
"RTN","PSJLMUTL",96,0)
RNACT() ;
"RTN","PSJLMUTL",97,0)
 I '$G(PSJRNF),'$G(PSJIRNF) Q 0
"RTN","PSJLMUTL",98,0)
 NEW X S X=$G(^PS(53.1,+PSJORD,0))
"RTN","PSJLMUTL",99,0)
 S PSGACT=""
"RTN","PSJLMUTL",100,0)
 I $S(+$P(X,U,13):1,$G(PSJRNF)&($P(X,U,4)="U"):1,$G(PSJIRNF)&($P(X,U,4)'="U"):1,1:0) S PSGACT="BFDE"
"RTN","PSJLMUTL",101,0)
 NEW X,Y
"RTN","PSJLMUTL",102,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLMUTL",103,0)
 I Y="PSJ LM DC" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",104,0)
 I Y="PSJ LM BYPASS" Q $S(PSGACT["B":1,1:0)
"RTN","PSJLMUTL",105,0)
 I Y="PSJ LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLMUTL",106,0)
 I Y="PSJI LM DISCONTINUE" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",107,0)
 I Y="PSJI LM EDIT" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLMUTL",108,0)
 I Y="PSJI LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLMUTL",109,0)
 I Y="PSJ LM FLAG" Q 0
"RTN","PSJLMUTL",110,0)
 Q 1
"RTN","PSJLMUTL",111,0)
 ;
"RTN","PSJLMUTL",112,0)
TECHACT() ; Allowable actions for IV technician (PSJI PHARM TECH)
"RTN","PSJLMUTL",113,0)
 Q:'$G(PSJITECH) 0
"RTN","PSJLMUTL",114,0)
 NEW X S X=$G(^PS(53.1,+PSJORD,0))
"RTN","PSJLMUTL",115,0)
 I $S(+$P(X,U,13):1,$P(X,U,4)'="U":1,1:0) S PSGACT="F"
"RTN","PSJLMUTL",116,0)
 N DIC,X,Y
"RTN","PSJLMUTL",117,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLMUTL",118,0)
 I Y="PSJ LM DC" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",119,0)
 I Y="PSJ LM BYPASS" Q $S(PSGACT["B":1,1:0)
"RTN","PSJLMUTL",120,0)
 I Y="PSJ LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLMUTL",121,0)
 I Y="PSJI LM DISCONTINUE" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLMUTL",122,0)
 I Y="PSJI LM EDIT" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLMUTL",123,0)
 I Y="PSJI LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLMUTL",124,0)
 I Y="PSJ LM FLAG" Q 0
"RTN","PSJLMUTL",125,0)
 Q 1
"RTN","PSJLMUTL",126,0)
PATINFO()         ; Determines if detailed allergy info can be displayed.
"RTN","PSJLMUTL",127,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLMUTL",128,0)
 I Y="PSJ LM SHOW PROFILE",$D(PSJLMPRO) Q 0
"RTN","PSJLMUTL",129,0)
 Q 1
"RTN","PSJLMUTL",130,0)
HIDDEN(CHK) ; Determines if certain Hidden actions are to be available.
"RTN","PSJLMUTL",131,0)
 I CHK="JUMP",'$G(PSJPNV) D NA("Jump is only available through Non-Verified/Pending Orders option.") Q 0
"RTN","PSJLMUTL",132,0)
 I CHK="SPEED",'$D(PSJUDPRF) D NA("Speed options are only available from the Unit Dose Order Entry Profile.") Q 0
"RTN","PSJLMUTL",133,0)
 ;PSJ*5*198;GMZ;Remove copy function from this option
"RTN","PSJLMUTL",134,0)
 I CHK="COPY",('$D(PSGACT)!($G(PSGACT)="")) D NA("Copy is not allowed from this option.") Q 0
"RTN","PSJLMUTL",135,0)
 Q 1
"RTN","PSJLMUTL",136,0)
 ;
"RTN","PSJLMUTL",137,0)
NA(TXT) ;
"RTN","PSJLMUTL",138,0)
 D FULL^VALM1 W !!,TXT,!! N DIR S DIR(0)="E" D ^DIR
"RTN","PSJLMUTL",139,0)
 Q
"RTN","PSJLMUTL",140,0)
 ;
"RTN","PSJLMUTL",141,0)
UPR(DFN)         ; UPDATE PATIENT SPECIFIC DATA IN 55
"RTN","PSJLMUTL",142,0)
 N DIE,DR S PSJC10=VALMCNT
"RTN","PSJLMUTL",143,0)
 S DA=DFN,DIE="^PS(55,",DR="62.2;62.01" D ^DIE,DISALL^PSJLMUTL(DFN)
"RTN","PSJLMUTL",144,0)
 S VALMCNT=PSJC10 K PSJC10
"RTN","PSJLMUTL",145,0)
 Q
"RTN","PSJLMUTL",146,0)
 ;
"RTN","PSJLMUTL",147,0)
DETALL(DFN)        ; Enter Detailed Allergy Display list.
"RTN","PSJLMUTL",148,0)
 D EN^VALM("PSJ LM ALLERGY DISPLAY")
"RTN","PSJLMUTL",149,0)
 Q
"RTN","PSJLMUTL",150,0)
BRFALL(DFN)        ;
"RTN","PSJLMUTL",151,0)
 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJLMUTL",152,0)
 Q
"RTN","PSJLMUTL",153,0)
PAUSE ;
"RTN","PSJLMUTL",154,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","PSJLMUTL",155,0)
 Q
"RTN","PSJLMUTL",156,0)
DRUGNAME(DFN,ON) ; Find drug name to display
"RTN","PSJLMUTL",157,0)
 ;If order is in 55:
"RTN","PSJLMUTL",158,0)
 ;.If Dosage Ordered is found, returns OI_U_Dosage Ordered.
"RTN","PSJLMUTL",159,0)
 ;.If no Dosage Ordered, returns Dispense Drug only.
"RTN","PSJLMUTL",160,0)
 ;If order in 53.1:
"RTN","PSJLMUTL",161,0)
 ;.If Dosage Ordered, returns OI_U_Dosage Ordered.
"RTN","PSJLMUTL",162,0)
 ;.If Dispense Drug is found, returns Dispense Drug name_U_Instructions.
"RTN","PSJLMUTL",163,0)
 ;.If no dispense drug, returns OI_U_Instructions.
"RTN","PSJLMUTL",164,0)
 I ON["U" D  Q DN
"RTN","PSJLMUTL",165,0)
 .S OIND=$G(^PS(55,DFN,5,+ON,.2))
"RTN","PSJLMUTL",166,0)
 .I $P(OIND,U,2)]"",($G(^PS(50.7,+OIND,0))]"") S DN=$$OINAME(OIND)_U_.2 Q
"RTN","PSJLMUTL",167,0)
 .S X=+$O(^PS(55,DFN,5,+ON,1,0)),X=$G(^PS(55,DFN,5,+ON,1,X,0)) I $P(X,U)]"" S DN=$$DDNAME(+X)_"^^"_$P(X,"^",2) Q  ;$S($P(OIND,U,2)]"":.2,1:.3) Q
"RTN","PSJLMUTL",168,0)
 .S DN=$$OINAME(+OIND)_U_.3 Q
"RTN","PSJLMUTL",169,0)
 S OIND=$G(^PS(53.1,+ON,.2)) Q:$P(OIND,U,2)]"" $$OINAME(OIND)_U_.2
"RTN","PSJLMUTL",170,0)
 S X=+$O(^PS(53.1,+ON,1,0)) I X,'$O(^PS(53.1,+ON,1,X)) S X=$G(^PS(53.1,+ON,1,X,0)) I $P(X,U)]"" Q $$DDNAME(+X)_U_.3_$P(X,"^",2)
"RTN","PSJLMUTL",171,0)
 Q $$OINAME(OIND)_U_.3
"RTN","PSJLMUTL",172,0)
 ;
"RTN","PSJLMUTL",173,0)
DDNAME(X) ; 
"RTN","PSJLMUTL",174,0)
 Q $$FOUND($P($G(^PSDRUG(+X,0)),U),X,"PSDRUG(,")
"RTN","PSJLMUTL",175,0)
 ;
"RTN","PSJLMUTL",176,0)
OINAME(ND) ; Return Orderable Item Name_" "_Dose Form_U_Dosage Ordered
"RTN","PSJLMUTL",177,0)
 N DF,DNME,X
"RTN","PSJLMUTL",178,0)
 S X=$G(^PS(50.7,+ND,0)),DNME="" S:X]"" DF=$P($G(^PS(50.606,+$P(X,U,2),0)),U),DNME=$P(X,U)_" "_DF
"RTN","PSJLMUTL",179,0)
 Q $$FOUND(DNME,+ND,"PS(50.7")
"RTN","PSJLMUTL",180,0)
 ;
"RTN","PSJLMUTL",181,0)
FOUND(DNME,DN,FN) ;
"RTN","PSJLMUTL",182,0)
 Q $S(DNME]"":DNME,1:"NOT FOUND "_DN_";"_FN)
"VER")
8.0^22.0
"BLD",7599,6)
^186
**END**
**END**
