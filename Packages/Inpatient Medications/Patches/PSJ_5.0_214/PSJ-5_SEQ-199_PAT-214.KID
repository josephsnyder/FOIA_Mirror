Released PSJ*5*214 SEQ #199
Extracted from mail message
**KIDS**:PSJ*5.0*214^

**INSTALL NAME**
PSJ*5.0*214
"BLD",6941,0)
PSJ*5.0*214^INPATIENT MEDICATIONS^0^3090723^y
"BLD",6941,1,0)
^^76^76^3090720^
"BLD",6941,1,1,0)
Patches PSJ*5*214 and PSN*4*193 are being released as part of the Class
"BLD",6941,1,2,0)
III to Class I conversion process.  In combination, the two 
"BLD",6941,1,3,0)
patches address the need to provide multidivisional functionality within
"BLD",6941,1,4,0)
the Inpatient Medications package's Patients on Specific Drug(s) [PSJ
"BLD",6941,1,5,0)
PDV] option. PSN*4*193 provides support within the National Drug File
"BLD",6941,1,6,0)
package and PSJ*5*214 delivers the enhanced functionality of the Patients
"BLD",6941,1,7,0)
on Specific Drug(s) [PSJ PDV] option.
"BLD",6941,1,8,0)
  
"BLD",6941,1,9,0)
This patch contains the following items:
"BLD",6941,1,10,0)
 
"BLD",6941,1,11,0)
1. The option would quit prematurely after the user entered an up-arrow to
"BLD",6941,1,12,0)
exit a previous attempt to generate the report.
"BLD",6941,1,13,0)
 
"BLD",6941,1,14,0)
Problem:
"BLD",6941,1,15,0)
--------
"BLD",6941,1,16,0)
The variable QFLG used to denote the user's attempt to quit the option was
"BLD",6941,1,17,0)
left defined following the aborted report attempt.
"BLD",6941,1,18,0)
 
"BLD",6941,1,19,0)
Resolution:
"BLD",6941,1,20,0)
-----------
"BLD",6941,1,21,0)
Routine PSJPDV updated to NEW variable QFLG.
"BLD",6941,1,22,0)
 
"BLD",6941,1,23,0)
2. To generate a report for all drugs within a parent drug class required 
"BLD",6941,1,24,0)
entry of each child class when specifying the report parameters.
"BLD",6941,1,25,0)
 
"BLD",6941,1,26,0)
Problem:
"BLD",6941,1,27,0)
--------
"BLD",6941,1,28,0)
There was no cross-reference in the VA DRUG CLASS file (#50.605) to
"BLD",6941,1,29,0)
determine the relationship between parent drug classes and 
"BLD",6941,1,30,0)
child drug classes.
"BLD",6941,1,31,0)
 
"BLD",6941,1,32,0)
Resolution:
"BLD",6941,1,33,0)
-----------
"BLD",6941,1,34,0)
Patch PSN*4*193 introduces the necessary cross-reference, which is 
"BLD",6941,1,35,0)
utilized by this patch to allow a user to enter a parent drug class.  The 
"BLD",6941,1,36,0)
system will then select all of the drugs in the hierarchy of that parent 
"BLD",6941,1,37,0)
class.
"BLD",6941,1,38,0)
 
"BLD",6941,1,39,0)
3.  The default response for the Number of Matches prompt did not 
"BLD",6941,1,40,0)
reflect the most common answer to that question.
"BLD",6941,1,41,0)
 
"BLD",6941,1,42,0)
Problem:
"BLD",6941,1,43,0)
--------
"BLD",6941,1,44,0)
Current functionality would count the number of unique entries selected 
"BLD",6941,1,45,0)
by the user and present that number as a default response to the Number 
"BLD",6941,1,46,0)
of Matches prompt.  This assumed that a patient had to have all of the 
"BLD",6941,1,47,0)
selected drugs in their profile in order to be listed in the final report.
"BLD",6941,1,48,0)
 
"BLD",6941,1,49,0)
Resolution:
"BLD",6941,1,50,0)
-----------
"BLD",6941,1,51,0)
The default is changed to 1, reflecting a report in which the patient can 
"BLD",6941,1,52,0)
be on any of the selected drugs in order to be listed on the report.  The 
"BLD",6941,1,53,0)
user can still enter a higher number to employ the previously defaulted 
"BLD",6941,1,54,0)
functionality.
"BLD",6941,1,55,0)
 
"BLD",6941,1,56,0)
4.  The existing program did not include functionality to support the 
"BLD",6941,1,57,0)
reporting needs of integrated or multidivisional facilities.
"BLD",6941,1,58,0)
 
"BLD",6941,1,59,0)
Problem:
"BLD",6941,1,60,0)
--------
"BLD",6941,1,61,0)
The report parameters do not ask for limitation of the output to 
"BLD",6941,1,62,0)
specified divisions, wards, or ward groups.  The resulting list always 
"BLD",6941,1,63,0)
included all patients meeting the criteria across an entire VistA 
"BLD",6941,1,64,0)
database.
"BLD",6941,1,65,0)
 
"BLD",6941,1,66,0)
Resolution:
"BLD",6941,1,67,0)
-----------
"BLD",6941,1,68,0)
A prompt is added to allow the user to select the DIVISION(s)
"BLD",6941,1,69,0)
from which patients will be reported.  Sites that have only 1 division
"BLD",6941,1,70,0)
associated with all of their inpatient wards will not see this new prompt.
"BLD",6941,1,71,0)
 
"BLD",6941,1,72,0)
A prompt is added to allow the user to select the WARDS(s) from which
"BLD",6941,1,73,0)
patients will be reported.
"BLD",6941,1,74,0)
 
"BLD",6941,1,75,0)
If no selection is made for the division or ward prompt, the user will 
"BLD",6941,1,76,0)
be allowed to select one WARD GROUP from which patients will be reported.
"BLD",6941,4,0)
^9.64PA^^
"BLD",6941,6.3)
8
"BLD",6941,"KRN",0)
^9.67PA^779.2^20
"BLD",6941,"KRN",.4,0)
.4
"BLD",6941,"KRN",.401,0)
.401
"BLD",6941,"KRN",.402,0)
.402
"BLD",6941,"KRN",.403,0)
.403
"BLD",6941,"KRN",.5,0)
.5
"BLD",6941,"KRN",.84,0)
.84
"BLD",6941,"KRN",3.6,0)
3.6
"BLD",6941,"KRN",3.8,0)
3.8
"BLD",6941,"KRN",9.2,0)
9.2
"BLD",6941,"KRN",9.8,0)
9.8
"BLD",6941,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",6941,"KRN",9.8,"NM",1,0)
PSJPDV^^0^B53702138
"BLD",6941,"KRN",9.8,"NM",2,0)
PSJPDV0^^0^B28813203
"BLD",6941,"KRN",9.8,"NM",4,0)
PSJQUTIL^^0^B569952
"BLD",6941,"KRN",9.8,"NM","B","PSJPDV",1)

"BLD",6941,"KRN",9.8,"NM","B","PSJPDV0",2)

"BLD",6941,"KRN",9.8,"NM","B","PSJQUTIL",4)

"BLD",6941,"KRN",19,0)
19
"BLD",6941,"KRN",19.1,0)
19.1
"BLD",6941,"KRN",101,0)
101
"BLD",6941,"KRN",409.61,0)
409.61
"BLD",6941,"KRN",771,0)
771
"BLD",6941,"KRN",779.2,0)
779.2
"BLD",6941,"KRN",870,0)
870
"BLD",6941,"KRN",8989.51,0)
8989.51
"BLD",6941,"KRN",8989.52,0)
8989.52
"BLD",6941,"KRN",8994,0)
8994
"BLD",6941,"KRN","B",.4,.4)

"BLD",6941,"KRN","B",.401,.401)

"BLD",6941,"KRN","B",.402,.402)

"BLD",6941,"KRN","B",.403,.403)

"BLD",6941,"KRN","B",.5,.5)

"BLD",6941,"KRN","B",.84,.84)

"BLD",6941,"KRN","B",3.6,3.6)

"BLD",6941,"KRN","B",3.8,3.8)

"BLD",6941,"KRN","B",9.2,9.2)

"BLD",6941,"KRN","B",9.8,9.8)

"BLD",6941,"KRN","B",19,19)

"BLD",6941,"KRN","B",19.1,19.1)

"BLD",6941,"KRN","B",101,101)

"BLD",6941,"KRN","B",409.61,409.61)

"BLD",6941,"KRN","B",771,771)

"BLD",6941,"KRN","B",779.2,779.2)

"BLD",6941,"KRN","B",870,870)

"BLD",6941,"KRN","B",8989.51,8989.51)

"BLD",6941,"KRN","B",8989.52,8989.52)

"BLD",6941,"KRN","B",8994,8994)

"BLD",6941,"QUES",0)
^9.62^^
"BLD",6941,"REQB",0)
^9.611^4^3
"BLD",6941,"REQB",1,0)
PSJ*5.0*33^2
"BLD",6941,"REQB",3,0)
PSJ*5.0*67^2
"BLD",6941,"REQB",4,0)
PSN*4.0*193^2
"BLD",6941,"REQB","B","PSJ*5.0*33",1)

"BLD",6941,"REQB","B","PSJ*5.0*67",3)

"BLD",6941,"REQB","B","PSN*4.0*193",4)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
214^3090723^11893
"PKG",197,22,1,"PAH",1,1,0)
^^76^76^3090723
"PKG",197,22,1,"PAH",1,1,1,0)
Patches PSJ*5*214 and PSN*4*193 are being released as part of the Class
"PKG",197,22,1,"PAH",1,1,2,0)
III to Class I conversion process.  In combination, the two 
"PKG",197,22,1,"PAH",1,1,3,0)
patches address the need to provide multidivisional functionality within
"PKG",197,22,1,"PAH",1,1,4,0)
the Inpatient Medications package's Patients on Specific Drug(s) [PSJ
"PKG",197,22,1,"PAH",1,1,5,0)
PDV] option. PSN*4*193 provides support within the National Drug File
"PKG",197,22,1,"PAH",1,1,6,0)
package and PSJ*5*214 delivers the enhanced functionality of the Patients
"PKG",197,22,1,"PAH",1,1,7,0)
on Specific Drug(s) [PSJ PDV] option.
"PKG",197,22,1,"PAH",1,1,8,0)
  
"PKG",197,22,1,"PAH",1,1,9,0)
This patch contains the following items:
"PKG",197,22,1,"PAH",1,1,10,0)
 
"PKG",197,22,1,"PAH",1,1,11,0)
1. The option would quit prematurely after the user entered an up-arrow to
"PKG",197,22,1,"PAH",1,1,12,0)
exit a previous attempt to generate the report.
"PKG",197,22,1,"PAH",1,1,13,0)
 
"PKG",197,22,1,"PAH",1,1,14,0)
Problem:
"PKG",197,22,1,"PAH",1,1,15,0)
--------
"PKG",197,22,1,"PAH",1,1,16,0)
The variable QFLG used to denote the user's attempt to quit the option was
"PKG",197,22,1,"PAH",1,1,17,0)
left defined following the aborted report attempt.
"PKG",197,22,1,"PAH",1,1,18,0)
 
"PKG",197,22,1,"PAH",1,1,19,0)
Resolution:
"PKG",197,22,1,"PAH",1,1,20,0)
-----------
"PKG",197,22,1,"PAH",1,1,21,0)
Routine PSJPDV updated to NEW variable QFLG.
"PKG",197,22,1,"PAH",1,1,22,0)
 
"PKG",197,22,1,"PAH",1,1,23,0)
2. To generate a report for all drugs within a parent drug class required 
"PKG",197,22,1,"PAH",1,1,24,0)
entry of each child class when specifying the report parameters.
"PKG",197,22,1,"PAH",1,1,25,0)
 
"PKG",197,22,1,"PAH",1,1,26,0)
Problem:
"PKG",197,22,1,"PAH",1,1,27,0)
--------
"PKG",197,22,1,"PAH",1,1,28,0)
There was no cross-reference in the VA DRUG CLASS file (#50.605) to
"PKG",197,22,1,"PAH",1,1,29,0)
determine the relationship between parent drug classes and 
"PKG",197,22,1,"PAH",1,1,30,0)
child drug classes.
"PKG",197,22,1,"PAH",1,1,31,0)
 
"PKG",197,22,1,"PAH",1,1,32,0)
Resolution:
"PKG",197,22,1,"PAH",1,1,33,0)
-----------
"PKG",197,22,1,"PAH",1,1,34,0)
Patch PSN*4*193 introduces the necessary cross-reference, which is 
"PKG",197,22,1,"PAH",1,1,35,0)
utilized by this patch to allow a user to enter a parent drug class.  The 
"PKG",197,22,1,"PAH",1,1,36,0)
system will then select all of the drugs in the hierarchy of that parent 
"PKG",197,22,1,"PAH",1,1,37,0)
class.
"PKG",197,22,1,"PAH",1,1,38,0)
 
"PKG",197,22,1,"PAH",1,1,39,0)
3.  The default response for the Number of Matches prompt did not 
"PKG",197,22,1,"PAH",1,1,40,0)
reflect the most common answer to that question.
"PKG",197,22,1,"PAH",1,1,41,0)
 
"PKG",197,22,1,"PAH",1,1,42,0)
Problem:
"PKG",197,22,1,"PAH",1,1,43,0)
--------
"PKG",197,22,1,"PAH",1,1,44,0)
Current functionality would count the number of unique entries selected 
"PKG",197,22,1,"PAH",1,1,45,0)
by the user and present that number as a default response to the Number 
"PKG",197,22,1,"PAH",1,1,46,0)
of Matches prompt.  This assumed that a patient had to have all of the 
"PKG",197,22,1,"PAH",1,1,47,0)
selected drugs in their profile in order to be listed in the final report.
"PKG",197,22,1,"PAH",1,1,48,0)
 
"PKG",197,22,1,"PAH",1,1,49,0)
Resolution:
"PKG",197,22,1,"PAH",1,1,50,0)
-----------
"PKG",197,22,1,"PAH",1,1,51,0)
The default is changed to 1, reflecting a report in which the patient can 
"PKG",197,22,1,"PAH",1,1,52,0)
be on any of the selected drugs in order to be listed on the report.  The 
"PKG",197,22,1,"PAH",1,1,53,0)
user can still enter a higher number to employ the previously defaulted 
"PKG",197,22,1,"PAH",1,1,54,0)
functionality.
"PKG",197,22,1,"PAH",1,1,55,0)
 
"PKG",197,22,1,"PAH",1,1,56,0)
4.  The existing program did not include functionality to support the 
"PKG",197,22,1,"PAH",1,1,57,0)
reporting needs of integrated or multidivisional facilities.
"PKG",197,22,1,"PAH",1,1,58,0)
 
"PKG",197,22,1,"PAH",1,1,59,0)
Problem:
"PKG",197,22,1,"PAH",1,1,60,0)
--------
"PKG",197,22,1,"PAH",1,1,61,0)
The report parameters do not ask for limitation of the output to 
"PKG",197,22,1,"PAH",1,1,62,0)
specified divisions, wards, or ward groups.  The resulting list always 
"PKG",197,22,1,"PAH",1,1,63,0)
included all patients meeting the criteria across an entire VistA 
"PKG",197,22,1,"PAH",1,1,64,0)
database.
"PKG",197,22,1,"PAH",1,1,65,0)
 
"PKG",197,22,1,"PAH",1,1,66,0)
Resolution:
"PKG",197,22,1,"PAH",1,1,67,0)
-----------
"PKG",197,22,1,"PAH",1,1,68,0)
A prompt is added to allow the user to select the DIVISION(s)
"PKG",197,22,1,"PAH",1,1,69,0)
from which patients will be reported.  Sites that have only 1 division
"PKG",197,22,1,"PAH",1,1,70,0)
associated with all of their inpatient wards will not see this new prompt.
"PKG",197,22,1,"PAH",1,1,71,0)
 
"PKG",197,22,1,"PAH",1,1,72,0)
A prompt is added to allow the user to select the WARDS(s) from which
"PKG",197,22,1,"PAH",1,1,73,0)
patients will be reported.
"PKG",197,22,1,"PAH",1,1,74,0)
 
"PKG",197,22,1,"PAH",1,1,75,0)
If no selection is made for the division or ward prompt, the user will 
"PKG",197,22,1,"PAH",1,1,76,0)
be allowed to select one WARD GROUP from which patients will be reported.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSJPDV")
0^1^B53702138^B41734306
"RTN","PSJPDV",1,0)
PSJPDV ;BIR/KKA-LIST PATIENTS ON SPECIFIC DRUGS ; 7/23/09 10:33am
"RTN","PSJPDV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,22,30,50,67,214**;16 DEC 97;Build 8
"RTN","PSJPDV",3,0)
 ;
"RTN","PSJPDV",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJPDV",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJPDV",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJPDV",7,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSJPDV",8,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJPDV",9,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJPDV",10,0)
 ; Reference to ^PS(50.605 is supported by DBIA# 696.
"RTN","PSJPDV",11,0)
 ; Reference to ^%DT is supported by DBIA# 10003.
"RTN","PSJPDV",12,0)
 ; Reference to ^%ZISC is supported by DBIA# 10089.
"RTN","PSJPDV",13,0)
 ; Reference to ^DIC is supported by DBIA# 10006.
"RTN","PSJPDV",14,0)
 ; Reference to ^DIR is supported by DBIA# 10026.
"RTN","PSJPDV",15,0)
 ; Reference to ^VAUTOMA is supported by DBIA# 664.
"RTN","PSJPDV",16,0)
 ;
"RTN","PSJPDV",17,0)
DATES ;prompt user for the range of dates
"RTN","PSJPDV",18,0)
 N QFLG,OUT
"RTN","PSJPDV",19,0)
 W ! S %DT="ETX",D="start" D DT G:Y'>0 DONE S (%DT(0),PSJREPS)=+Y,D="stop" D DT K %DT G:Y'>0 DONE S:'$P(PSJREPS,".",2) PSJREPS=PSJREPS+.0001 S PSJREPF=Y+$S($P(Y,".",2):0,1:.24)
"RTN","PSJPDV",20,0)
 ;
"RTN","PSJPDV",21,0)
ORDERS D LIST^PSJEXP0 G:$D(OUT) DONE W !
"RTN","PSJPDV",22,0)
 ;
"RTN","PSJPDV",23,0)
SORT S DIR(0)="SAOM^P:Patient;S:Start Date",DIR("A")="Do you wish to sort by (P)atient or (S)tart Date: ",DIR("B")="Patient"
"RTN","PSJPDV",24,0)
 S DIR("?",1)="Enter a ""P"" if you wish to sort by patient name or enter ""S"" if you",DIR("?")="wish to sort by order start date." D ^DIR K DIR S PSJSRT=Y G:$D(DTOUT)!($D(DUOUT)) DONE
"RTN","PSJPDV",25,0)
 ;
"RTN","PSJPDV",26,0)
SELECT W ! S DIR(0)="SAM^O:Orderable Item;D:Dispense Drug;V:VA Class of Drugs",DIR("A")="List by (O)rderable Item, (D)ispense Drug, or (V)A Class of Drugs: "
"RTN","PSJPDV",27,0)
 S DIR("?",1)="Enter a ""O"" if you wish to list all patients on a specific orderable item",DIR("?",2)="Enter a ""D"" if you wish to list all patients on a specific dispense drug,"
"RTN","PSJPDV",28,0)
 S DIR("?")="or enter a ""V"" if you wish to list all patients on a VA class of drugs." D ^DIR K DIR S PSJSL=Y G:$D(DTOUT)!($D(DUOUT)) DONE
"RTN","PSJPDV",29,0)
 ;
"RTN","PSJPDV",30,0)
DRGS S COUNT=1,BCNT=0 W !
"RTN","PSJPDV",31,0)
 ;/IV Identifier is no longer used after POE
"RTN","PSJPDV",32,0)
 ;/S PSJIDD=$P($G(^PS(59.7,1,31)),"^",2)
"RTN","PSJPDV",33,0)
 F  K DIC S DIC=$S(PSJSL="O":50.7,PSJSL="D":50,PSJSL="V":50.605),DIC(0)="QEAMZ" Q:$D(OUT)  D
"RTN","PSJPDV",34,0)
 .I PSJSL="O" D
"RTN","PSJPDV",35,0)
 ..;/S DIC("W")="W ""  ""_$P(^PS(50.606,$P(^PS(50.7,+Y,0),""^"",2),0),""^"")_$S($P(^PS(50.7,+Y,0),""^"",3):"" ""_$G(PSJIDD),1:"""")_"
"RTN","PSJPDV",36,0)
 ..S DIC("W")="W ""  ""_$P(^PS(50.606,$P(^PS(50.7,+Y,0),""^"",2),0),""^"")_"
"RTN","PSJPDV",37,0)
 ..S DIC("W")=DIC("W")_""" ""_$S($P(^PS(50.7,+Y,0),""^"",4):$E($P(^(0),""^"",4),4,5)_""-""_$E($P(^(0),""^"",4),6,7)_""-""_$E($P(^(0),""^"",4),2,3),1:"""")"
"RTN","PSJPDV",38,0)
 .D ^DIC K DIC S:$D(DTOUT)!($D(DUOUT)) QFLG=1 S:(+Y'>0) OUT=1 Q:+Y'>0  S IEN=+Y,NAME=$P(Y,U,2) D @PSJSL
"RTN","PSJPDV",39,0)
 ;***PSJCNT is set to the number of drugs or classes the user chooses
"RTN","PSJPDV",40,0)
 S PSJCNT=COUNT-1
"RTN","PSJPDV",41,0)
 ;G:$D(QFLG)!(PSJCNT=0) DONE
"RTN","PSJPDV",42,0)
 G:$D(QFLG)!(BCNT=0) DONE
"RTN","PSJPDV",43,0)
 ;
"RTN","PSJPDV",44,0)
MATCH ;**prompt user for the number of matches, default to 1 RMS/PBM PSJ*5*214
"RTN","PSJPDV",45,0)
 W ! S DIR(0)="NAO^1:"_PSJCNT_":0",DIR("A")="Select number of matches: ",DIR("B")=1
"RTN","PSJPDV",46,0)
 S DIR("?",1)="Enter the number of drugs that a user must be receiving to appear",DIR("?",2)="on the report.",DIR("?",3)="",DIR("?")="The number must be between 1 and "_PSJCNT
"RTN","PSJPDV",47,0)
 D ^DIR K DIR S PSJMAT=Y G:$D(DTOUT)!($D(DUOUT)) DONE
"RTN","PSJPDV",48,0)
 ;
"RTN","PSJPDV",49,0)
DIVWARD ;PSJ*5*214 ADDS MULTIDIVISIONAL SUPPORT
"RTN","PSJPDV",50,0)
 W !
"RTN","PSJPDV",51,0)
 I $$CNTDIV^PSJQUTIL=1 S VAUTD=1 G UNIDIV
"RTN","PSJPDV",52,0)
 D DIVISION^VAUTOMA
"RTN","PSJPDV",53,0)
 G:$D(DTOUT)!($D(DUOUT))!(Y=-1) DONE
"RTN","PSJPDV",54,0)
UNIDIV I '$G(VAUTNI) S VAUTNI=2
"RTN","PSJPDV",55,0)
 D WARD^VAUTOMA
"RTN","PSJPDV",56,0)
 G:$D(DTOUT)!(Y=-1) DONE
"RTN","PSJPDV",57,0)
 I VAUTD I VAUTW D  ;WARD GROUPS
"RTN","PSJPDV",58,0)
 . N PSJSTOP,PSJWARD,PSJSEL
"RTN","PSJPDV",59,0)
 . W !!,"You may optionally select a ward group..." D G^PSJPDIR
"RTN","PSJPDV",60,0)
 . Q:+PSJSTOP
"RTN","PSJPDV",61,0)
 . S PSJWARD=0 F  S PSJWARD=$O(^PS(57.5,+PSJSEL("WG"),1,PSJWARD)) Q:'+PSJWARD  D
"RTN","PSJPDV",62,0)
 .. S VAUTW=0,VAUTW($G(^PS(57.5,+PSJSEL("WG"),1,PSJWARD,0)))=""
"RTN","PSJPDV",63,0)
 ;
"RTN","PSJPDV",64,0)
DEV ; ask print device and queue if asked to
"RTN","PSJPDV",65,0)
 K ZTSAVE S PSGTIR="ENQ^PSJPDV0",ZTDESC="List Patients on Specific Drugs" F X="CHOICE","PSJISP(","PSJSNM(","PSJREPS","PSJREPF","PSJSL","PSJSRT","PSJCNT","PSJMAT","VAUTD","VAUTW","VAUTD(","VAUTW(" S ZTSAVE(X)=""
"RTN","PSJPDV",66,0)
 D ENDEV^PSGTI I POP!$D(ZTSK) W:POP !!?3,"No device selected for report run." W:$D(ZTSK) !?3,"Report Queued!" K ZTSK G DONE
"RTN","PSJPDV",67,0)
 U IO
"RTN","PSJPDV",68,0)
 W:$E(IOST)="C" !,"...this may take a few minutes...",!?25,"...you really should QUEUE this report, if possible..."
"RTN","PSJPDV",69,0)
 D ^PSJPDV0
"RTN","PSJPDV",70,0)
 I '$D(QFLG)&($E(IOST)="C") W !!,"Press RETURN to continue: " R CONT:DTIME
"RTN","PSJPDV",71,0)
 ;
"RTN","PSJPDV",72,0)
DONE W:$E(IOST)="P" @IOF D ^%ZISC K %DT,CHOICE,CNT,CONT,COUNT,D,DIC,DTOUT,DUOUT,IEN,NAME,OUT,POP,PRIM,PSGP,PSGTIR,PSJCNT,PSJISP,PSJMAT,PSJREPF,PSJREPS,PSJSL,PSJSNM,PSJSRT,QFLG,SPDRG,X,Y
"RTN","PSJPDV",73,0)
 ;/K GG,GGG,MATCHES,ON,OUT,PSIVUP,PSJACNWP,PSJIDD,PSJORIFN,PSJPAD,PSJPAGE,PSJPBID,PSJPCAF,PSJPDD,PSJDOB,PSJPDX,PSJPHT,PSJPHTD,PSJPPID,PSJPRB,PSJPSEX,PSJPSSN,PSJPTD,PSJPTS,PSJPTSD,PSJPWD,PSJPWDN,PSJPWT,PSJPWTD,PSJPDOB,PSJPTSP
"RTN","PSJPDV",74,0)
 K GG,GGG,MATCHES,ON,OUT,PSIVUP,PSJACNWP,PSJORIFN,PSJPAD,PSJPAGE,PSJPBID,PSJPCAF,PSJPDD,PSJDOB,PSJPDX,PSJPHT,PSJPHTD,PSJPPID,PSJPRB,PSJPSEX,PSJPSSN,PSJPTD,PSJPTS,PSJPTSD,PSJPWD,PSJPWDN,PSJPWT,PSJPWTD,PSJPDOB,PSJPTSP
"RTN","PSJPDV",75,0)
 K PSJQ,VAUTD,VAUTW,VAUTNI
"RTN","PSJPDV",76,0)
 Q
"RTN","PSJPDV",77,0)
 ;
"RTN","PSJPDV",78,0)
P ;get primary drug from user
"RTN","PSJPDV",79,0)
 W !!,"Dispense Drugs for ",NAME," are:"
"RTN","PSJPDV",80,0)
 S SPDRG=0 F  S SPDRG=$O(^PSDRUG("AP",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PSDRUG(SPDRG,0),"^") S PSJISP(SPDRG_"D")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",81,0)
 I $D(PSJSNM(NAME)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",82,0)
 E  W !,"   NONE FOUND"
"RTN","PSJPDV",83,0)
 W ! Q
"RTN","PSJPDV",84,0)
 ;
"RTN","PSJPDV",85,0)
O ;get orderable item from user
"RTN","PSJPDV",86,0)
 ;/I $P($G(^PS(50.7,IEN,0)),"^",3) S PSJIDD=$P($G(^PS(59.7,1,31)),"^",2) D O1 Q
"RTN","PSJPDV",87,0)
 NEW FIL F FIL=52.6,52.7 I $O(^PS(FIL,"AOI",IEN,0)) D O1 Q
"RTN","PSJPDV",88,0)
 W !!,"Dispense Drugs for ",NAME," are:"
"RTN","PSJPDV",89,0)
 S SPDRG=0 F  S SPDRG=$O(^PSDRUG("ASP",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PSDRUG(SPDRG,0),"^") S PSJISP(SPDRG_"D")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",90,0)
 I $D(PSJSNM(NAME)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",91,0)
 E  W !,"   NONE FOUND"
"RTN","PSJPDV",92,0)
 W ! Q
"RTN","PSJPDV",93,0)
O1 ; here if the orderable item is marked for IV use
"RTN","PSJPDV",94,0)
 W !!,"Additives for ",NAME," are:"
"RTN","PSJPDV",95,0)
 ;/S SPDRG=0 F  S SPDRG=$O(^PS(52.6,"AOI",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PS(52.6,SPDRG,0),"^") S PSJISP(IEN_"O")=COUNT_NAME,PSJSNM(NAME_"  "_PSJIDD)=""
"RTN","PSJPDV",96,0)
 S SPDRG=0 F  S SPDRG=$O(^PS(52.6,"AOI",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PS(52.6,SPDRG,0),"^") S PSJISP(IEN_"O")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",97,0)
 ;/I $D(PSJSNM(NAME_"  "_PSJIDD)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",98,0)
 I $D(PSJSNM(NAME)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",99,0)
 E  W !,"   NONE FOUND" D
"RTN","PSJPDV",100,0)
 .W !!,"Solutions for ",NAME," are:"
"RTN","PSJPDV",101,0)
 .;/S SPDRG=0 F  S SPDRG=$O(^PS(52.7,"AOI",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PS(52.7,SPDRG,0),"^") S PSJISP(IEN_"O")=COUNT_NAME,PSJSNM(NAME_"  "_PSJIDD)=""
"RTN","PSJPDV",102,0)
 .S SPDRG=0 F  S SPDRG=$O(^PS(52.7,"AOI",IEN,SPDRG)) Q:'SPDRG  W !,$P(^PS(52.7,SPDRG,0),"^") S PSJISP(IEN_"O")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",103,0)
 .;/I $D(PSJSNM(NAME_"  "_PSJIDD)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",104,0)
 .I $D(PSJSNM(NAME)) S (COUNT,BCNT)=COUNT+1
"RTN","PSJPDV",105,0)
 .E  W !,"   NONE FOUND"
"RTN","PSJPDV",106,0)
 W ! Q
"RTN","PSJPDV",107,0)
 ;
"RTN","PSJPDV",108,0)
D ;get dispense drug from user
"RTN","PSJPDV",109,0)
 S PSJISP(IEN_"D")=COUNT,(BCNT,COUNT)=COUNT+1,PSJSNM(NAME)=""
"RTN","PSJPDV",110,0)
 Q
"RTN","PSJPDV",111,0)
 ;
"RTN","PSJPDV",112,0)
V ;get VA Class of Drug from user
"RTN","PSJPDV",113,0)
 D VSPLIT Q:$G(PSJQ("STOP"))
"RTN","PSJPDV",114,0)
V2 W !!,"Dispense Drugs for VA Class ",NAME," are: "
"RTN","PSJPDV",115,0)
 S PRIM=0 F  S PRIM=$O(^PSDRUG("AOC",PRIM)) Q:'PRIM  S SPDRG=0 F  S SPDRG=$O(^PSDRUG("AOC",PRIM,NAME,SPDRG)) Q:'SPDRG  W !,$P(^PSDRUG(SPDRG,0),"^") S PSJISP(SPDRG_"D")=COUNT_NAME,PSJSNM(NAME)=""
"RTN","PSJPDV",116,0)
 I $D(PSJSNM(NAME)) S (BCNT,COUNT)=COUNT+1
"RTN","PSJPDV",117,0)
 W ! Q
"RTN","PSJPDV",118,0)
 ;
"RTN","PSJPDV",119,0)
VSPLIT I $D(^PS(50.605,"AC",IEN)) D
"RTN","PSJPDV",120,0)
 . S PSJQ("CLASS")=0 F  S PSJQ("CLASS")=$O(^PS(50.605,"AC",IEN,PSJQ("CLASS"))) D:$D(^PS(50.605,"AC",+PSJQ("CLASS"))) VSPLIT2 Q:PSJQ("CLASS")'=+PSJQ("CLASS")  D
"RTN","PSJPDV",121,0)
 .. S NAME=$P(^PS(50.605,PSJQ("CLASS"),0),"^") D V2 S PSJQ("STOP")=1
"RTN","PSJPDV",122,0)
 Q
"RTN","PSJPDV",123,0)
VSPLIT2 S PSJQ("CLASS2")=0 F  S PSJQ("CLASS2")=$O(^PS(50.605,"AC",PSJQ("CLASS"),PSJQ("CLASS2"))) Q:'+PSJQ("CLASS2")  S NAME=$P(^PS(50.605,PSJQ("CLASS2"),0),"^") D V2
"RTN","PSJPDV",124,0)
 Q
"RTN","PSJPDV",125,0)
DT S Y=-1 F  W !!,"Enter ",D," date: " R X:DTIME W:'$T $C(7) S:'$T X="^" D DTM:X?1."?",^%DT:"^"'[X I Y>0!("^"[X) W:Y<0 !,"No ",D," date chosen for notices run." Q
"RTN","PSJPDV",126,0)
 Q
"RTN","PSJPDV",127,0)
DTM W !!,"Enter the ",D," date of the range of dates where you wish to see patients ",!,"on specific drugs. The start date and stop date may be the same." W:D="stop" " The stop",!,"date may not come before the start date." W ! Q
"RTN","PSJPDV0")
0^2^B28813203^B25176087
"RTN","PSJPDV0",1,0)
PSJPDV0 ;BIR/KKA-LIST PATIENTS ON SPECIFIC DRUGS (CONT.) ; 7/6/09 2:20pm
"RTN","PSJPDV0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**12,22,33,214**;16 DEC 97;Build 8
"RTN","PSJPDV0",3,0)
 ;
"RTN","PSJPDV0",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231
"RTN","PSJPDV0",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173
"RTN","PSJPDV0",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJPDV0",7,0)
 ;Reference to ^SC is supported by DBIA 10040
"RTN","PSJPDV0",8,0)
 ;Reference to ^DG(40.8 is supported by DBIA 728
"RTN","PSJPDV0",9,0)
 ;Reference to ^DIC(42 is supported by DBIA 1377
"RTN","PSJPDV0",10,0)
 ;
"RTN","PSJPDV0",11,0)
ENQ N TMPWD,TMPRB D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT
"RTN","PSJPDV0",12,0)
 K ^TMP("PSJ",$J),^TMP("PSJPDV",$J)
"RTN","PSJPDV0",13,0)
 D:CHOICE'="IV" UDORD D:CHOICE'="UD" IVORD
"RTN","PSJPDV0",14,0)
 I $D(PMATCH) S PSGP=0 F  S PSGP=$O(PMATCH(PSGP)) Q:'PSGP  D GETMAT I MATCHES'<PSJMAT&($D(^TMP("PSJPDV",$J,+PSGP))) D
"RTN","PSJPDV0",15,0)
 .S PSJACNWP=1 D ^PSJAC S TMPWD=PSJPWDN,TMPRB=PSJPRB,NM=PSGP(0),PSJJORD=0 F  S PSJJORD=$O(^TMP("PSJPDV",$J,PSGP,PSJJORD)) Q:'PSJJORD  D:PSJJORD'["V"&$$DIVWARD UDSET D:PSJJORD["V"&$$DIVWARD IVSET
"RTN","PSJPDV0",16,0)
 D ^PSJPDV1
"RTN","PSJPDV0",17,0)
 ;
"RTN","PSJPDV0",18,0)
DONE K ^TMP("PSJ",$J),^TMP("PSJPDV",$J),%,ADD,CHOICE,CLS,DFN,DO,DRG,IVDO,IVDRG,IVIR,IVMR,IVND,IVORD,IVPSGP,IVSCH,IVSPD,IVSTD,MR,ND,ND2,NM,PATDRG,PDRG,PMATCH,PSGDT,PSGP,PSJJORD,SCH,SOL,SPD,SPPDRG,STD,VA,VADM,VAIN
"RTN","PSJPDV0",19,0)
 Q
"RTN","PSJPDV0",20,0)
 ;
"RTN","PSJPDV0",21,0)
DIVWARD() ;DIVISION/WARD MATCH FOR PATIENT (PSJ*5*214)
"RTN","PSJPDV0",22,0)
 N PSJV,PSJVA,PSJVC
"RTN","PSJPDV0",23,0)
 I $G(VAUTD) I $G(VAUTW) Q 1  ;ALL DIVISIONS/ALL WARDS
"RTN","PSJPDV0",24,0)
 I $D(VAUTW(PSJPWD)) Q 1  ;SPECIFIC WARD MATCHES
"RTN","PSJPDV0",25,0)
 I $G(VAUTW) S PSJVC=0 D  Q $G(PSJVA,0)  ;SPECIFIC DIVISION MATCHES
"RTN","PSJPDV0",26,0)
 . F  S PSJVC=$O(VAUTD(PSJVC)) Q:PSJVC'=+PSJVC  S PSJV=VAUTD(PSJVC) I PSJV=$P($G(^DG(40.8,+$P($G(^DIC(42,(+PSJPWD),0)),"^",11),0)),U,1) S PSJVA=1
"RTN","PSJPDV0",27,0)
 Q 0
"RTN","PSJPDV0",28,0)
 ;
"RTN","PSJPDV0",29,0)
UDORD ;find all Unit Dose orders with specified dispense drugs
"RTN","PSJPDV0",30,0)
 S SPD=$P(PSJREPS,".")-.0001 F  S SPD=$O(^PS(55,"AUD",SPD)) Q:'SPD  S PSGP=0 F  S PSGP=$O(^PS(55,"AUD",SPD,PSGP)) Q:'PSGP  D
"RTN","PSJPDV0",31,0)
 .S PSJJORD=0 F  S PSJJORD=$O(^PS(55,"AUD",SPD,PSGP,PSJJORD)) Q:'PSJJORD  D
"RTN","PSJPDV0",32,0)
 ..S ND=$G(^PS(55,PSGP,5,PSJJORD,2)) I +$P(ND,U,2)=0!(+$P(ND,U,2)>PSJREPF) Q
"RTN","PSJPDV0",33,0)
 ..Q:'$O(^PS(55,PSGP,5,PSJJORD,1,0))
"RTN","PSJPDV0",34,0)
 ..S PDRG=0 F  S PDRG=$O(^PS(55,PSGP,5,PSJJORD,1,PDRG)) Q:+PDRG=0  S SPPDRG=+$P(^(PDRG,0),"^") I $D(PSJISP(SPPDRG_"D")) S ^TMP("PSJPDV",$J,PSGP,PSJJORD)=SPD,CLS=PSJISP(SPPDRG_"D"),$P(PMATCH(PSGP),U,+CLS)=+CLS
"RTN","PSJPDV0",35,0)
 Q
"RTN","PSJPDV0",36,0)
 ;
"RTN","PSJPDV0",37,0)
UDSET ;get patient and order information and set in global
"RTN","PSJPDV0",38,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,0)),MR=$P(ND,"^",3),MR=$$ENMRN^PSGMI(MR)
"RTN","PSJPDV0",39,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,2)),DRG=$G(^(.2)),SCH=$P(ND,"^"),SPD=^TMP("PSJPDV",$J,PSGP,PSJJORD),STD=$S($P(ND,"^",2):$P(ND,"^",2),1:"NOT FOUND"),DO=$P(DRG,"^",2),DRG=$$ENPDN^PSGMI($P(DRG,"^")) I DO]"",$E(DO,$L(DO))'=" " S DO=DO_" "
"RTN","PSJPDV0",40,0)
 N X,PSJ
"RTN","PSJPDV0",41,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJJORD_"U",30,0,.PSJ,1)
"RTN","PSJPDV0",42,0)
 S DRG=PSJ(1)
"RTN","PSJPDV0",43,0)
 S ^TMP("PSJ",$J,$S(PSJSRT="P":NM_";"_DFN,1:+$G(STD)),$S(PSJSRT="P":+$G(STD),1:NM_";"_DFN),PSJJORD)=VA("PID")_"^"_PSJPWDN_"^"_PSJPRB_"^"_DRG_"^"_DO_MR_" "_SCH_"^"_SPD
"RTN","PSJPDV0",44,0)
 Q
"RTN","PSJPDV0",45,0)
IVORD ;get IV orders matching the requested drug
"RTN","PSJPDV0",46,0)
 S IVSPD=$P(PSJREPS,".")-.0001 F  S IVSPD=$O(^PS(55,"AIV",IVSPD)) Q:'IVSPD  S IVPSGP=0 F  S IVPSGP=$O(^PS(55,"AIV",IVSPD,IVPSGP)) Q:'IVPSGP  D
"RTN","PSJPDV0",47,0)
 .S IVORD=0 F  S IVORD=$O(^PS(55,"AIV",IVSPD,IVPSGP,IVORD)) Q:'IVORD  D
"RTN","PSJPDV0",48,0)
 ..S ND=$G(^PS(55,IVPSGP,"IV",IVORD,0)) I +$P(ND,U,2)=0!(+$P(ND,U,2)>PSJREPF) Q
"RTN","PSJPDV0",49,0)
 ..D MATADD,MATSOL
"RTN","PSJPDV0",50,0)
 Q
"RTN","PSJPDV0",51,0)
MATADD ;see if additives of the order match the drug
"RTN","PSJPDV0",52,0)
 Q:'$O(^PS(55,IVPSGP,"IV",IVORD,"AD",0))
"RTN","PSJPDV0",53,0)
 S ADD=0 F  S ADD=$O(^PS(55,IVPSGP,"IV",IVORD,"AD",ADD)) Q:'ADD  S ND=$G(^(ADD,0)),ND2=$G(^PS(52.6,+$P(ND,"^"),0)) D
"RTN","PSJPDV0",54,0)
 .I ND2]"" I $D(PSJISP($S(PSJSL="O":+$P($G(ND2),U,11)_"O",1:+$P($G(ND2),U,2)_"D"))) S CLS=PSJISP($S(PSJSL="O":$P(ND2,"^",11)_"O",1:$P(ND2,"^",2)_"D")),$P(PMATCH(IVPSGP),U,+CLS)=+CLS,^TMP("PSJPDV",$J,IVPSGP,IVORD_"V")=IVSPD
"RTN","PSJPDV0",55,0)
 Q
"RTN","PSJPDV0",56,0)
MATSOL ;see if solutions of the order match the drug
"RTN","PSJPDV0",57,0)
 Q:'$O(^PS(55,IVPSGP,"IV",IVORD,"SOL",0))
"RTN","PSJPDV0",58,0)
 S SOL=0 F  S SOL=$O(^PS(55,IVPSGP,"IV",IVORD,"SOL",SOL)) Q:'SOL  S ND=$G(^(SOL,0)),ND2=$G(^PS(52.7,+$P(ND,"^"),0))  D
"RTN","PSJPDV0",59,0)
 .I ND2]"" I $D(PSJISP($S(PSJSL="O":+$P($G(ND2),U,11)_"O",1:+$P($G(ND2),U,2)_"D"))) S CLS=PSJISP($S(PSJSL="O":$P(ND2,"^",11)_"O",1:$P(ND2,"^",2)_"D")),$P(PMATCH(IVPSGP),U,+CLS)=+CLS,^TMP("PSJPDV",$J,IVPSGP,IVORD_"V")=IVSPD
"RTN","PSJPDV0",60,0)
 Q
"RTN","PSJPDV0",61,0)
 ;
"RTN","PSJPDV0",62,0)
IVSET ;S IVND=$G(^PS(55,PSGP,"IV",+PSJJORD,0)),IVSCH=$P(IVND,"^",9),IVSTD=$P(IVND,"^",2),IVSPD=^TMP("PSJPDV",$J,PSGP,PSJJORD),IVMR=$P($G(^PS(55,PSGP,"IV",+PSJJORD,6)),"^",3),IVIR=$P(IVND,"^",8)
"RTN","PSJPDV0",63,0)
 ;S IVMR=$$ENMRN^PSGMI(IVMR)
"RTN","PSJPDV0",64,0)
 ;S IVDRG=$G(^PS(55,PSGP,"IV",+PSJJORD,6)),IVDO=$P(IVDRG,"^",2),IVDRG=$$ENPDN^PSGMI($P(IVDRG,"^")) I IVDO]"",$E(IVDO,$L(IVDO))'=" " S IVDO=IVDO_" "
"RTN","PSJPDV0",65,0)
 N X,ON55 S DFN=PSGP,ON=PSJJORD D GT55^PSIVORFB
"RTN","PSJPDV0",66,0)
 S DRG=$S($D(DRG("AD",1)):$P(DRG("AD",1),U,2),1:$P(DRG("SOL",1),U,2)),IVSCH=P(9),IVSTD=P(2),IVSPD=^TMP("PSJPDV",$J,PSGP,PSJJORD),IVMR=$P(P("MR"),U,2),IVIR=P(8),IVDRG=DRG
"RTN","PSJPDV0",67,0)
 S PSJPWDN=$S($G(^PS(55,PSGP,"IV",+ON,"DSS")):$P($G(^SC(+$G(^PS(55,PSGP,"IV",+ON,"DSS")),0)),"^"),($G(PSJPDD)]""&(IVSTD>+PSJPDD)):"",1:TMPWD),PSJPRB=$S($G(^PS(55,PSGP,"IV",+ON,"DSS")):"",($G(PSJPDD)]""&(IVSTD>+PSJPDD)):"",1:TMPRB)
"RTN","PSJPDV0",68,0)
 S ^TMP("PSJ",$J,$S(PSJSRT="P":NM_";"_DFN,1:+$G(IVSTD)),$S(PSJSRT="P":+$G(IVSTD),1:NM_";"_DFN),PSJJORD)=VA("PID")_"^"_PSJPWDN_"^"_PSJPRB_"^"_IVDRG_"^"_IVMR_" "_IVSCH_" "_IVIR_"^"_IVSPD
"RTN","PSJPDV0",69,0)
 ;
"RTN","PSJPDV0",70,0)
GETMAT ;see if the patient has the number of drugs necessary to be printed on
"RTN","PSJPDV0",71,0)
 ;the report
"RTN","PSJPDV0",72,0)
 S MATCHES=0 F GG=1:1:$L(PMATCH(PSGP),"^") S GGG=$P(PMATCH(PSGP),"^",GG) S:GGG MATCHES=MATCHES+1
"RTN","PSJPDV0",73,0)
 Q
"RTN","PSJQUTIL")
0^4^B569952^n/a
"RTN","PSJQUTIL",1,0)
PSJQUTIL ;BIR/RMS-UTILITY FOR PATIENTS ON SPECIFIC DRUGS ; 7/6/09 2:19pm
"RTN","PSJQUTIL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**214**;16 DEC 97;Build 8
"RTN","PSJQUTIL",3,0)
 ;
"RTN","PSJQUTIL",4,0)
 ;Reference to ^DIC(42 is supported by DBIA# 1377
"RTN","PSJQUTIL",5,0)
 ;
"RTN","PSJQUTIL",6,0)
CNTDIV()   ;COUNT THE NUMBER OF DIVISIONS PRESENT FOR WARD LOCATIONS
"RTN","PSJQUTIL",7,0)
 N WARD,DIV,DIVCT,DIVARR
"RTN","PSJQUTIL",8,0)
 S WARD=0 F  S WARD=$O(^DIC(42,WARD)) Q:'+WARD  D
"RTN","PSJQUTIL",9,0)
 . S DIV=$P($G(^DIC(42,WARD,0)),U,11)
"RTN","PSJQUTIL",10,0)
 . I +DIV S DIVARR(DIV)=""
"RTN","PSJQUTIL",11,0)
 S (DIV,DIVCT)=0 F  S DIV=$O(DIVARR(DIV)) Q:'+DIV  D
"RTN","PSJQUTIL",12,0)
 . S DIVCT=DIVCT+1
"RTN","PSJQUTIL",13,0)
 Q DIVCT
"VER")
8.0^22.0
"BLD",6941,6)
^199
**END**
**END**
