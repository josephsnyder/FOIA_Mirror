EMERGENCY Released IVM*2*131 SEQ #115
Extracted from mail message
**KIDS**:IVM*2.0*131^

**INSTALL NAME**
IVM*2.0*131
"BLD",7046,0)
IVM*2.0*131^INCOME VERIFICATION MATCH^0^3090422^y
"BLD",7046,4,0)
^9.64PA^^
"BLD",7046,6.3)
2
"BLD",7046,"INID")
n^n^n
"BLD",7046,"KRN",0)
^9.67PA^8989.52^19
"BLD",7046,"KRN",.4,0)
.4
"BLD",7046,"KRN",.401,0)
.401
"BLD",7046,"KRN",.402,0)
.402
"BLD",7046,"KRN",.403,0)
.403
"BLD",7046,"KRN",.5,0)
.5
"BLD",7046,"KRN",.84,0)
.84
"BLD",7046,"KRN",3.6,0)
3.6
"BLD",7046,"KRN",3.8,0)
3.8
"BLD",7046,"KRN",9.2,0)
9.2
"BLD",7046,"KRN",9.8,0)
9.8
"BLD",7046,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7046,"KRN",9.8,"NM",1,0)
IVMLDEMD^^0^B78952880
"BLD",7046,"KRN",9.8,"NM",2,0)
IVMLDEMB^^0^B7036667
"BLD",7046,"KRN",9.8,"NM","B","IVMLDEMB",2)

"BLD",7046,"KRN",9.8,"NM","B","IVMLDEMD",1)

"BLD",7046,"KRN",19,0)
19
"BLD",7046,"KRN",19.1,0)
19.1
"BLD",7046,"KRN",101,0)
101
"BLD",7046,"KRN",409.61,0)
409.61
"BLD",7046,"KRN",771,0)
771
"BLD",7046,"KRN",870,0)
870
"BLD",7046,"KRN",8989.51,0)
8989.51
"BLD",7046,"KRN",8989.52,0)
8989.52
"BLD",7046,"KRN",8994,0)
8994
"BLD",7046,"KRN","B",.4,.4)

"BLD",7046,"KRN","B",.401,.401)

"BLD",7046,"KRN","B",.402,.402)

"BLD",7046,"KRN","B",.403,.403)

"BLD",7046,"KRN","B",.5,.5)

"BLD",7046,"KRN","B",.84,.84)

"BLD",7046,"KRN","B",3.6,3.6)

"BLD",7046,"KRN","B",3.8,3.8)

"BLD",7046,"KRN","B",9.2,9.2)

"BLD",7046,"KRN","B",9.8,9.8)

"BLD",7046,"KRN","B",19,19)

"BLD",7046,"KRN","B",19.1,19.1)

"BLD",7046,"KRN","B",101,101)

"BLD",7046,"KRN","B",409.61,409.61)

"BLD",7046,"KRN","B",771,771)

"BLD",7046,"KRN","B",870,870)

"BLD",7046,"KRN","B",8989.51,8989.51)

"BLD",7046,"KRN","B",8989.52,8989.52)

"BLD",7046,"KRN","B",8994,8994)

"BLD",7046,"QUES",0)
^9.62^^
"BLD",7046,"REQB",0)
^9.611^1^1
"BLD",7046,"REQB",1,0)
IVM*2.0*108^2
"BLD",7046,"REQB","B","IVM*2.0*108",1)

"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
131^3090422
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IVMLDEMB")
0^2^B7036667^n/a
"RTN","IVMLDEMB",1,0)
IVMLDEMB ;ALB/PHH - IVM DEMOGRAPHIC UPLOAD FILE DATE OF DEATH FIELDS ; 04/17/2009
"RTN","IVMLDEMB",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**131**; 21-OCT-94;Build 2
"RTN","IVMLDEMB",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMLDEMB",4,0)
 ;
"RTN","IVMLDEMB",5,0)
 Q
"RTN","IVMLDEMB",6,0)
CKINPAT(DFN) ; Check if InPatient
"RTN","IVMLDEMB",7,0)
 ; Function returns 1 if yes, 0 if no
"RTN","IVMLDEMB",8,0)
 N RETVAL
"RTN","IVMLDEMB",9,0)
 S RETVAL=0
"RTN","IVMLDEMB",10,0)
 S RETVAL=$$CURINPAT^DGENPTA(DFN)
"RTN","IVMLDEMB",11,0)
 Q RETVAL
"RTN","IVMLDEMB",12,0)
AUTOREJ ; Auto Reject a DOD
"RTN","IVMLDEMB",13,0)
 ; - loop through DOD fields
"RTN","IVMLDEMB",14,0)
 F DODFIELD="ZPD09","ZPD31","ZPD32" D
"RTN","IVMLDEMB",15,0)
 .S IVMI=$O(^IVM(301.92,"C",DODFIELD,"")) I IVMI="" Q
"RTN","IVMLDEMB",16,0)
 .S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,"")) Q:IVMJ']""  D
"RTN","IVMLDEMB",17,0)
 ..;
"RTN","IVMLDEMB",18,0)
 ..; - check for data node in (#301.511) sub-file
"RTN","IVMLDEMB",19,0)
 ..S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0)) Q:'(+IVMNODE)
"RTN","IVMLDEMB",20,0)
 ..;
"RTN","IVMLDEMB",21,0)
 ..I DODFIELD="ZPD09" D
"RTN","IVMLDEMB",22,0)
 ...S DODREJDT=$P(IVMNODE,"^",2)
"RTN","IVMLDEMB",23,0)
 ..;
"RTN","IVMLDEMB",24,0)
 ..; - remove entry from (#301.511) sub-file
"RTN","IVMLDEMB",25,0)
 ..D DELENT^IVMLDEMU(IVMDA2,IVMDA1,IVMJ)
"RTN","IVMLDEMB",26,0)
 ;
"RTN","IVMLDEMB",27,0)
 D CLEAN^IVMLDEMD(IVMDA2)
"RTN","IVMLDEMB",28,0)
 Q
"RTN","IVMLDEMB",29,0)
SNDBULL ; Send MailMan Bulletin to HEC to remove DOD
"RTN","IVMLDEMB",30,0)
 N DGBULL,DGLINE,DGMGRP,DGNAME,DGSSN,DIFROM,VA,VAERR,XMTEXT,XMSUB,XMDUZ
"RTN","IVMLDEMB",31,0)
 S DGMGRP=$O(^XMB(3.8,"B","DGEN ELIGIBILITY ALERT",""))
"RTN","IVMLDEMB",32,0)
 Q:'DGMGRP
"RTN","IVMLDEMB",33,0)
 I $$FMTE^XLFDT($G(DODREJDT))="" Q
"RTN","IVMLDEMB",34,0)
 D XMY^DGMTUTL(DGMGRP,0,1)
"RTN","IVMLDEMB",35,0)
 S DGNAME=$P($G(^DPT(DFN,0)),"^"),DGSSN=$P($G(^DPT(DFN,0)),"^",9)
"RTN","IVMLDEMB",36,0)
 S XMTEXT="DGBULL("
"RTN","IVMLDEMB",37,0)
 S XMSUB="Date of Death Transmission Error"
"RTN","IVMLDEMB",38,0)
 S XMDUZ="DEATH TRANSMISSION TO STATION #"_$P($$SITE^VASITE,"^")
"RTN","IVMLDEMB",39,0)
 S DGLINE=0
"RTN","IVMLDEMB",40,0)
 D LINE^DGEN("A Death Demographic (ORU~Z05) HL7 Message was received",.DGLINE)
"RTN","IVMLDEMB",41,0)
 D LINE^DGEN("at Station #"_$P($$SITE^VASITE,"^")_" for the following patient:",.DGLINE)
"RTN","IVMLDEMB",42,0)
 D LINE^DGEN("",.DGLINE)
"RTN","IVMLDEMB",43,0)
 D LINE^DGEN("         Name: "_$P($$PT^IVMUFNC4(DFN),"^"),.DGLINE)
"RTN","IVMLDEMB",44,0)
 D LINE^DGEN("          SSN: "_$P($G(^DPT(DFN,0)),"^",9),.DGLINE)
"RTN","IVMLDEMB",45,0)
 D LINE^DGEN("          DOB: "_$$FMTE^XLFDT($P($G(^DPT(DFN,0)),"^",3)),.DGLINE)
"RTN","IVMLDEMB",46,0)
 D LINE^DGEN("          DOD: "_$$FMTE^XLFDT($G(DODREJDT)),.DGLINE)
"RTN","IVMLDEMB",47,0)
 D LINE^DGEN("",.DGLINE)
"RTN","IVMLDEMB",48,0)
 D LINE^DGEN("The veteran is an inpatient at this site. Please",.DGLINE)
"RTN","IVMLDEMB",49,0)
 D LINE^DGEN("remove the Date of Death information for this veteran.",.DGLINE)
"RTN","IVMLDEMB",50,0)
 D LINE^DGEN("",.DGLINE)
"RTN","IVMLDEMB",51,0)
 D ^XMD
"RTN","IVMLDEMB",52,0)
 Q
"RTN","IVMLDEMD")
0^1^B78952880^B69403239
"RTN","IVMLDEMD",1,0)
IVMLDEMD ;ALB/PJR/PHH - IVM DEMOGRAPHIC UPLOAD FILE DATE OF DEATH FIELDS ; 7/1/08 9:22am
"RTN","IVMLDEMD",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**102,108,131**; 21-OCT-94;Build 2
"RTN","IVMLDEMD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMLDEMD",4,0)
 ;
"RTN","IVMLDEMD",5,0)
 ;
"RTN","IVMLDEMD",6,0)
DOD(DFN,IVMDA2,IVMDA1,IVMDA) ; function to upload Date of Death
"RTN","IVMLDEMD",7,0)
 ;                                   fields and return a flag
"RTN","IVMLDEMD",8,0)
 ;
"RTN","IVMLDEMD",9,0)
 ;  Input:      DFN  -  as patient IEN
"RTN","IVMLDEMD",10,0)
 ;           IVMDA2  -  pointer to case record in (#301.5) file
"RTN","IVMLDEMD",11,0)
 ;           IVMDA1  -  pointer to PID msg in (#301.501) sub-file
"RTN","IVMLDEMD",12,0)
 ;            IVMDA  -  pointer to record in (#301.511) sub-file
"RTN","IVMLDEMD",13,0)
 ;
"RTN","IVMLDEMD",14,0)
 ; Output: IVMFLAG   -  1 if a Date of Death Field
"RTN","IVMLDEMD",15,0)
 ;                      0 if not a Date of Death field
"RTN","IVMLDEMD",16,0)
 ;
"RTN","IVMLDEMD",17,0)
 ;
"RTN","IVMLDEMD",18,0)
 N IVMFLAG,IVMI,IVMJ,IVMNODE,IVMPTR,Y,DODFIELD,DELDATA,CKDEL,DGDAUTO
"RTN","IVMLDEMD",19,0)
 ;
"RTN","IVMLDEMD",20,0)
 ; - initialize flags
"RTN","IVMLDEMD",21,0)
 S IVMFLAG=0
"RTN","IVMLDEMD",22,0)
 ;
"RTN","IVMLDEMD",23,0)
 ; - check for required parameters
"RTN","IVMLDEMD",24,0)
 I '$G(DFN)!('$G(IVMDA))!('$G(IVMDA1))!'($G(IVMDA2)) G DODQ
"RTN","IVMLDEMD",25,0)
 ;
"RTN","IVMLDEMD",26,0)
 ; - get pointer to (#301.92) file from (#301.511) sub-file
"RTN","IVMLDEMD",27,0)
 S IVMPTR=+$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMDA,0)) G DODQ:'IVMPTR
"RTN","IVMLDEMD",28,0)
 ;
"RTN","IVMLDEMD",29,0)
ASK ;;
"RTN","IVMLDEMD",30,0)
 D CKDEL I CKDEL G DODDEL
"RTN","IVMLDEMD",31,0)
 W ! S DIR("A")="Do you wish to proceed with this action"
"RTN","IVMLDEMD",32,0)
 S DIR("A",1)="You have selected to update a Date of Death field."
"RTN","IVMLDEMD",33,0)
 S DIR("A",2)="All Date of Death Fields will be uploaded."
"RTN","IVMLDEMD",34,0)
 S DIR("?")="Enter 'YES' to continue or 'NO' to abort."
"RTN","IVMLDEMD",35,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","IVMLDEMD",36,0)
 D ^DIR K DIR
"RTN","IVMLDEMD",37,0)
 S IVMFLAG=1 G DODQ:'Y
"RTN","IVMLDEMD",38,0)
 W !,"Filing Date of Death fields... "
"RTN","IVMLDEMD",39,0)
 ;
"RTN","IVMLDEMD",40,0)
 ;
"RTN","IVMLDEMD",41,0)
LOOP ; - loop through DOD fields
"RTN","IVMLDEMD",42,0)
 S (DGDAUTO,IVMDODUP)=1
"RTN","IVMLDEMD",43,0)
 F DODFIELD="ZPD09","ZPD31","ZPD32" D
"RTN","IVMLDEMD",44,0)
 .S IVMI=$O(^IVM(301.92,"C",DODFIELD,"")) I IVMI="" Q
"RTN","IVMLDEMD",45,0)
 .S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,"")) Q:IVMJ']""  D
"RTN","IVMLDEMD",46,0)
 ..;
"RTN","IVMLDEMD",47,0)
 ..; - check for data node in (#301.511) sub-file
"RTN","IVMLDEMD",48,0)
 ..S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0)) Q:'(+IVMNODE)
"RTN","IVMLDEMD",49,0)
 ..I DODFIELD="ZPD31",$P(IVMNODE,"^",2)=""!($P(IVMNODE,"^",2)<1)!($P(IVMNODE,"^",2)>9) S $P(IVMNODE,"^",2)="@"
"RTN","IVMLDEMD",50,0)
 ..I DODFIELD'="ZPD31",$P(IVMNODE,"^",2)=""!($E($P(IVMNODE,"^",2),1,7)'?1.7N) S $P(IVMNODE,"^",2)="@"
"RTN","IVMLDEMD",51,0)
 ..;
"RTN","IVMLDEMD",52,0)
 ..;   load Date of Death field rec'd from IVM into DHCP (#2) file
"RTN","IVMLDEMD",53,0)
 ..D UPLOAD(+DFN,$P($G(^IVM(301.92,+IVMNODE,0)),"^",5),$P(IVMNODE,"^",2)) S IVMFLAG=1
"RTN","IVMLDEMD",54,0)
 ..;
"RTN","IVMLDEMD",55,0)
 ..; - remove entry from (#301.511) sub-file
"RTN","IVMLDEMD",56,0)
 ..D DELENT^IVMLDEMU(IVMDA2,IVMDA1,IVMJ)
"RTN","IVMLDEMD",57,0)
 ;
"RTN","IVMLDEMD",58,0)
 I IVMFLAG D  W "completed.",!
"RTN","IVMLDEMD",59,0)
 .D UPLOAD(+DFN,.355,$S($G(DUZ):DUZ,1:.5))
"RTN","IVMLDEMD",60,0)
 D DISCHRGE^DGDEATH,XFR^DGDEATH
"RTN","IVMLDEMD",61,0)
 K IVMDODUP
"RTN","IVMLDEMD",62,0)
 ;                                                                    
"RTN","IVMLDEMD",63,0)
 S VALMBCK="R"
"RTN","IVMLDEMD",64,0)
 ;
"RTN","IVMLDEMD",65,0)
 G DODQ
"RTN","IVMLDEMD",66,0)
 ;
"RTN","IVMLDEMD",67,0)
DODDEL ;
"RTN","IVMLDEMD",68,0)
 W ! S DIR("A")="Do you wish to proceed with this action"
"RTN","IVMLDEMD",69,0)
 S DIR("A",1)="You have selected to update a DELETION of a Date of Death field."
"RTN","IVMLDEMD",70,0)
 S DIR("A",2)="All Date of Death Fields will be deleted."
"RTN","IVMLDEMD",71,0)
 S DIR("?")="Enter 'YES' to continue or 'NO' to abort."
"RTN","IVMLDEMD",72,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","IVMLDEMD",73,0)
 D ^DIR K DIR
"RTN","IVMLDEMD",74,0)
 S IVMFLAG=1 G DODQ:'Y
"RTN","IVMLDEMD",75,0)
 W !,"Filing Date of Death deletions... "
"RTN","IVMLDEMD",76,0)
 F DODFIELD="ZPD09","ZPD31","ZPD32" D
"RTN","IVMLDEMD",77,0)
 .S IVMI=$O(^IVM(301.92,"C",DODFIELD,"")) I IVMI="" Q
"RTN","IVMLDEMD",78,0)
 .S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,"")) Q:IVMJ']""
"RTN","IVMLDEMD",79,0)
 .;
"RTN","IVMLDEMD",80,0)
 .; - check for data node in (#301.511) sub-file
"RTN","IVMLDEMD",81,0)
 .S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0))
"RTN","IVMLDEMD",82,0)
 .Q:'(+IVMNODE)
"RTN","IVMLDEMD",83,0)
 .;
"RTN","IVMLDEMD",84,0)
 .;   load Date of Death deletion rec'd from IVM into DHCP (#2) file
"RTN","IVMLDEMD",85,0)
 .I DODFIELD="ZPD09" D UPLOAD(+DFN,.351,"@")
"RTN","IVMLDEMD",86,0)
 .;
"RTN","IVMLDEMD",87,0)
 .; - remove entry from (#301.511) sub-file
"RTN","IVMLDEMD",88,0)
 .D DELENT^IVMLDEMU(IVMDA2,IVMDA1,IVMJ)
"RTN","IVMLDEMD",89,0)
 ;
"RTN","IVMLDEMD",90,0)
 I IVMFLAG D  W "completed.",!
"RTN","IVMLDEMD",91,0)
 .D UPLOAD(+DFN,.355,.5)
"RTN","IVMLDEMD",92,0)
 ;
"RTN","IVMLDEMD",93,0)
 S VALMBCK="R"
"RTN","IVMLDEMD",94,0)
 ;
"RTN","IVMLDEMD",95,0)
 G DODQ
"RTN","IVMLDEMD",96,0)
CKDEL S CKDEL=0
"RTN","IVMLDEMD",97,0)
 S IVMI=$O(^IVM(301.92,"C","ZPD09","")) I IVMI="" Q
"RTN","IVMLDEMD",98,0)
 S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,""))
"RTN","IVMLDEMD",99,0)
 I IVMJ']"" Q
"RTN","IVMLDEMD",100,0)
 ;
"RTN","IVMLDEMD",101,0)
 ; - check for data node in (#301.511) sub-file
"RTN","IVMLDEMD",102,0)
 S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0))
"RTN","IVMLDEMD",103,0)
 Q:'(+IVMNODE)!($P(IVMNODE,"^",2)']"")
"RTN","IVMLDEMD",104,0)
 ;
"RTN","IVMLDEMD",105,0)
 I $P(IVMNODE,"^",2)="""""" S CKDEL=1
"RTN","IVMLDEMD",106,0)
 Q
"RTN","IVMLDEMD",107,0)
AUTODOD(DFN) ;
"RTN","IVMLDEMD",108,0)
 ; function to automatically upload Date of Death
"RTN","IVMLDEMD",109,0)
 ; fields and return a flag
"RTN","IVMLDEMD",110,0)
 ;
"RTN","IVMLDEMD",111,0)
 ;  Input:      DFN  -  as patient IEN
"RTN","IVMLDEMD",112,0)
 ;
"RTN","IVMLDEMD",113,0)
 ; Output: IVMFLAG   -  1 if a Date of Death Field
"RTN","IVMLDEMD",114,0)
 ;                      0 if not a Date of Death field
"RTN","IVMLDEMD",115,0)
 ;
"RTN","IVMLDEMD",116,0)
 N IVMFLAG,IVMI,IVMJ,IVMNODE,IVMPTR,DODFIELD
"RTN","IVMLDEMD",117,0)
 N DELDATA,CKDEL,CKADD,CKDUZ,IVMDA1,IVMDA2,DGDAUTO,IVMENT4
"RTN","IVMLDEMD",118,0)
 ;
"RTN","IVMLDEMD",119,0)
 ; - initialize flags
"RTN","IVMLDEMD",120,0)
 S (IVMFLAG,CKDEL,CKADD,CKDUZ)=0,IVMENT4=999999999
"RTN","IVMLDEMD",121,0)
 ;
"RTN","IVMLDEMD",122,0)
 ; - check for required parameters
"RTN","IVMLDEMD",123,0)
 S IVMDA2=$G(IVM3015)
"RTN","IVMLDEMD",124,0)
 I 'IVMDA2 G DODQ
"RTN","IVMLDEMD",125,0)
 S IVMDA1=$O(^HL(771.3,"B","PID",""))
"RTN","IVMLDEMD",126,0)
 S IVMDA1=$O(^IVM(301.5,IVMDA2,"IN","B",IVMDA1,""),-1)
"RTN","IVMLDEMD",127,0)
 I 'IVMDA1 G DODQ
"RTN","IVMLDEMD",128,0)
 ;
"RTN","IVMLDEMD",129,0)
 D CKAUTO I CKDEL D AUTODEL,DEM5,BULL(+^IVM(301.5,IVMDA2,0)) G DODQ
"RTN","IVMLDEMD",130,0)
 I CKADD D CKDUZ,AUTOADD,DEM5 G DODQ
"RTN","IVMLDEMD",131,0)
 I $$CKINPAT^IVMLDEMB($G(DFN)) D
"RTN","IVMLDEMD",132,0)
 .N DODREJDT
"RTN","IVMLDEMD",133,0)
 .; DEMBULL^IVMPREC6 already set up the IVMTEXT array so we don't want
"RTN","IVMLDEMD",134,0)
 .; to send it if the message is to be deleted
"RTN","IVMLDEMD",135,0)
 .; EN^IVMPREC6 will send a message if IVMCNTR
"RTN","IVMLDEMD",136,0)
 .I $G(IVMCNTR),$G(XMSUB)["IVM - DEMOGRAPHIC UPLOAD for ",$G(IVMTEXT(1))["Updated demographic information has been received from the",$G(IVMTEXT(2))["Health Eligibilty Center.  Please select the 'Demographic Upload'" S IVMCNTR=0 K IVMTEXT
"RTN","IVMLDEMD",137,0)
 .D AUTOREJ^IVMLDEMB,SNDBULL^IVMLDEMB
"RTN","IVMLDEMD",138,0)
 G DODQ
"RTN","IVMLDEMD",139,0)
AUTOADD ;
"RTN","IVMLDEMD",140,0)
 S DGDAUTO=1
"RTN","IVMLDEMD",141,0)
 ; - loop through DOD fields
"RTN","IVMLDEMD",142,0)
 F DODFIELD="ZPD09","ZPD31","ZPD32" D
"RTN","IVMLDEMD",143,0)
 .S IVMI=$O(^IVM(301.92,"C",DODFIELD,"")) I IVMI="" Q
"RTN","IVMLDEMD",144,0)
 .S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,"")) Q:IVMJ']""  D
"RTN","IVMLDEMD",145,0)
 ..;
"RTN","IVMLDEMD",146,0)
 ..; - check for data node in (#301.511) sub-file
"RTN","IVMLDEMD",147,0)
 ..S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0)) Q:'(+IVMNODE)
"RTN","IVMLDEMD",148,0)
 ..I DODFIELD="ZPD31",$P(IVMNODE,"^",2)=""!($P(IVMNODE,"^",2)<1)!($P(IVMNODE,"^",2)>9) S $P(IVMNODE,"^",2)="@"
"RTN","IVMLDEMD",149,0)
 ..I DODFIELD'="ZPD31",$P(IVMNODE,"^",2)=""!($E($P(IVMNODE,"^",2),1,7)'?1.7N) S $P(IVMNODE,"^",2)="@"
"RTN","IVMLDEMD",150,0)
 ..;
"RTN","IVMLDEMD",151,0)
 ..;   load Date of Death field rec'd from IVM into DHCP (#2) file
"RTN","IVMLDEMD",152,0)
 ..I DODFIELD'="ZPD09" D UPLOAD(+DFN,$P($G(^IVM(301.92,+IVMNODE,0)),"^",5),$P(IVMNODE,"^",2)) S IVMFLAG=1
"RTN","IVMLDEMD",153,0)
 ..; - remove entry from (#301.511) sub-file
"RTN","IVMLDEMD",154,0)
 ..D DELENT^IVMLDEMU(IVMDA2,IVMDA1,IVMJ)
"RTN","IVMLDEMD",155,0)
 ;
"RTN","IVMLDEMD",156,0)
 I IVMFLAG D UPLOAD(+DFN,.355,$S(CKDUZ:CKDUZ,1:.5))
"RTN","IVMLDEMD",157,0)
 D CLEAN(IVMDA2)
"RTN","IVMLDEMD",158,0)
 Q
"RTN","IVMLDEMD",159,0)
AUTODEL ;
"RTN","IVMLDEMD",160,0)
 N DFNDOD,DODMPI S DFNDOD=0 I $P($G(^DPT(+DFN,.35)),U)>0 S DFNDOD=1
"RTN","IVMLDEMD",161,0)
 F DODFIELD="ZPD09","ZPD31","ZPD32" D
"RTN","IVMLDEMD",162,0)
 .S IVMI=$O(^IVM(301.92,"C",DODFIELD,"")) I IVMI="" Q
"RTN","IVMLDEMD",163,0)
 .S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,"")) Q:IVMJ']""
"RTN","IVMLDEMD",164,0)
 .; - check for data node in (#301.511) sub-file
"RTN","IVMLDEMD",165,0)
 .S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0))
"RTN","IVMLDEMD",166,0)
 .Q:'(+IVMNODE)
"RTN","IVMLDEMD",167,0)
 .;   load Date of Death deletion rec'd from IVM into DHCP (#2) file
"RTN","IVMLDEMD",168,0)
 .I DODFIELD="ZPD09" I DFNDOD D UPLOAD(+DFN,.351,"@") S DODMPI=$$A31^MPIFA31B(+DFN),IVMFLAG=1
"RTN","IVMLDEMD",169,0)
 .; - remove entry from (#301.511) sub-file
"RTN","IVMLDEMD",170,0)
 .D DELENT^IVMLDEMU(IVMDA2,IVMDA1,IVMJ)
"RTN","IVMLDEMD",171,0)
 ;
"RTN","IVMLDEMD",172,0)
 I IVMFLAG D UPLOAD(+DFN,.355,.5)
"RTN","IVMLDEMD",173,0)
 D CLEAN(IVMDA2)
"RTN","IVMLDEMD",174,0)
 Q
"RTN","IVMLDEMD",175,0)
DEM5 ;
"RTN","IVMLDEMD",176,0)
 I '$$DEMO^IVMLDEM5(IVMDA2,IVMDA1,0),'$$DEMO^IVMLDEM5(IVMDA2,IVMDA1,1) D
"RTN","IVMLDEMD",177,0)
 .D DELETE^IVMLDEM5(IVMDA2,IVMDA1," ") ; Dummy up name parameter
"RTN","IVMLDEMD",178,0)
 Q
"RTN","IVMLDEMD",179,0)
CKAUTO S (CKDEL,CKADD)=0
"RTN","IVMLDEMD",180,0)
 S IVMI=$O(^IVM(301.92,"C","ZPD09","")) I IVMI="" Q
"RTN","IVMLDEMD",181,0)
 S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,""))
"RTN","IVMLDEMD",182,0)
 I IVMJ']"" Q
"RTN","IVMLDEMD",183,0)
 ;
"RTN","IVMLDEMD",184,0)
 ; - check for data node in (#301.511) sub-file
"RTN","IVMLDEMD",185,0)
 S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0))
"RTN","IVMLDEMD",186,0)
 Q:'(+IVMNODE)!($P(IVMNODE,"^",2)']"")
"RTN","IVMLDEMD",187,0)
 ;
"RTN","IVMLDEMD",188,0)
 I $P(IVMNODE,"^",2)="""""" S CKDEL=1 Q
"RTN","IVMLDEMD",189,0)
 I $P(IVMNODE,"^",2)=$P($G(^DPT(DFN,.35)),"^",1) S CKADD=1
"RTN","IVMLDEMD",190,0)
 Q
"RTN","IVMLDEMD",191,0)
CKDUZ ; Check to preserve DUZ for "Last Edited By"
"RTN","IVMLDEMD",192,0)
 S IVMI=$O(^IVM(301.92,"C","ZPD32","")) I IVMI="" Q
"RTN","IVMLDEMD",193,0)
 S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,""))
"RTN","IVMLDEMD",194,0)
 I IVMJ']"" Q
"RTN","IVMLDEMD",195,0)
 ;
"RTN","IVMLDEMD",196,0)
 ; - check for data node in (#301.511) sub-file
"RTN","IVMLDEMD",197,0)
 S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0))
"RTN","IVMLDEMD",198,0)
 Q:'(+IVMNODE)!($P(IVMNODE,"^",2)']"")
"RTN","IVMLDEMD",199,0)
 ;
"RTN","IVMLDEMD",200,0)
 I $P(IVMNODE,"^",2)=$P($G(^DPT(DFN,.35)),"^",4) D
"RTN","IVMLDEMD",201,0)
 .S CKDUZ=$P($G(^DPT(DFN,.35)),"^",5)
"RTN","IVMLDEMD",202,0)
 Q
"RTN","IVMLDEMD",203,0)
UPLOAD(DFN,IVMFIELD,IVMVALUE) ; - file Date of Death fields received from IVM
"RTN","IVMLDEMD",204,0)
 ;  Input:       DFN  -  as patient IEN
"RTN","IVMLDEMD",205,0)
 ;          IVMFIELD  -  as the field number to be updated
"RTN","IVMLDEMD",206,0)
 ;          IVMVALUE  -  as the value of the field
"RTN","IVMLDEMD",207,0)
 ;
"RTN","IVMLDEMD",208,0)
 ; Output: None
"RTN","IVMLDEMD",209,0)
 ;
"RTN","IVMLDEMD",210,0)
 N DA,DIE,DR
"RTN","IVMLDEMD",211,0)
 S DIE="^DPT(",DA=DFN,DR=IVMFIELD_"////^S X=IVMVALUE"
"RTN","IVMLDEMD",212,0)
 D ^DIE
"RTN","IVMLDEMD",213,0)
 Q
"RTN","IVMLDEMD",214,0)
 ;
"RTN","IVMLDEMD",215,0)
DODQ ; - return  -->  1 if uploadable field is a Date of Death field
"RTN","IVMLDEMD",216,0)
 ;           -->  0 if nothing uploadable
"RTN","IVMLDEMD",217,0)
 ;
"RTN","IVMLDEMD",218,0)
 I IVMFLAG D RESET^IVMLDEMU
"RTN","IVMLDEMD",219,0)
 Q IVMFLAG
"RTN","IVMLDEMD",220,0)
 ;
"RTN","IVMLDEMD",221,0)
CLEAN(IVMI) ;
"RTN","IVMLDEMD",222,0)
 ; Remove any Date of Death related entries from IVM UPLOAD DEM
"RTN","IVMLDEMD",223,0)
 N IVMJ,IVMN,IVM92,OTHFLG
"RTN","IVMLDEMD",224,0)
 S IVMJ=0 F  S IVMJ=$O(^IVM(301.5,"ASEG","PID",IVMI,IVMJ)) Q:'IVMJ  D
"RTN","IVMLDEMD",225,0)
 .I '$D(^IVM(301.5,IVMI,"IN",IVMJ)) D REMASEG(IVMI,IVMJ) Q
"RTN","IVMLDEMD",226,0)
 .S (OTHFLG,IVMN)=0 F  S IVMN=$O(^IVM(301.5,IVMI,"IN",IVMJ,"DEM",IVMN)) Q:'IVMN  D
"RTN","IVMLDEMD",227,0)
 ..S IVM92=$P(^IVM(301.5,IVMI,"IN",IVMJ,"DEM",IVMN,0),U)
"RTN","IVMLDEMD",228,0)
 ..I "^15^36^37^"[(U_IVM92_U) D REM511(IVMI,IVMJ,IVMN)
"RTN","IVMLDEMD",229,0)
 ..I "^15^36^37^"'[(U_IVM92_U) S OTHFLG=1
"RTN","IVMLDEMD",230,0)
 .I 'OTHFLG D REM501(IVMI,IVMJ)
"RTN","IVMLDEMD",231,0)
 Q
"RTN","IVMLDEMD",232,0)
 ;
"RTN","IVMLDEMD",233,0)
REM501(IVMI,IVMJ) ;
"RTN","IVMLDEMD",234,0)
 ; Delete 301.501 entry to remove from ASEG x-ref
"RTN","IVMLDEMD",235,0)
 N DA,DIE,DR
"RTN","IVMLDEMD",236,0)
 S DA=IVMJ,DA(1)=IVMI
"RTN","IVMLDEMD",237,0)
 S DIE="^IVM(301.5,"_DA(1)_",""IN"","
"RTN","IVMLDEMD",238,0)
 S DR=".02////@" D ^DIE
"RTN","IVMLDEMD",239,0)
 Q
"RTN","IVMLDEMD",240,0)
 ;
"RTN","IVMLDEMD",241,0)
REM511(IVMI,IVMJ,IVMN) ;
"RTN","IVMLDEMD",242,0)
 ; Delete 301.511 entry to remove from IVM UPLOAD DEM
"RTN","IVMLDEMD",243,0)
 N DA,DIK
"RTN","IVMLDEMD",244,0)
 S DA(1)=IVMJ,DA(2)=IVMI,DA=IVMN
"RTN","IVMLDEMD",245,0)
 S DIK="^IVM(301.5,"_DA(2)_",""IN"","_DA(1)_",""DEM"","
"RTN","IVMLDEMD",246,0)
 D ^DIK
"RTN","IVMLDEMD",247,0)
 Q
"RTN","IVMLDEMD",248,0)
 ;
"RTN","IVMLDEMD",249,0)
REMASEG(IVMI,IVMJ) ;
"RTN","IVMLDEMD",250,0)
 ; Delete invalid ASEG x-ref entries
"RTN","IVMLDEMD",251,0)
 K ^IVM(301.5,"ASEG","PID",IVMI,IVMJ)
"RTN","IVMLDEMD",252,0)
 Q
"RTN","IVMLDEMD",253,0)
BULL(DFN) ; Date of Death Deletion Bulletin
"RTN","IVMLDEMD",254,0)
 I '$D(^DPT(DFN,0)) Q
"RTN","IVMLDEMD",255,0)
 I '(+$G(^DPT(DFN,.35))) Q
"RTN","IVMLDEMD",256,0)
 ;
"RTN","IVMLDEMD",257,0)
 N DGDEATH,DGB,DGPCMM,XMSUB,X
"RTN","IVMLDEMD",258,0)
 S DGDEATH=+$G(^DPT(DFN,.35)),XMSUB="Patient Death has been Deleted",DGCT=0
"RTN","IVMLDEMD",259,0)
 D ^DGPATV
"RTN","IVMLDEMD",260,0)
 D LINE^DGDEATH("The date of death for the following patient has been deleted.")
"RTN","IVMLDEMD",261,0)
 D LINE^DGDEATH("")
"RTN","IVMLDEMD",262,0)
 D DEMOG^DGDEATH
"RTN","IVMLDEMD",263,0)
 D LINE^DGDEATH("")
"RTN","IVMLDEMD",264,0)
 S DGPCMM=$$PCMMXMY^SCAPMC25(1,DFN,,,0) ;creates xmy array
"RTN","IVMLDEMD",265,0)
 S DGCT=$$PCMAIL^SCMCMM(DFN,"DGTEXT",DT)
"RTN","IVMLDEMD",266,0)
 S DGB=1 D ^DGBUL S X=DGDEATH
"RTN","IVMLDEMD",267,0)
 K DGCT,DGDEATH D KILL^DGPATV
"RTN","IVMLDEMD",268,0)
 ;
"RTN","IVMLDEMD",269,0)
 Q
"VER")
8.0^22.0
"BLD",7046,6)
^115
**END**
**END**
