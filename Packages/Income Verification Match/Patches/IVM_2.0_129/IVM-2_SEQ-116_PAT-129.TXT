$TXT Created by KOPP,TERRY at MNTVLL.FO-ALBANY.MED.VA.GOV  (KIDS) on Thursday, 09/18/08 at 16:57
=============================================================================
Run Date: JUL 01, 2009                     Designation: IVM*2*129
Package : IVM - INCOME VERIFICATION MATCH     Priority: Mandatory
Version : 2       SEQ #116                      Status: Released
                  Compliance Date: AUG 01, 2009
=============================================================================

Associated patches: (v)IVM*2*82    <<= must be installed BEFORE `IVM*2*129'

Subject: 'AE'BULLETIN REFERENCES WRONG PATIENT

Category: 
  - Routine

Description:
============

 This patch corrects the following problems.
                                                    
 1.  Bulletins which result from the receipt of an Application Error (AE) 
 potentially contain wrong patient information.  The bulletins are
 generated by the IVM package after an income test is converted and the
 resulting charges are transmitted to the Enrollment Database in an ORU~Z09
 Billing / Collection Data batch transmission.  They are sent to the mail
 group defined in the IVM MESSAGES MAIL GROUP (#.02) field of the IVM SITE
 PARAMETER (#301.9) file.
  
 2.  During development, a problem was discovered where the 'PID' segment 
 receiver in VistA was incorrectly handling an inbound PID segment that 
 was split across two message lines.  In certain instances, if the break 
 occurred in the middle of one of the segment's sequences (up-arrow pieces)
 rather than between two sequences, and the patient name and identification
 were contained in the second line, then this information was not reliably
 picked up by the receiving application.  This patch modifies the VistA
 receiver to handle this type of instance.  This situation appears to occur
 on a relatively infrequent basis.
  
 This patch addresses the following New Service Request (NSR):
 -------------------------------------------------------------
 There is no NSR associated with this patch.
  
 This patch addresses the following Remedy Ticket(s):
 ----------------------------------------------------
 HD0000000228157 - More than One Match on National ICN
  
 Overview of Remedy Ticket(s):
 -----------------------------
 HD0000000228157 - More than One Match on National ICN
  
 Problem:
 --------
 When IVM converts a financial assessment, charges can result from the 
 conversion process. Billing activity resulting from the conversion 
 process is transmitted to the Enrollment Database (EDB) via an 
 unsolicited (ORU) Z09 batch transmission. The HL7 application error 
 (AE), "More than One Match on National ICN", is generated due to
 duplicate records found in the Enrollment Database (EDB). The duplication 
 was a result of the migration efforts from the HEC system. The HEC system 
 no longer has the duplication; however, the duplicates have not yet been 
 purged from the EDB.
  
 Routine IVMPREC1 is used to read in the HL7 'AE' message and sends a
 bulletin. The 'AE' messages are received with a message control ID that 
 consists of the entry number of the original record in the HL7 MESSAGE
 TEXT (#772) file concatenated with a dash and the sequence number
 associated with the MSH segment in error. The PID following the MSH
 segment contains the identifying patient information specific to that
 sequence within the batch.
  
 The routine responsible for response processing of acknowledgments,
 IVMPREC1, uses only the first part of the message control number in the
 'AE' message to find the original ORU~Z09 batch message. In the course of 
 processing the application error from the EDB, it always uses the first 
 PID segment it finds to identify the veteran rather than using the PID 
 associated with the MSH segment denoted by the sequence number within the 
 batch message. The veteran information may not be correct, which results 
 in confusion as to: (1) what the problem is with the misidentified 
 veteran, and (2) how to correct the problem.
  
 Resolution:
 -----------
 The receipt of an error message "More than One Match on National ICN" is a
 rare occurrence. The fix is accomplished by changing the routine to first 
 look for the MSH record within the batch which corresponds to the message 
 control ID sequence denoted in the application error (AE). Once the 
 correct MSH segment is determined, the PID segment which follows is used 
 to correctly identify the veteran.
  
 Test Sites:
 -----------
 Atlanta (Large)
 Manchester, NH (Medium)
 Maryland HCS (Integrated)
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 NOTE:  Before installing this patch, four protocols will need to be marked
 as 'Out of Order'. These protocols are listed below, in Installation Step
 4e. There are no options to disable.
  
 Install Time - less than 5 minutes
  
 This patch can be installed with users on the system.
  
 1.  LOAD TRANSPORT GLOBAL 
     ---------------------
     Choose the PackMan message containing this patch and invoke the 
     INSTALL/CHECK MESSAGE PackMan option.  
              
 2.  START UP KIDS 
     -------------
     Start up the Kernel Installation and Distribution System Menu 
     [XPD MAIN]: 
    
          Edits and Distribution ...  
          Utilities ...  
          Installation ...  
    
 Select Kernel Installation & Distribution System Option: INStallation 
                                                          ---
          Load a Distribution 
          Print Transport Global 
          Compare Transport Global to Current System 
          Verify Checksums in Transport Global 
          Install Package(s) 
          Restart Install of Package(s) 
          Unload a Distribution 
          Backup a Transport Global 
    
 Select Installation Option: 
    
 3.  Select Installation Option: 
     ---------------------------
     NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
            NAME, enter IVM*2.0*129):
       
     a.  Backup a Transport Global - This option will create a backup
         message of any routines exported with this patch. It will not
         backup any other changes such as DD's or templates.
     b.  Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when this patch
         is installed.  It compares all components of this patch
         (routines, DD's, templates, etc.).
     c.  Verify Checksums in Transport Global - This option will allow
         you to ensure the integrity of the routines that are in the
         transport global.
      
 4.  Select Installation Option: Install Package(s) 
                                 ------------------
     **This is the step to start the installation of this KIDS patch: 
    
     a.  Choose the Install Package(s) option to start the patch
         install.
     b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
         YES//' answer NO.
     c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
         Options, and Protocols? YES//' answer YES.
     d.  When prompted 'Enter options you wish to mark as 'Out of 
         Order':' press <Enter>.
     e.  When prompted 'Enter protocols you wish to mark as 'Out Of 
         Order':' enter the following protocols:
  
   INSURANCE/Unsolicited HEC to VAMC            [VAMC XXX ORU-Z04 SERVER H]
   INSURANCE/Unsolicited VAMC to HEC            [VAMC XXX ORU-Z04 SERVER V]
   IVM BILLING/COLLECTION/Unsolicited           [VAMC XXX ORU-Z09 SERVER]
                         VAMC to HEC
   IVM BILLING/COLLECTION/Unsolicited           [EAS EDB ORU-Z09 SERVER]
                     VAMC to HEC/Edb
  
         *** NOTE:  The XXX in each of the VAMC protocol names represents
         the station number of the site installing this patch.
  
         No other protocols need to be disabled to install this patch.

Routine Information:
====================
The second line of each of these routines now looks like:
 ;;2.0;INCOME VERIFICATION MATCH;**[Patch List]**; 21-OCT-94;Build 4

The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: IVMPREC1
    Before: B26530064   After: B32970288  **9,17,26,52,34,72,82,129**
 Description of Changes:
  Changed: OTH+1
  From:
   N IVMRMM,IVMNAM,IVMPID,IVMTMP,HLDA,HLDAT,HLSEG,DIC,DR,DA,DIQ
  To: (added NEW of IVMMCID variable)
   N IVMRMM,IVMNAM,IVMPID,IVMMCID,IVMTMP,HLDA,HLDAT,HLSEG,DIC,DR,DA,DIQ
   
  Changed: OTH+9-OTH+10
  From:
   .S HLSEG=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^")
  To: (added OTH+10)
   .S HLSEG=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^")
   .I HLSEG="MSH" S IVMMCID=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^",10)
   
  Changed: OTH+11-OTH+13
  From:
   .D:HLSEG="PID"
  To: (added OTH+12 and OTH+13)
   .D:HLSEG="PID"
   ..;Find PID segment for the same message control ID only
   ..I IVMMCID'=IVMMCI S HLSEG="NOT CORRECT PID" Q
   ..; If PID segment was split, reconnect records ..I $L($G(HLDAT(772,200,I
  VMTMP)))=245,$L($G(HLDAT(772,HLDA,200,IVMTMP)),U)<20 S HLDAT(772,HLDA,200,
  IVMTMP)=$$REBLDPID("HLDAT(772,"_HLDA_",200)",IVMTMP)
   
  Added:
  REBLDPID(ARRAY,SEQ) ; Reconnect the pieces of the PID segment
        ; ARRAY contains the HL7 message reference to be accessed indirectly
        ;  It should look similar in structure to the HL7 message text in
        ;  file 772
        ; @ARRAY@(SEQ) should = the first 'PID' segment record text and shou
  ld
        ; be 245 characters long
        N PID,SEQX
        S PID=$G(@ARRAY@(SEQ)),SEQX=SEQ
        G:$L(PID)'=245 PIDQ
        F  S SEQX=$O(@ARRAY@(SEQX)) Q:SEQX=""  I $G(@ARRAY@(SEQX))'="" S PID
  =PID_$G(@ARRAY@(SEQX)) Q
  PIDQ  Q PID
        ;


=============================================================================
User Information:
Entered By  : KOPP,TERRY M                  Date Entered  : APR 18, 2008
Completed By: RUDINGER,NANCY L.             Date Completed: JUL 01, 2009
Released By : GROOMS,ANTHONY E              Date Released : JUL 01, 2009
=============================================================================


Packman Mail Message:
=====================

$END TXT
