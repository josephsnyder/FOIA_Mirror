Released IVM*2*129 SEQ #116
Extracted from mail message
**KIDS**:IVM*2.0*129^

**INSTALL NAME**
IVM*2.0*129
"BLD",7073,0)
IVM*2.0*129^INCOME VERIFICATION MATCH^0^3080918^y
"BLD",7073,1,0)
^^3^3^3080821^
"BLD",7073,1,1,0)
This patch corrects the bulletin sent as a result of an HL7 message 'AE'
"BLD",7073,1,2,0)
error being received in VistA.  Please refer to the National Patch Module
"BLD",7073,1,3,0)
(NPM) for a full description of the contents of this patch.
"BLD",7073,4,0)
^9.64PA^^
"BLD",7073,6.3)
4
"BLD",7073,"KRN",0)
^9.67PA^8989.52^19
"BLD",7073,"KRN",.4,0)
.4
"BLD",7073,"KRN",.401,0)
.401
"BLD",7073,"KRN",.402,0)
.402
"BLD",7073,"KRN",.403,0)
.403
"BLD",7073,"KRN",.5,0)
.5
"BLD",7073,"KRN",.84,0)
.84
"BLD",7073,"KRN",3.6,0)
3.6
"BLD",7073,"KRN",3.8,0)
3.8
"BLD",7073,"KRN",9.2,0)
9.2
"BLD",7073,"KRN",9.8,0)
9.8
"BLD",7073,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7073,"KRN",9.8,"NM",1,0)
IVMPREC1^^0^B32970288
"BLD",7073,"KRN",9.8,"NM","B","IVMPREC1",1)

"BLD",7073,"KRN",19,0)
19
"BLD",7073,"KRN",19.1,0)
19.1
"BLD",7073,"KRN",101,0)
101
"BLD",7073,"KRN",409.61,0)
409.61
"BLD",7073,"KRN",771,0)
771
"BLD",7073,"KRN",870,0)
870
"BLD",7073,"KRN",8989.51,0)
8989.51
"BLD",7073,"KRN",8989.52,0)
8989.52
"BLD",7073,"KRN",8994,0)
8994
"BLD",7073,"KRN","B",.4,.4)

"BLD",7073,"KRN","B",.401,.401)

"BLD",7073,"KRN","B",.402,.402)

"BLD",7073,"KRN","B",.403,.403)

"BLD",7073,"KRN","B",.5,.5)

"BLD",7073,"KRN","B",.84,.84)

"BLD",7073,"KRN","B",3.6,3.6)

"BLD",7073,"KRN","B",3.8,3.8)

"BLD",7073,"KRN","B",9.2,9.2)

"BLD",7073,"KRN","B",9.8,9.8)

"BLD",7073,"KRN","B",19,19)

"BLD",7073,"KRN","B",19.1,19.1)

"BLD",7073,"KRN","B",101,101)

"BLD",7073,"KRN","B",409.61,409.61)

"BLD",7073,"KRN","B",771,771)

"BLD",7073,"KRN","B",870,870)

"BLD",7073,"KRN","B",8989.51,8989.51)

"BLD",7073,"KRN","B",8989.52,8989.52)

"BLD",7073,"KRN","B",8994,8994)

"BLD",7073,"QUES",0)
^9.62^^
"BLD",7073,"REQB",0)
^9.611^1^1
"BLD",7073,"REQB",1,0)
IVM*2.0*82^2
"BLD",7073,"REQB","B","IVM*2.0*82",1)

"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
129^3080918
"PKG",220,22,1,"PAH",1,1,0)
^^3^3^3080918
"PKG",220,22,1,"PAH",1,1,1,0)
This patch corrects the bulletin sent as a result of an HL7 message 'AE'
"PKG",220,22,1,"PAH",1,1,2,0)
error being received in VistA.  Please refer to the National Patch Module
"PKG",220,22,1,"PAH",1,1,3,0)
(NPM) for a full description of the contents of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IVMPREC1")
0^1^B32970288^B26530064
"RTN","IVMPREC1",1,0)
IVMPREC1 ;ALB/SEK/BRM - PROCESS INCOMING HL7 (ACK) MESSAGES ; 07/28/2003
"RTN","IVMPREC1",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**9,17,26,52,34,72,82,129**; 21-OCT-94;Build 4
"RTN","IVMPREC1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMPREC1",4,0)
 ;
"RTN","IVMPREC1",5,0)
 ; This routine will process ACK HL7 messages received from the
"RTN","IVMPREC1",6,0)
 ; IVM center.
"RTN","IVMPREC1",7,0)
 ;
"RTN","IVMPREC1",8,0)
ACK ; - Receive ACK Message from IVM Center stored in ^TMP("HLR".
"RTN","IVMPREC1",9,0)
 ;   If 1st segment is BHS then set(s) of MSH, MSA(AE) will follow
"RTN","IVMPREC1",10,0)
 ;   indicating error(s) in transmission received by IVM Center
"RTN","IVMPREC1",11,0)
 ;   If 1st segment is MSH than MSA (AA) indicating batch or individual
"RTN","IVMPREC1",12,0)
 ;   query was received ok.  MSA (AE) indicates error in transmission of
"RTN","IVMPREC1",13,0)
 ;   individual query.
"RTN","IVMPREC1",14,0)
 ; 
"RTN","IVMPREC1",15,0)
 ; - When acknowledgment code = "AA" (application accept)
"RTN","IVMPREC1",16,0)
 ;   Stuff 1 into STATUS field (.03) of ^IVM(301.6 indicating IVM Center
"RTN","IVMPREC1",17,0)
 ;   has received transmission.  
"RTN","IVMPREC1",18,0)
 ;
"RTN","IVMPREC1",19,0)
 K HLNODE,IVMRTN,SEGCNT,CNT
"RTN","IVMPREC1",20,0)
 S IVMRTN="IVMPREC1"
"RTN","IVMPREC1",21,0)
 S HLFS=HL("FS"),HLQ=HL("Q"),HLECH=HL("ECH")
"RTN","IVMPREC1",22,0)
 K ^TMP($J,IVMRTN)
"RTN","IVMPREC1",23,0)
 F SEGCNT=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","IVMPREC1",24,0)
 . S CNT=0,^TMP($J,IVMRTN,SEGCNT,CNT)=HLNODE
"RTN","IVMPREC1",25,0)
 . F  S CNT=$O(HLNODE(CNT)) Q:'CNT  D
"RTN","IVMPREC1",26,0)
 . . S ^TMP($J,IVMRTN,SEGCNT,CNT)=HLNODE(CNT)
"RTN","IVMPREC1",27,0)
 S HLDA=HLMTIEN
"RTN","IVMPREC1",28,0)
 K HLNODE,SEGCNT,CNT
"RTN","IVMPREC1",29,0)
 ;
"RTN","IVMPREC1",30,0)
 S IVMSEG=$G(^TMP($J,IVMRTN,1,0))
"RTN","IVMPREC1",31,0)
 I IVMSEG="" G ACKQ
"RTN","IVMPREC1",32,0)
 I $P(IVMSEG,HLFS)'="BHS",$P(IVMSEG,HLFS)'="MSH" G ACKQ
"RTN","IVMPREC1",33,0)
 ;
"RTN","IVMPREC1",34,0)
 ; - process batches of acknowledges
"RTN","IVMPREC1",35,0)
 I $P(IVMSEG,HLFS)="BHS" D AE G ACKQ
"RTN","IVMPREC1",36,0)
 ;
"RTN","IVMPREC1",37,0)
 ; - process MSH MSA message
"RTN","IVMPREC1",38,0)
 S IVMSEG=$G(^TMP($J,IVMRTN,2,0))
"RTN","IVMPREC1",39,0)
 I $P(IVMSEG,HLFS)'="MSA" G ACKQ
"RTN","IVMPREC1",40,0)
 S IVMADDT=$P(IVMSEG,HLFS,3)
"RTN","IVMPREC1",41,0)
 I $P(IVMSEG,HLFS,2)="AA" D  G ACKQ
"RTN","IVMPREC1",42,0)
 .F IVMDA=0:0 S IVMDA=$O(^IVM(301.6,"AE",IVMADDT,IVMDA)) Q:'IVMDA  I $$SETSTAT^IVMTLOG(IVMDA,1)
"RTN","IVMPREC1",43,0)
 ;
"RTN","IVMPREC1",44,0)
 I $P(IVMSEG,HLFS,2)="AE" D  G ACKQ
"RTN","IVMPREC1",45,0)
 .S IVMMCI=$P(IVMSEG,HLFS,3)
"RTN","IVMPREC1",46,0)
 .S IVMEM=$P(IVMSEG,HLFS,4)
"RTN","IVMPREC1",47,0)
 .S IVMDA=$O(^IVM(301.6,"AE",IVMADDT,"")) I 'IVMDA D OTH Q
"RTN","IVMPREC1",48,0)
 .I $$SETSTAT^IVMTLOG(IVMDA,3,IVMEM)
"RTN","IVMPREC1",49,0)
 ;
"RTN","IVMPREC1",50,0)
ACKQ ;
"RTN","IVMPREC1",51,0)
 K ^TMP($J,IVMRTN)
"RTN","IVMPREC1",52,0)
 K DA,DIE,DR,IVMADDT,IVMI,IVMCT,IVMDA,IVMMCI,IVMEM,IVMNAME,IVMPAT,IVMRTN,IVMSEG,IVMSSN,IVMTEXT,XMSUB
"RTN","IVMPREC1",53,0)
 ;
"RTN","IVMPREC1",54,0)
 Q
"RTN","IVMPREC1",55,0)
 ;
"RTN","IVMPREC1",56,0)
AE ; - When acknowledgment code = "AE" (application error)
"RTN","IVMPREC1",57,0)
 ;   Stuff 3 into STATUS field(.03), error message into ERROR MESSAGE
"RTN","IVMPREC1",58,0)
 ;   field(.04), and 1 (NEW) into the ERROR PROCESSING STATUS field.
"RTN","IVMPREC1",59,0)
 ;   Stuff 1 into STATUS field(.03) for transmissions (no 'AE' code
"RTN","IVMPREC1",60,0)
 ;   received) received by IVM Center.
"RTN","IVMPREC1",61,0)
 ;
"RTN","IVMPREC1",62,0)
 N Z07FLG,Z07RET
"RTN","IVMPREC1",63,0)
 S IVMI=0 F  S IVMI=$O(^TMP($J,IVMRTN,IVMI)) Q:'IVMI  S IVMSEG=$G(^(IVMI,0)) D
"RTN","IVMPREC1",64,0)
 .D:$E(IVMSEG,1,3)="MSH"
"RTN","IVMPREC1",65,0)
 ..S Z07RET=0
"RTN","IVMPREC1",66,0)
 ..I $P(IVMSEG,HLFS,9)["ORU~Z07" S Z07FLG=1 Q
"RTN","IVMPREC1",67,0)
 ..K Z07FLG
"RTN","IVMPREC1",68,0)
 .Q:IVMSEG']""!($E(IVMSEG,1,3)'="MSA")!($P(IVMSEG,HLFS,2)'="AE")
"RTN","IVMPREC1",69,0)
 .S IVMMCI=$P(IVMSEG,HLFS,3)
"RTN","IVMPREC1",70,0)
 .S IVMEM=$P(IVMSEG,HLFS,4)
"RTN","IVMPREC1",71,0)
 .S IVMDA=$O(^IVM(301.6,"ADS",IVMMCI,"")) I 'IVMDA D  Q:'Z07RET
"RTN","IVMPREC1",72,0)
 ..I $D(Z07FLG) D  Q
"RTN","IVMPREC1",73,0)
 ...S Z07RET=$$Z07CHK(IVMI,IVMMCI,IVMEM)
"RTN","IVMPREC1",74,0)
 ...S:Z07RET IVMDA=$O(^IVM(301.6,"ADS",IVMMCI,""))
"RTN","IVMPREC1",75,0)
 ..D OTH
"RTN","IVMPREC1",76,0)
 .I $$SETSTAT^IVMTLOG(IVMDA,3,IVMEM)
"RTN","IVMPREC1",77,0)
 ;
"RTN","IVMPREC1",78,0)
 ; - update messages in batch with no error
"RTN","IVMPREC1",79,0)
 F IVMDA=0:0 S IVMDA=$O(^IVM(301.6,"AE",+$G(IVMMCI),IVMDA)) Q:'IVMDA  I $$SETSTAT^IVMTLOG(IVMDA,1)
"RTN","IVMPREC1",80,0)
 Q
"RTN","IVMPREC1",81,0)
 ;
"RTN","IVMPREC1",82,0)
OTH ; Generate message for errors other than Full/Initial Transmissions.
"RTN","IVMPREC1",83,0)
 N IVMRMM,IVMNAM,IVMPID,IVMMCID,IVMTMP,HLDA,HLDAT,HLSEG,DIC,DR,DA,DIQ
"RTN","IVMPREC1",84,0)
 S (IVMNAM,IVMPID,HLDA,IVMTMP)=""
"RTN","IVMPREC1",85,0)
 S HLDA=$O(^HL(772,"C",$P($G(IVMMCI),"-"),0))
"RTN","IVMPREC1",86,0)
 Q:+$G(HLDA)'>0
"RTN","IVMPREC1",87,0)
 Q:'$D(^HL(772,+HLDA,0))
"RTN","IVMPREC1",88,0)
 S DIC="^HL(772,",DR=200,DA=HLDA,DR(200.02)=.01,DA(200.02)=17,DIQ="HLDAT"
"RTN","IVMPREC1",89,0)
 D EN^DIQ1
"RTN","IVMPREC1",90,0)
 F  S IVMTMP=$O(HLDAT(772,HLDA,200,IVMTMP)) Q:((IVMTMP="")!($G(HLSEG)="PID"))  D
"RTN","IVMPREC1",91,0)
 .S HLSEG=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^")
"RTN","IVMPREC1",92,0)
 .I HLSEG="MSH" S IVMMCID=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^",10)
"RTN","IVMPREC1",93,0)
 .D:HLSEG="PID"
"RTN","IVMPREC1",94,0)
 ..;Find PID segment for the same message control ID only
"RTN","IVMPREC1",95,0)
 ..I IVMMCID'=IVMMCI S HLSEG="NOT CORRECT PID" Q
"RTN","IVMPREC1",96,0)
 ..; If PID segment was split, reconnect records
"RTN","IVMPREC1",97,0)
 ..I $L($G(HLDAT(772,HLDA,200,IVMTMP)))=245,$L($G(HLDAT(772,HLDA,200,IVMTMP)),U)<20 S HLDAT(772,HLDA,200,IVMTMP)=$$REBLDPID("HLDAT(772,"_HLDA_",200)",IVMTMP)
"RTN","IVMPREC1",98,0)
 ..S IVMNAM=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^",6)  ;PATIENT NAME
"RTN","IVMPREC1",99,0)
 ..S IVMNAM=$P(IVMNAM,"~")_", "_$P(IVMNAM,"~",2)
"RTN","IVMPREC1",100,0)
 ..S IVMPID=$P($G(HLDAT(772,HLDA,200,IVMTMP)),"^",20)  ;SSN
"RTN","IVMPREC1",101,0)
 ..;S IVMPID=$P(IVMPID,"~")
"RTN","IVMPREC1",102,0)
 ..S IVMPID=$E(IVMPID,1,3)_"-"_$E(IVMPID,4,5)_"-"_$E(IVMPID,6,9)
"RTN","IVMPREC1",103,0)
 ..S XMSUB="ERROR MESSAGE FROM THE HEC"
"RTN","IVMPREC1",104,0)
 ..S IVMTEXT(1)="An Insurance Confirmation message or a Billing/Collections Transmission"
"RTN","IVMPREC1",105,0)
 ..S IVMTEXT(2)="was rejected by the Health Eligibility Center with the following error:"
"RTN","IVMPREC1",106,0)
 ..S IVMTEXT(3)=" ",IVMTEXT(4)=IVMEM,IVMTEXT(5)=" "
"RTN","IVMPREC1",107,0)
 ..S IVMTEXT(6)="NAME: "_IVMNAM
"RTN","IVMPREC1",108,0)
 ..S IVMTEXT(7)="PID : "_IVMPID,IVMTEXT(8)=" "
"RTN","IVMPREC1",109,0)
 ..S IVMRMM=$$MMN^IVMPTRN4($P(IVMMCI,"-"))
"RTN","IVMPREC1",110,0)
 ..S IVMTEXT(9)="Mailman Message # of Acknowledged Transmission: "_$S(IVMRMM:IVMRMM,1:"<unknown>")
"RTN","IVMPREC1",111,0)
 ..S IVMTEXT(10)=" "
"RTN","IVMPREC1",112,0)
 ..S IVMTEXT(11)="If you are unable to find the source of this problem,"
"RTN","IVMPREC1",113,0)
 ..S IVMTEXT(12)="please contact your ISC Support Group or the HEC."
"RTN","IVMPREC1",114,0)
 ..D MAIL^IVMUFNC()
"RTN","IVMPREC1",115,0)
 Q
"RTN","IVMPREC1",116,0)
 ;
"RTN","IVMPREC1",117,0)
Z07CHK(CURSEQ,CURMCI,CUREM) ; Function ;
"RTN","IVMPREC1",118,0)
 ; INPUT
"RTN","IVMPREC1",119,0)
 ;      CURSEQ : Current Sequence # reviewing in batch
"RTN","IVMPREC1",120,0)
 ;      CURMCI : Current Message Control ID reviewing in batch
"RTN","IVMPREC1",121,0)
 ;      CUREM  : Current Error Message reviewing in batch
"RTN","IVMPREC1",122,0)
 ;
"RTN","IVMPREC1",123,0)
 ; Check for duplicate ACK sequence on the same batch
"RTN","IVMPREC1",124,0)
 N SEQ,CHKSEG,CHKSEGN,DUP
"RTN","IVMPREC1",125,0)
 S (SEQ,DUP)=0
"RTN","IVMPREC1",126,0)
 F  S SEQ=$O(^TMP($J,IVMRTN,SEQ)) Q:SEQ=""  D
"RTN","IVMPREC1",127,0)
 . S CHKSEG=^TMP($J,IVMRTN,SEQ,0),CHKSEGN=$E(CHKSEG,1,3)
"RTN","IVMPREC1",128,0)
 . Q:CHKSEGN'="MSA"
"RTN","IVMPREC1",129,0)
 . Q:SEQ=CURSEQ
"RTN","IVMPREC1",130,0)
 . S:$P(CHKSEG,"^",3)=CURMCI DUP=1
"RTN","IVMPREC1",131,0)
 I DUP Q "0^DUPLICATE SEQUENCE ON ACK BATCH"
"RTN","IVMPREC1",132,0)
 ;
"RTN","IVMPREC1",133,0)
 ; Check to see if ADS x-ref missing in last 1000 entries
"RTN","IVMPREC1",134,0)
 N END,IEN,MCI,FND,LOG,RET,TMPCTR
"RTN","IVMPREC1",135,0)
 S FND=0,RET="",IEN=" "
"RTN","IVMPREC1",136,0)
 F TMPCTR=1:1:1000 S IEN=$O(^IVM(301.6,IEN),-1) Q:+IEN=0  D  Q:FND
"RTN","IVMPREC1",137,0)
 . S MCI=$P(^IVM(301.6,IEN,0),"^",5)
"RTN","IVMPREC1",138,0)
 . I MCI=CURMCI S FND=1 D  Q
"RTN","IVMPREC1",139,0)
 . . S LOG=^IVM(301.6,IEN,0)
"RTN","IVMPREC1",140,0)
 . . I $P(LOG,"^",3)=3&($P(LOG,"^",4)=CUREM) S RET="0^ACK TO THIS SEQUENCE HAS ALREADY BEEN PROCESSED" Q
"RTN","IVMPREC1",141,0)
 . . S ^IVM(301.6,"ADS",CURMCI,IEN)="" S RET="1^ADS X-REF MISSING.  X-REF HAS BEEN RESET."
"RTN","IVMPREC1",142,0)
 Q RET
"RTN","IVMPREC1",143,0)
 ;
"RTN","IVMPREC1",144,0)
REBLDPID(ARRAY,SEQ) ; Reconnect the pieces of the PID segment
"RTN","IVMPREC1",145,0)
 ; ARRAY contains the HL7 message reference to be accessed indirectly
"RTN","IVMPREC1",146,0)
 ;  It should look similar in structure to the HL7 message text in
"RTN","IVMPREC1",147,0)
 ;  file 772
"RTN","IVMPREC1",148,0)
 ; @ARRAY@(SEQ) should = the first 'PID' segment record text and should
"RTN","IVMPREC1",149,0)
 ; be 245 characters long
"RTN","IVMPREC1",150,0)
 N PID,SEQX
"RTN","IVMPREC1",151,0)
 S PID=$G(@ARRAY@(SEQ)),SEQX=SEQ
"RTN","IVMPREC1",152,0)
 G:$L(PID)'=245 PIDQ
"RTN","IVMPREC1",153,0)
 F  S SEQX=$O(@ARRAY@(SEQX)) Q:SEQX=""  I $G(@ARRAY@(SEQX))'="" S PID=PID_$G(@ARRAY@(SEQX)) Q
"RTN","IVMPREC1",154,0)
PIDQ Q PID
"RTN","IVMPREC1",155,0)
 ;
"VER")
8.0^22.0
"BLD",7073,6)
^116
**END**
**END**
