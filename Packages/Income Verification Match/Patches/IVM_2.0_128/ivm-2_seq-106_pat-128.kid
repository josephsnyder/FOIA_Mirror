Released IVM*2*128 SEQ #106
Extracted from mail message
**KIDS**:IVM*2.0*128^

**INSTALL NAME**
IVM*2.0*128
"BLD",7040,0)
IVM*2.0*128^INCOME VERIFICATION MATCH^0^3080117^y
"BLD",7040,4,0)
^9.64PA^^
"BLD",7040,6.3)
2
"BLD",7040,"ABPKG")
n
"BLD",7040,"INID")
n^n^n
"BLD",7040,"KRN",0)
^9.67PA^8989.52^19
"BLD",7040,"KRN",.4,0)
.4
"BLD",7040,"KRN",.401,0)
.401
"BLD",7040,"KRN",.402,0)
.402
"BLD",7040,"KRN",.403,0)
.403
"BLD",7040,"KRN",.5,0)
.5
"BLD",7040,"KRN",.84,0)
.84
"BLD",7040,"KRN",3.6,0)
3.6
"BLD",7040,"KRN",3.8,0)
3.8
"BLD",7040,"KRN",9.2,0)
9.2
"BLD",7040,"KRN",9.8,0)
9.8
"BLD",7040,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7040,"KRN",9.8,"NM",1,0)
IVMZ07C^^0^B18396291
"BLD",7040,"KRN",9.8,"NM","B","IVMZ07C",1)

"BLD",7040,"KRN",19,0)
19
"BLD",7040,"KRN",19.1,0)
19.1
"BLD",7040,"KRN",101,0)
101
"BLD",7040,"KRN",409.61,0)
409.61
"BLD",7040,"KRN",771,0)
771
"BLD",7040,"KRN",870,0)
870
"BLD",7040,"KRN",8989.51,0)
8989.51
"BLD",7040,"KRN",8989.52,0)
8989.52
"BLD",7040,"KRN",8994,0)
8994
"BLD",7040,"KRN","B",.4,.4)

"BLD",7040,"KRN","B",.401,.401)

"BLD",7040,"KRN","B",.402,.402)

"BLD",7040,"KRN","B",.403,.403)

"BLD",7040,"KRN","B",.5,.5)

"BLD",7040,"KRN","B",.84,.84)

"BLD",7040,"KRN","B",3.6,3.6)

"BLD",7040,"KRN","B",3.8,3.8)

"BLD",7040,"KRN","B",9.2,9.2)

"BLD",7040,"KRN","B",9.8,9.8)

"BLD",7040,"KRN","B",19,19)

"BLD",7040,"KRN","B",19.1,19.1)

"BLD",7040,"KRN","B",101,101)

"BLD",7040,"KRN","B",409.61,409.61)

"BLD",7040,"KRN","B",771,771)

"BLD",7040,"KRN","B",870,870)

"BLD",7040,"KRN","B",8989.51,8989.51)

"BLD",7040,"KRN","B",8989.52,8989.52)

"BLD",7040,"KRN","B",8994,8994)

"BLD",7040,"QUES",0)
^9.62^^
"BLD",7040,"REQB",0)
^9.611^1^1
"BLD",7040,"REQB",1,0)
IVM*2.0*105^2
"BLD",7040,"REQB","B","IVM*2.0*105",1)

"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
128^3080117
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IVMZ07C")
0^1^B18396291^B18729103
"RTN","IVMZ07C",1,0)
IVMZ07C ;BAJ/PHH - HL7 Z07 CONSISTENCY CHECKER -- DRIVER ROUTINE ; 1/17/2008
"RTN","IVMZ07C",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**105,128**;JUL 8,1996;Build 2
"RTN","IVMZ07C",3,0)
 ;
"RTN","IVMZ07C",4,0)
 ; 
"RTN","IVMZ07C",5,0)
 ; This routine calls various checking subroutines and manages arrays and data filing
"RTN","IVMZ07C",6,0)
 ; for inconsistency checking prior to building a Z07 HL7 record.  This routine returns
"RTN","IVMZ07C",7,0)
 ; a value and must be called as an API:
"RTN","IVMZ07C",8,0)
 ; 
"RTN","IVMZ07C",9,0)
 ; I '$$EN^IVMZ07C(DFN) Q
"RTN","IVMZ07C",10,0)
 ;
"RTN","IVMZ07C",11,0)
 ; Values returned:
"RTN","IVMZ07C",12,0)
 ; 0 = Fail: inconsistencies found, do not build Z07 record
"RTN","IVMZ07C",13,0)
 ; 1 = Pass: No inconsistencies found, Ok to build Z07 record
"RTN","IVMZ07C",14,0)
 ;
"RTN","IVMZ07C",15,0)
 ; Must be called from entry point
"RTN","IVMZ07C",16,0)
 Q
"RTN","IVMZ07C",17,0)
 ;
"RTN","IVMZ07C",18,0)
EN(DFN) ; entry point.  Patient DFN is sent from calling routine.
"RTN","IVMZ07C",19,0)
 ; initialize working variables
"RTN","IVMZ07C",20,0)
 N PASS,DGP,DGSD,U
"RTN","IVMZ07C",21,0)
 S U="^"
"RTN","IVMZ07C",22,0)
 ; 
"RTN","IVMZ07C",23,0)
 ; Input:        DFN     = ^DPT(DFN) of record to check
"RTN","IVMZ07C",24,0)
 ;                       BATCH   = 1     batch/background job records should be counted
"RTN","IVMZ07C",25,0)
 ;                                       = 0     single job, do not count records
"RTN","IVMZ07C",26,0)
 ; structure:
"RTN","IVMZ07C",27,0)
 ; 1. delete existing Z07 inconsistencies
"RTN","IVMZ07C",28,0)
 ; 2. load data arrays
"RTN","IVMZ07C",29,0)
 ; 3. call subroutines
"RTN","IVMZ07C",30,0)
 ; 4. check for Pass/Fail
"RTN","IVMZ07C",31,0)
 ; 5. update file 38.5 if necessary
"RTN","IVMZ07C",32,0)
 ; 6. return Pass/Fail
"RTN","IVMZ07C",33,0)
 ; 
"RTN","IVMZ07C",34,0)
 ; Set flag
"RTN","IVMZ07C",35,0)
 S PASS=0
"RTN","IVMZ07C",36,0)
 I '$D(^DPT(DFN)) Q PASS
"RTN","IVMZ07C",37,0)
 S PASS=1
"RTN","IVMZ07C",38,0)
 ;
"RTN","IVMZ07C",39,0)
 ; Load Patient and Spouse/dependent data
"RTN","IVMZ07C",40,0)
 D LOADPT(DFN,.DGP),LOADSD^IVMZ072(DFN,.DGSD)
"RTN","IVMZ07C",41,0)
 ;
"RTN","IVMZ07C",42,0)
 ; Do checks and file inconsistencies
"RTN","IVMZ07C",43,0)
 D WORK(DFN,.DGP,.DGSD)
"RTN","IVMZ07C",44,0)
 ;
"RTN","IVMZ07C",45,0)
 ; Delete old Inconsistency info
"RTN","IVMZ07C",46,0)
 D DELETE(DFN)
"RTN","IVMZ07C",47,0)
 ;
"RTN","IVMZ07C",48,0)
 ; File new inconsistencies if necessary
"RTN","IVMZ07C",49,0)
 I $$FILE(DFN) S PASS=0
"RTN","IVMZ07C",50,0)
 ;
"RTN","IVMZ07C",51,0)
 ; update counters
"RTN","IVMZ07C",52,0)
 D COUNT(PASS)
"RTN","IVMZ07C",53,0)
 ;
"RTN","IVMZ07C",54,0)
 ; return pass/fail flag
"RTN","IVMZ07C",55,0)
 Q PASS
"RTN","IVMZ07C",56,0)
 ;
"RTN","IVMZ07C",57,0)
COUNT(PASS) ; counter for batch run
"RTN","IVMZ07C",58,0)
 N I
"RTN","IVMZ07C",59,0)
 ; Set it up the first time through
"RTN","IVMZ07C",60,0)
 I '$D(^TMP($J,"CC")) D
"RTN","IVMZ07C",61,0)
 . F I=0,1 S ^TMP($J,"CC",I)=0
"RTN","IVMZ07C",62,0)
 ;
"RTN","IVMZ07C",63,0)
 ; Increment Batch counter
"RTN","IVMZ07C",64,0)
 S ^TMP($J,"CC",PASS)=^TMP($J,"CC",PASS)+1
"RTN","IVMZ07C",65,0)
 Q
"RTN","IVMZ07C",66,0)
 ;
"RTN","IVMZ07C",67,0)
LOADPT(DFN,DGP) ; load patient data into arrays
"RTN","IVMZ07C",68,0)
 N NIEN,IEN,I,DTTM,NAMCOM,NAME
"RTN","IVMZ07C",69,0)
 ; we need to load data from the following files
"RTN","IVMZ07C",70,0)
 ; Patient File                          2
"RTN","IVMZ07C",71,0)
 ; Name Components                       20
"RTN","IVMZ07C",72,0)
 ; Patient Enrollment                    27.11
"RTN","IVMZ07C",73,0)
 ; Means test file                       408.31
"RTN","IVMZ07C",74,0)
 ; MST History file                      29.11
"RTN","IVMZ07C",75,0)
 ; Note: we also need Catastrophic data info, but that subroutine loads its own data array.
"RTN","IVMZ07C",76,0)
 ; 
"RTN","IVMZ07C",77,0)
 ; ***************************
"RTN","IVMZ07C",78,0)
 ; DGP("PAT") Patient file
"RTN","IVMZ07C",79,0)
 F I=0,.3,.15,.29,.31,.32,.321,.322,.35,.36,.361,.38,.52,"SSN","TYPE","VET" S DGP("PAT",I)=$G(^DPT(DFN,I))
"RTN","IVMZ07C",80,0)
 S NAME=$P($G(^DPT(DFN,0)),"^",1),NAMCOM=$P($G(^DPT(DFN,"NAME")),"^",1)'=""
"RTN","IVMZ07C",81,0)
 ; 
"RTN","IVMZ07C",82,0)
 ; ***************************
"RTN","IVMZ07C",83,0)
 ; DGP("NAME") Name Components
"RTN","IVMZ07C",84,0)
 I NAMCOM S NIEN=$P(^DPT(DFN,"NAME"),U,1) I '$D(^VA(20,NIEN,1)) S NAMCOM=0
"RTN","IVMZ07C",85,0)
 S DGP("NAME",1)=$S(NAMCOM:$G(^VA(20,NIEN,1)),1:$P(NAME,",")_"^"_$P($P(NAME,",",2)," ",1)_"^"_$P($P(NAME,",",2)," ",2))
"RTN","IVMZ07C",86,0)
 ;
"RTN","IVMZ07C",87,0)
 ; ***************************
"RTN","IVMZ07C",88,0)
 ;
"RTN","IVMZ07C",89,0)
 ; DGP("ENR") Patient Enrollment
"RTN","IVMZ07C",90,0)
 S NIEN="",NIEN=$P($G(^DPT(DFN,"ENR")),U,1)
"RTN","IVMZ07C",91,0)
 I NIEN]"",$D(^DGEN(27.11,NIEN)) M DGP("ENR")=^DGEN(27.11,NIEN)
"RTN","IVMZ07C",92,0)
 ; 
"RTN","IVMZ07C",93,0)
 ; ***************************
"RTN","IVMZ07C",94,0)
 ; DGP("MEANS") Means Test
"RTN","IVMZ07C",95,0)
 S NIEN=+$$LST^DGMTU(DFN) I NIEN,$D(^DGMT(408.31,NIEN,0)) S DGP("MEANS",0)=^DGMT(408.31,NIEN,0)
"RTN","IVMZ07C",96,0)
 ;
"RTN","IVMZ07C",97,0)
 ; ***************************
"RTN","IVMZ07C",98,0)
 ; DGP("MST") MST History
"RTN","IVMZ07C",99,0)
 S (DTTM,NIEN)=""
"RTN","IVMZ07C",100,0)
 S DTTM=$O(^DGMS(29.11,"APDT",DFN,""),-1)
"RTN","IVMZ07C",101,0)
 I DTTM'="" D
"RTN","IVMZ07C",102,0)
 . S NIEN=$O(^DGMS(29.11,"APDT",DFN,DTTM,""),-1)
"RTN","IVMZ07C",103,0)
 . I $D(^DGMS(29.11,NIEN,0)) S DGP("MST",0)=^DGMS(29.11,NIEN,0)
"RTN","IVMZ07C",104,0)
 ;
"RTN","IVMZ07C",105,0)
 ; ***************************
"RTN","IVMZ07C",106,0)
 Q
"RTN","IVMZ07C",107,0)
 ;
"RTN","IVMZ07C",108,0)
WORK(DFN,DGP,DGSD) ;
"RTN","IVMZ07C",109,0)
 ; call subroutines to run rules and file any inconsistencies
"RTN","IVMZ07C",110,0)
 ;
"RTN","IVMZ07C",111,0)
 ; Demographics rules
"RTN","IVMZ07C",112,0)
 D EN^IVMZ7CD(DFN,.DGP,.DGSD)
"RTN","IVMZ07C",113,0)
 ;
"RTN","IVMZ07C",114,0)
 ; Enrollment/Eligibility rules
"RTN","IVMZ07C",115,0)
 D EN^IVMZ7CE(DFN,.DGP)
"RTN","IVMZ07C",116,0)
 ;
"RTN","IVMZ07C",117,0)
 ; Service rules
"RTN","IVMZ07C",118,0)
 D EN^IVMZ7CS(DFN,.DGP)
"RTN","IVMZ07C",119,0)
 ;
"RTN","IVMZ07C",120,0)
 ; Catastrophic Disability rules
"RTN","IVMZ07C",121,0)
 D EN^IVMZ7CCD(DFN)
"RTN","IVMZ07C",122,0)
 ;
"RTN","IVMZ07C",123,0)
 ; Registration Inconsistencies
"RTN","IVMZ07C",124,0)
 D EN^IVMZ7CR(DFN,.DGP,.DGSD)
"RTN","IVMZ07C",125,0)
 ;
"RTN","IVMZ07C",126,0)
 Q
"RTN","IVMZ07C",127,0)
 ;
"RTN","IVMZ07C",128,0)
DELETE(DFN) ; delete all Z07 inconsistencies from INCONSISTENT DATA file (#38.5).  Since we're not sure which rules
"RTN","IVMZ07C",129,0)
 ; will block a Z07 record, we need to loop through the INCONSISTENT DATA ELEMENTS file (#38.6) and grab only 
"RTN","IVMZ07C",130,0)
 ; those rules which are marked to prevent building a Z07 record:
"RTN","IVMZ07C",131,0)
 ; 
"RTN","IVMZ07C",132,0)
 ;
"RTN","IVMZ07C",133,0)
 N DELARRY,RULE,DIK,DA
"RTN","IVMZ07C",134,0)
 ; 
"RTN","IVMZ07C",135,0)
 ; create an array of rules which prevent Z07 records 
"RTN","IVMZ07C",136,0)
 S RULE=0 F  S RULE=$O(^DGIN(38.6,RULE)) Q:RULE=""  Q:$A(RULE)>$A(9)  D
"RTN","IVMZ07C",137,0)
 . I '$P(^DGIN(38.6,RULE,0),U,5),$P(^DGIN(38.6,RULE,0),U,6) S DELARRY(RULE)=""
"RTN","IVMZ07C",138,0)
 ;
"RTN","IVMZ07C",139,0)
 ; Now we have to check the patient INCONSISTENT DATA file (#38.5) and delete any records which have to be rechecked.
"RTN","IVMZ07C",140,0)
 ; 
"RTN","IVMZ07C",141,0)
 S DIK="^DGIN(38.5,"_DFN_","_"""I"""_","
"RTN","IVMZ07C",142,0)
 ;
"RTN","IVMZ07C",143,0)
 S DA="" F  S DA=$O(DELARRY(DA)) Q:DA=""  D ^DIK
"RTN","IVMZ07C",144,0)
 Q
"RTN","IVMZ07C",145,0)
 ;
"RTN","IVMZ07C",146,0)
FILE(DFN) ;
"RTN","IVMZ07C",147,0)
 N FILE,SUCCESS,CCS,I,DGENDA,DATA,SUBFILE,DIK,DA
"RTN","IVMZ07C",148,0)
 S FILE=38.5,CCS=0
"RTN","IVMZ07C",149,0)
 ; if no inconsistencies, return 0
"RTN","IVMZ07C",150,0)
 I '$D(^TMP($J,DFN)) D  Q CCS
"RTN","IVMZ07C",151,0)
 . ; clean up INCONSISTENT DATA file if no inconsistencies exist
"RTN","IVMZ07C",152,0)
 . I '$P($G(^DGIN(38.5,DFN,"I",0)),"^",4) D
"RTN","IVMZ07C",153,0)
 . . S DIK="^DGIN(38.5,",DA=DFN
"RTN","IVMZ07C",154,0)
 . . D ^DIK
"RTN","IVMZ07C",155,0)
 ;
"RTN","IVMZ07C",156,0)
 ; else process inconsistencies and return PASS=0
"RTN","IVMZ07C",157,0)
 S CCS=1
"RTN","IVMZ07C",158,0)
 ; if a new entry, create a stub
"RTN","IVMZ07C",159,0)
 S DATA(.01)=DFN
"RTN","IVMZ07C",160,0)
 I '$D(^DGIN(FILE,"B",DFN)) D
"RTN","IVMZ07C",161,0)
 . S DATA(2)=$$DT^XLFDT,DATA(3)=.5
"RTN","IVMZ07C",162,0)
 . S SUCCESS=$$ADD^DGENDBS(FILE,,.DATA,,DFN)
"RTN","IVMZ07C",163,0)
 ;
"RTN","IVMZ07C",164,0)
 ; update file header with data and user info.
"RTN","IVMZ07C",165,0)
 ; Last Updated field (#4) = Today's date
"RTN","IVMZ07C",166,0)
 ; Last Updated by field (#5) = Postmaster
"RTN","IVMZ07C",167,0)
 S DGENDA=DFN,DATA(4)=$$DT^XLFDT,DATA(5)=.5
"RTN","IVMZ07C",168,0)
 S SUCCESS=$$UPD^DGENDBS(FILE,.DGENDA,.DATA)
"RTN","IVMZ07C",169,0)
 ;
"RTN","IVMZ07C",170,0)
 ; add inconsistencies to file
"RTN","IVMZ07C",171,0)
 K DATA
"RTN","IVMZ07C",172,0)
 S SUBFILE=38.51,DGENDA(1)=DFN
"RTN","IVMZ07C",173,0)
 S I="" F  S I=$O(^TMP($J,DFN,I)) Q:I=""  D
"RTN","IVMZ07C",174,0)
 . S (DATA(.01),DATA(.001),DGENDA)=I
"RTN","IVMZ07C",175,0)
 . S SUCCESS=$$ADD^DGENDBS(SUBFILE,.DGENDA,.DATA)
"RTN","IVMZ07C",176,0)
 ;
"RTN","IVMZ07C",177,0)
 ; kill temp file before exit
"RTN","IVMZ07C",178,0)
 K ^TMP($J,DFN)
"RTN","IVMZ07C",179,0)
 ;
"RTN","IVMZ07C",180,0)
 Q CCS
"RTN","IVMZ07C",181,0)
 ;
"VER")
8.0^22.0
"BLD",7040,6)
^106
**END**
**END**
