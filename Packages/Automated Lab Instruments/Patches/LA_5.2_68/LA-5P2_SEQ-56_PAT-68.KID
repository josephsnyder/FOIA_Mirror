Released LA*5.2*68 SEQ #56
Extracted from mail message
**KIDS**:LA*5.2*68^

**INSTALL NAME**
LA*5.2*68
"BLD",7628,0)
LA*5.2*68^AUTOMATED LAB INSTRUMENTS^0^3091214^y
"BLD",7628,1,0)
^^727^727^3091209^
"BLD",7628,1,1,0)
Blood Bank Clearance
"BLD",7628,1,2,0)
====================
"BLD",7628,1,3,0)
VISTA Laboratory Package patch LA*5.2*68 contains changes to software
"BLD",7628,1,4,0)
controlled by VHA DIRECTIVE 99-053, titled VISTA BLOOD BANK SOFTWARE.
"BLD",7628,1,5,0)
Changes include: 
"BLD",7628,1,6,0)
    New style indexes have been created for the following sub-files
"BLD",7628,1,7,0)
    of the LAB DATA file (#63):
"BLD",7628,1,8,0)
        ELECTRON MICROSCOPY (#63.02)
"BLD",7628,1,9,0)
        SURGICAL PATHOLOGY (#63.08)
"BLD",7628,1,10,0)
        CYTOPATHOLOGY (#63.09)
"BLD",7628,1,11,0)
 
"BLD",7628,1,12,0)
All of the above changes have been reviewed by the VISTA Blood Bank
"BLD",7628,1,13,0)
Developer and found to have no impact on the VISTA BLOOD BANK SOFTWARE
"BLD",7628,1,14,0)
control functions.
"BLD",7628,1,15,0)
 
"BLD",7628,1,16,0)
RISK ANALYSIS:   Changes made by patch LA*5.2*68 have no effect on Blood
"BLD",7628,1,17,0)
Bank software functionality, therefore RISK is none.
"BLD",7628,1,18,0)
 
"BLD",7628,1,19,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS:  Patch LA*5.2*68 does not
"BLD",7628,1,20,0)
alter or modify any software design safeguards or safety critical elements
"BLD",7628,1,21,0)
functions.
"BLD",7628,1,22,0)
 
"BLD",7628,1,23,0)
POTENTIAL IMPACT ON SITES:  This patch contains changes to 0 routines and
"BLD",7628,1,24,0)
1 file identified in Veterans Health Administration (VHA) Directive 99-053,
"BLD",7628,1,25,0)
group B listing. The changes have no effect on Blood Bank functionality or
"BLD",7628,1,26,0)
medical device control functions. There is no adverse potential to sites.
"BLD",7628,1,27,0)
 
"BLD",7628,1,28,0)
========================================
"BLD",7628,1,29,0)
 
"BLD",7628,1,30,0)
This patch supports the VA Health Data Repository (HDR) effort,
"BLD",7628,1,31,0)
allowing changes to LAB DATA file (#63) to be transmitted to the HDR 
"BLD",7628,1,32,0)
via a VistA Laboratory HL7 Result (ORU) message.
"BLD",7628,1,33,0)
 
"BLD",7628,1,34,0)
Additionally, it provides the capability for the transmission of the HL7
"BLD",7628,1,35,0)
ORU message containing patient laboratory results to subscribers of the HL7
"BLD",7628,1,36,0)
event protocol LA7 LAB RESULTS AVAILABLE (EVN) as these results are made
"BLD",7628,1,37,0)
available within the Laboratory package. The following subscripts are
"BLD",7628,1,38,0)
supported by the event: "CH", "MI", "SP", "CY", "EM". See post-install
"BLD",7628,1,39,0)
instructions for enabling this capability.
"BLD",7628,1,40,0)
 
"BLD",7628,1,41,0)
  
"BLD",7628,1,42,0)
****************************************************************************
"BLD",7628,1,43,0)
  
"BLD",7628,1,44,0)
Patch LA*5.2*68 allows the HL7 ORU message containing patient laboratory 
"BLD",7628,1,45,0)
results to be transmitted to the subscriber, LA7 LAB RESULTS TO HDR 
"BLD",7628,1,46,0)
(SUB). This subscriber protocol is used to transmit laboratory results to 
"BLD",7628,1,47,0)
the VA HDR.
"BLD",7628,1,48,0)
 
"BLD",7628,1,49,0)
The HDR Team will contact the Chief of IRM at each site to set up the 
"BLD",7628,1,50,0)
coordination of lab extraction (LA*5.2*68) and the activation of the 
"BLD",7628,1,51,0)
subscriber (HDR).
"BLD",7628,1,52,0)
 
"BLD",7628,1,53,0)
The coordination of extracting existing laboratory data (HDR historical) 
"BLD",7628,1,54,0)
and the configuration of the LA7 LAB RESULTS TO HDR (SUB) subscriber will 
"BLD",7628,1,55,0)
be started at the same time. This will ensure that there is an overlap of 
"BLD",7628,1,56,0)
laboratory results between the real time extraction of lab data and the 
"BLD",7628,1,57,0)
historical extraction of lab data.
"BLD",7628,1,58,0)
 
"BLD",7628,1,59,0)
If a VA site activates the LA7 LAB RESULTS TO HDR (SUB) subscriber before 
"BLD",7628,1,60,0)
the historical extraction of existing laboratory data, the real time 
"BLD",7628,1,61,0)
extraction of lab data at the VA site may not be synchronized with the 
"BLD",7628,1,62,0)
HDR data.
"BLD",7628,1,63,0)
 
"BLD",7628,1,64,0)
If you have questions regarding installation or implementation,
"BLD",7628,1,65,0)
contact the HDR Project Office.
"BLD",7628,1,66,0)
 
"BLD",7628,1,67,0)
Once the HDR Project Office confirms that installation and implementation 
"BLD",7628,1,68,0)
was accomplished successfully, you must log a Remedy ticket for any
"BLD",7628,1,69,0)
subsequent problems encountered.
"BLD",7628,1,70,0)
 
"BLD",7628,1,71,0)
*****************************************************************************
"BLD",7628,1,72,0)
  
"BLD",7628,1,73,0)
 
"BLD",7628,1,74,0)
1. The following protocols are added to the PROTOCOL file (#101)
"BLD",7628,1,75,0)
 
"BLD",7628,1,76,0)
NAME: LA7 LAB RESULTS ACTION
"BLD",7628,1,77,0)
  ITEM TEXT: Lab process results for HL7 messaging
"BLD",7628,1,78,0)
  TYPE: action                          
"BLD",7628,1,79,0)
  PACKAGE: AUTOMATED LAB INSTRUMENTS
"BLD",7628,1,80,0)
 DESCRIPTION:   Action protocol to setup sending lab results to HL7 message
"BLD",7628,1,81,0)
 subscribers via protocol LA7 LAB RESULTS AVAILABLE (EVN) - Lab Results
"BLD",7628,1,82,0)
 Available Event.  This protocol should be attached to protocol LAB RESULTS
"BLD",7628,1,83,0)
 => EXTERNAL PACKAGE [LR7O ALL EVSEND RESULTS] which is an extended action
"BLD",7628,1,84,0)
 protocol triggered by the lab result verification process.
"BLD",7628,1,85,0)
  ENTRY ACTION: D QUEUE^LA7HDR          TIMESTAMP: 59056,40855
"BLD",7628,1,86,0)
 
"BLD",7628,1,87,0)
 
"BLD",7628,1,88,0)
NAME: LA7 LAB RESULTS AVAILABLE (EVN)  ITEM TEXT: Lab Results Available Event
"BLD",7628,1,89,0)
  TYPE: event driver                   
"BLD",7628,1,90,0)
 DESCRIPTION: A VistA Laboratory package HL7 ORU result message is created
"BLD",7628,1,91,0)
 and sent by the HL package for transmission to any subscribers of event
"BLD",7628,1,92,0)
 protocol LA7 LAB  RESULTS AVAILABLE (EVN).
"BLD",7628,1,93,0)
 
"BLD",7628,1,94,0)
 It provides the capability for the generation of a Laboratory HL7 ORU
"BLD",7628,1,95,0)
 message containing patient laboratory results to subscribers of the HL7
"BLD",7628,1,96,0)
 event protocol LA7 LAB RESULTS AVAILABLE (EVN) as these results are made
"BLD",7628,1,97,0)
 available within the Laboratory package.
"BLD",7628,1,98,0)
  
"BLD",7628,1,99,0)
 The following subscripts are supported by the event:
"BLD",7628,1,100,0)
   "CH", "MI", "SP", "CY", "EM".
"BLD",7628,1,101,0)
 
"BLD",7628,1,102,0)
  TIMESTAMP: 59725,36770                SENDING APPLICATION: LA7LAB
"BLD",7628,1,103,0)
  TRANSACTION MESSAGE TYPE: ORU         EVENT TYPE: R01
"BLD",7628,1,104,0)
  MESSAGE STRUCTURE: ORU_R01            ACCEPT ACK CODE: AL
"BLD",7628,1,105,0)
  APPLICATION ACK TYPE: NE              VERSION ID: 2.4
"BLD",7628,1,106,0)
  RESPONSE PROCESSING ROUTINE: D ACK^LA7VHL
"BLD",7628,1,107,0)
SUBSCRIBERS: LA7 LAB RESULTS TO HDR (SUB)
"BLD",7628,1,108,0)
 
"BLD",7628,1,109,0)
 
"BLD",7628,1,110,0)
NAME: LA7 LAB RESULTS TO HDR (SUB)      ITEM TEXT: Send Lab Results to HDR
"BLD",7628,1,111,0)
  TYPE: subscriber                      
"BLD",7628,1,112,0)
 DESCRIPTION:   This protocol should be attached to the HL7 event protocol
"BLD",7628,1,113,0)
 LA7 LAB RESULTS AVAILABLE (EVN). See this protocol for further information.
"BLD",7628,1,114,0)
 
"BLD",7628,1,115,0)
 This subscriber protocol is used by the Laboratory package to indicate to
"BLD",7628,1,116,0)
 the HL package to send laboratory results to the VA Health Data Repository
"BLD",7628,1,117,0)
 (HDR).
"BLD",7628,1,118,0)
 
"BLD",7628,1,119,0)
 It utilizes the "Router" Subscriber Protocol supported by the VistA HL
"BLD",7628,1,120,0)
 package. The routing logic uses the value of the parameter passed into the
"BLD",7628,1,121,0)
 router to determine which Laboratory package subscript should be sent to
"BLD",7628,1,122,0)
 the HDR.
"BLD",7628,1,123,0)
 
"BLD",7628,1,124,0)
 Examples:
"BLD",7628,1,125,0)
 
"BLD",7628,1,126,0)
 ROUTING LOGIC: D RTR^LA7HDR("CH;") will only send to HDR-IMS results
"BLD",7628,1,127,0)
 associated with Laboratory "CH" subscript.
"BLD",7628,1,128,0)
 
"BLD",7628,1,129,0)
 ROUTING LOGIC: D RTR^LA7HDR("MI;") will only send to HDR-IMS results
"BLD",7628,1,130,0)
 associated with Laboratory "MI" subscript.
"BLD",7628,1,131,0)
 
"BLD",7628,1,132,0)
 ROUTING LOGIC: D RTR^LA7HDR("CH;MI;SP;") will only send to HDR-IMS results
"BLD",7628,1,133,0)
 associated with Laboratory "CH", "MI", and "SP" subscripts.
"BLD",7628,1,134,0)
 
"BLD",7628,1,135,0)
  TIMESTAMP: 59056,40125                RECEIVING APPLICATION: LA7HDR
"BLD",7628,1,136,0)
  EVENT TYPE: R01                       LOGICAL LINK: VDEFVIE4
"BLD",7628,1,137,0)
  RESPONSE MESSAGE TYPE: ACK            SENDING FACILITY REQUIRED?: YES
"BLD",7628,1,138,0)
  RECEIVING FACILITY REQUIRED?: YES     ROUTING LOGIC: D RTR^LA7HDR("CH;")
"BLD",7628,1,139,0)
 
"BLD",7628,1,140,0)
 NOTE: This subscriber protocol is distributed with the ROUTING LOGIC
"BLD",7628,1,141,0)
       disabled. See post-installation instructions for guidance to
"BLD",7628,1,142,0)
       enable the protocol.
"BLD",7628,1,143,0)
 
"BLD",7628,1,144,0)
2. The following option is added to the OPTION file (#19)
"BLD",7628,1,145,0)
 
"BLD",7628,1,146,0)
NAME: LA7 HDR RECOVER    MENU TEXT: Recover/Transmit Lab HDR Result
"BLD",7628,1,147,0)
Messages
"BLD",7628,1,148,0)
 TYPE: run routine                                      
"BLD",7628,1,149,0)
 PACKAGE: AUTOMATED LAB INSTRUMENTS
"BLD",7628,1,150,0)
 DESCRIPTION:   Option to recover from failed Lab HDR ORU Result message 
"BLD",7628,1,151,0)
generation and/or transmission failure. This option allows the user to
"BLD",7628,1,152,0)
select those VistA Laboratory accessions that need to be transmitted to
"BLD",7628,1,153,0)
the VA HDR and other subscribers of the VistA Laboratory Result Available
"BLD",7628,1,154,0)
HL7 message capability via the protocol Lab Results Available Event [LA7
"BLD",7628,1,155,0)
LAB RESULTS AVAILABLE (EVN)].
"BLD",7628,1,156,0)
 
"BLD",7628,1,157,0)
If the original message generation/transmission failed due to system or 
"BLD",7628,1,158,0)
communication problems then using this option will allow the generation of
"BLD",7628,1,159,0)
new HL7 messages with the results associated with the selected 
"BLD",7628,1,160,0)
accessions.  Accessions can be selected using the human-readable accession
"BLD",7628,1,161,0)
designation (area abbreviation modified date accession number - "CH 1225
"BLD",7628,1,162,0)
100") or the accession's associated 10 character unique identifier (UID).
"BLD",7628,1,163,0)
 
"BLD",7628,1,164,0)
 ROUTINE: RECOVER^LA7HDR 
"BLD",7628,1,165,0)
 UPPERCASE MENU TEXT: RECOVER/TRANSMIT LAB HDR RESUL
"BLD",7628,1,166,0)
 
"BLD",7628,1,167,0)
This option is assigned to the Lab liaison menu option [LRLIAISON] and
"BLD",7628,1,168,0)
can be assigned to other uses as needed that support/monitor message 
"BLD",7628,1,169,0)
transmission to the VA HDR and other subscribers.
"BLD",7628,1,170,0)
 
"BLD",7628,1,171,0)
3. The LA7HDR routine, if the configuration LA7HDR in LA7 MESSAGE
"BLD",7628,1,172,0)
PARAMETER file (#62.48) has an active status, queues the record for
"BLD",7628,1,173,0)
transmission to the HDR via a HL7 ORU result message which is transmitted
"BLD",7628,1,174,0)
by the HL package to any subscribers of event protocol LA7 LAB RESULTS
"BLD",7628,1,175,0)
AVAILABLE (EVN) in addition to the HDR subscriber LA7 LAB RESULTS TO HDR
"BLD",7628,1,176,0)
(SUB).
"BLD",7628,1,177,0)
 
"BLD",7628,1,178,0)
   The LA7 LAB RESULTS TO HDR (SUB) subscriber protocol uses the logical
"BLD",7628,1,179,0)
link VDEFVIE4. This is a router subscriber protocol which determines
"BLD",7628,1,180,0)
which Lab HL7 messages are sent to the HDR. See protocol description
"BLD",7628,1,181,0)
for further information.
"BLD",7628,1,182,0)
  
"BLD",7628,1,183,0)
 
"BLD",7628,1,184,0)
4. Anatomic Pathology is not "CPRS-aware" and is unable to notify CPRS of
"BLD",7628,1,185,0)
release of anatomic pathology results. HDR will be notified of 
"BLD",7628,1,186,0)
availability of anatomic pathology results via three new-style
"BLD",7628,1,187,0)
cross-references in LAB DATA file (#63). These indexes will also trigger
"BLD",7628,1,188,0)
generation of the Lab HL7 ORU message if this capability has been enabled.
"BLD",7628,1,189,0)
 
"BLD",7628,1,190,0)
   The three new cross-references are:
"BLD",7628,1,191,0)
 
"BLD",7628,1,192,0)
Subfile #63.02
"BLD",7628,1,193,0)
 
"BLD",7628,1,194,0)
  New-Style Indexes:
"BLD",7628,1,195,0)
 
"BLD",7628,1,196,0)
  AC (#98)    FIELD    MUMPS        ACTION
"BLD",7628,1,197,0)
      Short Descr:  Notify HDR and others that this report is available.
"BLD",7628,1,198,0)
      Description:  This MUMPS cross-reference triggers the sending of this
"BLD",7628,1,199,0)
                    report to the Health Data Repository (HDR) and other
"BLD",7628,1,200,0)
                    subscribers when electron microscopy results are 
"BLD",7628,1,201,0)
                    released.
"BLD",7628,1,202,0)
        Set Logic:  D APQ^LA7HDR(DA(1),"EM",DA)
"BLD",7628,1,203,0)
       Kill Logic:  Q
"BLD",7628,1,204,0)
             X(1):  REPORT RELEASE DATE (63.02,.11) (Subscr 1) (forwards)
"BLD",7628,1,205,0)
 
"BLD",7628,1,206,0)
Subfile #63.08
"BLD",7628,1,207,0)
 
"BLD",7628,1,208,0)
  New-Style Indexes:
"BLD",7628,1,209,0)
 
"BLD",7628,1,210,0)
  AD (#95)    FIELD    MUMPS        ACTION
"BLD",7628,1,211,0)
      Short Descr:  Notify HDR and others that this report is available.
"BLD",7628,1,212,0)
      Description:  This MUMPS cross-reference triggers the sending of this
"BLD",7628,1,213,0)
                    report to the Health Data Repository (HDR) and other
"BLD",7628,1,214,0)
                    subscribers when surgical pathology results are 
"BLD",7628,1,215,0)
                    released.
"BLD",7628,1,216,0)
        Set Logic:  D APQ^LA7HDR(DA(1),"SP",DA)
"BLD",7628,1,217,0)
       Kill Logic:  Q
"BLD",7628,1,218,0)
             X(1):  REPORT RELEASE DATE/TIME (63.08,.11) (Subscr 1)
"BLD",7628,1,219,0)
                    (forwards)
"BLD",7628,1,220,0)
 
"BLD",7628,1,221,0)
Subfile #63.09
"BLD",7628,1,222,0)
 
"BLD",7628,1,223,0)
  New-Style Indexes:
"BLD",7628,1,224,0)
 
"BLD",7628,1,225,0)
  AD (#96)    FIELD    MUMPS        ACTION
"BLD",7628,1,226,0)
      Short Descr:  Notify HDR and others that this report is available.
"BLD",7628,1,227,0)
      Description:  This MUMPS cross-reference triggers the sending of this
"BLD",7628,1,228,0)
                    report to the Health Data Repository (HDR) and other
"BLD",7628,1,229,0)
                    subscribers when cytology results are released.
"BLD",7628,1,230,0)
        Set Logic:  D APQ^LA7HDR(DA(1),"CY",DA)
"BLD",7628,1,231,0)
       Kill Logic:  Q
"BLD",7628,1,232,0)
             X(1):  REPORT RELEASE DATE/TIME  (63.09,.11)  (Subscr 1)
"BLD",7628,1,233,0)
                    (forwards) 
"BLD",7628,1,234,0)
 
"BLD",7628,1,235,0)
 
"BLD",7628,1,236,0)
5. Microbiology results. The current Laboratory package does not support
"BLD",7628,1,237,0)
LOINC encoding of microbiology results. A default encoding is enabled
"BLD",7628,1,238,0)
to LOINC encode standard microbiology tests and antibiotics.
"BLD",7628,1,239,0)
LOINC codes valid as of version 2.14.
"BLD",7628,1,240,0)
  
"BLD",7628,1,241,0)
Default mapping of NLT/LOINC codes to standard fields within the 
"BLD",7628,1,242,0)
MICROBIOLOGY (#5) multiple of LAB DATA file (#63):
"BLD",7628,1,243,0)
 
"BLD",7628,1,244,0)
 
"BLD",7628,1,245,0)
 Test                               Order NLT     Result NLT     LOINC Code
"BLD",7628,1,246,0)
 Bacteriology report (#11)          87993.0000
"BLD",7628,1,247,0)
 Gram stain (#11.6)                 87993.0000    87754.0000     664-3
"BLD",7628,1,248,0)
 Bacteriology organism (#12)        87993.0000    87570.0000     11475-1
"BLD",7628,1,249,0)
 Bacteria colony count (#12,1)                    87719.0000     564-5
"BLD",7628,1,250,0)
 Parasite report (#14)              87505.0000
"BLD",7628,1,251,0)
 Parasite organism (#16)            87505.0000    87576.0000     17784-0
"BLD",7628,1,252,0)
 Mycology report (#18)              87994.0000
"BLD",7628,1,253,0)
 Fungal organism (#20)              87994.0000    87578.0000     580-1
"BLD",7628,1,254,0)
 Fungal colony count (#20,1)        87994.0000    87723.0000     19101-5
"BLD",7628,1,255,0)
 Mycobacterium report (#22)         87995.0000
"BLD",7628,1,256,0)
 Acid Fast stain (#24)              87995.0000    87756.0000     11545-1
"BLD",7628,1,257,0)
 Acid Fast stain quantity (#25)     87995.0000    87583.0000     11545-1
"BLD",7628,1,258,0)
 Mycobacterium organism (#26)       87995.0000    87589.0000     543-9
"BLD",7628,1,259,0)
 Mycobacterium colony count (#26,1) 87995.0000    87719.0000     564-5
"BLD",7628,1,260,0)
 Virology report (#33)              87996.0000
"BLD",7628,1,261,0)
 Viral agent (#36)                  87996.0000    87590.0000     6584-7
"BLD",7628,1,262,0)
 
"BLD",7628,1,263,0)
 Bacteriology or mycobacterium (TB) organism's susceptibilities -
"BLD",7628,1,264,0)
  is based on local site's mapping of NATIONAL VA LAB CODE field (#64)
"BLD",7628,1,265,0)
  in ANTIMICROBIAL SUSCEPTIBILITY file (#62.06) and the related default
"BLD",7628,1,266,0)
  LOINC code associated with this VA NLT code. Use option Map/Unmap 
"BLD",7628,1,267,0)
  Antimicrobial Default LOINC Code [LR LOINC MAP ANTIMICROBIAL] to
"BLD",7628,1,268,0)
  configure the default LOINC code for each antibiotic.
"BLD",7628,1,269,0)
 
"BLD",7628,1,270,0)
6. Surgical Pathology results. The current Laboratory package does not
"BLD",7628,1,271,0)
support LOINC encoding of surgical pathology results.
"BLD",7628,1,272,0)
LOINC codes valid as of version 2.14.
"BLD",7628,1,273,0)
  
"BLD",7628,1,274,0)
Default mapping of NLT/LOINC codes to standard fields within the 
"BLD",7628,1,275,0)
SURGICAL PATHOLOGY (#8) multiple of LAB DATA file (#63):
"BLD",7628,1,276,0)
 
"BLD",7628,1,277,0)
 Test                            Order NLT     Result NLT     LOINC Code
"BLD",7628,1,278,0)
 Specimen (#.012)                88515.0000    88539.0000     22633-2
"BLD",7628,1,279,0)
 Brief clinical history (#.013)  88515.0000    88542.0000     22636-5
"BLD",7628,1,280,0)
 Preoperative diagnosis (#.014)  88515.0000    88544.0000     10219-4
"BLD",7628,1,281,0)
 Operative findings (#.015)      88515.0000    88546.0000     10215-2
"BLD",7628,1,282,0)
 Postoperative diagnosis (#.016) 88515.0000    88547.0000     10218-6
"BLD",7628,1,283,0)
 Gross description (#1)          88515.0000    88549.0000     22634-0
"BLD",7628,1,284,0)
 Microscopic description (#1.1)  88515.0000    88563.0000     22635-7
"BLD",7628,1,285,0)
 Frozen section (#1.3)           88515.0000    88569.0000     22635-7
"BLD",7628,1,286,0)
 Surgical path diagnosis (#1.4)  88515.0000    88571.0000     22637-3
"BLD",7628,1,287,0)
 Supplementary report (#1.2)     88515.0000    88589.0000     22639-9
"BLD",7628,1,288,0)
 Specimen weight (#2)            88515.0000    81233.0000     3154-2
"BLD",7628,1,289,0)
 
"BLD",7628,1,290,0)
 
"BLD",7628,1,291,0)
7. Cytology results. The current Laboratory package does not support
"BLD",7628,1,292,0)
LOINC encoding of cytology results.
"BLD",7628,1,293,0)
LOINC codes valid as of version 2.14.
"BLD",7628,1,294,0)
  
"BLD",7628,1,295,0)
Default mapping of NLT/LOINC codes to standard fields within the 
"BLD",7628,1,296,0)
CYTOPATHOLOGY (#9) multiple of LAB DATA file (#63):
"BLD",7628,1,297,0)
 
"BLD",7628,1,298,0)
 Test                            Order NLT     Result NLT     LOINC Code
"BLD",7628,1,299,0)
 Specimens (#.012)               88593.0000    88539.0000     22633-2
"BLD",7628,1,300,0)
 Brief clinical history (#.013)  88593.0000    88542.0000     22636-5
"BLD",7628,1,301,0)
 Preoperative diagnosis (#.014)  88593.0000    88544.0000     10219-4
"BLD",7628,1,302,0)
 Operative findings (#.015)      88593.0000    88542.0000     10215-2
"BLD",7628,1,303,0)
 Postoperative diagnosis (#.016) 88593.0000    88547.0000     10218-6
"BLD",7628,1,304,0)
 Gross description (#1)          88593.0000    88549.0000     22634-0
"BLD",7628,1,305,0)
 Microscopic examination (#1.1)  88593.0000    88563.0000     22635-7
"BLD",7628,1,306,0)
 Supplementary report (#1.2)     88593.0000    88589.0000     22639-9
"BLD",7628,1,307,0)
 Cytopathlogy diagnosis (#1.4)   88593.0000    88571.0000     22637-3
"BLD",7628,1,308,0)
 
"BLD",7628,1,309,0)
 
"BLD",7628,1,310,0)
8. Electron microscopy results. The current Laboratory package does not
"BLD",7628,1,311,0)
support LOINC encoding of electron microscopy.
"BLD",7628,1,312,0)
 
"BLD",7628,1,313,0)
Default mapping of NLT/LOINC codes to standard fields within the 
"BLD",7628,1,314,0)
EM (#2) multiple of LAB DATA file (#63):
"BLD",7628,1,315,0)
 
"BLD",7628,1,316,0)
 Test                            Order NLT     Result NLT     LOINC Code
"BLD",7628,1,317,0)
 Specimens (#.012)               88597.0000    88057.0000     22633-2
"BLD",7628,1,318,0)
 Brief clinical history (#.013)  88597.0000    88542.0000     22636-5
"BLD",7628,1,319,0)
 Preoperative diagnosis (#.014)  88597.0000    88544.0000     10219-4
"BLD",7628,1,320,0)
 Operative findings (#.015)      88597.0000    88542.0000     10215-2
"BLD",7628,1,321,0)
 Postoperative diagnosis (#.016) 88597.0000    88547.0000     10218-6
"BLD",7628,1,322,0)
 Gross description (#1)          88597.0000    88549.0000     22634-0
"BLD",7628,1,323,0)
 Microscopic examination (#1.1)  88597.0000    88563.0000     22635-7
"BLD",7628,1,324,0)
 Supplementary report (#1.2)     88597.0000    88589.0000     22639-9
"BLD",7628,1,325,0)
 EM diagnosis (#1.4)             88597.0000    88571.0000     22637-3
"BLD",7628,1,326,0)
 
"BLD",7628,1,327,0)
 
"BLD",7628,1,328,0)
9. It corrects a defect identified during patch development with
"BLD",7628,1,329,0)
processing input parameters for the GCPR^LA7QRY API. If the input
"BLD",7628,1,330,0)
parameter LA7SC specified specific subscripts to search then the API
"BLD",7628,1,331,0)
would search those subscripts for any search code even when specific 
"BLD",7628,1,332,0)
search codes were passed to the API in the LA7SC array.
"BLD",7628,1,333,0)
 
"BLD",7628,1,334,0)
10. Converts several FileMan DBS calls on INSTITUTION file (#4) to using
"BLD",7628,1,335,0)
supported API's $$NS^XUAF4 and $$STA^XUAF4.
"BLD",7628,1,336,0)
 
"BLD",7628,1,337,0)
11. It corrects a defect identified during patch development with
"BLD",7628,1,338,0)
processing input parameters for the GCPR^LA7QRY API. If the input
"BLD",7628,1,339,0)
parameters LA7SDT and LA7EDT specified specific results available date
"BLD",7628,1,340,0)
range the API could return anatomic pathology results which have not
"BLD",7628,1,341,0)
been released. This API has been corrected to check the REPORT RELEASE
"BLD",7628,1,342,0)
DATE field (#.11) for subscripts "CY", EM", "SP".
"BLD",7628,1,343,0)
 
"BLD",7628,1,344,0)
12. Remedy ticket HD0000000096207 reported a problem with the error code
"BLD",7628,1,345,0)
returned by the Lab API LA7QRY. A FileMan DBS error code was erroroneously
"BLD",7628,1,346,0)
being returned to the calling application. Routines LA7QRY, LA7QRY1, and 
"BLD",7628,1,347,0)
LA7QRY2 has been modified to use a different name spaced variable LA7QERR
"BLD",7628,1,348,0)
to return to the calling application any error conditions. Additionally,
"BLD",7628,1,349,0)
routine LA7VOBX1 has been modified to use another name spaced variable
"BLD",7628,1,350,0)
LA7DDERR to handle FileMan DBS error conditions related to FileMan data
"BLD",7628,1,351,0)
dictionary calls.
"BLD",7628,1,352,0)
 
"BLD",7628,1,353,0)
13. It corrects a defect identified by MyHeatheVet regarding encoding of 
"BLD",7628,1,354,0)
the following fields in the OBR segment relating to anatomic pathology 
"BLD",7628,1,355,0)
reports:
"BLD",7628,1,356,0)
 OBR-32 - Principal result interpreter
"BLD",7628,1,357,0)
 OBR-33 - Assistant result interpreter
"BLD",7628,1,358,0)
 OBR-34 - Technician
"BLD",7628,1,359,0)
 OBR-35 - Transcriptionist
"BLD",7628,1,360,0)
 
"BLD",7628,1,361,0)
The name component of these fields was being encoded with the wrong HL7
"BLD",7628,1,362,0)
delimiter (component separator). The name component will be encoded with 
"BLD",7628,1,363,0)
the subcomponent separator per the HL7 standard.
"BLD",7628,1,364,0)
  
"BLD",7628,1,365,0)
14. To integrate the VistA-Office EHR with the regular VistA system as
"BLD",7628,1,366,0)
 well as adding functionality also available in the Indian Health Services
"BLD",7628,1,367,0)
 system, the GQPR^LA7QRY API has been modified to allow for VistA-Office
"BLD",7628,1,368,0)
 EHR to use data specifically geared toward clinical operations, whether
"BLD",7628,1,369,0)
 in a hospital or a standalone clinic. The use of an Electronic
"BLD",7628,1,370,0)
 Health Record number as opposed to a SSN for patient identification is
"BLD",7628,1,371,0)
 supported as an identifier accepted as input to this API.
"BLD",7628,1,372,0)
 
"BLD",7628,1,373,0)
 The entry point GCPR^LA7QRY remains unchanged. However, the parameter
"BLD",7628,1,374,0)
 used to pass the patient identifier should contain a 2nd piece indicating
"BLD",7628,1,375,0)
 the type of identifier contained in the 1st piece.
"BLD",7628,1,376,0)
 
"BLD",7628,1,377,0)
 It supports the following types of patient identifiers
"BLD",7628,1,378,0)
   SS = Social Security number
"BLD",7628,1,379,0)
   PI = VA MPI Integration Control Number
"BLD",7628,1,380,0)
   MR = medical record number of patient in file PATIENT/IHS (#9000001)
"BLD",7628,1,381,0)
 
"BLD",7628,1,382,0)
 To regular VistA users this modification will not be seen.
"BLD",7628,1,383,0)
 
"BLD",7628,1,384,0)
15. To support HDR-Historical which uses the GRPR^LA7QRY API to extract
"BLD",7628,1,385,0)
historical laboratory test results, the input parameter LA7SC to GCPR^LA7QRY
"BLD",7628,1,386,0)
supports a 2nd piece. When the 2nd piece of input parameter LA7SC equals
"BLD",7628,1,387,0)
1 the API will return results encoded using VUID's when available.
"BLD",7628,1,388,0)
 
"BLD",7628,1,389,0)
16. Remedy tickets HD0000000141922/HD0000000148089 reported a problem with
"BLD",7628,1,390,0)
failure of generation of MailMan bulletin LA7 ORDER STATUS CHANGED at
"BLD",7628,1,391,0)
collection laboratory facility. Routine LA7VMSG1 changed to set interface
"BLD",7628,1,392,0)
type to set flag in Lab HL7 ORU message indicating an order status change
"BLD",7628,1,393,0)
to trigger bulletin generation at collecting site.
"BLD",7628,1,394,0)
 
"BLD",7628,1,395,0)
  
"BLD",7628,1,396,0)
ASSOCIATED E3R
"BLD",7628,1,397,0)
--------------
"BLD",7628,1,398,0)
 None
"BLD",7628,1,399,0)
 
"BLD",7628,1,400,0)
 
"BLD",7628,1,401,0)
ASSOCIATED REMEDY
"BLD",7628,1,402,0)
-----------------
"BLD",7628,1,403,0)
 HD0000000096207
"BLD",7628,1,404,0)
 HD0000000141922
"BLD",7628,1,405,0)
 HD0000000148089
"BLD",7628,1,406,0)
 
"BLD",7628,1,407,0)
TEST SITES
"BLD",7628,1,408,0)
----------
"BLD",7628,1,409,0)
 Atlanta VAMC
"BLD",7628,1,410,0)
 Biloxi VAMC
"BLD",7628,1,411,0)
 Boston HCS
"BLD",7628,1,412,0)
 El Paso VAMC
"BLD",7628,1,413,0)
 Houston VAMC
"BLD",7628,1,414,0)
 Milwaukee VAMC
"BLD",7628,1,415,0)
 North CHhicago VAMC
"BLD",7628,1,416,0)
 Northhampton VAMC
"BLD",7628,1,417,0)
 Palo Alto HCS
"BLD",7628,1,418,0)
 Philadelphia VAMC
"BLD",7628,1,419,0)
 Pittsburgh HCS
"BLD",7628,1,420,0)
 Puget Sound HCS
"BLD",7628,1,421,0)
 Salt Lake City VAMC
"BLD",7628,1,422,0)
 South Texas HCS
"BLD",7628,1,423,0)
 VA Greater Los Angeles HCS
"BLD",7628,1,424,0)
 
"BLD",7628,1,425,0)
 
"BLD",7628,1,426,0)
INSTALLATION INSTRUCTIONS
"BLD",7628,1,427,0)
=========================
"BLD",7628,1,428,0)
 
"BLD",7628,1,429,0)
  The install time for this patch is less than 5 minute. This patch
"BLD",7628,1,430,0)
  can be installed when Laboratory users are on the system.
"BLD",7628,1,431,0)
  Suggested time to install: non-peak requirement hours.
"BLD",7628,1,432,0)
 
"BLD",7628,1,433,0)
 
"BLD",7628,1,434,0)
NOTE: Kernel patches must be current on the target system to avoid
"BLD",7628,1,435,0)
      problems loading and/or installing this patch.
"BLD",7628,1,436,0)
 
"BLD",7628,1,437,0)
      Patch installation needs to be coordinated with the Laboratory
"BLD",7628,1,438,0)
      Information Manager (LIM/ADPAC).
"BLD",7628,1,439,0)
 
"BLD",7628,1,440,0)
 1.   LOAD TRANSPORT GLOBAL
"BLD",7628,1,441,0)
      ---------------------------------------
"BLD",7628,1,442,0)
      Choose the PackMan message containing this patch and invoke the
"BLD",7628,1,443,0)
      INSTALL/CHECK   MESSAGE PackMan option. 
"BLD",7628,1,444,0)
 
"BLD",7628,1,445,0)
 
"BLD",7628,1,446,0)
 2.   START UP KIDS
"BLD",7628,1,447,0)
      Start up the Kernel Installation and distribution System
"BLD",7628,1,448,0)
      Menu [XPD MAIN]:
"BLD",7628,1,449,0)
              Edits and Distribution ...
"BLD",7628,1,450,0)
                           Utilities ...
"BLD",7628,1,451,0)
                         Installation ...
"BLD",7628,1,452,0)
      
"BLD",7628,1,453,0)
     Select Kernel Installation & Distribution System Option: Installation
"BLD",7628,1,454,0)
                                                              ----
"BLD",7628,1,455,0)
                1      Load a Distribution
"BLD",7628,1,456,0)
                2      Verify Checksums in Transport Global
"BLD",7628,1,457,0)
                3      Print Transport Global
"BLD",7628,1,458,0)
                4      Compare Transport Global to Current System
"BLD",7628,1,459,0)
                5      Backup a Transport Global
"BLD",7628,1,460,0)
                6      Install Package(s)
"BLD",7628,1,461,0)
                       Restart Install of Package(s)
"BLD",7628,1,462,0)
                       Unload a Distribution
"BLD",7628,1,463,0)
 
"BLD",7628,1,464,0)
      Select Installation Option:
"BLD",7628,1,465,0)
 
"BLD",7628,1,466,0)
 3.   Select Installation Option:
"BLD",7628,1,467,0)
      -------------------------------
"BLD",7628,1,468,0)
      NOTE:  The following are OPTIONAL - (When prompted for the
"BLD",7628,1,469,0)
      INSTALL NAME, enter LA*5.2*68):
"BLD",7628,1,470,0)
      a.  Backup a Transport Global - This option will create a
"BLD",7628,1,471,0)
          backup message of any routines exported with this patch.
"BLD",7628,1,472,0)
          It will not backup any other changes such as DD's or templates.
"BLD",7628,1,473,0)
      b.  Compare Transport Global to Current System - This option
"BLD",7628,1,474,0)
          will allow you to view all changes that will be made when this
"BLD",7628,1,475,0)
          patch is installed. It compares all components of this patch
"BLD",7628,1,476,0)
          (routines, DD's, templates, etc.).
"BLD",7628,1,477,0)
      c.  Verify Checksums in Transport Global - This option will
"BLD",7628,1,478,0)
          allow you to ensure the integrity of the routines that are in
"BLD",7628,1,479,0)
          the transport global.
"BLD",7628,1,480,0)
 
"BLD",7628,1,481,0)
 4.   Select Installation Option:  Install Package(s)
"BLD",7628,1,482,0)
                                   ------------------
"BLD",7628,1,483,0)
      **This is the step to start the installation of this KIDS patch:
"BLD",7628,1,484,0)
 
"BLD",7628,1,485,0)
      a.  Choose the Install Package(s) option to start the patch install.
"BLD",7628,1,486,0)
          (When prompted for the INSTALL NAME, enter LA*5.2*68.)
"BLD",7628,1,487,0)
      b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install?
"BLD",7628,1,488,0)
          NO//' answer NO (unless otherwise indicated)
"BLD",7628,1,489,0)
      c.  When prompted 'Want to DISABLE Scheduled Options, Menu Options,
"BLD",7628,1,490,0)
          and Protocols? NO//' answer NO (unless otherwise indicated)
"BLD",7628,1,491,0)
 
"BLD",7628,1,492,0)
 
"BLD",7628,1,493,0)
 
"BLD",7628,1,494,0)
 Note: Routine LA68 will be deleted after successful patch installation.
"BLD",7628,1,495,0)
 
"BLD",7628,1,496,0)
 
"BLD",7628,1,497,0)
POST-INSTALLATION INSTRUCTIONS:
"BLD",7628,1,498,0)
===============================
"BLD",7628,1,499,0)
 
"BLD",7628,1,500,0)
***************************************************************************
"BLD",7628,1,501,0)
 
"BLD",7628,1,502,0)
After the installation of Patch LA*5.2*68, do not activate the LA7 LAB 
"BLD",7628,1,503,0)
RESULTS TO HDR (SUB) subscriber protocol until contacted by the HDR team
"BLD",7628,1,504,0)
 
"BLD",7628,1,505,0)
***************************************************************************
"BLD",7628,1,506,0)
 
"BLD",7628,1,507,0)
 
"BLD",7628,1,508,0)
NOTE: Use the following steps only when activating the transmission of
"BLD",7628,1,509,0)
laboratory data to the VA HDR and/or interfacing to a Commercial Off the 
"BLD",7628,1,510,0)
Shelf System (COTS) or other VistA subscriber. No further action is
"BLD",7628,1,511,0)
required, if there is no requirement to activate this interface.
"BLD",7628,1,512,0)
 
"BLD",7628,1,513,0)
 To activate messaging to the VA HDR perform steps 1, 2, and 3.
"BLD",7628,1,514,0)
 To activate messaging to COTS and other VistA subscribers
"BLD",7628,1,515,0)
    perform steps 1 and 4.
"BLD",7628,1,516,0)
 
"BLD",7628,1,517,0)
1. To utilize the building and transmission of HL7 Lab ORU result messages.
"BLD",7628,1,518,0)
 
"BLD",7628,1,519,0)
   Enable the configuration 'LA7HDR' in LA7 MESSAGE PARAMETER file
"BLD",7628,1,520,0)
   (#62.48). This is accomplished by setting the field STATUS (#2) to
"BLD",7628,1,521,0)
   'ACTIVE' using VA File Manager. Setting this field to 'INACTIVE' will
"BLD",7628,1,522,0)
   turn off generation of this Lab HL7 message.
"BLD",7628,1,523,0)
 
"BLD",7628,1,524,0)
   Select VA FileMan Option:  Enter or Edit File Entries
"BLD",7628,1,525,0)
 
"BLD",7628,1,526,0)
   INPUT TO WHAT FILE: LA7 MESSAGE PARAMETER// 62.48  LA7 MESSAGE PARAMETER
"BLD",7628,1,527,0)
    EDIT WHICH FIELD: ALL// STATUS
"BLD",7628,1,528,0)
    THEN EDIT FIELD:
"BLD",7628,1,529,0)
 
"BLD",7628,1,530,0)
   Select LA7 MESSAGE PARAMETER CONFIGURATION: LA7HDR
"BLD",7628,1,531,0)
   STATUS: INACTIVE// ACTIVE  ACTIVE
"BLD",7628,1,532,0)
 
"BLD",7628,1,533,0)
 
"BLD",7628,1,534,0)
2. Activation of transmission to HDR requires coordination with your
"BLD",7628,1,535,0)
   assigned HDR Implementation Manager (IM). Sites should not activate the
"BLD",7628,1,536,0)
   LA7 LAB RESULTS TO HDR (SUB) subscriber until notified by the HDR
"BLD",7628,1,537,0)
   team. The coordination of extractions of existing laboratory data will
"BLD",7628,1,538,0)
   be started at the same time the configuration of the LA7 LAB RESULTS TO
"BLD",7628,1,539,0)
   HDR (SUB) subscriber to ensure that there is an overlap of laboratory
"BLD",7628,1,540,0)
   results. This overlap is done to ensure all laboratory results are in
"BLD",7628,1,541,0)
   the HDR.
"BLD",7628,1,542,0)
 
"BLD",7628,1,543,0)
 a. Set up VDEFVIE4 link for Laboratory data transmission
"BLD",7628,1,544,0)
 
"BLD",7628,1,545,0)
     Use the HL7 Main Menu, Filers option to look at the setup for 
"BLD",7628,1,546,0)
     VDEFVIE3. 
"BLD",7628,1,547,0)
 
"BLD",7628,1,548,0)
     Copy down the IP and port number used for VDEFVIE3.
"BLD",7628,1,549,0)
 
"BLD",7628,1,550,0)
     Use the HL7 Main Menu, Filers option to edit VDEFVIE4.  
"BLD",7628,1,551,0)
 
"BLD",7628,1,552,0)
     Enable auto startup and add the same IP and port numbers used for
"BLD",7628,1,553,0)
     VDEFVIE3.
"BLD",7628,1,554,0)
 
"BLD",7628,1,555,0)
     Use the HL7 Main Menu, Start/Stop Links option to start the VDEFVIE4
"BLD",7628,1,556,0)
     link.
"BLD",7628,1,557,0)
 
"BLD",7628,1,558,0)
     Use the HL7 Main Menu, Site Parameters option to select VDEF view
"BLD",7628,1,559,0)
     and add VDEFVIE4 to the view.
"BLD",7628,1,560,0)
 
"BLD",7628,1,561,0)
 
"BLD",7628,1,562,0)
 b. To activate the interface to the VA HDR use Protocol Edit option
"BLD",7628,1,563,0)
   [HL EDIT INTERFACE] on the HL package Interface Developer Options
"BLD",7628,1,564,0)
   [HL MENU INTERFACE TK] menu option and edit protocol LA7 LAB RESULTS
"BLD",7628,1,565,0)
   TO HDR (SUB). Go to the second ScreenMan screen and edit the field
"BLD",7628,1,566,0)
   ROUTING LOGIC and remove the leading ";" character and enter the
"BLD",7628,1,567,0)
   'save' command to save the changes to the protocol.
"BLD",7628,1,568,0)
 
"BLD",7628,1,569,0)
                          HL7 SUBSCRIBER                       PAGE 2 OF 2
"BLD",7628,1,570,0)
                         LA7 LAB RESULTS TO HDR (SUB)
"BLD",7628,1,571,0)
---------------------------------------------------------------------------
"BLD",7628,1,572,0)
 
"BLD",7628,1,573,0)
      RECEIVING APPLICATION: LA7HDR
"BLD",7628,1,574,0)
 
"BLD",7628,1,575,0)
      RESPONSE MESSAGE TYPE: ACK                            EVENT TYPE: R01
"BLD",7628,1,576,0)
 
"BLD",7628,1,577,0)
 SENDING FACILITY REQUIRED?: YES          RECEIVING FACILITY REQUIRED?: YES
"BLD",7628,1,578,0)
 
"BLD",7628,1,579,0)
         SECURITY REQUIRED?:
"BLD",7628,1,580,0)
 
"BLD",7628,1,581,0)
               LOGICAL LINK: VDEFVIE4
"BLD",7628,1,582,0)
 
"BLD",7628,1,583,0)
 PROCESSING RTN:
"BLD",7628,1,584,0)
 
"BLD",7628,1,585,0)
  ROUTING LOGIC: ;D RTR^LA7HDR("CH;")  <-- remove leading ";" character
"BLD",7628,1,586,0)
____________________________________________________________________________
"BLD",7628,1,587,0)
 
"BLD",7628,1,588,0)
COMMAND:                                     Press <PF1>H for help    Insert
"BLD",7628,1,589,0)
 
"BLD",7628,1,590,0)
After the change the field should look like:
"BLD",7628,1,591,0)
  ROUTING LOGIC: D RTR^LA7HDR("CH;")
"BLD",7628,1,592,0)
 
"BLD",7628,1,593,0)
3. To transmit Lab HL7 ORU result messages to another system, i.e.
"BLD",7628,1,594,0)
   Commercial Off the Shelf System (COTS).
"BLD",7628,1,595,0)
 
"BLD",7628,1,596,0)
 a. Create a HL7 subscriber protocol as documented in HL7 Site Manager &
"BLD",7628,1,597,0)
    Developer Manual version 1.6*56
"BLD",7628,1,598,0)
 
"BLD",7628,1,599,0)
 b. Attach this protocol as a subscriber to HL7 event protocol LA7 LAB
"BLD",7628,1,600,0)
    RESULTS AVAILABLE (EVN). Use Protocol Edit option [HL EDIT INTERFACE]
"BLD",7628,1,601,0)
    on the HL package Interface Developer Options [HL MENU INTERFACE TK]
"BLD",7628,1,602,0)
    menu option to add this subscriber.
"BLD",7628,1,603,0)
 
"BLD",7628,1,604,0)
 
"BLD",7628,1,605,0)
4. Controlling message generation and transmission.
"BLD",7628,1,606,0)
 
"BLD",7628,1,607,0)
   Notify the HDR Project Office in the event that this interface is
"BLD",7628,1,608,0)
   deactivated and the interface to the HDR was previously activated
"BLD",7628,1,609,0)
 
"BLD",7628,1,610,0)
   a. To turn off message building and transmission to ALL subscribers
"BLD",7628,1,611,0)
      of event protocol LA7 LAB RESULTS AVAILABLE (EVN).
"BLD",7628,1,612,0)
      Disable the configuration 'LA7HDR' in LA7 MESSAGE PARAMETER file
"BLD",7628,1,613,0)
      (#62.48). This is accomplished by setting the field STATUS (#2) to
"BLD",7628,1,614,0)
      'INACTIVE' using VA File Manager Enter or Edit File Entries [DIEDIT].
"BLD",7628,1,615,0)
      Setting this field to 'INACTIVE' will turn off generation of this Lab
"BLD",7628,1,616,0)
      HL7 message.
"BLD",7628,1,617,0)
 
"BLD",7628,1,618,0)
   b. To turn off message transmission to a specific subscriber.
"BLD",7628,1,619,0)
      On the HL package, Interface Developer Options [HL MENU INTERFACE
"BLD",7628,1,620,0)
      TK] menu option, use the Protocol Edit [HL EDIT INTERFACE] option to
"BLD",7628,1,621,0)
      remove the related subscriber protocol from the event protocol LA7
"BLD",7628,1,622,0)
      LAB RESULTS AVAILABLE (EVN).
"BLD",7628,1,623,0)
 
"BLD",7628,1,624,0)
      For the VA HDR, remove subscriber protocol LA7 LAB RESULTS TO HDR
"BLD",7628,1,625,0)
      (SUB).
"BLD",7628,1,626,0)
 
"BLD",7628,1,627,0)
 
"BLD",7628,1,628,0)
 
"BLD",7628,1,629,0)
 
"BLD",7628,1,630,0)
INSTALLATION EXAMPLE
"BLD",7628,1,631,0)
====================
"BLD",7628,1,632,0)
 
"BLD",7628,1,633,0)
Select Installation Option: 6  Install Package(s) 
"BLD",7628,1,634,0)
Select INSTALL NAME: LA*5.2*68 Loaded from Distribution  2/4/05@10:21
"BLD",7628,1,635,0)
     => LA*5.2*68
"BLD",7628,1,636,0)
 
"BLD",7628,1,637,0)
This Distribution was loaded on Feb 04, 2005@10:21 with header of
"BLD",7628,1,638,0)
   LA*5.2*68
"BLD",7628,1,639,0)
   It consisted of the following Install(s):
"BLD",7628,1,640,0)
      LA*5.2*68
"BLD",7628,1,641,0)
Checking Install for Package LA*5.2*68
"BLD",7628,1,642,0)
Will first run the Environment Check Routine, LA68
"BLD",7628,1,643,0)
 
"BLD",7628,1,644,0)
 
"BLD",7628,1,645,0)
                        --- Environment Check is Ok ---
"BLD",7628,1,646,0)
 
"BLD",7628,1,647,0)
Install Questions for LA*5.2*68
"BLD",7628,1,648,0)
 
"BLD",7628,1,649,0)
Incoming Files:
"BLD",7628,1,650,0)
 
"BLD",7628,1,651,0)
 
"BLD",7628,1,652,0)
   62.48     LA7 MESSAGE PARAMETER  (including data)
"BLD",7628,1,653,0)
Note:  You already have the 'LA7 MESSAGE PARAMETER' File.
"BLD",7628,1,654,0)
I will OVERWRITE your data with mine.
"BLD",7628,1,655,0)
 
"BLD",7628,1,656,0)
 
"BLD",7628,1,657,0)
   63        LAB DATA  (Partial Definition)
"BLD",7628,1,658,0)
Note:  You already have the 'LAB DATA' File.
"BLD",7628,1,659,0)
 
"BLD",7628,1,660,0)
 
"BLD",7628,1,661,0)
Want KIDS to Rebuild Menu Trees Upon Completion of Install? YES//
"BLD",7628,1,662,0)
 
"BLD",7628,1,663,0)
 
"BLD",7628,1,664,0)
Want KIDS to INHIBIT LOGONs during the install? NO// NO
"BLD",7628,1,665,0)
Want to DISABLE Scheduled Options, Menu Options, and Protocols? NO// NO
"BLD",7628,1,666,0)
 
"BLD",7628,1,667,0)
Enter the Device you want to print the Install messages.
"BLD",7628,1,668,0)
You can queue the install by enter a 'Q' at the device prompt.
"BLD",7628,1,669,0)
Enter a '^' to abort the install.
"BLD",7628,1,670,0)
 
"BLD",7628,1,671,0)
DEVICE: HOME//  TELNET VIRTUAL
"BLD",7628,1,672,0)
 
"BLD",7628,1,673,0)
 
"BLD",7628,1,674,0)
 Install Started for LA*5.2*68 :
"BLD",7628,1,675,0)
               Feb 04, 2005@10:21:55
"BLD",7628,1,676,0)
 
"BLD",7628,1,677,0)
Build Distribution Date: Feb 04, 2005
"BLD",7628,1,678,0)
 
"BLD",7628,1,679,0)
 Installing Routines:.............
"BLD",7628,1,680,0)
               Feb 04, 2005@10:21:55
"BLD",7628,1,681,0)
 
"BLD",7628,1,682,0)
 Running Pre-Install Routine: PRE^LA68.
"BLD",7628,1,683,0)
 
"BLD",7628,1,684,0)
               Sending install started alert to mail group G.LMI
"BLD",7628,1,685,0)
 
"BLD",7628,1,686,0)
                          *** Pre install started ***
"BLD",7628,1,687,0)
 
"BLD",7628,1,688,0)
                           --- No action required---
"BLD",7628,1,689,0)
 
"BLD",7628,1,690,0)
                         *** Pre install completed ***
"BLD",7628,1,691,0)
 
"BLD",7628,1,692,0)
 Installing Data Dictionaries: ...
"BLD",7628,1,693,0)
               Feb 04, 2005@10:21:55
"BLD",7628,1,694,0)
 
"BLD",7628,1,695,0)
 Installing Data:
"BLD",7628,1,696,0)
               Feb 04, 2005@10:21:55
"BLD",7628,1,697,0)
 
"BLD",7628,1,698,0)
 Installing PACKAGE COMPONENTS:
"BLD",7628,1,699,0)
 
"BLD",7628,1,700,0)
 Installing HL7 APPLICATION PARAMETER...
"BLD",7628,1,701,0)
 
"BLD",7628,1,702,0)
 Installing PROTOCOL..
"BLD",7628,1,703,0)
  Located in the LA7 (LAB MESSAGING) namespace..
"BLD",7628,1,704,0)
  Located in the LA7 (LAB MESSAGING) namespace..
"BLD",7628,1,705,0)
  Located in the LA7 (LAB MESSAGING) namespace..
"BLD",7628,1,706,0)
               Feb 04, 2005@10:21:55
"BLD",7628,1,707,0)
 
"BLD",7628,1,708,0)
 Running Post-Install Routine: POST^LA68.
"BLD",7628,1,709,0)
 
"BLD",7628,1,710,0)
                          *** Post install started ***
"BLD",7628,1,711,0)
 
"BLD",7628,1,712,0)
          *** Clearing facility name for LA7LAB entry in file #771 ***
"BLD",7628,1,713,0)
 
"BLD",7628,1,714,0)
                    *** Clearing facility name completed ***
"BLD",7628,1,715,0)
 
"BLD",7628,1,716,0)
                         *** Post install completed ***
"BLD",7628,1,717,0)
 
"BLD",7628,1,718,0)
              Sending install completion alert to mail group G.LMI
"BLD",7628,1,719,0)
 
"BLD",7628,1,720,0)
 Updating Routine file......
"BLD",7628,1,721,0)
 
"BLD",7628,1,722,0)
 Updating KIDS files.......
"BLD",7628,1,723,0)
 
"BLD",7628,1,724,0)
 LA*5.2*68 Installed.
"BLD",7628,1,725,0)
               Feb 04, 2005@10:21:55
"BLD",7628,1,726,0)
 
"BLD",7628,1,727,0)
 Install Message sent #xxxx
"BLD",7628,4,0)
^9.64PA^62.485^3
"BLD",7628,4,62.48,0)
62.48
"BLD",7628,4,62.48,222)
y^n^f^^n^^y^o^n
"BLD",7628,4,62.48,224)
I $P(^LAHM(62.48,Y,0),"^")="LA7HDR"
"BLD",7628,4,62.485,0)
62.485
"BLD",7628,4,62.485,222)
n^n^f^^n^^y^o^n
"BLD",7628,4,62.485,224)
I Y=121
"BLD",7628,4,63,0)
63
"BLD",7628,4,63,2,0)
^9.641^63.09^3
"BLD",7628,4,63,2,63.02,0)
EM  (sub-file)
"BLD",7628,4,63,2,63.02,1,0)
^9.6411^.11^1
"BLD",7628,4,63,2,63.02,1,.11,0)
REPORT RELEASE DATE
"BLD",7628,4,63,2,63.08,0)
SURGICAL PATHOLOGY  (sub-file)
"BLD",7628,4,63,2,63.08,1,0)
^9.6411^.11^1
"BLD",7628,4,63,2,63.08,1,.11,0)
REPORT RELEASE DATE/TIME
"BLD",7628,4,63,2,63.09,0)
CYTOPATHOLOGY  (sub-file)
"BLD",7628,4,63,2,63.09,1,0)
^9.6411^.11^1
"BLD",7628,4,63,2,63.09,1,.11,0)
REPORT RELEASE DATE/TIME
"BLD",7628,4,63,222)
y^n^p^^^^n^^n
"BLD",7628,4,63,224)

"BLD",7628,4,"APDD",63,63.02)

"BLD",7628,4,"APDD",63,63.02,.11)

"BLD",7628,4,"APDD",63,63.08)

"BLD",7628,4,"APDD",63,63.08,.11)

"BLD",7628,4,"APDD",63,63.09)

"BLD",7628,4,"APDD",63,63.09,.11)

"BLD",7628,4,"B",62.48,62.48)

"BLD",7628,4,"B",62.485,62.485)

"BLD",7628,4,"B",63,63)

"BLD",7628,6)
38^
"BLD",7628,6.3)
56
"BLD",7628,"ABPKG")
n
"BLD",7628,"INI")
PRE^LA68
"BLD",7628,"INID")
y
"BLD",7628,"INIT")
POST^LA68
"BLD",7628,"KRN",0)
^9.67PA^8989.52^19
"BLD",7628,"KRN",.4,0)
.4
"BLD",7628,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7628,"KRN",.401,0)
.401
"BLD",7628,"KRN",.402,0)
.402
"BLD",7628,"KRN",.403,0)
.403
"BLD",7628,"KRN",.5,0)
.5
"BLD",7628,"KRN",.84,0)
.84
"BLD",7628,"KRN",3.6,0)
3.6
"BLD",7628,"KRN",3.8,0)
3.8
"BLD",7628,"KRN",9.2,0)
9.2
"BLD",7628,"KRN",9.8,0)
9.8
"BLD",7628,"KRN",9.8,"NM",0)
^9.68A^30^28
"BLD",7628,"KRN",9.8,"NM",1,0)
LA7HDR^^0^B39353571
"BLD",7628,"KRN",9.8,"NM",2,0)
LA7QRY1^^0^B34477085
"BLD",7628,"KRN",9.8,"NM",3,0)
LA7QRY2^^0^B38475048
"BLD",7628,"KRN",9.8,"NM",4,0)
LA7QRY^^0^B8496816
"BLD",7628,"KRN",9.8,"NM",5,0)
LA7VHLU5^^0^B49053645
"BLD",7628,"KRN",9.8,"NM",6,0)
LA7VHLU3^^0^B55573792
"BLD",7628,"KRN",9.8,"NM",7,0)
LA7VORUA^^0^B11624236
"BLD",7628,"KRN",9.8,"NM",8,0)
LA7VORU1^^0^B61414246
"BLD",7628,"KRN",9.8,"NM",9,0)
LA7VMSG1^^0^B52098570
"BLD",7628,"KRN",9.8,"NM",11,0)
LA7VHLU^^0^B44857108
"BLD",7628,"KRN",9.8,"NM",12,0)
LA7VORM1^^0^B57485485
"BLD",7628,"KRN",9.8,"NM",13,0)
LA7HDR1^^0^B37911850
"BLD",7628,"KRN",9.8,"NM",14,0)
LA7VOBX^^0^B30185961
"BLD",7628,"KRN",9.8,"NM",15,0)
LA7VOBXA^^0^B53603815
"BLD",7628,"KRN",9.8,"NM",16,0)
LA7VOBX2^^0^B21393582
"BLD",7628,"KRN",9.8,"NM",17,0)
LA7VOBX3^^0^B83540167
"BLD",7628,"KRN",9.8,"NM",18,0)
LA7VOBX1^^0^B28786998
"BLD",7628,"KRN",9.8,"NM",19,0)
LA7VIN5^^0^B62438539
"BLD",7628,"KRN",9.8,"NM",20,0)
LA7VORC^^0^B18625097
"BLD",7628,"KRN",9.8,"NM",21,0)
LA7VOBR^^0^B25844567
"BLD",7628,"KRN",9.8,"NM",22,0)
LA7VHLU2^^0^B28776777
"BLD",7628,"KRN",9.8,"NM",23,0)
LA7VORU^^0^B24122155
"BLD",7628,"KRN",9.8,"NM",24,0)
LA7VHLU4^^0^B25782007
"BLD",7628,"KRN",9.8,"NM",25,0)
LA7VORU2^^0^B5334202
"BLD",7628,"KRN",9.8,"NM",27,0)
LA7VOBRA^^0^B39455733
"BLD",7628,"KRN",9.8,"NM",28,0)
LA7VHLU9^^0^B16600197
"BLD",7628,"KRN",9.8,"NM",29,0)
LA7VORUB^^0^B37430566
"BLD",7628,"KRN",9.8,"NM",30,0)
LA7VOBRB^^0^B12807459
"BLD",7628,"KRN",9.8,"NM","B","LA7HDR",1)

"BLD",7628,"KRN",9.8,"NM","B","LA7HDR1",13)

"BLD",7628,"KRN",9.8,"NM","B","LA7QRY",4)

"BLD",7628,"KRN",9.8,"NM","B","LA7QRY1",2)

"BLD",7628,"KRN",9.8,"NM","B","LA7QRY2",3)

"BLD",7628,"KRN",9.8,"NM","B","LA7VHLU",11)

"BLD",7628,"KRN",9.8,"NM","B","LA7VHLU2",22)

"BLD",7628,"KRN",9.8,"NM","B","LA7VHLU3",6)

"BLD",7628,"KRN",9.8,"NM","B","LA7VHLU4",24)

"BLD",7628,"KRN",9.8,"NM","B","LA7VHLU5",5)

"BLD",7628,"KRN",9.8,"NM","B","LA7VHLU9",28)

"BLD",7628,"KRN",9.8,"NM","B","LA7VIN5",19)

"BLD",7628,"KRN",9.8,"NM","B","LA7VMSG1",9)

"BLD",7628,"KRN",9.8,"NM","B","LA7VOBR",21)

"BLD",7628,"KRN",9.8,"NM","B","LA7VOBRA",27)

"BLD",7628,"KRN",9.8,"NM","B","LA7VOBRB",30)

"BLD",7628,"KRN",9.8,"NM","B","LA7VOBX",14)

"BLD",7628,"KRN",9.8,"NM","B","LA7VOBX1",18)

"BLD",7628,"KRN",9.8,"NM","B","LA7VOBX2",16)

"BLD",7628,"KRN",9.8,"NM","B","LA7VOBX3",17)

"BLD",7628,"KRN",9.8,"NM","B","LA7VOBXA",15)

"BLD",7628,"KRN",9.8,"NM","B","LA7VORC",20)

"BLD",7628,"KRN",9.8,"NM","B","LA7VORM1",12)

"BLD",7628,"KRN",9.8,"NM","B","LA7VORU",23)

"BLD",7628,"KRN",9.8,"NM","B","LA7VORU1",8)

"BLD",7628,"KRN",9.8,"NM","B","LA7VORU2",25)

"BLD",7628,"KRN",9.8,"NM","B","LA7VORUA",7)

"BLD",7628,"KRN",9.8,"NM","B","LA7VORUB",29)

"BLD",7628,"KRN",19,0)
19
"BLD",7628,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",7628,"KRN",19,"NM",1,0)
LA7 HDR RECOVER^^0
"BLD",7628,"KRN",19,"NM",2,0)
LRLIAISON^^2
"BLD",7628,"KRN",19,"NM","B","LA7 HDR RECOVER",1)

"BLD",7628,"KRN",19,"NM","B","LRLIAISON",2)

"BLD",7628,"KRN",19.1,0)
19.1
"BLD",7628,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7628,"KRN",101,0)
101
"BLD",7628,"KRN",101,"NM",0)
^9.68A^4^4
"BLD",7628,"KRN",101,"NM",1,0)
LA7 LAB RESULTS ACTION^^0
"BLD",7628,"KRN",101,"NM",2,0)
LA7 LAB RESULTS AVAILABLE (EVN)^^3
"BLD",7628,"KRN",101,"NM",3,0)
LA7 LAB RESULTS TO HDR (SUB)^^0
"BLD",7628,"KRN",101,"NM",4,0)
LR7O ALL EVSEND RESULTS^^2
"BLD",7628,"KRN",101,"NM","B","LA7 LAB RESULTS ACTION",1)

"BLD",7628,"KRN",101,"NM","B","LA7 LAB RESULTS AVAILABLE (EVN)",2)

"BLD",7628,"KRN",101,"NM","B","LA7 LAB RESULTS TO HDR (SUB)",3)

"BLD",7628,"KRN",101,"NM","B","LR7O ALL EVSEND RESULTS",4)

"BLD",7628,"KRN",409.61,0)
409.61
"BLD",7628,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",7628,"KRN",771,0)
771
"BLD",7628,"KRN",771,"NM",0)
^9.68A^2^1
"BLD",7628,"KRN",771,"NM",2,0)
LA7HDR^^0
"BLD",7628,"KRN",771,"NM","B","LA7HDR",2)

"BLD",7628,"KRN",870,0)
870
"BLD",7628,"KRN",870,"NM",0)
^9.68A^^0
"BLD",7628,"KRN",8989.51,0)
8989.51
"BLD",7628,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",7628,"KRN",8989.52,0)
8989.52
"BLD",7628,"KRN",8994,0)
8994
"BLD",7628,"KRN","B",.4,.4)

"BLD",7628,"KRN","B",.401,.401)

"BLD",7628,"KRN","B",.402,.402)

"BLD",7628,"KRN","B",.403,.403)

"BLD",7628,"KRN","B",.5,.5)

"BLD",7628,"KRN","B",.84,.84)

"BLD",7628,"KRN","B",3.6,3.6)

"BLD",7628,"KRN","B",3.8,3.8)

"BLD",7628,"KRN","B",9.2,9.2)

"BLD",7628,"KRN","B",9.8,9.8)

"BLD",7628,"KRN","B",19,19)

"BLD",7628,"KRN","B",19.1,19.1)

"BLD",7628,"KRN","B",101,101)

"BLD",7628,"KRN","B",409.61,409.61)

"BLD",7628,"KRN","B",771,771)

"BLD",7628,"KRN","B",870,870)

"BLD",7628,"KRN","B",8989.51,8989.51)

"BLD",7628,"KRN","B",8989.52,8989.52)

"BLD",7628,"KRN","B",8994,8994)

"BLD",7628,"PRE")
LA68
"BLD",7628,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",7628,"QUES",0)
^9.62^^
"BLD",7628,"REQB",0)
^9.611^6^4
"BLD",7628,"REQB",2,0)
LA*5.2*64^2
"BLD",7628,"REQB",3,0)
LA*5.2*69^2
"BLD",7628,"REQB",4,0)
VDEF 1.0^2
"BLD",7628,"REQB",6,0)
LA*5.2*71^2
"BLD",7628,"REQB","B","LA*5.2*64",2)

"BLD",7628,"REQB","B","LA*5.2*69",3)

"BLD",7628,"REQB","B","LA*5.2*71",6)

"BLD",7628,"REQB","B","VDEF 1.0",4)

"DATA",62.48,35,0)
LA7HDR^HL7^0^1^^5^^^30
"DATA",62.48,35,20,0)
^62.481S^1^1
"DATA",62.48,35,20,1,0)
2^LAB MESSAGING
"DATA",62.485,121,0)
121^FileMan DBS call is reporting error |1| with text '|2|' for data name |3|.^1
"DATA",62.485,121,1)
S LA7TXT(1)=LA7DDERR("DIERR",1),LA7TXT(2)=LA7DDERR("DIERR",1,"TEXT",1),LA7TXT(3)=LRSB
"FIA",62.48)
LA7 MESSAGE PARAMETER
"FIA",62.48,0)
^LAHM(62.48,
"FIA",62.48,0,0)
62.48
"FIA",62.48,0,1)
y^n^f^^n^^y^o^n
"FIA",62.48,0,10)

"FIA",62.48,0,11)
I $P(^LAHM(62.48,Y,0),"^")="LA7HDR"
"FIA",62.48,0,"RLRO")

"FIA",62.48,0,"VR")
5.2^LA
"FIA",62.48,62.48)
0
"FIA",62.48,62.481)
0
"FIA",62.48,62.483)
0
"FIA",62.485)
LA7 MESSAGE LOG BULLETINS
"FIA",62.485,0)
^LAHM(62.485,
"FIA",62.485,0,0)
62.485
"FIA",62.485,0,1)
n^n^f^^n^^y^o^n
"FIA",62.485,0,10)

"FIA",62.485,0,11)
I Y=121
"FIA",62.485,0,"RLRO")

"FIA",62.485,0,"VR")
5.2^LA
"FIA",62.485,62.485)
0
"FIA",63)
LAB DATA
"FIA",63,0)
^LR(
"FIA",63,0,0)
63
"FIA",63,0,1)
y^n^p^^^^n^^n
"FIA",63,0,10)

"FIA",63,0,11)

"FIA",63,0,"RLRO")

"FIA",63,0,"VR")
5.2^LA
"FIA",63,63)
1
"FIA",63,63.02)
1
"FIA",63,63.02,.11)

"FIA",63,63.08)
1
"FIA",63,63.08,.11)

"FIA",63,63.09)
1
"FIA",63,63.09,.11)

"INI")
PRE^LA68
"INIT")
POST^LA68
"IX",63,63.02,"AC",0)
63.02^AC^Notify HDR and others that this report is available.^MU^^F^^I^63.02^^^^^A
"IX",63,63.02,"AC",.1,0)
^^3^3^3090128^^^^
"IX",63,63.02,"AC",.1,1,0)
This MUMPS cross-reference triggers the sending of this
"IX",63,63.02,"AC",.1,2,0)
report to the Health Data Repository (HDR) and other
"IX",63,63.02,"AC",.1,3,0)
subscribers when electron microscopy results are released.
"IX",63,63.02,"AC",1)
D APQ^LA7HDR(DA(1),"EM",DA)
"IX",63,63.02,"AC",2)
Q
"IX",63,63.02,"AC",11.1,0)
^.114IA^1^1
"IX",63,63.02,"AC",11.1,1,0)
1^F^63.02^.11^^1^F
"IX",63,63.08,"AD",0)
63.08^AD^Notify HDR and others that this report is available.^MU^^F^^I^63.08^^^^^A
"IX",63,63.08,"AD",.1,0)
^^3^3^3090128^^^
"IX",63,63.08,"AD",.1,1,0)
This MUMPS cross-reference triggers the sending of this report
"IX",63,63.08,"AD",.1,2,0)
to the Health Data Repository (HDR) and other subscribers
"IX",63,63.08,"AD",.1,3,0)
when surgical pathology results are released.
"IX",63,63.08,"AD",1)
D APQ^LA7HDR(DA(1),"SP",DA)
"IX",63,63.08,"AD",2)
Q
"IX",63,63.08,"AD",11.1,0)
^.114IA^1^1
"IX",63,63.08,"AD",11.1,1,0)
1^F^63.08^.11^^1^F
"IX",63,63.09,"AD",0)
63.09^AD^Notify HDR and others that this report is available.^MU^^F^^I^63.09^^^^^A
"IX",63,63.09,"AD",.1,0)
^^3^3^3090128^^^
"IX",63,63.09,"AD",.1,1,0)
This MUMPS cross-reference triggers the sending of this
"IX",63,63.09,"AD",.1,2,0)
report to the Health Data Repository (HDR) and other
"IX",63,63.09,"AD",.1,3,0)
subscribers when cytology results are released.
"IX",63,63.09,"AD",1)
D APQ^LA7HDR(DA(1),"CY",DA)
"IX",63,63.09,"AD",2)
Q
"IX",63,63.09,"AD",11.1,0)
^.114IA^1^1
"IX",63,63.09,"AD",11.1,1,0)
1^F^63.09^.11^^1^F
"KRN",19,1240,-1)
2^2
"KRN",19,1240,0)
LRLIAISON^Lab liaison menu^^M^.5^LRLIASON^^^^^^14
"KRN",19,1240,10,0)
^19.01PI^34^34
"KRN",19,1240,10,34,0)
10868^HDR
"KRN",19,1240,10,34,"^")
LA7 HDR RECOVER
"KRN",19,1240,"U")
LAB LIAISON MENU
"KRN",19,10868,-1)
0^1
"KRN",19,10868,0)
LA7 HDR RECOVER^Recover/Transmit Lab HDR Result Messages^^R^^^^^^^^AUTOMATED LAB INSTRUMENTS
"KRN",19,10868,1,0)
^19.06^16^16^3090127^^^^
"KRN",19,10868,1,1,0)
Option to recover from failed Lab HDR ORU Result message
"KRN",19,10868,1,2,0)
generation and/or transmission failure. This option allows
"KRN",19,10868,1,3,0)
the user to select those VistA Laboratory accessions that
"KRN",19,10868,1,4,0)
need to be transmitted to the VA HDR and other subscribers
"KRN",19,10868,1,5,0)
of the VistA Laboratory Result Available HL7 message
"KRN",19,10868,1,6,0)
capability via the protocol Lab Results Available Event
"KRN",19,10868,1,7,0)
[LA7 LAB RESULTS AVAILABLE (EVN)].
"KRN",19,10868,1,8,0)
 
"KRN",19,10868,1,9,0)
If the original message generation/transmission failed
"KRN",19,10868,1,10,0)
due to system or communication problems then using this
"KRN",19,10868,1,11,0)
option will allow the generation of new HL7 messages with
"KRN",19,10868,1,12,0)
the results associated with the selected accessions.
"KRN",19,10868,1,13,0)
Accessions can be selected using the human-readable
"KRN",19,10868,1,14,0)
accession designation (area abbreviation modified date
"KRN",19,10868,1,15,0)
accession number - "CH 1225 100") or the accession's
"KRN",19,10868,1,16,0)
associated 10 character unique identifier (UID).
"KRN",19,10868,2)

"KRN",19,10868,25)
RECOVER^LA7HDR
"KRN",19,10868,"U")
RECOVER/TRANSMIT LAB HDR RESUL
"KRN",101,1692,-1)
2^4
"KRN",101,1692,0)
LR7O ALL EVSEND RESULTS^LAB RESULTS => EXTERNAL PACKAGE^^X^1^^^^^^^
"KRN",101,1692,10,0)
^101.01PA^6^6
"KRN",101,1692,10,6,0)
4258^^^
"KRN",101,1692,10,6,"^")
LA7 LAB RESULTS ACTION
"KRN",101,4256,-1)
3^2
"KRN",101,4256,0)
LA7 LAB RESULTS AVAILABLE (EVN)^Lab Results Available Event^^E^^^^^^^^
"KRN",101,4256,1,0)
^101.06^12^12^3090120^^^^
"KRN",101,4256,1,1,0)
A VistA Laboratory package HL7 ORU result message is created and sent
"KRN",101,4256,1,2,0)
by the HL package for transmission to any subscribers of event protocol
"KRN",101,4256,1,3,0)
LA7 LAB RESULTS AVAILABLE (EVN).
"KRN",101,4256,1,4,0)

"KRN",101,4256,1,5,0)
It provides the capability for the generation of a Laboratory HL7 ORU
"KRN",101,4256,1,6,0)
message containing patient laboratory results to subscribers of the HL7
"KRN",101,4256,1,7,0)
event protocol LA7 LAB RESULTS AVAILABLE (EVN) as these results are made
"KRN",101,4256,1,8,0)
available within the Laboratory package.
"KRN",101,4256,1,9,0)
  
"KRN",101,4256,1,10,0)
The following subscripts are supported by the event:
"KRN",101,4256,1,11,0)
  "CH", "MI", "SP", "CY", "EM". 
"KRN",101,4256,1,12,0)

"KRN",101,4256,99)
61473,34094
"KRN",101,4256,770)
LA7LAB^^ORU^R01^53^^^AL^NE^2.4^
"KRN",101,4256,772)
D ACK^LA7VHL
"KRN",101,4256,775,0)
^101.0775PA^1^1
"KRN",101,4256,775,1,0)
4257
"KRN",101,4256,775,1,"^")
LA7 LAB RESULTS TO HDR (SUB)
"KRN",101,4257,-1)
0^3
"KRN",101,4257,0)
LA7 LAB RESULTS TO HDR (SUB)^Send Lab Results to HDR^^S^^^^^^^^
"KRN",101,4257,1,0)
^101.06^35^35^3090120^^^^
"KRN",101,4257,1,1,0)
This protocol should be attached to the HL7 event protocol LA7 LAB
"KRN",101,4257,1,2,0)
RESULTS AVAILABLE (EVN). See this protocol for further information.
"KRN",101,4257,1,3,0)
 
"KRN",101,4257,1,4,0)
This subscriber protocol is used by the Laboratory package to indicate 
"KRN",101,4257,1,5,0)
to the HL package to send laboratory results to the VA Health Data
"KRN",101,4257,1,6,0)
Repository (HDR).
"KRN",101,4257,1,7,0)
 
"KRN",101,4257,1,8,0)
It utilizes the "Router" Subscriber Protocol supported by the VistA HL
"KRN",101,4257,1,9,0)
package. The routing logic uses the value of the parameter passed into
"KRN",101,4257,1,10,0)
the router to determine which Laboratory package subscript should be
"KRN",101,4257,1,11,0)
sent to the HDR. 
"KRN",101,4257,1,12,0)
 
"KRN",101,4257,1,13,0)
The following subscripts are supported by the event:
"KRN",101,4257,1,14,0)
   "CH", "MI", "SP", "CY", "EM".
"KRN",101,4257,1,15,0)
 
"KRN",101,4257,1,16,0)
Examples:
"KRN",101,4257,1,17,0)
 
"KRN",101,4257,1,18,0)
ROUTING LOGIC: D RTR^LA7HDR("CH;") will only send to HDR results
"KRN",101,4257,1,19,0)
 associated with Laboratory "CH" subscript.
"KRN",101,4257,1,20,0)
 
"KRN",101,4257,1,21,0)
ROUTING LOGIC: D RTR^LA7HDR("MI;") will only send to HDR results
"KRN",101,4257,1,22,0)
 associated with Laboratory "MI" subscript.
"KRN",101,4257,1,23,0)
 
"KRN",101,4257,1,24,0)
ROUTING LOGIC: D RTR^LA7HDR("CH;MI;") will only send to HDR
"KRN",101,4257,1,25,0)
 results associated with Laboratory "CH", and "MI" subscripts.
"KRN",101,4257,1,26,0)
 
"KRN",101,4257,1,27,0)
ROUTING LOGIC: D RTR^LA7HDR("CH;MI;SP;") will only send to HDR
"KRN",101,4257,1,28,0)
 results associated with Laboratory "CH", "MI", and "SP" subscripts.
"KRN",101,4257,1,29,0)
 
"KRN",101,4257,1,30,0)
ROUTING LOGIC: D RTR^LA7HDR("CH;MI;SP;CY;EM;") will send to HDR
"KRN",101,4257,1,31,0)
 results associated with all Laboratory subscripts currently supported.
"KRN",101,4257,1,32,0)
 
"KRN",101,4257,1,33,0)
Note: The order of the subscripts listed in the input parameter is not
"KRN",101,4257,1,34,0)
significant. Separating the subscripts using the ";" character is
"KRN",101,4257,1,35,0)
significant. 
"KRN",101,4257,99)
61473,34094
"KRN",101,4257,770)
^LA7HDR^^R01^^^^^^^ACK
"KRN",101,4257,773)
1^1
"KRN",101,4257,774)
;D RTR^LA7HDR("CH;")
"KRN",101,4258,-1)
0^1
"KRN",101,4258,0)
LA7 LAB RESULTS ACTION^Lab process results for HL7 messaging^^A^^^^^^^^AUTOMATED LAB INSTRUMENTS
"KRN",101,4258,1,0)
^101.06^5^5^3090120^^^
"KRN",101,4258,1,1,0)
Action protocol to setup sending lab results to HL7 message subscribers
"KRN",101,4258,1,2,0)
via protocol LA7 LAB RESULTS AVAILABLE (EVN) - Lab Results Available Event.
"KRN",101,4258,1,3,0)
This protocol should be attached to protocol LAB RESULTS => EXTERNAL PACKAGE
"KRN",101,4258,1,4,0)
[LR7O ALL EVSEND RESULTS] which is an extended action protocol triggered
"KRN",101,4258,1,5,0)
by the lab result verification process.
"KRN",101,4258,10,0)
^101.01PA^^0
"KRN",101,4258,20)
D QUEUE^LA7HDR
"KRN",101,4258,99)
61473,34094
"KRN",771,184,-1)
0^2
"KRN",771,184,0)
LA7HDR^a^^^^^
"MBREQ")
0
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",11,-1)
1^1
"PKG",11,0)
AUTOMATED LAB INSTRUMENTS^LA^Lab Auto-Instrument Package
"PKG",11,22,0)
^9.49I^1^1
"PKG",11,22,1,0)
5.2^3051119^2960605
"PKG",11,22,1,"PAH",1,0)
68^3091214^1
"PKG",11,22,1,"PAH",1,1,0)
^^727^727^3091214
"PKG",11,22,1,"PAH",1,1,1,0)
Blood Bank Clearance
"PKG",11,22,1,"PAH",1,1,2,0)
====================
"PKG",11,22,1,"PAH",1,1,3,0)
VISTA Laboratory Package patch LA*5.2*68 contains changes to software
"PKG",11,22,1,"PAH",1,1,4,0)
controlled by VHA DIRECTIVE 99-053, titled VISTA BLOOD BANK SOFTWARE.
"PKG",11,22,1,"PAH",1,1,5,0)
Changes include: 
"PKG",11,22,1,"PAH",1,1,6,0)
    New style indexes have been created for the following sub-files
"PKG",11,22,1,"PAH",1,1,7,0)
    of the LAB DATA file (#63):
"PKG",11,22,1,"PAH",1,1,8,0)
        ELECTRON MICROSCOPY (#63.02)
"PKG",11,22,1,"PAH",1,1,9,0)
        SURGICAL PATHOLOGY (#63.08)
"PKG",11,22,1,"PAH",1,1,10,0)
        CYTOPATHOLOGY (#63.09)
"PKG",11,22,1,"PAH",1,1,11,0)
 
"PKG",11,22,1,"PAH",1,1,12,0)
All of the above changes have been reviewed by the VISTA Blood Bank
"PKG",11,22,1,"PAH",1,1,13,0)
Developer and found to have no impact on the VISTA BLOOD BANK SOFTWARE
"PKG",11,22,1,"PAH",1,1,14,0)
control functions.
"PKG",11,22,1,"PAH",1,1,15,0)
 
"PKG",11,22,1,"PAH",1,1,16,0)
RISK ANALYSIS:   Changes made by patch LA*5.2*68 have no effect on Blood
"PKG",11,22,1,"PAH",1,1,17,0)
Bank software functionality, therefore RISK is none.
"PKG",11,22,1,"PAH",1,1,18,0)
 
"PKG",11,22,1,"PAH",1,1,19,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS:  Patch LA*5.2*68 does not
"PKG",11,22,1,"PAH",1,1,20,0)
alter or modify any software design safeguards or safety critical elements
"PKG",11,22,1,"PAH",1,1,21,0)
functions.
"PKG",11,22,1,"PAH",1,1,22,0)
 
"PKG",11,22,1,"PAH",1,1,23,0)
POTENTIAL IMPACT ON SITES:  This patch contains changes to 0 routines and
"PKG",11,22,1,"PAH",1,1,24,0)
1 file identified in Veterans Health Administration (VHA) Directive 99-053,
"PKG",11,22,1,"PAH",1,1,25,0)
group B listing. The changes have no effect on Blood Bank functionality or
"PKG",11,22,1,"PAH",1,1,26,0)
medical device control functions. There is no adverse potential to sites.
"PKG",11,22,1,"PAH",1,1,27,0)
 
"PKG",11,22,1,"PAH",1,1,28,0)
========================================
"PKG",11,22,1,"PAH",1,1,29,0)
 
"PKG",11,22,1,"PAH",1,1,30,0)
This patch supports the VA Health Data Repository (HDR) effort,
"PKG",11,22,1,"PAH",1,1,31,0)
allowing changes to LAB DATA file (#63) to be transmitted to the HDR 
"PKG",11,22,1,"PAH",1,1,32,0)
via a VistA Laboratory HL7 Result (ORU) message.
"PKG",11,22,1,"PAH",1,1,33,0)
 
"PKG",11,22,1,"PAH",1,1,34,0)
Additionally, it provides the capability for the transmission of the HL7
"PKG",11,22,1,"PAH",1,1,35,0)
ORU message containing patient laboratory results to subscribers of the HL7
"PKG",11,22,1,"PAH",1,1,36,0)
event protocol LA7 LAB RESULTS AVAILABLE (EVN) as these results are made
"PKG",11,22,1,"PAH",1,1,37,0)
available within the Laboratory package. The following subscripts are
"PKG",11,22,1,"PAH",1,1,38,0)
supported by the event: "CH", "MI", "SP", "CY", "EM". See post-install
"PKG",11,22,1,"PAH",1,1,39,0)
instructions for enabling this capability.
"PKG",11,22,1,"PAH",1,1,40,0)
 
"PKG",11,22,1,"PAH",1,1,41,0)
  
"PKG",11,22,1,"PAH",1,1,42,0)
****************************************************************************
"PKG",11,22,1,"PAH",1,1,43,0)
  
"PKG",11,22,1,"PAH",1,1,44,0)
Patch LA*5.2*68 allows the HL7 ORU message containing patient laboratory 
"PKG",11,22,1,"PAH",1,1,45,0)
results to be transmitted to the subscriber, LA7 LAB RESULTS TO HDR 
"PKG",11,22,1,"PAH",1,1,46,0)
(SUB). This subscriber protocol is used to transmit laboratory results to 
"PKG",11,22,1,"PAH",1,1,47,0)
the VA HDR.
"PKG",11,22,1,"PAH",1,1,48,0)
 
"PKG",11,22,1,"PAH",1,1,49,0)
The HDR Team will contact the Chief of IRM at each site to set up the 
"PKG",11,22,1,"PAH",1,1,50,0)
coordination of lab extraction (LA*5.2*68) and the activation of the 
"PKG",11,22,1,"PAH",1,1,51,0)
subscriber (HDR).
"PKG",11,22,1,"PAH",1,1,52,0)
 
"PKG",11,22,1,"PAH",1,1,53,0)
The coordination of extracting existing laboratory data (HDR historical) 
"PKG",11,22,1,"PAH",1,1,54,0)
and the configuration of the LA7 LAB RESULTS TO HDR (SUB) subscriber will 
"PKG",11,22,1,"PAH",1,1,55,0)
be started at the same time. This will ensure that there is an overlap of 
"PKG",11,22,1,"PAH",1,1,56,0)
laboratory results between the real time extraction of lab data and the 
"PKG",11,22,1,"PAH",1,1,57,0)
historical extraction of lab data.
"PKG",11,22,1,"PAH",1,1,58,0)
 
"PKG",11,22,1,"PAH",1,1,59,0)
If a VA site activates the LA7 LAB RESULTS TO HDR (SUB) subscriber before 
"PKG",11,22,1,"PAH",1,1,60,0)
the historical extraction of existing laboratory data, the real time 
"PKG",11,22,1,"PAH",1,1,61,0)
extraction of lab data at the VA site may not be synchronized with the 
"PKG",11,22,1,"PAH",1,1,62,0)
HDR data.
"PKG",11,22,1,"PAH",1,1,63,0)
 
"PKG",11,22,1,"PAH",1,1,64,0)
If you have questions regarding installation or implementation,
"PKG",11,22,1,"PAH",1,1,65,0)
contact the HDR Project Office.
"PKG",11,22,1,"PAH",1,1,66,0)
 
"PKG",11,22,1,"PAH",1,1,67,0)
Once the HDR Project Office confirms that installation and implementation 
"PKG",11,22,1,"PAH",1,1,68,0)
was accomplished successfully, you must log a Remedy ticket for any
"PKG",11,22,1,"PAH",1,1,69,0)
subsequent problems encountered.
"PKG",11,22,1,"PAH",1,1,70,0)
 
"PKG",11,22,1,"PAH",1,1,71,0)
*****************************************************************************
"PKG",11,22,1,"PAH",1,1,72,0)
  
"PKG",11,22,1,"PAH",1,1,73,0)
 
"PKG",11,22,1,"PAH",1,1,74,0)
1. The following protocols are added to the PROTOCOL file (#101)
"PKG",11,22,1,"PAH",1,1,75,0)
 
"PKG",11,22,1,"PAH",1,1,76,0)
NAME: LA7 LAB RESULTS ACTION
"PKG",11,22,1,"PAH",1,1,77,0)
  ITEM TEXT: Lab process results for HL7 messaging
"PKG",11,22,1,"PAH",1,1,78,0)
  TYPE: action                          
"PKG",11,22,1,"PAH",1,1,79,0)
  PACKAGE: AUTOMATED LAB INSTRUMENTS
"PKG",11,22,1,"PAH",1,1,80,0)
 DESCRIPTION:   Action protocol to setup sending lab results to HL7 message
"PKG",11,22,1,"PAH",1,1,81,0)
 subscribers via protocol LA7 LAB RESULTS AVAILABLE (EVN) - Lab Results
"PKG",11,22,1,"PAH",1,1,82,0)
 Available Event.  This protocol should be attached to protocol LAB RESULTS
"PKG",11,22,1,"PAH",1,1,83,0)
 => EXTERNAL PACKAGE [LR7O ALL EVSEND RESULTS] which is an extended action
"PKG",11,22,1,"PAH",1,1,84,0)
 protocol triggered by the lab result verification process.
"PKG",11,22,1,"PAH",1,1,85,0)
  ENTRY ACTION: D QUEUE^LA7HDR          TIMESTAMP: 59056,40855
"PKG",11,22,1,"PAH",1,1,86,0)
 
"PKG",11,22,1,"PAH",1,1,87,0)
 
"PKG",11,22,1,"PAH",1,1,88,0)
NAME: LA7 LAB RESULTS AVAILABLE (EVN)  ITEM TEXT: Lab Results Available Event
"PKG",11,22,1,"PAH",1,1,89,0)
  TYPE: event driver                   
"PKG",11,22,1,"PAH",1,1,90,0)
 DESCRIPTION: A VistA Laboratory package HL7 ORU result message is created
"PKG",11,22,1,"PAH",1,1,91,0)
 and sent by the HL package for transmission to any subscribers of event
"PKG",11,22,1,"PAH",1,1,92,0)
 protocol LA7 LAB  RESULTS AVAILABLE (EVN).
"PKG",11,22,1,"PAH",1,1,93,0)
 
"PKG",11,22,1,"PAH",1,1,94,0)
 It provides the capability for the generation of a Laboratory HL7 ORU
"PKG",11,22,1,"PAH",1,1,95,0)
 message containing patient laboratory results to subscribers of the HL7
"PKG",11,22,1,"PAH",1,1,96,0)
 event protocol LA7 LAB RESULTS AVAILABLE (EVN) as these results are made
"PKG",11,22,1,"PAH",1,1,97,0)
 available within the Laboratory package.
"PKG",11,22,1,"PAH",1,1,98,0)
  
"PKG",11,22,1,"PAH",1,1,99,0)
 The following subscripts are supported by the event:
"PKG",11,22,1,"PAH",1,1,100,0)
   "CH", "MI", "SP", "CY", "EM".
"PKG",11,22,1,"PAH",1,1,101,0)
 
"PKG",11,22,1,"PAH",1,1,102,0)
  TIMESTAMP: 59725,36770                SENDING APPLICATION: LA7LAB
"PKG",11,22,1,"PAH",1,1,103,0)
  TRANSACTION MESSAGE TYPE: ORU         EVENT TYPE: R01
"PKG",11,22,1,"PAH",1,1,104,0)
  MESSAGE STRUCTURE: ORU_R01            ACCEPT ACK CODE: AL
"PKG",11,22,1,"PAH",1,1,105,0)
  APPLICATION ACK TYPE: NE              VERSION ID: 2.4
"PKG",11,22,1,"PAH",1,1,106,0)
  RESPONSE PROCESSING ROUTINE: D ACK^LA7VHL
"PKG",11,22,1,"PAH",1,1,107,0)
SUBSCRIBERS: LA7 LAB RESULTS TO HDR (SUB)
"PKG",11,22,1,"PAH",1,1,108,0)
 
"PKG",11,22,1,"PAH",1,1,109,0)
 
"PKG",11,22,1,"PAH",1,1,110,0)
NAME: LA7 LAB RESULTS TO HDR (SUB)      ITEM TEXT: Send Lab Results to HDR
"PKG",11,22,1,"PAH",1,1,111,0)
  TYPE: subscriber                      
"PKG",11,22,1,"PAH",1,1,112,0)
 DESCRIPTION:   This protocol should be attached to the HL7 event protocol
"PKG",11,22,1,"PAH",1,1,113,0)
 LA7 LAB RESULTS AVAILABLE (EVN). See this protocol for further information.
"PKG",11,22,1,"PAH",1,1,114,0)
 
"PKG",11,22,1,"PAH",1,1,115,0)
 This subscriber protocol is used by the Laboratory package to indicate to
"PKG",11,22,1,"PAH",1,1,116,0)
 the HL package to send laboratory results to the VA Health Data Repository
"PKG",11,22,1,"PAH",1,1,117,0)
 (HDR).
"PKG",11,22,1,"PAH",1,1,118,0)
 
"PKG",11,22,1,"PAH",1,1,119,0)
 It utilizes the "Router" Subscriber Protocol supported by the VistA HL
"PKG",11,22,1,"PAH",1,1,120,0)
 package. The routing logic uses the value of the parameter passed into the
"PKG",11,22,1,"PAH",1,1,121,0)
 router to determine which Laboratory package subscript should be sent to
"PKG",11,22,1,"PAH",1,1,122,0)
 the HDR.
"PKG",11,22,1,"PAH",1,1,123,0)
 
"PKG",11,22,1,"PAH",1,1,124,0)
 Examples:
"PKG",11,22,1,"PAH",1,1,125,0)
 
"PKG",11,22,1,"PAH",1,1,126,0)
 ROUTING LOGIC: D RTR^LA7HDR("CH;") will only send to HDR-IMS results
"PKG",11,22,1,"PAH",1,1,127,0)
 associated with Laboratory "CH" subscript.
"PKG",11,22,1,"PAH",1,1,128,0)
 
"PKG",11,22,1,"PAH",1,1,129,0)
 ROUTING LOGIC: D RTR^LA7HDR("MI;") will only send to HDR-IMS results
"PKG",11,22,1,"PAH",1,1,130,0)
 associated with Laboratory "MI" subscript.
"PKG",11,22,1,"PAH",1,1,131,0)
 
"PKG",11,22,1,"PAH",1,1,132,0)
 ROUTING LOGIC: D RTR^LA7HDR("CH;MI;SP;") will only send to HDR-IMS results
"PKG",11,22,1,"PAH",1,1,133,0)
 associated with Laboratory "CH", "MI", and "SP" subscripts.
"PKG",11,22,1,"PAH",1,1,134,0)
 
"PKG",11,22,1,"PAH",1,1,135,0)
  TIMESTAMP: 59056,40125                RECEIVING APPLICATION: LA7HDR
"PKG",11,22,1,"PAH",1,1,136,0)
  EVENT TYPE: R01                       LOGICAL LINK: VDEFVIE4
"PKG",11,22,1,"PAH",1,1,137,0)
  RESPONSE MESSAGE TYPE: ACK            SENDING FACILITY REQUIRED?: YES
"PKG",11,22,1,"PAH",1,1,138,0)
  RECEIVING FACILITY REQUIRED?: YES     ROUTING LOGIC: D RTR^LA7HDR("CH;")
"PKG",11,22,1,"PAH",1,1,139,0)
 
"PKG",11,22,1,"PAH",1,1,140,0)
 NOTE: This subscriber protocol is distributed with the ROUTING LOGIC
"PKG",11,22,1,"PAH",1,1,141,0)
       disabled. See post-installation instructions for guidance to
"PKG",11,22,1,"PAH",1,1,142,0)
       enable the protocol.
"PKG",11,22,1,"PAH",1,1,143,0)
 
"PKG",11,22,1,"PAH",1,1,144,0)
2. The following option is added to the OPTION file (#19)
"PKG",11,22,1,"PAH",1,1,145,0)
 
"PKG",11,22,1,"PAH",1,1,146,0)
NAME: LA7 HDR RECOVER    MENU TEXT: Recover/Transmit Lab HDR Result
"PKG",11,22,1,"PAH",1,1,147,0)
Messages
"PKG",11,22,1,"PAH",1,1,148,0)
 TYPE: run routine                                      
"PKG",11,22,1,"PAH",1,1,149,0)
 PACKAGE: AUTOMATED LAB INSTRUMENTS
"PKG",11,22,1,"PAH",1,1,150,0)
 DESCRIPTION:   Option to recover from failed Lab HDR ORU Result message 
"PKG",11,22,1,"PAH",1,1,151,0)
generation and/or transmission failure. This option allows the user to
"PKG",11,22,1,"PAH",1,1,152,0)
select those VistA Laboratory accessions that need to be transmitted to
"PKG",11,22,1,"PAH",1,1,153,0)
the VA HDR and other subscribers of the VistA Laboratory Result Available
"PKG",11,22,1,"PAH",1,1,154,0)
HL7 message capability via the protocol Lab Results Available Event [LA7
"PKG",11,22,1,"PAH",1,1,155,0)
LAB RESULTS AVAILABLE (EVN)].
"PKG",11,22,1,"PAH",1,1,156,0)
 
"PKG",11,22,1,"PAH",1,1,157,0)
If the original message generation/transmission failed due to system or 
"PKG",11,22,1,"PAH",1,1,158,0)
communication problems then using this option will allow the generation of
"PKG",11,22,1,"PAH",1,1,159,0)
new HL7 messages with the results associated with the selected 
"PKG",11,22,1,"PAH",1,1,160,0)
accessions.  Accessions can be selected using the human-readable accession
"PKG",11,22,1,"PAH",1,1,161,0)
designation (area abbreviation modified date accession number - "CH 1225
"PKG",11,22,1,"PAH",1,1,162,0)
100") or the accession's associated 10 character unique identifier (UID).
"PKG",11,22,1,"PAH",1,1,163,0)
 
"PKG",11,22,1,"PAH",1,1,164,0)
 ROUTINE: RECOVER^LA7HDR 
"PKG",11,22,1,"PAH",1,1,165,0)
 UPPERCASE MENU TEXT: RECOVER/TRANSMIT LAB HDR RESUL
"PKG",11,22,1,"PAH",1,1,166,0)
 
"PKG",11,22,1,"PAH",1,1,167,0)
This option is assigned to the Lab liaison menu option [LRLIAISON] and
"PKG",11,22,1,"PAH",1,1,168,0)
can be assigned to other uses as needed that support/monitor message 
"PKG",11,22,1,"PAH",1,1,169,0)
transmission to the VA HDR and other subscribers.
"PKG",11,22,1,"PAH",1,1,170,0)
 
"PKG",11,22,1,"PAH",1,1,171,0)
3. The LA7HDR routine, if the configuration LA7HDR in LA7 MESSAGE
"PKG",11,22,1,"PAH",1,1,172,0)
PARAMETER file (#62.48) has an active status, queues the record for
"PKG",11,22,1,"PAH",1,1,173,0)
transmission to the HDR via a HL7 ORU result message which is transmitted
"PKG",11,22,1,"PAH",1,1,174,0)
by the HL package to any subscribers of event protocol LA7 LAB RESULTS
"PKG",11,22,1,"PAH",1,1,175,0)
AVAILABLE (EVN) in addition to the HDR subscriber LA7 LAB RESULTS TO HDR
"PKG",11,22,1,"PAH",1,1,176,0)
(SUB).
"PKG",11,22,1,"PAH",1,1,177,0)
 
"PKG",11,22,1,"PAH",1,1,178,0)
   The LA7 LAB RESULTS TO HDR (SUB) subscriber protocol uses the logical
"PKG",11,22,1,"PAH",1,1,179,0)
link VDEFVIE4. This is a router subscriber protocol which determines
"PKG",11,22,1,"PAH",1,1,180,0)
which Lab HL7 messages are sent to the HDR. See protocol description
"PKG",11,22,1,"PAH",1,1,181,0)
for further information.
"PKG",11,22,1,"PAH",1,1,182,0)
  
"PKG",11,22,1,"PAH",1,1,183,0)
 
"PKG",11,22,1,"PAH",1,1,184,0)
4. Anatomic Pathology is not "CPRS-aware" and is unable to notify CPRS of
"PKG",11,22,1,"PAH",1,1,185,0)
release of anatomic pathology results. HDR will be notified of 
"PKG",11,22,1,"PAH",1,1,186,0)
availability of anatomic pathology results via three new-style
"PKG",11,22,1,"PAH",1,1,187,0)
cross-references in LAB DATA file (#63). These indexes will also trigger
"PKG",11,22,1,"PAH",1,1,188,0)
generation of the Lab HL7 ORU message if this capability has been enabled.
"PKG",11,22,1,"PAH",1,1,189,0)
 
"PKG",11,22,1,"PAH",1,1,190,0)
   The three new cross-references are:
"PKG",11,22,1,"PAH",1,1,191,0)
 
"PKG",11,22,1,"PAH",1,1,192,0)
Subfile #63.02
"PKG",11,22,1,"PAH",1,1,193,0)
 
"PKG",11,22,1,"PAH",1,1,194,0)
  New-Style Indexes:
"PKG",11,22,1,"PAH",1,1,195,0)
 
"PKG",11,22,1,"PAH",1,1,196,0)
  AC (#98)    FIELD    MUMPS        ACTION
"PKG",11,22,1,"PAH",1,1,197,0)
      Short Descr:  Notify HDR and others that this report is available.
"PKG",11,22,1,"PAH",1,1,198,0)
      Description:  This MUMPS cross-reference triggers the sending of this
"PKG",11,22,1,"PAH",1,1,199,0)
                    report to the Health Data Repository (HDR) and other
"PKG",11,22,1,"PAH",1,1,200,0)
                    subscribers when electron microscopy results are 
"PKG",11,22,1,"PAH",1,1,201,0)
                    released.
"PKG",11,22,1,"PAH",1,1,202,0)
        Set Logic:  D APQ^LA7HDR(DA(1),"EM",DA)
"PKG",11,22,1,"PAH",1,1,203,0)
       Kill Logic:  Q
"PKG",11,22,1,"PAH",1,1,204,0)
             X(1):  REPORT RELEASE DATE (63.02,.11) (Subscr 1) (forwards)
"PKG",11,22,1,"PAH",1,1,205,0)
 
"PKG",11,22,1,"PAH",1,1,206,0)
Subfile #63.08
"PKG",11,22,1,"PAH",1,1,207,0)
 
"PKG",11,22,1,"PAH",1,1,208,0)
  New-Style Indexes:
"PKG",11,22,1,"PAH",1,1,209,0)
 
"PKG",11,22,1,"PAH",1,1,210,0)
  AD (#95)    FIELD    MUMPS        ACTION
"PKG",11,22,1,"PAH",1,1,211,0)
      Short Descr:  Notify HDR and others that this report is available.
"PKG",11,22,1,"PAH",1,1,212,0)
      Description:  This MUMPS cross-reference triggers the sending of this
"PKG",11,22,1,"PAH",1,1,213,0)
                    report to the Health Data Repository (HDR) and other
"PKG",11,22,1,"PAH",1,1,214,0)
                    subscribers when surgical pathology results are 
"PKG",11,22,1,"PAH",1,1,215,0)
                    released.
"PKG",11,22,1,"PAH",1,1,216,0)
        Set Logic:  D APQ^LA7HDR(DA(1),"SP",DA)
"PKG",11,22,1,"PAH",1,1,217,0)
       Kill Logic:  Q
"PKG",11,22,1,"PAH",1,1,218,0)
             X(1):  REPORT RELEASE DATE/TIME (63.08,.11) (Subscr 1)
"PKG",11,22,1,"PAH",1,1,219,0)
                    (forwards)
"PKG",11,22,1,"PAH",1,1,220,0)
 
"PKG",11,22,1,"PAH",1,1,221,0)
Subfile #63.09
"PKG",11,22,1,"PAH",1,1,222,0)
 
"PKG",11,22,1,"PAH",1,1,223,0)
  New-Style Indexes:
"PKG",11,22,1,"PAH",1,1,224,0)
 
"PKG",11,22,1,"PAH",1,1,225,0)
  AD (#96)    FIELD    MUMPS        ACTION
"PKG",11,22,1,"PAH",1,1,226,0)
      Short Descr:  Notify HDR and others that this report is available.
"PKG",11,22,1,"PAH",1,1,227,0)
      Description:  This MUMPS cross-reference triggers the sending of this
"PKG",11,22,1,"PAH",1,1,228,0)
                    report to the Health Data Repository (HDR) and other
"PKG",11,22,1,"PAH",1,1,229,0)
                    subscribers when cytology results are released.
"PKG",11,22,1,"PAH",1,1,230,0)
        Set Logic:  D APQ^LA7HDR(DA(1),"CY",DA)
"PKG",11,22,1,"PAH",1,1,231,0)
       Kill Logic:  Q
"PKG",11,22,1,"PAH",1,1,232,0)
             X(1):  REPORT RELEASE DATE/TIME  (63.09,.11)  (Subscr 1)
"PKG",11,22,1,"PAH",1,1,233,0)
                    (forwards) 
"PKG",11,22,1,"PAH",1,1,234,0)
 
"PKG",11,22,1,"PAH",1,1,235,0)
 
"PKG",11,22,1,"PAH",1,1,236,0)
5. Microbiology results. The current Laboratory package does not support
"PKG",11,22,1,"PAH",1,1,237,0)
LOINC encoding of microbiology results. A default encoding is enabled
"PKG",11,22,1,"PAH",1,1,238,0)
to LOINC encode standard microbiology tests and antibiotics.
"PKG",11,22,1,"PAH",1,1,239,0)
LOINC codes valid as of version 2.14.
"PKG",11,22,1,"PAH",1,1,240,0)
  
"PKG",11,22,1,"PAH",1,1,241,0)
Default mapping of NLT/LOINC codes to standard fields within the 
"PKG",11,22,1,"PAH",1,1,242,0)
MICROBIOLOGY (#5) multiple of LAB DATA file (#63):
"PKG",11,22,1,"PAH",1,1,243,0)
 
"PKG",11,22,1,"PAH",1,1,244,0)
 
"PKG",11,22,1,"PAH",1,1,245,0)
 Test                               Order NLT     Result NLT     LOINC Code
"PKG",11,22,1,"PAH",1,1,246,0)
 Bacteriology report (#11)          87993.0000
"PKG",11,22,1,"PAH",1,1,247,0)
 Gram stain (#11.6)                 87993.0000    87754.0000     664-3
"PKG",11,22,1,"PAH",1,1,248,0)
 Bacteriology organism (#12)        87993.0000    87570.0000     11475-1
"PKG",11,22,1,"PAH",1,1,249,0)
 Bacteria colony count (#12,1)                    87719.0000     564-5
"PKG",11,22,1,"PAH",1,1,250,0)
 Parasite report (#14)              87505.0000
"PKG",11,22,1,"PAH",1,1,251,0)
 Parasite organism (#16)            87505.0000    87576.0000     17784-0
"PKG",11,22,1,"PAH",1,1,252,0)
 Mycology report (#18)              87994.0000
"PKG",11,22,1,"PAH",1,1,253,0)
 Fungal organism (#20)              87994.0000    87578.0000     580-1
"PKG",11,22,1,"PAH",1,1,254,0)
 Fungal colony count (#20,1)        87994.0000    87723.0000     19101-5
"PKG",11,22,1,"PAH",1,1,255,0)
 Mycobacterium report (#22)         87995.0000
"PKG",11,22,1,"PAH",1,1,256,0)
 Acid Fast stain (#24)              87995.0000    87756.0000     11545-1
"PKG",11,22,1,"PAH",1,1,257,0)
 Acid Fast stain quantity (#25)     87995.0000    87583.0000     11545-1
"PKG",11,22,1,"PAH",1,1,258,0)
 Mycobacterium organism (#26)       87995.0000    87589.0000     543-9
"PKG",11,22,1,"PAH",1,1,259,0)
 Mycobacterium colony count (#26,1) 87995.0000    87719.0000     564-5
"PKG",11,22,1,"PAH",1,1,260,0)
 Virology report (#33)              87996.0000
"PKG",11,22,1,"PAH",1,1,261,0)
 Viral agent (#36)                  87996.0000    87590.0000     6584-7
"PKG",11,22,1,"PAH",1,1,262,0)
 
"PKG",11,22,1,"PAH",1,1,263,0)
 Bacteriology or mycobacterium (TB) organism's susceptibilities -
"PKG",11,22,1,"PAH",1,1,264,0)
  is based on local site's mapping of NATIONAL VA LAB CODE field (#64)
"PKG",11,22,1,"PAH",1,1,265,0)
  in ANTIMICROBIAL SUSCEPTIBILITY file (#62.06) and the related default
"PKG",11,22,1,"PAH",1,1,266,0)
  LOINC code associated with this VA NLT code. Use option Map/Unmap 
"PKG",11,22,1,"PAH",1,1,267,0)
  Antimicrobial Default LOINC Code [LR LOINC MAP ANTIMICROBIAL] to
"PKG",11,22,1,"PAH",1,1,268,0)
  configure the default LOINC code for each antibiotic.
"PKG",11,22,1,"PAH",1,1,269,0)
 
"PKG",11,22,1,"PAH",1,1,270,0)
6. Surgical Pathology results. The current Laboratory package does not
"PKG",11,22,1,"PAH",1,1,271,0)
support LOINC encoding of surgical pathology results.
"PKG",11,22,1,"PAH",1,1,272,0)
LOINC codes valid as of version 2.14.
"PKG",11,22,1,"PAH",1,1,273,0)
  
"PKG",11,22,1,"PAH",1,1,274,0)
Default mapping of NLT/LOINC codes to standard fields within the 
"PKG",11,22,1,"PAH",1,1,275,0)
SURGICAL PATHOLOGY (#8) multiple of LAB DATA file (#63):
"PKG",11,22,1,"PAH",1,1,276,0)
 
"PKG",11,22,1,"PAH",1,1,277,0)
 Test                            Order NLT     Result NLT     LOINC Code
"PKG",11,22,1,"PAH",1,1,278,0)
 Specimen (#.012)                88515.0000    88539.0000     22633-2
"PKG",11,22,1,"PAH",1,1,279,0)
 Brief clinical history (#.013)  88515.0000    88542.0000     22636-5
"PKG",11,22,1,"PAH",1,1,280,0)
 Preoperative diagnosis (#.014)  88515.0000    88544.0000     10219-4
"PKG",11,22,1,"PAH",1,1,281,0)
 Operative findings (#.015)      88515.0000    88546.0000     10215-2
"PKG",11,22,1,"PAH",1,1,282,0)
 Postoperative diagnosis (#.016) 88515.0000    88547.0000     10218-6
"PKG",11,22,1,"PAH",1,1,283,0)
 Gross description (#1)          88515.0000    88549.0000     22634-0
"PKG",11,22,1,"PAH",1,1,284,0)
 Microscopic description (#1.1)  88515.0000    88563.0000     22635-7
"PKG",11,22,1,"PAH",1,1,285,0)
 Frozen section (#1.3)           88515.0000    88569.0000     22635-7
"PKG",11,22,1,"PAH",1,1,286,0)
 Surgical path diagnosis (#1.4)  88515.0000    88571.0000     22637-3
"PKG",11,22,1,"PAH",1,1,287,0)
 Supplementary report (#1.2)     88515.0000    88589.0000     22639-9
"PKG",11,22,1,"PAH",1,1,288,0)
 Specimen weight (#2)            88515.0000    81233.0000     3154-2
"PKG",11,22,1,"PAH",1,1,289,0)
 
"PKG",11,22,1,"PAH",1,1,290,0)
 
"PKG",11,22,1,"PAH",1,1,291,0)
7. Cytology results. The current Laboratory package does not support
"PKG",11,22,1,"PAH",1,1,292,0)
LOINC encoding of cytology results.
"PKG",11,22,1,"PAH",1,1,293,0)
LOINC codes valid as of version 2.14.
"PKG",11,22,1,"PAH",1,1,294,0)
  
"PKG",11,22,1,"PAH",1,1,295,0)
Default mapping of NLT/LOINC codes to standard fields within the 
"PKG",11,22,1,"PAH",1,1,296,0)
CYTOPATHOLOGY (#9) multiple of LAB DATA file (#63):
"PKG",11,22,1,"PAH",1,1,297,0)
 
"PKG",11,22,1,"PAH",1,1,298,0)
 Test                            Order NLT     Result NLT     LOINC Code
"PKG",11,22,1,"PAH",1,1,299,0)
 Specimens (#.012)               88593.0000    88539.0000     22633-2
"PKG",11,22,1,"PAH",1,1,300,0)
 Brief clinical history (#.013)  88593.0000    88542.0000     22636-5
"PKG",11,22,1,"PAH",1,1,301,0)
 Preoperative diagnosis (#.014)  88593.0000    88544.0000     10219-4
"PKG",11,22,1,"PAH",1,1,302,0)
 Operative findings (#.015)      88593.0000    88542.0000     10215-2
"PKG",11,22,1,"PAH",1,1,303,0)
 Postoperative diagnosis (#.016) 88593.0000    88547.0000     10218-6
"PKG",11,22,1,"PAH",1,1,304,0)
 Gross description (#1)          88593.0000    88549.0000     22634-0
"PKG",11,22,1,"PAH",1,1,305,0)
 Microscopic examination (#1.1)  88593.0000    88563.0000     22635-7
"PKG",11,22,1,"PAH",1,1,306,0)
 Supplementary report (#1.2)     88593.0000    88589.0000     22639-9
"PKG",11,22,1,"PAH",1,1,307,0)
 Cytopathlogy diagnosis (#1.4)   88593.0000    88571.0000     22637-3
"PKG",11,22,1,"PAH",1,1,308,0)
 
"PKG",11,22,1,"PAH",1,1,309,0)
 
"PKG",11,22,1,"PAH",1,1,310,0)
8. Electron microscopy results. The current Laboratory package does not
"PKG",11,22,1,"PAH",1,1,311,0)
support LOINC encoding of electron microscopy.
"PKG",11,22,1,"PAH",1,1,312,0)
 
"PKG",11,22,1,"PAH",1,1,313,0)
Default mapping of NLT/LOINC codes to standard fields within the 
"PKG",11,22,1,"PAH",1,1,314,0)
EM (#2) multiple of LAB DATA file (#63):
"PKG",11,22,1,"PAH",1,1,315,0)
 
"PKG",11,22,1,"PAH",1,1,316,0)
 Test                            Order NLT     Result NLT     LOINC Code
"PKG",11,22,1,"PAH",1,1,317,0)
 Specimens (#.012)               88597.0000    88057.0000     22633-2
"PKG",11,22,1,"PAH",1,1,318,0)
 Brief clinical history (#.013)  88597.0000    88542.0000     22636-5
"PKG",11,22,1,"PAH",1,1,319,0)
 Preoperative diagnosis (#.014)  88597.0000    88544.0000     10219-4
"PKG",11,22,1,"PAH",1,1,320,0)
 Operative findings (#.015)      88597.0000    88542.0000     10215-2
"PKG",11,22,1,"PAH",1,1,321,0)
 Postoperative diagnosis (#.016) 88597.0000    88547.0000     10218-6
"PKG",11,22,1,"PAH",1,1,322,0)
 Gross description (#1)          88597.0000    88549.0000     22634-0
"PKG",11,22,1,"PAH",1,1,323,0)
 Microscopic examination (#1.1)  88597.0000    88563.0000     22635-7
"PKG",11,22,1,"PAH",1,1,324,0)
 Supplementary report (#1.2)     88597.0000    88589.0000     22639-9
"PKG",11,22,1,"PAH",1,1,325,0)
 EM diagnosis (#1.4)             88597.0000    88571.0000     22637-3
"PKG",11,22,1,"PAH",1,1,326,0)
 
"PKG",11,22,1,"PAH",1,1,327,0)
 
"PKG",11,22,1,"PAH",1,1,328,0)
9. It corrects a defect identified during patch development with
"PKG",11,22,1,"PAH",1,1,329,0)
processing input parameters for the GCPR^LA7QRY API. If the input
"PKG",11,22,1,"PAH",1,1,330,0)
parameter LA7SC specified specific subscripts to search then the API
"PKG",11,22,1,"PAH",1,1,331,0)
would search those subscripts for any search code even when specific 
"PKG",11,22,1,"PAH",1,1,332,0)
search codes were passed to the API in the LA7SC array.
"PKG",11,22,1,"PAH",1,1,333,0)
 
"PKG",11,22,1,"PAH",1,1,334,0)
10. Converts several FileMan DBS calls on INSTITUTION file (#4) to using
"PKG",11,22,1,"PAH",1,1,335,0)
supported API's $$NS^XUAF4 and $$STA^XUAF4.
"PKG",11,22,1,"PAH",1,1,336,0)
 
"PKG",11,22,1,"PAH",1,1,337,0)
11. It corrects a defect identified during patch development with
"PKG",11,22,1,"PAH",1,1,338,0)
processing input parameters for the GCPR^LA7QRY API. If the input
"PKG",11,22,1,"PAH",1,1,339,0)
parameters LA7SDT and LA7EDT specified specific results available date
"PKG",11,22,1,"PAH",1,1,340,0)
range the API could return anatomic pathology results which have not
"PKG",11,22,1,"PAH",1,1,341,0)
been released. This API has been corrected to check the REPORT RELEASE
"PKG",11,22,1,"PAH",1,1,342,0)
DATE field (#.11) for subscripts "CY", EM", "SP".
"PKG",11,22,1,"PAH",1,1,343,0)
 
"PKG",11,22,1,"PAH",1,1,344,0)
12. Remedy ticket HD0000000096207 reported a problem with the error code
"PKG",11,22,1,"PAH",1,1,345,0)
returned by the Lab API LA7QRY. A FileMan DBS error code was erroroneously
"PKG",11,22,1,"PAH",1,1,346,0)
being returned to the calling application. Routines LA7QRY, LA7QRY1, and 
"PKG",11,22,1,"PAH",1,1,347,0)
LA7QRY2 has been modified to use a different name spaced variable LA7QERR
"PKG",11,22,1,"PAH",1,1,348,0)
to return to the calling application any error conditions. Additionally,
"PKG",11,22,1,"PAH",1,1,349,0)
routine LA7VOBX1 has been modified to use another name spaced variable
"PKG",11,22,1,"PAH",1,1,350,0)
LA7DDERR to handle FileMan DBS error conditions related to FileMan data
"PKG",11,22,1,"PAH",1,1,351,0)
dictionary calls.
"PKG",11,22,1,"PAH",1,1,352,0)
 
"PKG",11,22,1,"PAH",1,1,353,0)
13. It corrects a defect identified by MyHeatheVet regarding encoding of 
"PKG",11,22,1,"PAH",1,1,354,0)
the following fields in the OBR segment relating to anatomic pathology 
"PKG",11,22,1,"PAH",1,1,355,0)
reports:
"PKG",11,22,1,"PAH",1,1,356,0)
 OBR-32 - Principal result interpreter
"PKG",11,22,1,"PAH",1,1,357,0)
 OBR-33 - Assistant result interpreter
"PKG",11,22,1,"PAH",1,1,358,0)
 OBR-34 - Technician
"PKG",11,22,1,"PAH",1,1,359,0)
 OBR-35 - Transcriptionist
"PKG",11,22,1,"PAH",1,1,360,0)
 
"PKG",11,22,1,"PAH",1,1,361,0)
The name component of these fields was being encoded with the wrong HL7
"PKG",11,22,1,"PAH",1,1,362,0)
delimiter (component separator). The name component will be encoded with 
"PKG",11,22,1,"PAH",1,1,363,0)
the subcomponent separator per the HL7 standard.
"PKG",11,22,1,"PAH",1,1,364,0)
  
"PKG",11,22,1,"PAH",1,1,365,0)
14. To integrate the VistA-Office EHR with the regular VistA system as
"PKG",11,22,1,"PAH",1,1,366,0)
 well as adding functionality also available in the Indian Health Services
"PKG",11,22,1,"PAH",1,1,367,0)
 system, the GQPR^LA7QRY API has been modified to allow for VistA-Office
"PKG",11,22,1,"PAH",1,1,368,0)
 EHR to use data specifically geared toward clinical operations, whether
"PKG",11,22,1,"PAH",1,1,369,0)
 in a hospital or a standalone clinic. The use of an Electronic
"PKG",11,22,1,"PAH",1,1,370,0)
 Health Record number as opposed to a SSN for patient identification is
"PKG",11,22,1,"PAH",1,1,371,0)
 supported as an identifier accepted as input to this API.
"PKG",11,22,1,"PAH",1,1,372,0)
 
"PKG",11,22,1,"PAH",1,1,373,0)
 The entry point GCPR^LA7QRY remains unchanged. However, the parameter
"PKG",11,22,1,"PAH",1,1,374,0)
 used to pass the patient identifier should contain a 2nd piece indicating
"PKG",11,22,1,"PAH",1,1,375,0)
 the type of identifier contained in the 1st piece.
"PKG",11,22,1,"PAH",1,1,376,0)
 
"PKG",11,22,1,"PAH",1,1,377,0)
 It supports the following types of patient identifiers
"PKG",11,22,1,"PAH",1,1,378,0)
   SS = Social Security number
"PKG",11,22,1,"PAH",1,1,379,0)
   PI = VA MPI Integration Control Number
"PKG",11,22,1,"PAH",1,1,380,0)
   MR = medical record number of patient in file PATIENT/IHS (#9000001)
"PKG",11,22,1,"PAH",1,1,381,0)
 
"PKG",11,22,1,"PAH",1,1,382,0)
 To regular VistA users this modification will not be seen.
"PKG",11,22,1,"PAH",1,1,383,0)
 
"PKG",11,22,1,"PAH",1,1,384,0)
15. To support HDR-Historical which uses the GRPR^LA7QRY API to extract
"PKG",11,22,1,"PAH",1,1,385,0)
historical laboratory test results, the input parameter LA7SC to GCPR^LA7QRY
"PKG",11,22,1,"PAH",1,1,386,0)
supports a 2nd piece. When the 2nd piece of input parameter LA7SC equals
"PKG",11,22,1,"PAH",1,1,387,0)
1 the API will return results encoded using VUID's when available.
"PKG",11,22,1,"PAH",1,1,388,0)
 
"PKG",11,22,1,"PAH",1,1,389,0)
16. Remedy tickets HD0000000141922/HD0000000148089 reported a problem with
"PKG",11,22,1,"PAH",1,1,390,0)
failure of generation of MailMan bulletin LA7 ORDER STATUS CHANGED at
"PKG",11,22,1,"PAH",1,1,391,0)
collection laboratory facility. Routine LA7VMSG1 changed to set interface
"PKG",11,22,1,"PAH",1,1,392,0)
type to set flag in Lab HL7 ORU message indicating an order status change
"PKG",11,22,1,"PAH",1,1,393,0)
to trigger bulletin generation at collecting site.
"PKG",11,22,1,"PAH",1,1,394,0)
 
"PKG",11,22,1,"PAH",1,1,395,0)
  
"PKG",11,22,1,"PAH",1,1,396,0)
ASSOCIATED E3R
"PKG",11,22,1,"PAH",1,1,397,0)
--------------
"PKG",11,22,1,"PAH",1,1,398,0)
 None
"PKG",11,22,1,"PAH",1,1,399,0)
 
"PKG",11,22,1,"PAH",1,1,400,0)
 
"PKG",11,22,1,"PAH",1,1,401,0)
ASSOCIATED REMEDY
"PKG",11,22,1,"PAH",1,1,402,0)
-----------------
"PKG",11,22,1,"PAH",1,1,403,0)
 HD0000000096207
"PKG",11,22,1,"PAH",1,1,404,0)
 HD0000000141922
"PKG",11,22,1,"PAH",1,1,405,0)
 HD0000000148089
"PKG",11,22,1,"PAH",1,1,406,0)
 
"PKG",11,22,1,"PAH",1,1,407,0)
TEST SITES
"PKG",11,22,1,"PAH",1,1,408,0)
----------
"PKG",11,22,1,"PAH",1,1,409,0)
 Atlanta VAMC
"PKG",11,22,1,"PAH",1,1,410,0)
 Biloxi VAMC
"PKG",11,22,1,"PAH",1,1,411,0)
 Boston HCS
"PKG",11,22,1,"PAH",1,1,412,0)
 El Paso VAMC
"PKG",11,22,1,"PAH",1,1,413,0)
 Houston VAMC
"PKG",11,22,1,"PAH",1,1,414,0)
 Milwaukee VAMC
"PKG",11,22,1,"PAH",1,1,415,0)
 North CHhicago VAMC
"PKG",11,22,1,"PAH",1,1,416,0)
 Northhampton VAMC
"PKG",11,22,1,"PAH",1,1,417,0)
 Palo Alto HCS
"PKG",11,22,1,"PAH",1,1,418,0)
 Philadelphia VAMC
"PKG",11,22,1,"PAH",1,1,419,0)
 Pittsburgh HCS
"PKG",11,22,1,"PAH",1,1,420,0)
 Puget Sound HCS
"PKG",11,22,1,"PAH",1,1,421,0)
 Salt Lake City VAMC
"PKG",11,22,1,"PAH",1,1,422,0)
 South Texas HCS
"PKG",11,22,1,"PAH",1,1,423,0)
 VA Greater Los Angeles HCS
"PKG",11,22,1,"PAH",1,1,424,0)
 
"PKG",11,22,1,"PAH",1,1,425,0)
 
"PKG",11,22,1,"PAH",1,1,426,0)
INSTALLATION INSTRUCTIONS
"PKG",11,22,1,"PAH",1,1,427,0)
=========================
"PKG",11,22,1,"PAH",1,1,428,0)
 
"PKG",11,22,1,"PAH",1,1,429,0)
  The install time for this patch is less than 5 minute. This patch
"PKG",11,22,1,"PAH",1,1,430,0)
  can be installed when Laboratory users are on the system.
"PKG",11,22,1,"PAH",1,1,431,0)
  Suggested time to install: non-peak requirement hours.
"PKG",11,22,1,"PAH",1,1,432,0)
 
"PKG",11,22,1,"PAH",1,1,433,0)
 
"PKG",11,22,1,"PAH",1,1,434,0)
NOTE: Kernel patches must be current on the target system to avoid
"PKG",11,22,1,"PAH",1,1,435,0)
      problems loading and/or installing this patch.
"PKG",11,22,1,"PAH",1,1,436,0)
 
"PKG",11,22,1,"PAH",1,1,437,0)
      Patch installation needs to be coordinated with the Laboratory
"PKG",11,22,1,"PAH",1,1,438,0)
      Information Manager (LIM/ADPAC).
"PKG",11,22,1,"PAH",1,1,439,0)
 
"PKG",11,22,1,"PAH",1,1,440,0)
 1.   LOAD TRANSPORT GLOBAL
"PKG",11,22,1,"PAH",1,1,441,0)
      ---------------------------------------
"PKG",11,22,1,"PAH",1,1,442,0)
      Choose the PackMan message containing this patch and invoke the
"PKG",11,22,1,"PAH",1,1,443,0)
      INSTALL/CHECK   MESSAGE PackMan option. 
"PKG",11,22,1,"PAH",1,1,444,0)
 
"PKG",11,22,1,"PAH",1,1,445,0)
 
"PKG",11,22,1,"PAH",1,1,446,0)
 2.   START UP KIDS
"PKG",11,22,1,"PAH",1,1,447,0)
      Start up the Kernel Installation and distribution System
"PKG",11,22,1,"PAH",1,1,448,0)
      Menu [XPD MAIN]:
"PKG",11,22,1,"PAH",1,1,449,0)
              Edits and Distribution ...
"PKG",11,22,1,"PAH",1,1,450,0)
                           Utilities ...
"PKG",11,22,1,"PAH",1,1,451,0)
                         Installation ...
"PKG",11,22,1,"PAH",1,1,452,0)
      
"PKG",11,22,1,"PAH",1,1,453,0)
     Select Kernel Installation & Distribution System Option: Installation
"PKG",11,22,1,"PAH",1,1,454,0)
                                                              ----
"PKG",11,22,1,"PAH",1,1,455,0)
                1      Load a Distribution
"PKG",11,22,1,"PAH",1,1,456,0)
                2      Verify Checksums in Transport Global
"PKG",11,22,1,"PAH",1,1,457,0)
                3      Print Transport Global
"PKG",11,22,1,"PAH",1,1,458,0)
                4      Compare Transport Global to Current System
"PKG",11,22,1,"PAH",1,1,459,0)
                5      Backup a Transport Global
"PKG",11,22,1,"PAH",1,1,460,0)
                6      Install Package(s)
"PKG",11,22,1,"PAH",1,1,461,0)
                       Restart Install of Package(s)
"PKG",11,22,1,"PAH",1,1,462,0)
                       Unload a Distribution
"PKG",11,22,1,"PAH",1,1,463,0)
 
"PKG",11,22,1,"PAH",1,1,464,0)
      Select Installation Option:
"PKG",11,22,1,"PAH",1,1,465,0)
 
"PKG",11,22,1,"PAH",1,1,466,0)
 3.   Select Installation Option:
"PKG",11,22,1,"PAH",1,1,467,0)
      -------------------------------
"PKG",11,22,1,"PAH",1,1,468,0)
      NOTE:  The following are OPTIONAL - (When prompted for the
"PKG",11,22,1,"PAH",1,1,469,0)
      INSTALL NAME, enter LA*5.2*68):
"PKG",11,22,1,"PAH",1,1,470,0)
      a.  Backup a Transport Global - This option will create a
"PKG",11,22,1,"PAH",1,1,471,0)
          backup message of any routines exported with this patch.
"PKG",11,22,1,"PAH",1,1,472,0)
          It will not backup any other changes such as DD's or templates.
"PKG",11,22,1,"PAH",1,1,473,0)
      b.  Compare Transport Global to Current System - This option
"PKG",11,22,1,"PAH",1,1,474,0)
          will allow you to view all changes that will be made when this
"PKG",11,22,1,"PAH",1,1,475,0)
          patch is installed. It compares all components of this patch
"PKG",11,22,1,"PAH",1,1,476,0)
          (routines, DD's, templates, etc.).
"PKG",11,22,1,"PAH",1,1,477,0)
      c.  Verify Checksums in Transport Global - This option will
"PKG",11,22,1,"PAH",1,1,478,0)
          allow you to ensure the integrity of the routines that are in
"PKG",11,22,1,"PAH",1,1,479,0)
          the transport global.
"PKG",11,22,1,"PAH",1,1,480,0)
 
"PKG",11,22,1,"PAH",1,1,481,0)
 4.   Select Installation Option:  Install Package(s)
"PKG",11,22,1,"PAH",1,1,482,0)
                                   ------------------
"PKG",11,22,1,"PAH",1,1,483,0)
      **This is the step to start the installation of this KIDS patch:
"PKG",11,22,1,"PAH",1,1,484,0)
 
"PKG",11,22,1,"PAH",1,1,485,0)
      a.  Choose the Install Package(s) option to start the patch install.
"PKG",11,22,1,"PAH",1,1,486,0)
          (When prompted for the INSTALL NAME, enter LA*5.2*68.)
"PKG",11,22,1,"PAH",1,1,487,0)
      b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install?
"PKG",11,22,1,"PAH",1,1,488,0)
          NO//' answer NO (unless otherwise indicated)
"PKG",11,22,1,"PAH",1,1,489,0)
      c.  When prompted 'Want to DISABLE Scheduled Options, Menu Options,
"PKG",11,22,1,"PAH",1,1,490,0)
          and Protocols? NO//' answer NO (unless otherwise indicated)
"PKG",11,22,1,"PAH",1,1,491,0)
 
"PKG",11,22,1,"PAH",1,1,492,0)
 
"PKG",11,22,1,"PAH",1,1,493,0)
 
"PKG",11,22,1,"PAH",1,1,494,0)
 Note: Routine LA68 will be deleted after successful patch installation.
"PKG",11,22,1,"PAH",1,1,495,0)
 
"PKG",11,22,1,"PAH",1,1,496,0)
 
"PKG",11,22,1,"PAH",1,1,497,0)
POST-INSTALLATION INSTRUCTIONS:
"PKG",11,22,1,"PAH",1,1,498,0)
===============================
"PKG",11,22,1,"PAH",1,1,499,0)
 
"PKG",11,22,1,"PAH",1,1,500,0)
***************************************************************************
"PKG",11,22,1,"PAH",1,1,501,0)
 
"PKG",11,22,1,"PAH",1,1,502,0)
After the installation of Patch LA*5.2*68, do not activate the LA7 LAB 
"PKG",11,22,1,"PAH",1,1,503,0)
RESULTS TO HDR (SUB) subscriber protocol until contacted by the HDR team
"PKG",11,22,1,"PAH",1,1,504,0)
 
"PKG",11,22,1,"PAH",1,1,505,0)
***************************************************************************
"PKG",11,22,1,"PAH",1,1,506,0)
 
"PKG",11,22,1,"PAH",1,1,507,0)
 
"PKG",11,22,1,"PAH",1,1,508,0)
NOTE: Use the following steps only when activating the transmission of
"PKG",11,22,1,"PAH",1,1,509,0)
laboratory data to the VA HDR and/or interfacing to a Commercial Off the 
"PKG",11,22,1,"PAH",1,1,510,0)
Shelf System (COTS) or other VistA subscriber. No further action is
"PKG",11,22,1,"PAH",1,1,511,0)
required, if there is no requirement to activate this interface.
"PKG",11,22,1,"PAH",1,1,512,0)
 
"PKG",11,22,1,"PAH",1,1,513,0)
 To activate messaging to the VA HDR perform steps 1, 2, and 3.
"PKG",11,22,1,"PAH",1,1,514,0)
 To activate messaging to COTS and other VistA subscribers
"PKG",11,22,1,"PAH",1,1,515,0)
    perform steps 1 and 4.
"PKG",11,22,1,"PAH",1,1,516,0)
 
"PKG",11,22,1,"PAH",1,1,517,0)
1. To utilize the building and transmission of HL7 Lab ORU result messages.
"PKG",11,22,1,"PAH",1,1,518,0)
 
"PKG",11,22,1,"PAH",1,1,519,0)
   Enable the configuration 'LA7HDR' in LA7 MESSAGE PARAMETER file
"PKG",11,22,1,"PAH",1,1,520,0)
   (#62.48). This is accomplished by setting the field STATUS (#2) to
"PKG",11,22,1,"PAH",1,1,521,0)
   'ACTIVE' using VA File Manager. Setting this field to 'INACTIVE' will
"PKG",11,22,1,"PAH",1,1,522,0)
   turn off generation of this Lab HL7 message.
"PKG",11,22,1,"PAH",1,1,523,0)
 
"PKG",11,22,1,"PAH",1,1,524,0)
   Select VA FileMan Option:  Enter or Edit File Entries
"PKG",11,22,1,"PAH",1,1,525,0)
 
"PKG",11,22,1,"PAH",1,1,526,0)
   INPUT TO WHAT FILE: LA7 MESSAGE PARAMETER// 62.48  LA7 MESSAGE PARAMETER
"PKG",11,22,1,"PAH",1,1,527,0)
    EDIT WHICH FIELD: ALL// STATUS
"PKG",11,22,1,"PAH",1,1,528,0)
    THEN EDIT FIELD:
"PKG",11,22,1,"PAH",1,1,529,0)
 
"PKG",11,22,1,"PAH",1,1,530,0)
   Select LA7 MESSAGE PARAMETER CONFIGURATION: LA7HDR
"PKG",11,22,1,"PAH",1,1,531,0)
   STATUS: INACTIVE// ACTIVE  ACTIVE
"PKG",11,22,1,"PAH",1,1,532,0)
 
"PKG",11,22,1,"PAH",1,1,533,0)
 
"PKG",11,22,1,"PAH",1,1,534,0)
2. Activation of transmission to HDR requires coordination with your
"PKG",11,22,1,"PAH",1,1,535,0)
   assigned HDR Implementation Manager (IM). Sites should not activate the
"PKG",11,22,1,"PAH",1,1,536,0)
   LA7 LAB RESULTS TO HDR (SUB) subscriber until notified by the HDR
"PKG",11,22,1,"PAH",1,1,537,0)
   team. The coordination of extractions of existing laboratory data will
"PKG",11,22,1,"PAH",1,1,538,0)
   be started at the same time the configuration of the LA7 LAB RESULTS TO
"PKG",11,22,1,"PAH",1,1,539,0)
   HDR (SUB) subscriber to ensure that there is an overlap of laboratory
"PKG",11,22,1,"PAH",1,1,540,0)
   results. This overlap is done to ensure all laboratory results are in
"PKG",11,22,1,"PAH",1,1,541,0)
   the HDR.
"PKG",11,22,1,"PAH",1,1,542,0)
 
"PKG",11,22,1,"PAH",1,1,543,0)
 a. Set up VDEFVIE4 link for Laboratory data transmission
"PKG",11,22,1,"PAH",1,1,544,0)
 
"PKG",11,22,1,"PAH",1,1,545,0)
     Use the HL7 Main Menu, Filers option to look at the setup for 
"PKG",11,22,1,"PAH",1,1,546,0)
     VDEFVIE3. 
"PKG",11,22,1,"PAH",1,1,547,0)
 
"PKG",11,22,1,"PAH",1,1,548,0)
     Copy down the IP and port number used for VDEFVIE3.
"PKG",11,22,1,"PAH",1,1,549,0)
 
"PKG",11,22,1,"PAH",1,1,550,0)
     Use the HL7 Main Menu, Filers option to edit VDEFVIE4.  
"PKG",11,22,1,"PAH",1,1,551,0)
 
"PKG",11,22,1,"PAH",1,1,552,0)
     Enable auto startup and add the same IP and port numbers used for
"PKG",11,22,1,"PAH",1,1,553,0)
     VDEFVIE3.
"PKG",11,22,1,"PAH",1,1,554,0)
 
"PKG",11,22,1,"PAH",1,1,555,0)
     Use the HL7 Main Menu, Start/Stop Links option to start the VDEFVIE4
"PKG",11,22,1,"PAH",1,1,556,0)
     link.
"PKG",11,22,1,"PAH",1,1,557,0)
 
"PKG",11,22,1,"PAH",1,1,558,0)
     Use the HL7 Main Menu, Site Parameters option to select VDEF view
"PKG",11,22,1,"PAH",1,1,559,0)
     and add VDEFVIE4 to the view.
"PKG",11,22,1,"PAH",1,1,560,0)
 
"PKG",11,22,1,"PAH",1,1,561,0)
 
"PKG",11,22,1,"PAH",1,1,562,0)
 b. To activate the interface to the VA HDR use Protocol Edit option
"PKG",11,22,1,"PAH",1,1,563,0)
   [HL EDIT INTERFACE] on the HL package Interface Developer Options
"PKG",11,22,1,"PAH",1,1,564,0)
   [HL MENU INTERFACE TK] menu option and edit protocol LA7 LAB RESULTS
"PKG",11,22,1,"PAH",1,1,565,0)
   TO HDR (SUB). Go to the second ScreenMan screen and edit the field
"PKG",11,22,1,"PAH",1,1,566,0)
   ROUTING LOGIC and remove the leading ";" character and enter the
"PKG",11,22,1,"PAH",1,1,567,0)
   'save' command to save the changes to the protocol.
"PKG",11,22,1,"PAH",1,1,568,0)
 
"PKG",11,22,1,"PAH",1,1,569,0)
                          HL7 SUBSCRIBER                       PAGE 2 OF 2
"PKG",11,22,1,"PAH",1,1,570,0)
                         LA7 LAB RESULTS TO HDR (SUB)
"PKG",11,22,1,"PAH",1,1,571,0)
---------------------------------------------------------------------------
"PKG",11,22,1,"PAH",1,1,572,0)
 
"PKG",11,22,1,"PAH",1,1,573,0)
      RECEIVING APPLICATION: LA7HDR
"PKG",11,22,1,"PAH",1,1,574,0)
 
"PKG",11,22,1,"PAH",1,1,575,0)
      RESPONSE MESSAGE TYPE: ACK                            EVENT TYPE: R01
"PKG",11,22,1,"PAH",1,1,576,0)
 
"PKG",11,22,1,"PAH",1,1,577,0)
 SENDING FACILITY REQUIRED?: YES          RECEIVING FACILITY REQUIRED?: YES
"PKG",11,22,1,"PAH",1,1,578,0)
 
"PKG",11,22,1,"PAH",1,1,579,0)
         SECURITY REQUIRED?:
"PKG",11,22,1,"PAH",1,1,580,0)
 
"PKG",11,22,1,"PAH",1,1,581,0)
               LOGICAL LINK: VDEFVIE4
"PKG",11,22,1,"PAH",1,1,582,0)
 
"PKG",11,22,1,"PAH",1,1,583,0)
 PROCESSING RTN:
"PKG",11,22,1,"PAH",1,1,584,0)
 
"PKG",11,22,1,"PAH",1,1,585,0)
  ROUTING LOGIC: ;D RTR^LA7HDR("CH;")  <-- remove leading ";" character
"PKG",11,22,1,"PAH",1,1,586,0)
____________________________________________________________________________
"PKG",11,22,1,"PAH",1,1,587,0)
 
"PKG",11,22,1,"PAH",1,1,588,0)
COMMAND:                                     Press <PF1>H for help    Insert
"PKG",11,22,1,"PAH",1,1,589,0)
 
"PKG",11,22,1,"PAH",1,1,590,0)
After the change the field should look like:
"PKG",11,22,1,"PAH",1,1,591,0)
  ROUTING LOGIC: D RTR^LA7HDR("CH;")
"PKG",11,22,1,"PAH",1,1,592,0)
 
"PKG",11,22,1,"PAH",1,1,593,0)
3. To transmit Lab HL7 ORU result messages to another system, i.e.
"PKG",11,22,1,"PAH",1,1,594,0)
   Commercial Off the Shelf System (COTS).
"PKG",11,22,1,"PAH",1,1,595,0)
 
"PKG",11,22,1,"PAH",1,1,596,0)
 a. Create a HL7 subscriber protocol as documented in HL7 Site Manager &
"PKG",11,22,1,"PAH",1,1,597,0)
    Developer Manual version 1.6*56
"PKG",11,22,1,"PAH",1,1,598,0)
 
"PKG",11,22,1,"PAH",1,1,599,0)
 b. Attach this protocol as a subscriber to HL7 event protocol LA7 LAB
"PKG",11,22,1,"PAH",1,1,600,0)
    RESULTS AVAILABLE (EVN). Use Protocol Edit option [HL EDIT INTERFACE]
"PKG",11,22,1,"PAH",1,1,601,0)
    on the HL package Interface Developer Options [HL MENU INTERFACE TK]
"PKG",11,22,1,"PAH",1,1,602,0)
    menu option to add this subscriber.
"PKG",11,22,1,"PAH",1,1,603,0)
 
"PKG",11,22,1,"PAH",1,1,604,0)
 
"PKG",11,22,1,"PAH",1,1,605,0)
4. Controlling message generation and transmission.
"PKG",11,22,1,"PAH",1,1,606,0)
 
"PKG",11,22,1,"PAH",1,1,607,0)
   Notify the HDR Project Office in the event that this interface is
"PKG",11,22,1,"PAH",1,1,608,0)
   deactivated and the interface to the HDR was previously activated
"PKG",11,22,1,"PAH",1,1,609,0)
 
"PKG",11,22,1,"PAH",1,1,610,0)
   a. To turn off message building and transmission to ALL subscribers
"PKG",11,22,1,"PAH",1,1,611,0)
      of event protocol LA7 LAB RESULTS AVAILABLE (EVN).
"PKG",11,22,1,"PAH",1,1,612,0)
      Disable the configuration 'LA7HDR' in LA7 MESSAGE PARAMETER file
"PKG",11,22,1,"PAH",1,1,613,0)
      (#62.48). This is accomplished by setting the field STATUS (#2) to
"PKG",11,22,1,"PAH",1,1,614,0)
      'INACTIVE' using VA File Manager Enter or Edit File Entries [DIEDIT].
"PKG",11,22,1,"PAH",1,1,615,0)
      Setting this field to 'INACTIVE' will turn off generation of this Lab
"PKG",11,22,1,"PAH",1,1,616,0)
      HL7 message.
"PKG",11,22,1,"PAH",1,1,617,0)
 
"PKG",11,22,1,"PAH",1,1,618,0)
   b. To turn off message transmission to a specific subscriber.
"PKG",11,22,1,"PAH",1,1,619,0)
      On the HL package, Interface Developer Options [HL MENU INTERFACE
"PKG",11,22,1,"PAH",1,1,620,0)
      TK] menu option, use the Protocol Edit [HL EDIT INTERFACE] option to
"PKG",11,22,1,"PAH",1,1,621,0)
      remove the related subscriber protocol from the event protocol LA7
"PKG",11,22,1,"PAH",1,1,622,0)
      LAB RESULTS AVAILABLE (EVN).
"PKG",11,22,1,"PAH",1,1,623,0)
 
"PKG",11,22,1,"PAH",1,1,624,0)
      For the VA HDR, remove subscriber protocol LA7 LAB RESULTS TO HDR
"PKG",11,22,1,"PAH",1,1,625,0)
      (SUB).
"PKG",11,22,1,"PAH",1,1,626,0)
 
"PKG",11,22,1,"PAH",1,1,627,0)
 
"PKG",11,22,1,"PAH",1,1,628,0)
 
"PKG",11,22,1,"PAH",1,1,629,0)
 
"PKG",11,22,1,"PAH",1,1,630,0)
INSTALLATION EXAMPLE
"PKG",11,22,1,"PAH",1,1,631,0)
====================
"PKG",11,22,1,"PAH",1,1,632,0)
 
"PKG",11,22,1,"PAH",1,1,633,0)
Select Installation Option: 6  Install Package(s) 
"PKG",11,22,1,"PAH",1,1,634,0)
Select INSTALL NAME: LA*5.2*68 Loaded from Distribution  2/4/05@10:21
"PKG",11,22,1,"PAH",1,1,635,0)
     => LA*5.2*68
"PKG",11,22,1,"PAH",1,1,636,0)
 
"PKG",11,22,1,"PAH",1,1,637,0)
This Distribution was loaded on Feb 04, 2005@10:21 with header of
"PKG",11,22,1,"PAH",1,1,638,0)
   LA*5.2*68
"PKG",11,22,1,"PAH",1,1,639,0)
   It consisted of the following Install(s):
"PKG",11,22,1,"PAH",1,1,640,0)
      LA*5.2*68
"PKG",11,22,1,"PAH",1,1,641,0)
Checking Install for Package LA*5.2*68
"PKG",11,22,1,"PAH",1,1,642,0)
Will first run the Environment Check Routine, LA68
"PKG",11,22,1,"PAH",1,1,643,0)
 
"PKG",11,22,1,"PAH",1,1,644,0)
 
"PKG",11,22,1,"PAH",1,1,645,0)
                        --- Environment Check is Ok ---
"PKG",11,22,1,"PAH",1,1,646,0)
 
"PKG",11,22,1,"PAH",1,1,647,0)
Install Questions for LA*5.2*68
"PKG",11,22,1,"PAH",1,1,648,0)
 
"PKG",11,22,1,"PAH",1,1,649,0)
Incoming Files:
"PKG",11,22,1,"PAH",1,1,650,0)
 
"PKG",11,22,1,"PAH",1,1,651,0)
 
"PKG",11,22,1,"PAH",1,1,652,0)
   62.48     LA7 MESSAGE PARAMETER  (including data)
"PKG",11,22,1,"PAH",1,1,653,0)
Note:  You already have the 'LA7 MESSAGE PARAMETER' File.
"PKG",11,22,1,"PAH",1,1,654,0)
I will OVERWRITE your data with mine.
"PKG",11,22,1,"PAH",1,1,655,0)
 
"PKG",11,22,1,"PAH",1,1,656,0)
 
"PKG",11,22,1,"PAH",1,1,657,0)
   63        LAB DATA  (Partial Definition)
"PKG",11,22,1,"PAH",1,1,658,0)
Note:  You already have the 'LAB DATA' File.
"PKG",11,22,1,"PAH",1,1,659,0)
 
"PKG",11,22,1,"PAH",1,1,660,0)
 
"PKG",11,22,1,"PAH",1,1,661,0)
Want KIDS to Rebuild Menu Trees Upon Completion of Install? YES//
"PKG",11,22,1,"PAH",1,1,662,0)
 
"PKG",11,22,1,"PAH",1,1,663,0)
 
"PKG",11,22,1,"PAH",1,1,664,0)
Want KIDS to INHIBIT LOGONs during the install? NO// NO
"PKG",11,22,1,"PAH",1,1,665,0)
Want to DISABLE Scheduled Options, Menu Options, and Protocols? NO// NO
"PKG",11,22,1,"PAH",1,1,666,0)
 
"PKG",11,22,1,"PAH",1,1,667,0)
Enter the Device you want to print the Install messages.
"PKG",11,22,1,"PAH",1,1,668,0)
You can queue the install by enter a 'Q' at the device prompt.
"PKG",11,22,1,"PAH",1,1,669,0)
Enter a '^' to abort the install.
"PKG",11,22,1,"PAH",1,1,670,0)
 
"PKG",11,22,1,"PAH",1,1,671,0)
DEVICE: HOME//  TELNET VIRTUAL
"PKG",11,22,1,"PAH",1,1,672,0)
 
"PKG",11,22,1,"PAH",1,1,673,0)
 
"PKG",11,22,1,"PAH",1,1,674,0)
 Install Started for LA*5.2*68 :
"PKG",11,22,1,"PAH",1,1,675,0)
               Feb 04, 2005@10:21:55
"PKG",11,22,1,"PAH",1,1,676,0)
 
"PKG",11,22,1,"PAH",1,1,677,0)
Build Distribution Date: Feb 04, 2005
"PKG",11,22,1,"PAH",1,1,678,0)
 
"PKG",11,22,1,"PAH",1,1,679,0)
 Installing Routines:.............
"PKG",11,22,1,"PAH",1,1,680,0)
               Feb 04, 2005@10:21:55
"PKG",11,22,1,"PAH",1,1,681,0)
 
"PKG",11,22,1,"PAH",1,1,682,0)
 Running Pre-Install Routine: PRE^LA68.
"PKG",11,22,1,"PAH",1,1,683,0)
 
"PKG",11,22,1,"PAH",1,1,684,0)
               Sending install started alert to mail group G.LMI
"PKG",11,22,1,"PAH",1,1,685,0)
 
"PKG",11,22,1,"PAH",1,1,686,0)
                          *** Pre install started ***
"PKG",11,22,1,"PAH",1,1,687,0)
 
"PKG",11,22,1,"PAH",1,1,688,0)
                           --- No action required---
"PKG",11,22,1,"PAH",1,1,689,0)
 
"PKG",11,22,1,"PAH",1,1,690,0)
                         *** Pre install completed ***
"PKG",11,22,1,"PAH",1,1,691,0)
 
"PKG",11,22,1,"PAH",1,1,692,0)
 Installing Data Dictionaries: ...
"PKG",11,22,1,"PAH",1,1,693,0)
               Feb 04, 2005@10:21:55
"PKG",11,22,1,"PAH",1,1,694,0)
 
"PKG",11,22,1,"PAH",1,1,695,0)
 Installing Data:
"PKG",11,22,1,"PAH",1,1,696,0)
               Feb 04, 2005@10:21:55
"PKG",11,22,1,"PAH",1,1,697,0)
 
"PKG",11,22,1,"PAH",1,1,698,0)
 Installing PACKAGE COMPONENTS:
"PKG",11,22,1,"PAH",1,1,699,0)
 
"PKG",11,22,1,"PAH",1,1,700,0)
 Installing HL7 APPLICATION PARAMETER...
"PKG",11,22,1,"PAH",1,1,701,0)
 
"PKG",11,22,1,"PAH",1,1,702,0)
 Installing PROTOCOL..
"PKG",11,22,1,"PAH",1,1,703,0)
  Located in the LA7 (LAB MESSAGING) namespace..
"PKG",11,22,1,"PAH",1,1,704,0)
  Located in the LA7 (LAB MESSAGING) namespace..
"PKG",11,22,1,"PAH",1,1,705,0)
  Located in the LA7 (LAB MESSAGING) namespace..
"PKG",11,22,1,"PAH",1,1,706,0)
               Feb 04, 2005@10:21:55
"PKG",11,22,1,"PAH",1,1,707,0)
 
"PKG",11,22,1,"PAH",1,1,708,0)
 Running Post-Install Routine: POST^LA68.
"PKG",11,22,1,"PAH",1,1,709,0)
 
"PKG",11,22,1,"PAH",1,1,710,0)
                          *** Post install started ***
"PKG",11,22,1,"PAH",1,1,711,0)
 
"PKG",11,22,1,"PAH",1,1,712,0)
          *** Clearing facility name for LA7LAB entry in file #771 ***
"PKG",11,22,1,"PAH",1,1,713,0)
 
"PKG",11,22,1,"PAH",1,1,714,0)
                    *** Clearing facility name completed ***
"PKG",11,22,1,"PAH",1,1,715,0)
 
"PKG",11,22,1,"PAH",1,1,716,0)
                         *** Post install completed ***
"PKG",11,22,1,"PAH",1,1,717,0)
 
"PKG",11,22,1,"PAH",1,1,718,0)
              Sending install completion alert to mail group G.LMI
"PKG",11,22,1,"PAH",1,1,719,0)
 
"PKG",11,22,1,"PAH",1,1,720,0)
 Updating Routine file......
"PKG",11,22,1,"PAH",1,1,721,0)
 
"PKG",11,22,1,"PAH",1,1,722,0)
 Updating KIDS files.......
"PKG",11,22,1,"PAH",1,1,723,0)
 
"PKG",11,22,1,"PAH",1,1,724,0)
 LA*5.2*68 Installed.
"PKG",11,22,1,"PAH",1,1,725,0)
               Feb 04, 2005@10:21:55
"PKG",11,22,1,"PAH",1,1,726,0)
 
"PKG",11,22,1,"PAH",1,1,727,0)
 Install Message sent #xxxx
"PRE")
LA68
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
29
"RTN","LA68")
0^^B17816218^n/a
"RTN","LA68",1,0)
LA68 ;DALOI/JMC - LA*5.2*68 PATCH ENVIRONMENT CHECK ROUTINE ;July 28, 2008
"RTN","LA68",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**68**;Sep 27, 1994;Build 56
"RTN","LA68",3,0)
 ;
"RTN","LA68",4,0)
 ; Reference to PROTOCOL file (#101) supported by ICR #872
"RTN","LA68",5,0)
 ;
"RTN","LA68",6,0)
EN ; Does not prevent loading of the transport global.
"RTN","LA68",7,0)
 ; Environment check is done only during the install.
"RTN","LA68",8,0)
 ; 
"RTN","LA68",9,0)
 N XQA,XQAMSG
"RTN","LA68",10,0)
 ;
"RTN","LA68",11,0)
 I '$G(XPDENV) D  Q
"RTN","LA68",12,0)
 . S XQAMSG="Transport global for patch "_$G(XPDNM,"Unknown patch")_" loaded on "_$$HTE^XLFDT($H),XQA("G.LMI")=""
"RTN","LA68",13,0)
 . D SETUP^XQALERT
"RTN","LA68",14,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Sending transport global loaded alert to mail group G.LMI",80))
"RTN","LA68",15,0)
 ;
"RTN","LA68",16,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" started on "_$$HTE^XLFDT($H)
"RTN","LA68",17,0)
 S XQA("G.LMI")=""
"RTN","LA68",18,0)
 D SETUP^XQALERT
"RTN","LA68",19,0)
 ;
"RTN","LA68",20,0)
 D CHECK
"RTN","LA68",21,0)
 D EXIT
"RTN","LA68",22,0)
 Q
"RTN","LA68",23,0)
 ;
"RTN","LA68",24,0)
 ;
"RTN","LA68",25,0)
CHECK ; Perform environment check
"RTN","LA68",26,0)
 I $S('$G(IOM):1,'$G(IOSL):1,$G(U)'="^":1,1:0) D  Q
"RTN","LA68",27,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Terminal Device is not defined",80))
"RTN","LA68",28,0)
 . S XPDQUIT=2
"RTN","LA68",29,0)
 ;
"RTN","LA68",30,0)
 I $S('$G(DUZ):1,$D(DUZ)[0:1,$D(DUZ(0))[0:1,1:0) D  Q
"RTN","LA68",31,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Please log in to set local DUZ... variables",80))
"RTN","LA68",32,0)
 . S XPDQUIT=2
"RTN","LA68",33,0)
 ;
"RTN","LA68",34,0)
 I $P($$ACTIVE^XUSER(DUZ),"^")'=1 D  Q
"RTN","LA68",35,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("You are not a valid user on this system",80))
"RTN","LA68",36,0)
 . S XPDQUIT=2
"RTN","LA68",37,0)
 ;
"RTN","LA68",38,0)
 Q
"RTN","LA68",39,0)
 ;
"RTN","LA68",40,0)
 ;
"RTN","LA68",41,0)
EXIT ;
"RTN","LA68",42,0)
 I $G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Install Environment Check FAILED ---",80))
"RTN","LA68",43,0)
 I '$G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Environment Check is Ok ---",80))
"RTN","LA68",44,0)
 Q
"RTN","LA68",45,0)
 ;
"RTN","LA68",46,0)
 ;
"RTN","LA68",47,0)
 ;
"RTN","LA68",48,0)
PRE ; KIDS Pre install for LA*5.2*68
"RTN","LA68",49,0)
 ;
"RTN","LA68",50,0)
 ; Save status of existing LA7HDR interface in #62.48 and #101
"RTN","LA68",51,0)
 S LA7HDR=$O(^LAHM(62.48,"B","LA7HDR",0))
"RTN","LA68",52,0)
 I LA7HDR S LA7HDR(0)=$G(^LAHM(62.48,LA7HDR,0))
"RTN","LA68",53,0)
 ;
"RTN","LA68",54,0)
 S LA7101=$O(^ORD(101,"B","LA7 LAB RESULTS TO HDR (SUB)",0))
"RTN","LA68",55,0)
 I LA7101 S LA7101(774)=$$GET1^DIQ(101,LA7101_",",774)
"RTN","LA68",56,0)
 ;
"RTN","LA68",57,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install started alert to mail group G.LMI",80))
"RTN","LA68",58,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install started ***",80))
"RTN","LA68",59,0)
 D BMES^XPDUTL($$CJ^XLFSTR("--- No action required---",80))
"RTN","LA68",60,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install completed ***",80))
"RTN","LA68",61,0)
 ;
"RTN","LA68",62,0)
 Q
"RTN","LA68",63,0)
 ;
"RTN","LA68",64,0)
 ;
"RTN","LA68",65,0)
POST ; KIDS Post install for LA*5.2*68
"RTN","LA68",66,0)
 N DA,DIC,DIK,DLAYGO,LA7200,LA7DIE,LA7FAC,LA7FDA,LA7UPD,LA7X,LA7Y,X,Y,XQA,XQAMSG
"RTN","LA68",67,0)
 ;
"RTN","LA68",68,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install started ***",80))
"RTN","LA68",69,0)
 ;
"RTN","LA68",70,0)
 ; Update flag.
"RTN","LA68",71,0)
 S LA7UPD=0
"RTN","LA68",72,0)
 ;
"RTN","LA68",73,0)
 ; Restore status of LA7HDR entry in #62.48 if pre-existing and active.
"RTN","LA68",74,0)
 I LA7HDR,$P($G(LA7HDR(0)),"^",3)=1 S $P(^LAHM(62.48,LA7HDR,0),"^",3)=1
"RTN","LA68",75,0)
 ;
"RTN","LA68",76,0)
 ; Restore status of Lab HDR subscriber protocol entry in #101 if pre-existing and active.
"RTN","LA68",77,0)
 I LA7101,$G(LA7101(774))'="",$E(LA7101(774),1)'=";" D
"RTN","LA68",78,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("*** Restoring protocol LA7 LAB RESULTS TO HDR (SUB) Routing Logic field (#774) ***",80))
"RTN","LA68",79,0)
 . S LA7FDA(1,101,LA7101_",",774)=LA7101(774)
"RTN","LA68",80,0)
 . D FILE^DIE("","LA7FDA(1)","LA7DIE(1)")
"RTN","LA68",81,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("*** Protocol restore completed ***",80))
"RTN","LA68",82,0)
 . S LA7UPD=1
"RTN","LA68",83,0)
 ;
"RTN","LA68",84,0)
 ; Removing facility station number in FACILITY NAME field in file #771.
"RTN","LA68",85,0)
 S LA7FAC=$$FIND1^DIC(771,"","OX","LA7LAB","B","")
"RTN","LA68",86,0)
 I LA7FAC>0 D
"RTN","LA68",87,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("*** Clearing facility name for LA7LAB entry in file #771 ***",80))
"RTN","LA68",88,0)
 . S LA7FDA(2,771,LA7FAC_",",3)="@"
"RTN","LA68",89,0)
 . D FILE^DIE("","LA7FDA(2)","LA7DIE(2)")
"RTN","LA68",90,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("*** Clearing facility name completed ***",80))
"RTN","LA68",91,0)
 . S LA7UPD=1
"RTN","LA68",92,0)
 ;
"RTN","LA68",93,0)
 I LA7UPD=0 D BMES^XPDUTL($$CJ^XLFSTR("--- No actions required for post install ---",80))
"RTN","LA68",94,0)
 ;
"RTN","LA68",95,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install completed ***",80))
"RTN","LA68",96,0)
 ;
"RTN","LA68",97,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install completion alert to mail group G.LMI",80))
"RTN","LA68",98,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" completed on "_$$HTE^XLFDT($H)
"RTN","LA68",99,0)
 S XQA("G.LMI")=""
"RTN","LA68",100,0)
 D SETUP^XQALERT
"RTN","LA68",101,0)
 ;
"RTN","LA68",102,0)
 K LA7101,LA7HDR
"RTN","LA68",103,0)
 Q
"RTN","LA7HDR")
0^1^B39353571^n/a
"RTN","LA7HDR",1,0)
LA7HDR ;DALOI/JMC - LAB HDR ORU (Observation Result) message builder ;12/08/09  16:39
"RTN","LA7HDR",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**68**;Sep 27, 1994;Build 56
"RTN","LA7HDR",3,0)
 ;
"RTN","LA7HDR",4,0)
 ; Reference to variable DIQUIET supported by DBIA #2098
"RTN","LA7HDR",5,0)
 ;
"RTN","LA7HDR",6,0)
 Q
"RTN","LA7HDR",7,0)
 ;
"RTN","LA7HDR",8,0)
 ;
"RTN","LA7HDR",9,0)
QUEUE ;
"RTN","LA7HDR",10,0)
 ; Called by protocol LA7 LAB RESULTS ACTION
"RTN","LA7HDR",11,0)
 ; and below (APQ) for AP subscripts
"RTN","LA7HDR",12,0)
 ; Call with:
"RTN","LA7HDR",13,0)
 ;  LRAA   - accession area (CH,MI subscript)
"RTN","LA7HDR",14,0)
 ;  LRAD   - accession date (CH,MI subscript)
"RTN","LA7HDR",15,0)
 ;  LRAN   - accession number (CH,MI subscript)
"RTN","LA7HDR",16,0)
 ;  LRIDT  - inverse date/time (collection date/time)
"RTN","LA7HDR",17,0)
 ;  LRSS   - test subscript defined in LABORATORY TEST file (#60)
"RTN","LA7HDR",18,0)
 ;  LRDFN  - IEN in LAB DATA file (#63)
"RTN","LA7HDR",19,0)
 ;  LRSPEC - specimen 
"RTN","LA7HDR",20,0)
 ;  LRSB (Optional) - array of Chemistry results
"RTN","LA7HDR",21,0)
 ;                      ex. glucose LRSB(2)=LR NODE
"RTN","LA7HDR",22,0)
 ;
"RTN","LA7HDR",23,0)
 N I,LA76248,LA7V,LA7VCH,LASTYP,LAVERR,X,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","LA7HDR",24,0)
 ;
"RTN","LA7HDR",25,0)
 ; If no accession area then quit - not much we can do.
"RTN","LA7HDR",26,0)
 I $G(LRAA)="" Q
"RTN","LA7HDR",27,0)
 ;
"RTN","LA7HDR",28,0)
 ; If LRSS not defined then set from file #68
"RTN","LA7HDR",29,0)
 I $G(LRSS)="" N LRSS S LRSS=$P($G(^LRO(68,LRAA,0)),"^",2)
"RTN","LA7HDR",30,0)
 ;
"RTN","LA7HDR",31,0)
 ; Not supporting AU and BB at this time (or if LRSS is null).
"RTN","LA7HDR",32,0)
 I "AUBB"[LRSS Q
"RTN","LA7HDR",33,0)
 ;
"RTN","LA7HDR",34,0)
 ; Check if CPRS has called us more than once for this accession.
"RTN","LA7HDR",35,0)
 ; Results are processed on first call.
"RTN","LA7HDR",36,0)
 I $D(LRTMPO("LRIFN")),$G(LRNIFN)>1 Q
"RTN","LA7HDR",37,0)
 I LRSS="MI",$D(LRTMPO("LRIFN")),$G(^TMP("LA7HDR",$J))=(LRAA_"^"_LRAD_"^"_LRAN) K ^TMP("LA7HDR",$J) Q
"RTN","LA7HDR",38,0)
 ;
"RTN","LA7HDR",39,0)
 ; Quit if test patient on a production account.
"RTN","LA7HDR",40,0)
 I $$TESTPAT^VADPT($P($G(^LR(LRDFN,0)),"^",3)),$$PROD^XUPROD(0) Q
"RTN","LA7HDR",41,0)
 ;
"RTN","LA7HDR",42,0)
 ; Check for configuration LA7HDR in 62.48 to see if turned on and site wants subscribers to receive HL7 messages for this event.
"RTN","LA7HDR",43,0)
 ; Task HL7 message building and transmission.
"RTN","LA7HDR",44,0)
 ; HDR-IMS will be using HL7 messaging, no call to VDEF API.
"RTN","LA7HDR",45,0)
 S LA76248=$O(^LAHM(62.48,"B","LA7HDR",0))
"RTN","LA7HDR",46,0)
 I 'LA76248 Q
"RTN","LA7HDR",47,0)
 I '$P(^LAHM(62.48,LA76248,0),"^",3) Q  ; not active
"RTN","LA7HDR",48,0)
 ;
"RTN","LA7HDR",49,0)
 S ZTRTN="BUILD^LA7HDR",ZTDTH=$H,ZTIO="",ZTDESC="Tasked Lab HL7 HDR ORU Build"
"RTN","LA7HDR",50,0)
 F I="LRAA","LRAD","LRAN","LRIDT","LRSS","LRDFN" S ZTSAVE(I)=""
"RTN","LA7HDR",51,0)
 I LRSS="CH" D
"RTN","LA7HDR",52,0)
 . S LA7V=0
"RTN","LA7HDR",53,0)
 . F  S LA7V=$O(LRSB(LA7V)) Q:'LA7V  D
"RTN","LA7HDR",54,0)
 . . I $P(LRSB(LA7V),"^")="" Q
"RTN","LA7HDR",55,0)
 . . S LA7VCH(LA7V)=LRSB(LA7V)
"RTN","LA7HDR",56,0)
 . . I $D(LRSA(LA7V,2)) S LA7VCH(LA7V,1)="C"
"RTN","LA7HDR",57,0)
 . S ZTSAVE("LA7VCH*")="",ZTSAVE("LRSPEC")=""
"RTN","LA7HDR",58,0)
 I LRSS="CH",'$D(LA7VCH) Q
"RTN","LA7HDR",59,0)
 S ZTSAVE=("LA7MTYP")="ORU"
"RTN","LA7HDR",60,0)
 D ^%ZTLOAD
"RTN","LA7HDR",61,0)
 I $G(ZTSK)'>0 Q
"RTN","LA7HDR",62,0)
 ;
"RTN","LA7HDR",63,0)
 ; Set flag to handle CPRS calling us multiple times during verifying session for each ordered test.
"RTN","LA7HDR",64,0)
 S ^TMP("LA7HDR",$J)=LRAA_"^"_LRAD_"^"_LRAN
"RTN","LA7HDR",65,0)
 ;
"RTN","LA7HDR",66,0)
 Q
"RTN","LA7HDR",67,0)
 ;
"RTN","LA7HDR",68,0)
 ;
"RTN","LA7HDR",69,0)
APQ(LRDFN,LRSS,LRIDT) ; Anatomic Pathology (CY,EM,SP) subscript entry point from FileMan cross-reference on specific fields.
"RTN","LA7HDR",70,0)
 ; Called by field #.11 in sub-files #63.02, 63.08, 63.09 - AP does not work through CPRS extended action protocols
"RTN","LA7HDR",71,0)
 ;
"RTN","LA7HDR",72,0)
 ; Only send file #2 patients to HDR
"RTN","LA7HDR",73,0)
 I $P($G(^LR(LRDFN,0)),"^",2)'=2 Q
"RTN","LA7HDR",74,0)
 ;
"RTN","LA7HDR",75,0)
 D QUEUE
"RTN","LA7HDR",76,0)
 Q
"RTN","LA7HDR",77,0)
 ;
"RTN","LA7HDR",78,0)
 ;
"RTN","LA7HDR",79,0)
BUILD ; Tasked entry point to build HL7 message to VA's HDR
"RTN","LA7HDR",80,0)
 ; Tasked from above.
"RTN","LA7HDR",81,0)
 ;
"RTN","LA7HDR",82,0)
 N DIQUIET,FDA,GBL,HL,HLQ,RUID,SITE
"RTN","LA7HDR",83,0)
 N LA76248,LA76249,LA76249P,LA7DT,LA7ERR,LA7EVNT,LA7ID,LA7INTYP,LA7LNCVR,LA7LOAD,LA7NOMSG,LA7NVAF,LA7RSITE,LA7X,LA7Y,LRQUIET,LRUID
"RTN","LA7HDR",84,0)
 ;
"RTN","LA7HDR",85,0)
 ; Prevent FileMan from issuing any unwanted WRITE(s).
"RTN","LA7HDR",86,0)
 S (DIQUIET,LRQUIET)=1
"RTN","LA7HDR",87,0)
 ; Insure DILOCKTM is defined
"RTN","LA7HDR",88,0)
 D DT^DICRW
"RTN","LA7HDR",89,0)
 ;
"RTN","LA7HDR",90,0)
 ; Lock record while building message.
"RTN","LA7HDR",91,0)
 F  L +^LR(LRDFN,LRSS,LRIDT,0):DILOCKTM Q:$T  H 5
"RTN","LA7HDR",92,0)
 ;
"RTN","LA7HDR",93,0)
 S (LA7ERR,LA7NVAF)=0,LA7EVNT="LA7 LAB RESULTS AVAILABLE (EVN)"
"RTN","LA7HDR",94,0)
 ; Create 62.49 entry but don't store message text.
"RTN","LA7HDR",95,0)
 S LA7NOMSG=2
"RTN","LA7HDR",96,0)
 ;
"RTN","LA7HDR",97,0)
 I $G(LA7MTYP)="" S LA7MTYP="ORU"
"RTN","LA7HDR",98,0)
 ;
"RTN","LA7HDR",99,0)
 S LA7X=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3))
"RTN","LA7HDR",100,0)
 S LRUID=$P(LA7X,"^"),RUID=$P(LA7X,"^",5)
"RTN","LA7HDR",101,0)
 I LRUID="" S LRUID=$$LRUID^LRX(LRAA,LRAD,LRAN)
"RTN","LA7HDR",102,0)
 ;
"RTN","LA7HDR",103,0)
 S (LA7RSITE,SITE)="LA7HDR",LA7ID=LA7RSITE_"-O-",LA76248=$O(^LAHM(62.48,"B",LA7RSITE,0))
"RTN","LA7HDR",104,0)
 ; No entry in 62.48 - *** Need to add error logging ****
"RTN","LA7HDR",105,0)
 I 'LA76248 Q
"RTN","LA7HDR",106,0)
 I '$P(^LAHM(62.48,LA76248,0),"^",3) Q  ; not active
"RTN","LA7HDR",107,0)
 S LA7INTYP=+$P(^LAHM(62.48,LA76248,0),"^",9)
"RTN","LA7HDR",108,0)
 ;
"RTN","LA7HDR",109,0)
 ; Determine if patient needs to have initial load sent to HDR.
"RTN","LA7HDR",110,0)
 ; *** need to establish location of HDR flag in 63***
"RTN","LA7HDR",111,0)
 S LA7LOAD=0
"RTN","LA7HDR",112,0)
 ;
"RTN","LA7HDR",113,0)
 ; Create new outgoing entry in 62.49
"RTN","LA7HDR",114,0)
 S (LA76249,LA76249P)=$$INIT6249^LA7VHLU
"RTN","LA7HDR",115,0)
 I LA76249<1 D  Q
"RTN","LA7HDR",116,0)
 . ; Log entry creation error
"RTN","LA7HDR",117,0)
 ;
"RTN","LA7HDR",118,0)
 K ^TMP("LA7-QRY",$J)
"RTN","LA7HDR",119,0)
 ;
"RTN","LA7HDR",120,0)
 ; Check "CH" test results for ordered tests.
"RTN","LA7HDR",121,0)
 ; Per Change Control Board decision to perform lab test's result aggregation on VistA -
"RTN","LA7HDR",122,0)
 ;   - besides test verified during this session include all other test results stored with this specimen.
"RTN","LA7HDR",123,0)
 I LRSS="CH" D
"RTN","LA7HDR",124,0)
 . N FDA,FDAIEN,LA7ER,LA7VT,LRSB
"RTN","LA7HDR",125,0)
 . S LA7Y=1
"RTN","LA7HDR",126,0)
 . F  S LA7Y=$O(^LR(LRDFN,LRSS,LRIDT,LA7Y)) Q:'LA7Y  D
"RTN","LA7HDR",127,0)
 . . I '$D(LA7VCH(LA7Y)) S LA7VCH(LA7Y)=^LR(LRDFN,LRSS,LRIDT,LA7Y)
"RTN","LA7HDR",128,0)
 . . I $P(LA7VCH(LA7Y),"^")="" Q
"RTN","LA7HDR",129,0)
 . . S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LA7Y,$P(LA7VCH(LA7Y),"^",3),LRSPEC)
"RTN","LA7HDR",130,0)
 . . S LRSB=LA7Y S:$G(LA7VCH(LA7Y,1))="C" $P(LRSB,"^",2)="C"
"RTN","LA7HDR",131,0)
 . . D STORE^LA7QRY2
"RTN","LA7HDR",132,0)
 . . K FDA,FDAIEN,LA7ER
"RTN","LA7HDR",133,0)
 . . S FDA(2,62.49162,"+2,"_LA76249_",",.01)=LRSB
"RTN","LA7HDR",134,0)
 . . I $G(LA7VCH(LA7Y,1))="C" S FDA(2,62.49162,"+2,"_LA76249_",",.02)="C"
"RTN","LA7HDR",135,0)
 . . S FDAIEN(1)=LA76249
"RTN","LA7HDR",136,0)
 . . D UPDATE^DIE("","FDA(2)","FDAIEN","LA7ER(2)")
"RTN","LA7HDR",137,0)
 . . D CLEAN^DILF
"RTN","LA7HDR",138,0)
 ;
"RTN","LA7HDR",139,0)
 I "CYEMSP"[LRSS D
"RTN","LA7HDR",140,0)
 . S LRSB=.012,LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,"","")
"RTN","LA7HDR",141,0)
 . D STORE^LA7QRY2
"RTN","LA7HDR",142,0)
 ;
"RTN","LA7HDR",143,0)
 I LRSS="MI" D
"RTN","LA7HDR",144,0)
 . S LRSPEC=$P(^LR(LRDFN,LRSS,LRIDT,0),"^",5)
"RTN","LA7HDR",145,0)
 . S LA7ND=0
"RTN","LA7HDR",146,0)
 . F LA7ND=1,5,8,11,16 I $D(^LR(LRDFN,LRSS,LRIDT,LA7ND)) D
"RTN","LA7HDR",147,0)
 . . I $P(^LR(LRDFN,LRSS,LRIDT,LA7ND),"^",2)="" Q  ; If no status -  skip
"RTN","LA7HDR",148,0)
 . . I $D(^TMP("LA7-QRY",$J,LRDFN,LRIDT,LRSS)) Q  ; Already marked this report to send
"RTN","LA7HDR",149,0)
 . . S LRSB=$S(LA7ND=1:11,LA7ND=5:14,LA7ND=8:18,LA7ND=11:22,LA7ND=16:33,1:11)
"RTN","LA7HDR",150,0)
 . . S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,"",LRSPEC)
"RTN","LA7HDR",151,0)
 . . D STORE^LA7QRY2
"RTN","LA7HDR",152,0)
 ;
"RTN","LA7HDR",153,0)
 S GBL="^TMP(""HLS"","_$J_")"
"RTN","LA7HDR",154,0)
 D STARTMSG^LA7VHLU(LA7EVNT,.LA76249,LA7NOMSG)
"RTN","LA7HDR",155,0)
 I $G(HL) S LA7ERR=$TR(HL,"^","-")
"RTN","LA7HDR",156,0)
 S (HLQ,HL("Q"))=""
"RTN","LA7HDR",157,0)
 D CHKACC^LA7VMSG
"RTN","LA7HDR",158,0)
 I 'LA7ERR D
"RTN","LA7HDR",159,0)
 . I LA7LOAD D
"RTN","LA7HDR",160,0)
 . . N LA7EDT,LA7SC,LA7SDT,LA7SPEC,LRIDT,LRSS,LRUID
"RTN","LA7HDR",161,0)
 . . S (LA7SC,LA7SPEC)="*",LA7SDT=$$FMADD^XLFDT(DT,-730,0,0,0),LA7EDT=DT
"RTN","LA7HDR",162,0)
 . . D BCD^LA7QRY2
"RTN","LA7HDR",163,0)
 . D BUILDMSG^LA7QRY1
"RTN","LA7HDR",164,0)
 . D SENDMSG^LA7VMSG1
"RTN","LA7HDR",165,0)
 S LA7ID=LA7RSITE_"-O-"_LRUID
"RTN","LA7HDR",166,0)
 D UPDT6249^LA7VORM1
"RTN","LA7HDR",167,0)
 ; File additional data
"RTN","LA7HDR",168,0)
 S FDA(1,62.49,LA76249_",",151)=LRUID
"RTN","LA7HDR",169,0)
 S FDA(1,62.49,LA76249_",",156)=LRIDT
"RTN","LA7HDR",170,0)
 S FDA(1,62.49,LA76249_",",157)=LRSS
"RTN","LA7HDR",171,0)
 S FDA(1,62.49,LA76249_",",158)=LRDFN
"RTN","LA7HDR",172,0)
 D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7HDR",173,0)
 D CLEAN^DILF
"RTN","LA7HDR",174,0)
 ;
"RTN","LA7HDR",175,0)
 ; Release locks on entries.
"RTN","LA7HDR",176,0)
 L -^LAHM(62.49,LA76249)
"RTN","LA7HDR",177,0)
 L -^LR(LRDFN,LRSS,LRIDT)
"RTN","LA7HDR",178,0)
 ;
"RTN","LA7HDR",179,0)
 ; Cleanup
"RTN","LA7HDR",180,0)
 K LA7ND,LRUID,LRNLT,LRIDT,LRSS,LRDFN,LA7VCH,LA7MTYP
"RTN","LA7HDR",181,0)
 D EXIT^LA7HDR1
"RTN","LA7HDR",182,0)
 Q
"RTN","LA7HDR",183,0)
 ;
"RTN","LA7HDR",184,0)
 ;
"RTN","LA7HDR",185,0)
RTR(LA7SS) ;
"RTN","LA7HDR",186,0)
 ; Call with LA7SS = list of subscripts that HDR wants separated by ";"
"RTN","LA7HDR",187,0)
 ;                   (LA7SS="CH;MI;EM")
"RTN","LA7HDR",188,0)
 ;
"RTN","LA7HDR",189,0)
 ; Setup link and subscriber array for HL7 HDR message generation
"RTN","LA7HDR",190,0)
 ; Determine if HDR wants to receive lab results for this subscript
"RTN","LA7HDR",191,0)
 ; Called by subscriber router protocol LA7 LAB RESULTS TO HDR (SUB)
"RTN","LA7HDR",192,0)
 ; Check outgoing message and find OBR segment to determine Laboratory
"RTN","LA7HDR",193,0)
 ;  subscript this result is associated with and if it's contained in
"RTN","LA7HDR",194,0)
 ;  the LA7SS subscript list.
"RTN","LA7HDR",195,0)
 ; 
"RTN","LA7HDR",196,0)
 N LA7I,LA7SEG,LA7VI,LA7VJ,LA7X,LRSS,LRX
"RTN","LA7HDR",197,0)
 ; 
"RTN","LA7HDR",198,0)
 S LRSS=""
"RTN","LA7HDR",199,0)
 F LA7VI=1:1 X HLNEXT Q:HLQUIT'>0  D  Q:LRSS'=""
"RTN","LA7HDR",200,0)
 . I $E(HLNODE,1,3)'="OBR" Q
"RTN","LA7HDR",201,0)
 . S LA7SEG(0)=HLNODE
"RTN","LA7HDR",202,0)
 . S LA7VJ=0
"RTN","LA7HDR",203,0)
 . F  S LA7VJ=$O(HLNODE(LA7VJ)) Q:'LA7VJ  S LA7SEG(LA7VJ)=HLNODE(LA7VJ)
"RTN","LA7HDR",204,0)
 . S LRX=$$P^LA7VHLU(.LA7SEG,21,HL("FS")),LRX=$$UNESC^LA7VHLU3(LRX,HL("FS")_HL("ECH"))
"RTN","LA7HDR",205,0)
 . S LRSS=$P(LRX,"^",2)
"RTN","LA7HDR",206,0)
 ;
"RTN","LA7HDR",207,0)
 F LA7I=1:1 S LA7X=$P(LA7SS,";",LA7I) Q:LA7X=""  D  Q:LA7X=""
"RTN","LA7HDR",208,0)
 . I LA7X=LRSS S HLL("LINKS",1)="LA7 LAB RESULTS TO HDR (SUB)^VDEFVIE4",LA7X=""
"RTN","LA7HDR",209,0)
 Q
"RTN","LA7HDR",210,0)
 ;
"RTN","LA7HDR",211,0)
 ;
"RTN","LA7HDR",212,0)
HDRLOAD(LA7SDT,LA7EDT,LA7LIMIT,LA7EVENT) ; Load patient's historical lab results to HDR (Health Data Repository).
"RTN","LA7HDR",213,0)
 ; Call with LA7SDT = start date of data extraction in FileMan format
"RTN","LA7HDR",214,0)
 ;           LA7EDT = end date of data extraction in FileMan format
"RTN","LA7HDR",215,0)
 ;         LA7LIMIT = # of messages to create this session (default =1000)
"RTN","LA7HDR",216,0)
 ;         LA7EVENT = name of HL7 event protocol to transmit messages
"RTN","LA7HDR",217,0)
 ;
"RTN","LA7HDR",218,0)
 D HDRLOAD^LA7HDR1
"RTN","LA7HDR",219,0)
 Q
"RTN","LA7HDR",220,0)
 ;
"RTN","LA7HDR",221,0)
 ;
"RTN","LA7HDR",222,0)
RECOVER ; Recover failed transmissions or message building
"RTN","LA7HDR",223,0)
 ; Called by option Recover/Transmit Lab HDR Result Messages [LA7 HDR RECOVER]
"RTN","LA7HDR",224,0)
 ;
"RTN","LA7HDR",225,0)
 D RECOVER^LA7HDR1
"RTN","LA7HDR",226,0)
 Q
"RTN","LA7HDR1")
0^13^B37911850^n/a
"RTN","LA7HDR1",1,0)
LA7HDR1 ;DALOI/JMC - LAB HDR ORU (Observation Result) message builder (cont'd) ;July 28, 2008
"RTN","LA7HDR1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**68**;Sep 27, 1994;Build 56
"RTN","LA7HDR1",3,0)
 ;
"RTN","LA7HDR1",4,0)
 ; Reference to variable DIQUIET supported by DBIA #2098
"RTN","LA7HDR1",5,0)
 ;
"RTN","LA7HDR1",6,0)
 Q
"RTN","LA7HDR1",7,0)
 ;
"RTN","LA7HDR1",8,0)
 ;
"RTN","LA7HDR1",9,0)
HDRLOAD ; Load patient's historical lab results to HDR (Health Data Repository).
"RTN","LA7HDR1",10,0)
 ; Called from tasked option LA7TASK HDR LOAD
"RTN","LA7HDR1",11,0)
 N DIQUIET,GBL
"RTN","LA7HDR1",12,0)
 N LA7101,LA761,LA76248,LA76249,LA76249P
"RTN","LA7HDR1",13,0)
 N LA7CODE,LA7CNT,LA7DT,LA7ECH,LA7ERR,LA7FS,LA7ID,LA7INTYP,LA7MID,LA7MTYP,LA7NOMSG,LA7NTESN,LA7NVAF,LA7OBRSN,LA7OBXSN,LA7PIDSN,LA7RSITE,LA7QUIT,LA7SC,LA7SPEC
"RTN","LA7HDR1",14,0)
 N LRDFN,LRIDT,LRSS,LRSSLST,LRUID,SITE
"RTN","LA7HDR1",15,0)
 ;
"RTN","LA7HDR1",16,0)
 ; Prevent FileMan from issuing any unwanted WRITE(s).
"RTN","LA7HDR1",17,0)
 S DIQUIET=1,DT=$$DT^XLFDT
"RTN","LA7HDR1",18,0)
 ;
"RTN","LA7HDR1",19,0)
 ; Find entry in #62.48 and check if it's active.
"RTN","LA7HDR1",20,0)
 S (LA7RSITE,SITE)="LA7HDR",LA76248=$O(^LAHM(62.48,"B",LA7RSITE,0))
"RTN","LA7HDR1",21,0)
 ; No entry in 62.48 - *** Need to add error logging ****
"RTN","LA7HDR1",22,0)
 I 'LA76248 Q
"RTN","LA7HDR1",23,0)
 I '$P(^LAHM(62.48,LA76248,0),"^",3) Q  ; not active
"RTN","LA7HDR1",24,0)
 S LA7INTYP=+$P(^LAHM(62.48,LA76248,0),"^",9)
"RTN","LA7HDR1",25,0)
 ;
"RTN","LA7HDR1",26,0)
 S (LA7CNT,LA7CNT(1),LA7ERR,LA7NVAF,LA7QUIT)=0,LA7MTYP="ORU",LA7NOMSG=2
"RTN","LA7HDR1",27,0)
 I LA7EVENT="" S LA7EVNT="LA7 LAB RESULTS AVAILABLE (EVN)"
"RTN","LA7HDR1",28,0)
 ; Setup search and subscript list
"RTN","LA7HDR1",29,0)
 S (LA7SC,LA7SPEC)="*"
"RTN","LA7HDR1",30,0)
 D SCLIST^LA7QRY2(LA7SC,.LRSSLST)
"RTN","LA7HDR1",31,0)
 ; Check start/end dates
"RTN","LA7HDR1",32,0)
 I '$G(LA7SDT) S LA7SDT=$$FMADD^XLFDT(DT,-730,0,0,0)
"RTN","LA7HDR1",33,0)
 I '$G(LA7EDT) S LA7EDT=DT
"RTN","LA7HDR1",34,0)
 I LA7SDT>LA7EDT S X=LA7SDT,LA7SDT=LA7EDT,LA7EDT=X
"RTN","LA7HDR1",35,0)
 ;
"RTN","LA7HDR1",36,0)
 S GBL="^TMP(""HLS"","_$J_")"
"RTN","LA7HDR1",37,0)
 ; Limit number of messages built this session.
"RTN","LA7HDR1",38,0)
 S LA7LIMIT=$G(LA7LIMIT,1000)
"RTN","LA7HDR1",39,0)
 ;
"RTN","LA7HDR1",40,0)
 I $D(^XTMP("LA7HDR","LRDFN")) S LRDFN=$P(^XTMP("LA7HDR","LRDFN"),"^")
"RTN","LA7HDR1",41,0)
 E  S LRDFN=0
"RTN","LA7HDR1",42,0)
 I LRDFN'=+LRDFN Q
"RTN","LA7HDR1",43,0)
 F  S LRDFN=$O(^LR(LRDFN)) Q:'LRDFN  D  Q:LA7QUIT
"RTN","LA7HDR1",44,0)
 . I $$S^%ZTLOAD("Processing LRDFN "_LRDFN_" for HDR Historical") S (LA7QUIT,ZTSTOP)=1,LRDFN=LRDFN-1 Q
"RTN","LA7HDR1",45,0)
 . S LA7CNT(1)=LA7CNT(1)+1
"RTN","LA7HDR1",46,0)
 . I '(LA7CNT(1)#100) H 1 ; take a "rest" - allow OS to swap out process
"RTN","LA7HDR1",47,0)
 . S X=^LR(LRDFN,0) Q:$P(X,"^",2)'=2
"RTN","LA7HDR1",48,0)
 . S DFN=$P(X,"^",3),LA7ID=SITE_"-O-"_$$GET1^DIQ(2,DFN_",",.01)
"RTN","LA7HDR1",49,0)
 . K ^TMP("LA7-QRY",$J),^TMP("LA7VS",$J)
"RTN","LA7HDR1",50,0)
 . D BCD^LA7QRY2 S LA7QUIT=0 Q:'$D(^TMP("LA7-QRY",$J))
"RTN","LA7HDR1",51,0)
 . S LA76249=$$INIT6249^LA7VHLU,^TMP("LA7VS",$J,LA76249)=LA76249
"RTN","LA7HDR1",52,0)
 . D INITHL^LA7VHLU(LA7EVNT)
"RTN","LA7HDR1",53,0)
 . I $G(HL) S LA7QUIT=1,LRDFN=LRDFN-1 Q
"RTN","LA7HDR1",54,0)
 . D BUILDMSG^LA7QRY1,GEN^LA7VHLU,UPDT6249^LA7VORM1
"RTN","LA7HDR1",55,0)
 . S LA7CNT=LA7CNT+1,LA7QUIT=$S(LA7CNT<LA7LIMIT:0,1:1)
"RTN","LA7HDR1",56,0)
 ;
"RTN","LA7HDR1",57,0)
 ; Update XTMP entry, save last LRDFN processed for next session.
"RTN","LA7HDR1",58,0)
 S ^XTMP("LA7HDR",0)=$$FMADD^XLFDT(DT,90,0,0,0)_"^"_DT_"^Lab historical results feed to HDR"
"RTN","LA7HDR1",59,0)
 S ^XTMP("LA7HDR","LRDFN")=LRDFN
"RTN","LA7HDR1",60,0)
 ;
"RTN","LA7HDR1",61,0)
 D EXIT
"RTN","LA7HDR1",62,0)
 Q
"RTN","LA7HDR1",63,0)
 ;
"RTN","LA7HDR1",64,0)
 ;
"RTN","LA7HDR1",65,0)
RECOVER ; Recover failed transmissions or message building
"RTN","LA7HDR1",66,0)
 ;
"RTN","LA7HDR1",67,0)
 N DIR,DIRUT,DTOUT,DUOUT,FIRST,LA76248,LA7CNT,LA7PROD,LA7QUIT,LA7TYPE,LA7UID,LA7X,LA7Y,LAST,LRAA,LRACC,LRAD,LRAN,LRDFN,LREXMPT,LRIDT,LRSPEC,LRSS,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","LA7HDR1",68,0)
 S (LA7CNT,LA7QUIT)=0
"RTN","LA7HDR1",69,0)
 ;
"RTN","LA7HDR1",70,0)
 S LA76248=$O(^LAHM(62.48,"B","LA7HDR",0))
"RTN","LA7HDR1",71,0)
 I 'LA76248 W !,"No entry LA7HDR in file #62.48" Q
"RTN","LA7HDR1",72,0)
 I '$P(^LAHM(62.48,LA76248,0),"^",3) D  Q
"RTN","LA7HDR1",73,0)
 . S DIR(0)="EA"
"RTN","LA7HDR1",74,0)
 . S DIR("A")="Enter RETURN to continue:"
"RTN","LA7HDR1",75,0)
 . S DIR("A",1)="Entry LA7HDR is not active in file #62.48"
"RTN","LA7HDR1",76,0)
 . D ^DIR
"RTN","LA7HDR1",77,0)
 ;
"RTN","LA7HDR1",78,0)
 S LA7PROD=$$PROD^XUPROD(0)
"RTN","LA7HDR1",79,0)
 ;
"RTN","LA7HDR1",80,0)
 S DIR(0)="SO^1:Range of Accessions;2:Selected Accessions"
"RTN","LA7HDR1",81,0)
 S DIR("A")="Selection Method",DIR("B")=1
"RTN","LA7HDR1",82,0)
 D ^DIR
"RTN","LA7HDR1",83,0)
 I $D(DIRUT) Q
"RTN","LA7HDR1",84,0)
 S LA7TYPE=+Y
"RTN","LA7HDR1",85,0)
 ;
"RTN","LA7HDR1",86,0)
 ; Get list of accession numbers, set flags used by LRWU4.
"RTN","LA7HDR1",87,0)
 S LRACC=1,LREXMPT=1
"RTN","LA7HDR1",88,0)
 I LA7TYPE=1 D
"RTN","LA7HDR1",89,0)
 . D ^LRWU4
"RTN","LA7HDR1",90,0)
 . I LRAN<1 S LA7QUIT=1 Q
"RTN","LA7HDR1",91,0)
 . S FIRST=LRAN,X=$O(^LRO(68,LRAA,1,LRAD,1,":"),-1)
"RTN","LA7HDR1",92,0)
 . S DIR(0)="NO^"_LRAN_":"_X_":0",DIR("B")=LRAN
"RTN","LA7HDR1",93,0)
 . S DIR("A",1)="",DIR("A")="Recover accessions from "_LRAN_" to"
"RTN","LA7HDR1",94,0)
 . D ^DIR K DIR
"RTN","LA7HDR1",95,0)
 . I $D(DIRUT) S LA7QUIT=1 Q
"RTN","LA7HDR1",96,0)
 . S LRAN=FIRST-1,LAST=Y
"RTN","LA7HDR1",97,0)
 . F  S LRAN=$O(^LRO(68,LRAA,1,LRAD,1,LRAN)) Q:'LRAN!(LRAN>LAST)  D SETTMP
"RTN","LA7HDR1",98,0)
 I LA7TYPE=2 F  D  Q:LA7QUIT!(LRAN<1)
"RTN","LA7HDR1",99,0)
 . D ^LRWU4
"RTN","LA7HDR1",100,0)
 . I $D(DTOUT)!($D(DUOUT)) S LA7QUIT=1 Q
"RTN","LA7HDR1",101,0)
 . I LRAN<1 S:'$D(^TMP("LA7S-RTM",$J)) LA7QUIT=1 Q
"RTN","LA7HDR1",102,0)
 . D SETTMP
"RTN","LA7HDR1",103,0)
 I LA7QUIT Q
"RTN","LA7HDR1",104,0)
 ;
"RTN","LA7HDR1",105,0)
 I '$D(^TMP("LA7S-RTM",$J)) D  Q
"RTN","LA7HDR1",106,0)
 . S DIR("A",1)="No accessions found to retransmit."
"RTN","LA7HDR1",107,0)
 . S DIR("A")="Enter RETURN to continue or '^' to exit"
"RTN","LA7HDR1",108,0)
 . S DIR(0)="E"
"RTN","LA7HDR1",109,0)
 . D ^DIR
"RTN","LA7HDR1",110,0)
 ;
"RTN","LA7HDR1",111,0)
 S DIR("A")="Ready to retransmit"
"RTN","LA7HDR1",112,0)
 S DIR("A",1)="Found "_LA7CNT_" accessions that can be retransmitted."
"RTN","LA7HDR1",113,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","LA7HDR1",114,0)
 D ^DIR K DIR
"RTN","LA7HDR1",115,0)
 I Y'=1 K ^TMP("LA7S-RTM",$J) Q
"RTN","LA7HDR1",116,0)
 D EN^DDIOL("Working","","!")
"RTN","LA7HDR1",117,0)
 ;
"RTN","LA7HDR1",118,0)
 K LA7Y
"RTN","LA7HDR1",119,0)
 S LA7CNT=0,LA7UID=""
"RTN","LA7HDR1",120,0)
 F  S LA7UID=$O(^TMP("LA7S-RTM",$J,LA7UID)) Q:LA7UID=""  D
"RTN","LA7HDR1",121,0)
 . K LA7X,ZTSAVE
"RTN","LA7HDR1",122,0)
 . S LA7X=^TMP("LA7S-RTM",$J,LA7UID),LA7CNT=LA7CNT+1
"RTN","LA7HDR1",123,0)
 . S ZTRTN="BUILD^LA7HDR",ZTDTH=$H,ZTIO="",ZTDESC="Tasked Lab HL7 HDR ORU Build"
"RTN","LA7HDR1",124,0)
 . S ZTSAVE("LRAA")=$P(LA7X,"^"),ZTSAVE("LRAD")=$P(LA7X,"^",2),ZTSAVE("LRAN")=$P(LA7X,"^",3)
"RTN","LA7HDR1",125,0)
 . S ZTSAVE("LRDFN")=$P(LA7X,"^",4),ZTSAVE("LRSS")=$P(LA7X,"^",5),ZTSAVE("LRIDT")=$P(LA7X,"^",6),ZTSAVE("LA7MTYP")="ORU"
"RTN","LA7HDR1",126,0)
 . I $P(LA7X,"^",5)="CH" S ZTSAVE("LRSPEC")=$P(LA7X,"^",7)
"RTN","LA7HDR1",127,0)
 . D ^%ZTLOAD
"RTN","LA7HDR1",128,0)
 . I $G(ZTSK) D
"RTN","LA7HDR1",129,0)
 . . I LA7CNT>101 Q
"RTN","LA7HDR1",130,0)
 . . I LA7CNT=101 S LA7Y(101)="*** Too many accessions to list (>100), list truncated... ***" Q
"RTN","LA7HDR1",131,0)
 . . S LA7Y(LA7CNT)="Task# "_ZTSK_" queued for processing accession "_LA7UID
"RTN","LA7HDR1",132,0)
 . E  S LA7Y(LA7CNT)="*** Tasking of retransmission failed for accession "_LA7UID_" ***"
"RTN","LA7HDR1",133,0)
 S LA7Y(.1)="...Done",LA7X(1,"F")=""
"RTN","LA7HDR1",134,0)
 S LA7Y(.2)=LA7CNT_" accession"_$S(LA7CNT>1:"s",1:"")_" scheduled for retransmitting of results!"
"RTN","LA7HDR1",135,0)
 D EN^DDIOL(.LA7Y)
"RTN","LA7HDR1",136,0)
 K ^TMP("LA7S-RTM",$J)
"RTN","LA7HDR1",137,0)
 ;
"RTN","LA7HDR1",138,0)
 Q
"RTN","LA7HDR1",139,0)
 ;
"RTN","LA7HDR1",140,0)
 ;
"RTN","LA7HDR1",141,0)
SETTMP ;
"RTN","LA7HDR1",142,0)
 ;
"RTN","LA7HDR1",143,0)
 S LA7UID=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3)),"^")
"RTN","LA7HDR1",144,0)
 I LA7UID="" Q
"RTN","LA7HDR1",145,0)
 S LRDFN=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),"^")
"RTN","LA7HDR1",146,0)
 ; Quit if not a file #2 patient.
"RTN","LA7HDR1",147,0)
 I $P($G(^LR(LRDFN,0)),"^",2)'=2 Q
"RTN","LA7HDR1",148,0)
 ; Quit if test patient on a production account.
"RTN","LA7HDR1",149,0)
 I $$TESTPAT^VADPT($P($G(^LR(LRDFN,0)),"^",3)),LA7PROD Q
"RTN","LA7HDR1",150,0)
 S LRSS=$P($G(^LRO(68,LRAA,0)),"^",2),LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),"^",5)
"RTN","LA7HDR1",151,0)
 I LRSS?1(1"CH",1"MI") S LRSPEC=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,5,1)),"^")
"RTN","LA7HDR1",152,0)
 E  S LRSPEC=""
"RTN","LA7HDR1",153,0)
 S LA7CNT=LA7CNT+1,^TMP("LA7S-RTM",$J,LA7UID)=LRAA_"^"_LRAD_"^"_LRAN_"^"_LRDFN_"^"_LRSS_"^"_LRIDT_"^"_LRSPEC
"RTN","LA7HDR1",154,0)
 Q
"RTN","LA7HDR1",155,0)
 ;
"RTN","LA7HDR1",156,0)
 ;
"RTN","LA7HDR1",157,0)
EXIT ;
"RTN","LA7HDR1",158,0)
 K LA7LIMIT
"RTN","LA7HDR1",159,0)
 D CLEANUP^LA7QRY,EXIT^LA7VORM1
"RTN","LA7HDR1",160,0)
 K @GBL,^TMP("LA7VS",$J)
"RTN","LA7HDR1",161,0)
 Q
"RTN","LA7QRY")
0^4^B8496816^B5873978
"RTN","LA7QRY",1,0)
LA7QRY ;DALOI/JMC - Lab HL7 Query Utility ;Apr 26, 2007
"RTN","LA7QRY",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,69,68**;Sep 27, 1994;Build 56
"RTN","LA7QRY",3,0)
 ;
"RTN","LA7QRY",4,0)
 ; Reference to variable DIQUIET supported by DBIA #2098
"RTN","LA7QRY",5,0)
 ; Reference to ^DPT("SSN") global supported by DBIA #10035
"RTN","LA7QRY",6,0)
 ;
"RTN","LA7QRY",7,0)
 Q
"RTN","LA7QRY",8,0)
 ;
"RTN","LA7QRY",9,0)
GCPR(LA7PTID,LA7SDT,LA7EDT,LA7SC,LA7SPEC,LA7QERR,LA7DEST,LA7HL7) ; Entry point for Government Computerized Patient Record query
"RTN","LA7QRY",10,0)
 ;
"RTN","LA7QRY",11,0)
 ; Call with LA7PTID = patient identifier, either SSN or MPI/ICN or medical record number.
"RTN","LA7QRY",12,0)
 ;                     if MPI/ICN then should be full ICN (10 digit number followed by "V" and six digit checksum)
"RTN","LA7QRY",13,0)
 ;                     Pass in the 2nd piece of this variable the type of identifier:
"RTN","LA7QRY",14,0)
 ;                     SS = Social Security number
"RTN","LA7QRY",15,0)
 ;                     PI = VA MPI Integration Control Number
"RTN","LA7QRY",16,0)
 ;                     MR = medical record number of patient in file PATIENT/IHS (#9000001)
"RTN","LA7QRY",17,0)
 ;                     Example: 1000720100V271387^PI
"RTN","LA7QRY",18,0)
 ;                                  123456789^SS
"RTN","LA7QRY",19,0)
 ;                                  123456789^MR
"RTN","LA7QRY",20,0)
 ;
"RTN","LA7QRY",21,0)
 ;            LA7SDT = start date of query (FileMan D/T,time optional)
"RTN","LA7QRY",22,0)
 ;            LA7EDT = end date of query (FileMan D/T, time optional)
"RTN","LA7QRY",23,0)
 ;                     (FileMan D/T^type of date ("CD" or "RAD")
"RTN","LA7QRY",24,0)
 ;                     Both start and end date values can pass a parameter in the second piece to indicate that  the date values are for specimen collection date/time (CD) or results available date (RAD)
"RTN","LA7QRY",25,0)
 ;                     Example: LA7SDT="2991001.1239^CD"
"RTN","LA7QRY",26,0)
 ;                              LA7EDT="2991002.0331^CD"
"RTN","LA7QRY",27,0)
 ;                              LA7SDT="3010201^RAD"
"RTN","LA7QRY",28,0)
 ;                              LA7EDT="3010201^RAD"
"RTN","LA7QRY",29,0)
 ;
"RTN","LA7QRY",30,0)
 ;             LA7SC = Array of search codes, either NLT or LOINC (code^coding system ("NLT" or "LN");
"RTN","LA7QRY",31,0)
 ;                     Example: LA7SC(1)="89628.0000^NLT"
"RTN","LA7QRY",32,0)
 ;                              LA7SC(2)="84330.0000^NLT"
"RTN","LA7QRY",33,0)
 ;                              LA7SC(3)="84295.0000^NLT"
"RTN","LA7QRY",34,0)
 ;                              LA7SC(4)="14749-6^LN"
"RTN","LA7QRY",35,0)
 ;
"RTN","LA7QRY",36,0)
 ;                   = The "*" (wildcard) for any code;
"RTN","LA7QRY",37,0)
 ;                     Example: LA7SC="*"
"RTN","LA7QRY",38,0)
 ;
"RTN","LA7QRY",39,0)
 ;                   = A list of subscripts (separated by commas) from where the results will be extracted ("CH", "MI", "SP", "EM", "CY").
"RTN","LA7QRY",40,0)
 ;                     Example: LA7SC="CH,MI" (CH and MI results only)
"RTN","LA7QRY",41,0)
 ;                     
"RTN","LA7QRY",42,0)
 ;                     Pass in the 2nd piece of LA7SC the indicator (1) to return VUID when available.
"RTN","LA7QRY",43,0)
 ;                     Example: LA7SC="*^1) or LA7SC="CH,MI^1"
"RTN","LA7QRY",44,0)
 ;
"RTN","LA7QRY",45,0)
 ;           LA7SPEC = array of specimen types using HL7 source table 0070 or "*" (wildcard) for any code
"RTN","LA7QRY",46,0)
 ;                     Currently specimen type only supported for CH and MI subscripted tests.
"RTN","LA7QRY",47,0)
 ;                     Example: LA7SPEC="*"
"RTN","LA7QRY",48,0)
 ;                                or
"RTN","LA7QRY",49,0)
 ;                              LA7SPEC(1)="UR"
"RTN","LA7QRY",50,0)
 ;                              LA7SPEC(2)="SER"
"RTN","LA7QRY",51,0)
 ;                              LA7SPEC(3)="PLAS"
"RTN","LA7QRY",52,0)
 ;
"RTN","LA7QRY",53,0)
 ;           LA7QERR = array (by reference) to return any errors
"RTN","LA7QRY",54,0)
 ;
"RTN","LA7QRY",55,0)
 ;           LA7DEST = closed root global reference to return search results (optional). If this parameter is omitted or equals an empty string, then node ^TMP("HLS",$J) is used.
"RTN","LA7QRY",56,0)
 ;                     Example: LA7DEST=$NA(^TMP("ZZTMP",$J))
"RTN","LA7QRY",57,0)
 ;
"RTN","LA7QRY",58,0)
 ;            LA7HL7 = HL7 field separator and encoding characters (4) to use to encode results (optional).
"RTN","LA7QRY",59,0)
 ;                     If undefined or incomplete (length<5) then uses field separator = "|" and encoding characters ="^\~&"
"RTN","LA7QRY",60,0)
 ;
"RTN","LA7QRY",61,0)
 ; Returns    LA7DEST = contains global reference of search results in HL7 message structure, usually ^TMP("HLS",$J)
"RTN","LA7QRY",62,0)
 ;
"RTN","LA7QRY",63,0)
 ;            LA7QERR = array (by reference) containing any errors
"RTN","LA7QRY",64,0)
 ;
"RTN","LA7QRY",65,0)
 N DFN,DIQUIET,LA761,LA76248,LA7CODE,LA7INTYP,LA7NLT,LA7NOMSG,LA7PTYP,LA7QUIT,LA7SCDE,LA7X,LRDFN,LRIDT,LRSS,LRSSLST
"RTN","LA7QRY",66,0)
 ;
"RTN","LA7QRY",67,0)
 D CLEANUP
"RTN","LA7QRY",68,0)
 S U="^",DT=$$DT^XLFDT,DTIME=$$DTIME^XUP($G(DUZ))
"RTN","LA7QRY",69,0)
 S GBL=$S($G(LA7DEST)'="":LA7DEST,1:"^TMP(""HLS"","_$J_")")
"RTN","LA7QRY",70,0)
 K LA7QERR
"RTN","LA7QRY",71,0)
 ; Prevent FileMan from issuing any unwanted WRITE(s).
"RTN","LA7QRY",72,0)
 S DIQUIET=1
"RTN","LA7QRY",73,0)
 ; Currently not using file #62.48 for configuration information.
"RTN","LA7QRY",74,0)
 S (LA76248,LA7INTYP)=0
"RTN","LA7QRY",75,0)
 ;
"RTN","LA7QRY",76,0)
 ; Setup DUZ array to 'non-human' user LRLAB,HL if DUZ not valid
"RTN","LA7QRY",77,0)
 ; Handle calls from non-VistA packages.
"RTN","LA7QRY",78,0)
 I $G(DUZ)<1 D
"RTN","LA7QRY",79,0)
 . S LA7X=$$FIND1^DIC(200,"","OX","LRLAB,HL","B","")
"RTN","LA7QRY",80,0)
 . I LA7X<1 D  Q
"RTN","LA7QRY",81,0)
 . D DUZ^XUP(LA7X)
"RTN","LA7QRY",82,0)
 ;
"RTN","LA7QRY",83,0)
 ; Identify patient, quit if error
"RTN","LA7QRY",84,0)
 D PATID^LA7QRY2
"RTN","LA7QRY",85,0)
 I $D(LA7QERR) Q ""
"RTN","LA7QRY",86,0)
 ;
"RTN","LA7QRY",87,0)
 ; Move LA7SC into local variable to check and modify if necessary.
"RTN","LA7QRY",88,0)
 M LA7SCDE=LA7SC
"RTN","LA7QRY",89,0)
 ;
"RTN","LA7QRY",90,0)
 ; Resolve search codes to lab datanames
"RTN","LA7QRY",91,0)
 S LA7SCDE=$G(LA7SCDE)
"RTN","LA7QRY",92,0)
 ;
"RTN","LA7QRY",93,0)
 ; Set flag to return VUID when available
"RTN","LA7QRY",94,0)
 I $P(LA7SCDE,"^",2)=1 S LA7INTYP=30
"RTN","LA7QRY",95,0)
 ;
"RTN","LA7QRY",96,0)
 ; Parse list of subscripts if any.
"RTN","LA7QRY",97,0)
 D SCLIST^LA7QRY2($P(LA7SCDE,"^"),.LRSSLST)
"RTN","LA7QRY",98,0)
 Q:$D(LA7QERR) ""
"RTN","LA7QRY",99,0)
 ;
"RTN","LA7QRY",100,0)
 ; If passing specific subscripts but no specific search codes then use wildcard ("*") for search codes.
"RTN","LA7QRY",101,0)
 I LA7SCDE'="",$P(LA7SCDE,"^")'="*",'$O(LA7SCDE(0)) S $P(LA7SCDE,"^")="*"
"RTN","LA7QRY",102,0)
 I $P(LA7SCDE,"^")'="*",$O(LA7SCDE(0)) D CHKSC^LA7QRY1
"RTN","LA7QRY",103,0)
 ;
"RTN","LA7QRY",104,0)
 ; Convert specimen codes to file #61 Topography entries
"RTN","LA7QRY",105,0)
 S LA7SPEC=$G(LA7SPEC)
"RTN","LA7QRY",106,0)
 I LA7SPEC'="*"  D SPEC^LA7QRY1
"RTN","LA7QRY",107,0)
 ;
"RTN","LA7QRY",108,0)
 ; Search by collection or results available date
"RTN","LA7QRY",109,0)
 I $P(LA7SDT,"^",2)="" S $P(LA7SDT,"^",2)="CD"
"RTN","LA7QRY",110,0)
 I $P(LA7SDT,"^",2)="RAD" D BRAD^LA7QRY2
"RTN","LA7QRY",111,0)
 I $P(LA7SDT,"^",2)="CD" D BCD^LA7QRY2
"RTN","LA7QRY",112,0)
 ;
"RTN","LA7QRY",113,0)
 I '$D(^TMP("LA7-QRY",$J)) D
"RTN","LA7QRY",114,0)
 . S LA7QERR(99)="No results found for requested parameters"
"RTN","LA7QRY",115,0)
 . S GBL=""
"RTN","LA7QRY",116,0)
 E  S LA7NOMSG=1 D BUILDMSG^LA7QRY1
"RTN","LA7QRY",117,0)
 ;
"RTN","LA7QRY",118,0)
 D CLEANUP
"RTN","LA7QRY",119,0)
 ;
"RTN","LA7QRY",120,0)
 Q GBL
"RTN","LA7QRY",121,0)
 ;
"RTN","LA7QRY",122,0)
 ;
"RTN","LA7QRY",123,0)
CLEANUP ; Cleanup TMP nodes that are used.
"RTN","LA7QRY",124,0)
 ;
"RTN","LA7QRY",125,0)
 N I
"RTN","LA7QRY",126,0)
 F I="LA7-61","LA7-DN","LA7-INST-DNS","LA7-LN","LA7-NLT","LA7-QRY" K ^TMP(I,$J)
"RTN","LA7QRY",127,0)
 D KVAR^LRX
"RTN","LA7QRY",128,0)
 ;
"RTN","LA7QRY",129,0)
 Q
"RTN","LA7QRY1")
0^2^B34477085^B12341981
"RTN","LA7QRY1",1,0)
LA7QRY1 ;DALOI/JMC - Lab HL7 Query Utility ;June 23, 2008
"RTN","LA7QRY1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,61,68**;Sep 27, 1994;Build 56
"RTN","LA7QRY1",3,0)
 ;
"RTN","LA7QRY1",4,0)
 ; Reference to ADM^VADPT2 supported by DBIA #325
"RTN","LA7QRY1",5,0)
 ; Reference to BLDPID^VAFCQRY supported by DBIA #3630
"RTN","LA7QRY1",6,0)
 Q
"RTN","LA7QRY1",7,0)
 ;
"RTN","LA7QRY1",8,0)
CHKSC ; Check search NLT/LOINC codes
"RTN","LA7QRY1",9,0)
 ;
"RTN","LA7QRY1",10,0)
 N J
"RTN","LA7QRY1",11,0)
 ;
"RTN","LA7QRY1",12,0)
 S J=0
"RTN","LA7QRY1",13,0)
 F  S J=$O(LA7SCDE(J)) Q:'J  D
"RTN","LA7QRY1",14,0)
 . N X
"RTN","LA7QRY1",15,0)
 . S X=LA7SCDE(J)
"RTN","LA7QRY1",16,0)
 . I $P(X,"^",2)="NLT",$D(^LAM("E",$P(X,"^"))) D  Q
"RTN","LA7QRY1",17,0)
 . . S ^TMP("LA7-NLT",$J,$P(X,"^"))=""
"RTN","LA7QRY1",18,0)
 . I $P(X,"^",2)="LN",$D(^LAB(95.3,$P($P(X,"^"),"-"))) D  Q
"RTN","LA7QRY1",19,0)
 . . S ^TMP("LA7-LN",$J,$P($P(X,"^"),"-"))=""
"RTN","LA7QRY1",20,0)
 . S LA7QERR(6)="Unknown search code "_$P(X,"^")_" passed"
"RTN","LA7QRY1",21,0)
 . K LA7SCDE(J)
"RTN","LA7QRY1",22,0)
 Q
"RTN","LA7QRY1",23,0)
 ;
"RTN","LA7QRY1",24,0)
 ;
"RTN","LA7QRY1",25,0)
SPEC ; Convert HL7 Specimen Codes to File #61, Topography codes
"RTN","LA7QRY1",26,0)
 ; Find all topographies that use this HL7 specimen code
"RTN","LA7QRY1",27,0)
 N J,K,L
"RTN","LA7QRY1",28,0)
 ;
"RTN","LA7QRY1",29,0)
 S J=0
"RTN","LA7QRY1",30,0)
 F  S J=$O(LA7SPEC(J)) Q:'J  D
"RTN","LA7QRY1",31,0)
 . S K=LA7SPEC(J),L=0
"RTN","LA7QRY1",32,0)
 . F  S L=$O(^LAB(61,"HL7",K,L)) Q:'L  S ^TMP("LA7-61",$J,L)=""
"RTN","LA7QRY1",33,0)
 Q
"RTN","LA7QRY1",34,0)
 ;
"RTN","LA7QRY1",35,0)
 ;
"RTN","LA7QRY1",36,0)
BUILDMSG ; Build HL7 message with result of query
"RTN","LA7QRY1",37,0)
 ;
"RTN","LA7QRY1",38,0)
 I $G(LA7NOMSG)=1 N HL,HLECH,HLFS,HLQ,LA7ECH,LA7FS,LA7MSH
"RTN","LA7QRY1",39,0)
 N LA,LA763,LA7ID,LA7NTESN,LA7NVAF,LA7OBRSN,LA7OBXSN,LA7PIDSN,LA7QUIT,LA7ROOT,LA7X,LRIDT,LRPOC,LRSS,X
"RTN","LA7QRY1",40,0)
 ;
"RTN","LA7QRY1",41,0)
 ; Create dummy MSH to pass HL7 delimiters
"RTN","LA7QRY1",42,0)
 I $G(LA7NOMSG)=1 D
"RTN","LA7QRY1",43,0)
 . I $L($G(LA7HL7))'=5 S LA7HL7="|^\~&"
"RTN","LA7QRY1",44,0)
 . S (HL("FS"),HLFS,LA7FS)=$E(LA7HL7),(HL("ECH"),HLECH,LA7ECH)=$E(LA7HL7,2,5)
"RTN","LA7QRY1",45,0)
 . S (HLQ,HL("Q"))=""
"RTN","LA7QRY1",46,0)
 . S LA7MSH(0)="MSH"_LA7FS_LA7ECH_LA7FS
"RTN","LA7QRY1",47,0)
 . S $P(LA7MSH(0),LA7FS,7)=$$FMTHL7^XLFDT($$NOW^XLFDT)_LA7FS
"RTN","LA7QRY1",48,0)
 . D FILESEG^LA7VHLU(GBL,.LA7MSH)
"RTN","LA7QRY1",49,0)
 ;
"RTN","LA7QRY1",50,0)
 F X="AUTO-INST","LRDFN","LRIDT","SUB","HUID","NLT","RUID","SITE" S LA(X)=""
"RTN","LA7QRY1",51,0)
 ;
"RTN","LA7QRY1",52,0)
 ; Find POC user to identify those specimens that are POC.
"RTN","LA7QRY1",53,0)
 S LRPOC=$$FIND1^DIC(200,"","OX","LRLAB,POC","B","")
"RTN","LA7QRY1",54,0)
 ;
"RTN","LA7QRY1",55,0)
 ; Take search results and put in HL7 message structure
"RTN","LA7QRY1",56,0)
 S LA7ROOT="^TMP(""LA7-QRY"",$J)",(LA7QUIT,LA7PIDSN)=0,LA7ID="LA7QRY-O-"
"RTN","LA7QRY1",57,0)
 F  S LA7ROOT=$Q(@LA7ROOT) Q:LA7ROOT=""  D  Q:LA7QUIT
"RTN","LA7QRY1",58,0)
 . I $QS(LA7ROOT,1)'="LA7-QRY"!($QS(LA7ROOT,2)'=$J) S LA7QUIT=1 Q
"RTN","LA7QRY1",59,0)
 . I LA("LRDFN")'=$QS(LA7ROOT,3) D PAT
"RTN","LA7QRY1",60,0)
 . I LA("LRIDT")'=$QS(LA7ROOT,4) D
"RTN","LA7QRY1",61,0)
 . . I $G(LA7INTYP)=30,$G(LA7OBRSN) D PAT
"RTN","LA7QRY1",62,0)
 . . D ORC
"RTN","LA7QRY1",63,0)
 . I LA("SUB")'=$QS(LA7ROOT,5) D
"RTN","LA7QRY1",64,0)
 . . I $G(LA7INTYP)=30,$G(LA7OBRSN) D PAT
"RTN","LA7QRY1",65,0)
 . . D ORC
"RTN","LA7QRY1",66,0)
 . I LA("NLT")'=$P($QS(LA7ROOT,6),"!") D ORC
"RTN","LA7QRY1",67,0)
 . D OBX
"RTN","LA7QRY1",68,0)
 ;
"RTN","LA7QRY1",69,0)
 Q
"RTN","LA7QRY1",70,0)
 ;
"RTN","LA7QRY1",71,0)
 ;
"RTN","LA7QRY1",72,0)
PAT ; Build PID/PV1 segments
"RTN","LA7QRY1",73,0)
 ;
"RTN","LA7QRY1",74,0)
 N I,LA7,LA7ERR,LA7PID,LA7PV1,VADMVT,VAINDT
"RTN","LA7QRY1",75,0)
 ;
"RTN","LA7QRY1",76,0)
 S (LA("LRDFN"),LRDFN)=$QS(LA7ROOT,3)
"RTN","LA7QRY1",77,0)
 S LRDPF=$P(^LR(LRDFN,0),"^",2),DFN=$P(^(0),"^",3)
"RTN","LA7QRY1",78,0)
 D DEM^LRX
"RTN","LA7QRY1",79,0)
 ;
"RTN","LA7QRY1",80,0)
 ; Build PID segment
"RTN","LA7QRY1",81,0)
 S LA7PIDSN=LA7PIDSN+1
"RTN","LA7QRY1",82,0)
 ;
"RTN","LA7QRY1",83,0)
 ; Check if this field has been built previously for this patient
"RTN","LA7QRY1",84,0)
 ; Save this field to TMP global to use for subsequent calls.
"RTN","LA7QRY1",85,0)
 I $D(^TMP($J,"LA7VHLU","PID",DFN,LA7FS_LA7ECH)) D
"RTN","LA7QRY1",86,0)
 . M LA7PID=^TMP($J,"LA7VHLU","PID",DFN,LA7FS_LA7ECH)
"RTN","LA7QRY1",87,0)
 . S $P(LA7PID(0),LA7FS,2)=LA7PIDSN
"RTN","LA7QRY1",88,0)
 E  D
"RTN","LA7QRY1",89,0)
 . D BLDPID^VAFCQRY(DFN,LA7PIDSN,"ALL",.LA7,.HL,.LA7ERR)
"RTN","LA7QRY1",90,0)
 . S I=0
"RTN","LA7QRY1",91,0)
 . F  S I=$O(LA7(I)) Q:'I  S LA7PID(I-1)=LA7(I)
"RTN","LA7QRY1",92,0)
 . M ^TMP($J,"LA7VHLU","PID",DFN,LA7FS_LA7ECH)=LA7PID
"RTN","LA7QRY1",93,0)
 ;
"RTN","LA7QRY1",94,0)
 D FILESEG^LA7VHLU(GBL,.LA7PID)
"RTN","LA7QRY1",95,0)
 I '$G(LA7NOMSG),$G(LA76249) D FILE6249^LA7VHLU(LA76249,.LA7PID)
"RTN","LA7QRY1",96,0)
 ;
"RTN","LA7QRY1",97,0)
 ; Build PV1 segment if building message for HDR and other subscribers
"RTN","LA7QRY1",98,0)
 I $G(LA7INTYP)=30 D PV1
"RTN","LA7QRY1",99,0)
 ;
"RTN","LA7QRY1",100,0)
 S (LA7OBRSN,LA7OBXSN,LA7NTESN)=0,(LA("LRIDT"),LA("SUB"))=""
"RTN","LA7QRY1",101,0)
 Q
"RTN","LA7QRY1",102,0)
 ;
"RTN","LA7QRY1",103,0)
 ;
"RTN","LA7QRY1",104,0)
ORC ; Build ORC segment
"RTN","LA7QRY1",105,0)
 ;
"RTN","LA7QRY1",106,0)
 N LA764,LA7NLT,LRNMSP,X
"RTN","LA7QRY1",107,0)
 ;
"RTN","LA7QRY1",108,0)
 S (LA("LRIDT"),LRIDT)=$QS(LA7ROOT,4),(LA("SUB"),LRSS)=$QS(LA7ROOT,5)
"RTN","LA7QRY1",109,0)
 S LA763(0)=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),0))
"RTN","LA7QRY1",110,0)
 S X=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),"ORU"))
"RTN","LA7QRY1",111,0)
 S LA("HUID")=$P(X,"^"),LRNMSP="LR"
"RTN","LA7QRY1",112,0)
 I LA("HUID")="" S LA("HUID")=$P(LA763(0),"^",6)
"RTN","LA7QRY1",113,0)
 S LA("HUID","NMSP")=LRNMSP
"RTN","LA7QRY1",114,0)
 I "CHMI"[LA("SUB") S LA("HUID","SITE")=$P(LA763(0),"^",14)
"RTN","LA7QRY1",115,0)
 E  S LA("HUID","SITE")=""
"RTN","LA7QRY1",116,0)
 ;
"RTN","LA7QRY1",117,0)
 S LA("RUID")=$P(X,"^",5),LRNMSP="LR"
"RTN","LA7QRY1",118,0)
 I LRPOC,LRPOC=$P(X,"^",4) S LRNMSP="LRPOC"
"RTN","LA7QRY1",119,0)
 S LA("RUID","NMSP")=LRNMSP
"RTN","LA7QRY1",120,0)
 S LA("RUID","SITE")=$P(X,"^",3)
"RTN","LA7QRY1",121,0)
 I LA("RUID")="" D
"RTN","LA7QRY1",122,0)
 . S LA("RUID")=LA("HUID")
"RTN","LA7QRY1",123,0)
 . S LA("RUID","NMSP")=LA("HUID","NMSP")
"RTN","LA7QRY1",124,0)
 . S LA("RUID","SITE")=LA("HUID","SITE")
"RTN","LA7QRY1",125,0)
 ;
"RTN","LA7QRY1",126,0)
 S LA("SITE")=$P(X,"^",2)
"RTN","LA7QRY1",127,0)
 S LA7NVAF=$$NVAF^LA7VHLU2(0),LA7NTESN=0
"RTN","LA7QRY1",128,0)
 ;
"RTN","LA7QRY1",129,0)
 S (LA("NLT"),LA7NLT)=$P($QS(LA7ROOT,6),"!"),(LA764,LA("ORD"))=""
"RTN","LA7QRY1",130,0)
 I LA7NLT'="" D
"RTN","LA7QRY1",131,0)
 . S LA764=+$O(^LAM("E",LA7NLT,0))
"RTN","LA7QRY1",132,0)
 . I LA764 S LA("ORD")=$$GET1^DIQ(64,LA764_",",.01)
"RTN","LA7QRY1",133,0)
 ;
"RTN","LA7QRY1",134,0)
 D ORC^LA7VORU,OBR
"RTN","LA7QRY1",135,0)
 ;
"RTN","LA7QRY1",136,0)
 Q
"RTN","LA7QRY1",137,0)
 ;
"RTN","LA7QRY1",138,0)
 ;
"RTN","LA7QRY1",139,0)
OBR ; Build OBR segment
"RTN","LA7QRY1",140,0)
 ;
"RTN","LA7QRY1",141,0)
 N LA7RS
"RTN","LA7QRY1",142,0)
 ;
"RTN","LA7QRY1",143,0)
 I LA("SUB")="CH" D
"RTN","LA7QRY1",144,0)
 . D OBR^LA7VORU
"RTN","LA7QRY1",145,0)
 . D NTE^LA7VORU
"RTN","LA7QRY1",146,0)
 . S LA7OBXSN=0
"RTN","LA7QRY1",147,0)
 ;
"RTN","LA7QRY1",148,0)
 Q
"RTN","LA7QRY1",149,0)
 ;
"RTN","LA7QRY1",150,0)
 ;
"RTN","LA7QRY1",151,0)
OBX ; Build OBX segment
"RTN","LA7QRY1",152,0)
 ;
"RTN","LA7QRY1",153,0)
 N LA7DATA,LA7VT
"RTN","LA7QRY1",154,0)
 ;
"RTN","LA7QRY1",155,0)
 S LA7NTESN=0
"RTN","LA7QRY1",156,0)
 I LA("SUB")="MI" D MI^LA7VORU1 Q
"RTN","LA7QRY1",157,0)
 I "CYEMSP"[LA("SUB") D AP^LA7VORU2 Q
"RTN","LA7QRY1",158,0)
 ;
"RTN","LA7QRY1",159,0)
 S LA7VT=$QS(LA7ROOT,7)
"RTN","LA7QRY1",160,0)
 D OBX^LA7VOBX(LA("LRDFN"),LA("SUB"),LA("LRIDT"),LA7VT,.LA7DATA,.LA7OBXSN,LA7FS,LA7ECH)
"RTN","LA7QRY1",161,0)
 I '$D(LA7DATA) Q
"RTN","LA7QRY1",162,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7QRY1",163,0)
 I '$G(LA7NOMSG),$G(LA76249) D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7QRY1",164,0)
 ; Send any test interpretation from file #60
"RTN","LA7QRY1",165,0)
 D INTRP^LA7VORUA
"RTN","LA7QRY1",166,0)
 ;
"RTN","LA7QRY1",167,0)
 ; Mark result as sent - set to 1, if corrected results set to 2
"RTN","LA7QRY1",168,0)
 I LA("SUB")="CH" D
"RTN","LA7QRY1",169,0)
 . I $P(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),$P(LA7VT,"^")),"^",10)>1 Q
"RTN","LA7QRY1",170,0)
 . S $P(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),$P(LA7VT,"^")),"^",10)=$S($P(LA7VT,"^",2)="C":2,1:1)
"RTN","LA7QRY1",171,0)
 ;
"RTN","LA7QRY1",172,0)
 Q
"RTN","LA7QRY1",173,0)
 ;
"RTN","LA7QRY1",174,0)
 ;
"RTN","LA7QRY1",175,0)
PV1 ; Build PV1 segment for HDR
"RTN","LA7QRY1",176,0)
 N LA7DT,LA7PCE,LA7SDENC,LRDX,LRIDT,LRSS,LRUID,VADMVT,VAINDT
"RTN","LA7QRY1",177,0)
 S LRIDT=$QS(LA7ROOT,4),LRSS=$QS(LA7ROOT,5),LA7DT=0
"RTN","LA7QRY1",178,0)
 I LRIDT,LRSS'="" S LA7DT=$P($G(^LR(LRDFN,LRSS,LRIDT,0)),"^")
"RTN","LA7QRY1",179,0)
 I 'LA7DT Q
"RTN","LA7QRY1",180,0)
 ;
"RTN","LA7QRY1",181,0)
 S LRDX=""
"RTN","LA7QRY1",182,0)
 ; Determine if an inpatient at time of specimen and build inpatient PV1.
"RTN","LA7QRY1",183,0)
 S VAINDT=LA7DT D ADM^VADPT2
"RTN","LA7QRY1",184,0)
 I VADMVT S LA7PV1(0)=$$IN^VAFHLPV1(DFN,LA7DT,",3,6,7,10,18,21,36,39,44,45,",VADMVT,"",1,LRDX)
"RTN","LA7QRY1",185,0)
 ;
"RTN","LA7QRY1",186,0)
 ; If not an inpatient then build outpatient PV1.
"RTN","LA7QRY1",187,0)
 I 'VADMVT D
"RTN","LA7QRY1",188,0)
 . N LA7VPTR
"RTN","LA7QRY1",189,0)
 . S LA7PCE=$$PCENC^LA7VHLU3(LRDFN,LRSS,LRIDT),LA7VPTR=""
"RTN","LA7QRY1",190,0)
 . I LA7PCE'="" D
"RTN","LA7QRY1",191,0)
 . . S LA7SDENC=$$SDENC^LA7VHLU3(LA7PCE)
"RTN","LA7QRY1",192,0)
 . . I LA7SDENC'="" S LA7VPTR=LA7SDENC_";SCE("
"RTN","LA7QRY1",193,0)
 . I LA7VPTR="" S LA7VPTR=DFN_";DPT("
"RTN","LA7QRY1",194,0)
 . S LA7PV1(0)=$$OUT^VAFHLPV1(DFN,"",LA7DT,LA7VPTR,"A",1)
"RTN","LA7QRY1",195,0)
 ;
"RTN","LA7QRY1",196,0)
 D FILESEG^LA7VHLU(GBL,.LA7PV1)
"RTN","LA7QRY1",197,0)
 I '$G(LA7NOMSG),$G(LA76249) D FILE6249^LA7VHLU(LA76249,.LA7PV1)
"RTN","LA7QRY1",198,0)
 Q
"RTN","LA7QRY2")
0^3^B38475048^B24752999
"RTN","LA7QRY2",1,0)
LA7QRY2 ;DALOI/JMC - Lab HL7 Query Utility ;Nov 3, 2006
"RTN","LA7QRY2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,69,68**;Sep 27, 1994;Build 56
"RTN","LA7QRY2",3,0)
 ;
"RTN","LA7QRY2",4,0)
 ; Reference to ^AUPNPAT("D") global supported by DBIA #4814
"RTN","LA7QRY2",5,0)
 ;
"RTN","LA7QRY2",6,0)
 Q
"RTN","LA7QRY2",7,0)
 ;
"RTN","LA7QRY2",8,0)
PATID ; Resolve patient id and establish patient environment
"RTN","LA7QRY2",9,0)
 ;
"RTN","LA7QRY2",10,0)
 N LA7X
"RTN","LA7QRY2",11,0)
 ;
"RTN","LA7QRY2",12,0)
 S (DFN,LRDFN)="",LA7PTYP=0
"RTN","LA7QRY2",13,0)
 S LA7PTID("TYPE")=$P(LA7PTID,"^",2),LA7PTID=$P(LA7PTID,"^")
"RTN","LA7QRY2",14,0)
 ;
"RTN","LA7QRY2",15,0)
 ; SSN passed as patient identifier
"RTN","LA7QRY2",16,0)
 ; Identifier type will be checked in subsequent patch once subscribers
"RTN","LA7QRY2",17,0)
 ; have updated their API call.
"RTN","LA7QRY2",18,0)
 ; I LA7PTID("TYPE")="SS" D
"RTN","LA7QRY2",19,0)
 I LA7PTID?9N.1A D
"RTN","LA7QRY2",20,0)
 . S LA7PTYP=1
"RTN","LA7QRY2",21,0)
 . S LA7X=$O(^DPT("SSN",LA7PTID,0))
"RTN","LA7QRY2",22,0)
 . I LA7X>0 D SETDFN(LA7X)
"RTN","LA7QRY2",23,0)
 ;
"RTN","LA7QRY2",24,0)
 ; MPI/ICN (integration control number) passed as patient identifier
"RTN","LA7QRY2",25,0)
 ; Identifier type will be checked in subsequent patch once subscribers have updated their API call.
"RTN","LA7QRY2",26,0)
 ; I LA7PTID("TYPE")="PI" D
"RTN","LA7QRY2",27,0)
 I LA7PTID?10N1"V"6N D
"RTN","LA7QRY2",28,0)
 . S LA7PTYP=2
"RTN","LA7QRY2",29,0)
 . S LA7X=$$GETDFN^MPIF001(LA7PTID)
"RTN","LA7QRY2",30,0)
 . I LA7X<0 S LA7QERR(5)=$P(LA7X,"^",2) Q
"RTN","LA7QRY2",31,0)
 . I LA7PTID'=$$GETICN^MPIF001(LA7X) S LA7QERR(1)="Invalid patient identifier passed" Q
"RTN","LA7QRY2",32,0)
 . D SETDFN(LA7X)
"RTN","LA7QRY2",33,0)
 ;
"RTN","LA7QRY2",34,0)
 ; Use HRN (health record number) cross reference of file PATIENT/IHS (#9000001).
"RTN","LA7QRY2",35,0)
 I LA7PTID("TYPE")="MR" D
"RTN","LA7QRY2",36,0)
 . S LA7PTYP=3
"RTN","LA7QRY2",37,0)
 . S LA7X=$O(^AUPNPAT("D",LA7PTID,0))
"RTN","LA7QRY2",38,0)
 . D SETDFN(LA7X)
"RTN","LA7QRY2",39,0)
 ;
"RTN","LA7QRY2",40,0)
 ; If no patient identified/no laboratory record - return exception message
"RTN","LA7QRY2",41,0)
 I 'LA7PTYP S LA7QERR(1)="Invalid patient identifier passed"
"RTN","LA7QRY2",42,0)
 I 'DFN S LA7QERR(2)="No patient found with requested identifier"
"RTN","LA7QRY2",43,0)
 I DFN,'LRDFN S LA7QERR(3)="No laboratory record for requested patient"
"RTN","LA7QRY2",44,0)
 I LRDFN,'$D(^LR(LRDFN)) S LA7QERR(4)="Database error - missing laboratory record for requested patient"
"RTN","LA7QRY2",45,0)
 Q
"RTN","LA7QRY2",46,0)
 ;
"RTN","LA7QRY2",47,0)
 ;
"RTN","LA7QRY2",48,0)
BCD ; Search by specimen collection date.
"RTN","LA7QRY2",49,0)
 ;
"RTN","LA7QRY2",50,0)
 N LA763,LA7QUIT
"RTN","LA7QRY2",51,0)
 ;
"RTN","LA7QRY2",52,0)
 S (LA7SDT(0),LA7EDT(0))=0
"RTN","LA7QRY2",53,0)
 I LA7SDT S LA7SDT(0)=9999999-LA7SDT
"RTN","LA7QRY2",54,0)
 I LA7EDT S LA7EDT(0)=9999999-LA7EDT
"RTN","LA7QRY2",55,0)
 ;
"RTN","LA7QRY2",56,0)
 S LRSS=""
"RTN","LA7QRY2",57,0)
 F  S LRSS=$O(LRSSLST(LRSS))  Q:LRSS=""  D
"RTN","LA7QRY2",58,0)
 . S (LA7QUIT,LRIDT)=0
"RTN","LA7QRY2",59,0)
 . I LA7EDT(0) S LRIDT=$O(^LR(LRDFN,LRSS,LA7EDT(0)),-1)
"RTN","LA7QRY2",60,0)
 . F  S LRIDT=$O(^LR(LRDFN,LRSS,LRIDT)) Q:LA7QUIT  D
"RTN","LA7QRY2",61,0)
 . . ; Quit if reached end of data or outside date criteria
"RTN","LA7QRY2",62,0)
 . . I 'LRIDT!(LRIDT>LA7SDT(0)) S LA7QUIT=1 Q
"RTN","LA7QRY2",63,0)
 . . D SEARCH
"RTN","LA7QRY2",64,0)
 ;
"RTN","LA7QRY2",65,0)
 Q
"RTN","LA7QRY2",66,0)
 ;
"RTN","LA7QRY2",67,0)
 ;
"RTN","LA7QRY2",68,0)
BRAD ; Search by results available date (completion date).
"RTN","LA7QRY2",69,0)
 ; Assumes cross-references still exist for dates in LRO(69) global.
"RTN","LA7QRY2",70,0)
 ; Collects specimen date/time values for a given LRDFN and completion date.
"RTN","LA7QRY2",71,0)
 ; Cross-reference is by date only, time stripped from start date.
"RTN","LA7QRY2",72,0)
 ; Uses cross-reference ^LRO(69,DT,1,"AN",'LOCATION',LRDFN,LRIDT)=""
"RTN","LA7QRY2",73,0)
 ;
"RTN","LA7QRY2",74,0)
 N LA763,LA7DT,LA7ROOT,LA7SRC,LA7X,X
"RTN","LA7QRY2",75,0)
 ;
"RTN","LA7QRY2",76,0)
 ; Check if orders still exist in file #69 for search range.
"RTN","LA7QRY2",77,0)
 ; If also searching any AP (SP,CY,EM,AU) subscripts then use long search as these do not always have orders in file #69.
"RTN","LA7QRY2",78,0)
 S LA7SDT(1)=(LA7SDT\1)-.0000000001,LA7EDT(1)=(LA7EDT\1)+.24,LA7SRC=0
"RTN","LA7QRY2",79,0)
 S X=$O(^LRO(69,LA7SDT(1)))
"RTN","LA7QRY2",80,0)
 I X,X<LA7EDT(1) D
"RTN","LA7QRY2",81,0)
 . S LA7SRC=1
"RTN","LA7QRY2",82,0)
 . F I="AU","CY","EM","SP" I $D(LRSSLST(I)) S LA7SRC=2 Q
"RTN","LA7QRY2",83,0)
 ;
"RTN","LA7QRY2",84,0)
 ; Search "AN" cross-reference in file #69.
"RTN","LA7QRY2",85,0)
 I LA7SRC D
"RTN","LA7QRY2",86,0)
 . S LA7DT=LA7SDT(1)
"RTN","LA7QRY2",87,0)
 . F  S LA7DT=$O(^LRO(69,LA7DT)) Q:'LA7DT!(LA7DT>LA7EDT(1))  D
"RTN","LA7QRY2",88,0)
 . . S LA7ROOT="^LRO(69,LA7DT,1,""AN"")"
"RTN","LA7QRY2",89,0)
 . . F  S LA7ROOT=$Q(@LA7ROOT) Q:LA7ROOT=""!($QS(LA7ROOT,2)'=LA7DT)!($QS(LA7ROOT,4)'="AN")  D
"RTN","LA7QRY2",90,0)
 . . . I $QS(LA7ROOT,6)'=LRDFN Q
"RTN","LA7QRY2",91,0)
 . . . S LRIDT=$QS(LA7ROOT,7),LRSS=""
"RTN","LA7QRY2",92,0)
 . . . F  S LRSS=$O(LRSSLST(LRSS))  Q:LRSS=""  D SEARCH
"RTN","LA7QRY2",93,0)
 ;
"RTN","LA7QRY2",94,0)
 ; If no orders in #69 then do long search through file #63.
"RTN","LA7QRY2",95,0)
 ; Or if searching AP subscripts.
"RTN","LA7QRY2",96,0)
 ; If MI subscript then check each section of specimen for release date.
"RTN","LA7QRY2",97,0)
 I 'LA7SRC!(LA7SRC=2) D
"RTN","LA7QRY2",98,0)
 . S LRSS=""
"RTN","LA7QRY2",99,0)
 . F  S LRSS=$O(LRSSLST(LRSS))  Q:LRSS=""  D
"RTN","LA7QRY2",100,0)
 . . I LA7SRC=2,"AUCYEMSP"'[LRSS Q
"RTN","LA7QRY2",101,0)
 . . S LRIDT=0
"RTN","LA7QRY2",102,0)
 . . F  S LRIDT=$O(^LR(LRDFN,LRSS,LRIDT)) Q:'LRIDT  D
"RTN","LA7QRY2",103,0)
 . . . S LA763(0)=$G(^LR(LRDFN,LRSS,LRIDT,0))
"RTN","LA7QRY2",104,0)
 . . . I LRSS="MI" D SEARCH
"RTN","LA7QRY2",105,0)
 . . . S LA7X=$S("SPCYEM"[LRSS:$P(LA763(0),"^",11),1:$P(LA763(0),"^",3))
"RTN","LA7QRY2",106,0)
 . . . I LA7X>LA7SDT(1),LA7X<LA7EDT(1) D SEARCH
"RTN","LA7QRY2",107,0)
 ;
"RTN","LA7QRY2",108,0)
 Q
"RTN","LA7QRY2",109,0)
 ;
"RTN","LA7QRY2",110,0)
 ;
"RTN","LA7QRY2",111,0)
SEARCH ; Search subscript for a specific collection date/time
"RTN","LA7QRY2",112,0)
 ;
"RTN","LA7QRY2",113,0)
 K LA763
"RTN","LA7QRY2",114,0)
 S LA763(0)=$G(^LR(LRDFN,LRSS,LRIDT,0))
"RTN","LA7QRY2",115,0)
 ; Skip if CH, SP, CY, or EM subscript and no complete date
"RTN","LA7QRY2",116,0)
 I "CHSPCYEM"[LRSS,'$P(LA763(0),"^",3) Q
"RTN","LA7QRY2",117,0)
 ; Skip if SP, CY, or EM subscript and no release date
"RTN","LA7QRY2",118,0)
 I "SPCYEM"[LRSS,'$P(LA763(0),"^",11) Q
"RTN","LA7QRY2",119,0)
 ;
"RTN","LA7QRY2",120,0)
 ; Only CH, MI, and BB subscripts store pointer to file #61 in 5th piece of zeroth node.
"RTN","LA7QRY2",121,0)
 ; Quit if specific specimen codes and they do not match
"RTN","LA7QRY2",122,0)
 I "CHMIBB"[LRSS S LA761=+$P(LA763(0),"^",5)
"RTN","LA7QRY2",123,0)
 E  S LA761=0
"RTN","LA7QRY2",124,0)
 I LA761,$D(^TMP("LA7-61",$J)),'$D(^TMP("LA7-61",$J,LA761)) Q
"RTN","LA7QRY2",125,0)
 ;
"RTN","LA7QRY2",126,0)
 ; --- Chemistry
"RTN","LA7QRY2",127,0)
 I LRSS="CH" D CHSS Q
"RTN","LA7QRY2",128,0)
 ; --- Microbiology
"RTN","LA7QRY2",129,0)
 I LRSS="MI" D MISS Q
"RTN","LA7QRY2",130,0)
 ; --- Surgical pathology
"RTN","LA7QRY2",131,0)
 I LRSS="SP" D APSS Q
"RTN","LA7QRY2",132,0)
 ; --- Cytology
"RTN","LA7QRY2",133,0)
 I LRSS="CY" D APSS Q
"RTN","LA7QRY2",134,0)
 ; --- Electron Microscopy
"RTN","LA7QRY2",135,0)
 I LRSS="EM" D APSS Q
"RTN","LA7QRY2",136,0)
 ; --- Autopsy
"RTN","LA7QRY2",137,0)
 I LRSS="AU" D APSS Q
"RTN","LA7QRY2",138,0)
 ; --- Blood Bank
"RTN","LA7QRY2",139,0)
 I LRSS="BB" D BBSS Q
"RTN","LA7QRY2",140,0)
 Q
"RTN","LA7QRY2",141,0)
 ;
"RTN","LA7QRY2",142,0)
 ;
"RTN","LA7QRY2",143,0)
CHSS ; Search "CH" datanames for matching codes
"RTN","LA7QRY2",144,0)
 ;
"RTN","LA7QRY2",145,0)
 N LA7X,LRSB
"RTN","LA7QRY2",146,0)
 ;
"RTN","LA7QRY2",147,0)
 S LRSB=1
"RTN","LA7QRY2",148,0)
 F  S LRSB=$O(^LR(LRDFN,LRSS,LRIDT,LRSB)) Q:'LRSB  D
"RTN","LA7QRY2",149,0)
 . S LA7X=$G(^LR(LRDFN,LRSS,LRIDT,LRSB))
"RTN","LA7QRY2",150,0)
 . S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,$P(LA7X,"^",3),LA761)
"RTN","LA7QRY2",151,0)
 . D CHECK
"RTN","LA7QRY2",152,0)
 Q
"RTN","LA7QRY2",153,0)
 ;
"RTN","LA7QRY2",154,0)
 ;
"RTN","LA7QRY2",155,0)
MISS ; Search "MI" subscripts for matching codes
"RTN","LA7QRY2",156,0)
 ;
"RTN","LA7QRY2",157,0)
 N LA7ND,LA7X,LRSB
"RTN","LA7QRY2",158,0)
 ;
"RTN","LA7QRY2",159,0)
 S LA7ND=0
"RTN","LA7QRY2",160,0)
 F LA7ND=1,5,8,11,16 I $D(^LR(LRDFN,LRSS,LRIDT,LA7ND)) D
"RTN","LA7QRY2",161,0)
 . S LA7X=$P(^LR(LRDFN,LRSS,LRIDT,LA7ND),"^")
"RTN","LA7QRY2",162,0)
 . ; If no rpt date approved do not include
"RTN","LA7QRY2",163,0)
 . I LA7X="" Q
"RTN","LA7QRY2",164,0)
 . I $P(LA7SDT,"^",2)="RAD",((LA7X<LA7SDT(1))!(LA7X>LA7EDT(1))) Q
"RTN","LA7QRY2",165,0)
 . S LRSB=$S(LA7ND=1:11,LA7ND=5:14,LA7ND=8:18,LA7ND=11:22,LA7ND=16:33,1:11)
"RTN","LA7QRY2",166,0)
 . S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,"",LA761)
"RTN","LA7QRY2",167,0)
 . D CHECK
"RTN","LA7QRY2",168,0)
 Q
"RTN","LA7QRY2",169,0)
 ;
"RTN","LA7QRY2",170,0)
 ;
"RTN","LA7QRY2",171,0)
APSS ; Search AP subscripts for matching codes
"RTN","LA7QRY2",172,0)
 ; AP results are currently not coded - use defaults
"RTN","LA7QRY2",173,0)
 ;
"RTN","LA7QRY2",174,0)
 N LA7CODE,LRSB
"RTN","LA7QRY2",175,0)
 ;
"RTN","LA7QRY2",176,0)
 ; *** Autopsy subscript currently not supported ***
"RTN","LA7QRY2",177,0)
 I LRSS="AU" Q
"RTN","LA7QRY2",178,0)
 ;
"RTN","LA7QRY2",179,0)
 S LRSB=.012
"RTN","LA7QRY2",180,0)
 S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,"","")
"RTN","LA7QRY2",181,0)
 D CHECK
"RTN","LA7QRY2",182,0)
 ;
"RTN","LA7QRY2",183,0)
 Q
"RTN","LA7QRY2",184,0)
 ;
"RTN","LA7QRY2",185,0)
 ;
"RTN","LA7QRY2",186,0)
BBSS ; Search BB subscript for matching codes
"RTN","LA7QRY2",187,0)
 ; *** This subscript currently not supported ***
"RTN","LA7QRY2",188,0)
 Q
"RTN","LA7QRY2",189,0)
 ;
"RTN","LA7QRY2",190,0)
 ;
"RTN","LA7QRY2",191,0)
CHECK ; Check NLT order/result and LOINC codes.
"RTN","LA7QRY2",192,0)
 ;
"RTN","LA7QRY2",193,0)
 N LA7I,LA7QUIT,LA7X
"RTN","LA7QRY2",194,0)
 ;
"RTN","LA7QRY2",195,0)
 ; If wildcard then store
"RTN","LA7QRY2",196,0)
 ; Otherwise check for specific NLT order/result and LOINC codes
"RTN","LA7QRY2",197,0)
 ; If searching for suffix "0000" then check for other than "0000" coded result NLT code suffixes
"RTN","LA7QRY2",198,0)
 I $P(LA7SCDE,"^")="*" D STORE Q
"RTN","LA7QRY2",199,0)
 S LA7QUIT=0
"RTN","LA7QRY2",200,0)
 F LA7I=1:1:3 D  Q:LA7QUIT
"RTN","LA7QRY2",201,0)
 . ; If no test code then skip
"RTN","LA7QRY2",202,0)
 . I $P(LA7CODE,"!",LA7I)="" Q
"RTN","LA7QRY2",203,0)
 . ; If test code matches a search code then store
"RTN","LA7QRY2",204,0)
 . I $D(^TMP($S(LA7I=3:"LA7-LN",1:"LA7-NLT"),$J,$P(LA7CODE,"!",LA7I))) D  Q
"RTN","LA7QRY2",205,0)
 . . D STORE
"RTN","LA7QRY2",206,0)
 . . S LA7QUIT=1
"RTN","LA7QRY2",207,0)
 . I LA7I=2,$P($P(LA7CODE,"!",LA7I),".",2)'="0000" D
"RTN","LA7QRY2",208,0)
 . . S LA7X=$P($P(LA7CODE,"!",LA7I),".",1)_".0000"
"RTN","LA7QRY2",209,0)
 . . I $D(^TMP("LA7-NLT",$J,LA7X)) D STORE S LA7QUIT=1 Q
"RTN","LA7QRY2",210,0)
 ;
"RTN","LA7QRY2",211,0)
 Q
"RTN","LA7QRY2",212,0)
 ;
"RTN","LA7QRY2",213,0)
 ;
"RTN","LA7QRY2",214,0)
STORE ; Store entry for building in HL7 message
"RTN","LA7QRY2",215,0)
 ;
"RTN","LA7QRY2",216,0)
 S ^TMP("LA7-QRY",$J,LRDFN,LRIDT,LRSS,$P(LA7CODE,"!"),LRSB)=""
"RTN","LA7QRY2",217,0)
 Q
"RTN","LA7QRY2",218,0)
 ;
"RTN","LA7QRY2",219,0)
 ;
"RTN","LA7QRY2",220,0)
SETDFN(LA7X) ; Setup DFN and other lab variables.
"RTN","LA7QRY2",221,0)
 ;
"RTN","LA7QRY2",222,0)
 S DFN=LA7X,LRDFN=$P($G(^DPT(DFN,"LR")),"^")
"RTN","LA7QRY2",223,0)
 Q
"RTN","LA7QRY2",224,0)
 ;
"RTN","LA7QRY2",225,0)
 ;
"RTN","LA7QRY2",226,0)
SCLIST(SCLST,LA7SLST) ; Setup subscript search list
"RTN","LA7QRY2",227,0)
 ; Call with   SCLST = list of subscripts to search, "," delimited
"RTN","LA7QRY2",228,0)
 ;           LA7SLST = array reference to return parsed subscript array
"RTN","LA7QRY2",229,0)
 ;
"RTN","LA7QRY2",230,0)
 ;   Returns LA7SLST =  parsed array of subscripts (passed by reference)
"RTN","LA7QRY2",231,0)
 ;
"RTN","LA7QRY2",232,0)
 N I,RC,SCALL,TMP
"RTN","LA7QRY2",233,0)
 ;
"RTN","LA7QRY2",234,0)
 ; Search all supported subscripts
"RTN","LA7QRY2",235,0)
 I SCLST="*" F I="AU","BB","CH","CY","EM","MI","SP" S LA7SLST(I)=""
"RTN","LA7QRY2",236,0)
 ;
"RTN","LA7QRY2",237,0)
 ; Search only requested valid subscripts
"RTN","LA7QRY2",238,0)
 I SCLST'="*" D
"RTN","LA7QRY2",239,0)
 . S SCALL=",AU,BB,CH,CY,EM,MI,SP,",SCLST=$$UP^XLFSTR($TR(SCLST," "))
"RTN","LA7QRY2",240,0)
 . F I=1:1:$L(SCLST,",") D  Q:$D(LA7QERR)
"RTN","LA7QRY2",241,0)
 . . S TMP=$P(SCLST,",",I) Q:TMP=""
"RTN","LA7QRY2",242,0)
 . . I SCALL[(","_TMP_",")  S LA7SLST(TMP)="" Q
"RTN","LA7QRY2",243,0)
 . . S LA7QERR(7)="Invalid list of subscripts: '"_SCLST_"'"
"RTN","LA7QRY2",244,0)
 Q
"RTN","LA7VHLU")
0^11^B44857108^B42350744
"RTN","LA7VHLU",1,0)
LA7VHLU ;DALOI/JMC - HL7 segment builder utility ;Nov 26, 2007
"RTN","LA7VHLU",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,62,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VHLU",3,0)
 ;
"RTN","LA7VHLU",4,0)
 ; Reference to PROTOCOL file (#101) supported by DBIA #872
"RTN","LA7VHLU",5,0)
 ;
"RTN","LA7VHLU",6,0)
STARTMSG(LA7EVNT,LA76249,LA7NOMSG) ; Create/initialize HL message
"RTN","LA7VHLU",7,0)
 ;
"RTN","LA7VHLU",8,0)
 ; Call with LA7EVNT = Lab event protocol in file (#101)
"RTN","LA7VHLU",9,0)
 ;           LA76249 = if entry already exists, do not create new entry
"RTN","LA7VHLU",10,0)
 ;          LA7NOMSG = flag to not store MSH segment in file #62.49
"RTN","LA7VHLU",11,0)
 ;
"RTN","LA7VHLU",12,0)
 N LA7MSH,X
"RTN","LA7VHLU",13,0)
 ;
"RTN","LA7VHLU",14,0)
 S LA76249=+$G(LA76249)
"RTN","LA7VHLU",15,0)
 D INITHL(LA7EVNT)
"RTN","LA7VHLU",16,0)
 I LA76249<1 S LA76249=$$INIT6249^LA7VHLU
"RTN","LA7VHLU",17,0)
 I $G(HL) D  Q
"RTN","LA7VHLU",18,0)
 . N LA7X
"RTN","LA7VHLU",19,0)
 . S LA7X(1)=LA76249,LA7X(2)=$TR(HL,"^","-")
"RTN","LA7VHLU",20,0)
 . D CREATE^LA7LOG(28)
"RTN","LA7VHLU",21,0)
 S X="MSH"_LA7FS_LA7ECH_LA7FS_HL("SAN")_LA7FS_HL("SAF")_LA7FS
"RTN","LA7VHLU",22,0)
 S $P(X,LA7FS,9)=HL("MTN")_$E(LA7ECH,1)_HL("ETN")
"RTN","LA7VHLU",23,0)
 S $P(X,LA7FS,11)=HL("PID")
"RTN","LA7VHLU",24,0)
 S $P(X,LA7FS,12)=HL("VER")
"RTN","LA7VHLU",25,0)
 S:$D(HL("ACAT")) $P(X,LA7FS,15)=HL("ACAT")
"RTN","LA7VHLU",26,0)
 S:$D(HL("APAT")) $P(X,LA7FS,16)=HL("APAT")
"RTN","LA7VHLU",27,0)
 S LA7MSH(0)=X
"RTN","LA7VHLU",28,0)
 I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249,.LA7MSH)
"RTN","LA7VHLU",29,0)
 ;
"RTN","LA7VHLU",30,0)
 Q
"RTN","LA7VHLU",31,0)
 ;
"RTN","LA7VHLU",32,0)
INITHL(LA7EVNT) ; Initialize HL environment
"RTN","LA7VHLU",33,0)
 ;
"RTN","LA7VHLU",34,0)
 ; Call with LA7EVNT = Lab event protocol in file (#101)
"RTN","LA7VHLU",35,0)
 ; HL7 v1.6 interface
"RTN","LA7VHLU",36,0)
 ; LA7101 - IEN of event protocol
"RTN","LA7VHLU",37,0)
 ; HL  - array of output parameters
"RTN","LA7VHLU",38,0)
 ; INT - DHCP-to-DHCP only
"RTN","LA7VHLU",39,0)
 ;
"RTN","LA7VHLU",40,0)
 K ^TMP("HLS",$J)
"RTN","LA7VHLU",41,0)
 K HL,HLCOMP,HLSUB,HLFS,HLERR,HLMID
"RTN","LA7VHLU",42,0)
 ;
"RTN","LA7VHLU",43,0)
 S LA7101=$O(^ORD(101,"B",LA7EVNT,0))
"RTN","LA7VHLU",44,0)
 D INIT^HLFNC2(LA7101,.HL,0)
"RTN","LA7VHLU",45,0)
 S (LA7FS,HLFS)=$G(HL("FS"))
"RTN","LA7VHLU",46,0)
 S (LA7ECH,HLECH)=$G(HL("ECH"))
"RTN","LA7VHLU",47,0)
 S HLCOMP=$E($G(HL("ECH")),1)
"RTN","LA7VHLU",48,0)
 S HLSUB=$E($G(HL("ECH")),4)
"RTN","LA7VHLU",49,0)
 Q
"RTN","LA7VHLU",50,0)
 ;
"RTN","LA7VHLU",51,0)
 ;
"RTN","LA7VHLU",52,0)
GEN ; Generate HL7 v1.6 message
"RTN","LA7VHLU",53,0)
 ; LA7101 - IEN of event protocol
"RTN","LA7VHLU",54,0)
 ; HLARYTYP - array type
"RTN","LA7VHLU",55,0)
 ; HLFORMAT - HLMA formatted/not formatted
"RTN","LA7VHLU",56,0)
 ; HLMTIEN - IEN in 772 (batch messages)
"RTN","LA7VHLU",57,0)
 ; HLRESLT = message ID^error code^error description
"RTN","LA7VHLU",58,0)
 ; HLP("CONTPTR") - continuation pointer field value
"RTN","LA7VHLU",59,0)
 ; HLP("PRIORITY") - priority field value
"RTN","LA7VHLU",60,0)
 ; HLP("NAMESPACE") - package namespace
"RTN","LA7VHLU",61,0)
 ; 
"RTN","LA7VHLU",62,0)
 N HLEID,HLARYTYP,HLFORMAT,HLMTIEN,HLRESLT,I
"RTN","LA7VHLU",63,0)
 S HLEID=LA7101,HLARYTYP="GM",HLFORMAT=1,HLMTIEN="",HLRESLT=""
"RTN","LA7VHLU",64,0)
 S HLP("NAMESPACE")="LA"
"RTN","LA7VHLU",65,0)
 D GENERATE^HLMA(HLEID,HLARYTYP,HLFORMAT,.HLRESLT,HLMTIEN,.HLP)
"RTN","LA7VHLU",66,0)
 K LA7MID M LA7MID=HLRESLT
"RTN","LA7VHLU",67,0)
 I $P(HLRESLT,"^",2)'="" D CREATE^LA7LOG(23)
"RTN","LA7VHLU",68,0)
 I $O(LA7MID(0)) D
"RTN","LA7VHLU",69,0)
 . S I=0
"RTN","LA7VHLU",70,0)
 . F  S I=$O(LA7MID(I)) Q:'I  I $L($P(LA7MID,"^",2)) S HLRESLT=LA7MID(I) D CREATE^LA7LOG(23)
"RTN","LA7VHLU",71,0)
 K HLP
"RTN","LA7VHLU",72,0)
 Q
"RTN","LA7VHLU",73,0)
 ;
"RTN","LA7VHLU",74,0)
 ;
"RTN","LA7VHLU",75,0)
BUILDSEG(LA7ARRAY,LA7DATA,LA7FS) ; Build HL segment
"RTN","LA7VHLU",76,0)
 ; Call with LA7ARRAY = array containing fields to build into a segment,
"RTN","LA7VHLU",77,0)
 ;                      passed by reference.
"RTN","LA7VHLU",78,0)
 ;            LA7DATA = array used to build segment, pass by reference
"RTN","LA7VHLU",79,0)
 ;                      used to return built segment.
"RTN","LA7VHLU",80,0)
 ;              LA7FS = HL field separator
"RTN","LA7VHLU",81,0)
 ;
"RTN","LA7VHLU",82,0)
 ; Returns         LA7DATA = array with segment built
"RTN","LA7VHLU",83,0)
 ;              LA7DATA(0) = if everything fits on one node
"RTN","LA7VHLU",84,0)
 ;         LA7DATA(0,1...) = multiple elements if >245 characters
"RTN","LA7VHLU",85,0)
 ;
"RTN","LA7VHLU",86,0)
 N LA7I,LA7J,LA7LAST,LA7SUB
"RTN","LA7VHLU",87,0)
 ;
"RTN","LA7VHLU",88,0)
 K LA7DATA
"RTN","LA7VHLU",89,0)
 ;
"RTN","LA7VHLU",90,0)
 S LA7FS=$G(LA7FS)
"RTN","LA7VHLU",91,0)
 ;
"RTN","LA7VHLU",92,0)
 ; Node to store data in array
"RTN","LA7VHLU",93,0)
 S LA7SUB=0
"RTN","LA7VHLU",94,0)
 ;
"RTN","LA7VHLU",95,0)
 ; Last element in array
"RTN","LA7VHLU",96,0)
 S LA7LAST=$O(LA7ARRAY(""),-1)
"RTN","LA7VHLU",97,0)
 ;
"RTN","LA7VHLU",98,0)
 F LA7I=0:1:LA7LAST D
"RTN","LA7VHLU",99,0)
 . I ($L($G(LA7DATA(LA7SUB)))+$L($G(LA7ARRAY(LA7I))))>245 S LA7SUB=LA7SUB+1
"RTN","LA7VHLU",100,0)
 . I $O(LA7ARRAY(LA7I,""))'="" D
"RTN","LA7VHLU",101,0)
 . . S LA7J=""
"RTN","LA7VHLU",102,0)
 . . F  S LA7J=$O(LA7ARRAY(LA7I,LA7J)) Q:LA7J=""  D
"RTN","LA7VHLU",103,0)
 . . . I ($L($G(LA7DATA(LA7SUB)))+$L($G(LA7ARRAY(LA7I,LA7J))))>245 S LA7SUB=LA7SUB+1
"RTN","LA7VHLU",104,0)
 . . . S LA7DATA(LA7SUB)=$G(LA7DATA(LA7SUB))_$G(LA7ARRAY(LA7I,LA7J))
"RTN","LA7VHLU",105,0)
 . S LA7DATA(LA7SUB)=$G(LA7DATA(LA7SUB))_$G(LA7ARRAY(LA7I))_LA7FS
"RTN","LA7VHLU",106,0)
 Q 
"RTN","LA7VHLU",107,0)
 ;
"RTN","LA7VHLU",108,0)
 ;
"RTN","LA7VHLU",109,0)
FILESEG(LA7ROOT,LA7DATA) ; File HL segment in global
"RTN","LA7VHLU",110,0)
 ; Call with  LA7ROOT = global root used to store HL segment
"RTN","LA7VHLU",111,0)
 ;            LA7DATA = array with data to file (pass by reference)
"RTN","LA7VHLU",112,0)
 ;
"RTN","LA7VHLU",113,0)
 N LA7HLSN,LA7I
"RTN","LA7VHLU",114,0)
 I $G(LA7ROOT)="" Q  ; no global root passed.
"RTN","LA7VHLU",115,0)
 ;
"RTN","LA7VHLU",116,0)
 ; get next subscript number
"RTN","LA7VHLU",117,0)
 S LA7HLSN=($O(@(LA7ROOT)@(""),-1))+1
"RTN","LA7VHLU",118,0)
 ;
"RTN","LA7VHLU",119,0)
 ; store first 245 characters of segment
"RTN","LA7VHLU",120,0)
 S @LA7ROOT@(LA7HLSN)=$G(LA7DATA(0))
"RTN","LA7VHLU",121,0)
 ;
"RTN","LA7VHLU",122,0)
 ; if segment >245 characters then store rest of message
"RTN","LA7VHLU",123,0)
 S LA7I=0
"RTN","LA7VHLU",124,0)
 F  S LA7I=$O(LA7DATA(LA7I)) Q:LA7I=""  S @LA7ROOT@(LA7HLSN,LA7I)=LA7DATA(LA7I)
"RTN","LA7VHLU",125,0)
 ;
"RTN","LA7VHLU",126,0)
 Q
"RTN","LA7VHLU",127,0)
 ;
"RTN","LA7VHLU",128,0)
 ;
"RTN","LA7VHLU",129,0)
INIT6249() ; Create stub entry in file #62.49
"RTN","LA7VHLU",130,0)
 ; Returns ien of entry in #62.49 that was created
"RTN","LA7VHLU",131,0)
 ; NOTE: set lock on entry in #62.49, does not release it - calling process should release lock
"RTN","LA7VHLU",132,0)
 ;
"RTN","LA7VHLU",133,0)
 N LA7ERR,LA7FDA,ZERO
"RTN","LA7VHLU",134,0)
 ;
"RTN","LA7VHLU",135,0)
 ; Lock zeroth node of file.
"RTN","LA7VHLU",136,0)
 L +^LAHM(62.49,0):99999
"RTN","LA7VHLU",137,0)
 I '$T Q -1
"RTN","LA7VHLU",138,0)
 ;
"RTN","LA7VHLU",139,0)
 S ZERO=$G(^LAHM(62.49,0))
"RTN","LA7VHLU",140,0)
 F LA76249=$P(ZERO,"^",3):1 I '$D(^LAHM(62.49,LA76249)) D  Q
"RTN","LA7VHLU",141,0)
 . S $P(^LAHM(62.49,LA76249,0),"^")=LA76249,^LAHM(62.49,"B",LA76249,LA76249)=""
"RTN","LA7VHLU",142,0)
 . S $P(ZERO,"^",3)=LA76249,$P(ZERO,"^",4)=$P(ZERO,"^",4)+1,^LAHM(62.49,0)=ZERO
"RTN","LA7VHLU",143,0)
 ;
"RTN","LA7VHLU",144,0)
 ; Unlock zero node
"RTN","LA7VHLU",145,0)
 L -^LAHM(62.49,0)
"RTN","LA7VHLU",146,0)
 ;
"RTN","LA7VHLU",147,0)
 ; Lock entry in file 62.49 - Calling process is responsible for releasing lock when no longer needed.
"RTN","LA7VHLU",148,0)
 L +^LAHM(62.49,LA76249):99999
"RTN","LA7VHLU",149,0)
 I '$T L -^LAHM(62.49,0) Q -1
"RTN","LA7VHLU",150,0)
 ;
"RTN","LA7VHLU",151,0)
 S LA7FDA(1,62.49,LA76249_",",2)="B" ; status =(B)uilding
"RTN","LA7VHLU",152,0)
 S LA7FDA(1,62.49,LA76249_",",4)=$$NOW^XLFDT ; Date/time entered
"RTN","LA7VHLU",153,0)
 D FILE^DIE("","LA7FDA(1)","LA7ERR(1)")
"RTN","LA7VHLU",154,0)
 I $D(LA7ERR) S LA76249=-1
"RTN","LA7VHLU",155,0)
 ;
"RTN","LA7VHLU",156,0)
 Q LA76249
"RTN","LA7VHLU",157,0)
 ;
"RTN","LA7VHLU",158,0)
 ;
"RTN","LA7VHLU",159,0)
FILE6249(LA76249,LA7DATA) ; File HL segment in LAHM(62.49) global
"RTN","LA7VHLU",160,0)
 ; Call with  LA76249 = ien of entry in file # 62.49
"RTN","LA7VHLU",161,0)
 ;            LA7DATA = array with data to file (pass by reference)
"RTN","LA7VHLU",162,0)
 ;
"RTN","LA7VHLU",163,0)
 N LA7I,LA7J,LA7WP
"RTN","LA7VHLU",164,0)
 I '$G(LA76249) Q  ; no entry passed.
"RTN","LA7VHLU",165,0)
 ;
"RTN","LA7VHLU",166,0)
 ; move data in positive number subscripts
"RTN","LA7VHLU",167,0)
 S LA7I="",LA7J=0
"RTN","LA7VHLU",168,0)
 F  S LA7I=$O(LA7DATA(LA7I)) Q:LA7I=""  D
"RTN","LA7VHLU",169,0)
 . S LA7J=LA7J+1
"RTN","LA7VHLU",170,0)
 . S LA7WP(LA7J)=LA7DATA(LA7I)
"RTN","LA7VHLU",171,0)
 ;
"RTN","LA7VHLU",172,0)
 ; set blank line which separates each segment
"RTN","LA7VHLU",173,0)
 S LA7WP(LA7J+1)=""
"RTN","LA7VHLU",174,0)
 ;
"RTN","LA7VHLU",175,0)
 ; file data
"RTN","LA7VHLU",176,0)
 D WP^DIE(62.49,LA76249_",",150,"A","LA7WP")
"RTN","LA7VHLU",177,0)
 Q
"RTN","LA7VHLU",178,0)
 ;
"RTN","LA7VHLU",179,0)
 ;
"RTN","LA7VHLU",180,0)
P(LA7X,LA7P,LA7EC) ; get field LA7P from array (passed by ref.)
"RTN","LA7VHLU",181,0)
 ; Call with  LA7X = array to extract data from, pass by reference.
"RTN","LA7VHLU",182,0)
 ;            LA7P = field to extract
"RTN","LA7VHLU",183,0)
 ;           LA7EC = encoding character separator
"RTN","LA7VHLU",184,0)
 ;
"RTN","LA7VHLU",185,0)
 ; Returns LA7Y = value of requested piece
"RTN","LA7VHLU",186,0)
 ;
"RTN","LA7VHLU",187,0)
 N I,L,LA7Y,L1,Y
"RTN","LA7VHLU",188,0)
 S L=0,Y=1,LA7Y=""
"RTN","LA7VHLU",189,0)
 ;Y=begining piece of each node, L1=number of pieces in each node
"RTN","LA7VHLU",190,0)
 ;L=last piece in each node, quit when last piece is greater than LA7P
"RTN","LA7VHLU",191,0)
 F I=0:1 Q:'$D(LA7X(I))  S L1=$L(LA7X(I),LA7EC),L=L1+Y-1 D  Q:Y>LA7P
"RTN","LA7VHLU",192,0)
 . ;if LA7P is less than last piece, this node has field you want
"RTN","LA7VHLU",193,0)
 . S:LA7P'>L LA7Y=LA7Y_$P(LA7X(I),LA7EC,(LA7P-Y+1))
"RTN","LA7VHLU",194,0)
 . S Y=L
"RTN","LA7VHLU",195,0)
 Q LA7Y
"RTN","LA7VHLU",196,0)
 ;
"RTN","LA7VHLU",197,0)
 ;
"RTN","LA7VHLU",198,0)
PA(LA7X,LA7P,LA7EC,LA7Y) ; get field LA7P from array (passed by ref.)
"RTN","LA7VHLU",199,0)
 ; Call with  LA7X = array to extract data from, pass by reference.
"RTN","LA7VHLU",200,0)
 ;            LA7P = field to extract
"RTN","LA7VHLU",201,0)
 ;           LA7EC = encoding character separator
"RTN","LA7VHLU",202,0)
 ;
"RTN","LA7VHLU",203,0)
 ; Returns LA7Y = array value of requested piece (returned by reference)
"RTN","LA7VHLU",204,0)
 ;
"RTN","LA7VHLU",205,0)
 N I,L,L1,X,Y
"RTN","LA7VHLU",206,0)
 S (L,LA7Y)=0,Y=1
"RTN","LA7VHLU",207,0)
 ;Y=begining piece of each node, L1=number of pieces in each node
"RTN","LA7VHLU",208,0)
 ;L=last piece in each node, quit when last piece is greater than LA7P
"RTN","LA7VHLU",209,0)
 F I=0:1 Q:'$D(LA7X(I))  S L1=$L(LA7X(I),LA7EC),L=L1+Y-1 D  Q:Y>LA7P
"RTN","LA7VHLU",210,0)
 . ;if LA7P is less than last piece, this node has field you want
"RTN","LA7VHLU",211,0)
 . I LA7P'>L S X=$P(LA7X(I),LA7EC,(LA7P-Y+1)) S:X]"" LA7Y=LA7Y+1,LA7Y(LA7Y)=X
"RTN","LA7VHLU",212,0)
 . S Y=L
"RTN","LA7VHLU",213,0)
 Q
"RTN","LA7VHLU",214,0)
 ;
"RTN","LA7VHLU",215,0)
 ;
"RTN","LA7VHLU",216,0)
BLG(LA7ACTN,LA7CHGTY,LA7FS,LA7ECH) ; Build BLG segment -  billing information
"RTN","LA7VHLU",217,0)
 ; Call with  LA7ACTN = billing account Number
"RTN","LA7VHLU",218,0)
 ;           LA7CHGTY = charge type
"RTN","LA7VHLU",219,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VHLU",220,0)
 ;
"RTN","LA7VHLU",221,0)
 ; Returns LA7Y
"RTN","LA7VHLU",222,0)
 ;
"RTN","LA7VHLU",223,0)
 ; Default to CO (contract) for charge type - table 0122
"RTN","LA7VHLU",224,0)
 S LA7CHGTY=$G(LA7CHGTY,"CO")
"RTN","LA7VHLU",225,0)
 S LA7Y="BLG"_LA7FS_LA7FS_LA7CHGTY_LA7FS_$$M11^HLFNC(LA7ACTN,LA7ECH)_LA7FS
"RTN","LA7VHLU",226,0)
 Q LA7Y
"RTN","LA7VHLU",227,0)
 ;
"RTN","LA7VHLU",228,0)
 ;
"RTN","LA7VHLU",229,0)
PTEXTID(LA74,LA7UID,LA7Y) ; Retrieve patient's id that was transmitted by other system.
"RTN","LA7VHLU",230,0)
 ; Used to build PID-2 when returning results to placer.
"RTN","LA7VHLU",231,0)
 ; Looks in file LAB PENDING ORDERS (#69.6) for info pertaining to placer's order.
"RTN","LA7VHLU",232,0)
 ; Call with  LA74 = ien of placer in INSTITUTION file (#4)
"RTN","LA7VHLU",233,0)
 ;          LA7UID = placer's specimen identifier (UID, etc.)
"RTN","LA7VHLU",234,0)
 ;
"RTN","LA7VHLU",235,0)
 ; Returns array LA7Y by reference
"RTN","LA7VHLU",236,0)
 ;               LA7Y("FS")  - original field separator
"RTN","LA7VHLU",237,0)
 ;               LA7Y("ECH") - original encoding characters used
"RTN","LA7VHLU",238,0)
 ;             LA7Y("PID-2") - original PID-2 sequence
"RTN","LA7VHLU",239,0)
 ;             LA7Y("PID-4") - original PID-4 sequence
"RTN","LA7VHLU",240,0)
 ;
"RTN","LA7VHLU",241,0)
 N LA7696,LA7X
"RTN","LA7VHLU",242,0)
 ;
"RTN","LA7VHLU",243,0)
 S LA74=$G(LA74),LA7UID=$G(LA7UID),LA7Y=""
"RTN","LA7VHLU",244,0)
 ;
"RTN","LA7VHLU",245,0)
 ; Return null if no values passed
"RTN","LA7VHLU",246,0)
 I LA74<1!(LA7UID="") Q
"RTN","LA7VHLU",247,0)
 ;
"RTN","LA7VHLU",248,0)
 S LA7696=$O(^LRO(69.6,"RST",LA74,LA7UID,0))
"RTN","LA7VHLU",249,0)
 I LA7696 D
"RTN","LA7VHLU",250,0)
 . S LA7X=$G(^LRO(69.6,LA7696,700))
"RTN","LA7VHLU",251,0)
 . S LA7Y("FS")=$E(LA7X,1)
"RTN","LA7VHLU",252,0)
 . S LA7Y("ECH")=$E(LA7X,2,5)
"RTN","LA7VHLU",253,0)
 . S LA7Y("PID-2")=$G(^LRO(69.6,LA7696,700.02))
"RTN","LA7VHLU",254,0)
 . S LA7Y("PID-4")=$G(^LRO(69.6,LA7696,700.04))
"RTN","LA7VHLU",255,0)
 Q
"RTN","LA7VHLU",256,0)
 ;
"RTN","LA7VHLU",257,0)
 ;
"RTN","LA7VHLU",258,0)
RETOBR(LA74,LA7UID,LA7NLT,LA7Y) ; Retrieve placer's various OBR's that were transmitted by other system.
"RTN","LA7VHLU",259,0)
 ; Used to build OBR-4/17/18 when returning results to placer.
"RTN","LA7VHLU",260,0)
 ; Looks in file LAB PENDING ORDERS (#69.6) for info pertaining to placer's order.
"RTN","LA7VHLU",261,0)
 ;
"RTN","LA7VHLU",262,0)
 ; Call with   LA74 = ien of placer in INSTITUTION file (#4)
"RTN","LA7VHLU",263,0)
 ;           LA7UID = placer's specimen identifier (UID, accession number, etc.)
"RTN","LA7VHLU",264,0)
 ;           LA7NLT = ordered NLT test code
"RTN","LA7VHLU",265,0)
 ;
"RTN","LA7VHLU",266,0)
 ; Returns array LA7Y by reference
"RTN","LA7VHLU",267,0)
 ;               LA7Y("FS")     - original field separator
"RTN","LA7VHLU",268,0)
 ;               LA7Y("ECH")    - original encoding characters used
"RTN","LA7VHLU",269,0)
 ;               LA7Y("OBR-4")  - original OBR-4 sequence
"RTN","LA7VHLU",270,0)
 ;               LA7Y("OBR-17)  - modified info from OBR-17
"RTN","LA7VHLU",271,0)
 ;               LA7Y("OBR-18") - original OBR-18 sequence
"RTN","LA7VHLU",272,0)
 ;               LA7Y("OBR-19") - original OBR-19 sequence
"RTN","LA7VHLU",273,0)
 ;
"RTN","LA7VHLU",274,0)
 N LA7696,LA76964,LA7X
"RTN","LA7VHLU",275,0)
 ;
"RTN","LA7VHLU",276,0)
 S LA74=$G(LA74),LA7UID=$G(LA7UID),LA7Y=""
"RTN","LA7VHLU",277,0)
 ;
"RTN","LA7VHLU",278,0)
 ; Return null if no values passed
"RTN","LA7VHLU",279,0)
 I LA74<1!(LA7UID="")!(LA7NLT="") Q
"RTN","LA7VHLU",280,0)
 ;
"RTN","LA7VHLU",281,0)
 S LA7696=$O(^LRO(69.6,"RST",LA74,LA7UID,0))
"RTN","LA7VHLU",282,0)
 I LA7696<1 Q
"RTN","LA7VHLU",283,0)
 ;
"RTN","LA7VHLU",284,0)
 S LA7X=$G(^LRO(69.6,LA7696,700))
"RTN","LA7VHLU",285,0)
 S LA7Y("FS")=$E(LA7X,1)
"RTN","LA7VHLU",286,0)
 S LA7Y("ECH")=$E(LA7X,2,5)
"RTN","LA7VHLU",287,0)
 ;
"RTN","LA7VHLU",288,0)
 S LA76964=$O(^LRO(69.6,LA7696,2,"C",LA7NLT,0))
"RTN","LA7VHLU",289,0)
 I LA76964<1 Q
"RTN","LA7VHLU",290,0)
 ;
"RTN","LA7VHLU",291,0)
 S LA7Y("OBR-4")=$G(^LRO(69.6,LA7696,2,LA76964,700.04))
"RTN","LA7VHLU",292,0)
 S LA7Y("OBR-17")=$P($G(^LRO(69.6,LA7696,2,LA76964,1)),"^")
"RTN","LA7VHLU",293,0)
 S LA7Y("OBR-18")=$G(^LRO(69.6,LA7696,2,LA76964,700.18))
"RTN","LA7VHLU",294,0)
 S LA7Y("OBR-19")=$G(^LRO(69.6,LA7696,2,LA76964,700.19))
"RTN","LA7VHLU",295,0)
 ;
"RTN","LA7VHLU",296,0)
 Q
"RTN","LA7VHLU2")
0^22^B28776777^B19775199
"RTN","LA7VHLU2",1,0)
LA7VHLU2 ;DALOI/JMC - HL7 Segment Utility ;Aug 20, 2007
"RTN","LA7VHLU2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,61,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VHLU2",3,0)
 ;
"RTN","LA7VHLU2",4,0)
 Q
"RTN","LA7VHLU2",5,0)
 ;
"RTN","LA7VHLU2",6,0)
GETSEG(LA76249,LA7NODE,LA7ARR) ; Returns the next segment from file 62.49
"RTN","LA7VHLU2",7,0)
 ;   during processing of an inbound message. The following variables
"RTN","LA7VHLU2",8,0)
 ;   are used for the processing.
"RTN","LA7VHLU2",9,0)
 ;
"RTN","LA7VHLU2",10,0)
 ; Call with  LA76249 - Entry in 62.49 where message is
"RTN","LA7VHLU2",11,0)
 ;            LA7NODE - Curent ien of "150" wp field
"RTN","LA7VHLU2",12,0)
 ;
"RTN","LA7VHLU2",13,0)
 ; Returns     LA7ARR - Data is returned in LA7ARR(0) and
"RTN","LA7VHLU2",14,0)
 ;                      LA7ARR(n) if segmemt is greater than 245 chars.
"RTN","LA7VHLU2",15,0)
 ;             LA7END - flag that end of message has been reached
"RTN","LA7VHLU2",16,0)
 ;
"RTN","LA7VHLU2",17,0)
 N LA7I,LA7END,LA7QUIT
"RTN","LA7VHLU2",18,0)
 K LA7ARR
"RTN","LA7VHLU2",19,0)
 S LA76249=+$G(LA76249),LA7NODE=$G(LA7NODE,0),(LA7END,LA7QUIT)=0
"RTN","LA7VHLU2",20,0)
 ;
"RTN","LA7VHLU2",21,0)
 S LA7NODE=$O(^LAHM(62.49,LA76249,150,LA7NODE))
"RTN","LA7VHLU2",22,0)
 I 'LA7NODE S LA7END=1
"RTN","LA7VHLU2",23,0)
 E  D
"RTN","LA7VHLU2",24,0)
 . S LA7ARR(0)=$G(^LAHM(62.49,LA76249,150,LA7NODE,0)),LA7I=0
"RTN","LA7VHLU2",25,0)
 . F  S LA7NODE=$O(^LAHM(62.49,LA76249,150,LA7NODE)) Q:'LA7NODE  D  Q:LA7QUIT
"RTN","LA7VHLU2",26,0)
 . . I $G(^LAHM(62.49,LA76249,150,LA7NODE,0))="" S LA7QUIT=1 Q
"RTN","LA7VHLU2",27,0)
 . . S LA7I=LA7I+1,LA7ARR(LA7I)=$G(^LAHM(62.49,LA76249,150,LA7NODE,0))
"RTN","LA7VHLU2",28,0)
 ;
"RTN","LA7VHLU2",29,0)
 Q LA7END
"RTN","LA7VHLU2",30,0)
 ;
"RTN","LA7VHLU2",31,0)
 ;
"RTN","LA7VHLU2",32,0)
FINDSITE(LA7Z,LA7TYPE,LA7SEM) ; Look up an institution in file #4
"RTN","LA7VHLU2",33,0)
 ;
"RTN","LA7VHLU2",34,0)
 ; Call with LA7Z = value to lookup 
"RTN","LA7VHLU2",35,0)
 ;                  VA: "VA"(optional) followed by 3-5 character VA site number
"RTN","LA7VHLU2",36,0)
 ;                  Non-VA uses 3-5 character site assigned identifier
"RTN","LA7VHLU2",37,0)
 ;          LA7TYPE = 1 (host facility)
"RTN","LA7VHLU2",38,0)
 ;                    2 (collection facility)
"RTN","LA7VHLU2",39,0)
 ;
"RTN","LA7VHLU2",40,0)
 ;           LA7SEM = 0 (log error message)
"RTN","LA7VHLU2",41,0)
 ;                    1 (suppress error message)
"RTN","LA7VHLU2",42,0)
 ;
"RTN","LA7VHLU2",43,0)
 ; Returns     LA7Y = ien of entry in INSTITUTION file (#4).
"RTN","LA7VHLU2",44,0)
 ;
"RTN","LA7VHLU2",45,0)
 N LA7X,LA7Y
"RTN","LA7VHLU2",46,0)
 ;
"RTN","LA7VHLU2",47,0)
 S LA7TYPE=$G(LA7TYPE),LA7Z=$G(LA7Z),LA7Y="",LA7SEM=$G(LA7SEM,1)
"RTN","LA7VHLU2",48,0)
 ;
"RTN","LA7VHLU2",49,0)
 ; If VA facility then strip off "VA" before lookup
"RTN","LA7VHLU2",50,0)
 I $E(LA7Z,1,2)="VA" S LA7X=$E(LA7Z,3,$L(LA7Z))
"RTN","LA7VHLU2",51,0)
 E  S LA7X=LA7Z
"RTN","LA7VHLU2",52,0)
 ;
"RTN","LA7VHLU2",53,0)
 ; Lookup in INSTITUTION file (#4)
"RTN","LA7VHLU2",54,0)
 ; If appears to be a VA station number
"RTN","LA7VHLU2",55,0)
 I LA7Z?1(3N,3.4N2U,3N1U1N) S LA7Y=$$IDX^XUAF4("VASTANUM",LA7Z)
"RTN","LA7VHLU2",56,0)
 ; If appears to be a DoD DMIS number
"RTN","LA7VHLU2",57,0)
 I LA7Z?4N S LA7Y=$$IDX^XUAF4("DMIS",LA7Z)
"RTN","LA7VHLU2",58,0)
 ; Else try anything
"RTN","LA7VHLU2",59,0)
 I 'LA7Y S LA7Y=$$FIND1^DIC(4,"","OMX",LA7X)
"RTN","LA7VHLU2",60,0)
 ;
"RTN","LA7VHLU2",61,0)
 ; If unable to find in INSTITUTION file (#4) then try looking in
"RTN","LA7VHLU2",62,0)
 ; SHIPPING CONFIGURATION file (#62.9) using non-VA identifier.
"RTN","LA7VHLU2",63,0)
 ; Check that entry is not a VA facility
"RTN","LA7VHLU2",64,0)
 I LA7Y'>0,LA7X]"" D
"RTN","LA7VHLU2",65,0)
 . N LA7J,LA7K
"RTN","LA7VHLU2",66,0)
 . S LA7J=0
"RTN","LA7VHLU2",67,0)
 . F  S LA7J=$O(^LAHM(62.9,LA7J)) Q:'LA7J  D  Q:LA7Y
"RTN","LA7VHLU2",68,0)
 . . S LA7J(0)=$G(^LAHM(62.9,LA7J,0))
"RTN","LA7VHLU2",69,0)
 . . I $P(LA7J(0),"^",4)'=1 Q  ; Not active
"RTN","LA7VHLU2",70,0)
 . . I $P(LA7J(0),"^",12)'=LA7X Q
"RTN","LA7VHLU2",71,0)
 . . S LA7K=$S(LA7TYPE=1:$P(LA7J(0),"^",3),LA7TYPE=2:$P(LA7J(0),"^",2),1:"")
"RTN","LA7VHLU2",72,0)
 . . I LA7K,$$NVAF(LA7K) S LA7Y=LA7K
"RTN","LA7VHLU2",73,0)
 ;
"RTN","LA7VHLU2",74,0)
 ; No entry found
"RTN","LA7VHLU2",75,0)
 I 'LA7SEM,LA7Y'>0 D
"RTN","LA7VHLU2",76,0)
 . N LA7SITE
"RTN","LA7VHLU2",77,0)
 . S LA7SITE=$S(LA7TYPE=1:"Host",LA7TYPE=2:"Collection",1:"type")_" site: "_$S(LA7Z]"":LA7Z,1:"Blank-no value")
"RTN","LA7VHLU2",78,0)
 . N LA7X,LA7Y,LA7Z
"RTN","LA7VHLU2",79,0)
 . D CREATE^LA7LOG(25)
"RTN","LA7VHLU2",80,0)
 ;
"RTN","LA7VHLU2",81,0)
 Q LA7Y
"RTN","LA7VHLU2",82,0)
 ;
"RTN","LA7VHLU2",83,0)
 ;
"RTN","LA7VHLU2",84,0)
RETFACID(LA7Z,LA7TYPE,LA7SEM) ; (RET)urn (FAC)ility (ID)entifier
"RTN","LA7VHLU2",85,0)
 ;
"RTN","LA7VHLU2",86,0)
 ; Call with LA7Z = ien of entry in INSTITUTION file (#4).
"RTN","LA7VHLU2",87,0)
 ;
"RTN","LA7VHLU2",88,0)
 ;          LA7TYPE = 1 (host facility)
"RTN","LA7VHLU2",89,0)
 ;                    2 (collecting facility)
"RTN","LA7VHLU2",90,0)
 ;
"RTN","LA7VHLU2",91,0)
 ;           LA7SEM = 0 (log error message)
"RTN","LA7VHLU2",92,0)
 ;                    1 (suppress error message)
"RTN","LA7VHLU2",93,0)
 ;
"RTN","LA7VHLU2",94,0)
 ; Returns     LA7Y = VA site number
"RTN","LA7VHLU2",95,0)
 ;                    non-VA site identifier
"RTN","LA7VHLU2",96,0)
 ;
"RTN","LA7VHLU2",97,0)
 N I,LA7NVAF,LA7X,LA7Y
"RTN","LA7VHLU2",98,0)
 S LA7Y="",LA7SEM=$G(LA7SEM,1)
"RTN","LA7VHLU2",99,0)
 ;
"RTN","LA7VHLU2",100,0)
 ; Check identifiers on file.
"RTN","LA7VHLU2",101,0)
 ; If DoD use DMIS code since some DoD also have VA station number.
"RTN","LA7VHLU2",102,0)
 S LA7NVAF=$$NVAF(LA7Z)
"RTN","LA7VHLU2",103,0)
 I LA7NVAF=0 S LA7Y=$$ID^XUAF4("VASTANUM",LA7Z)
"RTN","LA7VHLU2",104,0)
 I LA7NVAF=1 S LA7Y=$$ID^XUAF4("DMIS",LA7Z)
"RTN","LA7VHLU2",105,0)
 ;
"RTN","LA7VHLU2",106,0)
 ; If unable to find in INSTITUTION file (#4) then try looking in
"RTN","LA7VHLU2",107,0)
 ; SHIPPING CONFIGURATION file (#62.9) using non-VA identifier.
"RTN","LA7VHLU2",108,0)
 I LA7Y="" D
"RTN","LA7VHLU2",109,0)
 . N LA7J
"RTN","LA7VHLU2",110,0)
 . S LA7J=0
"RTN","LA7VHLU2",111,0)
 . F  S LA7J=$O(^LAHM(62.9,LA7J)) Q:'LA7J  D
"RTN","LA7VHLU2",112,0)
 . . S LA7J(0)=$G(^LAHM(62.9,LA7J,0))
"RTN","LA7VHLU2",113,0)
 . . I $P(LA7J(0),"^",4)'=1 Q  ; Not active
"RTN","LA7VHLU2",114,0)
 . . I LA7TYPE=1,LA7Z=$P(LA7J(0),"^",3) S LA7Y=$P(LA7J(0),"^",12)
"RTN","LA7VHLU2",115,0)
 . . I LA7TYPE=2,LA7Z=$P(LA7J(0),"^",2) S LA7Y=$P(LA7J(0),"^",12)
"RTN","LA7VHLU2",116,0)
 . I LA7Y'="" S LA7Y=$$UP^XLFSTR(LA7Y)
"RTN","LA7VHLU2",117,0)
 ;
"RTN","LA7VHLU2",118,0)
 ; No entry found
"RTN","LA7VHLU2",119,0)
 I 'LA7SEM,LA7Y="" D
"RTN","LA7VHLU2",120,0)
 . N LA7SITE
"RTN","LA7VHLU2",121,0)
 . S LA7SITE=$S(LA7TYPE=1:"Host",LA7TYPE=2:"Collection",1:"type")_" site: "_$$GET1^DIQ(4,LA7Z_",",.01)
"RTN","LA7VHLU2",122,0)
 . N LA7X,LA7Y
"RTN","LA7VHLU2",123,0)
 . D CREATE^LA7LOG(25)
"RTN","LA7VHLU2",124,0)
 ;
"RTN","LA7VHLU2",125,0)
 Q LA7Y
"RTN","LA7VHLU2",126,0)
 ;
"RTN","LA7VHLU2",127,0)
 ;
"RTN","LA7VHLU2",128,0)
FNDOLOC(LRUID) ; Find ordering location
"RTN","LA7VHLU2",129,0)
 ; Call with LRUID = Accession's UID
"RTN","LA7VHLU2",130,0)
 ; Returns    LA7Y = ordering location^ordering institution
"RTN","LA7VHLU2",131,0)
 ;
"RTN","LA7VHLU2",132,0)
 N LRAA,LRAD,LRAN,LA7X,LA7Y,X,Y
"RTN","LA7VHLU2",133,0)
 ;
"RTN","LA7VHLU2",134,0)
 S LA7Y=""
"RTN","LA7VHLU2",135,0)
 S X=$Q(^LRO(68,"C",LRUID))
"RTN","LA7VHLU2",136,0)
 I $QS(X,3)'=LRUID Q LA7Y
"RTN","LA7VHLU2",137,0)
 S LA7X=$P($G(^LRO(68,$QS(X,4),1,$QS(X,5),1,$QS(X,6),0)),"^",13)
"RTN","LA7VHLU2",138,0)
 I 'LA7X Q LA7Y
"RTN","LA7VHLU2",139,0)
 D GETS^DIQ(44,LA7X_",",".01;3","EI","LA7Y")
"RTN","LA7VHLU2",140,0)
 S LA7Y=LA7X_"^"_LA7Y(44,LA7X_",",.01,"E")_"^"_LA7Y(44,LA7X_",",3,"I")_"^"_LA7Y(44,LA7X_",",3,"E")
"RTN","LA7VHLU2",141,0)
 Q LA7Y
"RTN","LA7VHLU2",142,0)
 ;
"RTN","LA7VHLU2",143,0)
 ;
"RTN","LA7VHLU2",144,0)
CHKICN(LA7X) ; Lookup patient using ICN
"RTN","LA7VHLU2",145,0)
 ; Call with LA7X = patient's ICN
"RTN","LA7VHLU2",146,0)
 ; Returns   LA7Y = patient's DFN^full ICN
"RTN","LA7VHLU2",147,0)
 ;                  -1^error message
"RTN","LA7VHLU2",148,0)
 ;
"RTN","LA7VHLU2",149,0)
 ; Note - until MPI can handle full ICN (number,"V" and checksum) as lookup value
"RTN","LA7VHLU2",150,0)
 ; then confirm if full ICN passed in with full ICN from MPI.
"RTN","LA7VHLU2",151,0)
 ;
"RTN","LA7VHLU2",152,0)
 N LA7Y,LA7Z
"RTN","LA7VHLU2",153,0)
 ;
"RTN","LA7VHLU2",154,0)
 S (LA7Y,LA7Z)=""
"RTN","LA7VHLU2",155,0)
 S LA7X(1)=$P(LA7X,"V")
"RTN","LA7VHLU2",156,0)
 S LA7X(2)=$P(LA7X,"V",2)
"RTN","LA7VHLU2",157,0)
 I LA7X(2)="" S LA7Y=$$GETDFN^MPIF001(LA7X(1))
"RTN","LA7VHLU2",158,0)
 E  D
"RTN","LA7VHLU2",159,0)
 . S LA7Y=$$GETDFN^MPIF001(LA7X(1))
"RTN","LA7VHLU2",160,0)
 . S LA7Z=$$GETICN^MPIF001(LA7Y)
"RTN","LA7VHLU2",161,0)
 . I LA7X'=LA7Z S LA7Y="-1^Not a valid ICN"
"RTN","LA7VHLU2",162,0)
 ;
"RTN","LA7VHLU2",163,0)
 Q LA7Y_"^"_LA7Z
"RTN","LA7VHLU2",164,0)
 ;
"RTN","LA7VHLU2",165,0)
 ;
"RTN","LA7VHLU2",166,0)
NVAF(LA7X) ; Set flag sending to non-VA facility.
"RTN","LA7VHLU2",167,0)
 ; Used to code certain segments for other systems, i.e. CHCS-DOD.
"RTN","LA7VHLU2",168,0)
 ; Call with LA7X = ien of institution in file #4
"RTN","LA7VHLU2",169,0)
 ; Returns   LA7Y = 0 (VA facility)
"RTN","LA7VHLU2",170,0)
 ;                  1 (DoD facility - Army, Navy, Air Force)
"RTN","LA7VHLU2",171,0)
 ;                  2 (Indian Health Service)
"RTN","LA7VHLU2",172,0)
 ;                  3 (Other - non US Government)
"RTN","LA7VHLU2",173,0)
 ;
"RTN","LA7VHLU2",174,0)
 N LA7Y
"RTN","LA7VHLU2",175,0)
 S LA7Y=""
"RTN","LA7VHLU2",176,0)
 I LA7X S LA7Y=$$GET1^DIQ(4,LA7X_",",95,"I")
"RTN","LA7VHLU2",177,0)
 S LA7Y=$S(LA7Y="N":1,LA7Y="AF":1,LA7Y="ARMY":1,LA7Y="I":2,LA7Y="O":3,1:0)
"RTN","LA7VHLU2",178,0)
 Q LA7Y
"RTN","LA7VHLU2",179,0)
 ;
"RTN","LA7VHLU2",180,0)
 ;
"RTN","LA7VHLU2",181,0)
FACDNS(LA74,LA7FS,LA7ECH,LA7LV) ; Build facility DNS identifer
"RTN","LA7VHLU2",182,0)
 ; Call with LA74 = pointer to entry in INSITUTION file (#4)
"RTN","LA7VHLU2",183,0)
 ;          LA7FS = HL field separator
"RTN","LA7VHLU2",184,0)
 ;         LA7ECH = HL encoding characters
"RTN","LA7VHLU2",185,0)
 ;          LA7LV = field (1)/ component (2) level in message
"RTN","LA7VHLU2",186,0)
 ;
"RTN","LA7VHLU2",187,0)
 ; Returns   LA7Y = STA#~STA-NAME~DNS
"RTN","LA7VHLU2",188,0)
 ;
"RTN","LA7VHLU2",189,0)
 N LA7DN,LA7FAC,LA7NVAF,LA7Y
"RTN","LA7VHLU2",190,0)
 S LA7Y=""
"RTN","LA7VHLU2",191,0)
 ;
"RTN","LA7VHLU2",192,0)
 ; Retrieve saved valued
"RTN","LA7VHLU2",193,0)
 I $D(^TMP($J,"LA7VHLU","INST-DNS",LA74,LA7FS_LA7ECH,LA7LV)) S LA7Y=^TMP($J,"LA7VHLU","INST-DNS",LA74,LA7FS_LA7ECH,LA7LV)
"RTN","LA7VHLU2",194,0)
 ;
"RTN","LA7VHLU2",195,0)
 ; Retrieve station# or DMIS code for VA/DoD facilities.
"RTN","LA7VHLU2",196,0)
 ; Others leave blank for now (Jun 2005)
"RTN","LA7VHLU2",197,0)
 ; Retrieve domain name for this institution.
"RTN","LA7VHLU2",198,0)
 ; Build component and save for other parts of message building
"RTN","LA7VHLU2",199,0)
 I LA7Y="" D
"RTN","LA7VHLU2",200,0)
 . S LA7FAC="",LA7NVAF=$$NVAF(LA74)
"RTN","LA7VHLU2",201,0)
 . I LA7NVAF<2 S LA7FAC=$$ID^XUAF4($S(LA7NVAF=1:"DMIS",1:"VASTANUM"),LA74)
"RTN","LA7VHLU2",202,0)
 . S LA7Y=LA7FAC
"RTN","LA7VHLU2",203,0)
 . S LA7DN=$$WHAT^XUAF4(LA74,60)
"RTN","LA7VHLU2",204,0)
 . I LA7DN'="" S LA7DN=$$CHKDATA^LA7VHLU3(LA7DN,LA7FS_LA7ECH),LA7Y=LA7FAC_$S(LA7LV=1:$E(LA7ECH),1:$E(LA7ECH,4))_LA7DN_$S(LA7LV=1:$E(LA7ECH),1:$E(LA7ECH,4))_"DNS"
"RTN","LA7VHLU2",205,0)
 . S ^TMP($J,"LA7VHLU","INST-DNS",LA74,LA7FS_LA7ECH,LA7LV)=LA7Y
"RTN","LA7VHLU2",206,0)
 ;
"RTN","LA7VHLU2",207,0)
 Q LA7Y
"RTN","LA7VHLU3")
0^6^B55573792^B15291257
"RTN","LA7VHLU3",1,0)
LA7VHLU3 ;DALOI/JMC - HL7 Segment Utility ;Jan 29, 2009
"RTN","LA7VHLU3",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VHLU3",3,0)
 ;
"RTN","LA7VHLU3",4,0)
 Q
"RTN","LA7VHLU3",5,0)
 ;
"RTN","LA7VHLU3",6,0)
NTE(LA7ARRAY,LA7TXT,LA7TYP,LA7FS,LA7ECH,LA7NTESN,LA7CMTYP,LA7FMT) ; Build NTE segment -  notes and comments
"RTN","LA7VHLU3",7,0)
 ; Call with LA7ARRAY = array to return NTE segment, pass by reference
"RTN","LA7VHLU3",8,0)
 ;             LA7TXT = text to send (by value if format=0, by reference if format>0)
"RTN","LA7VHLU3",9,0)
 ;             LA7TYP = source of comment - HL table 0105 Default to L (ancilliary/filler)
"RTN","LA7VHLU3",10,0)
 ;              LA7FS = HL field separator
"RTN","LA7VHLU3",11,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VHLU3",12,0)
 ;           LA7NTESN = segment SET ID (pass by reference)
"RTN","LA7VHLU3",13,0)
 ;           LA7CMTYP = comment type code (HL table 0364)
"RTN","LA7VHLU3",14,0)
 ;             LA7FMT = format of text (0=single, 1=multi-line formatted text, 2=multi-line repetition)
"RTN","LA7VHLU3",15,0)
 ;
"RTN","LA7VHLU3",16,0)
 N LA7CTYPE,LA7NTE,LA7TEXT
"RTN","LA7VHLU3",17,0)
 ;
"RTN","LA7VHLU3",18,0)
 S LA7FS=$G(LA7FS),LA7TXT=$G(LA7TXT),(LA7CTYPE,LA7TEXT)="",LA7FMT=$G(LA7FMT)
"RTN","LA7VHLU3",19,0)
 ;
"RTN","LA7VHLU3",20,0)
 ; Remove leading "~" from comments and escape encode text
"RTN","LA7VHLU3",21,0)
 I 'LA7FMT D
"RTN","LA7VHLU3",22,0)
 . I $E(LA7TXT,1)="~" S LA7TXT=$$TRIM^XLFSTR(LA7TXT,"L","~")
"RTN","LA7VHLU3",23,0)
 . S LA7TXT=$$TRIM^XLFSTR(LA7TXT,"R"," ")
"RTN","LA7VHLU3",24,0)
 . S LA7TEXT=$$CHKDATA^LA7VHLU3(LA7TXT,LA7FS_LA7ECH)
"RTN","LA7VHLU3",25,0)
 ;
"RTN","LA7VHLU3",26,0)
 I LA7FMT>0 D
"RTN","LA7VHLU3",27,0)
 . N LA7I
"RTN","LA7VHLU3",28,0)
 . S LA7I=0
"RTN","LA7VHLU3",29,0)
 . F  S LA7I=$O(LA7TXT(LA7I)) Q:'LA7I  D
"RTN","LA7VHLU3",30,0)
 . . I $E(LA7TXT(LA7I),1)="~" S LA7TXT(LA7I)=$$TRIM^XLFSTR(LA7TXT(LA7I),"L","~")
"RTN","LA7VHLU3",31,0)
 . . S LA7TXT(LA7I)=$$TRIM^XLFSTR(LA7TXT(LA7I),"R"," ")
"RTN","LA7VHLU3",32,0)
 . . S LA7TXT(LA7I)=$$CHKDATA^LA7VHLU3(LA7TXT(LA7I),LA7FS_LA7ECH)
"RTN","LA7VHLU3",33,0)
 . . I LA7FMT=1 S LA7TEXT(LA7I)=LA7TEXT_$S(LA7I>1:$E(LA7ECH,3)_".br"_$E(LA7ECH,3),1:"")_LA7TXT(LA7I) Q
"RTN","LA7VHLU3",34,0)
 . . I LA7FMT=2 S LA7TEXT(LA7I)=LA7TEXT_LA7TXT(LA7I)_$E(LA7ECH,2) Q
"RTN","LA7VHLU3",35,0)
 ;
"RTN","LA7VHLU3",36,0)
 ; Update segment SET ID
"RTN","LA7VHLU3",37,0)
 S LA7NTESN=$G(LA7NTESN)+1
"RTN","LA7VHLU3",38,0)
 ;
"RTN","LA7VHLU3",39,0)
 ; Default source of comment if undefined
"RTN","LA7VHLU3",40,0)
 I $G(LA7TYP)="" S LA7TYP="L"
"RTN","LA7VHLU3",41,0)
 ;
"RTN","LA7VHLU3",42,0)
 ; Encode HL7 table 0364 with comment type
"RTN","LA7VHLU3",43,0)
 ; If no type passed then default to REmark
"RTN","LA7VHLU3",44,0)
 ; If 'code' not found in table then send 'code' in text (2nd component).
"RTN","LA7VHLU3",45,0)
 I $G(LA7CMTYP)="" S LA7CMTYP="RE"
"RTN","LA7VHLU3",46,0)
 I '$D(^TMP($J,"HL70364")) D HL70364
"RTN","LA7VHLU3",47,0)
 S LA7X=$G(^TMP($J,"HL70364",LA7CMTYP))
"RTN","LA7VHLU3",48,0)
 I LA7X="" S $P(LA7CTYPE,$E(LA7ECH,1),2)=$$CHKDATA^LA7VHLU3(LA7CMTYP,LA7FS_LA7ECH)
"RTN","LA7VHLU3",49,0)
 E  D
"RTN","LA7VHLU3",50,0)
 . S LA7CTYPE=LA7CMTYP
"RTN","LA7VHLU3",51,0)
 . S $P(LA7CTYPE,$E(LA7ECH,1),2)=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VHLU3",52,0)
 . S $P(LA7CTYPE,$E(LA7ECH,1),3)="HL70364"
"RTN","LA7VHLU3",53,0)
 ;
"RTN","LA7VHLU3",54,0)
 S LA7NTE(0)="NTE"
"RTN","LA7VHLU3",55,0)
 S LA7NTE(1)=LA7NTESN
"RTN","LA7VHLU3",56,0)
 S LA7NTE(2)=LA7TYP
"RTN","LA7VHLU3",57,0)
 M LA7NTE(3)=LA7TEXT
"RTN","LA7VHLU3",58,0)
 S LA7NTE(4)=LA7CTYPE
"RTN","LA7VHLU3",59,0)
 ;
"RTN","LA7VHLU3",60,0)
 D BUILDSEG^LA7VHLU(.LA7NTE,.LA7ARRAY,LA7FS)
"RTN","LA7VHLU3",61,0)
 ;
"RTN","LA7VHLU3",62,0)
 Q
"RTN","LA7VHLU3",63,0)
 ;
"RTN","LA7VHLU3",64,0)
 ;
"RTN","LA7VHLU3",65,0)
CHKDATA(LA7IN,LA7CH) ; Check data to be built into an HL7 field for characters that
"RTN","LA7VHLU3",66,0)
 ; conflict with encoding characters. Convert conflicting character using HL7 escape encoding.
"RTN","LA7VHLU3",67,0)
 ;
"RTN","LA7VHLU3",68,0)
 ; Call with LA7IN = data to be checked
"RTN","LA7VHLU3",69,0)
 ;           LA7CH = HL7 delimiters to check for
"RTN","LA7VHLU3",70,0)
 ;
"RTN","LA7VHLU3",71,0)
 ; Returns LA7OUT - checked data, converted if appropriate
"RTN","LA7VHLU3",72,0)
 ;
"RTN","LA7VHLU3",73,0)
 N J,LA7ESC,LA7LEN,LA7OUT,X
"RTN","LA7VHLU3",74,0)
 ;
"RTN","LA7VHLU3",75,0)
 S LA7IN=$G(LA7IN),LA7CH=$G(LA7CH),LA7OUT=""
"RTN","LA7VHLU3",76,0)
 ;
"RTN","LA7VHLU3",77,0)
 I LA7IN=""!(LA7CH="") Q LA7OUT
"RTN","LA7VHLU3",78,0)
 ;
"RTN","LA7VHLU3",79,0)
 ; Build array of encoding characters to check
"RTN","LA7VHLU3",80,0)
 S LA7LEN=$L(LA7CH),LA7ESC=$E(LA7CH,4)
"RTN","LA7VHLU3",81,0)
 F J=1:1:LA7LEN S LA7CH($E(LA7CH,J))=$E("FSRET",J)
"RTN","LA7VHLU3",82,0)
 ;
"RTN","LA7VHLU3",83,0)
 ; Check each character and convert if appropiate
"RTN","LA7VHLU3",84,0)
 F J=1:1:$L(LA7IN) D
"RTN","LA7VHLU3",85,0)
 . S X=$E(LA7IN,J)
"RTN","LA7VHLU3",86,0)
 . I $D(LA7CH(X)) S X=LA7ESC_LA7CH(X)_LA7ESC
"RTN","LA7VHLU3",87,0)
 . S LA7OUT=LA7OUT_X
"RTN","LA7VHLU3",88,0)
 ;
"RTN","LA7VHLU3",89,0)
 Q LA7OUT
"RTN","LA7VHLU3",90,0)
 ;
"RTN","LA7VHLU3",91,0)
 ;
"RTN","LA7VHLU3",92,0)
CNVFLD(LA7IN,LA7ECH1,LA7ECH2) ; Convert an encoded HL7 segment/field from one encoding scheme to another
"RTN","LA7VHLU3",93,0)
 ; Call with   LA7IN = data to be converted
"RTN","LA7VHLU3",94,0)
 ;           LA7ECH1 = delimiters of input
"RTN","LA7VHLU3",95,0)
 ;           LA7ECH2 = delimiters of output
"RTN","LA7VHLU3",96,0)
 ;
"RTN","LA7VHLU3",97,0)
 ; Returns LA7OUT - segment/field converted to new encoding scheme
"RTN","LA7VHLU3",98,0)
 ;
"RTN","LA7VHLU3",99,0)
 N J,LA7ECH,LA7ESC,LA7OUT,X
"RTN","LA7VHLU3",100,0)
 ;
"RTN","LA7VHLU3",101,0)
 S LA7IN=$G(LA7IN),LA7ECH1=$G(LA7ECH1),LA7ECH2=$G(LA7ECH2),LA7OUT=""
"RTN","LA7VHLU3",102,0)
 ;
"RTN","LA7VHLU3",103,0)
 I LA7IN=""!(LA7ECH1="")!(LA7ECH2="") Q LA7OUT
"RTN","LA7VHLU3",104,0)
 ;
"RTN","LA7VHLU3",105,0)
 ; Abort if input encoding length greater than output
"RTN","LA7VHLU3",106,0)
 I $L(LA7ECH1)>$L(LA7ECH2) Q LA7OUT
"RTN","LA7VHLU3",107,0)
 ;
"RTN","LA7VHLU3",108,0)
 ; If same then return input as output
"RTN","LA7VHLU3",109,0)
 I LA7ECH1=LA7ECH2 Q LA7IN
"RTN","LA7VHLU3",110,0)
 ;
"RTN","LA7VHLU3",111,0)
 S LA7ESC=$E(LA7ECH2,4)
"RTN","LA7VHLU3",112,0)
 ;
"RTN","LA7VHLU3",113,0)
 ; Build array to convert source encoding to target encoding
"RTN","LA7VHLU3",114,0)
 F J=1:1:$L(LA7ECH1) S LA7ECH($E(LA7ECH1,J))=$E(LA7ECH2,J)
"RTN","LA7VHLU3",115,0)
 ;
"RTN","LA7VHLU3",116,0)
 ; Check each character and convert if appropiate
"RTN","LA7VHLU3",117,0)
 ; If source conflicts with target encoding character then convert to escape encoding
"RTN","LA7VHLU3",118,0)
 ; If match on source encoding character - convert to new encoding
"RTN","LA7VHLU3",119,0)
 F J=1:1:$L(LA7IN) D
"RTN","LA7VHLU3",120,0)
 . S X=$E(LA7IN,J)
"RTN","LA7VHLU3",121,0)
 . I '$D(LA7ECH(X)),LA7ECH2[X S X=LA7ESC_$E("FSRET",($F(LA7ECH2,X)-1))_LA7ESC
"RTN","LA7VHLU3",122,0)
 . I $D(LA7ECH(X)) S X=LA7ECH(X)
"RTN","LA7VHLU3",123,0)
 . S LA7OUT=LA7OUT_X
"RTN","LA7VHLU3",124,0)
 ;
"RTN","LA7VHLU3",125,0)
 Q LA7OUT
"RTN","LA7VHLU3",126,0)
 ;
"RTN","LA7VHLU3",127,0)
 ;
"RTN","LA7VHLU3",128,0)
UNESC(LA7X,LA7CH) ; Unescape data using HL7 escape encoding
"RTN","LA7VHLU3",129,0)
 ; Call with  LA7X = string to decode
"RTN","LA7VHLU3",130,0)
 ;           LA7CH = HL7 delimiters (both field separator & encoding characters)
"RTN","LA7VHLU3",131,0)
 ;
"RTN","LA7VHLU3",132,0)
 ; Returns string of unencoded data.
"RTN","LA7VHLU3",133,0)
 ;
"RTN","LA7VHLU3",134,0)
 N J,LA7ESC
"RTN","LA7VHLU3",135,0)
 ;
"RTN","LA7VHLU3",136,0)
 ; If data does not contain escape encoding then return input string as output
"RTN","LA7VHLU3",137,0)
 S LA7ESC=$E(LA7CH,4)
"RTN","LA7VHLU3",138,0)
 I LA7X'[LA7ESC Q LA7X
"RTN","LA7VHLU3",139,0)
 ;
"RTN","LA7VHLU3",140,0)
 ; Build array of encoding characters to replace
"RTN","LA7VHLU3",141,0)
 F J=1:1:$L(LA7CH) S LA7CH(LA7ESC_$E("FSRET",J)_LA7ESC)=$E(LA7CH,J)
"RTN","LA7VHLU3",142,0)
 ;
"RTN","LA7VHLU3",143,0)
 Q $$REPLACE^XLFSTR(LA7X,.LA7CH)
"RTN","LA7VHLU3",144,0)
 ;
"RTN","LA7VHLU3",145,0)
 ;
"RTN","LA7VHLU3",146,0)
UNESCFT(LA7X,LA7CH,LA7Y) ; Unescape formatted text data using HL7 escape encoding
"RTN","LA7VHLU3",147,0)
 ; Call with  LA7X = array to decode (pass by reference)
"RTN","LA7VHLU3",148,0)
 ;           LA7CH = HL7 delimiters (both field separator & encoding characters)
"RTN","LA7VHLU3",149,0)
 ;
"RTN","LA7VHLU3",150,0)
 ; Returns    LA7Y =  array of unencoded data.
"RTN","LA7VHLU3",151,0)
 ;
"RTN","LA7VHLU3",152,0)
 N J,K,LA7ESC,LA7I,LA7Z,SAVX,SAVY,Z
"RTN","LA7VHLU3",153,0)
 ;
"RTN","LA7VHLU3",154,0)
 S J=0,LA7ESC=$E(LA7CH,$L(LA7CH)-1),(LA7I,SAVX,SAVY)=""
"RTN","LA7VHLU3",155,0)
 F  S LA7I=$O(LA7X(LA7I)) Q:LA7I=""  D
"RTN","LA7VHLU3",156,0)
 . S J=J+1
"RTN","LA7VHLU3",157,0)
 . I LA7X(LA7I)'[LA7ESC,SAVY="" S LA7Y(J,0)=LA7X(LA7I) Q
"RTN","LA7VHLU3",158,0)
 . F K=1:1:$L(LA7X(LA7I)) D
"RTN","LA7VHLU3",159,0)
 . . S Z=$E(LA7X(LA7I),K)
"RTN","LA7VHLU3",160,0)
 . . I Z=LA7ESC D  Q
"RTN","LA7VHLU3",161,0)
 . . . I SAVY="" S SAVY=Z Q
"RTN","LA7VHLU3",162,0)
 . . . S SAVY=SAVY_Z
"RTN","LA7VHLU3",163,0)
 . . . I $P(SAVY,LA7ESC,2)=".br" S LA7Y(J,0)=$S(SAVX]"":SAVX,1:" "),SAVX="",J=J+1
"RTN","LA7VHLU3",164,0)
 . . . I $E(SAVY,2)'="." S SAVX=SAVX_$$UNESC(SAVY,LA7CH)
"RTN","LA7VHLU3",165,0)
 . . . S SAVY=""
"RTN","LA7VHLU3",166,0)
 . . I SAVY]"" S SAVY=SAVY_Z Q
"RTN","LA7VHLU3",167,0)
 . . S SAVX=SAVX_Z
"RTN","LA7VHLU3",168,0)
 . S LA7Y(J,0)=SAVX,SAVX=""
"RTN","LA7VHLU3",169,0)
 S LA7Y=J
"RTN","LA7VHLU3",170,0)
 ;
"RTN","LA7VHLU3",171,0)
 Q
"RTN","LA7VHLU3",172,0)
 ;
"RTN","LA7VHLU3",173,0)
 ;
"RTN","LA7VHLU3",174,0)
HL70364 ; Build HL7 table 0364 - Comment Type
"RTN","LA7VHLU3",175,0)
 ;
"RTN","LA7VHLU3",176,0)
 S ^TMP($J,"HL70364","PI")="Patient Instructions"
"RTN","LA7VHLU3",177,0)
 S ^TMP($J,"HL70364","AI")="Ancillary Instructions"
"RTN","LA7VHLU3",178,0)
 S ^TMP($J,"HL70364","GI")="General Instructions"
"RTN","LA7VHLU3",179,0)
 S ^TMP($J,"HL70364","1R")="Primary Reason"
"RTN","LA7VHLU3",180,0)
 S ^TMP($J,"HL70364","2R")="Secondary Reason"
"RTN","LA7VHLU3",181,0)
 S ^TMP($J,"HL70364","GR")="General Reason"
"RTN","LA7VHLU3",182,0)
 S ^TMP($J,"HL70364","RE")="Remark"
"RTN","LA7VHLU3",183,0)
 S ^TMP($J,"HL70364","DR")="Duplicate/Interaction Reason"
"RTN","LA7VHLU3",184,0)
 S ^TMP($J,"HL70364","VA-LR001")="Order Comment"
"RTN","LA7VHLU3",185,0)
 S ^TMP($J,"HL70364","VA-LR002")="Result Comment"
"RTN","LA7VHLU3",186,0)
 S ^TMP($J,"HL70364","VA-LR003")="Result Interpretation"
"RTN","LA7VHLU3",187,0)
 S ^TMP($J,"HL70364","VA-LRMI001")="Comment on Specimen (#.99)"
"RTN","LA7VHLU3",188,0)
 S ^TMP($J,"HL70364","VA-LRMI010")="Bact Rpt Remark (#13)"
"RTN","LA7VHLU3",189,0)
 S ^TMP($J,"HL70364","VA-LRMI011")="Preliminary Bact Comment (#1)"
"RTN","LA7VHLU3",190,0)
 S ^TMP($J,"HL70364","VA-LRMI012")="Bacteriology Test(s) (#1.5)"
"RTN","LA7VHLU3",191,0)
 S ^TMP($J,"HL70364","VA-LRMI013")="Bacteriology Smear/Prep (#11.7)"
"RTN","LA7VHLU3",192,0)
 S ^TMP($J,"HL70364","VA-LRMI020")="Parasite Rpt Remark (#17)"
"RTN","LA7VHLU3",193,0)
 S ^TMP($J,"HL70364","VA-LRMI021")="Preliminary Parasite Comment (#16.5)"
"RTN","LA7VHLU3",194,0)
 S ^TMP($J,"HL70364","VA-LRMI022")="Parasite Test(s) (16.4)"
"RTN","LA7VHLU3",195,0)
 S ^TMP($J,"HL70364","VA-LRMI023")="Parasitology Smear/Prep (#15.51)"
"RTN","LA7VHLU3",196,0)
 S ^TMP($J,"HL70364","VA-LRMI030")="Mycology RPT Remark (#21)"
"RTN","LA7VHLU3",197,0)
 S ^TMP($J,"HL70364","VA-LRMI031")="Preliminary Mycology Comment (#20.5)"
"RTN","LA7VHLU3",198,0)
 S ^TMP($J,"HL70364","VA-LRMI032")="Mycology Test(s) (#20.4)"
"RTN","LA7VHLU3",199,0)
 S ^TMP($J,"HL70364","VA-LRMI033")="Mycology Smear/Prep (#19.6)"
"RTN","LA7VHLU3",200,0)
 S ^TMP($J,"HL70364","VA-LRMI040")="TB Rpt Remark (#27)"
"RTN","LA7VHLU3",201,0)
 S ^TMP($J,"HL70364","VA-LRMI041")="Preliminary TB Comment (#26.5)"
"RTN","LA7VHLU3",202,0)
 S ^TMP($J,"HL70364","VA-LRMI042")="TB Test(s) (#26.4)"
"RTN","LA7VHLU3",203,0)
 S ^TMP($J,"HL70364","VA-LRMI050")="Virology Rpt Remark (#37)"
"RTN","LA7VHLU3",204,0)
 S ^TMP($J,"HL70364","VA-LRMI051")="Preliminary Virology Comment (#36.5)"
"RTN","LA7VHLU3",205,0)
 S ^TMP($J,"HL70364","VA-LRMI052")="Virology Test (#36.4)"
"RTN","LA7VHLU3",206,0)
 Q
"RTN","LA7VHLU3",207,0)
 ;
"RTN","LA7VHLU3",208,0)
 ;
"RTN","LA7VHLU3",209,0)
PCENC(LRDFN,LRSS,LRIDT) ; Find PCE encounter for an entry in file #63
"RTN","LA7VHLU3",210,0)
 ;
"RTN","LA7VHLU3",211,0)
 ; Call with LRDFN = entry in file #63
"RTN","LA7VHLU3",212,0)
 ;            LRSS = file #63 subscript
"RTN","LA7VHLU3",213,0)
 ;           LRIDT = inverse date/time of specimen in file #63
"RTN","LA7VHLU3",214,0)
 ;
"RTN","LA7VHLU3",215,0)
 ; Returns   LA7ENC = related PCE encounter
"RTN","LA7VHLU3",216,0)
 ;
"RTN","LA7VHLU3",217,0)
 N LA7ENC,LA7UID,LA7X,LA7Y,LRODT,LRSN
"RTN","LA7VHLU3",218,0)
 S LA7ENC="",LA7UID=$P($G(^LR(LRDFN,LRSS,LRIDT,"ORU")),"^")
"RTN","LA7VHLU3",219,0)
 I LA7UID'="" D
"RTN","LA7VHLU3",220,0)
 . S LA7X=$$CHECKUID^LRWU4(LA7UID)
"RTN","LA7VHLU3",221,0)
 . I 'LA7X Q
"RTN","LA7VHLU3",222,0)
 . S LA7Y=$G(^LRO(68,$P(LA7X,"^",2),1,$P(LA7X,"^",3),1,$P(LA7X,"^",4),0))
"RTN","LA7VHLU3",223,0)
 . S LRODT=+$P(LA7Y,"^",4),LRSN=+$P(LA7Y,"^",5)
"RTN","LA7VHLU3",224,0)
 . I $P(LA7Y,"^",2)=2,LRODT,LRSN S LA7ENC=$G(^LRO(69,LRODT,1,LRSN,"PCE"))
"RTN","LA7VHLU3",225,0)
 ; 
"RTN","LA7VHLU3",226,0)
 Q LA7ENC
"RTN","LA7VHLU3",227,0)
 ;
"RTN","LA7VHLU3",228,0)
 ;
"RTN","LA7VHLU3",229,0)
SDENC(LA7PCE) ; Find SD Outpatient Encounter for an entry in file #63
"RTN","LA7VHLU3",230,0)
 ;
"RTN","LA7VHLU3",231,0)
 ; Call with LA7PCE = PCE encounters from file #69
"RTN","LA7VHLU3",232,0)
 ;
"RTN","LA7VHLU3",233,0)
 ; Returns   LA7ENC = related SD encounter
"RTN","LA7VHLU3",234,0)
 ;
"RTN","LA7VHLU3",235,0)
 N LA7ENC,LA7X,LA7Y,LA7Z
"RTN","LA7VHLU3",236,0)
 ;
"RTN","LA7VHLU3",237,0)
 S LA7ENC=""
"RTN","LA7VHLU3",238,0)
 F LA7I=1:1 S LA7X=$P(LA7PCE,";",LA7I) Q:LA7X=""  D  Q:LA7ENC'=""
"RTN","LA7VHLU3",239,0)
 . K LA7Y
"RTN","LA7VHLU3",240,0)
 . D LISTVST^SDOERPC(.LA7Y,LA7X)
"RTN","LA7VHLU3",241,0)
 . S LA7Z=$Q(@LA7Y)
"RTN","LA7VHLU3",242,0)
 . I $QS(LA7Z,1)="SD ENCOUNTER LIST",$QS(LA7Z,2)=$J S LA7ENC=$QS(LA7Z,3)
"RTN","LA7VHLU3",243,0)
 . K @LA7Y
"RTN","LA7VHLU3",244,0)
 ;
"RTN","LA7VHLU3",245,0)
 Q LA7ENC
"RTN","LA7VHLU4")
0^24^B25782007^B25336667
"RTN","LA7VHLU4",1,0)
LA7VHLU4 ;DALOI/JMC - HL7 segment builder utility ;Aug 6, 2008
"RTN","LA7VHLU4",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VHLU4",3,0)
 ;
"RTN","LA7VHLU4",4,0)
 ;
"RTN","LA7VHLU4",5,0)
INST(LA74,LA7FS,LA7ECH) ; Build institution field
"RTN","LA7VHLU4",6,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VHLU4",7,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VHLU4",8,0)
 ;            LA7FS = HL field separator
"RTN","LA7VHLU4",9,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VHLU4",10,0)
 ;
"RTN","LA7VHLU4",11,0)
 ; Returns facility that performed the testing (ID^text^99VA4)
"RTN","LA7VHLU4",12,0)
 ;
"RTN","LA7VHLU4",13,0)
 N LA7NVAF,LA7X,LA7Y,LA7Z
"RTN","LA7VHLU4",14,0)
 ;
"RTN","LA7VHLU4",15,0)
 S LA74=$G(LA74),LA7ECH=$G(LA7ECH),LA7Y=""
"RTN","LA7VHLU4",16,0)
 ;
"RTN","LA7VHLU4",17,0)
 ; If no institution, use Kernel Site default
"RTN","LA7VHLU4",18,0)
 I LA74="" S LA74=+$$KSP^XUPARAM("INST")
"RTN","LA7VHLU4",19,0)
 ;
"RTN","LA7VHLU4",20,0)
 ; Check if this field has been built previously for this institution
"RTN","LA7VHLU4",21,0)
 I LA74'="",$D(^TMP($J,"LA7VHLU","99VA4",LA74,LA7FS_LA7ECH)) S LA7Y=^TMP($J,"LA7VHLU","99VA4",LA74,LA7FS_LA7ECH)
"RTN","LA7VHLU4",22,0)
 ;
"RTN","LA7VHLU4",23,0)
 ; Value passed not a pointer - only build 2nd component
"RTN","LA7VHLU4",24,0)
 I LA7Y="",LA74'="",LA74'=+LA74 D
"RTN","LA7VHLU4",25,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=$$CHKDATA^LA7VHLU3(LA74,LA7FS_LA7ECH)
"RTN","LA7VHLU4",26,0)
 ;
"RTN","LA7VHLU4",27,0)
 I LA7Y="",LA74>0,LA74=+LA74 D
"RTN","LA7VHLU4",28,0)
 . S LA7NVAF=$$NVAF^LA7VHLU2(LA74)
"RTN","LA7VHLU4",29,0)
 . ; Build id - VA station #/DMIS code
"RTN","LA7VHLU4",30,0)
 . I LA7NVAF<2 S LA7Y=$$ID^XUAF4($S(LA7NVAF=1:"DMIS",1:"VASTANUM"),LA74)
"RTN","LA7VHLU4",31,0)
 . ; Build name using field #100, otherwise #.01
"RTN","LA7VHLU4",32,0)
 . S LA7Z=$$NAME^XUAF4(LA74)
"RTN","LA7VHLU4",33,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VHLU4",34,0)
 . ;
"RTN","LA7VHLU4",35,0)
 . S $P(LA7Y,$E(LA7ECH,1),3)="99VA4"
"RTN","LA7VHLU4",36,0)
 ;
"RTN","LA7VHLU4",37,0)
 ; Save this field to TMP global to use for subsequent calls.
"RTN","LA7VHLU4",38,0)
 S ^TMP($J,"LA7VHLU","99VA4",LA74,LA7FS_LA7ECH)=LA7Y
"RTN","LA7VHLU4",39,0)
 ;
"RTN","LA7VHLU4",40,0)
 Q LA7Y
"RTN","LA7VHLU4",41,0)
 ;
"RTN","LA7VHLU4",42,0)
 ;
"RTN","LA7VHLU4",43,0)
XAD(LA7FN,LA7DA,LA7DT,LA7FS,LA7ECH) ; Build extended address
"RTN","LA7VHLU4",44,0)
 ; Call with LA7FN = Source File number
"RTN","LA7VHLU4",45,0)
 ;                   Presently file #2 (PATIENT), #4 (INSTITUTION) or #200 (NEW PERSON)
"RTN","LA7VHLU4",46,0)
 ;           LA7DA = Entry in source file
"RTN","LA7VHLU4",47,0)
 ;           LA7DT = As of date in FileMan format
"RTN","LA7VHLU4",48,0)
 ;           LA7FS = HL field separator
"RTN","LA7VHLU4",49,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VHLU4",50,0)
 ;
"RTN","LA7VHLU4",51,0)
 ; Returns extended address
"RTN","LA7VHLU4",52,0)
 ;
"RTN","LA7VHLU4",53,0)
 N LA7X,LA7Y,LA7Z
"RTN","LA7VHLU4",54,0)
 ;
"RTN","LA7VHLU4",55,0)
 S LA7Y=""
"RTN","LA7VHLU4",56,0)
 ;
"RTN","LA7VHLU4",57,0)
 ; Check if this field has been built previously for this institution
"RTN","LA7VHLU4",58,0)
 I LA7FN,LA7DA,$D(^TMP($J,"LA7VHLU","99VA4A",LA7FN,LA7DA,LA7FS_LA7ECH)) S LA7Y=^TMP($J,"LA7VHLU","99VA4A",LA7FN,LA7DA,LA7FS_LA7ECH)
"RTN","LA7VHLU4",59,0)
 ;
"RTN","LA7VHLU4",60,0)
 ; Build from file #2
"RTN","LA7VHLU4",61,0)
 I LA7Y="",LA7FN=2,LA7DA D
"RTN","LA7VHLU4",62,0)
 . N DFN,VAHOW,VAPA,VAERR,VAROOT,VATEST
"RTN","LA7VHLU4",63,0)
 . S DFN=LA7DA
"RTN","LA7VHLU4",64,0)
 . I LA7DT S (VATEST("ADD",9),VATEST("ADD",10))=LA7DT
"RTN","LA7VHLU4",65,0)
 . D ADD^VADPT
"RTN","LA7VHLU4",66,0)
 . I VAERR Q
"RTN","LA7VHLU4",67,0)
 . S $P(LA7Y,$E(LA7ECH),1)=$$CHKDATA^LA7VHLU3(VAPA(1),LA7FS_LA7ECH)
"RTN","LA7VHLU4",68,0)
 . S $P(LA7Y,$E(LA7ECH),2)=$$CHKDATA^LA7VHLU3(VAPA(2),LA7FS_LA7ECH)
"RTN","LA7VHLU4",69,0)
 . S $P(LA7Y,$E(LA7ECH),3)=$$CHKDATA^LA7VHLU3(VAPA(4),LA7FS_LA7ECH)
"RTN","LA7VHLU4",70,0)
 . S $P(LA7Y,$E(LA7ECH),4)=$$CHKDATA^LA7VHLU3($P(VAPA(5),"^",2),LA7FS_LA7ECH)
"RTN","LA7VHLU4",71,0)
 . S $P(LA7Y,$E(LA7ECH),5)=$$CHKDATA^LA7VHLU3(VAPA(11),LA7FS_LA7ECH)
"RTN","LA7VHLU4",72,0)
 . I VAPA(9) S $P(LA7Y,$E(LA7ECH),7)="C"
"RTN","LA7VHLU4",73,0)
 . E  S $P(LA7Y,$E(LA7ECH),7)="P"
"RTN","LA7VHLU4",74,0)
 . S $P(LA7Y,$E(LA7ECH),9)=$$CHKDATA^LA7VHLU3($P(VAPA(7),"^",2),LA7FS_LA7ECH)
"RTN","LA7VHLU4",75,0)
 ;
"RTN","LA7VHLU4",76,0)
 ; Get address info from file #4, add 2nd address line
"RTN","LA7VHLU4",77,0)
 ;  change state to pointer to file #5
"RTN","LA7VHLU4",78,0)
 I LA7Y="",LA7FN=4,LA7DA D
"RTN","LA7VHLU4",79,0)
 . S LA7Z=$$PADD^XUAF4(LA7DA)
"RTN","LA7VHLU4",80,0)
 . S LA7X=$P(LA7Z,"^"),$P(LA7X,"^",2)=$$WHAT^XUAF4(LA7DA,1.02)
"RTN","LA7VHLU4",81,0)
 . F I=1,2 I $P(LA7X,"^",I)'="" S $P(LA7X,"^",I)=$$CHKDATA^LA7VHLU3($P(LA7X,"^",I),LA7FS_LA7ECH)
"RTN","LA7VHLU4",82,0)
 . S LA7Z=$P(LA7Z,"^",2,4),$P(LA7Z,"^",2)=$$GET1^DIQ(4,LA7DA_",",.02,"I")
"RTN","LA7VHLU4",83,0)
 . S $P(LA7Z,"^")=$$CHKDATA^LA7VHLU3($P(LA7Z,"^"),LA7FS_LA7ECH)
"RTN","LA7VHLU4",84,0)
 . S LA7Y=$$HLADDR^HLFNC(LA7X,LA7Z,LA7ECH)
"RTN","LA7VHLU4",85,0)
 ;
"RTN","LA7VHLU4",86,0)
 I LA7Y="",LA7FN=200,LA7DA D
"RTN","LA7VHLU4",87,0)
 . Q
"RTN","LA7VHLU4",88,0)
 ;
"RTN","LA7VHLU4",89,0)
 ; Save this field to TMP global to use for subsequent calls.
"RTN","LA7VHLU4",90,0)
 I LA7Y'="" S ^TMP($J,"LA7VHLU","99VA4A",LA7FN,LA7DA,LA7FS_LA7ECH)=LA7Y
"RTN","LA7VHLU4",91,0)
 ;
"RTN","LA7VHLU4",92,0)
 Q LA7Y
"RTN","LA7VHLU4",93,0)
 ;
"RTN","LA7VHLU4",94,0)
 ;
"RTN","LA7VHLU4",95,0)
XON(LA7FN,LA7DA,LA7TYP,LA7FS,LA7ECH) ; Build extended composite name/id for organization
"RTN","LA7VHLU4",96,0)
 ; Call with LA7FN = Source File number
"RTN","LA7VHLU4",97,0)
 ;                   Presently #4 (INSTITUTION)
"RTN","LA7VHLU4",98,0)
 ;           LA7DA = Entry in source file
"RTN","LA7VHLU4",99,0)
 ;          LA7TYP = type of identifer (0/null=station #, 1=CLIA)
"RTN","LA7VHLU4",100,0)
 ;           LA7FS = HL field separator
"RTN","LA7VHLU4",101,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VHLU4",102,0)
 ;           
"RTN","LA7VHLU4",103,0)
 ;
"RTN","LA7VHLU4",104,0)
 N LA7X,LA7Y,LA7Z
"RTN","LA7VHLU4",105,0)
 ;
"RTN","LA7VHLU4",106,0)
 S LA7Y="",LA7TYP=+$G(LA7TYP)
"RTN","LA7VHLU4",107,0)
 ;
"RTN","LA7VHLU4",108,0)
 ; Check if this field has been built previously for this institution
"RTN","LA7VHLU4",109,0)
 I LA7FN,LA7DA,$D(^TMP($J,"LA7VHLU","99VA4N",LA7FN,LA7DA,LA7TYP,LA7FS_LA7ECH)) S LA7Y=^TMP($J,"LA7VHLU","99VA4N",LA7FN,LA7DA,LA7TYP,LA7FS_LA7ECH)
"RTN","LA7VHLU4",110,0)
 ;
"RTN","LA7VHLU4",111,0)
 ; Build name using field #100, otherwise #.01
"RTN","LA7VHLU4",112,0)
 ; Send facility id in 3rd component if numeric - conform to standard.
"RTN","LA7VHLU4",113,0)
 I LA7Y="",LA7FN=4,LA7DA D
"RTN","LA7VHLU4",114,0)
 . S LA7Z(1)=$P($$NS^XUAF4(LA7DA),"^"),LA7Z(2)=$$WHAT^XUAF4(LA7DA,100)
"RTN","LA7VHLU4",115,0)
 . S $P(LA7Y,$E(LA7ECH,1),1)=$$CHKDATA^LA7VHLU3(LA7Z(1),LA7FS_LA7ECH)
"RTN","LA7VHLU4",116,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)="D"
"RTN","LA7VHLU4",117,0)
 . S LA7X=$$RETFACID^LA7VHLU2(LA7DA,2,1)
"RTN","LA7VHLU4",118,0)
 . I LA7X'="" D
"RTN","LA7VHLU4",119,0)
 . . I LA7X?1.N S $P(LA7Y,$E(LA7ECH,1),3)=LA7X
"RTN","LA7VHLU4",120,0)
 . . S $P(LA7Y,$E(LA7ECH,1),10)=LA7X
"RTN","LA7VHLU4",121,0)
 . S $P(LA7Y,$E(LA7ECH,1),6)="USVHA"
"RTN","LA7VHLU4",122,0)
 . S $P(LA7Y,$E(LA7ECH,1),7)="FI"
"RTN","LA7VHLU4",123,0)
 . S $P(LA7Y,$E(LA7ECH,1),9)="A"
"RTN","LA7VHLU4",124,0)
 . I LA7Z(2)'="" D
"RTN","LA7VHLU4",125,0)
 . . S $P(LA7Y,$E(LA7ECH,1),1)=$$CHKDATA^LA7VHLU3(LA7Z(2),LA7FS_LA7ECH)
"RTN","LA7VHLU4",126,0)
 . . S $P(LA7Y,$E(LA7ECH,1),2)="L"
"RTN","LA7VHLU4",127,0)
 . I LA7TYP=1 D
"RTN","LA7VHLU4",128,0)
 . . S LA7X=$$ID^XUAF4("CLIA",LA7DA) Q:LA7X=""
"RTN","LA7VHLU4",129,0)
 . . S $P(LA7Y,$E(LA7ECH,1),3)=""
"RTN","LA7VHLU4",130,0)
 . . S $P(LA7Y,$E(LA7ECH,1),6)="CLIA"
"RTN","LA7VHLU4",131,0)
 . . S $P(LA7Y,$E(LA7ECH,1),7)="LN"
"RTN","LA7VHLU4",132,0)
 . . S $P(LA7Y,$E(LA7ECH,1),10)=LA7X
"RTN","LA7VHLU4",133,0)
 ;
"RTN","LA7VHLU4",134,0)
 ; Save this field to TMP global to use for subsequent calls.
"RTN","LA7VHLU4",135,0)
 I LA7Y'="" S ^TMP($J,"LA7VHLU","99VA4N",LA7FN,LA7DA,LA7TYP,LA7FS_LA7ECH)=LA7Y
"RTN","LA7VHLU4",136,0)
 ;
"RTN","LA7VHLU4",137,0)
 Q LA7Y
"RTN","LA7VHLU4",138,0)
 ;
"RTN","LA7VHLU4",139,0)
 ;
"RTN","LA7VHLU4",140,0)
XCNTFM(LA7X,LA7ECH) ; Resolve XCN data type to FileMan (last name, first name, mi [id])
"RTN","LA7VHLU4",141,0)
 ; Call with LA7X = HL7 field containing name
"RTN","LA7VHLU4",142,0)
 ;         LA7ECH = HL7 encoding characters
"RTN","LA7VHLU4",143,0)
 ;
"RTN","LA7VHLU4",144,0)
 ; Returns   LA7Y = ID code^DUZ^FileMan name (DUZ=0 if name not found on local system).
"RTN","LA7VHLU4",145,0)
 ; Stub until all calls can be converted to call XCNTFM^LA7VHLU9
"RTN","LA7VHLU4",146,0)
 ;
"RTN","LA7VHLU4",147,0)
 Q $$XCNTFM^LA7VHLU9(LA7X,LA7ECH)
"RTN","LA7VHLU4",148,0)
 ;
"RTN","LA7VHLU4",149,0)
 ;
"RTN","LA7VHLU4",150,0)
PLTFM(LA7PL,LA7ECH) ; Resolve location from PL (person location) data type.
"RTN","LA7VHLU4",151,0)
 ; Call with LA7PL = HL7 field containing person location
"RTN","LA7VHLU4",152,0)
 ;          LA7ECH = HL7 encoding characters
"RTN","LA7VHLU4",153,0)
 ;
"RTN","LA7VHLU4",154,0)
 ; Returns    LA7Y = file #44 ien^name field (#.01)^division(institution)
"RTN","LA7VHLU4",155,0)
 ;
"RTN","LA7VHLU4",156,0)
 N LA7X,LA7Y,X,Y
"RTN","LA7VHLU4",157,0)
 S LA7X=$P(LA7PL,$E(LA7ECH)),(LA7Y,Y)=""
"RTN","LA7VHLU4",158,0)
 I LA7X?1.N S Y=$$GET1^DIQ(44,LA7X_",",.01)
"RTN","LA7VHLU4",159,0)
 ; If not ien try as name
"RTN","LA7VHLU4",160,0)
 I Y="" D
"RTN","LA7VHLU4",161,0)
 . S X=$$FIND1^DIC(44,"","X",LA7X,"B")
"RTN","LA7VHLU4",162,0)
 . I X S Y=LA7X,LA7X=X
"RTN","LA7VHLU4",163,0)
 I Y'="" S LA7Y=LA7X_"^"_Y
"RTN","LA7VHLU4",164,0)
 E  I $P(LA7PL,$E(LA7ECH),2)'="" S LA7Y="^"_$P(LA7PL,$E(LA7ECH),2)
"RTN","LA7VHLU4",165,0)
 ;
"RTN","LA7VHLU4",166,0)
 ; Process division (institution) - pass 1st sub-component of 4th component
"RTN","LA7VHLU4",167,0)
 S LA7X=$P(LA7PL,$E(LA7ECH),4)
"RTN","LA7VHLU4",168,0)
 S LA7X=$P(LA7X,$E(LA7ECH,4))
"RTN","LA7VHLU4",169,0)
 S Y=""
"RTN","LA7VHLU4",170,0)
 I LA7X'="" S Y=$$FINDSITE^LA7VHLU2(LA7X,1,1)
"RTN","LA7VHLU4",171,0)
 S $P(LA7Y,"^",3)=Y
"RTN","LA7VHLU4",172,0)
 ;
"RTN","LA7VHLU4",173,0)
 Q LA7Y
"RTN","LA7VHLU5")
0^5^B49053645^B40473983
"RTN","LA7VHLU5",1,0)
LA7VHLU5 ;DALOI/JMC - HL7 segment builder utility ;May 12, 2008
"RTN","LA7VHLU5",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VHLU5",3,0)
 ;
"RTN","LA7VHLU5",4,0)
 ; Reference to ^DD supported by DBIA #999
"RTN","LA7VHLU5",5,0)
 ;
"RTN","LA7VHLU5",6,0)
DEFCODE(LRSS,LRSB,LA7CODE,LA761) ; Determine default codes when data is not mapped
"RTN","LA7VHLU5",7,0)
 ;
"RTN","LA7VHLU5",8,0)
 ; Call with  LRSS = file #63 subscript
"RTN","LA7VHLU5",9,0)
 ;            LRSB = file #63 dataname/location
"RTN","LA7VHLU5",10,0)
 ;         LA7CODE = current codes stored with data (order nlt!result nlt!loinc code!method suffix)
"RTN","LA7VHLU5",11,0)
 ;           LA761 = specimen, pointer to file #61
"RTN","LA7VHLU5",12,0)
 ;
"RTN","LA7VHLU5",13,0)
 N I,LA760,LA7DFCDE,LA7MISS,LA7NLT,LA7X,LA7Y
"RTN","LA7VHLU5",14,0)
 ;
"RTN","LA7VHLU5",15,0)
 I LA7CODE="" S LA7CODE="!!!"
"RTN","LA7VHLU5",16,0)
 ;
"RTN","LA7VHLU5",17,0)
 ; Replace any missing codes with defaults
"RTN","LA7VHLU5",18,0)
 ; If no missing codes then return codes passed in.
"RTN","LA7VHLU5",19,0)
 S LA7MISS=""
"RTN","LA7VHLU5",20,0)
 F I=1:1:3 I $P(LA7CODE,"!",I)="" S $P(LA7MISS,"^",I)=I
"RTN","LA7VHLU5",21,0)
 ;
"RTN","LA7VHLU5",22,0)
 I LA7MISS'="" D
"RTN","LA7VHLU5",23,0)
 . I LRSS="CH" D CHSUB Q
"RTN","LA7VHLU5",24,0)
 . I LRSS="MI" D MISUB Q
"RTN","LA7VHLU5",25,0)
 . I LRSS="SP" D SPSUB Q
"RTN","LA7VHLU5",26,0)
 . I LRSS="CY" D CYSUB Q
"RTN","LA7VHLU5",27,0)
 . I LRSS="EM" D EMSUB Q
"RTN","LA7VHLU5",28,0)
 ;
"RTN","LA7VHLU5",29,0)
 Q LA7CODE
"RTN","LA7VHLU5",30,0)
 ;
"RTN","LA7VHLU5",31,0)
 ;
"RTN","LA7VHLU5",32,0)
CHSUB ; Determine codes for CH subscript.
"RTN","LA7VHLU5",33,0)
 ;
"RTN","LA7VHLU5",34,0)
 ; Find a file #60 test which uses this dataname. Since there can be
"RTN","LA7VHLU5",35,0)
 ; multiple tests check each until an order and result NLT code is found.
"RTN","LA7VHLU5",36,0)
 S LA760=0
"RTN","LA7VHLU5",37,0)
 F  S LA760=$O(^LAB(60,"C",LRSS_";"_LRSB_";1",LA760)) Q:'LA760  D
"RTN","LA7VHLU5",38,0)
 . ; Default order NLT
"RTN","LA7VHLU5",39,0)
 . I $P(LA7MISS,"^") D
"RTN","LA7VHLU5",40,0)
 . . S LA7X=$$NLT^LRVER1(LA760)
"RTN","LA7VHLU5",41,0)
 . . I LA7X'="" S $P(LA7CODE,"!")=LA7X,$P(LA7MISS,"^")=""
"RTN","LA7VHLU5",42,0)
 . ; Default result NLT
"RTN","LA7VHLU5",43,0)
 . I $P(LA7MISS,"^",2) D
"RTN","LA7VHLU5",44,0)
 . . S LA7X=+$P($G(^LAB(60,LA760,64)),"^",2),LA7Y=""
"RTN","LA7VHLU5",45,0)
 . . I LA7X S LA7Y=$$GET1^DIQ(64,LA7X_",",1)
"RTN","LA7VHLU5",46,0)
 . . I LA7Y'="" S $P(LA7CODE,"!",2)=LA7Y,$P(LA7MISS,"^",2)=""
"RTN","LA7VHLU5",47,0)
 ;
"RTN","LA7VHLU5",48,0)
 ; If no result NLT code then use order NLT as default
"RTN","LA7VHLU5",49,0)
 I $P(LA7CODE,"!",2)="" S $P(LA7CODE,"!",2)=$P(LA7CODE,"!")
"RTN","LA7VHLU5",50,0)
 ;
"RTN","LA7VHLU5",51,0)
 ; If no order NLT code found on file #60 entries then use this default
"RTN","LA7VHLU5",52,0)
 I $P(LA7CODE,"!")="" S $P(LA7CODE,"!")="81323.0000"
"RTN","LA7VHLU5",53,0)
 ;
"RTN","LA7VHLU5",54,0)
 ; Default result LOINC code based on result NLT code
"RTN","LA7VHLU5",55,0)
 ; If none on NLT result code then try order NLT code
"RTN","LA7VHLU5",56,0)
 I $P(LA7MISS,"^",3) D
"RTN","LA7VHLU5",57,0)
 . S LA7NLT=$P(LA7CODE,"!",2),LA7X=""
"RTN","LA7VHLU5",58,0)
 . I LA7NLT'="" S LA7X=$$LNC^LRVER1(LA7NLT,$P(LA7CODE,"!",4),LA761)
"RTN","LA7VHLU5",59,0)
 . I LA7X S $P(LA7CODE,"!",3)=LA7X Q
"RTN","LA7VHLU5",60,0)
 . S LA7NLT=$P(LA7CODE,"!"),LA7X=""
"RTN","LA7VHLU5",61,0)
 . I LA7NLT'="" S LA7X=$$LNC^LRVER1(LA7NLT,$P(LA7CODE,"!",4),LA761)
"RTN","LA7VHLU5",62,0)
 . I LA7X S $P(LA7CODE,"!",3)=LA7X
"RTN","LA7VHLU5",63,0)
 ;
"RTN","LA7VHLU5",64,0)
 Q
"RTN","LA7VHLU5",65,0)
 ;
"RTN","LA7VHLU5",66,0)
 ;
"RTN","LA7VHLU5",67,0)
MISUB ; Determine codes for MI subscript
"RTN","LA7VHLU5",68,0)
 ;
"RTN","LA7VHLU5",69,0)
 ; Bacteriology report
"RTN","LA7VHLU5",70,0)
 I LRSB=11 S LA7DFCDE="87993.0000^93928.0000^" D DEFAULT Q
"RTN","LA7VHLU5",71,0)
 ;
"RTN","LA7VHLU5",72,0)
 ; Urine Screen
"RTN","LA7VHLU5",73,0)
 I LRSB=11.57 S LA7DFCDE="87993.0000^93949.0000^630" D DEFAULT Q
"RTN","LA7VHLU5",74,0)
 ; 
"RTN","LA7VHLU5",75,0)
 ; Sputum screen
"RTN","LA7VHLU5",76,0)
 I LRSB=11.58 S LA7DFCDE="87993.0000^93948.0000^6460" D DEFAULT Q
"RTN","LA7VHLU5",77,0)
 ; 
"RTN","LA7VHLU5",78,0)
 ; Gram stain
"RTN","LA7VHLU5",79,0)
 I LRSB=11.6 S LA7DFCDE="87993.0000^87754.0000^664" D DEFAULT Q
"RTN","LA7VHLU5",80,0)
 ;
"RTN","LA7VHLU5",81,0)
 ; Bacteriology organism
"RTN","LA7VHLU5",82,0)
 I LRSB=12 S LA7DFCDE="87993.0000^87570.0000^11475" D DEFAULT Q
"RTN","LA7VHLU5",83,0)
 ;
"RTN","LA7VHLU5",84,0)
 ; Bacteria colony count
"RTN","LA7VHLU5",85,0)
 I +LRSB=12,$P(LRSB,",",2)=1 S LA7DFCDE="^87719.0000^564" D DEFAULT Q
"RTN","LA7VHLU5",86,0)
 ;
"RTN","LA7VHLU5",87,0)
 ; Parasite report
"RTN","LA7VHLU5",88,0)
 I LRSB=14 S LA7DFCDE="87505.0000^93929.0000^" D DEFAULT Q
"RTN","LA7VHLU5",89,0)
 ;
"RTN","LA7VHLU5",90,0)
 ; Parasite organism 
"RTN","LA7VHLU5",91,0)
 I LRSB=16 S LA7DFCDE="87505.0000^87576.0000^17784" D DEFAULT Q
"RTN","LA7VHLU5",92,0)
 ;
"RTN","LA7VHLU5",93,0)
 ; Mycology report
"RTN","LA7VHLU5",94,0)
 I LRSB=18 S LA7DFCDE="87994.0000^93930.0000^" D DEFAULT Q
"RTN","LA7VHLU5",95,0)
 ;
"RTN","LA7VHLU5",96,0)
 ; Fungal organism
"RTN","LA7VHLU5",97,0)
 I LRSB=20 S LA7DFCDE="87994.0000^87578.0000^580" D DEFAULT Q
"RTN","LA7VHLU5",98,0)
 ;
"RTN","LA7VHLU5",99,0)
 ; Fungal colony count
"RTN","LA7VHLU5",100,0)
 I +LRSB=20,$P(LRSB,",",2)=1 S LA7DFCDE="87994.0000^87723.0000^19101" D DEFAULT Q
"RTN","LA7VHLU5",101,0)
 ;
"RTN","LA7VHLU5",102,0)
 ; Mycobacterium report
"RTN","LA7VHLU5",103,0)
 I LRSB=22 S LA7DFCDE="87995.0000^93931.0000^" D DEFAULT Q
"RTN","LA7VHLU5",104,0)
 ;
"RTN","LA7VHLU5",105,0)
 ; Acid Fast stain
"RTN","LA7VHLU5",106,0)
 I LRSB=24 S LA7DFCDE="87995.0000^87756.0000^11545" D DEFAULT Q
"RTN","LA7VHLU5",107,0)
 ;
"RTN","LA7VHLU5",108,0)
 ; Acid Fast stain quantity
"RTN","LA7VHLU5",109,0)
 I LRSB=25 S LA7DFCDE="87995.0000^87583.0000^" D DEFAULT Q
"RTN","LA7VHLU5",110,0)
 ;
"RTN","LA7VHLU5",111,0)
 ; Mycobacterium organism
"RTN","LA7VHLU5",112,0)
 I +LRSB=26,'$P(LRSB,",",2) S LA7DFCDE="87995.0000^87589.0000^543" D DEFAULT Q
"RTN","LA7VHLU5",113,0)
 ;
"RTN","LA7VHLU5",114,0)
 ; Mycobacterium colony count
"RTN","LA7VHLU5",115,0)
 I +LRSB=26,$P(LRSB,",",2)=1 S LA7DFCDE="87995.0000^87719.0000^564" D DEFAULT Q
"RTN","LA7VHLU5",116,0)
 ;
"RTN","LA7VHLU5",117,0)
 ; Bact or TB organism's susceptibilities
"RTN","LA7VHLU5",118,0)
 I ($P(LRSB,",")=12!($P(LRSB,",")=26)),$P(LRSB,",",2)>2,$P(LRSB,",",2)<2.999 D  Q
"RTN","LA7VHLU5",119,0)
 . I +LRSB=12 D
"RTN","LA7VHLU5",120,0)
 . . S LA7DFCDE="87565.0000^^"
"RTN","LA7VHLU5",121,0)
 . . S LA7X=$O(^LAB(62.06,"AD",$P(LRSB,",",2),0)) Q:'LA7X
"RTN","LA7VHLU5",122,0)
 . . I $P(LA7MISS,"^",2) S $P(LA7DFCDE,"^",2)=$$GET1^DIQ(62.06,LA7X_",","64:1")
"RTN","LA7VHLU5",123,0)
 . I +LRSB=26 D
"RTN","LA7VHLU5",124,0)
 . . S LA7DFCDE="87568.0000^^"
"RTN","LA7VHLU5",125,0)
 . . N Y
"RTN","LA7VHLU5",126,0)
 . . S LA7X=$P(LRSB,",",2),Y=$O(^DD(63.39,"GL",LA7X,1,0))
"RTN","LA7VHLU5",127,0)
 . . I Y<1 Q
"RTN","LA7VHLU5",128,0)
 . . S $P(LA7DFCDE,"^",2)=$S(Y=5:"93635.0000",Y=10:"93620.0000",Y=15:"93657.0000",Y=20:"93634.0000",Y=25:"93659.0000",Y=30:"93618.0000",Y=35:"93616.0000",Y=40:"93617.0000",Y=45:"93626.0000",Y=50:"93641.0000",Y=55:"93534.0000",1:"")
"RTN","LA7VHLU5",129,0)
 . D DEFAULT
"RTN","LA7VHLU5",130,0)
 ;
"RTN","LA7VHLU5",131,0)
 ; Virology report
"RTN","LA7VHLU5",132,0)
 I LRSB=33 S LA7DFCDE="87996.0000^93932.0000^^" D DEFAULT Q
"RTN","LA7VHLU5",133,0)
 ;
"RTN","LA7VHLU5",134,0)
 ; Viral agent
"RTN","LA7VHLU5",135,0)
 I $P(LRSB,",")=36 S LA7DFCDE="87996.0000^87590.0000^6584" D DEFAULT Q
"RTN","LA7VHLU5",136,0)
 ;
"RTN","LA7VHLU5",137,0)
 Q
"RTN","LA7VHLU5",138,0)
 ;
"RTN","LA7VHLU5",139,0)
 ;
"RTN","LA7VHLU5",140,0)
SPSUB ; Determine codes for SP subscript
"RTN","LA7VHLU5",141,0)
 ;
"RTN","LA7VHLU5",142,0)
 ; specimens
"RTN","LA7VHLU5",143,0)
 I $P(LRSB,",")=.012!(LRSB=10) S LA7DFCDE="88515.0000^88539.0000^22633" D DEFAULT Q
"RTN","LA7VHLU5",144,0)
 ;
"RTN","LA7VHLU5",145,0)
 ; brief clinical history
"RTN","LA7VHLU5",146,0)
 I LRSB=.013 S LA7DFCDE="88515.0000^88542.0000^22636" D DEFAULT Q
"RTN","LA7VHLU5",147,0)
 ;
"RTN","LA7VHLU5",148,0)
 ; preoperative diagnosis
"RTN","LA7VHLU5",149,0)
 I LRSB=.014 S LA7DFCDE="88515.0000^88544.0000^10219" D DEFAULT Q
"RTN","LA7VHLU5",150,0)
 ;
"RTN","LA7VHLU5",151,0)
 ; operative findings
"RTN","LA7VHLU5",152,0)
 I LRSB=.015 S LA7DFCDE="88515.0000^88546.0000^10215" D DEFAULT Q
"RTN","LA7VHLU5",153,0)
 ;
"RTN","LA7VHLU5",154,0)
 ; postoperative diagnosis
"RTN","LA7VHLU5",155,0)
 I LRSB=.016 S LA7DFCDE="88515.0000^88547.0000^10218" D DEFAULT Q
"RTN","LA7VHLU5",156,0)
 ;
"RTN","LA7VHLU5",157,0)
 ; gross description
"RTN","LA7VHLU5",158,0)
 I LRSB=1 S LA7DFCDE="88515.0000^88549.0000^22634" D DEFAULT Q
"RTN","LA7VHLU5",159,0)
 ;
"RTN","LA7VHLU5",160,0)
 ; microscopic description
"RTN","LA7VHLU5",161,0)
 I LRSB=1.1 S LA7DFCDE="88515.0000^88563.0000^22635" D DEFAULT Q
"RTN","LA7VHLU5",162,0)
 ;
"RTN","LA7VHLU5",163,0)
 ; frozen section
"RTN","LA7VHLU5",164,0)
 I LRSB=1.3 S LA7DFCDE="88515.0000^88569.0000^22635" D DEFAULT Q
"RTN","LA7VHLU5",165,0)
 ;
"RTN","LA7VHLU5",166,0)
 ; surgical path diagnosis
"RTN","LA7VHLU5",167,0)
 I LRSB=1.4 S LA7DFCDE="88515.0000^88571.0000^22637" D DEFAULT Q
"RTN","LA7VHLU5",168,0)
 ;
"RTN","LA7VHLU5",169,0)
 ; supplementary report
"RTN","LA7VHLU5",170,0)
 I LRSB=1.2!(LRSB="10,5") S LA7DFCDE="88515.0000^88589.0000^22639" D DEFAULT Q
"RTN","LA7VHLU5",171,0)
 ;
"RTN","LA7VHLU5",172,0)
 ; specimen weight
"RTN","LA7VHLU5",173,0)
 I LRSB="10,2" S LA7DFCDE="88515.0000^81233.0000^3154" D DEFAULT Q
"RTN","LA7VHLU5",174,0)
 ;
"RTN","LA7VHLU5",175,0)
 Q
"RTN","LA7VHLU5",176,0)
 ;
"RTN","LA7VHLU5",177,0)
 ;
"RTN","LA7VHLU5",178,0)
CYSUB ;  Determine codes for CY subscript
"RTN","LA7VHLU5",179,0)
 ;
"RTN","LA7VHLU5",180,0)
 ; specimens
"RTN","LA7VHLU5",181,0)
 I $P(LRSB,",")=.012!(LRSB=10) S LA7DFCDE="88593.0000^88539.0000^22633" D DEFAULT Q
"RTN","LA7VHLU5",182,0)
 ;
"RTN","LA7VHLU5",183,0)
 ; brief clinical history
"RTN","LA7VHLU5",184,0)
 I LRSB=.013 S LA7DFCDE="88593.0000^88542.0000^22636" D DEFAULT Q
"RTN","LA7VHLU5",185,0)
 ;
"RTN","LA7VHLU5",186,0)
 ; preoperative diagnosis
"RTN","LA7VHLU5",187,0)
 I LRSB=.014 S LA7DFCDE="88593.0000^88544.0000^10219" D DEFAULT Q
"RTN","LA7VHLU5",188,0)
 ;
"RTN","LA7VHLU5",189,0)
 ; operative findings
"RTN","LA7VHLU5",190,0)
 I LRSB=.015 S LA7DFCDE="88593.0000^88542.0000^10215" D DEFAULT Q
"RTN","LA7VHLU5",191,0)
 ;
"RTN","LA7VHLU5",192,0)
 ; postoperative diagnosis
"RTN","LA7VHLU5",193,0)
 I LRSB=.016 S LA7DFCDE="88593.0000^88547.0000^10218" D DEFAULT Q
"RTN","LA7VHLU5",194,0)
 ;
"RTN","LA7VHLU5",195,0)
 ; gross description
"RTN","LA7VHLU5",196,0)
 I LRSB=1!(LRSB=20) S LA7DFCDE="88593.0000^88549.0000^22634" D DEFAULT Q
"RTN","LA7VHLU5",197,0)
 ;
"RTN","LA7VHLU5",198,0)
 ; microscopic examination
"RTN","LA7VHLU5",199,0)
 I LRSB=1.1 S LA7DFCDE="88593.0000^88563.0000^22635" D DEFAULT Q
"RTN","LA7VHLU5",200,0)
 ;
"RTN","LA7VHLU5",201,0)
 ; supplementary report
"RTN","LA7VHLU5",202,0)
 I LRSB=1.2 S LA7DFCDE="88593.0000^88589.0000^22639" D DEFAULT Q
"RTN","LA7VHLU5",203,0)
 ;
"RTN","LA7VHLU5",204,0)
 ; cytopatholgy diagnosis
"RTN","LA7VHLU5",205,0)
 I LRSB=1.4 S LA7DFCDE="88593.0000^88571.0000^22637" D DEFAULT Q
"RTN","LA7VHLU5",206,0)
 ;
"RTN","LA7VHLU5",207,0)
 Q
"RTN","LA7VHLU5",208,0)
 ;
"RTN","LA7VHLU5",209,0)
 ;
"RTN","LA7VHLU5",210,0)
EMSUB ;  Determine codes for EM subscript
"RTN","LA7VHLU5",211,0)
 ;
"RTN","LA7VHLU5",212,0)
 ; specimens
"RTN","LA7VHLU5",213,0)
 I $P(LRSB,",")=.012!(LRSB=10) S LA7DFCDE="88597.0000^88057.0000^22633" D DEFAULT Q
"RTN","LA7VHLU5",214,0)
 ;
"RTN","LA7VHLU5",215,0)
 ; brief clinical history
"RTN","LA7VHLU5",216,0)
 I LRSB=.013 S LA7DFCDE="88597.0000^88542.0000^22636" D DEFAULT Q
"RTN","LA7VHLU5",217,0)
 ;
"RTN","LA7VHLU5",218,0)
 ; preoperative diagnosis
"RTN","LA7VHLU5",219,0)
 I LRSB=.014 S LA7DFCDE="88597.0000^88544.0000^10219" D DEFAULT Q
"RTN","LA7VHLU5",220,0)
 ;
"RTN","LA7VHLU5",221,0)
 ; operative findings
"RTN","LA7VHLU5",222,0)
 I LRSB=.015 S LA7DFCDE="88597.0000^88542.0000^10215" D DEFAULT Q
"RTN","LA7VHLU5",223,0)
 ;
"RTN","LA7VHLU5",224,0)
 ; postoperative diagnosis
"RTN","LA7VHLU5",225,0)
 I LRSB=.016 S LA7DFCDE="88597.0000^88547.0000^10218" D DEFAULT Q
"RTN","LA7VHLU5",226,0)
 ;
"RTN","LA7VHLU5",227,0)
 ; gross description
"RTN","LA7VHLU5",228,0)
 I LRSB=1!(LRSB=20) S LA7DFCDE="88597.0000^88549.0000^22634" D DEFAULT Q
"RTN","LA7VHLU5",229,0)
 ;
"RTN","LA7VHLU5",230,0)
 ; microscopic examination
"RTN","LA7VHLU5",231,0)
 I LRSB=1.1 S LA7DFCDE="88597.0000^88563.0000^22635" D DEFAULT Q
"RTN","LA7VHLU5",232,0)
 ;
"RTN","LA7VHLU5",233,0)
 ; supplementary report
"RTN","LA7VHLU5",234,0)
 I LRSB=1.2 S LA7DFCDE="88597.0000^88589.0000^22639" D DEFAULT Q
"RTN","LA7VHLU5",235,0)
 ;
"RTN","LA7VHLU5",236,0)
 ; em diagnosis
"RTN","LA7VHLU5",237,0)
 I LRSB=1.4 S LA7DFCDE="88597.0000^88571.0000^22637" D DEFAULT Q
"RTN","LA7VHLU5",238,0)
 ;
"RTN","LA7VHLU5",239,0)
 Q
"RTN","LA7VHLU5",240,0)
 ;
"RTN","LA7VHLU5",241,0)
 ;
"RTN","LA7VHLU5",242,0)
DEFAULT ; Resolve codes and set defaults as needed
"RTN","LA7VHLU5",243,0)
 ;
"RTN","LA7VHLU5",244,0)
 ; Expects LA7DFCDE=default order NLT^default result NLT^default LOINC code
"RTN","LA7VHLU5",245,0)
 ;
"RTN","LA7VHLU5",246,0)
 I $P(LA7MISS,"^") S $P(LA7CODE,"!")=$P(LA7DFCDE,"^")
"RTN","LA7VHLU5",247,0)
 I $P(LA7MISS,"^",2) S $P(LA7CODE,"!",2)=$P(LA7DFCDE,"^",2)
"RTN","LA7VHLU5",248,0)
 I $P(LA7MISS,"^",3) D
"RTN","LA7VHLU5",249,0)
 . S $P(LA7CODE,"!",3)=$$LNC^LRVER1($P(LA7CODE,"!",2),$P(LA7CODE,"!",4),LA761)
"RTN","LA7VHLU5",250,0)
 . I '$P(LA7CODE,"!",3) S $P(LA7CODE,"!",3)=$P(LA7DFCDE,"^",3)
"RTN","LA7VHLU5",251,0)
 Q
"RTN","LA7VHLU9")
0^28^B16600197^n/a
"RTN","LA7VHLU9",1,0)
LA7VHLU9 ;DALOI/JMC - HL7 segment builder utility ;Jun 20, 2008
"RTN","LA7VHLU9",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**68**;Sep 27, 1994;Build 56
"RTN","LA7VHLU9",3,0)
 ;
"RTN","LA7VHLU9",4,0)
 ; Reference to NPI^XUSNPI supported by DBIA #4532
"RTN","LA7VHLU9",5,0)
 ; Reference to QI^XUSNPI supported by DBIA #4532
"RTN","LA7VHLU9",6,0)
 ;
"RTN","LA7VHLU9",7,0)
 ;
"RTN","LA7VHLU9",8,0)
XCN(LA7DUZ,LA7DIV,LA7FS,LA7ECH,LA7DMT,LA7IDTYP) ; Build composite ID and name for person
"RTN","LA7VHLU9",9,0)
 ; Call with   LA7DUZ = DUZ of person 
"RTN","LA7VHLU9",10,0)
 ;                      If not pointer to #200, then use as literal
"RTN","LA7VHLU9",11,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VHLU9",12,0)
 ;              LA7FS = HL field separator
"RTN","LA7VHLU9",13,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VHLU9",14,0)
 ;             LA7DMT = flag to indicate delimiters should be demoted
"RTN","LA7VHLU9",15,0)
 ;           LA7IDTYP = id type to return (0:DUZ 1:VPID 2:NPI)
"RTN","LA7VHLU9",16,0)
 ;
"RTN","LA7VHLU9",17,0)
 N I,LA7CS,LA7NPI,LA7SITE,LA7VAF,LA7VPID,LA7X,LA7Y,LA7Z,NAME
"RTN","LA7VHLU9",18,0)
 ;
"RTN","LA7VHLU9",19,0)
 S (LA7Y,LA7Z)="",LA7DMT=+$G(LA7DMT),LA7IDTYP=+$G(LA7IDTYP)
"RTN","LA7VHLU9",20,0)
 ; If demoting delimiters then use sub-component delimiter instead of component delimiter.
"RTN","LA7VHLU9",21,0)
 S LA7CS=$E(LA7ECH,$S(LA7DMT=1:4,1:1))
"RTN","LA7VHLU9",22,0)
 ;
"RTN","LA7VHLU9",23,0)
 ; Check if this field has been built previously for this person
"RTN","LA7VHLU9",24,0)
 I LA7DUZ'="",$D(^TMP($J,"LA7VHLU","99VA200",LA7DUZ,LA7FS_LA7ECH,LA7DMT,LA7IDTYP)) S LA7Y=^TMP($J,"LA7VHLU","99VA200",LA7DUZ,LA7FS_LA7ECH,LA7DMT,LA7IDTYP)
"RTN","LA7VHLU9",25,0)
 ;
"RTN","LA7VHLU9",26,0)
 ; Build from file #200
"RTN","LA7VHLU9",27,0)
 I LA7Y="",LA7DUZ>0,LA7DUZ?1.N D
"RTN","LA7VHLU9",28,0)
 . S NAME("FILE")=200,NAME("FIELD")=.01,NAME("IENS")=LA7DUZ
"RTN","LA7VHLU9",29,0)
 . S LA7Z=$$HLNAME^XLFNAME(.NAME,"S",LA7CS)
"RTN","LA7VHLU9",30,0)
 . I LA7IDTYP=2 D  Q:LA7NPI>0
"RTN","LA7VHLU9",31,0)
 . . S LA7NPI=$$NPI^XUSNPI("Individual_ID",LA7DUZ,DT)
"RTN","LA7VHLU9",32,0)
 . . I LA7NPI>0 S $P(LA7Y,LA7CS)=$P(LA7NPI,"^"),$P(LA7Y,LA7CS,9)="USDHHS",$P(LA7Y,LA7CS,11)=$E(LA7NPI,10),$P(LA7Y,LA7CS,12,13)="NPI"_LA7CS_"NPI"
"RTN","LA7VHLU9",33,0)
 . I LA7IDTYP>0 D  Q:LA7VPID'=""
"RTN","LA7VHLU9",34,0)
 . . S LA7VPID=$$VPID^XUPS(LA7DUZ)
"RTN","LA7VHLU9",35,0)
 . . I LA7VPID'="" S $P(LA7Y,LA7CS)=LA7VPID,$P(LA7Y,LA7CS,9)="USVHA",$P(LA7Y,LA7CS,13)="PN"
"RTN","LA7VHLU9",36,0)
 . ; If no institution, use Kernel Site default
"RTN","LA7VHLU9",37,0)
 . I LA7DIV="" S LA7DIV=+$$KSP^XUPARAM("INST")
"RTN","LA7VHLU9",38,0)
 . S LA7SITE=$$RETFACID^LA7VHLU2(LA7DIV,0,1)
"RTN","LA7VHLU9",39,0)
 . I LA7SITE'="" D
"RTN","LA7VHLU9",40,0)
 . . S LA7VAF=$$GET1^DIQ(4,LA7DIV_",","AGENCY CODE","I")
"RTN","LA7VHLU9",41,0)
 . . I LA7VAF="V" S LA7SITE="VA"_LA7SITE
"RTN","LA7VHLU9",42,0)
 . . S LA7DUZ=LA7DUZ_"-"_LA7SITE,$P(LA7Y,LA7CS,8)="99VA4"
"RTN","LA7VHLU9",43,0)
 . S $P(LA7Y,LA7CS)=LA7DUZ
"RTN","LA7VHLU9",44,0)
 ;
"RTN","LA7VHLU9",45,0)
 ; If only name passed
"RTN","LA7VHLU9",46,0)
 I LA7Y="",'LA7DUZ D
"RTN","LA7VHLU9",47,0)
 . S NAME=LA7DUZ
"RTN","LA7VHLU9",48,0)
 . I LA7DUZ["[",LA7DUZ["]" D
"RTN","LA7VHLU9",49,0)
 . . S NAME=$P(LA7DUZ,"["),NAME(1)=$P(LA7DUZ,"[",2),NAME(1)=$P(NAME(1),"]")
"RTN","LA7VHLU9",50,0)
 . . I $P(NAME(1),":",2)?1(1"NPI",1"PN") S $P(LA7Y,LA7CS)=$P(NAME(1),":"),$P(LA7Y,LA7CS,9)=$P(NAME(1),":",4),$P(LA7Y,LA7CS,13)=$P(NAME(1),":",2)
"RTN","LA7VHLU9",51,0)
 . . I $P(NAME(1),":",2)?1(1"99"1.E,1"L") S $P(LA7Y,LA7CS)=$P(NAME(1),":"),$P(LA7Y,LA7CS,8)=$P(NAME(1),":",2)
"RTN","LA7VHLU9",52,0)
 . S NAME=$$CHKDATA^LA7VHLU3(NAME,LA7FS_LA7ECH)
"RTN","LA7VHLU9",53,0)
 . S LA7Z=$$HLNAME^XLFNAME(NAME,"S",LA7CS)
"RTN","LA7VHLU9",54,0)
 ;
"RTN","LA7VHLU9",55,0)
 I LA7Z'="" F I=1:1:6 S $P(LA7Y,LA7CS,I+1)=$P(LA7Z,LA7CS,I)
"RTN","LA7VHLU9",56,0)
 ;
"RTN","LA7VHLU9",57,0)
 ; Save this field to TMP global to use for subsequent calls.
"RTN","LA7VHLU9",58,0)
 I LA7DUZ'="" S ^TMP($J,"LA7VHLU","99VA200",LA7DUZ,LA7FS_LA7ECH,LA7DMT,LA7IDTYP)=LA7Y
"RTN","LA7VHLU9",59,0)
 ;
"RTN","LA7VHLU9",60,0)
 Q LA7Y
"RTN","LA7VHLU9",61,0)
 ;
"RTN","LA7VHLU9",62,0)
 ;
"RTN","LA7VHLU9",63,0)
 ;
"RTN","LA7VHLU9",64,0)
XCNTFM(LA7X,LA7ECH) ; Resolve XCN data type to FileMan (last name, first name, mi [id])
"RTN","LA7VHLU9",65,0)
 ; Call with LA7X = HL7 field containing name
"RTN","LA7VHLU9",66,0)
 ;         LA7ECH = HL7 encoding characters
"RTN","LA7VHLU9",67,0)
 ;
"RTN","LA7VHLU9",68,0)
 ; Returns   LA7Y = ID code^DUZ^FileMan name (DUZ=0 if name not found on local system).
"RTN","LA7VHLU9",69,0)
 ;
"RTN","LA7VHLU9",70,0)
 N LA7DUZ,LA7IDC,LA7Y,LA7Z,X
"RTN","LA7VHLU9",71,0)
 ;
"RTN","LA7VHLU9",72,0)
 ;
"RTN","LA7VHLU9",73,0)
 S LA7DUZ=0
"RTN","LA7VHLU9",74,0)
 ;
"RTN","LA7VHLU9",75,0)
 ; Check for VPID
"RTN","LA7VHLU9",76,0)
 S (LA7IDC,LA7Z)=$P(LA7X,$E(LA7ECH))
"RTN","LA7VHLU9",77,0)
 I $P(LA7X,$E(LA7ECH),9)="USVHA",$P(LA7X,$E(LA7ECH),13)="PN" D
"RTN","LA7VHLU9",78,0)
 . S X=$$IEN^XUPS(LA7IDC)
"RTN","LA7VHLU9",79,0)
 . I X>0 S LA7DUZ=X
"RTN","LA7VHLU9",80,0)
 ;
"RTN","LA7VHLU9",81,0)
 ; Check for NPI
"RTN","LA7VHLU9",82,0)
 I $P(LA7X,$E(LA7ECH),9)="USDHHS",$P(LA7X,$E(LA7ECH),13)="NPI" D
"RTN","LA7VHLU9",83,0)
 . S X=$$QI^XUSNPI(LA7IDC)
"RTN","LA7VHLU9",84,0)
 . I $P(X,"^")="Individual_ID",$P(X,"^",2)>0 S LA7DUZ=X
"RTN","LA7VHLU9",85,0)
 ;
"RTN","LA7VHLU9",86,0)
 ; Check for coding that indicates DUZ from a VA facility
"RTN","LA7VHLU9",87,0)
 I 'LA7DUZ,LA7Z?.(1.N1"-VA"3N,1.N1"-VA"3N2U) D
"RTN","LA7VHLU9",88,0)
 . N LA7J,LA7K
"RTN","LA7VHLU9",89,0)
 . S LA7Z(1)=$P(LA7Z,"-"),LA7Z(2)=$P(LA7Z,"-",2)
"RTN","LA7VHLU9",90,0)
 . S LA7K=$$FINDSITE^LA7VHLU2(LA7Z(2),1,1)
"RTN","LA7VHLU9",91,0)
 . S LA7J=$$DIV4^XUSER(.LA7J,LA7Z(1))
"RTN","LA7VHLU9",92,0)
 . I LA7K,$D(LA7J(LA7K)) S LA7DUZ=LA7Z(1)
"RTN","LA7VHLU9",93,0)
 ;
"RTN","LA7VHLU9",94,0)
 ; Check if code resolves to a valid user.
"RTN","LA7VHLU9",95,0)
 I 'LA7DUZ,LA7Z=+LA7Z D
"RTN","LA7VHLU9",96,0)
 . S X=$$ACTIVE^XUSER(LA7Z)
"RTN","LA7VHLU9",97,0)
 . I X,$P(X,"^",2)'="" S LA7DUZ=LA7Z
"RTN","LA7VHLU9",98,0)
 ;
"RTN","LA7VHLU9",99,0)
 S LA7Y=$$FMNAME^HLFNC($P(LA7X,$E(LA7ECH),2,6),LA7ECH)
"RTN","LA7VHLU9",100,0)
 ; HL function sometimes returns trailing "," on name
"RTN","LA7VHLU9",101,0)
 S LA7Y=$$TRIM^XLFSTR(LA7Y,"R",",")
"RTN","LA7VHLU9",102,0)
 ;
"RTN","LA7VHLU9",103,0)
 ; Put identifying code at end of name in "[code:id type:va id type:issuing authority]".
"RTN","LA7VHLU9",104,0)
 I $P(LA7X,$E(LA7ECH))'="",LA7Y'="" D
"RTN","LA7VHLU9",105,0)
 . S X=""
"RTN","LA7VHLU9",106,0)
 . I $P(LA7X,$E(LA7ECH),8)?1(1"99"1.E,1"L") S X=$P(LA7X,$E(LA7ECH),8)
"RTN","LA7VHLU9",107,0)
 . I $P(LA7X,$E(LA7ECH),9)="USVHA",$P(LA7X,$E(LA7ECH),13)="PN" S X="PN:VPID:USVHA"
"RTN","LA7VHLU9",108,0)
 . I $P(LA7X,$E(LA7ECH),9)="USDHHS",$P(LA7X,$E(LA7ECH),13)="NPI" S X="NPI:NPI:USDHHS"
"RTN","LA7VHLU9",109,0)
 . S LA7Y=LA7Y_" ["_$P(LA7X,$E(LA7ECH))_":"_X_"]"
"RTN","LA7VHLU9",110,0)
 ;
"RTN","LA7VHLU9",111,0)
 Q LA7IDC_"^"_LA7DUZ_"^"_LA7Y
"RTN","LA7VIN5")
0^19^B62438539^B52231590
"RTN","LA7VIN5",1,0)
LA7VIN5 ;DALOI/JMC - Process Incoming UI Msgs, continued ;June 7, 2007
"RTN","LA7VIN5",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VIN5",3,0)
 ; This routine is a continuation of LA7VIN1 and is only called from there.
"RTN","LA7VIN5",4,0)
 ; It is called to process OBX segments for "CH" subscript tests.
"RTN","LA7VIN5",5,0)
 Q
"RTN","LA7VIN5",6,0)
 ;
"RTN","LA7VIN5",7,0)
OBX ;
"RTN","LA7VIN5",8,0)
 ;
"RTN","LA7VIN5",9,0)
 N LA76241,LA76304,LA7EII,LA7I,LA7LIMIT,LA7OBM,LA7SUBFL,LA7TEST,LA7TREEN,LA7UNITS,LA7VAL,LA7VTYP,LA7X,LA7XFORM,LA7Y
"RTN","LA7VIN5",10,0)
 ;
"RTN","LA7VIN5",11,0)
 K LA7RMK,^TMP("LA7TREE",$J)
"RTN","LA7VIN5",12,0)
 ;
"RTN","LA7VIN5",13,0)
 S LA7SUBFL=63.04
"RTN","LA7VIN5",14,0)
 ;
"RTN","LA7VIN5",15,0)
 ; OBX Set ID
"RTN","LA7VIN5",16,0)
 S LA7SOBX=$$P^LA7VHLU(.LA7SEG,2,LA7FS)
"RTN","LA7VIN5",17,0)
 ;
"RTN","LA7VIN5",18,0)
 ; Value type - type of data from Table 0125
"RTN","LA7VIN5",19,0)
 S LA7VTYP=$P($$P^LA7VHLU(.LA7SEG,3,LA7FS),LA7CS)
"RTN","LA7VIN5",20,0)
 ;
"RTN","LA7VIN5",21,0)
 ; Determine test result codes - check for primary and alternate codes
"RTN","LA7VIN5",22,0)
 ; For DoD/CHCS interface - do NOT process test codes using 99LRT as coding system per DoD/July 2002.
"RTN","LA7VIN5",23,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,4,LA7FS),(LA7RNLT,LA7RLNC)=""
"RTN","LA7VIN5",24,0)
 S LA7TEST=$P(LA7X,LA7CS)
"RTN","LA7VIN5",25,0)
 S LA7TEST(0)=$$UNESC^LA7VHLU3($P(LA7X,LA7CS,2),LA7FS_LA7ECH)
"RTN","LA7VIN5",26,0)
 I LA7TEST(0)["^" S LA7TEST(0)=$TR(LA7TEST(0),"^","~")
"RTN","LA7VIN5",27,0)
 S LA7TEST(0,1)=$P(LA7X,LA7CS,3)
"RTN","LA7VIN5",28,0)
 S LA7TEST(2)=$P(LA7X,LA7CS,4)
"RTN","LA7VIN5",29,0)
 S LA7TEST(2,0)=$$UNESC^LA7VHLU3($P(LA7X,LA7CS,5),LA7FS_LA7ECH)
"RTN","LA7VIN5",30,0)
 I LA7TEST(2,0)["^" S LA7TEST(2,0)=$TR(LA7TEST(2,0),"^","~")
"RTN","LA7VIN5",31,0)
 S LA7TEST(2,1)=$P(LA7X,LA7CS,6)
"RTN","LA7VIN5",32,0)
 F I=3,6 D
"RTN","LA7VIN5",33,0)
 . S LA7Y=$P(LA7X,LA7CS,I-2)
"RTN","LA7VIN5",34,0)
 . I $P(LA7X,LA7CS,I)="LN" D  Q
"RTN","LA7VIN5",35,0)
 . . I $$GET1^DIQ(95.3,+LA7Y_",",.01)=LA7Y S LA7RLNC=+LA7Y
"RTN","LA7VIN5",36,0)
 . I $P(LA7X,LA7CS,I)="99VA64" D  Q
"RTN","LA7VIN5",37,0)
 . . I $$FIND1^DIC(64,"","OMX",LA7Y) S LA7RNLT=LA7Y
"RTN","LA7VIN5",38,0)
 . I $P(LA7X,LA7CS,I)="99LRT" D  Q
"RTN","LA7VIN5",39,0)
 . . I LA7TEST(0)="",LA7TEST(2,0)'="" S LA7TEST(0)=LA7TEST(2,0)
"RTN","LA7VIN5",40,0)
 . . I LA7TEST(2,0)="",LA7TEST(0)'="" S LA7TEST(2,0)=LA7TEST(0)
"RTN","LA7VIN5",41,0)
 . . I I=3 S (LA7TEST,LA7TEST(0),LA7TEST(0,1))="" Q
"RTN","LA7VIN5",42,0)
 . . I I=6 S (LA7TEST(2),LA7TEST(2,0),LA7TEST(2,1))="" Q
"RTN","LA7VIN5",43,0)
 I LA7TEST="",LA7TEST(2)'="" D
"RTN","LA7VIN5",44,0)
 . S LA7TEST=LA7TEST(2),LA7TEST(0)=LA7TEST(2,0),LA7TEST(0,1)=LA7TEST(2,1)
"RTN","LA7VIN5",45,0)
 . S (LA7TEST(2),LA7TEST(2,0),LA7TEST(2,1))=""
"RTN","LA7VIN5",46,0)
 ;
"RTN","LA7VIN5",47,0)
 ; No test code in message
"RTN","LA7VIN5",48,0)
 I LA7TEST="",LA7TEST(2)="" D  Q
"RTN","LA7VIN5",49,0)
 . N LA7OBX
"RTN","LA7VIN5",50,0)
 . S LA7OBX=LA7SEG(0)
"RTN","LA7VIN5",51,0)
 . D CREATE^LA7LOG(15)
"RTN","LA7VIN5",52,0)
 ;
"RTN","LA7VIN5",53,0)
 ; Test code not found in auto inst file, also check alternate codes,
"RTN","LA7VIN5",54,0)
 ; and log error if none found.
"RTN","LA7VIN5",55,0)
 I LA7MTYP="ORU" D  Q:LA7TEST=""
"RTN","LA7VIN5",56,0)
 . I LA7TEST'="",$D(^LAB(62.4,LA7624,3,"AC",LA7TEST)) Q
"RTN","LA7VIN5",57,0)
 . I LA7TEST(2)'="",$D(^LAB(62.4,LA7624,3,"AC",LA7TEST(2))) D  Q
"RTN","LA7VIN5",58,0)
 . . S LA7TEST=LA7TEST(2),LA7TEST(0)=LA7TEST(2,0),LA7TEST(0,1)=LA7TEST(2,1)
"RTN","LA7VIN5",59,0)
 . D CREATE^LA7LOG(16) S LA7TEST=""
"RTN","LA7VIN5",60,0)
 ;
"RTN","LA7VIN5",61,0)
 ; Units - trim leading/trailing spaces
"RTN","LA7VIN5",62,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,7,LA7FS),LA7UNITS=""
"RTN","LA7VIN5",63,0)
 I LA7X'="" D
"RTN","LA7VIN5",64,0)
 . F I=1:1:6 S LA7UNITS(I)=$P(LA7X,LA7CS,I)
"RTN","LA7VIN5",65,0)
 . S LA7UNITS=$$TRIM^XLFSTR(LA7UNITS(1),"LR"," ")
"RTN","LA7VIN5",66,0)
 . I LA7UNITS["^" D
"RTN","LA7VIN5",67,0)
 . . N LA7STR S LA7STR("^")="~U~"
"RTN","LA7VIN5",68,0)
 . . S LA7UNITS=$$REPLACE^XLFSTR(LA7UNITS,.LA7STR)
"RTN","LA7VIN5",69,0)
 ;
"RTN","LA7VIN5",70,0)
 ; Observation result status - Table 0085
"RTN","LA7VIN5",71,0)
 S LA7ORS=$$P^LA7VHLU(.LA7SEG,12,LA7FS)
"RTN","LA7VIN5",72,0)
 ;
"RTN","LA7VIN5",73,0)
 ; Responsible observer
"RTN","LA7VIN5",74,0)
 S LA7RO=$$XCNTFM^LA7VHLU4($$P^LA7VHLU(.LA7SEG,17,LA7FS),LA7ECH)
"RTN","LA7VIN5",75,0)
 ;
"RTN","LA7VIN5",76,0)
 ; Observation method
"RTN","LA7VIN5",77,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,18,LA7FS),LA7OBM=""
"RTN","LA7VIN5",78,0)
 I $P(LA7X,LA7CS,3)="99VA64_2" S LA7OBM=$P($P(LA7X,LA7CS,1),".",2)
"RTN","LA7VIN5",79,0)
 ;
"RTN","LA7VIN5",80,0)
 ; Equipment instance identifier
"RTN","LA7VIN5",81,0)
 S LA7EII=$$P^LA7VHLU(.LA7SEG,19,LA7FS)
"RTN","LA7VIN5",82,0)
 I LA7EII'="" D
"RTN","LA7VIN5",83,0)
 . S LA7EII=$$UNESC^LA7VHLU3(LA7EII,LA7FS_LA7ECH)
"RTN","LA7VIN5",84,0)
 . S LA7EII=$TR(LA7EII,"^",";")
"RTN","LA7VIN5",85,0)
 ;
"RTN","LA7VIN5",86,0)
 ; Process ORU message results for all tests which use this test code.
"RTN","LA7VIN5",87,0)
 I LA7MTYP="ORU" D  Q
"RTN","LA7VIN5",88,0)
 . S LA76241=0
"RTN","LA7VIN5",89,0)
 . F  S LA76241=$O(^LAB(62.4,LA7624,3,"AC",LA7TEST,LA76241)) Q:'LA76241  D PROCESS
"RTN","LA7VIN5",90,0)
 ;
"RTN","LA7VIN5",91,0)
 I LA7MTYP="ORM",$G(LA7696)>0 D ORESULTS^LA7VIN5A
"RTN","LA7VIN5",92,0)
 ;
"RTN","LA7VIN5",93,0)
 Q
"RTN","LA7VIN5",94,0)
 ;
"RTN","LA7VIN5",95,0)
 ;
"RTN","LA7VIN5",96,0)
PROCESS ; Process results for a given test code
"RTN","LA7VIN5",97,0)
 S LA7VAL=$$P^LA7VHLU(.LA7SEG,6,LA7FS)
"RTN","LA7VIN5",98,0)
 I LA7VTYP="CE",$P(LA7VAL,LA7CS,2)'="" S LA7VAL=$P(LA7VAL,LA7CS,2)
"RTN","LA7VIN5",99,0)
 E  S LA7VAL=$P(LA7VAL,LA7CS)
"RTN","LA7VIN5",100,0)
 ;
"RTN","LA7VIN5",101,0)
 F LA7I=0,1,2 S LA76241(LA7I)=$G(^LAB(62.4,LA7624,3,LA76241,LA7I))
"RTN","LA7VIN5",102,0)
 ;
"RTN","LA7VIN5",103,0)
 ; Chem test fields incorrect
"RTN","LA7VIN5",104,0)
 I (LA76241(0)="")!(LA76241(1)="") D  Q
"RTN","LA7VIN5",105,0)
 . D CREATE^LA7LOG(18)
"RTN","LA7VIN5",106,0)
 ;
"RTN","LA7VIN5",107,0)
 ; Setup LA7RMK(0) variable in case comments (NTE) sent with test results.
"RTN","LA7VIN5",108,0)
 S LA7RMK(0,+LA76241(0))=+$P(LA76241(2),"^",7)_"^"_$P(LA76241(2),"^",8)
"RTN","LA7VIN5",109,0)
 ;
"RTN","LA7VIN5",110,0)
 S LA76304=+$P(LA76241(1),"(",2) ;lab data field
"RTN","LA7VIN5",111,0)
 ; No dataname for this result
"RTN","LA7VIN5",112,0)
 I LA76304'>1 D  Q
"RTN","LA7VIN5",113,0)
 . D CREATE^LA7LOG(18)
"RTN","LA7VIN5",114,0)
 ;
"RTN","LA7VIN5",115,0)
 ; Set flag for new results alert
"RTN","LA7VIN5",116,0)
 I LA7ORS'="","CDW"'[LA7ORS S ^TMP("LA7-ORU",$J,LA76248,LA76249)=""
"RTN","LA7VIN5",117,0)
 ;
"RTN","LA7VIN5",118,0)
 ; Set flag to send amended results bulletin
"RTN","LA7VIN5",119,0)
 I LA7INTYP=10,LA7ORS'="","CDW"[LA7ORS D
"RTN","LA7VIN5",120,0)
 . S LA7I=$O(^TMP("LA7 AMENDED RESULTS",$J,""),-1),LA7I=LA7I+1
"RTN","LA7VIN5",121,0)
 . S X=LA7LWL_"^"_LA7ISQN_"^"_LA76304_"^"_LA76248_"^"_LA76249_"^"_LA7ORS_"^"_LA7TEST_"^"_$S(LA7TEST(0)'="":LA7TEST(0),1:LA7TEST(2,0))_"^"_$$P^LA7VHLU(.LA7SEG,9,LA7FS)
"RTN","LA7VIN5",122,0)
 . S ^TMP("LA7 AMENDED RESULTS",$J,LA7I)=X
"RTN","LA7VIN5",123,0)
 . I LA7UID'="" S ^LAH("LA7 AMENDED RESULTS",LA7UID,LA76304,LA7LWL,LA7ISQN)=X
"RTN","LA7VIN5",124,0)
 ;
"RTN","LA7VIN5",125,0)
 ; NOTE - this array can be set from inside PARAM 1
"RTN","LA7VIN5",126,0)
 K LA7XFORM
"RTN","LA7VIN5",127,0)
 ; execute PARAM 1 if not a LEDI interface
"RTN","LA7VIN5",128,0)
 I LA7INTYP'=10 X $P(LA76241(0),"^",2)
"RTN","LA7VIN5",129,0)
 I $P(LA76241(2),"^",3)=0 Q
"RTN","LA7VIN5",130,0)
 I $P(LA76241(2),"^",3)=2,"CFUX"'[LA7ORS Q
"RTN","LA7VIN5",131,0)
 I LA7ORS="X",LA7VAL="" Q
"RTN","LA7VIN5",132,0)
 ;
"RTN","LA7VIN5",133,0)
 ; No value found
"RTN","LA7VIN5",134,0)
 I LA7VAL="" D  Q
"RTN","LA7VIN5",135,0)
 . D CREATE^LA7LOG(17)
"RTN","LA7VIN5",136,0)
 ;
"RTN","LA7VIN5",137,0)
 ; Transform result based on fields in file 62.4
"RTN","LA7VIN5",138,0)
 D XFORM^LA7VIN5A
"RTN","LA7VIN5",139,0)
 Q:LA7VAL=""
"RTN","LA7VIN5",140,0)
 ;
"RTN","LA7VIN5",141,0)
 ; Check if result passes input transform on data name
"RTN","LA7VIN5",142,0)
 D CHKDIE^LA7VIN5A
"RTN","LA7VIN5",143,0)
 Q:LA7VAL=""
"RTN","LA7VIN5",144,0)
 ;
"RTN","LA7VIN5",145,0)
 ; Set flag to not store comments if it wasn't explicitly ordered.
"RTN","LA7VIN5",146,0)
 I $G(LA7LIMIT)=1 D
"RTN","LA7VIN5",147,0)
 . N LA76804
"RTN","LA7VIN5",148,0)
 . K LA7LIMIT,LA7TREEN,^TMP("LA7TREE",$J)
"RTN","LA7VIN5",149,0)
 . ; Store all tests accessioned in ^TMP
"RTN","LA7VIN5",150,0)
 . S LA76804=0
"RTN","LA7VIN5",151,0)
 . F  S LA76804=$O(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA76804)) Q:'LA76804  D UNWIND^LA7UTIL(LA76804)
"RTN","LA7VIN5",152,0)
 . I '$D(^TMP("LA7TREE",$J,+LA76241(0))) S LA7LIMIT=1 ;wasn't ordered
"RTN","LA7VIN5",153,0)
 I $G(LA7LIMIT) D  Q
"RTN","LA7VIN5",154,0)
 . S $P(LA7RMK(0,+LA76241(0)),"^",1)=0
"RTN","LA7VIN5",155,0)
 . K LA7LIMIT,^TMP("LA7TREE",$J)
"RTN","LA7VIN5",156,0)
 K ^TMP("LA7TREE",$J)
"RTN","LA7VIN5",157,0)
 ;
"RTN","LA7VIN5",158,0)
 ; Check point of care interface for matching specimen type  for this test in #62.4
"RTN","LA7VIN5",159,0)
 I LA7INTYP>19,LA7INTYP<30 D  Q:'LA761
"RTN","LA7VIN5",160,0)
 . N LA70070
"RTN","LA7VIN5",161,0)
 . S LA761="",LA7X=$P(LA76241(2),"^",13) Q:'LA7X
"RTN","LA7VIN5",162,0)
 . S LA70070=$$GET1^DIQ(61,LA7X_",","LEDI HL7:HL7 ABBR")
"RTN","LA7VIN5",163,0)
 . I LA70070=LA7SPEC S LA761=LA7X
"RTN","LA7VIN5",164,0)
 ;
"RTN","LA7VIN5",165,0)
 ; Set data node=test value
"RTN","LA7VIN5",166,0)
 S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^")=LA7VAL
"RTN","LA7VIN5",167,0)
 ;
"RTN","LA7VIN5",168,0)
 ; Store reference ranges except for UI (LA7INTYP=1) interfaces
"RTN","LA7VIN5",169,0)
 I LA7INTYP'=1 D REFRNG^LA7VIN5A($$P^LA7VHLU(.LA7SEG,8,LA7FS))
"RTN","LA7VIN5",170,0)
 ;
"RTN","LA7VIN5",171,0)
 ; Store order/result codes/observation method except for UI (LA7INTYP=1) interfaces
"RTN","LA7VIN5",172,0)
 S LA7X=$P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",3)
"RTN","LA7VIN5",173,0)
 I LA7ONLT S $P(LA7X,"!",1)=LA7ONLT
"RTN","LA7VIN5",174,0)
 I LA7RNLT S $P(LA7X,"!",2)=LA7RNLT
"RTN","LA7VIN5",175,0)
 I LA7RLNC S $P(LA7X,"!",3)=LA7RLNC
"RTN","LA7VIN5",176,0)
 I LA7OBM S $P(LA7X,"!",4)=LA7OBM
"RTN","LA7VIN5",177,0)
 I LA7INTYP'=1 S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",3)=LA7X
"RTN","LA7VIN5",178,0)
 ; 
"RTN","LA7VIN5",179,0)
 ; Store abnormal flags except for UI (LA7INTYP=1) interfaces.
"RTN","LA7VIN5",180,0)
 I LA7INTYP'=1 D ABFLAG^LA7VIN5A($$P^LA7VHLU(.LA7SEG,9,LA7FS))
"RTN","LA7VIN5",181,0)
 ;
"RTN","LA7VIN5",182,0)
 ; Store units except for UI (LA7INTYP=1) interfaces which pull values from file #60.
"RTN","LA7VIN5",183,0)
 I LA7INTYP'=1,LA7UNITS'="" D
"RTN","LA7VIN5",184,0)
 . S LA7X=$P($G(^LAH(LA7LWL,1,LA7ISQN,LA76304)),"^",5)
"RTN","LA7VIN5",185,0)
 . S $P(LA7X,"!",7)=LA7UNITS
"RTN","LA7VIN5",186,0)
 . S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",5)=LA7X
"RTN","LA7VIN5",187,0)
 ;
"RTN","LA7VIN5",188,0)
 ; Store responsible observer on POC interfaces
"RTN","LA7VIN5",189,0)
 I LA7RO'="",LA7INTYP>19,LA7INTYP<30 D
"RTN","LA7VIN5",190,0)
 . I $P(LA7RO,"^",2) S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",4)=$P(LA7RO,"^",2)
"RTN","LA7VIN5",191,0)
 ;
"RTN","LA7VIN5",192,0)
 ; Store specimen type except for UI (LA7INTYP=1) interfaces which pull values from the accession.
"RTN","LA7VIN5",193,0)
 I LA7INTYP'=1,$G(LA761) D
"RTN","LA7VIN5",194,0)
 . S X=$P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",5)
"RTN","LA7VIN5",195,0)
 . S $P(X,"!")=LA761
"RTN","LA7VIN5",196,0)
 . S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",5)=X
"RTN","LA7VIN5",197,0)
 ;
"RTN","LA7VIN5",198,0)
 ; Store where test was performed except for UI (LA7INTYP=1) interfaces.
"RTN","LA7VIN5",199,0)
 I LA7INTYP'=1 D
"RTN","LA7VIN5",200,0)
 . N LA74,LA7I,LA7X
"RTN","LA7VIN5",201,0)
 . S LA7X=$$P^LA7VHLU(.LA7SEG,24,LA7FS),LA74=""
"RTN","LA7VIN5",202,0)
 . I $P(LA7X,LA7CS,6)="CLIA" S LA74=$$IDX^XUAF4("CLIA",$P(LA7X,LA7CS,10))
"RTN","LA7VIN5",203,0)
 . I LA74 S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",9)=LA74 Q
"RTN","LA7VIN5",204,0)
 . S LA7X=$$P^LA7VHLU(.LA7SEG,16,LA7FS)
"RTN","LA7VIN5",205,0)
 . F LA7I=1,4 I $P(LA7X,LA7CS,LA7I+2)?1(1"L-CL",1"CLIA",1"99VACLIA") S LA74=$$IDX^XUAF4("CLIA",$P(LA7X,LA7CS,LA7I))
"RTN","LA7VIN5",206,0)
 . I LA74 S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",9)=LA74 Q
"RTN","LA7VIN5",207,0)
 . D PRDID^LA7VIN5A($$P^LA7VHLU(.LA7SEG,16,LA7FS),LA7SFAC,LA7CS)
"RTN","LA7VIN5",208,0)
 ;
"RTN","LA7VIN5",209,0)
 ; Store equipment instance identifier
"RTN","LA7VIN5",210,0)
 I LA7EII'="" D EII^LA7VIN5A
"RTN","LA7VIN5",211,0)
 ;
"RTN","LA7VIN5",212,0)
 ; If results for LEDI interface (LA7INTYP=10) and site keeps file #60
"RTN","LA7VIN5",213,0)
 ; in sync with reference lab then compare message's units and normals
"RTN","LA7VIN5",214,0)
 ; with site's to detect changes(LA7FLAG=1) and notify site.
"RTN","LA7VIN5",215,0)
 I LA7INTYP=10,$G(LA761),$G(^LAB(60,+$P(LA76241(0),"^"),1,LA761,.1)) D
"RTN","LA7VIN5",216,0)
 . N LA760,LA7FLAG,LA7I,LA7Y,LA7X
"RTN","LA7VIN5",217,0)
 . S LA760=+$P(LA76241(0),"^"),LA7Y=^LAB(60,LA760,1,LA761,0),LA7FLAG=0
"RTN","LA7VIN5",218,0)
 . S LA7X=$P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",5)
"RTN","LA7VIN5",219,0)
 . I $P(LA7Y,"^",7)'=$P(LA7X,"!",7) S LA7FLAG=1
"RTN","LA7VIN5",220,0)
 . I 'LA7FLAG,$P(LA7Y,"^",2)=$P(LA7X,"!",2),$P(LA7Y,"^",3)=$P(LA7X,"!",3) Q
"RTN","LA7VIN5",221,0)
 . I 'LA7FLAG D
"RTN","LA7VIN5",222,0)
 . . N AGE,DOB,PNM,SEX
"RTN","LA7VIN5",223,0)
 . . N LRDPF,LRNG,LRNGS,LRNG2,LRNG3,LRNG4,LRNG5,LRTREA,LRWRD,LRX,LRY
"RTN","LA7VIN5",224,0)
 . . I $G(LRDFN) D DEM^LRX,KVAR^VADPT
"RTN","LA7VIN5",225,0)
 . . S LRNG=LA7Y D NORM^LRVER5
"RTN","LA7VIN5",226,0)
 . . S LA7Y=$TR(LRNG,$C(34),""),LA7X=$TR(LA7X,$C(34),"")
"RTN","LA7VIN5",227,0)
 . . I $P(LA7Y,"^",2)=$P(LA7X,"!",2),$P(LA7Y,"^",3)=$P(LA7X,"!",3) Q
"RTN","LA7VIN5",228,0)
 . . S LA7FLAG=1
"RTN","LA7VIN5",229,0)
 . I 'LA7FLAG Q
"RTN","LA7VIN5",230,0)
 . S LA7I=$O(^TMP("LA7 UNITS/NORMALS CHANGED",$J,""),-1),LA7I=LA7I+1
"RTN","LA7VIN5",231,0)
 . S X=LA7LWL_"^"_LA7ISQN_"^"_LA76304_"^"_LA76248_"^"_LA76249_"^"_LA7ORS_"^"_LA7TEST_"^"_$S(LA7TEST(0)'="":LA7TEST(0),1:LA7TEST(2,0))_"^"_$$P^LA7VHLU(.LA7SEG,9,LA7FS)_"^"_LA760
"RTN","LA7VIN5",232,0)
 . S ^TMP("LA7 UNITS/NORMALS CHANGED",$J,LA7I)=X
"RTN","LA7VIN5",233,0)
 ;
"RTN","LA7VIN5",234,0)
 ; If LEDI interface and order status change store which results
"RTN","LA7VIN5",235,0)
 ; associated with ordered test. Used to determine if order status
"RTN","LA7VIN5",236,0)
 ; changed bulletin needs to be generated.
"RTN","LA7VIN5",237,0)
 I LA7INTYP=10,LA7SAC?1(1"A",1"G") D
"RTN","LA7VIN5",238,0)
 . S LA7I=$G(LA7SAC(0)) Q:'LA7I
"RTN","LA7VIN5",239,0)
 . S ^TMP("LA7 ORDER STATUS",$J,LA7I,+LA76241(0))=""
"RTN","LA7VIN5",240,0)
 Q
"RTN","LA7VMSG1")
0^9^B52098570^B51506932
"RTN","LA7VMSG1",1,0)
LA7VMSG1 ;DALOI/JMC - LAB ORU (Observation Result) message builder cont'd;Aug 8, 2008
"RTN","LA7VMSG1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**56,46,61,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VMSG1",3,0)
 ;
"RTN","LA7VMSG1",4,0)
START ; Process entries in queue
"RTN","LA7VMSG1",5,0)
 ; Called from LA7VMSG
"RTN","LA7VMSG1",6,0)
 ;
"RTN","LA7VMSG1",7,0)
 N LA,LAER,LA7VER
"RTN","LA7VMSG1",8,0)
 N EID,HLEID,HLMTIEN,HLRESLT,HLARYTYP,HLECH,HLFS,HLCOMP,HLFORMAT
"RTN","LA7VMSG1",9,0)
 N GBL,LA7MID,LA7V,LA7VS,LA7V0N,LA7VIEN,RSITE,LRNT
"RTN","LA7VMSG1",10,0)
 N LA76248,LA76249,LA76249P,LA7DT,LA7ECH,LA7END,LA7FS,LA7NVAF,LA7ROOT,LA7X,LRDFN,LRIDT,LRSS,LRUID
"RTN","LA7VMSG1",11,0)
 ;
"RTN","LA7VMSG1",12,0)
 ; variable list
"RTN","LA7VMSG1",13,0)
 ; LA("LRUID") - Host Unique ID from the local ACCESSION file (#68)
"RTN","LA7VMSG1",14,0)
 ; LA("SITE")  - Primary site number of remote site ($$SITE^VASITE)
"RTN","LA7VMSG1",15,0)
 ; LA("RUID")  - Remote sites Unique ID from ACCESSION file (#68)
"RTN","LA7VMSG1",16,0)
 ; LA("ORD")   - Free text ordered test name from WKLD CODE file (#64)
"RTN","LA7VMSG1",17,0)
 ; LA("LRNLT") - National Laboratory test code from WKLD CODE file (#64)
"RTN","LA7VMSG1",18,0)
 ; LA("LRIDT") - Inverse date/time (accession date/time)
"RTN","LA7VMSG1",19,0)
 ; LA("LRSS")  - test subscript defined in LABORATORY TEST file (#60)
"RTN","LA7VMSG1",20,0)
 ; LA("LRDFN") - IEN in LAB DATA file (#63)
"RTN","LA7VMSG1",21,0)
 ; LA("ORDT")  - Order date
"RTN","LA7VMSG1",22,0)
 ; LA(62.49)   - entry in #62.49 which contains pointer to results to build
"RTN","LA7VMSG1",23,0)
 ;
"RTN","LA7VMSG1",24,0)
 L +^LAHM(62.49,"HL7 PROCESS",LA7MTYP):0 Q:'$T
"RTN","LA7VMSG1",25,0)
 ;
"RTN","LA7VMSG1",26,0)
 S GBL="^TMP(""HLS"","_$J_")"
"RTN","LA7VMSG1",27,0)
 ;
"RTN","LA7VMSG1",28,0)
 D SORTPAT
"RTN","LA7VMSG1",29,0)
 I $D(^TMP("LA76248",$J)) D PROCESS
"RTN","LA7VMSG1",30,0)
 D KVAR^LRX
"RTN","LA7VMSG1",31,0)
 ;
"RTN","LA7VMSG1",32,0)
 ; Release lock
"RTN","LA7VMSG1",33,0)
 L -^LAHM(62.49,"HL7 PROCESS",LA7MTYP)
"RTN","LA7VMSG1",34,0)
 ;
"RTN","LA7VMSG1",35,0)
 K ^TMP("LA76248",$J),^TMP("LA7VS",$J),^TMP("HLS",$J)
"RTN","LA7VMSG1",36,0)
 ;
"RTN","LA7VMSG1",37,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","LA7VMSG1",38,0)
 ;
"RTN","LA7VMSG1",39,0)
 Q
"RTN","LA7VMSG1",40,0)
 ;
"RTN","LA7VMSG1",41,0)
 ;
"RTN","LA7VMSG1",42,0)
SORTPAT ; Sort all results for tranmsission
"RTN","LA7VMSG1",43,0)
 ;
"RTN","LA7VMSG1",44,0)
 N LA76248,LA76249,LA7END,LA7ROOT,LRDFN,LRUID
"RTN","LA7VMSG1",45,0)
 ;
"RTN","LA7VMSG1",46,0)
 K ^TMP("LA76248",$J)
"RTN","LA7VMSG1",47,0)
 ; Flag to indicate end of global.
"RTN","LA7VMSG1",48,0)
 S LA7END=0
"RTN","LA7VMSG1",49,0)
 ;
"RTN","LA7VMSG1",50,0)
 ; Sort by configuration (LA76248), patient (LRDFN), UID (LRUID), file #62.49 ien (LA76249)
"RTN","LA7VMSG1",51,0)
 S LA7ROOT="^LAHM(62.49,""AC"",LA7MTYP,""P"")"
"RTN","LA7VMSG1",52,0)
 F  S LA7ROOT=$Q(@LA7ROOT) Q:LA7END  D
"RTN","LA7VMSG1",53,0)
 . I $QS(LA7ROOT,3)'=LA7MTYP!($QS(LA7ROOT,6)<1) S LA7END=1 Q
"RTN","LA7VMSG1",54,0)
 . S LA76248=$QS(LA7ROOT,5),LA76249=$QS(LA7ROOT,6)
"RTN","LA7VMSG1",55,0)
 . L +^LAHM(62.49,LA76249):5 Q:'$T
"RTN","LA7VMSG1",56,0)
 . S LRDFN=$P($G(^LAHM(62.49,LA76249,63)),"^",8)
"RTN","LA7VMSG1",57,0)
 . S LRUID=$P($G(^LAHM(62.49,LA76249,63)),"^",1)
"RTN","LA7VMSG1",58,0)
 . I LRDFN,LRUID]"" S ^TMP("LA76248",$J,LA76248,LRDFN,LRUID,LA76249)=""
"RTN","LA7VMSG1",59,0)
 . L -^LAHM(62.49,LA76249)
"RTN","LA7VMSG1",60,0)
 ;
"RTN","LA7VMSG1",61,0)
 Q
"RTN","LA7VMSG1",62,0)
 ;
"RTN","LA7VMSG1",63,0)
 ;
"RTN","LA7VMSG1",64,0)
PROCESS ; Process and build messages to be sent
"RTN","LA7VMSG1",65,0)
 ;
"RTN","LA7VMSG1",66,0)
 N LA7101,LA76248,LA76249,LA76249P,LA7INTYP,LA7NTESN,LA7OBRSN,LA7OBXSN,LA7PIDSN,LA7SMSG,LA7VS,LRDFN
"RTN","LA7VMSG1",67,0)
 ;
"RTN","LA7VMSG1",68,0)
 ; Cleanup
"RTN","LA7VMSG1",69,0)
 K ^TMP("LA7VS",$J),^TMP("HLS",$J)
"RTN","LA7VMSG1",70,0)
 ; Initialize variables
"RTN","LA7VMSG1",71,0)
 S (LA76248,LA76249,LA76249P,LA7END,LRDFN)=0,LRUID=""
"RTN","LA7VMSG1",72,0)
 ;
"RTN","LA7VMSG1",73,0)
 ; Process sorted list of results to transmit.
"RTN","LA7VMSG1",74,0)
 S LA7ROOT="^TMP(""LA76248"",$J)"
"RTN","LA7VMSG1",75,0)
 F  S LA7ROOT=$Q(@LA7ROOT) Q:LA7ROOT=""  D  Q:LA7END
"RTN","LA7VMSG1",76,0)
 . I $QS(LA7ROOT,1)'="LA76248"!($QS(LA7ROOT,2)'=$J) S LA7END=1 Q
"RTN","LA7VMSG1",77,0)
 . I LA76248'=$QS(LA7ROOT,3) D CONFIG
"RTN","LA7VMSG1",78,0)
 . I '$P(LA76248(0),"^",3) Q
"RTN","LA7VMSG1",79,0)
 . S LA7INTYP=+$P(LA76248(0),"^",9)
"RTN","LA7VMSG1",80,0)
 . S (LA76249,LA(62.49))=$QS(LA7ROOT,6)
"RTN","LA7VMSG1",81,0)
 . S LA7X=$G(^LAHM(62.49,LA76249,63))
"RTN","LA7VMSG1",82,0)
 . S LA("HUID")=$P(LA7X,U),LA("SITE")=$P(LA7X,U,2),LA("RUID")=$P(LA7X,U,3),LA("ORD")=$P(LA7X,U,4),LA("NLT")=$P(LA7X,U,5),LA("LRIDT")=$P(LA7X,U,6),LA("SUB")=$P(LA7X,U,7),LA("LRDFN")=$P(LA7X,U,8),LA("ORDT")=$P(LA7X,U,9)
"RTN","LA7VMSG1",83,0)
 . S LA7NVAF=$$NVAF^LA7VHLU2(+LA("SITE"))
"RTN","LA7VMSG1",84,0)
 . I LRUID'=$QS(LA7ROOT,5),LA7SMSG=2 D PAT Q:LA7END
"RTN","LA7VMSG1",85,0)
 . I LRDFN'=$QS(LA7ROOT,4) D PAT Q:LA7END
"RTN","LA7VMSG1",86,0)
 . S LRUID=$QS(LA7ROOT,5)
"RTN","LA7VMSG1",87,0)
 . S ^TMP("LA7VS",$J,LA76249)=LA76249P
"RTN","LA7VMSG1",88,0)
 . N LA76249
"RTN","LA7VMSG1",89,0)
 . S LA76249=LA76249P
"RTN","LA7VMSG1",90,0)
 . I LA7MTYP="ORU" D EN^LA7VORU(.LA)
"RTN","LA7VMSG1",91,0)
 . I LA7MTYP="ORR" D EN^LA7VORR1(.LA)
"RTN","LA7VMSG1",92,0)
 ;
"RTN","LA7VMSG1",93,0)
 I LA76249P D SENDMSG
"RTN","LA7VMSG1",94,0)
 ;
"RTN","LA7VMSG1",95,0)
 Q
"RTN","LA7VMSG1",96,0)
 ;
"RTN","LA7VMSG1",97,0)
 ;
"RTN","LA7VMSG1",98,0)
STARTMSG ; Initialize a HL7 message and variables
"RTN","LA7VMSG1",99,0)
 ;
"RTN","LA7VMSG1",100,0)
 N LA7EVNT,SITE
"RTN","LA7VMSG1",101,0)
 ;
"RTN","LA7VMSG1",102,0)
 K ^TMP("LA7VS",$J),@GBL
"RTN","LA7VMSG1",103,0)
 ;
"RTN","LA7VMSG1",104,0)
 S LA76249P=LA76249
"RTN","LA7VMSG1",105,0)
 S SITE=$$RETFACID^LA7VHLU2(LA("SITE"),2,1)
"RTN","LA7VMSG1",106,0)
 ;
"RTN","LA7VMSG1",107,0)
 I LA7MTYP="ORU" S LA7EVNT="LA7V Results Reporting to "_SITE
"RTN","LA7VMSG1",108,0)
 I LA7MTYP="ORR" S LA7EVNT="LA7V Order Response to "_SITE
"RTN","LA7VMSG1",109,0)
 D STARTMSG^LA7VHLU(LA7EVNT,LA76249P)
"RTN","LA7VMSG1",110,0)
 I $G(HL) S LA7END=1
"RTN","LA7VMSG1",111,0)
 ;
"RTN","LA7VMSG1",112,0)
 Q
"RTN","LA7VMSG1",113,0)
 ;
"RTN","LA7VMSG1",114,0)
 ;
"RTN","LA7VMSG1",115,0)
SENDMSG ; File HL7 message with HL and LAB packages
"RTN","LA7VMSG1",116,0)
 ;
"RTN","LA7VMSG1",117,0)
 ; No data to send
"RTN","LA7VMSG1",118,0)
 I '$D(^TMP("HLS",$J)) Q
"RTN","LA7VMSG1",119,0)
 ;
"RTN","LA7VMSG1",120,0)
 D GEN^LA7VHLU
"RTN","LA7VMSG1",121,0)
 I $P(LA7MID,U)=0 D
"RTN","LA7VMSG1",122,0)
 . N LA7X
"RTN","LA7VMSG1",123,0)
 . S LA7X(1)=LA76249P,LA7X(2)=$TR($P(HLMID,"^",2,3),"^","-")
"RTN","LA7VMSG1",124,0)
 . D CREATE^LA7LOG(28)
"RTN","LA7VMSG1",125,0)
 ;
"RTN","LA7VMSG1",126,0)
 D UPDT6249
"RTN","LA7VMSG1",127,0)
 D UPDLPD
"RTN","LA7VMSG1",128,0)
 ;
"RTN","LA7VMSG1",129,0)
 S (LA76249P,LA7PIDSN,LA7OBRSN,LA7OBXSN,LA7NTESN)=0
"RTN","LA7VMSG1",130,0)
 ;
"RTN","LA7VMSG1",131,0)
 Q
"RTN","LA7VMSG1",132,0)
 ;
"RTN","LA7VMSG1",133,0)
 ;
"RTN","LA7VMSG1",134,0)
CONFIG ; Setup for this configuration
"RTN","LA7VMSG1",135,0)
 ;
"RTN","LA7VMSG1",136,0)
 ; Send a building message
"RTN","LA7VMSG1",137,0)
 I LA76249P D SENDMSG
"RTN","LA7VMSG1",138,0)
 ;
"RTN","LA7VMSG1",139,0)
 ; Retrieve configuration information from #62.48
"RTN","LA7VMSG1",140,0)
 S LA76248=$QS(LA7ROOT,3)
"RTN","LA7VMSG1",141,0)
 S LA76248(0)=$G(^LAHM(62.48,LA76248,0))
"RTN","LA7VMSG1",142,0)
 ;
"RTN","LA7VMSG1",143,0)
 ; Flag to control message building; 1-one patient/msg, 2-one order/msg
"RTN","LA7VMSG1",144,0)
 S LA7SMSG=+$P(LA76248(0),"^",8)
"RTN","LA7VMSG1",145,0)
 ;
"RTN","LA7VMSG1",146,0)
 ; Initialize variables
"RTN","LA7VMSG1",147,0)
 S (LA76249,LA76249P,LRDFN)=0
"RTN","LA7VMSG1",148,0)
 S LRUID=""
"RTN","LA7VMSG1",149,0)
 ;
"RTN","LA7VMSG1",150,0)
 Q
"RTN","LA7VMSG1",151,0)
 ;
"RTN","LA7VMSG1",152,0)
 ;
"RTN","LA7VMSG1",153,0)
PAT ; Build patient information
"RTN","LA7VMSG1",154,0)
 ;
"RTN","LA7VMSG1",155,0)
 N LA7ALTID,LA7EXTID,LA7PID,LA7PV1
"RTN","LA7VMSG1",156,0)
 ;
"RTN","LA7VMSG1",157,0)
 ; If one patient/msg or one order/msg and message building then send it.
"RTN","LA7VMSG1",158,0)
 I LA7SMSG>0,LA76249P D SENDMSG
"RTN","LA7VMSG1",159,0)
 ;
"RTN","LA7VMSG1",160,0)
 ; If no message building then start one.
"RTN","LA7VMSG1",161,0)
 I 'LA76249P S LA7PIDSN=0 D STARTMSG Q:LA7END
"RTN","LA7VMSG1",162,0)
 ;
"RTN","LA7VMSG1",163,0)
 ; Setup PID and PV1 segments.
"RTN","LA7VMSG1",164,0)
 S LRDFN=$QS(LA7ROOT,4)
"RTN","LA7VMSG1",165,0)
 S LRDPF=$P(^LR(LRDFN,0),"^",2),DFN=$P(^(0),"^",3)
"RTN","LA7VMSG1",166,0)
 D DEM^LRX
"RTN","LA7VMSG1",167,0)
 ;
"RTN","LA7VMSG1",168,0)
 ; Send placer's patient id (PID-3), return in PID-2, return PID-4 with alternate id
"RTN","LA7VMSG1",169,0)
 S (LA7ALTID,LA7EXTID)=""
"RTN","LA7VMSG1",170,0)
 D PTEXTID^LA7VHLU(LA("SITE"),LA("RUID"),.LA7EXTID)
"RTN","LA7VMSG1",171,0)
 I $G(LA7EXTID("PID-2"))'="" S LA7EXTID=$$CNVFLD^LA7VHLU3(LA7EXTID("PID-2"),LA7EXTID("ECH"),LA7ECH)
"RTN","LA7VMSG1",172,0)
 I $G(LA7EXTID("PID-4"))'="" S LA7ALTID=$$CNVFLD^LA7VHLU3(LA7EXTID("PID-4"),LA7EXTID("ECH"),LA7ECH)
"RTN","LA7VMSG1",173,0)
 ;
"RTN","LA7VMSG1",174,0)
 ; Build PID segment
"RTN","LA7VMSG1",175,0)
 D PID^LA7VPID(LRDFN,LA7EXTID,.LA7PID,.LA7PIDSN,.HL,LA7ALTID)
"RTN","LA7VMSG1",176,0)
 D FILESEG^LA7VHLU(GBL,.LA7PID)
"RTN","LA7VMSG1",177,0)
 D FILE6249^LA7VHLU(LA76249P,.LA7PID)
"RTN","LA7VMSG1",178,0)
 ;
"RTN","LA7VMSG1",179,0)
 ; Build PV1 segment
"RTN","LA7VMSG1",180,0)
 ; Not built when sending to DoD facility - not used by CHCS
"RTN","LA7VMSG1",181,0)
 I LA7NVAF'=1 D
"RTN","LA7VMSG1",182,0)
 . D PV1^LA7VPID(LRDFN,.LA7PV1,LA7FS,LA7ECH)
"RTN","LA7VMSG1",183,0)
 . D FILESEG^LA7VHLU(GBL,.LA7PV1)
"RTN","LA7VMSG1",184,0)
 . D FILE6249^LA7VHLU(LA76249P,.LA7PV1)
"RTN","LA7VMSG1",185,0)
 ;
"RTN","LA7VMSG1",186,0)
 S LRUID="",(LA7OBRSN,LA7OBXSN,LA7NTESN)=0
"RTN","LA7VMSG1",187,0)
 ;
"RTN","LA7VMSG1",188,0)
 Q
"RTN","LA7VMSG1",189,0)
 ;
"RTN","LA7VMSG1",190,0)
 ;
"RTN","LA7VMSG1",191,0)
UPDT6249 ; Update entries in file #62.49
"RTN","LA7VMSG1",192,0)
 ;
"RTN","LA7VMSG1",193,0)
 N LA7ERR,LA76249,LA76249P
"RTN","LA7VMSG1",194,0)
 ;
"RTN","LA7VMSG1",195,0)
 S LA76249=0
"RTN","LA7VMSG1",196,0)
 F  S LA76249=$O(^TMP("LA7VS",$J,LA76249)) Q:'LA76249  D
"RTN","LA7VMSG1",197,0)
 . N FDA,LA7ERR
"RTN","LA7VMSG1",198,0)
 . S LA76249P=+$G(^TMP("LA7VS",$J,LA76249))
"RTN","LA7VMSG1",199,0)
 . ; Set pointer to parent on child entry.
"RTN","LA7VMSG1",200,0)
 . I LA76249'=LA76249P S FDA(1,62.49,LA76249_",",6)=LA76249P
"RTN","LA7VMSG1",201,0)
 . I $G(HL("APAT"))="AL"!($G(HL("APAT"))="") S FDA(1,62.49,LA76249_",",2)="A"
"RTN","LA7VMSG1",202,0)
 . E  S FDA(1,62.49,LA76249_",",2)="X"
"RTN","LA7VMSG1",203,0)
 . S FDA(1,62.49,LA76249_",",102)=HL("SAN")
"RTN","LA7VMSG1",204,0)
 . S FDA(1,62.49,LA76249_",",103)=HL("SAF")
"RTN","LA7VMSG1",205,0)
 . S FDA(1,62.49,LA76249_",",108)=HL("MTN")
"RTN","LA7VMSG1",206,0)
 . S FDA(1,62.49,LA76249_",",110)=HL("PID")
"RTN","LA7VMSG1",207,0)
 . S FDA(1,62.49,LA76249_",",111)=HL("VER")
"RTN","LA7VMSG1",208,0)
 . I $P($G(LA7MID),"^")'="" S FDA(1,62.49,LA76249_",",109)=$P(LA7MID,"^")
"RTN","LA7VMSG1",209,0)
 . I $P($G(LA7MID),"^",2) D
"RTN","LA7VMSG1",210,0)
 . . S FDA(1,62.49,LA76249_",",160)=$P(LA7MID,"^",2)
"RTN","LA7VMSG1",211,0)
 . . S FDA(1,62.49,LA76249_",",161)=$P(LA7MID,"^",3)
"RTN","LA7VMSG1",212,0)
 . D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VMSG1",213,0)
 . D CLEAN^DILF
"RTN","LA7VMSG1",214,0)
 ;
"RTN","LA7VMSG1",215,0)
 Q
"RTN","LA7VMSG1",216,0)
 ;
"RTN","LA7VMSG1",217,0)
 ;
"RTN","LA7VMSG1",218,0)
UPDLPD ; Update lab pending orders (#69.6) for each entry in #62.49
"RTN","LA7VMSG1",219,0)
 ;
"RTN","LA7VMSG1",220,0)
 N LA76249
"RTN","LA7VMSG1",221,0)
 ;
"RTN","LA7VMSG1",222,0)
 S LA76249=0
"RTN","LA7VMSG1",223,0)
 F  S LA76249=$O(^TMP("LA7VS",$J,LA76249)) Q:'LA76249  D UPD696
"RTN","LA7VMSG1",224,0)
 Q
"RTN","LA7VMSG1",225,0)
 ;
"RTN","LA7VMSG1",226,0)
 ;
"RTN","LA7VMSG1",227,0)
UPD696 ; Update LAB PENDING ORDERS file #69.6
"RTN","LA7VMSG1",228,0)
 ;
"RTN","LA7VMSG1",229,0)
 N LA74,LA7696,LA76964,LA7ERR,LA7ORDT,LA7STAT,LA7X
"RTN","LA7VMSG1",230,0)
 ;
"RTN","LA7VMSG1",231,0)
 ; Find "Results Available" status in #64.061
"RTN","LA7VMSG1",232,0)
 S LA7STAT=$$FIND1^DIC(64.061,"","OMX","Results Available","","I $P(^LAB(64.061,Y,0),U,7)=""U""")
"RTN","LA7VMSG1",233,0)
 ;
"RTN","LA7VMSG1",234,0)
 S LA7X=$G(^LAHM(62.49,LA76249,63))
"RTN","LA7VMSG1",235,0)
 ;
"RTN","LA7VMSG1",236,0)
 ; Ordering institution - pointer to file #4
"RTN","LA7VMSG1",237,0)
 S LA74=$P(LA7X,"^",2)
"RTN","LA7VMSG1",238,0)
 I LA74="" Q
"RTN","LA7VMSG1",239,0)
 ;
"RTN","LA7VMSG1",240,0)
 ; Ordered test
"RTN","LA7VMSG1",241,0)
 S LA7ORDT=$P(LA7X,"^",4)
"RTN","LA7VMSG1",242,0)
 I LA7ORDT="" Q
"RTN","LA7VMSG1",243,0)
 ;
"RTN","LA7VMSG1",244,0)
 ; File #69.6 ien and ordered test multiple ien
"RTN","LA7VMSG1",245,0)
 S LA7696=0
"RTN","LA7VMSG1",246,0)
 F  S LA7696=$O(^LRO(69.6,"RST",LA74,LA("RUID"),LA7696)) Q:'LA7696  D
"RTN","LA7VMSG1",247,0)
 . N FDA
"RTN","LA7VMSG1",248,0)
 . S LA76964=$O(^LRO(69.6,LA7696,2,"B",LA7ORDT,0))
"RTN","LA7VMSG1",249,0)
 . I LA76964<1 Q
"RTN","LA7VMSG1",250,0)
 . ;
"RTN","LA7VMSG1",251,0)
 . L +^LRO(69.6,LA7696):99999
"RTN","LA7VMSG1",252,0)
 . ; Cannot get lock on ENTRY in 69.6
"RTN","LA7VMSG1",253,0)
 . I '$T D CREATE^LA7LOG(33) Q
"RTN","LA7VMSG1",254,0)
 . ;
"RTN","LA7VMSG1",255,0)
 . ; Store outgoing HL7 message ID
"RTN","LA7VMSG1",256,0)
 . S FDA(1,69.64,LA76964_","_LA7696_",",7)=$P(LA7MID,U)
"RTN","LA7VMSG1",257,0)
 . ; Set to Results Available.
"RTN","LA7VMSG1",258,0)
 . S FDA(1,69.64,LA76964_","_LA7696_",",5)=LA7STAT
"RTN","LA7VMSG1",259,0)
 . D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VMSG1",260,0)
 . D CLEAN^DILF
"RTN","LA7VMSG1",261,0)
 . ;
"RTN","LA7VMSG1",262,0)
 . L -^LRO(69.6,LA7696)
"RTN","LA7VMSG1",263,0)
 ;
"RTN","LA7VMSG1",264,0)
 Q
"RTN","LA7VOBR")
0^21^B25844567^B23749256
"RTN","LA7VOBR",1,0)
LA7VOBR ;DALOI/JMC - LAB OBR segment builder ;Sep 18, 2007
"RTN","LA7VOBR",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VOBR",3,0)
 ;
"RTN","LA7VOBR",4,0)
 Q
"RTN","LA7VOBR",5,0)
 ;
"RTN","LA7VOBR",6,0)
 ;
"RTN","LA7VOBR",7,0)
OBR1(LA7OBRSN) ; Build OBR-1 sequence - set segment id
"RTN","LA7VOBR",8,0)
 ; Call with LA7OBRSN = segment id (pass by reference)
"RTN","LA7VOBR",9,0)
 ;
"RTN","LA7VOBR",10,0)
 S LA7OBRSN=$G(LA7OBRSN)+1
"RTN","LA7VOBR",11,0)
 Q LA7OBRSN
"RTN","LA7VOBR",12,0)
 ;
"RTN","LA7VOBR",13,0)
 ;
"RTN","LA7VOBR",14,0)
OBR2(LA7ID,LA7FS,LA7ECH) ; Build OBR-2 sequence - placer's specimen id
"RTN","LA7VOBR",15,0)
 ; Call with LA7ID = placer's specimen id (accn number/UID)
"RTN","LA7VOBR",16,0)
 ;           LA7ID("NMSP") = application namespace (optional)
"RTN","LA7VOBR",17,0)
 ;           LA7ID("SITE") = placer facility
"RTN","LA7VOBR",18,0)
 ;           LA7FS = HL7 field separator
"RTN","LA7VOBR",19,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBR",20,0)
 ;
"RTN","LA7VOBR",21,0)
 N LA7X,LA7Y
"RTN","LA7VOBR",22,0)
 D OBR2^LA7VOBRA
"RTN","LA7VOBR",23,0)
 Q LA7Y
"RTN","LA7VOBR",24,0)
 ;
"RTN","LA7VOBR",25,0)
 ;
"RTN","LA7VOBR",26,0)
OBR3(LA7ID,LA7FS,LA7ECH) ; Build OBR-3 sequence - filler's specimen id
"RTN","LA7VOBR",27,0)
 ; Call with LA7ID = filler's specimen id (accn number/UID)
"RTN","LA7VOBR",28,0)
 ;           LA7ID("NMSP") = application namespace (optional)
"RTN","LA7VOBR",29,0)
 ;           LA7ID("SITE") = filler facility
"RTN","LA7VOBR",30,0)
 ;           LA7FS = HL7 field separator
"RTN","LA7VOBR",31,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBR",32,0)
 ;
"RTN","LA7VOBR",33,0)
 N LA7X,LA7Y
"RTN","LA7VOBR",34,0)
 D OBR3^LA7VOBRA
"RTN","LA7VOBR",35,0)
 Q LA7Y
"RTN","LA7VOBR",36,0)
 ;
"RTN","LA7VOBR",37,0)
 ;
"RTN","LA7VOBR",38,0)
OBR4(LA7NLT,LA760,LA7ALT,LA7FS,LA7ECH) ; Build OBR-4 sequence - Universal service ID
"RTN","LA7VOBR",39,0)
 ; Call with LA7NLT = NLT test code
"RTN","LA7VOBR",40,0)
 ;            LA760 = file #60 ien if known
"RTN","LA7VOBR",41,0)
 ;           LA7ALT = alternate order code and system in form 
"RTN","LA7VOBR",42,0)
 ;                     test code^test name^coding system
"RTN","LA7VOBR",43,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",44,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",45,0)
 ;
"RTN","LA7VOBR",46,0)
 ; Returns     LA7Y = OBR-4 sequence
"RTN","LA7VOBR",47,0)
 ;
"RTN","LA7VOBR",48,0)
 N LA764,LA7COMP,LA7ERR,LA7TN,LA7X,LA7Y,LA7Z
"RTN","LA7VOBR",49,0)
 D OBR4^LA7VOBRA
"RTN","LA7VOBR",50,0)
 Q LA7Y
"RTN","LA7VOBR",51,0)
 ;
"RTN","LA7VOBR",52,0)
 ;
"RTN","LA7VOBR",53,0)
OBR6(LA7DT) ; Build OBR-6 sequence - requested date/time
"RTN","LA7VOBR",54,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBR",55,0)
 ; Returns OBR-6 sequence
"RTN","LA7VOBR",56,0)
 ;
"RTN","LA7VOBR",57,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBR",58,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBR",59,0)
 ;
"RTN","LA7VOBR",60,0)
 ;
"RTN","LA7VOBR",61,0)
OBR7(LA7DT) ; Build OBR-7 sequence - collection date/time
"RTN","LA7VOBR",62,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBR",63,0)
 ; Returns OBR-7 sequence
"RTN","LA7VOBR",64,0)
 ;
"RTN","LA7VOBR",65,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBR",66,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBR",67,0)
 ;
"RTN","LA7VOBR",68,0)
 ;
"RTN","LA7VOBR",69,0)
OBR8(LA7DT) ; Build OBR-8 sequence - collection end date/time
"RTN","LA7VOBR",70,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBR",71,0)
 ; Returns OBR-8 sequence
"RTN","LA7VOBR",72,0)
 ;
"RTN","LA7VOBR",73,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBR",74,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBR",75,0)
 ;
"RTN","LA7VOBR",76,0)
 ;
"RTN","LA7VOBR",77,0)
OBR9(LA7VOL,LA764061,LA7FS,LA7ECH) ; Build OBR-9 sequence - collection volume
"RTN","LA7VOBR",78,0)
 ; Call with    LA7VOL = collection volume
"RTN","LA7VOBR",79,0)
 ;            LA764061 = units (pointer to #64.061)
"RTN","LA7VOBR",80,0)
 ;               LA7FS = HL7 field separator
"RTN","LA7VOBR",81,0)
 ;              LA7ECH = HL encoding characters
"RTN","LA7VOBR",82,0)
 ; Returns OBR-9 sequence
"RTN","LA7VOBR",83,0)
 ;
"RTN","LA7VOBR",84,0)
 N LA7IENS,LA7X,LA7Y
"RTN","LA7VOBR",85,0)
 D OBR9^LA7VOBRA
"RTN","LA7VOBR",86,0)
 Q LA7Y
"RTN","LA7VOBR",87,0)
 ;
"RTN","LA7VOBR",88,0)
 ;
"RTN","LA7VOBR",89,0)
OBR11(LA7X) ; Build OBR-11 sequence - speciman action code
"RTN","LA7VOBR",90,0)
 ; Call with LA7X = HL7 Table 0065 entry
"RTN","LA7VOBR",91,0)
 ; Returns OBR-11 sequence
"RTN","LA7VOBR",92,0)
 ;
"RTN","LA7VOBR",93,0)
 ; JMC-12/09/99 Need to expand this function to determine based on collection status
"RTN","LA7VOBR",94,0)
 ;
"RTN","LA7VOBR",95,0)
 Q LA7X
"RTN","LA7VOBR",96,0)
 ;
"RTN","LA7VOBR",97,0)
 ;
"RTN","LA7VOBR",98,0)
OBR12(LRDFN,LA7FS,LA7ECH) ; Build OBR-12 sequence - patient info
"RTN","LA7VOBR",99,0)
 ; Call with  LRDFN = ien of patient in #63
"RTN","LA7VOBR",100,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",101,0)
 ;           LA7ECH = HL7 encoding characters
"RTN","LA7VOBR",102,0)
 ; Returns OBR-12 sequence
"RTN","LA7VOBR",103,0)
 ;
"RTN","LA7VOBR",104,0)
 N LA7X
"RTN","LA7VOBR",105,0)
 ;
"RTN","LA7VOBR",106,0)
 S LRDFN=$G(LRDFN),LA7ECH=$G(LA7ECH)
"RTN","LA7VOBR",107,0)
 ; Infection Warning
"RTN","LA7VOBR",108,0)
 S LA7X=$P($G(^LR(LRDFN,.091)),"^")
"RTN","LA7VOBR",109,0)
 I LA7X'="" D
"RTN","LA7VOBR",110,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VOBR",111,0)
 . S LA7X=$E(LA7ECH,1)_LA7X
"RTN","LA7VOBR",112,0)
 ;
"RTN","LA7VOBR",113,0)
 Q LA7X
"RTN","LA7VOBR",114,0)
 ;
"RTN","LA7VOBR",115,0)
 ;
"RTN","LA7VOBR",116,0)
OBR13(LA7TXT,LA7FS,LA7ECH) ; Build OBR-13 sequence - revelant clinical info
"RTN","LA7VOBR",117,0)
 ; Call with LA7TXT = text to place into OBR-13
"RTN","LA7VOBR",118,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",119,0)
 ;           LA7ECH = HL7 encoding characters
"RTN","LA7VOBR",120,0)
 ; Returns OBR-12 sequence
"RTN","LA7VOBR",121,0)
 ;
"RTN","LA7VOBR",122,0)
 N LA7X
"RTN","LA7VOBR",123,0)
 S LA7X=$$CHKDATA^LA7VHLU3(LA7TXT,LA7FS_LA7ECH)
"RTN","LA7VOBR",124,0)
 Q LA7X
"RTN","LA7VOBR",125,0)
 ;
"RTN","LA7VOBR",126,0)
 ;
"RTN","LA7VOBR",127,0)
OBR14(LA7DT) ; Build OBR-14 sequence - speciman arrival date/time
"RTN","LA7VOBR",128,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBR",129,0)
 ; Returns OBR-14 sequence
"RTN","LA7VOBR",130,0)
 ;
"RTN","LA7VOBR",131,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBR",132,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBR",133,0)
 ;
"RTN","LA7VOBR",134,0)
 ;
"RTN","LA7VOBR",135,0)
OBR15(LA761,LA762,LA7ALT,LA7FS,LA7ECH,LA7CM,LA7SNM) ; Build OBR-15 sequence - specimen source
"RTN","LA7VOBR",136,0)
 ; Call with LA761 = ien of topography file #61
"RTN","LA7VOBR",137,0)
 ;           LA762 = ien of collection sample in file #62
"RTN","LA7VOBR",138,0)
 ;          LA7ALT = alternate non-HL7 codes/text/coding system in form -
"RTN","LA7VOBR",139,0)
 ;                   specimen code^specimen text^specimen system^CONTROL^collection sample code^collection sample^collection system.
"RTN","LA7VOBR",140,0)
 ;                   "CONTROL" only present when specimen is a lab control from file #62.3.
"RTN","LA7VOBR",141,0)
 ;                   presence of these will override standard HL7 tables
"RTN","LA7VOBR",142,0)
 ;           LA7FS = HL7 field separator
"RTN","LA7VOBR",143,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBR",144,0)
 ;           LA7CM = ien of shipping condition file #62.93 (collection method)
"RTN","LA7VOBR",145,0)
 ;          LA7SNM = 1-flag to send SNOMED CT instead of HL7 table 0070
"RTN","LA7VOBR",146,0)
 ;
"RTN","LA7VOBR",147,0)
 ; Returns OBR-15 sequence in LA7Y
"RTN","LA7VOBR",148,0)
 ;
"RTN","LA7VOBR",149,0)
 N LA764061,LA7COMP,LA7ERR,LA7X,LA7Y,LA7Z,X,Y
"RTN","LA7VOBR",150,0)
 D OBR15^LA7VOBRB
"RTN","LA7VOBR",151,0)
 Q LA7Y
"RTN","LA7VOBR",152,0)
 ;
"RTN","LA7VOBR",153,0)
 ;
"RTN","LA7VOBR",154,0)
OBR18(LA7X,LA7FS,LA7ECH) ; Build OBR-18 sequence - Placer's field #1
"RTN","LA7VOBR",155,0)
 ; Call with   LA7X = array containing components to store, pass by reference.
"RTN","LA7VOBR",156,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",157,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",158,0)
 ;
"RTN","LA7VOBR",159,0)
 ; Returns OBR-18 sequence
"RTN","LA7VOBR",160,0)
 ;
"RTN","LA7VOBR",161,0)
 N LA7I,LA7Y,LA7Z
"RTN","LA7VOBR",162,0)
 D OBRPF^LA7VOBRA
"RTN","LA7VOBR",163,0)
 Q LA7Y
"RTN","LA7VOBR",164,0)
 ;
"RTN","LA7VOBR",165,0)
 ;
"RTN","LA7VOBR",166,0)
OBR19(LA7X,LA7FS,LA7ECH) ; Build OBR-19 sequence - Placer's field #2
"RTN","LA7VOBR",167,0)
 ; Call with LA7X() = array containing components to store, pass by reference.
"RTN","LA7VOBR",168,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",169,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",170,0)
 ;
"RTN","LA7VOBR",171,0)
 ; Returns OBR-19 sequence
"RTN","LA7VOBR",172,0)
 ;
"RTN","LA7VOBR",173,0)
 N LA7I,LA7Y,LA7Z
"RTN","LA7VOBR",174,0)
 D OBRPF^LA7VOBRA
"RTN","LA7VOBR",175,0)
 Q LA7Y
"RTN","LA7VOBR",176,0)
 ;
"RTN","LA7VOBR",177,0)
 ;
"RTN","LA7VOBR",178,0)
OBR20(LA7X,LA7FS,LA7ECH) ; Build OBR-20 sequence - Filler's field #1
"RTN","LA7VOBR",179,0)
 ; Call with   LA7X = array containing components to store, pass by reference.
"RTN","LA7VOBR",180,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",181,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",182,0)
 ;
"RTN","LA7VOBR",183,0)
 ; Returns OBR-20 sequence
"RTN","LA7VOBR",184,0)
 ;
"RTN","LA7VOBR",185,0)
 N LA7I,LA7Y,LA7Z
"RTN","LA7VOBR",186,0)
 D OBRPF^LA7VOBRA
"RTN","LA7VOBR",187,0)
 Q LA7Y
"RTN","LA7VOBR",188,0)
 ;
"RTN","LA7VOBR",189,0)
 ;
"RTN","LA7VOBR",190,0)
OBR21(LA7X,LA7FS,LA7ECH) ; Build OBR-21 sequence - Filler's field #2
"RTN","LA7VOBR",191,0)
 ; Call with LA7X() = array containing components to store, pass by reference.
"RTN","LA7VOBR",192,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",193,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",194,0)
 ;
"RTN","LA7VOBR",195,0)
 ; Returns OBR-21 sequence
"RTN","LA7VOBR",196,0)
 ;
"RTN","LA7VOBR",197,0)
 N LA7I,LA7Y,LA7Z
"RTN","LA7VOBR",198,0)
 D OBRPF^LA7VOBRA
"RTN","LA7VOBR",199,0)
 Q LA7Y
"RTN","LA7VOBR",200,0)
 ;
"RTN","LA7VOBR",201,0)
 ;
"RTN","LA7VOBR",202,0)
OBR22(LA7DT) ; Build OBR-22 sequence - date report completed
"RTN","LA7VOBR",203,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBR",204,0)
 ;
"RTN","LA7VOBR",205,0)
 ; Returns OBR-22 sequence
"RTN","LA7VOBR",206,0)
 ;
"RTN","LA7VOBR",207,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBR",208,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBR",209,0)
 ;
"RTN","LA7VOBR",210,0)
 ;
"RTN","LA7VOBR",211,0)
OBR24(LA7SS) ; Build OBR-24 sequence - diagnostic service id
"RTN","LA7VOBR",212,0)
 ; Call with LA7SS = File #63 subscript^section within subscript
"RTN","LA7VOBR",213,0)
 ;
"RTN","LA7VOBR",214,0)
 ; Returns OBR-24 sequence
"RTN","LA7VOBR",215,0)
 ;
"RTN","LA7VOBR",216,0)
 N LA7Y,LA7X
"RTN","LA7VOBR",217,0)
 D OBR24^LA7VOBRA
"RTN","LA7VOBR",218,0)
 Q LA7Y
"RTN","LA7VOBR",219,0)
 ;
"RTN","LA7VOBR",220,0)
 ;
"RTN","LA7VOBR",221,0)
OBR25(LA7FLAG) ; Build OBR-25 sequence - Result status
"RTN","LA7VOBR",222,0)
 ; Call with LA7FLAG = VistA Lab status flag
"RTN","LA7VOBR",223,0)
 ; Returns result status based on HL7 table 0123
"RTN","LA7VOBR",224,0)
 ;
"RTN","LA7VOBR",225,0)
 N LA7Y
"RTN","LA7VOBR",226,0)
 D OBR25^LA7VOBRA
"RTN","LA7VOBR",227,0)
 Q LA7Y
"RTN","LA7VOBR",228,0)
 ;
"RTN","LA7VOBR",229,0)
 ;
"RTN","LA7VOBR",230,0)
OBR26(LA7OBX3,LA7OBX4,LA7OBX5,LA7FS,LA7ECH)     ; Build OBR-26 sequence - Parent result
"RTN","LA7VOBR",231,0)
 ; Call with LA7OBX3 = OBX-3 observation id of parent result
"RTN","LA7VOBR",232,0)
 ;           LA7OBX4 = OBX-4 sub-id of parent result
"RTN","LA7VOBR",233,0)
 ;           LA7OBX5 = OBX-5 parent result
"RTN","LA7VOBR",234,0)
 ;             LA7FS = HL7 Field separator
"RTN","LA7VOBR",235,0)
 ;            LA7ECH = HL7 encoding characters
"RTN","LA7VOBR",236,0)
 ;
"RTN","LA7VOBR",237,0)
 N LA7C,LA7SC,LA7Y,LA7Z
"RTN","LA7VOBR",238,0)
 D OBR26^LA7VOBRA
"RTN","LA7VOBR",239,0)
 Q LA7Y
"RTN","LA7VOBR",240,0)
 ;
"RTN","LA7VOBR",241,0)
 ;
"RTN","LA7VOBR",242,0)
OBR27(LA7DUR,LA7DURU,LA76205,LA7FS,LA7ECH) ; Build OBR-27 sequence - Quantity/Timing
"RTN","LA7VOBR",243,0)
 ; Call with  LA7DUR = collection duration
"RTN","LA7VOBR",244,0)
 ;           LA7DURU = duration units (pointer to #64.061)
"RTN","LA7VOBR",245,0)
 ;           LA76205 = test urgency
"RTN","LA7VOBR",246,0)
 ;             LA7FS = HL7 field separator
"RTN","LA7VOBR",247,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBR",248,0)
 ;
"RTN","LA7VOBR",249,0)
 ; Returns OBR-27 sequence
"RTN","LA7VOBR",250,0)
 ;
"RTN","LA7VOBR",251,0)
 ; Since field is same as ORC-7, use builder for ORC-7 field.
"RTN","LA7VOBR",252,0)
 ;
"RTN","LA7VOBR",253,0)
 Q $$ORC7^LA7VORC(LA7DUR,LA7DURU,LA76205,LA7FS,LA7ECH)
"RTN","LA7VOBR",254,0)
 ;
"RTN","LA7VOBR",255,0)
 ;
"RTN","LA7VOBR",256,0)
OBR29(LA7PON,LA7FON,LA7FS,LA7ECH)       ; Build OBR-29 sequence - Parent
"RTN","LA7VOBR",257,0)
 ; Call with LA7PON = parent's placer order number
"RTN","LA7VOBR",258,0)
 ;           LA7FON = parent's filler order nubmer
"RTN","LA7VOBR",259,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",260,0)
 ;           LA7ECH = HL7 encoding characters
"RTN","LA7VOBR",261,0)
 ;
"RTN","LA7VOBR",262,0)
 N LA7Y,LA7Z
"RTN","LA7VOBR",263,0)
 D OBR29^LA7VOBRA
"RTN","LA7VOBR",264,0)
 Q LA7Y
"RTN","LA7VOBR",265,0)
 ;
"RTN","LA7VOBR",266,0)
 ;
"RTN","LA7VOBR",267,0)
OBR32(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBR-32 sequence - Principle Result Interpreter field
"RTN","LA7VOBR",268,0)
 ; Call with   LA7DUZ = DUZ of verifying user
"RTN","LA7VOBR",269,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBR",270,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBR",271,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBR",272,0)
 ;           
"RTN","LA7VOBR",273,0)
 ; Returns OBR-32 sequence
"RTN","LA7VOBR",274,0)
 ;
"RTN","LA7VOBR",275,0)
 N LA7PRI,LA7X
"RTN","LA7VOBR",276,0)
 D OBR32^LA7VOBRA
"RTN","LA7VOBR",277,0)
 Q LA7PRI
"RTN","LA7VOBR",278,0)
 ;
"RTN","LA7VOBR",279,0)
 ;
"RTN","LA7VOBR",280,0)
OBR33(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBR-32 sequence - Assistant Result Interpreter field
"RTN","LA7VOBR",281,0)
 ; Call with   LA7DUZ = DUZ of assistant interpreter
"RTN","LA7VOBR",282,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBR",283,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBR",284,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBR",285,0)
 ;           
"RTN","LA7VOBR",286,0)
 ; Returns OBR-33 sequence
"RTN","LA7VOBR",287,0)
 ;
"RTN","LA7VOBR",288,0)
 N LA7ARI,LA7X
"RTN","LA7VOBR",289,0)
 D OBR33^LA7VOBRA
"RTN","LA7VOBR",290,0)
 Q LA7ARI
"RTN","LA7VOBR",291,0)
 ;
"RTN","LA7VOBR",292,0)
 ;
"RTN","LA7VOBR",293,0)
OBR34(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBR-34 sequence - Technician field
"RTN","LA7VOBR",294,0)
 ; Call with   LA7DUZ = DUZ of techician
"RTN","LA7VOBR",295,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBR",296,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBR",297,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBR",298,0)
 ;           
"RTN","LA7VOBR",299,0)
 ; Returns OBR-34 sequence
"RTN","LA7VOBR",300,0)
 ;
"RTN","LA7VOBR",301,0)
 N LA7TECH,LA7X
"RTN","LA7VOBR",302,0)
 D OBR34^LA7VOBRA
"RTN","LA7VOBR",303,0)
 Q LA7TECH
"RTN","LA7VOBR",304,0)
 ;
"RTN","LA7VOBR",305,0)
 ;
"RTN","LA7VOBR",306,0)
OBR35(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBR-35 sequence - Transcriptionist field
"RTN","LA7VOBR",307,0)
 ; Call with   LA7DUZ = DUZ of transcriptionist
"RTN","LA7VOBR",308,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBR",309,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBR",310,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBR",311,0)
 ;           
"RTN","LA7VOBR",312,0)
 ; Returns OBR-35 sequence
"RTN","LA7VOBR",313,0)
 ;
"RTN","LA7VOBR",314,0)
 N LA7TSPT,LA7X
"RTN","LA7VOBR",315,0)
 D OBR35^LA7VOBRA
"RTN","LA7VOBR",316,0)
 Q LA7TSPT
"RTN","LA7VOBR",317,0)
 ;
"RTN","LA7VOBR",318,0)
 ;
"RTN","LA7VOBR",319,0)
OBR44(LA7VAL,LA7FS,LA7ECH) ; Build OBR-44 sequence - Procedure Code
"RTN","LA7VOBR",320,0)
 ; Call with   LA7VAL = Order NLT code
"RTN","LA7VOBR",321,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBR",322,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBR",323,0)
 ;           
"RTN","LA7VOBR",324,0)
 ; Returns       LA7Y = OBR-44 sequence
"RTN","LA7VOBR",325,0)
 ;
"RTN","LA7VOBR",326,0)
 N LA764,LA781,LA7X,LA7Y,LA7Z
"RTN","LA7VOBR",327,0)
 D OBR44^LA7VOBRA
"RTN","LA7VOBR",328,0)
 Q LA7Y
"RTN","LA7VOBRA")
0^27^B39455733^B37451712
"RTN","LA7VOBRA",1,0)
LA7VOBRA ;DALOI/JMC - LAB OBR segment builder (cont'd);Jan 20, 2009
"RTN","LA7VOBRA",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VOBRA",3,0)
 ;
"RTN","LA7VOBRA",4,0)
 Q
"RTN","LA7VOBRA",5,0)
 ;
"RTN","LA7VOBRA",6,0)
 ;
"RTN","LA7VOBRA",7,0)
OBR2 ; Build OBR-2 sequence - placer's specimen id
"RTN","LA7VOBRA",8,0)
 ;
"RTN","LA7VOBRA",9,0)
 S LA7ID=$$CHKDATA^LA7VHLU3(LA7ID,LA7FS_LA7ECH)
"RTN","LA7VOBRA",10,0)
 S $P(LA7Y,$E(LA7ECH,1),1)=LA7ID
"RTN","LA7VOBRA",11,0)
 I $G(LA7ID("NMSP"))'="" S $P(LA7Y,$E(LA7ECH,1),2)=LA7ID("NMSP")
"RTN","LA7VOBRA",12,0)
 I $G(LA7ID("SITE"))'="" D
"RTN","LA7VOBRA",13,0)
 . S LA7X=$$FACDNS^LA7VHLU2(LA7ID("SITE"),LA7FS,LA7ECH,1)
"RTN","LA7VOBRA",14,0)
 . S $P(LA7Y,$E(LA7ECH),3)=$P(LA7X,$E(LA7ECH),2)
"RTN","LA7VOBRA",15,0)
 . S $P(LA7Y,$E(LA7ECH),4)=$P(LA7X,$E(LA7ECH),3)
"RTN","LA7VOBRA",16,0)
 Q
"RTN","LA7VOBRA",17,0)
 ;
"RTN","LA7VOBRA",18,0)
 ;
"RTN","LA7VOBRA",19,0)
OBR3 ; Build OBR-3 sequence - filler's specimen id
"RTN","LA7VOBRA",20,0)
 ;
"RTN","LA7VOBRA",21,0)
 S LA7ID=$$CHKDATA^LA7VHLU3(LA7ID,LA7FS_LA7ECH)
"RTN","LA7VOBRA",22,0)
 S $P(LA7Y,$E(LA7ECH,1),1)=LA7ID
"RTN","LA7VOBRA",23,0)
 I $G(LA7ID("NMSP"))'="" S $P(LA7Y,$E(LA7ECH,1),2)=LA7ID("NMSP")
"RTN","LA7VOBRA",24,0)
 I $G(LA7ID("SITE"))'="" D
"RTN","LA7VOBRA",25,0)
 . S LA7X=$$FACDNS^LA7VHLU2(LA7ID("SITE"),LA7FS,LA7ECH,1)
"RTN","LA7VOBRA",26,0)
 . S $P(LA7Y,$E(LA7ECH),3)=$P(LA7X,$E(LA7ECH),2)
"RTN","LA7VOBRA",27,0)
 . S $P(LA7Y,$E(LA7ECH),4)=$P(LA7X,$E(LA7ECH),3)
"RTN","LA7VOBRA",28,0)
 Q
"RTN","LA7VOBRA",29,0)
 ;
"RTN","LA7VOBRA",30,0)
 ;
"RTN","LA7VOBRA",31,0)
OBR4 ; Build OBR-4 sequence - Universal service ID
"RTN","LA7VOBRA",32,0)
 ;
"RTN","LA7VOBRA",33,0)
 S LA764=0,LA7Y=""
"RTN","LA7VOBRA",34,0)
 ; specify component position - primary/alternate
"RTN","LA7VOBRA",35,0)
 S LA7COMP=0
"RTN","LA7VOBRA",36,0)
 ;
"RTN","LA7VOBRA",37,0)
 ; Send non-VA test codes as first coding system
"RTN","LA7VOBRA",38,0)
 I LA7ALT'="" D
"RTN","LA7VOBRA",39,0)
 . N I
"RTN","LA7VOBRA",40,0)
 . F I=1:1:3 S $P(LA7Y,$E(LA7ECH),LA7COMP+I)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",I),LA7FS_LA7ECH)
"RTN","LA7VOBRA",41,0)
 . S LA7COMP=LA7COMP+I
"RTN","LA7VOBRA",42,0)
 ;
"RTN","LA7VOBRA",43,0)
 ; Send NLT test codes as primary unless non-VA codes then send as alternate code
"RTN","LA7VOBRA",44,0)
 I LA7NLT'="" D
"RTN","LA7VOBRA",45,0)
 . S LA764=$O(^LAM("E",LA7NLT,0)),LA7Z=""
"RTN","LA7VOBRA",46,0)
 . I LA764 S LA7Z=$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VOBRA",47,0)
 . I LA7Z="" D
"RTN","LA7VOBRA",48,0)
 . . N LA7642
"RTN","LA7VOBRA",49,0)
 . . S LA764=$O(^LAM("E",$P(LA7NLT,".")_".0000",0))
"RTN","LA7VOBRA",50,0)
 . . I LA764 S LA7Z=$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VOBRA",51,0)
 . . S LA7642=$O(^LAB(64.2,"F","."_$P(LA7NLT,".",2),0))
"RTN","LA7VOBRA",52,0)
 . . I LA764,LA7642 S LA7Z=LA7Z_"~"_$$GET1^DIQ(64.2,LA7642_",",.01,"I")
"RTN","LA7VOBRA",53,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+1)=$$CHKDATA^LA7VHLU3(LA7NLT,LA7FS_LA7ECH)
"RTN","LA7VOBRA",54,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+2)=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBRA",55,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+3)="99VA64"
"RTN","LA7VOBRA",56,0)
 . S LA7COMP=LA7COMP+3
"RTN","LA7VOBRA",57,0)
 ;
"RTN","LA7VOBRA",58,0)
 ; Send file #60 test name if available and no alternate
"RTN","LA7VOBRA",59,0)
 I LA7COMP<4,LA760 D
"RTN","LA7VOBRA",60,0)
 . S LA7TN=$$GET1^DIQ(60,LA760_",",.01)
"RTN","LA7VOBRA",61,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+1)=LA760
"RTN","LA7VOBRA",62,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+2)=$$CHKDATA^LA7VHLU3(LA7TN,LA7FS_LA7ECH)
"RTN","LA7VOBRA",63,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+3)="99VA60"
"RTN","LA7VOBRA",64,0)
 ;
"RTN","LA7VOBRA",65,0)
 Q
"RTN","LA7VOBRA",66,0)
 ;
"RTN","LA7VOBRA",67,0)
 ;
"RTN","LA7VOBRA",68,0)
OBR9 ; Build OBR-9 sequence - collection volume
"RTN","LA7VOBRA",69,0)
 ;
"RTN","LA7VOBRA",70,0)
 ; Collection volume
"RTN","LA7VOBRA",71,0)
 S $P(LA7Y,$E(LA7ECH,1))=LA7VOL
"RTN","LA7VOBRA",72,0)
 ;
"RTN","LA7VOBRA",73,0)
 I LA764061 D
"RTN","LA7VOBRA",74,0)
 . S LA7IENS=LA764061_","
"RTN","LA7VOBRA",75,0)
 . D GETS^DIQ(64.061,LA7IENS,".01;1","E","LA7Y")
"RTN","LA7VOBRA",76,0)
 . ; Collection Volume units code
"RTN","LA7VOBRA",77,0)
 . S $P(LA7X,$E(LA7ECH,4),1)=$G(LA7Y(64.061,LA7IENS,.01,"E"))
"RTN","LA7VOBRA",78,0)
 . ; Collection Volume units text
"RTN","LA7VOBRA",79,0)
 . S $P(LA7X,$E(LA7ECH,4),2)=$$CHKDATA^LA7VHLU3($G(LA7Y(64.061,LA7IENS,1,"E")),LA7FS_LA7ECH)
"RTN","LA7VOBRA",80,0)
 . ; LOINC coding system
"RTN","LA7VOBRA",81,0)
 . S $P(LA7X,$E(LA7ECH,4),3)="LN"
"RTN","LA7VOBRA",82,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=LA7X
"RTN","LA7VOBRA",83,0)
 ;
"RTN","LA7VOBRA",84,0)
 Q
"RTN","LA7VOBRA",85,0)
 ;
"RTN","LA7VOBRA",86,0)
 ;
"RTN","LA7VOBRA",87,0)
OBR24 ; Build OBR-24 sequence - diagnostic service id
"RTN","LA7VOBRA",88,0)
 ;
"RTN","LA7VOBRA",89,0)
 ; Code non-MI subscripts
"RTN","LA7VOBRA",90,0)
 I $P(LA7SS,"^")'="MI" D  Q
"RTN","LA7VOBRA",91,0)
 . S LA7X=$P(LA7SS,"^")
"RTN","LA7VOBRA",92,0)
 . S LA7Y=$S(LA7X="CH":"CH",LA7X="SP":"SP",LA7X="CY":"CP",LA7X="EM":"PAT",LA7X="AU":"PAT",LA7X="BB":"BLB",1:"LAB")
"RTN","LA7VOBRA",93,0)
 ;
"RTN","LA7VOBRA",94,0)
 ; Code MI subscripts
"RTN","LA7VOBRA",95,0)
 S LA7X=$P(LA7SS,"^",2)
"RTN","LA7VOBRA",96,0)
 S LA7Y=$S(LA7X=11:"MB",LA7X=14:"PAR",LA7X=18:"MYC",LA7X=22:"MCB",LA7X=33:"VR",1:"MB")
"RTN","LA7VOBRA",97,0)
 ;
"RTN","LA7VOBRA",98,0)
 Q
"RTN","LA7VOBRA",99,0)
 ;
"RTN","LA7VOBRA",100,0)
 ;
"RTN","LA7VOBRA",101,0)
OBR25 ; Build OBR-25 sequence - Result status
"RTN","LA7VOBRA",102,0)
 ;
"RTN","LA7VOBRA",103,0)
 S LA7Y=""
"RTN","LA7VOBRA",104,0)
 ;
"RTN","LA7VOBRA",105,0)
 I LA7FLAG="F" S LA7Y="F"
"RTN","LA7VOBRA",106,0)
 I LA7FLAG="P" S LA7Y="P"
"RTN","LA7VOBRA",107,0)
 I LA7FLAG="A" S LA7Y="A"
"RTN","LA7VOBRA",108,0)
 I LA7FLAG="C" S LA7Y="C"
"RTN","LA7VOBRA",109,0)
 ;
"RTN","LA7VOBRA",110,0)
 Q
"RTN","LA7VOBRA",111,0)
 ;
"RTN","LA7VOBRA",112,0)
 ;
"RTN","LA7VOBRA",113,0)
OBR26 ; Build OBR-26 sequence - Parent result
"RTN","LA7VOBRA",114,0)
 ;
"RTN","LA7VOBRA",115,0)
 S LA7Y=""
"RTN","LA7VOBRA",116,0)
 ;
"RTN","LA7VOBRA",117,0)
 ; Move component into sub-component position
"RTN","LA7VOBRA",118,0)
 ; Translate component character to sub-component character
"RTN","LA7VOBRA",119,0)
 S LA7C=$E(LA7ECH,1),LA7SC=$E(LA7ECH,4)
"RTN","LA7VOBRA",120,0)
 ;
"RTN","LA7VOBRA",121,0)
 ; Parent result observation identifier in 1st component
"RTN","LA7VOBRA",122,0)
 I LA7OBX3'="" S $P(LA7Y,$E(LA7ECH,1),1)=$TR(LA7OBX3,LA7C,LA7SC)
"RTN","LA7VOBRA",123,0)
 ;
"RTN","LA7VOBRA",124,0)
 ; Parent sub-id in 2nd component
"RTN","LA7VOBRA",125,0)
 I LA7OBX4'="" S $P(LA7Y,$E(LA7ECH,1),2)=$TR(LA7OBX4,LA7C,LA7SC)
"RTN","LA7VOBRA",126,0)
 ;
"RTN","LA7VOBRA",127,0)
 ; Parent test result in 3rd component
"RTN","LA7VOBRA",128,0)
 I LA7OBX5'="" S $P(LA7Y,$E(LA7ECH,1),3)=$TR(LA7OBX5,LA7C,LA7SC)
"RTN","LA7VOBRA",129,0)
 ;
"RTN","LA7VOBRA",130,0)
 Q
"RTN","LA7VOBRA",131,0)
 ;
"RTN","LA7VOBRA",132,0)
 ;
"RTN","LA7VOBRA",133,0)
OBR29 ; Build OBR-29 sequence - Parent
"RTN","LA7VOBRA",134,0)
 ;
"RTN","LA7VOBRA",135,0)
 S LA7Y=""
"RTN","LA7VOBRA",136,0)
 ;
"RTN","LA7VOBRA",137,0)
 I $G(LA7PON)'="" D
"RTN","LA7VOBRA",138,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7PON,LA7FS_LA7ECH)
"RTN","LA7VOBRA",139,0)
 . S $P(LA7Y,$E(LA7ECH,1),1)=LA7Z
"RTN","LA7VOBRA",140,0)
 ;
"RTN","LA7VOBRA",141,0)
 I $G(LA7FON)'="" D
"RTN","LA7VOBRA",142,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7FON,LA7FS_LA7ECH)
"RTN","LA7VOBRA",143,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=LA7Z
"RTN","LA7VOBRA",144,0)
 ;
"RTN","LA7VOBRA",145,0)
 Q
"RTN","LA7VOBRA",146,0)
 ;
"RTN","LA7VOBRA",147,0)
 ;
"RTN","LA7VOBRA",148,0)
OBRPF ; Build OBR-18,19,20,21 Placer/Filler #1/#2
"RTN","LA7VOBRA",149,0)
 ;
"RTN","LA7VOBRA",150,0)
 S (LA7Y,LA7Z)="",LA7I=0
"RTN","LA7VOBRA",151,0)
 F  S LA7I=$O(LA7X(LA7I)) Q:'LA7I  S $P(LA7Z,"^",LA7I)=LA7X(LA7I)
"RTN","LA7VOBRA",152,0)
 S LA7Y=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBRA",153,0)
 Q
"RTN","LA7VOBRA",154,0)
 ;
"RTN","LA7VOBRA",155,0)
 ;
"RTN","LA7VOBRA",156,0)
OBR32 ; Build OBR-32 sequence - Principle Result Interpreter field
"RTN","LA7VOBRA",157,0)
 ;
"RTN","LA7VOBRA",158,0)
 S LA7X=$$XCN^LA7VHLU9(LA7DUZ,LA7DIV,LA7FS,LA7ECH,1,2)
"RTN","LA7VOBRA",159,0)
 S $P(LA7PRI,$E(LA7ECH))=$P(LA7X,$E(LA7ECH,4),1,9)
"RTN","LA7VOBRA",160,0)
 I LA7DIV S $P(LA7PRI,$E(LA7ECH),7)=$$FACDNS^LA7VHLU2(LA7DIV,LA7FS,LA7ECH,2)
"RTN","LA7VOBRA",161,0)
 Q
"RTN","LA7VOBRA",162,0)
 ;
"RTN","LA7VOBRA",163,0)
 ;
"RTN","LA7VOBRA",164,0)
OBR33 ; Build OBR-32 sequence - Assistant Result Interpreter field
"RTN","LA7VOBRA",165,0)
 ;
"RTN","LA7VOBRA",166,0)
 S LA7X=$$XCN^LA7VHLU9(LA7DUZ,LA7DIV,LA7FS,LA7ECH,1,2)
"RTN","LA7VOBRA",167,0)
 S $P(LA7ARI,$E(LA7ECH))=$P(LA7X,$E(LA7ECH,4),1,9)
"RTN","LA7VOBRA",168,0)
 I LA7DIV S $P(LA7ARI,$E(LA7ECH),7)=$$FACDNS^LA7VHLU2(LA7DIV,LA7FS,LA7ECH,2)
"RTN","LA7VOBRA",169,0)
 Q
"RTN","LA7VOBRA",170,0)
 ;
"RTN","LA7VOBRA",171,0)
OBR34 ; Build OBR-34 sequence - Technician field
"RTN","LA7VOBRA",172,0)
 ;
"RTN","LA7VOBRA",173,0)
 S LA7X=$$XCN^LA7VHLU9(LA7DUZ,LA7DIV,LA7FS,LA7ECH,1,1)
"RTN","LA7VOBRA",174,0)
 S $P(LA7TECH,$E(LA7ECH))=$P(LA7X,$E(LA7ECH,4),1,9)
"RTN","LA7VOBRA",175,0)
 I LA7DIV S $P(LA7TECH,$E(LA7ECH),7)=$$FACDNS^LA7VHLU2(LA7DIV,LA7FS,LA7ECH,2)
"RTN","LA7VOBRA",176,0)
 Q
"RTN","LA7VOBRA",177,0)
 ;
"RTN","LA7VOBRA",178,0)
 ;
"RTN","LA7VOBRA",179,0)
OBR35 ; Build OBR-35 sequence - Transcriptionist field
"RTN","LA7VOBRA",180,0)
 ;
"RTN","LA7VOBRA",181,0)
 S LA7X=$$XCN^LA7VHLU9(LA7DUZ,LA7DIV,LA7FS,LA7ECH,1,1)
"RTN","LA7VOBRA",182,0)
 S $P(LA7TSPT,$E(LA7ECH))=$P(LA7X,$E(LA7ECH,4),1,9)
"RTN","LA7VOBRA",183,0)
 I LA7DIV S $P(LA7TSPT,$E(LA7ECH),7)=$$FACDNS^LA7VHLU2(LA7DIV,LA7FS,LA7ECH,2)
"RTN","LA7VOBRA",184,0)
 Q
"RTN","LA7VOBRA",185,0)
 ;
"RTN","LA7VOBRA",186,0)
 ;
"RTN","LA7VOBRA",187,0)
OBR44 ; Build OBR-44
"RTN","LA7VOBRA",188,0)
 ;
"RTN","LA7VOBRA",189,0)
 S (LA7X,LA7Y,LA7Z)=""
"RTN","LA7VOBRA",190,0)
 ;
"RTN","LA7VOBRA",191,0)
 I LA7VAL="" Q
"RTN","LA7VOBRA",192,0)
 ;
"RTN","LA7VOBRA",193,0)
 ; Send NLT result code
"RTN","LA7VOBRA",194,0)
 S LA764=$O(^LAM("E",LA7VAL,0))
"RTN","LA7VOBRA",195,0)
 I LA764 S LA7X=$P($G(^LAM(LA764,0)),"^")
"RTN","LA7VOBRA",196,0)
 ;
"RTN","LA7VOBRA",197,0)
 ; If suffixed and not setup then construct from primary and suffix code.
"RTN","LA7VOBRA",198,0)
 I LA7X="" D
"RTN","LA7VOBRA",199,0)
 . N LA7642
"RTN","LA7VOBRA",200,0)
 . S LA764=$O(^LAM("E",$P(LA7VAL,".")_".0000",0))
"RTN","LA7VOBRA",201,0)
 . I LA764 S LA7X=$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VOBRA",202,0)
 . S LA7642=$O(^LAB(64.2,"F","."_$P(LA7VAL,".",2),0))
"RTN","LA7VOBRA",203,0)
 . I LA764,LA7642 S LA7X=LA7X_"~"_$$GET1^DIQ(64.2,LA7642_",",.01,"I")
"RTN","LA7VOBRA",204,0)
 ;
"RTN","LA7VOBRA",205,0)
 I LA7X'="" S LA7X=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VOBRA",206,0)
 S $P(LA7Z,$E(LA7ECH,1),1)=LA7VAL
"RTN","LA7VOBRA",207,0)
 S $P(LA7Z,$E(LA7ECH,1),2)=LA7X
"RTN","LA7VOBRA",208,0)
 S $P(LA7Z,$E(LA7ECH,1),3)="99VA64"
"RTN","LA7VOBRA",209,0)
 ;S LA7X=$$GET1^DID(64,"","","PACKAGE REVISION DATA")
"RTN","LA7VOBRA",210,0)
 ;S $P(LA7Z,$E(LA7ECH,1),7)=LA7X
"RTN","LA7VOBRA",211,0)
 S LA7Y=LA7Z
"RTN","LA7VOBRA",212,0)
 ;
"RTN","LA7VOBRA",213,0)
 ; Check for and build CPT code in primary, move NLT to alternate
"RTN","LA7VOBRA",214,0)
 I LA764="" Q
"RTN","LA7VOBRA",215,0)
 I '$D(^LAM("AD",LA764,"CPT")) Q
"RTN","LA7VOBRA",216,0)
 S LA7X=$O(^LAM("AD",LA764,"CPT",0))
"RTN","LA7VOBRA",217,0)
 S LA781=+$P($G(^LAM(LA764,4,LA7X,0)),"^")
"RTN","LA7VOBRA",218,0)
 S LA7X=$$CPT^ICPTCOD(LA781,DT,1)
"RTN","LA7VOBRA",219,0)
 S LA7Z=$P(LA7X,"^",2)
"RTN","LA7VOBRA",220,0)
 S $P(LA7Z,$E(LA7ECH,1),2)=$$CHKDATA^LA7VHLU3($P(LA7X,"^",3),LA7FS_LA7ECH)
"RTN","LA7VOBRA",221,0)
 S $P(LA7Z,$E(LA7ECH,1),3)=$S($P(LA7X,"^",5)="C":"C4",$P(LA7X,"^",5)="HCPCS":"HCPCS",1:"L")
"RTN","LA7VOBRA",222,0)
 S LA7Y=LA7Z_$E(LA7ECH,1)_$P(LA7Y,$E(LA7ECH,1),1,3)
"RTN","LA7VOBRA",223,0)
 ;S $P(LA7Y,$E(LA7ECH,1),8)=$P(LA7Y,$E(LA7ECH,1),7)
"RTN","LA7VOBRA",224,0)
 ;S $P(LA7Y,$E(LA7ECH,1),7)=$P(LA7X,"^",6)
"RTN","LA7VOBRA",225,0)
 ;
"RTN","LA7VOBRA",226,0)
 Q
"RTN","LA7VOBRB")
0^30^B12807459^n/a
"RTN","LA7VOBRB",1,0)
LA7VOBRB ;DALOI/JMC - LAB OBR segment builder (cont'd);Jan 17, 2008
"RTN","LA7VOBRB",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**68**;Sep 27, 1994;Build 56
"RTN","LA7VOBRB",3,0)
 ;
"RTN","LA7VOBRB",4,0)
 Q
"RTN","LA7VOBRB",5,0)
 ;
"RTN","LA7VOBRB",6,0)
 ;
"RTN","LA7VOBRB",7,0)
OBR15 ; Build OBR-15 sequence - specimen source
"RTN","LA7VOBRB",8,0)
 ;
"RTN","LA7VOBRB",9,0)
 S LA764061=0
"RTN","LA7VOBRB",10,0)
 S LA7COMP=0 ; specify subcomponent position - primary/alternate
"RTN","LA7VOBRB",11,0)
 S LA7Y="",LA7SNM=$G(LA7SNM)
"RTN","LA7VOBRB",12,0)
 ;
"RTN","LA7VOBRB",13,0)
 ; Get entry in #64.061 and SNOMED code for this Topography file #61 entry.
"RTN","LA7VOBRB",14,0)
 I LA761>0 D
"RTN","LA7VOBRB",15,0)
 . S LA761(0)=$G(^LAB(61,LA761,0)),LA764061=$P(LA761(0),"^",9)
"RTN","LA7VOBRB",16,0)
 . S $P(LA7Y,$E(LA7ECH,4),9)=$$CHKDATA^LA7VHLU3($P(LA761(0),"^"),LA7FS_LA7ECH)
"RTN","LA7VOBRB",17,0)
 ;
"RTN","LA7VOBRB",18,0)
 ; If no specimen code then default to HL7 0070 entry "XXX"
"RTN","LA7VOBRB",19,0)
 I LA764061<1 D
"RTN","LA7VOBRB",20,0)
 . N LA7SCR
"RTN","LA7VOBRB",21,0)
 . S LA7SCR="I $P(^LAB(64.061,Y,0),U,5)=""0070"",$P(^LAB(64.061,Y,0),U,7)=""S"""
"RTN","LA7VOBRB",22,0)
 . S LA764061=$$FIND1^DIC(64.061,,"X","XXX","D",LA7SCR,"LA7ERR")
"RTN","LA7VOBRB",23,0)
 ;
"RTN","LA7VOBRB",24,0)
 I LA764061 D GETS^DIQ(64.061,LA764061_",",".01;1;2;3;5","","LA7Z","LA7ERR")
"RTN","LA7VOBRB",25,0)
 ;
"RTN","LA7VOBRB",26,0)
 ; Send non-standard local code as primary
"RTN","LA7VOBRB",27,0)
 I $P(LA7ALT,"^")'=""!($P(LA7ALT,"^",2)'="") D
"RTN","LA7VOBRB",28,0)
 . S LA7X=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^"),LA7FS_LA7ECH)
"RTN","LA7VOBRB",29,0)
 . S $P(LA7Y,$E(LA7ECH,4),1)=LA7X
"RTN","LA7VOBRB",30,0)
 . S LA7X=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",2),LA7FS_LA7ECH)
"RTN","LA7VOBRB",31,0)
 . S $P(LA7Y,$E(LA7ECH,4),2)=LA7X
"RTN","LA7VOBRB",32,0)
 . S $P(LA7Y,$E(LA7ECH,4),3)=$P(LA7ALT,"^",3)
"RTN","LA7VOBRB",33,0)
 . S LA7COMP=LA7COMP+3
"RTN","LA7VOBRB",34,0)
 ;
"RTN","LA7VOBRB",35,0)
 ; Send HL7 Table 0070 coding as primary code
"RTN","LA7VOBRB",36,0)
 I 'LA7SNM,LA764061,LA7Z(64.061,LA764061_",",2)'="",LA7COMP<6 D
"RTN","LA7VOBRB",37,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",2),LA7FS_LA7ECH)
"RTN","LA7VOBRB",38,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+1)=LA7X
"RTN","LA7VOBRB",39,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",.01),LA7FS_LA7ECH)
"RTN","LA7VOBRB",40,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+2)=LA7X
"RTN","LA7VOBRB",41,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+3)="HL7"_LA7Z(64.061,LA764061_",",5)
"RTN","LA7VOBRB",42,0)
 . S LA7COMP=LA7COMP+3
"RTN","LA7VOBRB",43,0)
 ;
"RTN","LA7VOBRB",44,0)
 ; Send SNOMED as alternate code
"RTN","LA7VOBRB",45,0)
 I LA761,$P(LA761(0),"^",2)'="",LA7COMP<6 D
"RTN","LA7VOBRB",46,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+1)="T-"_$P(LA761(0),"^",2)
"RTN","LA7VOBRB",47,0)
 . S LA7X=$$CHKDATA^LA7VHLU3($P(LA761(0),"^"),LA7FS_LA7ECH)
"RTN","LA7VOBRB",48,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+2)=LA7X
"RTN","LA7VOBRB",49,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+3)="SNM"
"RTN","LA7VOBRB",50,0)
 . S $P(LA7Y,$E(LA7ECH,4),$S(LA7COMP<3:7,1:8))="1974"
"RTN","LA7VOBRB",51,0)
 . S LA7COMP=LA7COMP+3
"RTN","LA7VOBRB",52,0)
 ;
"RTN","LA7VOBRB",53,0)
 ; If VA code and not HL7 and/or LOINC
"RTN","LA7VOBRB",54,0)
 I LA764061,LA7Z(64.061,LA764061_",",3)'="",LA7COMP<6 D
"RTN","LA7VOBRB",55,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",3),LA7FS_LA7ECH)
"RTN","LA7VOBRB",56,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+1)=LA7X
"RTN","LA7VOBRB",57,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",.01),LA7FS_LA7ECH)
"RTN","LA7VOBRB",58,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+2)=LA7X
"RTN","LA7VOBRB",59,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+3)="99VA64.061"
"RTN","LA7VOBRB",60,0)
 . S $P(LA7Y,$E(LA7ECH,4),$S(LA7COMP<4:7,1:8))="5.2"
"RTN","LA7VOBRB",61,0)
 ;
"RTN","LA7VOBRB",62,0)
 ; LA7ALT should contain "CONTROL" in 4th piece if from file #62.3
"RTN","LA7VOBRB",63,0)
 I $P(LA7ALT,"^",4)'="" D
"RTN","LA7VOBRB",64,0)
 . N LA7TXT
"RTN","LA7VOBRB",65,0)
 . S LA7TXT=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",4),LA7FS_LA7ECH)
"RTN","LA7VOBRB",66,0)
 . S $P(LA7Y,$E(LA7ECH,1),3)=LA7TXT
"RTN","LA7VOBRB",67,0)
 ;
"RTN","LA7VOBRB",68,0)
 ; Get entry in #62 for this collection sample entry.
"RTN","LA7VOBRB",69,0)
 I LA762,$P(LA7ALT,"^",5)="",$P(LA7ALT,"^",6)="" D
"RTN","LA7VOBRB",70,0)
 . S LA7X=$$GET1^DIQ(62,LA762_",",.01,"","LA7ERR")
"RTN","LA7VOBRB",71,0)
 . S LA7X=$$TRIM^XLFSTR(LA7X,"LR"," ")
"RTN","LA7VOBRB",72,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VOBRB",73,0)
 . S LA7X=LA762_$E(LA7ECH,4)_LA7X_$E(LA7ECH,4)_"99VA62"
"RTN","LA7VOBRB",74,0)
 . S $P(LA7Y,$E(LA7ECH,1),4)=LA7X
"RTN","LA7VOBRB",75,0)
 ;
"RTN","LA7VOBRB",76,0)
 ; Send collection sample code for DoD.
"RTN","LA7VOBRB",77,0)
 I $P(LA7ALT,"^",5)'=""!($P(LA7ALT,"^",6)'="") D
"RTN","LA7VOBRB",78,0)
 . S X=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",5),LA7FS_LA7ECH)
"RTN","LA7VOBRB",79,0)
 . S Y=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",6),LA7FS_LA7ECH)
"RTN","LA7VOBRB",80,0)
 . S LA7X=X_$E(LA7ECH,4)_Y_$E(LA7ECH,4)_$P(LA7ALT,"^",7)
"RTN","LA7VOBRB",81,0)
 . S $P(LA7Y,$E(LA7ECH,1),4)=LA7X
"RTN","LA7VOBRB",82,0)
 ;
"RTN","LA7VOBRB",83,0)
 ; Send specimen shipping condition - collection method
"RTN","LA7VOBRB",84,0)
 I $G(LA7CM) D
"RTN","LA7VOBRB",85,0)
 . S X=$$GET1^DIQ(62.93,LA7CM_",",.01)
"RTN","LA7VOBRB",86,0)
 . I X'="" S X=$$CHKDATA^LA7VHLU3(X,LA7FS_LA7ECH)
"RTN","LA7VOBRB",87,0)
 . S Y=$$GET1^DIQ(62.93,LA7CM_",",.02)
"RTN","LA7VOBRB",88,0)
 . I Y'="" S Y=$$CHKDATA^LA7VHLU3(Y,LA7FS_LA7ECH)
"RTN","LA7VOBRB",89,0)
 . S LA7X=Y_$E(LA7ECH,4)_X_$E(LA7ECH,4)_"99VA62.93"
"RTN","LA7VOBRB",90,0)
 . S $P(LA7Y,$E(LA7ECH,1),6)=LA7X
"RTN","LA7VOBRB",91,0)
 Q
"RTN","LA7VOBX")
0^14^B30185961^B25091305
"RTN","LA7VOBX",1,0)
LA7VOBX ;DALOI/JMC - LAB OBX Segment message builder ;Jan 7, 2008
"RTN","LA7VOBX",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VOBX",3,0)
 ;
"RTN","LA7VOBX",4,0)
 ; Reference to $$LOSVUID^HDISVAP supported by DBIA #4801
"RTN","LA7VOBX",5,0)
 ;
"RTN","LA7VOBX",6,0)
OBX(LRDFN,LRSS,LRIDT,LRSB,LA7ARRAY,LA7OBXSN,LA7FS,LA7ECH,LA7NVAF) ; Observation/Result segment for Lab Results.
"RTN","LA7VOBX",7,0)
 ; Call with    LRDFN = ien of entry in file #63
"RTN","LA7VOBX",8,0)
 ;               LRSS = file #63 subscript
"RTN","LA7VOBX",9,0)
 ;              LRIDT = inverse date/time of specimen
"RTN","LA7VOBX",10,0)
 ;               LRSB = ien of dataname if "CH" subscript or global subscript for others
"RTN","LA7VOBX",11,0)
 ;           LA7ARRAY = array to return OBX segment, pass by reference
"RTN","LA7VOBX",12,0)
 ;           LA7OBXSN = OBX segment sequence number, pass by reference
"RTN","LA7VOBX",13,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",14,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",15,0)
 ;            LA7NVAF = flag indicating type of receiving facility (see NVAF^LA7VHLU2)
"RTN","LA7VOBX",16,0)
 ;
"RTN","LA7VOBX",17,0)
 ; Returns LA7OBXSN = current OBX segment sequence number 
"RTN","LA7VOBX",18,0)
 ;         LA7ARRAY = array containing OBX segment
"RTN","LA7VOBX",19,0)
 ;
"RTN","LA7VOBX",20,0)
 N LA7OBX,LA7VAL,LA7X
"RTN","LA7VOBX",21,0)
 ;
"RTN","LA7VOBX",22,0)
 ; No subscript/patient/specimen
"RTN","LA7VOBX",23,0)
 I $G(LRSS)=""!('$G(LRDFN))!('$G(LRIDT)) Q
"RTN","LA7VOBX",24,0)
 ;
"RTN","LA7VOBX",25,0)
 S LA7NVAF=$G(LA7NVAF)
"RTN","LA7VOBX",26,0)
 ;
"RTN","LA7VOBX",27,0)
 ; "CH" subscript
"RTN","LA7VOBX",28,0)
 I LRSS="CH" D CH^LA7VOBX1 Q
"RTN","LA7VOBX",29,0)
 ;
"RTN","LA7VOBX",30,0)
 ; "MI" subscript
"RTN","LA7VOBX",31,0)
 I LRSS="MI" D MI^LA7VOBX3 Q
"RTN","LA7VOBX",32,0)
 ;
"RTN","LA7VOBX",33,0)
 ; "SP" subscript
"RTN","LA7VOBX",34,0)
 I LRSS="SP" D AP^LA7VOBX2 Q
"RTN","LA7VOBX",35,0)
 ;
"RTN","LA7VOBX",36,0)
 ; "CY" subscript
"RTN","LA7VOBX",37,0)
 I LRSS="CY" D AP^LA7VOBX2 Q
"RTN","LA7VOBX",38,0)
 ;
"RTN","LA7VOBX",39,0)
 ; "EM" subscript
"RTN","LA7VOBX",40,0)
 I LRSS="EM" D AP^LA7VOBX2 Q
"RTN","LA7VOBX",41,0)
 ;
"RTN","LA7VOBX",42,0)
 Q
"RTN","LA7VOBX",43,0)
 ;
"RTN","LA7VOBX",44,0)
 ;
"RTN","LA7VOBX",45,0)
OBX1(LA7OBXSN) ; Build OBX-1 sequence - Set ID (sequence number)
"RTN","LA7VOBX",46,0)
 ; Call with LA7OBXSN = sequence number (pass by reference)
"RTN","LA7VOBX",47,0)
 ;
"RTN","LA7VOBX",48,0)
 N LA7Y
"RTN","LA7VOBX",49,0)
 ;
"RTN","LA7VOBX",50,0)
 ; increment sequence number
"RTN","LA7VOBX",51,0)
 S (LA7OBXSN,LA7Y)=$G(LA7OBXSN)+1
"RTN","LA7VOBX",52,0)
 ;
"RTN","LA7VOBX",53,0)
 Q LA7Y
"RTN","LA7VOBX",54,0)
 ;
"RTN","LA7VOBX",55,0)
 ;
"RTN","LA7VOBX",56,0)
OBX2(LA7FILE,LA7FIELD) ; Build OBX-2 sequence - Value type
"RTN","LA7VOBX",57,0)
 ; Call with   LA7FILE = FileMan DD file/subfield number
"RTN","LA7VOBX",58,0)
 ;            LA7FIELD = Fileman DD field number
"RTN","LA7VOBX",59,0)
 ;
"RTN","LA7VOBX",60,0)
 ; Returns      LA7VAL = value type  (HL7 table 0125)
"RTN","LA7VOBX",61,0)
 ;
"RTN","LA7VOBX",62,0)
 N LA7ERR,LA7TYP,LA7VAL
"RTN","LA7VOBX",63,0)
 ;
"RTN","LA7VOBX",64,0)
 D OBX2^LA7VOBXA
"RTN","LA7VOBX",65,0)
 ;
"RTN","LA7VOBX",66,0)
 Q LA7VAL
"RTN","LA7VOBX",67,0)
 ;
"RTN","LA7VOBX",68,0)
 ;
"RTN","LA7VOBX",69,0)
OBX3(LA7NLT,LA7953,LA7ALT,LA7FS,LA7ECH,LA7INTYP) ; Build OBX-3 sequence - Observation identifier field
"RTN","LA7VOBX",70,0)
 ; Call with  LA7NLT = NLT code.
"RTN","LA7VOBX",71,0)
 ;            LA7953 = LOINC code
"RTN","LA7VOBX",72,0)
 ;            LA7ALT = alternate code - local/non-VA (code^text^system^local code^local text^99VAnn)
"RTN","LA7VOBX",73,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",74,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",75,0)
 ;          LA7INTYP = type of interface from 62.48
"RTN","LA7VOBX",76,0)
 ;
"RTN","LA7VOBX",77,0)
 N LA764,LA7I,LA7J,LA7LN,LA7X,LA7Y
"RTN","LA7VOBX",78,0)
 ;
"RTN","LA7VOBX",79,0)
 D OBX3^LA7VOBXA
"RTN","LA7VOBX",80,0)
 ;
"RTN","LA7VOBX",81,0)
 Q LA7Y
"RTN","LA7VOBX",82,0)
 ;
"RTN","LA7VOBX",83,0)
 ;
"RTN","LA7VOBX",84,0)
OBX4(LA7VAL,LA7FS,LA7ECH) ; Build OBX-4 sequence - Observation sub-ID
"RTN","LA7VOBX",85,0)
 ; Call with  LA7VAL = value of the observation
"RTN","LA7VOBX",86,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",87,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",88,0)
 ;
"RTN","LA7VOBX",89,0)
 ; Returns LA7Y = Observation sub-ID checked for escape encoding
"RTN","LA7VOBX",90,0)
 ;
"RTN","LA7VOBX",91,0)
 N LA7Y
"RTN","LA7VOBX",92,0)
 ;
"RTN","LA7VOBX",93,0)
 S LA7Y=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VOBX",94,0)
 ;
"RTN","LA7VOBX",95,0)
 Q LA7Y
"RTN","LA7VOBX",96,0)
 ;
"RTN","LA7VOBX",97,0)
 ;
"RTN","LA7VOBX",98,0)
OBX5(LA7VAL,LA7OBX2,LA7FS,LA7ECH) ; Build OBX-5 sequence - Observation value
"RTN","LA7VOBX",99,0)
 ; Call with  LA7VAL = value of the observation
"RTN","LA7VOBX",100,0)
 ;           LA7OBX2 = value type
"RTN","LA7VOBX",101,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",102,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",103,0)
 ;
"RTN","LA7VOBX",104,0)
 N LA7Y
"RTN","LA7VOBX",105,0)
 ;
"RTN","LA7VOBX",106,0)
 D OBX5^LA7VOBXA
"RTN","LA7VOBX",107,0)
 ;
"RTN","LA7VOBX",108,0)
 Q LA7Y
"RTN","LA7VOBX",109,0)
 ;
"RTN","LA7VOBX",110,0)
 ;
"RTN","LA7VOBX",111,0)
OBX5M(LA7FN,LA7IENS,LA7FLD,LA7WP,LA7FS,LA7ECH) ; Build OBX-5 sequence - Observation value - multi-line textual result
"RTN","LA7VOBX",112,0)
 ; Call with LA7FN = File number or subfile
"RTN","LA7VOBX",113,0)
 ;         LA7IENS = Standard FileMan IENS indicating internal entry numbers
"RTN","LA7VOBX",114,0)
 ;          LA7FLD = Field number
"RTN","LA7VOBX",115,0)
 ;           LA7WP = array passed by reference to return text
"RTN","LA7VOBX",116,0)
 ;           LA7FS = HL field separator
"RTN","LA7VOBX",117,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBX",118,0)
 ;
"RTN","LA7VOBX",119,0)
 ; Returns   LA7WP = subscripted array containing text of results
"RTN","LA7VOBX",120,0)
 ;                   LA7WP(0), LA7WP(1), LA7WP(2),...
"RTN","LA7VOBX",121,0)
 ;
"RTN","LA7VOBX",122,0)
 N LA7ERR,LA7I,LA7J,LA7TYPE,LA7X,LA7Y
"RTN","LA7VOBX",123,0)
 ;
"RTN","LA7VOBX",124,0)
 D OBX5M^LA7VOBXA
"RTN","LA7VOBX",125,0)
 ;
"RTN","LA7VOBX",126,0)
 Q
"RTN","LA7VOBX",127,0)
 ;
"RTN","LA7VOBX",128,0)
 ;
"RTN","LA7VOBX",129,0)
OBX5R(LA7VAL,LA7OBX2,LA7FS,LA7ECH) ; Build OBX-5 sequence with repetition - Observation value
"RTN","LA7VOBX",130,0)
 ; Call with  LA7VAL = array passed by reference
"RTN","LA7VOBX",131,0)
 ;           LA7OBX2 = value type
"RTN","LA7VOBX",132,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",133,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",134,0)
 ;
"RTN","LA7VOBX",135,0)
 N LA7I,LA7Y
"RTN","LA7VOBX",136,0)
 ;
"RTN","LA7VOBX",137,0)
 D OBX5R^LA7VOBXA
"RTN","LA7VOBX",138,0)
 ;
"RTN","LA7VOBX",139,0)
 Q LA7Y
"RTN","LA7VOBX",140,0)
 ;
"RTN","LA7VOBX",141,0)
 ;
"RTN","LA7VOBX",142,0)
OBX6(LA7VAL,LA764061,LA7FS,LA7ECH,LA7INTYP) ; Build OBX-6 sequence - Units
"RTN","LA7VOBX",143,0)
 ; Call with   LA7VAL = Units if in external format
"RTN","LA7VOBX",144,0)
 ;           LA764061 = ien of units in #64.061
"RTN","LA7VOBX",145,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",146,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",147,0)
 ;           LA7INTYP = type of interface from 62.48
"RTN","LA7VOBX",148,0)
 ; Returns units
"RTN","LA7VOBX",149,0)
 ;
"RTN","LA7VOBX",150,0)
 N LA7Y
"RTN","LA7VOBX",151,0)
 ;
"RTN","LA7VOBX",152,0)
 D OBX6^LA7VOBXA
"RTN","LA7VOBX",153,0)
 ;
"RTN","LA7VOBX",154,0)
 Q LA7Y
"RTN","LA7VOBX",155,0)
 ;
"RTN","LA7VOBX",156,0)
 ;
"RTN","LA7VOBX",157,0)
OBX7(LA7LOW,LA7HIGH,LA7FS,LA7ECH) ; Build OBX-7 sequence - Reference range
"RTN","LA7VOBX",158,0)
 ; Call with  LA7LOW = lower limit
"RTN","LA7VOBX",159,0)
 ;           LA7HIGH = upper limit
"RTN","LA7VOBX",160,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",161,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",162,0)
 ; Returns reference range
"RTN","LA7VOBX",163,0)
 ;
"RTN","LA7VOBX",164,0)
 N LA7Y
"RTN","LA7VOBX",165,0)
 ;
"RTN","LA7VOBX",166,0)
 D OBX7^LA7VOBXA
"RTN","LA7VOBX",167,0)
 ;
"RTN","LA7VOBX",168,0)
 Q LA7Y
"RTN","LA7VOBX",169,0)
 ;
"RTN","LA7VOBX",170,0)
 ;
"RTN","LA7VOBX",171,0)
OBX8(LA7FLAG) ; Build OBX-8 sequence - Abnormal flags
"RTN","LA7VOBX",172,0)
 ; Call with LA7FLAG = DHCP Lab normalcy flag
"RTN","LA7VOBX",173,0)
 ; Returns abnormal flags based on HL7 table 0078
"RTN","LA7VOBX",174,0)
 ;
"RTN","LA7VOBX",175,0)
 N LA7Y
"RTN","LA7VOBX",176,0)
 ;
"RTN","LA7VOBX",177,0)
 S LA7Y=$TR(LA7FLAG,"*",$E(LA7FLAG,1)) ; abnormal flag
"RTN","LA7VOBX",178,0)
 Q LA7Y
"RTN","LA7VOBX",179,0)
 ;
"RTN","LA7VOBX",180,0)
 ;
"RTN","LA7VOBX",181,0)
OBX11(LA7FLAG) ; Build OBX-11 sequence - Observation result status
"RTN","LA7VOBX",182,0)
 ; Call with LA7FLAG = DHCP Lab status flag
"RTN","LA7VOBX",183,0)
 ; Returns result status based on HL7 table 0085
"RTN","LA7VOBX",184,0)
 ;
"RTN","LA7VOBX",185,0)
 N LA7Y
"RTN","LA7VOBX",186,0)
 ;
"RTN","LA7VOBX",187,0)
 S LA7Y=""
"RTN","LA7VOBX",188,0)
 ;
"RTN","LA7VOBX",189,0)
 I LA7FLAG="canc" S LA7Y="X"
"RTN","LA7VOBX",190,0)
 I LA7FLAG="comment" S LA7Y="F"
"RTN","LA7VOBX",191,0)
 I LA7FLAG="pending" S LA7Y="I"
"RTN","LA7VOBX",192,0)
 I LA7FLAG="F" S LA7Y="F"
"RTN","LA7VOBX",193,0)
 I LA7FLAG="P" S LA7Y="P"
"RTN","LA7VOBX",194,0)
 I LA7FLAG="A" S LA7Y="C"
"RTN","LA7VOBX",195,0)
 I LA7FLAG="C" S LA7Y="C"
"RTN","LA7VOBX",196,0)
 I LA7FLAG="W" S LA7Y="W"
"RTN","LA7VOBX",197,0)
 ;
"RTN","LA7VOBX",198,0)
 Q LA7Y
"RTN","LA7VOBX",199,0)
 ;
"RTN","LA7VOBX",200,0)
 ;
"RTN","LA7VOBX",201,0)
OBX13(LA7VAL,LA7SRC,LA7FS,LA7ECH) ; Build OBX-13 sequence - User defined access checks
"RTN","LA7VOBX",202,0)
 ; Call with LA7VAL = access screen to expand
"RTN","LA7VOBX",203,0)
 ;           LA7SRC = source of access screen
"RTN","LA7VOBX",204,0)
 ;            LA7FS = HL field separator
"RTN","LA7VOBX",205,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBX",206,0)
 ;
"RTN","LA7VOBX",207,0)
 ; Returns     LA7Y = access screen text or VUID
"RTN","LA7VOBX",208,0)
 ;
"RTN","LA7VOBX",209,0)
 N LA7Y
"RTN","LA7VOBX",210,0)
 S LA7Y=""
"RTN","LA7VOBX",211,0)
 ;
"RTN","LA7VOBX",212,0)
 ; Expanding antibiotic susceptibility display screen
"RTN","LA7VOBX",213,0)
 ; Send VUID instead of text for this code to HDR
"RTN","LA7VOBX",214,0)
 I $E(LA7SRC,1,3)="MIS"  D
"RTN","LA7VOBX",215,0)
 . I LA7SRC="MIS-HDR",$T(LOSVUID^HDISVAP)'="" S LA7Y=$$LOSVUID^HDISVAP(LA7VAL) Q
"RTN","LA7VOBX",216,0)
 . S LA7Y=$S(LA7VAL="A":"ALWAYS DISPLAY",LA7VAL="N":"NEVER DISPLAY",LA7VAL="R":"RESTRICT DISPLAY",1:"")
"RTN","LA7VOBX",217,0)
 ; 
"RTN","LA7VOBX",218,0)
 S LA7Y=$$CHKDATA^LA7VHLU3(LA7Y,LA7FS_LA7ECH)
"RTN","LA7VOBX",219,0)
 ;
"RTN","LA7VOBX",220,0)
 Q LA7Y
"RTN","LA7VOBX",221,0)
 ;
"RTN","LA7VOBX",222,0)
 ;
"RTN","LA7VOBX",223,0)
OBX14(LA7DT) ; Build OBX-14 sequence - date/time of observation
"RTN","LA7VOBX",224,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBX",225,0)
 ; Returns OBX-14 sequence
"RTN","LA7VOBX",226,0)
 ;
"RTN","LA7VOBX",227,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBX",228,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBX",229,0)
 ;
"RTN","LA7VOBX",230,0)
 ;
"RTN","LA7VOBX",231,0)
OBX15(LA74,LA7FS,LA7ECH) ; Build OBX-15 sequence - Producer's ID field
"RTN","LA7VOBX",232,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VOBX",233,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VOBX",234,0)
 ;            LA7FS = HL field separator
"RTN","LA7VOBX",235,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBX",236,0)
 ;
"RTN","LA7VOBX",237,0)
 ; Returns facility that performed the testing (ID^text^99VA4^CLIA id^^99VACLIA)
"RTN","LA7VOBX",238,0)
 ;
"RTN","LA7VOBX",239,0)
 N LA7X,LA7Y
"RTN","LA7VOBX",240,0)
 S LA7Y=$$INST^LA7VHLU4(LA74,LA7FS,LA7ECH)
"RTN","LA7VOBX",241,0)
 ;
"RTN","LA7VOBX",242,0)
 ; Include CLIA identifier if found.
"RTN","LA7VOBX",243,0)
 S LA7X=$$ID^XUAF4("CLIA",LA74)
"RTN","LA7VOBX",244,0)
 I LA7X'="" S $P(LA7Y,$E(LA7ECH),4)=LA7X,$P(LA7Y,$E(LA7ECH),6)="99VACLIA"
"RTN","LA7VOBX",245,0)
 ;
"RTN","LA7VOBX",246,0)
 Q LA7Y
"RTN","LA7VOBX",247,0)
 ;
"RTN","LA7VOBX",248,0)
 ;
"RTN","LA7VOBX",249,0)
OBX16(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBX-16 sequence - Responsible observer field
"RTN","LA7VOBX",250,0)
 ; Call with   LA7DUZ = DUZ of verifying user
"RTN","LA7VOBX",251,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBX",252,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",253,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",254,0)
 ;           
"RTN","LA7VOBX",255,0)
 ; Returns OBX-16 sequence
"RTN","LA7VOBX",256,0)
 ;
"RTN","LA7VOBX",257,0)
 Q $$XCN^LA7VHLU9(LA7DUZ,LA7DIV,LA7FS,LA7ECH,0,1)
"RTN","LA7VOBX",258,0)
 ;
"RTN","LA7VOBX",259,0)
 ;
"RTN","LA7VOBX",260,0)
OBX17(LA7VAL,LA7NLT,LA7FS,LA7ECH) ; Build OBX-17 sequence - Observation method field
"RTN","LA7VOBX",261,0)
 ; Call with   LA7VAL = WKLD SUFFIX CODES #64.2 with leading decimal
"RTN","LA7VOBX",262,0)
 ;             LA7NLT = Result NLT code
"RTN","LA7VOBX",263,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",264,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",265,0)
 ;           
"RTN","LA7VOBX",266,0)
 ; Returns       LA7Y = OBX-17 sequence
"RTN","LA7VOBX",267,0)
 ;
"RTN","LA7VOBX",268,0)
 N LA764,LA7X,LA7Y,LA7Z
"RTN","LA7VOBX",269,0)
 ;
"RTN","LA7VOBX",270,0)
 D OBX17^LA7VOBXA
"RTN","LA7VOBX",271,0)
 ;
"RTN","LA7VOBX",272,0)
 Q LA7Y
"RTN","LA7VOBX",273,0)
 ;
"RTN","LA7VOBX",274,0)
 ;
"RTN","LA7VOBX",275,0)
OBX18(LA7VAL,LA7FS,LA7ECH) ; Build OBX-18 sequence - Equipment entity identifier field
"RTN","LA7VOBX",276,0)
 ; Call with   LA7VAL = Equipment entity identifier
"RTN","LA7VOBX",277,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",278,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",279,0)
 ;           
"RTN","LA7VOBX",280,0)
 ; Returns       LA7X = OBX-18 sequence
"RTN","LA7VOBX",281,0)
 ;
"RTN","LA7VOBX",282,0)
 N LA7I,LA7J,LA7X,LA7Y
"RTN","LA7VOBX",283,0)
 ;
"RTN","LA7VOBX",284,0)
 D OBX18^LA7VOBXA
"RTN","LA7VOBX",285,0)
 ;
"RTN","LA7VOBX",286,0)
 Q LA7X
"RTN","LA7VOBX",287,0)
 ;
"RTN","LA7VOBX",288,0)
 ;
"RTN","LA7VOBX",289,0)
OBX19(LA7DT) ; Build OBX-19 sequence - date/time of the analysis
"RTN","LA7VOBX",290,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBX",291,0)
 ; Returns OBX-19 sequence
"RTN","LA7VOBX",292,0)
 ;
"RTN","LA7VOBX",293,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBX",294,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBX",295,0)
 ;
"RTN","LA7VOBX",296,0)
 ;
"RTN","LA7VOBX",297,0)
OBX23(LA7FN,LA7DA,LA7FS,LA7ECH) ; Build OBX-23 sequence - Performing organization name
"RTN","LA7VOBX",298,0)
 ; Call with LA7FN = Source File number
"RTN","LA7VOBX",299,0)
 ;                   Presently #4 (INSTITUTION)
"RTN","LA7VOBX",300,0)
 ;           LA7DA = Entry in source file
"RTN","LA7VOBX",301,0)
 ;           LA7FS = HL field separator
"RTN","LA7VOBX",302,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBX",303,0)
 ;           
"RTN","LA7VOBX",304,0)
 ; Returns OBX-23 sequence
"RTN","LA7VOBX",305,0)
 ;
"RTN","LA7VOBX",306,0)
 Q $$XON^LA7VHLU4(LA7FN,LA7DA,1,LA7FS,LA7ECH)
"RTN","LA7VOBX",307,0)
 ;
"RTN","LA7VOBX",308,0)
 ;
"RTN","LA7VOBX",309,0)
OBX24(LA7FN,LA7DA,LA7DT,LA7FS,LA7ECH) ; Build OBX-24 sequence - Performing organization address
"RTN","LA7VOBX",310,0)
 ; Call with LA7FN = Source File number
"RTN","LA7VOBX",311,0)
 ;                   Presently file #2 (PATIENT), #4 (INSTITUTION) or #200 (NEW PERSON)
"RTN","LA7VOBX",312,0)
 ;           LA7DA = Entry in source file
"RTN","LA7VOBX",313,0)
 ;           LA7DT = As of date in FileMan format
"RTN","LA7VOBX",314,0)
 ;           LA7FS = HL field separator
"RTN","LA7VOBX",315,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBX",316,0)
 ;           
"RTN","LA7VOBX",317,0)
 ; Returns OBX-24 sequence
"RTN","LA7VOBX",318,0)
 ;
"RTN","LA7VOBX",319,0)
 Q $$XAD^LA7VHLU4(LA7FN,LA7DA,LA7DT,LA7FS,LA7ECH)
"RTN","LA7VOBX",320,0)
 ;
"RTN","LA7VOBX",321,0)
 ;
"RTN","LA7VOBX",322,0)
OBX25(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBX-25 sequence - Performing organization medical director
"RTN","LA7VOBX",323,0)
 ; Call with   LA7DUZ = DUZ of medical director
"RTN","LA7VOBX",324,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBX",325,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",326,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",327,0)
 ;           
"RTN","LA7VOBX",328,0)
 ; Returns OBX-25 sequence
"RTN","LA7VOBX",329,0)
 ;
"RTN","LA7VOBX",330,0)
 Q $$XCN^LA7VHLU9(LA7DUZ,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX1")
0^18^B28786998^B15262892
"RTN","LA7VOBX1",1,0)
LA7VOBX1 ;DALOI/JMC - LAB OBX Segment message builder (CH subscript) cont'd ;Oct 13, 2009
"RTN","LA7VOBX1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,61,63,64,71,68**;Sep 27, 1994;Build 56
"RTN","LA7VOBX1",3,0)
 ;
"RTN","LA7VOBX1",4,0)
CH ; Observation/Result segment for "CH" subscript results.
"RTN","LA7VOBX1",5,0)
 ; Called by LA7VOBX
"RTN","LA7VOBX1",6,0)
 ;
"RTN","LA7VOBX1",7,0)
 N LA760,LA76304,LA7ALT,LA7DDERR,LA7DIV,LA7I,LA7RS,LA7X,LA7Y,X
"RTN","LA7VOBX1",8,0)
 ;
"RTN","LA7VOBX1",9,0)
 ; "CH" subscript requires a dataname
"RTN","LA7VOBX1",10,0)
 I '$G(LRSB) Q
"RTN","LA7VOBX1",11,0)
 ;
"RTN","LA7VOBX1",12,0)
 ; get result node from LR global.
"RTN","LA7VOBX1",13,0)
 S LA76304(0)=$G(^LR(LRDFN,LRSS,LRIDT,0))
"RTN","LA7VOBX1",14,0)
 S LA7RS=$P(LRSB,"^",2),LRSB=$P(LRSB,"^")
"RTN","LA7VOBX1",15,0)
 S LA7VAL=$G(^LR(LRDFN,LRSS,LRIDT,LRSB))
"RTN","LA7VOBX1",16,0)
 ; If previous results have been corrected then send corrected status
"RTN","LA7VOBX1",17,0)
 I LA7RS="",$P(LA7VAL,"^",10)=2 S LA7RS="C"
"RTN","LA7VOBX1",18,0)
 ;
"RTN","LA7VOBX1",19,0)
 ; Check if test is OK to send - (O)utput or (B)oth
"RTN","LA7VOBX1",20,0)
 S LA7X=$P(LA7VAL,"^",12)
"RTN","LA7VOBX1",21,0)
 I LA7X]"","BO"'[LA7X Q
"RTN","LA7VOBX1",22,0)
 I LA7X="",'$$OKTOSND^LA7VHLU1(LRSS,LRSB,+$P($P(LA7VAL,"^",3),"!",7)) Q
"RTN","LA7VOBX1",23,0)
 ;
"RTN","LA7VOBX1",24,0)
 ; If no result NLT or LOINC try to determine from file #60
"RTN","LA7VOBX1",25,0)
 S LA7X=$P(LA7VAL,"^",3)
"RTN","LA7VOBX1",26,0)
 I $P(LA7X,"!",2)=""!($P(LA7X,"!",3)="") S $P(LA7VAL,"^",3)=$$DEFCODE^LA7VHLU5(LRSS,LRSB,LA7X,$P(LA76304(0),"^",5))
"RTN","LA7VOBX1",27,0)
 ; No result NLT code - log error
"RTN","LA7VOBX1",28,0)
 I $P($P(LA7VAL,"^",3),"!",2)="" D
"RTN","LA7VOBX1",29,0)
 . N LA7X
"RTN","LA7VOBX1",30,0)
 . S LA7X="["_LRSB_"]"_$$GET1^DID(63.04,LRSB,"","LABEL")
"RTN","LA7VOBX1",31,0)
 . D CREATE^LA7LOG(36)
"RTN","LA7VOBX1",32,0)
 ;
"RTN","LA7VOBX1",33,0)
 ; something missing - No result.
"RTN","LA7VOBX1",34,0)
 I $P(LA7VAL,"^")="" Q
"RTN","LA7VOBX1",35,0)
 ;
"RTN","LA7VOBX1",36,0)
 ; Check for missing units/reference ranges
"RTN","LA7VOBX1",37,0)
 D CHECK
"RTN","LA7VOBX1",38,0)
 ;
"RTN","LA7VOBX1",39,0)
 ; Initialize OBX segment
"RTN","LA7VOBX1",40,0)
 S LA7OBX(0)="OBX"
"RTN","LA7VOBX1",41,0)
 S LA7OBX(1)=$$OBX1^LA7VOBX(.LA7OBXSN)
"RTN","LA7VOBX1",42,0)
 ;
"RTN","LA7VOBX1",43,0)
 ; Value type
"RTN","LA7VOBX1",44,0)
 ; If result is "cancel", "comment" or "pending" then data type is ST - string data
"RTN","LA7VOBX1",45,0)
 S LA7X=$S("canccommentpending"[$P(LA7VAL,"^"):1,1:0)
"RTN","LA7VOBX1",46,0)
 I LA7X,LA7INTYP'=30 S LA7OBX(2)="ST"
"RTN","LA7VOBX1",47,0)
 E  S LA7OBX(2)=$$OBX2^LA7VOBX(63.04,LRSB)
"RTN","LA7VOBX1",48,0)
 I LA7OBX(2)'="NM",$P(LA7VAL,"^")?1(1.N,.N1"."1.N) S LA7OBX(2)="NM"
"RTN","LA7VOBX1",49,0)
 ;
"RTN","LA7VOBX1",50,0)
 ; Observation identifer
"RTN","LA7VOBX1",51,0)
 ; build alternate code based on dataname from file #63 in case it's needed
"RTN","LA7VOBX1",52,0)
 S LA7X=$P(LA7VAL,"^",3)
"RTN","LA7VOBX1",53,0)
 S LA7ALT="CH"_LRSB_"^"_$$GET1^DID(63.04,LRSB,"","LABEL")_"^99VA63"
"RTN","LA7VOBX1",54,0)
 I $P(LA7X,"!",7) S LA760=$P(LA7X,"!",7)
"RTN","LA7VOBX1",55,0)
 E  S LA760=+$O(^LAB(60,"C","CH;"_LRSB_";1",0))
"RTN","LA7VOBX1",56,0)
 I LA760 S $P(LA7ALT,"^",4,6)=LA760_"^"_$P(^LAB(60,LA760,0),"^")_"^99VA60"
"RTN","LA7VOBX1",57,0)
 S LA7OBX(3)=$$OBX3^LA7VOBX($P(LA7X,"!",2),$P(LA7X,"!",3),LA7ALT,LA7FS,LA7ECH,$G(LA7INTYP))
"RTN","LA7VOBX1",58,0)
 ;
"RTN","LA7VOBX1",59,0)
 ; Build sub-id to aid in linking updates to previous transmissions.
"RTN","LA7VOBX1",60,0)
 S LA7OBX(4)=$$OBX4^LA7VOBX("CH"_LRSB,LA7FS,LA7ECH)
"RTN","LA7VOBX1",61,0)
 ;
"RTN","LA7VOBX1",62,0)
 ; Test value
"RTN","LA7VOBX1",63,0)
 ; If DoD and "canc" then report "PL Cancelled" per Lab Interop ICD.
"RTN","LA7VOBX1",64,0)
 S LA7X=$P(LA7VAL,"^") K LA7DDERR
"RTN","LA7VOBX1",65,0)
 I LA7X'="canc",$$GET1^DID(63.04,LRSB,"","TYPE","","LA7DDERR")="SET" D
"RTN","LA7VOBX1",66,0)
 . S LA7X=$$EXTERNAL^DILFD(63.04,LRSB,"",LA7X)
"RTN","LA7VOBX1",67,0)
 . I LA7X="" S LA7X=$P(LA7VAL,"^")
"RTN","LA7VOBX1",68,0)
 I $G(LA7NVAF)=1,LA7X="canc" S LA7X="PL Cancelled"
"RTN","LA7VOBX1",69,0)
 S LA7OBX(5)=$$OBX5^LA7VOBX(LA7X,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX1",70,0)
 ; Log exception when data dictionary appears corrupt.
"RTN","LA7VOBX1",71,0)
 I $D(LA7DDERR) D CREATE^LA7LOG(121) K LA7DDERR
"RTN","LA7VOBX1",72,0)
 ;
"RTN","LA7VOBX1",73,0)
 ; Suppress "pending" results when sending to HDR
"RTN","LA7VOBX1",74,0)
 I LA7INTYP=30,$P(LA7VAL,"^")="pending" S LA7OBX(2)="",LA7OBX(5)=""
"RTN","LA7VOBX1",75,0)
 ;
"RTN","LA7VOBX1",76,0)
 ; Units
"RTN","LA7VOBX1",77,0)
 S LA7X=$P(LA7VAL,"^",5)
"RTN","LA7VOBX1",78,0)
 S LA7OBX(6)=$$OBX6^LA7VOBX($P(LA7X,"!",7),"",LA7FS,LA7ECH,$G(LA7INTYP))
"RTN","LA7VOBX1",79,0)
 ;
"RTN","LA7VOBX1",80,0)
 ; Reference range - use therapeutic low/high if present.
"RTN","LA7VOBX1",81,0)
 K LA7Y
"RTN","LA7VOBX1",82,0)
 I $P(LA7X,"!",11)="",$P(LA7X,"!",12)="" D
"RTN","LA7VOBX1",83,0)
 . S LA7Y("LOW")=$P(LA7X,"!",2)
"RTN","LA7VOBX1",84,0)
 . S LA7Y("HIGH")=$P(LA7X,"!",3)
"RTN","LA7VOBX1",85,0)
 E  D
"RTN","LA7VOBX1",86,0)
 . S LA7Y("LOW")=$P(LA7X,"!",11)
"RTN","LA7VOBX1",87,0)
 . S LA7Y("HIGH")=$P(LA7X,"!",12)
"RTN","LA7VOBX1",88,0)
 ;
"RTN","LA7VOBX1",89,0)
 S LA7OBX(7)=$$OBX7^LA7VOBX(LA7Y("LOW"),LA7Y("HIGH"),LA7FS,LA7ECH)
"RTN","LA7VOBX1",90,0)
 K LA7Y
"RTN","LA7VOBX1",91,0)
 ;
"RTN","LA7VOBX1",92,0)
 ; Abnormal flags
"RTN","LA7VOBX1",93,0)
 S LA7OBX(8)=$$OBX8^LA7VOBX($P(LA7VAL,"^",2))
"RTN","LA7VOBX1",94,0)
 ;
"RTN","LA7VOBX1",95,0)
 ; "P"artial or "F"inal results
"RTN","LA7VOBX1",96,0)
 S LA7X=$S("canccommentpending"[$P(LA7VAL,"^"):$P(LA7VAL,"^"),1:"F")
"RTN","LA7VOBX1",97,0)
 I LA7RS="C" D
"RTN","LA7VOBX1",98,0)
 . S LA7X=LA7RS
"RTN","LA7VOBX1",99,0)
 . I LA7INTYP=30,$P(LA7VAL,"^")="pending" S LA7X="W",LA7OBX(5)=""""""
"RTN","LA7VOBX1",100,0)
 S LA7OBX(11)=$$OBX11^LA7VOBX(LA7X)
"RTN","LA7VOBX1",101,0)
 I LA7INTYP=30,$P(LA7VAL,"^")="canc",LA7OBX(11)="X" S LA7OBX(2)="",LA7OBX(5)=""
"RTN","LA7VOBX1",102,0)
 ;
"RTN","LA7VOBX1",103,0)
 ; Observation date/time - collection date/time per HL7 standard
"RTN","LA7VOBX1",104,0)
 S LA7X=$P(LA76304(0),"^") S:$P(LA76304(0),"^",2) LA7X=$P(LA7X,".")
"RTN","LA7VOBX1",105,0)
 I LA7X S LA7OBX(14)=$$OBX14^LA7VOBX(LA7X)
"RTN","LA7VOBX1",106,0)
 ;
"RTN","LA7VOBX1",107,0)
 S LA7DIV=$P(LA7VAL,"^",9)
"RTN","LA7VOBX1",108,0)
 I LA7DIV="" S LA7DIV=$P($G(^LR(LRDFN,LRSS,LRIDT,"RF")),"^")
"RTN","LA7VOBX1",109,0)
 I LA7DIV="",$$DIV4^XUSER(.LA7DIV,$P(LA7VAL,"^",4)) S LA7DIV=$O(LA7DIV(0))
"RTN","LA7VOBX1",110,0)
 ;
"RTN","LA7VOBX1",111,0)
 ; Facility that performed the testing
"RTN","LA7VOBX1",112,0)
 S LA7OBX(15)=$$OBX15^LA7VOBX(LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX1",113,0)
 ;
"RTN","LA7VOBX1",114,0)
 ; Person that verified the test
"RTN","LA7VOBX1",115,0)
 S LA7OBX(16)=$$OBX16^LA7VOBX($P(LA7VAL,"^",4),LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX1",116,0)
 ;
"RTN","LA7VOBX1",117,0)
 ; Observation method - workkload suffix (LA7X) and result NLT code (LA7Y)
"RTN","LA7VOBX1",118,0)
 S LA7X=$P($P(LA7VAL,"^",3),"!",4),LA7Y=$P($P(LA7VAL,"^",3),"!",2)
"RTN","LA7VOBX1",119,0)
 I LA7X'=""!(LA7Y="") S LA7OBX(17)=$$OBX17^LA7VOBX(LA7X,LA7Y,LA7FS,LA7ECH)
"RTN","LA7VOBX1",120,0)
 ;
"RTN","LA7VOBX1",121,0)
 ; Equipment entity identifier
"RTN","LA7VOBX1",122,0)
 I $P(LA7VAL,"^",11)'="" S LA7OBX(18)=$$OBX18^LA7VOBX($P(LA7VAL,"^",11),LA7FS,LA7ECH)
"RTN","LA7VOBX1",123,0)
 ;
"RTN","LA7VOBX1",124,0)
 ; Date/time of the analysis
"RTN","LA7VOBX1",125,0)
 I $P(LA7VAL,"^",6)'="" S LA7OBX(19)=$$OBX19^LA7VOBX($P(LA7VAL,"^",6))
"RTN","LA7VOBX1",126,0)
 ;
"RTN","LA7VOBX1",127,0)
 ; Performing organization name/address
"RTN","LA7VOBX1",128,0)
 I LA7DIV'="" D
"RTN","LA7VOBX1",129,0)
 . N LA7DT
"RTN","LA7VOBX1",130,0)
 . S LA7OBX(23)=$$OBX23^LA7VOBX(4,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX1",131,0)
 . S LA7DT=$S($P(LA7VAL,"^",6):$P(LA7VAL,"^",6),$P(LA76304(0),"^",3):$P(LA76304(0),"^",3),1:$$NOW^XLFDT)
"RTN","LA7VOBX1",132,0)
 . S LA7OBX(24)=$$OBX24^LA7VOBX(4,LA7DIV,LA7DT,LA7FS,LA7ECH)
"RTN","LA7VOBX1",133,0)
 ;
"RTN","LA7VOBX1",134,0)
 D BUILDSEG^LA7VHLU(.LA7OBX,.LA7ARRAY,LA7FS)
"RTN","LA7VOBX1",135,0)
 ;
"RTN","LA7VOBX1",136,0)
 Q
"RTN","LA7VOBX1",137,0)
 ;
"RTN","LA7VOBX1",138,0)
 ;
"RTN","LA7VOBX1",139,0)
CHECK ; Check for missing units/reference ranges
"RTN","LA7VOBX1",140,0)
 ;
"RTN","LA7VOBX1",141,0)
 N LA7I,LA7X,LA7FLAG
"RTN","LA7VOBX1",142,0)
 S LA7X=$P(LA7VAL,"^",5)
"RTN","LA7VOBX1",143,0)
 ;
"RTN","LA7VOBX1",144,0)
 ; If flag (NPC>1) indicates units/ranges are stored but pieces 5-9 are null then use values from file #60
"RTN","LA7VOBX1",145,0)
 ; - some class III software still does not store this info in file #63 when NPC>1
"RTN","LA7VOBX1",146,0)
 S LA7FLAG=0
"RTN","LA7VOBX1",147,0)
 I $G(^LR(LRDFN,LRSS,LRIDT,"NPC"))>1 D
"RTN","LA7VOBX1",148,0)
 . F LA7I=5:1:9 I $P(LA7VAL,"^",LA7I)'="" S LA7FLAG=1 Q
"RTN","LA7VOBX1",149,0)
 I 'LA7FLAG D BUNR
"RTN","LA7VOBX1",150,0)
 ;
"RTN","LA7VOBX1",151,0)
 ; Evaluate low/high reference ranges in case M code in these fields.
"RTN","LA7VOBX1",152,0)
 S:$G(SEX)="" SEX="M" S:$G(AGE)="" AGE=99
"RTN","LA7VOBX1",153,0)
 F LA7I=2,3,11,12 I $E($P(LA7X,"!",LA7I),1,3)="$S(" D
"RTN","LA7VOBX1",154,0)
 . S @("X="_$P(LA7X,"!",LA7I))
"RTN","LA7VOBX1",155,0)
 . S $P(LA7X,"!",LA7I)=X
"RTN","LA7VOBX1",156,0)
 ;
"RTN","LA7VOBX1",157,0)
 ; Put units/reference ranges back in variable LA7VAL
"RTN","LA7VOBX1",158,0)
 S $P(LA7VAL,"^",5)=LA7X
"RTN","LA7VOBX1",159,0)
 ;
"RTN","LA7VOBX1",160,0)
 Q
"RTN","LA7VOBX1",161,0)
 ;
"RTN","LA7VOBX1",162,0)
 ;
"RTN","LA7VOBX1",163,0)
BUNR ; Build units/normal ranges from file #60
"RTN","LA7VOBX1",164,0)
 ;
"RTN","LA7VOBX1",165,0)
 N LA7Y
"RTN","LA7VOBX1",166,0)
 S LA7Y=$$REFUNIT^LA7VHLU1(LRSB,$P(LA76304(0),"^",5))
"RTN","LA7VOBX1",167,0)
 ;
"RTN","LA7VOBX1",168,0)
 ; Results missing units, use value from file #60
"RTN","LA7VOBX1",169,0)
 I $P(LA7X,"!",7)="" S $P(LA7X,"!",7)=$P(LA7Y,"^",3)
"RTN","LA7VOBX1",170,0)
 ;
"RTN","LA7VOBX1",171,0)
 ; If results missing reference ranges, use values from file #60.
"RTN","LA7VOBX1",172,0)
 I $P(LA7X,"!",2)="",$P(LA7X,"!",3)="",$P(LA7X,"!",11)="",$P(LA7X,"!",12)="" D
"RTN","LA7VOBX1",173,0)
 . I $P(LA7X,"!",2)="",$P(LA7X,"!",3)="" D
"RTN","LA7VOBX1",174,0)
 . . S $P(LA7X,"!",2)=$P(LA7Y,"^")
"RTN","LA7VOBX1",175,0)
 . . S $P(LA7X,"!",3)=$P(LA7Y,"^",2)
"RTN","LA7VOBX1",176,0)
 . I $P(LA7X,"!",11)="",$P(LA7X,"!",12)="" D
"RTN","LA7VOBX1",177,0)
 . . S $P(LA7X,"!",11)=$P(LA7Y,"^",6)
"RTN","LA7VOBX1",178,0)
 . . S $P(LA7X,"!",12)=$P(LA7Y,"^",7)
"RTN","LA7VOBX1",179,0)
 Q
"RTN","LA7VOBX2")
0^16^B21393582^B15453740
"RTN","LA7VOBX2",1,0)
LA7VOBX2 ;DALOI/JMC - LAB OBX Segment message builder (AP subscripts) cont'd ;May 15,2007
"RTN","LA7VOBX2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VOBX2",3,0)
 ;
"RTN","LA7VOBX2",4,0)
AP ; Build OBX segments for resultss that are anatomic/surgical pathology subscripts
"RTN","LA7VOBX2",5,0)
 ; Called by LA7VOBX
"RTN","LA7VOBX2",6,0)
 ;
"RTN","LA7VOBX2",7,0)
 N LA7953,LA7ACODE,LA7CODE,LA7DIV,LA7IENS,LA7OBX5,LA7OBX5M,LA7SUB,LA7SUBFL,LA7VP,LA7WP,LA7X,LA7Y
"RTN","LA7VOBX2",8,0)
 ;
"RTN","LA7VOBX2",9,0)
 S (LA7953,LA7DIV,LA7VP)=""
"RTN","LA7VOBX2",10,0)
 ;
"RTN","LA7VOBX2",11,0)
 ; Surgical pathology subscript
"RTN","LA7VOBX2",12,0)
 I LRSS="SP" S LA7SUBFL=63.08
"RTN","LA7VOBX2",13,0)
 ;
"RTN","LA7VOBX2",14,0)
 ; Cytology subscript
"RTN","LA7VOBX2",15,0)
 I LRSS="CY" S LA7SUBFL=63.09
"RTN","LA7VOBX2",16,0)
 ;
"RTN","LA7VOBX2",17,0)
 ; Electron microscopy subscript
"RTN","LA7VOBX2",18,0)
 I LRSS="EM" S LA7SUBFL=63.02
"RTN","LA7VOBX2",19,0)
 ;
"RTN","LA7VOBX2",20,0)
 S LA7IENS=""
"RTN","LA7VOBX2",21,0)
 F I=3:-1:1 I $P(LRIDT,",",I) S LRIDT(I)=$P(LRIDT,",",I),LA7IENS=LA7IENS_LRIDT(I)_","
"RTN","LA7VOBX2",22,0)
 S LA7IENS=LA7IENS_LRDFN_","
"RTN","LA7VOBX2",23,0)
 S LRIDT=$P(LRIDT,",")
"RTN","LA7VOBX2",24,0)
 S LA7SUB(0)=$G(^LR(LRDFN,LRSS,LRIDT,0))
"RTN","LA7VOBX2",25,0)
 ;
"RTN","LA7VOBX2",26,0)
 ; Get default codes
"RTN","LA7VOBX2",27,0)
 S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,"","")
"RTN","LA7VOBX2",28,0)
 ;
"RTN","LA7VOBX2",29,0)
 ; Initialize OBX segment
"RTN","LA7VOBX2",30,0)
 S LA7OBX(0)="OBX"
"RTN","LA7VOBX2",31,0)
 ;
"RTN","LA7VOBX2",32,0)
 ; Value type
"RTN","LA7VOBX2",33,0)
 S LA7X=LA7SUBFL,LA7Y=LRSB
"RTN","LA7VOBX2",34,0)
 I LRSB=1.2 S LA7X=$S(LRSS="SP":63.817,LRSS="CY":63.907,LRSS="EM":63.207,1:""),LA7Y=1
"RTN","LA7VOBX2",35,0)
 I LRSB="10,1.5" S LA7X=$S(LRSS="SP":63.82,LRSS="CY":63.982,LRSS="EM":63.282,1:""),LA7Y=.01
"RTN","LA7VOBX2",36,0)
 I LRSB="10,2",LRSS="SP" S LA7X=63.12,LA7Y=2
"RTN","LA7VOBX2",37,0)
 I LRSB="10,5" S LA7X=$S(LRSS="SP":63.819,LRSS="CY":63.919,LRSS="EM":63.219,1:""),LA7Y=1
"RTN","LA7VOBX2",38,0)
 S LA7OBX(2)=$$OBX2^LA7VOBX(LA7X,LA7Y)
"RTN","LA7VOBX2",39,0)
 ;
"RTN","LA7VOBX2",40,0)
 ; Observation identifier
"RTN","LA7VOBX2",41,0)
 S LA7OBX(3)=$$OBX3^LA7VOBX($P(LA7CODE,"!",2),$P(LA7CODE,"!",3),"",LA7FS,LA7ECH,$G(LA7INTYP))
"RTN","LA7VOBX2",42,0)
 ;
"RTN","LA7VOBX2",43,0)
 ; Observation sub-ID
"RTN","LA7VOBX2",44,0)
 ; Create sub-ID for supplementary reports and special studies
"RTN","LA7VOBX2",45,0)
 D SUBID
"RTN","LA7VOBX2",46,0)
 ;
"RTN","LA7VOBX2",47,0)
 ; Build result field
"RTN","LA7VOBX2",48,0)
 I LRSB=.012 D
"RTN","LA7VOBX2",49,0)
 . N LA7I,LA7X,LA7Y
"RTN","LA7VOBX2",50,0)
 . S LA7I=0
"RTN","LA7VOBX2",51,0)
 . F  S LA7I=$O(^LR(LRDFN,LRSS,LRIDT,.1,LA7I)) Q:'LA7I  D
"RTN","LA7VOBX2",52,0)
 . . S LA7X=$G(^LR(LRDFN,LRSS,LRIDT,.1,LA7I,0))
"RTN","LA7VOBX2",53,0)
 . . S LA7Y(LA7I)=$P(LA7X,"^")
"RTN","LA7VOBX2",54,0)
 . . S LA7OBX(2)="CE" ; Override DD to conform to HL7 standard
"RTN","LA7VOBX2",55,0)
 . S LA7OBX(5)=$$OBX5R^LA7VOBX(.LA7Y,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX2",56,0)
 ;
"RTN","LA7VOBX2",57,0)
 I LRSB'=.012 D
"RTN","LA7VOBX2",58,0)
 . I $P(LRSB,",")=10,LRSB'="10,5" Q
"RTN","LA7VOBX2",59,0)
 . I LA7NVAF=1 D DOD Q
"RTN","LA7VOBX2",60,0)
 . I LRSB=1.2 N LRSB S LA7SUBFL=$S(LRSS="SP":63.817,LRSS="CY":63.907,LRSS="EM":63.207,1:""),LRSB=1
"RTN","LA7VOBX2",61,0)
 . I LRSB="10,5" N LRSB S LA7SUBFL=$S(LRSS="SP":63.819,LRSS="CY":63.919,LRSS="EM":63.219,1:""),LRSB=1
"RTN","LA7VOBX2",62,0)
 . D OBX5M^LA7VOBX(LA7SUBFL,LA7IENS,LRSB,.LA7WP,LA7FS,LA7ECH)
"RTN","LA7VOBX2",63,0)
 . D BUILDSEG^LA7VHLU(.LA7WP,.LA7OBX5M,"")
"RTN","LA7VOBX2",64,0)
 . M LA7OBX(5)=LA7OBX5M
"RTN","LA7VOBX2",65,0)
 ;
"RTN","LA7VOBX2",66,0)
 I $P(LRSB,",")=10,LRSB'="10,5" D
"RTN","LA7VOBX2",67,0)
 . N LA7VAL,LA7SUBFL,X
"RTN","LA7VOBX2",68,0)
 . I LRSS="SP",LRSB="10,2" D  Q
"RTN","LA7VOBX2",69,0)
 . . S LA7VAL=$$GET1^DIQ(63.12,LA7IENS,2)
"RTN","LA7VOBX2",70,0)
 . . S LA7OBX(5)=$$OBX5^LA7VOBX(LA7VAL,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX2",71,0)
 . . S LA7OBX(6)=$$OBX6^LA7VOBX("g","",LA7FS,LA7ECH,$G(LA7INTYP))
"RTN","LA7VOBX2",72,0)
 . I LRSB=10 S LA7SUBFL=$S(LRSS="SP":63.12,LRSS="CY":63.912,LRSS="EM":63.212,1:"")
"RTN","LA7VOBX2",73,0)
 . I LRSB="10,1.5" S LA7SUBFL=$S(LRSS="SP":63.82,LRSS="CY":63.982,LRSS="EM":63.282,1:"")
"RTN","LA7VOBX2",74,0)
 . S LA7VAL=$$GET1^DIQ(LA7SUBFL,LA7IENS,.01)
"RTN","LA7VOBX2",75,0)
 . S X=$$GET1^DIQ(LA7SUBFL,LA7IENS,".01:2")
"RTN","LA7VOBX2",76,0)
 . I X'="" S LA7VAL=$S($E(X,1,2)="T-":"",1:"T-")_X_"^"_LA7VAL_"^SNM",LA7OBX(2)="CE"
"RTN","LA7VOBX2",77,0)
 . S LA7OBX(5)=$$OBX5^LA7VOBX(LA7VAL,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX2",78,0)
 ;
"RTN","LA7VOBX2",79,0)
 ; Don't build this segment if no results/value to send
"RTN","LA7VOBX2",80,0)
 I $G(LA7OBX(5,0))="",$G(LA7OBX(5))="" Q
"RTN","LA7VOBX2",81,0)
 ;
"RTN","LA7VOBX2",82,0)
 ; Build sequence id
"RTN","LA7VOBX2",83,0)
 S LA7OBX(1)=$$OBX1^LA7VOBX(.LA7OBXSN)
"RTN","LA7VOBX2",84,0)
 ;
"RTN","LA7VOBX2",85,0)
 ; "P"artial, "F"inal , "A"mended results
"RTN","LA7VOBX2",86,0)
 ; If not release date then pending
"RTN","LA7VOBX2",87,0)
 I '$P(LA7SUB(0),"^",11) S LA7OBX(11)="P"
"RTN","LA7VOBX2",88,0)
 ;
"RTN","LA7VOBX2",89,0)
 ; If release date then check for changes
"RTN","LA7VOBX2",90,0)
 I $P(LA7SUB(0),"^",11) D
"RTN","LA7VOBX2",91,0)
 . I $P(LA7SUB(0),"^",15) S LA7OBX(11)="C"
"RTN","LA7VOBX2",92,0)
 . E  S LA7OBX(11)="F"
"RTN","LA7VOBX2",93,0)
 ;
"RTN","LA7VOBX2",94,0)
 S LA7DIV=$P($G(^LR(LRDFN,LRSS,LRIDT,"RF")),"^")
"RTN","LA7VOBX2",95,0)
 I LA7DIV="",$P(LA7SUB(0),"^",13),$$DIV4^XUSER(.LA7DIV,$P(LA7SUB(0),"^",2)) S LA7DIV=$O(LA7DIV(0))
"RTN","LA7VOBX2",96,0)
 ;
"RTN","LA7VOBX2",97,0)
 ; Facility that performed the testing
"RTN","LA7VOBX2",98,0)
 S LA7OBX(15)=$$OBX15^LA7VOBX(LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX2",99,0)
 ;
"RTN","LA7VOBX2",100,0)
 ; Person that verified the test
"RTN","LA7VOBX2",101,0)
 S LA7VP=$P(LA7SUB(0),"^",13)
"RTN","LA7VOBX2",102,0)
 I LA7VP S LA7OBX(16)=$$OBX16^LA7VOBX(LA7VP,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX2",103,0)
 ;
"RTN","LA7VOBX2",104,0)
 ; Performing organization name/address
"RTN","LA7VOBX2",105,0)
 I LA7DIV'="" D
"RTN","LA7VOBX2",106,0)
 . N LA7DT
"RTN","LA7VOBX2",107,0)
 . S LA7OBX(23)=$$OBX23^LA7VOBX(4,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX2",108,0)
 . S LA7DT=$S($P(LA7SUB(0),"^",11):$P(LA7SUB(0),"^",11),1:$$NOW^XLFDT)
"RTN","LA7VOBX2",109,0)
 . S LA7OBX(24)=$$OBX24^LA7VOBX(4,LA7DIV,LA7DT,LA7FS,LA7ECH)
"RTN","LA7VOBX2",110,0)
 ;
"RTN","LA7VOBX2",111,0)
 D BUILDSEG^LA7VHLU(.LA7OBX,.LA7ARRAY,LA7FS)
"RTN","LA7VOBX2",112,0)
 ;
"RTN","LA7VOBX2",113,0)
 Q
"RTN","LA7VOBX2",114,0)
 ;
"RTN","LA7VOBX2",115,0)
 ;
"RTN","LA7VOBX2",116,0)
SUBID ; Build sub-id for "SP" subscript
"RTN","LA7VOBX2",117,0)
 ; Used to identify supplementary reports, specimens and related special
"RTN","LA7VOBX2",118,0)
 ; studies performed on thoese specimens.
"RTN","LA7VOBX2",119,0)
 ;
"RTN","LA7VOBX2",120,0)
 N LA7SUBID
"RTN","LA7VOBX2",121,0)
 ;
"RTN","LA7VOBX2",122,0)
 S LA7SUBID=""
"RTN","LA7VOBX2",123,0)
 ;
"RTN","LA7VOBX2",124,0)
 ; Sub-id's for supplementary reports
"RTN","LA7VOBX2",125,0)
 I LRSB=1.2 S LA7SUBID="1."_$P(LA7IENS,",")
"RTN","LA7VOBX2",126,0)
 ;
"RTN","LA7VOBX2",127,0)
 ; Sub-id's for specimens and special studies
"RTN","LA7VOBX2",128,0)
 I LRSB=10!(LRSB="10,2") S LA7SUBID="10."_$P(LA7IENS,",")
"RTN","LA7VOBX2",129,0)
 I LRSB="10,1.5"!(LRSB="10,5") S LA7SUBID="10."_$P(LA7IENS,",",2)_"."_$P(LA7IENS,",")
"RTN","LA7VOBX2",130,0)
 ;
"RTN","LA7VOBX2",131,0)
 I LA7SUBID'="" S LA7OBX(4)=$$OBX4^LA7VOBX(LA7SUBID,LA7FS,LA7ECH)
"RTN","LA7VOBX2",132,0)
 ;
"RTN","LA7VOBX2",133,0)
 Q
"RTN","LA7VOBX2",134,0)
 ;
"RTN","LA7VOBX2",135,0)
 ;
"RTN","LA7VOBX2",136,0)
DOD ; Build OBX segment's to special DoD specifications.
"RTN","LA7VOBX2",137,0)
 ; Send word-processing fields as series of OBX's for DoD.
"RTN","LA7VOBX2",138,0)
 ; DoD cannot handle formatted text (FT) data type.
"RTN","LA7VOBX2",139,0)
 ;
"RTN","LA7VOBX2",140,0)
 S LA7OBX(2)="ST"
"RTN","LA7VOBX2",141,0)
 S LA7VAL=$G(^LR(LRDFN,LRSS,$P(LA7IDT,","),LA7SB,$P(LA7IDT,",",2),0))
"RTN","LA7VOBX2",142,0)
 I LA7VAL="" S LA7VAL=" "
"RTN","LA7VOBX2",143,0)
 S LA7OBX(5)=$$OBX5^LA7VOBX(LA7VAL,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX2",144,0)
 Q
"RTN","LA7VOBX3")
0^17^B83540167^B33632644
"RTN","LA7VOBX3",1,0)
LA7VOBX3 ;DALOI/JMC - LAB OBX Segment message builder (MI subscripts) cont'd ;Feb 5, 2009
"RTN","LA7VOBX3",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VOBX3",3,0)
 ;
"RTN","LA7VOBX3",4,0)
 ; Reference to ^DD supported by DBIA #999
"RTN","LA7VOBX3",5,0)
 ;
"RTN","LA7VOBX3",6,0)
MI ; Build OBX segments for results that are microbiology subscript.
"RTN","LA7VOBX3",7,0)
 ; Called by LA7VOBX
"RTN","LA7VOBX3",8,0)
 ;
"RTN","LA7VOBX3",9,0)
 N I,LA761,LA76305,LA7ALT,LA7ALTCS,LA7CODE,LA7DIV,LA7IENS,LA7LOINC,LA7NLT,LA7OBX,LA7ORS,LA7PARNT,LA7SAVID,LA7SUBFL,LA7VAL,LA7VERP
"RTN","LA7VOBX3",10,0)
 ;
"RTN","LA7VOBX3",11,0)
 I $P(LRIDT,",",2) S LRIDT(2)=$P(LRIDT,",",2),LRIDT(3)=$P(LRIDT,",",3),LRIDT=$P(LRIDT,",")
"RTN","LA7VOBX3",12,0)
 ;
"RTN","LA7VOBX3",13,0)
 I '$D(^LR(LRDFN,LRSS,LRIDT)) Q
"RTN","LA7VOBX3",14,0)
 ;
"RTN","LA7VOBX3",15,0)
 F I=0,1,5,8,11,16 S LA76305(I)=$G(^LR(LRDFN,LRSS,LRIDT,I))
"RTN","LA7VOBX3",16,0)
 ;
"RTN","LA7VOBX3",17,0)
 S (LA7ALT,LA7ALTCS,LA7CODE,LA7ID,LA7LOINC,LA7NLT,LA7ORS,LA7SAVID,LA7SUBFL,LA7VAL,LA7VERP)=""
"RTN","LA7VOBX3",18,0)
 ;
"RTN","LA7VOBX3",19,0)
 ; Specimen topography
"RTN","LA7VOBX3",20,0)
 S LA761=$P(LA76305(0),"^",5)
"RTN","LA7VOBX3",21,0)
 ; Default codes
"RTN","LA7VOBX3",22,0)
 S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,LA7CODE,LA761)
"RTN","LA7VOBX3",23,0)
 ;
"RTN","LA7VOBX3",24,0)
 D SEC,GEN
"RTN","LA7VOBX3",25,0)
 Q
"RTN","LA7VOBX3",26,0)
 ;
"RTN","LA7VOBX3",27,0)
SEC ; Build section specific fields
"RTN","LA7VOBX3",28,0)
 N LA7X,LA7Y
"RTN","LA7VOBX3",29,0)
 ;
"RTN","LA7VOBX3",30,0)
 ; Urine screen
"RTN","LA7VOBX3",31,0)
 I LRSB=11.57 D  Q
"RTN","LA7VOBX3",32,0)
 . N LA7ERR
"RTN","LA7VOBX3",33,0)
 . S LA7VERP=$P(LA76305(1),"^",3),LA7ORS=$P(LA76305(1),"^",2)
"RTN","LA7VOBX3",34,0)
 . S LA7OBX(2)=$$OBX2^LA7VOBX(63.05,11.57)
"RTN","LA7VOBX3",35,0)
 . S LA7IENS=LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",36,0)
 . S LA7VAL=$$GET1^DIQ(63.05,LA7IENS,11.57,"","LA7ERR")
"RTN","LA7VOBX3",37,0)
 . S LA7Y="MI-"_LRSB_"^"_$$GET1^DID(63.05,11.57,"","LABEL")_"^99VA63"
"RTN","LA7VOBX3",38,0)
 . S LA7ALT=LA7Y_"^"_LA7Y
"RTN","LA7VOBX3",39,0)
 ;
"RTN","LA7VOBX3",40,0)
 ; Sputum Screen
"RTN","LA7VOBX3",41,0)
 I LRSB=11.58 D  Q
"RTN","LA7VOBX3",42,0)
 . N LA7ERR
"RTN","LA7VOBX3",43,0)
 . S LA7VERP=$P(LA76305(1),"^",3)
"RTN","LA7VOBX3",44,0)
 . S LA7ORS=$P(LA76305(1),"^",2)
"RTN","LA7VOBX3",45,0)
 . S LA7OBX(2)=$$OBX2^LA7VOBX(63.05,11.58)
"RTN","LA7VOBX3",46,0)
 . S LA7VAL=$P(^LR(LRDFN,LRSS,LRIDT,1),"^",5)
"RTN","LA7VOBX3",47,0)
 . S LA7Y="MI-"_LRSB_"^"_$$GET1^DID(63.05,11.58,"","LABEL")_"^99VA63"
"RTN","LA7VOBX3",48,0)
 . S LA7ALT=LA7Y_"^"_LA7Y
"RTN","LA7VOBX3",49,0)
 ;
"RTN","LA7VOBX3",50,0)
 ; Gram stain
"RTN","LA7VOBX3",51,0)
 I LRSB=11.6 D  Q
"RTN","LA7VOBX3",52,0)
 . N LA7ERR
"RTN","LA7VOBX3",53,0)
 . S LA7VERP=$P(LA76305(1),"^",3)
"RTN","LA7VOBX3",54,0)
 . S LA7ORS=$P(LA76305(1),"^",2)
"RTN","LA7VOBX3",55,0)
 . S LA7OBX(2)=$$OBX2^LA7VOBX(63.05,11.6)
"RTN","LA7VOBX3",56,0)
 . S LA7IENS=LRIDT(2)_","_LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",57,0)
 . S LA7VAL=$$GET1^DIQ(63.29,LA7IENS,.01,"","LA7ERR")
"RTN","LA7VOBX3",58,0)
 . S LA7Y="MI-"_LRSB_"^"_$$GET1^DID(63.29,.01,"","LABEL")_"^99VA63"
"RTN","LA7VOBX3",59,0)
 . S LA7ALT=LA7Y_"^"_LA7Y
"RTN","LA7VOBX3",60,0)
 . ; Setup DoD special coding system
"RTN","LA7VOBX3",61,0)
 . I LA7NVAF=1,$P(LA7CODE,"!",2) S LA7ALTCS="99VA64MG"
"RTN","LA7VOBX3",62,0)
 ;
"RTN","LA7VOBX3",63,0)
 ; Micro organism
"RTN","LA7VOBX3",64,0)
 I $P(LRSB,",")=12 D  Q
"RTN","LA7VOBX3",65,0)
 . S LA7VERP=$P(LA76305(1),"^",3)
"RTN","LA7VOBX3",66,0)
 . S LA7ORS=$P(LA76305(1),"^",2)
"RTN","LA7VOBX3",67,0)
 . S LA7SUBFL=63.3
"RTN","LA7VOBX3",68,0)
 . ; Working on colony count
"RTN","LA7VOBX3",69,0)
 . I $P(LRSB,",",2)=1 D CC Q
"RTN","LA7VOBX3",70,0)
 . ; Working on organism
"RTN","LA7VOBX3",71,0)
 . I $G(LRIDT(3))="" D ORG Q
"RTN","LA7VOBX3",72,0)
 . ; Working on susceptibilities
"RTN","LA7VOBX3",73,0)
 . I $P(LA76305(1),"^",4) S LA7VERP=$P(LA76305(1),"^",4)
"RTN","LA7VOBX3",74,0)
 . I $P(LRSB,",",2)<3 D MIC Q
"RTN","LA7VOBX3",75,0)
 . I $P(LRSB,",",2)=3 D MICA Q
"RTN","LA7VOBX3",76,0)
 ; 
"RTN","LA7VOBX3",77,0)
 ; Parasite organism
"RTN","LA7VOBX3",78,0)
 I $P(LRSB,",")=16 D  Q
"RTN","LA7VOBX3",79,0)
 . S LA7ORS=$P(LA76305(5),"^",2)
"RTN","LA7VOBX3",80,0)
 . S LA7VERP=$P(LA76305(5),"^",3)
"RTN","LA7VOBX3",81,0)
 . ; Working on organism
"RTN","LA7VOBX3",82,0)
 . S LA7SUBFL=63.34 D ORG
"RTN","LA7VOBX3",83,0)
 ;
"RTN","LA7VOBX3",84,0)
 ; Mycology organism
"RTN","LA7VOBX3",85,0)
 I $P(LRSB,",")=20 D  Q
"RTN","LA7VOBX3",86,0)
 . S LA7ORS=$P(LA76305(8),"^",2)
"RTN","LA7VOBX3",87,0)
 . S LA7VERP=$P(LA76305(8),"^",3)
"RTN","LA7VOBX3",88,0)
 . S LA7SUBFL=63.37
"RTN","LA7VOBX3",89,0)
 . ; Working on colony count
"RTN","LA7VOBX3",90,0)
 . I $P(LRSB,",",2)=1 D CC Q
"RTN","LA7VOBX3",91,0)
 . ; Working on organism
"RTN","LA7VOBX3",92,0)
 . D ORG
"RTN","LA7VOBX3",93,0)
 ;
"RTN","LA7VOBX3",94,0)
 ; Acid Fast stain
"RTN","LA7VOBX3",95,0)
 I LRSB=24 D  Q
"RTN","LA7VOBX3",96,0)
 . N LA7ERR
"RTN","LA7VOBX3",97,0)
 . S LA7VERP=$P(LA76305(11),"^",3)
"RTN","LA7VOBX3",98,0)
 . S LA7ORS=$P(LA76305(11),"^",2)
"RTN","LA7VOBX3",99,0)
 . S LA7OBX(2)=$$OBX2^LA7VOBX(63.05,24)
"RTN","LA7VOBX3",100,0)
 . S LA7IENS=LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",101,0)
 . S LA7VAL=$$GET1^DIQ(63.05,LA7IENS,24,"","LA7ERR")
"RTN","LA7VOBX3",102,0)
 . S LA7Y="MI-"_LRSB_"^"_$$GET1^DID(63.05,24,"","LABEL")_"^99VA63"
"RTN","LA7VOBX3",103,0)
 . S LA7ALT=LA7Y_"^"_LA7Y
"RTN","LA7VOBX3",104,0)
 ;
"RTN","LA7VOBX3",105,0)
 ; Acid Fast stain quantity
"RTN","LA7VOBX3",106,0)
 I LRSB=25 D  Q
"RTN","LA7VOBX3",107,0)
 . N LA7ERR
"RTN","LA7VOBX3",108,0)
 . S LA7VERP=$P(LA76305(11),"^",3)
"RTN","LA7VOBX3",109,0)
 . S LA7ORS=$P(LA76305(11),"^",2)
"RTN","LA7VOBX3",110,0)
 . S LA7OBX(2)=$$OBX2^LA7VOBX(63.05,25)
"RTN","LA7VOBX3",111,0)
 . S LA7IENS=LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",112,0)
 . S LA7VAL=$$GET1^DIQ(63.05,LA7IENS,25,"","LA7ERR")
"RTN","LA7VOBX3",113,0)
 . S LA7Y="MI-"_LRSB_"^"_$$GET1^DID(63.05,25,"","LABEL")_"^99VA63"
"RTN","LA7VOBX3",114,0)
 . S LA7ALT=LA7Y_"^"_LA7Y
"RTN","LA7VOBX3",115,0)
 ;
"RTN","LA7VOBX3",116,0)
 ; TB organism
"RTN","LA7VOBX3",117,0)
 I $P(LRSB,",")=26 D  Q
"RTN","LA7VOBX3",118,0)
 . S LA7ORS=$P(LA76305(11),"^",2)
"RTN","LA7VOBX3",119,0)
 . S LA7VERP=$P(LA76305(11),"^",5)
"RTN","LA7VOBX3",120,0)
 . S LA7SUBFL=63.39
"RTN","LA7VOBX3",121,0)
 . ; Working on colony count
"RTN","LA7VOBX3",122,0)
 . I $P(LRSB,",",2)=1 D CC Q
"RTN","LA7VOBX3",123,0)
 . ; Working on organism
"RTN","LA7VOBX3",124,0)
 . I $G(LRIDT(3))="" D ORG Q
"RTN","LA7VOBX3",125,0)
 . ; Working on susceptibilities
"RTN","LA7VOBX3",126,0)
 . D MIC
"RTN","LA7VOBX3",127,0)
 ;
"RTN","LA7VOBX3",128,0)
 ; Virology virus
"RTN","LA7VOBX3",129,0)
 I $P(LRSB,",")=36 D  Q
"RTN","LA7VOBX3",130,0)
 . S LA7ORS=$P(LA76305(16),"^",2)
"RTN","LA7VOBX3",131,0)
 . S LA7VERP=$P(LA76305(16),"^",3)
"RTN","LA7VOBX3",132,0)
 . ; Working on virus
"RTN","LA7VOBX3",133,0)
 . S LA7SUBFL=63.43
"RTN","LA7VOBX3",134,0)
 . D ORG
"RTN","LA7VOBX3",135,0)
 ;
"RTN","LA7VOBX3",136,0)
 ; Antibiotic levels
"RTN","LA7VOBX3",137,0)
 I $P(LRSB,",")=28 D  Q
"RTN","LA7VOBX3",138,0)
 . S LA7VERP=$P(LA76305(1),"^",3)
"RTN","LA7VOBX3",139,0)
 . S LA7ORS=$P(LA76305(1),"^",2)
"RTN","LA7VOBX3",140,0)
 . S LA7SUBFL=63.42
"RTN","LA7VOBX3",141,0)
 . S LA7OBX(2)="SN"
"RTN","LA7VOBX3",142,0)
 . S LA7X=$G(^LR(LRDFN,LRSS,LRIDT,14,LRIDT(2),0))
"RTN","LA7VOBX3",143,0)
 . S $P(LA7CODE,"!",2)="93978.0000"
"RTN","LA7VOBX3",144,0)
 . S $P(LA7CODE,"!",3)=$S($P(LA7X,"^",2)="P":44433,$P(LA7X,"^",2)="T":44434,1:23816)
"RTN","LA7VOBX3",145,0)
 . S LA7VAL=$P(LA7X,"^",3)
"RTN","LA7VOBX3",146,0)
 . S LA7Y="MI-"_$P(LRSB,",")_"-"_$P(LRSB,",",2)_"^"_$P(LA7X,"^")_"^99VA63"
"RTN","LA7VOBX3",147,0)
 . S LA7ALT=LA7Y_"^"_LA7Y
"RTN","LA7VOBX3",148,0)
 ;
"RTN","LA7VOBX3",149,0)
 ;
"RTN","LA7VOBX3",150,0)
 Q
"RTN","LA7VOBX3",151,0)
 ;
"RTN","LA7VOBX3",152,0)
 ;
"RTN","LA7VOBX3",153,0)
CC ; Organism's Colony count
"RTN","LA7VOBX3",154,0)
 ; If "CFU/ml" found then move units to OBX-6 (Units).
"RTN","LA7VOBX3",155,0)
 N LA7X
"RTN","LA7VOBX3",156,0)
 ;
"RTN","LA7VOBX3",157,0)
 S LA7ID=$P(LRSB,",")_"-"_LRIDT(2)
"RTN","LA7VOBX3",158,0)
 S LA7IENS=LRIDT(2)_","_LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",159,0)
 S LA7OBX(2)=$$OBX2^LA7VOBX(LA7SUBFL,1)
"RTN","LA7VOBX3",160,0)
 S LA7VAL=$$GET1^DIQ(LA7SUBFL,LA7IENS,1)
"RTN","LA7VOBX3",161,0)
 S LA7X=$$UP^XLFSTR(LA7VAL)
"RTN","LA7VOBX3",162,0)
 I LA7X["CFU/ML" D
"RTN","LA7VOBX3",163,0)
 . S LA7OBX(6)=$$OBX6^LA7VOBX("CFU/ml","",LA7FS,LA7ECH,$G(LA7INTYP))
"RTN","LA7VOBX3",164,0)
 . S LA7X("CFU/ml")="",LA7X("CFU/ML")=""
"RTN","LA7VOBX3",165,0)
 . S LA7VAL=$$REPLACE^XLFSTR(LA7VAL,.LA7X)
"RTN","LA7VOBX3",166,0)
 ;
"RTN","LA7VOBX3",167,0)
 S LA7Y="MI-"_$P(LRSB,",")_"-1^"_$$GET1^DID(LA7SUBFL,1,"","LABEL")_"^99VA63"
"RTN","LA7VOBX3",168,0)
 S LA7ALT=LA7Y_"^"_LA7Y
"RTN","LA7VOBX3",169,0)
 ;
"RTN","LA7VOBX3",170,0)
 Q
"RTN","LA7VOBX3",171,0)
 ;
"RTN","LA7VOBX3",172,0)
 ;
"RTN","LA7VOBX3",173,0)
ORG ; Organism
"RTN","LA7VOBX3",174,0)
 ;
"RTN","LA7VOBX3",175,0)
 N LA7X,LA7Y,X
"RTN","LA7VOBX3",176,0)
 ;
"RTN","LA7VOBX3",177,0)
 S LA7ID=LRSB_"-"_LRIDT(2)
"RTN","LA7VOBX3",178,0)
 S LA7OBX(2)=$$OBX2^LA7VOBX(LA7SUBFL,.01)
"RTN","LA7VOBX3",179,0)
 S LA7IENS=LRIDT(2)_","_LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",180,0)
 S LA7VAL=""
"RTN","LA7VOBX3",181,0)
 S LA7X=$$GET1^DIQ(LA7SUBFL,LA7IENS,.01,"I"),LA7X(.01)=$$GET1^DIQ(LA7SUBFL,LA7IENS,.01)
"RTN","LA7VOBX3",182,0)
 ;
"RTN","LA7VOBX3",183,0)
 ; Check for SNOMED coding/local coding as alternate
"RTN","LA7VOBX3",184,0)
 S X=$$GET1^DIQ(LA7SUBFL,LA7IENS,".01:2")
"RTN","LA7VOBX3",185,0)
 I X'="" D
"RTN","LA7VOBX3",186,0)
 . S LA7VAL="E-"_X_"^"_LA7X(.01)_"^SNM",$P(LA7VAL,"^",4,6)=LA7X_"^"_LA7X(.01)_"^99VA61.2"
"RTN","LA7VOBX3",187,0)
 . I $G(LA7NVAF)'=1 S LA7OBX(2)="CWE",$P(LA7VAL,"^",7,8)="1974^5.2",$P(LA7VAL,"^",9)=LA7X(.01)
"RTN","LA7VOBX3",188,0)
 ;
"RTN","LA7VOBX3",189,0)
 ; If no SNOMED then use local coding as primary
"RTN","LA7VOBX3",190,0)
 I LA7VAL="" D
"RTN","LA7VOBX3",191,0)
 . S LA7VAL=LA7X_"^"_LA7X(.01)_"^99VA61.2"
"RTN","LA7VOBX3",192,0)
 . I $G(LA7NVAF)'=1 S LA7OBX(2)="CWE",$P(LA7VAL,"^",7)="5.2",$P(LA7VAL,"^",9)=LA7X(.01)
"RTN","LA7VOBX3",193,0)
 ;
"RTN","LA7VOBX3",194,0)
 S LA7Y="MI-"_$P(LRSB,",")_"-.01^"_$$GET1^DID(LA7SUBFL,.01,"","LABEL")_"^99VA63"
"RTN","LA7VOBX3",195,0)
 S LA7ALT=LA7Y_"^"_LA7Y
"RTN","LA7VOBX3",196,0)
 ;
"RTN","LA7VOBX3",197,0)
 S LA7OBX(8)=$$OBX8^LA7VOBX("A")
"RTN","LA7VOBX3",198,0)
 ;
"RTN","LA7VOBX3",199,0)
 ; Set flag to save sub-id for parent-child relationship
"RTN","LA7VOBX3",200,0)
 S LA7SAVID=1
"RTN","LA7VOBX3",201,0)
 Q
"RTN","LA7VOBX3",202,0)
 ;
"RTN","LA7VOBX3",203,0)
 ;
"RTN","LA7VOBX3",204,0)
MIC ; Organism's susceptibilities
"RTN","LA7VOBX3",205,0)
 ;
"RTN","LA7VOBX3",206,0)
 N LA7IENS,LA7SUB
"RTN","LA7VOBX3",207,0)
 ;
"RTN","LA7VOBX3",208,0)
 ; Bact or TB organism
"RTN","LA7VOBX3",209,0)
 S LA7SUB=$S($P(LRSB,",")=12:3,1:12)
"RTN","LA7VOBX3",210,0)
 ;
"RTN","LA7VOBX3",211,0)
 S LA7OBX(2)=$$OBX2^LA7VOBX(62.06,.01)
"RTN","LA7VOBX3",212,0)
 ;
"RTN","LA7VOBX3",213,0)
 ; Determine local code for antibiotic if not mapped to NLT or in file #62.06
"RTN","LA7VOBX3",214,0)
 ;  - Use file #62.06 entry if available otherwise generate from drug node field in file #63
"RTN","LA7VOBX3",215,0)
 ;    also used to convey local display name in 9th component
"RTN","LA7VOBX3",216,0)
 S LA7X=""
"RTN","LA7VOBX3",217,0)
 I $P(LRSB,",")=12 D
"RTN","LA7VOBX3",218,0)
 . S LA7X=$O(^LAB(62.06,"AD",$P(LRSB,",",2),0))
"RTN","LA7VOBX3",219,0)
 . I LA7X S LA7ALT=LA7X_"^"_$$GET1^DIQ(62.06,LA7X_",",.01)_"^99VA62.06",LA7ALT=LA7ALT_"^"_LA7ALT
"RTN","LA7VOBX3",220,0)
 I LA7ALT="" D
"RTN","LA7VOBX3",221,0)
 . S LA7X=$P(LRSB,",",2),LA7Y=$O(^DD(LA7SUBFL,"GL",LA7X,1,0))
"RTN","LA7VOBX3",222,0)
 . I LA7Y<1 Q
"RTN","LA7VOBX3",223,0)
 . S LA7ALT="MIAB"_$P(LRSB,",")_"-"_$P(LRSB,",",2)_"^"_$$GET1^DID(LA7SUBFL,LA7Y,"","LABEL")_"^99VA63"
"RTN","LA7VOBX3",224,0)
 . S LA7ALT=LA7ALT_"^"_LA7ALT
"RTN","LA7VOBX3",225,0)
 ;
"RTN","LA7VOBX3",226,0)
 S LA7X=$G(^LR(LRDFN,"MI",LRIDT,LA7SUB,LRIDT(2),LRIDT(3)))
"RTN","LA7VOBX3",227,0)
 S LA7VAL=$P(LA7X,"^")
"RTN","LA7VOBX3",228,0)
 I LA7VAL'="" D
"RTN","LA7VOBX3",229,0)
 . I "SIR"[$E(LA7VAL) S LA7OBX(8)=$$OBX8^LA7VOBX($E(LA7VAL)) Q
"RTN","LA7VOBX3",230,0)
 . I "SIR"[$E($P(LA7X,"^",2)) S LA7OBX(8)=$$OBX8^LA7VOBX($E($P(LA7X,"^",2))) Q
"RTN","LA7VOBX3",231,0)
 ;
"RTN","LA7VOBX3",232,0)
 ; Determine access screen for this susceptibility
"RTN","LA7VOBX3",233,0)
 I $P(LA7X,"^",3)="" S $P(LA7X,"^",3)="A"
"RTN","LA7VOBX3",234,0)
 S LA7OBX(13)=$$OBX13^LA7VOBX($P(LA7X,"^",3),$S($G(LA7INTYP)=30:"MIS-HDR",1:"MIS"),LA7FS,LA7ECH)
"RTN","LA7VOBX3",235,0)
 ;
"RTN","LA7VOBX3",236,0)
 Q
"RTN","LA7VOBX3",237,0)
 ;
"RTN","LA7VOBX3",238,0)
 ;
"RTN","LA7VOBX3",239,0)
MICA ;  Bacteria organism's susceptibilities - free text
"RTN","LA7VOBX3",240,0)
 ;
"RTN","LA7VOBX3",241,0)
 N LA7SUB,LA7X
"RTN","LA7VOBX3",242,0)
 S LA7OBX(2)="NM"
"RTN","LA7VOBX3",243,0)
 ;
"RTN","LA7VOBX3",244,0)
 ; Bact organism
"RTN","LA7VOBX3",245,0)
 S LA7SUB=3
"RTN","LA7VOBX3",246,0)
 ;
"RTN","LA7VOBX3",247,0)
 ; Determine local code for free text antibiotic also used to convey local display name in 9th component
"RTN","LA7VOBX3",248,0)
 S LA7X=$G(^LR(LRDFN,"MI",LRIDT,LA7SUB,LRIDT(2),3,LRIDT(3),0))
"RTN","LA7VOBX3",249,0)
 S LA7ALT="MIAB"_$P(LRSB,",")_"-"_$P(LRSB,",",2)_"-"_$P(LRSB,",",3)_"^"_$P(LA7X,"^")_$S($P(LRSB,",",3)=1:" MIC",1:" MBC")_"^99VA63"
"RTN","LA7VOBX3",250,0)
 S LA7ALT=LA7ALT_"^"_LA7ALT
"RTN","LA7VOBX3",251,0)
 S $P(LA7CODE,"!",2)="87565.0000"
"RTN","LA7VOBX3",252,0)
 S $P(LA7CODE,"!",3)=$S($P(LRSB,",",3)=1:21070,1:23658)
"RTN","LA7VOBX3",253,0)
 ;
"RTN","LA7VOBX3",254,0)
 S LA7VAL=$P(LA7X,"^",$S($P(LRSB,",",3)=1:2,1:3))
"RTN","LA7VOBX3",255,0)
 ;
"RTN","LA7VOBX3",256,0)
 S LA7OBX(6)="UG/ML"
"RTN","LA7VOBX3",257,0)
 S LA7OBX(8)=""
"RTN","LA7VOBX3",258,0)
 ;
"RTN","LA7VOBX3",259,0)
 Q
"RTN","LA7VOBX3",260,0)
 ;
"RTN","LA7VOBX3",261,0)
 ;
"RTN","LA7VOBX3",262,0)
GEN ; Fields common to all MI OBX segments.
"RTN","LA7VOBX3",263,0)
 ;
"RTN","LA7VOBX3",264,0)
 ; Initialize OBX segment
"RTN","LA7VOBX3",265,0)
 S LA7OBX(0)="OBX"
"RTN","LA7VOBX3",266,0)
 S LA7OBX(1)=$$OBX1^LA7VOBX(.LA7OBXSN)
"RTN","LA7VOBX3",267,0)
 ;
"RTN","LA7VOBX3",268,0)
 S LA7OBX(3)=$$OBX3^LA7VOBX($P(LA7CODE,"!",2),$P(LA7CODE,"!",3),LA7ALT,LA7FS,LA7ECH,$G(LA7INTYP))
"RTN","LA7VOBX3",269,0)
 ;
"RTN","LA7VOBX3",270,0)
 ; Change normal coding system for DoD special
"RTN","LA7VOBX3",271,0)
 I LA7NVAF=1,LA7ALTCS'="" D
"RTN","LA7VOBX3",272,0)
 . F I=3,6 I $P(LA7OBX(3),$E(LA7ECH,1),I)="99VA64" S $P(LA7OBX(3),$E(LA7ECH,1),I)=LA7ALTCS Q
"RTN","LA7VOBX3",273,0)
 ;
"RTN","LA7VOBX3",274,0)
 ; Test value
"RTN","LA7VOBX3",275,0)
 S LA7OBX(5)=$$OBX5^LA7VOBX(LA7VAL,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX3",276,0)
 ;
"RTN","LA7VOBX3",277,0)
 ; Set sub-id and save for constructing parents
"RTN","LA7VOBX3",278,0)
 I LA7ID'="" D
"RTN","LA7VOBX3",279,0)
 . S LA7OBX(4)=$$OBX4^LA7VOBX(LA7ID,LA7FS,LA7ECH)
"RTN","LA7VOBX3",280,0)
 . I LA7SAVID D
"RTN","LA7VOBX3",281,0)
 . . F I=1,2 S LA7ID(LA7ID,I)=LA7OBX(I+2)
"RTN","LA7VOBX3",282,0)
 . . I $G(HL("VER"))="2.2" S LA7ID(LA7ID,3)=LA7OBX(5) Q
"RTN","LA7VOBX3",283,0)
 . . F I=2,4 I $P(LA7OBX(5),$E(LA7ECH,1),I)'="" S LA7ID(LA7ID,3)=$P(LA7OBX(5),$E(LA7ECH,1),I) Q
"RTN","LA7VOBX3",284,0)
 ;
"RTN","LA7VOBX3",285,0)
 ; Order result status - "P"artial, "F"inal , "A"mended results
"RTN","LA7VOBX3",286,0)
 ; If no status from individual components then use status from zeroth node.
"RTN","LA7VOBX3",287,0)
 ; If no release date then pending else final
"RTN","LA7VOBX3",288,0)
 ; If amended, overrides all other status
"RTN","LA7VOBX3",289,0)
 I LA7ORS="" S LA7ORS=$S('$P(LA76305(0),"^",3):"P",1:"F")
"RTN","LA7VOBX3",290,0)
 I $P(LA76305(0),"^",9) S LA7ORS="A"
"RTN","LA7VOBX3",291,0)
 S LA7OBX(11)=$$OBX11^LA7VOBX(LA7ORS)
"RTN","LA7VOBX3",292,0)
 ;
"RTN","LA7VOBX3",293,0)
 S LA7DIV=$P($G(^LR(LRDFN,LRSS,LRIDT,"RF")),"^")
"RTN","LA7VOBX3",294,0)
 I LA7DIV="",$$DIV4^XUSER(.LA7DIV,$P(LA76305(0),"^",4)) S LA7DIV=$O(LA7DIV(0))
"RTN","LA7VOBX3",295,0)
 ;
"RTN","LA7VOBX3",296,0)
 ; Observation date/time - collection date/time per HL7 standard
"RTN","LA7VOBX3",297,0)
 I $P(LA76305(0),"^") S LA7OBX(14)=$$OBX14^LA7VOBX($P(LA76305(0),"^"))
"RTN","LA7VOBX3",298,0)
 ;
"RTN","LA7VOBX3",299,0)
 ; Facility that performed the testing
"RTN","LA7VOBX3",300,0)
 S LA7OBX(15)=$$OBX15^LA7VOBX(LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX3",301,0)
 ;
"RTN","LA7VOBX3",302,0)
 ; Person that verified the test
"RTN","LA7VOBX3",303,0)
 I $P(LA76305(0),"^",4) S LA7VERP=$P(LA76305(0),"^",4)
"RTN","LA7VOBX3",304,0)
 I LA7VERP S LA7OBX(16)=$$OBX16^LA7VOBX(LA7VERP,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX3",305,0)
 ;
"RTN","LA7VOBX3",306,0)
 ; Performing organization name/address
"RTN","LA7VOBX3",307,0)
 I LA7DIV'="" D
"RTN","LA7VOBX3",308,0)
 . N LA7DT
"RTN","LA7VOBX3",309,0)
 . S LA7OBX(23)=$$OBX23^LA7VOBX(4,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX3",310,0)
 . S LA7DT=$S($P(LA76305(0),"^",3):$P(LA76305(0),"^",3),1:$$NOW^XLFDT)
"RTN","LA7VOBX3",311,0)
 . S LA7OBX(24)=$$OBX24^LA7VOBX(4,LA7DIV,LA7DT,LA7FS,LA7ECH)
"RTN","LA7VOBX3",312,0)
 ;
"RTN","LA7VOBX3",313,0)
 D BUILDSEG^LA7VHLU(.LA7OBX,.LA7ARRAY,LA7FS)
"RTN","LA7VOBX3",314,0)
 ;
"RTN","LA7VOBX3",315,0)
 Q
"RTN","LA7VOBXA")
0^15^B53603815^B31676928
"RTN","LA7VOBXA",1,0)
LA7VOBXA ;DALOI/JMC - LAB OBX Segment message builder (cont'd) ;Sep 18, 2008
"RTN","LA7VOBXA",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,70,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VOBXA",3,0)
 ;
"RTN","LA7VOBXA",4,0)
 Q
"RTN","LA7VOBXA",5,0)
 ;
"RTN","LA7VOBXA",6,0)
OBX2 ; Build OBX-2 sequence - Value type
"RTN","LA7VOBXA",7,0)
 ;
"RTN","LA7VOBXA",8,0)
 ; default value - string data
"RTN","LA7VOBXA",9,0)
 S LA7VAL="ST"
"RTN","LA7VOBXA",10,0)
 S LA7TYP="",LA7FILE=$G(LA7FILE),LA7FIELD=$G(LA7FIELD)
"RTN","LA7VOBXA",11,0)
 ;
"RTN","LA7VOBXA",12,0)
 I LA7FILE,LA7FIELD S LA7TYP=$$GET1^DID(LA7FILE,LA7FIELD,"","TYPE","","LA7ERR")
"RTN","LA7VOBXA",13,0)
 ;
"RTN","LA7VOBXA",14,0)
 I LA7TYP="DATE/TIME" S LA7VAL="TS"
"RTN","LA7VOBXA",15,0)
 I LA7TYP="FREE TEXT" S LA7VAL="ST"
"RTN","LA7VOBXA",16,0)
 I LA7TYP="WORD-PROCESSING" S LA7VAL="FT"
"RTN","LA7VOBXA",17,0)
 I LA7TYP="NUMERIC" S LA7VAL="NM"
"RTN","LA7VOBXA",18,0)
 I LA7TYP="SET" S LA7VAL="ST"
"RTN","LA7VOBXA",19,0)
 I LA7TYP="POINTER" S LA7VAL="ST"
"RTN","LA7VOBXA",20,0)
 ;
"RTN","LA7VOBXA",21,0)
 Q
"RTN","LA7VOBXA",22,0)
 ;
"RTN","LA7VOBXA",23,0)
 ;
"RTN","LA7VOBXA",24,0)
OBX3 ; Build OBX-3 sequence - Observation identifier field
"RTN","LA7VOBXA",25,0)
 ;
"RTN","LA7VOBXA",26,0)
 ; Initialize variables 
"RTN","LA7VOBXA",27,0)
 S LA7J=1,LA7Y="",LA7INTYP=$G(LA7INTYP)
"RTN","LA7VOBXA",28,0)
 ;
"RTN","LA7VOBXA",29,0)
 ; Build sequence using LOINC codes. LOINC code/code name/"LN"
"RTN","LA7VOBXA",30,0)
 ; VA VUID in 2nd triplet when sending to VA HDR. Use VA Display name (field #82) for VUID test name
"RTN","LA7VOBXA",31,0)
 I LA7953'="" D
"RTN","LA7VOBXA",32,0)
 . N LA7IENS,LA7Z
"RTN","LA7VOBXA",33,0)
 . S LA7953=$P(LA7953,"-"),LA7IENS=LA7953_","
"RTN","LA7VOBXA",34,0)
 . D GETS^DIQ(95.3,LA7IENS,".01;80;99.99","E","LA7X")
"RTN","LA7VOBXA",35,0)
 . ; Invalid code???
"RTN","LA7VOBXA",36,0)
 . I $G(LA7X(95.3,LA7IENS,.01,"E"))="" Q
"RTN","LA7VOBXA",37,0)
 . S LA7Z=LA7X(95.3,LA7IENS,.01,"E")
"RTN","LA7VOBXA",38,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",39,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J)=LA7Z
"RTN","LA7VOBXA",40,0)
 . S LA7Z=$G(LA7X(95.3,LA7IENS,80,"E"))
"RTN","LA7VOBXA",41,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",42,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=LA7Z
"RTN","LA7VOBXA",43,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+2)="LN"
"RTN","LA7VOBXA",44,0)
 . S LA7J=4
"RTN","LA7VOBXA",45,0)
 . I LA7INTYP=30,$G(LA7X(95.3,LA7IENS,99.99,"E"))'="" D
"RTN","LA7VOBXA",46,0)
 . . S $P(LA7Y,$E(LA7ECH,1),LA7J)=LA7X(95.3,LA7IENS,99.99,"E")
"RTN","LA7VOBXA",47,0)
 . . I $$VFIELD^DILFD(95.3,82) D
"RTN","LA7VOBXA",48,0)
 . . . S LA7Z=$$GET1^DIQ(95.3,LA7IENS,82)
"RTN","LA7VOBXA",49,0)
 . . . I LA7Z'="" S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",50,0)
 . . S $P(LA7Y,$E(LA7ECH,1),LA7J+2)="99VA95.3"
"RTN","LA7VOBXA",51,0)
 . . S LA7J=9
"RTN","LA7VOBXA",52,0)
 . I $G(LA7LNCVR)="" S LA7LNCVR=$$GET1^DID(95.3,"","","PACKAGE REVISION DATA")
"RTN","LA7VOBXA",53,0)
 . I LA7J>1 S $P(LA7Y,$E(LA7ECH,1),7)=LA7LNCVR
"RTN","LA7VOBXA",54,0)
 . I LA7J=9 S $P(LA7Y,$E(LA7ECH,1),8)=LA7LNCVR
"RTN","LA7VOBXA",55,0)
 ;
"RTN","LA7VOBXA",56,0)
 ; Build sequence using NLT codes - file #64 NLT code/NLT code name/"99VA64"
"RTN","LA7VOBXA",57,0)
 ; If LOINC is primary make NLT alternate, otherwise NLT primary.
"RTN","LA7VOBXA",58,0)
 ; Only on non-HDR type interfaces.
"RTN","LA7VOBXA",59,0)
 I LA7NLT'="",LA7INTYP'=30,LA7J<9 D
"RTN","LA7VOBXA",60,0)
 . N LA7642,LA7Z
"RTN","LA7VOBXA",61,0)
 . S LA764=$O(^LAM("E",LA7NLT,0)),LA7Z=""
"RTN","LA7VOBXA",62,0)
 . I LA764 S LA7Z=$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VOBXA",63,0)
 . I LA7Z="" D
"RTN","LA7VOBXA",64,0)
 . . S LA764=$O(^LAM("E",$P(LA7NLT,".")_".0000",0))
"RTN","LA7VOBXA",65,0)
 . . I LA764 S LA7Z=$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VOBXA",66,0)
 . . S LA7642=$O(^LAB(64.2,"C","."_$P(LA7NLT,".",2),0))
"RTN","LA7VOBXA",67,0)
 . . I LA764,LA7642 S LA7Z=LA7Z_"~"_$$GET1^DIQ(64.2,LA7642_",",.01,"I")
"RTN","LA7VOBXA",68,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",69,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J)=LA7NLT
"RTN","LA7VOBXA",70,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=LA7Z
"RTN","LA7VOBXA",71,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+2)="99VA64"
"RTN","LA7VOBXA",72,0)
 . S LA7Z=$$GET1^DID(64,"","","PACKAGE REVISION DATA")
"RTN","LA7VOBXA",73,0)
 . S $P(LA7Y,$E(LA7ECH,1),$S(LA7J=1:7,1:8))=LA7Z
"RTN","LA7VOBXA",74,0)
 . S LA7J=LA7J+3
"RTN","LA7VOBXA",75,0)
 ;
"RTN","LA7VOBXA",76,0)
 ; Non-standard/non-VA code
"RTN","LA7VOBXA",77,0)
 ; If alternate is a non-VA code then use as alternate code.
"RTN","LA7VOBXA",78,0)
 I LA7ALT="" Q
"RTN","LA7VOBXA",79,0)
 I LA7INTYP'=30,$P(LA7ALT,"^",3)'="99VA63",LA7J>4 S LA7J=4
"RTN","LA7VOBXA",80,0)
 I LA7J<7 D
"RTN","LA7VOBXA",81,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^"),LA7FS_LA7ECH)
"RTN","LA7VOBXA",82,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",2),LA7FS_LA7ECH)
"RTN","LA7VOBXA",83,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+2)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",3),LA7FS_LA7ECH)
"RTN","LA7VOBXA",84,0)
 . I $P(LA7ALT,"^",3)="99VA63" S $P(LA7Y,$E(LA7ECH,1),$S(LA7J=1:7,1:8))="5.2"
"RTN","LA7VOBXA",85,0)
 ;
"RTN","LA7VOBXA",86,0)
 ; Put local test name in local text (9th component)
"RTN","LA7VOBXA",87,0)
 I $E($P(LA7ALT,"^",6),1,5)="99VA6",$P(LA7ALT,"^",6)'="99VA64" D
"RTN","LA7VOBXA",88,0)
 . N I,LA7Z
"RTN","LA7VOBXA",89,0)
 . S LA7Z=$$TRIM^XLFSTR($P(LA7ALT,"^",5),"LR"," ")
"RTN","LA7VOBXA",90,0)
 . I LA7Z="" Q
"RTN","LA7VOBXA",91,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",92,0)
 . S $P(LA7Y,$E(LA7ECH,1),9)=LA7Z
"RTN","LA7VOBXA",93,0)
 ;
"RTN","LA7VOBXA",94,0)
 Q
"RTN","LA7VOBXA",95,0)
 ;
"RTN","LA7VOBXA",96,0)
 ;
"RTN","LA7VOBXA",97,0)
OBX5 ; Build OBX-5 sequence - Observation value
"RTN","LA7VOBXA",98,0)
 ; Removes trailing spaces on string and text results.
"RTN","LA7VOBXA",99,0)
 ; Removes leading & trailing spaces on numeric results.
"RTN","LA7VOBXA",100,0)
 ;
"RTN","LA7VOBXA",101,0)
 S LA7Y=""
"RTN","LA7VOBXA",102,0)
 ;
"RTN","LA7VOBXA",103,0)
 I $G(LA7OBX2)="" S LA7OBX2="ST" ; default value type
"RTN","LA7VOBXA",104,0)
 I LA7OBX2="ST"!(LA7OBX2="TX") D
"RTN","LA7VOBXA",105,0)
 . S LA7VAL=$$TRIM^XLFSTR(LA7VAL,"R"," ")
"RTN","LA7VOBXA",106,0)
 . S LA7Y=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VOBXA",107,0)
 I LA7OBX2="NM" S LA7Y=$$TRIM^XLFSTR(LA7VAL,"RL"," ")
"RTN","LA7VOBXA",108,0)
 I LA7OBX2="TS" D
"RTN","LA7VOBXA",109,0)
 . S LA7VAL=$$CHKDT^LA7VHLU1(LA7VAL)
"RTN","LA7VOBXA",110,0)
 . S LA7Y=$$FMTHL7^XLFDT(LA7VAL)
"RTN","LA7VOBXA",111,0)
 I LA7OBX2?1(1"CE",1"CNE",1"CWE") D
"RTN","LA7VOBXA",112,0)
 . N LA7I,LA7J,X
"RTN","LA7VOBXA",113,0)
 . S LA7J=$S(LA7OBX2="CE":6,1:9)
"RTN","LA7VOBXA",114,0)
 . F LA7I=1:1:LA7J I $P(LA7VAL,"^",LA7I)'="" S $P(LA7Y,$E(LA7ECH),LA7I)=$$CHKDATA^LA7VHLU3($P(LA7VAL,"^",LA7I),LA7FS_LA7ECH)
"RTN","LA7VOBXA",115,0)
 ;
"RTN","LA7VOBXA",116,0)
 Q
"RTN","LA7VOBXA",117,0)
 ;
"RTN","LA7VOBXA",118,0)
 ;
"RTN","LA7VOBXA",119,0)
OBX5M ; Build OBX-5 sequence - Observation value - multi-line textual result
"RTN","LA7VOBXA",120,0)
 ;
"RTN","LA7VOBXA",121,0)
 K LA7WP
"RTN","LA7VOBXA",122,0)
 ;
"RTN","LA7VOBXA",123,0)
 S LA7WP=""
"RTN","LA7VOBXA",124,0)
 S LA7TYPE=$$GET1^DID(LA7FN,LA7FLD,"","TYPE","LA7ERR(1)")
"RTN","LA7VOBXA",125,0)
 ;
"RTN","LA7VOBXA",126,0)
 ; Process word-processing type field.
"RTN","LA7VOBXA",127,0)
 ; Check and encode data
"RTN","LA7VOBXA",128,0)
 I LA7TYPE="WORD-PROCESSING" D  Q
"RTN","LA7VOBXA",129,0)
 . N DIWF,DIWL,DIWR,X
"RTN","LA7VOBXA",130,0)
 . S LA7WP=$$GET1^DIQ(LA7FN,LA7IENS,LA7FLD,"","LA7WP","LA7ERR(2)")
"RTN","LA7VOBXA",131,0)
 . K ^UTILITY($J,"W")
"RTN","LA7VOBXA",132,0)
 . S DIWL=1,DIWR=245,DIWF="",LA7I=0
"RTN","LA7VOBXA",133,0)
 . I $$GET1^DID(+$$GET1^DID(LA7FN,LA7FLD,"","SPECIFIER","LA7ERR(1)"),.01,"","SPECIFIER","LA7ERR(3)")["L" S DIWF="N"
"RTN","LA7VOBXA",134,0)
 . F  S LA7I=$O(LA7WP(LA7I)) Q:'LA7I  S X=LA7WP(LA7I) D ^DIWP
"RTN","LA7VOBXA",135,0)
 . K LA7WP
"RTN","LA7VOBXA",136,0)
 . S LA7I=0
"RTN","LA7VOBXA",137,0)
 . F  S LA7I=$O(^UTILITY($J,"W",DIWL,LA7I)) Q:'LA7I  D
"RTN","LA7VOBXA",138,0)
 . . S LA7WP(LA7I)=$$CHKDATA^LA7VHLU3(^UTILITY($J,"W",DIWL,LA7I,0),LA7FS_LA7ECH)
"RTN","LA7VOBXA",139,0)
 . . I LA7I>1 S LA7WP(LA7I)=$E(LA7ECH,3)_".br"_$E(LA7ECH,3)_LA7WP(LA7I)
"RTN","LA7VOBXA",140,0)
 . K ^UTILITY($J,"W")
"RTN","LA7VOBXA",141,0)
 ;
"RTN","LA7VOBXA",142,0)
 ; Free text, assumes multiple valued
"RTN","LA7VOBXA",143,0)
 I LA7TYPE="FREE TEXT" D
"RTN","LA7VOBXA",144,0)
 . D GETS^DIQ(LA7FN,LA7IENS,LA7FLD_"*","","LA7WP","LA7ERR")
"RTN","LA7VOBXA",145,0)
 ;
"RTN","LA7VOBXA",146,0)
 Q
"RTN","LA7VOBXA",147,0)
 ;
"RTN","LA7VOBXA",148,0)
 ;
"RTN","LA7VOBXA",149,0)
OBX5R ; Build OBX-5 sequence with repetition - Observation value
"RTN","LA7VOBXA",150,0)
 ;
"RTN","LA7VOBXA",151,0)
 S (LA7I,LA7Y)=""
"RTN","LA7VOBXA",152,0)
 F  S LA7I=$O(LA7VAL(LA7I)) Q:'LA7I  D
"RTN","LA7VOBXA",153,0)
 . S LA7Y=LA7Y_$$OBX5^LA7VOBX(LA7VAL(LA7I),LA7OBX2,LA7FS,LA7ECH)_$E(LA7ECH,2)
"RTN","LA7VOBXA",154,0)
 ;
"RTN","LA7VOBXA",155,0)
 Q
"RTN","LA7VOBXA",156,0)
 ;
"RTN","LA7VOBXA",157,0)
 ;
"RTN","LA7VOBXA",158,0)
OBX6 ; Build OBX-6 sequence - Units
"RTN","LA7VOBXA",159,0)
 ;
"RTN","LA7VOBXA",160,0)
 S LA7ECH=$G(LA7ECH),LA7Y=""
"RTN","LA7VOBXA",161,0)
 ;
"RTN","LA7VOBXA",162,0)
 ; Units - remove leading and trailing spaces
"RTN","LA7VOBXA",163,0)
 ; If HDR interface (LA7INTYP=30) then add coding system (L) to units.
"RTN","LA7VOBXA",164,0)
 I $G(LA7VAL)'="" D
"RTN","LA7VOBXA",165,0)
 . S LA7Y=$$TRIM^XLFSTR(LA7VAL,"LR"," ")
"RTN","LA7VOBXA",166,0)
 . I $G(LA7INTYP)=30 D
"RTN","LA7VOBXA",167,0)
 . . S $P(LA7Y,$E(LA7ECH,1),2)=LA7Y
"RTN","LA7VOBXA",168,0)
 . . S $P(LA7Y,$E(LA7ECH,1),3)="L"
"RTN","LA7VOBXA",169,0)
 ;
"RTN","LA7VOBXA",170,0)
 ; Build sequence using LOINC codes only
"RTN","LA7VOBXA",171,0)
 ; LOINC code/code name/"LN"
"RTN","LA7VOBXA",172,0)
 I $G(LA764061) D
"RTN","LA7VOBXA",173,0)
 . N LA7IENS,LA7X,LA7Z
"RTN","LA7VOBXA",174,0)
 . S LA7IENS=LA764061_","
"RTN","LA7VOBXA",175,0)
 . D GETS^DIQ(64.061,LA7IENS,"1;8","E","LA7X")
"RTN","LA7VOBXA",176,0)
 . ; LOINC code
"RTN","LA7VOBXA",177,0)
 . S LA7Z=$G(LA7X(64.061,LA7IENS,1,"E"))
"RTN","LA7VOBXA",178,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",179,0)
 . S $P(LA7Y,$E(LA7ECH,1),1)=LA7Z
"RTN","LA7VOBXA",180,0)
 . ; LOINC code name
"RTN","LA7VOBXA",181,0)
 . S LA7Z=$G(LA7X(64.061,LA7IENS,8,"E"))
"RTN","LA7VOBXA",182,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",183,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=LA7Z
"RTN","LA7VOBXA",184,0)
 . S $P(LA7Y,$E(LA7ECH,1),3)="LN"
"RTN","LA7VOBXA",185,0)
 ;
"RTN","LA7VOBXA",186,0)
 Q
"RTN","LA7VOBXA",187,0)
 ;
"RTN","LA7VOBXA",188,0)
 ;
"RTN","LA7VOBXA",189,0)
OBX7 ; Build OBX-7 sequence - Reference range
"RTN","LA7VOBXA",190,0)
 ; Removes leading and trailing quote marks ("").
"RTN","LA7VOBXA",191,0)
 ;
"RTN","LA7VOBXA",192,0)
 S LA7Y=""
"RTN","LA7VOBXA",193,0)
 ;
"RTN","LA7VOBXA",194,0)
 I $G(LA7LOW)'="" D
"RTN","LA7VOBXA",195,0)
 . S LA7LOW=$$TRIM^XLFSTR(LA7LOW,"RL","""")
"RTN","LA7VOBXA",196,0)
 . I LA7LOW?1A.E S LA7Y=LA7Y_LA7LOW Q  ; alphabetic value
"RTN","LA7VOBXA",197,0)
 . I $G(LA7HIGH)="",$E(LA7LOW)'=">" S LA7Y=">"
"RTN","LA7VOBXA",198,0)
 . S LA7Y=LA7Y_LA7LOW
"RTN","LA7VOBXA",199,0)
 ;
"RTN","LA7VOBXA",200,0)
 I $G(LA7HIGH)'="" D
"RTN","LA7VOBXA",201,0)
 . S LA7HIGH=$$TRIM^XLFSTR(LA7HIGH,"RL","""")
"RTN","LA7VOBXA",202,0)
 . I LA7HIGH?1A.E S LA7Y=LA7Y_LA7HIGH Q  ; alphabetic value
"RTN","LA7VOBXA",203,0)
 . I $G(LA7LOW)="" D  Q
"RTN","LA7VOBXA",204,0)
 . . I $E(LA7HIGH)'="<" S LA7Y="<"
"RTN","LA7VOBXA",205,0)
 . . S LA7Y=LA7Y_LA7HIGH
"RTN","LA7VOBXA",206,0)
 . S LA7Y=LA7Y_"-"_LA7HIGH
"RTN","LA7VOBXA",207,0)
 ;
"RTN","LA7VOBXA",208,0)
 S LA7Y=$$CHKDATA^LA7VHLU3(LA7Y,LA7FS_LA7ECH)
"RTN","LA7VOBXA",209,0)
 ;
"RTN","LA7VOBXA",210,0)
 Q
"RTN","LA7VOBXA",211,0)
 ;
"RTN","LA7VOBXA",212,0)
 ;
"RTN","LA7VOBXA",213,0)
OBX17 ; Build OBX-17 sequence - Observation method field
"RTN","LA7VOBXA",214,0)
 ;
"RTN","LA7VOBXA",215,0)
 ; method suffix code maybe stored without leading decimal,
"RTN","LA7VOBXA",216,0)
 ;  add "." back for lookup, also add trailing space for lookup in x-ref.
"RTN","LA7VOBXA",217,0)
 I LA7VAL>1 S LA7VAL="."_LA7VAL
"RTN","LA7VOBXA",218,0)
 S LA7X=$O(^LAB(64.2,"C",LA7VAL_" ",0)),LA7Y=""
"RTN","LA7VOBXA",219,0)
 I LA7X D
"RTN","LA7VOBXA",220,0)
 . S LA7X(.01)=$P($G(^LAB(64.2,LA7X,0)),"^")
"RTN","LA7VOBXA",221,0)
 . S LA7X(.01)=$$CHKDATA^LA7VHLU3(LA7X(.01),LA7FS_LA7ECH)
"RTN","LA7VOBXA",222,0)
 . S LA7Y=LA7VAL_$E(LA7ECH)_LA7X(.01)_$E(LA7ECH)_"99VA64.2"
"RTN","LA7VOBXA",223,0)
 . ;S LA7X=$$GET1^DID(64.2,"","","PACKAGE REVISION DATA")
"RTN","LA7VOBXA",224,0)
 . ;S $P(LA7Y,$E(LA7ECH,1),7)=LA7X
"RTN","LA7VOBXA",225,0)
 ;
"RTN","LA7VOBXA",226,0)
 ; Send NLT result code
"RTN","LA7VOBXA",227,0)
 I LA7NLT'="" D
"RTN","LA7VOBXA",228,0)
 . S LA764=$O(^LAM("E",LA7NLT,0)),LA7Z=""
"RTN","LA7VOBXA",229,0)
 . I LA764 S LA7X=$P($G(^LAM(LA764,0)),"^")
"RTN","LA7VOBXA",230,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VOBXA",231,0)
 . S $P(LA7Z,$E(LA7ECH,1),1)=LA7NLT
"RTN","LA7VOBXA",232,0)
 . S $P(LA7Z,$E(LA7ECH,1),2)=LA7X
"RTN","LA7VOBXA",233,0)
 . S $P(LA7Z,$E(LA7ECH,1),3)="99VA64"
"RTN","LA7VOBXA",234,0)
 . ;S LA7X=$$GET1^DID(64,"","","PACKAGE REVISION DATA")
"RTN","LA7VOBXA",235,0)
 . ;S $P(LA7Z,$E(LA7ECH,1),7)=LA7X
"RTN","LA7VOBXA",236,0)
 . I LA7Y'="" S LA7Y=LA7Y_$E(LA7ECH,2)
"RTN","LA7VOBXA",237,0)
 . S LA7Y=LA7Y_LA7Z
"RTN","LA7VOBXA",238,0)
 ;
"RTN","LA7VOBXA",239,0)
 Q
"RTN","LA7VOBXA",240,0)
 ;
"RTN","LA7VOBXA",241,0)
 ;
"RTN","LA7VOBXA",242,0)
OBX18 ; Build OBX-18 sequence - Equipment entity identifier field
"RTN","LA7VOBXA",243,0)
 ;
"RTN","LA7VOBXA",244,0)
 S LA7X="",LA7J=$L(LA7VAL,"!")
"RTN","LA7VOBXA",245,0)
 F LA7I=1:1:LA7J D
"RTN","LA7VOBXA",246,0)
 . S LA7Y=$P(LA7VAL,"!",LA7I)
"RTN","LA7VOBXA",247,0)
 . I LA7Y="" Q
"RTN","LA7VOBXA",248,0)
 . S $P(LA7X,$E(LA7ECH,1),LA7I)=$$CHKDATA^LA7VHLU3(LA7Y,LA7FS_LA7ECH)
"RTN","LA7VOBXA",249,0)
 ;
"RTN","LA7VOBXA",250,0)
 Q
"RTN","LA7VORC")
0^20^B18625097^B8007778
"RTN","LA7VORC",1,0)
LA7VORC ;DALOI/JMC - LAB ORC Segment message builder ;Aug 27, 2007
"RTN","LA7VORC",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VORC",3,0)
 ;
"RTN","LA7VORC",4,0)
 Q
"RTN","LA7VORC",5,0)
 ;
"RTN","LA7VORC",6,0)
ORC1(LA7TYP) ; Build ORC-1 sequence - Order control
"RTN","LA7VORC",7,0)
 ; Call with LA7TYP = order type from table 0119
"RTN","LA7VORC",8,0)
 ;
"RTN","LA7VORC",9,0)
 Q LA7TYP
"RTN","LA7VORC",10,0)
 ;
"RTN","LA7VORC",11,0)
 ;
"RTN","LA7VORC",12,0)
ORC2(LA7VAL,LA7FS,LA7ECH) ; Build ORC-2 sequence - Placer order number
"RTN","LA7VORC",13,0)
 ; Call with  LA7VAL = accession number/UID
"RTN","LA7VORC",14,0)
 ;            LA7VAL("NMSP") = application namespace (optional)
"RTN","LA7VORC",15,0)
 ;            LA7VAL("SITE") = placer facility
"RTN","LA7VORC",16,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",17,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",18,0)
 ;            
"RTN","LA7VORC",19,0)
 N LAXY,LA7Y
"RTN","LA7VORC",20,0)
 ;
"RTN","LA7VORC",21,0)
 S $P(LA7Y,$E(LA7ECH),1)=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VORC",22,0)
 I $G(LA7VAL("NMSP"))'="" S $P(LA7Y,$E(LA7ECH),2)=LA7VAL("NMSP")
"RTN","LA7VORC",23,0)
 I $G(LA7VAL("SITE"))'="" D
"RTN","LA7VORC",24,0)
 . S LA7X=$$FACDNS^LA7VHLU2(LA7VAL("SITE"),LA7FS,LA7ECH,1)
"RTN","LA7VORC",25,0)
 . S $P(LA7Y,$E(LA7ECH),3)=$P(LA7X,$E(LA7ECH),2)
"RTN","LA7VORC",26,0)
 . S $P(LA7Y,$E(LA7ECH),4)=$P(LA7X,$E(LA7ECH),3)
"RTN","LA7VORC",27,0)
 Q LA7Y
"RTN","LA7VORC",28,0)
 ;
"RTN","LA7VORC",29,0)
 ;
"RTN","LA7VORC",30,0)
ORC3(LA7VAL,LA7FS,LA7ECH) ; Build ORC-3 sequence - Filler order number
"RTN","LA7VORC",31,0)
 ; Call with  LA7VAL = accession number/UID
"RTN","LA7VORC",32,0)
 ;            LA7VAL("NMSP") = application namespace (optional)
"RTN","LA7VORC",33,0)
 ;            LA7VAL("SITE") = placer facility
"RTN","LA7VORC",34,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",35,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",36,0)
 ;            
"RTN","LA7VORC",37,0)
 N LA7X,LA7Y
"RTN","LA7VORC",38,0)
 ;
"RTN","LA7VORC",39,0)
 S $P(LA7Y,$E(LA7ECH),1)=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VORC",40,0)
 I $G(LA7VAL("NMSP"))'="" S $P(LA7Y,$E(LA7ECH),2)=LA7VAL("NMSP")
"RTN","LA7VORC",41,0)
 I $G(LA7VAL("SITE"))'="" D
"RTN","LA7VORC",42,0)
 . S LA7X=$$FACDNS^LA7VHLU2(LA7VAL("SITE"),LA7FS,LA7ECH,1)
"RTN","LA7VORC",43,0)
 . S $P(LA7Y,$E(LA7ECH),3)=$P(LA7X,$E(LA7ECH),2)
"RTN","LA7VORC",44,0)
 . S $P(LA7Y,$E(LA7ECH),4)=$P(LA7X,$E(LA7ECH),3)
"RTN","LA7VORC",45,0)
 ;
"RTN","LA7VORC",46,0)
 Q LA7Y
"RTN","LA7VORC",47,0)
 ;
"RTN","LA7VORC",48,0)
 ;
"RTN","LA7VORC",49,0)
ORC4(LA7VAL,LA7FS,LA7ECH) ; Build ORC-4 sequence - Placer group number
"RTN","LA7VORC",50,0)
 ; Call with  LA7VAL = LEDI - shipping manifest number
"RTN","LA7VORC",51,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",52,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",53,0)
 ; Returns ORD-4 sequence
"RTN","LA7VORC",54,0)
 ;
"RTN","LA7VORC",55,0)
 N LA7Y
"RTN","LA7VORC",56,0)
 ;
"RTN","LA7VORC",57,0)
 S $P(LA7Y,$E(LA7ECH),1)=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VORC",58,0)
 ;
"RTN","LA7VORC",59,0)
 Q LA7Y
"RTN","LA7VORC",60,0)
 ;
"RTN","LA7VORC",61,0)
 ;
"RTN","LA7VORC",62,0)
ORC5(LA7VAL,LA7FS,LA7ECH) ; Build ORC-5 sequence - Order status
"RTN","LA7VORC",63,0)
 ; Call with  LA7VAL = order status
"RTN","LA7VORC",64,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",65,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",66,0)
 ; Returns ORC-5 sequence
"RTN","LA7VORC",67,0)
 ;
"RTN","LA7VORC",68,0)
 N LA7Y
"RTN","LA7VORC",69,0)
 ;
"RTN","LA7VORC",70,0)
 I LA7VAL="CM" S LA7Y="CM"
"RTN","LA7VORC",71,0)
 ;
"RTN","LA7VORC",72,0)
 Q LA7Y
"RTN","LA7VORC",73,0)
 ;
"RTN","LA7VORC",74,0)
 ;
"RTN","LA7VORC",75,0)
ORC7(LA7DUR,LA7DURU,LA76205,LA7FS,LA7ECH) ; Build ORC-7 sequence - Quantity/Timing
"RTN","LA7VORC",76,0)
 ; Call with  LA7DUR = collection duration
"RTN","LA7VORC",77,0)
 ;           LA7DURU = duration units (pointer to #64.061)
"RTN","LA7VORC",78,0)
 ;           LA76205 = test urgency
"RTN","LA7VORC",79,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",80,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",81,0)
 ;
"RTN","LA7VORC",82,0)
 ; Returns ORC-7 sequence
"RTN","LA7VORC",83,0)
 ;
"RTN","LA7VORC",84,0)
 N LA7X,LA7Y
"RTN","LA7VORC",85,0)
 S LA7Y=""
"RTN","LA7VORC",86,0)
 ;
"RTN","LA7VORC",87,0)
 I LA7DUR'="",LA7DURU D
"RTN","LA7VORC",88,0)
 . S LA7X=$$GET1^DIQ(64.061,LA7DURU_",",2) ; duration units
"RTN","LA7VORC",89,0)
 . S $P(LA7Y,$E(LA7ECH,1),3)=$$CHKDATA^LA7VHLU3(LA7X_LA7DUR,LA7FS_LA7ECH)
"RTN","LA7VORC",90,0)
 ;
"RTN","LA7VORC",91,0)
 I LA76205 D
"RTN","LA7VORC",92,0)
 . S LA7X=$$GET1^DIQ(64.061,+$$GET1^DIQ(62.05,LA76205_",",4,"I")_",",2) ; Urgency
"RTN","LA7VORC",93,0)
 . S $P(LA7Y,$E(LA7ECH,1),6)=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VORC",94,0)
 ;
"RTN","LA7VORC",95,0)
 Q LA7Y
"RTN","LA7VORC",96,0)
 ;
"RTN","LA7VORC",97,0)
 ;
"RTN","LA7VORC",98,0)
ORC9(LA7DT) ; Build ORC-9 sequence - date/time of transaction
"RTN","LA7VORC",99,0)
 ; Call with LA7DT = order date/time
"RTN","LA7VORC",100,0)
 ;
"RTN","LA7VORC",101,0)
 ; Returns ORC-9 sequence
"RTN","LA7VORC",102,0)
 ;
"RTN","LA7VORC",103,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VORC",104,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VORC",105,0)
 ;
"RTN","LA7VORC",106,0)
 ;
"RTN","LA7VORC",107,0)
ORC12(LA7DUZ,LA7DIV,LA7FS,LA7ECH,LA7IDTYP) ; Build ORC-12 sequence - Ordering provider
"RTN","LA7VORC",108,0)
 ; Call with   LA7DUZ = DUZ of ordering provider
"RTN","LA7VORC",109,0)
 ;             LA7DIV = Facility (division) of provider
"RTN","LA7VORC",110,0)
 ;              LA7FS = HL field separator
"RTN","LA7VORC",111,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VORC",112,0)
 ;           LA7IDTYP = id type to return (0:DUZ 1:VPID 2:NPI)
"RTN","LA7VORC",113,0)
 ;           
"RTN","LA7VORC",114,0)
 ; Returns ORC-12 sequence
"RTN","LA7VORC",115,0)
 ; Also used to build OBR-16 sequence
"RTN","LA7VORC",116,0)
 ;
"RTN","LA7VORC",117,0)
 S LA7IDTYP=+$G(LA7IDTYP)
"RTN","LA7VORC",118,0)
 Q $$XCN^LA7VHLU9(LA7DUZ,LA7DIV,LA7FS,LA7ECH,0,LA7IDTYP)
"RTN","LA7VORC",119,0)
 ;
"RTN","LA7VORC",120,0)
 ;
"RTN","LA7VORC",121,0)
ORC13(LA7J,LA7FS,LA7ECH) ; Build ORC-13 sequence - Enterer's location
"RTN","LA7VORC",122,0)
 ; Call with  LA7J = variable pointer to file #4 or #44
"RTN","LA7VORC",123,0)
 ;           LA7FS = HL field separator
"RTN","LA7VORC",124,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VORC",125,0)
 ;
"RTN","LA7VORC",126,0)
 ; Returns ORC-13 sequence
"RTN","LA7VORC",127,0)
 ;
"RTN","LA7VORC",128,0)
 N LA74,LA744,LA7X,LA7Y,LA7Z
"RTN","LA7VORC",129,0)
 ;
"RTN","LA7VORC",130,0)
 S (LA74,LA744,LA7Y)=""
"RTN","LA7VORC",131,0)
 ;
"RTN","LA7VORC",132,0)
 ; Pointer to file #44
"RTN","LA7VORC",133,0)
 I $P(LA7J,";",2)="SC(" D
"RTN","LA7VORC",134,0)
 . S LA744=$P(LA7J,";")
"RTN","LA7VORC",135,0)
 . S LA74=$$GET1^DIQ(44,LA744_",",3,"I")
"RTN","LA7VORC",136,0)
 ;
"RTN","LA7VORC",137,0)
 ; Pointer to file #4
"RTN","LA7VORC",138,0)
 I $P(LA7J,";",2)="DIC(4," S LA74=$P(LA7J,";")
"RTN","LA7VORC",139,0)
 ;
"RTN","LA7VORC",140,0)
 ; Build 1st component (point of care), 6th component (person location type)
"RTN","LA7VORC",141,0)
 I LA744 D
"RTN","LA7VORC",142,0)
 . S LA7Z=$$GET1^DIQ(44,LA744_",",.01)
"RTN","LA7VORC",143,0)
 . S $P(LA7Y,$E(LA7ECH,1),1)=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VORC",144,0)
 . S LA7Z=$$GET1^DIQ(44,LA744_",",2,"I")
"RTN","LA7VORC",145,0)
 . S $P(LA7Y,$E(LA7ECH,1),6)=$S(LA7Z="C":"C",LA7Z="W":"N",1:"D")
"RTN","LA7VORC",146,0)
 ;
"RTN","LA7VORC",147,0)
 ; Build 4th component (facility), demote delimiter from component to sub-component
"RTN","LA7VORC",148,0)
 I LA74 D
"RTN","LA7VORC",149,0)
 . S LA7Z=$$FACDNS^LA7VHLU2(LA74,LA7FS,LA7ECH,2)
"RTN","LA7VORC",150,0)
 . I $P(LA7Z,$E(LA7ECH,4),2)'="" S $P(LA7Y,$E(LA7ECH,1),4)=LA7Z Q
"RTN","LA7VORC",151,0)
 . S LA7Z=$$INST^LA7VHLU4(LA74,LA7FS,LA7ECH)
"RTN","LA7VORC",152,0)
 . I $P(LA7Z,$E(LA7ECH,1),3)="99VA4" S $P(LA7Z,$E(LA7ECH,1),3)="L"
"RTN","LA7VORC",153,0)
 . S $P(LA7Y,$E(LA7ECH,1),4)=$TR(LA7Z,$E(LA7ECH,1),$E(LA7ECH,4))
"RTN","LA7VORC",154,0)
 ;
"RTN","LA7VORC",155,0)
 Q LA7Y
"RTN","LA7VORC",156,0)
 ;
"RTN","LA7VORC",157,0)
 ;
"RTN","LA7VORC",158,0)
ORC17(LA74,LA7FS,LA7ECH) ; Build ORC-17 sequence - Entering organization
"RTN","LA7VORC",159,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VORC",160,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VORC",161,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",162,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",163,0)
 ;
"RTN","LA7VORC",164,0)
 ; Returns ORC-17 sequence (ID^text^99VA4)
"RTN","LA7VORC",165,0)
 ;
"RTN","LA7VORC",166,0)
 Q $$INST^LA7VHLU4(LA74,LA7FS,LA7ECH)
"RTN","LA7VORC",167,0)
 ;
"RTN","LA7VORC",168,0)
 ;
"RTN","LA7VORC",169,0)
ORC21(LA74,LA7FS,LA7ECH) ; Build ORC-21 sequence - Ordering facility name
"RTN","LA7VORC",170,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VORC",171,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",172,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",173,0)
 ;
"RTN","LA7VORC",174,0)
 ; Returns ORC-21 sequence
"RTN","LA7VORC",175,0)
 ;
"RTN","LA7VORC",176,0)
 Q $$XON^LA7VHLU4(4,LA74,0,LA7FS,LA7ECH)
"RTN","LA7VORC",177,0)
 ;
"RTN","LA7VORC",178,0)
 ;
"RTN","LA7VORC",179,0)
ORC22(LA74,LA7DT,LA7FS,LA7ECH) ; Build ORC-22 sequence - Ordering facility address
"RTN","LA7VORC",180,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VORC",181,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VORC",182,0)
 ;            LA7DT = "as of" date in FileMan format
"RTN","LA7VORC",183,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",184,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",185,0)
 ;
"RTN","LA7VORC",186,0)
 ; Returns ORC-22 sequence
"RTN","LA7VORC",187,0)
 ;
"RTN","LA7VORC",188,0)
 Q $$XAD^LA7VHLU4(4,LA74,LA7DT,LA7FS,LA7ECH)
"RTN","LA7VORC",189,0)
 ;
"RTN","LA7VORC",190,0)
 ;
"RTN","LA7VORC",191,0)
ORC23(LA74,LA7DT,LA7FS,LA7ECH) ; Build ORC-23 sequence - Ordering facility phone number
"RTN","LA7VORC",192,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VORC",193,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VORC",194,0)
 ;            LA7DT = "as of" date in FileMan format
"RTN","LA7VORC",195,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",196,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",197,0)
 ;
"RTN","LA7VORC",198,0)
 ; Returns ORC-23 sequence
"RTN","LA7VORC",199,0)
 ;
"RTN","LA7VORC",200,0)
 N LA7Y
"RTN","LA7VORC",201,0)
 ;
"RTN","LA7VORC",202,0)
 S LA7Y=""
"RTN","LA7VORC",203,0)
 ;
"RTN","LA7VORC",204,0)
 Q LA7Y
"RTN","LA7VORC",205,0)
 ;
"RTN","LA7VORC",206,0)
 ;
"RTN","LA7VORC",207,0)
ORC24(LA7200,LA7DT,LA7FS,LA7ECH) ; Build ORC-24 sequence - Ordering provider address
"RTN","LA7VORC",208,0)
 ; Call with LA7200 = ien of provider in file #200
"RTN","LA7VORC",209,0)
 ;            LA7DT = "as of" date in FileMan format
"RTN","LA7VORC",210,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",211,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",212,0)
 ;
"RTN","LA7VORC",213,0)
 ; Returns ORC-24 sequence
"RTN","LA7VORC",214,0)
 ;
"RTN","LA7VORC",215,0)
 N LA7Y
"RTN","LA7VORC",216,0)
 ;
"RTN","LA7VORC",217,0)
 S LA7Y=""
"RTN","LA7VORC",218,0)
 ;
"RTN","LA7VORC",219,0)
 Q LA7Y
"RTN","LA7VORM1")
0^12^B57485485^B52156055
"RTN","LA7VORM1",1,0)
LA7VORM1 ;DALOI/DLR - LAB ORM (Order) message builder ;Aug 13, 2007
"RTN","LA7VORM1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,51,46,61,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VORM1",3,0)
 ;
"RTN","LA7VORM1",4,0)
BUILD(LA7628) ;
"RTN","LA7VORM1",5,0)
 ; Call with LA7628 = ien of entry in file #62.8 Shipping Manifest
"RTN","LA7VORM1",6,0)
 ;
"RTN","LA7VORM1",7,0)
 N LA7101,LA762801,LA7629,LA7NVAF,LA7PIDSN,LA7X,ECNT,GBL,SHP,SHPC,SITE,ORUID,NTST
"RTN","LA7VORM1",8,0)
 ;
"RTN","LA7VORM1",9,0)
 I $G(LA7628)<1!('$D(^LAHM(62.8,+$G(LA7628),0))) D  Q
"RTN","LA7VORM1",10,0)
 . ; Need to add error logging for manifest not found.
"RTN","LA7VORM1",11,0)
 . D EXIT
"RTN","LA7VORM1",12,0)
 ;
"RTN","LA7VORM1",13,0)
 S GBL="^TMP(""HLS"","_$J_")",ECNT=1
"RTN","LA7VORM1",14,0)
 S LA7628(0)=$G(^LAHM(62.8,LA7628,0))
"RTN","LA7VORM1",15,0)
 S LA7629=$P(LA7628(0),U,2)
"RTN","LA7VORM1",16,0)
 S LA7629(0)=$G(^LAHM(62.9,LA7629,0))
"RTN","LA7VORM1",17,0)
 S LA76248=+$P(LA7629(0),"^",7)
"RTN","LA7VORM1",18,0)
 S LA76248(0)=$G(^LAHM(62.48,LA76248,0))
"RTN","LA7VORM1",19,0)
 I '$P(LA76248(0),"^",3) D EXIT Q  ; not active
"RTN","LA7VORM1",20,0)
 ;
"RTN","LA7VORM1",21,0)
 S LA7V("INST")=$P(LA7629(0),U,11)
"RTN","LA7VORM1",22,0)
 Q:LA7V("INST")=$P(LA7629(0),U,6)  ;Same system shipment
"RTN","LA7VORM1",23,0)
 ;
"RTN","LA7VORM1",24,0)
 S LA7NVAF=$$NVAF^LA7VHLU2(+LA7V("INST")),SITE=""
"RTN","LA7VORM1",25,0)
 I LA7NVAF=0 S SITE=$$STA^XUAF4(+$P(LA7629(0),U,11))
"RTN","LA7VORM1",26,0)
 I LA7NVAF=1 S SITE=$$ID^XUAF4("DMIS",+$P(LA7629(0),U,11))
"RTN","LA7VORM1",27,0)
 S LA7V("NON")=$P(LA7629(0),U,12)
"RTN","LA7VORM1",28,0)
 I LA7V("NON")'="" S SITE=LA7V("NON")
"RTN","LA7VORM1",29,0)
 ;
"RTN","LA7VORM1",30,0)
 S LA7X=$$NVAF^LA7VHLU2(+$P(LA7629(0),U,2))
"RTN","LA7VORM1",31,0)
 I LA7X=0 S LA7V("CLNT")=$$STA^XUAF4(+$P(LA7629(0),U,2))
"RTN","LA7VORM1",32,0)
 I LA7X=1 S LA7V("CLNT")=$$ID^XUAF4("DMIS",+$P(LA7629(0),U,2))
"RTN","LA7VORM1",33,0)
 S $P(LA7V("CLNT"),U,2)=$P($$NS^XUAF4(+$P(LA7629(0),U,2)),"^")
"RTN","LA7VORM1",34,0)
 ;
"RTN","LA7VORM1",35,0)
 S LA7X=$$NVAF^LA7VHLU2(+$P(LA7629(0),U,3))
"RTN","LA7VORM1",36,0)
 I LA7X=0 S LA7V("HOST")=$$STA^XUAF4(+$P(LA7629(0),U,3))
"RTN","LA7VORM1",37,0)
 I LA7X=1 S LA7V("HOST")=$$ID^XUAF4("DMIS",+$P(LA7629(0),U,3))
"RTN","LA7VORM1",38,0)
 S $P(LA7V("HOST"),U,2)=$P($$NS^XUAF4(+$P(LA7629(0),U,3)),"^")
"RTN","LA7VORM1",39,0)
 ;
"RTN","LA7VORM1",40,0)
 ; Assuming the receiving institution is the primary site (site with the computer system)
"RTN","LA7VORM1",41,0)
 ;
"RTN","LA7VORM1",42,0)
 ; Sort tests by patient,UID,test - only need to build one PID, PV1 per patient
"RTN","LA7VORM1",43,0)
 ; ^TMP("LA7628",$J, LRDFN, accession UID, ien of shipping manifest specimen entry)
"RTN","LA7VORM1",44,0)
 K ^TMP("LA7628",$J)
"RTN","LA7VORM1",45,0)
 S LA762801=0
"RTN","LA7VORM1",46,0)
 F  S LA762801=$O(^LAHM(62.8,LA7628,10,LA762801)) Q:'LA762801  D
"RTN","LA7VORM1",47,0)
 . S X(0)=$G(^LAHM(62.8,LA7628,10,LA762801,0))
"RTN","LA7VORM1",48,0)
 . I $P(X(0),"^",8)=0 Q  ; Removed from manifest
"RTN","LA7VORM1",49,0)
 . I $P(X(0),"^"),$P(X(0),"^",5)'="" S ^TMP("LA7628",$J,+$P(X(0),"^"),$P(X(0),"^",5),LA762801)=""
"RTN","LA7VORM1",50,0)
 K LA762801
"RTN","LA7VORM1",51,0)
 ;
"RTN","LA7VORM1",52,0)
 ; Nothing to send
"RTN","LA7VORM1",53,0)
 I '$D(^TMP("LA7628",$J)) D EXIT Q
"RTN","LA7VORM1",54,0)
 ;
"RTN","LA7VORM1",55,0)
 ; Set flag = 0 (multiple PID's/message - build one message)
"RTN","LA7VORM1",56,0)
 ;            1 (one PID/message - build multiple messages)
"RTN","LA7VORM1",57,0)
 ;            2 (one ORC/message - build multiple messages)
"RTN","LA7VORM1",58,0)
 S LA7SMSG=+$P(LA76248(0),"^",8)
"RTN","LA7VORM1",59,0)
 ;
"RTN","LA7VORM1",60,0)
 I LA7SMSG=0 D  Q:$G(HL)
"RTN","LA7VORM1",61,0)
 . D STARTMSG
"RTN","LA7VORM1",62,0)
 . I $G(HL) D EXIT
"RTN","LA7VORM1",63,0)
 ;
"RTN","LA7VORM1",64,0)
 S (LRDFN,LRI,LA7PIDSN)=0
"RTN","LA7VORM1",65,0)
 F  S LRDFN=$O(^TMP("LA7628",$J,LRDFN)) Q:'LRDFN  D  Q:$G(HL)
"RTN","LA7VORM1",66,0)
 . N LA7PID,LA7PV1
"RTN","LA7VORM1",67,0)
 . I LA7SMSG=1 D STARTMSG Q:$G(HL)
"RTN","LA7VORM1",68,0)
 . I LA7SMSG<2 D PID,PV1
"RTN","LA7VORM1",69,0)
 . S LA7UID=""
"RTN","LA7VORM1",70,0)
 . F  S LA7UID=$O(^TMP("LA7628",$J,LRDFN,LA7UID)) Q:LA7UID=""  D
"RTN","LA7VORM1",71,0)
 . . N LA76802,LA7ORC,X
"RTN","LA7VORM1",72,0)
 . . S X=$Q(^LRO(68,"C",LA7UID))
"RTN","LA7VORM1",73,0)
 . . I $QS(X,3)'=LA7UID Q
"RTN","LA7VORM1",74,0)
 . . S LRAA=$QS(X,4),LRAD=$QS(X,5),LRAN=$QS(X,6)
"RTN","LA7VORM1",75,0)
 . . F I=0,.3,3 S LA76802(I)=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,I))
"RTN","LA7VORM1",76,0)
 . . S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,5,0))
"RTN","LA7VORM1",77,0)
 . . I I>0 S LA76802(5)=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,5,I,0))
"RTN","LA7VORM1",78,0)
 . . E  S LA76802(5)=""
"RTN","LA7VORM1",79,0)
 . . I LA7SMSG=2 D STARTMSG Q:$G(HL)  D PID,PV1
"RTN","LA7VORM1",80,0)
 . . S (LA7OBRSN,LA762801)=0
"RTN","LA7VORM1",81,0)
 . . F  S LA762801=$O(^TMP("LA7628",$J,LRDFN,LA7UID,LA762801)) Q:'LA762801  D
"RTN","LA7VORM1",82,0)
 . . . N LA7OBR,I
"RTN","LA7VORM1",83,0)
 . . . F I=0,.1,1,2,5 S LA762801(I)=$G(^LAHM(62.8,LA7628,10,LA762801,I))
"RTN","LA7VORM1",84,0)
 . . . I $$CHKTST^LA7SMU(LA7628,LA762801)'=0 Q  ;deleted accession
"RTN","LA7VORM1",85,0)
 . . . D ORC,OBR^LA7VORM3,OBX^LA7VORM3
"RTN","LA7VORM1",86,0)
 . . I LA7SMSG=2 D BLG,SENDMSG
"RTN","LA7VORM1",87,0)
 . I LA7SMSG<2 D BLG
"RTN","LA7VORM1",88,0)
 . I LA7SMSG=1 D SENDMSG
"RTN","LA7VORM1",89,0)
 ;
"RTN","LA7VORM1",90,0)
 I LA7SMSG=0 D SENDMSG
"RTN","LA7VORM1",91,0)
 ;
"RTN","LA7VORM1",92,0)
 ;
"RTN","LA7VORM1",93,0)
EXIT ;
"RTN","LA7VORM1",94,0)
 K @GBL,^TMP("LA7628",$J)
"RTN","LA7VORM1",95,0)
 K DIC,DFN,EID,HL,HLCOMP,HLFS,HLQ,HLSUB,INT
"RTN","LA7VORM1",96,0)
 K LA760,LA7628,LA762801,LA7629
"RTN","LA7VORM1",97,0)
 K LA7ECH,LA7FS,LA7MID,LA7V,LA7HDR,LA7OBRSN,LA7OBXSN,LA7VIEN,LAEVNT
"RTN","LA7VORM1",98,0)
 K LRAA,LRACC,LRAD,LRAN,LRDFN,LRI
"RTN","LA7VORM1",99,0)
 K LTST,NLT,NLTIEN,PCNT,RUID,SNIEN,TIEN,X,Y,LA
"RTN","LA7VORM1",100,0)
 D KVAR^LRX
"RTN","LA7VORM1",101,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","LA7VORM1",102,0)
 Q
"RTN","LA7VORM1",103,0)
 ;
"RTN","LA7VORM1",104,0)
 ;
"RTN","LA7VORM1",105,0)
STARTMSG ; Create/initialize HL message
"RTN","LA7VORM1",106,0)
 ;
"RTN","LA7VORM1",107,0)
 K @GBL
"RTN","LA7VORM1",108,0)
 S (LA76249,LA7PIDSN)=0
"RTN","LA7VORM1",109,0)
 D STARTMSG^LA7VHLU("LA7V Order to "_SITE,.LA76249)
"RTN","LA7VORM1",110,0)
 Q
"RTN","LA7VORM1",111,0)
 ;
"RTN","LA7VORM1",112,0)
 ;
"RTN","LA7VORM1",113,0)
SENDMSG ; File HL7 message with HL and LAB packages.
"RTN","LA7VORM1",114,0)
 ;
"RTN","LA7VORM1",115,0)
 N LA7DATA,LA7ID
"RTN","LA7VORM1",116,0)
 S LA7ID="LA7V HOST "_SITE_"-O-"_$P($G(LA7628(0)),"^")
"RTN","LA7VORM1",117,0)
 ; If no message to send then quit
"RTN","LA7VORM1",118,0)
 I '$D(^TMP("HLS",$J)) D  Q
"RTN","LA7VORM1",119,0)
 . N FDA,LA7ER
"RTN","LA7VORM1",120,0)
 . I $G(LA76248) S FDA(1,62.49,LA76249_",",.5)=LA76248
"RTN","LA7VORM1",121,0)
 . S FDA(1,62.49,LA76249_",",1)="O"
"RTN","LA7VORM1",122,0)
 . S FDA(1,62.49,LA76249_",",2)="E"
"RTN","LA7VORM1",123,0)
 . S FDA(1,62.49,LA76249_",",5)=LA7ID
"RTN","LA7VORM1",124,0)
 . D FILE^DIE("","FDA(1)","LA7ER(1)")
"RTN","LA7VORM1",125,0)
 . D CLEAN^DILF
"RTN","LA7VORM1",126,0)
 . L -^LAHM(62.49,LA76249)
"RTN","LA7VORM1",127,0)
 ;
"RTN","LA7VORM1",128,0)
 D GEN^LA7VHLU
"RTN","LA7VORM1",129,0)
 S LA7DATA="SM06"_"^"_$$NOW^XLFDT
"RTN","LA7VORM1",130,0)
 D SEUP^LA7SMU($P(LA7628(0),"^"),"1",LA7DATA)
"RTN","LA7VORM1",131,0)
 D UPDT6249
"RTN","LA7VORM1",132,0)
 ; Unlock entry
"RTN","LA7VORM1",133,0)
 L -^LAHM(62.49,LA76249)
"RTN","LA7VORM1",134,0)
 Q
"RTN","LA7VORM1",135,0)
 ;
"RTN","LA7VORM1",136,0)
 ;
"RTN","LA7VORM1",137,0)
UPDT6249 ; update entry in 62.49
"RTN","LA7VORM1",138,0)
 ;
"RTN","LA7VORM1",139,0)
 N FDA,LA7ER
"RTN","LA7VORM1",140,0)
 ;
"RTN","LA7VORM1",141,0)
 I $G(LA76248) S FDA(1,62.49,LA76249_",",.5)=LA76248
"RTN","LA7VORM1",142,0)
 S FDA(1,62.49,LA76249_",",1)="O"
"RTN","LA7VORM1",143,0)
 ;
"RTN","LA7VORM1",144,0)
 ; Check for acknowledgment type and set status accordingly.
"RTN","LA7VORM1",145,0)
 ; If no commit/application ack then original mode(application ack)
"RTN","LA7VORM1",146,0)
 ; Check for commit ack when HL package sends these to application.
"RTN","LA7VORM1",147,0)
 I $P(^LAHM(62.49,LA76249,0),"^",3)'="E" D
"RTN","LA7VORM1",148,0)
 . I $G(LA7ERR) S FDA(1,62.49,LA76249_",",2)="E" Q
"RTN","LA7VORM1",149,0)
 . I $G(HL("APAT"))="",$G(HL("ACAT"))="" S FDA(1,62.49,LA76249_",",2)="A" Q
"RTN","LA7VORM1",150,0)
 . I $G(HL("APAT"))="AL" S FDA(1,62.49,LA76249_",",2)="A"
"RTN","LA7VORM1",151,0)
 . E  S FDA(1,62.49,LA76249_",",2)="X"
"RTN","LA7VORM1",152,0)
 S FDA(1,62.49,LA76249_",",5)=LA7ID
"RTN","LA7VORM1",153,0)
 I $G(HL("SAN"))'="" S FDA(1,62.49,LA76249_",",102)=HL("SAN")
"RTN","LA7VORM1",154,0)
 I $G(HL("SAF"))'="" S FDA(1,62.49,LA76249_",",103)=HL("SAF")
"RTN","LA7VORM1",155,0)
 I $G(HL("MTN"))'="" S FDA(1,62.49,LA76249_",",108)=HL("MTN")
"RTN","LA7VORM1",156,0)
 I $G(HL("PID"))'="" S FDA(1,62.49,LA76249_",",110)=HL("PID")
"RTN","LA7VORM1",157,0)
 I $G(HL("VER"))'="" S FDA(1,62.49,LA76249_",",111)=HL("VER")
"RTN","LA7VORM1",158,0)
 I $P($G(LA7MID),"^")'="" S FDA(1,62.49,LA76249_",",109)=$P(LA7MID,"^")
"RTN","LA7VORM1",159,0)
 I $P($G(LA7MID),"^",2) D
"RTN","LA7VORM1",160,0)
 . S FDA(1,62.49,LA76249_",",160)=$P(LA7MID,"^",2)
"RTN","LA7VORM1",161,0)
 . S FDA(1,62.49,LA76249_",",161)=$P(LA7MID,"^",3)
"RTN","LA7VORM1",162,0)
 D FILE^DIE("","FDA(1)","LA7ER(1)")
"RTN","LA7VORM1",163,0)
 D CLEAN^DILF
"RTN","LA7VORM1",164,0)
 Q
"RTN","LA7VORM1",165,0)
 ;
"RTN","LA7VORM1",166,0)
 ;
"RTN","LA7VORM1",167,0)
PID ; Patient identification
"RTN","LA7VORM1",168,0)
 S LRDPF=$P(^LR(LRDFN,0),"^",2),DFN=$P(^(0),"^",3)
"RTN","LA7VORM1",169,0)
 D DEM^LRX
"RTN","LA7VORM1",170,0)
 D PID^LA7VPID(LRDFN,"",.LA7PID,.LA7PIDSN,.HL,"")
"RTN","LA7VORM1",171,0)
 ; DoD/CHCS facilities only use 1st repetition of PID-3.
"RTN","LA7VORM1",172,0)
 I LA7NVAF=1 D
"RTN","LA7VORM1",173,0)
 . S X=$P(LA7PID(0),LA7FS,4),X=$P(X,$E(LA7ECH,2))
"RTN","LA7VORM1",174,0)
 . S $P(LA7PID(0),LA7FS,4)=X
"RTN","LA7VORM1",175,0)
 D FILESEG^LA7VHLU(GBL,.LA7PID)
"RTN","LA7VORM1",176,0)
 D FILE6249^LA7VHLU(LA76249,.LA7PID)
"RTN","LA7VORM1",177,0)
 Q
"RTN","LA7VORM1",178,0)
 ;
"RTN","LA7VORM1",179,0)
 ;
"RTN","LA7VORM1",180,0)
PV1 ; Location information
"RTN","LA7VORM1",181,0)
 ; DoD/CHCS facilities do not use PV1 segment
"RTN","LA7VORM1",182,0)
 I LA7NVAF=1 Q
"RTN","LA7VORM1",183,0)
 ;
"RTN","LA7VORM1",184,0)
 D PV1^LA7VPID(LRDFN,.LA7PV1,LA7FS,LA7ECH)
"RTN","LA7VORM1",185,0)
 D FILESEG^LA7VHLU(GBL,.LA7PV1)
"RTN","LA7VORM1",186,0)
 D FILE6249^LA7VHLU(LA76249,.LA7PV1)
"RTN","LA7VORM1",187,0)
 Q
"RTN","LA7VORM1",188,0)
 ;
"RTN","LA7VORM1",189,0)
 ;
"RTN","LA7VORM1",190,0)
ORC ;Order Control
"RTN","LA7VORM1",191,0)
 ;
"RTN","LA7VORM1",192,0)
 N ORC,LA7DATA,LA7DUR,LA7DURU,LA76205,LA762801,LA7X
"RTN","LA7VORM1",193,0)
 ;
"RTN","LA7VORM1",194,0)
 S ORC(0)="ORC"
"RTN","LA7VORM1",195,0)
 S ORC(1)=$$ORC1^LA7VORC("NW")
"RTN","LA7VORM1",196,0)
 ;
"RTN","LA7VORM1",197,0)
 ; Place order number - accession UID
"RTN","LA7VORM1",198,0)
 S ORC(2)=$$ORC2^LA7VORC($P(LA76802(.3),"^"),LA7FS,LA7ECH)
"RTN","LA7VORM1",199,0)
 ;
"RTN","LA7VORM1",200,0)
 ; Placer group number - shipping manifest invoice #
"RTN","LA7VORM1",201,0)
 S ORC(4)=$$ORC4^LA7VORC($P(LA7628(0),"^"),LA7FS,LA7ECH)
"RTN","LA7VORM1",202,0)
 ;
"RTN","LA7VORM1",203,0)
 ; Quantity/Timing
"RTN","LA7VORM1",204,0)
 S (LA76205,LA7DUR,LA7DURU)=""
"RTN","LA7VORM1",205,0)
 S LA762801=0
"RTN","LA7VORM1",206,0)
 F  S LA762801=$O(^TMP("LA7628",$J,LRDFN,LA7UID,LA762801)) Q:'LA762801  D
"RTN","LA7VORM1",207,0)
 . N I,LA760
"RTN","LA7VORM1",208,0)
 . ; Test duration
"RTN","LA7VORM1",209,0)
 . F I=0,2 S LA762801(I)=$G(^LAHM(62.8,LA7628,10,LA762801,I))
"RTN","LA7VORM1",210,0)
 . I $P(LA762801(2),"^",4) D
"RTN","LA7VORM1",211,0)
 . . S LA7DUR=$P(LA762801(2),"^",6) ; collection duration
"RTN","LA7VORM1",212,0)
 . . S LA7DURU=$P(LA762801(2),"^",7) ; duration units
"RTN","LA7VORM1",213,0)
 . ; Test urgency - find highest urgency on accession
"RTN","LA7VORM1",214,0)
 . S LA760=+$P(LA762801(0),"^",2)
"RTN","LA7VORM1",215,0)
 . S X=+$$GET1^DIQ(68.04,LA760_","_LRAN_","_LRAD_","_LRAA_",",1,"I")
"RTN","LA7VORM1",216,0)
 . I 'LA76205 S LA76205=X
"RTN","LA7VORM1",217,0)
 . I LA76205,X<LA76205 S LA76205=X
"RTN","LA7VORM1",218,0)
 S ORC(7)=$$ORC7^LA7VORC(LA7DUR,LA7DURU,LA76205,LA7FS,LA7ECH)
"RTN","LA7VORM1",219,0)
 ;
"RTN","LA7VORM1",220,0)
 ; Order Date/Time - if no order date/time then try draw time (only send date if d/t is inexact (2nd piece))
"RTN","LA7VORM1",221,0)
 I $P(LA76802(0),"^",4) S ORC(9)=$$ORC9^LA7VORC($P(LA76802(0),"^",4))
"RTN","LA7VORM1",222,0)
 I '$P(LA76802(0),"^",4),$P(LA76802(3),"^") D
"RTN","LA7VORM1",223,0)
 . K LA7X
"RTN","LA7VORM1",224,0)
 . S LA7X=$P(LA76802(3),"^") S:$P(LA76802(3),"^",2) LA7X=$P(LA7X,".")
"RTN","LA7VORM1",225,0)
 . S ORC(9)=$$ORC9^LA7VORC(LA7X)
"RTN","LA7VORM1",226,0)
 ;
"RTN","LA7VORM1",227,0)
 ; Ordering provider
"RTN","LA7VORM1",228,0)
 S LA7X=$$FNDOLOC^LA7VHLU2(LA7UID)
"RTN","LA7VORM1",229,0)
 S ORC(12)=$$ORC12^LA7VORC($P(LA76802(0),"^",8),$P(LA7X,"^",3),LA7FS,LA7ECH)
"RTN","LA7VORM1",230,0)
 ;
"RTN","LA7VORM1",231,0)
 ; Entering organization - VA facility
"RTN","LA7VORM1",232,0)
 S ORC(17)=$$ORC17^LA7VORC($P($G(LA7629(0)),U,2),LA7FS,LA7ECH)
"RTN","LA7VORM1",233,0)
 ;
"RTN","LA7VORM1",234,0)
 ; Ordering facility/address
"RTN","LA7VORM1",235,0)
 I $P($G(LA7629(0)),U,2) D
"RTN","LA7VORM1",236,0)
 . S ORC(21)=$$ORC21^LA7VORC($P(LA7629(0),U,2),LA7FS,LA7ECH)
"RTN","LA7VORM1",237,0)
 . S ORC(22)=$$ORC22^LA7VORC($P(LA7629(0),U,2),$P(LA76802(3),"^"),LA7FS,LA7ECH)
"RTN","LA7VORM1",238,0)
 ;
"RTN","LA7VORM1",239,0)
 D BUILDSEG^LA7VHLU(.ORC,.LA7DATA,LA7FS)
"RTN","LA7VORM1",240,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORM1",241,0)
 D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORM1",242,0)
 Q
"RTN","LA7VORM1",243,0)
 ;
"RTN","LA7VORM1",244,0)
 ;
"RTN","LA7VORM1",245,0)
BLG ; Billing segment
"RTN","LA7VORM1",246,0)
 ;
"RTN","LA7VORM1",247,0)
 N LA7BLG
"RTN","LA7VORM1",248,0)
 ;
"RTN","LA7VORM1",249,0)
 I $P(LA7629(0),U,13)="" Q
"RTN","LA7VORM1",250,0)
 S LA7BLG(0)=$$BLG^LA7VHLU($P(LA7629(0),"^",13),"CO",LA7FS,LA7ECH)
"RTN","LA7VORM1",251,0)
 D FILESEG^LA7VHLU(GBL,.LA7BLG)
"RTN","LA7VORM1",252,0)
 D FILE6249^LA7VHLU(LA76249,.LA7BLG)
"RTN","LA7VORM1",253,0)
 Q
"RTN","LA7VORU")
0^23^B24122155^B58855542
"RTN","LA7VORU",1,0)
LA7VORU ;DALOI/JMC - Builder of HL7 Lab Results OBR/OBX/NTE ;Aug 8, 2008
"RTN","LA7VORU",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,61,64,71,68**;Sep 27, 1994;Build 56
"RTN","LA7VORU",3,0)
 ;
"RTN","LA7VORU",4,0)
EN(LA) ; called from IN^LA7VMSG(...)
"RTN","LA7VORU",5,0)
 ; variables
"RTN","LA7VORU",6,0)
 ; LA("HUID") - Host Unique ID from the local ACCESSION file (#68)
"RTN","LA7VORU",7,0)
 ; LA("SITE") - Ordering site IEN in the INSTITUTION file (#4)
"RTN","LA7VORU",8,0)
 ; LA("RUID") - Remote sites Unique ID from ACCESSION file (#68)
"RTN","LA7VORU",9,0)
 ; LA("ORD") - Free text ordered test name from WKLD CODE file (#64)
"RTN","LA7VORU",10,0)
 ; LA("NLT") - National Laboratory test code from WKLD CODE file (#64)
"RTN","LA7VORU",11,0)
 ; LA("LRIDT") - Inverse date/time the lab arrival time (accession date/time)
"RTN","LA7VORU",12,0)
 ; LA("SUB") - test subscript defined in LABORATORY TEST file (#60)
"RTN","LA7VORU",13,0)
 ; LA("LRDFN") - IEN in LAB DATA file (#63)
"RTN","LA7VORU",14,0)
 ; LA("ORD"), LA("NLT"), and LA("SUB") are sent for specific lab results.
"RTN","LA7VORU",15,0)
 ; LA("AUTO-INST") - Auto-Instrument
"RTN","LA7VORU",16,0)
 ;
"RTN","LA7VORU",17,0)
 N LA763,LA7NLT,LA7NVAF,LA7X,PRIMARY
"RTN","LA7VORU",18,0)
 ;
"RTN","LA7VORU",19,0)
 S PRIMARY=$$PRIM^VASITE(DT),LA("AUTO-INST")=""
"RTN","LA7VORU",20,0)
 I $G(PRIMARY)'="" D
"RTN","LA7VORU",21,0)
 . S PRIMARY=$$SITE^VASITE(DT,PRIMARY)
"RTN","LA7VORU",22,0)
 . S PRIMARY=$P(PRIMARY,U,3)
"RTN","LA7VORU",23,0)
 . S LA("AUTO-INST")="LA7V HOST "_PRIMARY
"RTN","LA7VORU",24,0)
 ;
"RTN","LA7VORU",25,0)
 I '$O(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),0)) D  Q
"RTN","LA7VORU",26,0)
 . ; need to add error logging when no entry in 63.
"RTN","LA7VORU",27,0)
 ;
"RTN","LA7VORU",28,0)
 S LRDFN=LA("LRDFN"),LRSS=LA("SUB"),LRIDT=LA("LRIDT")
"RTN","LA7VORU",29,0)
 ;
"RTN","LA7VORU",30,0)
 ; Get zeroth node of entry in #63.
"RTN","LA7VORU",31,0)
 S LA763(0)=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),0))
"RTN","LA7VORU",32,0)
 S LA7NLT=$G(LA("NLT"))
"RTN","LA7VORU",33,0)
 ;
"RTN","LA7VORU",34,0)
 S LA7NVAF=$$NVAF^LA7VHLU2(+LA("SITE"))
"RTN","LA7VORU",35,0)
 S LA7NTESN=0
"RTN","LA7VORU",36,0)
 D ORC
"RTN","LA7VORU",37,0)
 ;
"RTN","LA7VORU",38,0)
 I $G(LA("SUB"))="CH" D CH
"RTN","LA7VORU",39,0)
 I $G(LA("SUB"))="MI" D MI^LA7VORU1
"RTN","LA7VORU",40,0)
 I "SPCYEM"[$G(LA("SUB")) D AP^LA7VORU2
"RTN","LA7VORU",41,0)
 Q
"RTN","LA7VORU",42,0)
 ;
"RTN","LA7VORU",43,0)
 ;
"RTN","LA7VORU",44,0)
CH ; Build segments for "CH" subscript
"RTN","LA7VORU",45,0)
 ;
"RTN","LA7VORU",46,0)
 D OBR
"RTN","LA7VORU",47,0)
 D NTE
"RTN","LA7VORU",48,0)
 S LA7OBXSN=0
"RTN","LA7VORU",49,0)
 D OBX
"RTN","LA7VORU",50,0)
 ;
"RTN","LA7VORU",51,0)
 Q
"RTN","LA7VORU",52,0)
 ;
"RTN","LA7VORU",53,0)
 ;
"RTN","LA7VORU",54,0)
ORC ; Build ORC segment
"RTN","LA7VORU",55,0)
 ;
"RTN","LA7VORU",56,0)
 N LA763,LA7696,LA7DATA,LA7SM,LA7X,LA7Y,LADFINST,ORC
"RTN","LA7VORU",57,0)
 ;
"RTN","LA7VORU",58,0)
 S LA763(0)=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),0))
"RTN","LA7VORU",59,0)
 ;
"RTN","LA7VORU",60,0)
 ; Default institution from Kernel
"RTN","LA7VORU",61,0)
 S LADFINST=+$$KSP^XUPARAM("INST")
"RTN","LA7VORU",62,0)
 ;
"RTN","LA7VORU",63,0)
 S ORC(0)="ORC"
"RTN","LA7VORU",64,0)
 ;
"RTN","LA7VORU",65,0)
 ; Order control
"RTN","LA7VORU",66,0)
 S ORC(1)=$$ORC1^LA7VORC("RE")
"RTN","LA7VORU",67,0)
 ;
"RTN","LA7VORU",68,0)
 ; Remote UID
"RTN","LA7VORU",69,0)
 K LA7X
"RTN","LA7VORU",70,0)
 M LA7X=LA("RUID")
"RTN","LA7VORU",71,0)
 S ORC(2)=$$ORC2^LA7VORC(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORU",72,0)
 ;
"RTN","LA7VORU",73,0)
 ; Host UID
"RTN","LA7VORU",74,0)
 K LA7X
"RTN","LA7VORU",75,0)
 M LA7X=LA("HUID")
"RTN","LA7VORU",76,0)
 S ORC(3)=$$ORC3^LA7VORC(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORU",77,0)
 ;
"RTN","LA7VORU",78,0)
 ; Return shipping manifest if found
"RTN","LA7VORU",79,0)
 S LA7SM="",LA7696=0
"RTN","LA7VORU",80,0)
 I LA("SITE")'="",LA("RUID")'="" S LA7696=$O(^LRO(69.6,"RST",LA("SITE"),LA("RUID"),0))
"RTN","LA7VORU",81,0)
 I LA7696 S LA7SM=$P($G(^LRO(69.6,LA7696,0)),U,14)
"RTN","LA7VORU",82,0)
 I LA7SM'="" S ORC(4)=$$ORC4^LA7VORC(LA7SM,LA7FS,LA7ECH)
"RTN","LA7VORU",83,0)
 ;
"RTN","LA7VORU",84,0)
 ; Order status
"RTN","LA7VORU",85,0)
 ; DoD/CHCS requires ORC-5 valued otherwise will not process message
"RTN","LA7VORU",86,0)
 I LA7NVAF=1 S ORC(5)=$$ORC5^LA7VORC("CM",LA7FS,LA7ECH)
"RTN","LA7VORU",87,0)
 ;
"RTN","LA7VORU",88,0)
 ; Ordering provider
"RTN","LA7VORU",89,0)
 K LA7X,LA7Y
"RTN","LA7VORU",90,0)
 S (LA7X,LA7Y)=""
"RTN","LA7VORU",91,0)
 ; "CH" and "MI" subscript store requesting provider and requesting div/location.
"RTN","LA7VORU",92,0)
 I "CHMI"[LA("SUB") D
"RTN","LA7VORU",93,0)
 . N LA7J
"RTN","LA7VORU",94,0)
 . S LA7J=$P(LA763(0),"^",13)
"RTN","LA7VORU",95,0)
 . I $P(LA7J,";",2)="SC(" S LA7Y=$$GET1^DIQ(44,$P(LA7J,";")_",",3,"I")
"RTN","LA7VORU",96,0)
 . I $P(LA7J,";",2)="DIC(4," S LA7Y=$P(LA7J,";")
"RTN","LA7VORU",97,0)
 . I LA("SUB")="CH" S LA7X=$P(LA763(0),"^",10)
"RTN","LA7VORU",98,0)
 . I LA("SUB")="MI" S LA7X=$P(LA763(0),"^",7)
"RTN","LA7VORU",99,0)
 ;
"RTN","LA7VORU",100,0)
 ; Other subscripts only store requesting provider
"RTN","LA7VORU",101,0)
 I "CYEMSP"[LA("SUB") S LA7X=$P(LA763(0),"^",7)
"RTN","LA7VORU",102,0)
 ;
"RTN","LA7VORU",103,0)
 I LA7Y="" S LA7Y=LADFINST
"RTN","LA7VORU",104,0)
 S ORC(12)=$$ORC12^LA7VORC(LA7X,LA7Y,LA7FS,LA7ECH,$S($G(LA7INTYP)=30:2,$G(LA7NVAF)=1:0,1:1))
"RTN","LA7VORU",105,0)
 ;
"RTN","LA7VORU",106,0)
 ; Enterer's location
"RTN","LA7VORU",107,0)
 S LA7X=""
"RTN","LA7VORU",108,0)
 I "CHMI"[LA("SUB") S LA7X=$P(LA763(0),"^",13)
"RTN","LA7VORU",109,0)
 I LA7X'="" S ORC(13)=$$ORC13^LA7VORC(LA7X,LA7FS,LA7ECH)
"RTN","LA7VORU",110,0)
 ;
"RTN","LA7VORU",111,0)
 ; Entering organization
"RTN","LA7VORU",112,0)
 S ORC(17)=$$ORC17^LA7VORC(LA7Y,LA7FS,LA7ECH)
"RTN","LA7VORU",113,0)
 ;
"RTN","LA7VORU",114,0)
 ; Ordering facility/address
"RTN","LA7VORU",115,0)
 S LA7X=$P($G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),"ORU")),"^",3)
"RTN","LA7VORU",116,0)
 I 'LA7X,"CHMI"[LA("SUB") S LA7X=$P(LA763(0),"^",14)
"RTN","LA7VORU",117,0)
 I LA7X D
"RTN","LA7VORU",118,0)
 . S ORC(21)=$$ORC21^LA7VORC(LA7X,LA7FS,LA7ECH)
"RTN","LA7VORU",119,0)
 . S ORC(22)=$$ORC22^LA7VORC(LA7X,$P(LA763(0),"^"),LA7FS,LA7ECH)
"RTN","LA7VORU",120,0)
 ;
"RTN","LA7VORU",121,0)
 D BUILDSEG^LA7VHLU(.ORC,.LA7DATA,LA7FS)
"RTN","LA7VORU",122,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORU",123,0)
 ;
"RTN","LA7VORU",124,0)
 ; Check for flag to only build message but do not file
"RTN","LA7VORU",125,0)
 I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249P,.LA7DATA)
"RTN","LA7VORU",126,0)
 ;
"RTN","LA7VORU",127,0)
 Q
"RTN","LA7VORU",128,0)
 ;
"RTN","LA7VORU",129,0)
 ;
"RTN","LA7VORU",130,0)
OBR ;Observation Request segment for Lab Order
"RTN","LA7VORU",131,0)
 ;
"RTN","LA7VORU",132,0)
 D OBR^LA7VORUB
"RTN","LA7VORU",133,0)
 Q
"RTN","LA7VORU",134,0)
 ;
"RTN","LA7VORU",135,0)
 ;
"RTN","LA7VORU",136,0)
OBX ;Observation/Result segment for Lab Results
"RTN","LA7VORU",137,0)
 ;
"RTN","LA7VORU",138,0)
 N LA7953,LA7DATA,LA7VT,LA7VTIEN,LA7X
"RTN","LA7VORU",139,0)
 ;
"RTN","LA7VORU",140,0)
 S LA7VTIEN=0
"RTN","LA7VORU",141,0)
 F  S LA7VTIEN=$O(^LAHM(62.49,LA(62.49),1,LA7VTIEN)) Q:'LA7VTIEN  D
"RTN","LA7VORU",142,0)
 . S LA7VT=$P(^LAHM(62.49,LA(62.49),1,LA7VTIEN,0),"^",1,2)
"RTN","LA7VORU",143,0)
 . ; Build OBX segment
"RTN","LA7VORU",144,0)
 . K LA7DATA
"RTN","LA7VORU",145,0)
 . D OBX^LA7VOBX(LA("LRDFN"),LA("SUB"),LA("LRIDT"),$P(LA7VT,"^",1,2),.LA7DATA,.LA7OBXSN,LA7FS,LA7ECH,$G(LA7NVAF))
"RTN","LA7VORU",146,0)
 . ; If OBX failed to build then don't store
"RTN","LA7VORU",147,0)
 . I '$D(LA7DATA) Q
"RTN","LA7VORU",148,0)
 . ;
"RTN","LA7VORU",149,0)
 . D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORU",150,0)
 . I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORU",151,0)
 . ;
"RTN","LA7VORU",152,0)
 . ; Send performing lab comment and interpretation from file #60
"RTN","LA7VORU",153,0)
 . S LA7NTESN=0
"RTN","LA7VORU",154,0)
 . I LA7NVAF=1 D PLC^LA7VORUA
"RTN","LA7VORU",155,0)
 . D INTRP^LA7VORUA
"RTN","LA7VORU",156,0)
 . ;
"RTN","LA7VORU",157,0)
 . ; Mark result as sent - set to 1, if corrected results set to 2
"RTN","LA7VORU",158,0)
 . I LA("SUB")="CH" D
"RTN","LA7VORU",159,0)
 . . I $P(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),$P(LA7VT,"^")),"^",10)>1 Q
"RTN","LA7VORU",160,0)
 . . S $P(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),$P(LA7VT,"^")),"^",10)=$S($P(LA7VT,"^",2)="C":2,1:1)
"RTN","LA7VORU",161,0)
 ;
"RTN","LA7VORU",162,0)
 Q
"RTN","LA7VORU",163,0)
 ;
"RTN","LA7VORU",164,0)
 ;
"RTN","LA7VORU",165,0)
NTE ; Build NTE segment
"RTN","LA7VORU",166,0)
 ;
"RTN","LA7VORU",167,0)
 D NTE^LA7VORUA
"RTN","LA7VORU",168,0)
 Q
"RTN","LA7VORU1")
0^8^B61414246^B35283793
"RTN","LA7VORU1",1,0)
LA7VORU1 ;DALOI/JMC - Builder of HL7 Lab Results Microbiology OBR/OBX/NTE ;12/08/09  16:39
"RTN","LA7VORU1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VORU1",3,0)
 Q
"RTN","LA7VORU1",4,0)
 ;
"RTN","LA7VORU1",5,0)
 ;
"RTN","LA7VORU1",6,0)
MI ; Build segments for "MI" subscript
"RTN","LA7VORU1",7,0)
 ;
"RTN","LA7VORU1",8,0)
 N LA7I,LA7ID,LA7IDT,LA7IENS,LA7NLT,LRDFN,LRIDT,LRSB,LRSS
"RTN","LA7VORU1",9,0)
 ;
"RTN","LA7VORU1",10,0)
 S LRDFN=LA("LRDFN"),LRSS=LA("SUB"),(LA7IENS,LRIDT)=LA("LRIDT")
"RTN","LA7VORU1",11,0)
 ;
"RTN","LA7VORU1",12,0)
 ; Bacteriology Report
"RTN","LA7VORU1",13,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,1)) D
"RTN","LA7VORU1",14,0)
 . S LA7IDT=LRIDT,LRSB=11,LA7NLT="87993.0000"
"RTN","LA7VORU1",15,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",16,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",17,0)
 . F LRSB=1,11.7,1.5,11 D RPTNTE
"RTN","LA7VORU1",18,0)
 . N LRSB
"RTN","LA7VORU1",19,0)
 . S LA7OBXSN=0
"RTN","LA7VORU1",20,0)
 . ; Report urine/sputum screens
"RTN","LA7VORU1",21,0)
 . F LA7I=5,6 I $P(^LR(LRDFN,LRSS,LRIDT,1),"^",LA7I)'="" S LRSB=$S(LA7I=5:11.58,1:11.57) D OBX
"RTN","LA7VORU1",22,0)
 . ; Report gram stain
"RTN","LA7VORU1",23,0)
 . I $D(^LR(LRDFN,LRSS,LRIDT,2)) D GS
"RTN","LA7VORU1",24,0)
 . ; Check for organism id
"RTN","LA7VORU1",25,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,3)) Q
"RTN","LA7VORU1",26,0)
 . S LRSB=12
"RTN","LA7VORU1",27,0)
 . D ORG
"RTN","LA7VORU1",28,0)
 . D MIC
"RTN","LA7VORU1",29,0)
 ;
"RTN","LA7VORU1",30,0)
 ; Parasite report
"RTN","LA7VORU1",31,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,5)) D
"RTN","LA7VORU1",32,0)
 . S LRSB=14,LA7NLT="87505.0000"
"RTN","LA7VORU1",33,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",34,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",35,0)
 . F LRSB=16.5,15.51,16.4,14 D RPTNTE
"RTN","LA7VORU1",36,0)
 . ; Check for organism id
"RTN","LA7VORU1",37,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,6)) Q
"RTN","LA7VORU1",38,0)
 . N LRSB
"RTN","LA7VORU1",39,0)
 . S LA7OBXSN=0,LA7IDT=LRIDT,LRSB=16
"RTN","LA7VORU1",40,0)
 . D ORG
"RTN","LA7VORU1",41,0)
 ;
"RTN","LA7VORU1",42,0)
 ; Mycology report
"RTN","LA7VORU1",43,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,8)) D
"RTN","LA7VORU1",44,0)
 . S LRSB=18,LA7NLT="87994.0000"
"RTN","LA7VORU1",45,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",46,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",47,0)
 . F LRSB=20.5,19.6,20.4,18 D RPTNTE
"RTN","LA7VORU1",48,0)
 . ; Check for organism id
"RTN","LA7VORU1",49,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,9)) Q
"RTN","LA7VORU1",50,0)
 . N LRSB
"RTN","LA7VORU1",51,0)
 . S LA7OBXSN=0,LA7IDT=LRIDT,LRSB=20
"RTN","LA7VORU1",52,0)
 . D ORG
"RTN","LA7VORU1",53,0)
 ;
"RTN","LA7VORU1",54,0)
 ; Mycobacterium report
"RTN","LA7VORU1",55,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,11)) D
"RTN","LA7VORU1",56,0)
 . S LRSB=22,LA7NLT="87995.0000"
"RTN","LA7VORU1",57,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",58,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",59,0)
 . F LRSB=26.5,26.4,22 D RPTNTE
"RTN","LA7VORU1",60,0)
 . N LRSB
"RTN","LA7VORU1",61,0)
 . S LA7OBXSN=0,LA7IDT=LRIDT
"RTN","LA7VORU1",62,0)
 . ; Report acid fast stain
"RTN","LA7VORU1",63,0)
 . I $P(^LR(LRDFN,LRSS,LRIDT,11),"^",3)'="" D
"RTN","LA7VORU1",64,0)
 . . S LRSB=24 D OBX
"RTN","LA7VORU1",65,0)
 . . S LRSB=25 D OBX
"RTN","LA7VORU1",66,0)
 . ; Check for organism id
"RTN","LA7VORU1",67,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,12)) Q
"RTN","LA7VORU1",68,0)
 . S LRSB=26
"RTN","LA7VORU1",69,0)
 . D ORG
"RTN","LA7VORU1",70,0)
 . D MIC
"RTN","LA7VORU1",71,0)
 ;
"RTN","LA7VORU1",72,0)
 ; Virology report
"RTN","LA7VORU1",73,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,16)) D
"RTN","LA7VORU1",74,0)
 . S LRSB=33,LA7NLT="87996.0000"
"RTN","LA7VORU1",75,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",76,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",77,0)
 . F LRSB=36.5,36.4,33 D RPTNTE
"RTN","LA7VORU1",78,0)
 . ; Check for virus id
"RTN","LA7VORU1",79,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,17)) Q
"RTN","LA7VORU1",80,0)
 . N LRSB
"RTN","LA7VORU1",81,0)
 . S LA7OBXSN=0,LA7IDT=LRIDT,LRSB=36
"RTN","LA7VORU1",82,0)
 . D ORG
"RTN","LA7VORU1",83,0)
 ;
"RTN","LA7VORU1",84,0)
 ; Antibiotic Levels
"RTN","LA7VORU1",85,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,14)) D
"RTN","LA7VORU1",86,0)
 . N LA7SR
"RTN","LA7VORU1",87,0)
 . S LRSB=28,LA7NLT="93978.0000",LA7NTESN=0
"RTN","LA7VORU1",88,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",89,0)
 . S LA7SR=0
"RTN","LA7VORU1",90,0)
 . F  S LA7SR=$O(^LR(LRDFN,LRSS,LRIDT,14,LA7SR)) Q:'LA7SR  S LA7IDT=LRIDT_","_LA7SR D OBX
"RTN","LA7VORU1",91,0)
 ;
"RTN","LA7VORU1",92,0)
 Q
"RTN","LA7VORU1",93,0)
 ;
"RTN","LA7VORU1",94,0)
 ;
"RTN","LA7VORU1",95,0)
GS ; Report Gram stain
"RTN","LA7VORU1",96,0)
 ;
"RTN","LA7VORU1",97,0)
 N LA7GS
"RTN","LA7VORU1",98,0)
 ;
"RTN","LA7VORU1",99,0)
 S LRSB=11.6,LA7GS=0
"RTN","LA7VORU1",100,0)
 F  S LA7GS=$O(^LR(LRDFN,LRSS,LRIDT,2,LA7GS)) Q:'LA7GS  D
"RTN","LA7VORU1",101,0)
 . S LA7IDT=LRIDT_","_LA7GS
"RTN","LA7VORU1",102,0)
 . D OBX
"RTN","LA7VORU1",103,0)
 Q
"RTN","LA7VORU1",104,0)
 ;
"RTN","LA7VORU1",105,0)
 ;
"RTN","LA7VORU1",106,0)
RPTNTE ; Send report comments
"RTN","LA7VORU1",107,0)
 ;
"RTN","LA7VORU1",108,0)
 N LA7CMTYP,LA7FMT,LA7J,LA7ND,LA7SOC,LA7TXT,LA7X
"RTN","LA7VORU1",109,0)
 ;
"RTN","LA7VORU1",110,0)
 ; Source of comment - handle special codes for other systems, i,e. DOD-CHCS
"RTN","LA7VORU1",111,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"AC",1:"L"),LA7ND=0
"RTN","LA7VORU1",112,0)
 ;
"RTN","LA7VORU1",113,0)
 S LA7FMT=0
"RTN","LA7VORU1",114,0)
 ; If HDR interface then send as repetition text.
"RTN","LA7VORU1",115,0)
 I $G(LA7INTYP)=30 S LA7FMT=2
"RTN","LA7VORU1",116,0)
 ;
"RTN","LA7VORU1",117,0)
 D
"RTN","LA7VORU1",118,0)
 . ; Bacterial preliminary/report/tests remark
"RTN","LA7VORU1",119,0)
 . I LRSB=11 S LA7ND=4,LA7CMTYP="VA-LRMI010" Q
"RTN","LA7VORU1",120,0)
 . I LRSB=1 S LA7ND=19,LA7CMTYP="VA-LRMI011" Q
"RTN","LA7VORU1",121,0)
 . I LRSB=1.5 S LA7ND=26,LA7CMTYP="VA-LRMI012" Q
"RTN","LA7VORU1",122,0)
 . I LRSB=11.7 S LA7ND=25,LA7CMTYP="VA-LRMI013" Q
"RTN","LA7VORU1",123,0)
 . ; Parasite preliminary/report/tests remark
"RTN","LA7VORU1",124,0)
 . I LRSB=14 S LA7ND=7,LA7CMTYP="VA-LRMI020" Q
"RTN","LA7VORU1",125,0)
 . I LRSB=16.5 S LA7ND=21,LA7CMTYP="VA-LRMI021" Q
"RTN","LA7VORU1",126,0)
 . I LRSB=16.4 S LA7ND=27,LA7CMTYP="VA-LRMI022" Q
"RTN","LA7VORU1",127,0)
 . I LRSB=15.1 S LA7ND=24,LA7CMTYP="VA-LRMI023" Q
"RTN","LA7VORU1",128,0)
 . ; Fungal preliminary/report/tests remark
"RTN","LA7VORU1",129,0)
 . I LRSB=18 S LA7ND=10,LA7CMTYP="VA-LRMI030" Q
"RTN","LA7VORU1",130,0)
 . I LRSB=20.5 S LA7ND=22,LA7CMTYP="VA-LRMI031" Q
"RTN","LA7VORU1",131,0)
 . I LRSB=20.4 S LA7ND=28,LA7CMTYP="VA-LRMI032" Q
"RTN","LA7VORU1",132,0)
 . I LRSB=19.6 S LA7ND=15,LA7CMTYP="VA-LRMI033" Q
"RTN","LA7VORU1",133,0)
 . ; Mycobacteria preliminary/report/tests remark
"RTN","LA7VORU1",134,0)
 . I LRSB=22 S LA7ND=13,LA7CMTYP="VA-LRMI040" Q
"RTN","LA7VORU1",135,0)
 . I LRSB=26.5 S LA7ND=23,LA7CMTYP="VA-LRMI041" Q
"RTN","LA7VORU1",136,0)
 . I LRSB=26.4 S LA7ND=29,LA7CMTYP="VA-LRMI042" Q
"RTN","LA7VORU1",137,0)
 . ; Viral preliminary/report/tests remark
"RTN","LA7VORU1",138,0)
 . I LRSB=33 S LA7ND=18,LA7CMTYP="VA-LRMI050" Q
"RTN","LA7VORU1",139,0)
 . I LRSB=36.5 S LA7ND=20,LA7CMTYP="VA-LRMI051" Q
"RTN","LA7VORU1",140,0)
 . I LRSB=36.4 S LA7ND=30,LA7CMTYP="VA-LRMI052" Q
"RTN","LA7VORU1",141,0)
 ;
"RTN","LA7VORU1",142,0)
 I LA7ND'>0 Q
"RTN","LA7VORU1",143,0)
 ;
"RTN","LA7VORU1",144,0)
 S LA7J=0
"RTN","LA7VORU1",145,0)
 F  S LA7J=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7J)) Q:'LA7J  D
"RTN","LA7VORU1",146,0)
 . S LA7X=$G(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7J,0))
"RTN","LA7VORU1",147,0)
 . I LA7FMT=0 S LA7TXT=LA7X D NTE^LA7VORU1 Q
"RTN","LA7VORU1",148,0)
 . S LA7TXT(LA7J)=LA7X
"RTN","LA7VORU1",149,0)
 ;
"RTN","LA7VORU1",150,0)
 ; If formatted or repetition format then build comments to a NTE segment.
"RTN","LA7VORU1",151,0)
 I LA7FMT,$D(LA7TXT) D NTE^LA7VORU1
"RTN","LA7VORU1",152,0)
 ;
"RTN","LA7VORU1",153,0)
 Q
"RTN","LA7VORU1",154,0)
 ;
"RTN","LA7VORU1",155,0)
 ;
"RTN","LA7VORU1",156,0)
ORG ; Build OBR/OBX segments for MI subscript organism id
"RTN","LA7VORU1",157,0)
 ;
"RTN","LA7VORU1",158,0)
 N LA7ND,LA7ORG
"RTN","LA7VORU1",159,0)
 ;
"RTN","LA7VORU1",160,0)
 ; Bacterial organism
"RTN","LA7VORU1",161,0)
 I LRSB=12 S LA7ND=3
"RTN","LA7VORU1",162,0)
 ; Parasite organism
"RTN","LA7VORU1",163,0)
 I LRSB=16 S LA7ND=6
"RTN","LA7VORU1",164,0)
 ; Fungal organism
"RTN","LA7VORU1",165,0)
 I LRSB=20 S LA7ND=9
"RTN","LA7VORU1",166,0)
 ; Mycobacteria organism
"RTN","LA7VORU1",167,0)
 I LRSB=26 S LA7ND=12
"RTN","LA7VORU1",168,0)
 ; Viral agent
"RTN","LA7VORU1",169,0)
 I LRSB=36 S LA7ND=17
"RTN","LA7VORU1",170,0)
 ;
"RTN","LA7VORU1",171,0)
 S LA7ORG=0
"RTN","LA7VORU1",172,0)
 F  S LA7ORG=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG)) Q:'LA7ORG  D
"RTN","LA7VORU1",173,0)
 . S LA7IDT=LRIDT_","_LA7ORG_","
"RTN","LA7VORU1",174,0)
 . D OBX
"RTN","LA7VORU1",175,0)
 . I LA7ND=17 Q  ; no quantity/comments on viruses
"RTN","LA7VORU1",176,0)
 . D ORGNTE
"RTN","LA7VORU1",177,0)
 . I $P($G(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,0)),"^",2)'="" D CC
"RTN","LA7VORU1",178,0)
 Q
"RTN","LA7VORU1",179,0)
 ;
"RTN","LA7VORU1",180,0)
 ;
"RTN","LA7VORU1",181,0)
CC ; Send colony count (quantity)
"RTN","LA7VORU1",182,0)
 ;
"RTN","LA7VORU1",183,0)
 N LRSB
"RTN","LA7VORU1",184,0)
 ;
"RTN","LA7VORU1",185,0)
 I LA7ND=3 S LRSB="12,1"
"RTN","LA7VORU1",186,0)
 I LA7ND=9 S LRSB="20,1"
"RTN","LA7VORU1",187,0)
 I LA7ND=12 S LRSB="26,1"
"RTN","LA7VORU1",188,0)
 ;
"RTN","LA7VORU1",189,0)
 D OBX
"RTN","LA7VORU1",190,0)
 ;
"RTN","LA7VORU1",191,0)
 Q
"RTN","LA7VORU1",192,0)
 ;
"RTN","LA7VORU1",193,0)
 ;
"RTN","LA7VORU1",194,0)
ORGNTE ; Send comments on organisms.
"RTN","LA7VORU1",195,0)
 ;
"RTN","LA7VORU1",196,0)
 N LA7CMTYP,LA7FMT,LA7J,LA7SOC,LA7NTESN,LA7TXT,LA7X
"RTN","LA7VORU1",197,0)
 ;
"RTN","LA7VORU1",198,0)
 ; Source of comment - handle special codes for other systems, i,e. DOD-CHCS
"RTN","LA7VORU1",199,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"RC",1:"L")
"RTN","LA7VORU1",200,0)
 ;
"RTN","LA7VORU1",201,0)
 S LA7FMT=0,LA7CMTYP=""
"RTN","LA7VORU1",202,0)
 ; If HDR interface then send as repetition text.
"RTN","LA7VORU1",203,0)
 I $G(LA7INTYP)=30 S LA7FMT=2
"RTN","LA7VORU1",204,0)
 ;
"RTN","LA7VORU1",205,0)
 S (LA7J,LA7NTESN)=0
"RTN","LA7VORU1",206,0)
 F  S LA7J=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,1,LA7J)) Q:'LA7J  D
"RTN","LA7VORU1",207,0)
 . S LA7X=$G(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,1,LA7J,0))
"RTN","LA7VORU1",208,0)
 . I LA7X="" S LA7X=" "
"RTN","LA7VORU1",209,0)
 . I LA7FMT=0 S LA7TXT=LA7X D NTE Q
"RTN","LA7VORU1",210,0)
 . S LA7TXT(LA7J)=LA7X
"RTN","LA7VORU1",211,0)
 ;
"RTN","LA7VORU1",212,0)
 ; If formatted or repetition format then build comments to a NTE segment.
"RTN","LA7VORU1",213,0)
 I LA7FMT,$D(LA7TXT) D NTE^LA7VORU1
"RTN","LA7VORU1",214,0)
 ;
"RTN","LA7VORU1",215,0)
 Q
"RTN","LA7VORU1",216,0)
 ;
"RTN","LA7VORU1",217,0)
 ;
"RTN","LA7VORU1",218,0)
MIC ; Build OBR/OBX segments for MI subscript susceptibilities(MIC)
"RTN","LA7VORU1",219,0)
 ;
"RTN","LA7VORU1",220,0)
 N LA7ORG,LA7ND,LA7NLT,LA7SB,LA7SB1,LA7SOC
"RTN","LA7VORU1",221,0)
 ;
"RTN","LA7VORU1",222,0)
 ; Source of comment - handle special codes for other systems, i,e. DOD-CHCS
"RTN","LA7VORU1",223,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"RC",1:"L")
"RTN","LA7VORU1",224,0)
 ;
"RTN","LA7VORU1",225,0)
 S (LA7NLT,LA7NLT(1))=""
"RTN","LA7VORU1",226,0)
 I LRSB=12 S LA7ND=3,LA7NLT="87565.0000",LA7NLT(1)="87993.0000"
"RTN","LA7VORU1",227,0)
 I LRSB=26 S LA7ND=12,LA7NLT="87899.0000",LA7NLT(1)="87525.0000"
"RTN","LA7VORU1",228,0)
 ;
"RTN","LA7VORU1",229,0)
 S LA7ORG=0,LA7SB=LRSB
"RTN","LA7VORU1",230,0)
 F  S LA7ORG=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG)) Q:'LA7ORG  D
"RTN","LA7VORU1",231,0)
 . N LA7NTESN,LA7PARNT
"RTN","LA7VORU1",232,0)
 . ; Check for susceptibilities for this organism
"RTN","LA7VORU1",233,0)
 . S X=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,2))
"RTN","LA7VORU1",234,0)
 . I X<2!(X>3) Q
"RTN","LA7VORU1",235,0)
 . S LA7PARNT=LA7SB_"-"_LA7ORG
"RTN","LA7VORU1",236,0)
 . M LA7PARNT=LA7ID(LA7PARNT)
"RTN","LA7VORU1",237,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",238,0)
 . S LA7OBXSN=0,LA7SB1=2
"RTN","LA7VORU1",239,0)
 . F  S LA7SB1=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,LA7SB1)) Q:'LA7SB1!(LA7SB1>2.99)  D
"RTN","LA7VORU1",240,0)
 . . N LA7CMTYP,LA7FMT,LA7TXT,LRSB
"RTN","LA7VORU1",241,0)
 . . S LA7IDT=LRIDT_","_LA7ORG_","_LA7SB1,LRSB=LA7SB_","_LA7SB1
"RTN","LA7VORU1",242,0)
 . . D OBX
"RTN","LA7VORU1",243,0)
 . . S X=$O(^LAB(62.06,"AD",LA7SB1,0)) Q:'X
"RTN","LA7VORU1",244,0)
 . . S LA7TXT=$P($G(^LAB(62.06,X,0)),"^",3)
"RTN","LA7VORU1",245,0)
 . . I LA7TXT'="" S (LA7NTESN,LA7FMT)=0,LA7CMTYP="" D NTE
"RTN","LA7VORU1",246,0)
 . I LA7ND'=3 Q  ; no free text antibiotics on AFB
"RTN","LA7VORU1",247,0)
 . S LA7SB1=0
"RTN","LA7VORU1",248,0)
 . F  S LA7SB1=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,3,LA7SB1)) Q:'LA7SB1  D
"RTN","LA7VORU1",249,0)
 . . N LRSB
"RTN","LA7VORU1",250,0)
 . . S LA7IDT=LRIDT_","_LA7ORG_","_LA7SB1
"RTN","LA7VORU1",251,0)
 . . S LRSB=LA7SB_",3,1" D OBX
"RTN","LA7VORU1",252,0)
 . . S LRSB=LA7SB_",3,2" D OBX
"RTN","LA7VORU1",253,0)
 . 
"RTN","LA7VORU1",254,0)
 Q
"RTN","LA7VORU1",255,0)
 ;
"RTN","LA7VORU1",256,0)
 ;
"RTN","LA7VORU1",257,0)
OBX ; Build OBX segments for MI subscript
"RTN","LA7VORU1",258,0)
 ; Also called by AP^LA7VORU2 to build AP OBX segments.
"RTN","LA7VORU1",259,0)
 ;
"RTN","LA7VORU1",260,0)
 N LA7DATA
"RTN","LA7VORU1",261,0)
 D OBX^LA7VOBX(LRDFN,LRSS,LA7IDT,LRSB,.LA7DATA,.LA7OBXSN,LA7FS,LA7ECH,LA7NVAF)
"RTN","LA7VORU1",262,0)
 ;
"RTN","LA7VORU1",263,0)
 ; If OBX failed to build then don't store
"RTN","LA7VORU1",264,0)
 I '$D(LA7DATA) Q
"RTN","LA7VORU1",265,0)
 ;
"RTN","LA7VORU1",266,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORU1",267,0)
 ;
"RTN","LA7VORU1",268,0)
 ; Check for flag to only build meesage but do not file
"RTN","LA7VORU1",269,0)
 I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORU1",270,0)
 Q
"RTN","LA7VORU1",271,0)
 ;
"RTN","LA7VORU1",272,0)
 ;
"RTN","LA7VORU1",273,0)
NTE ; Build NTE segment with comment
"RTN","LA7VORU1",274,0)
 ;
"RTN","LA7VORU1",275,0)
 N LA7DATA
"RTN","LA7VORU1",276,0)
 ;
"RTN","LA7VORU1",277,0)
 D NTE^LA7VHLU3(.LA7DATA,.LA7TXT,$G(LA7SOC),LA7FS,LA7ECH,.LA7NTESN,$G(LA7CMTYP),$G(LA7FMT))
"RTN","LA7VORU1",278,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORU1",279,0)
 ;
"RTN","LA7VORU1",280,0)
 ; Check for flag to only build meesage but do not file
"RTN","LA7VORU1",281,0)
 I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORU1",282,0)
 ;
"RTN","LA7VORU1",283,0)
 Q
"RTN","LA7VORU2")
0^25^B5334202^B6677596
"RTN","LA7VORU2",1,0)
LA7VORU2 ;DALOI/JMC - LAB ORU (Result) message builder cont'd ;Jun 17, 2005
"RTN","LA7VORU2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VORU2",3,0)
 ;
"RTN","LA7VORU2",4,0)
AP ; Observation/Result segment for Lab AP Results
"RTN","LA7VORU2",5,0)
 ;
"RTN","LA7VORU2",6,0)
 N LA7DATA,LA7IDT,LRSB,LRSS
"RTN","LA7VORU2",7,0)
 ;
"RTN","LA7VORU2",8,0)
 S LRDFN=LA("LRDFN"),LRSS=LA("SUB"),(LA7IDT,LRIDT)=LA("LRIDT")
"RTN","LA7VORU2",9,0)
 ;
"RTN","LA7VORU2",10,0)
 S (LA7NLT,LA("NLT"))=$P($$DEFCODE^LA7VHLU5(LRSS,.012,"",""),"!")
"RTN","LA7VORU2",11,0)
 D OBR^LA7VORU
"RTN","LA7VORU2",12,0)
 D NTE^LA7VORU
"RTN","LA7VORU2",13,0)
 ;
"RTN","LA7VORU2",14,0)
APORM ; Entry point when building OBX segments for ORM message
"RTN","LA7VORU2",15,0)
 ; Process AP subscripts
"RTN","LA7VORU2",16,0)
 ;
"RTN","LA7VORU2",17,0)
 N LA7ORG,LA7P,LA7SR,LA7SS
"RTN","LA7VORU2",18,0)
 S LA7OBXSN=0
"RTN","LA7VORU2",19,0)
 ;
"RTN","LA7VORU2",20,0)
 ; Process main report
"RTN","LA7VORU2",21,0)
 I LA7NVAF'=1 F LRSB=.012,.013,.014,.015,.016,1,1.1,1.3,1.4 D OBX^LA7VORU1
"RTN","LA7VORU2",22,0)
 I LA7NVAF=1 D SPDOD
"RTN","LA7VORU2",23,0)
 ;
"RTN","LA7VORU2",24,0)
 ; Process supplementary reports
"RTN","LA7VORU2",25,0)
 S LRSB=1.2,LA7SR=0
"RTN","LA7VORU2",26,0)
 F  S LA7SR=$O(^LR(LRDFN,LRSS,LRIDT,1.2,LA7SR)) Q:'LA7SR  D
"RTN","LA7VORU2",27,0)
 . N LA7IDT
"RTN","LA7VORU2",28,0)
 . ; If don't release this report then skip.
"RTN","LA7VORU2",29,0)
 . I $P($G(^LR(LRDFN,LRSS,LRIDT,1.2,LA7SR,0)),"^",2)'=1 Q
"RTN","LA7VORU2",30,0)
 . S LA7IDT=LRIDT_","_LA7SR D OBX^LA7VORU1
"RTN","LA7VORU2",31,0)
 ;
"RTN","LA7VORU2",32,0)
 ; Process organ/tissue subfile
"RTN","LA7VORU2",33,0)
 S LA7ORG=0
"RTN","LA7VORU2",34,0)
 F  S LA7ORG=$O(^LR(LRDFN,LRSS,LRIDT,2,LA7ORG)) Q:'LA7ORG  D
"RTN","LA7VORU2",35,0)
 . N LA7IDT
"RTN","LA7VORU2",36,0)
 . S LRSB=10,LA7IDT=LRIDT_","_LA7ORG D OBX^LA7VORU1
"RTN","LA7VORU2",37,0)
 . I LRSS="SP" S LRSB="10,2",LA7IDT=LRIDT_","_LA7ORG D OBX^LA7VORU1
"RTN","LA7VORU2",38,0)
 . ; Procedures
"RTN","LA7VORU2",39,0)
 . ;S LA7P=0,LRSB="10,1.5"
"RTN","LA7VORU2",40,0)
 . ;F  S LA7P=$O(^LR(LRDFN,LRSS,LRIDT,2,LA7ORG,4,LA7P)) Q:'LA7P  D
"RTN","LA7VORU2",41,0)
 . ;. S LA7IDT=LRIDT_","_LA7ORG_","_LA7P D OBX^LA7VORU1
"RTN","LA7VORU2",42,0)
 . ; Special studies
"RTN","LA7VORU2",43,0)
 . S LA7SS=0,LRSB="10,5"
"RTN","LA7VORU2",44,0)
 . F  S LA7SS=$O(^LR(LRDFN,LRSS,LRIDT,2,LA7ORG,5,LA7SS)) Q:'LA7SS  D
"RTN","LA7VORU2",45,0)
 . . S LA7IDT=LRIDT_","_LA7ORG_","_LA7SS D OBX^LA7VORU1
"RTN","LA7VORU2",46,0)
 ;
"RTN","LA7VORU2",47,0)
 Q
"RTN","LA7VORU2",48,0)
 ;
"RTN","LA7VORU2",49,0)
 ;
"RTN","LA7VORU2",50,0)
SPDOD ; Build OBX segment's to special DoD specifications.
"RTN","LA7VORU2",51,0)
 ; Send word-processing fields as series of OBX's for DoD.
"RTN","LA7VORU2",52,0)
 ; DoD cannot handle formatted text (FT) data type.
"RTN","LA7VORU2",53,0)
 N LA7DA
"RTN","LA7VORU2",54,0)
 ;
"RTN","LA7VORU2",55,0)
 S LRSB=.012 D OBX^LA7VORU1
"RTN","LA7VORU2",56,0)
 ;
"RTN","LA7VORU2",57,0)
 F LRSB=.013,.014,.015,.016,1,1.1,1.3,1.4 D
"RTN","LA7VORU2",58,0)
 . N LA7IDT,LA7SB
"RTN","LA7VORU2",59,0)
 . S LA7DA=0,LA7SB=$S(LRSB=.013:.2,LRSB=.014:.3,LRSB=.015:.4,LRSB=.016:.5,1:LRSB)
"RTN","LA7VORU2",60,0)
 . F  S LA7DA=$O(^LR(LRDFN,LRSS,LRIDT,LA7SB,LA7DA)) Q:'LA7DA  D
"RTN","LA7VORU2",61,0)
 . . S LA7IDT=LRIDT_","_LA7DA D OBX^LA7VORU1
"RTN","LA7VORU2",62,0)
 ;
"RTN","LA7VORU2",63,0)
 Q
"RTN","LA7VORUA")
0^7^B11624236^B8112587
"RTN","LA7VORUA",1,0)
LA7VORUA ;DALOI/JMC - Builder of HL7 Lab Results NTE ;12/08/09  16:39
"RTN","LA7VORUA",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**61,64,68**;Sep 27, 1994;Build 56
"RTN","LA7VORUA",3,0)
 ;
"RTN","LA7VORUA",4,0)
 ;
"RTN","LA7VORUA",5,0)
NTE ; Build NTE segment
"RTN","LA7VORUA",6,0)
 ;
"RTN","LA7VORUA",7,0)
 N LA7CMTYP,LA7FMT,LA7J,LA7NTE,LA7SOC,LA7TXT,LA7TYP,LA7X,LA7Y,X
"RTN","LA7VORUA",8,0)
 ;
"RTN","LA7VORUA",9,0)
 ; Initialize segment set id
"RTN","LA7VORUA",10,0)
 S LA7NTESN=0
"RTN","LA7VORUA",11,0)
 ;
"RTN","LA7VORUA",12,0)
 ; Source of comment - handle other system's special codes, i.e. DOD-CHCS
"RTN","LA7VORUA",13,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"AC",1:"L")
"RTN","LA7VORUA",14,0)
 ;
"RTN","LA7VORUA",15,0)
 S LA7FMT=0
"RTN","LA7VORUA",16,0)
 ; If HDR interface then send as repetition text.
"RTN","LA7VORUA",17,0)
 I $G(LA7INTYP)=30 S LA7FMT=2
"RTN","LA7VORUA",18,0)
 ;
"RTN","LA7VORUA",19,0)
 ; Send "MI" specimen's comments
"RTN","LA7VORUA",20,0)
 I LA("SUB")="MI" D
"RTN","LA7VORUA",21,0)
 . K LA7NTE
"RTN","LA7VORUA",22,0)
 . S LA7X=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),99)),LA7CMTYP="VA-LRMI001",LA7J=1
"RTN","LA7VORUA",23,0)
 . I LA7X="" Q
"RTN","LA7VORUA",24,0)
 . I LA7FMT S LA7Y(LA7CMTYP,LA7J)=LA7X
"RTN","LA7VORUA",25,0)
 . E  S LA7TXT=LA7X D NTE^LA7VORU1
"RTN","LA7VORUA",26,0)
 ;
"RTN","LA7VORUA",27,0)
 ; Send "CH" specimen's comments
"RTN","LA7VORUA",28,0)
 I LA("SUB")="CH" D
"RTN","LA7VORUA",29,0)
 . S LA7J=0
"RTN","LA7VORUA",30,0)
 . F  S LA7J=$O(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),1,LA7J)) Q:'LA7J  D
"RTN","LA7VORUA",31,0)
 . . K LA7NTE
"RTN","LA7VORUA",32,0)
 . . S LA7X=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),1,LA7J,0)),LA7CMTYP="VA-LR002"
"RTN","LA7VORUA",33,0)
 . . I $E(LA7X,1)="~" S LA7CMTYP="VA-LR001"
"RTN","LA7VORUA",34,0)
 . . I LA7X="" S LA7X=" "
"RTN","LA7VORUA",35,0)
 . . I LA7FMT S LA7Y(LA7CMTYP,LA7J)=LA7X
"RTN","LA7VORUA",36,0)
 . . E  S LA7TXT=LA7X D NTE^LA7VORU1
"RTN","LA7VORUA",37,0)
 ;
"RTN","LA7VORUA",38,0)
 ; If formatted or repetition format then build each type of comments to an NTE segment.
"RTN","LA7VORUA",39,0)
 I LA7FMT D
"RTN","LA7VORUA",40,0)
 . S LA7CMTYP=""
"RTN","LA7VORUA",41,0)
 . F  S LA7CMTYP=$O(LA7Y(LA7CMTYP)) Q:LA7CMTYP=""  D
"RTN","LA7VORUA",42,0)
 . . K LA7TXT
"RTN","LA7VORUA",43,0)
 . . M LA7TXT=LA7Y(LA7CMTYP)
"RTN","LA7VORUA",44,0)
 . . D NTE^LA7VORU1
"RTN","LA7VORUA",45,0)
 Q
"RTN","LA7VORUA",46,0)
 ;
"RTN","LA7VORUA",47,0)
 ;
"RTN","LA7VORUA",48,0)
PLC ; Performing lab comment
"RTN","LA7VORUA",49,0)
 N LA74,LA7DIV,LA7CMTYP,LA7FMT,LA7NTE,LA7RNLT,LA7SOC,LA7TSTN,LA7TXT,LA7X,X
"RTN","LA7VORUA",50,0)
 S (LA74,LA7CMTYP,LA7DIV,LA7RNLT,LA7TSTN)="",LA7FMT=0
"RTN","LA7VORUA",51,0)
 ;
"RTN","LA7VORUA",52,0)
 ; Source of comment - handle other system's special codes, i.e. DOD-CHCS
"RTN","LA7VORUA",53,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"DS",1:"L")
"RTN","LA7VORUA",54,0)
 ;
"RTN","LA7VORUA",55,0)
 ; Find reporting facility (division).
"RTN","LA7VORUA",56,0)
 I LA("SUB")="CH" D
"RTN","LA7VORUA",57,0)
 . S LA7X=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),$P(LA7VT,"^")))
"RTN","LA7VORUA",58,0)
 . S LA74=$P(LA7X,"^",9)
"RTN","LA7VORUA",59,0)
 . S LA7RNLT=$P($P(LA7X,"^",3),"!",2)
"RTN","LA7VORUA",60,0)
 I LA74="" S LA74=+$P($G(^XMB(1,1,"XUS")),"^",17)
"RTN","LA7VORUA",61,0)
 I LA74 S LA7DIV=$$NAME^XUAF4(LA74)
"RTN","LA7VORUA",62,0)
 ;
"RTN","LA7VORUA",63,0)
 ; Build result test name
"RTN","LA7VORUA",64,0)
 I LA7RNLT="" D
"RTN","LA7VORUA",65,0)
 . I $G(LA("NLT"))'="" S LA7RNLT=LA("NLT") Q
"RTN","LA7VORUA",66,0)
 . S LA7RNLT=$G(LA7NLT)
"RTN","LA7VORUA",67,0)
 I LA7RNLT D
"RTN","LA7VORUA",68,0)
 . S LA7X=$O(^LAM("E",LA7RNLT,0))
"RTN","LA7VORUA",69,0)
 . I LA7X S LA7TSTN=$$GET1^DIQ(64,LA7X_",",.01,"I")
"RTN","LA7VORUA",70,0)
 ;
"RTN","LA7VORUA",71,0)
 S LA7TXT=LA7TSTN_" results from "_LA7DIV_"."
"RTN","LA7VORUA",72,0)
 D NTE^LA7VORU1
"RTN","LA7VORUA",73,0)
 S X=$$PADD^XUAF4(LA74)
"RTN","LA7VORUA",74,0)
 S LA7TXT=$P(X,U)_" "_$P(X,U,2)_", "_$P(X,U,3)_" "_$P(X,U,4)
"RTN","LA7VORUA",75,0)
 D NTE^LA7VORU1
"RTN","LA7VORUA",76,0)
 Q
"RTN","LA7VORUA",77,0)
 ;
"RTN","LA7VORUA",78,0)
 ;
"RTN","LA7VORUA",79,0)
INTRP ; Send test interpretation
"RTN","LA7VORUA",80,0)
 ; Send "CH" subscript file #60 site/specimen's interpretation field (#5.5)
"RTN","LA7VORUA",81,0)
 ;
"RTN","LA7VORUA",82,0)
 N LA760,LA761,LA7CMTYP,LA7FMT,LA7J,LA7NTE,LA7SOC,LA7TXT,LA7X,LA7Y,LRSB
"RTN","LA7VORUA",83,0)
 ;
"RTN","LA7VORUA",84,0)
 S LRSB=$P(LA7VT,"^"),(LA7FMT,LA7Y)=0
"RTN","LA7VORUA",85,0)
 S LA761=+$P(LA763(0),"^",5)
"RTN","LA7VORUA",86,0)
 S LA7X=^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),LRSB)
"RTN","LA7VORUA",87,0)
 S LA760=+$P($P(LA7X,"^",3),"!",7)
"RTN","LA7VORUA",88,0)
 I LA760,$D(^LAB(60,LA760,1,LA761,1)) S LA7Y=1
"RTN","LA7VORUA",89,0)
 I 'LA760 D
"RTN","LA7VORUA",90,0)
 . S LA760=0
"RTN","LA7VORUA",91,0)
 . F  S LA760=$O(^LAB(60,"C","CH;"_LRSB_";1",LA760)) Q:'LA760  D  Q:LA7Y
"RTN","LA7VORUA",92,0)
 . . I $D(^LAB(60,LA760,1,LA761,1)) S LA7Y=1
"RTN","LA7VORUA",93,0)
 ;
"RTN","LA7VORUA",94,0)
 I 'LA7Y Q
"RTN","LA7VORUA",95,0)
 ;
"RTN","LA7VORUA",96,0)
 ; Source of comment - handle other system's special codes, i.e. DOD-CHCS
"RTN","LA7VORUA",97,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"RI",1:"L"),LA7CMTYP="VA-LR003"
"RTN","LA7VORUA",98,0)
 ;
"RTN","LA7VORUA",99,0)
 ; If HDR interface then send as repetition text.
"RTN","LA7VORUA",100,0)
 I $G(LA7INTYP)=30 S LA7FMT=2
"RTN","LA7VORUA",101,0)
 ;
"RTN","LA7VORUA",102,0)
 ; Build each line of interpretation as a NTE segment unless formatting flag (LA7FMT) indicates
"RTN","LA7VORUA",103,0)
 ;  either formatted text or repetition.
"RTN","LA7VORUA",104,0)
 S LA7J=0
"RTN","LA7VORUA",105,0)
 F  S LA7J=$O(^LAB(60,LA760,1,LA761,1,LA7J)) Q:'LA7J  D
"RTN","LA7VORUA",106,0)
 . S LA7X=$G(^LAB(60,LA760,1,LA761,1,LA7J,0))
"RTN","LA7VORUA",107,0)
 . I LA7X="" S LA7X=" "
"RTN","LA7VORUA",108,0)
 . I LA7FMT S LA7TXT(LA7J)=LA7X
"RTN","LA7VORUA",109,0)
 . E  S LA7TXT=LA7X D NTE^LA7VORU1
"RTN","LA7VORUA",110,0)
 ;
"RTN","LA7VORUA",111,0)
 I LA7FMT>0,$D(LA7TXT) D NTE^LA7VORU1
"RTN","LA7VORUA",112,0)
 ;
"RTN","LA7VORUA",113,0)
 Q
"RTN","LA7VORUB")
0^29^B37430566^n/a
"RTN","LA7VORUB",1,0)
LA7VORUB ;DALOI/JMC - Builder of HL7 Lab Results cont'd ;Jan 16, 2009
"RTN","LA7VORUB",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**68**;Sep 27, 1994;Build 56
"RTN","LA7VORUB",3,0)
 ;
"RTN","LA7VORUB",4,0)
 Q
"RTN","LA7VORUB",5,0)
 ;
"RTN","LA7VORUB",6,0)
 ;
"RTN","LA7VORUB",7,0)
OBR ;Observation Request segment for Lab Order
"RTN","LA7VORUB",8,0)
 ;
"RTN","LA7VORUB",9,0)
 N LA761,LA762,LA7DATA,LA7PLOBR,LA7RS,LA7RSDT,LA7SNM,LA7X,LA7Y,LADFINST,OBR
"RTN","LA7VORUB",10,0)
 ;
"RTN","LA7VORUB",11,0)
 ; Retrieve placer's OBR information stored in #69.6
"RTN","LA7VORUB",12,0)
 D RETOBR^LA7VHLU(LA("SITE"),LA("RUID"),LA("NLT"),.LA7PLOBR)
"RTN","LA7VORUB",13,0)
 ;
"RTN","LA7VORUB",14,0)
 ; Retrieve "ORUT" node for this NLT from file #63
"RTN","LA7VORUB",15,0)
 S LA7NLT(63)=""
"RTN","LA7VORUB",16,0)
 I LA7NLT'="" D
"RTN","LA7VORUB",17,0)
 . S LA7X=$O(^LR(LRDFN,LRSS,LRIDT,"ORUT","B",LA7NLT,0))
"RTN","LA7VORUB",18,0)
 . I LA7X>0 S LA7NLT(63)=$G(^LR(LRDFN,LRSS,LRIDT,"ORUT",LA7X,0))
"RTN","LA7VORUB",19,0)
 ;
"RTN","LA7VORUB",20,0)
 ; Default institution from Kernel
"RTN","LA7VORUB",21,0)
 S LADFINST=+$$KSP^XUPARAM("INST")
"RTN","LA7VORUB",22,0)
 ;
"RTN","LA7VORUB",23,0)
 ; Retreive accession info used below - accession area^accession date^accession number
"RTN","LA7VORUB",24,0)
 S LA7Y=$$CHECKUID^LRWU4(LA("HUID"))
"RTN","LA7VORUB",25,0)
 I LA7Y S LA("HUID",68)=$P(LA7Y,"^",2,4)
"RTN","LA7VORUB",26,0)
 E  S LA("HUID",68)=""
"RTN","LA7VORUB",27,0)
 ;
"RTN","LA7VORUB",28,0)
 ; Initialize OBR segment
"RTN","LA7VORUB",29,0)
 S OBR(0)="OBR"
"RTN","LA7VORUB",30,0)
 S OBR(1)=$$OBR1^LA7VOBR(.LA7OBRSN)
"RTN","LA7VORUB",31,0)
 ;
"RTN","LA7VORUB",32,0)
 ; Remote UID
"RTN","LA7VORUB",33,0)
 M LA7X=LA("RUID")
"RTN","LA7VORUB",34,0)
 S OBR(2)=$$OBR2^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORUB",35,0)
 ;
"RTN","LA7VORUB",36,0)
 ; Host UID
"RTN","LA7VORUB",37,0)
 K LA7X
"RTN","LA7VORUB",38,0)
 M LA7X=LA("HUID")
"RTN","LA7VORUB",39,0)
 S OBR(3)=$$OBR3^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORUB",40,0)
 ;
"RTN","LA7VORUB",41,0)
 ; Universal service ID, build from info stored in #69.6
"RTN","LA7VORUB",42,0)
 K LA7X
"RTN","LA7VORUB",43,0)
 S LA7X=""
"RTN","LA7VORUB",44,0)
 I $G(LA7PLOBR("OBR-4"))'="" S OBR(4)=$$CNVFLD^LA7VHLU3(LA7PLOBR("OBR-4"),LA7PLOBR("ECH"),LA7ECH)
"RTN","LA7VORUB",45,0)
 E  S OBR(4)=$$OBR4^LA7VOBR(LA7NLT,"",LA7X,LA7FS,LA7ECH)
"RTN","LA7VORUB",46,0)
 ;
"RTN","LA7VORUB",47,0)
 ; Collection D/T - only send date if d/t is inexact (2nd piece)
"RTN","LA7VORUB",48,0)
 K LA7X
"RTN","LA7VORUB",49,0)
 S LA7X=$P(LA763(0),"^") S:$P(LA763(0),"^",2) LA7X=$P(LA7X,".")
"RTN","LA7VORUB",50,0)
 S OBR(7)=$$OBR7^LA7VOBR(LA7X)
"RTN","LA7VORUB",51,0)
 ;
"RTN","LA7VORUB",52,0)
 ; Specimen action code
"RTN","LA7VORUB",53,0)
 ; If no OBR from PENDING ORDER file (#69.6) then assume added test.
"RTN","LA7VORUB",54,0)
 I $G(LA7INTYP)=10,$G(LA7PLOBR("OBR-4"))="" S OBR(11)=$$OBR11^LA7VOBR("A")
"RTN","LA7VORUB",55,0)
 ;
"RTN","LA7VORUB",56,0)
 ; Infection Warning
"RTN","LA7VORUB",57,0)
 S OBR(12)=$$OBR12^LA7VOBR(LRDFN,LA7FS,LA7ECH)
"RTN","LA7VORUB",58,0)
 ;
"RTN","LA7VORUB",59,0)
 ; Lab Arrival Time
"RTN","LA7VORUB",60,0)
 ; "CH" subscript does not store lab arrival time - attempt to retrieve from file #68.
"RTN","LA7VORUB",61,0)
 ; Other subscripts do store lab arrival time (date/time received).
"RTN","LA7VORUB",62,0)
 I LA("SUB")?1(1"MI",1"SP",1"CY",1"EM") S OBR(14)=$$OBR14^LA7VOBR($P(LA763(0),"^",10))
"RTN","LA7VORUB",63,0)
 I LA("SUB")="CH",LA("HUID",68) D
"RTN","LA7VORUB",64,0)
 . S LA7X=$G(^LRO(68,$P(LA("HUID",68),"^"),1,$P(LA("HUID",68),"^",2),1,$P(LA("HUID",68),"^",3),3))
"RTN","LA7VORUB",65,0)
 . I $P(LA7X,"^",3) S OBR(14)=$$OBR14^LA7VOBR($P(LA7X,"^",3))
"RTN","LA7VORUB",66,0)
 ;
"RTN","LA7VORUB",67,0)
 ; Specimen source 
"RTN","LA7VORUB",68,0)
 S (LA761,LA762,LA7SNM)=""
"RTN","LA7VORUB",69,0)
 I LA("SUB")?1(1"CH",1"MI") D
"RTN","LA7VORUB",70,0)
 . S LA761=$P(LA763(0),U,5)
"RTN","LA7VORUB",71,0)
 . I LA761="" D CREATE^LA7LOG(27)
"RTN","LA7VORUB",72,0)
 . I LA("SUB")="MI" S LA762=$P(LA763(0),U,11)
"RTN","LA7VORUB",73,0)
 I LA7NVAF=1,LA("SUB")'="CH" S LA7SNM=1
"RTN","LA7VORUB",74,0)
 S OBR(15)=$$OBR15^LA7VOBR(LA761,LA762,"",LA7FS,LA7ECH,"",LA7SNM)
"RTN","LA7VORUB",75,0)
 ;
"RTN","LA7VORUB",76,0)
 ; Ordering provider
"RTN","LA7VORUB",77,0)
 K LA7X
"RTN","LA7VORUB",78,0)
 S (LA7X,LA7Y)=""
"RTN","LA7VORUB",79,0)
 ; "CH" subscript stores requesting provider and requesting div/location.
"RTN","LA7VORUB",80,0)
 I LA("SUB")="CH" D
"RTN","LA7VORUB",81,0)
 . N LA7J
"RTN","LA7VORUB",82,0)
 . S LA7J=$P(LA763(0),"^",13)
"RTN","LA7VORUB",83,0)
 . I $P(LA7J,";",2)="SC(" S LA7Y=$$GET1^DIQ(44,$P(LA7J,";")_",",3,"I")
"RTN","LA7VORUB",84,0)
 . I $P(LA7J,";",2)="DIC(4," S LA7Y=$P(LA7J,";")
"RTN","LA7VORUB",85,0)
 . S LA7X=$P(LA763(0),"^",10)
"RTN","LA7VORUB",86,0)
 ;
"RTN","LA7VORUB",87,0)
 ; Other subscripts only store requesting provider
"RTN","LA7VORUB",88,0)
 I LA("SUB")?1(1"MI",1"SP",1"CY",1"EM") S LA7X=$P(LA763(0),"^",7)
"RTN","LA7VORUB",89,0)
 ;
"RTN","LA7VORUB",90,0)
 I LA7Y="" S LA7Y=LADFINST
"RTN","LA7VORUB",91,0)
 S OBR(16)=$$ORC12^LA7VORC(LA7X,LA7Y,LA7FS,LA7ECH,$S($G(LA7INTYP)=30:2,$G(LA7NVAF)=1:0,1:1))
"RTN","LA7VORUB",92,0)
 ;
"RTN","LA7VORUB",93,0)
 ; Placer Field #1 (remote auto-inst)
"RTN","LA7VORUB",94,0)
 ; Build from info stored in #69.6
"RTN","LA7VORUB",95,0)
 I $G(LA7PLOBR("OBR-18"))'="" D
"RTN","LA7VORUB",96,0)
 . S OBR(18)=$$CHKDATA^LA7VHLU3(LA7PLOBR("OBR-18"),LA7FS_LA7ECH)
"RTN","LA7VORUB",97,0)
 ; Else build "auto instrument" if sending to VA facility
"RTN","LA7VORUB",98,0)
 I $G(LA7PLOBR("OBR-18"))="",'LA7NVAF D
"RTN","LA7VORUB",99,0)
 . N LA7X
"RTN","LA7VORUB",100,0)
 . S LA7X(1)=LA("AUTO-INST")
"RTN","LA7VORUB",101,0)
 . S OBR(18)=$$OBR18^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORUB",102,0)
 ;
"RTN","LA7VORUB",103,0)
 ; Placer Field #2
"RTN","LA7VORUB",104,0)
 I $G(LA7PLOBR("OBR-19"))'="" S OBR(19)=$$CHKDATA^LA7VHLU3(LA7PLOBR("OBR-19"),LA7FS_LA7ECH)
"RTN","LA7VORUB",105,0)
 ; Else build collecting UID if sending to VA facility
"RTN","LA7VORUB",106,0)
 I $G(LA7PLOBR("OBR-19"))="",'LA7NVAF,LA("RUID")'="" D
"RTN","LA7VORUB",107,0)
 . K LA7X
"RTN","LA7VORUB",108,0)
 . S LA7X(7)=LA("RUID")
"RTN","LA7VORUB",109,0)
 . S OBR(19)=$$OBR19^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORUB",110,0)
 ;
"RTN","LA7VORUB",111,0)
 ; Filler Field #1
"RTN","LA7VORUB",112,0)
 ; Send file #63 ien info - used by HDR to track patient/specimen
"RTN","LA7VORUB",113,0)
 K LA7X
"RTN","LA7VORUB",114,0)
 S LA7X(1)=LA("LRDFN"),LA7X(2)=LA("SUB"),LA7X(3)=LA("LRIDT")
"RTN","LA7VORUB",115,0)
 S OBR(20)=$$OBR20^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORUB",116,0)
 ;
"RTN","LA7VORUB",117,0)
 ; Filler Field #2
"RTN","LA7VORUB",118,0)
 ; Send Accession/test info - used by DSS to track patient/specimen
"RTN","LA7VORUB",119,0)
 ; LRACC^LRAA^LRAD^LRAN^Accession Area^Area Abbreviation^NLT
"RTN","LA7VORUB",120,0)
 K LA7X
"RTN","LA7VORUB",121,0)
 S LA7X(1)=$P(LA763(0),"^",6),LA7X(7)=LA7NLT
"RTN","LA7VORUB",122,0)
 S LA7Y=LA("HUID",68)
"RTN","LA7VORUB",123,0)
 I LA7Y D
"RTN","LA7VORUB",124,0)
 . N I
"RTN","LA7VORUB",125,0)
 . F I=1,2,3 S LA7X(I+1)=$P(LA7Y,"^",I)
"RTN","LA7VORUB",126,0)
 . S LA7X(5)=$P($G(^LRO(68,$P(LA7Y,"^"),0)),"^")
"RTN","LA7VORUB",127,0)
 . S LA7X(6)=$P($G(^LRO(68,$P(LA7Y,"^"),0)),"^",11)
"RTN","LA7VORUB",128,0)
 S OBR(21)=$$OBR20^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORUB",129,0)
 K LA7X,LAY7
"RTN","LA7VORUB",130,0)
 ;
"RTN","LA7VORUB",131,0)
 ; Date Report Completed/Report status/Responsible person
"RTN","LA7VORUB",132,0)
 ; Determine report date and status from 0 node.
"RTN","LA7VORUB",133,0)
 S LA7RSDT=$P(LA763(0),"^",3),(LA7PRI,LA7RS)=""
"RTN","LA7VORUB",134,0)
 ;
"RTN","LA7VORUB",135,0)
 ; If CYEMSP subscripts then check for corrected report
"RTN","LA7VORUB",136,0)
 I LA("SUB")?1(1"SP",1"CY",1"EM") D
"RTN","LA7VORUB",137,0)
 . S LA7RSDT=$P(LA763(0),"^",11),LA7PRI=$P(LA763(0),"^",2)
"RTN","LA7VORUB",138,0)
 . I LA7RSDT S LA7RS="F"
"RTN","LA7VORUB",139,0)
 . I $P(LA763(0),"^",15) S LA7RS="C"
"RTN","LA7VORUB",140,0)
 . I $G(LRSB)=1.2,$G(LA7SR) S LA7RSDT=+$G(^LR(LRDFN,LA("SUB"),LRIDT,LRSB,LA7SR,0),"^")
"RTN","LA7VORUB",141,0)
 ;
"RTN","LA7VORUB",142,0)
 ; If MI subscript then also check various sections and audit subfile for corrected report
"RTN","LA7VORUB",143,0)
 I LA("SUB")="MI" D
"RTN","LA7VORUB",144,0)
 . S LA7PRI=$P(LA763(0),"^",4)
"RTN","LA7VORUB",145,0)
 . S LA7X=$S(LRSB=11:1,LRSB=11.6:1,LRSB=12:1,LRSB=14:5,LRSB=16:5,LRSB=18:8,LRSB=20:8,LRSB=22:11,LRSB=26:11,LRSB=24:11,LRSB=33:16,LRSB=36:16,1:0)
"RTN","LA7VORUB",146,0)
 . S LA7Y=$G(^LR(LRDFN,"MI",LRIDT,LA7X),"^")
"RTN","LA7VORUB",147,0)
 . I $P(LA7Y,"^") S LA7RSDT=$P(LA7Y,"^"),LA7RS=$P(LA7Y,"^",2),LA7PRI=$P(LA7Y,"^",3)
"RTN","LA7VORUB",148,0)
 . I $P(LA763(0),"^",9)=1 S LA7RS="C" Q
"RTN","LA7VORUB",149,0)
 . I '$D(^LR(LRDFN,"MI",LRIDT,32)) Q
"RTN","LA7VORUB",150,0)
 . S I=0
"RTN","LA7VORUB",151,0)
 . F  S I=$O(^LR(LRDFN,"MI",LRIDT,32,I)) Q:'I  I $P(^(I,0),"^",4)>1,LA7RS="F" S LA7RS="C" Q
"RTN","LA7VORUB",152,0)
 ;
"RTN","LA7VORUB",153,0)
 ; Also check for individual test status on "ORUT" node in file #63
"RTN","LA7VORUB",154,0)
 I $P(LA7NLT(63),"^",10) S LA7RS=$P(LA7NLT(63),"^",10)
"RTN","LA7VORUB",155,0)
 ; 
"RTN","LA7VORUB",156,0)
 ; Date Report Completed
"RTN","LA7VORUB",157,0)
 I LA7RSDT S OBR(22)=$$OBR22^LA7VOBR(LA7RSDT)
"RTN","LA7VORUB",158,0)
 ;
"RTN","LA7VORUB",159,0)
 ; Diagnostic service id
"RTN","LA7VORUB",160,0)
 S OBR(24)=$$OBR24^LA7VOBR(LA("SUB")_"^"_$G(LRSB))
"RTN","LA7VORUB",161,0)
 ;
"RTN","LA7VORUB",162,0)
 ; Result status
"RTN","LA7VORUB",163,0)
 I LA7RS'="" S OBR(25)=$$OBR25^LA7VOBR(LA7RS)
"RTN","LA7VORUB",164,0)
 ;
"RTN","LA7VORUB",165,0)
 ; Parent Result and Parent
"RTN","LA7VORUB",166,0)
 I $D(LA7PARNT) D
"RTN","LA7VORUB",167,0)
 . S OBR(26)=$$OBR26^LA7VOBR(LA7PARNT(1),LA7PARNT(2),LA7PARNT(3),LA7FS,LA7ECH)
"RTN","LA7VORUB",168,0)
 . S OBR(29)=$$OBR29^LA7VOBR(LA("RUID"),LA("HUID"),LA7FS,LA7ECH)
"RTN","LA7VORUB",169,0)
 ;
"RTN","LA7VORUB",170,0)
 ; Principle result interpreter
"RTN","LA7VORUB",171,0)
 I LA("SUB")?1(1"MI",1"SP",1"CY",1"EM") D
"RTN","LA7VORUB",172,0)
 . I LA("SUB")="MI" S LA7X=$P(LA763(0),"^",4)
"RTN","LA7VORUB",173,0)
 . E  S LA7X=$P(LA763(0),"^",2)
"RTN","LA7VORUB",174,0)
 . S OBR(32)=$$OBR32^LA7VOBR(LA7X,LADFINST,LA7FS,LA7ECH)
"RTN","LA7VORUB",175,0)
 ; 
"RTN","LA7VORUB",176,0)
 ; Assistant result interpreter
"RTN","LA7VORUB",177,0)
 I LA("SUB")?1(1"SP",1"EM"),$P(LA763(0),"^",4) S OBR(33)=$$OBR33^LA7VOBR($P(LA763(0),"^",4),LADFINST,LA7FS,LA7ECH)
"RTN","LA7VORUB",178,0)
 ; 
"RTN","LA7VORUB",179,0)
 ; Technician
"RTN","LA7VORUB",180,0)
 I LA("SUB")?1(1"CY",1"EM"),$P(LA763(0),"^",4) S OBR(34)=$$OBR34^LA7VOBR($P(LA763(0),"^",4),LADFINST,LA7FS,LA7ECH)
"RTN","LA7VORUB",181,0)
 ; 
"RTN","LA7VORUB",182,0)
 ; Typist - VistA stores as free text
"RTN","LA7VORUB",183,0)
 I LA("SUB")?1(1"SP",1"CY",1"EM"),$P(LA763(0),"^",9)'="" S OBR(35)=$$OBR35^LA7VOBR($P(LA763(0),"^",9),LADFINST,LA7FS,LA7ECH)
"RTN","LA7VORUB",184,0)
 ;
"RTN","LA7VORUB",185,0)
 ; Procedure code - use Order NLT code
"RTN","LA7VORUB",186,0)
 S OBR(44)=$$OBR44^LA7VOBR(LA7NLT,LA7FS,LA7ECH)
"RTN","LA7VORUB",187,0)
 ; 
"RTN","LA7VORUB",188,0)
 D BUILDSEG^LA7VHLU(.OBR,.LA7DATA,LA7FS)
"RTN","LA7VORUB",189,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORUB",190,0)
 ;
"RTN","LA7VORUB",191,0)
 ; Check for flag to only build message but do not file
"RTN","LA7VORUB",192,0)
 I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORUB",193,0)
 ;
"RTN","LA7VORUB",194,0)
 Q
"UP",63,63.02,-1)
63^EM
"UP",63,63.02,0)
63.02
"UP",63,63.08,-1)
63^SP
"UP",63,63.08,0)
63.08
"UP",63,63.09,-1)
63^CY
"UP",63,63.09,0)
63.09
"VER")
8.0^22.0
"^DD",62.48,62.48,0)
FIELD^^90^12
"^DD",62.48,62.48,0,"DDA")
N
"^DD",62.48,62.48,0,"DT")
3071019
"^DD",62.48,62.48,0,"IX","B",62.48,.01)

"^DD",62.48,62.48,0,"IX","C",62.483,.01)

"^DD",62.48,62.48,0,"NM","LA7 MESSAGE PARAMETER")

"^DD",62.48,62.48,0,"PT",62.4,8)

"^DD",62.48,62.48,0,"PT",62.49,.5)

"^DD",62.48,62.48,0,"PT",62.9,.07)

"^DD",62.48,62.48,0,"VRPK")
LA
"^DD",62.48,62.48,.01,0)
CONFIGURATION^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",62.48,62.48,.01,1,0)
^.1
"^DD",62.48,62.48,.01,1,1,0)
62.48^B
"^DD",62.48,62.48,.01,1,1,1)
S ^LAHM(62.48,"B",$E(X,1,30),DA)=""
"^DD",62.48,62.48,.01,1,1,2)
K ^LAHM(62.48,"B",$E(X,1,30),DA)
"^DD",62.48,62.48,.01,3)
Answer must be 3-30 characters in length.
"^DD",62.48,62.48,.01,21,0)
^^4^4^2970611^
"^DD",62.48,62.48,.01,21,1,0)
This field contains the descriptive name for all Lab Messaging 
"^DD",62.48,62.48,.01,21,2,0)
configurations.  Each external partner that the Lab system exchanges
"^DD",62.48,62.48,.01,21,3,0)
messages with should have an entry in the file, e.g. OERR, Universal 
"^DD",62.48,62.48,.01,21,4,0)
Interface.
"^DD",62.48,62.48,.01,"DT")
2940425
"^DD",62.48,62.48,1,0)
PROTOCOL^S^HL7:HEALTH LEVEL SEVEN;X12:ANSI X.12;1238:ASTM 1238;1381:ASTM 1381;1394:ASTM 1394;LOCAL:LOCAL;^0;2^Q
"^DD",62.48,62.48,1,3)
Enter the protocol name that best fits this configuration.
"^DD",62.48,62.48,1,21,0)
^^2^2^2970611^
"^DD",62.48,62.48,1,21,1,0)
This field should contain the type of messages that are used by this
"^DD",62.48,62.48,1,21,2,0)
configuration.  This field is primarily for documentation.
"^DD",62.48,62.48,1,"DT")
2950122
"^DD",62.48,62.48,2,0)
STATUS^S^1:ACTIVE;0:INACTIVE;^0;3^Q
"^DD",62.48,62.48,2,3)
Enter "Active" to allow this configuration to send and receive messages.
"^DD",62.48,62.48,2,21,0)
^^1^1^2970611^^
"^DD",62.48,62.48,2,21,1,0)
This field is used to turn this configuration on or off.
"^DD",62.48,62.48,2,"DT")
2940425
"^DD",62.48,62.48,3,0)
GRACE PERIOD FOR MESSAGES^NJ2,0^^0;6^K:+X'=X!(X>31)!(X<1)!(X?.E1"."1N.N) X
"^DD",62.48,62.48,3,3)
Type a Number between 1 and 31, 0 Decimal Digits.
"^DD",62.48,62.48,3,21,0)
^^7^7^2970702^^^
"^DD",62.48,62.48,3,21,1,0)
Grace period determines the number of days that messages for this
"^DD",62.48,62.48,3,21,2,0)
configuration are kept on the system before purging when the message
"^DD",62.48,62.48,3,21,3,0)
status is "purgable".  If this field is left blank, the system assumes 3
"^DD",62.48,62.48,3,21,4,0)
days.  These messages are found in the LA7 MESSAGE QUEUE file (#62.49).
"^DD",62.48,62.48,3,21,5,0)
When messages have status of "error" they remain on the system until their
"^DD",62.48,62.48,3,21,6,0)
corresponding error message is removed from the XTMP global by a KERNEL
"^DD",62.48,62.48,3,21,7,0)
cleanup task.  The messages then become "purgable".
"^DD",62.48,62.48,3,"DT")
2970305
"^DD",62.48,62.48,4,0)
LOG ERRORS^S^0:OFF;1:ON;^0;4^Q
"^DD",62.48,62.48,4,3)
Answer "Yes" to log errors in ^XTMP.
"^DD",62.48,62.48,4,21,0)
^^3^3^2970611^
"^DD",62.48,62.48,4,21,1,0)
If turned on, errors or exceptional conditions that occur during message
"^DD",62.48,62.48,4,21,2,0)
processing are stored in the ^XTMP global for review.  To review the
"^DD",62.48,62.48,4,21,3,0)
log, in programmer mode, type D PRINT^LA7LOG.
"^DD",62.48,62.48,4,"DT")
2970204
"^DD",62.48,62.48,5,0)
PROCESS IN^K^^1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",62.48,62.48,5,3)
This is Standard MUMPS code.
"^DD",62.48,62.48,5,9)
@
"^DD",62.48,62.48,5,21,0)
^^4^4^2970611^
"^DD",62.48,62.48,5,21,1,0)
This field is executable MUMPS code. It should contain a call to an
"^DD",62.48,62.48,5,21,2,0)
application routine that will process the incoming message.  For a
"^DD",62.48,62.48,5,21,3,0)
Universal Interface setup, it should contain the call
"^DD",62.48,62.48,5,21,4,0)
D QUE^LA7UIIN.
"^DD",62.48,62.48,5,"DT")
2940507
"^DD",62.48,62.48,6,0)
PROCESS DOWNLOAD^K^^2;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",62.48,62.48,6,3)
This is Standard MUMPS code.
"^DD",62.48,62.48,6,9)
@
"^DD",62.48,62.48,6,20,0)
^.3LA^^0
"^DD",62.48,62.48,6,21,0)
^^4^4^2970611^^
"^DD",62.48,62.48,6,21,1,0)
This field contains executable MUMPS code.  It should contain the
"^DD",62.48,62.48,6,21,2,0)
call point in a routine that will process building a message to be
"^DD",62.48,62.48,6,21,3,0)
sent to the receiving system.  For a Universal Interface configuration
"^DD",62.48,62.48,6,21,4,0)
it should contain the call D EN^LA7UID1.
"^DD",62.48,62.48,6,"DT")
2940516
"^DD",62.48,62.48,7,0)
HL7 NON-DHCP APPLICATION^P770'^HL(770,^0;5^Q
"^DD",62.48,62.48,7,3)
Used to call the HL7 package with the appropriate remote system identifier.
"^DD",62.48,62.48,7,21,0)
^^3^3^2970611^
"^DD",62.48,62.48,7,21,1,0)
This field is a pointer to the HL7 NON-DHCP APPLICATION PARAMETER file
"^DD",62.48,62.48,7,21,2,0)
(#770).  The field is used by the Universal Interface to create an Health
"^DD",62.48,62.48,7,21,3,0)
Level Seven message using the Vista HL7 v1.5 package.
"^DD",62.48,62.48,7,23,0)
^^4^4^2970611^
"^DD",62.48,62.48,7,23,1,0)
The variable HLNDAP is often required by the HL7 package.  This is a 
"^DD",62.48,62.48,7,23,2,0)
pointer to the HL7 NON-DHCP APPLICATION PARAMETER file (#770).  This field
"^DD",62.48,62.48,7,23,3,0)
is a pointer to that file and can be used in messaging building routines
"^DD",62.48,62.48,7,23,4,0)
to set the HLNDAP variable.
"^DD",62.48,62.48,7,"DT")
2940516
"^DD",62.48,62.48,10,0)
MULTIPLE ORDERS^S^0:MULTIPLE PATIENTS;1:SINGLE PATIENT;2:SINGLE ORDER;^0;8^Q
"^DD",62.48,62.48,10,3)
Select if multiple/single patients/orders should be sent in a single message. See description (??) for additional help.
"^DD",62.48,62.48,10,21,0)
^^25^25^3010831^^^^
"^DD",62.48,62.48,10,21,1,0)
Determines when building a HL7 message if message should contain only
"^DD",62.48,62.48,10,21,2,0)
one patient/order or multiple patients/orders.
"^DD",62.48,62.48,10,21,3,0)
 
"^DD",62.48,62.48,10,21,4,0)
Default is multiple patients per message if possible.
"^DD",62.48,62.48,10,21,5,0)
 
"^DD",62.48,62.48,10,21,6,0)
This allows site to configure message building when communicating with
"^DD",62.48,62.48,10,21,7,0)
a non-VA system that can not handle a message that has more than one
"^DD",62.48,62.48,10,21,8,0)
patient in the message. It applies to both order (ORM) and result (ORU)
"^DD",62.48,62.48,10,21,9,0)
messages.
"^DD",62.48,62.48,10,21,10,0)
 
"^DD",62.48,62.48,10,21,11,0)
When communicating with a VA facility this field can be left blank
"^DD",62.48,62.48,10,21,12,0)
(default) or set to 0 - MULTIPLE PATIENTS
"^DD",62.48,62.48,10,21,13,0)

"^DD",62.48,62.48,10,21,14,0)
If the receiving system can only accept one patient per HL7 message
"^DD",62.48,62.48,10,21,15,0)
then select 1 - SINGLE PATIENT. This will place multiple orders or
"^DD",62.48,62.48,10,21,16,0)
results for multiple orders in one message but only one patient will
"^DD",62.48,62.48,10,21,17,0)
be contained in the message.
"^DD",62.48,62.48,10,21,18,0)

"^DD",62.48,62.48,10,21,19,0)
If the receiving system can only accept one order per HL7 message then
"^DD",62.48,62.48,10,21,20,0)
select 2 - SINGLE ORDER. This will place in the message one order or
"^DD",62.48,62.48,10,21,21,0)
the results associated with one order for a single patient
"^DD",62.48,62.48,10,21,22,0)
 
"^DD",62.48,62.48,10,21,23,0)
Note: An order in the VA is considered those tests found on one
"^DD",62.48,62.48,10,21,24,0)
accession. What the VA considers as an accession other non-VA systems
"^DD",62.48,62.48,10,21,25,0)
may refer to as an order.
"^DD",62.48,62.48,10,"DT")
3010831
"^DD",62.48,62.48,11,0)
INTERFACE TYPE^S^1:LAB UI;10:LEDI;20:POC;21:POCA;30:HDR;40:OCS;99:OTHER;^0;9^Q
"^DD",62.48,62.48,11,3)
Enter the purpose for this messaging interface.
"^DD",62.48,62.48,11,21,0)
^.001^41^41^3071022^^
"^DD",62.48,62.48,11,21,1,0)
This field determines how and for what purpose this configuration is
"^DD",62.48,62.48,11,21,2,0)
used. It allows the laboratory software to generate, handle and
"^DD",62.48,62.48,11,21,3,0)
process messages.
"^DD",62.48,62.48,11,21,4,0)
 
"^DD",62.48,62.48,11,21,5,0)
LAB UI - Used to identify configurations that are for processing
"^DD",62.48,62.48,11,21,6,0)
         laboratory automated instrument data via a generic interface
"^DD",62.48,62.48,11,21,7,0)
         manager.
"^DD",62.48,62.48,11,21,8,0)
 
"^DD",62.48,62.48,11,21,9,0)
  LEDI - Designate entries involved with Laboratory Electronic Data
"^DD",62.48,62.48,11,21,10,0)
         Interchange (LEDI). Used to identify interfaces involved in
"^DD",62.48,62.48,11,21,11,0)
         the generation, transmission and processing of HL7 order (ORM)
"^DD",62.48,62.48,11,21,12,0)
         and result (ORU) messages involving reference laboratory
"^DD",62.48,62.48,11,21,13,0)
         testing between VistA and other VistA systems, commercial
"^DD",62.48,62.48,11,21,14,0)
         reference laboratories, DoD laboratories and civilian
"^DD",62.48,62.48,11,21,15,0)
         institutions.
"^DD",62.48,62.48,11,21,16,0)
 
"^DD",62.48,62.48,11,21,17,0)
   POC - Point of Care (POC) interface. These interfaces transmit
"^DD",62.48,62.48,11,21,18,0)
         laboratory test results for which there is no pre-existing
"^DD",62.48,62.48,11,21,19,0)
         VistA laboratory order. VistA creates an order as part of
"^DD",62.48,62.48,11,21,20,0)
         result processing and storage.
"^DD",62.48,62.48,11,21,21,0)
 
"^DD",62.48,62.48,11,21,22,0)
  POCA - Point of Care interface that subscribes to HL7 patient
"^DD",62.48,62.48,11,21,23,0)
         demographic (ADT) messages from VistA. Used by POC interfaces
"^DD",62.48,62.48,11,21,24,0)
         that subscribe to patient information from VistA to maintain
"^DD",62.48,62.48,11,21,25,0)
         the POC's patient database.
"^DD",62.48,62.48,11,21,26,0)
 
"^DD",62.48,62.48,11,21,27,0)
   HDR - Designates interface to the VA Health Data Repository (HDR).
"^DD",62.48,62.48,11,21,28,0)
         And those systems which subscribe to VistA Lab HL7 Result (ORU)
"^DD",62.48,62.48,11,21,29,0)
         messages broadcast by VistA when lab results are made available  
"^DD",62.48,62.48,11,21,30,0)
         within VistA. Examples are COTS clinical decision support
"^DD",62.48,62.48,11,21,31,0)
         systems.
"^DD",62.48,62.48,11,21,32,0)
 
"^DD",62.48,62.48,11,21,33,0)
   OCS - Order Collection System. Interfaces involved in phlebotomy
"^DD",62.48,62.48,11,21,34,0)
         and other specimen collection systems. Information regarding
"^DD",62.48,62.48,11,21,35,0)
         lab orders and specimen requirement are transmitted to an
"^DD",62.48,62.48,11,21,36,0)
         external system which assists in the specimen collection
"^DD",62.48,62.48,11,21,37,0)
         and updates VistA Lab with information related to the specimen
"^DD",62.48,62.48,11,21,38,0)
         and the related order/accession.
"^DD",62.48,62.48,11,21,39,0)
 
"^DD",62.48,62.48,11,21,40,0)
 OTHER - Designate other non-laboratory interfaces that utilize the
"^DD",62.48,62.48,11,21,41,0)
         Laboratory package.
"^DD",62.48,62.48,11,"DT")
3071019
"^DD",62.48,62.48,20,0)
ALERT CONDITION^62.481S^^20;0
"^DD",62.48,62.48,20,21,0)
^^3^3^2970827^^^
"^DD",62.48,62.48,20,21,1,0)
This field allows the user to identify whether to receive alerts when
"^DD",62.48,62.48,20,21,2,0)
there are new results, new orders or when an error is logged to the
"^DD",62.48,62.48,20,21,3,0)
^XTMP global.
"^DD",62.48,62.48,90,0)
REMOTE SYSTEM ID^62.483A^^90;0
"^DD",62.48,62.48,90,21,0)
^^45^45^2970611^
"^DD",62.48,62.48,90,21,1,0)
This field is used to locate the correct configuration in this file when
"^DD",62.48,62.48,90,21,2,0)
a message is received from a remote system. Most messaging protocols
"^DD",62.48,62.48,90,21,3,0)
contain information about the system that originated the message and the
"^DD",62.48,62.48,90,21,4,0)
system that is the destination. Since there can be several senders and
"^DD",62.48,62.48,90,21,5,0)
receivers, this field can be used to determine the correct receiver by
"^DD",62.48,62.48,90,21,6,0)
using a special lookup on this field. The Universal Interface utilizes
"^DD",62.48,62.48,90,21,7,0)
this field in the following manner.
"^DD",62.48,62.48,90,21,8,0)
 
"^DD",62.48,62.48,90,21,9,0)
The VISTA Health Level Seven (HL7) package requires that every message
"^DD",62.48,62.48,90,21,10,0)
must have four fields in the message header so that it can determine
"^DD",62.48,62.48,90,21,11,0)
the application route for the message. Those four fields are called
"^DD",62.48,62.48,90,21,12,0)
Sending Application, Sending Facility, Receiving Application, and
"^DD",62.48,62.48,90,21,13,0)
Receiving Facility. The HL7 software must find values for each of these
"^DD",62.48,62.48,90,21,14,0)
fields in the message within the HL7 package files. The fields must match
"^DD",62.48,62.48,90,21,15,0)
in the following way.
"^DD",62.48,62.48,90,21,16,0)
 For HL7 v1.5 interfaces
"^DD",62.48,62.48,90,21,17,0)
 Sending Application = the NAME field (#.01) in  the HL7 NON-DHCP
"^DD",62.48,62.48,90,21,18,0)
  APPLICATION PARAMETER file (#770)
"^DD",62.48,62.48,90,21,19,0)
 Sending Facility = the NON-DHCP FACILITY NAME field (#3) in File 770
"^DD",62.48,62.48,90,21,20,0)
 Receiving Application = the NAME field (#.01) in the HL7 APPLICATION
"^DD",62.48,62.48,90,21,21,0)
  PARAMETER file (#771)
"^DD",62.48,62.48,90,21,22,0)
 Receiving Facility = the DHCP STATION NUMBER field (#2) in File 770
"^DD",62.48,62.48,90,21,23,0)
 
"^DD",62.48,62.48,90,21,24,0)
 For HL7 v1.6 interfaces
"^DD",62.48,62.48,90,21,25,0)
 Sending Application = the NAME field (#.01) in the HL7 APPLICATION 
"^DD",62.48,62.48,90,21,26,0)
  PARAMETER file (#771)
"^DD",62.48,62.48,90,21,27,0)
 Sending Facility = the FACILITY NAME field (#3) in File 771
"^DD",62.48,62.48,90,21,28,0)
 Receiving Application = the NAME field (#.01) in the HL7 APPLICATION  
"^DD",62.48,62.48,90,21,29,0)
  PARAMETER file (#771)
"^DD",62.48,62.48,90,21,30,0)
 Receiving Facility = the FACILITY NAME field (#3) in File 771
"^DD",62.48,62.48,90,21,31,0)
 
"^DD",62.48,62.48,90,21,32,0)
For the Universal Interface, all four of those fields should be entered
"^DD",62.48,62.48,90,21,33,0)
into this multiple field, exactly as they are entered in the HL7 fields
"^DD",62.48,62.48,90,21,34,0)
listed above, including upper and lower case characters. No spaces should
"^DD",62.48,62.48,90,21,35,0)
be entered between the field values. An example of a Universal Interface
"^DD",62.48,62.48,90,21,36,0)
value for this field is listed below.
"^DD",62.48,62.48,90,21,37,0)
LAB INTERFACEInstrument ManagerLA AUTO INST695 
"^DD",62.48,62.48,90,21,38,0)
Where LAB INTERFACE is the NAME in File 770, Instrument Manager is
"^DD",62.48,62.48,90,21,39,0)
the NON-DHCP FACILITY NAME in File 770, LA AUTO INST is the NAME in
"^DD",62.48,62.48,90,21,40,0)
File 771, and 695 is the DHCP STATION NUMBER in File 770.
"^DD",62.48,62.48,90,21,41,0)
 
"^DD",62.48,62.48,90,21,42,0)
When an HL7 message comes in, these four fields are taken out of the
"^DD",62.48,62.48,90,21,43,0)
message, concatenated together, and a lookup is done on the "C" cross
"^DD",62.48,62.48,90,21,44,0)
reference to find this configuration and its associated parameters. The
"^DD",62.48,62.48,90,21,45,0)
processing routine can then continue to process the data. 
"^DD",62.48,62.481,0)
ALERT CONDITION SUB-FIELD^^.02^2
"^DD",62.48,62.481,0,"DT")
2970827
"^DD",62.48,62.481,0,"IX","B",62.481,.01)

"^DD",62.48,62.481,0,"NM","ALERT CONDITION")

"^DD",62.48,62.481,0,"UP")
62.48
"^DD",62.48,62.481,.01,0)
ALERT CONDITION^*S^1:NEW RESULTS;2:ERROR ON MESSAGE;3:ORDERS RECEIVED;^0;1^Q
"^DD",62.48,62.481,.01,1,0)
^.1
"^DD",62.48,62.481,.01,1,1,0)
62.481^B
"^DD",62.48,62.481,.01,1,1,1)
S ^LAHM(62.48,DA(1),20,"B",$E(X,1,30),DA)=""
"^DD",62.48,62.481,.01,1,1,2)
K ^LAHM(62.48,DA(1),20,"B",$E(X,1,30),DA)
"^DD",62.48,62.481,.01,3)
Enter "1" to receive alerts for new results, a "2" to receive alerts for errors during processing. and "3" when orders are received.
"^DD",62.48,62.481,.01,12)
Error on message alert may only be selected if Field #4, LOG ERRORS,is set to "ON".
"^DD",62.48,62.481,.01,12.1)
S DIC("S")="I $S(Y=2&($P(^LAHM(62.48,DA(1),0),U,4)'=1):0,1:1)"
"^DD",62.48,62.481,.01,21,0)
^^2^2^2970827^^^^
"^DD",62.48,62.481,.01,21,1,0)
This field allows the user to identify whether to receive alerts when
"^DD",62.48,62.481,.01,21,2,0)
there are new results and when an error is logged to the ^XTMP global.
"^DD",62.48,62.481,.01,"DT")
2970827
"^DD",62.48,62.481,.02,0)
MAIL GROUP^RP3.8'X^XMB(3.8,^0;2^K:$L(X)>30!($L(X)<1) X I $D(X) S DIC(0)="EMQ" S X=$P(Y,U,2),DIC=DIE K:Y<1 X
"^DD",62.48,62.481,.02,3)
Enter the Mail Group that will receive the alert condition messages.
"^DD",62.48,62.481,.02,21,0)
^^2^2^2970702^^^
"^DD",62.48,62.481,.02,21,1,0)
This field contains a pointer to the MAIL GROUP file (#3.8).  The group is
"^DD",62.48,62.481,.02,21,2,0)
used to identify who will receive the alert condition messages.
"^DD",62.48,62.481,.02,"DT")
2970219
"^DD",62.48,62.483,0)
REMOTE SYSTEM ID SUB-FIELD^^.01^1
"^DD",62.48,62.483,0,"DT")
2940425
"^DD",62.48,62.483,0,"IX","B",62.483,.01)

"^DD",62.48,62.483,0,"NM","REMOTE SYSTEM ID")

"^DD",62.48,62.483,0,"UP")
62.48
"^DD",62.48,62.483,.01,0)
REMOTE SYSTEM ID^MF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>60!($L(X)<1) X
"^DD",62.48,62.483,.01,1,0)
^.1
"^DD",62.48,62.483,.01,1,1,0)
62.483^B
"^DD",62.48,62.483,.01,1,1,1)
S ^LAHM(62.48,DA(1),90,"B",$E(X,1,30),DA)=""
"^DD",62.48,62.483,.01,1,1,2)
K ^LAHM(62.48,DA(1),90,"B",$E(X,1,30),DA)
"^DD",62.48,62.483,.01,1,2,0)
62.48^C^MUMPS
"^DD",62.48,62.483,.01,1,2,1)
N Y X ^%ZOSF("LPC") S ^LAHM(62.48,"C",$E(X,1,27)_Y,DA(1))=""
"^DD",62.48,62.483,.01,1,2,2)
N Y X ^%ZOSF("LPC") K ^LAHM(62.48,"C",$E(X,1,27)_Y,DA(1))
"^DD",62.48,62.483,.01,1,2,"%D",0)
^^8^8^2970613^
"^DD",62.48,62.483,.01,1,2,"%D",1,0)
This cross reference is used to identify the incoming messages to a
"^DD",62.48,62.483,.01,1,2,"%D",2,0)
specific LA7 MESSAGE PARAMETER file (#62.48) entry.  The cross reference
"^DD",62.48,62.483,.01,1,2,"%D",3,0)
is checked against the third (Sending Application), fourth (Sending
"^DD",62.48,62.483,.01,1,2,"%D",4,0)
facility), fifth (Receiving Application), and sixth (Receiving facility)
"^DD",62.48,62.483,.01,1,2,"%D",5,0)
sequences in the HL7 message header (MSH).  The format of the cross
"^DD",62.48,62.483,.01,1,2,"%D",6,0)
reference is as follows
"^DD",62.48,62.483,.01,1,2,"%D",7,0)
  X ^%ZOSF("LPC")  S ^LAHM(62.48,"C",$E(REMOTE SYSTEM
"^DD",62.48,62.483,.01,1,2,"%D",8,0)
ID,1,27)_Y,CONFIGURATION)=""
"^DD",62.48,62.483,.01,1,2,"DT")
2940429
"^DD",62.48,62.483,.01,3)
Answer must be 1-60 characters in length.
"^DD",62.48,62.483,.01,21,0)
^^32^32^2970611^
"^DD",62.48,62.483,.01,21,1,0)
For the Universal Interface, the following four fields should be
"^DD",62.48,62.483,.01,21,2,0)
entered into this REMOTE SYSTEM ID field.
"^DD",62.48,62.483,.01,21,3,0)
 Sending Application = the NAME field (#.01) in File 770
"^DD",62.48,62.483,.01,21,4,0)
 Sending Facility = the NON-DHCP FACILITY NAME field (#3) in File 770
"^DD",62.48,62.483,.01,21,5,0)
 Receiving Application = the NAME field (#.01) in the HL7 APPLICATION
"^DD",62.48,62.483,.01,21,6,0)
  PARAMETER file (#771)
"^DD",62.48,62.483,.01,21,7,0)
 Receiving Facility = the DHCP STATION NUMBER field (#2) in File 770
"^DD",62.48,62.483,.01,21,8,0)
 
"^DD",62.48,62.483,.01,21,9,0)
For interfaces that use the Vista Health Level Seven (HL7) v1.6 package,
"^DD",62.48,62.483,.01,21,10,0)
the following four fields should beentered into this REMOTE SYSTEM ID
"^DD",62.48,62.483,.01,21,11,0)
field.
"^DD",62.48,62.483,.01,21,12,0)
 Sending Application = the NAME field (#.01) in the HL7 APPLICATION  
"^DD",62.48,62.483,.01,21,13,0)
  PARAMETER file (#771)
"^DD",62.48,62.483,.01,21,14,0)
 Sending Facility = the FACILITY NAME field (#3) in File 771
"^DD",62.48,62.483,.01,21,15,0)
 Receiving Application = the NAME field (#.01) in the HL7 APPLICATION  
"^DD",62.48,62.483,.01,21,16,0)
  PARAMETER file (#771)
"^DD",62.48,62.483,.01,21,17,0)
 Receiving Facility = the FACILITY NAME field (#3) in File 771
"^DD",62.48,62.483,.01,21,18,0)
 
"^DD",62.48,62.483,.01,21,19,0)
 
"^DD",62.48,62.483,.01,21,20,0)
The data from these fields should be entered exactly as it is found in
"^DD",62.48,62.483,.01,21,21,0)
the HL7 fields listed above, including upper and lower case characters.
"^DD",62.48,62.483,.01,21,22,0)
No spaces should be entered between the field values.
"^DD",62.48,62.483,.01,21,23,0)
An example of a Universal Interface value for this field is listed below.
"^DD",62.48,62.483,.01,21,24,0)
LAB INTERFACEInstrument ManagerLA AUTO INST695 
"^DD",62.48,62.483,.01,21,25,0)
Where LAB INTERFACE is the NAME in File 770, Instrument Manager is
"^DD",62.48,62.483,.01,21,26,0)
the NON-DHCP FACILITY NAME in File 770, LA AUTO INST is the NAME in
"^DD",62.48,62.483,.01,21,27,0)
File 771, and 695 is the DHCP STATION NUMBER in File 770.
"^DD",62.48,62.483,.01,21,28,0)
 
"^DD",62.48,62.483,.01,21,29,0)
When an HL7 message comes in, these four fields are taken out of the
"^DD",62.48,62.483,.01,21,30,0)
message, concatenated together, and a lookup is done on the "C" cross
"^DD",62.48,62.483,.01,21,31,0)
reference to find this configuration and its associated parameters. The
"^DD",62.48,62.483,.01,21,32,0)
processing routine can then continue to process the data. 
"^DD",62.48,62.483,.01,"DT")
2940429
"^DD",62.485,62.485,0)
FIELD^^2^4
"^DD",62.485,62.485,0,"DDA")
N
"^DD",62.485,62.485,0,"DT")
2970205
"^DD",62.485,62.485,0,"IX","B",62.485,.01)

"^DD",62.485,62.485,0,"NM","LA7 MESSAGE LOG BULLETINS")

"^DD",62.485,62.485,0,"VRPK")
LA
"^DD",62.485,62.485,.01,0)
CODE^RNJ7,0X^^0;1^K:+X'=X!(X>9999999)!(X<$S($D(DIFROM):1,1:1000))!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",62.485,62.485,.01,1,0)
^.1
"^DD",62.485,62.485,.01,1,1,0)
62.485^B
"^DD",62.485,62.485,.01,1,1,1)
S ^LAHM(62.485,"B",$E(X,1,30),DA)=""
"^DD",62.485,62.485,.01,1,1,2)
K ^LAHM(62.485,"B",$E(X,1,30),DA)
"^DD",62.485,62.485,.01,3)
Type a Number between 1000 and 9999999, 0 Decimal Digits.
"^DD",62.485,62.485,.01,21,0)
^^3^3^2970612^^
"^DD",62.485,62.485,.01,21,1,0)
This field contains a number between 1 and 9999999 that uniquely
"^DD",62.485,62.485,.01,21,2,0)
identifies an error or exceptional condition.  Numbers below 999 are
"^DD",62.485,62.485,.01,21,3,0)
reserved for package use only.
"^DD",62.485,62.485,.01,"DT")
2950122
"^DD",62.485,62.485,1,0)
TEXT^RF^^0;2^K:$L(X)>160!($L(X)<1) X
"^DD",62.485,62.485,1,3)
Answer must be 1-160 characters in length.
"^DD",62.485,62.485,1,21,0)
^^3^3^2970612^
"^DD",62.485,62.485,1,21,1,0)
This field holds the text description of the error or exceptional
"^DD",62.485,62.485,1,21,2,0)
condition.  This field is used to create an error or exceptional condition
"^DD",62.485,62.485,1,21,3,0)
display in the ^XTMP global.
"^DD",62.485,62.485,1,23,0)
^^9^9^2970612^
"^DD",62.485,62.485,1,23,1,0)
This field is used to create error or exceptional condition displays in
"^DD",62.485,62.485,1,23,2,0)
the ^XTMP global.  The text description should contain useful information
"^DD",62.485,62.485,1,23,3,0)
about the message in the LA7 MESSAGE QUEUE file (#62.49).  The information
"^DD",62.485,62.485,1,23,4,0)
can be added to the text by using the "|" character and the LA7TXT()
"^DD",62.485,62.485,1,23,5,0)
array.
"^DD",62.485,62.485,1,23,6,0)
 
"^DD",62.485,62.485,1,23,7,0)
Example Text: Message # |1| did not contain a PID segment.
"^DD",62.485,62.485,1,23,8,0)
Array value: LA7TXT(1)=123
"^DD",62.485,62.485,1,23,9,0)
^XTMP: Message # 123 did not contain a PID segment.
"^DD",62.485,62.485,1,"DT")
2940427
"^DD",62.485,62.485,1.3,0)
SEND ALERT^S^0:NO;1:YES;^0;3^Q
"^DD",62.485,62.485,1.3,3)
Determines if alert is sent when a message is processed with this error. Alerts must also be turned on and mail group designated in file #62.48.
"^DD",62.485,62.485,1.3,21,0)
^^4^4^2970612^
"^DD",62.485,62.485,1.3,21,1,0)
This field is used to flag those errors which can generate an alert to a
"^DD",62.485,62.485,1.3,21,2,0)
site selectable mail group whenever this error occurs. The site needs to
"^DD",62.485,62.485,1.3,21,3,0)
designate a mail group in the LA7 MESSAGE PARAMETER file (#62.48) under
"^DD",62.485,62.485,1.3,21,4,0)
the ALERT CONDITION field (#20).
"^DD",62.485,62.485,1.3,"DT")
2970205
"^DD",62.485,62.485,2,0)
BUILD LOGIC^K^^1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",62.485,62.485,2,3)
This is Standard MUMPS code.
"^DD",62.485,62.485,2,9)
@
"^DD",62.485,62.485,2,21,0)
^^8^8^2970612^
"^DD",62.485,62.485,2,21,1,0)
This is standard MUMPS code that is executed to log the text
"^DD",62.485,62.485,2,21,2,0)
description error into the ^XTMP global.  The MUMPS code should set the
"^DD",62.485,62.485,2,21,3,0)
LA7TXT() array to feel in the fields in the text description.
"^DD",62.485,62.485,2,21,4,0)
 
"^DD",62.485,62.485,2,21,5,0)
 Example MUMPS code: S LA7TXT(1)=LA76249
"^DD",62.485,62.485,2,21,6,0)
 Variable value: LA76249=123
"^DD",62.485,62.485,2,21,7,0)
 Text description: Message # |1| did not contain a PID segment.
"^DD",62.485,62.485,2,21,8,0)
 ^XTMP: Message # 123 did not contain a PID segment.
"^DD",62.485,62.485,2,"DT")
2940427
"^DD",63,63.02,.11,0)
REPORT RELEASE DATE^DIX^^0;11^S %DT="ETXR",%DT(0)="N" D ^%DT K %DT S X=Y K:Y<1 X I $D(X),X<$P($P(^LR(DA(1),"EM",DA,0),U,3),".") K X W !,"Release date must not be before completed date (" S Y=$P(^(0),U,3) D DD^%DT W Y,")"
"^DD",63,63.02,.11,3)
ONLY CURRENT DATE/TIME ALLOWED
"^DD",63,63.02,.11,4)
K DZ
"^DD",63,63.02,.11,21,0)
^^1^1^2950908^^
"^DD",63,63.02,.11,21,1,0)
YES indicates the report was released.
"^DD",63,63.02,.11,"DT")
2950908
"^DD",63,63.08,.11,0)
REPORT RELEASE DATE/TIME^DIX^^0;11^S %DT="ETXR",%DT(0)="N" D ^%DT K %DT S X=Y K:Y<1 X I $D(X),X<$P($P(^LR(DA(1),"SP",DA,0),U,3),".") K X W !,"Release date must not be before report completed date (" S Y=$P(^(0),U,3) D DD^%DT W Y,")"
"^DD",63,63.08,.11,1,0)
^.1
"^DD",63,63.08,.11,1,1,0)
63.08^AC^MUMPS
"^DD",63,63.08,.11,1,1,1)
D ADD^LRWOMEN
"^DD",63,63.08,.11,1,1,2)
D DEL^LRWOMEN
"^DD",63,63.08,.11,1,1,"%D",0)
^^3^3^2990219^
"^DD",63,63.08,.11,1,1,"%D",1,0)
This cross reference will send notification to the Women's Health Program
"^DD",63,63.08,.11,1,1,"%D",2,0)
when a Surgical Pathology specimen on a female is verified/released by the
"^DD",63,63.08,.11,1,1,"%D",3,0)
laboratory.
"^DD",63,63.08,.11,1,1,"DT")
2990219
"^DD",63,63.08,.11,3)
ONLY PRESENT DATE/TIME ALLOWED   
"^DD",63,63.08,.11,4)
K DZ
"^DD",63,63.08,.11,21,0)
^^1^1^2950908^^^
"^DD",63,63.08,.11,21,1,0)
YES indicates the report was released.
"^DD",63,63.08,.11,"DT")
2990219
"^DD",63,63.09,.11,0)
REPORT RELEASE DATE/TIME^DIX^^0;11^S %DT="ETXR",%DT(0)="N" D ^%DT K %DT S X=Y K:Y<1 X I $D(X),X<$P($P(^LR(DA(1),"CY",DA,0),U,3),".") K X W !,"Release date must not be before completed date (" S Y=$P(^(0),U,3) D DD^%DT W Y,")"
"^DD",63,63.09,.11,1,0)
^.1
"^DD",63,63.09,.11,1,1,0)
63.09^AC^MUMPS
"^DD",63,63.09,.11,1,1,1)
D ADD^LRWOMEN
"^DD",63,63.09,.11,1,1,2)
D DEL^LRWOMEN
"^DD",63,63.09,.11,1,1,"%D",0)
^^2^2^2990219^
"^DD",63,63.09,.11,1,1,"%D",1,0)
This cross reference will send notification to the Women's Health Program
"^DD",63,63.09,.11,1,1,"%D",2,0)
when a Cytology specimen is Verified/Released from the Laboratory package.
"^DD",63,63.09,.11,1,1,"DT")
2990219
"^DD",63,63.09,.11,3)
ONLY CURRENT DATE/TIME ALLOWED
"^DD",63,63.09,.11,4)
K DZ
"^DD",63,63.09,.11,21,0)
^^1^1^2950908^^^
"^DD",63,63.09,.11,21,1,0)
Date report was released
"^DD",63,63.09,.11,"DT")
2990219
"^DIC",62.48,62.48,0)
LA7 MESSAGE PARAMETER^62.48
"^DIC",62.48,62.48,0,"GL")
^LAHM(62.48,
"^DIC",62.48,62.48,"%D",0)
^^2^2^2970205^^^^
"^DIC",62.48,62.48,"%D",1,0)
This file is used to store parameters associated with a Lab Messaging
"^DIC",62.48,62.48,"%D",2,0)
system configuration.
"^DIC",62.48,"B","LA7 MESSAGE PARAMETER",62.48)

"^DIC",62.485,62.485,0)
LA7 MESSAGE LOG BULLETINS^62.485
"^DIC",62.485,62.485,0,"GL")
^LAHM(62.485,
"^DIC",62.485,62.485,"%D",0)
^^8^8^2970612^
"^DIC",62.485,62.485,"%D",1,0)
This file stores canned text for logging errors or exceptional 
"^DIC",62.485,62.485,"%D",2,0)
conditions during message processing.
"^DIC",62.485,62.485,"%D",3,0)
 
"^DIC",62.485,62.485,"%D",4,0)
This file should not be edited locally by the site, but if a local
"^DIC",62.485,62.485,"%D",5,0)
messaging system is developed, and entries must be added, the site
"^DIC",62.485,62.485,"%D",6,0)
should add new entries at entry numbers higher than 999. It is preferred
"^DIC",62.485,62.485,"%D",7,0)
that the local codes be preceded with the three digit primary site number
"^DIC",62.485,62.485,"%D",8,0)
which would result in a seven digit number, site #_xxxx.
"^DIC",62.485,"B","LA7 MESSAGE LOG BULLETINS",62.485)

"BLD",7628,6)
^56
**END**
**END**
