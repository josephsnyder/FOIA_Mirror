Released EAS*1*105 SEQ #88
Extracted from mail message
**KIDS**:EAS*1.0*105^

**INSTALL NAME**
EAS*1.0*105
"BLD",9202,0)
EAS*1.0*105^ENROLLMENT APPLICATION SYSTEM^0^3130117^y
"BLD",9202,1,0)
^^6^6^3130117^
"BLD",9202,1,1,0)
This patch addresses the issue that the Calculated LTC Copayments 
"BLD",9202,1,2,0)
Print report [EASEC LTC COPAY PRINT], can in certain circumstances 
"BLD",9202,1,3,0)
provide estimates that are different from what the actual billing option 
"BLD",9202,1,4,0)
LTC Billing Clock [IBAEC LTC CLOCK INQURIY] generates. A disclaimer has 
"BLD",9202,1,5,0)
been inserted stating that the Calculated LTC Copayments Print report 
"BLD",9202,1,6,0)
provides projected estimates.
"BLD",9202,4,0)
^9.64PA^^
"BLD",9202,6.3)
4
"BLD",9202,"KRN",0)
^9.67PA^779.2^20
"BLD",9202,"KRN",.4,0)
.4
"BLD",9202,"KRN",.401,0)
.401
"BLD",9202,"KRN",.402,0)
.402
"BLD",9202,"KRN",.403,0)
.403
"BLD",9202,"KRN",.5,0)
.5
"BLD",9202,"KRN",.84,0)
.84
"BLD",9202,"KRN",3.6,0)
3.6
"BLD",9202,"KRN",3.8,0)
3.8
"BLD",9202,"KRN",9.2,0)
9.2
"BLD",9202,"KRN",9.8,0)
9.8
"BLD",9202,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9202,"KRN",9.8,"NM",1,0)
EASECPC^^0^B24232664
"BLD",9202,"KRN",9.8,"NM",2,0)
EASECPC1^^0^B78976052
"BLD",9202,"KRN",9.8,"NM","B","EASECPC",1)

"BLD",9202,"KRN",9.8,"NM","B","EASECPC1",2)

"BLD",9202,"KRN",19,0)
19
"BLD",9202,"KRN",19.1,0)
19.1
"BLD",9202,"KRN",101,0)
101
"BLD",9202,"KRN",409.61,0)
409.61
"BLD",9202,"KRN",771,0)
771
"BLD",9202,"KRN",779.2,0)
779.2
"BLD",9202,"KRN",870,0)
870
"BLD",9202,"KRN",8989.51,0)
8989.51
"BLD",9202,"KRN",8989.52,0)
8989.52
"BLD",9202,"KRN",8994,0)
8994
"BLD",9202,"KRN","B",.4,.4)

"BLD",9202,"KRN","B",.401,.401)

"BLD",9202,"KRN","B",.402,.402)

"BLD",9202,"KRN","B",.403,.403)

"BLD",9202,"KRN","B",.5,.5)

"BLD",9202,"KRN","B",.84,.84)

"BLD",9202,"KRN","B",3.6,3.6)

"BLD",9202,"KRN","B",3.8,3.8)

"BLD",9202,"KRN","B",9.2,9.2)

"BLD",9202,"KRN","B",9.8,9.8)

"BLD",9202,"KRN","B",19,19)

"BLD",9202,"KRN","B",19.1,19.1)

"BLD",9202,"KRN","B",101,101)

"BLD",9202,"KRN","B",409.61,409.61)

"BLD",9202,"KRN","B",771,771)

"BLD",9202,"KRN","B",779.2,779.2)

"BLD",9202,"KRN","B",870,870)

"BLD",9202,"KRN","B",8989.51,8989.51)

"BLD",9202,"KRN","B",8989.52,8989.52)

"BLD",9202,"KRN","B",8994,8994)

"BLD",9202,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",9202,"QUES",0)
^9.62^^
"BLD",9202,"REQB",0)
^9.611^1^1
"BLD",9202,"REQB",1,0)
EAS*1.0*79^2
"BLD",9202,"REQB","B","EAS*1.0*79",1)

"MBREQ")
0
"PKG",552,-1)
1^1
"PKG",552,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",552,20,0)
^9.402P^2^1
"PKG",552,20,2,0)
2^^EASXDR
"PKG",552,20,2,1)
 
"PKG",552,20,"B",2,2)

"PKG",552,22,0)
^9.49I^1^1
"PKG",552,22,1,0)
1.0^3010315^3010419^66481
"PKG",552,22,1,"PAH",1,0)
105^3130117
"PKG",552,22,1,"PAH",1,1,0)
^^6^6^3130117
"PKG",552,22,1,"PAH",1,1,1,0)
This patch addresses the issue that the Calculated LTC Copayments 
"PKG",552,22,1,"PAH",1,1,2,0)
Print report [EASEC LTC COPAY PRINT], can in certain circumstances 
"PKG",552,22,1,"PAH",1,1,3,0)
provide estimates that are different from what the actual billing option 
"PKG",552,22,1,"PAH",1,1,4,0)
LTC Billing Clock [IBAEC LTC CLOCK INQURIY] generates. A disclaimer has 
"PKG",552,22,1,"PAH",1,1,5,0)
been inserted stating that the Calculated LTC Copayments Print report 
"PKG",552,22,1,"PAH",1,1,6,0)
provides projected estimates.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","EASECPC")
0^1^B24232664^B16405138
"RTN","EASECPC",1,0)
EASECPC ;ALB/PHH,CKN,LBD,AMA,SCK - LTC Copayment Report; 29-AUG-2001 ; 12/10/12 5:37pm
"RTN","EASECPC",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,19,24,34,40,79,105**;Mar 15, 2001;Build 4
"RTN","EASECPC",3,0)
 ;
"RTN","EASECPC",4,0)
 ; This routine prints a report of calculated LTC copayments for a veteran.
"RTN","EASECPC",5,0)
 ; It is called by menu option EASEC LTC COPAY PRINT
"RTN","EASECPC",6,0)
 ;
"RTN","EASECPC",7,0)
EN N DFN,EASRPT,EASADM,EASRDT,MAXRT,DGMTI,DGMTDT
"RTN","EASECPC",8,0)
 ; Select which report to print (1=Institutional (IP); 2=Non-Institutional (OP))
"RTN","EASECPC",9,0)
 D DISCMSG
"RTN","EASECPC",10,0)
 S EASRPT=$$RPT Q:'EASRPT
"RTN","EASECPC",11,0)
 ; Select Patient
"RTN","EASECPC",12,0)
 S DFN=$$GETDFN Q:'DFN
"RTN","EASECPC",13,0)
 S EASADM=""
"RTN","EASECPC",14,0)
 ; Get the LTC admission date (if EASRPT=1)
"RTN","EASECPC",15,0)
 I EASRPT=1 S EASADM=$$ADMDT Q:'EASADM
"RTN","EASECPC",16,0)
 ;E  S EASADM=""   ;EAS*1.0*79
"RTN","EASECPC",17,0)
 ; Get start date for report
"RTN","EASECPC",18,0)
 S EASRDT=$$RPTDT Q:'EASRDT
"RTN","EASECPC",19,0)
 ;EAS*1.0*79 - moved from 4 lines up, and added EASADM as a parameter
"RTN","EASECPC",20,0)
 ;Set EASADM to the report date for Non-Institutional (OP) reports
"RTN","EASECPC",21,0)
 I EASRPT=2 S EASADM=EASRDT
"RTN","EASECPC",22,0)
 ; Get most recent LTC Copay Test for patient and set up LTC variables
"RTN","EASECPC",23,0)
 I '$$GETLTC(DFN,EASADM) Q
"RTN","EASECPC",24,0)
 ; Run the report
"RTN","EASECPC",25,0)
 D QUE
"RTN","EASECPC",26,0)
 Q
"RTN","EASECPC",27,0)
RPT() ; Select which report to print
"RTN","EASECPC",28,0)
 ; Input:   None
"RTN","EASECPC",29,0)
 ; Output:  Y - Report Type (1=Institutional (IP); 2=Non-Institutional (OP); 0=Quit)
"RTN","EASECPC",30,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","EASECPC",31,0)
 W !!,"Report of Calculated Long Term Care Copayments"
"RTN","EASECPC",32,0)
 W !,"=============================================="
"RTN","EASECPC",33,0)
 S DIR(0)="S^1:Institutional (Inpatient);2:Non-Institutional (Outpatient)"
"RTN","EASECPC",34,0)
 S DIR("A")="Enter 1 or 2"
"RTN","EASECPC",35,0)
 D ^DIR I 'Y!($D(DTOUT))!($D(DUOUT)) Q 0
"RTN","EASECPC",36,0)
 Q Y
"RTN","EASECPC",37,0)
GETDFN() ; Get the veteran's DFN
"RTN","EASECPC",38,0)
 N DIC,DTOUT,DUOUT,X,Y
"RTN","EASECPC",39,0)
 W !
"RTN","EASECPC",40,0)
 S DIC="^DPT(",DIC(0)="AEMZQ",DIC("S")="I $D(^DGMT(408.31,""AID"",3,+Y))"
"RTN","EASECPC",41,0)
 D ^DIC
"RTN","EASECPC",42,0)
 Q:$D(DTOUT)!($D(DUOUT)) 0
"RTN","EASECPC",43,0)
 Q:Y<0 0
"RTN","EASECPC",44,0)
 Q +Y
"RTN","EASECPC",45,0)
 ;EAS*1.0*79 - added EASADM as a parameter
"RTN","EASECPC",46,0)
GETLTC(DFN,EASADM) ; Get the most recent LTC copay test.  If no completed test on
"RTN","EASECPC",47,0)
 ; file, test status is exempt or LTC copay rates not defined, quit 0
"RTN","EASECPC",48,0)
 ; Input:   DFN - Patient file IEN
"RTN","EASECPC",49,0)
 ;          EASADM - LTC Admission Date
"RTN","EASECPC",50,0)
 ; Output:  DGMTI - LTC Copay Test IEN (file #408.31)
"RTN","EASECPC",51,0)
 ;          DGMTDT - LTC Copay Test Date
"RTN","EASECPC",52,0)
 ;          MAXRT - Maximum daily copay rates for OP and IP LTC
"RTN","EASECPC",53,0)
 ;          1=OK to continue; 0=Not OK to continue
"RTN","EASECPC",54,0)
 N LTC,STAT
"RTN","EASECPC",55,0)
 ;EAS*1.0*79 - added EASADM to $$LST call, and text in WRITE line following
"RTN","EASECPC",56,0)
 S LTC=$$LST^EASECU(DFN,EASADM),DGMTI=+LTC
"RTN","EASECPC",57,0)
 I 'DGMTI W !!,"No LTC Copayment Test on file for this veteran for that LTC admission date!" Q 0
"RTN","EASECPC",58,0)
 S DGMTDT=$P(LTC,U,2),STAT=$P(LTC,U,3)
"RTN","EASECPC",59,0)
 ; Get the maximum daily copay rate for outpatient and inpatient LTC
"RTN","EASECPC",60,0)
 ; DBIA #3717
"RTN","EASECPC",61,0)
 S MAXRT=$$MAXRATE^IBAECU(DGMTDT)
"RTN","EASECPC",62,0)
 I '$P(MAXRT,U)!('$P(MAXRT,U,2)) W !!,"Copayment rates for LTC are not available at this time.",!! Q 0
"RTN","EASECPC",63,0)
 ; Check test status, if anything other than Non-Exempt don't continue
"RTN","EASECPC",64,0)
 D DISDT^EASECU(DFN,EASADM)   ;EAS*1.0*79
"RTN","EASECPC",65,0)
 I STAT="NON-EXEMPT" Q 1
"RTN","EASECPC",66,0)
 I STAT="" W !!,"The LTC Copayment Test is incomplete!" Q 0
"RTN","EASECPC",67,0)
 I STAT="EXEMPT" W !!,"This veteran is Exempt from LTC copayments!" Q 0
"RTN","EASECPC",68,0)
 W !!,"This LTC Copayment Test contains an invalid status!"
"RTN","EASECPC",69,0)
 Q 0
"RTN","EASECPC",70,0)
ADMDT() ; Get the LTC admission date (for IP report only)
"RTN","EASECPC",71,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","EASECPC",72,0)
 W !
"RTN","EASECPC",73,0)
 S DIR(0)="D^::EX"
"RTN","EASECPC",74,0)
 S DIR("A")="Enter the LTC Admission Date"
"RTN","EASECPC",75,0)
 S DIR("?",1)="Enter the admission date for the current institutional"
"RTN","EASECPC",76,0)
 S DIR("?")="Long Term Care episode."
"RTN","EASECPC",77,0)
 D ^DIR I 'Y!($D(DTOUT))!($D(DUOUT)) Q 0
"RTN","EASECPC",78,0)
 Q Y
"RTN","EASECPC",79,0)
RPTDT() ; Get the start date for the report
"RTN","EASECPC",80,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,DAYS
"RTN","EASECPC",81,0)
RD W !
"RTN","EASECPC",82,0)
 S DIR(0)="D^::EMX"
"RTN","EASECPC",83,0)
 S DIR("A")="Enter the Report Start Date (Month/Year)"
"RTN","EASECPC",84,0)
 S DIR("?",1)="Enter the starting date for the report in the format month/year (e.g. 9/03)."
"RTN","EASECPC",85,0)
 S DIR("?",2)="The report will print 12 months of copayments starting with the"
"RTN","EASECPC",86,0)
 S DIR("?")="month and year entered."
"RTN","EASECPC",87,0)
 D ^DIR I 'Y!($D(DTOUT))!($D(DUOUT)) Q 0
"RTN","EASECPC",88,0)
 S DAYS=$$DOM^EASECPC1(Y)
"RTN","EASECPC",89,0)
 I (Y+DAYS)<$G(EASADM) W !!,*7,"Report Start Date cannot be before LTC Admission Date!" G RD
"RTN","EASECPC",90,0)
 Q Y+DAYS
"RTN","EASECPC",91,0)
 ;
"RTN","EASECPC",92,0)
QUE ; Get report device. Queue report if requested.
"RTN","EASECPC",93,0)
 N POP,ZTRTN,ZTDESC,ZTSAVE
"RTN","EASECPC",94,0)
 K IOP,%ZIS
"RTN","EASECPC",95,0)
 S %ZIS="MQ"
"RTN","EASECPC",96,0)
 W !
"RTN","EASECPC",97,0)
 D ^%ZIS I POP W !!,"Report Cancelled!" Q
"RTN","EASECPC",98,0)
 I $D(IO("Q")) D  Q
"RTN","EASECPC",99,0)
 . S ZTRTN="START^EASECPC1"
"RTN","EASECPC",100,0)
 . S ZTDESC="LTC Copay Calculation Report"
"RTN","EASECPC",101,0)
 . S (ZTSAVE("DFN"),ZTSAVE("DGMTI"),ZTSAVE("DGMTDT"),ZTSAVE("MAXRT"))=""
"RTN","EASECPC",102,0)
 . S (ZTSAVE("EASRPT"),ZTSAVE("EASRDT"))="",ZTSAVE("EASADM")=$G(EASADM)
"RTN","EASECPC",103,0)
 . D ^%ZTLOAD
"RTN","EASECPC",104,0)
 . W !!,"Report "_$S($D(ZTSK):"Queued!",1:"Cancelled!")
"RTN","EASECPC",105,0)
 . D HOME^%ZIS
"RTN","EASECPC",106,0)
 D START^EASECPC1,^%ZISC
"RTN","EASECPC",107,0)
 Q
"RTN","EASECPC",108,0)
DISCMSG ;EAS*1*105 This is a disclaimer to remind users that this report
"RTN","EASECPC",109,0)
        ; is only for estimates and that values can change.
"RTN","EASECPC",110,0)
 W !!,"** This report is intended to provide a projected estimate of charges that"
"RTN","EASECPC",111,0)
 W !,"should generate for a patient admitted for a LTC stay. These estimates are"
"RTN","EASECPC",112,0)
 W !,"dependent on existing conditions with the projected estimate out to a year "
"RTN","EASECPC",113,0)
 W !,"being presented in the report. Be advised that changing circumstances or newer"
"RTN","EASECPC",114,0)
 W !,"LTC Copay tests within this timeframe could impact these projected estimates"
"RTN","EASECPC",115,0)
 W !,"and a discrepancy can exist from the actual charges billing generates. **"
"RTN","EASECPC",116,0)
 Q
"RTN","EASECPC1")
0^2^B78976052^B77767454
"RTN","EASECPC1",1,0)
EASECPC1 ;ALB/LBD,CKN - LTC CoPayment Report continuation ; 12/10/12 5:29pm
"RTN","EASECPC1",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**7,24,40,105**;Mar 15, 2001;Build 4
"RTN","EASECPC1",3,0)
 ;
"RTN","EASECPC1",4,0)
 ; This routine is a continuation of EASECPC.
"RTN","EASECPC1",5,0)
 ;
"RTN","EASECPC1",6,0)
 ; Input:  DFN - Patient file IEN
"RTN","EASECPC1",7,0)
 ;         DGMTI - LTC Copay Test IEN (file #408.31)
"RTN","EASECPC1",8,0)
 ;         DGMTDT - LTC Copay Test Date
"RTN","EASECPC1",9,0)
 ;         MAXRT - Maximum daily copay rates for LTC (OP^IP)
"RTN","EASECPC1",10,0)
 ;         EASRPT - Report type:  1=Institutional (IP)
"RTN","EASECPC1",11,0)
 ;                                2=Non-Institutional (OP)
"RTN","EASECPC1",12,0)
 ;         EASRDT - Report start date
"RTN","EASECPC1",13,0)
 ;         EASADM - LTC admission date (only if EASRPT=1)
"RTN","EASECPC1",14,0)
 ;
"RTN","EASECPC1",15,0)
START ; Generate Report
"RTN","EASECPC1",16,0)
 N ARRY,IPRPT,DGSP,SRIC,LSEP,DECINF,AGRPAY,ERR
"RTN","EASECPC1",17,0)
 I $G(ZTSK) S ZTREQ="@"
"RTN","EASECPC1",18,0)
 D INIT(EASRDT,.ARRY)
"RTN","EASECPC1",19,0)
 D BLDTBL(.ARRY) Q:$G(ERR)
"RTN","EASECPC1",20,0)
 D PRINT
"RTN","EASECPC1",21,0)
 Q
"RTN","EASECPC1",22,0)
PRINT ; Print the Report
"RTN","EASECPC1",23,0)
 N CRT,PAGE,RPTDT,LINE,HDR,CALC1,CALC2,SIDX,EIDX,MNTH,NAME,SSN,DOB,LOS
"RTN","EASECPC1",24,0)
 D PRTVAR
"RTN","EASECPC1",25,0)
 U IO
"RTN","EASECPC1",26,0)
 D HEADER
"RTN","EASECPC1",27,0)
 W !,$S(DGSP:"MARRIED",LSEP:"LEGALLY SEPARATED",1:"SINGLE")
"RTN","EASECPC1",28,0)
 W:SRIC ?15,"SPOUSE RESIDING IN THE COMMUNITY"
"RTN","EASECPC1",29,0)
 I DECINF,AGRPAY W !,"*** DECLINED TO PROVIDE INCOME INFORMATION -- AGREED TO PAY COPAYMENTS ***"
"RTN","EASECPC1",30,0)
 I AGRPAY=0 W !,"*** VETERAN IS INELIGIBLE FOR LTC SERVICES -- REFUSED TO SIGN 10-10EC ***"
"RTN","EASECPC1",31,0)
 W !,"LTC COPAY TEST DATE: ",$$FMTE^XLFDT(DGMTDT)
"RTN","EASECPC1",32,0)
 W:$G(EASADM) ?47,"LTC ADMISSION DATE: ",$$FMTE^XLFDT(EASADM)
"RTN","EASECPC1",33,0)
 W !!!,"LTC COPAYMENT CALCULATION"_$S(IPRPT:"S:",1:":")
"RTN","EASECPC1",34,0)
 W ! W:IPRPT "FOR DAYS 1-180  " W CALC1
"RTN","EASECPC1",35,0)
 I IPRPT W !,"FOR DAYS 181+   " W CALC2
"RTN","EASECPC1",36,0)
 ;
"RTN","EASECPC1",37,0)
 S SIDX=1,EIDX=6
"RTN","EASECPC1",38,0)
 W !!,"              "
"RTN","EASECPC1",39,0)
 F MNTH=1:1:6 W $J($P(ARRY(MNTH),"^"),11)
"RTN","EASECPC1",40,0)
 I IPRPT D PRINTROW("TOT ASSETS    ",SIDX,EIDX,9)
"RTN","EASECPC1",41,0)
 D PRINTROW("TOT INCOME    ",SIDX,EIDX,3)
"RTN","EASECPC1",42,0)
 I 'IPRPT!($G(LOS)<181)!(DGSP&(SRIC)) D PRINTROW("TOT EXPENSES  ",SIDX,EIDX,4)
"RTN","EASECPC1",43,0)
 D PRINTROW("TOT ALLOWANCE ",SIDX,EIDX,5)
"RTN","EASECPC1",44,0)
 W ! D PRINTROW("CALC COPAY    ",SIDX,EIDX,6)
"RTN","EASECPC1",45,0)
 D PRINTROW("MAX COPAY     ",SIDX,EIDX,7)
"RTN","EASECPC1",46,0)
 W !,LINE
"RTN","EASECPC1",47,0)
 D PRINTROW("VET COPAY     ",SIDX,EIDX,8)
"RTN","EASECPC1",48,0)
 W !,LINE
"RTN","EASECPC1",49,0)
 ;
"RTN","EASECPC1",50,0)
 S SIDX=7,EIDX=12
"RTN","EASECPC1",51,0)
 W !!,"              "
"RTN","EASECPC1",52,0)
 F MNTH=7:1:12 W $J($P(ARRY(MNTH),"^"),11)
"RTN","EASECPC1",53,0)
 I IPRPT D PRINTROW("TOT ASSETS    ",SIDX,EIDX,9)
"RTN","EASECPC1",54,0)
 D PRINTROW("TOT INCOME    ",SIDX,EIDX,3)
"RTN","EASECPC1",55,0)
 I 'IPRPT!(DGSP&(SRIC)) D PRINTROW("TOT EXPENSES  ",SIDX,EIDX,4)
"RTN","EASECPC1",56,0)
 D PRINTROW("TOT ALLOWANCE ",SIDX,EIDX,5)
"RTN","EASECPC1",57,0)
 W ! D PRINTROW("CALC COPAY    ",SIDX,EIDX,6)
"RTN","EASECPC1",58,0)
 D PRINTROW("MAX COPAY     ",SIDX,EIDX,7)
"RTN","EASECPC1",59,0)
 W !,LINE
"RTN","EASECPC1",60,0)
 D PRINTROW("VET COPAY     ",SIDX,EIDX,8)
"RTN","EASECPC1",61,0)
 W !,LINE
"RTN","EASECPC1",62,0)
 ;
"RTN","EASECPC1",63,0)
 I CRT Q:$$PAUSE(0)
"RTN","EASECPC1",64,0)
 D:CRT HEADER
"RTN","EASECPC1",65,0)
 D NOTETXT
"RTN","EASECPC1",66,0)
 I CRT Q:$$PAUSE(0)
"RTN","EASECPC1",67,0)
 I IPRPT D HEADER,SPNDDWN I CRT Q:$$PAUSE(0)
"RTN","EASECPC1",68,0)
 Q
"RTN","EASECPC1",69,0)
PRINTROW(TEXT,SIDX,EIDX,NODE) ; Print the Rows
"RTN","EASECPC1",70,0)
 N MNTH
"RTN","EASECPC1",71,0)
 W !,TEXT
"RTN","EASECPC1",72,0)
 F MNTH=SIDX:1:EIDX W $J($S($P(ARRY(MNTH),"^",NODE)[".":$P($P(ARRY(MNTH),"^",NODE),"."),1:$P(ARRY(MNTH),"^",NODE)),11)
"RTN","EASECPC1",73,0)
 Q
"RTN","EASECPC1",74,0)
PRTVAR ; Set up variables needed to print report
"RTN","EASECPC1",75,0)
 N PAT0
"RTN","EASECPC1",76,0)
 S CRT=$S($E(IOST,1,2)="C-":1,1:0)
"RTN","EASECPC1",77,0)
 S PAGE=0,RPTDT=$$FMTE^XLFDT(DT)
"RTN","EASECPC1",78,0)
 S LINE="",$P(LINE,"-",81)=""
"RTN","EASECPC1",79,0)
 S HDR=$$CJ^XLFSTR("LONG TERM CARE ESTIMATED COPAYMENTS FOR "_$S('IPRPT:"NON-",1:"")_"INSTITUTIONAL SERVICES",80)
"RTN","EASECPC1",80,0)
 S PAT0=$G(^DPT(DFN,0)),NAME=$P(PAT0,"^"),DOB=$P(PAT0,"^",3)
"RTN","EASECPC1",81,0)
 S SSN=$P(PAT0,"^",9),SSN=$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","EASECPC1",82,0)
 S CALC1="TOTAL INCOME - TOTAL EXPENSES - TOTAL ALLOWANCE"
"RTN","EASECPC1",83,0)
 I DGSP,SRIC S CALC2="(TOTAL ASSETS + TOTAL INCOME) - TOTAL EXPENSES - TOTAL ALLOWANCE"
"RTN","EASECPC1",84,0)
 E  S CALC2="(TOTAL ASSETS + TOTAL INCOME) - TOTAL ALLOWANCE"
"RTN","EASECPC1",85,0)
 S:$G(EASADM) LOS=$$FMDIFF^XLFDT(EASRDT,EASADM)
"RTN","EASECPC1",86,0)
 Q
"RTN","EASECPC1",87,0)
HEADER ; Print the header
"RTN","EASECPC1",88,0)
 S PAGE=PAGE+1
"RTN","EASECPC1",89,0)
 W @IOF
"RTN","EASECPC1",90,0)
 W RPTDT,?71,"Page: ",$J(PAGE,3)
"RTN","EASECPC1",91,0)
 W !!,HDR
"RTN","EASECPC1",92,0)
 W !!?6,"**This report contains projected estimates based on existing data**"
"RTN","EASECPC1",93,0)
 W !!,NAME,?35,SSN,?62,"DOB: ",$$FMTE^XLFDT(DOB)
"RTN","EASECPC1",94,0)
 Q
"RTN","EASECPC1",95,0)
PAUSE(RESP) ; Prompt user for next page or quit
"RTN","EASECPC1",96,0)
 N DIR,DIRUT,DUOUT,DTOUT,U,X,Y
"RTN","EASECPC1",97,0)
 S DIR(0)="E"
"RTN","EASECPC1",98,0)
 D ^DIR
"RTN","EASECPC1",99,0)
 I 'Y S RESP=1
"RTN","EASECPC1",100,0)
 Q RESP
"RTN","EASECPC1",101,0)
 ;
"RTN","EASECPC1",102,0)
INIT(DATE,ARRY) ; Initialize the Month/Year Table
"RTN","EASECPC1",103,0)
 N IDX,MNYR
"RTN","EASECPC1",104,0)
 S MNYR=$E(DATE,1,5)_"00"
"RTN","EASECPC1",105,0)
 F IDX=1:1:12 D
"RTN","EASECPC1",106,0)
 .S ARRY(IDX)=$$UP^XLFSTR($$FMTE^XLFDT(MNYR))
"RTN","EASECPC1",107,0)
 .S ARRY(IDX)=$P(ARRY(IDX)," ")_"'"_$E($P(ARRY(IDX)," ",2),3,4)
"RTN","EASECPC1",108,0)
 .S $P(ARRY(IDX),"^",2)=MNYR
"RTN","EASECPC1",109,0)
 .S MNYR=MNYR+100
"RTN","EASECPC1",110,0)
 .S:$E(MNYR,4,5)=13 MNYR=$E(MNYR,1,3)+1_"0100"
"RTN","EASECPC1",111,0)
 Q
"RTN","EASECPC1",112,0)
BLDTBL(ARRY) ; Get the veteran's financial data, do the copay calculations,
"RTN","EASECPC1",113,0)
 ; build the data table
"RTN","EASECPC1",114,0)
 ;
"RTN","EASECPC1",115,0)
 N DGDC,DGDEP,DGERR,DGFL,DGIN0,DGIN1,DGIN2,DGINI,DGIRI,DGDET,DGINT,DGNWT
"RTN","EASECPC1",116,0)
 N DGPRI,DGNC,DGND,DGNWTF,DGVINI,DGVIR0,DGVIRI,DGVPRI,DGINTF,CPYFLG,IDX
"RTN","EASECPC1",117,0)
 N OVR180,TAST,TINC,TEXP,ALLOW,CALCCPY,DAYS,MAXCPY,VETMAX,IPDR,OPDR,LOS
"RTN","EASECPC1",118,0)
 ;
"RTN","EASECPC1",119,0)
 S ERR=0
"RTN","EASECPC1",120,0)
 S DGPRI=$O(^DGPR(408.12,"C",DFN_";DPT(",0)) I 'DGPRI S ERR=1 Q
"RTN","EASECPC1",121,0)
 D GETIENS^EASECU2(DFN,DGPRI,DGMTDT) I '$G(DGIRI),'$G(DGINI) S ERR=1 Q
"RTN","EASECPC1",122,0)
 S DGVIRI=DGIRI,DGVINI=DGINI
"RTN","EASECPC1",123,0)
 D DEP^EASECSU3,INC^EASECSU3
"RTN","EASECPC1",124,0)
 S IPRPT=$S(EASRPT=1:1,1:0)
"RTN","EASECPC1",125,0)
 S CPYFLG=0
"RTN","EASECPC1",126,0)
 S DECINF=$P($G(^DGMT(408.31,DGMTI,0)),"^",14)
"RTN","EASECPC1",127,0)
 S AGRPAY=$P($G(^DGMT(408.31,DGMTI,0)),"^",11)
"RTN","EASECPC1",128,0)
 I DECINF=1!(AGRPAY=0) S CPYFLG=1
"RTN","EASECPC1",129,0)
 S SRIC=$P(DGVIR0,U,16),LSEP=$P(DGVIR0,U,17)
"RTN","EASECPC1",130,0)
 S OPDR=$P(MAXRT,U),IPDR=$P(MAXRT,U,2)
"RTN","EASECPC1",131,0)
 I IPRPT S LOS=$$FMDIFF^XLFDT(EASRDT,EASADM)+1
"RTN","EASECPC1",132,0)
 ;
"RTN","EASECPC1",133,0)
 S OVR180=$S($G(LOS)>180:1,1:0)
"RTN","EASECPC1",134,0)
 S TINC=DGINT/12,TEXP=DGDET/12
"RTN","EASECPC1",135,0)
 I OVR180,('DGSP!('SRIC)) S TEXP=0
"RTN","EASECPC1",136,0)
 S TAST=DGNWT I OVR180 S TAST=$$ASSET
"RTN","EASECPC1",137,0)
 ;
"RTN","EASECPC1",138,0)
 ; Build data table
"RTN","EASECPC1",139,0)
 F IDX=1:1:12 D
"RTN","EASECPC1",140,0)
 .S DAYS=$$DOM($P(ARRY(IDX),"^",2))
"RTN","EASECPC1",141,0)
 .D CALCALL
"RTN","EASECPC1",142,0)
 .S $P(ARRY(IDX),"^",3)=TINC
"RTN","EASECPC1",143,0)
 .S $P(ARRY(IDX),"^",4)=TEXP
"RTN","EASECPC1",144,0)
 .S $P(ARRY(IDX),"^",5)=ALLOW
"RTN","EASECPC1",145,0)
 .S $P(ARRY(IDX),"^",6)=CALCCPY
"RTN","EASECPC1",146,0)
 .S $P(ARRY(IDX),"^",7)=MAXCPY
"RTN","EASECPC1",147,0)
 .S $P(ARRY(IDX),"^",8)=VETMAX
"RTN","EASECPC1",148,0)
 .S $P(ARRY(IDX),"^",9)=$S(OVR180:TAST,1:"-")
"RTN","EASECPC1",149,0)
 .S:OVR180 TAST=$$ASTSPD
"RTN","EASECPC1",150,0)
 .I $G(LOS) D
"RTN","EASECPC1",151,0)
 ..S LOS=LOS+DAYS
"RTN","EASECPC1",152,0)
 ..S:'OVR180 OVR180=$S(LOS>180:1,1:0)
"RTN","EASECPC1",153,0)
 ..I OVR180,('DGSP!'(SRIC)) S:TEXP TEXP=0
"RTN","EASECPC1",154,0)
 Q
"RTN","EASECPC1",155,0)
 ;
"RTN","EASECPC1",156,0)
CALCALL ; Calculate the allowance and all the copayment amounts
"RTN","EASECPC1",157,0)
 S ALLOW=20*DAYS*(1+SRIC) S:CPYFLG ALLOW=0
"RTN","EASECPC1",158,0)
 S CALCCPY=$$CALCCPY
"RTN","EASECPC1",159,0)
 S MAXCPY=$$CALCMAX(DAYS)
"RTN","EASECPC1",160,0)
 S VETMAX=$$VETMAX(CALCCPY,MAXCPY)
"RTN","EASECPC1",161,0)
 Q
"RTN","EASECPC1",162,0)
ASSET() ; Initialize asset amount by applying spend-down
"RTN","EASECPC1",163,0)
 N NUM,MNYR,J,DONE,DAYS,ALLOW,CALCCPY,MAXCPY,VETMAX
"RTN","EASECPC1",164,0)
 S DONE=0
"RTN","EASECPC1",165,0)
 ; Calculate number of months to spend down the assets
"RTN","EASECPC1",166,0)
 S NUM=(LOS-180)\30
"RTN","EASECPC1",167,0)
 ; Get month to start spend down
"RTN","EASECPC1",168,0)
 S MNYR=$$FMADD^XLFDT(EASADM,180)
"RTN","EASECPC1",169,0)
 I NUM>0 F J=1:1:NUM D  Q:DONE
"RTN","EASECPC1",170,0)
 .S DAYS=$$DOM(MNYR)
"RTN","EASECPC1",171,0)
 .D CALCALL
"RTN","EASECPC1",172,0)
 .S TAST=$$ASTSPD I TAST=0 S DONE=1 Q
"RTN","EASECPC1",173,0)
 .S MNYR=MNYR+100 S:$E(MNYR,4,5)=13 MNYR=$E(MNYR,1,3)+1_"0100"
"RTN","EASECPC1",174,0)
 Q TAST
"RTN","EASECPC1",175,0)
ASTSPD() ;Asset Spend down for 180+ days
"RTN","EASECPC1",176,0)
 Q:CPYFLG TAST
"RTN","EASECPC1",177,0)
 I (TINC-TEXP-ALLOW)'>VETMAX D
"RTN","EASECPC1",178,0)
 . I DGSP,SRIC S TAST=TAST-(VETMAX-(TINC-TEXP-ALLOW))
"RTN","EASECPC1",179,0)
 . E  S TAST=TAST-(VETMAX-(TINC-ALLOW))
"RTN","EASECPC1",180,0)
 . S:TAST<0 TAST=0
"RTN","EASECPC1",181,0)
 Q TAST
"RTN","EASECPC1",182,0)
 ;
"RTN","EASECPC1",183,0)
CALCCPY() ; Calculate the Co-Pay Amount
"RTN","EASECPC1",184,0)
 ;
"RTN","EASECPC1",185,0)
 Q:CPYFLG 0
"RTN","EASECPC1",186,0)
 Q:OVR180 TAST+TINC-ALLOW-TEXP
"RTN","EASECPC1",187,0)
 Q TINC-ALLOW-TEXP
"RTN","EASECPC1",188,0)
DOM(MNYR) ; Days in Month
"RTN","EASECPC1",189,0)
 ; Returns: number of days in a month
"RTN","EASECPC1",190,0)
 N DAYS,MN,YR
"RTN","EASECPC1",191,0)
 S MN=+$E(MNYR,4,5)
"RTN","EASECPC1",192,0)
 I "^4^6^9^11^"[("^"_MN_"^") S DAYS=30 Q DAYS
"RTN","EASECPC1",193,0)
 I MN=2 D  Q DAYS
"RTN","EASECPC1",194,0)
 .S DAYS=28
"RTN","EASECPC1",195,0)
 .S YR=$E(MNYR,1,3)+1700
"RTN","EASECPC1",196,0)
 .S:YR#4=0 DAYS=29
"RTN","EASECPC1",197,0)
 S DAYS=31
"RTN","EASECPC1",198,0)
 Q DAYS
"RTN","EASECPC1",199,0)
CALCMAX(DAYS) ; Calculate the Maximum Co-Pay Amount
"RTN","EASECPC1",200,0)
 ;
"RTN","EASECPC1",201,0)
 Q $S(IPRPT:IPDR,1:OPDR)*DAYS
"RTN","EASECPC1",202,0)
VETMAX(CALCCPY,MAXCPY) ; Calculate the Veteran Maximum Co-Pay Amount
"RTN","EASECPC1",203,0)
 ;
"RTN","EASECPC1",204,0)
 Q:CPYFLG MAXCPY
"RTN","EASECPC1",205,0)
 Q:CALCCPY<0 0
"RTN","EASECPC1",206,0)
 Q:CALCCPY<MAXCPY CALCCPY
"RTN","EASECPC1",207,0)
 Q MAXCPY
"RTN","EASECPC1",208,0)
 ;
"RTN","EASECPC1",209,0)
NOTETXT ; Write the Note message
"RTN","EASECPC1",210,0)
 W !!,"IMPORTANT NOTICE: The copayment amounts shown in this report are"
"RTN","EASECPC1",211,0)
 W " estimates",!,"based on calculations of the copayment amount for "
"RTN","EASECPC1",212,0)
 W "an entire month. The",!,"copayment amounts will be adjusted to "
"RTN","EASECPC1",213,0)
 W "reflect the actual start date of LTC",!,"services and the "
"RTN","EASECPC1",214,0)
 W "copayment exemption for the first 21 days of service. The VET",!
"RTN","EASECPC1",215,0)
 W "COPAY amount is based on the assumption that the veteran "
"RTN","EASECPC1",216,0)
 W "will be responsible",!,"to pay the lesser of EITHER the calculated"
"RTN","EASECPC1",217,0)
 W " copayment (CALC COPAY) OR the",!,"maximum copayment (MAX COPAY).  "
"RTN","EASECPC1",218,0)
 W "In the event that the calculated copayment",!,"(CALC COPAY) is a "
"RTN","EASECPC1",219,0)
 W "negative figure, the veteran copayment (VET COPAY)",!
"RTN","EASECPC1",220,0)
 W "will be adjusted to zero (0). If the veteran declined to provide"
"RTN","EASECPC1",221,0)
 W " income",!,"information, the veteran will be obligated to pay the"
"RTN","EASECPC1",222,0)
 W " maximum copayment."
"RTN","EASECPC1",223,0)
 Q
"RTN","EASECPC1",224,0)
 ;
"RTN","EASECPC1",225,0)
SPNDDWN ; Text of message to explain the asset spend down
"RTN","EASECPC1",226,0)
 W !!,"EXPLANATION OF ASSET SPEND DOWN CALCULATION:"
"RTN","EASECPC1",227,0)
 W !,"============================================"
"RTN","EASECPC1",228,0)
 W !,"The veteran's assets are included in the calculation of copayments"
"RTN","EASECPC1",229,0)
 W !,"after 180 days of institutional LTC services.  The assets then may"
"RTN","EASECPC1",230,0)
 W !,"be reduced each month according to the following formula:"
"RTN","EASECPC1",231,0)
 W !
"RTN","EASECPC1",232,0)
 W !,"Single Veteran:"
"RTN","EASECPC1",233,0)
 W !
"RTN","EASECPC1",234,0)
 W !,"  TOTAL ASSETS-(VET COPAY-(INCOME-ALLOWANCE))"
"RTN","EASECPC1",235,0)
 W !
"RTN","EASECPC1",236,0)
 W !,"Married Veteran (spouse residing in the community):"
"RTN","EASECPC1",237,0)
 W !
"RTN","EASECPC1",238,0)
 W !,"  TOTAL ASSETS-(VET COPAY-(INCOME-EXPENSES-ALLOWANCE))"
"RTN","EASECPC1",239,0)
 W !
"RTN","EASECPC1",240,0)
 W !,"In other words, the assets will be reduced by the amount of the"
"RTN","EASECPC1",241,0)
 W !,"veteran's copayment that is not covered by the veteran's income "
"RTN","EASECPC1",242,0)
 W !,"after all expenses and allowances are subtracted.  If the amount"
"RTN","EASECPC1",243,0)
 W !,"of the veteran's income after all expenses and allowances are"
"RTN","EASECPC1",244,0)
 W !,"subtracted is greater than the veteran's copayment then the assets"
"RTN","EASECPC1",245,0)
 W !,"will not be reduced."
"RTN","EASECPC1",246,0)
 W !
"RTN","EASECPC1",247,0)
 Q
"VER")
8.0^22.0
**END**
**END**
