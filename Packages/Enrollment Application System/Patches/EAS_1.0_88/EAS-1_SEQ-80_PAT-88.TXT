$TXT Created by FERRARESE,MARY ANNE at MNTVLL.FO-ALBANY.MED.VA.GOV  (KIDS) on Monday, 08/17/09 at 11:16
=============================================================================
Run Date: MAY 12, 2010                     Designation: EAS*1*88
Package : EAS - ENROLLMENT APPLICATION SYSTEM Priority: Mandatory
Version : 1        SEQ #80                      Status: Released
                  Compliance Date: JUN 12, 2010
=============================================================================

Associated patches: (v)EAS*1*70    <<= must be installed BEFORE `EAS*1*88'

Subject: FIX ERROR IN DGMTSC FOR LTC COPAY TEST

Category: 
  - Routine

Description:
============

 This patch, EAS*1.0*88, addresses a problem where users are experiencing 
 a COMMAND system error when working with Long Term Care (LTC) means 
 tests.  This error occurs when entering or editing an LTC co-pay test.  
 It is occurring because the call point in the LTC processing expects to 
 receive a return value from another routine entry point, but does not.    
  
 This routine entry point is being modified to add a parameter to the 
 specific call point to use it as a regular call with parameters rather 
 than as a call to a function.  This new parameter will take the place of
 the value that was sometimes returned when means tests were executed.
  
 This patch addresses the following New Service Request (NSR):
 -------------------------------------------------------------
 There is no NSR associated with this patch.
  
  
 This patch addresses the following Remedy Ticket(s):
 ----------------------------------------------------
 HD0000000183451 - FIX ERROR IN DGMTSC FOR LTC COPAY TEST
      DUPLICATE: HD0000000236665
  
  
 Overview of Remedy Ticket(s):
 -----------------------------
 HD0000000183451 - FIX ERROR IN DGMTSC FOR LTC COPAY TEST
      DUPLICATE: HD0000000236665
  
 Problem:
 --------
 A COMMAND error occurs when entering or editing a long term care copay 
 test due to a coding problem.  The error occurs in DGMTSC, but is 
 actually caused by a bad module structure in routine EASECMT.
  
 Resolution:
 -----------
 The solution is very technical.  Part of the code in entry points MT and
 MT1 in the EASECMT routine need to be corrected so a system error does not
 occur.  One problem is that the MT1 entry point is called by other areas
 of the code and does not expect a return value, but MT1 is coded to return
 a value, causing the system error.  MT1 will be changed to not return a
 value.  The second problem is in the call to MT.  It is called as a
 function expecting a return value.  It CAN end without a value, which will
 produce the system error, or it CAN fall through to the MT1 entry point
 (that we've now changed NOT to return a value).  The solution to this then
 is to add a parameter to the end of the MT call and use it as a regular
 call with parameters rather than a call to a function.  This new parameter
 will take the place of the value that was sometimes returned when MT was
 executed.
  
  
 Test Sites:
 -----------
  
  Marion VA Medical Center, Marion, IL
  Miami VA Healthcare System, Miami, FL
  Carl Vinson VAMC, Dublin, GA
  
        ================INSTALLATION INSTRUCTIONS =================
  
 If installed during the normal workday, it is recommended that the 
 following selection in the OPTION (#19) file be disabled to prevent 
 possible conflicts while running the KIDS Install. Other VISTA users will 
 not be affected.
  
    [EASEC LTC COPAY MENU]  LTC Copayments Menu
  
 Install Time - less than 5 minutes
  
 1.  LOAD TRANSPORT GLOBAL 
     ---------------------
     Choose the PackMan message containing this patch and invoke the 
     INSTALL/CHECK MESSAGE PackMan option.  
              
 2.  START UP KIDS 
     -------------
     Start up the Kernel Installation and Distribution System Menu 
     [XPD MAIN]: 
    
          Edits and Distribution ...  
          Utilities ...  
          Installation ...  
    
 Select Kernel Installation & Distribution System Option: INStallation 
                                                          ---
          Load a Distribution 
          Print Transport Global 
          Compare Transport Global to Current System 
          Verify Checksums in Transport Global 
          Install Package(s) 
          Restart Install of Package(s) 
          Unload a Distribution 
          Backup a Transport Global 
    
 Select Installation Option: 
    
 3.  Select Installation Option: 
     ---------------------------
     NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
            NAME, enter EAS*1.0*88):
       
     a.  Backup a Transport Global - This option will create a backup
         message of any routines exported with this patch. It will not
         backup any other changes such as DD's or templates.
     b.  Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when this patch
         is installed.  It compares all components of this patch
         (routines, DD's, templates, etc.).
     c.  Verify Checksums in Transport Global - This option will allow
         you to ensure the integrity of the routines that are in the
         transport global.
      
 4.  Select Installation Option: Install Package(s) 
                                 ------------------
     **This is the step to start the installation of this KIDS patch: 
  
     a.  Choose the Install Package(s) option to start the patch
         install.
     b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
         YES//' answer NO
     c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
         Options, and Protocols? YES//' answer YES
     d.  When prompted 'Enter options you wish to mark as 'Out Of
         Order':'  Enter the following options:
   
              [EASEC LTC COPAY MENU]  LTC Copayments Menu
  
     e.  When prompted 'Enter protocols you wish to mark as 'Out Of
         Order':' press <return>.

Routine Information:
====================
The second line of each of these routines now looks like:
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**[Patch List]**;Mar 15, 2001;Build 3

The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: EASECMT
    Before: B36465428   After: B37169032  **7,16,18,70,88**
 Description of Changes:
  Change: EN+9
    From: N DGMTI,DGMTDT,DGMTYPT,DGMTACT,DGL,DGCS,DGMSGF,DGREQF,DGDOM,DGDOM
          1,Y
      To: N DGCMPLT,DGMTI,DGMTDT,DGMTYPT,DGMTACT,DGL,DGCS,DGMSGF,DGREQF,DGD
          OM,DGDOM1,Y
   
  Change: EN+22
    From: .I '$$MT(DFN,DGMTYPT,DGMTACT,.DGMTI) S DGOUT=1 Q 
      To: .D MT(DFN,DGMTYPT,DGMTACT,.DGMTI,.DGCMPLT)
          .I '$G(DGCMPLT) S DGOUT=1 Q
   
  Change: EN+33
    From: .I '$$MT(DFN,DGMTYPT,"ADD",.DGMTI) S DGOUT=1 Q 
      To: .D MT(DFN,DGMTYPT,"ADD",.DGMTI,.DGCMPLT)
          .I '$G(DGCMPLT) S DGOUT=1 Q
   
  Change: MT
    From: MT(DFN,TYPE,ACT,DGMTI) ; Complete a means test or LTC co-pay exemp
          tion test
      To: MT(DFN,TYPE,ACT,DGMTI,DGCMPLT) ; Complete a means test or LTC co-p
          ay exemption test
   
  Change: MT+5
    From: ; Output   -  EASECMT = 1 (MT completed)
      To: ; Output   -  DGCMPLT = 1 (MT completed)
   
  Change: MT+8 through MT+10
    From: N DGMTYPT,DGMTACT,DGMTROU,DGMT0,DGSTA,TYPESAVE,EASECMT
          S EASECMT=0
          I $$LOCK^DGMTUTL(DFN) E  Q EASECMT
      To: N DGMTYPT,DGMTACT,DGMTROU,DGMT0,DGSTA,TYPESAVE,DGCMPLT
          S DGCMPLT=0
          I $$LOCK^DGMTUTL(DFN) E  Q DGCMPLT
   
  Change: MT+13
    From: S DGMTDT=$S(DGMTACT="EDT":+$G(^DGMT(408.31,DGMTI,0)),1:DT) G MT1:'
          DGMTDT
      To: S DGMTDT=$S(DGMTACT="EDT":+$G(^DGMT(408.31,DGMTI,0)),1:DT) I 'DGMT
          DT D MT1 Q
   
  Change: MT+16
    From: I DGMTACT="ADD" S:TYPE=4 TYPE=1 D ADD^DGMTA S TYPE=TYPESAVE G MT1:'$G(DGMTI)
      To: I DGMTACT="ADD" S:TYPE=4 TYPE=1 D ADD^DGMTA S TYPE=TYPESAVE I '$G(DGMTI) D MT1 Q
   
  Change: MT1+2 through MT1+3
    From: .I DGSTA'="","ACP01"[DGSTA,$P(DGMT0,U,7)]"" S EASECMT=1
          .I 'EASECMT,TYPE=4 D DEL  ;Delete incomplete LTC copay exemption t
          est
      To: .I DGSTA'="","ACP01"[DGSTA,$P(DGMT0,U,7)]"" S DGCMPLT=1
          .I 'DGCMPLT,TYPE=4 D DEL  ;Delete incomplete LTC copay exemption t
          est
   
  Change: MT1+5
    From: Q +$G(EASECMT)
      To: Q

 
Routine list of preceding patches: 70

=============================================================================
User Information:
Entered By  : KOPP,TERRY M                  Date Entered  : SEP 09, 2008
Completed By: SBERRO,SANDRA                 Date Completed: MAY 03, 2010
Released By : GROOMS,ANTHONY E              Date Released : MAY 12, 2010
=============================================================================


Packman Mail Message:
=====================

$END TXT
