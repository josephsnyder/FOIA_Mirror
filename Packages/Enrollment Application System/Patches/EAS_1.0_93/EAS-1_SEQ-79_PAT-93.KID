Released EAS*1*93 SEQ #79
Extracted from mail message
**KIDS**:EAS*1.0*93^

**INSTALL NAME**
EAS*1.0*93
"BLD",7714,0)
EAS*1.0*93^ENROLLMENT APPLICATION SYSTEM^0^3090612^y
"BLD",7714,1,0)
^^2^2^3090313^
"BLD",7714,1,1,0)
Fixes errors reported by ^XINDEX utility due to LOCK commands withou 
"BLD",7714,1,2,0)
timeouts
"BLD",7714,4,0)
^9.64PA^^
"BLD",7714,6.3)
2
"BLD",7714,"ABPKG")
n
"BLD",7714,"KRN",0)
^9.67PA^779.2^20
"BLD",7714,"KRN",.4,0)
.4
"BLD",7714,"KRN",.401,0)
.401
"BLD",7714,"KRN",.402,0)
.402
"BLD",7714,"KRN",.403,0)
.403
"BLD",7714,"KRN",.5,0)
.5
"BLD",7714,"KRN",.84,0)
.84
"BLD",7714,"KRN",3.6,0)
3.6
"BLD",7714,"KRN",3.8,0)
3.8
"BLD",7714,"KRN",9.2,0)
9.2
"BLD",7714,"KRN",9.8,0)
9.8
"BLD",7714,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7714,"KRN",9.8,"NM",1,0)
EASEZF1^^0^B56432278
"BLD",7714,"KRN",9.8,"NM",2,0)
EASEZFM^^0^B8780865
"BLD",7714,"KRN",9.8,"NM","B","EASEZF1",1)

"BLD",7714,"KRN",9.8,"NM","B","EASEZFM",2)

"BLD",7714,"KRN",19,0)
19
"BLD",7714,"KRN",19.1,0)
19.1
"BLD",7714,"KRN",101,0)
101
"BLD",7714,"KRN",409.61,0)
409.61
"BLD",7714,"KRN",771,0)
771
"BLD",7714,"KRN",779.2,0)
779.2
"BLD",7714,"KRN",870,0)
870
"BLD",7714,"KRN",8989.51,0)
8989.51
"BLD",7714,"KRN",8989.52,0)
8989.52
"BLD",7714,"KRN",8994,0)
8994
"BLD",7714,"KRN","B",.4,.4)

"BLD",7714,"KRN","B",.401,.401)

"BLD",7714,"KRN","B",.402,.402)

"BLD",7714,"KRN","B",.403,.403)

"BLD",7714,"KRN","B",.5,.5)

"BLD",7714,"KRN","B",.84,.84)

"BLD",7714,"KRN","B",3.6,3.6)

"BLD",7714,"KRN","B",3.8,3.8)

"BLD",7714,"KRN","B",9.2,9.2)

"BLD",7714,"KRN","B",9.8,9.8)

"BLD",7714,"KRN","B",19,19)

"BLD",7714,"KRN","B",19.1,19.1)

"BLD",7714,"KRN","B",101,101)

"BLD",7714,"KRN","B",409.61,409.61)

"BLD",7714,"KRN","B",771,771)

"BLD",7714,"KRN","B",779.2,779.2)

"BLD",7714,"KRN","B",870,870)

"BLD",7714,"KRN","B",8989.51,8989.51)

"BLD",7714,"KRN","B",8989.52,8989.52)

"BLD",7714,"KRN","B",8994,8994)

"BLD",7714,"QUES",0)
^9.62^^
"BLD",7714,"REQB",0)
^9.611^1^1
"BLD",7714,"REQB",1,0)
EAS*1.0*70^2
"BLD",7714,"REQB","B","EAS*1.0*70",1)

"MBREQ")
0
"PKG",187,-1)
1^1
"PKG",187,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",187,20,0)
^9.402P^1^1
"PKG",187,20,1,0)
2^^EASXDR
"PKG",187,20,1,1)
 
"PKG",187,20,"B",2,1)

"PKG",187,22,0)
^9.49I^1^1
"PKG",187,22,1,0)
1.0^3010315^3010321^66481
"PKG",187,22,1,"PAH",1,0)
93^3090612^123456988
"PKG",187,22,1,"PAH",1,1,0)
^^2^2^3090612
"PKG",187,22,1,"PAH",1,1,1,0)
Fixes errors reported by ^XINDEX utility due to LOCK commands withou 
"PKG",187,22,1,"PAH",1,1,2,0)
timeouts
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","EASEZF1")
0^1^B56432278^B56560994
"RTN","EASEZF1",1,0)
EASEZF1 ;ALB/jap,TM - Filing 1010EZ Data to Patient Database ; 3/13/09 5:19pm
"RTN","EASEZF1",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**1,51,57,62,70,93**;Mar 15, 2001;Build 2
"RTN","EASEZF1",3,0)
 ;
"RTN","EASEZF1",4,0)
F2(EASAPP,EASDFN) ;file to Patient record in #2
"RTN","EASEZF1",5,0)
 ;input EASDFN = ien to #2
"RTN","EASEZF1",6,0)
 N KEYIEN,FILE,SUBFILE,FLD,DATAKEY,MULTIPLE,SECT,QUES,SUBIEN,ACCEPT,EZDATA,PTDATA,LINK,EROOT,EAS,ERR,IENS,ARRAY,ELIGVER
"RTN","EASEZF1",7,0)
 N DIC,DIQ,DA,DR,X,Y,EZSTRG
"RTN","EASEZF1",8,0)
 Q:'$G(EASDFN)
"RTN","EASEZF1",9,0)
 ;L +^DPT(EASDFN) ;Handling locking in EASEZFM - EAS*1*93
"RTN","EASEZF1",10,0)
 I '$G(EASVRSN) S EASVRSN=$$VERSION^EASEZU4(EASAPP)
"RTN","EASEZF1",11,0)
 ;EAS*1.0*70 - Special handling for Foreign Address
"RTN","EASEZF1",12,0)
 S KEYIEN=+$$KEY711^EASEZU1("APPLICANT COUNTRY")
"RTN","EASEZF1",13,0)
 S DATAKEY=$P(^TMP("EZDATA",$J,KEYIEN),U,4)
"RTN","EASEZF1",14,0)
 S SECT=$P(DATAKEY,";"),QUES=$P(DATAKEY,";",2)
"RTN","EASEZF1",15,0)
 S EZDATA=$P($G(^TMP("EZTEMP",$J,SECT,1,QUES)),U,2)
"RTN","EASEZF1",16,0)
 I EZDATA="UNITED STATES" S EZSTRG="APPLICANT PROVINCE^APPLICANT POSTAL CODE"
"RTN","EASEZF1",17,0)
 E  S EZSTRG="APPLICANT COUNTY^APPLICANT STATE^APPLICANT ZIP"
"RTN","EASEZF1",18,0)
 F X=1:1 S DATANM=$P(EZSTRG,U,X) Q:DATANM=""  D
"RTN","EASEZF1",19,0)
 . S KEYIEN=+$$KEY711^EASEZU1(DATANM) Q:(KEYIEN=.1)
"RTN","EASEZF1",20,0)
 . S DATAKEY=$P(^TMP("EZDATA",$J,KEYIEN),U,4)
"RTN","EASEZF1",21,0)
 . S SECT=$P(DATAKEY,";"),QUES=$P(DATAKEY,";",2)
"RTN","EASEZF1",22,0)
 . K ^TMP("EZDATA",$J,KEYIEN),^TMP("EZTEMP",$J,SECT,1,QUES)
"RTN","EASEZF1",23,0)
 ;
"RTN","EASEZF1",24,0)
 S KEYIEN=0
"RTN","EASEZF1",25,0)
 F  S KEYIEN=$O(^TMP("EZDATA",$J,KEYIEN)) Q:'KEYIEN  D
"RTN","EASEZF1",26,0)
 . S LN=^TMP("EZDATA",$J,KEYIEN),FILE=$P(LN,U,1)
"RTN","EASEZF1",27,0)
 . Q:FILE'=2
"RTN","EASEZF1",28,0)
 . S SUBFILE=$P(LN,U,2),FLD=$P(LN,U,3),DATAKEY=$P(LN,U,4)
"RTN","EASEZF1",29,0)
 . S SECT=$P(DATAKEY,";",1),QUES=$P(DATAKEY,";",2)
"RTN","EASEZF1",30,0)
 . ;call to suppress may be redundant
"RTN","EASEZF1",31,0)
 . Q:$$SUPPRESS^EASEZU4(EASAPP,DATAKEY,1,EASVRSN)
"RTN","EASEZF1",32,0)
 . ;in file #2, multiple is always 1
"RTN","EASEZF1",33,0)
 . S MULTIPLE=1
"RTN","EASEZF1",34,0)
 . Q:'$D(^TMP("EZDATA",$J,KEYIEN,MULTIPLE,1))
"RTN","EASEZF1",35,0)
 . S X=$G(^TMP("EZTEMP",$J,SECT,MULTIPLE,QUES))
"RTN","EASEZF1",36,0)
 . Q:$P(X,U,1)'=KEYIEN
"RTN","EASEZF1",37,0)
 . S EZDATA=$P(X,U,2),ACCEPT=$P(X,U,3),SUBIEN=$P(X,U,4),PTDATA=$P(X,U,5)
"RTN","EASEZF1",38,0)
 . Q:EZDATA=""
"RTN","EASEZF1",39,0)
 . Q:'SUBIEN
"RTN","EASEZF1",40,0)
 . ;special handling for Designee
"RTN","EASEZF1",41,0)
 . I FLD=.3405 S EZDATA=$S(EZDATA="NEXT OF KIN":"YES",1:"NO")
"RTN","EASEZF1",42,0)
 . ;strip off code display from county
"RTN","EASEZF1",43,0)
 . I SECT="I",QUES="9E." S EZDATA=$P(EZDATA," (",1)
"RTN","EASEZF1",44,0)
 . ;get file #2 ien; always same as EASDFN
"RTN","EASEZF1",45,0)
 . S LINK=EASDFN
"RTN","EASEZF1",46,0)
 . ;don't continue if data item not accepted
"RTN","EASEZF1",47,0)
 . Q:ACCEPT<1
"RTN","EASEZF1",48,0)
 . ;process subfile data elsewhere
"RTN","EASEZF1",49,0)
 . I SUBFILE=2.01 Q
"RTN","EASEZF1",50,0)
 . I SUBFILE=2.101 Q
"RTN","EASEZF1",51,0)
 . I SUBFILE=2.02 D F202^EASEZF1(SUBFILE,DATAKEY,EZDATA,SUBIEN,KEYIEN) Q
"RTN","EASEZF1",52,0)
 . I SUBFILE=2.06 D F206^EASEZF1(SUBFILE,DATAKEY,EZDATA,SUBIEN) Q
"RTN","EASEZF1",53,0)
 . ;special conversion to file data to field #.328
"RTN","EASEZF1",54,0)
 . I FLD=.328 D
"RTN","EASEZF1",55,0)
 . . S X=$$UC^EASEZT1(EZDATA) I X="SSN" D
"RTN","EASEZF1",56,0)
 . . . ;allow SSN as Service Number only if field #.328 in patient record is null;
"RTN","EASEZF1",57,0)
 . . . S PTSSN=$$GETANY^EASEZU1(EASAPP,EASDFN,SUBIEN)
"RTN","EASEZF1",58,0)
 . . . I PTSSN="" S EZDATA="SS" Q
"RTN","EASEZF1",59,0)
 . . . ;otherwise Applicant SSN must match Patient SSN
"RTN","EASEZF1",60,0)
 . . . S KK=$$KEY711^EASEZU1("APPLICANT SOCIAL SECURITY NUMBER")
"RTN","EASEZF1",61,0)
 . . . S EZSSN=$P($G(^TMP("EZDATA",$J,KK,1,1)),U,1),EZSSN=$TR(EZSSN,"-","")
"RTN","EASEZF1",62,0)
 . . . I EZSSN=PTSSN S EZDATA="SS" Q
"RTN","EASEZF1",63,0)
 . . . S EZDATA="ssn"
"RTN","EASEZF1",64,0)
 . . K KK,PTSSN,EZSSN
"RTN","EASEZF1",65,0)
 . ;special for fields #.092 & #.093
"RTN","EASEZF1",66,0)
 . I FILE=2,((FLD=.092)!(FLD=.093)) D FPOB(DATAKEY,EZDATA,SUBIEN,PTDATA) Q
"RTN","EASEZF1",67,0)
 . ;don't need these lines after 672
"RTN","EASEZF1",68,0)
 . ;special for field #.362
"RTN","EASEZF1",69,0)
 . ;I FILE=2,FLD=.362,EASVRSN>5.99 I (EZDATA="Y")!(EZDATA="YES") S EZDATA="YES, RECEIVING MILITARY RETIREMENT IN LIEU OF VA COMPENSATION"
"RTN","EASEZF1",70,0)
 . Q:EZDATA=PTDATA
"RTN","EASEZF1",71,0)
 . ;repeat check for verified eligibility;
"RTN","EASEZF1",72,0)
 . ;do not file certain fields if eligibility verified
"RTN","EASEZF1",73,0)
 . K ARRAY
"RTN","EASEZF1",74,0)
 . S DA=EASDFN,DIC="^DPT(",DR=".3611;.3613",DIQ(0)="I",DIQ="ARRAY"
"RTN","EASEZF1",75,0)
 . D EN^DIQ1 K DA,DIC,DIQ,DR
"RTN","EASEZF1",76,0)
 . I $G(ARRAY(2,EASDFN,.3611,"I"))="V",$G(ARRAY(2,EASDFN,.3613,"I"))="H" S ELIGVER=1
"RTN","EASEZF1",77,0)
 . I FLD=.313,$G(ARRAY(2,EASDFN,.3611,"I"))="V" Q
"RTN","EASEZF1",78,0)
 . I $G(ELIGVER),((FLD=.301)!(FLD=.302)!(FLD=.36235)) Q
"RTN","EASEZF1",79,0)
 . ;special for field #.32102 - Agent Orange Exposure . DATAKEY = I;14F
"RTN","EASEZF1",80,0)
 . I FLD=.32102 D F32102^EASEZF1A(EASAPP,EASDFN,EZDATA)
"RTN","EASEZF1",81,0)
 . ;setup to call FM database server using EASDFN as file #2 record
"RTN","EASEZF1",82,0)
 . K EAS,ERR
"RTN","EASEZF1",83,0)
 . S IENS=EASDFN_","
"RTN","EASEZF1",84,0)
 . S EROOT="EAS("_EASAPP_")"
"RTN","EASEZF1",85,0)
 . D VAL^DIE(2,IENS,FLD,"F",EZDATA,,EROOT,"ERR")
"RTN","EASEZF1",86,0)
 . ;try to resolve possible invalid input for free text fields due to length
"RTN","EASEZF1",87,0)
 . I $D(ERR) D RESOLVE
"RTN","EASEZF1",88,0)
 . I $D(ERR) D ERROR^EASEZF2("AP",MULTIPLE,.ERR,"LINK")
"RTN","EASEZF1",89,0)
 . ;file to database if input is valid
"RTN","EASEZF1",90,0)
 . I '$D(ERR) D
"RTN","EASEZF1",91,0)
 . . ;2/1/2001 - don't attempt to file Name, SSN, DOB; too many complications;
"RTN","EASEZF1",92,0)
 . . ;  example: if system assigns pseudo-SSN to new patient, user could overwrite;
"RTN","EASEZF1",93,0)
 . . ;  example: if applicant matched to existing patient, all critical identifying
"RTN","EASEZF1",94,0)
 . . ;           data could be overwritten; could impact HEC as well
"RTN","EASEZF1",95,0)
 . . D FILE^DIE("S",EROOT,"ERR")
"RTN","EASEZF1",96,0)
 . . ;set any replaced data into subfile #712.01 for audit
"RTN","EASEZF1",97,0)
 . . S ^EAS(712,EASAPP,10,SUBIEN,2)=PTDATA_U_LINK
"RTN","EASEZF1",98,0)
 ;
"RTN","EASEZF1",99,0)
 ;L -^DPT(EASDFN) ;Handling locking in EASEZFM - EAS*1*93
"RTN","EASEZF1",100,0)
 Q
"RTN","EASEZF1",101,0)
 ;
"RTN","EASEZF1",102,0)
RESOLVE ;try to resolve invalid input for free text fields only
"RTN","EASEZF1",103,0)
 ;see if mapped to free text field
"RTN","EASEZF1",104,0)
 N FDEF,FTYPE,MAX
"RTN","EASEZF1",105,0)
 I (SUBFILE=FILE)!(SUBFILE="") S FDEF=FILE
"RTN","EASEZF1",106,0)
 E  S FDEF=SUBFILE
"RTN","EASEZF1",107,0)
 S FTYPE=$$GET1^DID(FDEF,FLD,"","TYPE")
"RTN","EASEZF1",108,0)
 Q:FTYPE'="FREE TEXT"
"RTN","EASEZF1",109,0)
 S MAX=$$GET1^DID(FDEF,FLD,"","FIELD LENGTH")
"RTN","EASEZF1",110,0)
 S EZDATA=$E(EZDATA,1,MAX)
"RTN","EASEZF1",111,0)
 K ERR
"RTN","EASEZF1",112,0)
 D VAL^DIE(2,IENS,FLD,"F",EZDATA,,EROOT,"ERR")
"RTN","EASEZF1",113,0)
 ;if still sets ERR array then won't be filed to database
"RTN","EASEZF1",114,0)
 Q
"RTN","EASEZF1",115,0)
 ;
"RTN","EASEZF1",116,0)
F202(SUBFILE,DATAKEY,EZDATA,SUBIEN,KEYIEN) ;add or edit subrecord in subfile #2.02
"RTN","EASEZF1",117,0)
 ;input SUBFILE = 2.02
"RTN","EASEZF1",118,0)
 ;      DATAKEY = data item identifier, e.g., I;4B.
"RTN","EASEZF1",119,0)
 ;      EZDATA  = in these cases, either "N(o)" or "Y(es)"
"RTN","EASEZF1",120,0)
 ;      SUBIEN  = subrecord # for data in #712/#10
"RTN","EASEZF1",121,0)
 ;      KEYIEN  = record # for data element in #711
"RTN","EASEZF1",122,0)
 N X,N,DATANM,EROOT,EAS,EIEN,ERR,FLD,IENS,EASARRAY,LINK,OUT,K1,K3
"RTN","EASEZF1",123,0)
 Q:EZDATA'["Y"
"RTN","EASEZF1",124,0)
 Q:SUBFILE'=2.02
"RTN","EASEZF1",125,0)
 ;covert data to corresponding file #10 pointer
"RTN","EASEZF1",126,0)
 S X=$$KEY711^EASEZU1(DATAKEY)
"RTN","EASEZF1",127,0)
 S K1=$P(X,U,1),DATANM=$P(X,U,2),K3=$P(X,U,3)
"RTN","EASEZF1",128,0)
 Q:(DATANM="")
"RTN","EASEZF1",129,0)
 Q:(K1'=KEYIEN)
"RTN","EASEZF1",130,0)
 Q:(K3'=DATAKEY)
"RTN","EASEZF1",131,0)
 S DATANM=$P(DATANM," - ",2),DATANM=$E(DATANM,1,30)
"RTN","EASEZF1",132,0)
 I DATANM["UNANSWERED" S DATANM="UNKNOWN BY PATIENT"
"RTN","EASEZF1",133,0)
 S EZDATA=$O(^DIC(10,"B",DATANM,0))
"RTN","EASEZF1",134,0)
 Q:EZDATA=""
"RTN","EASEZF1",135,0)
 D I202^EASEZI(EASDFN,.EASARRAY)
"RTN","EASEZF1",136,0)
 ;if matching race already exists, edit method only
"RTN","EASEZF1",137,0)
 S OUT=0,N=0 F  S N=$O(EASARRAY(N)) Q:'N  D
"RTN","EASEZF1",138,0)
 . Q:($P(EASARRAY(N),";",2)'=EZDATA)
"RTN","EASEZF1",139,0)
 . K EAS,ERR
"RTN","EASEZF1",140,0)
 . S IENS=EZDATA_","_EASDFN_","
"RTN","EASEZF1",141,0)
 . S EROOT="EAS("_EASAPP_")"
"RTN","EASEZF1",142,0)
 . S FLD=.02,EAS(EASAPP,SUBFILE,IENS,FLD)=1
"RTN","EASEZF1",143,0)
 . D FILE^DIE("S",EROOT,"ERR")
"RTN","EASEZF1",144,0)
 . S OUT=1
"RTN","EASEZF1",145,0)
 ;no matching race in patient record, add new subrecord
"RTN","EASEZF1",146,0)
 I 'OUT D
"RTN","EASEZF1",147,0)
 . K ERR
"RTN","EASEZF1",148,0)
 . S EROOT="EAS("_EASAPP_")"
"RTN","EASEZF1",149,0)
 . S IENS="+1,"_EASDFN_",",EIEN(1)=EZDATA
"RTN","EASEZF1",150,0)
 . S FLD=.01,EAS(EASAPP,SUBFILE,IENS,FLD)=EZDATA
"RTN","EASEZF1",151,0)
 . S FLD=.02,EAS(EASAPP,SUBFILE,IENS,FLD)=1
"RTN","EASEZF1",152,0)
 . D UPDATE^DIE("S",EROOT,"EIEN","ERR")
"RTN","EASEZF1",153,0)
 . I $D(ERR) D ERROR^EASEZF2("AP",1,.ERR,"LINK") Q
"RTN","EASEZF1",154,0)
 . S LINK=EASDFN_";"_EZDATA
"RTN","EASEZF1",155,0)
 . S ^EAS(712,EASAPP,10,SUBIEN,2)=U_LINK
"RTN","EASEZF1",156,0)
 Q
"RTN","EASEZF1",157,0)
 ;
"RTN","EASEZF1",158,0)
F206(SUBFILE,DATAKEY,EZDATA,SUBIEN) ;add subrecord in subfile #2.06 
"RTN","EASEZF1",159,0)
 ;input SUBFILE = 2.06
"RTN","EASEZF1",160,0)
 ;      DATAKEY = data item identifier, e.g., I;4A.
"RTN","EASEZF1",161,0)
 ;      EZDATA  = in these cases, either "N(o)" or "Y(es)"
"RTN","EASEZF1",162,0)
 N X,EROOT,EAS,EIEN,ERR,FLD,EASARRAY,IENS,LINK,PTDATA
"RTN","EASEZF1",163,0)
 Q:SUBFILE'=2.06
"RTN","EASEZF1",164,0)
 D I206^EASEZI(EASDFN,.EASARRAY)
"RTN","EASEZF1",165,0)
 S LINK=$P($G(EASARRAY(1)),";",2),PTDATA="" I LINK S PTDATA=$P(^DPT(EASDFN,.06,LINK,0),U,1)
"RTN","EASEZF1",166,0)
 I DATAKEY="I;4A." S EZDATA=$S(EZDATA["Y":"H",$E(EZDATA,1)="N":"N",1:"U") D
"RTN","EASEZF1",167,0)
 . S EROOT="EAS("_EASAPP_")"
"RTN","EASEZF1",168,0)
 . S IENS="+1,"_EASDFN_","
"RTN","EASEZF1",169,0)
 . S FLD=.01,EAS(EASAPP,SUBFILE,IENS,FLD)=EZDATA
"RTN","EASEZF1",170,0)
 . S FLD=.02,EAS(EASAPP,SUBFILE,IENS,FLD)="SELF IDENTIFICATION"
"RTN","EASEZF1",171,0)
 . D UPDATE^DIE("ES",EROOT,"EIEN","ERR")
"RTN","EASEZF1",172,0)
 . S LINK=EASDFN_";"_$G(EIEN(1))
"RTN","EASEZF1",173,0)
 . S ^EAS(712,EASAPP,10,SUBIEN,2)=PTDATA_U_LINK
"RTN","EASEZF1",174,0)
 Q
"RTN","EASEZF1",175,0)
 ;
"RTN","EASEZF1",176,0)
FPOB(DATAKEY,EZDATA,SUBIEN,PTDATA) ;add or edit pob city & state
"RTN","EASEZF1",177,0)
 ;input DATAKEY = data item identifier, either, I;8A. or I;8B.
"RTN","EASEZF1",178,0)
 ;      EZDATA  = free text if city or 
"RTN","EASEZF1",179,0)
 ;                state abbrv if state
"RTN","EASEZF1",180,0)
 ;filing for both city & state only done when datakey=I;8A.
"RTN","EASEZF1",181,0)
 N X,EROOT,EAS,EIEN,ERR,FLD,EASARRAY,IENS,LINK,SECT,QUES,XIEN,XDATA
"RTN","EASEZF1",182,0)
 Q:(DATAKEY'="I;8A.")
"RTN","EASEZF1",183,0)
 Q:(EZDATA="")
"RTN","EASEZF1",184,0)
 Q:(EZDATA=PTDATA)
"RTN","EASEZF1",185,0)
 ;file pob city
"RTN","EASEZF1",186,0)
 K EAS,ERR
"RTN","EASEZF1",187,0)
 S FLD=.092,LINK=EASDFN
"RTN","EASEZF1",188,0)
 S IENS=EASDFN_","
"RTN","EASEZF1",189,0)
 S EROOT="EAS("_EASAPP_")"
"RTN","EASEZF1",190,0)
 D VAL^DIE(2,IENS,FLD,"F",EZDATA,,EROOT,"ERR")
"RTN","EASEZF1",191,0)
 I $D(ERR) D RESOLVE
"RTN","EASEZF1",192,0)
 I $D(ERR) D ERROR^EASEZF2("AP",1,.ERR,"LINK") Q
"RTN","EASEZF1",193,0)
 D FILE^DIE("ES",EROOT,"ERR")
"RTN","EASEZF1",194,0)
 ;set any replaced data into subfile #712.01 for audit
"RTN","EASEZF1",195,0)
 S ^EAS(712,EASAPP,10,SUBIEN,2)=PTDATA_U_LINK
"RTN","EASEZF1",196,0)
 ;file pob state
"RTN","EASEZF1",197,0)
 S (EZDATA,XDATA)=""
"RTN","EASEZF1",198,0)
 S DATAKEY="I;8B.",SECT=$P(DATAKEY,";",1),QUES=$P(DATAKEY,";",2)
"RTN","EASEZF1",199,0)
 S X=$G(^TMP("EZTEMP",$J,SECT,1,QUES)),EZDATA=$P(X,U,2),XIEN=$P(X,U,4),XDATA=$P(X,U,5)
"RTN","EASEZF1",200,0)
 Q:(EZDATA="")
"RTN","EASEZF1",201,0)
 Q:(EZDATA=XDATA)
"RTN","EASEZF1",202,0)
 I (EZDATA["FOREIGN")!(EZDATA="FC")!(EZDATA="FG") S EZDATA="FOREIGN"
"RTN","EASEZF1",203,0)
 K EAS,ERR
"RTN","EASEZF1",204,0)
 S FLD=.093
"RTN","EASEZF1",205,0)
 S IENS=EASDFN_","
"RTN","EASEZF1",206,0)
 S EROOT="EAS("_EASAPP_")"
"RTN","EASEZF1",207,0)
 D VAL^DIE(2,IENS,FLD,"F",EZDATA,,EROOT,"ERR")
"RTN","EASEZF1",208,0)
 I $D(ERR) D ERROR^EASEZF2("AP",1,.ERR,"LINK") Q
"RTN","EASEZF1",209,0)
 D FILE^DIE("ES",EROOT,"ERR")
"RTN","EASEZF1",210,0)
 S ^EAS(712,EASAPP,10,XIEN,2)=XDATA_U_LINK
"RTN","EASEZF1",211,0)
 Q
"RTN","EASEZFM")
0^2^B8780865^B8303288
"RTN","EASEZFM",1,0)
EASEZFM ;ALB/jap,TM - Filing 1010EZ Data to Patient Database ; 3/13/09 4:51pm
"RTN","EASEZFM",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**1,93**;Mar 15, 2001;Build 2
"RTN","EASEZFM",3,0)
 ;
"RTN","EASEZFM",4,0)
QUE ;entry point from queued background job
"RTN","EASEZFM",5,0)
 ;
"RTN","EASEZFM",6,0)
 ;check signature verification before continuing
"RTN","EASEZFM",7,0)
 K ^TMP("1010EZERROR",$J)
"RTN","EASEZFM",8,0)
 Q:'$G(EASAPP)
"RTN","EASEZFM",9,0)
 Q:'$D(^EAS(712,EASAPP,0))
"RTN","EASEZFM",10,0)
 S EASEZNEW=$P(^EAS(712,EASAPP,0),U,11)
"RTN","EASEZFM",11,0)
 S X=$G(^EAS(712,EASAPP,1))
"RTN","EASEZFM",12,0)
 ;recheck signature status
"RTN","EASEZFM",13,0)
 I ('$P(X,U,1))&('$P(X,U,2)) D RESET Q
"RTN","EASEZFM",14,0)
 ;
"RTN","EASEZFM",15,0)
 L +^EAS(712,EASAPP):60 I '$T D RESET Q
"RTN","EASEZFM",16,0)
 ;check incoming data
"RTN","EASEZFM",17,0)
 D CHECK
"RTN","EASEZFM",18,0)
 ;
"RTN","EASEZFM",19,0)
 ;get EZ1010 data into ^TMP("EZDATA" array
"RTN","EASEZFM",20,0)
 D EN^EASEZC1(EASAPP,.EASDFN)
"RTN","EASEZFM",21,0)
 ;
"RTN","EASEZFM",22,0)
 ;store file #2 data
"RTN","EASEZFM",23,0)
 L +^DPT(EASDFN):60 I '$T D RESET Q
"RTN","EASEZFM",24,0)
 D F2^EASEZF1(EASAPP,EASDFN)
"RTN","EASEZFM",25,0)
 L -^DPT(EASDFN)
"RTN","EASEZFM",26,0)
 ;
"RTN","EASEZFM",27,0)
 ;store file #408.12, #408.13, #408.21, #408.22 data
"RTN","EASEZFM",28,0)
 D F408^EASEZF2(EASAPP,EASDFN)
"RTN","EASEZFM",29,0)
 ;
"RTN","EASEZFM",30,0)
 ;store file #355.33 data;
"RTN","EASEZFM",31,0)
 ;call IB API to file health insurance and Medicare data
"RTN","EASEZFM",32,0)
 D IBINS^EASEZF5(EASAPP,EASDFN)
"RTN","EASEZFM",33,0)
 ;
"RTN","EASEZFM",34,0)
 ;update 'new patient' remark
"RTN","EASEZFM",35,0)
 I EASEZNEW D
"RTN","EASEZFM",36,0)
 .S REM="New Patient record added by ELECTRONIC 10-10EZ."
"RTN","EASEZFM",37,0)
 .S DA=EASDFN,DIE="^DPT(",DR=".091///^S X=REM"
"RTN","EASEZFM",38,0)
 .D ^DIE
"RTN","EASEZFM",39,0)
 ;update processing status if not already done
"RTN","EASEZFM",40,0)
 I $P($G(^EAS(712,EASAPP,2)),U,5)="" D SETDATE^EASEZU2(EASAPP,"FIL")
"RTN","EASEZFM",41,0)
 ;remove the task id
"RTN","EASEZFM",42,0)
 S $P(^EAS(712,EASAPP,2),U,11)=""
"RTN","EASEZFM",43,0)
 L -^EAS(712,EASAPP)
"RTN","EASEZFM",44,0)
 I $D(^TMP("1010EZERROR",$J)) D MAILERR
"RTN","EASEZFM",45,0)
 S ZTREQ="@"
"RTN","EASEZFM",46,0)
 Q
"RTN","EASEZFM",47,0)
 ;
"RTN","EASEZFM",48,0)
CHECK ;check data
"RTN","EASEZFM",49,0)
 ;returns '0' if any invalid data found; otherwise '1'
"RTN","EASEZFM",50,0)
 N SUBIEN,X,CHK,DIK,DA
"RTN","EASEZFM",51,0)
 ;remove any 'noise' from incoming data
"RTN","EASEZFM",52,0)
 S SUBIEN=0 F  S SUBIEN=$O(^EAS(712,EASAPP,10,SUBIEN)) Q:+SUBIEN=0  D
"RTN","EASEZFM",53,0)
 .S CHK=$P($G(^EAS(712,EASAPP,10,SUBIEN,1)),U,1)
"RTN","EASEZFM",54,0)
 .I (CHK="/")!(CHK="//")!(CHK="-")!(CHK="--")!(CHK=" ")!(CHK="") D
"RTN","EASEZFM",55,0)
 ..S DA=SUBIEN,DA(1)=EASAPP,DIK="^EAS(712,"_DA(1)_",10,"
"RTN","EASEZFM",56,0)
 ..D ^DIK
"RTN","EASEZFM",57,0)
 Q
"RTN","EASEZFM",58,0)
 ;
"RTN","EASEZFM",59,0)
CLEAN ; cleanup
"RTN","EASEZFM",60,0)
 K ^TMP("EZDATA",$J),^TMP("EZINDEX",$J),^TMP("EZTEMP",$J),^TMP("EZDISP",$J)
"RTN","EASEZFM",61,0)
 Q
"RTN","EASEZFM",62,0)
 ;
"RTN","EASEZFM",63,0)
MAILERR ;notify user if any data elements failed FM validator
"RTN","EASEZFM",64,0)
 ;
"RTN","EASEZFM",65,0)
 N XMY,XMSUB,XMDUZ,XMTEXT,Y
"RTN","EASEZFM",66,0)
 ;fill-in first 6 lines of message
"RTN","EASEZFM",67,0)
 S ^TMP("1010EZERROR",$J,1,0)="Errors were returned by the FileMan validator when filing 1010EZ"
"RTN","EASEZFM",68,0)
 S ^TMP("1010EZERROR",$J,2,0)="data for --"
"RTN","EASEZFM",69,0)
 S ^TMP("1010EZERROR",$J,3,0)="Applicant:     "_$P($G(^EAS(712,EASAPP,0)),U,4)
"RTN","EASEZFM",70,0)
 S ^TMP("1010EZERROR",$J,4,0)="Application #: "_EASAPP
"RTN","EASEZFM",71,0)
 S Y=DT D DD^%DT
"RTN","EASEZFM",72,0)
 S ^TMP("1010EZERROR",$J,5,0)="Filing Date:   "_Y
"RTN","EASEZFM",73,0)
 S ^TMP("1010EZERROR",$J,6,0)=" "
"RTN","EASEZFM",74,0)
 ;setup call to MailMan
"RTN","EASEZFM",75,0)
 S XMSUB="EAS 1010EZ Error Report for APP #"_EASAPP,XMDUZ=.5
"RTN","EASEZFM",76,0)
 S XMY(DUZ)=""
"RTN","EASEZFM",77,0)
 S XMTEXT="^TMP(""1010EZERROR"",$J,"
"RTN","EASEZFM",78,0)
 D ^XMD
"RTN","EASEZFM",79,0)
 K ^TMP("1010EZERROR",$J)
"RTN","EASEZFM",80,0)
 Q
"RTN","EASEZFM",81,0)
 ;
"RTN","EASEZFM",82,0)
RESET ;remove filing date if can't continue
"RTN","EASEZFM",83,0)
 S FDT=$P(^EAS(712,EASAPP,2),U,5),$P(^EAS(712,EASAPP,2),U,5)=""
"RTN","EASEZFM",84,0)
 S $P(^EAS(712,EASAPP,2),U,6)="",$P(^EAS(712,EASAPP,2),U,11)=""
"RTN","EASEZFM",85,0)
 I FDT K ^EAS(712,"FIL",FDT,EASAPP)
"RTN","EASEZFM",86,0)
 D APPINDEX^EASEZU2(EASAPP)
"RTN","EASEZFM",87,0)
 Q
"VER")
8.0^22.0
"BLD",7714,6)
^79
**END**
**END**
