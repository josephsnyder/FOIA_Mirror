Released IB*2*424 SEQ #397
Extracted from mail message
**KIDS**:IB*2.0*424^

**INSTALL NAME**
IB*2.0*424
"BLD",8246,0)
IB*2.0*424^INTEGRATED BILLING^0^3091124^y
"BLD",8246,1,0)
^^2^2^3091112^
"BLD",8246,1,1,0)
This patch addresses one issue regarding new Rate Schedules for the Rate
"BLD",8246,1,2,0)
Types of CHAMPVA and CHAMPVA REIMB. INS..
"BLD",8246,4,0)
^9.64PA^^
"BLD",8246,6.3)
4
"BLD",8246,"INIT")
POST^IB20P424
"BLD",8246,"KRN",0)
^9.67PA^779.2^20
"BLD",8246,"KRN",.4,0)
.4
"BLD",8246,"KRN",.401,0)
.401
"BLD",8246,"KRN",.402,0)
.402
"BLD",8246,"KRN",.403,0)
.403
"BLD",8246,"KRN",.5,0)
.5
"BLD",8246,"KRN",.84,0)
.84
"BLD",8246,"KRN",3.6,0)
3.6
"BLD",8246,"KRN",3.8,0)
3.8
"BLD",8246,"KRN",9.2,0)
9.2
"BLD",8246,"KRN",9.8,0)
9.8
"BLD",8246,"KRN",19,0)
19
"BLD",8246,"KRN",19.1,0)
19.1
"BLD",8246,"KRN",101,0)
101
"BLD",8246,"KRN",409.61,0)
409.61
"BLD",8246,"KRN",771,0)
771
"BLD",8246,"KRN",779.2,0)
779.2
"BLD",8246,"KRN",870,0)
870
"BLD",8246,"KRN",8989.51,0)
8989.51
"BLD",8246,"KRN",8989.52,0)
8989.52
"BLD",8246,"KRN",8994,0)
8994
"BLD",8246,"KRN","B",.4,.4)

"BLD",8246,"KRN","B",.401,.401)

"BLD",8246,"KRN","B",.402,.402)

"BLD",8246,"KRN","B",.403,.403)

"BLD",8246,"KRN","B",.5,.5)

"BLD",8246,"KRN","B",.84,.84)

"BLD",8246,"KRN","B",3.6,3.6)

"BLD",8246,"KRN","B",3.8,3.8)

"BLD",8246,"KRN","B",9.2,9.2)

"BLD",8246,"KRN","B",9.8,9.8)

"BLD",8246,"KRN","B",19,19)

"BLD",8246,"KRN","B",19.1,19.1)

"BLD",8246,"KRN","B",101,101)

"BLD",8246,"KRN","B",409.61,409.61)

"BLD",8246,"KRN","B",771,771)

"BLD",8246,"KRN","B",779.2,779.2)

"BLD",8246,"KRN","B",870,870)

"BLD",8246,"KRN","B",8989.51,8989.51)

"BLD",8246,"KRN","B",8989.52,8989.52)

"BLD",8246,"KRN","B",8994,8994)

"BLD",8246,"QUES",0)
^9.62^^
"BLD",8246,"REQB",0)
^9.611^^0
"INIT")
POST^IB20P424
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
424^3091124
"PKG",200,22,1,"PAH",1,1,0)
^^2^2^3091124
"PKG",200,22,1,"PAH",1,1,1,0)
This patch addresses one issue regarding new Rate Schedules for the Rate
"PKG",200,22,1,"PAH",1,1,2,0)
Types of CHAMPVA and CHAMPVA REIMB. INS..
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IB20P424")
0^^B34256380^n/a
"RTN","IB20P424",1,0)
IB20P424 ;ALB/CXW-IB*2*424 POST INIT RS FOR CHAMPVA/CHAMPVA RI;16-SEP-09
"RTN","IB20P424",2,0)
 ;;2.0;INTEGRATED BILLING;**424**;21-MAR-94;Build 4
"RTN","IB20P424",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IB20P424",4,0)
 ; 
"RTN","IB20P424",5,0)
 Q
"RTN","IB20P424",6,0)
POST ;
"RTN","IB20P424",7,0)
 N IBA,IBEFFDT,EFFDT
"RTN","IB20P424",8,0)
 D MSG("    IB*2*424 Post-Install ....."),MSG(" ")
"RTN","IB20P424",9,0)
 ;
"RTN","IB20P424",10,0)
 S IBEFFDT=3100101 ;            effective date of new RS
"RTN","IB20P424",11,0)
 ;
"RTN","IB20P424",12,0)
 D ADDORS(IBEFFDT) ;     inactivate existing CHAMPVA/CHAMPVA RI Rate Schedules
"RTN","IB20P424",13,0)
 D ADDNRS(IBEFFDT) ;     add new Rate Schedules linking CHAMPVA Reasonable Charges
"RTN","IB20P424",14,0)
 ;
"RTN","IB20P424",15,0)
 D MSG("    IB*2*424 Post-Install Complete")
"RTN","IB20P424",16,0)
 Q
"RTN","IB20P424",17,0)
 ;
"RTN","IB20P424",18,0)
ADDORS(EFFDT) ;Inactivate Existing CHAMPVA/CHAMPVA RI Rate Schedules
"RTN","IB20P424",19,0)
 N INEFFDT,IBORS,IBORSFN,IBORSNM,IBORSTY,IBRATY,IBCNT
"RTN","IB20P424",20,0)
 S IBCNT=0
"RTN","IB20P424",21,0)
 ;
"RTN","IB20P424",22,0)
 ;return the day before the effective date
"RTN","IB20P424",23,0)
 I +$G(EFFDT) S INEFFDT=$$FMADD^XLFDT(EFFDT,-1)
"RTN","IB20P424",24,0)
 I 'INEFFDT D MSG("**Error: No Date, could not inactivate old RS for CHAMPVA/CHAMPVA RI") Q
"RTN","IB20P424",25,0)
 ;
"RTN","IB20P424",26,0)
 S IBORSFN=0 F  S IBORSFN=$O(^IBE(363,IBORSFN)) Q:'IBORSFN  D
"RTN","IB20P424",27,0)
 . S IBORS=$G(^IBE(363,IBORSFN,0))
"RTN","IB20P424",28,0)
 . ;
"RTN","IB20P424",29,0)
 . S IBORSNM=$P(IBORS,U,1)
"RTN","IB20P424",30,0)
 . S IBORSTY=$P(IBORS,U,2)
"RTN","IB20P424",31,0)
 . Q:'IBORSTY   ;quit if no rate type
"RTN","IB20P424",32,0)
 . ;
"RTN","IB20P424",33,0)
 . S IBRATY=$P($G(^DGCR(399.3,+IBORSTY,0)),U,1)
"RTN","IB20P424",34,0)
 . I IBRATY'["CHAMPVA" Q  ; CHAMPVA/CHAMPVA RI only
"RTN","IB20P424",35,0)
 . ;
"RTN","IB20P424",36,0)
 . I $P(IBORS,U,5)=EFFDT Q  ;quit if active date exists
"RTN","IB20P424",37,0)
 . I ($P(IBORS,U,6)="")!($P(IBORS,U,6)>INEFFDT) D
"RTN","IB20P424",38,0)
 . . S IBCNT=IBCNT+1,DR=".06////"_INEFFDT,DIE="^IBE(363,",DA=+IBORSFN D ^DIE K DIE,DA,DR,X,Y
"RTN","IB20P424",39,0)
 . . D MSG("      >> Inactivating Rate Schedule: "_IBORSNM)
"RTN","IB20P424",40,0)
 D MSG("Total Rate Schedules: "_IBCNT_$S(IBCNT=1:" has",1:" have")_" been inactivated on "_$$FMTE^XLFDT(INEFFDT,2)_" (363)")
"RTN","IB20P424",41,0)
 D MSG(" ")
"RTN","IB20P424",42,0)
 Q
"RTN","IB20P424",43,0)
ADDNRS(EFFDT) ; add CAHMPVA/CHAMPVA REIMB. INS. Rate Schedules (363) if they don't exist
"RTN","IB20P424",44,0)
 ;
"RTN","IB20P424",45,0)
 N IBI,IBJ,IBCNT,IBCNTCS,IBNRS,IBBVS,IBRT,IBDT,IBRS,IBFN
"RTN","IB20P424",46,0)
 S IBCNT=0,IBDT=+$G(EFFDT)
"RTN","IB20P424",47,0)
 I 'IBDT D MSG("**Error: No Date, could not link Rate Schedules to Charge Sets") Q
"RTN","IB20P424",48,0)
 F IBI=1:1 S IBNRS=$P($T(NRSF+IBI),";;",2) Q:+IBNRS!(IBNRS="")  I $E(IBNRS)?1A D
"RTN","IB20P424",49,0)
 . I $O(^IBE(363,"B",$P(IBNRS,U,1),0)) D MSG("** No Change, Rate Schedule linking "_$P(IBNRS,U,1)_" and RC already exists") Q
"RTN","IB20P424",50,0)
 . S IBBVS=$P(IBNRS,U,4) I IBBVS'="" S IBBVS=$$MCCRUTL(IBBVS,13) D  Q:'IBBVS
"RTN","IB20P424",51,0)
 .. I 'IBBVS D MSG("** Error: Billable Service "_$P(IBNRS,U,4)_" not defined, "_$P(IBNRS,U,1)_" not created") Q
"RTN","IB20P424",52,0)
 . ;
"RTN","IB20P424",53,0)
 . S IBRT=$P(IBNRS,U,2),IBRT=$O(^DGCR(399.3,"B",IBRT,0)) D  Q:'IBRT
"RTN","IB20P424",54,0)
 .. I 'IBRT D MSG("** Error: Rate Type "_$P(IBNRS,U,2)_" not defined, "_$P(IBNRS,U,1)_" not created!!!")
"RTN","IB20P424",55,0)
 .. I +$P($G(^DGCR(399.3,+IBRT,0)),U,3) S IBRT=0 D MSG("** Warning: Rate Type "_$P(IBNRS,U,2)_" not Active, RS "_$P(IBNRS,U,1)_" not created")
"RTN","IB20P424",56,0)
 . ;
"RTN","IB20P424",57,0)
 . F IBJ=1:1 S IBRS=$G(^IBE(363,IBJ,0)) I IBRS="" S DINUM=IBJ Q
"RTN","IB20P424",58,0)
 . ;
"RTN","IB20P424",59,0)
 . K DD,DO S DLAYGO=363,DIC="^IBE(363,",DIC(0)="L",X=$P(IBNRS,U,1) D FILE^DICN K DIC,DINUM,DLAYGO I Y<1 K X,Y Q
"RTN","IB20P424",60,0)
 . S IBFN=+Y,IBCNT=IBCNT+1,IBCNTCS=0
"RTN","IB20P424",61,0)
 . ;
"RTN","IB20P424",62,0)
 . S DR=".02////"_IBRT_";.03////"_$P(IBNRS,U,3) S:+IBBVS DR=DR_";.04////"_IBBVS S DR=DR_";.05////"_IBDT
"RTN","IB20P424",63,0)
 . ;I $P(IBNRS,U,6)'="" S DR=DR_";1.02////"_$P(IBNRS,U,6) ;admin fee
"RTN","IB20P424",64,0)
 . I $P(IBNRS,U,7)'="" S DR=DR_";10////^S X=$P(IBNRS,U,7)"
"RTN","IB20P424",65,0)
 . S DIE="^IBE(363,",DA=+Y D ^DIE K DIE,DA,DR,X,Y
"RTN","IB20P424",66,0)
 . D MSG("      >> Adding Rate Schedule: "_$P(IBNRS,U))
"RTN","IB20P424",67,0)
 . S IBCNTCS=IBCNTCS+$$RSCS(IBFN) ; add all Reasonable Charges Charge Sets
"RTN","IB20P424",68,0)
 . ;
"RTN","IB20P424",69,0)
 . I 'IBCNTCS D MSG("** Warning: No Charge Sets added to RS "_$P(IBNRS,U,1))
"RTN","IB20P424",70,0)
 D MSG("Total Rate Schedules: "_IBCNT_$S(IBCNT=1:" has",1:" have")_" been added and activated on "_$$FMTE^XLFDT(IBDT,2)_" (363)")
"RTN","IB20P424",71,0)
 D MSG(" ")
"RTN","IB20P424",72,0)
 Q
"RTN","IB20P424",73,0)
 ;
"RTN","IB20P424",74,0)
RSCS(IBFN) ; add existing Charge Sets to RC, return number added
"RTN","IB20P424",75,0)
 ; copy the Charge Sets from the corresponding RI RS (v2)
"RTN","IB20P424",76,0)
 ; add the Charge Sets - RX COST
"RTN","IB20P424",77,0)
 N IBCNT,IBNRS,IBRSNM,IBTY,IBVDT,IBCOPY,IBCS,IBXFN,IBCSFN,IBCSNM,IBCSAA
"RTN","IB20P424",78,0)
 S (IBCNT,IBCOPY)=0
"RTN","IB20P424",79,0)
 ;
"RTN","IB20P424",80,0)
 S IBNRS=$G(^IBE(363,+$G(IBFN),0)),IBRSNM=$P(IBNRS,U,1)
"RTN","IB20P424",81,0)
 S IBTY=$P(IBNRS,U,3)
"RTN","IB20P424",82,0)
 S IBVDT=$$VERSDT^IBCRU8(2)
"RTN","IB20P424",83,0)
 I IBRSNM["INPT" S IBCOPY=+$$RSEXISTS(IBVDT,"RI-INPT")
"RTN","IB20P424",84,0)
 I IBRSNM["SNF" S IBCOPY=+$$RSEXISTS(IBVDT,"RI-SNF")
"RTN","IB20P424",85,0)
 I IBRSNM["OPT" S IBCOPY=+$$RSEXISTS(IBVDT,"RI-OPT")
"RTN","IB20P424",86,0)
 I IBRSNM["RX",+$$RSCSFILE(IBFN,"RX COST",1) S IBCNT=IBCNT+1
"RTN","IB20P424",87,0)
 ;
"RTN","IB20P424",88,0)
 I 'IBCOPY G RSCSQ
"RTN","IB20P424",89,0)
 I +$P($G(^IBE(363,+IBCOPY,0)),U,3)=IBTY D
"RTN","IB20P424",90,0)
 . ;
"RTN","IB20P424",91,0)
 . S IBXFN=0 F  S IBXFN=$O(^IBE(363,IBCOPY,11,IBXFN)) Q:'IBXFN  D
"RTN","IB20P424",92,0)
 .. S IBCS=$G(^IBE(363,IBCOPY,11,IBXFN,0)),IBCSFN=+IBCS
"RTN","IB20P424",93,0)
 .. I +$$RSCSFILE(IBFN,$P($G(^IBE(363.1,IBCSFN,0)),U,1),$P(IBCS,U,2)) S IBCNT=IBCNT+1
"RTN","IB20P424",94,0)
 ;
"RTN","IB20P424",95,0)
RSCSQ Q IBCNT
"RTN","IB20P424",96,0)
 ;
"RTN","IB20P424",97,0)
RSCSFILE(IBFN,IBCSNM,IBCSAA) ; Add Charge Set to a Rate Schedule
"RTN","IB20P424",98,0)
 N IBX,DD,DO,DLAYGO,DIC,DIE,DA,DR,X,Y,IBCSFN S IBX=0
"RTN","IB20P424",99,0)
 I $G(^IBE(363,+$G(IBFN),0))="" G RSCSFQ
"RTN","IB20P424",100,0)
 I $G(IBCSNM)="" G RSCSFQ
"RTN","IB20P424",101,0)
 S IBCSFN=$O(^IBE(363.1,"B",IBCSNM,0)) I 'IBCSFN G RSCSFQ
"RTN","IB20P424",102,0)
 I $O(^IBE(363,IBFN,11,"B",IBCSFN,0)) G RSCSFQ
"RTN","IB20P424",103,0)
 ;
"RTN","IB20P424",104,0)
 S DLAYGO=363,DA(1)=+IBFN,DIC="^IBE(363,"_DA(1)_",11,",DIC(0)="L",X=IBCSNM,DIC("DR")=".02////"_$G(IBCSAA),DIC("P")="363.0011P" D ^DIC K DIC,DIE S IBX=1
"RTN","IB20P424",105,0)
RSCSFQ Q IBX
"RTN","IB20P424",106,0)
 ;
"RTN","IB20P424",107,0)
RSEXISTS(EFFDT,NAME) ; return RS IFN if Rate Schedule exists for Effective Date
"RTN","IB20P424",108,0)
 N IBX,IBRSFN,IBRS0 S IBX=0
"RTN","IB20P424",109,0)
 I +$G(EFFDT),$G(NAME)'="" S IBRSFN=0 F  S IBRSFN=$O(^IBE(363,IBRSFN))  Q:'IBRSFN  D  I IBX Q
"RTN","IB20P424",110,0)
 . S IBRS0=$G(^IBE(363,IBRSFN,0))
"RTN","IB20P424",111,0)
 . I $P(IBRS0,U,1)=NAME,$P(IBRS0,U,5)=EFFDT S IBX=IBRSFN
"RTN","IB20P424",112,0)
 Q IBX
"RTN","IB20P424",113,0)
 ;
"RTN","IB20P424",114,0)
MCCRUTL(X,P) ; returns IFN of item in 399.1 if Name is found and piece P is true
"RTN","IB20P424",115,0)
 N IBX,IBY S IBY=""
"RTN","IB20P424",116,0)
 I $G(X)'="" S IBX=0 F  S IBX=$O(^DGCR(399.1,"B",X,IBX)) Q:'IBX  I $P($G(^DGCR(399.1,IBX,0)),U,+$G(P)) S IBY=IBX
"RTN","IB20P424",117,0)
 Q IBY
"RTN","IB20P424",118,0)
 ;
"RTN","IB20P424",119,0)
 ;
"RTN","IB20P424",120,0)
MSG(X) ;
"RTN","IB20P424",121,0)
 D MES^XPDUTL(X)
"RTN","IB20P424",122,0)
 Q
"RTN","IB20P424",123,0)
NRSF ;New Rate Schedules (363)
"RTN","IB20P424",124,0)
 ;; rs name^rate type^bill type^billable service^effective date^
"RTN","IB20P424",125,0)
 ;; administrative fee^adjustment
"RTN","IB20P424",126,0)
 ;;CVA-INPT^CHAMPVA^1^^^^
"RTN","IB20P424",127,0)
 ;;CVA-SNF^CHAMPVA^1^SKILLED NURSING^^^
"RTN","IB20P424",128,0)
 ;;CVA-OPT^CHAMPVA^3^^^^
"RTN","IB20P424",129,0)
 ;;CVA-RX^CHAMPVA^3^^^^S X=X+5
"RTN","IB20P424",130,0)
 ;;CVA RI-INPT^CHAMPVA REIMB. INS.^1^^^^
"RTN","IB20P424",131,0)
 ;;CVA RI-SNF^CHAMPVA REIMB. INS.^1^SKILLED NURSING^^^
"RTN","IB20P424",132,0)
 ;;CVA RI-OPT^CHAMPVA REIMB. INS.^3^^^^
"RTN","IB20P424",133,0)
 ;;CVA RI-RX^CHAMPVA REIMB. INS.^3^^^^S X=X+5
"RTN","IB20P424",134,0)
 ;;
"RTN","IB20P424",135,0)
 ;
"VER")
8.0^22.0
"BLD",8246,6)
^397
**END**
**END**
