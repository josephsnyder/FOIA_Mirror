Released IB*2*391 SEQ #366
Extracted from mail message
**KIDS**:IB*2.0*391^

**INSTALL NAME**
IB*2.0*391
"BLD",7196,0)
IB*2.0*391^INTEGRATED BILLING^0^3080612^y
"BLD",7196,1,0)
^^2^2^3080417^
"BLD",7196,1,1,0)
Modifications to allow NPI to be ACTIVE in both the #200 file and the 
"BLD",7196,1,2,0)
#355.93 file at the same time.
"BLD",7196,4,0)
^9.64PA^355.93^1
"BLD",7196,4,355.93,0)
355.93
"BLD",7196,4,355.93,2,0)
^9.641^355.93^1
"BLD",7196,4,355.93,2,355.93,0)
IB NON/OTHER VA BILLING PROVIDER  (File-top level)
"BLD",7196,4,355.93,2,355.93,1,0)
^9.6411^41.01^1
"BLD",7196,4,355.93,2,355.93,1,41.01,0)
NPI
"BLD",7196,4,355.93,222)
y^n^p^^^^n^^n
"BLD",7196,4,355.93,224)

"BLD",7196,4,"APDD",355.93,355.93)

"BLD",7196,4,"APDD",355.93,355.93,41.01)

"BLD",7196,4,"B",355.93,355.93)

"BLD",7196,6.3)
39
"BLD",7196,"KRN",0)
^9.67PA^8989.52^19
"BLD",7196,"KRN",.4,0)
.4
"BLD",7196,"KRN",.401,0)
.401
"BLD",7196,"KRN",.402,0)
.402
"BLD",7196,"KRN",.403,0)
.403
"BLD",7196,"KRN",.5,0)
.5
"BLD",7196,"KRN",.84,0)
.84
"BLD",7196,"KRN",3.6,0)
3.6
"BLD",7196,"KRN",3.8,0)
3.8
"BLD",7196,"KRN",9.2,0)
9.2
"BLD",7196,"KRN",9.8,0)
9.8
"BLD",7196,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",7196,"KRN",9.8,"NM",1,0)
IBCEP8^^0^B47452533
"BLD",7196,"KRN",9.8,"NM",2,0)
IBCEP81^^0^B63787045
"BLD",7196,"KRN",9.8,"NM",3,0)
IBCEP82^^0^B73798180
"BLD",7196,"KRN",9.8,"NM",4,0)
IBCEF73A^^0^B31517693
"BLD",7196,"KRN",9.8,"NM",5,0)
IBCEP8B^^0^B10681479
"BLD",7196,"KRN",9.8,"NM","B","IBCEF73A",4)

"BLD",7196,"KRN",9.8,"NM","B","IBCEP8",1)

"BLD",7196,"KRN",9.8,"NM","B","IBCEP81",2)

"BLD",7196,"KRN",9.8,"NM","B","IBCEP82",3)

"BLD",7196,"KRN",9.8,"NM","B","IBCEP8B",5)

"BLD",7196,"KRN",19,0)
19
"BLD",7196,"KRN",19,"NM",0)
^9.68A^^
"BLD",7196,"KRN",19.1,0)
19.1
"BLD",7196,"KRN",101,0)
101
"BLD",7196,"KRN",409.61,0)
409.61
"BLD",7196,"KRN",771,0)
771
"BLD",7196,"KRN",870,0)
870
"BLD",7196,"KRN",8989.51,0)
8989.51
"BLD",7196,"KRN",8989.52,0)
8989.52
"BLD",7196,"KRN",8994,0)
8994
"BLD",7196,"KRN","B",.4,.4)

"BLD",7196,"KRN","B",.401,.401)

"BLD",7196,"KRN","B",.402,.402)

"BLD",7196,"KRN","B",.403,.403)

"BLD",7196,"KRN","B",.5,.5)

"BLD",7196,"KRN","B",.84,.84)

"BLD",7196,"KRN","B",3.6,3.6)

"BLD",7196,"KRN","B",3.8,3.8)

"BLD",7196,"KRN","B",9.2,9.2)

"BLD",7196,"KRN","B",9.8,9.8)

"BLD",7196,"KRN","B",19,19)

"BLD",7196,"KRN","B",19.1,19.1)

"BLD",7196,"KRN","B",101,101)

"BLD",7196,"KRN","B",409.61,409.61)

"BLD",7196,"KRN","B",771,771)

"BLD",7196,"KRN","B",870,870)

"BLD",7196,"KRN","B",8989.51,8989.51)

"BLD",7196,"KRN","B",8989.52,8989.52)

"BLD",7196,"KRN","B",8994,8994)

"BLD",7196,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",7196,"QUES",0)
^9.62^^
"BLD",7196,"REQB",0)
^9.611^3^3
"BLD",7196,"REQB",1,0)
IB*2.0*395^1
"BLD",7196,"REQB",2,0)
XU*8.0*480^1
"BLD",7196,"REQB",3,0)
IB*2.0*377^1
"BLD",7196,"REQB","B","IB*2.0*377",3)

"BLD",7196,"REQB","B","IB*2.0*395",1)

"BLD",7196,"REQB","B","XU*8.0*480",2)

"FIA",355.93)
IB NON/OTHER VA BILLING PROVIDER
"FIA",355.93,0)
^IBA(355.93,
"FIA",355.93,0,0)
355.93I
"FIA",355.93,0,1)
y^n^p^^^^n^^n
"FIA",355.93,0,10)

"FIA",355.93,0,11)

"FIA",355.93,0,"RLRO")

"FIA",355.93,0,"VR")
2.0^IB
"FIA",355.93,355.93)
1
"FIA",355.93,355.93,41.01)

"MBREQ")
0
"PKG",179,-1)
1^1
"PKG",179,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",179,20,0)
^9.402P^1^1
"PKG",179,20,1,0)
2^^IBAXDR
"PKG",179,20,1,1)

"PKG",179,20,"B",2,1)

"PKG",179,22,0)
^9.49I^1^1
"PKG",179,22,1,0)
2.0^2940321^2940528
"PKG",179,22,1,"PAH",1,0)
391^3080612^18154
"PKG",179,22,1,"PAH",1,1,0)
^^2^2^3080612
"PKG",179,22,1,"PAH",1,1,1,0)
Modifications to allow NPI to be ACTIVE in both the #200 file and the 
"PKG",179,22,1,"PAH",1,1,2,0)
#355.93 file at the same time.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","IBCEF73A")
0^4^B31517693^B31578985
"RTN","IBCEF73A",1,0)
IBCEF73A ;ALB/KJH - FORMATTER AND EXTRACTOR SPECIFIC (NPI) BILL FUNCTIONS ;30 Aug 2006  10:38 AM
"RTN","IBCEF73A",2,0)
 ;;2.0;INTEGRATED BILLING;**343,374,395,391**;21-MAR-94;Build 39
"RTN","IBCEF73A",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCEF73A",4,0)
 ;
"RTN","IBCEF73A",5,0)
PROVNPI(IBIEN399,IBNONPI) ;
"RTN","IBCEF73A",6,0)
 ;Retrieves NPIs from #200 or 355.93
"RTN","IBCEF73A",7,0)
 ; Input:
"RTN","IBCEF73A",8,0)
 ;       IBIEN399 - IEN of record in BILL/CLAIMS file 399
"RTN","IBCEF73A",9,0)
 ;       IBNONPI - variable to pass info on missing NPI to calling routine.  Pass by reference
"RTN","IBCEF73A",10,0)
 ; Output:
"RTN","IBCEF73A",11,0)
 ;       NPI codes for all providers
"RTN","IBCEF73A",12,0)
 ;       IBNONPI - U-delimited list of provider types with missing NPIs
"RTN","IBCEF73A",13,0)
 N IBRETVAL,IBPTR,IBFT
"RTN","IBCEF73A",14,0)
 S IBRETVAL="",IBNONPI=""
"RTN","IBCEF73A",15,0)
 F IBFT=1:1:9 D
"RTN","IBCEF73A",16,0)
 . S IBPTR=$$PROVPTR^IBCEF7(IBIEN399,IBFT)
"RTN","IBCEF73A",17,0)
 . I IBPTR S $P(IBRETVAL,"^",IBFT)=$$GETNPI(IBPTR)
"RTN","IBCEF73A",18,0)
 Q IBRETVAL
"RTN","IBCEF73A",19,0)
GETNPI(IBPTR) ;look for NPI in #200 or #355.93
"RTN","IBCEF73A",20,0)
 ;Input: IBPTR from 399.0222, field .02
"RTN","IBCEF73A",21,0)
 ;Output: NPI
"RTN","IBCEF73A",22,0)
 ;if in file #200
"RTN","IBCEF73A",23,0)
 N NPI
"RTN","IBCEF73A",24,0)
 S NPI=""
"RTN","IBCEF73A",25,0)
 ;if in 200 then get it from 200
"RTN","IBCEF73A",26,0)
 I $P(IBPTR,";",2)="VA(200," S NPI=$P($$NPI^XUSNPI("Individual_ID",$P(IBPTR,";")),U) S:NPI<1 NPI=""
"RTN","IBCEF73A",27,0)
 ;if in 355.93 then use 355.93
"RTN","IBCEF73A",28,0)
 I $P(IBPTR,";",2)="IBA(355.93," S NPI=$$NPIGET^IBCEP81($P(IBPTR,";"))
"RTN","IBCEF73A",29,0)
 I NPI="",$D(IBNONPI) S IBNONPI=$S(IBNONPI="":IBFT,1:IBNONPI_U_IBFT)
"RTN","IBCEF73A",30,0)
 Q NPI
"RTN","IBCEF73A",31,0)
 ;
"RTN","IBCEF73A",32,0)
SPECTAX(IBIEN399,IBNOSPEC) ;
"RTN","IBCEF73A",33,0)
 ;Retrieves Specialty Codes from Current Taxonomy entries for a claim from #399
"RTN","IBCEF73A",34,0)
 ; Input:
"RTN","IBCEF73A",35,0)
 ;       IBIEN399 - IEN of record in BILL/CLAIMS file 399
"RTN","IBCEF73A",36,0)
 ;       IBNOSPEC - variable to pass info on missing taxonomies to calling routine.  Pass by reference
"RTN","IBCEF73A",37,0)
 ; Output:
"RTN","IBCEF73A",38,0)
 ;       Taxonomy Specialty Codes for all providers
"RTN","IBCEF73A",39,0)
 ;       IBNOSPEC - U-delimited list of provider types with missing Taxonomy Specialty codes
"RTN","IBCEF73A",40,0)
 N IBRETVAL,IBN,IBFT,IBSPEC,SPEC
"RTN","IBCEF73A",41,0)
 S IBRETVAL="",IBNOSPEC=""
"RTN","IBCEF73A",42,0)
 I $G(IBIEN399)="" Q ""
"RTN","IBCEF73A",43,0)
 F IBFT=1:1:9 D
"RTN","IBCEF73A",44,0)
 . S IBN=$O(^DGCR(399,IBIEN399,"PRV","B",IBFT,0))
"RTN","IBCEF73A",45,0)
 . I +IBN=0 Q
"RTN","IBCEF73A",46,0)
 . S IBSPEC=$P($G(^DGCR(399,IBIEN399,"PRV",+IBN,0)),"^",15)
"RTN","IBCEF73A",47,0)
 . S SPEC=$$GET1^DIQ(8932.1,IBSPEC,"SPECIALTY CODE")
"RTN","IBCEF73A",48,0)
 . S $P(IBRETVAL,"^",IBFT)=SPEC
"RTN","IBCEF73A",49,0)
 . I SPEC="",$D(IBNOSPEC) S IBNOSPEC=$S(IBNOSPEC="":IBFT,1:IBNOSPEC_U_IBFT)
"RTN","IBCEF73A",50,0)
 Q IBRETVAL
"RTN","IBCEF73A",51,0)
 ;
"RTN","IBCEF73A",52,0)
PROVTAX(IBIEN399,IBNOTAX) ;
"RTN","IBCEF73A",53,0)
 ;Retrieves Current Taxonomy entries for a claim from #399
"RTN","IBCEF73A",54,0)
 ; Input:
"RTN","IBCEF73A",55,0)
 ;       IBIEN399 - IEN of record in BILL/CLAIMS file 399
"RTN","IBCEF73A",56,0)
 ;       IBNOTAX - variable to pass info on missing taxonomies to calling routine.  Pass by reference
"RTN","IBCEF73A",57,0)
 ; Output:
"RTN","IBCEF73A",58,0)
 ;       Taxonomy X12 codes for all providers
"RTN","IBCEF73A",59,0)
 ;       IBNOTAX - U-delimited list of provider types with missing Taxonomy X12 codes
"RTN","IBCEF73A",60,0)
 N IBRETVAL,IBN,IBFT,IBTAX,TAX
"RTN","IBCEF73A",61,0)
 S IBRETVAL="",IBNOTAX=""
"RTN","IBCEF73A",62,0)
 I $G(IBIEN399)="" Q ""
"RTN","IBCEF73A",63,0)
 F IBFT=1:1:9 D
"RTN","IBCEF73A",64,0)
 . S IBN=$O(^DGCR(399,IBIEN399,"PRV","B",IBFT,0))
"RTN","IBCEF73A",65,0)
 . I +IBN=0 Q
"RTN","IBCEF73A",66,0)
 . S IBTAX=$P($G(^DGCR(399,IBIEN399,"PRV",+IBN,0)),"^",15)
"RTN","IBCEF73A",67,0)
 . S TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",68,0)
 . S $P(IBRETVAL,"^",IBFT)=TAX
"RTN","IBCEF73A",69,0)
 . I TAX="",$D(IBNOTAX) S IBNOTAX=$S(IBNOTAX="":IBFT,1:IBNOTAX_U_IBFT)
"RTN","IBCEF73A",70,0)
 Q IBRETVAL
"RTN","IBCEF73A",71,0)
GETTAX(IBPTR) ;look for Taxonomy in #200 or #355.93
"RTN","IBCEF73A",72,0)
 ;Input: IBPTR from 399.0222, field .02
"RTN","IBCEF73A",73,0)
 ;Output: Taxonomy X12 code_"^"_IEN
"RTN","IBCEF73A",74,0)
 N TAX
"RTN","IBCEF73A",75,0)
 S TAX="^"
"RTN","IBCEF73A",76,0)
 ;if in 200 then get it from 200
"RTN","IBCEF73A",77,0)
 I $P(IBPTR,";",2)="VA(200," S TAX=$$TAXIND^XUSTAX($P(IBPTR,";"))
"RTN","IBCEF73A",78,0)
 ;if in 355.93 then use 355.93
"RTN","IBCEF73A",79,0)
 I $P(IBPTR,";",2)="IBA(355.93," S TAX=$$TAXGET^IBCEP81($P(IBPTR,";"))
"RTN","IBCEF73A",80,0)
 Q TAX
"RTN","IBCEF73A",81,0)
 ;
"RTN","IBCEF73A",82,0)
ORGNPI(IBIEN399,IBNONPI) ; Extract NPIs for organizations on this claim
"RTN","IBCEF73A",83,0)
 ; Input
"RTN","IBCEF73A",84,0)
 ;       IBIEN399 - Claim IEN in file 399
"RTN","IBCEF73A",85,0)
 ;       IBNONPI - Variable to pass info on missing NPI back to calling routine.  Pass by reference.
"RTN","IBCEF73A",86,0)
 ; Output - NPI codes for facilities
"RTN","IBCEF73A",87,0)
 ;        Piece 1) Division (Responsible Institution) NPI code
"RTN","IBCEF73A",88,0)
 ;        Piece 2) Non-VA Service Facility NPI code
"RTN","IBCEF73A",89,0)
 ;        Piece 3) Billing Provider NPI code (main VA division)
"RTN","IBCEF73A",90,0)
 N IBRETVAL,IBORG,IBEVDT,IBDIV,NPI
"RTN","IBCEF73A",91,0)
 S IBNONPI=""
"RTN","IBCEF73A",92,0)
 I $G(IBIEN399)="" Q ""
"RTN","IBCEF73A",93,0)
 S IBRETVAL=""
"RTN","IBCEF73A",94,0)
 S IBEVDT=$$GET1^DIQ(399,IBIEN399_",",.03,"I")
"RTN","IBCEF73A",95,0)
 I IBEVDT="" S IBEVDT=DT
"RTN","IBCEF73A",96,0)
 S IBDIV=$$GET1^DIQ(399,IBIEN399_",",.22,"I")
"RTN","IBCEF73A",97,0)
 I IBDIV="" S IBDIV=$$PRIM^VASITE(IBEVDT)
"RTN","IBCEF73A",98,0)
 S IBORG=$P($$SITE^VASITE(IBEVDT,IBDIV),U),NPI=""
"RTN","IBCEF73A",99,0)
 I IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U) S:NPI>0 $P(IBRETVAL,U)=NPI
"RTN","IBCEF73A",100,0)
 I NPI<1,$D(IBNONPI) S IBNONPI=1
"RTN","IBCEF73A",101,0)
 S IBORG=$$GET1^DIQ(399,IBIEN399_",",232,"I")
"RTN","IBCEF73A",102,0)
 I IBORG S NPI=$$NPIGET^IBCEP81(IBORG),$P(IBRETVAL,U,2)=NPI I 'NPI,$D(IBNONPI) S IBNONPI=$S(IBNONPI="":2,1:IBNONPI_U_2)
"RTN","IBCEF73A",103,0)
 S IBORG=$P($$SITE^VASITE,U),NPI=""
"RTN","IBCEF73A",104,0)
 I IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U) S:NPI>0 $P(IBRETVAL,U,3)=NPI
"RTN","IBCEF73A",105,0)
 I NPI<1,$D(IBNONPI) S IBNONPI=$S(IBNONPI="":3,1:IBNONPI_U_3)
"RTN","IBCEF73A",106,0)
 I $$ISRX^IBCEF1(IBIEN399) S IBORG=$$RXSITE(IBIEN399) I IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U) S:NPI>0 $P(IBRETVAL,U,3)=NPI
"RTN","IBCEF73A",107,0)
 Q IBRETVAL
"RTN","IBCEF73A",108,0)
 ;
"RTN","IBCEF73A",109,0)
ORGTAX(IBIEN399,IBNOTAX) ; Extract Taxonomies for organizations on this claim
"RTN","IBCEF73A",110,0)
 ; Input
"RTN","IBCEF73A",111,0)
 ;       IBIEN399 - Claim IEN in file 399
"RTN","IBCEF73A",112,0)
 ;       IBNOTAX - Variable to pass info on missing taxonomies back to calling routine.  Pass by reference.
"RTN","IBCEF73A",113,0)
 ; Output - Taxonomy X12 codes for facilities
"RTN","IBCEF73A",114,0)
 ;        Piece 1) Division (Responsible Institution) Taxonomy X12 code
"RTN","IBCEF73A",115,0)
 ;        Piece 2) Non-VA Service Facility Taxonomy X12 code
"RTN","IBCEF73A",116,0)
 ;        Piece 3) Billing Provider Taxonomy X12 code (main VA division)
"RTN","IBCEF73A",117,0)
 N IBRETVAL,IBTAX,TAX
"RTN","IBCEF73A",118,0)
 S IBTAX=$$GET1^DIQ(399,IBIEN399_",",243,"I")
"RTN","IBCEF73A",119,0)
 S TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",120,0)
 S $P(IBRETVAL,U)=TAX
"RTN","IBCEF73A",121,0)
 I '$L(TAX),$D(IBNOTAX) S IBNOTAX=1
"RTN","IBCEF73A",122,0)
 S IBTAX=$$GET1^DIQ(399,IBIEN399_",",244,"I")
"RTN","IBCEF73A",123,0)
 S TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",124,0)
 S $P(IBRETVAL,U,2)=TAX
"RTN","IBCEF73A",125,0)
 I '$L(TAX),$$GET1^DIQ(399,IBIEN399_",",232,"I"),$D(IBNOTAX) S IBNOTAX=$S(IBNOTAX="":2,1:IBNOTAX_U_2)
"RTN","IBCEF73A",126,0)
 S IBORG=$P($$SITE^VASITE,U)
"RTN","IBCEF73A",127,0)
 S TAX=$P($$TAXORG^XUSTAX(IBORG),U)
"RTN","IBCEF73A",128,0)
 S $P(IBRETVAL,U,3)=TAX
"RTN","IBCEF73A",129,0)
 I '$L(TAX),$D(IBNOTAX) S IBNOTAX=$S(IBNOTAX="":3,1:IBNOTAX_U_3)
"RTN","IBCEF73A",130,0)
 Q IBRETVAL
"RTN","IBCEF73A",131,0)
 ;
"RTN","IBCEF73A",132,0)
RXSITE(IBIEN399,IBLIST) ; returns prescription organization (file 4) pointer
"RTN","IBCEF73A",133,0)
 ; for the given bill.  If IBLIST passed by reference, then a list of
"RTN","IBCEF73A",134,0)
 ; the possible organizations are returned for a bill, since a bill may
"RTN","IBCEF73A",135,0)
 ; have more than one prescription.  If more than one rx on the bill, the
"RTN","IBCEF73A",136,0)
 ; $$ return is the pointer of the last prescription found.
"RTN","IBCEF73A",137,0)
 ; IBLIST(rx ien,fill date)=ORGINATION (file 4 pointer)
"RTN","IBCEF73A",138,0)
 ;
"RTN","IBCEF73A",139,0)
 N IBX,IBDATA,IBORG,IBRX,IBDT,IBY,IBRXN,DFN
"RTN","IBCEF73A",140,0)
 K ^TMP($J,"IBCEF73A")
"RTN","IBCEF73A",141,0)
 S IBORG=0,DFN=$P($G(^DGCR(399,IBIEN399,0)),"^",2),IBLIST="IBCEF73A"
"RTN","IBCEF73A",142,0)
 S IBRXN=0 F  S IBRXN=$O(^IBA(362.4,"AIFN"_IBIEN399,IBRXN)) Q:'IBRXN  S IBX=0 F  S IBX=$O(^IBA(362.4,"AIFN"_IBIEN399,IBRXN,IBX)) Q:'IBX  D
"RTN","IBCEF73A",143,0)
 . S IBDATA=$G(^IBA(362.4,IBX,0))
"RTN","IBCEF73A",144,0)
 . S IBRX=$P(IBDATA,"^",5),IBDT=$P(IBDATA,"^",3) Q:'IBRX!('IBDT)
"RTN","IBCEF73A",145,0)
 . D RX^PSO52API(DFN,IBLIST,IBRX,,"0,2,R")
"RTN","IBCEF73A",146,0)
 . I IBDT=+$G(^TMP($J,"IBCEF73A",DFN,IBRX,22)) S (IBORG,IBLIST(IBRX,IBDT))=$$PSONPI(+$G(^TMP($J,"IBCEF73A",DFN,IBRX,20))) Q
"RTN","IBCEF73A",147,0)
 . S IBY=0 F  S IBY=$O(^TMP($J,"IBCEF73A",DFN,IBRX,"RF",IBY)) Q:'IBY  I IBDT=+$G(^TMP($J,"IBCEF73A",DFN,IBRX,"RF",IBY,.01)) S (IBORG,IBLIST(IBRX,IBDT))=$$PSONPI(+$G(^TMP($J,"IBCEF73A",DFN,IBRX,"RF",IBY,8))) Q
"RTN","IBCEF73A",148,0)
 K ^TMP($J,"IBCEF73A")
"RTN","IBCEF73A",149,0)
 Q IBORG
"RTN","IBCEF73A",150,0)
 ;
"RTN","IBCEF73A",151,0)
PSONPI(IB59IEN) ; returns institution ien for a file 59 ien
"RTN","IBCEF73A",152,0)
 N IB4IEN
"RTN","IBCEF73A",153,0)
 K ^TMP($J,"IBCEF59")
"RTN","IBCEF73A",154,0)
 D PSS^PSO59(IB59IEN,,"IBCEF59")
"RTN","IBCEF73A",155,0)
 S IB4IEN=+$G(^TMP($J,"IBCEF59",IB59IEN,101))
"RTN","IBCEF73A",156,0)
 K ^TMP($J,"IBCEF59")
"RTN","IBCEF73A",157,0)
 Q IB4IEN
"RTN","IBCEP8")
0^1^B47452533^B80393448
"RTN","IBCEP8",1,0)
IBCEP8 ;ALB/TMP - Functions for NON-VA PROVIDER ;11-07-00
"RTN","IBCEP8",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,232,288,320,343,374,377,391**;21-MAR-94;Build 39
"RTN","IBCEP8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEP8",4,0)
 ;
"RTN","IBCEP8",5,0)
EN ; -- main entry point
"RTN","IBCEP8",6,0)
 N IBNPRV
"RTN","IBCEP8",7,0)
 K IBFASTXT
"RTN","IBCEP8",8,0)
 D FULL^VALM1
"RTN","IBCEP8",9,0)
 D EN^VALM("IBCE PRVNVA MAINT")
"RTN","IBCEP8",10,0)
 Q
"RTN","IBCEP8",11,0)
 ;
"RTN","IBCEP8",12,0)
HDR ; -- header code
"RTN","IBCEP8",13,0)
 K VALMHDR
"RTN","IBCEP8",14,0)
 Q
"RTN","IBCEP8",15,0)
 ;
"RTN","IBCEP8",16,0)
INIT ; Initialization
"RTN","IBCEP8",17,0)
 N DIC,DA,X,Y,DLAYGO,IBIF,DIR,DTOUT,DUOUT
"RTN","IBCEP8",18,0)
 K ^TMP("IBCE_PRVNVA_MAINT",$J)
"RTN","IBCEP8",19,0)
 ;
"RTN","IBCEP8",20,0)
 ; if coming in from main routine ^IBCEP6 this special variable IBNVPMIF is set already
"RTN","IBCEP8",21,0)
 I $G(IBNVPMIF)'="" S IBIF=IBNVPMIF G INIT1
"RTN","IBCEP8",22,0)
 ;
"RTN","IBCEP8",23,0)
 S DIR("A")="(I)NDIVIDUAL OR (F)ACILITY?: ",DIR(0)="SA^I:INDIVIDUAL;F:FACILITY" D ^DIR K DIR
"RTN","IBCEP8",24,0)
 I $D(DUOUT)!$D(DTOUT) S VALMQUIT=1 G INITQ
"RTN","IBCEP8",25,0)
 S IBIF=Y
"RTN","IBCEP8",26,0)
 ;
"RTN","IBCEP8",27,0)
INIT1 ;
"RTN","IBCEP8",28,0)
 ;
"RTN","IBCEP8",29,0)
 I IBIF="F" D
"RTN","IBCEP8",30,0)
 . S VALM("TITLE")="Non-VA Lab or Facility Info"
"RTN","IBCEP8",31,0)
 . K VALM("PROTOCOL")
"RTN","IBCEP8",32,0)
 . S Y=$$FIND1^DIC(101,,,"IBCE PRVNVA NONIND MAINT")
"RTN","IBCEP8",33,0)
 . I Y S VALM("PROTOCOL")=+Y_";ORD(101,"
"RTN","IBCEP8",34,0)
 ;
"RTN","IBCEP8",35,0)
 S DIC="^IBA(355.93,",DIC("DR")=".02///"_$S(IBIF'="F":2,1:1)
"RTN","IBCEP8",36,0)
 S DIC("S")="I $P(^(0),U,2)="_$S(IBIF'="F":2,1:1)
"RTN","IBCEP8",37,0)
 S DLAYGO=355.93,DIC(0)="AELMQ",DIC("A")="Select a NON"_$S(IBIF="I":"-",1:"/OTHER ")_"VA PROVIDER: "
"RTN","IBCEP8",38,0)
 D ^DIC K DIC,DLAYGO
"RTN","IBCEP8",39,0)
 I Y'>0 S VALMQUIT=1 G INITQ
"RTN","IBCEP8",40,0)
 S IBNPRV=+Y
"RTN","IBCEP8",41,0)
 D BLD^IBCEP8B(IBNPRV)
"RTN","IBCEP8",42,0)
INITQ Q
"RTN","IBCEP8",43,0)
 ;
"RTN","IBCEP8",44,0)
EXPND ;
"RTN","IBCEP8",45,0)
 Q
"RTN","IBCEP8",46,0)
 ;
"RTN","IBCEP8",47,0)
HELP ;
"RTN","IBCEP8",48,0)
 Q
"RTN","IBCEP8",49,0)
 ;
"RTN","IBCEP8",50,0)
EXIT ;
"RTN","IBCEP8",51,0)
 K ^TMP("IBCE_PRVNVA_MAINT",$J)
"RTN","IBCEP8",52,0)
 D CLEAN^VALM10
"RTN","IBCEP8",53,0)
 K IBFASTXT
"RTN","IBCEP8",54,0)
 Q
"RTN","IBCEP8",55,0)
 ;
"RTN","IBCEP8",56,0)
EDIT1(IBNPRV,IBNOLM) ; Edit non-VA provider/facility demographics
"RTN","IBCEP8",57,0)
 ; IBNPRV = ien of entry in file 355.93
"RTN","IBCEP8",58,0)
 ; IBNOLM = 1 if not called from list manager
"RTN","IBCEP8",59,0)
 ;
"RTN","IBCEP8",60,0)
 N DA,X,Y,DIE,DR,IBP
"RTN","IBCEP8",61,0)
 I '$G(IBNOLM) D FULL^VALM1
"RTN","IBCEP8",62,0)
 I IBNPRV D
"RTN","IBCEP8",63,0)
 . I '$G(IBNOLM) D CLEAR^VALM1
"RTN","IBCEP8",64,0)
 . S DIE="^IBA(355.93,",DA=IBNPRV,IBP=($P($G(^IBA(355.93,IBNPRV,0)),U,2)=2)
"RTN","IBCEP8",65,0)
 . ; PRXM/KJH - Added NPI and Taxonomy to the list of fields to be edited. Put a "NO^" around the Taxonomy multiple (#42) since some of the sub-field entries are 'required'.
"RTN","IBCEP8",66,0)
 . S DR=".01;"_$S(IBP:".03;.04",1:".05;.1;.06;.07;.08;.13///24;W !,""ID Qualifier: 24 - EMPLOYER'S IDENTIFICATION #"";.09Lab or Facility Primary ID;.11;.15")_";D PRENPI^IBCEP81(IBNPRV);D EN^IBCEP82(IBNPRV);S DIE(""NO^"")="""";42;K DIE(""NO^"")"
"RTN","IBCEP8",67,0)
 . D ^DIE
"RTN","IBCEP8",68,0)
 . Q:$G(IBNOLM)
"RTN","IBCEP8",69,0)
 . D BLD^IBCEP8B(IBNPRV)
"RTN","IBCEP8",70,0)
 I '$G(IBNOLM) K VALMBCK S VALMBCK="R"
"RTN","IBCEP8",71,0)
 Q
"RTN","IBCEP8",72,0)
 ;
"RTN","IBCEP8",73,0)
EDITID(IBNPRV,IBSLEV) ; Link from this list template to maintain provider-specific ids
"RTN","IBCEP8",74,0)
 ; This entry point is called by 4 action protocols.
"RTN","IBCEP8",75,0)
 ; IBNPRV = ien of entry in file 355.93 (can be either an individual or a facility) (required)
"RTN","IBCEP8",76,0)
 ; IBSLEV = 1 for facility/provider own ID's
"RTN","IBCEP8",77,0)
 ; IBSLEV = 2 for facility/provider ID's furnished by an insurance company
"RTN","IBCEP8",78,0)
 ;
"RTN","IBCEP8",79,0)
 Q:'$G(IBNPRV)
"RTN","IBCEP8",80,0)
 Q:'$G(IBSLEV)
"RTN","IBCEP8",81,0)
 N IBPRV,IBIF
"RTN","IBCEP8",82,0)
 D FULL^VALM1    ; set full scrolling region
"RTN","IBCEP8",83,0)
 D CLEAR^VALM1   ; clear screen
"RTN","IBCEP8",84,0)
 S IBPRV=IBNPRV
"RTN","IBCEP8",85,0)
 ;
"RTN","IBCEP8",86,0)
 K IBFASTXT
"RTN","IBCEP8",87,0)
 S IBIF=$$GET1^DIQ(355.93,IBPRV,.02,"I")    ; 1=facility/group      2=individual
"RTN","IBCEP8",88,0)
 D EN^VALM("IBCE PRVPRV MAINT")
"RTN","IBCEP8",89,0)
 ;
"RTN","IBCEP8",90,0)
 K VALMQUIT
"RTN","IBCEP8",91,0)
 S VALMBCK=$S($G(IBFASTXT)'="":"Q",1:"R")
"RTN","IBCEP8",92,0)
 Q
"RTN","IBCEP8",93,0)
 ;
"RTN","IBCEP8",94,0)
NVAFAC ; Enter/edit Non-VA facility information
"RTN","IBCEP8",95,0)
 ; This entry point is called by the menu system for option IBCE PRVNVA FAC EDIT
"RTN","IBCEP8",96,0)
 N X,Y,DA,DIC,IBNPRV,DLAYGO
"RTN","IBCEP8",97,0)
 S DIC="^IBA(355.93,",DIC("S")="I $P(^(0),U,2)=1",DIC("DR")=".02///1"
"RTN","IBCEP8",98,0)
 S DLAYGO=355.93,DIC(0)="AELMQ",DIC("A")="Select a NON/Other VA FACILITY: "
"RTN","IBCEP8",99,0)
 D ^DIC K DIC,DLAYGO
"RTN","IBCEP8",100,0)
 I Y'>0 S VALMQUIT=1 G NVAFACQ
"RTN","IBCEP8",101,0)
 S IBNPRV=+Y
"RTN","IBCEP8",102,0)
 D EDIT1(IBNPRV,1)
"RTN","IBCEP8",103,0)
 ;
"RTN","IBCEP8",104,0)
NVAFACQ Q
"RTN","IBCEP8",105,0)
 ;
"RTN","IBCEP8",106,0)
GETFAC(IB,IBFILE,IBELE,IBSFD) ; Returns facility name,address lines or city-state-zip
"RTN","IBCEP8",107,0)
 ; IB = ien of entry in file
"RTN","IBCEP8",108,0)
 ; IBFILE = 0 for retrieval from file 4, 1 for retrieval from file 355.93
"RTN","IBCEP8",109,0)
 ; If IBELE=0, returns name
"RTN","IBCEP8",110,0)
 ;         =1, returns address line 1
"RTN","IBCEP8",111,0)
 ;         =2, returns address line 2
"RTN","IBCEP8",112,0)
 ;         =3, returns city, state zip
"RTN","IBCEP8",113,0)
 ;         = "3C", returns city  = "3S", state    = "3Z", zip
"RTN","IBCEP8",114,0)
 ; IBSFD (optional) = Output formatter segment name if the output needs
"RTN","IBCEP8",115,0)
 ;       to be screened thru the VAMCFD^IBCEF75 procedure for the flag
"RTN","IBCEP8",116,0)
 ;       in the insurance company file
"RTN","IBCEP8",117,0)
 ;
"RTN","IBCEP8",118,0)
 N Z,IBX,IBZ
"RTN","IBCEP8",119,0)
 S IBX=""
"RTN","IBCEP8",120,0)
 ;
"RTN","IBCEP8",121,0)
 I $G(IBSFD)="SUB" D VAMCFD^IBCEF75(+$G(IBXIEN),.IBZ) I $D(IBZ),'$G(IBZ("C",1)) G GETFACX
"RTN","IBCEP8",122,0)
 ;
"RTN","IBCEP8",123,0)
 S Z=$S('IBFILE:$G(^DIC(4,+IB,1)),1:$G(^IBA(355.93,+IB,0)))
"RTN","IBCEP8",124,0)
 I +IBELE=0 S IBX=$S('IBFILE:$P($G(^DIC(4,+IB,0)),U),1:$P($G(^IBA(355.93,+IB,0)),U))
"RTN","IBCEP8",125,0)
 I IBELE=1!(IBELE=12) S IBX=$S('IBFILE:$P(Z,U),1:$P(Z,U,5))
"RTN","IBCEP8",126,0)
 I IBELE=2!(IBELE=12) S IBX=$S(IBELE=12:IBX_" ",1:"")_$S('IBFILE:$P(Z,U,2),1:$P(Z,U,10))
"RTN","IBCEP8",127,0)
 ;
"RTN","IBCEP8",128,0)
 I +IBELE=3,'IBFILE D
"RTN","IBCEP8",129,0)
 . S:IBELE=3!(IBELE["C") IBX=$P(Z,U,3) Q:IBELE["C"
"RTN","IBCEP8",130,0)
 . S:IBELE=3 IBX=IBX_$S(IBX'="":", ",1:"") S:IBELE=3!(IBELE["S") IBX=IBX_$$STATE^IBCEFG1($P($G(^DIC(4,+IB,0)),U,2)) Q:IBELE["S"
"RTN","IBCEP8",131,0)
 . S:IBELE=3 IBX=IBX_" " S:IBELE=3!(IBELE["Z") IBX=IBX_$P(Z,U,4)
"RTN","IBCEP8",132,0)
 . Q
"RTN","IBCEP8",133,0)
 ;
"RTN","IBCEP8",134,0)
 I +IBELE=3,IBFILE D
"RTN","IBCEP8",135,0)
 . S:IBELE=3!(IBELE["C") IBX=$P(Z,U,6) Q:IBELE["C"
"RTN","IBCEP8",136,0)
 . S:IBELE=3 IBX=IBX_$S(IBX'="":", ",1:"") S:IBELE=3!(IBELE["S") IBX=IBX_$$STATE^IBCEFG1($P(Z,U,7))
"RTN","IBCEP8",137,0)
 . S:IBELE=3 IBX=IBX_" " S:IBELE=3!(IBELE["Z") IBX=IBX_$P(Z,U,8)
"RTN","IBCEP8",138,0)
 . Q
"RTN","IBCEP8",139,0)
GETFACX ;
"RTN","IBCEP8",140,0)
 Q IBX
"RTN","IBCEP8",141,0)
 ;
"RTN","IBCEP8",142,0)
ALLID(IBPRV,IBPTYP,IBZ) ; Returns array IBZ for all ids for provider IBPRV
"RTN","IBCEP8",143,0)
 ; for all provider id types or for id type in IBPTYP
"RTN","IBCEP8",144,0)
 ; IBPRV = vp ien of provider
"RTN","IBCEP8",145,0)
 ; IBPTYP = ien of provider id type to return or "" for all
"RTN","IBCEP8",146,0)
 ; IBZ = array returned with internal data:
"RTN","IBCEP8",147,0)
 ;  IBZ(file 355.9 ien)=ID type^ID#^ins co^form type^bill care type^care un^X12 code for id type
"RTN","IBCEP8",148,0)
 N Z,Z0
"RTN","IBCEP8",149,0)
 K IBZ
"RTN","IBCEP8",150,0)
 G:'$G(IBPRV) ALLIDQ
"RTN","IBCEP8",151,0)
 S IBPTYP=$G(IBPTYP)
"RTN","IBCEP8",152,0)
 S Z=0 F  S Z=$O(^IBA(355.9,"B",IBPRV,Z)) Q:'Z  S Z0=$G(^IBA(355.9,Z,0)) D
"RTN","IBCEP8",153,0)
 . I $S(IBPTYP="":1,1:($P(Z0,U,6)=IBPTYP)) S IBZ(Z)=($P(Z0,U,6)_U_$P(Z0,U,7)_U_$P(Z0,U,2)_U_$P(Z0,U,4)_U_$P(Z0,U,5)_U_$P(Z0,U,3))_U_$P($G(^IBE(355.97,+$P(Z0,U,6),0)),U,3)
"RTN","IBCEP8",154,0)
 ;
"RTN","IBCEP8",155,0)
ALLIDQ Q
"RTN","IBCEP8",156,0)
 ;
"RTN","IBCEP8",157,0)
CLIA() ; Returns ien of CLIA # provider id type
"RTN","IBCEP8",158,0)
 N Z,IBZ
"RTN","IBCEP8",159,0)
 S (IBZ,Z)=0 F  S Z=$O(^IBE(355.97,Z)) Q:'Z  I $P($G(^(Z,0)),U,3)="X4",$P(^(0),U)["CLIA" S IBZ=Z Q
"RTN","IBCEP8",160,0)
 Q IBZ
"RTN","IBCEP8",161,0)
 ;
"RTN","IBCEP8",162,0)
STLIC() ; Returns ien of STLIC# provider id type
"RTN","IBCEP8",163,0)
 N Z,IBZ
"RTN","IBCEP8",164,0)
 S (IBZ,Z)=0 F  S Z=$O(^IBE(355.97,Z)) Q:'Z  I $P($G(^(Z,1)),U,3) S IBZ=Z Q
"RTN","IBCEP8",165,0)
 Q IBZ
"RTN","IBCEP8",166,0)
 ;
"RTN","IBCEP8",167,0)
TAXID() ; Returns ien of Fed tax id provider id type
"RTN","IBCEP8",168,0)
 N Z,IBZ
"RTN","IBCEP8",169,0)
 S (IBZ,Z)=0 F  S Z=$O(^IBE(355.97,Z)) Q:'Z  I $P($G(^(Z,1)),U,4) S IBZ=Z Q
"RTN","IBCEP8",170,0)
 Q IBZ
"RTN","IBCEP8",171,0)
 ;
"RTN","IBCEP8",172,0)
CLIANVA(IBIFN) ; Returns CLIA # for a non-VA facility on bill ien IBIFN
"RTN","IBCEP8",173,0)
 N IBCLIA,IBZ,IBNVA,Z
"RTN","IBCEP8",174,0)
 S IBCLIA="",IBZ=$$CLIA()
"RTN","IBCEP8",175,0)
 I IBZ D
"RTN","IBCEP8",176,0)
 . S IBNVA=$P($G(^DGCR(399,IBIFN,"U2")),U,10) Q:'IBNVA
"RTN","IBCEP8",177,0)
 . S IBCLIA=$$IDFIND^IBCEP2(IBIFN,IBZ,IBNVA_";IBA(355.93,","",1)
"RTN","IBCEP8",178,0)
 Q IBCLIA
"RTN","IBCEP8",179,0)
 ;
"RTN","IBCEP8",180,0)
VALFAC(X) ; Function returns 1 if format is valid for X12 facility name
"RTN","IBCEP8",181,0)
 ; Alpha/numeric/certain punctuation valid.  Must start with an Alpha
"RTN","IBCEP8",182,0)
 N OK,VAL
"RTN","IBCEP8",183,0)
 S OK=1
"RTN","IBCEP8",184,0)
 S VAL("A")="",VAL("N")="",VAL=",.- "
"RTN","IBCEP8",185,0)
 I $E(X)'?1A!'$$VALFMT(X,.VAL) S OK=0
"RTN","IBCEP8",186,0)
 Q OK
"RTN","IBCEP8",187,0)
 ;
"RTN","IBCEP8",188,0)
VALFMT(X,VAL) ; Returns 1 if format of X is valid, 0 if not
"RTN","IBCEP8",189,0)
 ; X = data to be examined
"RTN","IBCEP8",190,0)
 ; VAL = a 'string' of valid characters AND/OR (passed by reference)
"RTN","IBCEP8",191,0)
 ;    if VAL("A") defined ==> Alpha
"RTN","IBCEP8",192,0)
 ;    if VAL("A") defined ==> Numeric valid
"RTN","IBCEP8",193,0)
 ;    if VAL("A") defined ==> Punctuation valid
"RTN","IBCEP8",194,0)
 ;   any other character included in the string is checked individually
"RTN","IBCEP8",195,0)
 N Z
"RTN","IBCEP8",196,0)
 I $D(VAL("A")) D
"RTN","IBCEP8",197,0)
 . N Z0
"RTN","IBCEP8",198,0)
 . F Z=1:1:$L(X) I $E(X,Z)?1A S Z0(Z)=""
"RTN","IBCEP8",199,0)
 . S Z0="" F  S Z0=$O(Z0(Z0),-1) Q:'Z0  S $E(X,Z0)=""
"RTN","IBCEP8",200,0)
 I $D(VAL("N")) D
"RTN","IBCEP8",201,0)
 . N Z0
"RTN","IBCEP8",202,0)
 . F Z=1:1:$L(X) I $E(X,Z)?1N S Z0(Z)=""
"RTN","IBCEP8",203,0)
 . S Z0="" F  S Z0=$O(Z0(Z0),-1) Q:'Z0  S $E(X,Z0)=""
"RTN","IBCEP8",204,0)
 I $D(VAL("P")) D
"RTN","IBCEP8",205,0)
 . N Z0
"RTN","IBCEP8",206,0)
 . F Z=1:1:$L(X) I $E(X,Z)?1P S Z0(Z)=""
"RTN","IBCEP8",207,0)
 . S Z0="" F  S Z0=$O(Z0(Z0),-1) Q:'Z0  S $E(X,Z0)=""
"RTN","IBCEP8",208,0)
 I $G(VAL)'="" S X=$TR(X,VAL,"")
"RTN","IBCEP8",209,0)
 Q (X="")
"RTN","IBCEP8",210,0)
 ;
"RTN","IBCEP8",211,0)
PS(IBXSAVE) ; Returns 1 if IBXSAVE("PSVC") indicates the svc was non-lab
"RTN","IBCEP8",212,0)
 ; 
"RTN","IBCEP8",213,0)
 Q $S($G(IBXSAVE("PSVC"))="":0,1:"13"[IBXSAVE("PSVC"))
"RTN","IBCEP8",214,0)
 ;
"RTN","IBCEP8",215,0)
 ; Pass in the Internal Entry number to File 355.93
"RTN","IBCEP8",216,0)
 ; Return the Primary ID and Qualifier (ID Type) from 355.9
"RTN","IBCEP8",217,0)
PRIMID(IEN35593) ; Return External Primary ID and ID Quailier
"RTN","IBCEP8",218,0)
 N INDXVAL,LIST,MSG,IDCODE
"RTN","IBCEP8",219,0)
 S INDXVAL=IEN35593_";IBA(355.93,"
"RTN","IBCEP8",220,0)
 N SCREEN S SCREEN="I $P(^(0),U,8)"
"RTN","IBCEP8",221,0)
 D FIND^DIC(355.9,,"@;.06EI;.07","Q",INDXVAL,,,SCREEN,,"LIST","MSG")
"RTN","IBCEP8",222,0)
 I '+$G(LIST("DILIST",0)) Q ""   ; No Primary ID
"RTN","IBCEP8",223,0)
 I +$G(LIST("DILIST",0))>1 Q "***ERROR***^***ERROR***"  ; Bad.  More than one. 
"RTN","IBCEP8",224,0)
 ; Found just one
"RTN","IBCEP8",225,0)
 S IDCODE=$$GET1^DIQ(355.97,LIST("DILIST","ID",1,.06,"I"),.03)
"RTN","IBCEP8",226,0)
 Q $G(LIST("DILIST","ID",1,.07))_U_IDCODE_" - "_$G(LIST("DILIST","ID",1,.06,"E"))
"RTN","IBCEP81")
0^2^B63787045^B19908581
"RTN","IBCEP81",1,0)
IBCEP81 ;ALB/KJH - NPI and Taxonomy Functions ;19 Apr 2008  5:17 PM
"RTN","IBCEP81",2,0)
 ;;2.0;INTEGRATED BILLING;**343,391**;21-MAR-94;Build 39
"RTN","IBCEP81",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEP81",4,0)
 ;
"RTN","IBCEP81",5,0)
 ; Must call at an entry point  
"RTN","IBCEP81",6,0)
 Q
"RTN","IBCEP81",7,0)
 ;
"RTN","IBCEP81",8,0)
 ; NPIREQ - Extrinsic function that will return a flag indicating
"RTN","IBCEP81",9,0)
 ;          if the NPI 'drop dead date' has passed.
"RTN","IBCEP81",10,0)
 ; Input
"RTN","IBCEP81",11,0)
 ;    IBDT - Date to check (internal Fileman format)
"RTN","IBCEP81",12,0)
 ; Output
"RTN","IBCEP81",13,0)
 ;    1 - On or after the May 23, 2008 drop dead date
"RTN","IBCEP81",14,0)
 ;    0 - Prior to the May 23, 2008 drop dead date 
"RTN","IBCEP81",15,0)
NPIREQ(IBDT) ; Check NPI drop dead date
"RTN","IBCEP81",16,0)
 N IBCHKDT
"RTN","IBCEP81",17,0)
 S IBCHKDT=3080523
"RTN","IBCEP81",18,0)
 Q $S(IBDT<IBCHKDT:0,1:1)
"RTN","IBCEP81",19,0)
 ;
"RTN","IBCEP81",20,0)
 ; TAXREQ - Extrinsic function that will return a flag indicating
"RTN","IBCEP81",21,0)
 ;          if the Taxonomy 'drop dead date' has passed.
"RTN","IBCEP81",22,0)
 ; Input
"RTN","IBCEP81",23,0)
 ;    IBDT - Date to check (internal Fileman format)
"RTN","IBCEP81",24,0)
 ; Output
"RTN","IBCEP81",25,0)
 ;    1 - On or after the May 23, 2008 drop dead date
"RTN","IBCEP81",26,0)
 ;    0 - Prior to the May 23, 2008 drop dead date 
"RTN","IBCEP81",27,0)
TAXREQ(IBDT) ; Check Taxonomy drop dead date
"RTN","IBCEP81",28,0)
 N IBCHKDT
"RTN","IBCEP81",29,0)
 S IBCHKDT=3080523
"RTN","IBCEP81",30,0)
 Q $S(IBDT<IBCHKDT:0,1:1)
"RTN","IBCEP81",31,0)
 ;
"RTN","IBCEP81",32,0)
 ; NPIGET - Extrinsic function to retrieve the NPI of a specified
"RTN","IBCEP81",33,0)
 ;          record from file 355.93.
"RTN","IBCEP81",34,0)
 ; Input
"RTN","IBCEP81",35,0)
 ;    IBIEN - IEN of the record from file 355.93
"RTN","IBCEP81",36,0)
 ; Output
"RTN","IBCEP81",37,0)
 ;    NPI of that record or "" if not yet defined
"RTN","IBCEP81",38,0)
NPIGET(IBIEN) ; Get NPI
"RTN","IBCEP81",39,0)
 I IBIEN="" Q ""
"RTN","IBCEP81",40,0)
 N NPI
"RTN","IBCEP81",41,0)
 S NPI=$$GET1^DIQ(355.93,IBIEN_",",41.01,"I")
"RTN","IBCEP81",42,0)
 Q NPI
"RTN","IBCEP81",43,0)
 ;
"RTN","IBCEP81",44,0)
 ; TAXGET - Extrinsic function to retrieve the Taxonomy of a specified
"RTN","IBCEP81",45,0)
 ;          record from file 355.93. (NOTE: Returns data for the 'active'
"RTN","IBCEP81",46,0)
 ;          primary record from the Taxonomy multiple or the earliest
"RTN","IBCEP81",47,0)
 ;          'active' secondary record if no primary is present.)
"RTN","IBCEP81",48,0)
 ;
"RTN","IBCEP81",49,0)
 ;          The 'optional' array parameter returns all Taxonomies in a
"RTN","IBCEP81",50,0)
 ;          formatted array so they can be displayed.
"RTN","IBCEP81",51,0)
 ; Input
"RTN","IBCEP81",52,0)
 ;    IBIEN - IEN of the record from file 355.93
"RTN","IBCEP81",53,0)
 ; Output
"RTN","IBCEP81",54,0)
 ;    Piece 1 = Taxonomy (X12 value) of that record as defined in file 8932.1
"RTN","IBCEP81",55,0)
 ;    Piece 2 = IEN from file 8932.1
"RTN","IBCEP81",56,0)
 ;
"RTN","IBCEP81",57,0)
 ;    IBARR = IEN of the record from the main output
"RTN","IBCEP81",58,0)
 ;    IBARR(IEN) = 3 pieces for each Taxonomy record
"RTN","IBCEP81",59,0)
 ;    Piece 1 = Taxonomy (X12 value) of that record as defined in file 8932.1
"RTN","IBCEP81",60,0)
 ;    Piece 2 = IEN from file 8932.1
"RTN","IBCEP81",61,0)
 ;    Piece 3 = Primary/Secondary (1/0)
"RTN","IBCEP81",62,0)
 ;    
"RTN","IBCEP81",63,0)
TAXGET(IBIEN,IBARR) ; Get Taxonomy
"RTN","IBCEP81",64,0)
 I IBIEN="" Q U
"RTN","IBCEP81",65,0)
 N TAX,IBPTR,IEN,IENS
"RTN","IBCEP81",66,0)
 S IEN=0,IBPTR=""
"RTN","IBCEP81",67,0)
 F  S IEN=$O(^IBA(355.93,IBIEN,"TAXONOMY",IEN)) Q:'IEN  D
"RTN","IBCEP81",68,0)
 . S IENS=IEN_","_IBIEN_","
"RTN","IBCEP81",69,0)
 . I $$GET1^DIQ(355.9342,IENS,.03,"E")'="ACTIVE" Q
"RTN","IBCEP81",70,0)
 . S IBARR(IEN)=U_$$GET1^DIQ(355.9342,IENS,.01,"I")_U_$$GET1^DIQ(355.9342,IENS,.02,"I")
"RTN","IBCEP81",71,0)
 . S $P(IBARR(IEN),U)=$$GET1^DIQ(8932.1,$P(IBARR(IEN),U,2),"X12 CODE")
"RTN","IBCEP81",72,0)
 . I $$GET1^DIQ(355.9342,IENS,.02,"E")="YES" S IBPTR=$P(IBARR(IEN),U,2),IBARR=IEN Q
"RTN","IBCEP81",73,0)
 . I IBPTR="" S IBPTR=$P(IBARR(IEN),U,2),IBARR=IEN
"RTN","IBCEP81",74,0)
 S TAX=$$GET1^DIQ(8932.1,IBPTR,"X12 CODE")
"RTN","IBCEP81",75,0)
 Q TAX_U_IBPTR
"RTN","IBCEP81",76,0)
 ;
"RTN","IBCEP81",77,0)
 ; TAXDEF - Extrinsic function to retrieve the Taxonomy for the Default
"RTN","IBCEP81",78,0)
 ;          Division from a record in file 399.
"RTN","IBCEP81",79,0)
 ; Input
"RTN","IBCEP81",80,0)
 ;    IBIEN399 - IEN of the record from file 399
"RTN","IBCEP81",81,0)
 ; Output
"RTN","IBCEP81",82,0)
 ;    Piece 1 = Taxonomy (X12 value) of that record as defined in file 8932.1
"RTN","IBCEP81",83,0)
 ;    Piece 2 = IEN from file 8932.1
"RTN","IBCEP81",84,0)
TAXDEF(IBIEN399) ; Get Taxonomy for Default Division
"RTN","IBCEP81",85,0)
 I IBIEN399="" Q U
"RTN","IBCEP81",86,0)
 N IBRETVAL,IBORG,IBEVDT,IBDIV,TAX
"RTN","IBCEP81",87,0)
 S IBDIV=$$GET1^DIQ(399,IBIEN399_",",.22,"I")
"RTN","IBCEP81",88,0)
 S IBEVDT=$$GET1^DIQ(399,IBIEN399_",",.03,"I")
"RTN","IBCEP81",89,0)
 S IBORG=$P($$SITE^VASITE(IBEVDT,IBDIV),U)
"RTN","IBCEP81",90,0)
 Q $$TAXORG^XUSTAX(IBORG)
"RTN","IBCEP81",91,0)
 ;
"RTN","IBCEP81",92,0)
 ; NPIUSED - Extrinsic function to determine whether a given NPI is already being used in files 200, 4, or 355.93.
"RTN","IBCEP81",93,0)
 ;
"RTN","IBCEP81",94,0)
 ; Input
"RTN","IBCEP81",95,0)
 ;    IBNPI - NPI number to check.
"RTN","IBCEP81",96,0)
 ;    IBOLDNPI - NPI that is being replaced or deleted
"RTN","IBCEP81",97,0)
 ;    IBIEN - entry number for file 355.93 of entry being edited
"RTN","IBCEP81",98,0)
 ;    IBCHECK - Is this a new NPI entry or existing
"RTN","IBCEP81",99,0)
 ;    IBKEY - They security key XUSNPIMTL
"RTN","IBCEP81",100,0)
 ; Output
"RTN","IBCEP81",101,0)
 ;    1 = NPI is already being used.
"RTN","IBCEP81",102,0)
 ;    0 = NPI is not currently being used.
"RTN","IBCEP81",103,0)
 ;
"RTN","IBCEP81",104,0)
NPIUSED(IBNPI,IBOLDNPI,IBIEN,IBCHECK,IBKEY) ; Check whether NPI is already used within files 200, 4, or 355.93.
"RTN","IBCEP81",105,0)
 N IBNOTIFY,IBVA200,DUP,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCEP81",106,0)
 S (IBNOTIFY,IBVA200,DUP)=""
"RTN","IBCEP81",107,0)
 S IBNOTIFY=$S(IBCHECK=2:1,1:$$RULES(IBNPI,IBIEN,IBOLDNPI))
"RTN","IBCEP81",108,0)
 I IBNOTIFY=0!(IBNOTIFY="") Q ""
"RTN","IBCEP81",109,0)
 ;Associating NPI to an entry in NEW PERSON file
"RTN","IBCEP81",110,0)
 ;IBNOTIFY of 14 = Replacing an NPI from NEW PERSON file with an NPI from NEW PERSON file
"RTN","IBCEP81",111,0)
 I IBNOTIFY=1!(IBNOTIFY=14) D:$G(IBOLDNPI)'=$G(IBNPI)  Q $S($G(Y)=1:0,$G(IBCHECK)=2:0,1:1)
"RTN","IBCEP81",112,0)
 . D EN^DDIOL("The NPI of "_IBNPI_" is also associated with the INDIVIDUAL provider","","!!")
"RTN","IBCEP81",113,0)
 . I $G(IBVA200)="" S IBVA200=$$QI^XUSNPI(IBNPI)
"RTN","IBCEP81",114,0)
 . D EN^DDIOL($$GET1^DIQ(200,$P(IBVA200,U,2),.01))
"RTN","IBCEP81",115,0)
 . D EN^DDIOL(" in the NEW PERSON file.  You are trying to associate","","?0")
"RTN","IBCEP81",116,0)
 . D EN^DDIOL("it with "_$S($$GET1^DIQ(355.93,IBIEN,.02,"I")=1:"a FACILITY/GROUP",$$GET1^DIQ(355.93,IBIEN,.02,"I")=2:"an INDIVIDUAL",1:"a")_" provider")
"RTN","IBCEP81",117,0)
 . D EN^DDIOL(" in the IB NON/OTHER VA BILLING PROVIDER file.","","?0"),EN^DDIOL("")
"RTN","IBCEP81",118,0)
 . S DIR(0)="Y",DIR("A")="Do you still want to add this NPI to provider "_$$GET1^DIQ(355.93,IBIEN,.01),DIR("B")="NO"
"RTN","IBCEP81",119,0)
 . S DIR("?")="Answer YES if you wish to associate the NPI from the IB NON/OTHER VA PROVIDER file with the entry in the NEW PERSON file."
"RTN","IBCEP81",120,0)
 . D ^DIR,EN^DDIOL("") Q
"RTN","IBCEP81",121,0)
 ; NPI is now or was in the past in use in File 4
"RTN","IBCEP81",122,0)
 I IBNOTIFY=9 D EN^DDIOL("The NPI of "_IBNPI_" is now, or was in the past, associated with "_$$GET1^DIQ(4,$O(^DIC(4,"ANPI",IBNPI,"")),.01),"","!!"),EN^DDIOL(" in the INSTITUTION file.") Q 1
"RTN","IBCEP81",123,0)
 ; NPI is now or was in the past in use in 355.93
"RTN","IBCEP81",124,0)
 I IBNOTIFY=11 D EN^DDIOL("The NPI of "_IBNPI_" is now, or was in the past, associated with "_$$GET1^DIQ(355.93,$$DUP(IBNPI),.01),"","!!"),EN^DDIOL(" in the IB NON/OTHER VA BILLING PROVIDER file.") Q 1
"RTN","IBCEP81",125,0)
 ;Inactive NPI in 355.93
"RTN","IBCEP81",126,0)
 I IBNOTIFY=12 D EN^DDIOL("The NPI of "_IBNPI_" is already associated with the provider "_$$GET1^DIQ(355.93,$$DUP(IBNPI),.01)_" as","","!!") D  Q 1
"RTN","IBCEP81",127,0)
 . D EN^DDIOL("INACTIVE in the IB NON/OTHER VA BILLING PROVIDER file.")
"RTN","IBCEP81",128,0)
 . D EN^DDIOL("You are updating "_$S($$GET1^DIQ(355.93,IBIEN,.02,"I")=1:"a FACILITY/GROUP",$$GET1^DIQ(355.93,IBIEN,.02,"I")=2:"an INDIVIDUAL",1:""),"","!!")
"RTN","IBCEP81",129,0)
 . D EN^DDIOL("in the IB NON/OTHER VA BILLING PROVIDER file.")
"RTN","IBCEP81",130,0)
 ;Inactive NPI in NEW PERSON file
"RTN","IBCEP81",131,0)
 I IBNOTIFY=13 D  Q 1
"RTN","IBCEP81",132,0)
 .D EN^DDIOL("The NPI of "_IBNPI_" is also associated with the INDIVIDUAL provider","","!!"),EN^DDIOL($$GET1^DIQ(200,$P(IBVA200,U,2),.01)_" in the NEW PERSON file."),EN^DDIOL("The NPI is INACTIVE and may not be used."),EN^DDIOL("")
"RTN","IBCEP81",133,0)
 Q ""
"RTN","IBCEP81",134,0)
 ;
"RTN","IBCEP81",135,0)
 ; DUP - Extrinsic function to determine whether a given NPI is already being used in file# 355.93.
"RTN","IBCEP81",136,0)
 ;
"RTN","IBCEP81",137,0)
 ; Input
"RTN","IBCEP81",138,0)
 ;    IBNPI - NPI number to check.
"RTN","IBCEP81",139,0)
 ; Output
"RTN","IBCEP81",140,0)
 ;    NULL - NPI is not currently being used.
"RTN","IBCEP81",141,0)
 ;    Otherwise, the IEN of the entry in file# 355.93 associated with that NPI.
"RTN","IBCEP81",142,0)
 ;
"RTN","IBCEP81",143,0)
DUP(IBNPI) ; Check whether this is a duplicate NPI within file# 355.93
"RTN","IBCEP81",144,0)
 I IBNPI="" Q ""
"RTN","IBCEP81",145,0)
 Q $O(^IBA(355.93,"NPIHISTORY",IBNPI,""))
"RTN","IBCEP81",146,0)
 ;
"RTN","IBCEP81",147,0)
 ; DISPTAX - Function to display extra Taxonomy info in the input templates in screens 6, 7, and 8 in IB EDIT BILLING INFO
"RTN","IBCEP81",148,0)
 ; 
"RTN","IBCEP81",149,0)
 ; Input
"RTN","IBCEP81",150,0)
 ;    IBIEN - IEN of the entry in file 8932.1 to be displayed
"RTN","IBCEP81",151,0)
 ;    IBTXT - (optional) extra text to be displayed before the entry (i.e. "Default Division" or "Non-VA Facility")
"RTN","IBCEP81",152,0)
 ;    
"RTN","IBCEP81",153,0)
DISPTAX(IBIEN,IBTXT) ; Display extra Taxonomy info (when available)
"RTN","IBCEP81",154,0)
 N IBX
"RTN","IBCEP81",155,0)
 I $G(IBIEN)="" Q
"RTN","IBCEP81",156,0)
 S IBX=$$GET1^DIQ(8932.1,IBIEN,1) I IBX]"" W !,"    ",$G(IBTXT)," Classification: ",IBX
"RTN","IBCEP81",157,0)
 S IBX=$$GET1^DIQ(8932.1,IBIEN,2) I IBX]"" W !,"    ",$G(IBTXT)," Area of Specialization: ",IBX
"RTN","IBCEP81",158,0)
 S IBX=$$GET1^DIQ(8932.1,IBIEN,8) I IBX]"" W !,"    ",$G(IBTXT)," Specialty Code: ",IBX
"RTN","IBCEP81",159,0)
 S IBX=$$GET1^DIQ(8932.1,IBIEN,6) W !,"    ",$G(IBTXT)," Taxonomy X12 Code: ",IBX
"RTN","IBCEP81",160,0)
 Q
"RTN","IBCEP81",161,0)
RULES(IBNPI,IBIEN,IBOLDNPI) ;Verify that the NPI meets all rules for usage
"RTN","IBCEP81",162,0)
 N IBIEN1,IBIEN2,DUP
"RTN","IBCEP81",163,0)
 I $G(IBOLDNPI)>0,IBNPI=IBOLDNPI,$D(^VA(200,"ANPI",IBOLDNPI)) Q 1
"RTN","IBCEP81",164,0)
 I IBNPI="" Q ""
"RTN","IBCEP81",165,0)
 S DUP=$$DUP(IBNPI)
"RTN","IBCEP81",166,0)
 ;Duplicate in 355.93
"RTN","IBCEP81",167,0)
 I DUP'="",DUP'=IBIEN Q 11
"RTN","IBCEP81",168,0)
 ;Replacing an NPI that is associated to NEW PERSON file with another NPI that is associated with the NEW PERSON file
"RTN","IBCEP81",169,0)
 I $G(IBOLDNPI)>0,$D(^VA(200,"ANPI",IBOLDNPI)),$D(^VA(200,"ANPI",IBNPI)) Q 14
"RTN","IBCEP81",170,0)
 ;Already an inactive NPI
"RTN","IBCEP81",171,0)
 S IBIEN2=$O(^IBA(355.93,"NPIHISTORY",IBNPI,"")) D:$G(IBIEN2)'=""
"RTN","IBCEP81",172,0)
 . S IBIEN1=$O(^IBA(355.93,IBIEN2,"NPISTATUS","C",IBNPI,""),-1)
"RTN","IBCEP81",173,0)
 I $G(IBIEN1)'="",$D(^IBA(355.93,IBIEN2,"NPISTATUS","NPISTATUS",0,IBIEN1)) Q 12
"RTN","IBCEP81",174,0)
 ;Check for existence in New Person 
"RTN","IBCEP81",175,0)
 ;file (#200) and/or Institution file (#4)
"RTN","IBCEP81",176,0)
 S IBVA200=$$QI^XUSNPI(IBNPI)
"RTN","IBCEP81",177,0)
 I $E($P(IBVA200,U,4),1,8)="Inactive" Q 13
"RTN","IBCEP81",178,0)
 I $P(IBVA200,U)="Individual_ID",$P(IBVA200,U,4)["Active" Q 1
"RTN","IBCEP81",179,0)
 I $P(IBVA200,U)="Organization_ID",$P(IBVA200,U,4)["Active" Q 9
"RTN","IBCEP81",180,0)
 I $D(^DIC(4,"ANPI",IBNPI)) Q 9
"RTN","IBCEP81",181,0)
 Q 0
"RTN","IBCEP81",182,0)
 ;
"RTN","IBCEP81",183,0)
PRENPI(IBIEN) ;Pre-NPI edit messages
"RTN","IBCEP81",184,0)
 N IBNPI,IBVA200
"RTN","IBCEP81",185,0)
 Q:$G(IBIEN)=""
"RTN","IBCEP81",186,0)
 S IBNPI=$P($G(^IBA(355.93,IBIEN,0)),U,14)
"RTN","IBCEP81",187,0)
 Q:$G(IBNPI)=""
"RTN","IBCEP81",188,0)
 S IBVA200=$$QI^XUSNPI(IBNPI)
"RTN","IBCEP81",189,0)
 ;NPI that exists in 355.93 also is used in 200
"RTN","IBCEP81",190,0)
 I $P(IBVA200,U,1)="Individual_ID",$P(IBVA200,U,4)["Active" D
"RTN","IBCEP81",191,0)
 . W !!,"The NPI of ",IBNPI," is also associated with the INDIVIDUAL provider ",!,$$GET1^DIQ(200,$P(IBVA200,U,2),.01)," in the NEW PERSON file."
"RTN","IBCEP81",192,0)
 . W !!,"You are updating ",$S($$GET1^DIQ(355.93,IBIEN,.02,"I")=1:"a FACILITY/GROUP",$$GET1^DIQ(355.93,IBIEN,.02,"I")=2:"an INDIVIDUAL",1:"a")," provider in the"
"RTN","IBCEP81",193,0)
 . W !,"IB NON/OTHER VA BILLING PROVIDER file.",!
"RTN","IBCEP81",194,0)
 ;The NPI used in 355.93 is inactive in 200
"RTN","IBCEP81",195,0)
 I $P(IBVA200,U,1)="Individual_ID",$P(IBVA200,U,4)["Inactive" D
"RTN","IBCEP81",196,0)
 . W !!,"The NPI of ",IBNPI," is also associated with the INDIVIDUAL provider ",!,$$GET1^DIQ(200,$P(IBVA200,U,2),.01)," as INACTIVE in the NEW PERSON file."
"RTN","IBCEP81",197,0)
 . W !!,"You are updating ",$S($$GET1^DIQ(355.93,IBIEN,.02,"I")=1:"a FACILITY/GROUP",$$GET1^DIQ(355.93,IBIEN,.02,"I")=2:"an INDIVIDUAL",1:"a")," provider in the"
"RTN","IBCEP81",198,0)
 . W !,"IB NON/OTHER VA BILLING PROVIDER file.",!
"RTN","IBCEP81",199,0)
 Q
"RTN","IBCEP82")
0^3^B73798180^B31460736
"RTN","IBCEP82",1,0)
IBCEP82 ;ALB/CLT - Special cross references and data entry for fields in file 355.93 ;18 Apr 2008  3:46 PM
"RTN","IBCEP82",2,0)
 ;;2.0;INTEGRATED BILLING;**343,374,377,391**;21-MAR-94;Build 39
"RTN","IBCEP82",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEP82",4,0)
 ;
"RTN","IBCEP82",5,0)
 ; Call at tags only
"RTN","IBCEP82",6,0)
 Q
"RTN","IBCEP82",7,0)
 ;This routine will ask for the NPI, check for duplicate entries, and check for proper
"RTN","IBCEP82",8,0)
 ;format using the double-add-double formula.  If the NPI is being deleted it will ask
"RTN","IBCEP82",9,0)
 ;the user why it is being deleted.
"RTN","IBCEP82",10,0)
 ;If it is being deleted because of an erroneous entry it will be completely deleted.
"RTN","IBCEP82",11,0)
 ;If it is a valid NPI being deleted because of possible inappropriate usage it will be
"RTN","IBCEP82",12,0)
 ;maintained in the history cross reference to preclude anyone from using this NPI again.
"RTN","IBCEP82",13,0)
 ;
"RTN","IBCEP82",14,0)
EN(IBNPRV) ;Routine primary entry point
"RTN","IBCEP82",15,0)
 N DTOUT,DUOUT,DA,DIR,DIE,DIC,DR,X,Y,IBKEY
"RTN","IBCEP82",16,0)
 N IBIEN,IBNPI,IBCHECK,IBOLDNPI,IBRBNPI,IBRB
"RTN","IBCEP82",17,0)
 S IBOLDNPI="",IBNPI="",IBKEY="XUSNPIMTL"
"RTN","IBCEP82",18,0)
EN1 ;
"RTN","IBCEP82",19,0)
 S (DA,IBIEN)=IBNPRV
"RTN","IBCEP82",20,0)
 K DIR
"RTN","IBCEP82",21,0)
 S DIR(0)="FO^10:10",DIR("A")="NPI",DIR("?")="Enter a 10 digit National Provider Identifier"
"RTN","IBCEP82",22,0)
 I $G(DA) S:$P($G(^IBA(355.93,DA,0)),U,14)'="" (DIR("B"),IBOLDNPI,IBNPI)=$P($G(^IBA(355.93,DA,0)),U,14)
"RTN","IBCEP82",23,0)
 D ^DIR S IBCHECK=$S(Y=IBOLDNPI:2,1:0)
"RTN","IBCEP82",24,0)
 I X="^" W *7,!,"   EXIT NOT ALLOWED ??" G EN1
"RTN","IBCEP82",25,0)
 I $E(X)="^" W *7,!,"   JUMPING NOT ALLOWED ??" G EN1
"RTN","IBCEP82",26,0)
 I X="@" G:IBOLDNPI'="" DEL W *7,"??" G EN1
"RTN","IBCEP82",27,0)
 I $G(DUOUT)!$G(DTOUT) G XIT
"RTN","IBCEP82",28,0)
 I $G(IBOLDNPI)="",$G(X)="" G XIT
"RTN","IBCEP82",29,0)
 S IBNPI=$S(X="":$G(IBOLDNPI),1:X)
"RTN","IBCEP82",30,0)
 I '$$PROC(IBNPI,IBOLDNPI,IBIEN) G EN1
"RTN","IBCEP82",31,0)
 G XIT
"RTN","IBCEP82",32,0)
 ;
"RTN","IBCEP82",33,0)
EN2(IBNPRV,INDENT) ; entry point from input templates IB SCREEN82 and IB SCREEN8H
"RTN","IBCEP82",34,0)
 N DTOUT,DUOUT,DA,DIR,DIE,DIC,DR,X,Y,IBKEY
"RTN","IBCEP82",35,0)
 N IBIEN,IBNPI,IBCHECK,IBOLDNPI,IBRBNPI,IBRB,SPACES
"RTN","IBCEP82",36,0)
 S IBNPI="",IBKEY="XUSNPIMTL",IBOLDNPI="",SPACES="          "
"RTN","IBCEP82",37,0)
EN21 ;
"RTN","IBCEP82",38,0)
 S (DA,IBIEN)=IBNPRV
"RTN","IBCEP82",39,0)
 K DIR
"RTN","IBCEP82",40,0)
 S DIR(0)="FO^10:10",DIR("A")=$E(SPACES,1,INDENT)_"NPI",DIR("?")=$E(SPACES,1,INDENT)_"Enter a 10 digit National Provider Identifier"
"RTN","IBCEP82",41,0)
 I $G(DA) S:$P($G(^IBA(355.93,DA,0)),U,14)'="" (DIR("B"),IBOLDNPI,IBNPI)=$P($G(^IBA(355.93,DA,0)),U,14)
"RTN","IBCEP82",42,0)
 D ^DIR S IBCHECK=$S(Y=IBOLDNPI:2,1:0)
"RTN","IBCEP82",43,0)
 I X="@" G:IBOLDNPI'="" DEL W *7,"??" G EN21
"RTN","IBCEP82",44,0)
 I $G(DUOUT)!$G(DTOUT) G XIT
"RTN","IBCEP82",45,0)
 I $G(IBOLDNPI)="",$G(X)="" G XIT
"RTN","IBCEP82",46,0)
 S IBNPI=$S(X="":$G(IBOLDNPI),1:X)
"RTN","IBCEP82",47,0)
 I '$$PROC(IBNPI,IBOLDNPI,IBIEN) G EN21
"RTN","IBCEP82",48,0)
 G XIT
"RTN","IBCEP82",49,0)
 ;
"RTN","IBCEP82",50,0)
PROC(IBNPI,IBOLDNPI,IBIEN) ; process new NPI
"RTN","IBCEP82",51,0)
 I '$$CHKDGT^XUSNPI(IBNPI) W !,*7,$E($G(SPACES),1,+$G(INDENT))_"Not a valid NPI.  Please try again.",! Q 0
"RTN","IBCEP82",52,0)
 I $$NPIUSED^IBCEP81(IBNPI,IBOLDNPI,IBIEN,IBCHECK,IBKEY)=1 Q 0
"RTN","IBCEP82",53,0)
 S IBCHECK=1
"RTN","IBCEP82",54,0)
 I IBOLDNPI="" D ACTI
"RTN","IBCEP82",55,0)
 I IBOLDNPI'="" D:IBNPI'=IBOLDNPI INACT
"RTN","IBCEP82",56,0)
 S $P(^IBA(355.93,IBIEN,0),U,14)=IBNPI,^IBA(355.93,"NPI",IBNPI,IBIEN)="",^IBA(355.93,"NPIHISTORY",IBNPI,IBIEN)=""
"RTN","IBCEP82",57,0)
 Q 1
"RTN","IBCEP82",58,0)
 ;
"RTN","IBCEP82",59,0)
ACTI ;CREATE AN ACTIVATED ENTRY IN MULTIPLE NPISTATUS FIELD
"RTN","IBCEP82",60,0)
 S DA(1)=IBIEN,DIC="^IBA(355.93,"_DA(1)_",""NPISTATUS"",",DIC(0)="L",X=$$NOW^XLFDT()
"RTN","IBCEP82",61,0)
 S DIC("DR")=".02////^S X=1;.03////^S X=IBNPI;.04////^S X=DUZ"
"RTN","IBCEP82",62,0)
 D FILE^DICN
"RTN","IBCEP82",63,0)
 S $P(^IBA(355.93,IBIEN,0),U,14)=IBNPI
"RTN","IBCEP82",64,0)
 Q
"RTN","IBCEP82",65,0)
 ;
"RTN","IBCEP82",66,0)
DEL ;NPI HAS BEEN DELETED
"RTN","IBCEP82",67,0)
 ;If the user deletes the NPI this subroutine will determine why it was deleted and, if it was because it was found
"RTN","IBCEP82",68,0)
 ;in a false identity situation, will mark it in history to never be used again.
"RTN","IBCEP82",69,0)
 S IBNPI=$G(DIR("B"))
"RTN","IBCEP82",70,0)
 K DIR
"RTN","IBCEP82",71,0)
 S DIR(0)="Y"
"RTN","IBCEP82",72,0)
 S DIR("A")="Are you sure you wish to delete this NPI"
"RTN","IBCEP82",73,0)
 S DIR("?")="You have indicated you wish to delete the NPI.  This is a second chance check."
"RTN","IBCEP82",74,0)
 D ^DIR
"RTN","IBCEP82",75,0)
 G:Y(0)="NO" XIT
"RTN","IBCEP82",76,0)
 S DIR(0)="S^E:ERROR;V:VALID",DIR("A")="Was this a Valid NPI or an NPI entered in Error"
"RTN","IBCEP82",77,0)
 S DIR("?",1)="An example of an NPI entered in error is if the entry person transposed numbers,"
"RTN","IBCEP82",78,0)
 S DIR("?",2)="or if the NPI for one provider is accidentally assigned to a different provider."
"RTN","IBCEP82",79,0)
 S DIR("?")="Enter an 'E' for Error or a 'V' for Valid."
"RTN","IBCEP82",80,0)
 D ^DIR
"RTN","IBCEP82",81,0)
 I Y="E" D COMP W !,"The NPI has been deleted.",!
"RTN","IBCEP82",82,0)
 I Y="V" S IBCHECK=2 D INACT W !,"The NPI is now inactive.",!
"RTN","IBCEP82",83,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","IBCEP82",84,0)
 S IBOLDNPI=IBNPI D WARND(IBIEN,IBOLDNPI,IBKEY)
"RTN","IBCEP82",85,0)
 Q
"RTN","IBCEP82",86,0)
 ;
"RTN","IBCEP82",87,0)
COMP ;COMPLETELY DELETE THE NPI
"RTN","IBCEP82",88,0)
 ;This subroutine will delete the NPI from the file 355.93.
"RTN","IBCEP82",89,0)
 S OIEN=$O(^IBA(355.93,IBIEN,"NPISTATUS","C",IBOLDNPI,"A"),-1)
"RTN","IBCEP82",90,0)
 D DELNPI(IBIEN,OIEN)
"RTN","IBCEP82",91,0)
 K ^IBA(355.93,"NPI",IBOLDNPI,DA),^IBA(355.93,"NPIHISTORY",IBOLDNPI,DA)
"RTN","IBCEP82",92,0)
 S IBRB=0
"RTN","IBCEP82",93,0)
 D  ; Find the most recent status '0' (inactive) NPI entry in the list.
"RTN","IBCEP82",94,0)
 . N IBRBLST,IBRBTMP
"RTN","IBCEP82",95,0)
 . ; Don't want to roll back to the same number you are deleting.
"RTN","IBCEP82",96,0)
 . S IBRBLST(IBOLDNPI)=""
"RTN","IBCEP82",97,0)
 . S IBRBTMP="A"
"RTN","IBCEP82",98,0)
 . ; Go through each entry in reverse order
"RTN","IBCEP82",99,0)
 . F  S IBRBTMP=$O(^IBA(355.93,IBIEN,"NPISTATUS",IBRBTMP),-1) Q:'IBRBTMP  D  Q:IBRB'=0
"RTN","IBCEP82",100,0)
 .. S IBRBLST=^IBA(355.93,IBIEN,"NPISTATUS",IBRBTMP,0)
"RTN","IBCEP82",101,0)
 .. ; If this is an 'active' entry then ignore it.
"RTN","IBCEP82",102,0)
 .. I $P(IBRBLST,U,2)=1 Q
"RTN","IBCEP82",103,0)
 .. ; If this entry does not have an NPI then ignore it.
"RTN","IBCEP82",104,0)
 .. I $P(IBRBLST,U,3)="" Q
"RTN","IBCEP82",105,0)
 .. ;If this is an inactive entry then report it.
"RTN","IBCEP82",106,0)
 .. I $P(IBRBLST,U,2)=0 S IBRB=IBRBTMP Q
"RTN","IBCEP82",107,0)
 .. Q
"RTN","IBCEP82",108,0)
 . Q
"RTN","IBCEP82",109,0)
 I IBRB>0 D ROLLBACK
"RTN","IBCEP82",110,0)
 Q
"RTN","IBCEP82",111,0)
 ;
"RTN","IBCEP82",112,0)
DELNPI(IEN,OIEN) ;DELETE-INVALID removes NPI from file.
"RTN","IBCEP82",113,0)
 NEW DIE,DIK,DIC,DA,DR,D,D0,DI,DIC,DQ,X
"RTN","IBCEP82",114,0)
 NEW DP,DM,DK,DL,DIEL
"RTN","IBCEP82",115,0)
 S DIE="^IBA(355.93,",DA=IEN,DR="41.01////@"
"RTN","IBCEP82",116,0)
 D ^DIE
"RTN","IBCEP82",117,0)
 S DA(1)=IEN,DIK="^IBA(355.93,"_DA(1)_",""NPISTATUS"",",DA=OIEN
"RTN","IBCEP82",118,0)
 D ^DIK
"RTN","IBCEP82",119,0)
 Q
"RTN","IBCEP82",120,0)
 ;
"RTN","IBCEP82",121,0)
INACT ;INACTIVATE AN ENTRY
"RTN","IBCEP82",122,0)
 ;This subroutine makes two entries in the NPI multiple field:
"RTN","IBCEP82",123,0)
 ;one for the deactivation of the old NPI and the second
"RTN","IBCEP82",124,0)
 ;for the activation of a new NPI.
"RTN","IBCEP82",125,0)
 S DA(1)=IBIEN,DIC="^IBA(355.93,"_DA(1)_",""NPISTATUS"",",DIC(0)="L",X=$$NOW^XLFDT()
"RTN","IBCEP82",126,0)
 S DIC("DR")=".02////^S X=0;.03////^S X=IBOLDNPI;.04////^S X=DUZ"
"RTN","IBCEP82",127,0)
 D FILE^DICN
"RTN","IBCEP82",128,0)
 S ^IBA(355.93,"NPIHISTORY",IBOLDNPI,DA(1))=""
"RTN","IBCEP82",129,0)
 K ^IBA(355.93,"NPI",IBOLDNPI,DA(1))
"RTN","IBCEP82",130,0)
 S $P(^IBA(355.93,IBIEN,0),U,14)=""
"RTN","IBCEP82",131,0)
 I $G(IBCHECK)<2 D
"RTN","IBCEP82",132,0)
 .D ACTI
"RTN","IBCEP82",133,0)
 .S ^IBA(355.93,"NPIHISTORY",IBNPI,DA(1))=""
"RTN","IBCEP82",134,0)
 .D WARNR(IBIEN,IBOLDNPI,IBKEY)
"RTN","IBCEP82",135,0)
 Q
"RTN","IBCEP82",136,0)
 ;
"RTN","IBCEP82",137,0)
ROLLBACK ;Rollback or delete NPI
"RTN","IBCEP82",138,0)
 S IBRBNPI=$P(^IBA(355.93,IBIEN,"NPISTATUS",IBRB,0),U,3)
"RTN","IBCEP82",139,0)
 NEW DIE,DIK,DIC,DA,DR,D,D0,DI,DIC,DQ,X
"RTN","IBCEP82",140,0)
 NEW DP,DM,DK,DL,DIEL
"RTN","IBCEP82",141,0)
 S DA(1)=IBIEN,DIK="^IBA(355.93,"_DA(1)_",""NPISTATUS"",",DA=IBRB
"RTN","IBCEP82",142,0)
 D ^DIK
"RTN","IBCEP82",143,0)
 S $P(^IBA(355.93,IBIEN,0),U,14)=IBRBNPI,^IBA(355.93,"NPI",IBRBNPI,IBIEN)=""
"RTN","IBCEP82",144,0)
 Q
"RTN","IBCEP82",145,0)
 ;
"RTN","IBCEP82",146,0)
XIT ;CLEAN AND EXIT
"RTN","IBCEP82",147,0)
 Q
"RTN","IBCEP82",148,0)
 ;
"RTN","IBCEP82",149,0)
XR ;Set the primary taxonomy code cross reference for field 42
"RTN","IBCEP82",150,0)
 N ATAX S ATAX=""
"RTN","IBCEP82",151,0)
 I $D(^IBA(355.93,DA(1),"TAXONOMY","D")) D:X=1
"RTN","IBCEP82",152,0)
 . F  S ATAX=$O(^IBA(355.93,DA(1),"TAXONOMY","D",1,ATAX)) Q:ATAX=""  D
"RTN","IBCEP82",153,0)
 .. K ^IBA(355.93,DA(1),"TAXONOMY","D",1,ATAX)
"RTN","IBCEP82",154,0)
 .. I ATAX'=DA S $P(^IBA(355.93,DA(1),"TAXONOMY",ATAX,0),U,2)=0,^IBA(355.93,DA(1),"TAXONOMY","D",0,ATAX)=""
"RTN","IBCEP82",155,0)
 S ^IBA(355.93,DA(1),"TAXONOMY","D",X,DA)=""
"RTN","IBCEP82",156,0)
 Q
"RTN","IBCEP82",157,0)
 ;
"RTN","IBCEP82",158,0)
KXR ;Kill primary taxonomy code cross reference for field 42
"RTN","IBCEP82",159,0)
 N K
"RTN","IBCEP82",160,0)
 F K=0,1 K ^IBA(355.93,DA(1),"TAXONOMY","D",K,DA)
"RTN","IBCEP82",161,0)
 Q
"RTN","IBCEP82",162,0)
 ;
"RTN","IBCEP82",163,0)
WARNR(IBIEN,IBOLDNPI,IBKEY) ;Warn user that the old NPI that was replaced is currently used by an entry in the New Person file (#200)
"RTN","IBCEP82",164,0)
 N IBIEN200
"RTN","IBCEP82",165,0)
 Q:$G(IBOLDNPI)=""
"RTN","IBCEP82",166,0)
 S IBIEN200=$O(^VA(200,"ANPI",IBOLDNPI,""))
"RTN","IBCEP82",167,0)
 Q:IBIEN200=""
"RTN","IBCEP82",168,0)
 W !!,"WARNING: NPI ",IBOLDNPI," is also associated with Provider ",$$GET1^DIQ(200,IBIEN200,.01),".",!
"RTN","IBCEP82",169,0)
 I $O(^XUSEC(IBKEY,""))="" W !!,"There are no holders of the ",IBKEY," security key on the VistA system.  Contact your IRM department for further direction." Q
"RTN","IBCEP82",170,0)
 W !,"A MailMan message has been sent to holders of the "_""""_IBKEY_""""_" security key."
"RTN","IBCEP82",171,0)
 D MAILR(IBIEN,IBKEY,IBIEN200,IBOLDNPI)
"RTN","IBCEP82",172,0)
 Q
"RTN","IBCEP82",173,0)
 ;
"RTN","IBCEP82",174,0)
WARND(IBIEN,IBOLDNPI,IBKEY) ;Warn user that the old NPI that was deleted is currently used by an entry in the New Person file (#200)
"RTN","IBCEP82",175,0)
 N IBIEN200
"RTN","IBCEP82",176,0)
 Q:$G(IBOLDNPI)=""
"RTN","IBCEP82",177,0)
 S IBIEN200=$O(^VA(200,"ANPI",IBOLDNPI,""))
"RTN","IBCEP82",178,0)
 Q:IBIEN200=""
"RTN","IBCEP82",179,0)
 W !!,"WARNING: NPI ",IBOLDNPI," is also associated with VA Provider ",$$GET1^DIQ(200,IBIEN200,.01),".",!
"RTN","IBCEP82",180,0)
 I $O(^XUSEC(IBKEY,""))="" W !!,"There are no holders of the ",IBKEY," security key on the VistA system.  Contact your IRM department for further direction." Q
"RTN","IBCEP82",181,0)
 W !,"A MailMan message has been sent to holders of the "_""""_IBKEY_""""_" security key."
"RTN","IBCEP82",182,0)
 D MAILD(IBIEN,IBKEY,IBIEN200,IBOLDNPI)
"RTN","IBCEP82",183,0)
 Q
"RTN","IBCEP82",184,0)
 ;
"RTN","IBCEP82",185,0)
MAILR(IBIEN,IBKEY,IBIEN200,IBOLDNPI) ;Send mailman message for replacement of NPI
"RTN","IBCEP82",186,0)
 ;This subroutine is supported by IA# 10070
"RTN","IBCEP82",187,0)
 ;Lookups in NEW PERSON file (#200) are supported by IA#10076
"RTN","IBCEP82",188,0)
 N IBIEN2,XMDUZ,XMSUB,XMTEXT,XMY,IBMSG,XMZ,XMMG
"RTN","IBCEP82",189,0)
 S IBIEN2=0 F  S IBIEN2=$O(^XUSEC(IBKEY,IBIEN2)) Q:IBIEN2=""  S XMY(IBIEN2)=""
"RTN","IBCEP82",190,0)
 S XMDUZ=$S($G(DUZ):DUZ,1:.5),XMSUB="NPI Replacement"
"RTN","IBCEP82",191,0)
 S IBMSG(1)="The NPI "_IBOLDNPI_" was changed to "_IBNPI_" for"
"RTN","IBCEP82",192,0)
 S IBMSG(2)=$$GET1^DIQ(355.93,IBIEN,.01)_" in the IB NON/OTHER VA BILLING PROVIDER"
"RTN","IBCEP82",193,0)
 S IBMSG(3)="file.  The NPI "_IBOLDNPI_" is also associated with"
"RTN","IBCEP82",194,0)
 S IBMSG(4)=$$GET1^DIQ(200,IBIEN200,.01)_" in the NEW PERSON file."
"RTN","IBCEP82",195,0)
 S IBMSG(5)=""
"RTN","IBCEP82",196,0)
 S IBMSG(6)="The same change may need to be made to the NEW PERSON file using the"
"RTN","IBCEP82",197,0)
 S IBMSG(7)="Add/Edit NPI values for Providers option."
"RTN","IBCEP82",198,0)
 S XMTEXT="IBMSG(" D ^XMD
"RTN","IBCEP82",199,0)
 Q
"RTN","IBCEP82",200,0)
 ;
"RTN","IBCEP82",201,0)
MAILD(IBIEN,IBKEY,IBIEN200,IBOLDNPI) ;Send mailman message for deletion of an NPI
"RTN","IBCEP82",202,0)
 ;This subroutine is supported by IA# 10070
"RTN","IBCEP82",203,0)
 ;Lookups in NEW PERSON file (#200) are supported by IA#10076
"RTN","IBCEP82",204,0)
 N IBIEN2,XMDUZ,XMSUB,XMTEXT,XMY,IBMSG,XMZ,XMMG
"RTN","IBCEP82",205,0)
 S IBIEN2=0 F  S IBIEN2=$O(^XUSEC(IBKEY,IBIEN2)) Q:IBIEN2=""  S XMY(IBIEN2)=""
"RTN","IBCEP82",206,0)
 S XMDUZ=$S($G(DUZ):DUZ,1:.5),XMSUB="NPI Deletion"
"RTN","IBCEP82",207,0)
 S IBMSG(1)="The NPI "_IBOLDNPI_" was deleted for "_$$GET1^DIQ(355.93,IBIEN,.01)
"RTN","IBCEP82",208,0)
 S IBMSG(2)="in the IB NON/OTHER VA BILLING PROVIDER file.  The NPI "_IBOLDNPI_" is also"
"RTN","IBCEP82",209,0)
 S IBMSG(3)="associated with "_$$GET1^DIQ(200,IBIEN200,.01)_" in the NEW PERSON file."
"RTN","IBCEP82",210,0)
 S IBMSG(4)=""
"RTN","IBCEP82",211,0)
 S IBMSG(5)="The same change may need to be made to the NEW PERSON file using the"
"RTN","IBCEP82",212,0)
 S IBMSG(6)="Add/Edit NPI values for Providers option."
"RTN","IBCEP82",213,0)
 S XMTEXT="IBMSG(" D ^XMD
"RTN","IBCEP82",214,0)
 Q
"RTN","IBCEP8B")
0^5^B10681479^n/a
"RTN","IBCEP8B",1,0)
IBCEP8B ;ALB/CJS - Functions for NON-VA PROVIDER cont'd ;06-06-08
"RTN","IBCEP8B",2,0)
 ;;2.0;INTEGRATED BILLING;**391**;21-MAR-94;Build 39
"RTN","IBCEP8B",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEP8B",4,0)
 ;
"RTN","IBCEP8B",5,0)
BLD(IBNPRV) ; Build/Rebuild display
"RTN","IBCEP8B",6,0)
 N IBLCT,IBCT,IBLST,IBPRI,IBIEN,Z,Z1,Z2
"RTN","IBCEP8B",7,0)
 K @VALMAR
"RTN","IBCEP8B",8,0)
 S (IBLCT,IBCT)=0,Z=$G(^IBA(355.93,IBNPRV,0))
"RTN","IBCEP8B",9,0)
 S IBCT=IBCT+1
"RTN","IBCEP8B",10,0)
 S Z1=$J("Name: ",15)_$P(Z,U) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",11,0)
 I $P(Z,U,2)=2 D
"RTN","IBCEP8B",12,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",13,0)
 . S Z1=$J("Type: ",15)_$S($P(Z,U,2)=2:"INDIVIDUAL PROVIDER",1:"OUTSIDE OR OTHER VA FACILITY") D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",14,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",15,0)
 . S Z1=$J("Credentials: ",15)_$P(Z,U,3) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",16,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",17,0)
 . S Z1=$J("Specialty: ",15)_$P(Z,U,4) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",18,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",19,0)
 . S Z1=$J("NPI: ",15)_$$NPIGET^IBCEP81(IBNPRV) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",20,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",21,0)
 . S IBPRI=$$TAXGET^IBCEP81(IBNPRV,.IBLST)
"RTN","IBCEP8B",22,0)
 . S Z1=$J("Taxonomy Code: ",15)_$P(IBPRI,U)
"RTN","IBCEP8B",23,0)
 . I $D(IBLST) S Z1=Z1_" ("_$S($P(IBLST(IBLST),U,3)=1:"Primary",1:"Secondary")_")"
"RTN","IBCEP8B",24,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",25,0)
 . S IBIEN=""
"RTN","IBCEP8B",26,0)
 . F  S IBIEN=$O(IBLST(IBIEN)) Q:IBIEN=""  D
"RTN","IBCEP8B",27,0)
 .. I IBIEN=IBLST Q
"RTN","IBCEP8B",28,0)
 .. S IBCT=IBCT+1
"RTN","IBCEP8B",29,0)
 .. S Z1=$J("",15)_$P(IBLST(IBIEN),U)_" ("_$S($P(IBLST(IBIEN),U,3)=1:"Primary",1:"Secondary")_")"
"RTN","IBCEP8B",30,0)
 .. D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",31,0)
 E  D
"RTN","IBCEP8B",32,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",33,0)
 . S Z1=$J("Address: ",15)_$P(Z,U,5) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",34,0)
 . I $P(Z,U,10) D
"RTN","IBCEP8B",35,0)
 .. S IBCT=IBCT+1
"RTN","IBCEP8B",36,0)
 .. S Z1=$J("",15)_$P(Z,U,10)
"RTN","IBCEP8B",37,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",38,0)
 . S Z1=$J("",15)_$P(Z,U,6)_$S($P(Z,U,6)'="":", ",1:"")_$S($P(Z,U,7):$$EXTERNAL^DILFD(355.93,.07,"",$P(Z,U,7))_"  ",1:"")_$P(Z,U,8)
"RTN","IBCEP8B",39,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",40,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",41,0)
 . S Z1=" " D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",42,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",43,0)
 . S Z1=$J("Type of Facility: ",30)_$$EXTERNAL^DILFD(355.93,.11,,$P(Z,U,11))
"RTN","IBCEP8B",44,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",45,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",46,0)
 . S Z1=$J("Primary ID: ",30)_$P(Z,U,9)
"RTN","IBCEP8B",47,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",48,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",49,0)
 . S Z1=$J("ID Qualifier: ",30)_$$GET1^DIQ(355.97,$P(Z,U,13),.03) I $P(Z,U,13)]"" S Z1=Z1_" - "_$$GET1^DIQ(355.97,$P(Z,U,13),.01)
"RTN","IBCEP8B",50,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",51,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",52,0)
 . S Z1=$J("Mammography Certification #: ",30)_$P(Z,U,15)
"RTN","IBCEP8B",53,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",54,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",55,0)
 . S Z1=$J("NPI: ",30)_$$NPIGET^IBCEP81(IBNPRV) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",56,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",57,0)
 . S IBPRI=$$TAXGET^IBCEP81(IBNPRV,.IBLST)
"RTN","IBCEP8B",58,0)
 . S Z1=$J("Taxonomy Code: ",30)_$P(IBPRI,U)
"RTN","IBCEP8B",59,0)
 . I $D(IBLST) S Z1=Z1_" ("_$S($P(IBLST(IBLST),U,3)=1:"Primary",1:"Secondary")_")"
"RTN","IBCEP8B",60,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",61,0)
 . S IBIEN=""
"RTN","IBCEP8B",62,0)
 . F  S IBIEN=$O(IBLST(IBIEN)) Q:IBIEN=""  D
"RTN","IBCEP8B",63,0)
 .. I IBIEN=IBLST Q
"RTN","IBCEP8B",64,0)
 .. S IBCT=IBCT+1
"RTN","IBCEP8B",65,0)
 .. S Z1=$J("",30)_$P(IBLST(IBIEN),U)_" ("_$S($P(IBLST(IBIEN),U,3)=1:"Primary",1:"Secondary")_")"
"RTN","IBCEP8B",66,0)
 .. D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",67,0)
 K VALMBG,VALMCNT
"RTN","IBCEP8B",68,0)
 S VALMBG=1,VALMCNT=IBLCT
"RTN","IBCEP8B",69,0)
 Q
"RTN","IBCEP8B",70,0)
 ;
"RTN","IBCEP8B",71,0)
SET1(IBLCT,TEXT,IBCT) ;
"RTN","IBCEP8B",72,0)
 S IBLCT=IBLCT+1 D SET^VALM10(IBLCT,TEXT,$G(IBCT))
"RTN","IBCEP8B",73,0)
 Q
"VER")
8.0^22.0
"^DD",355.93,355.93,41.01,0)
NPI^FX^^0;14^N IBOLDNPI S IBOLDNPI=$P($G(^IBA(355.93,DA,0)),U,14) K:$L(X)>10!($L(X)<10)!'$$CHKDGT^XUSNPI(X)!$$NPIUSED^IBCEP81(X,IBOLDNPI,DA,$S(X=IBOLDNPI:2,1:0),"XUSNPIMTL") X
"^DD",355.93,355.93,41.01,1,0)
^.1
"^DD",355.93,355.93,41.01,1,1,0)
355.93^NPI
"^DD",355.93,355.93,41.01,1,1,1)
S ^IBA(355.93,"NPI",$E(X,1,30),DA)=""
"^DD",355.93,355.93,41.01,1,1,2)
K ^IBA(355.93,"NPI",$E(X,1,30),DA)
"^DD",355.93,355.93,41.01,1,1,"%D",0)
^^1^1^3060914^
"^DD",355.93,355.93,41.01,1,1,"%D",1,0)
This cross reference holds a list of the active NPIs in this file.
"^DD",355.93,355.93,41.01,1,1,"DT")
3060728
"^DD",355.93,355.93,41.01,1,2,0)
355.93^NPIHISTORY
"^DD",355.93,355.93,41.01,1,2,1)
S ^IBA(355.93,"NPIHISTORY",$E(X,1,30),DA)=""
"^DD",355.93,355.93,41.01,1,2,2)
K ^IBA(355.93,"NPIHISTORY",$E(X,1,30),DA)
"^DD",355.93,355.93,41.01,1,2,3)
An entry into the NPI History cross reference should not be deleted
"^DD",355.93,355.93,41.01,1,2,"%D",0)
^.101^2^2^3060914^^
"^DD",355.93,355.93,41.01,1,2,"%D",1,0)
This cross reference holds the entire history of the NPIs used in the 
"^DD",355.93,355.93,41.01,1,2,"%D",2,0)
file.
"^DD",355.93,355.93,41.01,1,2,"DT")
3060914
"^DD",355.93,355.93,41.01,3)
Answer must be 10 characters in length and a valid unique NPI number.
"^DD",355.93,355.93,41.01,21,0)
^.001^2^2^3060728^^
"^DD",355.93,355.93,41.01,21,1,0)
Unique National Provider Identifier.  A unique integer assigned to a 
"^DD",355.93,355.93,41.01,21,2,0)
provider by CMS.  This field contains the current NPI for this provider.
"^DD",355.93,355.93,41.01,"DT")
3080512
"BLD",7196,6)
^366
**END**
**END**
