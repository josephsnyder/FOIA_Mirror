Released IB*2*370 SEQ #358
Extracted from mail message
**KIDS**:IB*2.0*370^

**INSTALL NAME**
IB*2.0*370
"BLD",6452,0)
IB*2.0*370^INTEGRATED BILLING^0^3080115^y
"BLD",6452,1,0)
^^1^1^3070223^
"BLD",6452,1,1,0)
Reasonable Charges v3.0: Remove RC Discounts
"BLD",6452,4,0)
^9.64PA^^
"BLD",6452,6.3)
5
"BLD",6452,"INIT")
POST^IBYPSK
"BLD",6452,"KRN",0)
^9.67PA^8989.52^19
"BLD",6452,"KRN",.4,0)
.4
"BLD",6452,"KRN",.401,0)
.401
"BLD",6452,"KRN",.402,0)
.402
"BLD",6452,"KRN",.403,0)
.403
"BLD",6452,"KRN",.5,0)
.5
"BLD",6452,"KRN",.84,0)
.84
"BLD",6452,"KRN",3.6,0)
3.6
"BLD",6452,"KRN",3.8,0)
3.8
"BLD",6452,"KRN",9.2,0)
9.2
"BLD",6452,"KRN",9.8,0)
9.8
"BLD",6452,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",6452,"KRN",9.8,"NM",1,0)
IBCRBC^^0^B11588633
"BLD",6452,"KRN",9.8,"NM",2,0)
IBCRBC1^^0^B55586137
"BLD",6452,"KRN",9.8,"NM",3,0)
IBCRBC2^^0^B26657513
"BLD",6452,"KRN",9.8,"NM",4,0)
IBCRBH1^^0^B56713441
"BLD",6452,"KRN",9.8,"NM",5,0)
IBCRCC^^0^B26741603
"BLD",6452,"KRN",9.8,"NM",6,0)
IBCRER^^0^B20891309
"BLD",6452,"KRN",9.8,"NM",7,0)
IBYPSK^^0^B6669891
"BLD",6452,"KRN",9.8,"NM",8,0)
IBCRER1^^0^B44995002
"BLD",6452,"KRN",9.8,"NM",9,0)
IBCRBCA1^^1^
"BLD",6452,"KRN",9.8,"NM",10,0)
IBCRBCA2^^1^
"BLD",6452,"KRN",9.8,"NM",11,0)
IBCRBCA3^^1^
"BLD",6452,"KRN",9.8,"NM",12,0)
IBCRBCAP^^1^
"BLD",6452,"KRN",9.8,"NM",13,0)
IBCRBCAQ^^1^
"BLD",6452,"KRN",9.8,"NM",14,0)
IBCRBCAR^^1^
"BLD",6452,"KRN",9.8,"NM","B","IBCRBC",1)

"BLD",6452,"KRN",9.8,"NM","B","IBCRBC1",2)

"BLD",6452,"KRN",9.8,"NM","B","IBCRBC2",3)

"BLD",6452,"KRN",9.8,"NM","B","IBCRBCA1",9)

"BLD",6452,"KRN",9.8,"NM","B","IBCRBCA2",10)

"BLD",6452,"KRN",9.8,"NM","B","IBCRBCA3",11)

"BLD",6452,"KRN",9.8,"NM","B","IBCRBCAP",12)

"BLD",6452,"KRN",9.8,"NM","B","IBCRBCAQ",13)

"BLD",6452,"KRN",9.8,"NM","B","IBCRBCAR",14)

"BLD",6452,"KRN",9.8,"NM","B","IBCRBH1",4)

"BLD",6452,"KRN",9.8,"NM","B","IBCRCC",5)

"BLD",6452,"KRN",9.8,"NM","B","IBCRER",6)

"BLD",6452,"KRN",9.8,"NM","B","IBCRER1",8)

"BLD",6452,"KRN",9.8,"NM","B","IBYPSK",7)

"BLD",6452,"KRN",19,0)
19
"BLD",6452,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",6452,"KRN",19,"NM",1,0)
IBCR ENTER RC NATIONAL CHARGES^^0
"BLD",6452,"KRN",19,"NM",2,0)
IBCR CHARGE MASTER MENU^^2
"BLD",6452,"KRN",19,"NM","B","IBCR CHARGE MASTER MENU",2)

"BLD",6452,"KRN",19,"NM","B","IBCR ENTER RC NATIONAL CHARGES",1)

"BLD",6452,"KRN",19.1,0)
19.1
"BLD",6452,"KRN",101,0)
101
"BLD",6452,"KRN",409.61,0)
409.61
"BLD",6452,"KRN",771,0)
771
"BLD",6452,"KRN",870,0)
870
"BLD",6452,"KRN",8989.51,0)
8989.51
"BLD",6452,"KRN",8989.52,0)
8989.52
"BLD",6452,"KRN",8994,0)
8994
"BLD",6452,"KRN","B",.4,.4)

"BLD",6452,"KRN","B",.401,.401)

"BLD",6452,"KRN","B",.402,.402)

"BLD",6452,"KRN","B",.403,.403)

"BLD",6452,"KRN","B",.5,.5)

"BLD",6452,"KRN","B",.84,.84)

"BLD",6452,"KRN","B",3.6,3.6)

"BLD",6452,"KRN","B",3.8,3.8)

"BLD",6452,"KRN","B",9.2,9.2)

"BLD",6452,"KRN","B",9.8,9.8)

"BLD",6452,"KRN","B",19,19)

"BLD",6452,"KRN","B",19.1,19.1)

"BLD",6452,"KRN","B",101,101)

"BLD",6452,"KRN","B",409.61,409.61)

"BLD",6452,"KRN","B",771,771)

"BLD",6452,"KRN","B",870,870)

"BLD",6452,"KRN","B",8989.51,8989.51)

"BLD",6452,"KRN","B",8989.52,8989.52)

"BLD",6452,"KRN","B",8994,8994)

"BLD",6452,"QUES",0)
^9.62^^
"BLD",6452,"REQB",0)
^9.611^3^2
"BLD",6452,"REQB",2,0)
IB*2.0*365^1
"BLD",6452,"REQB",3,0)
IB*2.0*347^1
"BLD",6452,"REQB","B","IB*2.0*347",3)

"BLD",6452,"REQB","B","IB*2.0*365",2)

"INIT")
POST^IBYPSK
"KRN",19,5531,-1)
2^2
"KRN",19,5531,0)
IBCR CHARGE MASTER MENU^Charge Master Menu^^M^10882^^^^^^^200
"KRN",19,5531,10,0)
^19.01IP^9^9
"KRN",19,5531,10,9,0)
12047
"KRN",19,5531,10,9,"^")
IBCR ENTER RC NATIONAL CHARGES
"KRN",19,5531,"U")
CHARGE MASTER MENU
"KRN",19,12047,-1)
0^1
"KRN",19,12047,0)
IBCR ENTER RC NATIONAL CHARGES^National Reasonable Charges Enter^^R^^IB SUPERVISOR^^^^^^INTEGRATED BILLING
"KRN",19,12047,1,0)
^19.06^4^4^3070223^^^
"KRN",19,12047,1,1,0)
This option is used to enter the National Interim Reasonable Charges.  
"KRN",19,12047,1,2,0)
These non-site specific charges are provided when new CPT/HCPCS codes 
"KRN",19,12047,1,3,0)
are released as interim charges until the next full release of Reasonable 
"KRN",19,12047,1,4,0)
Charges.
"KRN",19,12047,25)
IBCRER
"KRN",19,12047,"U")
NATIONAL REASONABLE CHARGES EN
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
370^3080115
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3080115
"PKG",200,22,1,"PAH",1,1,1,0)
Reasonable Charges v3.0: Remove RC Discounts
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","IBCRBC")
0^1^B11588633^B13287981
"RTN","IBCRBC",1,0)
IBCRBC ;ALB/ARH - RATES: BILL CALCULATION OF CHARGES ; 22-MAY-1996
"RTN","IBCRBC",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,106,51,137,245,370**;21-MAR-94;Build 5
"RTN","IBCRBC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRBC",4,0)
 ;
"RTN","IBCRBC",5,0)
 ; Variable DGPTUPDT may be defined on entry/exit for inpt bills so the PTF will only be updated once per session
"RTN","IBCRBC",6,0)
 ; Charges may be filed on the bill and if IBRSARR is passed but does not exist it may be updated
"RTN","IBCRBC",7,0)
 ; otherwise there are no other outputs/results of this call.
"RTN","IBCRBC",8,0)
 ;
"RTN","IBCRBC",9,0)
BILL(IBIFN,IBRSARR) ; given a bill number calculate and store all charges
"RTN","IBCRBC",10,0)
 ; if IBRSARR is defined it will be used to create charges rather than the standard set for the bills Rate Type
"RTN","IBCRBC",11,0)
 ;
"RTN","IBCRBC",12,0)
 N IB0,IBU,IBBRT,IBBTYPE,IBCTYPE,DFN,PTF,IBDGPT,IBRS,IBCS,IBBEVNT Q:'$G(IBIFN)
"RTN","IBCRBC",13,0)
 K ^TMP($J,"IBCRCC"),^TMP($J,"IBCRCS")
"RTN","IBCRBC",14,0)
 ;
"RTN","IBCRBC",15,0)
 S IB0=$G(^DGCR(399,+IBIFN,0)) Q:IB0=""  S IBU=$G(^DGCR(399,+IBIFN,"U")) Q:'IBU
"RTN","IBCRBC",16,0)
 S IBBRT=+$P(IB0,U,7),IBBTYPE=$S($$INPAT^IBCEF(IBIFN):1,1:3),IBCTYPE=+$P(IB0,U,27),DFN=$P(IB0,U,2) Q:'DFN
"RTN","IBCRBC",17,0)
 ;
"RTN","IBCRBC",18,0)
 ; if who's responsible is insurer, but bill has no insurer defined quit
"RTN","IBCRBC",19,0)
 I $P(IB0,U,11)="i",'$G(^DGCR(399,+IBIFN,"MP")),'$$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN)) Q
"RTN","IBCRBC",20,0)
 ;
"RTN","IBCRBC",21,0)
 ; if inpt bill, PTF Status is Open, not a Fee Basis record and not previously done then Update the PTF record
"RTN","IBCRBC",22,0)
 I IBBTYPE<3,'$D(DGPTUPDT) S PTF=$P(IB0,U,8) Q:'PTF  S IBDGPT=$G(^DGPT(+PTF,0)) Q:IBDGPT=""  D
"RTN","IBCRBC",23,0)
 . I '$P(IBDGPT,U,6),'$P(IBDGPT,U,4) D UPDT^DGPTUTL S DGPTUPDT=""
"RTN","IBCRBC",24,0)
 ;
"RTN","IBCRBC",25,0)
 ;
"RTN","IBCRBC",26,0)
 D DSPDL^IBCRBC3,DELALLRC^IBCRBF(IBIFN) ; delete all existing auto charges on the bill
"RTN","IBCRBC",27,0)
 ;
"RTN","IBCRBC",28,0)
 ; get standard set of all rate schedules and charge sets available for entire date range of the bill
"RTN","IBCRBC",29,0)
 I '$D(IBRSARR) D RT^IBCRU3(IBBRT,IBBTYPE,$P(IBU,U,1,2),.IBRSARR,"",IBCTYPE) I 'IBRSARR G END
"RTN","IBCRBC",30,0)
 ;
"RTN","IBCRBC",31,0)
 ; process charge sets - set all charges for the bill into array
"RTN","IBCRBC",32,0)
 S IBRS=0 F  S IBRS=$O(IBRSARR(IBRS)) Q:'IBRS  D
"RTN","IBCRBC",33,0)
 . S IBCS=0 F  S IBCS=$O(IBRSARR(IBRS,IBCS)) Q:'IBCS  I +IBRSARR(IBRS,IBCS) D
"RTN","IBCRBC",34,0)
 .. S IBBEVNT=+$P($G(^IBE(363.1,+IBCS,0)),U,3) Q:'IBBEVNT  S IBBEVNT=$$EMUTL^IBCRU1(IBBEVNT) Q:IBBEVNT=""
"RTN","IBCRBC",35,0)
 .. ;
"RTN","IBCRBC",36,0)
 .. I IBBEVNT["INPATIENT BEDSECTION STAY" D INPTBS^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBC",37,0)
 .. I IBBEVNT["INPATIENT DRG" D INPTDRG^IBCRBC11(IBIFN,IBRS,IBCS)
"RTN","IBCRBC",38,0)
 .. I IBBEVNT["OUTPATIENT VISIT DATE" D OPTVST^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBC",39,0)
 .. I IBBEVNT["PRESCRIPTION" D RX^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBC",40,0)
 .. I IBBEVNT["PROSTHETICS" D PI^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBC",41,0)
 .. I IBBEVNT["PROCEDURE" D CPT^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBC",42,0)
 ;
"RTN","IBCRBC",43,0)
 I '$D(^TMP($J,"IBCRCC")) G END
"RTN","IBCRBC",44,0)
 ;
"RTN","IBCRBC",45,0)
 D SORTCI^IBCRBC3 I '$D(^TMP($J,"IBCRCS")) G END
"RTN","IBCRBC",46,0)
 ;
"RTN","IBCRBC",47,0)
 D ADDBCHGS^IBCRBC3(IBIFN)
"RTN","IBCRBC",48,0)
 ;
"RTN","IBCRBC",49,0)
 D MAILADD(IBIFN,IBBTYPE)
"RTN","IBCRBC",50,0)
 ;
"RTN","IBCRBC",51,0)
END I $D(^TMP("IBCRRX",$J)) D CLEANRX^IBCRBC3(IBIFN)
"RTN","IBCRBC",52,0)
 K ^TMP($J,"IBCRCC"),^TMP($J,"IBCRCS")
"RTN","IBCRBC",53,0)
 Q
"RTN","IBCRBC",54,0)
 ;
"RTN","IBCRBC",55,0)
MAILADD(IBIFN,BTYPE) ; update the bill mailing address:  it may be based on the types of charges
"RTN","IBCRBC",56,0)
 ; an outpatient bill may go to either the opt or rx mailing addresses depending on the types of charges
"RTN","IBCRBC",57,0)
 N DA,IB01,IB02
"RTN","IBCRBC",58,0)
 I $G(BTYPE)>2,+$G(IBIFN),$D(^IBA(362.4,"C",+IBIFN)),+$$CHGTYPE^IBCU(+IBIFN)=3 S DA=IBIFN D MAILA^IBCU5 D
"RTN","IBCRBC",59,0)
 . I '$D(ZTQUEUED),'$G(IBAUTO) W !!,"Updating Bill Mailing Address"
"RTN","IBCRBC",60,0)
 Q
"RTN","IBCRBC",61,0)
 ;
"RTN","IBCRBC",62,0)
BILLITEM(IBIFN,IBITMARR) ; add selected unassociated item charges to the bill
"RTN","IBCRBC",63,0)
 N IBRS,IBCS,IBBEVNT K ^TMP($J,"IBCRCC"),^TMP($J,"IBCRCS")
"RTN","IBCRBC",64,0)
 ;
"RTN","IBCRBC",65,0)
 S IBRS=0 F  S IBRS=$O(IBITMARR(IBRS)) Q:'IBRS  D
"RTN","IBCRBC",66,0)
 . S IBCS=0 F  S IBCS=$O(IBITMARR(IBRS,IBCS)) Q:'IBCS  D
"RTN","IBCRBC",67,0)
 .. S IBBEVNT=+$P($G(^IBE(363.1,+IBCS,0)),U,3) Q:'IBBEVNT  S IBBEVNT=$$EMUTL^IBCRU1(IBBEVNT) Q:IBBEVNT=""
"RTN","IBCRBC",68,0)
 .. ;
"RTN","IBCRBC",69,0)
 .. I IBBEVNT["UNASSOCIATED" D UNASSOC^IBCRBC11(IBIFN,IBRS,IBCS,.IBITMARR)
"RTN","IBCRBC",70,0)
 ;
"RTN","IBCRBC",71,0)
 I $D(^TMP($J,"IBCRCC")) D SORTCI^IBCRBC3
"RTN","IBCRBC",72,0)
 ;
"RTN","IBCRBC",73,0)
 I $D(^TMP($J,"IBCRCS")) D ADDBCHGS^IBCRBC3(IBIFN)
"RTN","IBCRBC",74,0)
 ;
"RTN","IBCRBC",75,0)
 K ^TMP($J,"IBCRCC"),^TMP($J,"IBCRCS")
"RTN","IBCRBC",76,0)
 Q
"RTN","IBCRBC",77,0)
 ;
"RTN","IBCRBC",78,0)
 ;
"RTN","IBCRBC",79,0)
 ;
"RTN","IBCRBC",80,0)
 ; There are 3 types of charges/items:
"RTN","IBCRBC",81,0)
 ; - ITEM: charge for an individual item:  specific item has one or more charge entries in 363.2
"RTN","IBCRBC",82,0)
 ;   for the charge to be applied to the bill the specific item must be found on the bill
"RTN","IBCRBC",83,0)
 ;
"RTN","IBCRBC",84,0)
 ; - EVENT: charge for an event, not an item:  items are defined in 363.2
"RTN","IBCRBC",85,0)
 ;   all charge items active on a date in the set define the charge for the event
"RTN","IBCRBC",86,0)
 ;   the item does not need to be defined on the bill for the charge to be applied to the bill
"RTN","IBCRBC",87,0)
 ;   the charge set on a date becomes the events charge, so effective date cuts across item and applies to event
"RTN","IBCRBC",88,0)
 ;   all charge items with the same effective date are used to calculate the event charge for that date
"RTN","IBCRBC",89,0)
 ;   each charge item effective date in the set overrides all previous entries in the set regardless of item
"RTN","IBCRBC",90,0)
 ;
"RTN","IBCRBC",91,0)
 ; - VA COST:  charge for an individual item but no entries in 363.2
"RTN","IBCRBC",92,0)
 ;   instead the charge is calculated/obtained when it is needed from an interface with the source package
"RTN","IBCRBC",93,0)
 ;
"RTN","IBCRBC",94,0)
 ;
"RTN","IBCRBC",95,0)
 ; Auto calculation and filing of a bills charges
"RTN","IBCRBC",96,0)
 ;
"RTN","IBCRBC",97,0)
 ; IBCRBC (BILL) - determine if charges can be calculated and which rates (RS/CS) should be used
"RTN","IBCRBC",98,0)
 ;                 then find billable items/events, calculate and store the charges
"RTN","IBCRBC",99,0)
 ;                 called anytime a bills charges need to be updated
"RTN","IBCRBC",100,0)
 ;        
"RTN","IBCRBC",101,0)
 ;                 IBCRBC1 (event) - gather billable items/events for each billable event type
"RTN","IBCRBC",102,0)
 ;                                   then accumulate all charges for the bill for each billable event/item
"RTN","IBCRBC",103,0)
 ;
"RTN","IBCRBC",104,0)
 ;                                   IBCRCGx (event) - pull billable items/events from the bill
"RTN","IBCRBC",105,0)
 ;                                   IBCRBC2 (BITMCHRG) - calculate charges for billable item/event
"RTN","IBCRBC",106,0)
 ;
"RTN","IBCRBC",107,0)
 ;                 IBCRBC3 (SORTCI) - sort accumulated charges into order to store on bill, combine if possible
"RTN","IBCRBC",108,0)
 ;                 IBCRBC3 (ADDBCHRGS) -  store the sorted accumulated charges on the bill
"RTN","IBCRBC",109,0)
 ;
"RTN","IBCRBC",110,0)
 ;
"RTN","IBCRBC",111,0)
 ; The Billable Event of the Charge Set is directly related to the Type of charge assigned
"RTN","IBCRBC",112,0)
 ; to the charges calculated for that Charge Set.  So, Billable Event (363.1,.03) <-> Type (399,42,.1)
"RTN","IBCRBC",113,0)
 ;
"RTN","IBCRBC",114,0)
 ;
"RTN","IBCRBC",115,0)
 ;  ^TMP($J,"IBCRCC")  -  array containing raw charges for a bill and related data, created in IBRCBC2
"RTN","IBCRBC",116,0)
 ;  ^TMP($J,"IBCRCC",X) = 1  charge item ifn
"RTN","IBCRBC",117,0)
 ;                        2  charge set ifn
"RTN","IBCRBC",118,0)
 ;                        3  rate schedule ifn
"RTN","IBCRBC",119,0)
 ;                        4  item ptr (to source)
"RTN","IBCRBC",120,0)
 ;                        5  cpt modifier ptr
"RTN","IBCRBC",121,0)
 ;                        6  revenue code ptr
"RTN","IBCRBC",122,0)
 ;                        7  billable bedsection (bill)
"RTN","IBCRBC",123,0)
 ;                        8  event date (visit or st from or admission)
"RTN","IBCRBC",124,0)
 ;                        9  charge per unit/qty
"RTN","IBCRBC",125,0)
 ;                        10 units/qty (qty of item)
"RTN","IBCRBC",126,0)
 ;                        11 total charge per unit/qty
"RTN","IBCRBC",127,0)
 ;                        12 adjusted total charge per unit/qty
"RTN","IBCRBC",128,0)
 ;                        13 units (# item on bill)
"RTN","IBCRBC",129,0)
 ;                        14 CPT ptr
"RTN","IBCRBC",130,0)
 ;                        15 division ptr
"RTN","IBCRBC",131,0)
 ;                        16 item type (source)
"RTN","IBCRBC",132,0)
 ;                        17 item ptr (to source)
"RTN","IBCRBC",133,0)
 ;                        18 charge component
"RTN","IBCRBC",134,0)
 ;                        19 billable bedsection (for item)
"RTN","IBCRBC",135,0)
 ;                        20 procedure provider
"RTN","IBCRBC",136,0)
 ;                        21 procedures associated clinic
"RTN","IBCRBC",137,0)
 ;                        22 procedures Outpatient Encounter, pointer to #409.68
"RTN","IBCRBC",138,0)
 ;                        23 list of all the procedures modifiers, separated by ','
"RTN","IBCRBC",139,0)
 ;
"RTN","IBCRBC",140,0)
 ;  ^TMP($J,"IBCRCC",X,"CC",x) = comments explaining charge adjustements
"RTN","IBCRBC",141,0)
 ;
"RTN","IBCRBC",142,0)
 ;  ^TMP($J,"IBCRCS")  -  array of charges from IBCRCC in sorted order and with only data needed to save on bill
"RTN","IBCRBC",143,0)
 ;  ^TMP($J,"IBCRCS", BS, RV, X) = 1  revenue code ptr
"RTN","IBCRBC",144,0)
 ;                                 2  bedsection ptr
"RTN","IBCRBC",145,0)
 ;                                 3  charge per units (adjusted total charge)
"RTN","IBCRBC",146,0)
 ;                                 4  units (# item on bill)
"RTN","IBCRBC",147,0)
 ;                                 5  CPT ptr
"RTN","IBCRBC",148,0)
 ;                                 6  division ptr
"RTN","IBCRBC",149,0)
 ;                                 7  item type
"RTN","IBCRBC",150,0)
 ;                                 8  item ptr
"RTN","IBCRBC",151,0)
 ;                                 9  charge component
"RTN","IBCRBC",152,0)
 ;
"RTN","IBCRBC",153,0)
 ;
"RTN","IBCRBC",154,0)
 ;
"RTN","IBCRBC",155,0)
 ; Inpatient Bill Dates use follow rules:
"RTN","IBCRBC",156,0)
 ; - admission date is counted as billable
"RTN","IBCRBC",157,0)
 ; - the discharge date is not billable and is not counted
"RTN","IBCRBC",158,0)
 ; 
"RTN","IBCRBC",159,0)
 ; - if admission movement is found in the Patient Movement file then the dates of admission and discharge
"RTN","IBCRBC",160,0)
 ;   will be used as the outside limits of the LOS, even if date range of the bill is longer   (LOS^IBCU64)
"RTN","IBCRBC",161,0)
 ; 
"RTN","IBCRBC",162,0)
 ; - a day is counted as billable to the bedsection the patient was in at the end of the day (ie. counted
"RTN","IBCRBC",163,0)
 ;   in LOS of next movement after midnight)
"RTN","IBCRBC",164,0)
 ; - if there is a movement on any given date that date is included in the LOS of the bedsection the patient
"RTN","IBCRBC",165,0)
 ;   moved into (same as admission date)
"RTN","IBCRBC",166,0)
 ; - if there is a movement on any given date that date is NOT included in the LOS of the bedsection the 
"RTN","IBCRBC",167,0)
 ;   patient moved out of (same as discharge date)
"RTN","IBCRBC",168,0)
 ; 
"RTN","IBCRBC",169,0)
 ; - if the time frame of the bill is:
"RTN","IBCRBC",170,0)
 ;   - either interim-first or interim-continuous the last date on the bill should be billed
"RTN","IBCRBC",171,0)
 ;     - if the last date is counted it is added to the LOS of the bedsection the patient was in at the end
"RTN","IBCRBC",172,0)
 ;       of the day
"RTN","IBCRBC",173,0)
 ;   - either NOT interim-first or interim-continuous (final bills) the last date on the bill
"RTN","IBCRBC",174,0)
 ;     should NOT be billed (i.e. this is considered the discharge date)
"RTN","IBCRBC",175,0)
 ;
"RTN","IBCRBC",176,0)
 ; - start with first bedsection after begin date, day is counted in the bedsection the patient is in at midnight
"RTN","IBCRBC",177,0)
 ; - continuous: last bedsection counted is the bedsection the patient is in at midnight of the end date
"RTN","IBCRBC",178,0)
 ; - final:last bedsection counted is the bedsection the patient is in at midnight of the day before the end date
"RTN","IBCRBC",179,0)
 ;
"RTN","IBCRBC1")
0^2^B55586137^B55203191
"RTN","IBCRBC1",1,0)
IBCRBC1 ;ALB/ARH - RATES: BILL CALCULATION BILLABLE EVENTS ; 22 MAY 96
"RTN","IBCRBC1",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,106,138,51,148,245,270,370**;21-MAR-94;Build 5
"RTN","IBCRBC1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRBC1",4,0)
 ;
"RTN","IBCRBC1",5,0)
 ; For each type of Billable Event, search for items on the bill and calculate the charges
"RTN","IBCRBC1",6,0)
 ;  1) search the bill for items of the billable event type
"RTN","IBCRBC1",7,0)
 ;  2) determine how the charges should be calculated, based on Billable Item and Charge Method of the Set's Rate
"RTN","IBCRBC1",8,0)
 ;  3) calculate charges
"RTN","IBCRBC1",9,0)
 ; For per diem Billing Rates, no item pointers are passed since all items have a standard charge
"RTN","IBCRBC1",10,0)
 ; The Insurance Company Different Revenue Codes to Use (36,.07) is passed so standard rev codes can be replaced
"RTN","IBCRBC1",11,0)
 ; The Charge Type (363.1,.04) is passed so it can be added to the charge on the bill if it is defined for a Set
"RTN","IBCRBC1",12,0)
 ; Output:  ^TMP($J,"IBCRCC")= ..., (created in IBCRBC2 based on charge items found here)
"RTN","IBCRBC1",13,0)
 ;
"RTN","IBCRBC1",14,0)
INPTBS(IBIFN,RS,CS) ; Determine charges for INPATIENT BEDSECTION STAY billable events
"RTN","IBCRBC1",15,0)
 ; - the billable events are billable bedsections based on the patient movement treating specialties,
"RTN","IBCRBC1",16,0)
 ;   these are pulled from the PTF record each time the charges are calculated (INPTPTF^IBCRCG)
"RTN","IBCRBC1",17,0)
 ; - each day of billable care is calculated separately in case a rate becomes inactive
"RTN","IBCRBC1",18,0)
 ;
"RTN","IBCRBC1",19,0)
 N IBX,IBBLITEM,IBCHGMTH,IBEVDT,IBIDRC,IBBDIV,IBITM,IBDIV,IBTYPE,IBCMPNT,IBSAVE I '$G(IBIFN)!'$G(CS) Q
"RTN","IBCRBC1",20,0)
 ;
"RTN","IBCRBC1",21,0)
 D INPTPTF^IBCRBG(IBIFN,CS)
"RTN","IBCRBC1",22,0)
 ;
"RTN","IBCRBC1",23,0)
 S IBTYPE=1,IBCMPNT=$P($G(^IBE(363.1,+CS,0)),U,4),IBX=$$CSBR^IBCRU3(CS),IBBLITEM=$P(IBX,U,4),IBCHGMTH=$P(IBX,U,5)
"RTN","IBCRBC1",24,0)
 S IBIDRC=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBCRBC1",25,0)
 I 'IBIDRC,$$MCRWNR^IBEFUNC($$CURR^IBCEF2(IBIFN)) S IBIDRC=$$CURR^IBCEF2(IBIFN)
"RTN","IBCRBC1",26,0)
 S IBIDRC=$G(^DIC(36,+IBIDRC,0)),IBIDRC=$P(IBIDRC,U,7)
"RTN","IBCRBC1",27,0)
 ;
"RTN","IBCRBC1",28,0)
 S IBBDIV=$P($G(^DGCR(399,+IBIFN,0)),U,22) ; bill's default division
"RTN","IBCRBC1",29,0)
 ;
"RTN","IBCRBC1",30,0)
 I IBBLITEM=1,IBCHGMTH=1 D  ; inpt/bedsection/per diem
"RTN","IBCRBC1",31,0)
 . S IBEVDT="" F  S IBEVDT=$O(^TMP($J,"IBCRC-INDT",IBEVDT)) Q:'IBEVDT  D
"RTN","IBCRBC1",32,0)
 .. S IBX=$G(^TMP($J,"IBCRC-INDT",IBEVDT)),IBITM=+$P(IBX,U,2),IBDIV=$P(IBX,U,5)
"RTN","IBCRBC1",33,0)
 .. ;
"RTN","IBCRBC1",34,0)
 .. I $$CSDV^IBCRU3(CS,IBDIV,IBBDIV)<0 Q  ; check division
"RTN","IBCRBC1",35,0)
 .. ;
"RTN","IBCRBC1",36,0)
 .. S IBSAVE="1^^"_IBDIV_"^"_IBTYPE_"^^"_IBCMPNT
"RTN","IBCRBC1",37,0)
 .. D BITMCHG^IBCRBC2(RS,CS,IBITM,IBEVDT,1,"","",IBIDRC,IBSAVE)
"RTN","IBCRBC1",38,0)
 K ^TMP($J,"IBCRC-INDT")
"RTN","IBCRBC1",39,0)
 Q
"RTN","IBCRBC1",40,0)
 ;
"RTN","IBCRBC1",41,0)
OPTVST(IBIFN,RS,CS) ; Determine charges for OUTPATIENT VISIT DATE billable events
"RTN","IBCRBC1",42,0)
 ; - the billable event is the outpatient visit date(s) on the bill (399,43)
"RTN","IBCRBC1",43,0)
 ;
"RTN","IBCRBC1",44,0)
 N IBX,IBBLITEM,IBCHGMTH,IBIDRC,IBOPVARR,IBI,IBEVDT,IBTYPE,IBCMPNT,IBSAVE I '$G(IBIFN)!'$G(CS) Q
"RTN","IBCRBC1",45,0)
 ;
"RTN","IBCRBC1",46,0)
 D OPTVD^IBCRBG1(IBIFN,.IBOPVARR) Q:'IBOPVARR
"RTN","IBCRBC1",47,0)
 ;
"RTN","IBCRBC1",48,0)
 S IBTYPE=2,IBCMPNT=$P($G(^IBE(363.1,+CS,0)),U,4),IBX=$$CSBR^IBCRU3(CS),IBBLITEM=$P(IBX,U,4),IBCHGMTH=$P(IBX,U,5)
"RTN","IBCRBC1",49,0)
 S IBIDRC=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBCRBC1",50,0)
 I 'IBIDRC,$$MCRWNR^IBEFUNC($$CURR^IBCEF2(IBIFN)) S IBIDRC=$$CURR^IBCEF2(IBIFN)
"RTN","IBCRBC1",51,0)
 S IBIDRC=$G(^DIC(36,+IBIDRC,0)),IBIDRC=$P(IBIDRC,U,7)
"RTN","IBCRBC1",52,0)
 ;
"RTN","IBCRBC1",53,0)
 I IBBLITEM=1,IBCHGMTH=1 D  ; opt vst/bedsection/per diem
"RTN","IBCRBC1",54,0)
 . S IBI="" F  S IBI=$O(IBOPVARR(IBI)) Q:IBI=""  D
"RTN","IBCRBC1",55,0)
 .. S IBEVDT=IBOPVARR(IBI)
"RTN","IBCRBC1",56,0)
 .. S IBSAVE="1^^^"_IBTYPE_"^^"_IBCMPNT
"RTN","IBCRBC1",57,0)
 .. D ALLBEDS^IBCRBC2(RS,CS,IBEVDT,"",IBIDRC,IBSAVE)
"RTN","IBCRBC1",58,0)
 Q
"RTN","IBCRBC1",59,0)
 ;
"RTN","IBCRBC1",60,0)
RX(IBIFN,RS,CS) ; Determine charges for PRESCRIPTION billable events
"RTN","IBCRBC1",61,0)
 ; - the billable event is an rx that has been added to the bill (362.4)
"RTN","IBCRBC1",62,0)
 ; - the insurance company Prescription Refill Rev Code (36,.15) is passed to the calculator to be used as
"RTN","IBCRBC1",63,0)
 ;   the rev code for all Rx charges, all types, this overrides the rev codes for the set or item
"RTN","IBCRBC1",64,0)
 ; - on HCFA 1500, the site parameter Default Rx Refill CPT (350.9,1.3) is added as the CPT to all Rx RC entries
"RTN","IBCRBC1",65,0)
 ;
"RTN","IBCRBC1",66,0)
 N IBX,IBBLITEM,IBCHGMTH,IBRXCPT,IBIDRC,IBIRC,IBRXARR,IBRX,IBEVDT,IBUNIT,IBITM,IBNDC,IBTYPE,IBCMPNT,IBSAVE
"RTN","IBCRBC1",67,0)
 I '$G(IBIFN)!'$G(CS) Q
"RTN","IBCRBC1",68,0)
 ;
"RTN","IBCRBC1",69,0)
 D SET^IBCSC5A(IBIFN,.IBRXARR) Q:'$P(IBRXARR,U,2)
"RTN","IBCRBC1",70,0)
 ;
"RTN","IBCRBC1",71,0)
 S IBTYPE=3,IBCMPNT=$P($G(^IBE(363.1,+CS,0)),U,4),IBX=$$CSBR^IBCRU3(CS),IBBLITEM=$P(IBX,U,4),IBCHGMTH=$P(IBX,U,5)
"RTN","IBCRBC1",72,0)
 S IBIDRC=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBCRBC1",73,0)
 I 'IBIDRC,$$MCRWNR^IBEFUNC($$CURR^IBCEF2(IBIFN)) S IBIDRC=$$CURR^IBCEF2(IBIFN)
"RTN","IBCRBC1",74,0)
 S IBIDRC=$G(^DIC(36,+IBIDRC,0)),IBIRC=$P(IBIDRC,U,15),IBIDRC=$P(IBIDRC,U,7)
"RTN","IBCRBC1",75,0)
 ;
"RTN","IBCRBC1",76,0)
 S IBRXCPT="" I $$FT^IBCU3(IBIFN)=2 S IBRXCPT=$P($G(^IBE(350.9,1,1)),U,30)
"RTN","IBCRBC1",77,0)
 ;
"RTN","IBCRBC1",78,0)
 I IBBLITEM=1,IBCHGMTH=1 D  ; rx refill/bedsection/per diem
"RTN","IBCRBC1",79,0)
 . S IBRX="" F  S IBRX=$O(IBRXARR(IBRX)) Q:IBRX=""  D
"RTN","IBCRBC1",80,0)
 .. S IBEVDT=0 F  S IBEVDT=$O(IBRXARR(IBRX,IBEVDT)) Q:'IBEVDT  D
"RTN","IBCRBC1",81,0)
 ... ;
"RTN","IBCRBC1",82,0)
 ... S IBSAVE="1^"_IBRXCPT_"^^"_IBTYPE_"^"_+IBRXARR(IBRX,IBEVDT)_"^"_IBCMPNT
"RTN","IBCRBC1",83,0)
 ... D ALLBEDS^IBCRBC2(RS,CS,IBEVDT,IBIRC,IBIDRC,IBSAVE)
"RTN","IBCRBC1",84,0)
 ;
"RTN","IBCRBC1",85,0)
 I IBBLITEM=3,IBCHGMTH=3 D  ; ndc/quantity
"RTN","IBCRBC1",86,0)
 . S IBRX="" F  S IBRX=$O(IBRXARR(IBRX)) Q:IBRX=""  D
"RTN","IBCRBC1",87,0)
 .. S IBEVDT=0 F  S IBEVDT=$O(IBRXARR(IBRX,IBEVDT)) Q:'IBEVDT  D
"RTN","IBCRBC1",88,0)
 ... S IBX=IBRXARR(IBRX,IBEVDT),IBITM=+IBX,IBUNIT=$P(IBX,U,4),IBNDC=$P(IBX,U,5) Q:IBNDC=""
"RTN","IBCRBC1",89,0)
 ... S IBNDC=$O(^IBA(363.21,"B",IBNDC,0)) Q:'IBNDC
"RTN","IBCRBC1",90,0)
 ... S IBSAVE="1^"_IBRXCPT_"^^"_IBTYPE_"^"_IBITM_"^"_IBCMPNT
"RTN","IBCRBC1",91,0)
 ... D BITMCHG^IBCRBC2(RS,CS,IBNDC,IBEVDT,IBUNIT,"",IBIRC,IBIDRC,IBSAVE)
"RTN","IBCRBC1",92,0)
 ;
"RTN","IBCRBC1",93,0)
 I IBCHGMTH=2 D  ; va cost
"RTN","IBCRBC1",94,0)
 . S IBRX="" F  S IBRX=$O(IBRXARR(IBRX)) Q:IBRX=""  D
"RTN","IBCRBC1",95,0)
 .. S IBEVDT=0 F  S IBEVDT=$O(IBRXARR(IBRX,IBEVDT)) Q:'IBEVDT  D
"RTN","IBCRBC1",96,0)
 ... S IBX=IBRXARR(IBRX,IBEVDT),IBITM=+IBX,IBUNIT=$P(IBX,U,4) Q:'IBITM
"RTN","IBCRBC1",97,0)
 ... S IBSAVE="1^"_IBRXCPT_"^^"_IBTYPE_"^"_IBITM_"^"_IBCMPNT
"RTN","IBCRBC1",98,0)
 ... D BITMCHG^IBCRBC2(RS,CS,IBITM,IBEVDT,IBUNIT,"",IBIRC,IBIDRC,IBSAVE)
"RTN","IBCRBC1",99,0)
 ;
"RTN","IBCRBC1",100,0)
 Q
"RTN","IBCRBC1",101,0)
 ;
"RTN","IBCRBC1",102,0)
CPT(IBIFN,RS,CS) ; Determine charges for PROCEDURE billable events
"RTN","IBCRBC1",103,0)
 ; - the billable event is a CPT procedure from the bill (399,304)
"RTN","IBCRBC1",104,0)
 ; - the item to be billed is a CPT, this may include Modifier
"RTN","IBCRBC1",105,0)
 ; - for each CPT found on the bill that has a modifier, will first check to see if that CPT-modifier
"RTN","IBCRBC1",106,0)
 ;   combination is billable (ie. is defined as a charge item for the Billing Rate, does not have to be active)
"RTN","IBCRBC1",107,0)
 ;   if it does not then assumes the charge should be the CPT charge
"RTN","IBCRBC1",108,0)
 ; - if the charge set is limited by region then either the CPT's division or if no CPT division then the bill's
"RTN","IBCRBC1",109,0)
 ;   Default Division must be contained in the sets region
"RTN","IBCRBC1",110,0)
 ; - the billable CPT is added as the CPT of the charge entry, Division is also added if defined for the CPT
"RTN","IBCRBC1",111,0)
 ; - the procedures provider may affect the charges due to a provider discount
"RTN","IBCRBC1",112,0)
 ; - if an inpatient bill then the bedsection on date of procedure will be used as the default bedsection
"RTN","IBCRBC1",113,0)
 ; - different sets of charges apply to SNF and Inpatient care although the bill is defined as inpatient
"RTN","IBCRBC1",114,0)
 ; - the Default Rx CPT should not be billed the CPT charge, instead the Rx is charged
"RTN","IBCRBC1",115,0)
 ;
"RTN","IBCRBC1",116,0)
 N IBX,IBBLITEM,IBCHGMTH,IBBR,IBBDIV,IBIDRC,IBCPTARR,IBCPT,IBCPTFN,IBEVDT,IBMOD,IBDIV,IBTYPE,IBCMPNT
"RTN","IBCRBC1",117,0)
 N IBPPRV,IBBS,IBCLIN,IBOE,IBSAVE,IBUNIT,IBCPTRX,IBMODS I '$G(IBIFN)!'$G(CS) Q
"RTN","IBCRBC1",118,0)
 ;
"RTN","IBCRBC1",119,0)
 D CPT^IBCRBG1(IBIFN,.IBCPTARR) Q:'IBCPTARR
"RTN","IBCRBC1",120,0)
 ;
"RTN","IBCRBC1",121,0)
 S IBTYPE=4,IBCMPNT=$P($G(^IBE(363.1,+CS,0)),U,4),IBX=$$CSBR^IBCRU3(CS),IBBLITEM=$P(IBX,U,4),IBCHGMTH=$P(IBX,U,5)
"RTN","IBCRBC1",122,0)
 S IBIDRC=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBCRBC1",123,0)
 I 'IBIDRC,$$MCRWNR^IBEFUNC($$CURR^IBCEF2(IBIFN)) S IBIDRC=$$CURR^IBCEF2(IBIFN)
"RTN","IBCRBC1",124,0)
 S IBIDRC=$G(^DIC(36,+IBIDRC,0)),IBIDRC=$P(IBIDRC,U,7)
"RTN","IBCRBC1",125,0)
 S IBBR=$P(IBX,U,3) S IBCPTRX="" I $O(^IBA(362.4,"C",IBIFN,0)) S IBCPTRX=+$P($G(^IBE(350.9,1,1)),U,30)
"RTN","IBCRBC1",126,0)
 ;
"RTN","IBCRBC1",127,0)
 S IBBDIV=$P($G(^DGCR(399,+IBIFN,0)),U,22) ; bill's default division
"RTN","IBCRBC1",128,0)
 D INPTPTF^IBCRBG(IBIFN,CS) ; get inpatient bedsections
"RTN","IBCRBC1",129,0)
 ;
"RTN","IBCRBC1",130,0)
 I IBBLITEM=2 D  ; cpt/count/minutes/miles/hours
"RTN","IBCRBC1",131,0)
 . S IBCPT=0 F  S IBCPT=$O(IBCPTARR(IBCPT)) Q:'IBCPT  D
"RTN","IBCRBC1",132,0)
 .. S IBCPTFN=0 F  S IBCPTFN=$O(IBCPTARR(IBCPT,IBCPTFN)) Q:'IBCPTFN  D
"RTN","IBCRBC1",133,0)
 ... S IBX=IBCPTARR(IBCPT,IBCPTFN),IBEVDT=$P(IBX,U,1),(IBMOD,IBMODS)=$P(IBX,U,2)
"RTN","IBCRBC1",134,0)
 ... S IBDIV=$P(IBX,U,3),IBPPRV=$P(IBX,U,4),IBCLIN=$P(IBX,U,5),IBOE=$P(IBX,U,6)
"RTN","IBCRBC1",135,0)
 ... ;
"RTN","IBCRBC1",136,0)
 ... I '$$CHGOTH^IBCRBC2(IBIFN,RS,IBEVDT) Q
"RTN","IBCRBC1",137,0)
 ... I +IBCPTRX,'IBOE,IBCPT=IBCPTRX Q  ; site parameter rx procedure
"RTN","IBCRBC1",138,0)
 ... ;
"RTN","IBCRBC1",139,0)
 ... S IBUNIT=$$CPTUNITS^IBCRBC2(CS,IBCHGMTH,IBX) Q:'IBUNIT
"RTN","IBCRBC1",140,0)
 ... ;
"RTN","IBCRBC1",141,0)
 ... S IBBS=$P($G(^TMP($J,"IBCRC-INDT",IBEVDT)),U,2) ; get inpatient bedsection
"RTN","IBCRBC1",142,0)
 ... I 'IBBS S IBX=$O(^TMP($J,"IBCRC-INDT",IBEVDT),-1) I +IBX S IBBS=$P($G(^TMP($J,"IBCRC-INDT",IBX)),U,2)
"RTN","IBCRBC1",143,0)
 ... ;
"RTN","IBCRBC1",144,0)
 ... I '$P($$CPT^ICPTCOD(+IBCPT,+IBEVDT),U,7) Q  ; check is a valid active CPT
"RTN","IBCRBC1",145,0)
 ... I $$CSDV^IBCRU3(CS,IBDIV,IBBDIV)<0 Q  ; check division
"RTN","IBCRBC1",146,0)
 ... I +IBMOD S IBMOD=$P($$CPTMOD^IBCRCU1(CS,IBCPT,IBMOD,IBEVDT),",",1) ; check CPT-MODs for billable combination
"RTN","IBCRBC1",147,0)
 ... ;
"RTN","IBCRBC1",148,0)
 ... S IBSAVE="1^"_IBCPT_U_IBDIV_U_IBTYPE_U_IBCPTFN_U_IBCMPNT_U_IBBS_U_IBPPRV_U_IBCLIN_U_IBOE_U_IBMODS
"RTN","IBCRBC1",149,0)
 ... D BITMCHG^IBCRBC2(RS,CS,IBCPT,IBEVDT,IBUNIT,IBMOD,"",IBIDRC,IBSAVE)
"RTN","IBCRBC1",150,0)
 K ^TMP($J,"IBCRC-INDT")
"RTN","IBCRBC1",151,0)
 Q
"RTN","IBCRBC1",152,0)
 ;
"RTN","IBCRBC1",153,0)
PI(IBIFN,RS,CS) ; Determine charges for PROSTHETICS billable events
"RTN","IBCRBC1",154,0)
 ; - the billable event is a prosthetic item that has been added to the bill (362.5)
"RTN","IBCRBC1",155,0)
 ;
"RTN","IBCRBC1",156,0)
 N IBX,IBBLITEM,IBCHGMTH,IBPIARR,IBIDRC,IBEVDT,IBPI,IBITM,IBTYPE,IBCMPNT,IBSAVE I '$G(IBIFN)!'$G(CS) Q
"RTN","IBCRBC1",157,0)
 ;
"RTN","IBCRBC1",158,0)
 D SET^IBCSC5B(IBIFN,.IBPIARR) Q:'$P(IBPIARR,U,2)
"RTN","IBCRBC1",159,0)
 ;
"RTN","IBCRBC1",160,0)
 S IBTYPE=5,IBCMPNT=$P($G(^IBE(363.1,+CS,0)),U,4),IBX=$$CSBR^IBCRU3(CS),IBBLITEM=$P(IBX,U,4),IBCHGMTH=$P(IBX,U,5)
"RTN","IBCRBC1",161,0)
 S IBIDRC=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBCRBC1",162,0)
 I 'IBIDRC,$$MCRWNR^IBEFUNC($$CURR^IBCEF2(IBIFN)) S IBIDRC=$$CURR^IBCEF2(IBIFN)
"RTN","IBCRBC1",163,0)
 S IBIDRC=$G(^DIC(36,+IBIDRC,0)),IBIDRC=$P(IBIDRC,U,7)
"RTN","IBCRBC1",164,0)
 ;
"RTN","IBCRBC1",165,0)
 I IBBLITEM=1,IBCHGMTH=1 D  ; pros/bedsection/per diem
"RTN","IBCRBC1",166,0)
 . S IBEVDT="" F  S IBEVDT=$O(IBPIARR(IBEVDT)) Q:'IBEVDT  D
"RTN","IBCRBC1",167,0)
 .. S IBPI=0 F  S IBPI=$O(IBPIARR(IBEVDT,IBPI)) Q:'IBPI  D
"RTN","IBCRBC1",168,0)
 ... S IBSAVE="1^^^"_IBTYPE_"^^"_IBCMPNT
"RTN","IBCRBC1",169,0)
 ... D ALLBEDS^IBCRBC2(RS,CS,IBEVDT,"",IBIDRC,IBSAVE)
"RTN","IBCRBC1",170,0)
 ;
"RTN","IBCRBC1",171,0)
 I IBCHGMTH=2 D  ; va cost
"RTN","IBCRBC1",172,0)
 . S IBEVDT="" F  S IBEVDT=$O(IBPIARR(IBEVDT)) Q:'IBEVDT  D
"RTN","IBCRBC1",173,0)
 .. S IBPI=0 F  S IBPI=$O(IBPIARR(IBEVDT,IBPI)) Q:'IBPI  D
"RTN","IBCRBC1",174,0)
 ... S IBITM=IBPIARR(IBEVDT,IBPI) Q:'IBITM
"RTN","IBCRBC1",175,0)
 ... S IBSAVE="1^^^"_IBTYPE_"^"_+IBITM_"^"_IBCMPNT
"RTN","IBCRBC1",176,0)
 ... D BITMCHG^IBCRBC2(RS,CS,+IBITM,IBEVDT,1,"","",IBIDRC,IBSAVE)
"RTN","IBCRBC1",177,0)
 ;
"RTN","IBCRBC1",178,0)
 Q
"RTN","IBCRBC2")
0^3^B26657513^B24945366
"RTN","IBCRBC2",1,0)
IBCRBC2 ;ALB/ARH - RATES: BILL CALCULATION OF ITEM CHARGE ; 22-MAY-1996
"RTN","IBCRBC2",2,0)
 ;;2.0;INTEGRATED BILLING;**52,106,138,148,245,370**;21-MAR-94;Build 5
"RTN","IBCRBC2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRBC2",4,0)
 ;
"RTN","IBCRBC2",5,0)
 ; Input:  RS     - rate schedule necessary to calculated modified charges
"RTN","IBCRBC2",6,0)
 ;         CS     - required, charge set which defines the charges to calculate
"RTN","IBCRBC2",7,0)
 ;         ITEM   - required, ptr to source item to be billed, type defined by billable item of the rate
"RTN","IBCRBC2",8,0)
 ;         EVDT   - date of event, to be used when searching for a charge effective date, default=DT
"RTN","IBCRBC2",9,0)
 ;         UNITS  - required, used only for Quantity:  # of units of Charge Item Charge for each Item
"RTN","IBCRBC2",10,0)
 ;         MOD    - CPT Modifier if any
"RTN","IBCRBC2",11,0)
 ;         INSRC  - special revenue code to use (from ins comp), if any (overrides set and item rv cd)
"RTN","IBCRBC2",12,0)
 ;         IDFRC  - different revenue codes to use, these replace the standard set in CM (DRC:SRC,DRC:SRC)
"RTN","IBCRBC2",13,0)
 ;         SAVE   - serveral data items not needed here but passed on to next step (store) in TMP array:
"RTN","IBCRBC2",14,0)
 ;                  TUNITS - required to add charge to bill, total # of the Item on the bill
"RTN","IBCRBC2",15,0)
 ;                  CPT    - default CPT to be added to the bill for the charge
"RTN","IBCRBC2",16,0)
 ;                  DIV    - division charges apply to
"RTN","IBCRBC2",17,0)
 ;                  TYPE   - type of item being billed - defines the source of the item on the bill
"RTN","IBCRBC2",18,0)
 ;                  ITMPTR - soft pointer to the item on the bill:  may be a multiple or file IFN
"RTN","IBCRBC2",19,0)
 ;                  CMPNT  - what component of the total charge: institutional or professional
"RTN","IBCRBC2",20,0)
 ;                  BEDS   - billable bedsection to use if not a bedsection item, if null uses set default
"RTN","IBCRBC2",21,0)
 ;                  PROV   - procedure provider
"RTN","IBCRBC2",22,0)
 ;                  CLINIC - procedures associated clinic
"RTN","IBCRBC2",23,0)
 ;                  IBOE   - Outpatient Encounter, pointer to #408.69
"RTN","IBCRBC2",24,0)
 ;                  MODS   - list of all modifiers define for the procedure, separated by ','
"RTN","IBCRBC2",25,0)
 ;
"RTN","IBCRBC2",26,0)
 ; Total charge is calculated:  X = UNITS * UNIT CHARGE of the item         (per unit charge (un-adjusted))
"RTN","IBCRBC2",27,0)
 ;                              Y = X modified by Rate Schedule Adjustment  (per unit charge (adjusted))
"RTN","IBCRBC2",28,0)
 ; the Units are used to calculate the per item charge: 30 pills for an rx, 1 bs per bs
"RTN","IBCRBC2",29,0)
 ; and the Tunits are the number of that Item on the bill: 1 rx of 30 pills, 11 days of bs stay
"RTN","IBCRBC2",30,0)
 ;
"RTN","IBCRBC2",31,0)
 ; Output: TMP($J,"IBCRCC", containing all chargable items and all related info needed to file them on the bill
"RTN","IBCRBC2",32,0)
 ;         each charge will have it's own entry, nothing combined (12 = per unit charge (adjusted), p13 = Tunits)
"RTN","IBCRBC2",33,0)
 ;         TMP is not killed on entry so each items charges are compiled and added to existing charges
"RTN","IBCRBC2",34,0)
 ;         
"RTN","IBCRBC2",35,0)
BITMCHG(RS,CS,ITEM,EVDT,UNITS,MOD,INSRC,IDFRC,SAVE) ; get bill charges for a specific item, rate schedule and charge set and date set into temp array
"RTN","IBCRBC2",36,0)
 ;
"RTN","IBCRBC2",37,0)
 N IBCS0,IBDRVCD,IBBS,IBCHGARR,IBI,IBCNT,IBLN,IBCI,IBRVCD,IBPPRV,IBCHRG,IBTCHRG,IBRCHRG,IBPCHRG,IBACHRG
"RTN","IBCRBC2",38,0)
 N IBMCHRG,IBMODS,IBBASE,IBCOM I '$G(ITEM)!'$G(CS)!'$G(UNITS) Q
"RTN","IBCRBC2",39,0)
 ;
"RTN","IBCRBC2",40,0)
 S RS=$G(RS),EVDT=$S(+$G(EVDT):+EVDT\1,1:DT),MOD=$G(MOD),INSRC=$G(INSRC),IDFRC=$G(IDFRC),SAVE=$G(SAVE)
"RTN","IBCRBC2",41,0)
 S IBCS0=$G(^IBE(363.1,+CS,0)),IBDRVCD=$P(IBCS0,U,5),IBPPRV=$P(SAVE,U,8),IBMODS=$P(SAVE,U,11)
"RTN","IBCRBC2",42,0)
 S IBBS=+ITEM I $P($G(^IBE(363.3,+$P(IBCS0,U,2),0)),U,4)'=1 S IBBS=$P(SAVE,U,7) I 'IBBS S IBBS=$P(IBCS0,U,6)
"RTN","IBCRBC2",43,0)
 I 'IBBS Q
"RTN","IBCRBC2",44,0)
 ;
"RTN","IBCRBC2",45,0)
 D ITMCHG^IBCRCC(CS,ITEM,EVDT,MOD,.IBCHGARR)
"RTN","IBCRBC2",46,0)
 ;
"RTN","IBCRBC2",47,0)
 S IBCNT=+$G(^TMP($J,"IBCRCC"))
"RTN","IBCRBC2",48,0)
 S IBI=0 F  S IBI=$O(IBCHGARR(IBI)) Q:'IBI  D
"RTN","IBCRBC2",49,0)
 . S IBLN=IBCHGARR(IBI),IBCI=+IBLN,IBCHRG=$P(IBLN,U,3),(IBPCHRG,IBRCHRG)="" Q:'IBCHRG  S IBBASE=$P(IBLN,U,4)
"RTN","IBCRBC2",50,0)
 . S IBRVCD=INSRC I 'IBRVCD S IBRVCD=$P(IBLN,U,2)
"RTN","IBCRBC2",51,0)
 . I 'IBRVCD S IBRVCD=$P($$RVLNK^IBCRU6(+ITEM,"",+CS),U,2) I 'IBRVCD S IBRVCD=IBDRVCD Q:'IBRVCD
"RTN","IBCRBC2",52,0)
 . I +IDFRC,+$P(IDFRC,IBRVCD_":",2) S IBRVCD=+$P(IDFRC,IBRVCD_":",2) Q:IBRVCD'?3N
"RTN","IBCRBC2",53,0)
 . ;
"RTN","IBCRBC2",54,0)
 . S IBCHRG=IBCHRG*UNITS
"RTN","IBCRBC2",55,0)
 . S IBCHRG=IBCHRG+IBBASE
"RTN","IBCRBC2",56,0)
 . S IBPCHRG=IBCHRG I +IBPPRV S IBPCHRG=$$PRVCHG^IBCRCC(CS,IBCHRG,IBPPRV,EVDT,ITEM)
"RTN","IBCRBC2",57,0)
 . S IBMCHRG=+IBPCHRG I +IBMODS S IBMCHRG=$$MODCHG^IBCRCC(CS,IBPCHRG,IBMODS)
"RTN","IBCRBC2",58,0)
 . S (IBCHRG,IBTCHRG)=+IBMCHRG
"RTN","IBCRBC2",59,0)
 . S IBACHRG=IBTCHRG I +RS,+IBTCHRG S IBRCHRG=$$RATECHG^IBCRCC(RS,IBTCHRG,EVDT),IBACHRG=+IBRCHRG
"RTN","IBCRBC2",60,0)
 . ;
"RTN","IBCRBC2",61,0)
 . S IBCNT=IBCNT+1,^TMP($J,"IBCRCC")=IBCNT
"RTN","IBCRBC2",62,0)
 . S ^TMP($J,"IBCRCC",IBCNT)=IBCI_U_CS_U_RS_U_ITEM_U_MOD_U_IBRVCD_U_IBBS_U_EVDT_U_IBCHRG_U_UNITS_U_IBTCHRG_U_IBACHRG_U_$G(SAVE)
"RTN","IBCRBC2",63,0)
 . ;
"RTN","IBCRBC2",64,0)
 . I (UNITS>1)!(+IBBASE) S IBCOM=$$COMMUB(CS,UNITS,IBBASE) I IBCOM'="" D COMMENT(IBCNT,IBCOM)
"RTN","IBCRBC2",65,0)
 . I $P(IBPCHRG,U,2)'="" S IBCOM=$P(IBPCHRG,U,2) I IBCOM'="" D COMMENT(IBCNT,IBCOM)
"RTN","IBCRBC2",66,0)
 . I $P(IBMCHRG,U,2)'="" S IBCOM=$P(IBMCHRG,U,2) I IBCOM'="" D COMMENT(IBCNT,IBCOM)
"RTN","IBCRBC2",67,0)
 . I $P(IBRCHRG,U,2)'="" S IBCOM=$P(IBRCHRG,U,2) I IBCOM'="" D COMMENT(IBCNT,IBCOM)
"RTN","IBCRBC2",68,0)
 Q
"RTN","IBCRBC2",69,0)
 ;
"RTN","IBCRBC2",70,0)
COMMENT(LINE,COMM) ; set comment into charge array for a particular line item
"RTN","IBCRBC2",71,0)
 I +$D(^TMP($J,"IBCRCC",+$G(LINE))) N IBX D
"RTN","IBCRBC2",72,0)
 . S IBX=$O(^TMP($J,"IBCRCC",+LINE,"CC",9999),-1) S IBX=IBX+1
"RTN","IBCRBC2",73,0)
 . S ^TMP($J,"IBCRCC",+LINE,"CC",IBX)=$G(COMM)
"RTN","IBCRBC2",74,0)
 Q
"RTN","IBCRBC2",75,0)
 ;
"RTN","IBCRBC2",76,0)
COMMUB(CS,UNITS,BASE) ; return comment for special units and base
"RTN","IBCRBC2",77,0)
 N IBX,IBY,IBCM S IBX="",IBY="Charge calculated"
"RTN","IBCRBC2",78,0)
 S IBCM=$P($G(^IBE(363.1,+CS,0)),U,2),IBCM=$P($G(^IBE(363.3,+IBCM,0)),U,5)
"RTN","IBCRBC2",79,0)
 S IBCM=$S(IBCM=4:"Miles",IBCM=5:"SubUnits",IBCM=6:"Hours",1:"")
"RTN","IBCRBC2",80,0)
 I +$G(UNITS) S IBX=IBY_" for "_UNITS_" "_IBCM,IBY=""
"RTN","IBCRBC2",81,0)
 I +$G(BASE) S IBX=IBY_IBX_" with a Base Charge="_$J(BASE,0,2)
"RTN","IBCRBC2",82,0)
 Q IBX
"RTN","IBCRBC2",83,0)
 ;
"RTN","IBCRBC2",84,0)
ALLBEDS(RS,CS,EVDT,RC,DFRC,SAVE) ; get charges for all bedsections active on date of visit
"RTN","IBCRBC2",85,0)
 ; each effective date supercedes all previous effective date, regardless of the item
"RTN","IBCRBC2",86,0)
 ; used for per diem rates where the charges are associated with a bedsection, but the item being billed is not
"RTN","IBCRBC2",87,0)
 ; a bedsection, so the count of the item on the bill is found and applied as the units to all bedsections active
"RTN","IBCRBC2",88,0)
 ; on the event date  (the 3 opt visit dates on a bill are the units for the Outpatient Visit bedsection charge)
"RTN","IBCRBC2",89,0)
 ;
"RTN","IBCRBC2",90,0)
 N IBITM,IBITEMS I '$G(CS)!'$G(EVDT) Q
"RTN","IBCRBC2",91,0)
 ;
"RTN","IBCRBC2",92,0)
 D CSALL^IBCRCU1(CS,EVDT,.IBITEMS)
"RTN","IBCRBC2",93,0)
 ;
"RTN","IBCRBC2",94,0)
 I +IBITEMS S IBITM="" F  S IBITM=$O(IBITEMS(IBITM)) Q:'IBITM  D
"RTN","IBCRBC2",95,0)
 . D BITMCHG($G(RS),CS,IBITM,EVDT,1,"",$G(RC),$G(DFRC),$G(SAVE))
"RTN","IBCRBC2",96,0)
 Q
"RTN","IBCRBC2",97,0)
 ;
"RTN","IBCRBC2",98,0)
 ;
"RTN","IBCRBC2",99,0)
CPTUNITS(CS,CHGMTH,ITLINE) ; return CPT units based on Charge Method and CPT data
"RTN","IBCRBC2",100,0)
 ; Input:  CS is the related Charge Set
"RTN","IBCRBC2",101,0)
 ;         CHGMTH is the Rate Schedule Charge Method (363.3, .05)
"RTN","IBCRBC2",102,0)
 ;         ITLINE is item data from CPT^IBCRBG1
"RTN","IBCRBC2",103,0)
 ; Output: calculated units for CPT, 1 or calculated for miles/minutes/hours
"RTN","IBCRBC2",104,0)
 N IBUNIT S IBUNIT=1,CHGMTH=$G(CHGMTH),ITLINE=$G(ITLINE),CS=$G(CS)
"RTN","IBCRBC2",105,0)
 I CHGMTH=4 S IBUNIT=+$P(ITLINE,U,8) ; miles
"RTN","IBCRBC2",106,0)
 I CHGMTH=5 S IBUNIT=+$P(ITLINE,U,7) ; minutes
"RTN","IBCRBC2",107,0)
 I CHGMTH=6 S IBUNIT=+$P(ITLINE,U,9) ; hours
"RTN","IBCRBC2",108,0)
 S IBUNIT=$$CPTUNITS^IBCRCU1(CS,IBUNIT)
"RTN","IBCRBC2",109,0)
 Q IBUNIT
"RTN","IBCRBC2",110,0)
 ;
"RTN","IBCRBC2",111,0)
CHGOTH(IBIFN,RS,EVDT) ; check if the Rate Schedule charges are applicable to the event date for the bill
"RTN","IBCRBC2",112,0)
 ; this is relevent to RC v2.0 and type of care of Other
"RTN","IBCRBC2",113,0)
 ; both Rate Schedule is SNF and event date is SNF care or neither can be otherwise no charge
"RTN","IBCRBC2",114,0)
 ; SNF charges can't be used for non-SNF care and non-SNF charges can't be used for SNF care
"RTN","IBCRBC2",115,0)
 ; Output: returns true if charges and bill date are of same type, SNF or non-SNF
"RTN","IBCRBC2",116,0)
 N IBOK,IBRSTY,IBDTTY S (IBRSTY,IBDTTY)=0,IBOK=1
"RTN","IBCRBC2",117,0)
 I $G(EVDT)<$$VERSDT^IBCRU8(2) G CHGOTHQ
"RTN","IBCRBC2",118,0)
 I '$G(IBIFN)!'$G(RS) G CHGOTHQ
"RTN","IBCRBC2",119,0)
 ;
"RTN","IBCRBC2",120,0)
 S IBRSTY=$$RSOTHER^IBCRU8(RS) ; are charges for other type of care
"RTN","IBCRBC2",121,0)
 S IBDTTY=$$BOTHER^IBCU3(IBIFN,EVDT) ; is date other type of care
"RTN","IBCRBC2",122,0)
 ;
"RTN","IBCRBC2",123,0)
 I +IBRSTY,'IBDTTY S IBOK=0
"RTN","IBCRBC2",124,0)
 I 'IBRSTY,+IBDTTY S IBOK=0
"RTN","IBCRBC2",125,0)
 ;
"RTN","IBCRBC2",126,0)
CHGOTHQ Q IBOK
"RTN","IBCRBC2",127,0)
 ;
"RTN","IBCRBC2",128,0)
CHGICU(CS,BS) ; check if charge and bedsection match relative to ICU RC 2.0+, compares Charge Set Name and Bedsection
"RTN","IBCRBC2",129,0)
 ; both the charge set and the bedsection have to be ICU or neither of them can be ICU otherwise no charge
"RTN","IBCRBC2",130,0)
 ; ICU charges can't be used with non-ICU bedsections and non-ICU charges can't be used with ICU bedsection
"RTN","IBCRBC2",131,0)
 ; Output: returns true if charges and bedsection are of same type, ICU or non-ICU
"RTN","IBCRBC2",132,0)
 N IBCSICU,IBCSN,IBICU,IBOK S (IBOK,IBCSICU)=0,BS=+$G(BS)
"RTN","IBCRBC2",133,0)
 S IBICU=$$MCCRUTL^IBCRU1("ICU",5)
"RTN","IBCRBC2",134,0)
 S IBCSN=$G(^IBE(363.1,+$G(CS),0)) I $E(IBCSN,1,2)'="RC" S IBOK=1
"RTN","IBCRBC2",135,0)
 I $P(IBCSN,U,1)["ICU" S IBCSICU=1 ; charge set is icu
"RTN","IBCRBC2",136,0)
 ;
"RTN","IBCRBC2",137,0)
 I BS=IBICU,+IBCSICU S IBOK=1 ; both bedsection and charge set are icu
"RTN","IBCRBC2",138,0)
 I BS'=IBICU,'IBCSICU S IBOK=1 ; niether bedsection nor charge set are icu
"RTN","IBCRBC2",139,0)
 Q IBOK
"RTN","IBCRBCA1")
1^9^^B59536766
"RTN","IBCRBCA2")
1^10^^B12988933
"RTN","IBCRBCA3")
1^11^^B15514071
"RTN","IBCRBCAP")
1^12^^B51905634
"RTN","IBCRBCAQ")
1^13^^B47316097
"RTN","IBCRBCAR")
1^14^^B44755741
"RTN","IBCRBH1")
0^4^B56713441^B59021504
"RTN","IBCRBH1",1,0)
IBCRBH1 ;ALB/ARH - RATES: BILL HELP DISPLAYS - CHARGES ; 10-OCT-1998
"RTN","IBCRBH1",2,0)
 ;;2.0;INTEGRATED BILLING;**106,245,370**;21-MAR-94;Build 5
"RTN","IBCRBH1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRBH1",4,0)
 ;
"RTN","IBCRBH1",5,0)
DISPCHG(IBIFN) ; display a bills items and their charges, display only, does not change the charges on the bill
"RTN","IBCRBH1",6,0)
 ;
"RTN","IBCRBH1",7,0)
 D BILL(IBIFN,1),SORTCI(IBIFN),DSPCHRG(1) ;     display auto add charges
"RTN","IBCRBH1",8,0)
 K ^TMP($J,"IBCRCC"),^TMP($J,"IBCRCSX"),^TMP($J,"IBCRCSXR"),^TMP($J,"IBCRCSXN")
"RTN","IBCRBH1",9,0)
 D BILL(IBIFN,""),SORTCI(IBIFN),DSPCHRG("") ;   display non-auto add charges
"RTN","IBCRBH1",10,0)
 K ^TMP($J,"IBCRCC"),^TMP($J,"IBCRCSX"),^TMP($J,"IBCRCSXR"),^TMP($J,"IBCRCSXN")
"RTN","IBCRBH1",11,0)
 D NOTES(IBIFN,1)
"RTN","IBCRBH1",12,0)
 Q
"RTN","IBCRBH1",13,0)
 ;
"RTN","IBCRBH1",14,0)
BILL(IBIFN,IBAA,IBRSARR) ; given a bill number calculate charges using schedules that match the auto add flag
"RTN","IBCRBH1",15,0)
 ; if IBRSARR is defined it will be used to create charges rather than the standard set for the bills Rate Type
"RTN","IBCRBH1",16,0)
 ; Output:  ^TMP($J,"IBCRCC" - same as would be calculated if the charges were being added to bill
"RTN","IBCRBH1",17,0)
 ;
"RTN","IBCRBH1",18,0)
 N IB0,IBU,IBBRT,IBBTYPE,IBCTYPE,IBRS,IBCS,IBBEVNT Q:'$G(IBIFN)
"RTN","IBCRBH1",19,0)
 K ^TMP($J,"IBCRCC")
"RTN","IBCRBH1",20,0)
 ;
"RTN","IBCRBH1",21,0)
 S IB0=$G(^DGCR(399,+IBIFN,0)) Q:IB0=""  S IBU=$G(^DGCR(399,+IBIFN,"U")) Q:'IBU
"RTN","IBCRBH1",22,0)
 S IBBRT=+$P(IB0,U,7),IBBTYPE=$S($P(IB0,U,5)<3:1,1:3),IBCTYPE=+$P(IB0,U,27)
"RTN","IBCRBH1",23,0)
 ;
"RTN","IBCRBH1",24,0)
 ; get standard set of all rate schedules and charge sets available for the bill
"RTN","IBCRBH1",25,0)
 I '$D(IBRSARR) D RT^IBCRU3(IBBRT,IBBTYPE,$P(IBU,U,1,2),.IBRSARR,"",IBCTYPE) I 'IBRSARR G END
"RTN","IBCRBH1",26,0)
 ;
"RTN","IBCRBH1",27,0)
 ; process charge sets - set all charges for the bill into array
"RTN","IBCRBH1",28,0)
 S IBRS=0 F  S IBRS=$O(IBRSARR(IBRS)) Q:'IBRS  D
"RTN","IBCRBH1",29,0)
 . S IBCS=0 F  S IBCS=$O(IBRSARR(IBRS,IBCS)) Q:'IBCS  I IBRSARR(IBRS,IBCS)=IBAA D
"RTN","IBCRBH1",30,0)
 .. S IBBEVNT=+$P($G(^IBE(363.1,+IBCS,0)),U,3) Q:'IBBEVNT  S IBBEVNT=$$EMUTL^IBCRU1(IBBEVNT) Q:IBBEVNT=""
"RTN","IBCRBH1",31,0)
 .. ;
"RTN","IBCRBH1",32,0)
 .. I IBBEVNT["INPATIENT BEDSECTION STAY" D INPTBS^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBH1",33,0)
 .. I IBBEVNT["INPATIENT DRG" D INPTDRG^IBCRBC11(IBIFN,IBRS,IBCS)
"RTN","IBCRBH1",34,0)
 .. I IBBEVNT["OUTPATIENT VISIT DATE" D OPTVST^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBH1",35,0)
 .. I IBBEVNT["PRESCRIPTION" D RX^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBH1",36,0)
 .. I IBBEVNT["PROSTHETICS" D PI^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBH1",37,0)
 .. I IBBEVNT["PROCEDURE" D CPT^IBCRBC1(IBIFN,IBRS,IBCS)
"RTN","IBCRBH1",38,0)
 ;
"RTN","IBCRBH1",39,0)
END Q
"RTN","IBCRBH1",40,0)
 ;
"RTN","IBCRBH1",41,0)
 ;
"RTN","IBCRBH1",42,0)
SORTCI(IBIFN) ; process charge array - create new array in sorted order with items combined, if possible
"RTN","IBCRBH1",43,0)
 ; if bs, rv cd, charge, cpt, div, item type, item ptr and component all match then charge is combined
"RTN","IBCRBH1",44,0)
 ; Input:  TMP($J,"IBCRCC",X) = ...  (from IBCRBC2)
"RTN","IBCRBH1",45,0)
 ; Output: TMP($J,"IBCRCSX",X) = 
"RTN","IBCRBH1",46,0)
 ;         RV CD ^ BS ^ CHG ^ UNITS ^ CPT ^ DIV ^ ITM TYPE ^ ITM PTR ^ CHRG CMPNT ^ CHRG SET ^ EVNT DT ^ ITM NAME
"RTN","IBCRBH1",47,0)
 ;         TMP($J,"IBCRCSX",X,"CC",Y) = charge adjustment messages
"RTN","IBCRBH1",48,0)
 ;         TMP($J,"IBCRCSXR",BS,RV CD,X) = ""
"RTN","IBCRBH1",49,0)
 ;         TMP($J,"IBCRCSXN",DATE,ITEM NAME,X) = ""
"RTN","IBCRBH1",50,0)
 ;
"RTN","IBCRBH1",51,0)
 N IBI,IBLN,IBRVCD,IBBS,IBCHG,IBUNITS,IBCPT,IBDV,IBIT,IBIP,IBCMPT,IBCS,IBDT,IBNM,IBTUNITS,IBK,IBJ,IBX,IBY
"RTN","IBCRBH1",52,0)
 K ^TMP($J,"IBCRCSX"),^TMP($J,"IBCRCSXR"),^TMP($J,"IBCRCSXN")
"RTN","IBCRBH1",53,0)
 ;
"RTN","IBCRBH1",54,0)
 S IBI=0 F  S IBI=$O(^TMP($J,"IBCRCC",IBI)) Q:'IBI  D
"RTN","IBCRBH1",55,0)
 . ;
"RTN","IBCRBH1",56,0)
 . S IBLN=^TMP($J,"IBCRCC",IBI)
"RTN","IBCRBH1",57,0)
 . S IBRVCD=$P(IBLN,U,6),IBBS=$P(IBLN,U,7),IBCHG=+$FN($P(IBLN,U,12),"",2),IBUNITS=$P(IBLN,U,13)
"RTN","IBCRBH1",58,0)
 . S IBCPT=$P(IBLN,U,14),IBDV=$P(IBLN,U,15),IBIT=$P(IBLN,U,16),IBIP=$P(IBLN,U,17),IBCMPT=$P(IBLN,U,18)
"RTN","IBCRBH1",59,0)
 . S IBCS=$P(IBLN,U,2),IBDT=$P(IBLN,U,8),IBNM=$$ITMNM($G(IBIFN),IBBS,IBIT,IBIP,IBCPT)
"RTN","IBCRBH1",60,0)
 . ;
"RTN","IBCRBH1",61,0)
 . ; combine like charges, unless there are comments
"RTN","IBCRBH1",62,0)
 . S (IBTUNITS,IBK,IBJ)=0 F  S IBJ=$O(^TMP($J,"IBCRCSXR",+IBBS,+IBRVCD,IBJ)) Q:'IBJ  S IBK=IBJ D  Q:+IBTUNITS
"RTN","IBCRBH1",63,0)
 .. I $D(^TMP($J,"IBCRCC",IBI,"CC")) Q
"RTN","IBCRBH1",64,0)
 .. S IBX=$G(^TMP($J,"IBCRCSX",IBJ))
"RTN","IBCRBH1",65,0)
 .. I IBCHG=$P(IBX,U,3),IBCPT=$P(IBX,U,5),IBDV=$P(IBX,U,6),IBIT=$P(IBX,U,7),IBIP=$P(IBX,U,8),IBCMPT=$P(IBX,U,9) D
"RTN","IBCRBH1",66,0)
 ... S IBTUNITS=$P(IBX,U,4),IBDT=$P(IBX,U,11)
"RTN","IBCRBH1",67,0)
 . ;
"RTN","IBCRBH1",68,0)
 . I 'IBTUNITS S IBK=IBI ; no combination, new line item charge
"RTN","IBCRBH1",69,0)
 . S IBTUNITS=IBTUNITS+IBUNITS
"RTN","IBCRBH1",70,0)
 . ;
"RTN","IBCRBH1",71,0)
 . S ^TMP($J,"IBCRCSXR",+IBBS,+IBRVCD,IBK)=""
"RTN","IBCRBH1",72,0)
 . S ^TMP($J,"IBCRCSXN",IBDT_" ",IBNM_" ",IBK)=""
"RTN","IBCRBH1",73,0)
 . S ^TMP($J,"IBCRCSX",IBK)=IBRVCD_U_+IBBS_U_IBCHG_U_IBTUNITS_U_IBCPT_U_IBDV_U_IBIT_U_IBIP_U_IBCMPT_U_IBCS_U_IBDT_U_IBNM
"RTN","IBCRBH1",74,0)
 . S IBY=0 F  S IBY=$O(^TMP($J,"IBCRCC",IBI,"CC",IBY)) Q:'IBY  S ^TMP($J,"IBCRCSX",IBK,"CC",IBY)=^TMP($J,"IBCRCC",IBI,"CC",IBY)
"RTN","IBCRBH1",75,0)
 Q
"RTN","IBCRBH1",76,0)
 ;
"RTN","IBCRBH1",77,0)
DSPCHRG(AA) ; display charges
"RTN","IBCRBH1",78,0)
 ; Input: TMP($J,"IBCRCSx",...) = ... (from SORTCI)
"RTN","IBCRBH1",79,0)
 ;
"RTN","IBCRBH1",80,0)
 N IBX,IBI,IBJ,IBK,IBLN,IBCNT,IBRVCD,IBCHG,IBUNITS,IBDV,IBCMPT,IBCS,IBDT,IBNM,IBTOTAL,IBQUIT,IBY S (IBTOTAL,IBQUIT)=0
"RTN","IBCRBH1",81,0)
 ;
"RTN","IBCRBH1",82,0)
 D DSPHDR(AA) S IBCNT=4
"RTN","IBCRBH1",83,0)
 ;
"RTN","IBCRBH1",84,0)
 S IBI="" F  S IBI=$O(^TMP($J,"IBCRCSXN",IBI)) Q:IBI=""  D  Q:IBQUIT
"RTN","IBCRBH1",85,0)
 . S IBJ="" F  S IBJ=$O(^TMP($J,"IBCRCSXN",IBI,IBJ)) Q:IBJ=""  D  Q:IBQUIT
"RTN","IBCRBH1",86,0)
 .. S IBK=0 F  S IBK=$O(^TMP($J,"IBCRCSXN",IBI,IBJ,IBK)) Q:'IBK  D  Q:IBQUIT
"RTN","IBCRBH1",87,0)
 ... S IBLN=$G(^TMP($J,"IBCRCSX",IBK)) Q:IBLN=""
"RTN","IBCRBH1",88,0)
 ... ;
"RTN","IBCRBH1",89,0)
 ... ; add charges to RC multiple
"RTN","IBCRBH1",90,0)
 ... S IBRVCD=$P(IBLN,U,1),IBCHG=$P(IBLN,U,3),IBUNITS=$P(IBLN,U,4),IBDV=$P(IBLN,U,6)
"RTN","IBCRBH1",91,0)
 ... S IBCMPT=$P(IBLN,U,9),IBCS=$P(IBLN,U,10),IBDT=$P(IBLN,U,11),IBNM=$P(IBLN,U,12)
"RTN","IBCRBH1",92,0)
 ... S IBTOTAL=IBTOTAL+(IBCHG*IBUNITS),IBCNT=IBCNT+1
"RTN","IBCRBH1",93,0)
 ... ;
"RTN","IBCRBH1",94,0)
 ... S IBX=IBRVCD_U_IBCHG_U_IBUNITS_U_IBCMPT_U_IBCS_U_IBDT_U_IBDV_U_IBNM D DSPLN(IBX)
"RTN","IBCRBH1",95,0)
 ... ;
"RTN","IBCRBH1",96,0)
 ... S IBY=0 F  S IBY=$O(^TMP($J,"IBCRCSX",IBK,"CC",IBY)) Q:'IBY  D
"RTN","IBCRBH1",97,0)
 .... S IBX=$G(^TMP($J,"IBCRCSX",IBK,"CC",IBY)) I IBX'="" D DISPLNC(IBX) S IBCNT=IBCNT+1
"RTN","IBCRBH1",98,0)
 ... I $O(^TMP($J,"IBCRCSX",IBK,"CC",0)) D DISPLNC("") S IBCNT=IBCNT+1
"RTN","IBCRBH1",99,0)
 ... ;
"RTN","IBCRBH1",100,0)
 ... I IBCNT>20 S IBQUIT=$$PAUSE(IBCNT) Q:IBQUIT  D DSPHDR(AA) S IBCNT=4
"RTN","IBCRBH1",101,0)
 ;
"RTN","IBCRBH1",102,0)
 I +IBTOTAL W !,?72,"--------",!,?70,$J(IBTOTAL,10,2) S IBCNT=IBCNT+2
"RTN","IBCRBH1",103,0)
 I 'IBQUIT S IBQUIT=$$PAUSE(IBCNT)
"RTN","IBCRBH1",104,0)
 Q
"RTN","IBCRBH1",105,0)
 ;
"RTN","IBCRBH1",106,0)
DSPHDR(AA) ;
"RTN","IBCRBH1",107,0)
 W @IOF,!,"Items and Charges on this Bill ("_$S('AA:"NOT ",1:"")_"Auto Add)"
"RTN","IBCRBH1",108,0)
 W !,"Item",?18,"Date",?28,"Charge Set",?40,"Div",?47,"Type",?52,"RvCd",?57,"Units",?64,"Charge",?75,"Total"
"RTN","IBCRBH1",109,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCRBH1",110,0)
 Q
"RTN","IBCRBH1",111,0)
 ;
"RTN","IBCRBH1",112,0)
DSPLN(LN) ;
"RTN","IBCRBH1",113,0)
 N CS,DIV,CMP,RVCD,ITM,CHG,UNIT S LN=$G(LN)
"RTN","IBCRBH1",114,0)
 S CS=$P(LN,U,5) I +CS S CS=$P($G(^IBE(363.1,+$P(LN,U,5),0)),U,1)
"RTN","IBCRBH1",115,0)
 S DIV=$P($G(^DG(40.8,+$P(LN,U,7),0)),U,2)
"RTN","IBCRBH1",116,0)
 S CMP=$S($P(LN,U,4)=1:"INST",$P(LN,U,4)=2:"PROF",1:"")
"RTN","IBCRBH1",117,0)
 S RVCD=$P($G(^DGCR(399.2,+LN,0)),U,1)
"RTN","IBCRBH1",118,0)
 S ITM=$P(LN,U,8),CHG=+$P(LN,U,2),UNIT=$P(LN,U,3)
"RTN","IBCRBH1",119,0)
 W !,$E(ITM,1,15),?18,$$DATE($P(LN,U,6)),?28,$E(CS,1,7),?40,DIV,?47,CMP,?52,RVCD,?57,$J(UNIT,3),?62,$J(CHG,8,2),?71,$J((UNIT*CHG),9,2)
"RTN","IBCRBH1",120,0)
 Q
"RTN","IBCRBH1",121,0)
 ;
"RTN","IBCRBH1",122,0)
DISPLNC(LN) ; display charge adjustment commenmts
"RTN","IBCRBH1",123,0)
 W !,?18,$G(LN)
"RTN","IBCRBH1",124,0)
 Q
"RTN","IBCRBH1",125,0)
 ;
"RTN","IBCRBH1",126,0)
DATE(X) ;
"RTN","IBCRBH1",127,0)
 S X=$G(X),X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBCRBH1",128,0)
 Q X
"RTN","IBCRBH1",129,0)
 ;
"RTN","IBCRBH1",130,0)
PAUSE(CNT) ;
"RTN","IBCRBH1",131,0)
 N IBI F IBI=CNT:1:22 W !
"RTN","IBCRBH1",132,0)
 N DIR,DUOUT,DTOUT,DIRUT,IBX,X,Y S IBX=0,DIR(0)="E" D ^DIR K DIR I $D(DIRUT) S IBX=1
"RTN","IBCRBH1",133,0)
 Q IBX
"RTN","IBCRBH1",134,0)
 ;
"RTN","IBCRBH1",135,0)
ITMNM(IBIFN,IBBS,IBIT,IBIP,IBCPT) ; return external form of the item name
"RTN","IBCRBH1",136,0)
 N ITM S ITM="",IBBS=$G(IBBS),IBIT=$G(IBIT),IBIP=$G(IBIP),IBCPT=$G(IBCPT)
"RTN","IBCRBH1",137,0)
 I +IBIP S ITM=$$NAME^IBCSC61(IBIT,IBIP)
"RTN","IBCRBH1",138,0)
 I ITM="",+IBIT=4,+$G(IBIFN) S ITM=$$CPTNM(IBIFN,IBIT,IBIP)
"RTN","IBCRBH1",139,0)
 I ITM="",+IBCPT S ITM=$P($$CPT^ICPTCOD(+IBCPT,DT),U,2)
"RTN","IBCRBH1",140,0)
 I ITM="" S ITM=$$EMUTL^IBCRU1(IBBS)
"RTN","IBCRBH1",141,0)
 Q ITM
"RTN","IBCRBH1",142,0)
 ;
"RTN","IBCRBH1",143,0)
CPTNM(IBIFN,TYPE,ITEM) ; retrurn external name of the charge item if it is a CPT item (type=399,42,.1)
"RTN","IBCRBH1",144,0)
 N IBX,NAME S IBX=0,NAME=""
"RTN","IBCRBH1",145,0)
 I +$G(TYPE)=4 S IBX=$G(^DGCR(399,+$G(IBIFN),"CP",+$G(ITEM),0))
"RTN","IBCRBH1",146,0)
 I +IBX S NAME=$P($$CPT^ICPTCOD(+$P(IBX,U,1),DT),U,2)
"RTN","IBCRBH1",147,0)
 I +IBX S IBX=$$GETMOD^IBEFUNC(+$G(IBIFN),+$G(ITEM),1) I IBX'="" S NAME=NAME_"-"_IBX
"RTN","IBCRBH1",148,0)
 Q NAME
"RTN","IBCRBH1",149,0)
 ;
"RTN","IBCRBH1",150,0)
 ;
"RTN","IBCRBH1",151,0)
 ;
"RTN","IBCRBH1",152,0)
 ;
"RTN","IBCRBH1",153,0)
NOTES(IBIFN,PAUSE) ; compile and print charge notes for a bill
"RTN","IBCRBH1",154,0)
 ;
"RTN","IBCRBH1",155,0)
 ; Current Checks are for those Treating Specialties that should not be billed using DRG:
"RTN","IBCRBH1",156,0)
 ; - Inpatient Institutional Reasonable Charges bill contains SNF Treating Specialty
"RTN","IBCRBH1",157,0)
 ; - Inpatient Institutional Reasonable Charges bill contains Observation Treating Specialty
"RTN","IBCRBH1",158,0)
 ;
"RTN","IBCRBH1",159,0)
 I $D(ZTQUEUED)!(+$G(IBAUTO)) Q
"RTN","IBCRBH1",160,0)
 N IB0,IBU,PTF,BEG,END,IBMVLN,IBENDDT,IBMDRG,IBFND,IBMSG,IBX S IBFND=0 K ^TMP($J,"IBCRC-PTF")
"RTN","IBCRBH1",161,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)) Q:IB0=""  S IBU=$G(^DGCR(399,+$G(IBIFN),"U")) Q:'IBU
"RTN","IBCRBH1",162,0)
 ;
"RTN","IBCRBH1",163,0)
 I '$$BILLRATE^IBCRU3($P(IB0,U,7),$P(IB0,U,5),$P(IB0,U,3),"RC") Q  ; not Reasonable Charges bill
"RTN","IBCRBH1",164,0)
 ;
"RTN","IBCRBH1",165,0)
 ; Outpatient Freestanding bill: display message if this is a non-provider based freestanding bill
"RTN","IBCRBH1",166,0)
 I $P(IB0,U,5)=3,$P(IB0,U,3)'<$$VERSDT^IBCRU8(2),$P($$RCDV^IBCRU8(+$P(IB0,U,22)),U,3)=3 D
"RTN","IBCRBH1",167,0)
 . S IBFND=IBFND+1,IBX=">>> Bill Division is Freestanding Non-Provider with Professional Charges only.",IBMSG(IBFND)=IBX
"RTN","IBCRBH1",168,0)
 ;
"RTN","IBCRBH1",169,0)
 ; Inpatient Institutional bill: check for treating specialties that should not be billed by DRG
"RTN","IBCRBH1",170,0)
 I +$P(IB0,U,8),$P(IB0,U,5)<3,$P(IB0,U,27)<2 D
"RTN","IBCRBH1",171,0)
 . ;
"RTN","IBCRBH1",172,0)
 . S PTF=+$P(IB0,U,8),BEG=+$P(IBU,U,1)\1,END=$S(+$P(IBU,U,2):+$P(IBU,U,2)\1,1:DT)
"RTN","IBCRBH1",173,0)
 . ;
"RTN","IBCRBH1",174,0)
 . D PTF^IBCRBG(PTF)
"RTN","IBCRBH1",175,0)
 . ;
"RTN","IBCRBH1",176,0)
 . S IBENDDT=BEG F  S IBENDDT=$O(^TMP($J,"IBCRC-PTF",IBENDDT)) Q:'IBENDDT  D  I IBENDDT>END Q
"RTN","IBCRBH1",177,0)
 .. I (IBENDDT\1)=BEG,BEG'=END Q
"RTN","IBCRBH1",178,0)
 .. ;
"RTN","IBCRBH1",179,0)
 .. S IBMVLN=$G(^TMP($J,"IBCRC-PTF",IBENDDT)),IBMVLN=+$P(IBMVLN,U,6) Q:'IBMVLN
"RTN","IBCRBH1",180,0)
 .. S IBMDRG=$$NODRG^IBCRBG2(IBMVLN) Q:'IBMDRG
"RTN","IBCRBH1",181,0)
 .. ;
"RTN","IBCRBH1",182,0)
 .. S IBFND=IBFND+1,IBX=">>> "_$P(IBMDRG,U,2)_" ("_$$FMTE^XLFDT(IBENDDT,2)_") not billed using DRG"
"RTN","IBCRBH1",183,0)
 .. S:IBMDRG["Nursing" IBX=IBX_", use SNF." S:IBMDRG["Observa" IBX=IBX_", use Procedures."
"RTN","IBCRBH1",184,0)
 .. S IBMSG(IBFND)=$G(IBX)
"RTN","IBCRBH1",185,0)
 ;
"RTN","IBCRBH1",186,0)
 I +IBFND D  I +$G(PAUSE) S IBFND=$$PAUSE(21)
"RTN","IBCRBH1",187,0)
 . W ! S IBX="" F  S IBX=$O(IBMSG(IBX)) Q:IBX=""  W !,IBMSG(IBX)
"RTN","IBCRBH1",188,0)
 K ^TMP($J,"IBCRC-PTF")
"RTN","IBCRBH1",189,0)
 Q
"RTN","IBCRCC")
0^5^B26741603^B18670863
"RTN","IBCRCC",1,0)
IBCRCC ;ALB/ARH - RATES: CALCULATION OF ITEM CHARGE ;22-MAY-1996
"RTN","IBCRCC",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,106,138,245,223,309,347,370**;21-MAR-94;Build 5
"RTN","IBCRCC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRCC",4,0)
 ;
"RTN","IBCRCC",5,0)
 ; ITMCHG and RATECHG are basic item/set/rate charge functions, IBCRCI contains more standard callable functions
"RTN","IBCRCC",6,0)
 ;
"RTN","IBCRCC",7,0)
ITMCHG(CS,ITEM,EVDT,MOD,ARR) ; get the base unit charges for a specific item, given a charge set, item and date
"RTN","IBCRCC",8,0)
 ; this is the primary function to get an item charge and works for all Charge Methods, given an Item
"RTN","IBCRCC",9,0)
 ; returns ARR = count of items in array ^ total charge for item ^ total base charge
"RTN","IBCRCC",10,0)
 ;         ARR(x) = charge item IFN (if any) ^ rev code (if any) ^ $ charge ^ $ base charge
"RTN","IBCRCC",11,0)
 ; checks Item effective and inactive dates, modifier match, and only sets array if the charge is non-zero
"RTN","IBCRCC",12,0)
 ; each item will be passed back separately in the array, no combination of charges
"RTN","IBCRCC",13,0)
 ;
"RTN","IBCRCC",14,0)
 N IBCSBR,IBEVDT,IBEFDT,IBXREF,IBITEM,IBDA,IBLN,IBCHRG,IBITMFND K ARR S ARR=0
"RTN","IBCRCC",15,0)
 S CS=+$G(CS),IBEVDT=$S(+$G(EVDT):+EVDT,1:DT),IBITEM=+$G(ITEM),MOD=$G(MOD) I 'CS!'IBITEM Q
"RTN","IBCRCC",16,0)
 S IBCSBR=$$CSBR^IBCRU3(CS)
"RTN","IBCRCC",17,0)
 ;
"RTN","IBCRCC",18,0)
 ; va cost
"RTN","IBCRCC",19,0)
 I $P(IBCSBR,U,5)=2 D  Q  ; va cost
"RTN","IBCRCC",20,0)
 . I $P(IBCSBR,U,1)["PROSTHETICS" S IBCHRG=$$PICOST(IBITEM)  I +IBCHRG D SETARR(0,0,+IBCHRG,.ARR) Q
"RTN","IBCRCC",21,0)
 . I $P(IBCSBR,U,1)["PRESCRIPTION" S IBCHRG=$$RXCOST(IBITEM) I +IBCHRG D SETARR(0,0,+IBCHRG,.ARR) Q
"RTN","IBCRCC",22,0)
 ;
"RTN","IBCRCC",23,0)
 ; all others - have Charge Item entries
"RTN","IBCRCC",24,0)
 ;
"RTN","IBCRCC",25,0)
 ; find most recent Charge Item for the item, search until modifiers match (only BI=CPT should have mods defined)
"RTN","IBCRCC",26,0)
 S IBXREF="AIVDTS"_CS,IBITMFND=0
"RTN","IBCRCC",27,0)
 S IBEFDT=-(IBEVDT+.01) F  S IBEFDT=$O(^IBA(363.2,IBXREF,IBITEM,IBEFDT)) Q:'IBEFDT  D  Q:IBITMFND
"RTN","IBCRCC",28,0)
 . S IBDA=0 F  S IBDA=$O(^IBA(363.2,IBXREF,IBITEM,IBEFDT,IBDA)) Q:'IBDA  D
"RTN","IBCRCC",29,0)
 .. S IBLN=$G(^IBA(363.2,IBDA,0))
"RTN","IBCRCC",30,0)
 .. I +$P(IBLN,U,7)'=+MOD Q  ; charge item modifier does not match modifier passed in
"RTN","IBCRCC",31,0)
 .. S IBITMFND=1 ; item found
"RTN","IBCRCC",32,0)
 .. I +$P(IBLN,U,4),+$P(IBLN,U,4)<IBEVDT Q  ; charge is inactive on event date
"RTN","IBCRCC",33,0)
 .. I +$P(IBLN,U,5) D SETARR(IBDA,+$P(IBLN,U,6),+$P(IBLN,U,5),.ARR,$P(IBLN,U,8))
"RTN","IBCRCC",34,0)
 Q
"RTN","IBCRCC",35,0)
 ;
"RTN","IBCRCC",36,0)
SETARR(CI,RVCD,CHRG,ARR,CHRGB) ; set charges into an array, does not allow zero charge, a new entry is created each time,
"RTN","IBCRCC",37,0)
 ; no attempt to combine like items, the new item charge is added to any that may already be in the array 
"RTN","IBCRCC",38,0)
 ; returns ARR = count of items in array ^ total charge for item
"RTN","IBCRCC",39,0)
 ;         ARR(x) = charge item IFN (if any) ^ item rev code (if any) ^ $ charge
"RTN","IBCRCC",40,0)
 ;
"RTN","IBCRCC",41,0)
 N CNT,TCHRG,TCHRGB
"RTN","IBCRCC",42,0)
 S CNT=+$G(ARR)+1,TCHRG=$P($G(ARR),U,2)+$G(CHRG) I +$G(CHRGB) S TCHRGB=+$P($G(ARR),U,3)+CHRGB
"RTN","IBCRCC",43,0)
 I +$G(CHRG) S ARR=CNT_U_+TCHRG_U_$G(TCHRGB),ARR(CNT)=$G(CI)_U_+$G(RVCD)_U_+CHRG_U_$G(TCHRGB)
"RTN","IBCRCC",44,0)
 Q
"RTN","IBCRCC",45,0)
 ;
"RTN","IBCRCC",46,0)
PICOST(PI) ; returns (PI=ptr 362.5): total VA cost of an item (660,14) ^ quantity (660,5) from prosthetics ^ bill IFN
"RTN","IBCRCC",47,0)
 ;
"RTN","IBCRCC",48,0)
 N IBPIP,IBLN,IBX,IBIFN S (IBPIP,IBX)=0
"RTN","IBCRCC",49,0)
 I +$G(PI) S IBLN=$G(^IBA(362.5,+PI,0)),IBPIP=$P(IBLN,U,4),IBIFN=$P(IBLN,U,2)
"RTN","IBCRCC",50,0)
 I +IBPIP S IBLN=$G(^RMPR(660,+IBPIP,0)) I IBLN'="" S IBX=$P(IBLN,U,16)_U_$P(IBLN,U,7)_U_IBIFN
"RTN","IBCRCC",51,0)
 Q IBX
"RTN","IBCRCC",52,0)
 ;
"RTN","IBCRCC",53,0)
RATECHG(RS,CHG,EVDT,FEE) ; returns modifed item charge based on rate schedule:  check effective dates, apply adjustment
"RTN","IBCRCC",54,0)
 ; adjusted amount ^ comment (if there is an adjustment)
"RTN","IBCRCC",55,0)
 ; if FEE passed by reference, returns disp fee^admin fee
"RTN","IBCRCC",56,0)
 ;
"RTN","IBCRCC",57,0)
 N IBX,IBRS0,IBRS10,IBEFDT,IBINADT,IBRTY,X S IBRTY=""
"RTN","IBCRCC",58,0)
 S IBX=+$G(CHG),IBRS0=$G(^IBE(363,+$G(RS),0)),IBRS10=$G(^IBE(363,+$G(RS),10))
"RTN","IBCRCC",59,0)
 S EVDT=$S(+$G(EVDT):EVDT,1:DT),IBEFDT=$P(IBRS0,U,5),IBINADT=$P(IBRS0,U,6)
"RTN","IBCRCC",60,0)
 I +IBEFDT>EVDT!(+IBINADT&(IBINADT<EVDT)) S IBX=0
"RTN","IBCRCC",61,0)
 I +IBX,IBRS10'="" S X=IBX X IBRS10 S IBX=X,IBRTY="^Rate Schedule Adjustment ("_$J(CHG,"",2)_")"
"RTN","IBCRCC",62,0)
 S FEE=$P($G(^IBE(363,+$G(RS),1)),"^",1,2)
"RTN","IBCRCC",63,0)
 Q IBX_IBRTY
"RTN","IBCRCC",64,0)
 ;
"RTN","IBCRCC",65,0)
RXCOST(RX) ; returns (RX=ptr 362.4): VA Cost of an Rx - Per Unit Cost ^ bill IFN
"RTN","IBCRCC",66,0)
 ; w/ Per Unit Cost = RX (Unit Price of Drug - 52,17) or Drug (Price Per Dispense Unit 50,16) cost
"RTN","IBCRCC",67,0)
 ;
"RTN","IBCRCC",68,0)
 N IBRXP,IBDGP,IBLN,IBX,IBIFN S (IBRXP,IBX)=0
"RTN","IBCRCC",69,0)
 I +$G(RX) S IBLN=$G(^IBA(362.4,+RX,0)),IBRXP=$P(IBLN,U,5),IBDGP=$P(IBLN,U,4),IBIFN=$P(IBLN,U,2)
"RTN","IBCRCC",70,0)
 I +IBRXP S IBX=$$FILE^IBRXUTL(IBRXP,17)_U_IBIFN
"RTN","IBCRCC",71,0)
 I 'IBRXP,+IBDGP D DATA^IBRXUTL(+IBDGP) S IBLN=$G(^TMP($J,"IBDRUG",0)) I IBLN'="" S IBX=$G(^TMP($J,"IBDRUG",+IBDGP,16))_U_IBIFN
"RTN","IBCRCC",72,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBCRCC",73,0)
 Q IBX
"RTN","IBCRCC",74,0)
 ;
"RTN","IBCRCC",75,0)
PRVCHG(CS,CHG,PRV,EVDT,ITEM) ; return discounted amount, based on total charge for a the care, the provider and Charge Set (BR)
"RTN","IBCRCC",76,0)
 ; if no discount record found for the Charge Set or the provider then returns original amount
"RTN","IBCRCC",77,0)
 ; no provider discount for Lab charges (80000-89999)
"RTN","IBCRCC",78,0)
 ;   discounted amount ^ comment (if discounted) ^ percent discount
"RTN","IBCRCC",79,0)
 ;
"RTN","IBCRCC",80,0)
 N IBPC,IBSGFN,IBSG,IBPDFN,IBPD0,IBPDTY,IBI,IBX,IBY S IBX=+$G(CHG),(IBSGFN,IBPDTY)="" I '$G(EVDT) S EVDT=DT
"RTN","IBCRCC",81,0)
 I +$G(ITEM),ITEM>79999,ITEM<90000 S (CS,PRV)=""
"RTN","IBCRCC",82,0)
 I +$G(CS) S IBSGFN=+$$CSSG^IBCRU6(+CS,"",2,.IBSG)
"RTN","IBCRCC",83,0)
 I +$G(PRV),+IBSGFN S IBPC=$$GET^XUA4A72(PRV,EVDT)
"RTN","IBCRCC",84,0)
 ;
"RTN","IBCRCC",85,0)
 S IBI=0 F  S IBI=$O(IBSG(IBI)) Q:'IBI  S IBSGFN=+IBSG(IBI) I +IBSGFN D
"RTN","IBCRCC",86,0)
 . S IBPDFN=0 F  S IBPDFN=$O(^IBE(363.34,"C",+IBSGFN,IBPDFN)) Q:'IBPDFN  D  Q:IBPDTY'=""
"RTN","IBCRCC",87,0)
 .. I '$O(^IBE(363.34,+IBPDFN,11,"B",+IBPC,0)) Q
"RTN","IBCRCC",88,0)
 .. S IBPD0=$G(^IBE(363.34,+IBPDFN,0)),IBY=$P(IBPD0,U,3) Q:IBY=""
"RTN","IBCRCC",89,0)
 .. S IBY=+IBY/100,IBX=IBY*IBX
"RTN","IBCRCC",90,0)
 .. S IBPDTY=U_$P($G(^VA(200,+PRV,0)),U,1)_" - "_$P(IBPD0,U,1)_" "_$P(IBPD0,U,3)_"% of "_$J(CHG,0,2)_U_+IBY
"RTN","IBCRCC",91,0)
 Q IBX_IBPDTY
"RTN","IBCRCC",92,0)
 ;
"RTN","IBCRCC",93,0)
MODCHG(CS,CHG,MODS) ; return adjusted amount due to RC modifier adjustment
"RTN","IBCRCC",94,0)
 ; straight adjustment for RC Physician charges by modifier, if no modifier adjustment returns original amount
"RTN","IBCRCC",95,0)
 ; Input:  Charge Set, Procedure Charge, Modifiers - list with modifier IEN's separated by ','
"RTN","IBCRCC",96,0)
 ; Output: discounted amount ^ comment (if discounted) ^ percent discount
"RTN","IBCRCC",97,0)
 ;
"RTN","IBCRCC",98,0)
 N IBCS0,IBBR0,IBMOD,IBMODS,IBMODE,IBDSCNT,IBPDTY,IBI,IBX,IBY
"RTN","IBCRCC",99,0)
 S CHG=+$G(CHG),MODS=$G(MODS),(IBBR0,IBPDTY,IBMODS)="",IBDSCNT=1,IBX=+CHG
"RTN","IBCRCC",100,0)
 I +$G(CS) S IBCS0=$G(^IBE(363.1,+CS,0)),IBBR0=$G(^IBE(363.3,+$P(IBCS0,U,2),0))
"RTN","IBCRCC",101,0)
 I $P(IBBR0,U,1)'["RC PHYSICIAN" S MODS="" ; professional charge only
"RTN","IBCRCC",102,0)
 I $P(IBBR0,U,4)'=2 S MODS="" ; CPT item only
"RTN","IBCRCC",103,0)
 I 'CHG S MODS=""
"RTN","IBCRCC",104,0)
 ;
"RTN","IBCRCC",105,0)
 I +MODS F IBI=1:1 S IBMOD=$P(MODS,",",IBI) Q:'IBMOD  S IBY=0 D
"RTN","IBCRCC",106,0)
 . I IBMOD=3 S IBMODE=22,IBY=1.2,IBX=IBX*IBY ; modifier 22 at 120% adjustment
"RTN","IBCRCC",107,0)
 . I IBMOD=10 S IBMODE=50,IBY=1.54,IBX=IBX*IBY ; modifier 50 at 154% adjustment
"RTN","IBCRCC",108,0)
 . I +IBY S IBMODS=IBMODS_$S(IBMODS="":"",1:",")_IBMODE,IBDSCNT=IBDSCNT*IBY ; allow for multiple discounts
"RTN","IBCRCC",109,0)
 I IBMODS'="" S IBPDTY=U_"Modifier "_IBMODS_" Adjustment "_(IBDSCNT*100)_"% of "_$J(CHG,0,2)_U_+IBDSCNT
"RTN","IBCRCC",110,0)
 Q IBX_IBPDTY
"RTN","IBCRCC",111,0)
 ;
"RTN","IBCRCC",112,0)
HRUNIT(HRS) ; returns Hour Units based on the Hours passed in
"RTN","IBCRCC",113,0)
 ; Hour Units are the hours rounded to the nearest whole hour (less than 30 minutes is 0 units)
"RTN","IBCRCC",114,0)
 N IBX S IBX=0 I +$G(HRS) S IBX=$J(HRS,0,0)
"RTN","IBCRCC",115,0)
 Q IBX
"RTN","IBCRCC",116,0)
 ;
"RTN","IBCRCC",117,0)
MLUNIT(MLS) ; returns Miles Units based on the Miles passed in
"RTN","IBCRCC",118,0)
 ; Mile Units are the miles rounded to the nearest whole mile
"RTN","IBCRCC",119,0)
 N IBX S IBX=0 I +$G(MLS) S IBX=$J(MLS,0,0) I 'IBX S IBX=1
"RTN","IBCRCC",120,0)
 Q IBX
"RTN","IBCRCC",121,0)
 ;
"RTN","IBCRCC",122,0)
MNUNIT(MNS) ; return Minute Units based on the Minutes passed in
"RTN","IBCRCC",123,0)
 ; Minute Units are 15 minute intervals, rounded up after any minutes
"RTN","IBCRCC",124,0)
 N IBX S IBX=0 I +$G(MNS) S IBX=(MNS\15) S:+(MNS#15) IBX=IBX+1 I 'IBX S IBX=1
"RTN","IBCRCC",125,0)
 Q IBX
"RTN","IBCRER")
0^6^B20891309^n/a
"RTN","IBCRER",1,0)
IBCRER ;ALB/ARH - RATES: CM RC NATIONAL ENTER/EDIT OPTION ; 13-FEB-2007
"RTN","IBCRER",2,0)
 ;;2.0;INTEGRATED BILLING;**370**;21-MAR-94;Build 5
"RTN","IBCRER",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRER",4,0)
 ;
"RTN","IBCRER",5,0)
EN ; Enter/Edit Option: enter National Interim Reasonable Charges
"RTN","IBCRER",6,0)
 N IBI,IBX,IBXL,IBLN,IBEFF,IBTYPE S IBXL="",$P(IBXL,"-",80)=""
"RTN","IBCRER",7,0)
 ;
"RTN","IBCRER",8,0)
 W !,"Enter National Reasonable Charges:",!
"RTN","IBCRER",9,0)
 W !,"This option is used to enter the National Interim Reasonable Charges. "
"RTN","IBCRER",10,0)
 W !,"These non-site specific charges are provided when new CPT/HCPCS codes are"
"RTN","IBCRER",11,0)
 W !,"released as interim charges until the next full release of Reasonable Charges.",!
"RTN","IBCRER",12,0)
 W !,"Procedures and their charge data are entered then they will be added to the "
"RTN","IBCRER",13,0)
 W !,"appropriate charges sets for every division of Reasonable Charges defined "
"RTN","IBCRER",14,0)
 W !,"on your system.  Enter Professional Charges first.",!
"RTN","IBCRER",15,0)
 W !,"This option should ONLY be used to add the National Interim Reasonable Charges.",!
"RTN","IBCRER",16,0)
 ;
"RTN","IBCRER",17,0)
 F IBI=1:1 D  Q:IBLN<0  W !,IBXL,!
"RTN","IBCRER",18,0)
 . D CHGLN^IBCRER1(.IBEFF,.IBTYPE,.IBLN) Q:IBLN<1  W !
"RTN","IBCRER",19,0)
 . D DISPLN(IBLN) W !
"RTN","IBCRER",20,0)
 . I +$$ASKLN(IBLN) W ! D SAVELN(IBLN) W !
"RTN","IBCRER",21,0)
 ;
"RTN","IBCRER",22,0)
 Q
"RTN","IBCRER",23,0)
 ;
"RTN","IBCRER",24,0)
SAVELN(LN) ; Save charge to Charge Master (#363.2), identify Charge Set based on Type (I/P) and Indicators (I/S/O/F)
"RTN","IBCRER",25,0)
 ; freestanding sites will recieve any fs indicated charge as a professional charge regardless of charge type
"RTN","IBCRER",26,0)
 N IBTYP,IBBRTY,IBITM,IBEFF,IBMOD,IBCHGU,IBINCR,IBCHGI,IBINP,IBSNF,IBOPT,IBFS,IBCARE,IBCS,IBCS0,IBCSN,IBBR0,IBCNT
"RTN","IBCRER",27,0)
 ;
"RTN","IBCRER",28,0)
 S IBCNT=0 S IBTYP=$P($G(LN),U,4) I IBTYP="" W !,"Missing Charge Type, Not Saved" Q
"RTN","IBCRER",29,0)
 S IBBRTY=$S(IBTYP="I":"RC FACILITY",IBTYP="P":"RC PHYSICIAN",1:"") I IBBRTY="" W !,"Bad Bill Rate, Not Saved" Q
"RTN","IBCRER",30,0)
 ;
"RTN","IBCRER",31,0)
 S IBITM=+LN,IBEFF=+$P(LN,U,2),IBMOD=$P(LN,U,3),IBCHGU=+$P(LN,U,5),IBINCR=$P(LN,U,6),IBCHGI=$P(LN,U,7)
"RTN","IBCRER",32,0)
 S IBINP=+$P(LN,U,8),IBSNF=+$P(LN,U,9),IBOPT=+$P(LN,U,10),IBFS=+$P(LN,U,11)
"RTN","IBCRER",33,0)
 ;
"RTN","IBCRER",34,0)
 S IBCS=0 F  S IBCS=$O(^IBE(363.1,IBCS)) Q:'IBCS  D
"RTN","IBCRER",35,0)
 . S IBCS0=$G(^IBE(363.1,IBCS,0)),IBCSN=$P(IBCS0,U,1) I $E(IBCSN,1,3)'="RC-" Q
"RTN","IBCRER",36,0)
 . S IBCARE=$S(IBCSN["INPT ":"INP",IBCSN["SNF ":"SNF",IBCSN["OPT ":"OPT",IBCSN["FS ":"FS",1:"") Q:IBCARE=""
"RTN","IBCRER",37,0)
 . ;
"RTN","IBCRER",38,0)
 . S IBBR0=$G(^IBE(363.3,+$P(IBCS0,U,2),0))
"RTN","IBCRER",39,0)
 . I $P(IBBR0,U,1)'[IBBRTY,IBCARE'="FS" Q
"RTN","IBCRER",40,0)
 . I $P(IBBR0,U,4)'=2 Q
"RTN","IBCRER",41,0)
 . I IBINCR="PR",$P(IBBR0,U,5)'=1 Q
"RTN","IBCRER",42,0)
 . I IBINCR="ML",$P(IBBR0,U,5)'=4 Q
"RTN","IBCRER",43,0)
 . I IBINCR="MN",$P(IBBR0,U,5)'=5 Q
"RTN","IBCRER",44,0)
 . I IBINCR="HR",$P(IBBR0,U,5)'=6 Q
"RTN","IBCRER",45,0)
 . ;
"RTN","IBCRER",46,0)
 . I +IBFS,IBCARE="FS" D ADDCHG(IBCS,IBITM,IBEFF,IBCHGU,IBMOD,IBCHGI,LN) S IBCNT=IBCNT+1 Q
"RTN","IBCRER",47,0)
 . I +IBINP,IBCARE="INP" D ADDCHG(IBCS,IBITM,IBEFF,IBCHGU,IBMOD,IBCHGI,LN) S IBCNT=IBCNT+1 Q
"RTN","IBCRER",48,0)
 . I +IBSNF,IBCARE="SNF" D ADDCHG(IBCS,IBITM,IBEFF,IBCHGU,IBMOD,IBCHGI,LN) S IBCNT=IBCNT+1 Q
"RTN","IBCRER",49,0)
 . I +IBOPT,IBCARE="OPT" D ADDCHG(IBCS,IBITM,IBEFF,IBCHGU,IBMOD,IBCHGI,LN) S IBCNT=IBCNT+1 Q
"RTN","IBCRER",50,0)
 ;
"RTN","IBCRER",51,0)
 I 'IBCNT W !,"No Reasonable Charges set found for ",IBBRTY,$S(IBINCR="ML":" Ambulance",IBINCR="MN":" Anesthesia",IBINCR="HR":" Observation",1:""),", Charge Not Added."
"RTN","IBCRER",52,0)
 Q
"RTN","IBCRER",53,0)
 ;
"RTN","IBCRER",54,0)
ADDCHG(CS,ITM,EFF,CHG,MOD,CHGI,LN) ; Add charge to Charge Master
"RTN","IBCRER",55,0)
 N IBCI S CS=+$G(CS),ITM=+$G(ITM),EFF=+$G(EFF),CHG=+$G(CHG),MOD=$G(MOD),CHGI=$G(CHGI) Q:'CHG
"RTN","IBCRER",56,0)
 ;
"RTN","IBCRER",57,0)
 S IBCI=$$ITCHG^IBCRCI(CS,ITM,EFF,MOD)
"RTN","IBCRER",58,0)
 I +IBCI W !,"Active charge already exists ",$P($G(^IBE(363.1,CS,0)),U,1),", Charge Not Added." Q
"RTN","IBCRER",59,0)
 ;
"RTN","IBCRER",60,0)
 S IBCI=$$ADDCI^IBCREF(CS,ITM,EFF,CHG,,MOD,,CHGI)
"RTN","IBCRER",61,0)
 I +IBCI D DISPLN($P($G(LN),U,1,7)) W ?45,"added "_$P($G(^IBE(363.1,CS,0)),U,1)
"RTN","IBCRER",62,0)
 I 'IBCI D DISPLN($P($G(LN),U,1,7)) W ?45,"CHARGE NOT ADDED "_$P($G(^IBE(363.1,CS,0)),U,1)
"RTN","IBCRER",63,0)
 Q
"RTN","IBCRER",64,0)
 ;
"RTN","IBCRER",65,0)
ASKLN(LN) ; Ask user if charge should be saved
"RTN","IBCRER",66,0)
 ; Returns: 1 for save, 0 for no or invalid
"RTN","IBCRER",67,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y S IBX=0
"RTN","IBCRER",68,0)
 I $G(LN)'="",$P(LN,U,8,11)'[1 W !,"No Sites Selected, Charge Not Added." Q 0
"RTN","IBCRER",69,0)
 S DIR("?")="Enter Yes to save the charge for all divisions, otherwise enter No."
"RTN","IBCRER",70,0)
 ;
"RTN","IBCRER",71,0)
 S DIR(0)="Y",DIR("A")="Save Charge for all Divisions",DIR("B")="No" D ^DIR I Y=1 S IBX=1
"RTN","IBCRER",72,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=0
"RTN","IBCRER",73,0)
 Q IBX
"RTN","IBCRER",74,0)
 ;
"RTN","IBCRER",75,0)
DISPLN(LN) ; Print charge line
"RTN","IBCRER",76,0)
 ; string 'cpt ifn^eff dt^mod ifn^type (I/P)^charge^incr type (PR/ML/HR/MN)^incr charge^inpt^snf^opt^free'
"RTN","IBCRER",77,0)
 Q:$G(LN)=""
"RTN","IBCRER",78,0)
 W !,$P($$CPT^ICPTCOD(+LN),U,2),$S(+$P(LN,U,3):"-"_$P($$MOD^ICPTMOD(+$P(LN,U,3),"I"),U,2),1:"")
"RTN","IBCRER",79,0)
 W ?11,$$DATE(+$P(LN,U,2)),?21,$S($P(LN,U,4)="I":"Inst",1:"Prof"),?27,$J(+$P(LN,U,5),8,2)
"RTN","IBCRER",80,0)
 W $S(+$P(LN,U,7):"+"_$J(+$P(LN,U,7),0,2),1:""),$S($P(LN,U,6)="PR":"",1:$$LOW^XLFSTR($P(LN,U,6)))
"RTN","IBCRER",81,0)
 W ?47,$S(+$P(LN,U,8):"Inpt ",1:""),$S(+$P(LN,U,9):"SNF ",1:""),$S(+$P(LN,U,10):"Opt ",1:""),$S(+$P(LN,U,11):"FreeSt ",1:"")
"RTN","IBCRER",82,0)
 Q
"RTN","IBCRER",83,0)
 ;
"RTN","IBCRER",84,0)
DATE(X) ; returns VA date in external form
"RTN","IBCRER",85,0)
 N Y S Y="" I $G(X)?7N.E S Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBCRER",86,0)
 Q Y
"RTN","IBCRER1")
0^8^B44995002^n/a
"RTN","IBCRER1",1,0)
IBCRER1 ;ALB/ARH - RATES: CM RC NATIONAL ENTER/EDIT OPTION (CONT) ; 13-FEB-2007
"RTN","IBCRER1",2,0)
 ;;2.0;INTEGRATED BILLING;**370**;21-MAR-94;Build 5
"RTN","IBCRER1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRER1",4,0)
 ;
"RTN","IBCRER1",5,0)
 ;
"RTN","IBCRER1",6,0)
CHGLN(IBEFF,IBTYP,IBLINE) ; get all user data for charge
"RTN","IBCRER1",7,0)
 ; Input:  pass by reference to get/retain defaults: Effective Date, Inst/Prof
"RTN","IBCRER1",8,0)
 ; Output: IBLINE if passed by reference
"RTN","IBCRER1",9,0)
 ; IBLINE = 'cpt ifn^eff dt^mod ifn^type (I/P)^charge^incr type (PR/ML/HR/MN)^incr charge^inpt^snf^opt^free'
"RTN","IBCRER1",10,0)
 ;          or null if no CPT, or -1 if invalid (exit)
"RTN","IBCRER1",11,0)
 N IBCPT,IBMOD,IBCHGU,IBINCR,IBCHGI,IBINP,IBSNF,IBOPT,IBFS S IBEFF=$G(IBEFF),IBTYP=$G(IBTYP),IBLINE=""
"RTN","IBCRER1",12,0)
 ;
"RTN","IBCRER1",13,0)
 S IBCPT=$$GETCPT(IBEFF) I IBCPT<1 S IBLINE=-1 Q  ; active cpt code
"RTN","IBCRER1",14,0)
 S IBEFF=$$GETEFF(IBEFF) Q:IBEFF<1  ; charge effective date
"RTN","IBCRER1",15,0)
 S IBMOD=$$GETMOD() Q:IBMOD<0  ; modifier for procedure charge
"RTN","IBCRER1",16,0)
 S IBTYP=$$GETTYP(IBTYP) Q:IBTYP<0  ; charge type, inst/prof
"RTN","IBCRER1",17,0)
 S IBCHGU=$$GETCHGU() Q:IBCHGU<0  W ! ; unit charge
"RTN","IBCRER1",18,0)
 ;
"RTN","IBCRER1",19,0)
 S IBINCR=$$GETINCR() Q:IBINCR<0  ; type of incremental charge
"RTN","IBCRER1",20,0)
 S IBCHGI=$$GETCHGI(IBINCR) Q:IBCHGI<0  W ! ; incremental charge
"RTN","IBCRER1",21,0)
 ;
"RTN","IBCRER1",22,0)
 S IBINP=$$GETIINP() Q:IBINP<0  ; inpatient indicator
"RTN","IBCRER1",23,0)
 S IBSNF=$$GETISNF() Q:IBSNF<0  ; snf indicator
"RTN","IBCRER1",24,0)
 S IBOPT=$$GETIOPT() Q:IBOPT<0  ; outpatient indictor
"RTN","IBCRER1",25,0)
 S IBFS=$$GETIFS() Q:IBFS<0  ; freestanding indicator
"RTN","IBCRER1",26,0)
 ;
"RTN","IBCRER1",27,0)
 S IBLINE=+IBCPT_U_+IBEFF_U_IBMOD_U_IBTYP_U_IBCHGU_U_IBINCR_U_IBCHGI_U_IBINP_U_IBSNF_U_IBOPT_U_IBFS
"RTN","IBCRER1",28,0)
 Q
"RTN","IBCRER1",29,0)
 ;
"RTN","IBCRER1",30,0)
GETCPT(EFFDT) ; Get CPT/HCPCS procedure associated with charge
"RTN","IBCRER1",31,0)
 ; Returns: IFN of CPT/HCPCS selected, -1 if invalid
"RTN","IBCRER1",32,0)
 N IBX,DIC,DIE,DA,DR,I,X,Y,DTOUT,DUOUT S IBX=-1
"RTN","IBCRER1",33,0)
 ;
"RTN","IBCRER1",34,0)
 S DIC("A")="Select PROCEDURE CPT/HCPCS: " I +$G(EFFDT) S DIC("S")="I $$CPTACT^IBACSV(+Y,EFFDT)"
"RTN","IBCRER1",35,0)
 S DIC="^ICPT(",DIC(0)="AEMNQ" D ^DIC K DIC I +Y>0 S IBX=+Y
"RTN","IBCRER1",36,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",37,0)
 Q IBX
"RTN","IBCRER1",38,0)
 ;
"RTN","IBCRER1",39,0)
GETEFF(DEFAULT) ; Get Effective Date for charge, must be within date range of current version
"RTN","IBCRER1",40,0)
 ; returns valid effective date, -1 if invalid
"RTN","IBCRER1",41,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y,IBY,IBI,IBZ,IBA,IBMIN S IBMIN="",IBA="",IBX=-1
"RTN","IBCRER1",42,0)
 S IBY=$$VERSALL^IBCRHBRV() F IBI=1:1 S IBZ=$P(IBY,U,IBI) Q:IBZ=""  S IBMIN=IBZ
"RTN","IBCRER1",43,0)
 S DIR("?",1)="Charge Effective Date must be within the date range of the current RC"
"RTN","IBCRER1",44,0)
 S DIR("?",2)="version, v"_+IBMIN_".  Date must be between "_$$DATE(+$P(IBMIN,";",2))_" and Today.",DIR("?",3)=""
"RTN","IBCRER1",45,0)
 S DIR("?")="Enter Effective Date of Charge."
"RTN","IBCRER1",46,0)
 ;
"RTN","IBCRER1",47,0)
 S DIR("A")="EFFECTIVE DATE" I +$G(DEFAULT)>0 S DIR("B")=$$DATE(DEFAULT),IBA="A",DIR("A")=DIR("A")_": "
"RTN","IBCRER1",48,0)
 S DIR(0)="D"_IBA_"^"_+$P(IBMIN,";",2)_":"_DT_":EX" D ^DIR K DIR I Y?7N S IBX=+Y
"RTN","IBCRER1",49,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",50,0)
 Q IBX
"RTN","IBCRER1",51,0)
 ;
"RTN","IBCRER1",52,0)
GETMOD() ; Get Modifier associated with the procedure charge
"RTN","IBCRER1",53,0)
 ; Modifier not limited to valid CPTs since that list is often out of date
"RTN","IBCRER1",54,0)
 ; Returns: IFN of selected modifier, null if no modifier selected, -1 if invalid
"RTN","IBCRER1",55,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y S IBX=""
"RTN","IBCRER1",56,0)
 S DIR("?",1)="Modifier is optional.  If a modifier is added then the charge will only"
"RTN","IBCRER1",57,0)
 S DIR("?",2)="be applied if the modifier is assigned to the procedure on the bill.",DIR("?",3)=""
"RTN","IBCRER1",58,0)
 S DIR("?")="Enter the Modifier associated with the procedure charge."
"RTN","IBCRER1",59,0)
 ;
"RTN","IBCRER1",60,0)
 S DIR("A")="MODIFIER"
"RTN","IBCRER1",61,0)
 S DIR(0)="PO^DIC(81.3,:AEMQ" D ^DIR K DIR I Y>0 S IBX=+Y
"RTN","IBCRER1",62,0)
 I $D(DUOUT)!$D(DTOUT) S IBX=-1
"RTN","IBCRER1",63,0)
 Q IBX
"RTN","IBCRER1",64,0)
 ;
"RTN","IBCRER1",65,0)
GETTYP(DEFAULT) ; Get Charge Type: Institutional or Professional
"RTN","IBCRER1",66,0)
 ; Returns: I for Institutional, P for Professional, -1 if invalid
"RTN","IBCRER1",67,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y S IBX=-1
"RTN","IBCRER1",68,0)
 I $G(DEFAULT)'="" S DEFAULT=$S(DEFAULT="I":"Institutional",DEFAULT="P":"Professional",1:"")
"RTN","IBCRER1",69,0)
 S DIR("?")="Enter the type of charge, either Institutional or Professional."
"RTN","IBCRER1",70,0)
 ;
"RTN","IBCRER1",71,0)
 S DIR("A")="CHARGE TYPE" I $G(DEFAULT)'="" S DIR("B")=DEFAULT
"RTN","IBCRER1",72,0)
 S DIR(0)="SB^I:Institutional;P:Professional" D ^DIR S IBX=Y
"RTN","IBCRER1",73,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",74,0)
 Q IBX
"RTN","IBCRER1",75,0)
 ;
"RTN","IBCRER1",76,0)
GETCHGU() ; get procedures unit charge
"RTN","IBCRER1",77,0)
 ; Returns: dollar amount (non-zero), -1 if invalid
"RTN","IBCRER1",78,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y S IBX=-1
"RTN","IBCRER1",79,0)
 S DIR("?",1)="The dollar amount to be added to a bill for each of this procedure on the bill."
"RTN","IBCRER1",80,0)
 S DIR("?",2)="Enter an amount greater than zero and less than 99999, 2 decimal digits."
"RTN","IBCRER1",81,0)
 S DIR("?")="Enter the unit charge for Procedure to be used at all sites."
"RTN","IBCRER1",82,0)
 ;
"RTN","IBCRER1",83,0)
 S DIR("A")="UNIT CHARGE: "
"RTN","IBCRER1",84,0)
 S DIR(0)="NA^.001:99999:2" D ^DIR K DIR I +Y>0 S IBX=Y
"RTN","IBCRER1",85,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",86,0)
 Q IBX
"RTN","IBCRER1",87,0)
 ;
"RTN","IBCRER1",88,0)
GETINCR() ; get the type of charge, identifies Charge Method and incremental calculations
"RTN","IBCRER1",89,0)
 ; Returns: PR for standard, HR for observation, MN for anesthesia, ML for ambulance, -1 if invalid
"RTN","IBCRER1",90,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y S IBX=-1
"RTN","IBCRER1",91,0)
 S DIR("?",1)="Most charges are a standard charge per procedure.  There are three types of"
"RTN","IBCRER1",92,0)
 S DIR("?",2)="charges that require special calculations that add charge based on an "
"RTN","IBCRER1",93,0)
 S DIR("?",3)="increment of units:  Anesthesia, Observation, Ambulance."
"RTN","IBCRER1",94,0)
 S DIR("?")="Enter type of care that will identify the charge calculation."
"RTN","IBCRER1",95,0)
 ;
"RTN","IBCRER1",96,0)
 S DIR("A")="Standard, Observation, Anesthesia, or Ambulance",DIR("B")="Standard"
"RTN","IBCRER1",97,0)
 S DIR(0)="SB^PR:Standard;HR:Observation;MN:Anesthesia;ML:Ambulance" D ^DIR S IBX=Y
"RTN","IBCRER1",98,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",99,0)
 ;
"RTN","IBCRER1",100,0)
 Q IBX
"RTN","IBCRER1",101,0)
 ;
"RTN","IBCRER1",102,0)
GETCHGI(TYPE) ; if a special charge then get the incremental charge amount, anesthesia and observation only
"RTN","IBCRER1",103,0)
 ; Returns: dollar amount if applicable (non-zero), null if not applicable, -1 if invalid
"RTN","IBCRER1",104,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y,IBTYP S TYPE=$G(TYPE),IBX=-1
"RTN","IBCRER1",105,0)
 S IBTYP=$S(TYPE="MN":"Anesthesia",TYPE="HR":"Observation",1:"") I IBTYP="" S IBX=""
"RTN","IBCRER1",106,0)
 S DIR("?",1)="Anesthesia and Observation have a unit charge added to a base/incremental"
"RTN","IBCRER1",107,0)
 S DIR("?",2)="charge that is multiplied by the time associated with the procedure."
"RTN","IBCRER1",108,0)
 S DIR("?",3)="Enter an amount greater than zero and less than 99999, 2 decimal digits.",DIR("?",4)=""
"RTN","IBCRER1",109,0)
 S DIR("?")="Enter the base or incremental "_IBTYP_" charge for this procedure."
"RTN","IBCRER1",110,0)
 ;
"RTN","IBCRER1",111,0)
 S DIR("A")=IBTYP_" BASE CHARGE: "
"RTN","IBCRER1",112,0)
 I IBTYP'="" S DIR(0)="NA^.001:99999:2" D ^DIR K DIR I +Y>0 S IBX=Y
"RTN","IBCRER1",113,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",114,0)
 Q IBX
"RTN","IBCRER1",115,0)
 ;
"RTN","IBCRER1",116,0)
GETIINP() ; Get Inpatient Indicator, is this charge billable for Inpatient care
"RTN","IBCRER1",117,0)
 ; Returns: 1 for Yes Billable for Inpatient care, 0 for not billable, -1 if invalid
"RTN","IBCRER1",118,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y S IBX=0
"RTN","IBCRER1",119,0)
 S DIR("?")="Enter Yes if this charge is billable for Inpatient care, No otherwise."
"RTN","IBCRER1",120,0)
 ;
"RTN","IBCRER1",121,0)
 S DIR(0)="Y",DIR("A")="INPATIENT",DIR("B")="No" D ^DIR I Y=1 S IBX=1
"RTN","IBCRER1",122,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",123,0)
 Q IBX
"RTN","IBCRER1",124,0)
 ;
"RTN","IBCRER1",125,0)
GETISNF() ; Get SNF Indicator, is this charge billable for Skilled Nursing care
"RTN","IBCRER1",126,0)
 ; Returns: 1 for Yes Billable for SNF care, 0 for not billable, -1 if invalid
"RTN","IBCRER1",127,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y S IBX=0
"RTN","IBCRER1",128,0)
 S DIR("?")="Enter Yes if this charge is billable for SNF care, No otherwise."
"RTN","IBCRER1",129,0)
 ;
"RTN","IBCRER1",130,0)
 S DIR(0)="Y",DIR("A")="SKILLED NURSING",DIR("B")="Yes" D ^DIR I Y=1 S IBX=1
"RTN","IBCRER1",131,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",132,0)
 Q IBX
"RTN","IBCRER1",133,0)
 ;
"RTN","IBCRER1",134,0)
GETIOPT() ; Get Outpatient Indicator, is this charge billable for Outpatient care
"RTN","IBCRER1",135,0)
 ; Returns: 1 for Yes Billable for outpatient care, 0 for not billable, -1 if invalid
"RTN","IBCRER1",136,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y S IBX=0
"RTN","IBCRER1",137,0)
 S DIR("?")="Enter Yes if this charge is billable for Outpatient care, No otherwise."
"RTN","IBCRER1",138,0)
 ;
"RTN","IBCRER1",139,0)
 S DIR(0)="Y",DIR("A")="OUTPATIENT",DIR("B")="Yes" D ^DIR I Y=1 S IBX=1
"RTN","IBCRER1",140,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",141,0)
 Q IBX
"RTN","IBCRER1",142,0)
 ;
"RTN","IBCRER1",143,0)
GETIFS() ; Get Freestanding Indicator, is this charge billable at Freestanding Sites
"RTN","IBCRER1",144,0)
 ; Returns: 1 for Yes Billable at Non-Provider Based/Freestanding sites, 0 for not billable, -1 if invalid
"RTN","IBCRER1",145,0)
 N IBX,DIR,DUOUT,DTOUT,DIRUT,X,Y S IBX=0
"RTN","IBCRER1",146,0)
 S DIR("?",1)="All charges for Freestanding sites will be stored as Professional charges."
"RTN","IBCRER1",147,0)
 S DIR("?")="Enter Yes if this charge is billable at Freestanding Sites, No otherwise."
"RTN","IBCRER1",148,0)
 ;
"RTN","IBCRER1",149,0)
 S DIR(0)="Y",DIR("A")="FREESTANDING",DIR("B")="Yes" D ^DIR I Y=1 S IBX=1
"RTN","IBCRER1",150,0)
 I $D(DTOUT)!$D(DUOUT) S IBX=-1
"RTN","IBCRER1",151,0)
 Q IBX
"RTN","IBCRER1",152,0)
 ;
"RTN","IBCRER1",153,0)
DATE(X) ; returns VA date in external form
"RTN","IBCRER1",154,0)
 N Y S Y="" I $G(X)?7N.E S Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBCRER1",155,0)
 Q Y
"RTN","IBYPSK")
0^7^B6669891^n/a
"RTN","IBYPSK",1,0)
IBYPSK ;ALB/ARH - IB*2.0*370 POST INIT: RC V3.0 DELETE PROVIDER DISCOUNTS ; 01-FEB-2007
"RTN","IBYPSK",2,0)
 ;;2.0;INTEGRATED BILLING;**370**;21-MAR-94;Build 5
"RTN","IBYPSK",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBYPSK",4,0)
 ;
"RTN","IBYPSK",5,0)
 ;
"RTN","IBYPSK",6,0)
 Q
"RTN","IBYPSK",7,0)
 ;
"RTN","IBYPSK",8,0)
POST ;
"RTN","IBYPSK",9,0)
 N IBA
"RTN","IBYPSK",10,0)
 S IBA(1)="",IBA(2)="    Reasonable Charges v3.0 Post-Install .....",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPSK",11,0)
 ;
"RTN","IBYPSK",12,0)
 D PDDEL ; delete all RC Provider Discounts, except Zero Charge
"RTN","IBYPSK",13,0)
 ;
"RTN","IBYPSK",14,0)
 S IBA(1)="",IBA(2)="    Reasonable Charges v3.0 Post-Install Complete",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPSK",15,0)
 ;
"RTN","IBYPSK",16,0)
 Q
"RTN","IBYPSK",17,0)
 ;
"RTN","IBYPSK",18,0)
 ;
"RTN","IBYPSK",19,0)
PDDEL ; delete all RC Provider Discounts (except Zero Charge)
"RTN","IBYPSK",20,0)
 N IBA,IBC,IBSG,IBCNT,IBPD0,IBPDFN,DA,DIK,DIC,DIE,X,Y S IBCNT=0
"RTN","IBYPSK",21,0)
 S IBC="Delete Reasonable Charges Provider Discounts:" D MSG(IBC)
"RTN","IBYPSK",22,0)
 ;
"RTN","IBYPSK",23,0)
 S IBSG=$O(^IBE(363.32,"B","RC PROVIDER DISCOUNTS",0))
"RTN","IBYPSK",24,0)
 I 'IBSG S IBC="** Error, Discounts Not Deleted: Special Group Not Found, Contact Support" D MSG(IBC) G PDDELQ
"RTN","IBYPSK",25,0)
 ;
"RTN","IBYPSK",26,0)
 S IBPDFN=0 F  S IBPDFN=$O(^IBE(363.34,IBPDFN)) Q:'IBPDFN  D
"RTN","IBYPSK",27,0)
 . S IBPD0=$G(^IBE(363.34,IBPDFN,0))
"RTN","IBYPSK",28,0)
 . ;
"RTN","IBYPSK",29,0)
 . I +$P(IBPD0,U,2)'=IBSG Q
"RTN","IBYPSK",30,0)
 . I $P(IBPD0,U,1)="ZERO CHARGE" Q
"RTN","IBYPSK",31,0)
 . ;
"RTN","IBYPSK",32,0)
 . S DA=IBPDFN,DIK="^IBE(363.34," D ^DIK K DIK,DA S IBCNT=IBCNT+1
"RTN","IBYPSK",33,0)
 . ;
"RTN","IBYPSK",34,0)
 . S IBC=">> Discount Deleted: "_$P(IBPD0,U,1) D MSG(IBC)
"RTN","IBYPSK",35,0)
 ;
"RTN","IBYPSK",36,0)
PDDELQ S IBC=IBCNT_" Provider Discount Groups Deleted (#363.34)" D MSG(IBC)
"RTN","IBYPSK",37,0)
 D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPSK",38,0)
 ;
"RTN","IBYPSK",39,0)
 S IBC=0,IBPD0="" F  S IBPD0=$O(^IBE(363.34,"B",IBPD0)) Q:IBPD0=""  I IBPD0'="ZERO CHARGE" S IBC=1
"RTN","IBYPSK",40,0)
 I +IBC S IBA(1)="",IBA(2)="    ** Provider Discount Groups still exist, Contact Support." D MES^XPDUTL(.IBA)
"RTN","IBYPSK",41,0)
 Q
"RTN","IBYPSK",42,0)
 ;
"RTN","IBYPSK",43,0)
 ;
"RTN","IBYPSK",44,0)
 ;
"RTN","IBYPSK",45,0)
MCCRUTL(X,P) ; returns IFN of item in 399.1 if Name is found and piece P is true
"RTN","IBYPSK",46,0)
 N IBX,IBY S IBY=""
"RTN","IBYPSK",47,0)
 I $G(X)'="" S IBX=0 F  S IBX=$O(^DGCR(399.1,"B",X,IBX)) Q:'IBX  I $P($G(^DGCR(399.1,IBX,0)),U,+$G(P)) S IBY=IBX
"RTN","IBYPSK",48,0)
 Q IBY
"RTN","IBYPSK",49,0)
 ;
"RTN","IBYPSK",50,0)
MSG(X) ;
"RTN","IBYPSK",51,0)
 N IBX S IBX=+$O(IBA(999999),-1) S IBX=IBX+1
"RTN","IBYPSK",52,0)
 S IBA(IBX)="    "_$G(X)
"RTN","IBYPSK",53,0)
 Q
"VER")
8.0^22.0
"BLD",6452,6)
^358
**END**
**END**
