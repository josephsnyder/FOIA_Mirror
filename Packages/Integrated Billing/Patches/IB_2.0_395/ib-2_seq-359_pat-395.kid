Released IB*2*395 SEQ #359
Extracted from mail message
**KIDS**:IB*2.0*395^

**INSTALL NAME**
IB*2.0*395
"BLD",7560,0)
IB*2.0*395^INTEGRATED BILLING^0^3080130^y
"BLD",7560,1,0)
^^1^1^3080130^
"BLD",7560,1,1,0)
PHARMACY NPI FIX (REPLACES IB*2*388)
"BLD",7560,4,0)
^9.64PA^^
"BLD",7560,6.3)
3
"BLD",7560,"INIT")
POST^IB20P395
"BLD",7560,"KRN",0)
^9.67PA^8989.52^19
"BLD",7560,"KRN",.4,0)
.4
"BLD",7560,"KRN",.401,0)
.401
"BLD",7560,"KRN",.402,0)
.402
"BLD",7560,"KRN",.403,0)
.403
"BLD",7560,"KRN",.5,0)
.5
"BLD",7560,"KRN",.84,0)
.84
"BLD",7560,"KRN",3.6,0)
3.6
"BLD",7560,"KRN",3.8,0)
3.8
"BLD",7560,"KRN",9.2,0)
9.2
"BLD",7560,"KRN",9.8,0)
9.8
"BLD",7560,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",7560,"KRN",9.8,"NM",1,0)
IBCBB1^^0^B67930710
"BLD",7560,"KRN",9.8,"NM",2,0)
IBCBB11^^0^B19890435
"BLD",7560,"KRN",9.8,"NM",3,0)
IBCEF73A^^0^B31578985
"BLD",7560,"KRN",9.8,"NM",4,0)
IBCEF74A^^0^B20383624
"BLD",7560,"KRN",9.8,"NM",5,0)
IBCSCH^^0^B63443719
"BLD",7560,"KRN",9.8,"NM",6,0)
IBCSCH1^^0^B30182718
"BLD",7560,"KRN",9.8,"NM",7,0)
IB20P395^^0^B11117397
"BLD",7560,"KRN",9.8,"NM","B","IB20P395",7)

"BLD",7560,"KRN",9.8,"NM","B","IBCBB1",1)

"BLD",7560,"KRN",9.8,"NM","B","IBCBB11",2)

"BLD",7560,"KRN",9.8,"NM","B","IBCEF73A",3)

"BLD",7560,"KRN",9.8,"NM","B","IBCEF74A",4)

"BLD",7560,"KRN",9.8,"NM","B","IBCSCH",5)

"BLD",7560,"KRN",9.8,"NM","B","IBCSCH1",6)

"BLD",7560,"KRN",19,0)
19
"BLD",7560,"KRN",19.1,0)
19.1
"BLD",7560,"KRN",101,0)
101
"BLD",7560,"KRN",409.61,0)
409.61
"BLD",7560,"KRN",771,0)
771
"BLD",7560,"KRN",870,0)
870
"BLD",7560,"KRN",8989.51,0)
8989.51
"BLD",7560,"KRN",8989.52,0)
8989.52
"BLD",7560,"KRN",8994,0)
8994
"BLD",7560,"KRN","B",.4,.4)

"BLD",7560,"KRN","B",.401,.401)

"BLD",7560,"KRN","B",.402,.402)

"BLD",7560,"KRN","B",.403,.403)

"BLD",7560,"KRN","B",.5,.5)

"BLD",7560,"KRN","B",.84,.84)

"BLD",7560,"KRN","B",3.6,3.6)

"BLD",7560,"KRN","B",3.8,3.8)

"BLD",7560,"KRN","B",9.2,9.2)

"BLD",7560,"KRN","B",9.8,9.8)

"BLD",7560,"KRN","B",19,19)

"BLD",7560,"KRN","B",19.1,19.1)

"BLD",7560,"KRN","B",101,101)

"BLD",7560,"KRN","B",409.61,409.61)

"BLD",7560,"KRN","B",771,771)

"BLD",7560,"KRN","B",870,870)

"BLD",7560,"KRN","B",8989.51,8989.51)

"BLD",7560,"KRN","B",8989.52,8989.52)

"BLD",7560,"KRN","B",8994,8994)

"BLD",7560,"QUES",0)
^9.62^^
"BLD",7560,"REQB",0)
^9.611^4^3
"BLD",7560,"REQB",2,0)
IB*2.0*371^2
"BLD",7560,"REQB",3,0)
PSO*7.0*273^2
"BLD",7560,"REQB",4,0)
IB*2.0*266^2
"BLD",7560,"REQB","B","IB*2.0*266",4)

"BLD",7560,"REQB","B","IB*2.0*371",2)

"BLD",7560,"REQB","B","PSO*7.0*273",3)

"INIT")
POST^IB20P395
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
395^3080130
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3080130
"PKG",200,22,1,"PAH",1,1,1,0)
PHARMACY NPI FIX (REPLACES IB*2*388)
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","IB20P395")
0^7^B11117397^n/a
"RTN","IB20P395",1,0)
IB20P395 ;OAK/ELZ - POST INIT ROUTINE FOR IB*2*395 ;1/30/2008
"RTN","IB20P395",2,0)
 ;;2.0;INTEGRATED BILLING;**395**;21-MAR-94;Build 3
"RTN","IB20P395",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IB20P395",4,0)
 ;
"RTN","IB20P395",5,0)
 ;
"RTN","IB20P395",6,0)
POST ; Post init to edit 364.7 and update the Format Code
"RTN","IB20P395",7,0)
 ;
"RTN","IB20P395",8,0)
 N IBL,IBM,IBX,IB353,IB3646,IB3645,IB3647
"RTN","IB20P395",9,0)
 ;
"RTN","IB20P395",10,0)
 S IBL=0 D M(""),M("  IB*2*395 Post-Install Starting ....."),M(""),MES^XPDUTL(.IBM) K IBM S IBL=0
"RTN","IB20P395",11,0)
 ;
"RTN","IB20P395",12,0)
 ; ^IBE(353,"B","CMS-1500",0)
"RTN","IB20P395",13,0)
 ;        BILL FORM: CMS-1500
"RTN","IB20P395",14,0)
 ;        NATIONAL FORM: YES
"RTN","IB20P395",15,0)
 S IBX=0 F  S IBX=$O(^IBE(353,"B","CMS-1500",IBX)) Q:'IBX  I $P($G(^IBE(353,IBX,2)),"^",4) S IB353=IBX Q
"RTN","IB20P395",16,0)
 I '$G(IB353) D M(""),M("          ***** Post-Install ERROR *****"),M("  -Cannot find National CMS-1500 form in file 353!!!"),M(""),MES^XPDUTL(.IBM) Q
"RTN","IB20P395",17,0)
 ;
"RTN","IB20P395",18,0)
 ;
"RTN","IB20P395",19,0)
 ; ^IBA(364.6,"C","SERVICE FAC NPI (BX-32A)",0)
"RTN","IB20P395",20,0)
 ;        BILL FORM: CMS-1500
"RTN","IB20P395",21,0)
 ;        SECURITY LEVEL: NATIONAL,NO EDIT
"RTN","IB20P395",22,0)
 S IBX=0 F  S IBX=$O(^IBA(364.6,"C","SERVICE FAC NPI (BX-32A)",IBX)) Q:'IBX  I $P($G(^IBA(364.6,IBX,0)),"^",1,2)=(IB353_"^N") S IB3646=IBX Q
"RTN","IB20P395",23,0)
 I '$G(IB3646) D M(""),M("          ***** Post-Install ERROR *****"),M("  -Cannot find National SERVICE FAC NPI (BX-32A) in file 364.6!!!"),M(""),MES^XPDUTL(.IBM) Q
"RTN","IB20P395",24,0)
 ;
"RTN","IB20P395",25,0)
 ;
"RTN","IB20P395",26,0)
 ; ^IBA(364.5,"B","N-RENDERING INSTITUTION",0)
"RTN","IB20P395",27,0)
 ;        SECURITY LEVEL: NATIONAL,NO EDIT
"RTN","IB20P395",28,0)
 S IBX=0 F  S IBX=$O(^IBA(364.5,"B","N-RENDERING INSTITUTION",IBX)) Q:'IBX  I $P($G(^IBA(364.5,IBX,0)),"^",2)="N" S IB3645=IBX Q
"RTN","IB20P395",29,0)
 I '$G(IB3645) D M(""),M("          ***** Post-Install ERROR *****"),M("  -Cannot find National N-RENDERING INSTITUTION in file 364.5!!!"),M(""),MES^XPDUTL(.IBM) Q
"RTN","IB20P395",30,0)
 ;
"RTN","IB20P395",31,0)
 ;
"RTN","IB20P395",32,0)
 ; ^IBA(364.7,"B",364.6 entry
"RTN","IB20P395",33,0)
 ;        SECURITY LEVEL: NATIONAL,NO EDIT
"RTN","IB20P395",34,0)
 ;        DATA ELEMENT: N-RENDERING INSTITUTION
"RTN","IB20P395",35,0)
 S IBX=0 F  S IBX=$O(^IBA(364.7,"B",IB3646,IBX)) Q:'IBX  I $P($G(^IBA(364.7,IBX,0)),"^",2,3)=("N^"_IB3645) S IB3647=IBX Q
"RTN","IB20P395",36,0)
 I '$G(IB3647) D M(""),M("          ***** Post-Install ERROR *****"),M("  -Cannot find National SERVICE FAC NPI (BX-32A) in file 364.7!!!"),M(""),MES^XPDUTL(.IBM) Q
"RTN","IB20P395",37,0)
 ;
"RTN","IB20P395",38,0)
 ; set in format code
"RTN","IB20P395",39,0)
 S ^IBA(364.7,IB3647,1)=$P($T(CODE+1),";",3,99)
"RTN","IB20P395",40,0)
 ;
"RTN","IB20P395",41,0)
 ;
"RTN","IB20P395",42,0)
 D M("  Format code updated in 364.7 for National SERVICE FAC NPI (BX-32A)"),M(" ")
"RTN","IB20P395",43,0)
 D MES^XPDUTL(.IBM) K IBM S IBL=0
"RTN","IB20P395",44,0)
 ;
"RTN","IB20P395",45,0)
 D M("  IB*2*395 Post-Install Done .....")
"RTN","IB20P395",46,0)
 D MES^XPDUTL(.IBM)
"RTN","IB20P395",47,0)
 ;
"RTN","IB20P395",48,0)
 Q
"RTN","IB20P395",49,0)
 ;
"RTN","IB20P395",50,0)
M(Y) ; sets up messages
"RTN","IB20P395",51,0)
 ; Y = text to set up
"RTN","IB20P395",52,0)
 S IBL=IBL+1,IBM(IBL)=Y
"RTN","IB20P395",53,0)
 Q
"RTN","IB20P395",54,0)
 ;
"RTN","IB20P395",55,0)
CODE ; new format code for 364.7 entry
"RTN","IB20P395",56,0)
 ;;N IBZ,IBZ1 S IBZ=$P(IBXDATA,U,2),IBZ1="" D F^IBCEF("N-ORGANIZATION NPI CODES","IBZ1",,IBXIEN) S IBXDATA=$S($$ISRX^IBCEF1(IBXIEN):$P(IBZ1,U,3),IBZ=1:$P(IBZ1,U,2),IBZ=0:$P(IBZ1,U),1:$P(IBZ1,U,3)),IBXSAVE("NPISVC")=IBXDATA
"RTN","IB20P395",57,0)
 ;;
"RTN","IBCBB1")
0^1^B67930710^B66788213
"RTN","IBCBB1",1,0)
IBCBB1 ;ALB/AAS - CONTINUATION OF EDIT CHECK ROUTINE ;2-NOV-89
"RTN","IBCBB1",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,80,93,106,51,151,148,153,137,232,280,155,320,343,349,363,371,395**;21-MAR-94;Build 3
"RTN","IBCBB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB1",4,0)
 ;
"RTN","IBCBB1",5,0)
 ;MAP TO DGCRBB1
"RTN","IBCBB1",6,0)
 ;
"RTN","IBCBB1",7,0)
% ;Bill Status
"RTN","IBCBB1",8,0)
 N Z,Z0,Z1
"RTN","IBCBB1",9,0)
 I $S(+IBST=0:1,1:"^1^2^3^4^7^"'[(U_IBST_U)) S IBER=IBER_"IB045;"
"RTN","IBCBB1",10,0)
 ;
"RTN","IBCBB1",11,0)
 ;Statement Covers From
"RTN","IBCBB1",12,0)
 I IBFDT="" S IBER=IBER_"IB061;"
"RTN","IBCBB1",13,0)
 I IBFDT]"",IBFDT'?7N&(IBFDT'?7N1".".N) S IBER=IBER_"IB061;"
"RTN","IBCBB1",14,0)
 I IBFDT>IBTDT S IBER=IBER_"IB061;" ; from must be on or before the to date 
"RTN","IBCBB1",15,0)
 S IBFFY=$$FY^IBOUTL(IBFDT)
"RTN","IBCBB1",16,0)
 ; if inpat - from date must not be prior to admit date.
"RTN","IBCBB1",17,0)
 I $$INPAT^IBCEF(IBIFN,1),(IBFDT<($P($G(^DGPT(+$P(IBND0,U,8),0)),U,2)\1))  S IBER=IBER_"IB061;"
"RTN","IBCBB1",18,0)
 ;
"RTN","IBCBB1",19,0)
 ;Statement Covers To
"RTN","IBCBB1",20,0)
 I IBTDT="" S IBER=IBER_"IB062;"
"RTN","IBCBB1",21,0)
 I IBTDT]"",IBTDT'?7N&(IBTDT'?7N1".".N) S IBER=IBER_"IB062;"
"RTN","IBCBB1",22,0)
 I IBTDT>DT!(IBTDT<IBFDT) S IBER=IBER_"IB062;"  ; to date must not be >than today's date
"RTN","IBCBB1",23,0)
 S IBTFY=$$FY^IBOUTL(IBTDT)
"RTN","IBCBB1",24,0)
 ;
"RTN","IBCBB1",25,0)
 ;Total Charges
"RTN","IBCBB1",26,0)
 I +IBTC'>0!(+IBTC'=IBTC) S IBER=IBER_"IB064;"
"RTN","IBCBB1",27,0)
 ;
"RTN","IBCBB1",28,0)
 ;Billable charges for secondary claim
"RTN","IBCBB1",29,0)
 I $$MCRONBIL^IBEFUNC(IBIFN)&(($P(IBNDU1,U,1)-$P(IBNDU1,U,2))'>0) S IBER=IBER_"IB094;"
"RTN","IBCBB1",30,0)
 ;Fiscal Year 1
"RTN","IBCBB1",31,0)
 S IBFFY=$$FY^IBOUTL(IBFDT)
"RTN","IBCBB1",32,0)
 ;
"RTN","IBCBB1",33,0)
 ;Check provider link for current user, enterer, reviewer and Authorizor
"RTN","IBCBB1",34,0)
 I '$D(^VA(200,DUZ,0)) S IBER=IBER_"IB048;"
"RTN","IBCBB1",35,0)
 I IBEU]"",'$D(^VA(200,IBEU,0)) S IBER=IBER_"IB048;"
"RTN","IBCBB1",36,0)
 I IBRU]"",'$D(^VA(200,IBRU,0)) S IBER=IBER_"IB060;"
"RTN","IBCBB1",37,0)
 I IBAU]"",'$D(^VA(200,IBAU,0)) S IBER=IBER_"IB041;"
"RTN","IBCBB1",38,0)
 ;
"RTN","IBCBB1",39,0)
 I IBER="",+$$STA^PRCAFN(IBIFN)=104 S IBER=IBER_"IB040;"
"RTN","IBCBB1",40,0)
 ; If ins bill, must have valid COB sequence
"RTN","IBCBB1",41,0)
 I $P(IBND0,U,11)="i",$S($P(IBND0,U,21)="":1,1:"PST"'[$P(IBND0,U,21)) S IBER=IBER_"IB324;"
"RTN","IBCBB1",42,0)
 ;
"RTN","IBCBB1",43,0)
 ; Check for valid sec provider id for current ins
"RTN","IBCBB1",44,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"PRV",Z)) Q:'Z  S Z0=$G(^(Z,0)),Z1=+$$COBN^IBCEF(IBIFN) I $P(Z0,U,4+Z1)'="",$P(Z0,U,11+Z1)'="" D
"RTN","IBCBB1",45,0)
 . I '$$SECIDCK^IBCEF74(IBIFN,Z1,$P(Z0,U,11+Z1),Z) D WARN^IBCBB11("Prov secondary id type for the "_$P("PRIMARY^SECONDARY^TERTIARY",U,Z1)_" "_$$EXTERNAL^DILFD(399.0222,.01,,+Z0)_" is invalid/won't transmit")
"RTN","IBCBB1",46,0)
 ; Check NPIs
"RTN","IBCBB1",47,0)
 D NPICHK^IBCBB11
"RTN","IBCBB1",48,0)
 ;
"RTN","IBCBB1",49,0)
 ; Check multiple rx NPIs
"RTN","IBCBB1",50,0)
 D RXNPI^IBCBB11(IBIFN)
"RTN","IBCBB1",51,0)
 ;
"RTN","IBCBB1",52,0)
 ; Check taxonomies
"RTN","IBCBB1",53,0)
 D TAXCHK^IBCBB11
"RTN","IBCBB1",54,0)
 ;
"RTN","IBCBB1",55,0)
 ; Check for Physician Name
"RTN","IBCBB1",56,0)
 K IBXDATA D F^IBCEF("N-ATT/REND PHYSICIAN NAME",,,IBIFN)
"RTN","IBCBB1",57,0)
 I $P($G(IBXDATA),U)="" S IBER=IBER_"IB303;"
"RTN","IBCBB1",58,0)
 ;
"RTN","IBCBB1",59,0)
 N FUNCTION,IBINS
"RTN","IBCBB1",60,0)
 S FUNCTION=$S($$FT^IBCEF(IBIFN)=3:4,1:3)
"RTN","IBCBB1",61,0)
 I IBER'["IB303;" D
"RTN","IBCBB1",62,0)
 . F IBINS=1:1:3 D
"RTN","IBCBB1",63,0)
 .. S Z=$$GETTYP^IBCEP2A(IBIFN,IBINS)
"RTN","IBCBB1",64,0)
 .. I Z,$P(Z,U,2) D  ; Rendering/attending prov secondary id required
"RTN","IBCBB1",65,0)
 ... N IBID,IBOK,Q0
"RTN","IBCBB1",66,0)
 ... D PROVINF^IBCEF74(IBIFN,IBINS,.IBID,1,"C")  ; check all as though they were current
"RTN","IBCBB1",67,0)
 ... S IBOK=0
"RTN","IBCBB1",68,0)
 ... S Q0=0 F  S Q0=$O(IBID(1,FUNCTION,Q0)) Q:'Q0  I $P(IBID(1,FUNCTION,Q0),U,9)=+Z S IBOK=1 Q
"RTN","IBCBB1",69,0)
 ... I 'IBOK S IBER=IBER_$S(IBINS=1:"IB236;",IBINS=2:"IB237;",IBINS=3:"IB238;",1:"")
"RTN","IBCBB1",70,0)
 ;
"RTN","IBCBB1",71,0)
 D PRIIDCHK^IBCBB11
"RTN","IBCBB1",72,0)
 ;
"RTN","IBCBB1",73,0)
 N IBM,IBM1
"RTN","IBCBB1",74,0)
 S IBM=$G(^DGCR(399,IBIFN,"M"))
"RTN","IBCBB1",75,0)
 S IBM1=$G(^DGCR(399,IBIFN,"M1"))
"RTN","IBCBB1",76,0)
 I $P(IBM,U),$P($G(^DIC(36,$P(IBM,U),4)),U,6),$P(IBM1,U,2)="" S IBER=IBER_"IB244;"
"RTN","IBCBB1",77,0)
 I $P(IBM,U,2),$P($G(^DIC(36,$P(IBM,U,2),4)),U,6),$P(IBM1,U,3)="" S IBER=IBER_"IB245;"
"RTN","IBCBB1",78,0)
 I $P(IBM,U,3),$P($G(^DIC(36,$P(IBM,U,3),4)),U,6),$P(IBM1,U,4)="" S IBER=IBER_"IB246;"
"RTN","IBCBB1",79,0)
 ;
"RTN","IBCBB1",80,0)
 ; If outside facility, check for ID and qualifier in 355.93
"RTN","IBCBB1",81,0)
 ; 5/15/06 - esg - hard error IB243 turned into warning message instead
"RTN","IBCBB1",82,0)
 S Z=$P($G(^DGCR(399,IBIFN,"U2")),U,10)
"RTN","IBCBB1",83,0)
 I Z D
"RTN","IBCBB1",84,0)
 . I $P($G(^IBA(355.93,Z,0)),U,9)=""!($P($G(^IBA(355.93,Z,0)),U,13)="") D
"RTN","IBCBB1",85,0)
 .. N Z1,Z2
"RTN","IBCBB1",86,0)
 .. S Z1="Missing Lab or Facility Primary ID for non-VA facility, "
"RTN","IBCBB1",87,0)
 .. S Z2=$$EXTERNAL^DILFD(399,232,,Z)
"RTN","IBCBB1",88,0)
 .. I $L(Z2)'>19 D WARN^IBCBB11(Z1_Z2) Q
"RTN","IBCBB1",89,0)
 .. D WARN^IBCBB11(Z1),WARN^IBCBB11("     "_Z2)
"RTN","IBCBB1",90,0)
 .. Q
"RTN","IBCBB1",91,0)
 . Q
"RTN","IBCBB1",92,0)
 ;
"RTN","IBCBB1",93,0)
 ; Must be one and only one division on bill
"RTN","IBCBB1",94,0)
 S IBZ=$$MULTDIV^IBCBB11(IBIFN,IBND0)
"RTN","IBCBB1",95,0)
 I IBZ S IBER=IBER_$S(IBZ=1:"IB095;",IBZ=2:"IB104;",1:"IB105;")
"RTN","IBCBB1",96,0)
 ; Division address must be defined in institution file
"RTN","IBCBB1",97,0)
 I $P(IBND0,U,22) D
"RTN","IBCBB1",98,0)
 . N Z,Z0,Z1
"RTN","IBCBB1",99,0)
 . S Z0=$G(^DIC(4,+$P($G(^DG(40.8,+$P(IBND0,U,22),0)),U,7),0))
"RTN","IBCBB1",100,0)
 . S Z1=$G(^DIC(4,+$P($G(^DG(40.8,+$P(IBND0,U,22),0)),U,7),1))
"RTN","IBCBB1",101,0)
 . I $P(Z0,U,2)="" S IBER=IBER_"IB097;" Q
"RTN","IBCBB1",102,0)
 . F Z=1,3,4 I $P(Z1,U,Z)="" S IBER=IBER_"IB097;" Q
"RTN","IBCBB1",103,0)
 ;
"RTN","IBCBB1",104,0)
 ;CHAMPVA Rate Type and Primary Insurance Carriers Type of Coverage must match
"RTN","IBCBB1",105,0)
 S (IBRTCHV,IBPICHV)=0
"RTN","IBCBB1",106,0)
 I $P($G(^DGCR(399.3,+IBAT,0)),U,1)="CHAMPVA" S IBRTCHV=1
"RTN","IBCBB1",107,0)
 I $P($G(^IBE(355.2,+$P($G(^DIC(36,+IBNDMP,0)),U,13),0)),U,1)="CHAMPVA" S IBPICHV=1
"RTN","IBCBB1",108,0)
 I (+IBRTCHV!+IBPICHV)&('IBRTCHV!'IBPICHV) S IBER=IBER_"IB085;"
"RTN","IBCBB1",109,0)
 ;
"RTN","IBCBB1",110,0)
 N IBZPRC,IBZPRCUB
"RTN","IBCBB1",111,0)
 D F^IBCEF("N-ALL PROCEDURES","IBZPRC",,IBIFN)
"RTN","IBCBB1",112,0)
 ; Procedure Clinic is required for Surgical Procedures Outpt Facility Charges
"RTN","IBCBB1",113,0)
 I +$P(IBND0,U,27)'=2,$$BILLRATE^IBCRU3(IBAT,IBCL,IBEVDT,"RC OUTPATIENT") D
"RTN","IBCBB1",114,0)
 . N Z,Z0,Z1,ZE S (ZE,Z)=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  D  I +ZE S IBER=IBER_"IB320;" Q
"RTN","IBCBB1",115,0)
 .. S Z0=$G(^DGCR(399,IBIFN,"CP",Z,0)),Z1=+Z0 I Z0'[";ICPT(" Q
"RTN","IBCBB1",116,0)
 .. I '((Z1'<10000)&(Z1'>69999))&'((Z1'<93501)&(Z1'>93533)) Q
"RTN","IBCBB1",117,0)
 .. I '$P(Z0,U,7) S ZE=1
"RTN","IBCBB1",118,0)
 ;
"RTN","IBCBB1",119,0)
 ; Extract procedures for UB-04
"RTN","IBCBB1",120,0)
 D F^IBCEF("N-UB-04 PROCEDURES","IBZPRCUB",,IBIFN)
"RTN","IBCBB1",121,0)
 ; Does this bill have ANY prescriptions associated with it?
"RTN","IBCBB1",122,0)
 ; Must bill prescriptions separately from other charges
"RTN","IBCBB1",123,0)
 ;
"RTN","IBCBB1",124,0)
 I $$ISRX^IBCEF1(IBIFN) D
"RTN","IBCBB1",125,0)
 . N IBZ,IBRXDEF
"RTN","IBCBB1",126,0)
 . S IBRXDEF=$P($G(^IBE(350.9,1,1)),U,30),IBZ=0
"RTN","IBCBB1",127,0)
 . F  S IBZ=$O(IBZPRCUB(IBZ)) Q:'IBZ  I IBZPRCUB(IBZ),+$P(IBZPRCUB(IBZ),U)'=IBRXDEF S IBER=IBER_"IB102;" Q
"RTN","IBCBB1",128,0)
 . K IBZ
"RTN","IBCBB1",129,0)
 ;
"RTN","IBCBB1",130,0)
 ; Check that COB sequences are not skipped
"RTN","IBCBB1",131,0)
 K Z
"RTN","IBCBB1",132,0)
 F Z=1:1:3 S:+$G(^DGCR(399,IBIFN,"I"_Z)) Z(Z)=""
"RTN","IBCBB1",133,0)
 F Z=0:1:2 S Z0=$O(Z(Z)) Q:'Z0  I Z0'=(Z+1) S IBER=IBER_"IB322;" Q
"RTN","IBCBB1",134,0)
 K Z
"RTN","IBCBB1",135,0)
 ; HD64676  IB*2*371 - OK for payer sequence to be blank when the Rate
"RTN","IBCBB1",136,0)
 ;    Type is either Interagency or Sharing Agreement
"RTN","IBCBB1",137,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,21)="",$P($G(^DGCR(399,IBIFN,0)),U,7)'=4,$P($G(^DGCR(399,IBIFN,0)),U,7)'=9 S IBER=IBER_"IB323;"
"RTN","IBCBB1",138,0)
 K IBXDATA D F^IBCEF("N-PROCEDURE CODING METHD",,,IBIFN)
"RTN","IBCBB1",139,0)
 ; Coding method should agree with types of procedure codes
"RTN","IBCBB1",140,0)
 S IBOK=$S('$O(IBZPRC(0))!(IBXDATA=""):1,1:0)
"RTN","IBCBB1",141,0)
 I 'IBOK S IBOK=1,IBZ=0 F  S IBZ=$O(IBZPRC(IBZ)) Q:'IBZ  I IBZPRC(IBZ),$P(IBZPRC(IBZ),U)'[$S(IBXDATA=9:"ICD",1:"ICP") S IBOK=0 Q
"RTN","IBCBB1",142,0)
 I 'IBOK D WARN^IBCBB11("Coding Method does not agree with all procedure codes found on bill")
"RTN","IBCBB1",143,0)
 D EDITMRA^IBCBB3(.IBQUIT,.IBER,IBIFN,IBFT)
"RTN","IBCBB1",144,0)
 Q:$G(IBQUIT)
"RTN","IBCBB1",145,0)
 ;
"RTN","IBCBB1",146,0)
 ;Other things that could be added:  Rev Code - calculating charges
"RTN","IBCBB1",147,0)
 ;        Diagnosis Coding, if MT copay - check for other co-payments
"RTN","IBCBB1",148,0)
 ;
"RTN","IBCBB1",149,0)
 I $P(IBNDTX,U,8),$$REQMRA^IBEFUNC(IBIFN) S IBER=IBER_"IB121;"   ; can't force MRAs to print
"RTN","IBCBB1",150,0)
 I $P(IBNDTX,U,8)!$P(IBNDTX,U,9) D WARN^IBCBB11($S($$REQMRA^IBEFUNC(IBIFN)&($P(IBNDTX,U,9)):"MRA Secondary ",1:"")_"Bill has been forced to print "_$S($P(IBNDTX,U,8)=1!($P(IBNDTX,U,9)=1):"locally",1:"at clearinghouse"))
"RTN","IBCBB1",151,0)
 N IBXZ,IBIZ F IBIZ=12,13,14 S IBXZ=$P(IBNDM,U,IBIZ) I +IBXZ S IBXZ=$P($G(^DPT(DFN,.312,IBXZ,0)),U,18) I +IBXZ S IBXZ=$G(^IBA(355.3,+IBXZ,0)) I +$P(IBXZ,U,12) D
"RTN","IBCBB1",152,0)
 . D WARN^IBCBB11($P($G(^DIC(36,+IBXZ,0)),U,1)_" requires Amb Care Certification")
"RTN","IBCBB1",153,0)
 ;
"RTN","IBCBB1",154,0)
 D VALNDC^IBCBB11(IBIFN,DFN)  ;validate NDC#
"RTN","IBCBB1",155,0)
 ;
"RTN","IBCBB1",156,0)
 ;Build AR array if no errors and MRA not needed or already rec'd
"RTN","IBCBB1",157,0)
 I IBER="",$S($$NEEDMRA^IBEFUNC(IBIFN)!($$REQMRA^IBEFUNC(IBIFN)):0,1:1) D ARRAY
"RTN","IBCBB1",158,0)
 ;
"RTN","IBCBB1",159,0)
END ;Don't kill IBIFN, IBER, DFN
"RTN","IBCBB1",160,0)
 I $O(^TMP($J,"BILL-WARN",0)),$G(IBER)="" S IBER="WARN" ;Warnings only
"RTN","IBCBB1",161,0)
 K IBBNO,IBEVDT,IBLOC,IBCL,IBTF,IBAT,IBWHO,IBST,IBFDT,IBTDT,IBTC,IBFY,IBFY1,IBAU,IBRU,IBEU,IBARTP,IBFYC,IBMRA,IBTOB,IBTOB12,IBNDU2,IBNDUF3,IBNDUF31,IBNDTX
"RTN","IBCBB1",162,0)
 K IBNDS,IBND0,IBNDU,IBNDM,IBNDMP,IBNDU1,IBFFY,IBTFY,IBFT,IBRTCHV,IBPICHV,IBXDATA,IBOK
"RTN","IBCBB1",163,0)
 I $D(IBER),IBER="" W !,"No Errors found for National edits"
"RTN","IBCBB1",164,0)
 Q
"RTN","IBCBB1",165,0)
 ;
"RTN","IBCBB1",166,0)
ARRAY ;Build PRCASV(array)
"RTN","IBCBB1",167,0)
 N IBCOBN,X
"RTN","IBCBB1",168,0)
 K PRCASV
"RTN","IBCBB1",169,0)
 Q:$$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN))
"RTN","IBCBB1",170,0)
 S IBCOBN=$$COBN^IBCEF(IBIFN)
"RTN","IBCBB1",171,0)
 S X=IBIFN
"RTN","IBCBB1",172,0)
 S PRCASV("BDT")=DT,PRCASV("ARREC")=IBIFN
"RTN","IBCBB1",173,0)
 S PRCASV("APR")=DUZ
"RTN","IBCBB1",174,0)
 S PRCASV("PAT")=DFN,PRCASV("CAT")=$P(^DGCR(399.3,IBAT,0),"^",6)
"RTN","IBCBB1",175,0)
 I IBWHO="i" S PRCASV("DEBTOR")=+IBNDMP_";DIC(36,"
"RTN","IBCBB1",176,0)
 S PRCASV("DEBTOR")=$S(IBWHO="p":DFN_";DPT(",IBWHO="o":$P(IBNDM,"^",11)_";DIC(4,",IBWHO="i":PRCASV("DEBTOR"),1:"")
"RTN","IBCBB1",177,0)
 S PRCASV("CARE")=$E($$TOB^IBCEF1(IBIFN),1,2)
"RTN","IBCBB1",178,0)
 S PRCASV("FY")=$$FY^IBOUTL(DT)_U_($P(IBNDU1,U)-$P(IBNDU1,U,2))
"RTN","IBCBB1",179,0)
 ;S PRCASV("FY")=$P(IBNDU1,U,9)_U_$S($P(IBNDU1,U,2)]"":($P(IBNDU1,U,10)-$P(IBNDU1,U,2)),1:$P(IBNDU1,U,10))_$S($P(IBNDU1,U,11)]"":U_$P(IBNDU1,U,11)_U_$P(IBNDU1,U,12),1:"")
"RTN","IBCBB1",180,0)
PLUS I IBWHO="i",$P(IBNDM,"^",2),$D(^DIC(36,$P(IBNDM,"^",2),0)) S PRCASV("2NDINS")=$P(IBNDM,"^",2)
"RTN","IBCBB1",181,0)
 I IBWHO="i",$P(IBNDM,"^",3),$D(^DIC(36,$P(IBNDM,"^",3),0)) S PRCASV("3RDINS")=$P(IBNDM,"^",3)
"RTN","IBCBB1",182,0)
 ;
"RTN","IBCBB1",183,0)
 N IBX S IBX=$P(IBND0,U,21),IBX=$S(IBX="P":"I1",IBX="S":"I2",IBX="T":"I3",1:"") Q:IBX=""
"RTN","IBCBB1",184,0)
 N IBNDI1
"RTN","IBCBB1",185,0)
 Q:'$D(^DGCR(399,IBIFN,IBX))  S IBNDI1=^(IBX)
"RTN","IBCBB1",186,0)
 S:$P(IBNDI1,"^",3)]"" PRCASV("GPNO")=$P(IBNDI1,"^",3)
"RTN","IBCBB1",187,0)
 S:$P(IBNDI1,"^",15)]"" PRCASV("GPNM")=$P(IBNDI1,"^",15)
"RTN","IBCBB1",188,0)
 S:$P(IBNDI1,"^",17)]"" PRCASV("INPA")=$P(IBNDI1,"^",17)
"RTN","IBCBB1",189,0)
 S:$P(IBNDI1,"^",2)]"" PRCASV("IDNO")=$P(IBNDI1,"^",2),PRCASV("INID")=PRCASV("IDNO")
"RTN","IBCBB1",190,0)
 ; Check that this is a secondary or tertiary bill and insurance for previous
"RTN","IBCBB1",191,0)
 ; COB sequence is Medicare WNR and MRA is active --> send data elements to AR
"RTN","IBCBB1",192,0)
 I IBCOBN>1,$$WNRBILL^IBEFUNC(IBIFN,IBCOBN-1),$$EDIACTV^IBCEF4(2) D MRA
"RTN","IBCBB1",193,0)
 Q
"RTN","IBCBB1",194,0)
 ;
"RTN","IBCBB1",195,0)
MRA N IBEOB S IBEOB=0
"RTN","IBCBB1",196,0)
 ;
"RTN","IBCBB1",197,0)
 K PRCASV("MEDURE"),PRCASV("MEDCA")
"RTN","IBCBB1",198,0)
 ; Get EOB data
"RTN","IBCBB1",199,0)
 F  S IBEOB=$O(^IBM(361.1,"B",IBIFN,IBEOB)) Q:'IBEOB  D
"RTN","IBCBB1",200,0)
 . D MRACALC^IBCEMU2(IBEOB,IBIFN,1,.PRCASV)
"RTN","IBCBB1",201,0)
 Q  ;MRA
"RTN","IBCBB1",202,0)
 ;
"RTN","IBCBB1",203,0)
 ;; PREGNANCY DX CODES: V22**-V24**, V27**-V28**, 630**-677**
"RTN","IBCBB1",204,0)
 ;; FLU SHOTS PROCEDURE CODES: 90724, G0008, 90732, G0009
"RTN","IBCBB11")
0^2^B19890435^B16826545
"RTN","IBCBB11",1,0)
IBCBB11 ;ALB/AAS - CONTINUATION OF EDIT CHECK ROUTINE ;12 Jun 2006  3:45 PM
"RTN","IBCBB11",2,0)
 ;;2.0;INTEGRATED BILLING;**51,343,363,371,395**;21-MAR-94;Build 3
"RTN","IBCBB11",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB11",4,0)
 ;
"RTN","IBCBB11",5,0)
WARN(IBDISP) ; Set warning in global
"RTN","IBCBB11",6,0)
 ; DISP = warning text to display
"RTN","IBCBB11",7,0)
 ;
"RTN","IBCBB11",8,0)
 N Z
"RTN","IBCBB11",9,0)
 S Z=+$O(^TMP($J,"BILL-WARN",""),-1)
"RTN","IBCBB11",10,0)
 I Z=0 S ^TMP($J,"BILL-WARN",1)=$J("",5)_"**Warnings**:",Z=1
"RTN","IBCBB11",11,0)
 S Z=Z+1,^TMP($J,"BILL-WARN",Z)=$J("",5)_IBDISP
"RTN","IBCBB11",12,0)
 Q
"RTN","IBCBB11",13,0)
 ;
"RTN","IBCBB11",14,0)
MULTDIV(IBIFN,IBND0) ; Check for multiple divisions on a bill ien IBIFN
"RTN","IBCBB11",15,0)
 ; IBND0 = 0-node of bill
"RTN","IBCBB11",16,0)
 ;
"RTN","IBCBB11",17,0)
 ;  Function returns 1 if more than 1 division found on bill
"RTN","IBCBB11",18,0)
 N Z,Z0,Z1,MULT
"RTN","IBCBB11",19,0)
 S MULT=0,Z1=$P(IBND0,U,22)
"RTN","IBCBB11",20,0)
 I Z1 D
"RTN","IBCBB11",21,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$P(^(Z,0),U,7) I Z0,Z0'=Z1 S MULT=1 Q
"RTN","IBCBB11",22,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  S Z0=$P(^(Z,0),U,6) I Z0,Z0'=Z1 S MULT=2 Q
"RTN","IBCBB11",23,0)
 I 'Z1 S MULT=3
"RTN","IBCBB11",24,0)
 Q MULT
"RTN","IBCBB11",25,0)
 ;
"RTN","IBCBB11",26,0)
 ;; PREGNANCY DX CODES: V22**-V24**, V27**-V28**, 630**-677**
"RTN","IBCBB11",27,0)
 ;; FLU SHOTS PROCEDURE CODES: 90724, G0008, 90732, G0009
"RTN","IBCBB11",28,0)
 ;
"RTN","IBCBB11",29,0)
 ; Check for required NPIs
"RTN","IBCBB11",30,0)
NPICHK ;
"RTN","IBCBB11",31,0)
 N IBNPIS,IBNONPI,IBNPIREQ,Z
"RTN","IBCBB11",32,0)
 S IBNPIREQ=$$NPIREQ^IBCEP81(DT)  ; Check if NPI is required
"RTN","IBCBB11",33,0)
 ; Check providers
"RTN","IBCBB11",34,0)
 S IBNPIS=$$PROVNPI^IBCEF73A(IBIFN,.IBNONPI)
"RTN","IBCBB11",35,0)
 I $L(IBNONPI) F Z=1:1:$L(IBNONPI,U) D
"RTN","IBCBB11",36,0)
 . I IBNPIREQ S IBER=IBER_"IB"_(140+$P(IBNONPI,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",37,0)
 . D WARN("NPI for the "_$P("referring^operating^rendering^attending^supervising^^^^other",U,$P(IBNONPI,U,Z))_" provider has no value")  ; Else, set warning
"RTN","IBCBB11",38,0)
 ; Check organizations
"RTN","IBCBB11",39,0)
 S IBNONPI=""
"RTN","IBCBB11",40,0)
 S IBNPIS=$$ORGNPI^IBCEF73A(IBIFN,.IBNONPI)
"RTN","IBCBB11",41,0)
 I $L(IBNONPI) F Z=1:1:$L(IBNONPI,U) D
"RTN","IBCBB11",42,0)
 . I IBNPIREQ S IBER=IBER_"IB"_(160+$P(IBNONPI,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",43,0)
 . ; PRXM/KJH - Changed descriptions.
"RTN","IBCBB11",44,0)
 . D WARN("NPI for the "_$P("Division^Non-VA Service Facility^Billing Provider",U,$P(IBNONPI,U,Z))_" has no value")  ; Else, set warning
"RTN","IBCBB11",45,0)
 Q
"RTN","IBCBB11",46,0)
 ;
"RTN","IBCBB11",47,0)
 ; Check for required taxonomies
"RTN","IBCBB11",48,0)
TAXCHK ;
"RTN","IBCBB11",49,0)
 N IBTAXS,IBNOTAX,IBTAXREQ,Z
"RTN","IBCBB11",50,0)
 S IBTAXREQ=$$TAXREQ^IBCEP81(DT)  ; Check if taxonomy is required
"RTN","IBCBB11",51,0)
 ; Check providers
"RTN","IBCBB11",52,0)
 S IBTAXS=$$PROVTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCBB11",53,0)
 I $L(IBNOTAX) F Z=1:1:$L(IBNOTAX,U) D
"RTN","IBCBB11",54,0)
 . I IBTAXREQ S IBER=IBER_"IB"_(250+$P(IBNOTAX,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",55,0)
 . D WARN("Taxonomy for the "_$P("referring^operating^rendering^attending^supervising^^^^other",U,$P(IBNOTAX,U,Z))_" provider has no value")  ; Else, set warning
"RTN","IBCBB11",56,0)
 ; Check organizations
"RTN","IBCBB11",57,0)
 S IBNOTAX=""
"RTN","IBCBB11",58,0)
 S IBTAXS=$$ORGTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCBB11",59,0)
 I $L(IBNOTAX) F Z=1:1:$L(IBNOTAX,U) D
"RTN","IBCBB11",60,0)
 . I IBTAXREQ S IBER=IBER_"IB"_(164+$P(IBNOTAX,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",61,0)
 . ; PRXM/KJH - Changed descriptions.
"RTN","IBCBB11",62,0)
 . D WARN("Taxonomy for the "_$P("Division^Non-VA Service Facility^Billing Provider",U,$P(IBNOTAX,U,Z))_" has no value")  ; Else, set warning
"RTN","IBCBB11",63,0)
 Q
"RTN","IBCBB11",64,0)
 ;
"RTN","IBCBB11",65,0)
VALNDC(IBIFN,IBDFN) ; IB*2*363 - validate NDC# between PRESCRIPTION file (#52)
"RTN","IBCBB11",66,0)
 ; and IB BILL/CLAIMS PRESCRIPTION REFILL file (#362.4)
"RTN","IBCBB11",67,0)
 ; input - IBIFN = internal entry number of the billing record in the BILL/CLAIMS file (#399)
"RTN","IBCBB11",68,0)
 ;         IBDFN = internal entry number of patient record in the PATIENT file (#2)
"RTN","IBCBB11",69,0)
 N IBX,IBRXCOL
"RTN","IBCBB11",70,0)
 ; call program that determines if NDC differences exist
"RTN","IBCBB11",71,0)
 D VALNDC^IBEFUNC3(IBIFN,IBDFN,.IBRXCOL)
"RTN","IBCBB11",72,0)
 Q:'$D(IBRXCOL)
"RTN","IBCBB11",73,0)
 ; at least one RX on the IB record has an NDC discrepancy 
"RTN","IBCBB11",74,0)
 S IBX=0 F  S IBX=$O(IBRXCOL(IBX)) Q:'IBX  D WARN("NDC# on Bill does not equal the NDC# on Rx "_IBRXCOL(IBX))
"RTN","IBCBB11",75,0)
 Q
"RTN","IBCBB11",76,0)
 ;
"RTN","IBCBB11",77,0)
PRIIDCHK ; Check for required Pimarary ID (SSN/EIN)
"RTN","IBCBB11",78,0)
 ; If the provider is on the claim, he must have one
"RTN","IBCBB11",79,0)
 ; 
"RTN","IBCBB11",80,0)
 N IBI,IBZ
"RTN","IBCBB11",81,0)
 I $$TXMT^IBCEF4(IBIFN) D
"RTN","IBCBB11",82,0)
 . D F^IBCEF("N-ALL ATT/REND PROV SSN/EI","IBZ",,IBIFN)
"RTN","IBCBB11",83,0)
 . S IBI="" F  S IBI=$O(^DGCR(399,IBIFN,"PRV","B",IBI)) Q:IBI=""  D
"RTN","IBCBB11",84,0)
 .. I $P(IBZ,U,IBI)="" S IBER=IBER_$S(IBI=1:"IB151;",IBI=2:"IB152;",IBI=3!(IBI=4):"IB321;",IBI=5:"IB153;",IBI=9:"IB154;",1:"")
"RTN","IBCBB11",85,0)
 Q
"RTN","IBCBB11",86,0)
 ;
"RTN","IBCBB11",87,0)
RXNPI(IBIFN) ; check for multiple pharmacy npi's on the same bill
"RTN","IBCBB11",88,0)
 N IBORG,IBRXNPI,IBX,IBY
"RTN","IBCBB11",89,0)
 S IBORG=$$RXSITE^IBCEF73A(IBIFN,.IBORG)
"RTN","IBCBB11",90,0)
 S IBX=0 F  S IBX=$O(IBORG(IBX)) Q:'IBX  S IBY=0 F  S IBY=$O(IBORG(IBX,IBY)) Q:'IBY  S IBRXNPI(+IBORG(IBX,IBY))=""
"RTN","IBCBB11",91,0)
 S (IBX,IBY)=0 F  S IBX=$O(IBRXNPI(IBX)) Q:'IBX  S IBY=IBY+1
"RTN","IBCBB11",92,0)
 I IBY>1 D WARN("Bill has prescriptions resulting from "_IBY_" different NPI locations")
"RTN","IBCBB11",93,0)
 Q
"RTN","IBCEF73A")
0^3^B31578985^B18483698
"RTN","IBCEF73A",1,0)
IBCEF73A ;ALB/KJH - FORMATTER AND EXTRACTOR SPECIFIC (NPI) BILL FUNCTIONS ; 30 Aug 2006  10:38 AM
"RTN","IBCEF73A",2,0)
 ;;2.0;INTEGRATED BILLING;**343,374,395**;21-MAR-94;Build 3
"RTN","IBCEF73A",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCEF73A",4,0)
 ;
"RTN","IBCEF73A",5,0)
PROVNPI(IBIEN399,IBNONPI) ;
"RTN","IBCEF73A",6,0)
 ;Retrieves NPIs from #200 or 355.93
"RTN","IBCEF73A",7,0)
 ; Input:
"RTN","IBCEF73A",8,0)
 ;       IBIEN399 - IEN of record in BILL/CLAIMS file 399
"RTN","IBCEF73A",9,0)
 ;       IBNONPI - variable to pass info on missing NPI to calling routine.  Pass by reference
"RTN","IBCEF73A",10,0)
 ; Output:
"RTN","IBCEF73A",11,0)
 ;       NPI codes for all providers
"RTN","IBCEF73A",12,0)
 ;       IBNONPI - U-delimited list of provider types with missing NPIs
"RTN","IBCEF73A",13,0)
 N IBRETVAL,IBPTR,IBFT
"RTN","IBCEF73A",14,0)
 S IBRETVAL="",IBNONPI=""
"RTN","IBCEF73A",15,0)
 F IBFT=1:1:9 D
"RTN","IBCEF73A",16,0)
 . S IBPTR=$$PROVPTR^IBCEF7(IBIEN399,IBFT)
"RTN","IBCEF73A",17,0)
 . I IBPTR S $P(IBRETVAL,"^",IBFT)=$$GETNPI(IBPTR)
"RTN","IBCEF73A",18,0)
 Q IBRETVAL
"RTN","IBCEF73A",19,0)
GETNPI(IBPTR) ;look for NPI in #200 or #355.93
"RTN","IBCEF73A",20,0)
 ;Input: IBPTR from 399.0222, field .02
"RTN","IBCEF73A",21,0)
 ;Output: NPI
"RTN","IBCEF73A",22,0)
 ;if in file #200
"RTN","IBCEF73A",23,0)
 N NPI
"RTN","IBCEF73A",24,0)
 S NPI=""
"RTN","IBCEF73A",25,0)
 ;if in 200 then get it from 200
"RTN","IBCEF73A",26,0)
 I $P(IBPTR,";",2)="VA(200," S NPI=$P($$NPI^XUSNPI("Individual_ID",$P(IBPTR,";")),U) S:NPI=-1 NPI=""
"RTN","IBCEF73A",27,0)
 ;if in 355.93 then use 355.93
"RTN","IBCEF73A",28,0)
 I $P(IBPTR,";",2)="IBA(355.93," S NPI=$$NPIGET^IBCEP81($P(IBPTR,";"))
"RTN","IBCEF73A",29,0)
 I NPI="",$D(IBNONPI) S IBNONPI=$S(IBNONPI="":IBFT,1:IBNONPI_U_IBFT)
"RTN","IBCEF73A",30,0)
 Q NPI
"RTN","IBCEF73A",31,0)
 ;
"RTN","IBCEF73A",32,0)
SPECTAX(IBIEN399,IBNOSPEC) ;
"RTN","IBCEF73A",33,0)
 ;Retrieves Specialty Codes from Current Taxonomy entries for a claim from #399
"RTN","IBCEF73A",34,0)
 ; Input:
"RTN","IBCEF73A",35,0)
 ;       IBIEN399 - IEN of record in BILL/CLAIMS file 399
"RTN","IBCEF73A",36,0)
 ;       IBNOSPEC - variable to pass info on missing taxonomies to calling routine.  Pass by reference
"RTN","IBCEF73A",37,0)
 ; Output:
"RTN","IBCEF73A",38,0)
 ;       Taxonomy Specialty Codes for all providers
"RTN","IBCEF73A",39,0)
 ;       IBNOSPEC - U-delimited list of provider types with missing Taxonomy Specialty codes
"RTN","IBCEF73A",40,0)
 N IBRETVAL,IBN,IBFT,IBSPEC,SPEC
"RTN","IBCEF73A",41,0)
 S IBRETVAL="",IBNOSPEC=""
"RTN","IBCEF73A",42,0)
 I $G(IBIEN399)="" Q ""
"RTN","IBCEF73A",43,0)
 F IBFT=1:1:9 D
"RTN","IBCEF73A",44,0)
 . S IBN=$O(^DGCR(399,IBIEN399,"PRV","B",IBFT,0))
"RTN","IBCEF73A",45,0)
 . I +IBN=0 Q
"RTN","IBCEF73A",46,0)
 . S IBSPEC=$P($G(^DGCR(399,IBIEN399,"PRV",+IBN,0)),"^",15)
"RTN","IBCEF73A",47,0)
 . S SPEC=$$GET1^DIQ(8932.1,IBSPEC,"SPECIALTY CODE")
"RTN","IBCEF73A",48,0)
 . S $P(IBRETVAL,"^",IBFT)=SPEC
"RTN","IBCEF73A",49,0)
 . I SPEC="",$D(IBNOSPEC) S IBNOSPEC=$S(IBNOSPEC="":IBFT,1:IBNOSPEC_U_IBFT)
"RTN","IBCEF73A",50,0)
 Q IBRETVAL
"RTN","IBCEF73A",51,0)
 ;
"RTN","IBCEF73A",52,0)
PROVTAX(IBIEN399,IBNOTAX) ;
"RTN","IBCEF73A",53,0)
 ;Retrieves Current Taxonomy entries for a claim from #399
"RTN","IBCEF73A",54,0)
 ; Input:
"RTN","IBCEF73A",55,0)
 ;       IBIEN399 - IEN of record in BILL/CLAIMS file 399
"RTN","IBCEF73A",56,0)
 ;       IBNOTAX - variable to pass info on missing taxonomies to calling routine.  Pass by reference
"RTN","IBCEF73A",57,0)
 ; Output:
"RTN","IBCEF73A",58,0)
 ;       Taxonomy X12 codes for all providers
"RTN","IBCEF73A",59,0)
 ;       IBNOTAX - U-delimited list of provider types with missing Taxonomy X12 codes
"RTN","IBCEF73A",60,0)
 N IBRETVAL,IBN,IBFT,IBTAX,TAX
"RTN","IBCEF73A",61,0)
 S IBRETVAL="",IBNOTAX=""
"RTN","IBCEF73A",62,0)
 I $G(IBIEN399)="" Q ""
"RTN","IBCEF73A",63,0)
 F IBFT=1:1:9 D
"RTN","IBCEF73A",64,0)
 . S IBN=$O(^DGCR(399,IBIEN399,"PRV","B",IBFT,0))
"RTN","IBCEF73A",65,0)
 . I +IBN=0 Q
"RTN","IBCEF73A",66,0)
 . S IBTAX=$P($G(^DGCR(399,IBIEN399,"PRV",+IBN,0)),"^",15)
"RTN","IBCEF73A",67,0)
 . S TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",68,0)
 . S $P(IBRETVAL,"^",IBFT)=TAX
"RTN","IBCEF73A",69,0)
 . I TAX="",$D(IBNOTAX) S IBNOTAX=$S(IBNOTAX="":IBFT,1:IBNOTAX_U_IBFT)
"RTN","IBCEF73A",70,0)
 Q IBRETVAL
"RTN","IBCEF73A",71,0)
GETTAX(IBPTR) ;look for Taxonomy in #200 or #355.93
"RTN","IBCEF73A",72,0)
 ;Input: IBPTR from 399.0222, field .02
"RTN","IBCEF73A",73,0)
 ;Output: Taxonomy X12 code_"^"_IEN
"RTN","IBCEF73A",74,0)
 N TAX
"RTN","IBCEF73A",75,0)
 S TAX="^"
"RTN","IBCEF73A",76,0)
 ;if in 200 then get it from 200
"RTN","IBCEF73A",77,0)
 I $P(IBPTR,";",2)="VA(200," S TAX=$$TAXIND^XUSTAX($P(IBPTR,";"))
"RTN","IBCEF73A",78,0)
 ;if in 355.93 then use 355.93
"RTN","IBCEF73A",79,0)
 I $P(IBPTR,";",2)="IBA(355.93," S TAX=$$TAXGET^IBCEP81($P(IBPTR,";"))
"RTN","IBCEF73A",80,0)
 Q TAX
"RTN","IBCEF73A",81,0)
 ;
"RTN","IBCEF73A",82,0)
ORGNPI(IBIEN399,IBNONPI) ; Extract NPIs for organizations on this claim
"RTN","IBCEF73A",83,0)
 ; Input
"RTN","IBCEF73A",84,0)
 ;       IBIEN399 - Claim IEN in file 399
"RTN","IBCEF73A",85,0)
 ;       IBNONPI - Variable to pass info on missing NPI back to calling routine.  Pass by reference.
"RTN","IBCEF73A",86,0)
 ; Output - NPI codes for facilities
"RTN","IBCEF73A",87,0)
 ;        Piece 1) Division (Responsible Institution) NPI code
"RTN","IBCEF73A",88,0)
 ;        Piece 2) Non-VA Service Facility NPI code
"RTN","IBCEF73A",89,0)
 ;        Piece 3) Billing Provider NPI code (main VA division)
"RTN","IBCEF73A",90,0)
 N IBRETVAL,IBORG,IBEVDT,IBDIV,NPI
"RTN","IBCEF73A",91,0)
 S IBNONPI=""
"RTN","IBCEF73A",92,0)
 I $G(IBIEN399)="" Q ""
"RTN","IBCEF73A",93,0)
 S IBRETVAL=""
"RTN","IBCEF73A",94,0)
 S IBEVDT=$$GET1^DIQ(399,IBIEN399_",",.03,"I")
"RTN","IBCEF73A",95,0)
 I IBEVDT="" S IBEVDT=DT
"RTN","IBCEF73A",96,0)
 S IBDIV=$$GET1^DIQ(399,IBIEN399_",",.22,"I")
"RTN","IBCEF73A",97,0)
 I IBDIV="" S IBDIV=$$PRIM^VASITE(IBEVDT)
"RTN","IBCEF73A",98,0)
 S IBORG=$P($$SITE^VASITE(IBEVDT,IBDIV),U),NPI=""
"RTN","IBCEF73A",99,0)
 I IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U) S:NPI'=-1 $P(IBRETVAL,U)=NPI
"RTN","IBCEF73A",100,0)
 I NPI<1,$D(IBNONPI) S IBNONPI=1
"RTN","IBCEF73A",101,0)
 S IBORG=$$GET1^DIQ(399,IBIEN399_",",232,"I")
"RTN","IBCEF73A",102,0)
 I IBORG S NPI=$$NPIGET^IBCEP81(IBORG),$P(IBRETVAL,U,2)=NPI I 'NPI,$D(IBNONPI) S IBNONPI=$S(IBNONPI="":2,1:IBNONPI_U_2)
"RTN","IBCEF73A",103,0)
 S IBORG=$P($$SITE^VASITE,U),NPI=""
"RTN","IBCEF73A",104,0)
 I IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U) S:NPI'=-1 $P(IBRETVAL,U,3)=NPI
"RTN","IBCEF73A",105,0)
 I NPI<1,$D(IBNONPI) S IBNONPI=$S(IBNONPI="":3,1:IBNONPI_U_3)
"RTN","IBCEF73A",106,0)
 I $$ISRX^IBCEF1(IBIEN399) S IBORG=$$RXSITE(IBIEN399) I IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U) S:NPI'=-1 $P(IBRETVAL,U,3)=NPI
"RTN","IBCEF73A",107,0)
 Q IBRETVAL
"RTN","IBCEF73A",108,0)
 ;
"RTN","IBCEF73A",109,0)
ORGTAX(IBIEN399,IBNOTAX) ; Extract Taxonomies for organizations on this claim
"RTN","IBCEF73A",110,0)
 ; Input
"RTN","IBCEF73A",111,0)
 ;       IBIEN399 - Claim IEN in file 399
"RTN","IBCEF73A",112,0)
 ;       IBNOTAX - Variable to pass info on missing taxonomies back to calling routine.  Pass by reference.
"RTN","IBCEF73A",113,0)
 ; Output - Taxonomy X12 codes for facilities
"RTN","IBCEF73A",114,0)
 ;        Piece 1) Division (Responsible Institution) Taxonomy X12 code
"RTN","IBCEF73A",115,0)
 ;        Piece 2) Non-VA Service Facility Taxonomy X12 code
"RTN","IBCEF73A",116,0)
 ;        Piece 3) Billing Provider Taxonomy X12 code (main VA division)
"RTN","IBCEF73A",117,0)
 N IBRETVAL,IBTAX,TAX
"RTN","IBCEF73A",118,0)
 S IBTAX=$$GET1^DIQ(399,IBIEN399_",",243,"I")
"RTN","IBCEF73A",119,0)
 S TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",120,0)
 S $P(IBRETVAL,U)=TAX
"RTN","IBCEF73A",121,0)
 I '$L(TAX),$D(IBNOTAX) S IBNOTAX=1
"RTN","IBCEF73A",122,0)
 S IBTAX=$$GET1^DIQ(399,IBIEN399_",",244,"I")
"RTN","IBCEF73A",123,0)
 S TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",124,0)
 S $P(IBRETVAL,U,2)=TAX
"RTN","IBCEF73A",125,0)
 I '$L(TAX),$$GET1^DIQ(399,IBIEN399_",",232,"I"),$D(IBNOTAX) S IBNOTAX=$S(IBNOTAX="":2,1:IBNOTAX_U_2)
"RTN","IBCEF73A",126,0)
 S IBORG=$P($$SITE^VASITE,U)
"RTN","IBCEF73A",127,0)
 S TAX=$P($$TAXORG^XUSTAX(IBORG),U)
"RTN","IBCEF73A",128,0)
 S $P(IBRETVAL,U,3)=TAX
"RTN","IBCEF73A",129,0)
 I '$L(TAX),$D(IBNOTAX) S IBNOTAX=$S(IBNOTAX="":3,1:IBNOTAX_U_3)
"RTN","IBCEF73A",130,0)
 Q IBRETVAL
"RTN","IBCEF73A",131,0)
 ;
"RTN","IBCEF73A",132,0)
RXSITE(IBIEN399,IBLIST) ; returns prescription organization (file 4) pointer
"RTN","IBCEF73A",133,0)
 ; for the given bill.  If IBLIST passed by reference, then a list of
"RTN","IBCEF73A",134,0)
 ; the possible organizations are returned for a bill, since a bill may
"RTN","IBCEF73A",135,0)
 ; have more than one prescription.  If more than one rx on the bill, the
"RTN","IBCEF73A",136,0)
 ; $$ return is the pointer of the last prescription found.
"RTN","IBCEF73A",137,0)
 ; IBLIST(rx ien,fill date)=ORGINATION (file 4 pointer)
"RTN","IBCEF73A",138,0)
 ;
"RTN","IBCEF73A",139,0)
 N IBX,IBDATA,IBORG,IBRX,IBDT,IBY,IBRXN,DFN
"RTN","IBCEF73A",140,0)
 K ^TMP($J,"IBCEF73A")
"RTN","IBCEF73A",141,0)
 S IBORG=0,DFN=$P($G(^DGCR(399,IBIEN399,0)),"^",2),IBLIST="IBCEF73A"
"RTN","IBCEF73A",142,0)
 S IBRXN=0 F  S IBRXN=$O(^IBA(362.4,"AIFN"_IBIEN399,IBRXN)) Q:'IBRXN  S IBX=0 F  S IBX=$O(^IBA(362.4,"AIFN"_IBIEN399,IBRXN,IBX)) Q:'IBX  D
"RTN","IBCEF73A",143,0)
 . S IBDATA=$G(^IBA(362.4,IBX,0))
"RTN","IBCEF73A",144,0)
 . S IBRX=$P(IBDATA,"^",5),IBDT=$P(IBDATA,"^",3) Q:'IBRX!('IBDT)
"RTN","IBCEF73A",145,0)
 . D RX^PSO52API(DFN,IBLIST,IBRX,,"0,2,R")
"RTN","IBCEF73A",146,0)
 . I IBDT=+$G(^TMP($J,"IBCEF73A",DFN,IBRX,22)) S (IBORG,IBLIST(IBRX,IBDT))=$$PSONPI(+$G(^TMP($J,"IBCEF73A",DFN,IBRX,20))) Q
"RTN","IBCEF73A",147,0)
 . S IBY=0 F  S IBY=$O(^TMP($J,"IBCEF73A",DFN,IBRX,"RF",IBY)) Q:'IBY  I IBDT=+$G(^TMP($J,"IBCEF73A",DFN,IBRX,"RF",IBY,.01)) S (IBORG,IBLIST(IBRX,IBDT))=$$PSONPI(+$G(^TMP($J,"IBCEF73A",DFN,IBRX,"RF",IBY,8))) Q
"RTN","IBCEF73A",148,0)
 K ^TMP($J,"IBCEF73A")
"RTN","IBCEF73A",149,0)
 Q IBORG
"RTN","IBCEF73A",150,0)
 ;
"RTN","IBCEF73A",151,0)
PSONPI(IB59IEN) ; returns institution ien for a file 59 ien
"RTN","IBCEF73A",152,0)
 N IB4IEN
"RTN","IBCEF73A",153,0)
 K ^TMP($J,"IBCEF59")
"RTN","IBCEF73A",154,0)
 D PSS^PSO59(IB59IEN,,"IBCEF59")
"RTN","IBCEF73A",155,0)
 S IB4IEN=+$G(^TMP($J,"IBCEF59",IB59IEN,101))
"RTN","IBCEF73A",156,0)
 K ^TMP($J,"IBCEF59")
"RTN","IBCEF73A",157,0)
 Q IB4IEN
"RTN","IBCEF74A")
0^4^B20383624^B19511866
"RTN","IBCEF74A",1,0)
IBCEF74A ;ALB/ESG - Provider ID maint ?ID continuation ;7 Mar 2006
"RTN","IBCEF74A",2,0)
 ;;2.0;INTEGRATED BILLING;**320,343,349,395**;21-MAR-94;Build 3
"RTN","IBCEF74A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF74A",4,0)
 ;
"RTN","IBCEF74A",5,0)
 Q
"RTN","IBCEF74A",6,0)
 ;
"RTN","IBCEF74A",7,0)
EN(IBIFN,IBQUIT) ; Display billing provider and service provider IDs as part
"RTN","IBCEF74A",8,0)
 ; of the ?ID display/help in the billing screens.
"RTN","IBCEF74A",9,0)
 ; Called from DISPID^IBCEF74.
"RTN","IBCEF74A",10,0)
 NEW IBID,IBX,Z,ZI,ZN,SEQ,PSIN,DATA,QUALNM,IDNUM,FACNAME,IBZ,IBXIEN,IBSSFI,ORGNPI
"RTN","IBCEF74A",11,0)
 ;
"RTN","IBCEF74A",12,0)
 D ALLIDS^IBCEF75(IBIFN,.IBID)
"RTN","IBCEF74A",13,0)
 ;
"RTN","IBCEF74A",14,0)
 ; Re-sort array by insurance sequence (P/S/T)
"RTN","IBCEF74A",15,0)
 K IBX
"RTN","IBCEF74A",16,0)
 F Z="BILLING PRV","LAB/FAC" F ZI="C","O" S ZN=0 F  S ZN=$O(IBID(Z,IBIFN,ZI,ZN)) Q:'ZN  D
"RTN","IBCEF74A",17,0)
 . S SEQ=$P($G(IBID(Z,IBIFN,ZI,ZN)),U,1) Q:SEQ=""
"RTN","IBCEF74A",18,0)
 . S IBX(Z,SEQ,ZI,ZN)=""
"RTN","IBCEF74A",19,0)
 . Q
"RTN","IBCEF74A",20,0)
 ;
"RTN","IBCEF74A",21,0)
 ; Display billing provider secondary ID's (current ins only)
"RTN","IBCEF74A",22,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",23,0)
 S Z="BILLING PRV"
"RTN","IBCEF74A",24,0)
 ; PRXM/KJH - Removed "I $D(IBX(Z))" from next line. Caused header to not display even though there would be a "None Found' message.
"RTN","IBCEF74A",25,0)
 W !!,"Billing Provider Secondary IDs (VistA Record CI1A):"
"RTN","IBCEF74A",26,0)
 D SECID(Z,.IBQUIT)
"RTN","IBCEF74A",27,0)
 I IBQUIT G EX
"RTN","IBCEF74A",28,0)
 ;
"RTN","IBCEF74A",29,0)
 ; Now display the lab or facility primary and secondary IDs
"RTN","IBCEF74A",30,0)
 ; This is the service facility information
"RTN","IBCEF74A",31,0)
 ;
"RTN","IBCEF74A",32,0)
 ; Facility name, same code as found in SUB-2
"RTN","IBCEF74A",33,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",34,0)
 W !!,"Service Facility Name and ID Information"
"RTN","IBCEF74A",35,0)
 S IBXIEN=IBIFN
"RTN","IBCEF74A",36,0)
 D F^IBCEF("N-RENDERING INSTITUTION","IBZ",,IBIFN)
"RTN","IBCEF74A",37,0)
 I $$ISRX^IBCEF1(IBIFN) S Z=$$RXSITE^IBCEF73A(IBIFN) I Z S $P(IBZ,"^")=+Z
"RTN","IBCEF74A",38,0)
 S FACNAME=$$GETFAC^IBCEP8(+IBZ,+$P(IBZ,U,2),0,"SUB")
"RTN","IBCEF74A",39,0)
 S Z="LAB/FAC"
"RTN","IBCEF74A",40,0)
 ;
"RTN","IBCEF74A",41,0)
 ; determine if flag to suppress lab/fac data is set
"RTN","IBCEF74A",42,0)
 D VAMCFD^IBCEF75(IBIFN,.IBSSFI)
"RTN","IBCEF74A",43,0)
 I $D(IBSSFI),'$G(IBSSFI("C",1)) D  I IBQUIT G EX
"RTN","IBCEF74A",44,0)
 . I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() Q:IBQUIT
"RTN","IBCEF74A",45,0)
 . W !!,"Note:  Service Facility Data not sent for Current Insurance"
"RTN","IBCEF74A",46,0)
 . W !,"       'Send VA Lab/Facility IDs or Facility Data for VAMC?' is set to NO",!
"RTN","IBCEF74A",47,0)
 . Q
"RTN","IBCEF74A",48,0)
 ;
"RTN","IBCEF74A",49,0)
 ; facility name
"RTN","IBCEF74A",50,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",51,0)
 I FACNAME="" S FACNAME="n/a"
"RTN","IBCEF74A",52,0)
 W !,"Facility:  ",FACNAME
"RTN","IBCEF74A",53,0)
 ;
"RTN","IBCEF74A",54,0)
 ; PRXM/KJH - Add NPI to display for patch 343.
"RTN","IBCEF74A",55,0)
 S ORGNPI=$$ORGNPI^IBCEF73A(IBIFN)
"RTN","IBCEF74A",56,0)
 S DATA=$S($$ISRX^IBCEF1(IBIFN):$P(ORGNPI,U,3),$P($G(IBZ),U,2)=1:$P(ORGNPI,U,2),$P($G(IBZ),U,2)=0:$P(ORGNPI,U,1),1:$P(ORGNPI,U,3))
"RTN","IBCEF74A",57,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",58,0)
 W !?5,"Lab or Facility NPI:"
"RTN","IBCEF74A",59,0)
 W !?12,$S(DATA'="":DATA,1:"***MISSING***")
"RTN","IBCEF74A",60,0)
 ; primary ID
"RTN","IBCEF74A",61,0)
 S DATA=$G(IBID(Z,IBIFN,"C",1,0))   ; lab/facility current ins primary
"RTN","IBCEF74A",62,0)
 S QUALNM=$$QUAL($P(DATA,U,1),$$FT^IBCEF(IBIFN))
"RTN","IBCEF74A",63,0)
 S IDNUM=$P(DATA,U,2)
"RTN","IBCEF74A",64,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",65,0)
 W !?5,"Lab or Facility Primary ID (VistA Record SUB):"
"RTN","IBCEF74A",66,0)
 I DATA'="" W !?8,"(",$P($G(IBID(Z,IBIFN,"C",1)),U,1),") ",QUALNM,?40,IDNUM
"RTN","IBCEF74A",67,0)
 I DATA="" W !?8,"(-) None Found"
"RTN","IBCEF74A",68,0)
 ;
"RTN","IBCEF74A",69,0)
 ; secondary IDs
"RTN","IBCEF74A",70,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",71,0)
 W !?5,"Lab or Facility Secondary IDs (VistA Records SUB1,SUB2,OP3,OP6,OP7):"
"RTN","IBCEF74A",72,0)
 D SECID(Z,.IBQUIT)
"RTN","IBCEF74A",73,0)
 I IBQUIT G EX
"RTN","IBCEF74A",74,0)
 ;
"RTN","IBCEF74A",75,0)
EX ;
"RTN","IBCEF74A",76,0)
 Q
"RTN","IBCEF74A",77,0)
 ;
"RTN","IBCEF74A",78,0)
QUAL(Z,FORMTYPE) ; turn the qualifier code into a qualifier description
"RTN","IBCEF74A",79,0)
 NEW QUAL,IEN
"RTN","IBCEF74A",80,0)
 S QUAL=""
"RTN","IBCEF74A",81,0)
 I $G(Z)="" G QUALX
"RTN","IBCEF74A",82,0)
 I Z="1C" D  G QUALX   ; qualifier for Medicare Part ?
"RTN","IBCEF74A",83,0)
 . I $G(FORMTYPE)=2 S QUAL="MEDICARE PART B"   ; 1500
"RTN","IBCEF74A",84,0)
 . I $G(FORMTYPE)=3 S QUAL="MEDICARE PART A"   ; ub
"RTN","IBCEF74A",85,0)
 . Q
"RTN","IBCEF74A",86,0)
 I Z=34 S Z="SY"       ; qualifier for SSN
"RTN","IBCEF74A",87,0)
 S IEN=+$O(^IBE(355.97,"C",Z,"")) I 'IEN G QUALX
"RTN","IBCEF74A",88,0)
 S QUAL=$P($G(^IBE(355.97,IEN,0)),U,1)
"RTN","IBCEF74A",89,0)
QUALX ;
"RTN","IBCEF74A",90,0)
 Q QUAL
"RTN","IBCEF74A",91,0)
 ;
"RTN","IBCEF74A",92,0)
SECID(Z,IBQUIT) ; Display secondary ID and qualifier information
"RTN","IBCEF74A",93,0)
 ; Z is the type of IDs passed in; either BILLING PRV or LAB/FAC
"RTN","IBCEF74A",94,0)
 ; IBQUIT is returned if passed by reference
"RTN","IBCEF74A",95,0)
 NEW SEQ,ZI,ZN,PSIN,DATA,QUALNM,IDNUM,NODATA
"RTN","IBCEF74A",96,0)
 S IBQUIT=0,NODATA=1
"RTN","IBCEF74A",97,0)
 F SEQ="P","S","T" D  Q:IBQUIT
"RTN","IBCEF74A",98,0)
 . ;
"RTN","IBCEF74A",99,0)
 . ; current ins only for billing provider secondary IDs
"RTN","IBCEF74A",100,0)
 . I Z="BILLING PRV",SEQ'=$$COB^IBCEF(IBIFN) Q
"RTN","IBCEF74A",101,0)
 . S ZI=""
"RTN","IBCEF74A",102,0)
 . F  S ZI=$O(IBX(Z,SEQ,ZI)) Q:ZI=""  D  Q:IBQUIT
"RTN","IBCEF74A",103,0)
 .. S ZN=0
"RTN","IBCEF74A",104,0)
 .. F  S ZN=$O(IBX(Z,SEQ,ZI,ZN)) Q:'ZN  D  Q:IBQUIT
"RTN","IBCEF74A",105,0)
 ... S PSIN=0   ; start at 0 to skip primary IDs
"RTN","IBCEF74A",106,0)
 ... F  S PSIN=$O(IBID(Z,IBIFN,ZI,ZN,PSIN)) Q:PSIN=""  D  Q:IBQUIT
"RTN","IBCEF74A",107,0)
 .... S DATA=$G(IBID(Z,IBIFN,ZI,ZN,PSIN))
"RTN","IBCEF74A",108,0)
 .... S QUALNM=$$QUAL($P(DATA,U,1),$$FT^IBCEF(IBIFN))
"RTN","IBCEF74A",109,0)
 .... S IDNUM=$P(DATA,U,2)
"RTN","IBCEF74A",110,0)
 .... I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() Q:IBQUIT
"RTN","IBCEF74A",111,0)
 .... S NODATA=0
"RTN","IBCEF74A",112,0)
 .... W !?8,"(",SEQ,") ",QUALNM,?40,IDNUM
"RTN","IBCEF74A",113,0)
 .... I Z="LAB/FAC",$D(^DGCR(399,IBIFN,"I2")),SEQ=$$COB^IBCEF(IBIFN) W ?54,"<<<Current Ins"
"RTN","IBCEF74A",114,0)
 .... I Z="BILLING PRV",PSIN=1 W ?54,"<<<System Generated ID"
"RTN","IBCEF74A",115,0)
 .... Q
"RTN","IBCEF74A",116,0)
 ... Q
"RTN","IBCEF74A",117,0)
 .. Q
"RTN","IBCEF74A",118,0)
 . Q
"RTN","IBCEF74A",119,0)
 I NODATA,'IBQUIT W !?8,"(-) None Found"
"RTN","IBCEF74A",120,0)
SECIDX ;
"RTN","IBCEF74A",121,0)
 Q
"RTN","IBCEF74A",122,0)
 ;
"RTN","IBCSCH")
0^5^B63443719^B62017089
"RTN","IBCSCH",1,0)
IBCSCH ;ALB/MJB - MCCR HELP ROUTINE ;03 JUN 88 15:25
"RTN","IBCSCH",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,106,124,138,51,148,137,161,245,232,287,348,349,374,371,395**;21-MAR-94;Build 3
"RTN","IBCSCH",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSCH",4,0)
 ;
"RTN","IBCSCH",5,0)
 ;MAP TO DGCRSCH
"RTN","IBCSCH",6,0)
 ;
"RTN","IBCSCH",7,0)
 N I,C,IBSCNNZ,IBQ,IBPRNT,Z S IBSCNNZ=$$UP^XLFSTR($G(IBSCNN)),IBQ=0
"RTN","IBCSCH",8,0)
 I '$D(IBPAR) D  Q:IBQ
"RTN","IBCSCH",9,0)
 . I $F(".?1500.?HCFA.","."_$G(IBSCNNZ)_"."),$$FT^IBCEF(IBIFN)=2 S IBQ=1,IBPRNT=2 D BL24(IBIFN,0) Q
"RTN","IBCSCH",10,0)
 . I $G(IBSCNNZ)="?SC" S IBQ=1 D DISPSC(IBIFN) Q
"RTN","IBCSCH",11,0)
 . I $G(IBSCNNZ)="?INS" S IBQ=1 D INSDSPL(IBIFN) Q
"RTN","IBCSCH",12,0)
 . I $G(IBSCNNZ)="?INX" S IBQ=1 D INSDSPLX(IBIFN) Q
"RTN","IBCSCH",13,0)
 . I $G(IBSCNNZ)="?PRV" S IBQ=1 D DISPROPT(IBIFN) Q
"RTN","IBCSCH",14,0)
 . I $G(IBSCNNZ)="?CHG" S IBQ=1 D DISPCHG^IBCRBH1(IBIFN) Q
"RTN","IBCSCH",15,0)
 . I $G(IBSCNNZ)="?PRC" S IBQ=1 D DISPPRC^IBCSCH1(IBIFN) Q
"RTN","IBCSCH",16,0)
 . I $G(IBSCNNZ)="?CPT" S IBQ=1 D BCPTCHG^IBCRBH2(IBIFN) Q
"RTN","IBCSCH",17,0)
 . I $G(IBSCNNZ)="?INC" S IBQ=1 D EDIT^IBCBB(IBIFN) Q
"RTN","IBCSCH",18,0)
 . I $G(IBSCNNZ)="?CLA",$$CK0^IBCIUT1() S IBQ=1 D CLA^IBCISC(IBIFN) Q
"RTN","IBCSCH",19,0)
 . I $G(IBSCNNZ)="?MRA",$$MCRONBIL^IBEFUNC(IBIFN),$T(SCR^IBCEMVU)'="" S IBQ=1 D SCR^IBCEMVU(IBIFN) Q
"RTN","IBCSCH",20,0)
 . I $G(IBSCNNZ)="?ID" S IBQ=1 D DISPID^IBCEF74(IBIFN) Q
"RTN","IBCSCH",21,0)
 . I $G(IBSCNNZ)="?RX" S IBQ=1 D DISPRX^IBCSCH1(IBIFN) Q
"RTN","IBCSCH",22,0)
 . Q
"RTN","IBCSCH",23,0)
 ;
"RTN","IBCSCH",24,0)
 S IBH("HELP")="" D ^IBCSCU,H^IBCSCU K IBH("HELP") W !,"Enter '^' to stop the display ",$S(IBV:"",1:"and edit "),"of data,"
"RTN","IBCSCH",25,0)
 W:'$D(IBPAR) " '^N' to jump to screen #N (see",!,"listing below), <RET> to continue on to the next available screen" I IBV W "." G M
"RTN","IBCSCH",26,0)
 W " or enter",!,"the field group number(s) you wish to edit using commas and dashes as",!,"delimiters.  Those groups enclosed in brackets ""[]"" are editable while those"
"RTN","IBCSCH",27,0)
 W !,"enclosed in arrows ""<>"" are not."
"RTN","IBCSCH",28,0)
 G:$D(IBPAR) M1
"RTN","IBCSCH",29,0)
M W "  Special help screens:"
"RTN","IBCSCH",30,0)
 W !,?5,"Enter '?SC' to view SC Status and Rated Disabilities."
"RTN","IBCSCH",31,0)
 W !,?5,"Enter '?INS' to view the patients insurance policies."
"RTN","IBCSCH",32,0)
 W !,?5,"Enter '?INX' to view the patients insurance policies with comments."
"RTN","IBCSCH",33,0)
 W !,?5,"Enter '?PRV' to view provider specific information."
"RTN","IBCSCH",34,0)
 W !,?5,"Enter '?PRC' to view all procedures on the bill and related data."
"RTN","IBCSCH",35,0)
 W !,?5,"Enter '?CHG' to view all items on the bill with potential charges."
"RTN","IBCSCH",36,0)
 W !,?5,"Enter '?CPT' to view all charges for selected CPT codes and bill type."
"RTN","IBCSCH",37,0)
 I $$FT^IBCEF(IBIFN)=2 W !,?5,"Enter '?1500' to view how block 24 will print on a CMS-1500."
"RTN","IBCSCH",38,0)
 W !,?5,"Enter '?INC' to execute the edits & view the bill inconsistencies."
"RTN","IBCSCH",39,0)
 I $$CK0^IBCIUT1() W !?5,"Enter '?CLA' to view the ClaimsManager options."
"RTN","IBCSCH",40,0)
 I $$MCRONBIL^IBEFUNC(IBIFN) W !?5,"Enter '?MRA' to view Medicare Remittance Advice EOB's on file."
"RTN","IBCSCH",41,0)
 W !,?5,"Enter '?ID' to view all IDs to be electronically transmitted on this claim."
"RTN","IBCSCH",42,0)
 W !,?5,"Enter '?RX' to view all prescriptions on this claim."
"RTN","IBCSCH",43,0)
 ;
"RTN","IBCSCH",44,0)
 I +IBSR'=9 S Z="DATA GROUPS ON SCREEN "_+IBSR W ! X IBWW D @(IBSR1_IBSR) D W
"RTN","IBCSCH",45,0)
 D S W ! F I=$Y:1:20 W !
"RTN","IBCSCH",46,0)
 S Z="PRESS <RETURN> KEY" X IBWW W " to RETURN to SCREEN ",+IBSR R X:DTIME Q
"RTN","IBCSCH",47,0)
M1 N I,Z S Z="DATA GROUPS ON PARAMETER SCREEN" W !! X IBWW D @(IBSR1_IBSR) D W W ! F I=$Y:1:20 W !
"RTN","IBCSCH",48,0)
 S Z="PRESS <RETURN> KEY" X IBWW W " to RETURN to PARAMETER SCREEN" R X:DTIME Q
"RTN","IBCSCH",49,0)
1 S X="DOB^Alias Name^Sex, Marital Status^Veteran Status, Eligibility^Address, Temporary Address^SC at Time of Care" Q
"RTN","IBCSCH",50,0)
2 S X="Patient Employer Name, Address^Spouse Employer Name, Address" Q
"RTN","IBCSCH",51,0)
3 S X="Payer Information^Provider Numbers^Mailing Address" Q
"RTN","IBCSCH",52,0)
4 S X="Admission Information^Discharge Information^Diagnosis Code(s)^Coding Method, Inpt Proc Code(s)^Occurrence Code(s)^Condition Code(s)^Value Code(s)" Q
"RTN","IBCSCH",53,0)
5 S X="Event Date^Outpatient Diagnosis^Outpatient Visits^Coding Method, Opt. Pro. Code(s)^Occurrence Code(s)^Condition Code(s)" Q
"RTN","IBCSCH",54,0)
6 S X="Bill Type, Covered/Non-Covered Days^R.O.I., Assignment of Benefits^Statement Covers Period^Bedsection, Length of Stay^Revenue Code(s), Offset, Total^Rate Schedule(s)^Prior Payments/Claims" Q
"RTN","IBCSCH",55,0)
7 S X="Bill Type, Covered/Non-Covered Days^R.O.I., Assignment of Benefits^Statement Covers Period^Outpatient Visits^Revenue Code(s), Offset, Total^Rate Schedule(s)^Prior Payments/Claims" Q
"RTN","IBCSCH",56,0)
8 S X="Bill Remark^Form Locator 2^Form Locator 9^Form Locator 27^Form Locator 45^Form Locator 92^Form Locator 93^Tx Auth. Code" Q
"RTN","IBCSCH",57,0)
9 S X="Locally defined fields" Q
"RTN","IBCSCH",58,0)
28 S X="Bill Remark, ICN/DCN's, Tx Auth. Code, Admit Diagnosis/Source ^Providers^Force to Print^Provider ID Maintenance^Other Facility (VA/non)" Q
"RTN","IBCSCH",59,0)
H8 S X="Period Unable to Work^Admit Dx, ICN/DCN, Tx/Prior Auth. Code^Providers^Non-VA Facility^Chiropractic Data^Form Locator 19^Force to Print^Provider ID Maintenance" Q
"RTN","IBCSCH",60,0)
PAR S X="Fed Tax #, BC/BS #, MAS Svc Pointer^Bill Signer, Billing Supervisor^Security Parameters, Outpatient CPT parameters ^Remarks, Mailgroups^Agent Cashier Address/Phone" Q
"RTN","IBCSCH",61,0)
S N C,I,Z,J W !! S Z="AVAILABLE SCREENS" X IBWW
"RTN","IBCSCH",62,0)
 S X="Demographic^Employment^Payer^Inpatient Event^Outpatient Event^Inpatient Billing - General^Outpatient Billing - General^Billing - Specific^Locally Defined"
"RTN","IBCSCH",63,0)
 S C=0 F I=1:1 S J=$P(X,"^",I) Q:J=""  I '$E(IBVV,I) S C=C+1,Z="^"_I,IBW=(C#2) W:'(C#2) ?41 X IBWW S Z=$S(I?1N:" ",1:" ")_J_" Data" W Z
"RTN","IBCSCH",64,0)
 Q
"RTN","IBCSCH",65,0)
W N I,J,Z
"RTN","IBCSCH",66,0)
 F I=1:1 S J=$P(X,"^",I) Q:J=""  S Z=I,IBW=(I#2) W:'(I#2) ?42 X IBWW W " "_J
"RTN","IBCSCH",67,0)
 W:'(I-1)#2 ! Q
"RTN","IBCSCH",68,0)
 Q
"RTN","IBCSCH",69,0)
 ;IBCSCH
"RTN","IBCSCH",70,0)
 ;
"RTN","IBCSCH",71,0)
 ;
"RTN","IBCSCH",72,0)
BL24(IBIFN,IBNOSHOW) ; display block 24 of CMS-1500
"RTN","IBCSCH",73,0)
 ; IBNOSHOW = 1 for not to show error/warning text line
"RTN","IBCSCH",74,0)
 N X,Y,DIR,IBPG,IBLN,IBCOL,IBX,IBQ,IBLC,IBLIN,IBPFORM,IBD,IBC1,Z,Z0,IBXDATA,IBXSAVE,IBNXPG
"RTN","IBCSCH",75,0)
 K ^TMP("IBXSAVE",$J)
"RTN","IBCSCH",76,0)
 S IBQ=0,IBLC=9 Q:'$G(IBIFN)  K ^TMP("IBXDISP",$J)
"RTN","IBCSCH",77,0)
 ;
"RTN","IBCSCH",78,0)
 S IBLIN=$$BOX24D^IBCEF11()
"RTN","IBCSCH",79,0)
 S IBPFORM=$S($P($G(^IBE(353,2,2)),U,8):$P(^(2),U,8),1:2)
"RTN","IBCSCH",80,0)
 S IBX=$$BILLN^IBCEFG0(0,"1^99",IBLIN,+IBIFN,IBPFORM)
"RTN","IBCSCH",81,0)
 ;
"RTN","IBCSCH",82,0)
 W @IOF,!,"Example of diagnoses, procedures and charges printing on the CMS-1500"
"RTN","IBCSCH",83,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",84,0)
 ;
"RTN","IBCSCH",85,0)
 ; box 19 - lines 36-37
"RTN","IBCSCH",86,0)
 F Z=+IBLIN,IBLIN+1 I $D(^TMP("IBXDISP",$J,1,Z)) S Z0=$G(^TMP("IBXDISP",$J,1,Z,+$O(^TMP("IBXDISP",$J,1,Z,20),-1))) I Z0'="" S:Z=+IBLIN Z0="BOX 19 DATA: "_Z0 W !,Z0
"RTN","IBCSCH",87,0)
 ;
"RTN","IBCSCH",88,0)
 ; box 21 - lines 39-41
"RTN","IBCSCH",89,0)
 W !,"21. diagnosis"
"RTN","IBCSCH",90,0)
 I $D(^TMP("IBXDISP",$J,2,IBLIN+3)) W ?16,"(1st 4 only)"
"RTN","IBCSCH",91,0)
 W !,?5,"1. ",$G(^TMP("IBXDISP",$J,1,IBLIN+3,3)),?25,"3. ",$G(^TMP("IBXDISP",$J,1,IBLIN+3,30))
"RTN","IBCSCH",92,0)
 W !,?5,"2. ",$G(^TMP("IBXDISP",$J,1,IBLIN+5,3)),?25,"4. ",$G(^TMP("IBXDISP",$J,1,IBLIN+5,30))
"RTN","IBCSCH",93,0)
 ;
"RTN","IBCSCH",94,0)
 ; box 24 - lines 44-55
"RTN","IBCSCH",95,0)
 D PG
"RTN","IBCSCH",96,0)
 S IBPG=0 F  S IBPG=$O(^TMP("IBXDISP",$J,IBPG)) Q:'IBPG  D  Q:IBQ
"RTN","IBCSCH",97,0)
 . I '$D(^TMP("IBXDISP",$J,IBPG,IBLIN+9)) Q   ; no line's on this page
"RTN","IBCSCH",98,0)
 . F IBLN=IBLIN+8:1:+$P(IBLIN,U,2) S IBCOL=$O(^TMP("IBXDISP",$J,IBPG,IBLN,0)) Q:'IBCOL&'$O(^TMP("IBXDISP",$J,IBPG,IBLN))  S IBLC=IBLC+1 I IBCOL D  Q:IBQ
"RTN","IBCSCH",99,0)
 .. S IBCOL=0,IBC1=1 F  S IBCOL=$O(^TMP("IBXDISP",$J,IBPG,IBLN,IBCOL)) Q:'IBCOL  I $TR($G(^(IBCOL))," ")'="" D
"RTN","IBCSCH",100,0)
 ... W:IBC1 ! S IBC1=0 W ?(IBCOL-1),$G(^TMP("IBXDISP",$J,IBPG,IBLN,IBCOL))
"RTN","IBCSCH",101,0)
 . S IBNXPG=$O(^TMP("IBXDISP",$J,IBPG))   ; next page
"RTN","IBCSCH",102,0)
 . I 'IBQ,IBNXPG,$D(^TMP("IBXDISP",$J,IBNXPG,IBLIN+9)) S IBLIN=$$BOX24D^IBCEF11(),IBQ=$$PAUSE^IBCSCH1(IBLC) Q:IBQ  S IBLC=9 W @IOF D PG
"RTN","IBCSCH",103,0)
 . Q
"RTN","IBCSCH",104,0)
 ;
"RTN","IBCSCH",105,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",106,0)
 I 'IBPG,'IBQ S IBQ=$$PAUSE^IBCSCH1(IBLC)
"RTN","IBCSCH",107,0)
 K ^TMP("IBXDISP",$J),^TMP("IBXSAVE",$J)
"RTN","IBCSCH",108,0)
 Q
"RTN","IBCSCH",109,0)
 ;
"RTN","IBCSCH",110,0)
PG ; Display box 24 letters at top of charge list
"RTN","IBCSCH",111,0)
 W !,"24. A             B  C    D                 E         F     G H I    J"
"RTN","IBCSCH",112,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",113,0)
 Q
"RTN","IBCSCH",114,0)
 ;
"RTN","IBCSCH",115,0)
INSDSPL(IBIFN) ; Display patient's policies
"RTN","IBCSCH",116,0)
 N DIR,X,Y,IBX,DFN,IBDTIN,IBCOVEXT W @IOF
"RTN","IBCSCH",117,0)
 S IBX=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IBX,U,2),IBDTIN=$P(IBX,U,3),IBCOVEXT=1
"RTN","IBCSCH",118,0)
 I +DFN D DISPDT^IBCNS W ! S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR
"RTN","IBCSCH",119,0)
 Q
"RTN","IBCSCH",120,0)
 ;
"RTN","IBCSCH",121,0)
INSDSPLX(IBIFN) ; Display patient's policies extended (?INX)
"RTN","IBCSCH",122,0)
 N IBX,DFN,IBDATE S IBX=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IBX,U,2),IBDATE=$P(IBX,U,3) D DISP^IBCNS3(DFN,IBDATE,123)
"RTN","IBCSCH",123,0)
 Q
"RTN","IBCSCH",124,0)
 ;
"RTN","IBCSCH",125,0)
DISPSC(IBIFN) ; display patients SC Status and Rated Disabilities
"RTN","IBCSCH",126,0)
 N IB0,DFN,IBSC,IBX,VAEL,VAERR
"RTN","IBCSCH",127,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IB0,U,2),IBSC=$P(IB0,U,18)
"RTN","IBCSCH",128,0)
 W !,@IOF,!,"SC Status and Rated Disabilities for ",$P($G(^DPT(+$G(DFN),0)),U,1)
"RTN","IBCSCH",129,0)
 W !,"--------------------------------------------------------------------------------",!
"RTN","IBCSCH",130,0)
 I +$G(IBIFN) W !," SC At Time Of Care: ",$S(IBSC=1:"Yes",IBSC=0:"No",1:"")
"RTN","IBCSCH",131,0)
 I +$G(DFN) D ELIG^VADPT D DIS^DGRPDB
"RTN","IBCSCH",132,0)
 W !!,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",133,0)
 S IBX=$$PAUSE^IBCSCH1(19)
"RTN","IBCSCH",134,0)
 Q
"RTN","IBCSCH",135,0)
 ;
"RTN","IBCSCH",136,0)
DISPROPT(IBIFN) ; prompt for VA or Non-VA provider.
"RTN","IBCSCH",137,0)
 N X,Y,DIR
"RTN","IBCSCH",138,0)
 S DIR(0)="SAO^V:VA PROVIDER;N:NON-VA PROVIDER",DIR("A")="(V)A or (N)on-VA Provider: ",DIR("B")="V"
"RTN","IBCSCH",139,0)
 D ^DIR
"RTN","IBCSCH",140,0)
 I Y="V" D DISPPRV^IBCSCH2(IBIFN) Q
"RTN","IBCSCH",141,0)
 I Y="N" D DISPNVA^IBCSCH2(IBIFN)
"RTN","IBCSCH",142,0)
 Q
"RTN","IBCSCH",143,0)
 ;
"RTN","IBCSCH1")
0^6^B30182718^B21600403
"RTN","IBCSCH1",1,0)
IBCSCH1 ;ALB/MRL - BILLING HELPS (CONTINUED) ; 01 JUN 88 12:00
"RTN","IBCSCH1",2,0)
 ;;2.0;INTEGRATED BILLING;**106,125,51,245,266,395**;21-MAR-94;Build 3
"RTN","IBCSCH1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSCH1",4,0)
 ;
"RTN","IBCSCH1",5,0)
 ;MAP TO DGCRSCH1
"RTN","IBCSCH1",6,0)
 ;
"RTN","IBCSCH1",7,0)
1 W !!,"DO YOU WISH TO ADD/EDIT INSURANCE COMPANY DATA FOR THIS PATIENT" S %=2 D YN^DICN S IBADI=$S(%=1!(%=-1):%,1:0)
"RTN","IBCSCH1",8,0)
 I '% W !!?4,"YES - And I'll prompt you so that you may add insurance data to the PATIENT",!?9,"file for this patient.",!?4,"NO  - To bypass this editing of the PATIENT file." G 1
"RTN","IBCSCH1",9,0)
 Q
"RTN","IBCSCH1",10,0)
 ;
"RTN","IBCSCH1",11,0)
2 W !!,"If you updated insurance information for any policy which is already specified",!,"as either a PRIMARY, SECONDARY or TERIARY for this billing episode, you will"
"RTN","IBCSCH1",12,0)
 W !,"need to press the <RETURN> key through the following prompts in order to insure",!,"that these new values are properly stored.  If you fail to do so, i.e.,"
"RTN","IBCSCH1",13,0)
 W !,"enter an up-arrow, the new values will not be stored as part of this billing",!,"record." Q
"RTN","IBCSCH1",14,0)
3 I '$D(IBIFN),$D(DA) S IBIFN=DA
"RTN","IBCSCH1",15,0)
 W !,"If a procedure is linked as a prescription to a rev code, it cannot be deleted",!
"RTN","IBCSCH1",16,0)
 W:$P(^DGCR(399,IBIFN,0),"^",5)<3 !!?4," - Enter the alphanumeric designation of your choice from",!?7,"the display (e.g. 'A1') to input one of the codes shown",!?7,"above into this billing record."
"RTN","IBCSCH1",17,0)
 I $P(^IBE(350.9,1,1),U,15)'=1 G 4
"RTN","IBCSCH1",18,0)
 S DGCODMET=$P(^DGCR(399,IBIFN,0),"^",9),DGCODMET=$S(DGCODMET=9:"ICD",DGCODMET="":"",1:"CPT")
"RTN","IBCSCH1",19,0)
 W !!?4," - Enter the name or code number of an ",$S($D(IBPY):"ICD DIAGNOSIS ",1:DGCODMET_" PROCEDURE "),"CODE",!?7,"not displayed above to input a ",$S($D(IBPY):"DIAGNOSIS",1:"PROCEDURE")," code"
"RTN","IBCSCH1",20,0)
 I $P(^DGCR(399,IBIFN,0),"^",5)>2 W "." G 4
"RTN","IBCSCH1",21,0)
 W " not found",!?7,"in the PTF record into this billing record, or '??' for ",!?7,"a list of all ",$S($D(IBPY):"ICD DIAGNOSIS ",1:DGCODMET_" PROCEDURE "),"CODES."
"RTN","IBCSCH1",22,0)
4 W !!?4," - Enter <RETURN> to accept the default ",$S($D(IBPY):"DIAGNOSIS ",1:"PROCEDURE "),"code, or",!?7,"'^' to abort.",!!
"RTN","IBCSCH1",23,0)
 K DGCODMET
"RTN","IBCSCH1",24,0)
 Q
"RTN","IBCSCH1",25,0)
 ;
"RTN","IBCSCH1",26,0)
DISPPRC(IBIFN) ; display procedures
"RTN","IBCSCH1",27,0)
 N IBHDR,IBHDR1,IBD,IBN,IBI,IBX,IBQ,IBLN,IBPR,IBPRD,IBDT,IBDV,IBCL,IBPV,IBLC,PRCARR,IBMOD,IBSUS,IBDATE
"RTN","IBCSCH1",28,0)
 S IBQ=0
"RTN","IBCSCH1",29,0)
 ;
"RTN","IBCSCH1",30,0)
 I '$O(^DGCR(399,+$G(IBIFN),"CP",0)) W !!?5,"No Codes Entered!",! D PAUSE^VALM1 Q
"RTN","IBCSCH1",31,0)
 ;
"RTN","IBCSCH1",32,0)
 S IBDATE=$$BDATE^IBACSV(IBIFN)
"RTN","IBCSCH1",33,0)
 S IBHDR="W @IOF,!,""Procedures Assigned to this Bill"",!,""Code"",?10,""Procedure"",?35,""PO"",?38,""Date"",?48,""Div"",?55,""Clinic"",?68,""Provider"" X IBHDR1"
"RTN","IBCSCH1",34,0)
 S IBHDR1="W !,""--------------------------------------------------------------------------------"" S IBLC=2"
"RTN","IBCSCH1",35,0)
 ;
"RTN","IBCSCH1",36,0)
 X IBHDR D PRCDT^IBCU71(+IBIFN,.PRCARR)
"RTN","IBCSCH1",37,0)
 S IBD="" F  S IBD=$O(PRCARR(IBD)) Q:IBD=""  D  Q:IBQ
"RTN","IBCSCH1",38,0)
 . S IBN="" F  S IBN=$O(PRCARR(IBD,IBN)) Q:IBN=""  D  Q:IBQ
"RTN","IBCSCH1",39,0)
 .. S IBI=0 F  S IBI=$O(PRCARR(IBD,IBN,IBI)) Q:'IBI  D  I IBLC>19 S IBQ=$$PAUSE(IBLC) Q:IBQ  X IBHDR
"RTN","IBCSCH1",40,0)
 ... S IBLN=$G(PRCARR(IBD,IBN,IBI)),(IBPR,IBPRD,IBDT,IBDV,IBCL,IBPV,IBSUS)="",IBLC=IBLC+1
"RTN","IBCSCH1",41,0)
 ... S IBX=$$PRCNM($P(IBLN,U,1),IBD),IBPR=$P(IBX,U,1),IBPRD=$P(IBX,U,2)
"RTN","IBCSCH1",42,0)
 ... S IBDT=$P(IBLN,U,2),IBDT=$E(IBDT,4,5)_"/"_$E(IBDT,6,7)_"/"_$E(IBDT,2,3)
"RTN","IBCSCH1",43,0)
 ... I +$P(IBLN,U,6) S IBDV=$P($G(^DG(40.8,+$P(IBLN,U,6),0)),U,2)
"RTN","IBCSCH1",44,0)
 ... I +$P(IBLN,U,7) S IBCL=$P($G(^SC(+$P(IBLN,U,7),0)),U,1)
"RTN","IBCSCH1",45,0)
 ... I +$P(IBLN,U,18) S IBPV=$P($G(^VA(200,+$P(IBLN,U,18),0)),U,1)
"RTN","IBCSCH1",46,0)
 ... I +$P(IBLN,U,16) S IBSUS=$P(IBLN,U,16)_"mn"
"RTN","IBCSCH1",47,0)
 ... I +$P(IBLN,U,21) S IBSUS=$P(IBLN,U,21)_"ml"
"RTN","IBCSCH1",48,0)
 ... I +$P(IBLN,U,22) S IBSUS=$P(IBLN,U,22)_"hr"
"RTN","IBCSCH1",49,0)
 ... ;
"RTN","IBCSCH1",50,0)
 ... W !,$E(IBPR,1,6),?7,$E(IBPRD,1,20),?29,IBSUS,?35,$P(IBLN,U,4),?38,IBDT,?48,IBDV,?55,$E(IBCL,1,11),?68,$E(IBPV,1,12)
"RTN","IBCSCH1",51,0)
 ... S IBX=$$MODLST^IBEFUNC2($$GETMOD^IBEFUNC(IBIFN,IBI),1,.IBX,IBD)
"RTN","IBCSCH1",52,0)
 ... I IBX'="" F IBMOD=1:1:$L(IBX,",") W !,?10,$P(IBX,",",IBMOD),?15,$P($G(IBX(1)),",",IBMOD) S IBLC=IBLC+1
"RTN","IBCSCH1",53,0)
 I 'IBI,'IBQ S IBQ=$$PAUSE(IBLC)
"RTN","IBCSCH1",54,0)
 Q
"RTN","IBCSCH1",55,0)
 ;
"RTN","IBCSCH1",56,0)
PRCNM(PRC,EFDT) ; return procedure name, input first piece of CP node -
"RTN","IBCSCH1",57,0)
 ;                                        (in variable pointer format)
"RTN","IBCSCH1",58,0)
 ; output: code ^ name
"RTN","IBCSCH1",59,0)
 N IBNM
"RTN","IBCSCH1",60,0)
 S IBNM=$$PRCD^IBCEF1($G(PRC),1,$G(EFDT))
"RTN","IBCSCH1",61,0)
 I $TR(IBNM,U)="" D
"RTN","IBCSCH1",62,0)
 . S IBNM="NO ENTRY FOUND^"
"RTN","IBCSCH1",63,0)
 E  D
"RTN","IBCSCH1",64,0)
 . S IBNM=$P(IBNM,U,2,3)
"RTN","IBCSCH1",65,0)
 Q IBNM
"RTN","IBCSCH1",66,0)
 ;
"RTN","IBCSCH1",67,0)
PAUSE(CNT) ;
"RTN","IBCSCH1",68,0)
 N IBI F IBI=CNT:1:20 W !
"RTN","IBCSCH1",69,0)
 N DIR,DUOUT,DTOUT,DIRUT,IBX,X,Y S IBX=0,DIR(0)="E" D ^DIR K DIR I $D(DIRUT) S IBX=1
"RTN","IBCSCH1",70,0)
 Q IBX
"RTN","IBCSCH1",71,0)
 ;
"RTN","IBCSCH1",72,0)
DISPRX(IBIFN) ; display prescriptions
"RTN","IBCSCH1",73,0)
 N IBHDR,IBHDR1,IBX,IBZ,IBRXL,IBNPI,IBRX,IBQ,IBORG
"RTN","IBCSCH1",74,0)
 S IBQ=0
"RTN","IBCSCH1",75,0)
 ;
"RTN","IBCSCH1",76,0)
 I '$O(^IBA(362.4,"AIFN"_IBIFN,0)) W !!?5,"No Prescriptions Entered!",! D PAUSE^VALM1 Q
"RTN","IBCSCH1",77,0)
 ;
"RTN","IBCSCH1",78,0)
 ; get NPIs
"RTN","IBCSCH1",79,0)
 S IBX=$$RXSITE^IBCEF73A(IBIFN,.IBRXL)
"RTN","IBCSCH1",80,0)
 ;
"RTN","IBCSCH1",81,0)
 S IBHDR="W @IOF,!,""Prescriptions Assigned to this Bill"" X IBHDR1"
"RTN","IBCSCH1",82,0)
 S IBHDR1="W !,""--------------------------------------------------------------------------------"" "
"RTN","IBCSCH1",83,0)
 ;
"RTN","IBCSCH1",84,0)
 X IBHDR
"RTN","IBCSCH1",85,0)
 S IBRX=0 F  S IBRX=$O(^IBA(362.4,"AIFN"_IBIFN,IBRX)) Q:'IBRX!(IBQ)  S IBX=0 F  S IBX=$O(^IBA(362.4,"AIFN"_IBIFN,IBRX,IBX)) Q:'IBX!(IBQ)  D
"RTN","IBCSCH1",86,0)
 . S IBZ=$G(^IBA(362.4,IBX,0))
"RTN","IBCSCH1",87,0)
 . W !?5,"RX #: ",$P(IBZ,"^")
"RTN","IBCSCH1",88,0)
 . W ?50,"DATE: ",$$FMTE^XLFDT($P(IBZ,"^",3))
"RTN","IBCSCH1",89,0)
 . W !?5,"DRUG: ",$$EXTERNAL^DILFD(362.4,.04,"",$P(IBZ,"^",4))
"RTN","IBCSCH1",90,0)
 . W ?50,"NDC: ",$P(IBZ,"^",8)
"RTN","IBCSCH1",91,0)
 . W !?5,"DAYS SUPPLY: ",$P(IBZ,"^",6)
"RTN","IBCSCH1",92,0)
 . W ?50,"QUANTITY: ",$P(IBZ,"^",7)
"RTN","IBCSCH1",93,0)
 . S IBORG=$G(IBRXL(+$P(IBZ,"^",5),+$P(IBZ,"^",3)))
"RTN","IBCSCH1",94,0)
 . ; ia #4532
"RTN","IBCSCH1",95,0)
 . S IBNPI=$S(IBORG:$P($$NPI^XUSNPI("Organization_ID",IBORG),U),1:"")
"RTN","IBCSCH1",96,0)
 . W !?5,"NPI INSTITUTION: ",$S(IBORG:$$EXTERNAL^DILFD(350.9,.02,"",IBORG),1:"")
"RTN","IBCSCH1",97,0)
 . W ?50,"RX NPI: ",$S(IBNPI>0:IBNPI,1:"")
"RTN","IBCSCH1",98,0)
 . W !?5,"PROVIDER: ",$S($P(IBZ,"^",5):$$RXAPI1^IBNCPUT1($P(IBZ,"^",5),4),1:""),!
"RTN","IBCSCH1",99,0)
 . I $Y+7>IOSL S IBQ=$$PAUSE(0)
"RTN","IBCSCH1",100,0)
 D PAUSE^VALM1
"RTN","IBCSCH1",101,0)
 ;
"RTN","IBCSCH1",102,0)
 Q
"RTN","IBCSCH1",103,0)
 ;
"VER")
8.0^22.0
"BLD",7560,6)
^359
**END**
**END**
