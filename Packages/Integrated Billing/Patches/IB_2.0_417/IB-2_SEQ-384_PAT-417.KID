EMERGENCY Released IB*2*417 SEQ #384
Extracted from mail message
**KIDS**:IB*2.0*417^

**INSTALL NAME**
IB*2.0*417
"BLD",8097,0)
IB*2.0*417^INTEGRATED BILLING^0^3090812^y
"BLD",8097,1,0)
^^2^2^3090804^
"BLD",8097,1,1,0)
This patch is to exclude the MRA's filing errors from the MRA patient
"BLD",8097,1,2,0)
responsibility calculation.
"BLD",8097,4,0)
^9.64PA^^0
"BLD",8097,6.3)
6
"BLD",8097,"ABPKG")
n
"BLD",8097,"KRN",0)
^9.67PA^779.2^20
"BLD",8097,"KRN",.4,0)
.4
"BLD",8097,"KRN",.401,0)
.401
"BLD",8097,"KRN",.402,0)
.402
"BLD",8097,"KRN",.403,0)
.403
"BLD",8097,"KRN",.5,0)
.5
"BLD",8097,"KRN",.84,0)
.84
"BLD",8097,"KRN",3.6,0)
3.6
"BLD",8097,"KRN",3.8,0)
3.8
"BLD",8097,"KRN",9.2,0)
9.2
"BLD",8097,"KRN",9.8,0)
9.8
"BLD",8097,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",8097,"KRN",9.8,"NM",1,0)
IBCECOB5^^0^B13879653
"BLD",8097,"KRN",9.8,"NM",2,0)
IBCECOB1^^0^B69046565
"BLD",8097,"KRN",9.8,"NM",3,0)
IBCEU0^^0^B63678448
"BLD",8097,"KRN",9.8,"NM",4,0)
IBCECSA6^^0^B88419993
"BLD",8097,"KRN",9.8,"NM",5,0)
IBJTBA1^^0^B27347491
"BLD",8097,"KRN",9.8,"NM","B","IBCECOB1",2)

"BLD",8097,"KRN",9.8,"NM","B","IBCECOB5",1)

"BLD",8097,"KRN",9.8,"NM","B","IBCECSA6",4)

"BLD",8097,"KRN",9.8,"NM","B","IBCEU0",3)

"BLD",8097,"KRN",9.8,"NM","B","IBJTBA1",5)

"BLD",8097,"KRN",19,0)
19
"BLD",8097,"KRN",19.1,0)
19.1
"BLD",8097,"KRN",101,0)
101
"BLD",8097,"KRN",409.61,0)
409.61
"BLD",8097,"KRN",771,0)
771
"BLD",8097,"KRN",779.2,0)
779.2
"BLD",8097,"KRN",870,0)
870
"BLD",8097,"KRN",8989.51,0)
8989.51
"BLD",8097,"KRN",8989.52,0)
8989.52
"BLD",8097,"KRN",8994,0)
8994
"BLD",8097,"KRN","B",.4,.4)

"BLD",8097,"KRN","B",.401,.401)

"BLD",8097,"KRN","B",.402,.402)

"BLD",8097,"KRN","B",.403,.403)

"BLD",8097,"KRN","B",.5,.5)

"BLD",8097,"KRN","B",.84,.84)

"BLD",8097,"KRN","B",3.6,3.6)

"BLD",8097,"KRN","B",3.8,3.8)

"BLD",8097,"KRN","B",9.2,9.2)

"BLD",8097,"KRN","B",9.8,9.8)

"BLD",8097,"KRN","B",19,19)

"BLD",8097,"KRN","B",19.1,19.1)

"BLD",8097,"KRN","B",101,101)

"BLD",8097,"KRN","B",409.61,409.61)

"BLD",8097,"KRN","B",771,771)

"BLD",8097,"KRN","B",779.2,779.2)

"BLD",8097,"KRN","B",870,870)

"BLD",8097,"KRN","B",8989.51,8989.51)

"BLD",8097,"KRN","B",8989.52,8989.52)

"BLD",8097,"KRN","B",8994,8994)

"BLD",8097,"QUES",0)
^9.62^^
"BLD",8097,"REQB",0)
^9.611^3^2
"BLD",8097,"REQB",2,0)
IB*2.0*349^2
"BLD",8097,"REQB",3,0)
IB*2.0*377^2
"BLD",8097,"REQB","B","IB*2.0*349",2)

"BLD",8097,"REQB","B","IB*2.0*377",3)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
417^3090812
"PKG",200,22,1,"PAH",1,1,0)
^^2^2^3090812
"PKG",200,22,1,"PAH",1,1,1,0)
This patch is to exclude the MRA's filing errors from the MRA patient
"PKG",200,22,1,"PAH",1,1,2,0)
responsibility calculation.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","IBCECOB1")
0^2^B69046565^B68510086
"RTN","IBCECOB1",1,0)
IBCECOB1 ;ALB/CXW - IB COB MANAGEMENT SCREEN/REPORT ;14-JUN-99
"RTN","IBCECOB1",2,0)
 ;;2.0;INTEGRATED BILLING;**137,155,288,348,377,417**;21-MAR-94;Build 6
"RTN","IBCECOB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCECOB1",4,0)
 ;
"RTN","IBCECOB1",5,0)
BLD ; Build list entrypoint
"RTN","IBCECOB1",6,0)
 N I,IBFND,IBB,IBIFN,IB364,IBDA1,IBDTN,IBDA,IBDAY,IBHIS,IBNDS,IBEUT,IBAPY,IBOAM,IBDT,IBMUT,IBBPY,IBINS,IBNDM,IBQ,IBNDI1,IBNDI2,IBNDI3,Z,Z0,IBSEQ,IB3611,IBINS1,IBINS2,IBEXPY,IBNBAL,IBPTRSP,IBAMT,IBMRACNT,IBPTNM,IBSRVC,IBPY,IBB364
"RTN","IBCECOB1",7,0)
 N IBEOBREV,IBDENDUP
"RTN","IBCECOB1",8,0)
 K ^TMP("IBCECOB",$J),^TMP("IBCECOB1",$J),^TMP("IBCOBST",$J),^TMP("IBCOBSTX",$J)
"RTN","IBCECOB1",9,0)
 D CLEAN^VALM10      ; kill data and video control arrays
"RTN","IBCECOB1",10,0)
 S VALMCNT=0,IBHIS=""
"RTN","IBCECOB1",11,0)
 ; since 0 is a valid Review Status, init w/null
"RTN","IBCECOB1",12,0)
 S IBEOBREV=""
"RTN","IBCECOB1",13,0)
 ; get EOB's w/Review Status of 0, 1, 1.5 or 2; If 3 or higher, not needed
"RTN","IBCECOB1",14,0)
 F  S IBEOBREV=$O(^IBM(361.1,"AMRA",1,IBEOBREV)) Q:IBEOBREV=""  Q:IBEOBREV>2  D  ;
"RTN","IBCECOB1",15,0)
 . S IBDA="A" F  S IBDA=$O(^IBM(361.1,"AMRA",1,IBEOBREV,IBDA),-1) Q:'IBDA  D BLD1
"RTN","IBCECOB1",16,0)
 ; no data accumulated
"RTN","IBCECOB1",17,0)
 I $O(^TMP("IBCOBST",$J,""))="" D NMAT Q
"RTN","IBCECOB1",18,0)
 ; display accumulated data
"RTN","IBCECOB1",19,0)
 D SCRN
"RTN","IBCECOB1",20,0)
 Q
"RTN","IBCECOB1",21,0)
BLD1 ;
"RTN","IBCECOB1",22,0)
 I '$$ELIG(IBDA) Q
"RTN","IBCECOB1",23,0)
 S IBDENDUP=$$DENDUP^IBCEMU4(IBDA)
"RTN","IBCECOB1",24,0)
 I '$G(IBMRADUP),IBDENDUP Q     ; don't include denied MRAs for Duplicate Claim/Service
"RTN","IBCECOB1",25,0)
 S IB3611=$G(^IBM(361.1,IBDA,0))
"RTN","IBCECOB1",26,0)
 S IBIFN=+IB3611,IB364=$P(IB3611,U,19),IBDT=+$P(IB3611,U,6)
"RTN","IBCECOB1",27,0)
 I $D(^TMP("IBCOBSTX",$J,IBIFN)) Q  ;show each bill once on the worklist
"RTN","IBCECOB1",28,0)
 S IBB=$G(^DGCR(399,IBIFN,0))
"RTN","IBCECOB1",29,0)
 S IBNDS=$G(^DGCR(399,IBIFN,"S")),IBNDI1=$G(^("I1")),IBNDI2=$G(^("I2")),IBNDI3=$G(^("I3")),IBNDM=$G(^("M"))
"RTN","IBCECOB1",30,0)
 S IBMUT=+$P(IBNDS,U,8),IBEUT=+$P(IBNDS,U,2)
"RTN","IBCECOB1",31,0)
 S IBINS="",IBSEQ=$P(IB3611,U,15)
"RTN","IBCECOB1",32,0)
 F I=1:1:3 S Z="IBNDI"_I I @Z D
"RTN","IBCECOB1",33,0)
 . N Q
"RTN","IBCECOB1",34,0)
 . S Q=(IBSEQ=I)
"RTN","IBCECOB1",35,0)
 . I Q S IBINS1=+@Z_U_$P($G(^DIC(36,+@Z,0)),U)
"RTN","IBCECOB1",36,0)
 . S IBINS=IBINS_$S(IBINS="":"",1:", ")_$P($G(^DIC(36,+@Z,0)),U)
"RTN","IBCECOB1",37,0)
 ; Get the payer/insurance company that comes after Medicare WNR
"RTN","IBCECOB1",38,0)
 ; If WNR is Primary, get the secondary ins. co.
"RTN","IBCECOB1",39,0)
 ; If WNR is secondary, get the tertiary ins. co.
"RTN","IBCECOB1",40,0)
 D  I $P(IBINS2,U,2)="" S $P(IBINS2,U,2)="UNKNOWN"
"RTN","IBCECOB1",41,0)
 . I $$WNRBILL^IBEFUNC(IBIFN,1) S IBINS2=+IBNDI2_U_$P($G(^DIC(36,+IBNDI2,0)),U) Q
"RTN","IBCECOB1",42,0)
 . S IBINS2=+IBNDI3_U_$P($G(^DIC(36,+IBNDI3,0)),U)
"RTN","IBCECOB1",43,0)
 S IBFND=0
"RTN","IBCECOB1",44,0)
 ; biller entry not ALL and no biller, then get entered/edited by user
"RTN","IBCECOB1",45,0)
 I $D(^TMP("IBBIL",$J)) D  Q:'IBFND
"RTN","IBCECOB1",46,0)
 . S IBFND=$S($D(^TMP("IBBIL",$J,IBMUT)):IBMUT,$D(^TMP("IBBIL",$J,IBEUT)):IBEUT,1:0)
"RTN","IBCECOB1",47,0)
 S Z=$S(IBFND:IBFND,IBMUT:IBMUT,1:IBEUT)
"RTN","IBCECOB1",48,0)
 S IBMUT=$P($G(^VA(200,+Z,0)),U)_"~"_Z
"RTN","IBCECOB1",49,0)
 S:'$P(IBMUT,"~",2) IBMUT="UNKNOWN~0"
"RTN","IBCECOB1",50,0)
 S IBBPY=+$$COBN^IBCEF(IBIFN),IBQ=1
"RTN","IBCECOB1",51,0)
 ;IBQ;1=EOB without subsequent insurer,0=COB,2=0 balance
"RTN","IBCECOB1",52,0)
 D  ;I IBQ Q
"RTN","IBCECOB1",53,0)
 . ;Check for no reimbursable subsequent insurance
"RTN","IBCECOB1",54,0)
 .  F I=IBBPY+1:1:3 D  Q:'IBQ
"RTN","IBCECOB1",55,0)
 .. S Z="IBNDI"_I,Z=$G(@Z)
"RTN","IBCECOB1",56,0)
 .. I $P($G(^DIC(36,+Z,0)),U,2)="N" S IBQ=0 Q
"RTN","IBCECOB1",57,0)
 . ;Check if next ins doesn't exist or next bill# already created
"RTN","IBCECOB1",58,0)
 . S Z="IBNDI"_(IBBPY+1),Z=$G(@Z)
"RTN","IBCECOB1",59,0)
 . I Z,'$P($G(^DGCR(399,IBIFN,"M1")),U,5+IBBPY) S IBQ=0
"RTN","IBCECOB1",60,0)
 ;
"RTN","IBCECOB1",61,0)
 ; Days since transmission of latest bill in COB - IBDAY
"RTN","IBCECOB1",62,0)
 S IBDAY=+$P($G(^DGCR(399,IBIFN,"TX")),U,2) I IBDAY S IBDAY=$$FMDIFF^XLFDT(DT,IBDAY,1)
"RTN","IBCECOB1",63,0)
 ; if no Last Electronic Extract Date on file 399, get it from file 364
"RTN","IBCECOB1",64,0)
 I 'IBDAY D  I IBDAY S IBDAY=$$FMDIFF^XLFDT(DT,IBDAY,1) ;calc. the difference
"RTN","IBCECOB1",65,0)
 . S IBB364=$$LAST364^IBCEF4(IBIFN) I IBB364'="" S IBDAY=+$P($P($G(^IBA(364,IBB364,0)),U,4),".",1)
"RTN","IBCECOB1",66,0)
 ;
"RTN","IBCECOB1",67,0)
 S IBAPY=$$TPR^PRCAFN(IBIFN) ; payment on this bill from A/R
"RTN","IBCECOB1",68,0)
 S IBEXPY=+$G(^IBM(361.1,IBDA,1))       ; payer paid amount
"RTN","IBCECOB1",69,0)
 S IBPTRSP=$$PREOBTOT^IBCEU0(IBIFN)     ; patient resp. function
"RTN","IBCECOB1",70,0)
 S IBPY=$S(IBAPY:IBAPY,1:IBEXPY)
"RTN","IBCECOB1",71,0)
 S IBOAM=+$G(^DGCR(399,IBIFN,"U1"))     ; total charges for bill
"RTN","IBCECOB1",72,0)
 S IBNBAL=IBOAM-IBPY
"RTN","IBCECOB1",73,0)
 I IBNBAL'>0 S IBQ=2
"RTN","IBCECOB1",74,0)
 S IBPTNM=$P($G(^DPT(+$P($G(^DGCR(399,IBIFN,0)),U,2),0)),U) I IBPTNM="" S IBPTNM="UNKNOWN"
"RTN","IBCECOB1",75,0)
 S IBSRVC=$P($G(^DGCR(399,IBIFN,"U")),U)
"RTN","IBCECOB1",76,0)
 S Z0=$S(IBSRT="B":IBMUT,IBSRT="D":-IBDAY,IBSRT="I":$P(IBINS2,U,2)_"~"_$P(IBINS2,U),IBSRT="M":$$EXTERNAL^DILFD(361.1,.13,"",$P(IB3611,"^",13)),IBSRT="R":-IBPTRSP,IBSRT="P":IBPTNM,IBSRT="S":IBSRVC,1:IBDT)
"RTN","IBCECOB1",77,0)
 S ^TMP("IBCOBST",$J,Z0,IBIFN)=IBSRVC_U_IBOAM_U_IBAPY_U_$S(IBNBAL>0:IBNBAL,1:0)_U_$P(IBB,U,5)_U_$P(IBB,U,19)_U_IBBPY_U_$P(IBMUT,"~")_U_IBINS_U_IBDA_U_$$HIS(IBIFN)_U_IBDAY_U_IBDT_U_IBQ_U_IB364_U_IBSEQ_U_IBEXPY_U_IBPTRSP
"RTN","IBCECOB1",78,0)
 S ^TMP("IBCOBST",$J,Z0,IBIFN,1)=$$EXTERNAL^DILFD(361.1,.13,"",$P(IB3611,"^",13))_", "_$$FMTE^XLFDT($P($P(IB3611,"^",6),"."))_"^"_$P(IB3611,"^",16)
"RTN","IBCECOB1",79,0)
 S ^TMP("IBCOBSTX",$J,IBIFN)=IBDA  ;keep track of compiled IBIFN's
"RTN","IBCECOB1",80,0)
 ;
"RTN","IBCECOB1",81,0)
 ; Save some data when there are multiple MRA's on file for this bill
"RTN","IBCECOB1",82,0)
 S IBMRACNT=$$MRACNT^IBCEMU1(IBIFN)
"RTN","IBCECOB1",83,0)
 I IBMRACNT>1 S $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,1)="Multiple MRA's on file"
"RTN","IBCECOB1",84,0)
 S $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,3)=IBMRACNT
"RTN","IBCECOB1",85,0)
 S $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,4)=IBDENDUP
"RTN","IBCECOB1",86,0)
 Q
"RTN","IBCECOB1",87,0)
 ;
"RTN","IBCECOB1",88,0)
HIS(IBIFN) ; COB history
"RTN","IBCECOB1",89,0)
 N A,B,IBST,IBBIL,IBHIS
"RTN","IBCECOB1",90,0)
 S IBHIS="",A=0 F  S A=$O(^IBM(361.1,"ABS",IBIFN,A)) Q:'A  S B=0 F  S B=$O(^IBM(361.1,"ABS",IBIFN,A,B)) Q:'B  D
"RTN","IBCECOB1",91,0)
 . S IBST=$P($G(^IBM(361.1,B,0)),U,4),IBBIL=$P(^DGCR(399,IBIFN,"M1"),U,4+A)
"RTN","IBCECOB1",92,0)
 . Q:IBBIL=""
"RTN","IBCECOB1",93,0)
 . S IBHIS=IBHIS_$S(IBHIS="":"",1:";")_$S(A=1:"PRIMARY",A=2:"SECONDARY",1:"TERTIARY")_" "_$S(IBST:"MRA",1:"EOB")_" RECEIVED - "_IBBIL
"RTN","IBCECOB1",94,0)
 Q IBHIS
"RTN","IBCECOB1",95,0)
 ;
"RTN","IBCECOB1",96,0)
NMAT ;No COB list
"RTN","IBCECOB1",97,0)
 S VALMCNT=2,IBCNT=2
"RTN","IBCECOB1",98,0)
 S ^TMP("IBCECOB",$J,1,0)=" "
"RTN","IBCECOB1",99,0)
 S ^TMP("IBCECOB",$J,2,0)="    No MRA's Matching Selection Criteria Were Found"
"RTN","IBCECOB1",100,0)
 Q
"RTN","IBCECOB1",101,0)
 ;
"RTN","IBCECOB1",102,0)
SCRN ;
"RTN","IBCECOB1",103,0)
 N IBX,IBCNT,IBIFN,IBDA,IB,X,IBS1,IBPAT,Z,IBK,IBFORM
"RTN","IBCECOB1",104,0)
 S IBCNT=0
"RTN","IBCECOB1",105,0)
 S IBS1=$S(IBSRT="B":"BILLER",IBSRT="D":"Days Since Last Transmission",IBSRT="L":"Date Last MRA Received",IBSRT="I":"SECONDARY INSURANCE COMPANY",IBSRT="M":"MRA Status",1:"")
"RTN","IBCECOB1",106,0)
 S IBX="" F  S IBX=$O(^TMP("IBCOBST",$J,IBX)) Q:IBX=""  D
"RTN","IBCECOB1",107,0)
 . I IBSRT="B"!(IBSRT="I")!(IBSRT="M") D
"RTN","IBCECOB1",108,0)
 .. D:IBCNT SET("",IBCNT+1)
"RTN","IBCECOB1",109,0)
 .. D SET(IBS1_": "_$P(IBX,"~"),IBCNT+1)
"RTN","IBCECOB1",110,0)
 . S IBIFN=0 F  S IBIFN=$O(^TMP("IBCOBST",$J,IBX,IBIFN)) Q:'IBIFN  D
"RTN","IBCECOB1",111,0)
 .. S IB=$G(^TMP("IBCOBST",$J,IBX,IBIFN))
"RTN","IBCECOB1",112,0)
 .. S Z=$G(^DPT(+$P($G(^DGCR(399,IBIFN,0)),U,2),0))
"RTN","IBCECOB1",113,0)
 .. S IBPAT=$$LJ^XLFSTR($E($P(Z,U),1,18),18," ")_" "_$E($P(Z,U,9),6,9)
"RTN","IBCECOB1",114,0)
 .. S IBDA=$P(IB,U,10) ;361.1-ien
"RTN","IBCECOB1",115,0)
 .. S IBQ=$P(IB,U,14),IB364=$P(IB,U,15)
"RTN","IBCECOB1",116,0)
 .. S IBFORM=$$EXTERNAL^DILFD(399,.19,,+$P(IB,U,6))
"RTN","IBCECOB1",117,0)
 .. I +$P(IB,U,6)=2 S IBFORM=1500   ; for space reasons
"RTN","IBCECOB1",118,0)
 .. S IBPTRSP=$P(IB,U,18)
"RTN","IBCECOB1",119,0)
 .. S IBAMT=$P(IB,U,2)
"RTN","IBCECOB1",120,0)
 .. S IBCNT=IBCNT+1
"RTN","IBCECOB1",121,0)
 .. S X=""
"RTN","IBCECOB1",122,0)
 .. S X=$$SETFLD^VALM1(IBCNT,X,"NUMBER")
"RTN","IBCECOB1",123,0)
 .. S X=$$SETFLD^VALM1($$BN1^PRCAFN(IBIFN)_$S($P($G(^DGCR(399,IBIFN,"TX")),U,10)=1:"*",1:""),X,"BILL")
"RTN","IBCECOB1",124,0)
 .. S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IB,U)),X,"SERVICE")
"RTN","IBCECOB1",125,0)
 .. S X=$$SETFLD^VALM1(IBPAT,X,"PATNM")
"RTN","IBCECOB1",126,0)
 .. S X=$$SETFLD^VALM1($$RJ^XLFSTR($FN(IBPTRSP,"",2),9," "),X,"PTRESP")
"RTN","IBCECOB1",127,0)
 .. S X=$$SETFLD^VALM1($$RJ^XLFSTR($FN(IBAMT,"",2),9," "),X,"IBAMT")
"RTN","IBCECOB1",128,0)
 .. S X=$$SETFLD^VALM1($$TYPE^IBJTLA1($P(IB,U,5))_"/"_IBFORM,X,"BTYPE")
"RTN","IBCECOB1",129,0)
 .. D SET(X,IBCNT,IBIFN,IBDA,IBQ,IB364,IBX,IB)
"RTN","IBCECOB1",130,0)
 .. ;For R (Pt Resp), P (Pt Name) and S (Service Date) don't display sub-headers
"RTN","IBCECOB1",131,0)
 .. I "BIMRPS"'[IBSRT D
"RTN","IBCECOB1",132,0)
 ... S Z=$S(IBSRT="L":$$DAT1^IBOUTL(IBX),IBSRT="D":-IBX,1:IBX)
"RTN","IBCECOB1",133,0)
 ... D SET("   "_IBS1_": "_Z,IBCNT)
"RTN","IBCECOB1",134,0)
 .. S X=$$SETSTR^VALM1("Insurers:  "_$P(IB,U,9),"",7,74)
"RTN","IBCECOB1",135,0)
 .. D SET(X,IBCNT,IBIFN,IBDA,IBQ,IB364,IBX,IB)
"RTN","IBCECOB1",136,0)
 .. ;
"RTN","IBCECOB1",137,0)
 .. ; line 3 of display:  MRA status/date/split claim indicator
"RTN","IBCECOB1",138,0)
 .. S X=$$SETSTR^VALM1("MRA Status:  ","",5,13)
"RTN","IBCECOB1",139,0)
 .. S IBK=$G(^TMP("IBCOBST",$J,IBX,IBIFN,1))
"RTN","IBCECOB1",140,0)
 .. S X=$$SETSTR^VALM1($P(IBK,U,1),X,18,63)
"RTN","IBCECOB1",141,0)
 .. I $P(IBK,U,2)=2 S X=$$SETSTR^VALM1("** SPLIT CLAIM **",X,63,18)
"RTN","IBCECOB1",142,0)
 .. I $P(IBK,U,4),$P(IBK,U,2)'=2,$P(IBK,U,3)=1 S X=$$SETSTR^VALM1("** Denied for Duplicate **",X,54,27)
"RTN","IBCECOB1",143,0)
 .. D SET(X,IBCNT,IBIFN,IBDA,IBQ,IB364,IBX,IB)
"RTN","IBCECOB1",144,0)
 .. ;
"RTN","IBCECOB1",145,0)
 .. ; conditionally update video attributes of line 3
"RTN","IBCECOB1",146,0)
 .. I '$D(IOINHI) D ENS^%ZISS
"RTN","IBCECOB1",147,0)
 .. ; split claim
"RTN","IBCECOB1",148,0)
 .. I $P(IBK,U,2)=2 D CNTRL^VALM10(VALMCNT,63,17,IOINHI,IOINORM)
"RTN","IBCECOB1",149,0)
 .. ; multiple mra's on file
"RTN","IBCECOB1",150,0)
 .. I $P(IBK,U,3)>1 D CNTRL^VALM10(VALMCNT,18,22,IOINHI,IOINORM)
"RTN","IBCECOB1",151,0)
 .. ; Denied for Duplicate - no split claim and single MRA only
"RTN","IBCECOB1",152,0)
 .. I $P(IBK,U,4),$P(IBK,U,2)'=2,$P(IBK,U,3)=1 D CNTRL^VALM10(VALMCNT,54,26,IOINHI,IOINORM)
"RTN","IBCECOB1",153,0)
 .. Q
"RTN","IBCECOB1",154,0)
 Q
"RTN","IBCECOB1",155,0)
 ;
"RTN","IBCECOB1",156,0)
SET(X,CNT,IBIFN,IBDA,IBQ,IB364,IBX,IB) ;set up list manager screen array
"RTN","IBCECOB1",157,0)
 S VALMCNT=VALMCNT+1
"RTN","IBCECOB1",158,0)
 S ^TMP("IBCECOB",$J,VALMCNT,0)=X
"RTN","IBCECOB1",159,0)
 S ^TMP("IBCECOB",$J,"IDX",VALMCNT,CNT)=""
"RTN","IBCECOB1",160,0)
 I $G(IBIFN),$G(^TMP("IBCECOB",$J,CNT))="" S ^TMP("IBCECOB",$J,CNT)=VALMCNT_U_IBIFN_U_IB364_U_IBDA_U_IBQ_U_IBX,^TMP("IBCECOB1",$J,CNT)=IB
"RTN","IBCECOB1",161,0)
 Q
"RTN","IBCECOB1",162,0)
 ;
"RTN","IBCECOB1",163,0)
FTYPE(Y) ;type classification
"RTN","IBCECOB1",164,0)
 Q $E($P($G(^IBE(353,Y,0)),U),1,8)
"RTN","IBCECOB1",165,0)
 ;
"RTN","IBCECOB1",166,0)
PTRESPI(IBEOB) ; Function - Computes the Patient's Responsibility based on IBEOB
"RTN","IBCECOB1",167,0)
 ; of 361.1 for Claims/Bills with form type 3=UB
"RTN","IBCECOB1",168,0)
 ; Input IBEOB - a single EOB ien; Required
"RTN","IBCECOB1",169,0)
 ; Output      - Function Returns IBPTRES - Patient Responsibility Amount for the EOB
"RTN","IBCECOB1",170,0)
 ;
"RTN","IBCECOB1",171,0)
 N IBPTRES,IBC,EOBADJ
"RTN","IBCECOB1",172,0)
 S IBPTRES=0,IBEOB=+$G(IBEOB)
"RTN","IBCECOB1",173,0)
 I 'IBEOB Q IBPTRES   ;PTRESPI
"RTN","IBCECOB1",174,0)
 ; filing error
"RTN","IBCECOB1",175,0)
 Q:$D(^IBM(361.1,IBEOB,"ERR")) IBPTRES
"RTN","IBCECOB1",176,0)
 ;
"RTN","IBCECOB1",177,0)
 ; get claim level adjustments
"RTN","IBCECOB1",178,0)
 K EOBADJ M EOBADJ=^IBM(361.1,IBEOB,10)
"RTN","IBCECOB1",179,0)
 S IBPTRES=$$CALCPR^IBCEU0(.EOBADJ)
"RTN","IBCECOB1",180,0)
 ;
"RTN","IBCECOB1",181,0)
 ; get line level adjustments
"RTN","IBCECOB1",182,0)
 S IBC=0 F  S IBC=$O(^IBM(361.1,IBEOB,15,IBC)) Q:'IBC  D
"RTN","IBCECOB1",183,0)
 . K EOBADJ M EOBADJ=^IBM(361.1,IBEOB,15,IBC,1)
"RTN","IBCECOB1",184,0)
 . S IBPTRES=IBPTRES+$$CALCPR^IBCEU0(.EOBADJ)
"RTN","IBCECOB1",185,0)
 Q IBPTRES
"RTN","IBCECOB1",186,0)
 ;
"RTN","IBCECOB1",187,0)
ELIG(IBEOB) ; Function to determine if an EOB entry is eligible for
"RTN","IBCECOB1",188,0)
 ; inclusion on the MRA management worklist or not.
"RTN","IBCECOB1",189,0)
 ; IBEOB - ien into file 361.1 (required)
"RTN","IBCECOB1",190,0)
 ; Returns 1 if EOB should appear on the worklist
"RTN","IBCECOB1",191,0)
 ; Returns 0 if EOB should not appear on the worklist
"RTN","IBCECOB1",192,0)
 ;
"RTN","IBCECOB1",193,0)
 NEW ELIG,IB3611,IBIFN
"RTN","IBCECOB1",194,0)
 S ELIG=0,IBEOB=+$G(IBEOB)
"RTN","IBCECOB1",195,0)
 S IB3611=$G(^IBM(361.1,IBEOB,0))
"RTN","IBCECOB1",196,0)
 I $P(IB3611,U,4)'=1 G ELIGX    ; eob type must be Medicare MRA
"RTN","IBCECOB1",197,0)
 I $P(IB3611,U,16)>2 G ELIGX    ; review status must be <= 2
"RTN","IBCECOB1",198,0)
 S IBIFN=+IB3611
"RTN","IBCECOB1",199,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)'=2 G ELIGX  ; Request MRA bill status
"RTN","IBCECOB1",200,0)
 I $D(^IBM(361.1,IBEOB,"ERR")) G ELIGX         ; filing errors
"RTN","IBCECOB1",201,0)
 ;
"RTN","IBCECOB1",202,0)
 S ELIG=1    ; this EOB is eligible for the worklist
"RTN","IBCECOB1",203,0)
 ;
"RTN","IBCECOB1",204,0)
ELIGX ;
"RTN","IBCECOB1",205,0)
 Q ELIG
"RTN","IBCECOB1",206,0)
 ;
"RTN","IBCECOB5")
0^1^B13879653^B13398553
"RTN","IBCECOB5",1,0)
IBCECOB5 ;ALB/TMP - IB COB MANAGEMENT SCREEN ;31-JAN-01
"RTN","IBCECOB5",2,0)
 ;;2.0;INTEGRATED BILLING;**137,155,349,417**;21-MAR-94;Build 6
"RTN","IBCECOB5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCECOB5",4,0)
 ;
"RTN","IBCECOB5",5,0)
INIT ;
"RTN","IBCECOB5",6,0)
 S IBDA=+$O(IBDA(0))
"RTN","IBCECOB5",7,0)
 Q:'IBDA
"RTN","IBCECOB5",8,0)
 D BLD(IBDA)
"RTN","IBCECOB5",9,0)
 S VALMBG=1
"RTN","IBCECOB5",10,0)
 Q
"RTN","IBCECOB5",11,0)
 ;
"RTN","IBCECOB5",12,0)
BLD(IBDA) ; Build list entrypoint
"RTN","IBCECOB5",13,0)
 N IB,IBIFN,IBVCNT,X,Z,IBCNT,CNT,IBREC,IBIFN1,IBPTRESP
"RTN","IBCECOB5",14,0)
 K ^TMP("IBCECOB-X",$J)
"RTN","IBCECOB5",15,0)
 S VALMCNT=0
"RTN","IBCECOB5",16,0)
 S IB=$G(^TMP("IBCECOB1",$J,IBDA)),IBCNT=$P(IB,"^",10)
"RTN","IBCECOB5",17,0)
 S IBVCNT=$G(^TMP("IBCECOB",$J,IBDA)),IBIFN=$P(IBVCNT,U,2),IBVCNT=+IBVCNT
"RTN","IBCECOB5",18,0)
 Q:'IBVCNT
"RTN","IBCECOB5",19,0)
 S Z=IBVCNT-1
"RTN","IBCECOB5",20,0)
 F  S Z=$O(^TMP("IBCECOB",$J,"IDX",Z)) Q:'Z!('$D(^TMP("IBCECOB",$J,"IDX",+Z,IBDA)))  D SET($G(^TMP("IBCECOB",$J,Z,0)))
"RTN","IBCECOB5",21,0)
 D SET("")
"RTN","IBCECOB5",22,0)
 S X=$E(" Original Billed Amt: $"_$$A10^IBCECSA5(+$P(IB,U,2))_$J("",40),1,40)
"RTN","IBCECOB5",23,0)
 S X=X_$S($G(IBSRC):"   Total A/R Payments: $"_$$A10^IBCECSA5($P(IB,U,3)),1:"Unreimburse Medicare Exp: $"_$$A10^IBCECSA5(+$G(^IBM(361.1,IBCNT,1))))
"RTN","IBCECOB5",24,0)
 D SET(X)
"RTN","IBCECOB5",25,0)
 ;
"RTN","IBCECOB5",26,0)
 S IBIFN1=$P($G(^IBM(361.1,IBCNT,0)),U,1)      ; bill#
"RTN","IBCECOB5",27,0)
 ; filing error
"RTN","IBCECOB5",28,0)
 S IBPTRESP=$P($G(^IBM(361.1,IBCNT,1)),U,2)    ; Pt Resp Amt 1.02 field
"RTN","IBCECOB5",29,0)
 S:$D(^IBM(361.1,IBCNT,"ERR")) IBPTRESP=0      ; filing error
"RTN","IBCECOB5",30,0)
 ; Override Pt Resp Amt for bills with Form Type UB-04
"RTN","IBCECOB5",31,0)
 I $$FT^IBCEF(IBIFN1)=3 S IBPTRESP=$$PTRESPI^IBCECOB1(IBCNT)
"RTN","IBCECOB5",32,0)
 ;
"RTN","IBCECOB5",33,0)
 S X=$E($S($G(IBSRC):"        Bill Balance: $"_$$A10^IBCECSA5(+$P(IB,U,4)),1:" Pt Resp Amt:         $"_$$A10^IBCECSA5(IBPTRESP))_$J("",40),1,40)
"RTN","IBCECOB5",34,0)
 I '$G(IBSRC) N IBCALC,IBIFN S IBIFN=+$G(^IBM(361.1,IBCNT,0)) D MRACALC^IBCEMU2(IBCNT,IBIFN,0,.IBCALC)
"RTN","IBCECOB5",35,0)
 S X=X_$S($G(IBSRC):"       Total Amt This EOB: $"_$$A10^IBCECSA5($P(IB,U,17)),1:"   Medicare Contract Adj: $"_$$A10^IBCECSA5($G(IBCALC("MEDCA"))))
"RTN","IBCECOB5",36,0)
 D SET(X)
"RTN","IBCECOB5",37,0)
 D SET("")
"RTN","IBCECOB5",38,0)
 I $G(IBSRC) D
"RTN","IBCECOB5",39,0)
 . S X=" Days Since Last Transmit: "_+$P(IB,U,12)
"RTN","IBCECOB5",40,0)
 . D SET(X)
"RTN","IBCECOB5",41,0)
 . S X="       Authorizing Biller: "_$P(IB,U,8)
"RTN","IBCECOB5",42,0)
 . D SET(X)
"RTN","IBCECOB5",43,0)
 . S X="              COB History: "
"RTN","IBCECOB5",44,0)
 . I $P(IB,U,11)'="" D
"RTN","IBCECOB5",45,0)
 .. F Z=1:1:$L($P(IB,U,11),";") S X=X_$P($P(IB,U,11),";",Z) D SET(X) S X=$J("",27)
"RTN","IBCECOB5",46,0)
 . E  D
"RTN","IBCECOB5",47,0)
 .. S X=X_"NONE FOUND" D SET(X)
"RTN","IBCECOB5",48,0)
 I '$G(IBSRC) S CNT=20,IBREC=$G(^IBM(361.1,IBCNT,0)) K ^TMP("IBCECSD",$J) D MRALLA^IBCECSA5 M ^TMP("IBCECOB-X",$J)=^TMP("IBCECSD",$J) K ^TMP("IBCECSD",$J)
"RTN","IBCECOB5",49,0)
 ;
"RTN","IBCECOB5",50,0)
 Q
"RTN","IBCECOB5",51,0)
 ;
"RTN","IBCECOB5",52,0)
EXIT ; -- exit code --
"RTN","IBCECOB5",53,0)
 K ^TMP("IBCECOB-X",$J),IBDA
"RTN","IBCECOB5",54,0)
 D CLEAN^VALM10
"RTN","IBCECOB5",55,0)
 Q
"RTN","IBCECOB5",56,0)
 ;
"RTN","IBCECOB5",57,0)
HDR1 ; -- header code
"RTN","IBCECOB5",58,0)
 ; Assume IBIFN and IBZIEN are defined
"RTN","IBCECOB5",59,0)
 N IBCOB,IBINS
"RTN","IBCECOB5",60,0)
 K VALMHDR
"RTN","IBCECOB5",61,0)
 S IBINS=$$FINDINS^IBCEF1(IBIFN)
"RTN","IBCECOB5",62,0)
 S VALMHDR(1)=IORVON_" BILL #:"_$$BN^PRCAFN(IBIFN)_IORVOFF
"RTN","IBCECOB5",63,0)
 S VALMHDR(1)=$J("",80-$L(VALMHDR(1))\2)_VALMHDR(1)
"RTN","IBCECOB5",64,0)
 S VALMHDR(2)="  INSURANCE COMPANY: "_$P($G(^DIC(36,+IBINS,0)),U)
"RTN","IBCECOB5",65,0)
 S VALMHDR(3)="  "_IOUON_"Svc Date  Patient Name/Last 4           Care Type/Form  COB/SEQ"_IOUOFF
"RTN","IBCECOB5",66,0)
 S Z=$G(^TMP("IBCECOB",$J,IBZIEN,0))
"RTN","IBCECOB5",67,0)
 S VALMHDR(4)="  "_$E(Z,17,$L(Z))
"RTN","IBCECOB5",68,0)
 Q
"RTN","IBCECOB5",69,0)
 ;
"RTN","IBCECOB5",70,0)
EXIT1 ; -- exit code --
"RTN","IBCECOB5",71,0)
 K ^TMP("IBCECSD",$J)
"RTN","IBCECOB5",72,0)
 D CLEAN^VALM10
"RTN","IBCECOB5",73,0)
 Q
"RTN","IBCECOB5",74,0)
 ;
"RTN","IBCECOB5",75,0)
VEOB ;View an EOB from EOB Management
"RTN","IBCECOB5",76,0)
 N IBDA,IBCNT,IBIFN,Z,VALMCNT,IBZIEN,IBONE
"RTN","IBCECOB5",77,0)
 ;
"RTN","IBCECOB5",78,0)
 D FULL^VALM1
"RTN","IBCECOB5",79,0)
 D SEL^IBCECOB2(.IBDA,1)
"RTN","IBCECOB5",80,0)
 S IBDA=+$O(IBDA(0))
"RTN","IBCECOB5",81,0)
 I IBDA D EN^VALM("IBCEM EOB VIEW EOB")
"RTN","IBCECOB5",82,0)
 S VALMBCK="R"
"RTN","IBCECOB5",83,0)
 Q
"RTN","IBCECOB5",84,0)
 ;
"RTN","IBCECOB5",85,0)
INIT1 ;
"RTN","IBCECOB5",86,0)
 S IBCNT=+$P($G(IBDA(IBDA)),U,3)
"RTN","IBCECOB5",87,0)
 S IBIFN=+$G(IBDA(IBDA)),IBZIEN=+$G(^TMP("IBCECOB",$J,IBDA)),IBONE=1
"RTN","IBCECOB5",88,0)
 Q:'IBCNT!'IBIFN!'IBZIEN
"RTN","IBCECOB5",89,0)
 D HDR1
"RTN","IBCECOB5",90,0)
 D BLD^IBCECSA6
"RTN","IBCECOB5",91,0)
 Q
"RTN","IBCECOB5",92,0)
 ;
"RTN","IBCECOB5",93,0)
SET(X) ;set up list manager screen array
"RTN","IBCECOB5",94,0)
 S VALMCNT=VALMCNT+1
"RTN","IBCECOB5",95,0)
 S ^TMP("IBCECOB-X",$J,VALMCNT,0)=X
"RTN","IBCECOB5",96,0)
 Q
"RTN","IBCECOB5",97,0)
 ;
"RTN","IBCECSA6")
0^4^B88419993^B87864497
"RTN","IBCECSA6",1,0)
IBCECSA6 ;ALB/CXW - VIEW EOB SCREEN ;01-OCT-1999
"RTN","IBCECSA6",2,0)
 ;;2.0;INTEGRATED BILLING;**137,135,155,417**;21-MAR-1994;Build 6
"RTN","IBCECSA6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCECSA6",4,0)
 ;
"RTN","IBCECSA6",5,0)
BLD ;build EOB data display
"RTN","IBCECSA6",6,0)
 D GETEOB(IBCNT,0)
"RTN","IBCECSA6",7,0)
 Q
"RTN","IBCECSA6",8,0)
 ;
"RTN","IBCECSA6",9,0)
GETEOB(IBCNT,IBSRC,IBFULL,IBJTIBLN) ; Get EOB data in display format
"RTN","IBCECSA6",10,0)
 ; IBCNT = the ien of the entry in file 361.1
"RTN","IBCECSA6",11,0)
 ; IBSRC = 1 if called from AR, 0 if List Manager format needed
"RTN","IBCECSA6",12,0)
 ;       = 2 if called from AR and header data is desired
"RTN","IBCECSA6",13,0)
 ;   If IBSRC > 0  ^TMP("PRCA_EOB",$J,IBCNT,n)=line n's text is ret'd
"RTN","IBCECSA6",14,0)
 ; IBFULL = 1 if no check should be made to eliminate a fld whose value=0
"RTN","IBCECSA6",15,0)
 ; IBJTIBLN = line number to start VALMCNT with (optional)
"RTN","IBCECSA6",16,0)
 ;            used by IBJTBA1
"RTN","IBCECSA6",17,0)
 ;
"RTN","IBCECSA6",18,0)
 N IBREC,IBTYP,CNT,IBREM
"RTN","IBCECSA6",19,0)
 S IBFULL=$G(IBFULL),IBSRC=$G(IBSRC)
"RTN","IBCECSA6",20,0)
 I IBSRC N VALMBG,VALMCNT
"RTN","IBCECSA6",21,0)
 S VALMCNT=0,VALMBG=1,CNT=0
"RTN","IBCECSA6",22,0)
 I $G(IBJTIBLN)>0 S VALMCNT=IBJTIBLN
"RTN","IBCECSA6",23,0)
 S IBREC=$G(^IBM(361.1,IBCNT,0)),IBTYP=$P(IBREC,U,4)
"RTN","IBCECSA6",24,0)
 I IBSRC K ^TMP("PRCA_EOB",$J,IBCNT)
"RTN","IBCECSA6",25,0)
 ; Once we're displaying a single EOB, remove the multiple EOB header of 
"RTN","IBCECSA6",26,0)
 ; the View EOB screen that was set in HDR^IBCEOB2 - VALMHDR(4).
"RTN","IBCECSA6",27,0)
 I 'IBSRC,$G(VALMHDR(4))'="" S VALMHDR(4)=""
"RTN","IBCECSA6",28,0)
 D GEN,PAY,ARCP^IBCECSA7,CLVL,CLVLA,MIN^IBCECSA5,MOUT,LLVLA^IBCECSA7,RDATA^IBCECSA7
"RTN","IBCECSA6",29,0)
 Q
"RTN","IBCECSA6",30,0)
 ;
"RTN","IBCECSA6",31,0)
SEL(IB,ONE) ;
"RTN","IBCECSA6",32,0)
 N IBDA
"RTN","IBCECSA6",33,0)
 D EN^VALM2($G(XQORNOD(0)),$S('$G(ONE):"",1:"S"))
"RTN","IBCECSA6",34,0)
 S IBDA=0 S IBDA=$O(VALMY(IBDA)) Q:'IBDA  D
"RTN","IBCECSA6",35,0)
 . S IB=$P($G(^TMP("IBCECSD",$J,IBDA)),U,2)
"RTN","IBCECSA6",36,0)
 . S IBONE=1
"RTN","IBCECSA6",37,0)
 Q
"RTN","IBCECSA6",38,0)
 ;
"RTN","IBCECSA6",39,0)
ACT ; Reposition display using actions
"RTN","IBCECSA6",40,0)
 I '$G(IBONE) D SEL(.IBCNT,1) D BLD:$G(IBCNT)
"RTN","IBCECSA6",41,0)
 S VALMBG=$G(^TMP("IBCECSD",$J,"X",+$G(IBACT))) S:'VALMBG VALMBG=1
"RTN","IBCECSA6",42,0)
 S VALMBCK="R"
"RTN","IBCECSA6",43,0)
 Q
"RTN","IBCECSA6",44,0)
 ;
"RTN","IBCECSA6",45,0)
SET(IBSRC,X,CNT,IBCNT) ;set list manager arrays
"RTN","IBCECSA6",46,0)
 S VALMCNT=VALMCNT+1,IBSRC=$G(IBSRC)
"RTN","IBCECSA6",47,0)
 ;
"RTN","IBCECSA6",48,0)
 I IBSRC D  Q
"RTN","IBCECSA6",49,0)
 . S ^TMP("PRCA_EOB",$J,IBCNT,VALMCNT)=X
"RTN","IBCECSA6",50,0)
 ;
"RTN","IBCECSA6",51,0)
 S ^TMP("IBCECSD",$J,VALMCNT,0)=X
"RTN","IBCECSA6",52,0)
 S ^TMP("IBCECSD",$J,"IDX",VALMCNT,CNT)=""
"RTN","IBCECSA6",53,0)
 S ^TMP("IBCECSD",$J,CNT)=VALMCNT_U_IBCNT
"RTN","IBCECSA6",54,0)
 Q
"RTN","IBCECSA6",55,0)
 ;
"RTN","IBCECSA6",56,0)
GEN ;
"RTN","IBCECSA6",57,0)
 S IBSRC=$G(IBSRC) Q:IBSRC=1
"RTN","IBCECSA6",58,0)
 N IBREC1,IBTMP,IBSPL
"RTN","IBCECSA6",59,0)
 S IBSPL=+$O(^IBM(361.1,IBCNT,8,0)),IBSPL=(+$O(^(IBSPL))'=IBSPL)
"RTN","IBCECSA6",60,0)
 S IB=$$SETSTR^VALM1("EOB GENERAL INFORMATION:","",1,50)
"RTN","IBCECSA6",61,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",62,0)
 I 'IBSRC D
"RTN","IBCECSA6",63,0)
 . D CNTRL^VALM10(VALMCNT,1,24,IORVON,IORVOFF)
"RTN","IBCECSA6",64,0)
 . S ^TMP("IBCECSD",$J,"X",1)=VALMCNT
"RTN","IBCECSA6",65,0)
 S IB=$$SETSTR^VALM1("Type        : "_$S(IBTYP:"MEDICARE MRA",1:"NORMAL EOB")_$S(IBSPL:" (SPLIT IN A/R)",1:""),"",2,39)
"RTN","IBCECSA6",66,0)
 S IB=$$SETSTR^VALM1("EOB Paid DT  : "_$$DAT1^IBOUTL($P(IBREC,U,6),1),IB,41,38)
"RTN","IBCECSA6",67,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",68,0)
 I IBSRC D
"RTN","IBCECSA6",69,0)
 . S IB=$$SETSTR^VALM1($S(IBSRC:"Entry Dt/Tm :"_$$DAT1^IBOUTL($P(IBREC,U,5),1),1:""),"",2,39)
"RTN","IBCECSA6",70,0)
 . S IBTMP=$P(IBREC,U,13)
"RTN","IBCECSA6",71,0)
 . S IB=$$SETSTR^VALM1("Claim Status : "_$$EXTERNAL^DILFD(361.1,.13,"",IBTMP),IB,41,38)
"RTN","IBCECSA6",72,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",73,0)
 . S IBTMP=$P(IBREC,U,16)
"RTN","IBCECSA6",74,0)
 . S IB=$$SETSTR^VALM1("Review Status: "_$$EXTERNAL^DILFD(361.1,.16,"",IBTMP),IB,41,38)
"RTN","IBCECSA6",75,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",76,0)
 . S IB=$$SETSTR^VALM1("Entered By  : "_$P($G(^VA(200,+$P(IBREC,U,18),0)),U),"",2,39)
"RTN","IBCECSA6",77,0)
 . S IBTMP=$P(IBREC,U,15)
"RTN","IBCECSA6",78,0)
 . S IB=$$SETSTR^VALM1("Insurance Seq: "_$$EXTERNAL^DILFD(361.1,.15,"",IBTMP),IB,41,38)
"RTN","IBCECSA6",79,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",80,0)
 I 'IBSRC D
"RTN","IBCECSA6",81,0)
 . S IB=$$SETSTR^VALM1($S($P(IBREC,U,17):"Manual Entry: YES",1:""),"",2,39)
"RTN","IBCECSA6",82,0)
 . S IBTMP=$P(IBREC,U,13)
"RTN","IBCECSA6",83,0)
 . S IB=$$SETSTR^VALM1("Claim Status : "_$$EXTERNAL^DILFD(361.1,.13,"",IBTMP),IB,41,38)
"RTN","IBCECSA6",84,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",85,0)
 . S IBTMP=$P(IBREC,U,15)
"RTN","IBCECSA6",86,0)
 . S IB=$$SETSTR^VALM1("Insurance Seq: "_$$EXTERNAL^DILFD(361.1,.15,"",IBTMP),"",41,38)
"RTN","IBCECSA6",87,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",88,0)
 S IBREC1=$G(^IBM(361.1,IBCNT,100))
"RTN","IBCECSA6",89,0)
 I $S($G(IBFULL):1,1:$P(IBREC1,U,4)'=""!($P(IBREC1,U,3)'="")) D
"RTN","IBCECSA6",90,0)
 . S IB=$$SETSTR^VALM1("Last Edited : "_$$DAT1^IBOUTL($P(IBREC1,U,4),1),"",2,39)
"RTN","IBCECSA6",91,0)
 . S IB=$$SETSTR^VALM1("Last Edit By : "_$P($G(^VA(200,+$P(IBREC1,U,3),0)),U),IB,41,38)
"RTN","IBCECSA6",92,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",93,0)
 ;
"RTN","IBCECSA6",94,0)
 D INSINF^IBCECSA7(+IBREC,CNT,IBCNT)
"RTN","IBCECSA6",95,0)
 ;
"RTN","IBCECSA6",96,0)
 I $S($G(IBFULL):1,1:$P($G(^IBM(361.1,IBCNT,6)),U)'=""!($P($G(^IBM(361.1,IBCNT,6)),U,2)'="")) D
"RTN","IBCECSA6",97,0)
 . S IB=$$SETSTR^VALM1("New Pat. Nm.: "_$P($G(^IBM(361.1,IBCNT,6)),U),"",2,39)
"RTN","IBCECSA6",98,0)
 . S IB=$$SETSTR^VALM1("New Pat. Id  : "_$P($G(^IBM(361.1,IBCNT,6)),U,2),IB,41,38)
"RTN","IBCECSA6",99,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",100,0)
 D:IBSRC SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",101,0)
 Q
"RTN","IBCECSA6",102,0)
 ;
"RTN","IBCECSA6",103,0)
PAY ;
"RTN","IBCECSA6",104,0)
 S IBSRC=$G(IBSRC) Q:IBSRC=1
"RTN","IBCECSA6",105,0)
 N IBREC1,IBTMP
"RTN","IBCECSA6",106,0)
 S IB=$$SETSTR^VALM1("PAYER INFORMATION:","",1,50)
"RTN","IBCECSA6",107,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",108,0)
 I 'IBSRC D
"RTN","IBCECSA6",109,0)
 . D CNTRL^VALM10(VALMCNT,1,18,IORVON,IORVOFF)
"RTN","IBCECSA6",110,0)
 . S ^TMP("IBCECSD",$J,"X",2)=VALMCNT
"RTN","IBCECSA6",111,0)
 S IB=$$SETSTR^VALM1("Payer Name   : "_$P($G(^DIC(36,+$P(IBREC,U,2),0)),U),"",2,39)
"RTN","IBCECSA6",112,0)
 S IB=$$SETSTR^VALM1("Payer Id    : "_$P(IBREC,U,3),IB,41,38)
"RTN","IBCECSA6",113,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",114,0)
 S IB=$$SETSTR^VALM1("ICN          : "_$P(IBREC,U,14),"",2,39)
"RTN","IBCECSA6",115,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",116,0)
 I $P(IBREC,U,9)'=""!($P(IBREC,U,8)'="") D
"RTN","IBCECSA6",117,0)
 . S IB=$$SETSTR^VALM1("Cross Ovr ID : "_$P(IBREC,U,9),"",2,39)
"RTN","IBCECSA6",118,0)
 . S IB=$$SETSTR^VALM1("Cross Ovr Nm: "_$P(IBREC,U,8),IB,41,38)
"RTN","IBCECSA6",119,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",120,0)
 D:IBSRC SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",121,0)
 Q
"RTN","IBCECSA6",122,0)
 ;
"RTN","IBCECSA6",123,0)
CLVL ;
"RTN","IBCECSA6",124,0)
 N IBREC1,IBTMP,IBRL
"RTN","IBCECSA6",125,0)
 S IB=$$SETSTR^VALM1("CLAIM LEVEL PAY STATUS:","",1,50),IBSRC=$G(IBSRC)
"RTN","IBCECSA6",126,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",127,0)
 I 'IBSRC D
"RTN","IBCECSA6",128,0)
 . D CNTRL^VALM10(VALMCNT,1,23,IORVON,IORVOFF)
"RTN","IBCECSA6",129,0)
 . S ^TMP("IBCECSD",$J,"X",3)=VALMCNT
"RTN","IBCECSA6",130,0)
 I '$D(^IBM(361.1,IBCNT,2)),'$D(^IBM(361.1,IBCNT,1)) D SET(IBSRC," NONE",CNT,IBCNT) Q
"RTN","IBCECSA6",131,0)
 S IB=$$SETSTR^VALM1("Tot Submitted Chrg: "_$$A10($P($G(^IBM(361.1,IBCNT,2)),U,4)),"",2,39)
"RTN","IBCECSA6",132,0)
 S IBREC1=$G(^IBM(361.1,IBCNT,1))
"RTN","IBCECSA6",133,0)
 S IB=$$SETSTR^VALM1("Covered Amt       : "_$$A10($P(IBREC1,U,3)),IB,41,38)
"RTN","IBCECSA6",134,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",135,0)
 S IB=$$SETSTR^VALM1("Payer Paid Amt    : "_$$A10($P(IBREC1,U)),"",2,39)
"RTN","IBCECSA6",136,0)
 S IB=$$SETSTR^VALM1("Patient Resp. Amt : "_$$A10($S($D(^IBM(361.1,IBCNT,"ERR")):0,IBSRC:$P(IBREC1,U,2),$$FT^IBCEF(+IBREC)=3:$$PTRESPI^IBCECOB1(IBCNT),1:$P($G(^IBM(361.1,IBCNT,1)),"^",2))),IB,41,38)
"RTN","IBCECSA6",137,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",138,0)
 S (IB,IBRL)=""
"RTN","IBCECSA6",139,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,4)) S IB=$$SETSTR^VALM1("Discount Amt      : "_$$A10($P(IBREC1,U,4)),"",2,39),IBRL=1
"RTN","IBCECSA6",140,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,5)) S IB=$$SETSTR^VALM1("Per Day Limit Amt : "_$$A10($P(IBREC1,U,5)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",141,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,8)) S IB=$$SETSTR^VALM1("Tax Amt           : "_$$A10($P(IBREC1,U,8)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",142,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,9)) S IB=$$SETSTR^VALM1("Tot Before Tax Amt: "_$$A10($P(IBREC1,U,9)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",143,0)
 I $S(IBFULL:1,1:$P($G(^IBM(361.1,IBCNT,2)),U,3)) S IB=$$SETSTR^VALM1("Total Allowed Amt : "_$$A10($P($G(^IBM(361.1,IBCNT,2)),U,3)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",144,0)
 I $S(IBFULL:1,1:$P($G(^IBM(361.1,IBCNT,2)),U,5)) S IB=$$SETSTR^VALM1("Negative Reimb Amt: "_$$A10($P($G(^IBM(361.1,IBCNT,2)),U,5)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",145,0)
 I $G(IBSRC) I $S(IBFULL:1,1:$P(IBREC,U,12)) S IB=$$SETSTR^VALM1("Discharge Fraction: "_$$A10($P(IBREC,U,12)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",146,0)
 I $S(IBFULL:1,1:$P(IBREC,U,10)) S IB=$$SETSTR^VALM1("DRG Code Used     :"_$$RJ^XLFSTR($P(IBREC,U,10),11," "),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",147,0)
 I $S(IBFULL:1,1:$P(IBREC,U,11)) S IB=$$SETSTR^VALM1("DRG Weight Used   :"_$$RJ^XLFSTR($P(IBREC,U,11),11," "),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",148,0)
 D:IBRL'="" SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",149,0)
 D:IBSRC SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",150,0)
 Q
"RTN","IBCECSA6",151,0)
 ;
"RTN","IBCECSA6",152,0)
MOUT ;
"RTN","IBCECSA6",153,0)
 N IBREC1,IBRL
"RTN","IBCECSA6",154,0)
 S IBREC1=$G(^IBM(361.1,IBCNT,3)),IBSRC=$G(IBSRC)
"RTN","IBCECSA6",155,0)
 I 'IBSRC,$$INPAT^IBCEF(+IBREC),$TR(IBREC1,"0^")="" Q
"RTN","IBCECSA6",156,0)
 I IBREC1="" D:'$D(^IBM(361.1,IBCNT,4)) SET(IBSRC,"  NONE",CNT,IBCNT) D:'IBSRC SET(IBSRC,"",CNT,IBCNT),REMARK^IBCECSA5 Q
"RTN","IBCECSA6",157,0)
 D SET(IBSRC," OUTPATIENT:",CNT,IBCNT)
"RTN","IBCECSA6",158,0)
 S IBRL=""
"RTN","IBCECSA6",159,0)
 I $S(IBFULL:1,1:$P(IBREC1,U)) S IB=$$SETSTR^VALM1("Reimburse Rate    : "_$$P10($P(IBREC1,U)),"",$S('IBRL:4,1:40),$S('IBRL:41,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",160,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,2)) S IB=$$SETSTR^VALM1("HCPCS Pay Amt     : "_$$A10($P(IBREC1,U,2)),IB,$S('IBRL:4,1:40),$S('IBRL:41,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",161,0)
 D:IBRL=0 SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",162,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,8)) S IB=$$SETSTR^VALM1("Esrd Paid Amt     : "_$$A10($P(IBREC1,U,8)),"",$S('IBRL:4,1:40),$S('IBRL:41,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",163,0)
 D:IBRL=0 SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",164,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,9)) S IB=$$SETSTR^VALM1("Non-Pay Prof Comp : "_$$A10($P(IBREC1,U,9)),IB,$S('IBRL:4,1:40),$S('IBRL:41,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",165,0)
 D:IBRL'="" SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",166,0)
 D REMARK^IBCECSA5
"RTN","IBCECSA6",167,0)
 D SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",168,0)
 Q
"RTN","IBCECSA6",169,0)
 ;
"RTN","IBCECSA6",170,0)
CLVLA ;
"RTN","IBCECSA6",171,0)
 N IBREC,IBFLG,GR,RSN,Z
"RTN","IBCECSA6",172,0)
 S IB=$$SETSTR^VALM1("CLAIM LEVEL ADJUSTMENTS:","",1,50),IBSRC=$G(IBSRC)
"RTN","IBCECSA6",173,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",174,0)
 I 'IBSRC D
"RTN","IBCECSA6",175,0)
 . D CNTRL^VALM10(VALMCNT,1,24,IORVON,IORVOFF)
"RTN","IBCECSA6",176,0)
 . S ^TMP("IBCECSD",$J,"X",4)=VALMCNT
"RTN","IBCECSA6",177,0)
 S (Y,IBFLG)=0 F  S Y=$O(^IBM(361.1,IBCNT,10,Y)) Q:'Y  D
"RTN","IBCECSA6",178,0)
 . S IBREC=$G(^IBM(361.1,IBCNT,10,Y,0)),GR=$P(IBREC,U,1)
"RTN","IBCECSA6",179,0)
 . I GR="OA",$P($G(^IBM(361.1,IBCNT,10,Y,1,0)),U,4)=1,$D(^IBM(361.1,IBCNT,10,Y,1,"B","AB3")) Q   ; kludge
"RTN","IBCECSA6",180,0)
 . S IBREC=$$EXTERNAL^DILFD(361.11,.01,"",GR),IBFLG=1
"RTN","IBCECSA6",181,0)
 . D SET(IBSRC," GROUP CODE: "_IBREC,CNT,IBCNT)
"RTN","IBCECSA6",182,0)
 . S Z=0 F  S Z=$O(^IBM(361.1,IBCNT,10,Y,1,Z)) Q:'Z  D
"RTN","IBCECSA6",183,0)
 .. S IBREC=$G(^IBM(361.1,IBCNT,10,Y,1,Z,0)),RSN=$P(IBREC,U,1)
"RTN","IBCECSA6",184,0)
 .. I GR="OA",RSN="AB3" Q   ; kludge
"RTN","IBCECSA6",185,0)
 .. S IB=$$SETSTR^VALM1("REASON CODE: "_RSN_"  "_$P(IBREC,U,4),"",3,77)
"RTN","IBCECSA6",186,0)
 .. D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",187,0)
 .. S IB=$$SETSTR^VALM1("Amount: "_$$A10($P(IBREC,U,2)),"",3,40)
"RTN","IBCECSA6",188,0)
 .. S IB=$$SETSTR^VALM1("Quantity: "_$P(IBREC,U,3),IB,41,38)
"RTN","IBCECSA6",189,0)
 .. D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",190,0)
 I 'IBFLG D SET(IBSRC," NONE",CNT,IBCNT)
"RTN","IBCECSA6",191,0)
 D:IBSRC SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",192,0)
 Q
"RTN","IBCECSA6",193,0)
 ;
"RTN","IBCECSA6",194,0)
A10(X) ; returns a dollar amount right justified to 10 characters
"RTN","IBCECSA6",195,0)
 Q $$RJ^XLFSTR($FN(X,"",2),10," ")
"RTN","IBCECSA6",196,0)
 ;
"RTN","IBCECSA6",197,0)
P10(X) ; returns a % right just 10
"RTN","IBCECSA6",198,0)
 ; X is a decimal between 0-1
"RTN","IBCECSA6",199,0)
 Q $$RJ^XLFSTR((X*100)_"%",10," ")
"RTN","IBCECSA6",200,0)
 ;
"RTN","IBCEU0")
0^3^B63678448^B62153346
"RTN","IBCEU0",1,0)
IBCEU0 ;ALB/TMP - EDI UTILITIES ;02-OCT-96
"RTN","IBCEU0",2,0)
 ;;2.0;INTEGRATED BILLING;**137,197,155,296,349,417**;21-MAR-94;Build 6
"RTN","IBCEU0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEU0",4,0)
 ;
"RTN","IBCEU0",5,0)
NOTECHG(IBDA,IBNTEXT) ; Enter who/when review stat change was entered
"RTN","IBCEU0",6,0)
 ; IBDA = ien of entry in file 361.1
"RTN","IBCEU0",7,0)
 ; IBNTEXT = array containing the lines of text to store if not using the
"RTN","IBCEU0",8,0)
 ;           default text  IBNTEXT = # of lines  IBNTEXT(#)=line text
"RTN","IBCEU0",9,0)
 N IBIEN,IBTEXT,DA,X,Y,DIC,DO,DLAYGO,DD
"RTN","IBCEU0",10,0)
 S DA(1)=IBDA,DIC="^IBM(361.1,"_DA(1)_",2,",DIC(0)="L",DLAYGO=361.121
"RTN","IBCEU0",11,0)
 S X=$$NOW^XLFDT
"RTN","IBCEU0",12,0)
 D FILE^DICN K DIC,DD,DO,DLAYGO
"RTN","IBCEU0",13,0)
 Q:Y'>0
"RTN","IBCEU0",14,0)
 S DA(2)=DA(1),DA(1)=+Y,IBIEN=DA(1)_","_DA(2)_","
"RTN","IBCEU0",15,0)
 I $G(IBNTEXT) D
"RTN","IBCEU0",16,0)
 . M IBTEXT=IBNTEXT
"RTN","IBCEU0",17,0)
 E  D
"RTN","IBCEU0",18,0)
 . S IBTEXT(1)="REVIEW STATUS CHANGED TO '"_$$EXTERNAL^DILFD(361.1,.2,,$P(^IBM(361.1,DA(2),0),U,20))_"'  BY: "_$$EXTERNAL^DILFD(361.121,.02,,+$G(DUZ))
"RTN","IBCEU0",19,0)
 D WP^DIE(361.121,IBIEN,.03,,"IBTEXT") K ^TMP("DIERR",$J)
"RTN","IBCEU0",20,0)
 Q
"RTN","IBCEU0",21,0)
 ;
"RTN","IBCEU0",22,0)
LOCK(IBFILE,IBREC) ; Lock record # IBREC in file #IBFILE (361 or 361.1)
"RTN","IBCEU0",23,0)
 N OK
"RTN","IBCEU0",24,0)
 S OK=0
"RTN","IBCEU0",25,0)
 L +^IBM(IBFILE,IBREC):3 I $T S OK=1
"RTN","IBCEU0",26,0)
 I 'OK D
"RTN","IBCEU0",27,0)
 . W !,"Another user has locked this record - try again later"
"RTN","IBCEU0",28,0)
 . D PAUSE^VALM1
"RTN","IBCEU0",29,0)
 Q OK
"RTN","IBCEU0",30,0)
 ;
"RTN","IBCEU0",31,0)
UNLOCK(IBFILE,IBREC) ; Unlock record # IBREC in file #IBFILE
"RTN","IBCEU0",32,0)
 I $G(IBREC) L -^IBM(IBFILE,IBREC)
"RTN","IBCEU0",33,0)
 Q
"RTN","IBCEU0",34,0)
 ;
"RTN","IBCEU0",35,0)
MSTAT ; Enter reviewed by selected range
"RTN","IBCEU0",36,0)
 N IBDAX,IBA,IBCLOSE,IBLOOK,IBOK,IBSTOP,IBREBLD,IBCLOK,DA,DIR,X,Y,DIE,DR
"RTN","IBCEU0",37,0)
 D FULL^VALM1
"RTN","IBCEU0",38,0)
 D SEL^IBCECSA4(.IBDAX)
"RTN","IBCEU0",39,0)
 S IBREBLD=0
"RTN","IBCEU0",40,0)
 I $O(IBDAX(""))="" G MSTATQ
"RTN","IBCEU0",41,0)
 S DIR("?,1")="ONLY SELECT TO CLOSE THE TRANSMIT RECORDS IF YOU KNOW THESE ARE THE FINAL",DIR("?",2)="  ELECTRONIC MESSAGES YOU WILL RECEIVE FOR ALL THE BILLS REFERENCED BY",DIR("?")="  THESE MESSAGES"
"RTN","IBCEU0",42,0)
 S DIR(0)="YA",DIR("A",1)="DO YOU WANT TO AUTOMATICALLY CLOSE THE TRANSMIT RECORDS FOR ANY MESSAGES",DIR("A")=" THAT AREN'T REJECTS?: ",DIR("B")="NO" W ! D ^DIR K DIR W !
"RTN","IBCEU0",43,0)
 G:$D(DIRUT) MSTATQ
"RTN","IBCEU0",44,0)
 S IBCLOSE=(Y=1)
"RTN","IBCEU0",45,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO SEE EACH MESSAGE BEFORE MARKING IT REVIEWED?: ",DIR("B")="NO"
"RTN","IBCEU0",46,0)
 S DIR("?",1)="IF YOU OPT TO SEE EACH MESSAGE, YOU CAN CONTROL WHETHER OR NOT THE MESSAGE",DIR("?",2)="  IS MARKED AS REVIEWED"
"RTN","IBCEU0",47,0)
 I 'IBCLOSE S DIR("?")=DIR("?",2) K DIR("?",2)
"RTN","IBCEU0",48,0)
 I IBCLOSE S DIR("?",2)=DIR("?",2)_" AND, FOR NON-REJECTS, WHETHER OR NOT TO CLOSE THE",DIR("?")="  TRANSMIT RECORD FOR THE BILL"
"RTN","IBCEU0",49,0)
 W ! D ^DIR K DIR W !
"RTN","IBCEU0",50,0)
 G:$D(DIRUT) MSTATQ
"RTN","IBCEU0",51,0)
 S IBLOOK=(Y=1)
"RTN","IBCEU0",52,0)
 S IBDAX=0,IBSTOP=0
"RTN","IBCEU0",53,0)
 F  S IBDAX=+$O(IBDAX(IBDAX)) Q:'IBDAX  D  Q:IBSTOP
"RTN","IBCEU0",54,0)
 . S IBA=$G(IBDAX(IBDAX))
"RTN","IBCEU0",55,0)
 . S DIE="^IBM(361,",DA=$P(IBA,U,2),DR=""
"RTN","IBCEU0",56,0)
 . I DA D
"RTN","IBCEU0",57,0)
 .. S IBOK=1
"RTN","IBCEU0",58,0)
 .. S IBCLOK=$S(IBCLOSE:1,1:0)
"RTN","IBCEU0",59,0)
 .. I IBLOOK D  Q:'IBOK
"RTN","IBCEU0",60,0)
 ... S DIC="^IBM(361," D EN^DIQ
"RTN","IBCEU0",61,0)
 ... I '$$LOCK(361,DA) W ! S IBOK=0 Q
"RTN","IBCEU0",62,0)
 ... S DIR(0)="YA",DIR("A")="OK TO MARK REVIEWED?: ",DIR("B")="YES",DIR("?",1)="IF YOU ENTER YES, THIS MESSAGE WILL BE MARKED REVIEWED"
"RTN","IBCEU0",63,0)
 ... S DIR("?",2)="IF YOU ENTER NO, THIS MESSAGE WILL NOT BE ALTERED",DIR("?",3)="IF YOU ENTER AN ^, THIS MESSAGE WILL NOT BE ALTERED & NONE OF THE",DIR("?")="   REMAINING MESSAGES WILL BE PROCESSED" D ^DIR K DIR
"RTN","IBCEU0",64,0)
 ... I Y'>0 S IBOK=0 S:$D(DIRUT) IBSTOP=1 Q
"RTN","IBCEU0",65,0)
 ... I 'IBCLOSE D
"RTN","IBCEU0",66,0)
 .... S DIR(0)="YA",DIR("A")="OK TO CLOSE THIS BILL'S TRANSMIT RECORD?: ",DIR("B")="NO"
"RTN","IBCEU0",67,0)
 .... S DIR("?",1)="If you respond YES to this prompt, the transmit status of this bill will",DIR("?",2)="  be set to CLOSED.  No further electronic processing of this bill will be"
"RTN","IBCEU0",68,0)
 .... S DIR("?",3)="  allowed.  If you respond NO to this prompt, this electronic message will",DIR("?",4)="  be filed as reviewed, but the bill's transmit status will not be changed."
"RTN","IBCEU0",69,0)
 .... S DIR("?",5)="  You may wish to periodically print a list of bills with a non-final",DIR("?",6)="  (closed/cancelled/etc) status to ensure the electronic processing of all"
"RTN","IBCEU0",70,0)
 .... S DIR("?",7)="  bills has been completed.  Closing the transmit bill record here will",DIR("?")="  eliminate the bill from this list."
"RTN","IBCEU0",71,0)
 .... W ! D ^DIR K DIR W !
"RTN","IBCEU0",72,0)
 .... I Y'=1 S IBCLOK=0
"RTN","IBCEU0",73,0)
 .. I 'IBLOOK,$P($G(^IBM(361,DA,0)),U,3)="R" D  Q:'IBOK
"RTN","IBCEU0",74,0)
 ... S DR="1",DIC="^IBM(361," D EN^DIQ W !,"Bill Number: ",$$EXPAND^IBTRE(361,.01,+^IBM(361,DA,0))
"RTN","IBCEU0",75,0)
 ... S DIR(0)="YA",DIR("A")="THIS IS A REJECTION ... ARE YOU SURE YOU WANT TO MARK IT REVIEWED?: ",DIR("B")="NO"
"RTN","IBCEU0",76,0)
 ... S DIR("?",1)="IF YOU ENTER YES, THIS MESSAGE WILL BE MARKED REVIEWED"
"RTN","IBCEU0",77,0)
 ... S DIR("?",2)="IF YOU ENTER NO, THIS MESSAGE WILL NOT BE ALTERED",DIR("?",3)="IF YOU ENTER AN ^, THIS MESSAGE WILL NOT BE ALTERED & NONE OF THE",DIR("?")="   MESSAGES FOLLOWING THIS ONE WILL BE PROCESSED" D ^DIR K DIR
"RTN","IBCEU0",78,0)
 ... I Y'=1 S IBOK=0 S:$D(DIRUT) IBSTOP=1
"RTN","IBCEU0",79,0)
 .. S:'IBREBLD IBREBLD=1
"RTN","IBCEU0",80,0)
 .. S DR=".09////2;.1////F" D ^DIE
"RTN","IBCEU0",81,0)
 .. N IBUPD
"RTN","IBCEU0",82,0)
 .. S IBUPD=0
"RTN","IBCEU0",83,0)
 .. I $$PRINTUPD($G(^IBM(361,DA,1,1,0)),+$P(^IBM(361,DA,0),U,11)) S IBUPD=1
"RTN","IBCEU0",84,0)
 .. I $G(^IBM(361,DA,1,1,0))["CLAIM SENT TO PAYER" D UPDTX^IBCECSA2(+$P(^IBM(361,DA,0),U,11),$S(IBCLOK:"Z",1:"A2")) S IBUPD=1
"RTN","IBCEU0",85,0)
 .. I $G(^IBM(361,DA,1,1,0))["CLAIM REJECTED" D UPDTX^IBCECSA2(+$P(^IBM(361,DA,0),U,11),"E") S IBUPD=1
"RTN","IBCEU0",86,0)
 .. I IBCLOK,'IBUPD D UPDTX^IBCECSA2(+$P(^IBM(361,DA,0),U,11),"Z")
"RTN","IBCEU0",87,0)
 .. I 'IBLOOK D
"RTN","IBCEU0",88,0)
 ... W !,"Seq #: ",IBDAX,"  Bill number: ",$$EXPAND^IBTRE(361,.01,+^IBM(361,DA,0)),?45,"REVIEWED"
"RTN","IBCEU0",89,0)
 .. D NOTECHG^IBCECSA2(DA,1)
"RTN","IBCEU0",90,0)
 .. D UNLOCK(361,DA)
"RTN","IBCEU0",91,0)
 W !!,"LAST SELECTION PROCESSED",!
"RTN","IBCEU0",92,0)
 D PAUSE^VALM1
"RTN","IBCEU0",93,0)
MSTATQ S VALMBCK="R"
"RTN","IBCEU0",94,0)
 I IBREBLD D BLD^IBCECSA1
"RTN","IBCEU0",95,0)
 Q
"RTN","IBCEU0",96,0)
 ;
"RTN","IBCEU0",97,0)
PRPAY(IBIFN,IBMCR) ; Returns total amount of prior payments applied to
"RTN","IBCEU0",98,0)
 ; bill ien IBIFN
"RTN","IBCEU0",99,0)
 ; IBMCR = flag passed in as 1 if MRA total should be included
"RTN","IBCEU0",100,0)
 ;
"RTN","IBCEU0",101,0)
 N IBTOT,IBZ,IBSEQ
"RTN","IBCEU0",102,0)
 S IBSEQ=$$COBN^IBCEF(IBIFN)
"RTN","IBCEU0",103,0)
 I IBSEQ'>1 S IBTOT=0 G PRPAYQ
"RTN","IBCEU0",104,0)
 D F^IBCEF("N-PRIOR PAYMENTS","IBZ",,IBIFN)
"RTN","IBCEU0",105,0)
 S IBTOT=IBZ
"RTN","IBCEU0",106,0)
 I $G(IBMCR),$$MCRONBIL^IBEFUNC(IBIFN)=1 D  ; MCR on bill before curr ins
"RTN","IBCEU0",107,0)
 . N Z,Z0,Z2,Q
"RTN","IBCEU0",108,0)
 . F Z=1:1:IBSEQ-1 I $$WNRBILL^IBEFUNC(IBIFN,Z) D
"RTN","IBCEU0",109,0)
 .. S IBTOT=+$$MCRPAY(IBIFN)
"RTN","IBCEU0",110,0)
PRPAYQ Q IBTOT
"RTN","IBCEU0",111,0)
 ;
"RTN","IBCEU0",112,0)
PRINTUPD(IBTEXT,IBDA) ; If the status message indicates claim was printed
"RTN","IBCEU0",113,0)
 ;    or the claim record in file 399 says it was, update the transmit
"RTN","IBCEU0",114,0)
 ;    message status to closed
"RTN","IBCEU0",115,0)
 ; IBTEXT = the first line text of the status message (optional)
"RTN","IBCEU0",116,0)
 ; IBDA = the ien of the transmission record in file 364
"RTN","IBCEU0",117,0)
 ;
"RTN","IBCEU0",118,0)
 ; FUNCTION returns 1 if message status changed
"RTN","IBCEU0",119,0)
 ;
"RTN","IBCEU0",120,0)
 N IBP,IBP1
"RTN","IBCEU0",121,0)
 S IBP=0,IBP1=$P($G(^DGCR(399,+$G(^IBA(364,+$G(IBDA),0)),"TX")),U,7)
"RTN","IBCEU0",122,0)
 I $G(IBTEXT)["CLAIM RECEIVED, PRINTED AND MAILED BY PRINT CENTER"!IBP1 D
"RTN","IBCEU0",123,0)
 . N Z
"RTN","IBCEU0",124,0)
 . S Z=$E($P($G(^IBA(364,IBDA,0)),U,3),1)
"RTN","IBCEU0",125,0)
 . I "AP"'[Z Q  ; Only change if status is pending or received/accepted
"RTN","IBCEU0",126,0)
 . D UPDTX^IBCECSA2(IBDA,"Z") S IBP=1
"RTN","IBCEU0",127,0)
 Q IBP
"RTN","IBCEU0",128,0)
 ;
"RTN","IBCEU0",129,0)
MCRPAY(IBIFN) ; Calculate MRA total for the bill IBIFN
"RTN","IBCEU0",130,0)
 N IBPAY,Q,Z0
"RTN","IBCEU0",131,0)
 S IBPAY=0
"RTN","IBCEU0",132,0)
 ;include eligible bill for process
"RTN","IBCEU0",133,0)
 S Q=0 F  S Q=$O(^IBM(361.1,"B",IBIFN,Q)) Q:'Q  I $$EOBELIG^IBCEU1(Q) S IBPAY=IBPAY+$P($G(^IBM(361.1,Q,1)),U,1)
"RTN","IBCEU0",134,0)
 Q IBPAY
"RTN","IBCEU0",135,0)
 ;
"RTN","IBCEU0",136,0)
PREOBTOT(IBIFN) ; Function - Calculates Patient Responsibility Amount
"RTN","IBCEU0",137,0)
 ; Input:  IBIFN - ien of Bill Number (ien of file 399)
"RTN","IBCEU0",138,0)
 ; Output Function returns: Patient Responsibility Amount for all EOB's for bill
"RTN","IBCEU0",139,0)
 ;
"RTN","IBCEU0",140,0)
 N FRMTYP,IBPTRES
"RTN","IBCEU0",141,0)
 S IBPTRES=0
"RTN","IBCEU0",142,0)
 ; Form Type 2=CMS-1500; 3=UB-04
"RTN","IBCEU0",143,0)
 S FRMTYP=$$FT^IBCEF(IBIFN)
"RTN","IBCEU0",144,0)
 ;
"RTN","IBCEU0",145,0)
 ; For bills w/CMS-1500 Form Type, total up Pt Resp amount from top
"RTN","IBCEU0",146,0)
 ; level of EOB (field 1.02) for All MRA type EOB's on file for that
"RTN","IBCEU0",147,0)
 ; bill (IBIFN)
"RTN","IBCEU0",148,0)
 ;  
"RTN","IBCEU0",149,0)
 I FRMTYP=2 D  Q IBPTRES
"RTN","IBCEU0",150,0)
 . N IBEOB,EOBREC,EOBREC1,IBPRTOT
"RTN","IBCEU0",151,0)
 . S (IBEOB,IBPRTOT,IBPTRES)=0
"RTN","IBCEU0",152,0)
 . F  S IBEOB=$O(^IBM(361.1,"B",IBIFN,IBEOB)) Q:'IBEOB  D  ;
"RTN","IBCEU0",153,0)
 . . S EOBREC=$G(^IBM(361.1,IBEOB,0)),EOBREC1=$G(^(1))
"RTN","IBCEU0",154,0)
 . . I $P(EOBREC,U,4)'=1 Q  ;make sure it's an MRA
"RTN","IBCEU0",155,0)
 . . Q:$D(^IBM(361.1,IBEOB,"ERR"))  ;no filing error
"RTN","IBCEU0",156,0)
 . . ; Total up Pt Resp Amounts on all valid MRA's
"RTN","IBCEU0",157,0)
 . . S IBPTRES=IBPTRES+$P(EOBREC1,U,2)
"RTN","IBCEU0",158,0)
 ;
"RTN","IBCEU0",159,0)
 ; For bills w/UB-04 Form Type, loop through all EOB's and sum up amounts
"RTN","IBCEU0",160,0)
 ; on both Line level and on Claim level
"RTN","IBCEU0",161,0)
 N EOBADJ,IBEOB,LNLVL
"RTN","IBCEU0",162,0)
 S IBEOB=0
"RTN","IBCEU0",163,0)
 F  S IBEOB=$O(^IBM(361.1,"B",IBIFN,IBEOB)) Q:'IBEOB  D  ;
"RTN","IBCEU0",164,0)
 . I $P($G(^IBM(361.1,IBEOB,0)),U,4)'=1 Q    ; must be an MRA
"RTN","IBCEU0",165,0)
 . Q:$D(^IBM(361.1,IBEOB,"ERR"))  ; no filing error
"RTN","IBCEU0",166,0)
 . ; get claim level adjustments
"RTN","IBCEU0",167,0)
 . K EOBADJ M EOBADJ=^IBM(361.1,IBEOB,10)
"RTN","IBCEU0",168,0)
 . S IBPTRES=IBPTRES+$$CALCPR(.EOBADJ)
"RTN","IBCEU0",169,0)
 . ;
"RTN","IBCEU0",170,0)
 . ; get line level adjustments
"RTN","IBCEU0",171,0)
 . S LNLVL=0
"RTN","IBCEU0",172,0)
 . F  S LNLVL=$O(^IBM(361.1,IBEOB,15,LNLVL)) Q:'LNLVL  D  ;
"RTN","IBCEU0",173,0)
 . . K EOBADJ M EOBADJ=^IBM(361.1,IBEOB,15,LNLVL,1)
"RTN","IBCEU0",174,0)
 . . S IBPTRES=IBPTRES+$$CALCPR(.EOBADJ)
"RTN","IBCEU0",175,0)
 Q IBPTRES
"RTN","IBCEU0",176,0)
 ;
"RTN","IBCEU0",177,0)
CALCPR(EOBADJ) ; Function - Calculate Patient Responsibilty Amount
"RTN","IBCEU0",178,0)
 ; For Group Code PR; Ignore the PR-AAA kludge
"RTN","IBCEU0",179,0)
 ; Input - EOBADJ = Array of Group Codes & Reason Codes from either the Claim
"RTN","IBCEU0",180,0)
 ;                 Level (10) or Service Line Level (15) of EOB file (#361.1)
"RTN","IBCEU0",181,0)
 ; Output - Function returns Patient Responsibility Amount
"RTN","IBCEU0",182,0)
 ;
"RTN","IBCEU0",183,0)
 N GRPLVL,RSNCD,RSNAMT,PTRESP
"RTN","IBCEU0",184,0)
 S (GRPLVL,PTRESP)=0
"RTN","IBCEU0",185,0)
 F  S GRPLVL=$O(EOBADJ(GRPLVL)) Q:'GRPLVL  D
"RTN","IBCEU0",186,0)
 . I $P($G(EOBADJ(GRPLVL,0)),U)'="PR" Q  ;grp code must be PR
"RTN","IBCEU0",187,0)
 . S RSNCD=0
"RTN","IBCEU0",188,0)
 . F  S RSNCD=$O(EOBADJ(GRPLVL,1,RSNCD)) Q:'RSNCD  D
"RTN","IBCEU0",189,0)
 . . I $P($G(EOBADJ(GRPLVL,1,RSNCD,0)),U,1)="AAA" Q   ; ignore PR-AAA
"RTN","IBCEU0",190,0)
 . . S RSNAMT=$P($G(EOBADJ(GRPLVL,1,RSNCD,0)),U,2)
"RTN","IBCEU0",191,0)
 . . S PTRESP=PTRESP+RSNAMT
"RTN","IBCEU0",192,0)
 Q PTRESP
"RTN","IBCEU0",193,0)
 ;
"RTN","IBCEU0",194,0)
COBMOD(IBXSAVE,IBXDATA,SEQ) ; output the modifiers from the COB
"RTN","IBCEU0",195,0)
 ; SEQ is which modifier we're extracting (1-4)
"RTN","IBCEU0",196,0)
 ; Build IBXDATA(line#)=Modifier# SEQ
"RTN","IBCEU0",197,0)
 NEW LN,N,Z,MOD,LNSEQ
"RTN","IBCEU0",198,0)
 KILL IBXDATA
"RTN","IBCEU0",199,0)
 I '$G(SEQ) Q
"RTN","IBCEU0",200,0)
 S (LN,LNSEQ)=0
"RTN","IBCEU0",201,0)
 F  S LN=$O(IBXSAVE("LCOB",LN)) Q:'LN  D
"RTN","IBCEU0",202,0)
 . S LNSEQ=LNSEQ+1
"RTN","IBCEU0",203,0)
 . S (N,Z)=0
"RTN","IBCEU0",204,0)
 . F  S Z=$O(IBXSAVE("LCOB",LN,"COBMOD",Z)) Q:'Z  D
"RTN","IBCEU0",205,0)
 .. S N=N+1
"RTN","IBCEU0",206,0)
 .. S MOD(LNSEQ,N)=$P($G(IBXSAVE("LCOB",LN,"COBMOD",Z,0)),U,1)
"RTN","IBCEU0",207,0)
 .. Q
"RTN","IBCEU0",208,0)
 . S MOD=$G(MOD(LNSEQ,SEQ))
"RTN","IBCEU0",209,0)
 . I MOD'="" S IBXDATA(LNSEQ)=MOD
"RTN","IBCEU0",210,0)
 . Q
"RTN","IBCEU0",211,0)
 Q
"RTN","IBCEU0",212,0)
 ;
"RTN","IBJTBA1")
0^5^B27347491^B26877071
"RTN","IBJTBA1",1,0)
IBJTBA1 ;ALB/TMK - TPJI BILL CHARGE INFO SCREEN ;01-MAR-1995
"RTN","IBJTBA1",2,0)
 ;;2.0;INTEGRATED BILLING;**135,265,155,349,417**;21-MAR-94;Build 6
"RTN","IBJTBA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTBA1",4,0)
 ;
"RTN","IBJTBA1",5,0)
SHEOB(IBI,IBSPL,IBEOBCT,IBCTOF) ; Format EOB called from IBJTBA
"RTN","IBJTBA1",6,0)
 ; IBSPL = 0 if EOB represents one bill's payment
"RTN","IBJTBA1",7,0)
 ;       =  1 if AR had to split the EOB between multiple bills
"RTN","IBJTBA1",8,0)
 ; Assumes IBLN is defined and returns it with line count
"RTN","IBJTBA1",9,0)
 ; Assumes IBEOBDET may be defined as a flag to control detail level of print
"RTN","IBJTBA1",10,0)
 N X,IBPT,IBCN,IBM,IBM1,IBM2,IBTY,IBPY,IBPR,IBST,IBSTR,IBCA,IBTS,IBTA,Z,Z0
"RTN","IBJTBA1",11,0)
 S X="0.00"
"RTN","IBJTBA1",12,0)
 S IBM=$G(^IBM(361.1,IBI,0))
"RTN","IBJTBA1",13,0)
 S IBTY=$P(IBM,U,4),IBTY=$S(IBTY:"MEDICARE MRA",1:"NORMAL EOB")
"RTN","IBJTBA1",14,0)
 I IBTY'["MRA",IBSPL S IBTY="A/R SPLIT/COVERS MORE THAN 1 BILL"
"RTN","IBJTBA1",15,0)
 I $P(IBM,U,13)>1,$P(IBM,U,13)<5 S IBTY=IBTY_" ("_$$EXTERNAL^DILFD(361.1,.13,,$P(IBM,U,13))_")"
"RTN","IBJTBA1",16,0)
 S IBCN=$P(IBM,U,14),IBPY=$P(IBM,U,2)
"RTN","IBJTBA1",17,0)
 S:IBPY IBPY=$P($G(^DIC(36,IBPY,0)),U)
"RTN","IBJTBA1",18,0)
 S IBPR=$$FMTE^XLFDT($P(IBM,U,6)),IBST=$P(IBM,U,16)
"RTN","IBJTBA1",19,0)
 S IBST=$$EXPAND^IBTRE(361.1,.16,+IBST)
"RTN","IBJTBA1",20,0)
 S IBM1=$G(^IBM(361.1,IBI,1))
"RTN","IBJTBA1",21,0)
 ;
"RTN","IBJTBA1",22,0)
 S IBPT=$P(IBM1,U,2)   ; patient responsibility 1.02 fiel
"RTN","IBJTBA1",23,0)
 I $P(IBM,U,4),$D(^IBM(361.1,IBI,"ERR")) S IBPT=0  ; filing error
"RTN","IBJTBA1",24,0)
 ; If MRA & UB, then calculate patient responsiblity value
"RTN","IBJTBA1",25,0)
 I $P(IBM,U,4),$$FT^IBCEF(+$P(IBM,U,1))=3 S IBPT=$$PTRESPI^IBCECOB1(IBI)
"RTN","IBJTBA1",26,0)
 ;
"RTN","IBJTBA1",27,0)
 S IBCA=$P(IBM1,U)
"RTN","IBJTBA1",28,0)
 S IBM2=$G(^IBM(361.1,IBI,2)),IBTA=$P(IBM2,U,3)
"RTN","IBJTBA1",29,0)
 ; if no Total Allowed Amount, sum up amounts on Line Level Adjustment
"RTN","IBJTBA1",30,0)
 I IBTA="" S IBTA=$$ALLOWED^IBCEMU2(IBI)
"RTN","IBJTBA1",31,0)
 S IBTS=$P(IBM2,U,4)
"RTN","IBJTBA1",32,0)
 D MRA2
"RTN","IBJTBA1",33,0)
 S IBLN=$$SET^IBJTBA("",IBLN)
"RTN","IBJTBA1",34,0)
 I '$G(IBEOBDET),IBSPL D
"RTN","IBJTBA1",35,0)
 . S IBSTR=$$SETLN^IBJTBA("    **A/R CORRECTED PAYMENT DATA:","",1,50),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",36,0)
 . S IBSTR=$$SETLN^IBJTBA("     TOTAL AMT PD: "_$J(+$P($G(^IBM(361.1,IBI,1)),U,1),"",2),"",1,75),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",37,0)
 . S Z=0 F  S Z=$O(^IBM(361.1,IBI,8,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","IBJTBA1",38,0)
 .. S IBSTR=$$SETLN^IBJTBA($E($J("",8)_$S($P(Z0,U,3):$$BN1^PRCAFN(+$P(Z0,U,3)),1:"[suspense]"_$P(Z0,U))_$J("",25),1,25)_"  "_$J(+$P(Z0,U,2),"",2),"",1,75),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",39,0)
 ;
"RTN","IBJTBA1",40,0)
 I $G(IBEOBDET) D
"RTN","IBJTBA1",41,0)
 . I $P($G(^IBM(361.1,IBI,0)),U,4) D  Q     ; Medicare MRA processing
"RTN","IBJTBA1",42,0)
 .. N VALMCNT
"RTN","IBJTBA1",43,0)
 .. K ^TMP("IBCECSD",$J)
"RTN","IBJTBA1",44,0)
 .. D GETEOB^IBCECSA6(IBI,0,,+$G(IBLN)-1)
"RTN","IBJTBA1",45,0)
 .. S Z=0 F  S Z=$O(^TMP("IBCECSD",$J,Z)) Q:'Z  S IBSTR=$$SETLN^IBJTBA($G(^TMP("IBCECSD",$J,Z,0)),"",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",46,0)
 .. K ^TMP("IBCECSD",$J)
"RTN","IBJTBA1",47,0)
 .. D EOBERR
"RTN","IBJTBA1",48,0)
 .. Q
"RTN","IBJTBA1",49,0)
 . ;
"RTN","IBJTBA1",50,0)
 . ; Normal EOB processing
"RTN","IBJTBA1",51,0)
 . N VALMCNT
"RTN","IBJTBA1",52,0)
 . K ^TMP("PRCA_EOB",$J)
"RTN","IBJTBA1",53,0)
 . D GETEOB^IBCECSA6(IBI,1)
"RTN","IBJTBA1",54,0)
 . S Z=0 F  S Z=$O(^TMP("PRCA_EOB",$J,IBI,Z)) Q:'Z  S IBSTR=$$SETLN^IBJTBA($G(^TMP("PRCA_EOB",$J,IBI,Z)),"",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",55,0)
 . K ^TMP("PRCA_EOB",$J)
"RTN","IBJTBA1",56,0)
 . D EOBERR
"RTN","IBJTBA1",57,0)
 . Q
"RTN","IBJTBA1",58,0)
 ;
"RTN","IBJTBA1",59,0)
 Q
"RTN","IBJTBA1",60,0)
 ;
"RTN","IBJTBA1",61,0)
MRA2 ;
"RTN","IBJTBA1",62,0)
 N IBD
"RTN","IBJTBA1",63,0)
 S IBLN=$$SET^IBJTBA("",IBLN)
"RTN","IBJTBA1",64,0)
 S IBD="EOB/MRA Information"_$S($D(IBCTOF):" ("_$G(IBEOBCT)_" OF "_IBCTOF_")",1:"")
"RTN","IBJTBA1",65,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,"",30,45),$E(IBSTR,1,2)=">>",IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",66,0)
 S IBD="EOB Type: "_IBTY,IBSTR=$$SETLN^IBJTBA(IBD,"",5,59)
"RTN","IBJTBA1",67,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",68,0)
 S IBD="ICN: "_IBCN,IBSTR=$$SETLN^IBJTBA(IBD,"",10,30)
"RTN","IBJTBA1",69,0)
 S IBD="Patient Resp Amount: "_$S('IBPT:X,1:IBPT)
"RTN","IBJTBA1",70,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,44,35)
"RTN","IBJTBA1",71,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",72,0)
 S IBD="Payer Name: "_IBPY,IBSTR=$$SETLN^IBJTBA(IBD,"",3,40)
"RTN","IBJTBA1",73,0)
 S IBD="Total Allowed Amount: "_$S('IBTA:X,1:IBTA)
"RTN","IBJTBA1",74,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,43,36)
"RTN","IBJTBA1",75,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",76,0)
 S IBD="EOB Date: "_IBPR,IBSTR=$$SETLN^IBJTBA(IBD,"",5,35)
"RTN","IBJTBA1",77,0)
 S IBD="Total Submitted Charges: "_$S('IBTS:X,1:IBTS)
"RTN","IBJTBA1",78,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,40,39)
"RTN","IBJTBA1",79,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",80,0)
 S IBD="Svc From Dt: "_$$DAT1^IBOUTL($P(IBM1,U,10))
"RTN","IBJTBA1",81,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,"",2,38)
"RTN","IBJTBA1",82,0)
 S IBD="Svc To Dt: "_$$DAT1^IBOUTL($P(IBM1,U,11))
"RTN","IBJTBA1",83,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,54,25)
"RTN","IBJTBA1",84,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",85,0)
 S IBSTR=""
"RTN","IBJTBA1",86,0)
 I IBTY["MRA" S IBD="MRA Review Status: "_IBST,IBSTR=$$SETLN^IBJTBA(IBD,"",2,38)
"RTN","IBJTBA1",87,0)
 S IBD=$S('$G(IBSPL):"  ",1:"**")_"Reported Payment Amt: "_$S('IBCA:$J(X,"",2),1:$J(+IBCA,"",2))
"RTN","IBJTBA1",88,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,41,37)
"RTN","IBJTBA1",89,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",90,0)
 ;
"RTN","IBJTBA1",91,0)
 I IBTY["MRA",$D(^IBM(361.1,IBI,21)) D
"RTN","IBJTBA1",92,0)
 . S IBD=$TR($J("",35)," ","-")_"Review"_$TR($J("",38)," ","-")
"RTN","IBJTBA1",93,0)
 . S IBSTR=$$SETLN^IBJTBA(IBD,"",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",94,0)
 . S (IBST,IBCN)=0 F  S IBCN=$O(^IBM(361.1,IBI,21,IBCN)) Q:'IBCN  S X=$G(^(IBCN,0)) D
"RTN","IBJTBA1",95,0)
 .. S IBST=0
"RTN","IBJTBA1",96,0)
 .. S IBD="Review Date: "_$$DAT1^IBOUTL($P(X,U))
"RTN","IBJTBA1",97,0)
 .. S IBSTR=$$SETLN^IBJTBA(IBD,"",1,30)
"RTN","IBJTBA1",98,0)
 .. S IBD="Reviewed By: "_$P($G(^VA(200,+$P(X,U,2),0)),U)
"RTN","IBJTBA1",99,0)
 .. S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,40,39)
"RTN","IBJTBA1",100,0)
 .. S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",101,0)
 .. S IBD=0 F  S IBD=$O(^IBM(361.1,IBI,21,IBCN,1,IBD)) Q:'IBD  S IBSTR=$$SETLN^IBJTBA($S('IBST:"Comments: ",1:"")_$G(^(IBD,0)),"",1,$S('IBST:69,1:79)),IBST=1,IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",102,0)
 . I 'IBST D
"RTN","IBJTBA1",103,0)
 .. S IBSTR=$$SETLN^IBJTBA("None","",1,10)
"RTN","IBJTBA1",104,0)
 .. S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",105,0)
 Q
"RTN","IBJTBA1",106,0)
 ;
"RTN","IBJTBA1",107,0)
EOBERR ; Display information about any 361.1 message storage or filing errors
"RTN","IBJTBA1",108,0)
 I '$O(^IBM(361.1,IBI,"ERR",0)) Q
"RTN","IBJTBA1",109,0)
 S IBSTR=$$SETLN^IBJTBA(" ** MESSAGE STORAGE ERRORS  **","",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",110,0)
 S Z=0 F  S Z=$O(^IBM(361.1,IBI,"ERR",Z)) Q:'Z  S IBSTR=$$SETLN^IBJTBA($G(^(Z,0)),"",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",111,0)
 Q
"RTN","IBJTBA1",112,0)
 ;
"VER")
8.0^22.0
"BLD",8097,6)
^384
**END**
**END**
