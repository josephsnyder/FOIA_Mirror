Released IB*2*432 SEQ #421
Extracted from mail message
**KIDS**:IB*2.0*432^

**INSTALL NAME**
IB*2.0*432
"BLD",7627,0)
IB*2.0*432^INTEGRATED BILLING^0^3110916^y
"BLD",7627,4,0)
^9.64PA^353.3^11
"BLD",7627,4,36,0)
36
"BLD",7627,4,36,2,0)
^9.641^36^1
"BLD",7627,4,36,2,36,0)
INSURANCE COMPANY  (File-top level)
"BLD",7627,4,36,2,36,1,0)
^9.6411^6.1^2
"BLD",7627,4,36,2,36,1,6.09,0)
PRINT SEC/TERT AUTO CLAIMS?
"BLD",7627,4,36,2,36,1,6.1,0)
PRINT MRA 2NDARY CLAIM W/O MRA
"BLD",7627,4,36,222)
y^y^p^^^^n^^n
"BLD",7627,4,36,224)

"BLD",7627,4,350.8,0)
350.8
"BLD",7627,4,350.8,222)
n^n^f^^n^^y^o^n
"BLD",7627,4,350.8,223)

"BLD",7627,4,350.8,224)
I $$INC3508^IBY432PR(Y)
"BLD",7627,4,350.9,0)
350.9
"BLD",7627,4,350.9,2,0)
^9.641^350.9^1
"BLD",7627,4,350.9,2,350.9,0)
IB SITE PARAMETERS  (File-top level)
"BLD",7627,4,350.9,2,350.9,1,0)
^9.6411^8.19^5
"BLD",7627,4,350.9,2,350.9,1,8.14,0)
CMS-1500 AUTO PRINTER
"BLD",7627,4,350.9,2,350.9,1,8.15,0)
UB-04 AUTO PRINTER
"BLD",7627,4,350.9,2,350.9,1,8.16,0)
EOB AUTO PRINTER
"BLD",7627,4,350.9,2,350.9,1,8.17,0)
AUTOMATIC REG EOB PROCESS?
"BLD",7627,4,350.9,2,350.9,1,8.19,0)
MRA AUTO PRINTER
"BLD",7627,4,350.9,222)
y^n^p^^^^n^^n
"BLD",7627,4,350.9,224)

"BLD",7627,4,353.3,0)
353.3
"BLD",7627,4,353.3,222)
y^y^f^^n^^y^o^n
"BLD",7627,4,355.3,0)
355.3
"BLD",7627,4,355.3,2,0)
^9.641^355.3^1
"BLD",7627,4,355.3,2,355.3,0)
GROUP INSURANCE PLAN  (File-top level)
"BLD",7627,4,355.3,2,355.3,1,0)
^9.6411^.15^1
"BLD",7627,4,355.3,2,355.3,1,.15,0)
ELECTRONIC PLAN TYPE
"BLD",7627,4,355.3,222)
y^n^p^^^^n^^n
"BLD",7627,4,355.3,224)

"BLD",7627,4,355.93,0)
355.93
"BLD",7627,4,355.93,2,0)
^9.641^355.93^1
"BLD",7627,4,355.93,2,355.93,0)
IB NON/OTHER VA BILLING PROVIDER  (File-top level)
"BLD",7627,4,355.93,2,355.93,1,0)
^9.6411^1.03^3
"BLD",7627,4,355.93,2,355.93,1,1.01,0)
CONTACT NAME
"BLD",7627,4,355.93,2,355.93,1,1.02,0)
CONTACT PHONE NUMBER
"BLD",7627,4,355.93,2,355.93,1,1.03,0)
CONTACT PHONE EXTENSION
"BLD",7627,4,355.93,222)
y^y^p^^^^n^^n
"BLD",7627,4,355.93,224)

"BLD",7627,4,362.4,0)
362.4
"BLD",7627,4,362.4,2,0)
^9.641^362.4^1
"BLD",7627,4,362.4,2,362.4,0)
IB BILL/CLAIMS PRESCRIPTION REFILL  (File-top level)
"BLD",7627,4,362.4,2,362.4,1,0)
^9.6411^.11^1
"BLD",7627,4,362.4,2,362.4,1,.11,0)
ORDER DATE
"BLD",7627,4,362.4,222)
y^y^p^^^^n^^n
"BLD",7627,4,362.4,224)

"BLD",7627,4,364.5,0)
364.5
"BLD",7627,4,364.5,222)
n^n^f^^y^^y^o^n
"BLD",7627,4,364.5,224)
I $$INCLUDE^IBY432PR(5,Y)
"BLD",7627,4,364.6,0)
364.6
"BLD",7627,4,364.6,222)
n^n^f^^y^^y^o^n
"BLD",7627,4,364.6,224)
I $$INCLUDE^IBY432PR(6,Y)
"BLD",7627,4,364.7,0)
364.7
"BLD",7627,4,364.7,222)
n^n^f^^y^^y^o^n
"BLD",7627,4,364.7,224)
I $$INCLUDE^IBY432PR(7,Y)
"BLD",7627,4,399,0)
399
"BLD",7627,4,399,2,0)
^9.641^399.0222^6
"BLD",7627,4,399,2,399,0)
BILL/CLAIMS  (File-top level)
"BLD",7627,4,399,2,399,1,0)
^9.6411^.21^43
"BLD",7627,4,399,2,399,1,.19,0)
FORM TYPE
"BLD",7627,4,399,2,399,1,.21,0)
CURRENT BILL PAYER SEQUENCE
"BLD",7627,4,399,2,399,1,28.1,0)
MRA REVIEW STATUS
"BLD",7627,4,399,2,399,1,34,0)
AUTO PROCESSED FROM CLAIM
"BLD",7627,4,399,2,399,1,35,0)
AUTO PROCESS
"BLD",7627,4,399,2,399,1,36,0)
AUTO PROCESS REASON
"BLD",7627,4,399,2,399,1,37,0)
REMOVED FROM WORKLIST BY
"BLD",7627,4,399,2,399,1,38,0)
REMOVED FROM WORKLIST HOW
"BLD",7627,4,399,2,399,1,39,0)
REMOVED FROM WORKLIST DATE
"BLD",7627,4,399,2,399,1,101,0)
PRIMARY INSURANCE CARRIER
"BLD",7627,4,399,2,399,1,238,0)
SPECIAL PROGRAM INDICATOR
"BLD",7627,4,399,2,399,1,253,0)
PRIMARY REFERRAL NUMBER
"BLD",7627,4,399,2,399,1,254,0)
SECONDARY REFERRAL NUMBER
"BLD",7627,4,399,2,399,1,255,0)
TERTIARY REFERRAL NUMBER
"BLD",7627,4,399,2,399,1,260,0)
COB TOTAL NON-COVERED AMOUNT
"BLD",7627,4,399,2,399,1,261,0)
PROPERTY/CASUALTY CLAIM NUMBER
"BLD",7627,4,399,2,399,1,262,0)
PROP/CAS DATE OF 1ST CONTACT
"BLD",7627,4,399,2,399,1,263,0)
DISABILITY START DATE
"BLD",7627,4,399,2,399,1,264,0)
DISABILITY END DATE
"BLD",7627,4,399,2,399,1,266,0)
PRIMARY SURGICAL PROC CODE
"BLD",7627,4,399,2,399,1,267,0)
SECONDARY SURGICAL PROC CODE
"BLD",7627,4,399,2,399,1,268,0)
PROPERTY/CASUALTY CONTACT NAME
"BLD",7627,4,399,2,399,1,269,0)
PROP/CAS COMMUNICATION NUMBER
"BLD",7627,4,399,2,399,1,269.1,0)
PROP/CAS EXTENSION NUMBER
"BLD",7627,4,399,2,399,1,271,0)
AMBULANCE P/U ADDRESS 1
"BLD",7627,4,399,2,399,1,272,0)
AMBULANCE P/U ADDRESS 2
"BLD",7627,4,399,2,399,1,273,0)
AMBULANCE P/U CITY
"BLD",7627,4,399,2,399,1,274,0)
AMBULANCE P/U STATE
"BLD",7627,4,399,2,399,1,275,0)
AMBULANCE P/U ZIP
"BLD",7627,4,399,2,399,1,276,0)
AMBULANCE D/O LOCATION
"BLD",7627,4,399,2,399,1,277,0)
AMBULANCE D/O ADDRESS 1
"BLD",7627,4,399,2,399,1,278,0)
AMBULANCE D/O ADDRESS 2
"BLD",7627,4,399,2,399,1,279,0)
AMBULANCE D/O CITY
"BLD",7627,4,399,2,399,1,280,0)
AMBULANCE D/O STATE
"BLD",7627,4,399,2,399,1,281,0)
AMBULANCE D/O ZIP
"BLD",7627,4,399,2,399,1,282,0)
ASSUMED CARE DATE
"BLD",7627,4,399,2,399,1,283,0)
RELINQUISHED CARE DATE
"BLD",7627,4,399,2,399,1,284,0)
ATTACHMENT CONTROL NUMBER
"BLD",7627,4,399,2,399,1,285,0)
ATTACHMENT REPORT TYPE
"BLD",7627,4,399,2,399,1,286,0)
ATTACHMENT REPORT TRANS CODE
"BLD",7627,4,399,2,399,1,453,0)
FORM LOCATOR 64A
"BLD",7627,4,399,2,399,1,454,0)
FORM LOCATOR 64B
"BLD",7627,4,399,2,399,1,455,0)
FORM LOCATOR 64C
"BLD",7627,4,399,2,399.0222,0)
PROVIDER  (sub-file)
"BLD",7627,4,399,2,399.0222,1,0)
^9.6411^.02^2
"BLD",7627,4,399,2,399.0222,1,.01,0)
FUNCTION
"BLD",7627,4,399,2,399.0222,1,.02,0)
PERFORMED BY
"BLD",7627,4,399,2,399.0304,0)
PROCEDURES  (sub-file)
"BLD",7627,4,399,2,399.0304,1,0)
^9.6411^74^5
"BLD",7627,4,399,2,399.0304,1,19,0)
PURCHASED COST
"BLD",7627,4,399,2,399.0304,1,70,0)
ATTACHMENT CONTROL NUMBER
"BLD",7627,4,399,2,399.0304,1,71,0)
ATTACHMENT REPORT TYPE
"BLD",7627,4,399,2,399.0304,1,72,0)
ATTACHMENT REPORT TRANS CODE
"BLD",7627,4,399,2,399.0304,1,74,0)
ADDITIONAL OB MINUTES
"BLD",7627,4,399,2,399.0404,0)
LINE PROVIDER  (sub-file)
"BLD",7627,4,399,2,399.0404,1,0)
^9.6411^^0
"BLD",7627,4,399,2,399.042,0)
REVENUE CODE  (sub-file)
"BLD",7627,4,399,2,399.042,1,0)
^9.6411^.09^3
"BLD",7627,4,399,2,399.042,1,.02,0)
CHARGES
"BLD",7627,4,399,2,399.042,1,.04,0)
TOTAL
"BLD",7627,4,399,2,399.042,1,.09,0)
NON-COVERED CHARGE
"BLD",7627,4,399,2,399.078,0)
EOB CLAIM COMMENTS  (sub-file)
"BLD",7627,4,399,2,399.078,1,0)
^9.6411^^
"BLD",7627,4,399,222)
y^n^p^^^^n^^n
"BLD",7627,4,399,224)

"BLD",7627,4,"APDD",36,36)

"BLD",7627,4,"APDD",36,36,6.09)

"BLD",7627,4,"APDD",36,36,6.1)

"BLD",7627,4,"APDD",350.9,350.9)

"BLD",7627,4,"APDD",350.9,350.9,8.14)

"BLD",7627,4,"APDD",350.9,350.9,8.15)

"BLD",7627,4,"APDD",350.9,350.9,8.16)

"BLD",7627,4,"APDD",350.9,350.9,8.17)

"BLD",7627,4,"APDD",350.9,350.9,8.19)

"BLD",7627,4,"APDD",355.3,355.3)

"BLD",7627,4,"APDD",355.3,355.3,.15)

"BLD",7627,4,"APDD",355.93,355.93)

"BLD",7627,4,"APDD",355.93,355.93,1.01)

"BLD",7627,4,"APDD",355.93,355.93,1.02)

"BLD",7627,4,"APDD",355.93,355.93,1.03)

"BLD",7627,4,"APDD",362.4,362.4)

"BLD",7627,4,"APDD",362.4,362.4,.11)

"BLD",7627,4,"APDD",399,399)

"BLD",7627,4,"APDD",399,399,.19)

"BLD",7627,4,"APDD",399,399,.21)

"BLD",7627,4,"APDD",399,399,28.1)

"BLD",7627,4,"APDD",399,399,34)

"BLD",7627,4,"APDD",399,399,35)

"BLD",7627,4,"APDD",399,399,36)

"BLD",7627,4,"APDD",399,399,37)

"BLD",7627,4,"APDD",399,399,38)

"BLD",7627,4,"APDD",399,399,39)

"BLD",7627,4,"APDD",399,399,101)

"BLD",7627,4,"APDD",399,399,238)

"BLD",7627,4,"APDD",399,399,253)

"BLD",7627,4,"APDD",399,399,254)

"BLD",7627,4,"APDD",399,399,255)

"BLD",7627,4,"APDD",399,399,260)

"BLD",7627,4,"APDD",399,399,261)

"BLD",7627,4,"APDD",399,399,262)

"BLD",7627,4,"APDD",399,399,263)

"BLD",7627,4,"APDD",399,399,264)

"BLD",7627,4,"APDD",399,399,266)

"BLD",7627,4,"APDD",399,399,267)

"BLD",7627,4,"APDD",399,399,268)

"BLD",7627,4,"APDD",399,399,269)

"BLD",7627,4,"APDD",399,399,269.1)

"BLD",7627,4,"APDD",399,399,271)

"BLD",7627,4,"APDD",399,399,272)

"BLD",7627,4,"APDD",399,399,273)

"BLD",7627,4,"APDD",399,399,274)

"BLD",7627,4,"APDD",399,399,275)

"BLD",7627,4,"APDD",399,399,276)

"BLD",7627,4,"APDD",399,399,277)

"BLD",7627,4,"APDD",399,399,278)

"BLD",7627,4,"APDD",399,399,279)

"BLD",7627,4,"APDD",399,399,280)

"BLD",7627,4,"APDD",399,399,281)

"BLD",7627,4,"APDD",399,399,282)

"BLD",7627,4,"APDD",399,399,283)

"BLD",7627,4,"APDD",399,399,284)

"BLD",7627,4,"APDD",399,399,285)

"BLD",7627,4,"APDD",399,399,286)

"BLD",7627,4,"APDD",399,399,453)

"BLD",7627,4,"APDD",399,399,454)

"BLD",7627,4,"APDD",399,399,455)

"BLD",7627,4,"APDD",399,399.0222)

"BLD",7627,4,"APDD",399,399.0222,.01)

"BLD",7627,4,"APDD",399,399.0222,.02)

"BLD",7627,4,"APDD",399,399.0304)

"BLD",7627,4,"APDD",399,399.0304,19)

"BLD",7627,4,"APDD",399,399.0304,70)

"BLD",7627,4,"APDD",399,399.0304,71)

"BLD",7627,4,"APDD",399,399.0304,72)

"BLD",7627,4,"APDD",399,399.0304,74)

"BLD",7627,4,"APDD",399,399.0404)

"BLD",7627,4,"APDD",399,399.042)

"BLD",7627,4,"APDD",399,399.042,.02)

"BLD",7627,4,"APDD",399,399.042,.04)

"BLD",7627,4,"APDD",399,399.042,.09)

"BLD",7627,4,"APDD",399,399.078)

"BLD",7627,4,"B",36,36)

"BLD",7627,4,"B",350.8,350.8)

"BLD",7627,4,"B",350.9,350.9)

"BLD",7627,4,"B",353.3,353.3)

"BLD",7627,4,"B",355.3,355.3)

"BLD",7627,4,"B",355.93,355.93)

"BLD",7627,4,"B",362.4,362.4)

"BLD",7627,4,"B",364.5,364.5)

"BLD",7627,4,"B",364.6,364.6)

"BLD",7627,4,"B",364.7,364.7)

"BLD",7627,4,"B",399,399)

"BLD",7627,6.3)
192
"BLD",7627,"ABPKG")
n
"BLD",7627,"INI")
IBY432PR
"BLD",7627,"INID")
^y^y
"BLD",7627,"INIT")
IBY432PO
"BLD",7627,"KRN",0)
^9.67PA^779.2^20
"BLD",7627,"KRN",.4,0)
.4
"BLD",7627,"KRN",.401,0)
.401
"BLD",7627,"KRN",.402,0)
.402
"BLD",7627,"KRN",.402,"NM",0)
^9.68A^9^9
"BLD",7627,"KRN",.402,"NM",1,0)
IB SCREEN82    FILE #399^399^1^
"BLD",7627,"KRN",.402,"NM",2,0)
IB SCREEN8H    FILE #399^399^1^
"BLD",7627,"KRN",.402,"NM",3,0)
IBEDIT INS CO1    FILE #36^36^0
"BLD",7627,"KRN",.402,"NM",4,0)
IB SCREEN8    FILE #399^399^0
"BLD",7627,"KRN",.402,"NM",5,0)
IB SCREEN10    FILE #399^399^0
"BLD",7627,"KRN",.402,"NM",6,0)
IB SCREEN102    FILE #399^399^0
"BLD",7627,"KRN",.402,"NM",7,0)
IB SCREEN10H    FILE #399^399^0
"BLD",7627,"KRN",.402,"NM",8,0)
IB SCREEN6    FILE #399^399^0
"BLD",7627,"KRN",.402,"NM",9,0)
IB SCREEN7    FILE #399^399^0
"BLD",7627,"KRN",.402,"NM","B","IB SCREEN10    FILE #399",5)

"BLD",7627,"KRN",.402,"NM","B","IB SCREEN102    FILE #399",6)

"BLD",7627,"KRN",.402,"NM","B","IB SCREEN10H    FILE #399",7)

"BLD",7627,"KRN",.402,"NM","B","IB SCREEN6    FILE #399",8)

"BLD",7627,"KRN",.402,"NM","B","IB SCREEN7    FILE #399",9)

"BLD",7627,"KRN",.402,"NM","B","IB SCREEN8    FILE #399",4)

"BLD",7627,"KRN",.402,"NM","B","IB SCREEN82    FILE #399",1)

"BLD",7627,"KRN",.402,"NM","B","IB SCREEN8H    FILE #399",2)

"BLD",7627,"KRN",.402,"NM","B","IBEDIT INS CO1    FILE #36",3)

"BLD",7627,"KRN",.403,0)
.403
"BLD",7627,"KRN",.5,0)
.5
"BLD",7627,"KRN",.84,0)
.84
"BLD",7627,"KRN",3.6,0)
3.6
"BLD",7627,"KRN",3.8,0)
3.8
"BLD",7627,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",7627,"KRN",9.2,0)
9.2
"BLD",7627,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",7627,"KRN",9.8,0)
9.8
"BLD",7627,"KRN",9.8,"NM",0)
^9.68A^107^100
"BLD",7627,"KRN",9.8,"NM",3,0)
IBCSC5A^^0^B46960679
"BLD",7627,"KRN",9.8,"NM",4,0)
IBCSC5C^^0^B51873840
"BLD",7627,"KRN",9.8,"NM",5,0)
IBCBB1^^0^B87354166
"BLD",7627,"KRN",9.8,"NM",6,0)
IBCU71^^0^B25142768
"BLD",7627,"KRN",9.8,"NM",7,0)
IBCU82^^0^B22371343
"BLD",7627,"KRN",9.8,"NM",8,0)
IBCECOB^^0^B17473873
"BLD",7627,"KRN",9.8,"NM",9,0)
IBCEP8^^0^B124106207
"BLD",7627,"KRN",9.8,"NM",10,0)
IBCEP8B^^0^B12352923
"BLD",7627,"KRN",9.8,"NM",11,0)
IBCECOB1^^0^B99389484
"BLD",7627,"KRN",9.8,"NM",12,0)
IBCEMU4^^0^B1508771
"BLD",7627,"KRN",9.8,"NM",13,0)
IBCEMU1^^0^B59079187
"BLD",7627,"KRN",9.8,"NM",14,0)
IBCU^^0^B52974983
"BLD",7627,"KRN",9.8,"NM",15,0)
IBCBB3^^0^B41965627
"BLD",7627,"KRN",9.8,"NM",16,0)
IBJPS3^^0^B89166752
"BLD",7627,"KRN",9.8,"NM",17,0)
IBCECOB6^^0^B54280340
"BLD",7627,"KRN",9.8,"NM",18,0)
IBCEMRAX^^0^B48296303
"BLD",7627,"KRN",9.8,"NM",19,0)
IBJPS^^0^B3750253
"BLD",7627,"KRN",9.8,"NM",20,0)
IBJPS2^^0^B43690193
"BLD",7627,"KRN",9.8,"NM",21,0)
IBCAPU^^0^B877398
"BLD",7627,"KRN",9.8,"NM",23,0)
IBCSC8^^0^B8784188
"BLD",7627,"KRN",9.8,"NM",24,0)
IBCSCH^^0^B47256662
"BLD",7627,"KRN",9.8,"NM",25,0)
IBCSCU^^0^B12080989
"BLD",7627,"KRN",9.8,"NM",26,0)
IBCBB11^^0^B97720533
"BLD",7627,"KRN",9.8,"NM",27,0)
IBCEF31^^0^B12054415
"BLD",7627,"KRN",9.8,"NM",28,0)
IBCSC82^^1^
"BLD",7627,"KRN",9.8,"NM",29,0)
IBCSC8A^^1^
"BLD",7627,"KRN",9.8,"NM",30,0)
IBCSC8B^^1^
"BLD",7627,"KRN",9.8,"NM",31,0)
IBCSC8H^^1^
"BLD",7627,"KRN",9.8,"NM",32,0)
IBCSC10^^0^B3383615
"BLD",7627,"KRN",9.8,"NM",33,0)
IBCSC102^^0^B40563126
"BLD",7627,"KRN",9.8,"NM",34,0)
IBCSC10A^^0^B7774728
"BLD",7627,"KRN",9.8,"NM",35,0)
IBCSC10B^^0^B42359591
"BLD",7627,"KRN",9.8,"NM",36,0)
IBCSC10H^^0^B48673264
"BLD",7627,"KRN",9.8,"NM",37,0)
IBCSC7^^0^B6990382
"BLD",7627,"KRN",9.8,"NM",38,0)
IBCSCP^^0^B10801833
"BLD",7627,"KRN",9.8,"NM",39,0)
IBCSCE^^0^B9117892
"BLD",7627,"KRN",9.8,"NM",40,0)
IBY432PR^^0^B209623389
"BLD",7627,"KRN",9.8,"NM",41,0)
IBCBB21^^0^B15422214
"BLD",7627,"KRN",9.8,"NM",42,0)
IBCEF75^^0^B24683660
"BLD",7627,"KRN",9.8,"NM",43,0)
IBJTTC^^0^B68420577
"BLD",7627,"KRN",9.8,"NM",44,0)
IBCSC6^^0^B15100068
"BLD",7627,"KRN",9.8,"NM",45,0)
IBCAPR^^0^B150582034
"BLD",7627,"KRN",9.8,"NM",46,0)
IBCEF11^^0^B72157495
"BLD",7627,"KRN",9.8,"NM",47,0)
IBCEU^^0^B105674829
"BLD",7627,"KRN",9.8,"NM",48,0)
IBCBB2^^0^B49120476
"BLD",7627,"KRN",9.8,"NM",50,0)
IBCEU5^^0^B79445173
"BLD",7627,"KRN",9.8,"NM",51,0)
IBCCC2^^0^B89240196
"BLD",7627,"KRN",9.8,"NM",52,0)
IBCEP2B^^0^B59761091
"BLD",7627,"KRN",9.8,"NM",53,0)
IBCEF22^^0^B61306963
"BLD",7627,"KRN",9.8,"NM",54,0)
IBCAPR1^^0^B7280643
"BLD",7627,"KRN",9.8,"NM",55,0)
IBCU7B^^0^B52236174
"BLD",7627,"KRN",9.8,"NM",56,0)
IBCEU7^^0^B28602980
"BLD",7627,"KRN",9.8,"NM",57,0)
IBCU7^^0^B78100882
"BLD",7627,"KRN",9.8,"NM",58,0)
IBCEP2^^0^B54308373
"BLD",7627,"KRN",9.8,"NM",59,0)
IBCCC^^0^B20747072
"BLD",7627,"KRN",9.8,"NM",60,0)
IBCCC1^^0^B10846914
"BLD",7627,"KRN",9.8,"NM",61,0)
IBCCCB^^0^B88589489
"BLD",7627,"KRN",9.8,"NM",62,0)
IBCC^^0^B58814397
"BLD",7627,"KRN",9.8,"NM",64,0)
IBCEOB21^^0^B26316775
"BLD",7627,"KRN",9.8,"NM",65,0)
IBCAPP1^^0^B37999170
"BLD",7627,"KRN",9.8,"NM",66,0)
IBY432PO^^0^B24652883
"BLD",7627,"KRN",9.8,"NM",67,0)
IBCF23^^0^B40963193
"BLD",7627,"KRN",9.8,"NM",68,0)
IBCF23A^^0^B19444201
"BLD",7627,"KRN",9.8,"NM",69,0)
IBCCPT^^0^B86719137
"BLD",7627,"KRN",9.8,"NM",70,0)
IBCEMQA^^0^B15212408
"BLD",7627,"KRN",9.8,"NM",71,0)
IBCECOB2^^0^B156849928
"BLD",7627,"KRN",9.8,"NM",72,0)
IBCEF79^^0^B170462166
"BLD",7627,"KRN",9.8,"NM",73,0)
IBCAPP^^0^B19459268
"BLD",7627,"KRN",9.8,"NM",76,0)
IBCEU0^^0^B65545551
"BLD",7627,"KRN",9.8,"NM",77,0)
IBCAPP2^^0^B40572879
"BLD",7627,"KRN",9.8,"NM",78,0)
IBCNSBL2^^0^B33173974
"BLD",7627,"KRN",9.8,"NM",79,0)
IBCEF81^^0^B105842498
"BLD",7627,"KRN",9.8,"NM",80,0)
IBCEF71^^0^B65598873
"BLD",7627,"KRN",9.8,"NM",81,0)
IBCBB12^^0^B132831016
"BLD",7627,"KRN",9.8,"NM",82,0)
IBCEF82^^0^B111186112
"BLD",7627,"KRN",9.8,"NM",83,0)
IBCEF83^^0^B56319703
"BLD",7627,"KRN",9.8,"NM",84,0)
IBCEF7^^0^B50797975
"BLD",7627,"KRN",9.8,"NM",85,0)
IBCEF74^^0^B47493658
"BLD",7627,"KRN",9.8,"NM",86,0)
IBCEF74A^^0^B39969650
"BLD",7627,"KRN",9.8,"NM",87,0)
IBCEU3^^0^B75406373
"BLD",7627,"KRN",9.8,"NM",88,0)
IBCBB9^^0^B8708481
"BLD",7627,"KRN",9.8,"NM",89,0)
IBCEFP^^0^B85133537
"BLD",7627,"KRN",9.8,"NM",90,0)
IBCEFP1^^0^B10606502
"BLD",7627,"KRN",9.8,"NM",91,0)
IBCEF76^^0^B45722940
"BLD",7627,"KRN",9.8,"NM",92,0)
IBCEF84^^0^B4728757
"BLD",7627,"KRN",9.8,"NM",93,0)
IBCU2^^0^B8155508
"BLD",7627,"KRN",9.8,"NM",94,0)
IBCEF80^^0^B53774560
"BLD",7627,"KRN",9.8,"NM",95,0)
IBCEU1^^0^B59089714
"BLD",7627,"KRN",9.8,"NM",96,0)
IBCBB^^0^B73668257
"BLD",7627,"KRN",9.8,"NM",97,0)
IBCEF73A^^0^B55865498
"BLD",7627,"KRN",9.8,"NM",98,0)
IBCEF72^^0^B54190068
"BLD",7627,"KRN",9.8,"NM",99,0)
IBCEF2^^0^B64226101
"BLD",7627,"KRN",9.8,"NM",100,0)
IBCAPR2^^0^B99779459
"BLD",7627,"KRN",9.8,"NM",101,0)
IBCEU6^^0^B13249318
"BLD",7627,"KRN",9.8,"NM",102,0)
IBCVC^^0^B12760924
"BLD",7627,"KRN",9.8,"NM",103,0)
IBCEOB^^0^B95746536
"BLD",7627,"KRN",9.8,"NM",104,0)
IBCB1^^0^B67924398
"BLD",7627,"KRN",9.8,"NM",105,0)
IBCU74^^0^B35879024
"BLD",7627,"KRN",9.8,"NM",106,0)
IBCNSC01^^0^B55647455
"BLD",7627,"KRN",9.8,"NM",107,0)
IBJTCA1^^0^B52064339
"BLD",7627,"KRN",9.8,"NM","B","IBCAPP",73)

"BLD",7627,"KRN",9.8,"NM","B","IBCAPP1",65)

"BLD",7627,"KRN",9.8,"NM","B","IBCAPP2",77)

"BLD",7627,"KRN",9.8,"NM","B","IBCAPR",45)

"BLD",7627,"KRN",9.8,"NM","B","IBCAPR1",54)

"BLD",7627,"KRN",9.8,"NM","B","IBCAPR2",100)

"BLD",7627,"KRN",9.8,"NM","B","IBCAPU",21)

"BLD",7627,"KRN",9.8,"NM","B","IBCB1",104)

"BLD",7627,"KRN",9.8,"NM","B","IBCBB",96)

"BLD",7627,"KRN",9.8,"NM","B","IBCBB1",5)

"BLD",7627,"KRN",9.8,"NM","B","IBCBB11",26)

"BLD",7627,"KRN",9.8,"NM","B","IBCBB12",81)

"BLD",7627,"KRN",9.8,"NM","B","IBCBB2",48)

"BLD",7627,"KRN",9.8,"NM","B","IBCBB21",41)

"BLD",7627,"KRN",9.8,"NM","B","IBCBB3",15)

"BLD",7627,"KRN",9.8,"NM","B","IBCBB9",88)

"BLD",7627,"KRN",9.8,"NM","B","IBCC",62)

"BLD",7627,"KRN",9.8,"NM","B","IBCCC",59)

"BLD",7627,"KRN",9.8,"NM","B","IBCCC1",60)

"BLD",7627,"KRN",9.8,"NM","B","IBCCC2",51)

"BLD",7627,"KRN",9.8,"NM","B","IBCCCB",61)

"BLD",7627,"KRN",9.8,"NM","B","IBCCPT",69)

"BLD",7627,"KRN",9.8,"NM","B","IBCECOB",8)

"BLD",7627,"KRN",9.8,"NM","B","IBCECOB1",11)

"BLD",7627,"KRN",9.8,"NM","B","IBCECOB2",71)

"BLD",7627,"KRN",9.8,"NM","B","IBCECOB6",17)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF11",46)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF2",99)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF22",53)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF31",27)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF7",84)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF71",80)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF72",98)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF73A",97)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF74",85)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF74A",86)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF75",42)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF76",91)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF79",72)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF80",94)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF81",79)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF82",82)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF83",83)

"BLD",7627,"KRN",9.8,"NM","B","IBCEF84",92)

"BLD",7627,"KRN",9.8,"NM","B","IBCEFP",89)

"BLD",7627,"KRN",9.8,"NM","B","IBCEFP1",90)

"BLD",7627,"KRN",9.8,"NM","B","IBCEMQA",70)

"BLD",7627,"KRN",9.8,"NM","B","IBCEMRAX",18)

"BLD",7627,"KRN",9.8,"NM","B","IBCEMU1",13)

"BLD",7627,"KRN",9.8,"NM","B","IBCEMU4",12)

"BLD",7627,"KRN",9.8,"NM","B","IBCEOB",103)

"BLD",7627,"KRN",9.8,"NM","B","IBCEOB21",64)

"BLD",7627,"KRN",9.8,"NM","B","IBCEP2",58)

"BLD",7627,"KRN",9.8,"NM","B","IBCEP2B",52)

"BLD",7627,"KRN",9.8,"NM","B","IBCEP8",9)

"BLD",7627,"KRN",9.8,"NM","B","IBCEP8B",10)

"BLD",7627,"KRN",9.8,"NM","B","IBCEU",47)

"BLD",7627,"KRN",9.8,"NM","B","IBCEU0",76)

"BLD",7627,"KRN",9.8,"NM","B","IBCEU1",95)

"BLD",7627,"KRN",9.8,"NM","B","IBCEU3",87)

"BLD",7627,"KRN",9.8,"NM","B","IBCEU5",50)

"BLD",7627,"KRN",9.8,"NM","B","IBCEU6",101)

"BLD",7627,"KRN",9.8,"NM","B","IBCEU7",56)

"BLD",7627,"KRN",9.8,"NM","B","IBCF23",67)

"BLD",7627,"KRN",9.8,"NM","B","IBCF23A",68)

"BLD",7627,"KRN",9.8,"NM","B","IBCNSBL2",78)

"BLD",7627,"KRN",9.8,"NM","B","IBCNSC01",106)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC10",32)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC102",33)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC10A",34)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC10B",35)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC10H",36)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC5A",3)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC5C",4)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC6",44)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC7",37)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC8",23)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC82",28)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC8A",29)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC8B",30)

"BLD",7627,"KRN",9.8,"NM","B","IBCSC8H",31)

"BLD",7627,"KRN",9.8,"NM","B","IBCSCE",39)

"BLD",7627,"KRN",9.8,"NM","B","IBCSCH",24)

"BLD",7627,"KRN",9.8,"NM","B","IBCSCP",38)

"BLD",7627,"KRN",9.8,"NM","B","IBCSCU",25)

"BLD",7627,"KRN",9.8,"NM","B","IBCU",14)

"BLD",7627,"KRN",9.8,"NM","B","IBCU2",93)

"BLD",7627,"KRN",9.8,"NM","B","IBCU7",57)

"BLD",7627,"KRN",9.8,"NM","B","IBCU71",6)

"BLD",7627,"KRN",9.8,"NM","B","IBCU74",105)

"BLD",7627,"KRN",9.8,"NM","B","IBCU7B",55)

"BLD",7627,"KRN",9.8,"NM","B","IBCU82",7)

"BLD",7627,"KRN",9.8,"NM","B","IBCVC",102)

"BLD",7627,"KRN",9.8,"NM","B","IBJPS",19)

"BLD",7627,"KRN",9.8,"NM","B","IBJPS2",20)

"BLD",7627,"KRN",9.8,"NM","B","IBJPS3",16)

"BLD",7627,"KRN",9.8,"NM","B","IBJTCA1",107)

"BLD",7627,"KRN",9.8,"NM","B","IBJTTC",43)

"BLD",7627,"KRN",9.8,"NM","B","IBY432PO",66)

"BLD",7627,"KRN",9.8,"NM","B","IBY432PR",40)

"BLD",7627,"KRN",19,0)
19
"BLD",7627,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",7627,"KRN",19,"NM",1,0)
IBCE COB MANAGEMENT^^0
"BLD",7627,"KRN",19,"NM",2,0)
IBCE 837 EDI MENU^^2
"BLD",7627,"KRN",19,"NM",3,0)
IB COPY SECOND/THIRD^^0^
"BLD",7627,"KRN",19,"NM",4,0)
IBCE PRINT EOB^^0
"BLD",7627,"KRN",19,"NM",5,0)
IB THIRD PARTY BILLING MENU^^2
"BLD",7627,"KRN",19,"NM","B","IB COPY SECOND/THIRD",3)

"BLD",7627,"KRN",19,"NM","B","IB THIRD PARTY BILLING MENU",5)

"BLD",7627,"KRN",19,"NM","B","IBCE 837 EDI MENU",2)

"BLD",7627,"KRN",19,"NM","B","IBCE COB MANAGEMENT",1)

"BLD",7627,"KRN",19,"NM","B","IBCE PRINT EOB",4)

"BLD",7627,"KRN",19.1,0)
19.1
"BLD",7627,"KRN",101,0)
101
"BLD",7627,"KRN",101,"NM",0)
^9.68A^19^18
"BLD",7627,"KRN",101,"NM",1,0)
IBCEM COB MANAGEMENT 2^^0
"BLD",7627,"KRN",101,"NM",2,0)
IBCAPR MENU^^0
"BLD",7627,"KRN",101,"NM",3,0)
IBCAPR PRINT MAR^^0
"BLD",7627,"KRN",101,"NM",4,0)
IBCAPR PRINT MAR DEFAULT^^0
"BLD",7627,"KRN",101,"NM",5,0)
IBCAPR PRINTF^^0
"BLD",7627,"KRN",101,"NM",6,0)
IBCAPR PRINTFD^^0
"BLD",7627,"KRN",101,"NM",8,0)
IBCEM REMOVE FROM WORKLIST^^0
"BLD",7627,"KRN",101,"NM",9,0)
IBCEM COB EXIT^^4^
"BLD",7627,"KRN",101,"NM",10,0)
IBCEM COPY SECOND/THIRD^^4^
"BLD",7627,"KRN",101,"NM",11,0)
IBCE EOB VIEW^^4^
"BLD",7627,"KRN",101,"NM",12,0)
IBCEM COB EDIT BILL^^4^
"BLD",7627,"KRN",101,"NM",13,0)
IBCEM CLONE BILL^^4^
"BLD",7627,"KRN",101,"NM",14,0)
IBCEM COB TPJI^^4^
"BLD",7627,"KRN",101,"NM",15,0)
IBCEM MRA STATUS^^4^
"BLD",7627,"KRN",101,"NM",16,0)
IBCEM VIEW COMMENTS^^4^
"BLD",7627,"KRN",101,"NM",17,0)
IBCEM COB CANCEL^^4^
"BLD",7627,"KRN",101,"NM",18,0)
IBCEM CORRECT REJECTED/DENIED BILL^^4^
"BLD",7627,"KRN",101,"NM",19,0)
IBCAPR2 MAIN ENTRY^^0
"BLD",7627,"KRN",101,"NM","B","IBCAPR MENU",2)

"BLD",7627,"KRN",101,"NM","B","IBCAPR PRINT MAR",3)

"BLD",7627,"KRN",101,"NM","B","IBCAPR PRINT MAR DEFAULT",4)

"BLD",7627,"KRN",101,"NM","B","IBCAPR PRINTF",5)

"BLD",7627,"KRN",101,"NM","B","IBCAPR PRINTFD",6)

"BLD",7627,"KRN",101,"NM","B","IBCAPR2 MAIN ENTRY",19)

"BLD",7627,"KRN",101,"NM","B","IBCE EOB VIEW",11)

"BLD",7627,"KRN",101,"NM","B","IBCEM CLONE BILL",13)

"BLD",7627,"KRN",101,"NM","B","IBCEM COB CANCEL",17)

"BLD",7627,"KRN",101,"NM","B","IBCEM COB EDIT BILL",12)

"BLD",7627,"KRN",101,"NM","B","IBCEM COB EXIT",9)

"BLD",7627,"KRN",101,"NM","B","IBCEM COB MANAGEMENT 2",1)

"BLD",7627,"KRN",101,"NM","B","IBCEM COB TPJI",14)

"BLD",7627,"KRN",101,"NM","B","IBCEM COPY SECOND/THIRD",10)

"BLD",7627,"KRN",101,"NM","B","IBCEM CORRECT REJECTED/DENIED BILL",18)

"BLD",7627,"KRN",101,"NM","B","IBCEM MRA STATUS",15)

"BLD",7627,"KRN",101,"NM","B","IBCEM REMOVE FROM WORKLIST",8)

"BLD",7627,"KRN",101,"NM","B","IBCEM VIEW COMMENTS",16)

"BLD",7627,"KRN",409.61,0)
409.61
"BLD",7627,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",7627,"KRN",409.61,"NM",1,0)
IBCEM COB MANAGEMENT^^0
"BLD",7627,"KRN",409.61,"NM",2,0)
IBCAPR^^0
"BLD",7627,"KRN",409.61,"NM","B","IBCAPR",2)

"BLD",7627,"KRN",409.61,"NM","B","IBCEM COB MANAGEMENT",1)

"BLD",7627,"KRN",771,0)
771
"BLD",7627,"KRN",771,"NM",0)
^9.68A^^
"BLD",7627,"KRN",779.2,0)
779.2
"BLD",7627,"KRN",870,0)
870
"BLD",7627,"KRN",8989.51,0)
8989.51
"BLD",7627,"KRN",8989.52,0)
8989.52
"BLD",7627,"KRN",8994,0)
8994
"BLD",7627,"KRN","B",.4,.4)

"BLD",7627,"KRN","B",.401,.401)

"BLD",7627,"KRN","B",.402,.402)

"BLD",7627,"KRN","B",.403,.403)

"BLD",7627,"KRN","B",.5,.5)

"BLD",7627,"KRN","B",.84,.84)

"BLD",7627,"KRN","B",3.6,3.6)

"BLD",7627,"KRN","B",3.8,3.8)

"BLD",7627,"KRN","B",9.2,9.2)

"BLD",7627,"KRN","B",9.8,9.8)

"BLD",7627,"KRN","B",19,19)

"BLD",7627,"KRN","B",19.1,19.1)

"BLD",7627,"KRN","B",101,101)

"BLD",7627,"KRN","B",409.61,409.61)

"BLD",7627,"KRN","B",771,771)

"BLD",7627,"KRN","B",779.2,779.2)

"BLD",7627,"KRN","B",870,870)

"BLD",7627,"KRN","B",8989.51,8989.51)

"BLD",7627,"KRN","B",8989.52,8989.52)

"BLD",7627,"KRN","B",8994,8994)

"BLD",7627,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",7627,"QUES",0)
^9.62^^
"BLD",7627,"REQB",0)
^9.611^11^11
"BLD",7627,"REQB",1,0)
IB*2.0*431^1
"BLD",7627,"REQB",2,0)
IB*2.0*433^1
"BLD",7627,"REQB",3,0)
IB*2.0*436^1
"BLD",7627,"REQB",4,0)
IB*2.0*240^1
"BLD",7627,"REQB",5,0)
IB*2.0*389^1
"BLD",7627,"REQB",6,0)
IB*2.0*402^1
"BLD",7627,"REQB",7,0)
IB*2.0*405^1
"BLD",7627,"REQB",8,0)
IB*2.0*417^1
"BLD",7627,"REQB",9,0)
IB*2.0*419^1
"BLD",7627,"REQB",10,0)
XU*8.0*549^1
"BLD",7627,"REQB",11,0)
IB*2.0*416^1
"BLD",7627,"REQB","B","IB*2.0*240",4)

"BLD",7627,"REQB","B","IB*2.0*389",5)

"BLD",7627,"REQB","B","IB*2.0*402",6)

"BLD",7627,"REQB","B","IB*2.0*405",7)

"BLD",7627,"REQB","B","IB*2.0*416",11)

"BLD",7627,"REQB","B","IB*2.0*417",8)

"BLD",7627,"REQB","B","IB*2.0*419",9)

"BLD",7627,"REQB","B","IB*2.0*431",1)

"BLD",7627,"REQB","B","IB*2.0*433",2)

"BLD",7627,"REQB","B","IB*2.0*436",3)

"BLD",7627,"REQB","B","XU*8.0*549",10)

"DATA",350.8,90,0)
IB090^Total amt. of each line item cannot exceed $9,999,999.99 (split line/bill).^IB090^1^3
"DATA",350.8,164,0)
IB329^Address Line1,City,ST,ZIP required for Ambulance addresses in the USA^IB329^1^1
"DATA",350.8,167,0)
IB330^COB Total non-Covered Charge amt must equal total claim charge amt.^IB330^1^1
"DATA",350.8,173,0)
IB331^Attachment Control # REQUIRED when Trans Method = BM,EL,EM,FT or FX.^IB331^1^1
"DATA",350.8,174,0)
IB332^Transmission Method/Report Type are REQUIRED with Paperwork Attachments.^IB332^1^1
"DATA",350.8,177,0)
IB333^Claim Level Rend Prov REQUIRED unless all Line Level Rend Provs present.^IB333^1^1
"DATA",350.8,178,0)
IB334^Claim Level Rend Provider differs from all Line Level Rend Providers.^IB334^1^1
"DATA",350.8,181,0)
IB337^An Operating Provider is REQUIRED on a claim with an Other Operating Prov.^IB337^1^1
"DATA",350.8,182,0)
IB338^Claim requires an Operating or Rendering provider.^IB338^1^1
"DATA",350.8,183,0)
IB800^Automatic EOB Processing parameter is turned off.  File 350.9, Field 8.17.^IB800^1^1
"DATA",350.8,184,0)
IB801^No EOB Data Found^IB801^1^1
"DATA",350.8,185,0)
IB802^Multiple EOBs found for this claim^IB802^1^1
"DATA",350.8,186,0)
IB803^EOB Filing Errors^IB803^1^1
"DATA",350.8,187,0)
IB804^EOB Claim Status must be PROCESSED^IB804^1^1
"DATA",350.8,188,0)
IB805^Claim level remark code MA15 received.  Multiple EOBs.^IB805^1^1
"DATA",350.8,189,0)
IB806^Balance remaining dollar amount is less than or equal to $0^IB806^1^1
"DATA",350.8,190,0)
IB807^Need to pass in an internal claim number^IB807^1^1
"DATA",350.8,191,0)
IB808^Failed adjustment criteria selection^IB808^1^1
"DATA",350.8,192,0)
IB809^EOB Split to more claims^IB809^1^1
"DATA",350.8,193,0)
IB810^No Form Type defined^IB810^1^1
"DATA",350.8,194,0)
IB811^Auto-printer not defined in IB Site Parameters^IB811^1^1
"DATA",350.8,195,0)
IB812^Failed AUTOCOB Generation^IB812^1^1
"DATA",350.8,196,0)
IB339^The NPI is REQUIRED for the Service Facility.^IB339^1^1
"DATA",350.8,197,0)
IB340^The NPI is REQUIRED for the non-VA Service Facility.^IB340^1^1
"DATA",350.8,198,0)
IB341^The NPI is REQUIRED for the Billing Provider.^IB341^1^1
"DATA",350.8,199,0)
IB342^COB non-Covered Charge Amt is only valid for Medicare Secondary w/no MRA.^IB342^1^1
"DATA",350.8,201,0)
IB343^COB Total non-Covered Amt required for Medicare Secondary w/o MRA.^IB343^1^1
"DATA",350.8,202,0)
IB813^CHAMPVA Center or TRICARE Fiscal Intermediary or TRICARE Supplemental policy.^IB813^1^1
"DATA",350.8,203,0)
IB814^Secondary payer is Medicare and Tertiary coverage also exists.^IB814^1^1
"DATA",350.8,279,0)
IB312^Operating provider required on bill type 83X^IB312^1^3
"DATA",350.8,287,0)
IB105^Default division is required even w/multiple line level divisions present.^IB105^1^3
"DATA",350.8,301,0)
IB122^At least one Rendering Provider's Specialty Code of 99 is invalid for Medicare^IB122^1^3
"DATA",350.8,321,0)
IB141^A Referring Provider's NPI is required.^IB141^1^3
"DATA",350.8,322,0)
IB142^An Operating Provider's NPI is required.^IB142^1^3
"DATA",350.8,323,0)
IB143^A Rendering Provider's NPI is required.^IB143^1^3
"DATA",350.8,324,0)
IB144^An Attending Provider's NPI is required.^IB144^1^3
"DATA",350.8,325,0)
IB145^A Supervising Provider's NPI is required.^IB145^1^3
"DATA",350.8,326,0)
IB149^An Other Operating Provider's NPI is required.^IB149^1^3
"DATA",350.8,333,0)
IB161^A Division's NPI is required.^IB161^1^3
"DATA",350.8,334,0)
IB162^A Non-VA Service Facility's NPI is required.^IB162^1^3
"DATA",350.8,335,0)
IB163^A Billing Provider's NPI is required.^IB163^1^3
"DATA",353.3,1,0)
03^Report Justifying Treatment Beyond Utilization Guidelines
"DATA",353.3,2,0)
04^Drugs Administered
"DATA",353.3,3,0)
05^Treatment Diagnosis
"DATA",353.3,4,0)
06^Initial Assessment
"DATA",353.3,5,0)
07^Functional Goals
"DATA",353.3,6,0)
08^Plan of Treatment
"DATA",353.3,7,0)
09^Progress Report
"DATA",353.3,8,0)
10^Continued Treatment
"DATA",353.3,9,0)
11^Chemical Analysis
"DATA",353.3,10,0)
13^Certified Test Report
"DATA",353.3,11,0)
15^Justification for Admission
"DATA",353.3,12,0)
21^Recovery Plan
"DATA",353.3,13,0)
A3^Allergies/Sensitivities Document
"DATA",353.3,14,0)
A4^Autopsy Report
"DATA",353.3,15,0)
AM^Ambulance Certification
"DATA",353.3,16,0)
AS^Admission Summary
"DATA",353.3,17,0)
B2^Prescription
"DATA",353.3,18,0)
B3^Physician Order
"DATA",353.3,19,0)
B4^Referral Form
"DATA",353.3,20,0)
BR^Benchmark Testing Results
"DATA",353.3,21,0)
BS^Baseline
"DATA",353.3,22,0)
BT^Blanket Test Results
"DATA",353.3,23,0)
CB^Chiropractic Justification
"DATA",353.3,24,0)
CK^Consent Form(s)
"DATA",353.3,25,0)
CT^Certification
"DATA",353.3,26,0)
D2^Drug Profile Document
"DATA",353.3,27,0)
DA^Dental Models
"DATA",353.3,28,0)
DB^Durable Medical Equipment Prescription
"DATA",353.3,29,0)
DG^Diagnostic Report
"DATA",353.3,30,0)
DJ^Discharge Monitoring Report
"DATA",353.3,31,0)
DS^Discharge Summary
"DATA",353.3,32,0)
EB^Explanation of Benefits (Coordination of Benefits or Medicare Secondary Payor)
"DATA",353.3,33,0)
HC^Health Certificate
"DATA",353.3,34,0)
HR^Health Clinic Records
"DATA",353.3,35,0)
I5^Immunization Record
"DATA",353.3,36,0)
IR^State School Immunization Records
"DATA",353.3,37,0)
LA^Laboratory Results
"DATA",353.3,38,0)
M1^Medical Record Attachment
"DATA",353.3,39,0)
MT^Models
"DATA",353.3,40,0)
NN^Nursing Notes
"DATA",353.3,41,0)
OB^Operative Note
"DATA",353.3,42,0)
OC^Oxygen Content Averaging Report
"DATA",353.3,43,0)
OD^Orders and Treatments Document
"DATA",353.3,44,0)
OE^Objective Physical Examination (including vital signs) Document
"DATA",353.3,45,0)
OX^Oxygen Therapy Certification
"DATA",353.3,46,0)
OZ^Support Data for Claim
"DATA",353.3,47,0)
P4^Pathology Report
"DATA",353.3,48,0)
P5^Patient Medical History Document
"DATA",353.3,49,0)
PE^Parenteral or Enteral Certification
"DATA",353.3,50,0)
PN^Physical Therapy Notes
"DATA",353.3,51,0)
PO^Prosthetics or Orthotic Certification
"DATA",353.3,52,0)
PQ^Paramedical Results
"DATA",353.3,53,0)
PY^Physician’s Report
"DATA",353.3,54,0)
PZ^Physical Therapy Certification
"DATA",353.3,55,0)
RB^Radiology Films
"DATA",353.3,56,0)
RR^Radiology Reports
"DATA",353.3,57,0)
RT^Report of Tests and Analysis Report
"DATA",353.3,58,0)
RX^Renewable Oxygen Content Averaging Report
"DATA",353.3,59,0)
SG^Symptoms Document
"DATA",353.3,60,0)
V5^Death Notification
"DATA",353.3,61,0)
XP^Photographs
"DATA",364.5,195,0)
N-ALL INSURANCE CO PROV NUM^N^E^G^399^^^
"DATA",364.5,195,1)
N Z,Q,R S Q=$P($G(^DGCR(399,IBXIEN,"M1")),U,2,4),R=$P($G(^IBE(350.9,1,1)),U,5) F Z=1:1:3 I $D(^DGCR(399,IBXIEN,"I"_Z)) S IBXDATA(Z)=$P(Q,U,Z)
"DATA",364.5,195,3,0)
^^2^2^3110207^
"DATA",364.5,195,3,1,0)
Extracts the primary, secondary, and tertiary insurance company provider
"DATA",364.5,195,3,2,0)
numbers into the IBXDATA(1),(2),(3) array for bill entry IBXIEN.
"DATA",364.5,254,0)
N-AMBULANCE PU ADDR LINE 1^N^F^I^399^AMBULANCE P/U ADDRESS 1^^
"DATA",364.5,254,1)

"DATA",364.5,259,0)
N-AMBULANCE PU ADDR LINE 2^N^F^I^399^AMBULANCE P/U ADDRESS 2^E^
"DATA",364.5,259,1)

"DATA",364.5,269,0)
N-AMBULANCE PU CITY^N^F^I^399^AMBULANCE P/U CITY^E^
"DATA",364.5,269,1)

"DATA",364.5,324,0)
N-AMBULANCE PU STATE^N^F^I^399^AMBULANCE P/U STATE^E^
"DATA",364.5,324,1)

"DATA",364.5,325,0)
N-AMBULANCE PU ZIP^N^F^I^399^AMBULANCE P/U ZIP^^
"DATA",364.5,325,1)

"DATA",364.5,326,0)
N-AMBULANCE DO ADDR LINE 1^N^F^I^399^AMBULANCE D/O ADDRESS 1^^
"DATA",364.5,326,1)

"DATA",364.5,327,0)
N-AMBULANCE DO ADDR 2^N^F^I^399^AMBULANCE D/O ADDRESS 2^^
"DATA",364.5,327,1)

"DATA",364.5,328,0)
N-AMBULANCE DO CITY^N^F^I^399^AMBULANCE D/O CITY^E^
"DATA",364.5,328,1)

"DATA",364.5,329,0)
N-AMBULANCE DO STATE^N^F^I^399^AMBULANCE D/O STATE^E^
"DATA",364.5,329,1)

"DATA",364.5,330,0)
N-AMBULANCE DO ZIP^N^F^I^399^AMBULANCE D/O ZIP^^
"DATA",364.5,330,1)

"DATA",364.5,331,0)
N-AMBULANCE DO LOCATION^N^F^I^399^AMBULANCE D/O LOCATION^E^
"DATA",364.5,331,1)

"DATA",364.5,332,0)
N-PROP/CAS DATE OF 1ST CONTACT^N^F^I^399^PROP/CAS DATE OF 1ST CONTACT^I^
"DATA",364.5,332,1)

"DATA",364.5,333,0)
N-DISABILITY DATE QUALIFIER^N^E^I^399^^^
"DATA",364.5,333,1)
S IBXDATA=$S(IBXSAVE("DIS ST DT")&IBXSAVE("DIS END DT"):314,IBXSAVE("DIS END DT"):361,IBXSAVE("DIS ST DT"):360,1:"")
"DATA",364.5,334,0)
N-DISABILITY START DATE^N^F^I^399^DISABILITY START DATE^I^
"DATA",364.5,334,1)

"DATA",364.5,335,0)
N-DISABILITY END DATE^N^F^I^399^DISABILITY END DATE^I^
"DATA",364.5,335,1)

"DATA",364.5,336,0)
N-ASSUME CARE DATE^N^F^I^399^ASSUMED CARE DATE^I^
"DATA",364.5,336,1)

"DATA",364.5,337,0)
N-RELINQUISH CARE DATE^N^F^I^399^RELINQUISHED CARE DATE^I^
"DATA",364.5,337,1)

"DATA",364.5,338,0)
N-PRIMARY REFERRAL NUMBER^N^F^I^399^PRIMARY REFERRAL NUMBER^I^
"DATA",364.5,338,1)

"DATA",364.5,339,0)
N-SECONDARY REFERRAL NUMBER^N^F^I^399^SECONDARY REFERRAL NUMBER^^
"DATA",364.5,339,1)

"DATA",364.5,340,0)
N-TERTIARY REFERRAL NUMBER^N^F^I^399^TERTIARY REFERRAL NUMBER^^
"DATA",364.5,340,1)

"DATA",364.5,341,0)
N-CURRENT REFERRAL NUMBER^N^E^I^399^^^
"DATA",364.5,341,1)
N Z S Z=$$COBN^IBCEF(IBXIEN) D F^IBCEF("N-"_$P("PRIMARY^SECONDARY^TERTIARY",U,Z)_" REFERRAL NUMBER",,,IBXIEN)
"DATA",364.5,342,0)
N-ATT RPT TYPE^N^F^I^399^ATTACHMENT REPORT TYPE^E^
"DATA",364.5,342,1)

"DATA",364.5,343,0)
N-ATT RPT TRX CODE^N^F^I^399^ATTACHMENT REPORT TRANS CODE^I^
"DATA",364.5,343,1)

"DATA",364.5,344,0)
N-ATT CONTROL NUM^N^F^I^399^ATTACHMENT CONTROL NUMBER^E^
"DATA",364.5,344,1)

"DATA",364.5,345,0)
N-PROP/CAS CLAIM NUMBER^N^F^I^399^PROPERTY/CASUALTY CLAIM NUMBER^E^
"DATA",364.5,345,1)

"DATA",364.5,346,0)
N-PROP/CAS CONTACT NAME^N^F^I^399^PROPERTY/CASUALTY CONTACT NAME^E^
"DATA",364.5,346,1)

"DATA",364.5,347,0)
N-PROP/CAS CONTACT TELEPHONE^N^F^I^399^PROP/CAS COMMUNICATION NUMBER^E^
"DATA",364.5,347,1)

"DATA",364.5,348,0)
N-PROP/CAS CONTACT EXTENSION^N^F^I^399^PROP/CAS EXTENSION NUMBER^E^
"DATA",364.5,348,1)

"DATA",364.5,349,0)
N-PRI SURG PROC CODE^N^F^I^399^PRIMARY SURGICAL PROC CODE^E^
"DATA",364.5,349,1)

"DATA",364.5,350,0)
N-SEC SURG PROC CODE^N^F^I^399^SECONDARY SURGICAL PROC CODE^E^
"DATA",364.5,350,1)

"DATA",364.5,351,0)
N-COB TOTAL NON-COVERED AMOUNT^N^F^I^399^COB TOTAL NON-COVERED AMOUNT^E^
"DATA",364.5,351,1)

"DATA",364.5,352,0)
N-RENDERING PHYSICIAN NAME^N^E^I^399^^^
"DATA",364.5,352,1)
N IBZ D GETPRV^IBCEU(IBXIEN,3,.IBZ) S IBXDATA=$P($G(IBZ(3,1)),U)_U_$P($G(IBZ(3,1)),U,3)_U_$P($G(IBZ(3,1)),U,4)
"DATA",364.5,352,3,0)
^364.53^1^1^3101103^^^
"DATA",364.5,352,3,1,0)
1st '^'-piece is name, 2nd is new person file ien, 3rd is credentials
"DATA",364.5,353,0)
N-ALL REFERRAL NUMBERS^N^E^G^399^^^
"DATA",364.5,353,1)
N IBZ,Z F Z=1:1:3 D F^IBCEF("N-"_$P("PRIMARY^SECONDARY^TERTIARY",U,Z)_" REFERRAL NUMBER","IBZ",,IBXIEN) S IBXDATA(Z)=IBZ
"DATA",364.5,354,0)
N-OTHER PAYER REF NUM^N^E^G^399^^^
"DATA",364.5,354,1)
N Z,Z0,Z1,IBZ D F^IBCEF("N-ALL REFERRAL NUMBERS","IBZ") S Z=$$COBN^IBCEF(IBXIEN) S Z0=0 F Z1=1:1:3 I Z1'=Z,($G(IBZ(Z1))]"") S Z0=Z0+1,IBXDATA(Z0)=$G(IBZ(Z1))
"DATA",364.5,357,0)
N-EOB OTHER PAYER INFO^N^E^G^361.1^^^
"DATA",364.5,357,1)
N Z,Z0,Z1,Z2,IBZ D F^IBCEF("N-EOB ENTRIES","IBZ") S Z=$$COBN^IBCEF(IBXIEN) S Z0=0 F Z1=1:1:3 I Z1'=Z S Z2=$O(IBZ(Z1,""),-1) I Z2 S Z0=Z0+1,IBXDATA(Z0)=IBZ(Z1,Z2)
"DATA",364.5,358,0)
N-CURRENT AUTH/REFERRAL CODE^N^E^I^399^^^
"DATA",364.5,358,1)
N Z S Z=$$COBN^IBCEF(IBXIEN),IBXDATA=$$AUTRF^IBCEF31(IBXIEN,28,Z)
"DATA",364.5,358,3,0)
^364.53^5^5^3100928^^^
"DATA",364.5,358,3,1,0)
This data element finds the treatment authorization code for
"DATA",364.5,358,3,2,0)
bill IBXIEN for the current insurance company. If there is also
"DATA",364.5,358,3,3,0)
a referral number, it  will include that after, separated by a space.
"DATA",364.5,358,3,4,0)
Possible output is:  Auth code Referral #     or:  Auth code     or:
"DATA",364.5,358,3,5,0)
Referral #     or:  null
"DATA",364.5,359,0)
N-ALL AUTH/REFERRAL CODES^N^E^G^399^^^
"DATA",364.5,359,1)
N Z F Z=1:1:3 I $S(Z=1:1,1:$D(^DGCR(399,IBXIEN,"I"_Z))) S IBXDATA(Z)=$$AUTRF^IBCEF31(IBXIEN,30,Z)
"DATA",364.5,359,3,0)
^^5^5^3100928^
"DATA",364.5,359,3,1,0)
Extracts the 3 authorization codes for bill IBXIEN into IBXDATA(1),
"DATA",364.5,359,3,2,0)
IBXDATA(2), IBXDATA(3). If there is also a referral number, it will
"DATA",364.5,359,3,3,0)
include that after, separated by a space.
"DATA",364.5,359,3,4,0)
Possible output is:  Auth code Referral #     or:  Auth code     or:
"DATA",364.5,359,3,5,0)
Referral #     or:  null
"DATA",364.5,360,0)
N-ATTENDING PHYSICIAN NAME^N^E^I^399^^^
"DATA",364.5,360,1)
N IBZ,IBT S IBT=4 D GETPRV^IBCEU(IBXIEN,IBT,.IBZ) S IBXDATA=$P($G(IBZ(IBT,1)),U)_U_$P($G(IBZ(IBT,1)),U,3)_U_$P($G(IBZ(IBT,1)),U,4)
"DATA",364.5,361,0)
N-LAB/FAC CONTACT NAME^N^E^I^355.93^^^
"DATA",364.5,361,1)
N Z K IBXDATA S Z=+$P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1)),U,2) S:Z IBXDATA=$P($G(^IBA(355.93,Z,1)),U,1)
"DATA",364.5,362,0)
N-LAB/FAC CONTACT PHONE^N^E^I^355.93^^^
"DATA",364.5,362,1)
N Z K IBXDATA S Z=+$P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1)),U,2) S:Z IBXDATA=$P($G(^IBA(355.93,Z,1)),U,2)
"DATA",364.5,363,0)
N-LAB/FAC CONTACT EXT^N^E^I^355.93^^^
"DATA",364.5,363,1)
N Z K IBXDATA S Z=+$P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1)),U,2) S:Z IBXDATA=$P($G(^IBA(355.93,Z,1)),U,3)
"DATA",364.5,364,0)
N-REFERRING PROVIDER NAME BR^N^E^I^399^^^
"DATA",364.5,364,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,1,"A1")
"DATA",364.5,364,3,0)
^^1^1^3101102^
"DATA",364.5,364,3,1,0)
The name of the referring provider for bill entry IBXIEN.
"DATA",364.5,365,0)
N-OPERATING PHYSICIAN NAME BR^N^E^I^399^^^
"DATA",364.5,365,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,2,"A1")
"DATA",364.5,365,3,0)
^364.53^1^1^3101103^^
"DATA",364.5,365,3,1,0)
The name of the operating physician for bill entry IBXIEN.
"DATA",364.5,366,0)
N-SPRVSING PROV FULL NAME BR^N^E^I^399^^^
"DATA",364.5,366,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,5,"A1")_U_$$GETPRV^IBCEF83(IBXIEN,,5,"A0")_U_$$GETPRV^IBCEF83(IBXIEN,,5,"A6")
"DATA",364.5,366,3,0)
^^2^2^3101102^
"DATA",364.5,366,3,1,0)
The name of the supervising physician for bill entry IBXIEN.  The pieces 
"DATA",364.5,366,3,2,0)
returned are: provider name^vp ien for provider (200/355.93)^credentials
"DATA",364.5,367,0)
N-OPERATING PHYSICIAN DATA BR^N^E^G^399^^^
"DATA",364.5,367,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,2,"A1")_U_$$GETPRV^IBCEF83(IBXIEN,,2,"A7")_U_$$GETPRV^IBCEF83(IBXIEN,,2,"A0")_U_$$GETPRV^IBCEF83(IBXIEN,,2,"A6")
"DATA",364.5,367,3,0)
^364.53^3^3^3101103^^
"DATA",364.5,367,3,1,0)
The name of the operating physician for bill entry IBXIEN.  The pieces 
"DATA",364.5,367,3,2,0)
returned are: provider name^current cob id^vp ien for provider 
"DATA",364.5,367,3,3,0)
(200/355.93)^credentials.
"DATA",364.5,368,0)
N-RENDERING PHYSICIAN NAME BR^N^E^I^399^^^
"DATA",364.5,368,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,3,"A1")_U_$$GETPRV^IBCEF83(IBXIEN,,3,"A0")_U_$$GETPRV^IBCEF83(IBXIEN,,3,"A6")
"DATA",364.5,368,3,0)
^364.53^2^2^3101210^^
"DATA",364.5,368,3,1,0)
The name of the rendering physician for bill entry IBXIEN.  The pieces 
"DATA",364.5,368,3,2,0)
returned are: provider name^vp ien for provider (200/355.93)^credentials.
"DATA",364.5,369,0)
N-ATTENDING PHYSICIAN NAME BR^N^E^I^399^^^
"DATA",364.5,369,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,4,"A1")_U_$$GETPRV^IBCEF83(IBXIEN,,4,"A0")_U_$$GETPRV^IBCEF83(IBXIEN,,4,"A6")
"DATA",364.5,369,3,0)
^364.53^2^2^3101210^^
"DATA",364.5,369,3,1,0)
The name of the attending physician for bill entry IBXIEN.  The pieces 
"DATA",364.5,369,3,2,0)
returned are: provider name^vp ien for provider (200/355.93)^credentials.
"DATA",364.5,370,0)
N-ATT/REND PHYSICIAN NAME BR^N^E^I^399^^^
"DATA",364.5,370,1)
N IBT S IBT=$S($$FT^IBCEF(IBXIEN)=2:3,1:4) S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,IBT,"A1")_U_$$GETPRV^IBCEF83(IBXIEN,,IBT,"A0")_U_$$GETPRV^IBCEF83(IBXIEN,,IBT,"A6")
"DATA",364.5,370,3,0)
^^3^3^3101103^
"DATA",364.5,370,3,1,0)
The name of the ATTENDING or RENDERING provider for bill entry IBXIEN.  
"DATA",364.5,370,3,2,0)
The pieces returned are: provider name^vp ien for provider 
"DATA",364.5,370,3,3,0)
(200/355.93)^credentials.
"DATA",364.5,371,0)
N-CMS-1500 BOX 24I ID QUAL BR^N^E^G^399^^^
"DATA",364.5,371,1)
D CMSBOX24^IBCEF83(IBXIEN,"I",.IBXDATA)
"DATA",364.5,371,3,0)
^364.53^3^3^3101109^^^
"DATA",364.5,371,3,1,0)
Data element returns the IBXDATA array box 24I on the printed 1500 claim 
"DATA",364.5,371,3,2,0)
form.  This is the rendering provider ID qualifier.  Each claim line item 
"DATA",364.5,371,3,3,0)
has 2 lines in the IBXDATA array.
"DATA",364.5,372,0)
N-CMS-1500 24J REND PROV ID BR^N^E^G^399^^^
"DATA",364.5,372,1)
D CMSBOX24^IBCEF83(IBXIEN,"J",.IBXDATA)
"DATA",364.5,372,3,0)
^364.53^3^3^3101109^^
"DATA",364.5,372,3,1,0)
Data element returns the IBXDATA array for box 24J on the printed 1500 
"DATA",364.5,372,3,2,0)
claim form.  This is the Rendering Provider secondary ID and NPI#.  Each 
"DATA",364.5,372,3,3,0)
service line on the claim form has 2 lines in the IBXDATA array.
"DATA",364.5,373,0)
N-OI4 COB SETUP^N^E^I^399^^^
"DATA",364.5,373,1)
K IBXSAVE("CCOB") D CCOB1^IBCEU1(IBXIEN,"0,1,2,4")
"DATA",364.5,373,3,0)
^^2^2^3101229^
"DATA",364.5,373,3,1,0)
This extracts the Other Payer Check and Status info which used to be in 
"DATA",364.5,373,3,2,0)
the COB1 record.
"DATA",364.5,374,0)
N-VALUE CODE GROUP^N^E^G^399^^^
"DATA",364.5,374,1)
K IBXDATA D VC1^IBCVC(IBXIEN,.IBFL)
"DATA",364.5,374,3,0)
^364.53^3^3^3110223^^
"DATA",364.5,374,3,1,0)
This will extract the value Codes from ^DGCR(399,IBXIEN,"CV",n). If the 
"DATA",364.5,374,3,2,0)
claim is institutional (UB-04) the A3, B3, and C3 will be overwritten by 
"DATA",364.5,374,3,3,0)
the estimated claim value calculated as it is in CL1.12.
"DATA",364.5,375,0)
N-ALL PROVIDERS 1^N^E^G^399^^^
"DATA",364.5,375,1)
N IBZ,Z D GETPRV1^IBCEU(IBXIEN,"ALL",.IBZ) F Z=1:1:$O(IBZ(""),-1) S:'$G(IBZ(Z)) IBZ(Z)="" M IBXDATA(Z)=IBZ(Z)
"DATA",364.5,375,3,0)
^^2^2^3110727^
"DATA",364.5,375,3,1,0)
Returns array in the format:
"DATA",364.5,375,3,2,0)
IBPRV(level,type,ct)=name^current COB id^vp provider ien^cred
"DATA",364.6,55,0)
8^N^^50^1^^1^15^4^Admission Hour^^1^^
"DATA",364.6,57,0)
8^N^^50^1^^1^17^4^Discharge Hour^^1^^
"DATA",364.6,87,0)
8^N^^75^1^^0^4^3^Procedure Code Qualifier^^1^^
"DATA",364.6,88,0)
8^N^^80^1^^0^2^3^Value Code^^1^^
"DATA",364.6,93,0)
8^N^^90^1^^0^3^3^Diagnosis Code Qualifier^^1
"DATA",364.6,114,0)
8^N^^180^1^^0^5^9^Line Item Charge Amt^^1^0^^
"DATA",364.6,130,0)
8^N^^185^1^^0^9^9^Service Line Charge Amt^^1^^
"DATA",364.6,195,0)
8^N^^105^1^^0^12^18^COB Total Non-Covered Amount^^1^^
"DATA",364.6,804,0)
8^N^^105^1^^0^13^2^COB Total Non-Covered Amount Qualifier^^1^^
"DATA",364.6,806,0)
8^N^^105^1^^0^15^20^Other Payer Prior Auth Qual^^1^^
"DATA",364.6,891,0)
8^N^^115^1^^0^10^8^BLANK^^1^^
"DATA",364.6,935,0)
8^N^^96^1^^0^16^2^Attending Prov Taxonomy Qualifier^0^1^^
"DATA",364.6,941,0)
8^N^^96^1^^0^2^20^Attending Prov Last Name^0^1^0^^
"DATA",364.6,942,0)
8^N^^96^1^^0^3^20^Attending Prov First Name^0^1^^
"DATA",364.6,943,0)
8^N^^96^1^^0^4^10^Attending Prov Name Suffix^0^1^0^^
"DATA",364.6,944,0)
8^N^^96^1^^0^5^5^BLANK^0^1^^
"DATA",364.6,951,0)
8^N^^96^1^^0^17^10^Attending Prov Taxonomy^0^1^^
"DATA",364.6,957,0)
8^N^^35^1^^0^9^35^Prior Authorization #^^1^^
"DATA",364.6,962,0)
8^N^^115^1^^0^12^2^BLANK^0^1^^
"DATA",364.6,973,0)
8^N^^97^1^^0^4^1^Attending Prov Entity Type Qualifier^0^1^^
"DATA",364.6,974,0)
8^N^^180^1^^0^21^8^BLANK^0^1^^
"DATA",364.6,985,0)
8^N^^97^1^^0^2^2^Attending Prov Primary ID Qualifier^0^1^^
"DATA",364.6,986,0)
8^N^^97^1^^0^3^10^Attending Prov Primary ID^0^1^^
"DATA",364.6,990,0)
8^N^^97^1^^0^7^1^Other Oper Prov Entity Type Qualifier^0^1^^
"DATA",364.6,991,0)
8^N^^97^1^^0^5^2^Other Oper Prov Primary ID Qualifier^0^1^^
"DATA",364.6,992,0)
8^N^^97^1^^0^6^10^Other Oper Prov Primary ID^0^1^^
"DATA",364.6,993,0)
8^N^^97^1^^0^8^2^Operating Phy Primary ID Qualifier^0^1^^
"DATA",364.6,999,0)
8^N^^35^1^^0^11^50^Payer Claim Control Number^^1^^
"DATA",364.6,1000,0)
8^N^^35^1^^0^10^2^Payer Claim Control Number Qualifier^^1^^
"DATA",364.6,1007,0)
8^N^^97^1^^0^10^3^Rend Prov Credentials^0^1^^
"DATA",364.6,1045,0)
8^N^^57^1^^0^4.5^2^Lab/Facility ID Setup^1^1^0^^
"DATA",364.6,1047,0)
8^N^^97^1^^0^11^2^Referring Prov Primary ID Qualifier^0^1^0^^
"DATA",364.6,1181,0)
8^N^^178^1^0^0^3^2^Other Payer Oth Op Prov Entity ID^0^1^0^^
"DATA",364.6,1182,0)
8^N^^178^1^0^0^4^1^Other Payer Oth Op Prov Entity Qual^0^1^0^^
"DATA",364.6,1183,0)
8^N^^178^1^0^0^5^2^Other Payer Oth Op Prov Sec ID Qual(1)^0^1^0^^
"DATA",364.6,1184,0)
8^N^^178^1^0^0^6^30^Other Payer Oth Op Prov Sec ID(1)^0^1^0^^
"DATA",364.6,1185,0)
8^N^^178^1^0^0^7^2^Other Payer Oth Op Prov Sec ID Qual(2)^0^1^0^^
"DATA",364.6,1186,0)
8^N^^178^1^0^0^8^30^Other Payer Oth Op Prov Sec ID(2)^0^1^0^^
"DATA",364.6,1187,0)
8^N^^178^1^0^0^9^2^Other Payer Oth Op Prov Sec ID Qual(3)^0^1^0^^
"DATA",364.6,1188,0)
8^N^^178^1^0^0^10^30^Other Payer Oth Op Prov Sec ID(3)^0^1^0^^
"DATA",364.6,1224,0)
8^N^^98^1^^0^2^2^ Attending Prov Sec ID Qualifier (1)^0^1^^
"DATA",364.6,1225,0)
8^N^^98^1^^0^3^30^Attending Prov Sec ID (1)^0^1^^
"DATA",364.6,1226,0)
8^N^^98^1^^0^4^2^Attending Prov Sec ID Qualifier (2)^0^1^^
"DATA",364.6,1227,0)
8^N^^98^1^^0^5^30^Attending Prov Sec ID (2)^0^1^^
"DATA",364.6,1228,0)
8^N^^98^1^^0^6^2^Attending Prov Sec ID Qualifier (3)^0^1^^
"DATA",364.6,1229,0)
8^N^^98^1^^0^7^30^Attending Prov Sec ID (3)^0^1^^
"DATA",364.6,1230,0)
8^N^^98^1^^0^8^2^Attending Prov Sec ID Qualifier (4)^0^1^^
"DATA",364.6,1231,0)
8^N^^98^1^^0^9^30^Attending Prov Sec ID (4)^0^1^^
"DATA",364.6,1232,0)
8^N^^98^1^^0^10^2^Attending Prov Sec ID Qualifier (5)^0^1^^
"DATA",364.6,1233,0)
8^N^^98^1^^0^11^30^Attending Prov Sec ID (5)^0^1^^
"DATA",364.6,1487,0)
2^N^^1^44^^1^50^8^CHARGES (BX-24F)^^
"DATA",364.6,1917,0)
8^N^^51^1^^0^17^3^Patient Reason for Visit Qualifier (1)^0^1
"DATA",364.6,1919,0)
8^N^^51^1^^0^19^3^Patient Reason for Visit Qualifier (2)^0^1
"DATA",364.6,1921,0)
8^N^^51^1^^0^21^3^Patient Reason for Visit Qualifier (3)^0^1
"DATA",364.6,1935,0)
8^N^^51^1^^0^15^3^Code List Qualifier Code (BJ)^^1
"DATA",364.6,1937,0)
8^N^^104.8^1^^0^1^4^RECORD ID 'AMB '^0^1^1
"DATA",364.6,1938,0)
8^N^^104.8^1^^0^2^2^Amb PU Addr Type Qualifier^0^1^0
"DATA",364.6,1939,0)
8^N^^104.9^1^^0^1^4^RECORD ID 'AMB '^^1^0
"DATA",364.6,1940,0)
8^N^^104.8^1^^0^3^40^Amb PU Addr 1^0^1^0
"DATA",364.6,1941,0)
8^N^^104.8^1^^0^4^30^Amb PU Addr 2^0^1^0
"DATA",364.6,1942,0)
8^N^^104.8^1^^0^5^30^Amb PU City^0^1^0
"DATA",364.6,1943,0)
8^N^^104.8^1^^0^6^2^Amb PU State^0^1^0
"DATA",364.6,1944,0)
8^N^^104.8^1^^0^7^15^Amb PU Zip^0^1^0
"DATA",364.6,1945,0)
8^N^^104.9^1^^0^2^2^Amb DO Addr Type Qualifier^0^1^0
"DATA",364.6,1946,0)
8^N^^104.9^1^^0^3^40^Amb DO Addr 1^0^1^0
"DATA",364.6,1947,0)
8^N^^104.9^1^^0^4^30^Amb DO Addr 2^0^1^0
"DATA",364.6,1948,0)
8^N^^104.9^1^^0^5^30^Amb DO City^0^1^0
"DATA",364.6,1949,0)
8^N^^104.9^1^^0^6^2^Amb DO State^0^1^0
"DATA",364.6,1950,0)
8^N^^104.9^1^^0^7^15^Amb DO Zip^0^1^0
"DATA",364.6,1951,0)
8^N^^104.9^1^^0^8^60^Amb DO Location^0^1^0
"DATA",364.6,1952,0)
8^N^^15^1^^0^9^17^Billing Prov Primary ID^0^1^0
"DATA",364.6,1953,0)
8^N^^15^1^^0^12^2^Billing Prov Primary ID Qual^0^1^0
"DATA",364.6,1954,0)
8^N^^51^1^^0^29^3^Prop/Cas Date 1st Cont Qual^0^1^0
"DATA",364.6,1955,0)
8^N^^51^1^^0^30^8^Prop/Cas Date of 1st Contact^0^1^0
"DATA",364.6,1956,0)
8^N^^51^1^^0^23^3^Disability Date Qualifier^0^1^0
"DATA",364.6,1957,0)
8^N^^51^1^^0^22.8^8^Disability Start Date^1^1^0
"DATA",364.6,1958,0)
8^N^^51^1^^0^22.9^8^Disability End Date^1^1^0
"DATA",364.6,1959,0)
8^N^^51^1^^0^24^17^Disability Date(s)^0^1^0
"DATA",364.6,1960,0)
8^N^^51^1^^0^25^3^Assume Care Date Qualifier^0^1^0
"DATA",364.6,1961,0)
8^N^^51^1^^0^26^8^Assume Care Date^0^1^0
"DATA",364.6,1962,0)
8^N^^51^1^^0^27^3^Relinquish Care Date Qualifier^0^1^0
"DATA",364.6,1963,0)
8^N^^51^1^^0^28^8^Relinquish Care Date^0^1^0
"DATA",364.6,1964,0)
8^N^^15^1^^0^13^2^Billing Prov Taxonomy Code Qualifier^0^1^0
"DATA",364.6,1965,0)
8^N^^15^1^^0^14^10^Billing Prov Taxonomy Code^0^1^0
"DATA",364.6,1966,0)
8^N^^35^1^^0^13^2^Prior Authorization Qualifier^0^1^0
"DATA",364.6,1967,0)
8^N^^35^1^^0^14^2^Referral Number Qualifier^^1
"DATA",364.6,1968,0)
8^N^^35^1^^0^15^20^Referral Number^^1
"DATA",364.6,1969,0)
8^N^^52^1^^0^1^4^RECORD ID 'CL1B'^^1
"DATA",364.6,1970,0)
8^N^^52^1^^0^2^2^Attachment Report Type^^1
"DATA",364.6,1971,0)
8^N^^52^1^^0^3^2^Attachment Report Transmission Code^^1
"DATA",364.6,1972,0)
8^N^^52^1^^0^4^2^Attachment Control Qualifier^^1
"DATA",364.6,1973,0)
8^N^^52^1^^0^5^30^Attachemnt Control Number^^1
"DATA",364.6,1974,0)
8^N^^45^1^^0^5^3^Prop/Cas Claim Number Qualifier^^1
"DATA",364.6,1975,0)
8^N^^45^1^^0^6^30^Prop/Cas Claim Number^^1
"DATA",364.6,1976,0)
8^N^^45^1^^0^7^2^Prop/Cas Contact Name Qualifier^^1
"DATA",364.6,1977,0)
8^N^^45^1^^0^8^60^Prop/Cas Contact Name^^1
"DATA",364.6,1978,0)
8^N^^45^1^^0^9^2^Prop/Cas Contact Tele Qualifier^^1
"DATA",364.6,1979,0)
8^N^^45^1^^0^10^10^Prop/Cas Contact Telephone^^1
"DATA",364.6,1980,0)
8^N^^45^1^^0^11^2^Prop/Cas Contact Ext Qualifier^^1
"DATA",364.6,1981,0)
8^N^^45^1^^0^12^10^Prop/Cas contact Extension^^1
"DATA",364.6,1982,0)
8^N^^77^1^^0^1^4^RECORD ID 'SPC '^^1
"DATA",364.6,1983,0)
8^N^^77^1^^0^2^3^Primary Surgical Proc Code Qualifier^^1
"DATA",364.6,1984,0)
8^N^^77^1^^0^3^10^Primary Surgical Proc Code^^1
"DATA",364.6,1985,0)
8^N^^77^1^^0^4^3^Secondary Surgical Proc Code Qualifier^^1
"DATA",364.6,1986,0)
8^N^^77^1^^0^5^10^Secondary Surgical Proc Code^^1
"DATA",364.6,1988,0)
8^N^^57^1^^0^5^2^Lab/Facility Primary ID Qualifier^0^1
"DATA",364.6,1991,0)
8^N^^104.2^1^^0^1^4^RECORD ID 'OPR9'^0
"DATA",364.6,1992,0)
8^N^^104.2^1^^0^1.5^^Rendering Provider Name^1
"DATA",364.6,1993,0)
8^N^^104.2^1^^0^2^2^Rendering Provider qualifier^0
"DATA",364.6,1994,0)
8^N^^104.2^1^^0^3^1^Rendering Provider type
"DATA",364.6,1995,0)
8^N^^104.2^1^^0^4^35^Rendering Provider Last Name
"DATA",364.6,1996,0)
8^N^^104.2^1^^0^5^25^Rendering Provider First Name
"DATA",364.6,1997,0)
8^N^^104.2^1^^0^6^25^Rendering Provider Middle Name
"DATA",364.6,1998,0)
8^N^^104.2^1^^0^7^10^Rendering Provider Name Suffix
"DATA",364.6,1999,0)
8^N^^104.2^1^^0^8^2^Rendering Provider  Primary ID Qualifier^0
"DATA",364.6,2000,0)
8^N^^104.2^1^^0^9^30^Rendering Provider Primary ID
"DATA",364.6,2001,0)
8^N^^104.2^1^^0^10^2^Rendering Provider Taxonomy Qualifier
"DATA",364.6,2002,0)
8^N^^104.2^1^^0^11^10^Rendering Provider Taxonomy
"DATA",364.6,2003,0)
8^N^^104.4^1^^0^1^4^RECORD ID 'OPRA'
"DATA",364.6,2004,0)
8^N^^104.4^1^^0^2^2^Rendering provider sec ID Qualifier (1)
"DATA",364.6,2005,0)
8^N^^104.4^1^^0^3^30^Rendering provider sec ID (1)
"DATA",364.6,2006,0)
8^N^^104.4^1^^0^4^2^Rendering provider sec ID Qualifier (2)
"DATA",364.6,2007,0)
8^N^^104.4^1^^0^5^30^Rendering provider sec ID (2)
"DATA",364.6,2008,0)
8^N^^104.4^1^^0^6^2^Rendering provider sec ID Qualifier (3)
"DATA",364.6,2009,0)
8^N^^104.4^1^^0^7^30^Rendering provider sec ID (3)
"DATA",364.6,2010,0)
8^N^^104.4^1^^0^8^2^Rendering provider sec ID Qualifier (4)
"DATA",364.6,2011,0)
8^N^^104.4^1^^0^9^30^Rendering provider sec ID (4)
"DATA",364.6,2012,0)
8^N^^170.5^1^^0^1^4^RECORD ID 'OP1A'^^1^0
"DATA",364.6,2013,0)
8^N^^170.5^1^^0^2^1^Payer Responsibility Sequence # Code^^1^0
"DATA",364.6,2014,0)
8^N^^170.5^1^^0^3^2^Other Payer Attending Entity ID^^1^0
"DATA",364.6,2015,0)
8^^^170.5^1^^0^4^1^Other Payer Attending Entity Type Qual^^1^0
"DATA",364.6,2016,0)
8^N^^170.5^1^^0^5^2^Other Payer Attending Sec ID Qual (1)^^1^0
"DATA",364.6,2017,0)
8^N^^170.5^1^^0^6^30^Other Payer Attending Sec ID (1)^^1^0
"DATA",364.6,2018,0)
8^N^^170.5^1^^0^7^2^Other Payer Attending Sec ID Qual (2)^^1^0
"DATA",364.6,2019,0)
8^N^^170.5^1^^0^8^30^Other Payer Attending Sec ID (2)^^1^0
"DATA",364.6,2020,0)
8^N^^170.5^1^^0^9^2^Other Payer Attending Sec ID Qual (3)^^1^0
"DATA",364.6,2021,0)
8^N^^170.5^1^^0^10^30^Other Payer Attending Sec ID (3)^^1^0
"DATA",364.6,2022,0)
8^N^^190^1^^^11^3^Prescription date qualifier^0
"DATA",364.6,2023,0)
8^N^^190^1^^0^12^8^Prescription date^0
"DATA",364.6,2024,0)
8^N^^112^1^^0^11^2^Other Payer Referral Number qualifier^0
"DATA",364.6,2025,0)
8^N^^112^1^^^12^20^Other Payer Referral Number^0
"DATA",364.6,2026,0)
8^N^^112^1^^0^8^3^Other payer Check Qualifier^0
"DATA",364.6,2027,0)
8^N^^112^1^^0^9^8^Other payer Check Date^0
"DATA",364.6,2028,0)
8^N^^112^1^^0^10^2^Other payer claim status^0
"DATA",364.6,2029,0)
8^N^^57^1^^0^17^2^Facility contact name qualifier^0^1
"DATA",364.6,2030,0)
8^N^^57^1^^0^18^35^Facility Contact name^0^1
"DATA",364.6,2031,0)
8^N^^57^1^^0^19^2^Facility phone number qualifier^0^1
"DATA",364.6,2032,0)
8^N^^57^1^^0^20^10^Facility phone number^0^1
"DATA",364.6,2033,0)
8^N^^57^1^^0^21^2^Facility phone extension qualifier^0^1
"DATA",364.6,2034,0)
8^N^^57^1^^0^22^10^Facility phone extension^0^1
"DATA",364.6,2050,0)
8^N^^191^1^^0^1^4^RECORD ID 'LDAT'^0^1
"DATA",364.6,2051,0)
8^N^^191^1^^0^2^6^Service Line Counter^0^1
"DATA",364.6,2052,0)
8^N^^191^1^^0^1.9^^LDAT DATA EXTRACT^1^1
"DATA",364.6,2053,0)
8^N^^191^1^^0^3^2^Attachment Report Type^0^1
"DATA",364.6,2054,0)
8^N^^191^1^^0^4^2^Attachment Report Transmission Code^0^1
"DATA",364.6,2055,0)
8^N^^191^1^^0^5^2^Attachment Control Qualifier^0^1
"DATA",364.6,2056,0)
8^N^^191^1^^0^6^30^Attachment Control Number^0^1
"DATA",364.6,2057,0)
8^N^^191^1^^0^7^2^OB Anesthesia Additional Units Qualifier^0^1
"DATA",364.6,2058,0)
8^N^^191^1^^0^8^5^OB Anesthesia Additional Units^0^1
"DATA",364.6,2059,0)
8^N^^191^1^^0^9^2^Prior Authorization Qualifier^0^1
"DATA",364.6,2060,0)
8^N^^191^1^^0^10^25^Prior Authorization Number^0^1
"DATA",364.6,2061,0)
8^N^^191^1^^0^11^2^Line Item Control Number Qualifier^0^1
"DATA",364.6,2062,0)
8^N^^191^1^^0^12^20^Line Item Control Number^0^1
"DATA",364.6,2063,0)
8^N^^191^1^^0^13^20^Purchase Service Provider ID^0^1
"DATA",364.6,2064,0)
8^N^^191^1^^0^14^8^Purchase Service Amount^0^1
"DATA",364.6,2065,0)
8^N^^191^1^^0^99.9^1^Cleanup^1^1
"DATA",364.6,2066,0)
8^N^^192^1^^0^1^4^RECORD ID 'LOPE'^0^1
"DATA",364.6,2067,0)
8^N^^192^1^^0^1.9^1^LOPE DATA EXTRACT^1^1
"DATA",364.6,2068,0)
8^N^^192^1^^0^2^6^Service Line Counter^0^1
"DATA",364.6,2069,0)
8^N^^192^1^^0^3^2^Operating Physician Qualifier^0^1
"DATA",364.6,2070,0)
8^N^^192^1^^0^4^60^Operating Physician Last Name^0^1
"DATA",364.6,2071,0)
8^N^^192^1^^0^5^35^Operating Physician First Name^0^1
"DATA",364.6,2072,0)
8^N^^192^1^^0^6^1^Operating Physician Middle Initial^0^1
"DATA",364.6,2073,0)
8^N^^192^1^^0^7^10^Operating Physician Suffix^0^1
"DATA",364.6,2074,0)
8^N^^192^1^^0^8^2^Primary ID Qualifier^0^1
"DATA",364.6,2075,0)
8^N^^192^1^^0^9^10^Primary ID^0^1
"DATA",364.6,2076,0)
8^N^^192^1^^0^10^2^Secondary ID Qualifier (1)^0^1
"DATA",364.6,2077,0)
8^N^^192^1^^0^11^10^Secondary ID (1)^0^1
"DATA",364.6,2078,0)
8^N^^192^1^^0^12^2^Secondary ID Qualifier (2)^0^1
"DATA",364.6,2079,0)
8^N^^192^1^^0^13^10^Secondary ID (2)^0^1
"DATA",364.6,2080,0)
8^N^^192^1^^0^14^2^Secondary ID Qualifier (3)^0^1
"DATA",364.6,2081,0)
8^N^^192^1^^0^15^10^Secondary ID (3)^0^1
"DATA",364.6,2084,0)
8^N^^192^1^^0^99.9^1^Cleanup^1^1
"DATA",364.6,2085,0)
8^N^^193^1^^0^1^4^RECORD ID 'LOP1'^0^1
"DATA",364.6,2086,0)
8^N^^193^1^^0^2^6^Service Line Counter^0^1
"DATA",364.6,2087,0)
8^N^^193^1^^0^1.9^1^LOP1 DATA EXTRACT^1^1
"DATA",364.6,2088,0)
8^N^^193^1^^0^3^2^Other Operating Physician Qualifier^0^1
"DATA",364.6,2089,0)
8^N^^193^1^^0^4^60^Other Operating Physician Last Name^0^1
"DATA",364.6,2090,0)
8^N^^193^1^^0^5^35^Other Operating Physician First Name^0^1
"DATA",364.6,2091,0)
8^N^^193^1^^0^6^1^Other Operating Physician Middle Initial^0^1
"DATA",364.6,2092,0)
8^N^^193^1^^0^7^10^Other Operating Physician Suffix^0^1
"DATA",364.6,2093,0)
8^N^^193^1^^0^8^2^Primary ID Qualifier^0^1
"DATA",364.6,2094,0)
8^N^^193^1^^0^9^10^Primary ID^0^1
"DATA",364.6,2095,0)
8^N^^193^1^^0^10^2^Secondary ID Qualifier (1)^0^1
"DATA",364.6,2096,0)
8^N^^193^1^^0^11^10^Secondary ID (1)^0^1
"DATA",364.6,2097,0)
8^N^^193^1^^0^12^2^Secondary ID Qualifier (2)^0^1
"DATA",364.6,2098,0)
8^N^^193^1^^0^13^10^Secondary ID (2)^0^1
"DATA",364.6,2099,0)
8^N^^193^1^^0^14^2^Secondary ID Qualifier (3)^0^1
"DATA",364.6,2100,0)
8^N^^193^1^^0^15^10^Secondary ID (3)^0^1
"DATA",364.6,2103,0)
8^N^^193^1^^0^99.9^1^Cleanup^1^1
"DATA",364.6,2104,0)
8^N^^193.3^1^^0^1^4^RECORD ID 'LREN'^0^1
"DATA",364.6,2105,0)
8^N^^193.3^1^^0^1.9^1^LREN DATA EXTRACT^1^1
"DATA",364.6,2106,0)
8^N^^193.3^1^^0^2^6^Service Line Counter^0^1
"DATA",364.6,2107,0)
8^N^^193.3^1^^0^3^2^Rendering Provider Qualifier^0^1
"DATA",364.6,2108,0)
8^N^^193.3^1^^0^4^60^Rendering Provider Last Name^0^1
"DATA",364.6,2109,0)
8^N^^193.3^1^^0^5^35^Rendering Provider First Name^0^1
"DATA",364.6,2110,0)
8^N^^193.3^1^^0^6^1^Rendering Provider Middle Initial^0^1
"DATA",364.6,2111,0)
8^N^^193.3^1^^0^7^10^Rendering Provider Suffix^0^1
"DATA",364.6,2112,0)
8^N^^193.3^1^^0^8^2^Primary ID Qualifier^0^1
"DATA",364.6,2113,0)
8^N^^193.3^1^^0^9^10^Primary ID^0^1
"DATA",364.6,2114,0)
8^N^^193.3^1^^0^10^2^Secondary ID Qualifier (1)^0^1
"DATA",364.6,2115,0)
8^N^^193.3^1^^0^11^10^Secondary ID (1)^0^1
"DATA",364.6,2116,0)
8^N^^193.3^1^^0^12^2^Secondary ID Qualifier (2)^0^1
"DATA",364.6,2117,0)
8^N^^193.3^1^^0^13^10^Secondary ID (2)^0^1
"DATA",364.6,2118,0)
8^N^^193.3^1^^0^14^2^Secondary ID Qualifier (3)^0^1
"DATA",364.6,2119,0)
8^N^^193.3^1^^0^15^10^Secondary ID (3)^0^1
"DATA",364.6,2122,0)
8^N^^193.3^1^^0^99.9^1^Cleanup^1^1
"DATA",364.6,2123,0)
8^N^^193.3^1^^0^16^2^Taxonomy Qualifier^0^1
"DATA",364.6,2124,0)
8^N^^193.3^1^^0^17^10^Taxonomy Code^0^1
"DATA",364.6,2125,0)
8^N^^193.6^1^^0^1^4^RECORD ID 'LPUR'^0^1
"DATA",364.6,2126,0)
8^N^^193.6^1^^0^1.9^1^LPUR DATA EXTRACT^1^1
"DATA",364.6,2127,0)
8^N^^193.6^1^^0^2^6^Service Line Counter^0^1
"DATA",364.6,2128,0)
8^N^^193.6^1^^0^3^2^Purchase Service Provider Qualifier^0^1
"DATA",364.6,2129,0)
8^N^^193.6^1^^0^4^2^Primary ID Qualifier^0^1
"DATA",364.6,2130,0)
8^N^^193.6^1^^0^5^10^Primary ID^0^1
"DATA",364.6,2131,0)
8^N^^193.6^1^^0^6^2^Secondary ID Qualifier (1)^0^1
"DATA",364.6,2132,0)
8^N^^193.6^1^^0^7^10^Secondary ID (1)^0^1
"DATA",364.6,2133,0)
8^N^^193.6^1^^0^99.9^1^Cleanup^1^1
"DATA",364.6,2134,0)
8^N^^194^1^^0^1^4^RECORD ID 'LSUP'^0^1
"DATA",364.6,2135,0)
8^N^^194^1^^0^1.9^1^LSUP DATA EXTRACT^1^1
"DATA",364.6,2136,0)
8^N^^194^1^^0^2^6^Service Line Counter^0^1
"DATA",364.6,2137,0)
8^N^^194^1^^0^3^2^Supervising Provider Qualifier^0^1
"DATA",364.6,2138,0)
8^N^^194^1^^0^4^60^Supervising Provider Last Name^0^1
"DATA",364.6,2139,0)
8^N^^194^1^^0^5^35^Supervising Provider First Name^0^1
"DATA",364.6,2140,0)
8^N^^194^1^^0^6^1^Supervising Provider Middle Initial^0^1
"DATA",364.6,2141,0)
8^N^^194^1^^0^7^10^Supervising Provider Suffix^0^1
"DATA",364.6,2142,0)
8^N^^194^1^^0^8^2^Primary ID Qualifier^0^1
"DATA",364.6,2143,0)
8^N^^194^1^^0^9^10^Primary ID^0^1
"DATA",364.6,2144,0)
8^N^^194^1^^0^10^2^Secondary ID Qualifier (1)^0^1
"DATA",364.6,2145,0)
8^N^^194^1^^0^11^10^Secondary ID (1)^0^1
"DATA",364.6,2146,0)
8^N^^194^1^^0^12^2^Secondary ID Qualifier (2)^0^1
"DATA",364.6,2147,0)
8^N^^194^1^^0^13^10^Secondary ID (2)^0^1
"DATA",364.6,2148,0)
8^N^^194^1^^0^14^2^Secondary ID Qualifier (3)^0^1
"DATA",364.6,2149,0)
8^N^^194^1^^0^15^10^Secondary ID (3)^0^1
"DATA",364.6,2152,0)
8^N^^194^1^^0^99.9^1^Cleanup^1^1
"DATA",364.6,2153,0)
8^N^^194.3^1^^0^1^4^RECORD ID 'LREF'^0^1
"DATA",364.6,2154,0)
8^N^^194.3^1^^0^1.9^1^LREF DATA EXTRACT^1^1
"DATA",364.6,2155,0)
8^N^^194.3^1^^0^2^6^Service Line Counter^0^1
"DATA",364.6,2156,0)
8^N^^194.3^1^^0^3^2^Referring Provider Qualifier^0^1
"DATA",364.6,2157,0)
8^N^^194.3^1^^0^4^60^Referring Provider Last Name^0^1
"DATA",364.6,2158,0)
8^N^^194.3^1^^0^5^35^Referring Provider First Name^0^1
"DATA",364.6,2159,0)
8^N^^194.3^1^^0^6^1^Referring Provider Middle Initial^0^1
"DATA",364.6,2160,0)
8^N^^194.3^1^^0^7^10^Referring Provider Suffix^0^1
"DATA",364.6,2161,0)
8^N^^194.3^1^^0^8^2^Primary ID Qualifier^0^1
"DATA",364.6,2162,0)
8^N^^194.3^1^^0^9^10^Primary ID^0^1
"DATA",364.6,2163,0)
8^N^^194.3^1^^0^10^2^Secondary ID Qualifier (1)^0^1
"DATA",364.6,2164,0)
8^N^^194.3^1^^0^11^10^Secondary ID (1)^0^1
"DATA",364.6,2165,0)
8^N^^194.3^1^^0^12^2^Secondary ID Qualifier (2)^0^1
"DATA",364.6,2166,0)
8^N^^194.3^1^^0^13^10^Secondary ID (2)^0^1
"DATA",364.6,2167,0)
8^N^^194.3^1^^0^14^2^Secondary ID Qualifier (3)^0^1
"DATA",364.6,2168,0)
8^N^^194.3^1^^0^15^10^Secondary ID (3)^0^1
"DATA",364.6,2169,0)
8^N^^194.3^1^^0^99.9^1^Cleanup^1^1
"DATA",364.6,2170,0)
8^N^^57^1^^0^99^1^SUB2 Clean Up^1
"DATA",364.6,2171,0)
8^N^^28^1^^0^1.5^1^CI1A Setup^1
"DATA",364.6,2172,0)
8^N^^28^1^^0^99^1^CI1A Clean Up^1
"DATA",364.6,2173,0)
8^N^^96^1^^0^1.5^1^OPR Setup^1
"DATA",364.6,2174,0)
8^N^^96^1^^0^99.5^1^OPR Cleanup^1
"DATA",364.6,2175,0)
8^N^^97^1^^0^1.5^1^OPR1 Setup^1
"DATA",364.6,2176,0)
8^N^^97^1^^0^99.5^1^OPR1 Cleanup^1
"DATA",364.6,2177,0)
8^N^^98^1^^0^1.5^1^OPR2 Setup^1
"DATA",364.6,2178,0)
8^N^^98^1^^0^99.5^1^OPR2 Cleanup^1
"DATA",364.6,2179,0)
8^N^^99^1^^0^1.5^1^OPR3 Setup^1
"DATA",364.6,2180,0)
8^N^^99^1^^0^99.5^^OPR3 Cleanup^1
"DATA",364.6,2181,0)
8^N^^100^1^^0^1.5^^OPR4 Setup^1
"DATA",364.6,2182,0)
8^N^^100^1^^0^99.5^^OPR4 Cleanup^1
"DATA",364.6,2183,0)
8^N^^101^1^^0^1.5^^OPR5 Setup^1
"DATA",364.6,2184,0)
8^N^^101^1^^0^99.5^^OPR5 Clean up^1
"DATA",364.6,2185,0)
8^N^^103^1^^0^99.5^^OPR7 Clean up^1
"DATA",364.6,2186,0)
8^N^^104^1^^0^1.5^^OPR8 Setup^1
"DATA",364.6,2187,0)
8^N^^104^1^^0^99.5^^OPR8 Cleanup^1
"DATA",364.6,2188,0)
8^N^^104.2^1^^0^99.5^^OPR9 Cleanup^1
"DATA",364.6,2189,0)
8^N^^104.4^1^^0^1.5^^OPRA Setup^1
"DATA",364.6,2190,0)
8^N^^104.4^1^^0^99.5^^OPRA Cleanup^1
"DATA",364.6,2191,0)
8^N^^170^1^^0^1.5^^OP1 Setup^1
"DATA",364.6,2192,0)
8^N^^170^1^^0^99.5^^OP1 Cleanup^1
"DATA",364.6,2193,0)
8^N^^170.5^1^^0^1.5^^OP1A Setup^1
"DATA",364.6,2194,0)
8^N^^170.5^1^^0^99.5^^OP1A Cleanup^1
"DATA",364.6,2195,0)
8^N^^171^1^^0^1.5^^OP2 Setup^1
"DATA",364.6,2196,0)
8^N^^171^1^^0^99.5^^OP2 Cleanup^1
"DATA",364.6,2197,0)
8^N^^173^1^^0^1.5^^OP4 Setup^1
"DATA",364.6,2198,0)
8^N^^173^1^^0^99.5^^OP4 Cleanup^1
"DATA",364.6,2199,0)
8^N^^177^1^^0^1.5^^OP8 Setup^1
"DATA",364.6,2200,0)
8^N^^178^1^^0^1.5^^OP9 Setup^1
"DATA",364.6,2201,0)
8^N^^178^1^^0^99.5^^OP9 Cleanup^1
"DATA",364.6,2202,0)
8^N^^114^1^^0^99.9^1^OI6 Cleanup^1
"DATA",364.6,2203,0)
8^N^^112^1^^0^7.9^^COB DATA SETUP^1
"DATA",364.6,2204,0)
8^N^^105^1^^0^19^3^Remaining patient Liability qualifier
"DATA",364.6,2205,0)
8^N^^105^1^^0^20^15^Remaining Patient Liability
"DATA",364.6,2206,0)
8^N^^195^1^^0^18^1^Payer Responsibility Sequence # Code^0
"DATA",364.6,2207,0)
8^N^^200^1^^0^22^1^Payer Responsibility Sequence # Code^0^1^0
"DATA",364.6,2208,0)
8^^^16^1^^0^12^9^Pay-To Provider Tax ID^0^1
"DATA",364.7,12,0)
1015^N^5^^^^N
"DATA",364.7,12,1)
S IBXDATA=$P($G(IBXSAVE("BILLING PRV",IBXIEN,"C",1,2)),U,1)
"DATA",364.7,12,3,0)
^364.73^7^7^3101108^^^^
"DATA",364.7,12,3,1,0)
EI=Employer ID;SY=Social Security Number;0B=State License Number;
"DATA",364.7,12,3,2,0)
1A = Blue Cross Number;1B=Blue Shield Number;1C=Medicare Number;
"DATA",364.7,12,3,3,0)
1D = Medicaid Number;1G=UPIN Number;1H=TRICARE ID Number;
"DATA",364.7,12,3,4,0)
B3 = PPO Number;BQ=HMO Code Number;U3=USIN Number;G2=Commercial Number;
"DATA",364.7,12,3,5,0)
FH = Clinic Number;X5=State Industrial Accident Provider Number;
"DATA",364.7,12,3,6,0)
LU=Location Number
"DATA",364.7,12,3,7,0)
This is the X12 interpretation of the type of billing provider id for this insurance co.  It is calculated from the electronic type of plan. Refer to the 837 V4010 (professional) fields 2010BB/REF(2)/01 and 2000B/SBR/09 for details.
"DATA",364.7,40,0)
87^N^5^^^^N
"DATA",364.7,40,1)
K IBXDATA N Z S Z=0 F  S Z=$O(IBXSAVE("PROC",Z)) Q:'Z  S IBXDATA(Z)=$S($O(IBXSAVE("PROC",Z),-1)="":$S($P(IBXSAVE("PROC",Z),U)["CPT":"BP",1:"BR"),$P(IBXSAVE("PROC",Z),U)["CPT":"BO",1:"BQ")
"DATA",364.7,40,3,0)
^364.73^5^5^3101221^^
"DATA",364.7,40,3,1,0)
If there are any procedures (not relating to charges) on the bill, output
"DATA",364.7,40,3,2,0)
the type of procedure here:
"DATA",364.7,40,3,3,0)
 
"DATA",364.7,40,3,4,0)
BR = principal procedure and is an ICD code
"DATA",364.7,40,3,5,0)
BQ = not principal procedure, but is an ICD code
"DATA",364.7,53,0)
945^N^5^^^^N
"DATA",364.7,53,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,"NAME")),U,1)
"DATA",364.7,53,3,0)
^364.73^2^2^3101109^^^^
"DATA",364.7,53,3,1,0)
 
"DATA",364.7,53,3,2,0)
Operating provider last name
"DATA",364.7,68,0)
48^N^23^^^^N
"DATA",364.7,68,1)
S IBXDATA="Y"
"DATA",364.7,68,3,0)
^364.73^1^1^3101215^^^^
"DATA",364.7,68,3,1,0)
Converts release of information indicator from DHCP to X12 format.
"DATA",364.7,103,0)
63^N^5^^^^N
"DATA",364.7,103,1)
S IBXDATA=$P($G(^DGCR(399,IBXIEN,"U")),U,8) S:'IBXDATA IBXDATA=9
"DATA",364.7,103,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,103,3,1,0)
If data element's value is null, do not output.
"DATA",364.7,106,0)
161^N^374^^^^N
"DATA",364.7,106,1)
K IBXDATA N Z K:$D(IBFL(39))=1 IBFL(39) S Z=0 F  S Z=$O(IBFL(39,Z)) K:'Z IBFL(39) Q:'Z  S IBXSAVE("VALUE",Z)=IBFL(39,Z)
"DATA",364.7,106,3,0)
^364.73^4^4^3110216^^^^
"DATA",364.7,106,3,1,0)
Data element's array reference is IBFL(39), not default of IBXDATA.  This is
"DATA",364.7,106,3,2,0)
a group data element so more than 1 occurrence of a value is possible for
"DATA",364.7,106,3,3,0)
the data element in the IBFL(39) array.  Save off values in IBXSAVE array
"DATA",364.7,106,3,4,0)
for later use.  No output.
"DATA",364.7,131,0)
165^N^286^^^^N
"DATA",364.7,131,1)
I +IBXDATA S IBXDATA="Y"
"DATA",364.7,131,3,0)
^^1^1^3110104^
"DATA",364.7,131,3,1,0)
Only report if Data is 1 set IBXDATA to Y
"DATA",364.7,188,0)
195^N^351^^^^N
"DATA",364.7,188,1)
S IBXDATA=$$NOPUNCT^IBCEF($G(IBXDATA))
"DATA",364.7,205,0)
1041^N^274^^^^N^0
"DATA",364.7,205,1)
I $G(IBXDATA) S IBXDATA=77
"DATA",364.7,205,3,0)
^^5^5^3110901^
"DATA",364.7,205,3,1,0)
If the service is performed at an outside facility, output the
"DATA",364.7,205,3,2,0)
service facility type of facility if defined for the outside facility.
"DATA",364.7,205,3,3,0)
If none defined, output the default of 'FA' for non-lab and 'LI' for lab.
"DATA",364.7,205,3,4,0)
IB*2.0*432 changed this requirement to always send a 77 if there is an 
"DATA",364.7,205,3,5,0)
outside facility defined or null.
"DATA",364.7,209,0)
1045^N^5^^^^N^0
"DATA",364.7,209,1)
D CLEANUP^IBCEFP1(.IBXSAVE) D:$$SENDSF^IBCEF79(IBXIEN) ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1) S IBXDATA=$P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1,0)),U,1)
"DATA",364.7,209,3,0)
^364.73^3^3^3101104^^
"DATA",364.7,209,3,1,0)
Build the IBXSAVE array with the data needed to complete the SUB2 record.
"DATA",364.7,209,3,2,0)
Only build if $$SENDSF^IBCEF79(IBXIEN) is true.  We only send 
"DATA",364.7,209,3,3,0)
SUB2 if there is a SUB record.
"DATA",364.7,212,0)
1047^N^5^^^^N^0
"DATA",364.7,212,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,0)),U,3)
"DATA",364.7,213,0)
1048^N^5^^^^N
"DATA",364.7,213,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,0)),U,4)
"DATA",364.7,226,0)
226^N^5^^^^N
"DATA",364.7,226,1)
S IBXDATA=$P($G(IBXSAVE("BILLING PRV",IBXIEN,"C",1,1)),U,1)
"DATA",364.7,226,3,0)
^364.73^1^1^3101104^^
"DATA",364.7,226,3,1,0)
CI1A-2 site suffix or facility ID qualifier.  This is hard-coded to be G5.
"DATA",364.7,229,0)
1057^N^5^^^^N
"DATA",364.7,229,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,229,3,0)
^^1^1^3101108^
"DATA",364.7,229,3,1,0)
Builds IBXSAVE array for OPR7 record. No output.
"DATA",364.7,230,0)
1058^N^5^^^^N^0
"DATA",364.7,230,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,"NAME")),U,1)
"DATA",364.7,230,3,0)
^364.73^3^3^3101108^^^^
"DATA",364.7,230,3,1,0)
The FULL NAME data extracted,by SPRVSING PROV FULL NAME,
"DATA",364.7,230,3,2,0)
into the array IBXSAVE is parsed and the appropiate piece (1)
"DATA",364.7,230,3,3,0)
LAST NAME, is stored into IBXDATA for transmission.
"DATA",364.7,232,0)
1059^N^5^^^^N
"DATA",364.7,232,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,"NAME")),U,2)
"DATA",364.7,232,3,0)
^364.73^3^3^3101108^^^^
"DATA",364.7,232,3,1,0)
The FULL NAME data extracted,by SPRVSING PROV FULL NAME,
"DATA",364.7,232,3,2,0)
into the array IBXSAVE is parsed and the appropiate piece (2)
"DATA",364.7,232,3,3,0)
FIRST NAME, is stored into IBXDATA for transmission.
"DATA",364.7,244,0)
1060^N^5^^^^N^0
"DATA",364.7,244,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,"NAME")),U,3)
"DATA",364.7,244,3,0)
^364.73^3^3^3101108^^^^
"DATA",364.7,244,3,1,0)
The FULL NAME data extracted,by SPRVSING PROV FULL NAME,
"DATA",364.7,244,3,2,0)
into the array IBXSAVE is parsed and the appropiate piece (3)
"DATA",364.7,244,3,3,0)
MIDDLE NAME, is stored into IBXDATA for transmission.
"DATA",364.7,245,0)
1061^N^5^^^^N^0
"DATA",364.7,245,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,"NAME")),U,5)
"DATA",364.7,245,3,0)
^364.73^3^3^3101108^^^^
"DATA",364.7,245,3,1,0)
The FULL NAME data extracted,by SPRVSING PROV FULL NAME,
"DATA",364.7,245,3,2,0)
into the array IBXSAVE is parsed and the appropiate piece (5)
"DATA",364.7,245,3,3,0)
NAME SUFFIX, is stored into IBXDATA for transmission.
"DATA",364.7,246,0)
1062^N^5^^^^N^0
"DATA",364.7,246,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,0)),U,3)
"DATA",364.7,247,0)
1063^N^5^^^^N^0
"DATA",364.7,247,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,0)),U,4)
"DATA",364.7,375,0)
1094^N^5^^^^N
"DATA",364.7,375,1)
S IBXDATA=$P($G(IBXSAVE("BILLING PRV",IBXIEN,"C",1,2)),U,2)
"DATA",364.7,375,3,0)
^364.73^2^2^3100917^^^^
"DATA",364.7,375,3,1,0)
Extract the 364.5 definition into an array. Then use piece 1, Blue Cross 
"DATA",364.7,375,3,2,0)
Number for 8,16 piece 3.. The array will be used for the remaining pieces.
"DATA",364.7,376,0)
1095^N^5^^^^N
"DATA",364.7,376,1)
S IBXDATA=$P($G(IBXSAVE("BILLING PRV",IBXIEN,"C",1,3)),U,1)
"DATA",364.7,377,0)
1096^N^5^^^^N
"DATA",364.7,377,1)
S IBXDATA=$P($G(IBXSAVE("BILLING PRV",IBXIEN,"C",1,3)),U,2)
"DATA",364.7,385,0)
1104^N^5^^^^N
"DATA",364.7,385,1)
S IBXDATA=$P($G(IBXSAVE("BILLING PRV",IBXIEN,"C",1,8)),U,2)
"DATA",364.7,385,3,0)
^364.73^1^1^3101104^^^^
"DATA",364.7,385,3,1,0)
If header data has already been extracted, array ^TMP("IBHDR1",$J) will already exist.  Don't want to extract this field again, so kill data element so there is no output.
"DATA",364.7,388,0)
1192^N^5^^^^N
"DATA",364.7,388,1)
S IBXDATA=$P($G(IBXSAVE("BILLING PRV",IBXIEN,"C",1,0)),U,2)
"DATA",364.7,388,3,0)
^364.73^2^2^3100917^^^^
"DATA",364.7,388,3,1,0)
Provider number for the current insurance company for bill entry 
"DATA",364.7,388,3,2,0)
IBXIEN.
"DATA",364.7,389,0)
1191^N^5^^^^N
"DATA",364.7,389,1)
S IBXDATA=$S($P($G(IBXSAVE("BILLING PRV",IBXIEN,"C",1,0)),U,1)]"":"EI",1:"")
"DATA",364.7,389,3,0)
^364.73^4^4^3100917^^^^
"DATA",364.7,389,3,1,0)
Kept N-CURRENT INS POLICY TYPE because didn't want to touch previous logic 
"DATA",364.7,389,3,2,0)
that may set array or TMP.
"DATA",364.7,389,3,3,0)
the format code sets array to string with QUALIF and ID for the first 
"DATA",364.7,389,3,4,0)
seven insurances in file #355.97 except some.
"DATA",364.7,413,0)
1217^N^5^^^^N
"DATA",364.7,413,1)
S IBXDATA=$P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1,5)),U,2)
"DATA",364.7,413,3,0)
^364.73^2^2^3101005^^^^
"DATA",364.7,413,3,1,0)
Output the fifth 'other' id.
"DATA",364.7,413,3,2,0)
Delete the 'filtered' id array IBXSAVE("PROVINF_FAC",IBXIEN).
"DATA",364.7,420,0)
1224^N^5^^^^N
"DATA",364.7,420,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,1)),"^",3)
"DATA",364.7,420,3,0)
0^364.73^5^5^3101105^^^^
"DATA",364.7,420,3,1,0)
Attending Provider Secondary ID Qualifier.
"DATA",364.7,420,3,2,0)
EI=EMPLOYER, SY=SSN, 0B=STATE LICENSE NUMBER, 1A=BLUE CROSS, 1B=BLUE SHIELD,
"DATA",364.7,420,3,3,0)
1C=MEDICARE PARTA and PARTB, 1D=MEDICAID, 1G=UPIN Number, 1H=TRICARE
"DATA",364.7,420,3,4,0)
G2=COMMERCAIL NUMBER, X5=STATE INDUSTRIAL ACCIDENT PROVIDER NUMBER
"DATA",364.7,420,3,5,0)
N5=PROVIDER PLAN NETWORK ID
"DATA",364.7,421,0)
1225^N^5^^^^N
"DATA",364.7,421,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,1)),"^",4),1)
"DATA",364.7,422,0)
1226^N^5^^^^N
"DATA",364.7,422,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,2)),"^",3)
"DATA",364.7,423,0)
1227^N^5^^^^N
"DATA",364.7,423,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,2)),"^",4),1)
"DATA",364.7,424,0)
1228^N^5^^^^N
"DATA",364.7,424,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,3)),"^",3)
"DATA",364.7,425,0)
1229^N^5^^^^N
"DATA",364.7,425,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,3)),"^",4),1)
"DATA",364.7,426,0)
1230^N^5^^^^N
"DATA",364.7,426,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,4)),"^",3)
"DATA",364.7,427,0)
1231^N^5^^^^N
"DATA",364.7,427,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,4)),"^",4),1)
"DATA",364.7,428,0)
1232^N^5^^^^N
"DATA",364.7,428,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,5)),"^",3)
"DATA",364.7,429,0)
1233^N^5^^^^N
"DATA",364.7,429,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,5)),"^",4),1)
"DATA",364.7,430,0)
1234^N^5^^^^N
"DATA",364.7,430,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,1)),"^",3)
"DATA",364.7,430,3,0)
^364.73^1^1^3101105^^^^
"DATA",364.7,430,3,1,0)
Operating Physician Secondary ID and Qualifier.
"DATA",364.7,431,0)
1235^N^5^^^^N
"DATA",364.7,431,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,1)),"^",4),1)
"DATA",364.7,432,0)
1236^N^5^^^^N
"DATA",364.7,432,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,2)),"^",3)
"DATA",364.7,433,0)
1237^N^5^^^^N
"DATA",364.7,433,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,2)),"^",4),1)
"DATA",364.7,434,0)
1238^N^5^^^^N
"DATA",364.7,434,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,3)),"^",3)
"DATA",364.7,435,0)
1239^N^5^^^^N
"DATA",364.7,435,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,3)),"^",4),1)
"DATA",364.7,436,0)
1240^N^5^^^^N
"DATA",364.7,436,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,4)),"^",3)
"DATA",364.7,437,0)
1241^N^5^^^^N
"DATA",364.7,437,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,4)),"^",4),1)
"DATA",364.7,438,0)
1242^N^5^^^^N
"DATA",364.7,438,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,5)),"^",3)
"DATA",364.7,439,0)
1243^N^5^^^^N
"DATA",364.7,439,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,5)),"^",4),1)
"DATA",364.7,440,0)
1245^N^5^^^^N
"DATA",364.7,440,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,1)),"^",4),1)
"DATA",364.7,440,3,0)
^364.73^4^4^3101105^^^^
"DATA",364.7,440,3,1,0)
Other Provider Secondary Qualifier 1.
"DATA",364.7,440,3,2,0)
EI=EMPLOYER ID, SY=SSN, 0B=STATE LICENSE #, 1A=BLUE CROSS, 1B=BLUE SHIELD,
"DATA",364.7,440,3,3,0)
1C=MEDICARE PARTA or PARTB, 1D=MEDICAID, 1G=UPIN #, 1H=TRICARE, G2=COMMERCIAL #
"DATA",364.7,440,3,4,0)
X5=STATE INDUSTRIAL ACCIDENT PROVIDER #, LU=LOCATION #, N5=PROVIDER PLAN NETWORK ID
"DATA",364.7,443,0)
1277^N^5^^^^N
"DATA",364.7,443,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,1)),U,3)
"DATA",364.7,443,3,0)
^364.73^5^5^3101108^^^^
"DATA",364.7,443,3,1,0)
Supervising Provider Secondary ID Qualifier
"DATA",364.7,443,3,2,0)
EI=EMPLOYER, SY=SSN, 0B=STATE LICENSE NUMBER, 1A=BLUE CROSS, 1B=BLUE SHIELD,
"DATA",364.7,443,3,3,0)
1C=MEDICARE PARTA aqnd PARTB, 1D=MEDICAID, 1G=UPIN Number, 1H=TRICARE
"DATA",364.7,443,3,4,0)
G2=COMMERCAIL NUMBER, X5=STATE INDUSTRIAL ACCIDENT PROVIDER NUMBER
"DATA",364.7,443,3,5,0)
N5=PROVIDER PLAN NETWORK ID
"DATA",364.7,444,0)
1278^N^5^^^^N
"DATA",364.7,444,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,1)),U,4),1)
"DATA",364.7,444,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,444,3,1,0)
Supervising Provider Secondary ID
"DATA",364.7,445,0)
1279^N^5^^^^N
"DATA",364.7,445,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,2)),U,3)
"DATA",364.7,446,0)
1280^N^5^^^^N
"DATA",364.7,446,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,2)),U,4),1)
"DATA",364.7,447,0)
1281^N^5^^^^N
"DATA",364.7,447,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,3)),U,3)
"DATA",364.7,448,0)
1282^N^5^^^^N
"DATA",364.7,448,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,3)),U,4),1)
"DATA",364.7,449,0)
1283^N^5^^^^N
"DATA",364.7,449,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,4)),U,3)
"DATA",364.7,450,0)
1284^N^5^^^^N
"DATA",364.7,450,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,4)),U,4),1)
"DATA",364.7,451,0)
1285^N^5^^^^N
"DATA",364.7,451,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,5)),U,3)
"DATA",364.7,452,0)
1286^N^5^^^^N
"DATA",364.7,452,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,5,5)),U,4),1)
"DATA",364.7,535,0)
1182^N^5^^^^N
"DATA",364.7,535,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,9,"1")
"DATA",364.7,535,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,535,3,1,0)
HARD CODE PERSON QUALIFIER
"DATA",364.7,537,0)
1107^N^5^^^^N^0
"DATA",364.7,537,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,3,"82")
"DATA",364.7,537,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,537,3,1,0)
QUAL IS 71 FOR INST AND 82 FOR PROF
"DATA",364.7,538,0)
1113^N^5^^^^N^0
"DATA",364.7,538,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,3,"I",2) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,540,0)
1115^N^5^^^^N
"DATA",364.7,540,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,3,"I",3) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,541,0)
1108^N^5^^^^N^0
"DATA",364.7,541,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,3,"1")
"DATA",364.7,541,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,541,3,1,0)
HARD CODE PERSON CODE "1"
"DATA",364.7,542,0)
1111^N^5^^^^N^0
"DATA",364.7,542,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,3,"I",1) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,542,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,542,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,543,0)
1110^N^5^^^^N^0
"DATA",364.7,543,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,3,"Q",1)
"DATA",364.7,543,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,543,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,544,0)
1112^N^5^^^^N^0
"DATA",364.7,544,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,3,"Q",2)
"DATA",364.7,544,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,544,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,545,0)
1118^N^5^^^^N^0
"DATA",364.7,545,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,2,"1")
"DATA",364.7,545,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,545,3,1,0)
HARD CODE ENTITY TYPE QUALIFIER 1=PERSON
"DATA",364.7,546,0)
1119^N^5^^^^N^0
"DATA",364.7,546,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,2,"Q",1)
"DATA",364.7,546,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,546,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,547,0)
1121^N^5^^^^N^0
"DATA",364.7,547,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,2,"Q",2)
"DATA",364.7,547,3,0)
^364.73^1^1^3101108^^
"DATA",364.7,547,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,548,0)
1123^N^5^^^^N^0
"DATA",364.7,548,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,2,"Q",3)
"DATA",364.7,548,3,0)
^364.73^1^1^3101108^^
"DATA",364.7,548,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,549,0)
1120^N^5^^^^N^0
"DATA",364.7,549,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,2,"I",1) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,549,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,549,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,550,0)
1124^N^5^^^^N^0
"DATA",364.7,550,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,2,"I",3) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,550,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,550,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,551,0)
1117^N^5^^^^N^0
"DATA",364.7,551,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,2,"72")
"DATA",364.7,551,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,551,3,1,0)
HARD CODE "72" OTHER PAYER OPERATING PROVIDER NAME QUALIFIER
"DATA",364.7,558,0)
1134^N^5^^^^N^0
"DATA",364.7,558,1)
N Z K IBXDATA F Z=1,2 S IBXDATA(Z)=$P($G(IBXSAVE("LAB/FAC",IBXIEN,"O",Z,3)),U,2) D:Z=2 CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,558,3,0)
^364.73^3^3^3101108^^
"DATA",364.7,558,3,1,0)
OP3-10
"DATA",364.7,558,3,2,0)
Lab/Facility, Other Payer, ID #3
"DATA",364.7,558,3,3,0)
Clean up IBXSAVE array when done with this segment.
"DATA",364.7,560,0)
1137^N^5^^^^N^0
"DATA",364.7,560,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,1,"1")
"DATA",364.7,560,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,560,3,1,0)
HARD CODE ENTITY TYPE
"DATA",364.7,561,0)
1136^N^5^^^^N^0
"DATA",364.7,561,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,1,"DN")
"DATA",364.7,561,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,561,3,1,0)
HARD CODE REFERRING PROVIDER CODE
"DATA",364.7,562,0)
1138^N^5^^^^N^0
"DATA",364.7,562,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,1,"Q",1)
"DATA",364.7,563,0)
1140^N^5^^^^N^0
"DATA",364.7,563,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,1,"Q",2)
"DATA",364.7,564,0)
1142^N^5^^^^N^0
"DATA",364.7,564,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,1,"Q",3)
"DATA",364.7,565,0)
1139^N^5^^^^N^0
"DATA",364.7,565,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,1,"I",1) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,565,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,565,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,566,0)
1141^N^5^^^^N^0
"DATA",364.7,566,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,1,"I",2) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,566,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,566,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,567,0)
1143^N^5^^^^N^0
"DATA",364.7,567,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,1,"I",3) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,567,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,567,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,588,0)
1168^N^5^^^^N^0
"DATA",364.7,588,1)
N Z K IBXDATA F Z=1,2 S IBXDATA(Z)=$P($G(IBXSAVE("LAB/FAC",IBXIEN,"O",Z,2)),U,2)
"DATA",364.7,588,3,0)
^^2^2^3060314^
"DATA",364.7,588,3,1,0)
OP7-8
"DATA",364.7,588,3,2,0)
Lab/Facility, Other Payer, ID #2
"DATA",364.7,589,0)
1170^N^5^^^^N^0
"DATA",364.7,589,1)
N Z K IBXDATA F Z=1,2 S IBXDATA(Z)=$P($G(IBXSAVE("LAB/FAC",IBXIEN,"O",Z,3)),U,2) D:Z=2 CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,589,3,0)
^364.73^3^3^3101108^^
"DATA",364.7,589,3,1,0)
OP7-10
"DATA",364.7,589,3,2,0)
Lab/Facility, Other Payer, ID #3
"DATA",364.7,589,3,3,0)
Cleanup array when done with segment.
"DATA",364.7,600,0)
1183^N^5^^^^N^0
"DATA",364.7,600,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,9,"Q",1)
"DATA",364.7,601,0)
1185^N^5^^^^N^0
"DATA",364.7,601,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,9,"Q",2)
"DATA",364.7,602,0)
1187^N^5^^^^N^0
"DATA",364.7,602,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,9,"Q",3)
"DATA",364.7,602,3,0)
^364.73^1^1^3101109^^
"DATA",364.7,602,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,603,0)
1184^N^5^^^^N^0
"DATA",364.7,603,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,9,"I",1) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,603,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,603,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,604,0)
1186^N^5^^^^N^0
"DATA",364.7,604,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,9,"I",2) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,604,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,604,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,605,0)
1188^N^5^^^^N^0
"DATA",364.7,605,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,9,"I",3) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,605,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,605,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,640,0)
1181^N^5^^^^N^0
"DATA",364.7,640,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,9,"ZZ")
"DATA",364.7,640,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,640,3,1,0)
HARD CODE FORMAT OTH PAYER OTH PROV ID
"DATA",364.7,644,0)
1254^N^5^^^^N
"DATA",364.7,644,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,1)),"^",3)
"DATA",364.7,644,3,0)
^364.73^5^5^3101108^^^^
"DATA",364.7,644,3,1,0)
Refering Provider Secondary ID Qualifier
"DATA",364.7,644,3,2,0)
EI=EMPLOYER, SY=SSN, 0B=STATE LICENSE NUMBER, 1A=BLUE CROSS, 1B=BLUE SHIELD,
"DATA",364.7,644,3,3,0)
1C=MEDICARE PARTA aqnd PARTB, 1D=MEDICAID, 1G=UPIN Number, 1H=TRICARE
"DATA",364.7,644,3,4,0)
G2=COMMERCIAL NUMBER, X5=STATE INDUSTRIAL ACCIDENT PROVIDER NUMBER
"DATA",364.7,644,3,5,0)
N5=PROVIDER PLAN NETWORK ID
"DATA",364.7,645,0)
1255^N^5^^^^N
"DATA",364.7,645,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,1)),"^",4),1)
"DATA",364.7,645,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,645,3,1,0)
Refering Provider Secondary ID
"DATA",364.7,646,0)
1256^N^5^^^^N
"DATA",364.7,646,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,2)),"^",3)
"DATA",364.7,646,3,0)
^364.73^5^5^3101108^^^
"DATA",364.7,646,3,1,0)
Refering Provider Secondary ID Qualifier.
"DATA",364.7,646,3,2,0)
EI=EMPLOYER, SY=SSN, 0B=STATE LICENSE NUMBER, 1A=BLUE CROSS, 1B=BLUE SHIELD,
"DATA",364.7,646,3,3,0)
1C=MEDICARE PARTA aqnd PARTB, 1D=MEDICAID, 1G=UPIN Number, 1H=TRICARE
"DATA",364.7,646,3,4,0)
G2=COMMERCAIL NUMBER, X5=STATE INDUSTRIAL ACCIDENT PROVIDER NUMBER
"DATA",364.7,646,3,5,0)
N5=PROVIDER PLAN NETWORK ID
"DATA",364.7,647,0)
1257^N^5^^^^N
"DATA",364.7,647,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,2)),"^",4),1)
"DATA",364.7,647,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,647,3,1,0)
Refering Provider Secondary ID
"DATA",364.7,648,0)
1258^N^5^^^^N
"DATA",364.7,648,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,3)),"^",3)
"DATA",364.7,648,3,0)
^364.73^5^5^3101108^^
"DATA",364.7,648,3,1,0)
Refering Provider Secondary ID Qualifier.
"DATA",364.7,648,3,2,0)
EI=EMPLOYER, SY=SSN, 0B=STATE LICENSE NUMBER, 1A=BLUE CROSS, 1B=BLUE SHIELD,
"DATA",364.7,648,3,3,0)
1C=MEDICARE PARTA aqnd PARTB, 1D=MEDICAID, 1G=UPIN Number, 1H=TRICARE
"DATA",364.7,648,3,4,0)
G2=COMMERCAIL NUMBER, X5=STATE INDUSTRIAL ACCIDENT PROVIDER NUMBER
"DATA",364.7,648,3,5,0)
N5=PROVIDER PLAN NETWORK ID
"DATA",364.7,649,0)
1259^N^5^^^^N
"DATA",364.7,649,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,3)),"^",4),1)
"DATA",364.7,649,3,0)
^364.73^1^1^3101108^^^
"DATA",364.7,649,3,1,0)
Refering Provider Secondary ID
"DATA",364.7,650,0)
1260^N^5^^^^N
"DATA",364.7,650,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,4)),"^",3)
"DATA",364.7,650,3,0)
^364.73^5^5^3101108^^^
"DATA",364.7,650,3,1,0)
Refering Provider Secondary ID Qualifier.
"DATA",364.7,650,3,2,0)
EI=EMPLOYER, SY=SSN, 0B=STATE LICENSE NUMBER, 1A=BLUE CROSS, 1B=BLUE SHIELD,
"DATA",364.7,650,3,3,0)
1C=MEDICARE PARTA aqnd PARTB, 1D=MEDICAID, 1G=UPIN Number, 1H=TRICARE
"DATA",364.7,650,3,4,0)
G2=COMMERCAIL NUMBER, X5=STATE INDUSTRIAL ACCIDENT PROVIDER NUMBER
"DATA",364.7,650,3,5,0)
N5=PROVIDER PLAN NETWORK ID
"DATA",364.7,651,0)
1261^N^5^^^^N
"DATA",364.7,651,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,4)),"^",4),1)
"DATA",364.7,651,3,0)
^364.73^1^1^3101108^^^
"DATA",364.7,651,3,1,0)
Refering Provider Secondary ID
"DATA",364.7,652,0)
1262^N^5^^^^N
"DATA",364.7,652,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,5)),"^",3)
"DATA",364.7,652,3,0)
^364.73^5^5^3101108^^
"DATA",364.7,652,3,1,0)
Refering Provider Secondary ID Qualifier.
"DATA",364.7,652,3,2,0)
EI=EMPLOYER, SY=SSN, 0B=STATE LICENSE NUMBER, 1A=BLUE CROSS, 1B=BLUE SHIELD,
"DATA",364.7,652,3,3,0)
1C=MEDICARE PARTA aqnd PARTB, 1D=MEDICAID, 1G=UPIN Number, 1H=TRICARE
"DATA",364.7,652,3,4,0)
G2=COMMERCAIL NUMBER, X5=STATE INDUSTRIAL ACCIDENT PROVIDER NUMBER
"DATA",364.7,652,3,5,0)
N5=PROVIDER PLAN NETWORK ID
"DATA",364.7,653,0)
1263^N^5^^^^N
"DATA",364.7,653,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,5)),"^",4),1)
"DATA",364.7,653,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,653,3,1,0)
Refering Provider Secondary ID
"DATA",364.7,654,0)
1247^N^5^^^^N^0
"DATA",364.7,654,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,2)),"^",4),1)
"DATA",364.7,654,3,0)
^364.73^1^1^3101105^^^^
"DATA",364.7,654,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,655,0)
1249^N^5^^^^N^0
"DATA",364.7,655,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,3)),"^",4),1)
"DATA",364.7,655,3,0)
^364.73^1^1^3101105^^^^
"DATA",364.7,655,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,656,0)
1251^N^5^^^^N^0
"DATA",364.7,656,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,4)),"^",4),1)
"DATA",364.7,656,3,0)
^364.73^1^1^3101105^^^^
"DATA",364.7,656,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,657,0)
1253^N^5^^^^N^0
"DATA",364.7,657,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,5)),"^",4),1)
"DATA",364.7,657,3,0)
^364.73^1^1^3101105^^^^
"DATA",364.7,657,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,658,0)
1244^N^5^^^^N^0
"DATA",364.7,658,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,1)),"^",3)
"DATA",364.7,658,3,0)
^364.73^1^1^3101105^^^^
"DATA",364.7,658,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,659,0)
1246^N^5^^^^N^0
"DATA",364.7,659,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,2)),"^",3)
"DATA",364.7,659,3,0)
^364.73^1^1^3101105^^^
"DATA",364.7,659,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,660,0)
1248^N^5^^^^N^0
"DATA",364.7,660,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,3)),"^",3)
"DATA",364.7,660,3,0)
^364.73^1^1^3101105^^^
"DATA",364.7,660,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,661,0)
1250^N^5^^^^N^0
"DATA",364.7,661,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,4)),"^",3)
"DATA",364.7,661,3,0)
^364.73^1^1^3101105^^^
"DATA",364.7,661,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,662,0)
1252^N^5^^^^N^0
"DATA",364.7,662,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,5)),"^",3)
"DATA",364.7,662,3,0)
^364.73^1^1^3101105^^^^
"DATA",364.7,662,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,663,0)
1114^N^5^^^^N^0
"DATA",364.7,663,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,3,"Q",3)
"DATA",364.7,663,3,0)
^364.73^1^1^3101108^^^
"DATA",364.7,663,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,664,0)
1122^N^5^^^^N^0
"DATA",364.7,664,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,2,"I",2) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,664,3,0)
^364.73^1^1^3101108^^^^
"DATA",364.7,664,3,1,0)
FROM FORMAT IN PROVINF^IBCEF7
"DATA",364.7,798,0)
943^N^5^^^^N
"DATA",364.7,798,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,"NAME")),U,5)
"DATA",364.7,798,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,798,3,1,0)
Finds SSN for ATTENDING or RENDERING PROVIDER
"DATA",364.7,804,0)
808^N^5^^^^N
"DATA",364.7,804,1)
N Z,IBZ K IBXDATA S (Z,IBZ)=0 F  S IBZ=$O(IBXSAVE("CCOB",IBZ)) Q:'IBZ  S Z=Z+1,IBXDATA(Z)=$E("PST",IBZ) I Z>1 D ID^IBCEF2(Z,"COB1")
"DATA",364.7,804,3,0)
^364.73^5^5^3050207^^^^
"DATA",364.7,804,3,1,0)
This is a group data element so more than 1 occurrence of a value is
"DATA",364.7,804,3,2,0)
possible for the data element in the IBXDATA array.  It relies on the
"DATA",364.7,804,3,3,0)
existence of the IBXSAVE("CCOB",COBSEQ) array that was previously extracted.
"DATA",364.7,804,3,4,0)
For other than the first occurrence, the RECORD ID 'COB1' must be output.
"DATA",364.7,804,3,5,0)
Only output 1 record per COB sequence.
"DATA",364.7,814,0)
817^N^5^^^^N
"DATA",364.7,814,1)
K:$$INPAT^IBCEF(IBXIEN,1) IBXDATA I $D(IBXDATA) N Z,IBZ K IBXDATA S (Z,IBZ)=0 F  S IBZ=$O(IBXSAVE("MOA",IBZ)) Q:'IBZ  S Z=Z+1,IBXDATA(Z)=$E("PST",IBZ) I Z>1 D ID^IBCEF2(Z,"MOA1")
"DATA",364.7,814,3,0)
^364.73^4^4^3050207^^^^
"DATA",364.7,814,3,1,0)
This is a group data element so more than 1 occurrence of a value is
"DATA",364.7,814,3,2,0)
possible for the data element in the IBXDATA array.  It relies on the
"DATA",364.7,814,3,3,0)
existence of the IBXSAVE("MOA") array that was previously extracted.
"DATA",364.7,814,3,4,0)
For other than the first occurrence, the RECORD ID 'MOA1' must be output.
"DATA",364.7,815,0)
828^N^5^^^^N
"DATA",364.7,815,1)
K:'$$INPAT^IBCEF(IBXIEN,1) IBXDATA I $D(IBXDATA) N Z,IBZ K IBXDATA S (Z,IBZ)=0 F  S IBZ=$O(IBXSAVE("MIA45",IBZ)) Q:'IBZ  S Z=Z+1,IBXDATA(Z)=$E("PST",IBZ) I Z>1 D ID^IBCEF2(Z,"MIA1")
"DATA",364.7,815,3,0)
^364.73^4^4^3050207^^^^
"DATA",364.7,815,3,1,0)
This is a group data element so more than 1 occurrence of a value is
"DATA",364.7,815,3,2,0)
possible for the data element in the IBXDATA array.  It relies on the
"DATA",364.7,815,3,3,0)
existence of the IBXSAVE("MIA45") array that was previously extracted.
"DATA",364.7,815,3,4,0)
For other than the first occurrence, the RECORD ID 'MIA1' must be output.
"DATA",364.7,816,0)
840^N^5^^^^N
"DATA",364.7,816,1)
K:'$$INPAT^IBCEF(IBXIEN,1) IBXDATA I $D(IBXDATA) N Z,IBZ K IBXDATA S (Z,IBZ)=0 F  S IBZ=$O(IBXSAVE("MIA45",IBZ)) Q:'IBZ  S Z=Z+1,IBXDATA(Z)=$E("PST",IBZ) I Z>1 D ID^IBCEF2(Z,"MOA1")
"DATA",364.7,816,3,0)
^364.73^4^4^3050207^^^^
"DATA",364.7,816,3,1,0)
This is a group data element so more than 1 occurrence of a value is
"DATA",364.7,816,3,2,0)
possible for the data element in the IBXDATA array.  It relies on the
"DATA",364.7,816,3,3,0)
existence of the IBXSAVE("MIA45") array that was previously extracted.
"DATA",364.7,816,3,4,0)
For other than the first occurrence, the RECORD ID 'MIA2' must be output.
"DATA",364.7,817,0)
854^N^5^^^^N
"DATA",364.7,817,1)
N Z,Z0 K IBXDATA S (Z,Z1)=0 F  S Z=$O(IBXSAVE("CCAS",Z)) Q:'Z  S Z0=0 F  S Z0=$O(IBXSAVE("CCAS",Z,Z0)) Q:'Z0  S Z1=Z1+1,IBXDATA(Z1)=$E("PST",Z) I Z1>1 D ID^IBCEF2(Z1,"CCAS")
"DATA",364.7,817,3,0)
^364.73^4^4^3050207^^^^
"DATA",364.7,817,3,1,0)
This is a group data element so more than 1 occurrence of a value is
"DATA",364.7,817,3,2,0)
possible for the data element in the IBXDATA array.  It relies on the
"DATA",364.7,817,3,3,0)
existence of the IBXSAVE("CCAS") array that was previously extracted.
"DATA",364.7,817,3,4,0)
For other than the first occurrence, the RECORD ID 'CCAS' must be output.
"DATA",364.7,893,0)
936^N^5^^^^N
"DATA",364.7,893,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,"NAME")),U,5)
"DATA",364.7,893,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,893,3,1,0)
Finds SSN for REFERING PROVIDER
"DATA",364.7,894,0)
938^N^5^^^^N
"DATA",364.7,894,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,"NAME")),U,1)
"DATA",364.7,894,3,0)
^364.73^2^2^3101109^^^^
"DATA",364.7,894,3,1,0)
Changes data element (name) into LAST^FIRST^MIDDLE format.  Saves data in
"DATA",364.7,894,3,2,0)
IBXSAVE array for use by later fields.
"DATA",364.7,896,0)
948^N^5^^^^N
"DATA",364.7,896,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,"NAME")),U,1)
"DATA",364.7,896,3,0)
^364.73^2^2^3101109^^^^
"DATA",364.7,896,3,1,0)
Changes data element (name) into LAST^FIRST^MIDDLE format.  Saves data in
"DATA",364.7,896,3,2,0)
IBXSAVE array for use by later fields.
"DATA",364.7,897,0)
950^N^5^^^^N
"DATA",364.7,897,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,"NAME")),U,5)
"DATA",364.7,897,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,897,3,1,0)
Finds the Operating Physicians SSN 
"DATA",364.7,900,0)
804^N^351^^^^N
"DATA",364.7,900,1)
S IBXDATA=$S(IBXDATA]"":"A8",1:"")
"DATA",364.7,902,0)
806^N^266^^^^N
"DATA",364.7,902,1)
N Z,IBZ M IBZ=IBXDATA K IBXDATA F Z=1,2 I $G(IBZ(Z))'="" S IBXDATA(Z)="G1"
"DATA",364.7,914,0)
941^N^5^^^^N
"DATA",364.7,914,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,"NAME")),U,1)
"DATA",364.7,914,3,0)
^364.73^4^4^3101109^^^^
"DATA",364.7,914,3,1,0)
Changes data element (name) into LAST^FIRST^MIDDLE^CREDENTIALS format. Saves
"DATA",364.7,914,3,2,0)
data in IBXSAVE array for use by later fields.
"DATA",364.7,914,3,3,0)
If the provider name is blank and the provider id is SLF000 (self), this
"DATA",364.7,914,3,4,0)
field is not required.
"DATA",364.7,915,0)
942^N^5^^^^N
"DATA",364.7,915,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,"NAME")),U,2)
"DATA",364.7,915,3,0)
^364.73^2^2^3101109^^^^
"DATA",364.7,915,3,1,0)
If the attending/rendering provider exists, output the first name from the
"DATA",364.7,915,3,2,0)
second '^' piece.
"DATA",364.7,916,0)
946^N^5^^^^N
"DATA",364.7,916,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,"NAME")),U,2)
"DATA",364.7,916,3,0)
^364.73^1^1^3101109^^^^
"DATA",364.7,916,3,1,0)
Operating provider first name
"DATA",364.7,917,0)
949^N^5^^^^N
"DATA",364.7,917,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,"NAME")),U,2)
"DATA",364.7,917,3,0)
^364.73^2^2^3101109^^^^
"DATA",364.7,917,3,1,0)
If the operating provider exists, output the first name from the second '^'
"DATA",364.7,917,3,2,0)
piece.
"DATA",364.7,918,0)
937^N^5^^^^N
"DATA",364.7,918,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,"NAME")),U,2)
"DATA",364.7,918,3,0)
^364.73^2^2^3101109^^^^
"DATA",364.7,918,3,1,0)
If the referring provider exists, output the first name from the second '^'
"DATA",364.7,918,3,2,0)
piece.
"DATA",364.7,919,0)
947^N^5^^^^N
"DATA",364.7,919,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,"NAME")),U,5)
"DATA",364.7,921,0)
944^N^5^^^^N
"DATA",364.7,921,1)
K IBXDATA S IBXDATA=""
"DATA",364.7,922,0)
935^N^5^^^^N
"DATA",364.7,922,1)
S IBXDATA="AT" I $G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,"TAXONOMY"))']"" S IBXDATA=""
"DATA",364.7,923,0)
951^N^5^^^^N
"DATA",364.7,923,1)
S IBXDATA=$G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,"TAXONOMY"))
"DATA",364.7,951,0)
891^N^5^^^^N
"DATA",364.7,951,1)
K IBXDATA
"DATA",364.7,952,0)
974^N^5^^^^N
"DATA",364.7,952,1)
K IBXDATA S IBXDATA=""
"DATA",364.7,952,3,0)
^^1^1^3100921^
"DATA",364.7,952,3,1,0)
Moved to LPUR record in patch IB*2.0*432
"DATA",364.7,962,0)
873^N^5^^^^N
"DATA",364.7,962,1)
D COBMOD^IBCEU0(.IBXSAVE,.IBXDATA,3)
"DATA",364.7,962,3,0)
^^4^4^2990902^^
"DATA",364.7,962,3,1,0)
This data element assumes the existence of the IBXSAVE array for each line
"DATA",364.7,962,3,2,0)
item (LCOB) that was previously extracted.  If the line has COB data
"DATA",364.7,962,3,3,0)
associated with it, output the modifier 3 for each COB sequence found for
"DATA",364.7,962,3,4,0)
the line.
"DATA",364.7,983,0)
962^N^5^^^^N
"DATA",364.7,983,1)
K IBXDATA
"DATA",364.7,985,0)
983^N^5^^^^N
"DATA",364.7,985,1)
N Z,Z0 K IBXDATA I $$COBN^IBCEF(IBXIEN)>1 F Z0="INPT","OUTPT","RX" S Z=0 F  S Z=$O(IBXSAVE(Z0,Z)) K:'Z IBXSAVE(Z0) Q:'Z  I $D(IBXSAVE(Z0,Z,"COB")) M IBXSAVE("LCOB",Z)=IBXSAVE(Z0,Z)
"DATA",364.7,985,3,0)
^364.73^4^4^3110105^^^^
"DATA",364.7,985,3,1,0)
The arrays IBXSAVE("INPT"), IBXSAVE("OUTPT") and IBXSAVE("RX") are created
"DATA",364.7,985,3,2,0)
when the line items on the bill are produced.  This field takes the data
"DATA",364.7,985,3,3,0)
from these arrays and creates a new IBXSAVE("LCOB") array with just the COB
"DATA",364.7,985,3,4,0)
data and deletes the original IBXSAVE arrays.
"DATA",364.7,987,0)
985^N^5^^^^N
"DATA",364.7,987,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,0)),U,3)
"DATA",364.7,988,0)
986^N^5^^^^N
"DATA",364.7,988,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,0)),U,4)
"DATA",364.7,992,0)
993^N^5^^^^N
"DATA",364.7,992,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,0)),U,3)
"DATA",364.7,993,0)
991^N^5^^^^N
"DATA",364.7,993,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,0)),U,3)
"DATA",364.7,994,0)
992^N^5^^^^N
"DATA",364.7,994,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,0)),U,4)
"DATA",364.7,995,0)
994^N^5^^^^N
"DATA",364.7,995,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,0)),U,4)
"DATA",364.7,1001,0)
1000^N^55^^^^N
"DATA",364.7,1001,1)
S IBXDATA=$S(IBXDATA]"":"F8",1:"")
"DATA",364.7,1008,0)
1007^N^5^^^^N
"DATA",364.7,1008,1)
S IBXDATA=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,"NAME")),U,4)
"DATA",364.7,1008,3,0)
^^2^2^3101105^
"DATA",364.7,1008,3,1,0)
Credentials should be in the 4th piece of the "NAME" node of the 
"DATA",364.7,1008,3,2,0)
Rendering Provider IBXSAVE array.
"DATA",364.7,1015,0)
1014^N^5^^^^N
"DATA",364.7,1015,1)
S IBXDATA="432.0" I '$$PROD^XUPROD(1) S $E(IBXDATA,11)="D"
"DATA",364.7,1015,3,0)
^364.73^7^7^3100818^^^^
"DATA",364.7,1015,3,1,0)
This field contains the VistA IB patch# that pertains to the
"DATA",364.7,1015,3,2,0)
applicable changes in the claim map.  Austin uses this field to determine
"DATA",364.7,1015,3,3,0)
which set of EDI claim maps to use when processing the EDI claims.
"DATA",364.7,1015,3,4,0)

"DATA",364.7,1015,3,5,0)
If the EDI claims are being transmitted from a non-production account,
"DATA",364.7,1015,3,6,0)
then the "D" in the 11th position indicates to Austin that it is test
"DATA",364.7,1015,3,7,0)
data.
"DATA",364.7,1018,0)
1301^N^5^^^^N
"DATA",364.7,1018,1)
K IBXSAVE("OSQ") N Q,OK M Q=IBXSAVE("PROVINF",IBXIEN,"O") S (C,Z)=0 F  S Z=$O(Q(Z)) Q:'Z  S OK=0 X "N A F A=1:1 Q:'$D(Q(Z,5,A))  I $P(Q(Z,5,A),U,4)'="""" S OK=1 Q" I OK S C=C+1,IBXDATA(C)=$G(Q(Z)),IBXSAVE("OSQ",Z)=C D:C>1 ID^IBCEF2(C,"OP8 ")
"DATA",364.7,1018,3,0)
^364.73^9^9^3101109^^^^
"DATA",364.7,1018,3,1,0)
Output if an ID exists for the 'other insurance'.  If more than 1 ins,
"DATA",364.7,1018,3,2,0)
must output the record id.  Must kill the IBXSAVE("OSQ") array as this is
"DATA",364.7,1018,3,3,0)
used to determine the current bill's sequence of other providers and which
"DATA",364.7,1018,3,4,0)
IBXDATA array entry needs to be set for each.  IBXSAVE("OSQ") must be killed
"DATA",364.7,1018,3,5,0)
at the last field for this record.
"DATA",364.7,1018,3,6,0)
IBXSAVE("OSQ",n)=m where n = the sequence for the other insurance (if bill
"DATA",364.7,1018,3,7,0)
is primary, 1=secondary, 2=tertiary; if bill is secondary, 1=primary,
"DATA",364.7,1018,3,8,0)
2=tertiary; if bill is tertiary, 1=primary, 2=secondary).  And where
"DATA",364.7,1018,3,9,0)
m = the IBXDATA(m) entry to set for the 'n' COB sequence.
"DATA",364.7,1019,0)
1303^N^5^^^^N
"DATA",364.7,1019,1)
K IBXDATA D PROVSEQ^IBCEF72(IBXIEN,.IBXSAVE,.IBXDATA,3,"OP1 ")
"DATA",364.7,1019,3,0)
^364.73^9^9^3101108^^^^
"DATA",364.7,1019,3,1,0)
Output if an ID exists for the 'other insurance'.  If more than 1
"DATA",364.7,1019,3,2,0)
insurance, must output the record id.  The IBXSAVE("OSQ") array is 
"DATA",364.7,1019,3,3,0)
used to determine the current bill's sequence of other providers and
"DATA",364.7,1019,3,4,0)
which IBXDATA array entry needs to be set for each.  This variable must
"DATA",364.7,1019,3,5,0)
be killed at the last field for this record.  IBXSAVE("OSQ",n)=m where
"DATA",364.7,1019,3,6,0)
n = the sequence for the other insurance (if bill is primary, 1=secondary,
"DATA",364.7,1019,3,7,0)
2=tertiary; if bill is secondary, 1=primary, 2=tertiary; if bill is
"DATA",364.7,1019,3,8,0)
tertiary, 1=primary, 2=secondary.  And where m=the IBXDATA(m) entry to
"DATA",364.7,1019,3,9,0)
set for the 'n' COB sequence.
"DATA",364.7,1021,0)
1306^N^5^^^^N
"DATA",364.7,1021,1)
K IBXDATA D PROVSEQ^IBCEF72(IBXIEN,.IBXSAVE,.IBXDATA,1,"OP4 ")
"DATA",364.7,1021,3,0)
^364.73^9^9^3101108^^^^
"DATA",364.7,1021,3,1,0)
Output if an ID exists for the 'other insurance'.  If more than 1 insurance
"DATA",364.7,1021,3,2,0)
must output the record id.  Must kill the IBXSAVE("OSQ") array as this
"DATA",364.7,1021,3,3,0)
is used to determine the current bill's sequence of other providers and
"DATA",364.7,1021,3,4,0)
which IBXDATA array entry needs to be set for each.  This variable must
"DATA",364.7,1021,3,5,0)
be killed at the last field for this record.  IBXSAVE("OSQ",n)=m where
"DATA",364.7,1021,3,6,0)
n = the sequence for the other insurance (if bill is primary, 1=secondary,
"DATA",364.7,1021,3,7,0)
2=tertiary; if bill is secondary, 1=primary, 2=tertiary; if bill is
"DATA",364.7,1021,3,8,0)
tertiary, 1=primary, 2=secondary.  And where m=the IBXDATA(m) entry to
"DATA",364.7,1021,3,9,0)
set for the 'n' COB sequence.
"DATA",364.7,1024,0)
1310^N^5^^^^N
"DATA",364.7,1024,1)
K IBXSAVE("OSQ") N C,Z,Q,OK M Q=IBXSAVE("PROVINF",IBXIEN,"O") S (C,Z)=0 F  S Z=$O(Q(Z)) Q:'Z  S OK=0 X "N A F A=1:1 Q:'$D(Q(Z,9,A))  I $P(Q(Z,9,A),U,4)'="""" S OK=1 Q" I OK S C=C+1,IBXDATA(C)=$G(Q(Z)),IBXSAVE("OSQ",Z)=C D:C>1 ID^IBCEF2(C,"OP9 ")
"DATA",364.7,1024,3,0)
^364.73^9^9^3101109^^^^
"DATA",364.7,1024,3,1,0)
Output if an ID exists for the 'other insurance'.  If more than 1 insurance
"DATA",364.7,1024,3,2,0)
must output the record id.  Must kill the IBXSAVE("OSQ") array as this
"DATA",364.7,1024,3,3,0)
is used to determine the current bill's sequence of other providers and
"DATA",364.7,1024,3,4,0)
which IBXDATA array entry needs to be set for each.  This variable must
"DATA",364.7,1024,3,5,0)
be killed at the last field for this record.  IBXSAVE("OSQ",n)=m where
"DATA",364.7,1024,3,6,0)
n = the sequence for the other insurance (if bill is primary, 1=secondary,
"DATA",364.7,1024,3,7,0)
2=tertiary; if bill is secondary, 1=primary, 2=tertiary; if bill is
"DATA",364.7,1024,3,8,0)
tertiary, 1=primary, 2=secondary.  And where m=the IBXDATA(m) entry to
"DATA",364.7,1024,3,9,0)
set for the 'n' COB sequence.
"DATA",364.7,1034,0)
973^N^5^^^^N
"DATA",364.7,1034,1)
S IBXDATA=$G(IBXSAVE("PROVINF",IBXIEN,"C",1,4,"ENTITY TYPE"))
"DATA",364.7,1034,3,0)
^^2^2^3101105^
"DATA",364.7,1034,3,1,0)
Get the attending provider id info.  If facility provider,
"DATA",364.7,1034,3,2,0)
output 2 for non-person or 1 for person.
"DATA",364.7,1035,0)
1318^N^5
"DATA",364.7,1035,1)
S IBXDATA=$G(IBXSAVE("PROVINF",IBXIEN,"C",1,1,"ENTITY TYPE"))
"DATA",364.7,1035,3,0)
^364.73^2^2^3101105^^
"DATA",364.7,1035,3,1,0)
Get the referring provider id info.  If facility provider, output 2 for
"DATA",364.7,1035,3,2,0)
non-person or 1 for person.
"DATA",364.7,1036,0)
1319^N^5
"DATA",364.7,1036,1)
S IBXDATA=$G(IBXSAVE("PROVINF",IBXIEN,"C",1,2,"ENTITY TYPE"))
"DATA",364.7,1036,3,0)
^364.73^2^2^3101105^^^
"DATA",364.7,1036,3,1,0)
Get the operating provider id info.  If facility provider, output 2 for
"DATA",364.7,1036,3,2,0)
non-person or 1 for person.
"DATA",364.7,1037,0)
990^N^5^^^^N
"DATA",364.7,1037,1)
S IBXDATA=$G(IBXSAVE("PROVINF",IBXIEN,"C",1,9,"ENTITY TYPE"))
"DATA",364.7,1037,3,0)
^364.73^2^2^3101105^^^
"DATA",364.7,1037,3,1,0)
Get the other provider id info.  If facility provider, output 2 for
"DATA",364.7,1037,3,2,0)
non-person or 1 for person.
"DATA",364.7,1039,0)
1321^N^101^^^^N^0
"DATA",364.7,1039,1)
K IBXDATA
"DATA",364.7,1039,3,0)
^364.73^5^5^3101019^^^^
"DATA",364.7,1039,3,1,0)
Get the current payer sequence from the claim. 
"DATA",364.7,1039,3,2,0)
Output "P" if primary, "S" if secondary or tertiary. 
"DATA",364.7,1039,3,3,0)
 
"DATA",364.7,1039,3,4,0)
This field is a duplicate of CI2.2. It was decided to blank this field 
"DATA",364.7,1039,3,5,0)
out so as not to confuse the user.  8/24/10
"DATA",364.7,1162,0)
1462^N^5^^^^N
"DATA",364.7,1162,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,1,"B1")
"DATA",364.7,1162,3,0)
^^2^2^3101110^
"DATA",364.7,1162,3,1,0)
cms-1500, box 17a/1, 2 character qualifier for the Referring provider 
"DATA",364.7,1162,3,2,0)
other ID (non-NPI ID).
"DATA",364.7,1163,0)
1463^N^5^^^^N
"DATA",364.7,1163,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,1,"B2")
"DATA",364.7,1163,3,0)
^^2^2^3101110^
"DATA",364.7,1163,3,1,0)
CMS-1500, Box 17a/2, Referring Provider other ID number (non NPI ID 
"DATA",364.7,1163,3,2,0)
number).
"DATA",364.7,1164,0)
1464^N^364^^^^N
"DATA",364.7,1165,0)
1465^N^5^^^^N
"DATA",364.7,1165,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,1,"B3")
"DATA",364.7,1165,3,0)
^364.73^1^1^3101110^^
"DATA",364.7,1165,3,1,0)
NPI# of Referring Physician
"DATA",364.7,1179,0)
1479^N^358^^^^N
"DATA",364.7,1179,1)
I $$OLAB^IBCEU(IBXIEN) N IBZ S IBZ=IBXDATA D F^IBCEF("N-LAB CLIA #",,,IBXIEN) I IBXDATA="",IBZ'="" S IBXDATA=IBZ
"DATA",364.7,1179,3,0)
^364.73^2^2^3060717^^^^
"DATA",364.7,1179,3,1,0)
If the bill is for services rendered at an outside lab, get the CLIA number.
"DATA",364.7,1179,3,2,0)
If this # is not available, use the prior authorization #.
"DATA",364.7,1190,0)
1490^N^371^^^^N
"DATA",364.7,1190,1)
N Z S Z=12 F  S Z=$O(IBXDATA(Z)) Q:'Z  D PG^IBCEF3(IBXDATA(Z),Z)
"DATA",364.7,1190,3,0)
^364.73^2^2^3101109^^^^
"DATA",364.7,1190,3,1,0)
If more than 6 service dates (12 lines) exists for the bill, this outputs
"DATA",364.7,1190,3,2,0)
the rest on additional bill pages.
"DATA",364.7,1191,0)
1491^N^372^^^^N
"DATA",364.7,1191,1)
N Z S Z=12 F  S Z=$O(IBXDATA(Z)) Q:'Z  D PG^IBCEF3(IBXDATA(Z),Z)
"DATA",364.7,1191,3,0)
^364.73^2^2^3101109^^^^
"DATA",364.7,1191,3,1,0)
If more than 6 service dates (12 lines) exists for the bill, this outputs
"DATA",364.7,1191,3,2,0)
the rest on additional bill pages.
"DATA",364.7,1203,0)
1503^N^370^^^^N
"DATA",364.7,1203,1)
S IBXSAVE("BOX31")=IBXDATA,IBXDATA=$$NAME31^IBCF2(IBXIEN,IBXDATA)
"DATA",364.7,1203,3,0)
^364.73^2^2^3101103^^
"DATA",364.7,1203,3,1,0)
Formats the name in 21 spaces for block 31 of the 1500.
"DATA",364.7,1203,3,2,0)
IBXSAVE("BOX31") is the name in format Last,first mi^ien in file 200
"DATA",364.7,1205,0)
1505^N^5^^^^N
"DATA",364.7,1205,1)
KILL IBXSAVE("SERVFACFLAG"),IBXSAVE("BPSFDATA"),IBXSAVE("BOX33"),^TMP("IB 1500 PRINT",$J,IBXIEN),IBXPROV
"DATA",364.7,1205,3,0)
^364.73^1^1^3101104^^^^
"DATA",364.7,1205,3,1,0)
Remove IBXSAVE array entries used in the construction of Boxes 32 and 33.
"DATA",364.7,1208,0)
1508^N^209^^^^N
"DATA",364.7,1208,1)
N A,Z S Z=$$DATE31^IBCF2(IBXDATA,IBXIEN) S A=$$GETPRV^IBCEF83(IBXIEN,,3,"A6"),IBXDATA=A_$J("",11-$L(A))_Z
"DATA",364.7,1208,3,0)
^364.73^2^2^3101104^^^^
"DATA",364.7,1208,3,1,0)
Print credentials left justified and date right justified. Format date as
"DATA",364.7,1208,3,2,0)
MM/DD/YYYY.
"DATA",364.7,1366,0)
1666^N^359^^^^N
"DATA",364.7,1430,0)
1730^N^5^^^^N
"DATA",364.7,1430,1)
S IBXDATA=$P($$GETPRV^IBCEF83(IBXIEN,,4,"A1"),",",1)
"DATA",364.7,1430,3,0)
^364.73^1^1^3101105^^
"DATA",364.7,1430,3,1,0)
Attending Providers last name
"DATA",364.7,1431,0)
1731^N^5^^^^N
"DATA",364.7,1431,1)
S IBXDATA=$P($$GETPRV^IBCEF83(IBXIEN,,4,"A1"),",",2)
"DATA",364.7,1431,3,0)
^364.73^1^1^3101105^^
"DATA",364.7,1431,3,1,0)
Attending Providers first name
"DATA",364.7,1432,0)
1732^N^5^^^^N
"DATA",364.7,1432,1)
S IBXDATA=$P($$GETPRV^IBCEF83(IBXIEN,,2,"A1"),",",1)
"DATA",364.7,1432,3,0)
^364.73^1^1^3101105^^
"DATA",364.7,1432,3,1,0)
Operating Provider last name
"DATA",364.7,1433,0)
1733^N^5^^^^N
"DATA",364.7,1433,1)
S IBXDATA=$P($$GETPRV^IBCEF83(IBXIEN,,2,"A1"),",",2)
"DATA",364.7,1433,3,0)
^364.73^1^1^3101105^^
"DATA",364.7,1433,3,1,0)
Operating Provider first name
"DATA",364.7,1436,0)
1736^N^5^^^^N
"DATA",364.7,1436,1)
S IBXDATA=$P($P(IBXSAVE("BOX 78"),U,1),",",1)
"DATA",364.7,1436,3,0)
^364.73^1^1^3101223^^^
"DATA",364.7,1436,3,1,0)
Other Provider last name
"DATA",364.7,1437,0)
1737^N^5^^^^N
"DATA",364.7,1437,1)
S IBXDATA=$P($P(IBXSAVE("BOX 78"),U,1),",",2) K IBXSAVE("BOX 78")
"DATA",364.7,1437,3,0)
^364.73^1^1^3101223^^^
"DATA",364.7,1437,3,1,0)
Other Provider first name
"DATA",364.7,1438,0)
1738^N^5^^^^N
"DATA",364.7,1438,1)
S IBXDATA=$P($P(IBXSAVE("BOX 79"),U,1),",",1)
"DATA",364.7,1438,3,0)
^^1^1^3101223^
"DATA",364.7,1438,3,1,0)
OTHER PROVIDER LAST NAME
"DATA",364.7,1439,0)
1739^N^5^^^^N
"DATA",364.7,1439,1)
S IBXDATA=$P($P(IBXSAVE("BOX 79"),U,1),",",2) K IBXSAVE("BOX 79"),IBXPROV
"DATA",364.7,1439,3,0)
^^1^1^3101223^
"DATA",364.7,1439,3,1,0)
OTHER PROVIDER FIRST NAME
"DATA",364.7,1440,0)
1740^N^5^^^^N
"DATA",364.7,1440,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,4,"B3")
"DATA",364.7,1440,3,0)
^364.73^1^1^3101223^^
"DATA",364.7,1440,3,1,0)
Attending Provider NPI if available
"DATA",364.7,1441,0)
1741^N^5^^^^N
"DATA",364.7,1441,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,4,"B1")
"DATA",364.7,1441,3,0)
^364.73^1^1^3101223^^^
"DATA",364.7,1441,3,1,0)
Legacy ID quailifer
"DATA",364.7,1442,0)
1742^N^5^^^^N
"DATA",364.7,1442,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,4,"B2")
"DATA",364.7,1442,3,0)
^364.73^1^1^3101223^^
"DATA",364.7,1442,3,1,0)
Attending legacy ID
"DATA",364.7,1443,0)
1743^N^5^^^^N
"DATA",364.7,1443,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,2,"B3")
"DATA",364.7,1443,3,0)
^364.73^1^1^3101223^^
"DATA",364.7,1443,3,1,0)
Operating Provider NPI if available
"DATA",364.7,1444,0)
1744^N^5^^^^N
"DATA",364.7,1444,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,2,"B1")
"DATA",364.7,1444,3,0)
^364.73^1^1^3101223^^
"DATA",364.7,1444,3,1,0)
Operating provider legacy ID if needed
"DATA",364.7,1445,0)
1745^N^5^^^^N
"DATA",364.7,1445,1)
S IBXDATA=$$GETPRV^IBCEF83(IBXIEN,,2,"B2")
"DATA",364.7,1445,3,0)
^364.73^1^1^3101223^^
"DATA",364.7,1445,3,1,0)
Operating legacy ID if needed
"DATA",364.7,1446,0)
1746^N^5^^^^N
"DATA",364.7,1446,1)
K IBXDATA D UB047879^IBCEF83(IBXIEN,.IBXDATA) S IBXSAVE("BOX 78")=IBXDATA(1),IBXSAVE("BOX 79")=IBXDATA(2) K IBXDATA S IBXDATA=$P(IBXSAVE("BOX 78"),U,4)
"DATA",364.7,1446,3,0)
^364.73^1^1^3101223^^
"DATA",364.7,1446,3,1,0)
Other provider NPI if available
"DATA",364.7,1447,0)
1747^N^5^^^^N
"DATA",364.7,1447,1)
S IBXDATA=$P(IBXSAVE("BOX 78"),U,2)
"DATA",364.7,1447,3,0)
^364.73^1^1^3101223^^
"DATA",364.7,1447,3,1,0)
Other provider legacy ID qualifier if needed
"DATA",364.7,1448,0)
1748^N^5^^^^N
"DATA",364.7,1448,1)
S IBXDATA=$P(IBXSAVE("BOX 78"),U,3)
"DATA",364.7,1448,3,0)
^364.73^1^1^3101223^^
"DATA",364.7,1448,3,1,0)
Other provider legacy ID if needed
"DATA",364.7,1451,0)
1751^N^5^^^^N
"DATA",364.7,1451,1)
S IBXDATA=$P(IBXSAVE("BOX 79"),U,4)
"DATA",364.7,1451,3,0)
^^1^1^3101223^
"DATA",364.7,1451,3,1,0)
OTHER PROVIDER NPI
"DATA",364.7,1452,0)
1752^N^5^^^^N
"DATA",364.7,1452,1)
S IBXDATA=$P(IBXSAVE("BOX 79"),U,2)
"DATA",364.7,1452,3,0)
^^1^1^3101223^
"DATA",364.7,1452,3,1,0)
OTHER PROVIDER ID QUALIFIER.
"DATA",364.7,1453,0)
1753^N^5^^^^N
"DATA",364.7,1453,1)
S IBXDATA=$P(IBXSAVE("BOX 79"),U,3)
"DATA",364.7,1453,3,0)
^^1^1^3101223^
"DATA",364.7,1453,3,1,0)
OTHER PROVIDER OTHER ID
"DATA",364.7,1525,0)
1825^N^5^^^^N
"DATA",364.7,1525,1)
S IBXDATA=$P($G(IBXSAVE("CI_PSIDS",1)),U,4)
"DATA",364.7,1526,0)
1826^N^5^^^^N
"DATA",364.7,1526,1)
S IBXDATA=$P($G(IBXSAVE("CI_PSIDS",1)),U,5)
"DATA",364.7,1527,0)
1827^N^5^^^^N
"DATA",364.7,1527,1)
S IBXDATA=$P($G(IBXSAVE("CI_PSIDS",1)),U,6) D CLEANUP^IBCEF78(.IBXSAVE)
"DATA",364.7,1539,0)
1839^N^5^^^^N
"DATA",364.7,1539,1)
D ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1) K IBXDATA N Z F Z=1,2 S IBXDATA(Z)=$P($G(IBXSAVE("BILLING PRV",IBXIEN,"O",Z,2)),U)
"DATA",364.7,1540,0)
1840^N^5^^^^N
"DATA",364.7,1540,1)
K IBXDATA N Z F Z=1,2 S IBXDATA(Z)=$P($G(IBXSAVE("BILLING PRV",IBXIEN,"O",Z,2)),U,2) D:Z=2 CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1611,0)
1911^N^5^^^^N
"DATA",364.7,1611,1)
K IBXSAVE("PRV-BP"),IBXSAVE("ORGNPI"),IBXSAVE("ORGTAX")
"DATA",364.7,1611,3,0)
^364.73^1^1^3100813^^
"DATA",364.7,1611,3,1,0)
Clean up the IBXSAVE usage at the end of the PRV segment.
"DATA",364.7,1617,0)
1917^N^5^^^^N
"DATA",364.7,1617,1)
K IBXDATA I $$FT^IBCEF(IBXIEN)=3,'$$INPAT^IBCEF(IBXIEN),$P($G(^DGCR(399,IBXIEN,"U3")),U,8)'="" S IBXDATA="PR"
"DATA",364.7,1617,3,0)
^364.73^1^1^3100913^^
"DATA",364.7,1617,3,1,0)
This is a qualifier for PRV diagnosis (1)
"DATA",364.7,1618,0)
1918^N^5^^^^N
"DATA",364.7,1618,1)
K IBXDATA I $$FT^IBCEF(IBXIEN)=3,'$$INPAT^IBCEF(IBXIEN) S IBXDATA=$TR($P($$ICD9^IBACSV($P($G(^DGCR(399,IBXIEN,"U3")),U,8)),U,1),".")
"DATA",364.7,1618,3,0)
^^1^1^3081029^
"DATA",364.7,1618,3,1,0)
This is PRV diagnosis (1)
"DATA",364.7,1619,0)
1919^N^5^^^^N
"DATA",364.7,1619,1)
K IBXDATA I '$$INPAT^IBCEF(IBXIEN),$P($G(^DGCR(399,IBXIEN,"U3")),U,9)'="" S IBXDATA="PR"
"DATA",364.7,1619,3,0)
^364.73^1^1^3101101^^
"DATA",364.7,1619,3,1,0)
This is a qualifier for PRV diagnosis (2)
"DATA",364.7,1621,0)
1921^N^5^^^^N
"DATA",364.7,1621,1)
K IBXDATA I '$$INPAT^IBCEF(IBXIEN),$P($G(^DGCR(399,IBXIEN,"U3")),U,10)'="" S IBXDATA="PR"
"DATA",364.7,1621,3,0)
^^1^1^3081029^
"DATA",364.7,1621,3,1,0)
This is a qualifier for PRV diagnosis (3)
"DATA",364.7,1628,0)
1928^N^5^^^^N
"DATA",364.7,1628,1)
K IBXDATA I $P($G(IBXSAVE("PRV1")),U,2)]"" S IBXDATA="XX"
"DATA",364.7,1628,3,0)
^364.73^2^2^3081112^^
"DATA",364.7,1628,3,1,0)
PRV1-5  ID code qualifier
"DATA",364.7,1628,3,2,0)
This is set by PRV1-1.5
"DATA",364.7,1629,0)
1929^N^5^^^^N
"DATA",364.7,1629,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PRV1")),U,2),1)
"DATA",364.7,1629,3,0)
^^6^6^3081111^
"DATA",364.7,1629,3,1,0)
PRV1-6
"DATA",364.7,1629,3,2,0)
pay-to provider primary ID (tax ID here).  Strip out the punctuation.
"DATA",364.7,1629,3,3,0)
 
"DATA",364.7,1629,3,4,0)
 
"DATA",364.7,1629,3,5,0)
please note:  The pay-to provider NPI# which is really the primary ID is
"DATA",364.7,1629,3,6,0)
being sent with NPI-18.
"DATA",364.7,1634,0)
1934^N^5^^^^N
"DATA",364.7,1634,1)
S IBXDATA=$P($G(IBXSAVE("PRV1")),U,9),IBXDATA=$$NOPUNCT^IBCEF(IBXDATA,1)
"DATA",364.7,1634,3,0)
^364.73^2^2^3110217^^
"DATA",364.7,1634,3,1,0)
PRV1-11 - pay-to provider zip code
"DATA",364.7,1634,3,2,0)
Remove any punctuation including dashes or spaces.
"DATA",364.7,1637,0)
1937^N^131^^^^N
"DATA",364.7,1637,1)
S IBXDATA="AMB "
"DATA",364.7,1637,3,0)
^364.73^1^1^3110322^^^
"DATA",364.7,1637,3,1,0)
Output RECORD ID for AMB PICK UP record.
"DATA",364.7,1638,0)
1938^N^254^^^^N^0
"DATA",364.7,1638,1)
S IBXDATA=$S(IBXDATA]"":"PW",1:"")
"DATA",364.7,1639,0)
1939^N^131^^^^N^0
"DATA",364.7,1639,1)
S IBXDATA="AMB "
"DATA",364.7,1640,0)
1940^N^254^^^^N^0
"DATA",364.7,1641,0)
1941^N^259^^^^N^0
"DATA",364.7,1642,0)
1942^N^269^^^^N^0
"DATA",364.7,1643,0)
1943^N^324^^^^N^0
"DATA",364.7,1644,0)
1944^N^325^^^^N^0
"DATA",364.7,1645,0)
1945^N^326^^^^N^0
"DATA",364.7,1645,1)
S IBXDATA=$S(IBXDATA]"":"45",1:"")
"DATA",364.7,1646,0)
1946^N^326^^^^N^0
"DATA",364.7,1647,0)
1947^N^327^^^^N^0
"DATA",364.7,1648,0)
1948^N^328^^^^N^0
"DATA",364.7,1649,0)
1949^N^329^^^^N^0
"DATA",364.7,1650,0)
1950^N^330^^^^N^0
"DATA",364.7,1651,0)
1951^N^331^^^^N^0
"DATA",364.7,1652,0)
1952^N^321^^^^N^0
"DATA",364.7,1652,1)
S IBXDATA=$P($G(IBXSAVE("ORGNPI")),U,3)
"DATA",364.7,1652,3,0)
^364.73^1^1^3100811^^
"DATA",364.7,1652,3,1,0)
Extract NPI Code for Billing Provider
"DATA",364.7,1653,0)
1953^N^321^^^^N^0
"DATA",364.7,1653,1)
S IBXDATA=$S($P($G(IBXSAVE("ORGNPI")),U,3)]"":"XX",1:"")
"DATA",364.7,1653,3,0)
^364.73^1^1^3100811^
"DATA",364.7,1653,3,1,0)
If the NPI number exists this field will be set to XX; otherwise to null.
"DATA",364.7,1654,0)
1954^N^332^^^^N^0
"DATA",364.7,1654,1)
S IBXDATA=$S($$FT^IBCEF(IBXIEN)=3:"",IBXDATA:444,1:"")
"DATA",364.7,1655,0)
1955^N^332^^^^N^0
"DATA",364.7,1655,1)
S IBXDATA=$S($$FT^IBCEF(IBXIEN)=3:"",1:$$DT^IBCEFG1(IBXDATA,"","D8"))
"DATA",364.7,1656,0)
1956^N^333^^^^N^0
"DATA",364.7,1657,0)
1957^N^334^^^^N^0
"DATA",364.7,1657,1)
S IBXSAVE("DIS ST DT")=$S($$FT^IBCEF(IBXIEN)=3:"",1:$$DT^IBCEFG1(IBXDATA,"","D8"))
"DATA",364.7,1658,0)
1958^N^335^^^^N^0
"DATA",364.7,1658,1)
S IBXSAVE("DIS END DT")=$S($$FT^IBCEF(IBXIEN)=3:"",1:$$DT^IBCEFG1(IBXDATA,"","D8"))
"DATA",364.7,1659,0)
1959^N^333^^^^N^0
"DATA",364.7,1659,1)
S IBXDATA=$S($$FT^IBCEF(IBXIEN)=3:"",IBXDATA=360:IBXSAVE("DIS ST DT"),IBXDATA=361:IBXSAVE("DIS END DT"),IBXDATA=314:IBXSAVE("DIS ST DT")_"-"_IBXSAVE("DIS END DT"),1:"")
"DATA",364.7,1660,0)
1960^N^336^^^^N^0
"DATA",364.7,1660,1)
S IBXDATA=$S($$FT^IBCEF(IBXIEN)=3:"",IBXDATA:"090",1:"")
"DATA",364.7,1661,0)
1961^N^336^^^^N^0
"DATA",364.7,1661,1)
S IBXDATA=$S($$FT^IBCEF(IBXIEN)=3:"",1:$$DT^IBCEFG1(IBXDATA,"","D8"))
"DATA",364.7,1662,0)
1962^N^337^^^^N^0
"DATA",364.7,1662,1)
S IBXDATA=$S($$FT^IBCEF(IBXIEN)=3:"",IBXDATA:"091",1:"")
"DATA",364.7,1663,0)
1963^N^337^^^^N^0
"DATA",364.7,1663,1)
S IBXDATA=$S($$FT^IBCEF(IBXIEN)=3:"",1:$$DT^IBCEFG1(IBXDATA,"","D8"))
"DATA",364.7,1664,0)
1964^N^322^^^^N
"DATA",364.7,1664,1)
S IBXDATA=$S($P($G(IBXSAVE("ORGTAX")),U,3)]"":"BI",1:"")
"DATA",364.7,1665,0)
1965^N^322^^^^N
"DATA",364.7,1665,1)
S IBXDATA=$P($G(IBXSAVE("ORGTAX")),U,3)
"DATA",364.7,1666,0)
1966^N^262^^^^N^0
"DATA",364.7,1666,1)
S IBXDATA=$S(IBXDATA]"":"G1",1:"")
"DATA",364.7,1667,0)
1967^N^341^^^^N
"DATA",364.7,1667,1)
S IBXDATA=$S(IBXDATA]"":"9F",1:"")
"DATA",364.7,1668,0)
1968^N^341^^^^N
"DATA",364.7,1669,0)
1969^N^131^^^^N
"DATA",364.7,1669,1)
S IBXDATA="CL1B"
"DATA",364.7,1670,0)
1970^N^342^^^^N
"DATA",364.7,1671,0)
1971^N^343^^^^N
"DATA",364.7,1672,0)
1972^N^344^^^^N
"DATA",364.7,1672,1)
S IBXDATA=$S(IBXDATA]"":"AC",1:"")
"DATA",364.7,1673,0)
1973^N^344^^^^N
"DATA",364.7,1674,0)
1974^N^345^^^^N
"DATA",364.7,1674,1)
S IBXDATA=$S(IBXDATA]"":"Y4",1:"")
"DATA",364.7,1675,0)
1975^N^345^^^^N
"DATA",364.7,1676,0)
1976^N^346^^^^N
"DATA",364.7,1676,1)
S IBXDATA=$S(IBXDATA]"":"IC",1:"")
"DATA",364.7,1677,0)
1977^N^346^^^^N
"DATA",364.7,1678,0)
1978^N^347^^^^N
"DATA",364.7,1678,1)
S IBXDATA=$S(IBXDATA]"":"TE",1:"")
"DATA",364.7,1679,0)
1979^N^347^^^^N
"DATA",364.7,1680,0)
1980^N^348^^^^N
"DATA",364.7,1680,1)
S IBXDATA=$S(IBXDATA]"":"EX",1:"")
"DATA",364.7,1681,0)
1981^N^348^^^^N
"DATA",364.7,1682,0)
1982^N^131^^^^N
"DATA",364.7,1682,1)
S IBXDATA="SPC "
"DATA",364.7,1683,0)
1983^N^349^^^^N
"DATA",364.7,1683,1)
S IBXDATA=$S(IBXDATA]"":"BP",1:"")
"DATA",364.7,1684,0)
1984^N^349^^^^N
"DATA",364.7,1685,0)
1985^N^350^^^^N
"DATA",364.7,1685,1)
S IBXDATA=$S(IBXDATA]"":"BO",1:"")
"DATA",364.7,1686,0)
1986^N^350^^^^N
"DATA",364.7,1687,0)
1988^N^5^^^^N
"DATA",364.7,1687,1)
S IBXDATA=$P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1,0)),U,1)
"DATA",364.7,1690,0)
1991^N^131^^^^N
"DATA",364.7,1690,1)
S IBXDATA="OPR9"
"DATA",364.7,1691,0)
1992^N^5^^^^N
"DATA",364.7,1691,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1691,3,0)
^364.73^1^1^3101108^^
"DATA",364.7,1691,3,1,0)
Extract the Rendering Physician Name.  Controls processing of the record.
"DATA",364.7,1692,0)
1993^N^5^^^^N
"DATA",364.7,1692,1)
K IBXDATA I $D(IBXSAVE("PROVINF",IBXIEN,"C",1,3,"NAME")) S IBXDATA=82
"DATA",364.7,1693,0)
1994^N^5^^^^N
"DATA",364.7,1693,1)
K IBXDATA I $D(IBXSAVE("PROVINF",IBXIEN,"C",1,3,"NAME")) S IBXDATA=1
"DATA",364.7,1694,0)
1995^N^5^^^^N
"DATA",364.7,1694,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,"NAME")),U,1) I Z]"" S IBXDATA=Z
"DATA",364.7,1695,0)
1996^N^5^^^^N
"DATA",364.7,1695,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,"NAME")),U,2) I Z]"" S IBXDATA=Z
"DATA",364.7,1696,0)
1997^N^5^^^^N
"DATA",364.7,1696,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,"NAME")),U,3) I Z]"" S IBXDATA=Z
"DATA",364.7,1697,0)
1998^N^5^^^^N
"DATA",364.7,1697,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,"NAME")),U,5) I Z]"" S IBXDATA=Z
"DATA",364.7,1698,0)
1999^N^5^^^^N
"DATA",364.7,1698,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,0)),U,3) I Z]"" S IBXDATA=Z
"DATA",364.7,1699,0)
2000^N^5^^^^N
"DATA",364.7,1699,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,0)),U,4) I Z]"" S IBXDATA=Z
"DATA",364.7,1700,0)
2001^N^5^^^^N
"DATA",364.7,1700,1)
K IBXDATA I $G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,"TAXONOMY"))]"" S IBXDATA="PE"
"DATA",364.7,1701,0)
2002^N^5^^^^N
"DATA",364.7,1701,1)
K IBXDATA S Z=$G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,"TAXONOMY")) I Z]"" S IBXDATA=Z
"DATA",364.7,1702,0)
2003^N^131^^^^N
"DATA",364.7,1702,1)
S IBXDATA="OPRA"
"DATA",364.7,1703,0)
2004^N^5^^^^N
"DATA",364.7,1703,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,1)),"^",3) I Z]"" S IBXDATA=Z
"DATA",364.7,1704,0)
2005^N^5^^^^N
"DATA",364.7,1704,1)
K IBXDATA S Z=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,1)),"^",4),1) I Z]"" S IBXDATA=Z
"DATA",364.7,1705,0)
2006^N^5^^^^N
"DATA",364.7,1705,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,2)),"^",3) I Z]"" S IBXDATA=Z
"DATA",364.7,1706,0)
2007^N^5^^^^N
"DATA",364.7,1706,1)
K IBXDATA S Z=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,2)),"^",4),1) I Z]"" S IBXDATA=Z
"DATA",364.7,1707,0)
2008^N^5^^^^N
"DATA",364.7,1707,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,3)),"^",3) I Z]"" S IBXDATA=Z
"DATA",364.7,1708,0)
2009^N^5^^^^N
"DATA",364.7,1708,1)
K IBXDATA S Z=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,3)),"^",4),1) I Z]"" S IBXDATA=Z
"DATA",364.7,1709,0)
2010^N^5^^^^N
"DATA",364.7,1709,1)
K IBXDATA S Z=$P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,4)),"^",3) I Z]"" S IBXDATA=Z
"DATA",364.7,1710,0)
2011^N^5^^^^N
"DATA",364.7,1710,1)
K IBXDATA S Z=$$NOPUNCT^IBCEF($P($G(IBXSAVE("PROVINF",IBXIEN,"C",1,3,4)),"^",4),1) I Z]"" S IBXDATA=Z
"DATA",364.7,1711,0)
2012^^131^^^^N
"DATA",364.7,1711,1)
S IBXDATA="OP1A"
"DATA",364.7,1712,0)
2013^N^5^^^^N
"DATA",364.7,1712,1)
K IBXDATA I $$FT^IBCEF(IBIFN)=3 D PROVSEQ^IBCEF72(IBXIEN,.IBXSAVE,.IBXDATA,4,"OP1A")
"DATA",364.7,1713,0)
2014^N^5^^^^N
"DATA",364.7,1713,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,4,"71")
"DATA",364.7,1714,0)
2015^N^5^^^^N
"DATA",364.7,1714,1)
K IBXDATA D OTHPAYC^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,4,"1")
"DATA",364.7,1715,0)
2016^N^5^^^^N
"DATA",364.7,1715,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,4,"Q",1)
"DATA",364.7,1716,0)
2017^N^5^^^^N
"DATA",364.7,1716,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,4,"I",1) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,1717,0)
2018^N^5^^^^N
"DATA",364.7,1717,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,4,"Q",2)
"DATA",364.7,1718,0)
2019^N^5^^^^N
"DATA",364.7,1718,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,4,"I",2) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,1719,0)
2020^N^5^^^^N
"DATA",364.7,1719,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,4,"Q",3)
"DATA",364.7,1720,0)
2021^N^5^^^^N
"DATA",364.7,1720,1)
K IBXDATA D OTHPAYV^IBCEF71(IBXIEN,.IBXSAVE,.IBXDATA,4,"I",3) I $D(IBXDATA) D NOPUNCT^IBCEF73(.IBXDATA,1)
"DATA",364.7,1721,0)
2022^N^5^^^^N
"DATA",364.7,1721,1)
K IBXDATA N Z S Z="" F  S Z=$O(IBXSAVE("OUTPT",Z)) Q:'Z  I $P($G(IBXSAVE("OUTPT",Z,"RX")),U,11) S IBXDATA(Z)=471
"DATA",364.7,1722,0)
2023^N^5^^^^N
"DATA",364.7,1722,1)
K IBXDATA N Z S Z="" F  S Z=$O(IBXSAVE("OUTPT",Z)) Q:'Z  I $D(IBXSAVE("OUTPT",Z,"RX")) S IBXDATA(Z)=$S($P(IBXSAVE("OUTPT",Z,"RX"),U,11)'="":$$DT^IBCEFG1($P(IBXSAVE("OUTPT",Z,"RX"),U,11),"","D8"),1:"")
"DATA",364.7,1723,0)
2024^N^354^^^^N
"DATA",364.7,1723,1)
N Z,IBZ M IBZ=IBXDATA K IBXDATA F Z=1,2 I $G(IBZ(Z))'="" S IBXDATA(Z)="9F"
"DATA",364.7,1724,0)
2025^N^354^^^^N
"DATA",364.7,1724,1)
N Z,IBZ M IBZ=IBXDATA K IBXDATA F Z=1,2 I $G(IBZ(Z))'="" S IBXDATA(Z)=IBZ(Z)
"DATA",364.7,1725,0)
2026^N^5^^^^N
"DATA",364.7,1725,1)
N Z,Z0,IBZ K IBXDATA S (IBZ,Z0)=0 F  S IBZ=$O(IBXSAVE("CCOB",IBZ)) Q:'IBZ  S Z0=Z0+1,Z=0 F  S Z=$O(IBXSAVE("CCOB",IBZ,Z)) Q:'Z  I $P($G(IBXSAVE("CCOB",IBZ,Z,0)),U,6) S IBXDATA(Z0)=573
"DATA",364.7,1726,0)
2027^N^5^^^^N
"DATA",364.7,1726,1)
N Z,Z0,IBZ K IBXDATA S (IBZ,Z0)=0 F  S IBZ=$O(IBXSAVE("CCOB",IBZ)) Q:'IBZ  S Z0=Z0+1,Z=0 F  S Z=$O(IBXSAVE("CCOB",IBZ,Z)) Q:'Z  I $P($G(IBXSAVE("CCOB",IBZ,Z,0)),U,6) S IBXDATA(Z0)=$$DT^IBCEFG1($P(IBXSAVE("CCOB",IBZ,Z,0),U,6),"","D8")
"DATA",364.7,1727,0)
2028^N^5
"DATA",364.7,1727,1)
N Z,Z0,IBZ K IBXDATA S (IBZ,Z0)=0 F  S IBZ=$O(IBXSAVE("CCOB",IBZ)) Q:'IBZ  S Z0=Z0+1,Z=0 F  S Z=$O(IBXSAVE("CCOB",IBZ,Z)) Q:'Z  I $P($G(IBXSAVE("CCOB",IBZ,Z,0)),U,21)'="" S IBXDATA(Z0)=$P(IBXSAVE("CCOB",IBZ,Z,0),U,21)
"DATA",364.7,1728,0)
2029^N^5^^^^N
"DATA",364.7,1728,1)
S IBXDATA="IC" I $P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1,"CONTACT")),U,1)="" S IBXDATA=""
"DATA",364.7,1729,0)
2030^N^5^^^^N
"DATA",364.7,1729,1)
S IBXDATA=$P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1,"CONTACT")),U,1)
"DATA",364.7,1730,0)
2031^N^5^^^^N
"DATA",364.7,1730,1)
S IBXDATA="TE" I $P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1,"CONTACT")),U,2)="" S IBXDATA=""
"DATA",364.7,1731,0)
2032^N^5^^^^N
"DATA",364.7,1731,1)
S IBXDATA=$$NOPUNCT^IBCEF($P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1,"CONTACT")),U,2),1)
"DATA",364.7,1732,0)
2033^N^5^^^^N
"DATA",364.7,1732,1)
S IBXDATA="EX" I $P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1,"CONTACT")),U,3)="" S IBXDATA=""
"DATA",364.7,1733,0)
2034^N^5^^^^N
"DATA",364.7,1733,1)
S IBXDATA=$P($G(IBXSAVE("LAB/FAC",IBXIEN,"C",1,"CONTACT")),U,3)
"DATA",364.7,1750,0)
2050^N^131^^^^N
"DATA",364.7,1750,1)
S IBXDATA="LDAT"
"DATA",364.7,1751,0)
2051^N^5^^^^N
"DATA",364.7,1751,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=Z D:Z>1 ID^IBCEF2(Z,"LDAT")
"DATA",364.7,1751,3,0)
^364.73^1^1^3101019^^
"DATA",364.7,1751,3,1,0)
Service line counter for LDAT record.
"DATA",364.7,1752,0)
2052^N^5^^^^N
"DATA",364.7,1752,1)
K IBXSAVE("LDAT") D GETLDAT^IBCEF11(IBXIEN)
"DATA",364.7,1752,3,0)
^^1^1^3101011^
"DATA",364.7,1752,3,1,0)
Extract data for LDAT record and save it in IBXSAVE("LDAT").
"DATA",364.7,1753,0)
2053^N^5^^^^N
"DATA",364.7,1753,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("LDAT",Z),U)
"DATA",364.7,1753,3,0)
^^1^1^3101011^
"DATA",364.7,1753,3,1,0)
Attachment report type from field 399.0304/71.
"DATA",364.7,1754,0)
2054^N^5^^^^N
"DATA",364.7,1754,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("LDAT",Z),U,2)
"DATA",364.7,1754,3,0)
^^1^1^3101011^
"DATA",364.7,1754,3,1,0)
Attachment report transmission code from 399.0304/72.
"DATA",364.7,1755,0)
2055^N^5^^^^N
"DATA",364.7,1755,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("LDAT",Z),U,3)'="" IBXDATA(Z)="AC"
"DATA",364.7,1755,3,0)
^^1^1^3101011^
"DATA",364.7,1755,3,1,0)
Always set to "AC".
"DATA",364.7,1756,0)
2056^N^5^^^^N
"DATA",364.7,1756,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("LDAT",Z),U,3)
"DATA",364.7,1756,3,0)
^^1^1^3101011^
"DATA",364.7,1756,3,1,0)
Attachment control number from 399.0304/70.
"DATA",364.7,1757,0)
2057^N^5^^^^N
"DATA",364.7,1757,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("LDAT",Z),U,4)'="" IBXDATA(Z)="FL"
"DATA",364.7,1757,3,0)
^^1^1^3101011^
"DATA",364.7,1757,3,1,0)
Always set to "FL".
"DATA",364.7,1758,0)
2058^N^5^^^^N
"DATA",364.7,1758,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("LDAT",Z),U,4)
"DATA",364.7,1758,3,0)
^^1^1^3101012^
"DATA",364.7,1758,3,1,0)
OB Anesthesia Additional Units from field 399.0304/74.
"DATA",364.7,1759,0)
2059^N^5^^^^N
"DATA",364.7,1759,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=""
"DATA",364.7,1759,3,0)
^^1^1^3101012^
"DATA",364.7,1759,3,1,0)
This piece is always blank.
"DATA",364.7,1760,0)
2060^N^5^^^^N
"DATA",364.7,1760,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=""
"DATA",364.7,1760,3,0)
^^1^1^3101012^
"DATA",364.7,1760,3,1,0)
This piece is always blank.
"DATA",364.7,1761,0)
2061^N^5^^^^N
"DATA",364.7,1761,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)="6R"
"DATA",364.7,1761,3,0)
^^1^1^3101012^
"DATA",364.7,1761,3,1,0)
Always set to "6R".
"DATA",364.7,1762,0)
2062^N^5^^^^N
"DATA",364.7,1762,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=Z_"_"_$P(^DGCR(399,IBXIEN,0),U)
"DATA",364.7,1762,3,0)
^^2^2^3101012^
"DATA",364.7,1762,3,1,0)
This piece contains [service line number]_[claim number], i.e. 
"DATA",364.7,1762,3,2,0)
"5_K30002Z".
"DATA",364.7,1763,0)
2063^N^5^^^^N
"DATA",364.7,1763,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("LDAT",Z),U,5)
"DATA",364.7,1763,3,0)
^^2^2^3101012^
"DATA",364.7,1763,3,1,0)
Contains the value of SUB2-8 if available, otherwise contains the value 
"DATA",364.7,1763,3,2,0)
of SUB2-6. If both values are not available, this piece is blank.
"DATA",364.7,1764,0)
2064^N^5^^^^N
"DATA",364.7,1764,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("LDAT",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("LDAT",Z),U,6)
"DATA",364.7,1764,3,0)
^^2^2^3101012^
"DATA",364.7,1764,3,1,0)
Contains total charges returned by either OUTPT^IBCEF11for CMS-1500 or 
"DATA",364.7,1764,3,2,0)
HOS^IBCEF2 for UB-04.
"DATA",364.7,1765,0)
2065^N^5^^^^N
"DATA",364.7,1765,1)
K IBXSAVE("LDAT")
"DATA",364.7,1765,3,0)
^^1^1^3101015^
"DATA",364.7,1765,3,1,0)
Clear IBXSAVE array for this record.
"DATA",364.7,1766,0)
2066^N^131^^^^N
"DATA",364.7,1766,1)
S IBXDATA="LOPE"
"DATA",364.7,1767,0)
2067^N^5^^^^N
"DATA",364.7,1767,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1,"LOPE")
"DATA",364.7,1767,3,0)
^^1^1^3101015^
"DATA",364.7,1767,3,1,0)
Get data for LOPE record.
"DATA",364.7,1768,0)
2068^N^5^^^^N
"DATA",364.7,1768,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$G(IBXSAVE("SLPRV",Z,"SLC")) D:Z>1 ID^IBCEF2(Z,"LOPE")
"DATA",364.7,1769,0)
2069^N^5^^^^N
"DATA",364.7,1769,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U)'="" IBXDATA(Z)=72
"DATA",364.7,1769,3,0)
^^1^1^3101016^
"DATA",364.7,1769,3,1,0)
Always set to 72.
"DATA",364.7,1770,0)
2070^N^5^^^^N
"DATA",364.7,1770,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U)
"DATA",364.7,1771,0)
2071^N^5^^^^N
"DATA",364.7,1771,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,2)
"DATA",364.7,1772,0)
2072^N^5^^^^N
"DATA",364.7,1772,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,3)
"DATA",364.7,1773,0)
2073^N^5^^^^N
"DATA",364.7,1773,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,4)
"DATA",364.7,1774,0)
2074^N^5^^^^N
"DATA",364.7,1774,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,6)'="" IBXDATA(Z)="XX"
"DATA",364.7,1774,3,0)
^^1^1^3101016^
"DATA",364.7,1774,3,1,0)
Always set to XX.
"DATA",364.7,1775,0)
2075^N^5^^^^N
"DATA",364.7,1775,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,6)
"DATA",364.7,1776,0)
2076^N^5^^^^N
"DATA",364.7,1776,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,7)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,8)
"DATA",364.7,1777,0)
2077^N^5^^^^N
"DATA",364.7,1777,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,7)
"DATA",364.7,1778,0)
2078^N^5^^^^N
"DATA",364.7,1778,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,9)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,10)
"DATA",364.7,1779,0)
2079^N^5^^^^N
"DATA",364.7,1779,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,9)
"DATA",364.7,1780,0)
2080^N^5^^^^N
"DATA",364.7,1780,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,11)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,12)
"DATA",364.7,1781,0)
2081^N^5^^^^N
"DATA",364.7,1781,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,11)
"DATA",364.7,1784,0)
2084^N^5^^^^N
"DATA",364.7,1784,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1785,0)
2085^N^131^^^^N
"DATA",364.7,1785,1)
S IBXDATA="LOP1"
"DATA",364.7,1786,0)
2086^N^5^^^^N
"DATA",364.7,1786,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$G(IBXSAVE("SLPRV",Z,"SLC")) D:Z>1 ID^IBCEF2(Z,"LOP1")
"DATA",364.7,1787,0)
2087^N^5^^^^N
"DATA",364.7,1787,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1,"LOP1")
"DATA",364.7,1788,0)
2088^N^5^^^^N
"DATA",364.7,1788,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U)'="" IBXDATA(Z)="ZZ"
"DATA",364.7,1788,3,0)
^^1^1^3101017^
"DATA",364.7,1788,3,1,0)
Always set to ZZ.
"DATA",364.7,1789,0)
2089^N^5^^^^N
"DATA",364.7,1789,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U)
"DATA",364.7,1790,0)
2090^N^5^^^^N
"DATA",364.7,1790,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,2)
"DATA",364.7,1791,0)
2091^N^5^^^^N
"DATA",364.7,1791,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,3)
"DATA",364.7,1792,0)
2092^N^5^^^^N
"DATA",364.7,1792,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,4)
"DATA",364.7,1793,0)
2093^N^5^^^^N
"DATA",364.7,1793,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,6)'="" IBXDATA(Z)="XX"
"DATA",364.7,1793,3,0)
^^1^1^3101017^
"DATA",364.7,1793,3,1,0)
Always set to XX.
"DATA",364.7,1794,0)
2094^N^5^^^^N
"DATA",364.7,1794,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,6)
"DATA",364.7,1795,0)
2095^N^5^^^^N
"DATA",364.7,1795,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,7)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,8)
"DATA",364.7,1796,0)
2096^N^5^^^^N
"DATA",364.7,1796,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,7)
"DATA",364.7,1797,0)
2097^N^5^^^^N
"DATA",364.7,1797,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,9)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,10)
"DATA",364.7,1798,0)
2098^N^5^^^^N
"DATA",364.7,1798,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,9)
"DATA",364.7,1799,0)
2099^N^5^^^^N
"DATA",364.7,1799,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,11)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,12)
"DATA",364.7,1800,0)
2100^N^5^^^^N
"DATA",364.7,1800,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,11)
"DATA",364.7,1803,0)
2103^N^5^^^^N
"DATA",364.7,1803,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1804,0)
2104^N^131^^^^N
"DATA",364.7,1804,1)
S IBXDATA="LREN"
"DATA",364.7,1805,0)
2105^N^5^^^^N
"DATA",364.7,1805,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1,"LREN")
"DATA",364.7,1806,0)
2106^N^5^^^^N
"DATA",364.7,1806,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$G(IBXSAVE("SLPRV",Z,"SLC")) D:Z>1 ID^IBCEF2(Z,"LREN")
"DATA",364.7,1807,0)
2107^N^5^^^^N
"DATA",364.7,1807,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U)'="" IBXDATA(Z)=82
"DATA",364.7,1808,0)
2108^N^5^^^^N
"DATA",364.7,1808,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U)
"DATA",364.7,1809,0)
2109^N^5^^^^N
"DATA",364.7,1809,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,2)
"DATA",364.7,1810,0)
2110^N^5^^^^N
"DATA",364.7,1810,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,3)
"DATA",364.7,1811,0)
2111^N^5^^^^N
"DATA",364.7,1811,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,4)
"DATA",364.7,1812,0)
2112^N^5^^^^N
"DATA",364.7,1812,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,6)'="" IBXDATA(Z)="XX"
"DATA",364.7,1812,3,0)
^^1^1^3101017^
"DATA",364.7,1812,3,1,0)
Always set to XX.
"DATA",364.7,1813,0)
2113^N^5^^^^N
"DATA",364.7,1813,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,6)
"DATA",364.7,1814,0)
2114^N^5^^^^N
"DATA",364.7,1814,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,7)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,8)
"DATA",364.7,1815,0)
2115^N^5^^^^N
"DATA",364.7,1815,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,7)
"DATA",364.7,1816,0)
2116^N^5^^^^N
"DATA",364.7,1816,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,9)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,10)
"DATA",364.7,1817,0)
2117^N^5^^^^N
"DATA",364.7,1817,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,9)
"DATA",364.7,1818,0)
2118^N^5^^^^N
"DATA",364.7,1818,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,11)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,12)
"DATA",364.7,1819,0)
2119^N^5^^^^N
"DATA",364.7,1819,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,11)
"DATA",364.7,1822,0)
2122^N^5^^^^N
"DATA",364.7,1822,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1823,0)
2123^N^5^^^^N
"DATA",364.7,1823,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,5)'="" IBXDATA(Z)="PE"
"DATA",364.7,1824,0)
2124^N^5^^^^N
"DATA",364.7,1824,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,5)
"DATA",364.7,1825,0)
2125^N^131^^^^N
"DATA",364.7,1825,1)
S IBXDATA="LPUR"
"DATA",364.7,1826,0)
2126^N^5^^^^N
"DATA",364.7,1826,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1,"LPUR")
"DATA",364.7,1827,0)
2127^N^5^^^^N
"DATA",364.7,1827,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  I $D(IBXSAVE("SLPRV",Z,"SLC")) S IBXDATA(Z)=$G(IBXSAVE("SLPRV",Z,"SLC")) D:Z>1 ID^IBCEF2(Z,"LPUR")
"DATA",364.7,1828,0)
2128^N^5^^^^N
"DATA",364.7,1828,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" I $D(IBXSAVE("SLPRV",Z,"SLC")) S IBXDATA(Z)="QB"
"DATA",364.7,1829,0)
2129^N^5^^^^N
"DATA",364.7,1829,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,6)'="" IBXDATA(Z)="XX"
"DATA",364.7,1829,3,0)
^^1^1^3101017^
"DATA",364.7,1829,3,1,0)
Always set to XX.
"DATA",364.7,1830,0)
2130^N^5^^^^N
"DATA",364.7,1830,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,6)
"DATA",364.7,1831,0)
2131^N^5^^^^N
"DATA",364.7,1831,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,7)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,8)
"DATA",364.7,1832,0)
2132^N^5^^^^N
"DATA",364.7,1832,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,7)
"DATA",364.7,1833,0)
2133^N^5^^^^N
"DATA",364.7,1833,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1834,0)
2134^N^131^^^^N
"DATA",364.7,1834,1)
S IBXDATA="LSUP"
"DATA",364.7,1835,0)
2135^N^5^^^^N
"DATA",364.7,1835,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1,"LSUP")
"DATA",364.7,1836,0)
2136^N^5^^^^N
"DATA",364.7,1836,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$G(IBXSAVE("SLPRV",Z,"SLC")) D:Z>1 ID^IBCEF2(Z,"LSUP")
"DATA",364.7,1837,0)
2137^N^5^^^^N
"DATA",364.7,1837,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U)'="" IBXDATA(Z)="DQ"
"DATA",364.7,1838,0)
2138^N^5^^^^N
"DATA",364.7,1838,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U)
"DATA",364.7,1839,0)
2139^N^5^^^^N
"DATA",364.7,1839,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,2)
"DATA",364.7,1840,0)
2140^N^5^^^^N
"DATA",364.7,1840,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,3)
"DATA",364.7,1841,0)
2141^N^5^^^^N
"DATA",364.7,1841,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,4)
"DATA",364.7,1842,0)
2142^N^5^^^^N
"DATA",364.7,1842,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,6)'="" IBXDATA(Z)="XX"
"DATA",364.7,1842,3,0)
^^1^1^3101017^
"DATA",364.7,1842,3,1,0)
Always set to XX.
"DATA",364.7,1843,0)
2143^N^5^^^^N
"DATA",364.7,1843,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,6)
"DATA",364.7,1844,0)
2144^N^5^^^^N
"DATA",364.7,1844,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,7)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,8)
"DATA",364.7,1845,0)
2145^N^5^^^^N
"DATA",364.7,1845,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,7)
"DATA",364.7,1846,0)
2146^N^5^^^^N
"DATA",364.7,1846,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,9)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,10)
"DATA",364.7,1847,0)
2147^N^5^^^^N
"DATA",364.7,1847,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,9)
"DATA",364.7,1848,0)
2148^N^5^^^^N
"DATA",364.7,1848,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,11)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,12)
"DATA",364.7,1849,0)
2149^N^5^^^^N
"DATA",364.7,1849,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,11)
"DATA",364.7,1852,0)
2152^N^5^^^^N
"DATA",364.7,1852,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1853,0)
2153^N^131^^^^N
"DATA",364.7,1853,1)
S IBXDATA="LREF"
"DATA",364.7,1854,0)
2154^N^5^^^^N
"DATA",364.7,1854,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1,"LREF")
"DATA",364.7,1855,0)
2155^N^5^^^^N
"DATA",364.7,1855,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$G(IBXSAVE("SLPRV",Z,"SLC")) D:Z>1 ID^IBCEF2(Z,"LREF")
"DATA",364.7,1856,0)
2156^N^5^^^^N
"DATA",364.7,1856,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U)'="" IBXDATA(Z)="DN"
"DATA",364.7,1857,0)
2157^N^5^^^^N
"DATA",364.7,1857,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U)
"DATA",364.7,1858,0)
2158^N^5^^^^N
"DATA",364.7,1858,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,2)
"DATA",364.7,1859,0)
2159^N^5^^^^N
"DATA",364.7,1859,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,3)
"DATA",364.7,1860,0)
2160^N^5^^^^N
"DATA",364.7,1860,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,4)
"DATA",364.7,1861,0)
2161^N^5^^^^N
"DATA",364.7,1861,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,6)'="" IBXDATA(Z)="XX"
"DATA",364.7,1861,3,0)
^^1^1^3101017^
"DATA",364.7,1861,3,1,0)
Always set to XX.
"DATA",364.7,1862,0)
2162^N^5^^^^N
"DATA",364.7,1862,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,6)
"DATA",364.7,1863,0)
2163^N^5^^^^N
"DATA",364.7,1863,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,7)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,8)
"DATA",364.7,1864,0)
2164^N^5^^^^N
"DATA",364.7,1864,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,7)
"DATA",364.7,1865,0)
2165^N^5^^^^N
"DATA",364.7,1865,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,9)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,10)
"DATA",364.7,1866,0)
2166^N^5^^^^N
"DATA",364.7,1866,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,9)
"DATA",364.7,1867,0)
2167^N^5^^^^N
"DATA",364.7,1867,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)="" S:$P(IBXSAVE("SLPRV",Z),U,11)'="" IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,12)
"DATA",364.7,1868,0)
2168^N^5^^^^N
"DATA",364.7,1868,1)
N Z K IBXDATA S Z=0 F  S Z=$O(IBXSAVE("SLPRV",Z)) Q:'Z  S IBXDATA(Z)=$P(IBXSAVE("SLPRV",Z),U,11)
"DATA",364.7,1869,0)
2169^N^5^^^^N
"DATA",364.7,1869,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1870,0)
2170^N^5^^^^N
"DATA",364.7,1870,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1871,0)
2171^N^5^^^^N
"DATA",364.7,1871,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1872,0)
2172^N^5^^^^N
"DATA",364.7,1872,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1873,0)
2173^N^5^^^^N
"DATA",364.7,1873,1)
D CLEANUP^IBCEFP1(.IBXSAVE) D ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1874,0)
2174^N^5^^^^N
"DATA",364.7,1874,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1875,0)
2175^N^5^^^^N
"DATA",364.7,1875,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1875,3,0)
^^1^1^3101105^
"DATA",364.7,1875,3,1,0)
Set up the IBXSAVE array to build the OPR1 record.
"DATA",364.7,1876,0)
2176^N^5^^^^N
"DATA",364.7,1876,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1876,3,0)
^364.73^1^1^3110220^^
"DATA",364.7,1876,3,1,0)
Clean up the IBXSAVE array.
"DATA",364.7,1877,0)
2177^N^5^^^^N
"DATA",364.7,1877,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1877,3,0)
^364.73^1^1^3101108^^
"DATA",364.7,1877,3,1,0)
Setup record for OPR2.  Sets up IBXSAVE
"DATA",364.7,1878,0)
2178^N^5^^^^N
"DATA",364.7,1878,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1878,3,0)
^^1^1^3101105^
"DATA",364.7,1878,3,1,0)
Clean up record for OPR2
"DATA",364.7,1879,0)
2179^N^5^^^^N
"DATA",364.7,1879,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1879,3,0)
^364.73^1^1^3101108^^
"DATA",364.7,1879,3,1,0)
Set up IBXSAVE array for OPR3
"DATA",364.7,1880,0)
2180^N^5^^^^N
"DATA",364.7,1880,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1880,3,0)
^^1^1^3101105^
"DATA",364.7,1880,3,1,0)
Clean up IBXSAVE array
"DATA",364.7,1881,0)
2181^N^5^^^^N
"DATA",364.7,1881,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1881,3,0)
^^1^1^3101105^
"DATA",364.7,1881,3,1,0)
Set up IBXSAVE array for OPR4 record.
"DATA",364.7,1882,0)
2182^N^5^^^^N
"DATA",364.7,1882,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1882,3,0)
^^1^1^3101105^
"DATA",364.7,1882,3,1,0)
Clean up for OPR4 record.
"DATA",364.7,1883,0)
2183^N^5
"DATA",364.7,1883,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1883,3,0)
^^1^1^3101108^
"DATA",364.7,1883,3,1,0)
Setup for OPR5 record
"DATA",364.7,1884,0)
2184^N^5^^^^N
"DATA",364.7,1884,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1884,3,0)
^^1^1^3101108^
"DATA",364.7,1884,3,1,0)
Clean up after OPR5 record.
"DATA",364.7,1885,0)
2185^N^5^^^^N
"DATA",364.7,1885,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1886,0)
2186^N^5^^^^N
"DATA",364.7,1886,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1886,3,0)
^^1^1^3101108^
"DATA",364.7,1886,3,1,0)
Set up the IBXSAVE array for the OPR8 record.
"DATA",364.7,1887,0)
2187^N^5^^^^N
"DATA",364.7,1887,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1888,0)
2188^N^5^^^^N
"DATA",364.7,1888,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1889,0)
2189^N^5^^^^N
"DATA",364.7,1889,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1889,3,0)
^364.73^1^1^3101108^^
"DATA",364.7,1889,3,1,0)
Set up IBXSAVE array for OPRA record.
"DATA",364.7,1890,0)
2190^N^5^^^^N
"DATA",364.7,1890,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1891,0)
2191^N^5^^^^N
"DATA",364.7,1891,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1891,3,0)
^^1^1^3101108^
"DATA",364.7,1891,3,1,0)
Set up IBXSAVE for OP1 record.
"DATA",364.7,1892,0)
2192^N^5^^^^N
"DATA",364.7,1892,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1893,0)
2193^N^5^^^^N
"DATA",364.7,1893,1)
D CLEANUP^IBCEFP1(.IBXSAVE) I $$FT^IBCEF(IBIFN)=3 D ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1893,3,0)
^^1^1^3101108^
"DATA",364.7,1893,3,1,0)
Set up IBX Array for OP1A if form type is 3.
"DATA",364.7,1894,0)
2194^N^5
"DATA",364.7,1894,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1894,3,0)
^^1^1^3101108^
"DATA",364.7,1894,3,1,0)
Clean up after OP1A record.
"DATA",364.7,1895,0)
2195^N^5^^^^N
"DATA",364.7,1895,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1895,3,0)
^^1^1^3101108^
"DATA",364.7,1895,3,1,0)
Set up IBXSAVE array for OP2 record.
"DATA",364.7,1896,0)
2196^N^5^^^^N
"DATA",364.7,1896,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1897,0)
2197^N^5^^^^N
"DATA",364.7,1897,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1897,3,0)
^^1^1^3101108^
"DATA",364.7,1897,3,1,0)
Set up IBXSAVE for OP4 record.
"DATA",364.7,1898,0)
2198^N^5^^^^N
"DATA",364.7,1898,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1899,0)
2199^N^5^^^^N
"DATA",364.7,1899,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1899,3,0)
^^1^1^3101109^
"DATA",364.7,1899,3,1,0)
Set up IBXSAVE array for the OP8 record.
"DATA",364.7,1900,0)
2200^N^5
"DATA",364.7,1900,1)
D CLEANUP^IBCEFP1(.IBXSAVE),ALLIDS^IBCEFP(IBXIEN,.IBXSAVE,1)
"DATA",364.7,1900,3,0)
^^1^1^3101109^
"DATA",364.7,1900,3,1,0)
Set up IBXSAVE array for the OP9 record.
"DATA",364.7,1901,0)
2201^N^5^^^^N
"DATA",364.7,1901,1)
D CLEANUP^IBCEFP1(.IBXSAVE)
"DATA",364.7,1901,3,0)
^^1^1^3101109^
"DATA",364.7,1901,3,1,0)
Clean up IBXSAVE array after OP9 record.
"DATA",364.7,1902,0)
2202^N^5^^^^N
"DATA",364.7,1902,1)
K IBXSAVE N LN,NOKILL,IBPCE S LN=0 F  S LN=$O(^TMP("IBXDATA",$J,IBXREC,IBXPG,LN)) Q:'LN  S NOKILL=0 F IBPCE=4,6,8,10 S:$G(^TMP("IBXDATA",$J,IBXREC,IBXPG,LN,IBPCE))]"" NOKILL=1 I IBPCE=10,'NOKILL K ^TMP("IBXDATA",$J,IBXREC,IBXPG,LN)
"DATA",364.7,1902,3,0)
^^2^2^3101129^
"DATA",364.7,1902,3,1,0)
If pieces 4, 6, 8 and 10 are null remove the line from the output 
"DATA",364.7,1902,3,2,0)
formatter.
"DATA",364.7,1903,0)
2203^N^373^^^^N
"DATA",364.7,1903,1)
M IBXSAVE("CCOB")=IBXDATA K IBXDATA
"DATA",364.7,1904,0)
2204^N^225^^^^N
"DATA",364.7,1904,1)
M IBXSAVE("CCOB")=IBXDATA N Z,Z0,IBZ K IBXDATA S (IBZ,Z0)=0 F  S IBZ=$O(IBXSAVE("CCOB",IBZ)) Q:'IBZ  S Z0=Z0+1,Z=0 F  S Z=$O(IBXSAVE("CCOB",IBZ,Z)) Q:'Z  I $P($G(IBXSAVE("CCOB",IBZ,Z,1)),U,2) S IBXDATA(Z0)="EAF"
"DATA",364.7,1905,0)
2205^N^5^^^^N
"DATA",364.7,1905,1)
N Z,Z0,IBZ K IBXDATA S (IBZ,Z0)=0 F  S IBZ=$O(IBXSAVE("CCOB",IBZ)) Q:'IBZ  S Z0=Z0+1,Z=0 F  S Z=$O(IBXSAVE("CCOB",IBZ,Z)) Q:'Z  I $P($G(IBXSAVE("CCOB",IBZ,Z,1)),U,2) S IBXDATA(Z0)=$$DOLLAR^IBCEFG1($G(IBXDATA(Z0))+$P(IBXSAVE("CCOB",IBZ,Z,1),U,2))
"DATA",364.7,1906,0)
2206^N^5^^^^N
"DATA",364.7,1906,1)
K IBXDATA D COBOUT^IBCEU1(.IBXSAVE,.IBXDATA,"Z")
"DATA",364.7,1906,3,0)
^364.73^1^1^3110113^^
"DATA",364.7,1906,3,1,0)
Payer Sequence # code
"DATA",364.7,1907,0)
2207^N^5^^^^N
"DATA",364.7,1907,1)
K IBXDATA D LCOBOUT^IBCEU1(.IBXSAVE,.IBXDATA,"Z")
"DATA",364.7,1907,3,0)
^364.73^1^1^3110114^^
"DATA",364.7,1907,3,1,0)
Payer Responsibility Sequence # Code
"DATA",364.7,1908,0)
2208^N^5^^^^N
"DATA",364.7,1908,1)
S IBXDATA=$P($G(IBXSAVE("PRV1")),U,3),IBXDATA=$$NOPUNCT^IBCEF(IBXDATA,1) K IBXSAVE("PRV1")
"DATA",364.7,1908,3,0)
^364.73^3^3^3110217^^
"DATA",364.7,1908,3,1,0)
PRV1-12 pay-to provider Tax ID
"DATA",364.7,1908,3,2,0)
 
"DATA",364.7,1908,3,3,0)
Clean up IBXSAVE("PRV1")
"FIA",36)
INSURANCE COMPANY
"FIA",36,0)
^DIC(36,
"FIA",36,0,0)
36I
"FIA",36,0,1)
y^y^p^^^^n^^n
"FIA",36,0,10)

"FIA",36,0,11)

"FIA",36,0,"RLRO")

"FIA",36,0,"VR")
2.0^IB
"FIA",36,36)
1
"FIA",36,36,6.09)

"FIA",36,36,6.1)

"FIA",350.8)
IB ERROR
"FIA",350.8,0)
^IBE(350.8,
"FIA",350.8,0,0)
350.8I
"FIA",350.8,0,1)
n^n^f^^n^^y^o^n
"FIA",350.8,0,10)

"FIA",350.8,0,11)
I $$INC3508^IBY432PR(Y)
"FIA",350.8,0,"RLRO")

"FIA",350.8,0,"VR")
2.0^IB
"FIA",350.8,350.8)
0
"FIA",350.9)
IB SITE PARAMETERS
"FIA",350.9,0)
^IBE(350.9,
"FIA",350.9,0,0)
350.9I
"FIA",350.9,0,1)
y^n^p^^^^n^^n
"FIA",350.9,0,10)

"FIA",350.9,0,11)

"FIA",350.9,0,"RLRO")

"FIA",350.9,0,"VR")
2.0^IB
"FIA",350.9,350.9)
1
"FIA",350.9,350.9,8.14)

"FIA",350.9,350.9,8.15)

"FIA",350.9,350.9,8.16)

"FIA",350.9,350.9,8.17)

"FIA",350.9,350.9,8.19)

"FIA",353.3)
IB ATTACHMENT REPORT TYPE
"FIA",353.3,0)
^IBE(353.3,
"FIA",353.3,0,0)
353.3I
"FIA",353.3,0,1)
y^y^f^^n^^y^o^n
"FIA",353.3,0,10)

"FIA",353.3,0,11)

"FIA",353.3,0,"RLRO")

"FIA",353.3,0,"VR")
2.0^IB
"FIA",353.3,353.3)
0
"FIA",355.3)
GROUP INSURANCE PLAN
"FIA",355.3,0)
^IBA(355.3,
"FIA",355.3,0,0)
355.3IP
"FIA",355.3,0,1)
y^n^p^^^^n^^n
"FIA",355.3,0,10)

"FIA",355.3,0,11)

"FIA",355.3,0,"RLRO")

"FIA",355.3,0,"VR")
2.0^IB
"FIA",355.3,355.3)
1
"FIA",355.3,355.3,.15)

"FIA",355.93)
IB NON/OTHER VA BILLING PROVIDER
"FIA",355.93,0)
^IBA(355.93,
"FIA",355.93,0,0)
355.93I
"FIA",355.93,0,1)
y^y^p^^^^n^^n
"FIA",355.93,0,10)

"FIA",355.93,0,11)

"FIA",355.93,0,"RLRO")

"FIA",355.93,0,"VR")
2.0^IB
"FIA",355.93,355.93)
1
"FIA",355.93,355.93,1.01)

"FIA",355.93,355.93,1.02)

"FIA",355.93,355.93,1.03)

"FIA",362.4)
IB BILL/CLAIMS PRESCRIPTION REFILL
"FIA",362.4,0)
^IBA(362.4,
"FIA",362.4,0,0)
362.4I
"FIA",362.4,0,1)
y^y^p^^^^n^^n
"FIA",362.4,0,10)

"FIA",362.4,0,11)

"FIA",362.4,0,"RLRO")

"FIA",362.4,0,"VR")
2.0^IB
"FIA",362.4,362.4)
1
"FIA",362.4,362.4,.11)

"FIA",364.5)
IB DATA ELEMENT DEFINITION
"FIA",364.5,0)
^IBA(364.5,
"FIA",364.5,0,0)
364.5I
"FIA",364.5,0,1)
n^n^f^^y^^y^o^n
"FIA",364.5,0,10)

"FIA",364.5,0,11)
I $$INCLUDE^IBY432PR(5,Y)
"FIA",364.5,0,"RLRO")

"FIA",364.5,0,"VR")
2.0^IB
"FIA",364.5,364.5)
0
"FIA",364.5,364.53)
0
"FIA",364.6)
IB FORM SKELETON DEFINITION
"FIA",364.6,0)
^IBA(364.6,
"FIA",364.6,0,0)
364.6IP
"FIA",364.6,0,1)
n^n^f^^y^^y^o^n
"FIA",364.6,0,10)

"FIA",364.6,0,11)
I $$INCLUDE^IBY432PR(6,Y)
"FIA",364.6,0,"RLRO")

"FIA",364.6,0,"VR")
2.0^IB
"FIA",364.6,364.6)
0
"FIA",364.7)
IB FORM FIELD CONTENT
"FIA",364.7,0)
^IBA(364.7,
"FIA",364.7,0,0)
364.7IP
"FIA",364.7,0,1)
n^n^f^^y^^y^o^n
"FIA",364.7,0,10)

"FIA",364.7,0,11)
I $$INCLUDE^IBY432PR(7,Y)
"FIA",364.7,0,"RLRO")

"FIA",364.7,0,"VR")
2.0^IB
"FIA",364.7,364.7)
0
"FIA",364.7,364.73)
0
"FIA",399)
BILL/CLAIMS
"FIA",399,0)
^DGCR(399,
"FIA",399,0,0)
399I
"FIA",399,0,1)
y^n^p^^^^n^^n
"FIA",399,0,10)

"FIA",399,0,11)

"FIA",399,0,"RLRO")

"FIA",399,0,"VR")
2.0^IB
"FIA",399,399)
1
"FIA",399,399,.19)

"FIA",399,399,.21)

"FIA",399,399,28.1)

"FIA",399,399,34)

"FIA",399,399,35)

"FIA",399,399,36)

"FIA",399,399,37)

"FIA",399,399,38)

"FIA",399,399,39)

"FIA",399,399,78)

"FIA",399,399,101)

"FIA",399,399,222)

"FIA",399,399,238)

"FIA",399,399,253)

"FIA",399,399,254)

"FIA",399,399,255)

"FIA",399,399,260)

"FIA",399,399,261)

"FIA",399,399,262)

"FIA",399,399,263)

"FIA",399,399,264)

"FIA",399,399,266)

"FIA",399,399,267)

"FIA",399,399,268)

"FIA",399,399,269)

"FIA",399,399,269.1)

"FIA",399,399,271)

"FIA",399,399,272)

"FIA",399,399,273)

"FIA",399,399,274)

"FIA",399,399,275)

"FIA",399,399,276)

"FIA",399,399,277)

"FIA",399,399,278)

"FIA",399,399,279)

"FIA",399,399,280)

"FIA",399,399,281)

"FIA",399,399,282)

"FIA",399,399,283)

"FIA",399,399,284)

"FIA",399,399,285)

"FIA",399,399,286)

"FIA",399,399,453)

"FIA",399,399,454)

"FIA",399,399,455)

"FIA",399,399.0222)
1
"FIA",399,399.0222,.01)

"FIA",399,399.0222,.02)

"FIA",399,399.0304)
1
"FIA",399,399.0304,19)

"FIA",399,399.0304,60)

"FIA",399,399.0304,70)

"FIA",399,399.0304,71)

"FIA",399,399.0304,72)

"FIA",399,399.0304,74)

"FIA",399,399.0404)
0
"FIA",399,399.042)
1
"FIA",399,399.042,.02)

"FIA",399,399.042,.04)

"FIA",399,399.042,.09)

"FIA",399,399.078)
0
"FIA",399,399.0781)
0
"INI")
IBY432PR
"INIT")
IBY432PO
"IX",364.6,364.6,"ALL",0)
364.6^ALL^Allows for identification of local override fields that apply to ALL^MU^^F^IR^I^364.6^^^^^S
"IX",364.6,364.6,"ALL",1)
S ^IBA(364.7,"ALL",DA,X2(5))=""
"IX",364.6,364.6,"ALL",1.4)
I X2(4)'="L"!'X2(5)!(X2(2)'="")!(X2(3)'="")!'X2(1) S X=0
"IX",364.6,364.6,"ALL",2)
K ^IBA(364.7,"ALL",DA,X1(5))
"IX",364.6,364.6,"ALL",2.4)
I X1(4)'="L"!'X1(5)!(X1(2)'="")!(X1(3)'="")!'X1(1) S X=0
"IX",364.6,364.6,"ALL",2.5)
K ^IBA(364.7,"ALL")
"IX",364.6,364.6,"ALL",11.1,0)
^.114IA^5^5
"IX",364.6,364.6,"ALL",11.1,1,0)
1^F^364.6^.03^^1^F
"IX",364.6,364.6,"ALL",11.1,1,1)
 
"IX",364.6,364.6,"ALL",11.1,2,0)
2^C
"IX",364.6,364.6,"ALL",11.1,2,1.5)
N Z S Z=+$O(^IBA(364.7,"B",DA,0)) I Z S X=$P($G(^IBA(364.7,Z,0)),U,5)
"IX",364.6,364.6,"ALL",11.1,3,0)
3^C
"IX",364.6,364.6,"ALL",11.1,3,1.5)
N Z S Z=+$O(^IBA(364.7,"B",DA,0)) I Z S X=$P($G(^IBA(364.7,Z,0)),U,6)
"IX",364.6,364.6,"ALL",11.1,4,0)
4^C
"IX",364.6,364.6,"ALL",11.1,4,1.5)
N Z S Z=+$O(^IBA(364.7,"B",DA,0)) I Z S X=$P($G(^IBA(364.7,Z,0)),U,2)
"IX",364.6,364.6,"ALL",11.1,5,0)
5^C
"IX",364.6,364.6,"ALL",11.1,5,1.5)
S X=+$O(^IBA(364.7,"B",DA,0))
"IX",364.6,364.6,"C",0)
364.6^C^Field name lookup^R^^F^IR^I^364.6^^^^^LS
"IX",364.6,364.6,"C",1)
S ^IBA(364.6,"C",$E(X,1,40),DA)=""
"IX",364.6,364.6,"C",2)
K ^IBA(364.6,"C",$E(X,1,40),DA)
"IX",364.6,364.6,"C",2.5)
K ^IBA(364.6,"C")
"IX",364.6,364.6,"C",11.1,0)
^.114IA^1^1
"IX",364.6,364.6,"C",11.1,1,0)
1^F^364.6^.1^40^1^F
"IX",364.6,364.6,"C",11.1,1,2)
S X=$$UP^XLFSTR(X)
"IX",364.6,364.6,"D",0)
364.6^D^XREF BY FORM,PAGE,LINE,COL TO SIMPLIFY DEVELOPMENT^MU^^R^IR^I^364.6^^^^^LS
"IX",364.6,364.6,"D",1)
S ^IBA(364.6,"D",X2(1)_","_X2(2)_","_X2(3)_","_X2(4),DA)=""
"IX",364.6,364.6,"D",1.4)
I X2(1)=""!(X2(2)="")!(X2(3)="")!(X2(4)="") S X=0
"IX",364.6,364.6,"D",2)
K ^IBA(364.6,"D",X1(1)_","_X1(2)_","_X1(3)_","_X1(4),DA)
"IX",364.6,364.6,"D",2.4)
I X1(1)=""!(X1(2)="")!(X1(3)="")!(X1(4)="") S X=0
"IX",364.6,364.6,"D",2.5)
K ^IBA(364.6,"D")
"IX",364.6,364.6,"D",11.1,0)
^.114IA^4^4
"IX",364.6,364.6,"D",11.1,1,0)
1^F^364.6^.01^^1^F
"IX",364.6,364.6,"D",11.1,2,0)
2^F^364.6^.04^^^F
"IX",364.6,364.6,"D",11.1,3,0)
3^F^364.6^.05^^^F
"IX",364.6,364.6,"D",11.1,4,0)
4^F^364.6^.08^^^F
"IX",364.7,364.7,"ALL",0)
364.7^ALL^Xref contains all local overrides defined for all insurance and type^MU^^F^IR^I^364.7^^^^^S
"IX",364.7,364.7,"ALL",1)
S ^IBA(364.7,"ALL",X2(2),DA)=""
"IX",364.7,364.7,"ALL",1.4)
I 'X2(2)!(X2(4)'="")!(X2(5)'="")!(X2(3)'="L") S X=0
"IX",364.7,364.7,"ALL",2)
K ^IBA(364.7,"ALL",X1(2),DA)
"IX",364.7,364.7,"ALL",2.4)
I 'X1(2)!(X1(4)'="")!(X1(5)'="")!(X1(3)'="L") S X=0
"IX",364.7,364.7,"ALL",2.5)
K ^IBA(364.7,"ALL")
"IX",364.7,364.7,"ALL",11.1,0)
^.114IA^5^5
"IX",364.7,364.7,"ALL",11.1,1,0)
1^F^364.7^.01^15^^F
"IX",364.7,364.7,"ALL",11.1,1,3)
 
"IX",364.7,364.7,"ALL",11.1,2,0)
2^C^^^10^1
"IX",364.7,364.7,"ALL",11.1,2,1.5)
S X=$P($G(^IBA(364.6,+X(1),0)),U,3)
"IX",364.7,364.7,"ALL",11.1,3,0)
3^F^364.7^.02^10^^F
"IX",364.7,364.7,"ALL",11.1,3,3)
 
"IX",364.7,364.7,"ALL",11.1,4,0)
4^F^364.7^.05^20^^F
"IX",364.7,364.7,"ALL",11.1,4,3)
 
"IX",364.7,364.7,"ALL",11.1,5,0)
5^F^364.7^.06^20^^F
"IX",364.7,364.7,"ALL",11.1,5,3)
 
"IX",399,399,"ABP",0)
399^ABP^Update default taxonomy codes and billing provider IDs^MU^^R^IR^I^399^^^^^A
"IX",399,399,"ABP",.1,0)
^^17^17^3091019
"IX",399,399,"ABP",.1,1,0)
Whenever the fields in this x-ref are changed in any way (add/edit/delete)
"IX",399,399,"ABP",.1,2,0)
the billing provider and service facility for the claim may change so we
"IX",399,399,"ABP",.1,3,0)
need to recalculate the default values of the billing provider taxonomy
"IX",399,399,"ABP",.1,4,0)
code, the service facility taxonomy code, and the billing provider
"IX",399,399,"ABP",.1,5,0)
secondary IDs and Qualifiers for every payer on the claim.
"IX",399,399,"ABP",.1,6,0)
 
"IX",399,399,"ABP",.1,7,0)
Please note that this x-ref will potentially update the values of 8
"IX",399,399,"ABP",.1,8,0)
fields in file 399:
"IX",399,399,"ABP",.1,9,0)
 
"IX",399,399,"ABP",.1,10,0)
399,243 - SERVICE FACILITY TAXONOMY
"IX",399,399,"ABP",.1,11,0)
399,252 - BILLING PROVIDER TAXONOMY
"IX",399,399,"ABP",.1,12,0)
399,122 - PRIMARY PROVIDER #
"IX",399,399,"ABP",.1,13,0)
399,123 - SECONDARY PROVIDER #
"IX",399,399,"ABP",.1,14,0)
399,124 - TERTIARY PROVIDER #
"IX",399,399,"ABP",.1,15,0)
399,128 - PRIMARY ID QUALIFIER
"IX",399,399,"ABP",.1,16,0)
399,129 - SECONDARY ID QUALIFIER
"IX",399,399,"ABP",.1,17,0)
399,130 - TERTIARY ID QUALIFIER
"IX",399,399,"ABP",1)
D TAX^IBCEF79(DA)
"IX",399,399,"ABP",2)
D TAX^IBCEF79(DA)
"IX",399,399,"ABP",11.1,0)
^.114IA^4^4
"IX",399,399,"ABP",11.1,1,0)
1^F^399^.22^^^F
"IX",399,399,"ABP",11.1,2,0)
2^F^399^232^^^F
"IX",399,399,"ABP",11.1,3,0)
3^F^399^136^^^F
"IX",399,399,"ABP",11.1,4,0)
4^F^399^.19^^^F
"IX",399,399,"AE",0)
399^AE^Index by patient and insurance company^MU^^R^IR^I^399^^^^^S
"IX",399,399,"AE",.1,0)
^^7^7^3041021^
"IX",399,399,"AE",.1,1,0)
Cross reference of patients and bills to payer responsible for the bill.
"IX",399,399,"AE",.1,2,0)
This will be used to prevent deletion of insurance policy entries from the
"IX",399,399,"AE",.1,3,0)
patient file if a bill has been created for this insurance company.
"IX",399,399,"AE",.1,4,0)
 
"IX",399,399,"AE",.1,5,0)
Created with patch IB*2.0*288 replacing traditional cross-reference #1 in 
"IX",399,399,"AE",.1,6,0)
field 135 of file 399.  Medicare is now a valid insurance company for 
"IX",399,399,"AE",.1,7,0)
this index file.
"IX",399,399,"AE",1)
N CURR S CURR=+$$COBN^IBCEF(DA) I $G(X(4)),$G(X(CURR)) S ^DGCR(399,"AE",X(4),X(CURR),DA)=""
"IX",399,399,"AE",2)
N G I $G(X(4)) F G=1,2,3 I $G(X(G)) K ^DGCR(399,"AE",X(4),X(G),DA)
"IX",399,399,"AE",2.5)
K ^DGCR(399,"AE")
"IX",399,399,"AE",11.1,0)
^.114IA^4^4
"IX",399,399,"AE",11.1,1,0)
1^F^399^101^^^F
"IX",399,399,"AE",11.1,1,3)

"IX",399,399,"AE",11.1,2,0)
2^F^399^102^^^F
"IX",399,399,"AE",11.1,2,3)

"IX",399,399,"AE",11.1,3,0)
3^F^399^103^^^F
"IX",399,399,"AE",11.1,3,3)

"IX",399,399,"AE",11.1,4,0)
4^F^399^.02^^^F
"IX",399,399,"AE",11.1,4,3)

"IX",399,399,"AK",0)
399^AK^Update the line level providers for claim FORM TYPE change.^MU^^F^IR^I^399^^^^^A
"IX",399,399,"AK",.1,0)
^^36^36^3101022^
"IX",399,399,"AK",.1,1,0)
For Patch IB*2.0*432:
"IX",399,399,"AK",.1,2,0)
 
"IX",399,399,"AK",.1,3,0)
The patch introduces line providers to the Bill/Claims process. Line 
"IX",399,399,"AK",.1,4,0)
providers (Sub-file 399.0404) are based on the claim FORM TYPE. So, when
"IX",399,399,"AK",.1,5,0)
there is a change in claim FORM TYPE, then we want to update the line
"IX",399,399,"AK",.1,6,0)
level providers to be in agreement with the claim FORM TYPE (see below for
"IX",399,399,"AK",.1,7,0)
FORM TYPE and allowable line provider types). In the case when the FORM
"IX",399,399,"AK",.1,8,0)
TYPE field is changed, then the line provider types are checked to see if
"IX",399,399,"AK",.1,9,0)
any, or all, line providers need to be deleted from the claim.
"IX",399,399,"AK",.1,10,0)
 
"IX",399,399,"AK",.1,11,0)
Logic:
"IX",399,399,"AK",.1,12,0)
 
"IX",399,399,"AK",.1,13,0)
(1) IF $$LNPRVFT^IBCEU7(X,.IBLNPRV) is TRUE, then we have line providers
"IX",399,399,"AK",.1,14,0)
    in the IBLNPRV array to be deleted.
"IX",399,399,"AK",.1,15,0)
    Note: IBLNPRV array holds the procedure IENs (Sub-file 399.0304), and
"IX",399,399,"AK",.1,16,0)
    line provider IENs and .01 field (Sub-file 399.0404,.01) equal to the 
"IX",399,399,"AK",.1,17,0)
    delete indicator "@" in FDA format 
"IX",399,399,"AK",.1,18,0)
    (FDA_ROOT(FILE#,"IENS",FIELD#)="VALUE".
"IX",399,399,"AK",.1,19,0)
 
"IX",399,399,"AK",.1,20,0)
(2) IF (1) TRUE, then we call FILE^DIE("E","IBLNPRV") to delete the line
"IX",399,399,"AK",.1,21,0)
level providers in the IBLNPRV array.
"IX",399,399,"AK",.1,22,0)
 
"IX",399,399,"AK",.1,23,0)
Allowable line provider types by FORM TYPE:
"IX",399,399,"AK",.1,24,0)
 
"IX",399,399,"AK",.1,25,0)
Allowable line provider functions for UB04 (FORM TYPE = 3)
"IX",399,399,"AK",.1,26,0)
  Inpatient and UB04 Outpatient:
"IX",399,399,"AK",.1,27,0)
   - Rendering Provider(VAL=3).
"IX",399,399,"AK",.1,28,0)
   - Referring Provider(VAL=1).
"IX",399,399,"AK",.1,29,0)
   - Operating Physician(VAL=2).
"IX",399,399,"AK",.1,30,0)
   - Other Operating Physician(VAL=9).
"IX",399,399,"AK",.1,31,0)
 
"IX",399,399,"AK",.1,32,0)
Allowable line provider functions for CMS 1500 (FORM TYPE = 2)
"IX",399,399,"AK",.1,33,0)
  Inpatient and CMS 1500 Outpatient:
"IX",399,399,"AK",.1,34,0)
   - Rendering Provider(VAL=3).
"IX",399,399,"AK",.1,35,0)
   - Referring Provider(VAL=1).
"IX",399,399,"AK",.1,36,0)
   - Supervising Provider(VAL=5).
"IX",399,399,"AK",1)
N IBLNPRV I $$LNPRVFT^IBCEU7(X,.IBLNPRV) D FILE^DIE("E","IBLNPRV") Q
"IX",399,399,"AK",2)
Q
"IX",399,399,"AK",11.1,0)
^.114IA^1^1
"IX",399,399,"AK",11.1,1,0)
1^F^399^.19^20^^F
"IX",399,399,"AL",0)
399^AL^Remove line level info from inpatient UBs.^MU^^F^IR^I^399^^^^^A
"IX",399,399,"AL",.1,0)
^^11^11^3110301^
"IX",399,399,"AL",.1,1,0)
For Patch IB*2.0*432:
"IX",399,399,"AL",.1,2,0)
 
"IX",399,399,"AL",.1,3,0)
The patch introduces line providers and line level attachment 
"IX",399,399,"AL",.1,4,0)
information to the Bill/Claims process. Billers are prevented from 
"IX",399,399,"AL",.1,5,0)
entering this information for inpatient UBs.  However, if the biller 
"IX",399,399,"AL",.1,6,0)
entered the information before changing the FORM TYPE to UB, the data may
"IX",399,399,"AL",.1,7,0)
exist and needs to be cleaned up.  The clean up routine removes 
"IX",399,399,"AL",.1,8,0)
following line level attachment information from the PROCEDURES sub-file
"IX",399,399,"AL",.1,9,0)
(#399.0304): (#70) ATTACHMENT CONTROL NUMBER, (#71) ATTACHMENT REPORT
"IX",399,399,"AL",.1,10,0)
TYPE and (#72) ATTACHMENT REPORT TRANS CODE. It also removes all line
"IX",399,399,"AL",.1,11,0)
level provider information in the LINE PROVIDER sub-file (#399.0404).
"IX",399,399,"AL",1)
D REMOVE^IBCEU7(IBIFN,X(1))
"IX",399,399,"AL",1.4)
S X=X(1)=3
"IX",399,399,"AL",2)
Q
"IX",399,399,"AL",11.1,0)
^.114IA^1^1
"IX",399,399,"AL",11.1,1,0)
1^F^399^.19^20^^F
"IX",399,399,"AUPDID",0)
399^AUPDID^UPDATE PROVIDER ID WHEN DATA FIELDS CHANGE AT TOP LEVEL OF FILE^MU^^R^IR^I^399^^^^^A
"IX",399,399,"AUPDID",.1,0)
^^5^5^3010109^
"IX",399,399,"AUPDID",.1,1,0)
This cross reference maintains the integrity of the rendering or attending
"IX",399,399,"AUPDID",.1,2,0)
provider id whenever an insurance company is added, deleted or changed
"IX",399,399,"AUPDID",.1,3,0)
on the claim.  If either of these provider functions exist on the bill,
"IX",399,399,"AUPDID",.1,4,0)
this cross reference sets the default id data based on the insurance co's
"IX",399,399,"AUPDID",.1,5,0)
parameters.
"IX",399,399,"AUPDID",1)
D:X1(1)'=X2(1)!(X1(5)'=X2(5)) SETID^IBCEP3(DA,1) D:X1(2)'=X2(2)!(X1(4)'=X2(4)) SETID^IBCEP3(DA,2) D:X1(3)'=X2(3)!(X1(6)'=X2(6)) SETID^IBCEP3(DA,3)
"IX",399,399,"AUPDID",1.4)
S X=$S($O(^DGCR(399,DA,"PRV",0)):1,1:0)
"IX",399,399,"AUPDID",2)
D:X1(1)'=X2(1)!(X1(5)'=X2(5)) DELID^IBCEP3(DA,1) D:X1(2)'=X2(2)!(X1(4)'=X2(4)) DELID^IBCEP3(DA,2) D:X1(3)'=X2(3)!(X1(6)'=X2(6)) DELID^IBCEP3(DA,3)
"IX",399,399,"AUPDID",2.4)
S X=$S($O(^DGCR(399,DA,"PRV",0)):1,1:0)
"IX",399,399,"AUPDID",11.1,0)
^.114IA^6^6
"IX",399,399,"AUPDID",11.1,1,0)
1^F^399^101^^^F
"IX",399,399,"AUPDID",11.1,2,0)
2^F^399^102^^^F
"IX",399,399,"AUPDID",11.1,3,0)
3^F^399^103^^^F
"IX",399,399,"AUPDID",11.1,4,0)
4^F^399^113^^^F
"IX",399,399,"AUPDID",11.1,5,0)
5^F^399^112^^^F
"IX",399,399,"AUPDID",11.1,5,3)
 
"IX",399,399,"AUPDID",11.1,6,0)
6^F^399^114^^^F
"IX",399,399,"AUPDID",11.1,6,3)
 
"IX",399,399.0404,"C",0)
399.0404^C^External value of LINE FUNCTION field.^R^^F^IR^I^399.0404^^^^^LS
"IX",399,399.0404,"C",1)
S ^DGCR(399,DA(2),"CP",DA(1),"LNPRV","C",$E(X(2),1,30),DA)=""
"IX",399,399.0404,"C",2)
K ^DGCR(399,DA(2),"CP",DA(1),"LNPRV","C",$E(X(2),1,30),DA)
"IX",399,399.0404,"C",2.5)
K ^DGCR(399,DA(2),"CP",DA(1),"LNPRV","C")
"IX",399,399.0404,"C",11.1,0)
^.114IA^2^2
"IX",399,399.0404,"C",11.1,1,0)
1^F^399.0404^.01^30^^F
"IX",399,399.0404,"C",11.1,1,3)

"IX",399,399.0404,"C",11.1,2,0)
2^C^^^30^1
"IX",399,399.0404,"C",11.1,2,1.5)
S X=$$EXTERNAL^DILFD(399.0404,.01,,X(1))
"KRN",.402,2199,-1)
0^9
"KRN",.402,2199,0)
IB SCREEN7^3100920.17^@^399^^@^3110912
"KRN",.402,2199,"AR",399,120)
1^IBXS78
"KRN",.402,2199,"DIAB",1,1,399.043,0)
ALL
"KRN",.402,2199,"DIAB",4,0,399,1)
UB-04 TIMEFRAME OF BILL;"TIMEFRAME OF BILL"
"KRN",.402,2199,"DIAB",11,0,399,0)
UB-04 LOCATION OF CARE;"LOCATION OF CARE"
"KRN",.402,2199,"DIAB",13,0,399,0)
UB-04 BILL CLASSIFICATION;"BILL CLASSIFICATION"
"KRN",.402,2199,"DR",1,399)
S:IBDR20'["74" Y="@71";S:$D(IBOUT) Y="@999";43;@999;K IBOUT;@71;S:IBDR20'["71" Y="@72";S:$P($G(^DGCR(399,DA,0)),U,19)'=3 Y="@712";@711;S DIE("NO^")="";.24LOCATION OF CARE~;S:'$D(DIE("NO^")) DIE("NO^")="";.25BILL CLASSIFICATION~;
"KRN",.402,2199,"DR",1,399,1)
I '$$TOBIN^IBCU4($P(^DGCR(399,DA,0),U,25),DA) W !!,*7,"  **  The 'BILL CLASSIFICATION' must be consistent with the 'LOCATION OF CARE.'",! S Y="@711";@712;K DIE("NO^");.26TIMEFRAME OF BILL~;162;.22;243;
"KRN",.402,2199,"DR",1,399,2)
D DISPTAX^IBCEP81($P($G(^DGCR(399,DA,"U3")),U,2),"Service Facility");.27;S DGRVRCAL=1;S DIPA("FT1")=$P($G(^DGCR(399,DA,0)),U,19);D CKFT^IBCIUT1(IBIFN);@714;.19;S DIPA("FT")=$P($G(^DGCR(399,DA,0)),U,19);
"KRN",.402,2199,"DR",1,399,3)
I $P($G(^IBE(353,+DIPA("FT"),2)),U,2)="P",$P($G(^(2)),U,4) S DIPA("FT1")=DIPA("FT") D CKFT^IBCIUT1(IBIFN) S Y="@715";W !,*7,"Must be a printable national form type";.19///^S X=$G(DIPA("FT1"));S Y="@714";@715;D FTPRV^IBCEU5(DA);@72;
"KRN",.402,2199,"DR",1,399,4)
S:IBDR20'["72" Y="@73";155;S:X=0 Y=156;157;156;S:'$D(IBOX) Y="@73";153;@73;S:IBDR20'["73" Y="@75";151;152;@75;S:IBDR20'["75" Y="@76";D RCD^IBCU1;42;202;S:'X Y="@757";203;@757;I $P(^DGCR(399,DA,"U1"),"^",11)']"" S Y="@76";210;@76;
"KRN",.402,2199,"DR",1,399,5)
@77;S:IBDR20'["77" Y="@78";S:'$D(^DGCR(399,DA,"I1")) Y="@772";218;@772;S:'$D(^DGCR(399,DA,"I2")) Y="@773";219;@773;S:'$D(^DGCR(399,DA,"I3")) Y="@78";220;@78;K DIE("NO^");
"KRN",.402,2199,"DR",2,399.042)
.01;.02;.03;.04;.05;.09;.06;I '$P(^DGCR(399,DA(1),"RC",DA,0),U,6) S Y="@758";.07//^S X=$$DEFDIV^IBCU7(DA(1));@758;I +$P(^DGCR(399,DA(1),"RC",DA,0),U,8) W !," AUTO ADDED CHARGE - NO CHANGE TO TYPE/COMPONENT" S Y="@759";.1;.12;
"KRN",.402,2199,"DR",2,399.042,1)
I $S($P($G(^DGCR(399,DA(1),"RC",DA,0)),U,10)=3:0,1:$P($G(^(0)),U,10)'=4)!$P($G(^(0)),U,8) S Y="@759";I $P($G(^DGCR(399,DA(1),"RC",DA,0)),U,10)=4 S Y="@7581";S DGRVRCAL=1;D LINKRX^IBCEU5(DA(1),DA);.15;S Y="@759";@7581;
"KRN",.402,2199,"DR",2,399.042,2)
D LINKCPT^IBCEU5(DA(1),DA);@759;
"KRN",.402,2199,"DR",2,399.043)
.01
"KRN",.402,2199,"ROU")
^IBXS7
"KRN",.402,2199,"ROUOLD")
IBXS7
"KRN",.402,2203,-1)
0^8
"KRN",.402,2203,0)
IB SCREEN6^3100920.1659^@^399^^@^3110912
"KRN",.402,2203,"AR",399,120)
1^IBXS67
"KRN",.402,2203,"DIAB",4,0,399,1)
UB-04 TIMEFRAME OF BILL;"TIMEFRAME OF BILL"
"KRN",.402,2203,"DIAB",5,0,399,0)
UB-04 LOCATION OF CARE;"LOCATION OF CARE"
"KRN",.402,2203,"DIAB",7,0,399,0)
UB-04 BILL CLASSIFICATION;"BILL CLASSIFICATION"
"KRN",.402,2203,"DR",1,399)
S:IBDR20'["61" Y="@62";S:$P($G(^DGCR(399,DA,0)),U,19)'=3 Y="@612";@611;S DIE("NO^")="";.24LOCATION OF CARE~;S:'$D(DIE("NO^")) DIE("NO^")="";.25BILL CLASSIFICATION~;
"KRN",.402,2203,"DR",1,399,1)
I '$$TOBIN^IBCU4($P(^DGCR(399,DA,0),U,25),DA) W !!,*7,"  **  The 'BILL CLASSIFICATION' must be consistent with the 'LOCATION OF CARE.'",! S Y="@611";@612;K DIE("NO^");.26TIMEFRAME OF BILL~;
"KRN",.402,2203,"DR",1,399,2)
I '$$INPAT^IBCEF(DA)!($$FT^IBCEF(DA)'=3) S Y="@6121";@6121;.22;243;D DISPTAX^IBCEP81($P($G(^DGCR(399,DA,"U3")),U,2),"Service Facility");.27;S DGRVRCAL=1;S DIPA("FT1")=$P($G(^DGCR(399,DA,0)),U,19);D CKFT^IBCIUT1(IBIFN);@614;.19;
"KRN",.402,2203,"DR",1,399,3)
S DIPA("FT")=$P($G(^DGCR(399,DA,0)),U,19);I $P($G(^IBE(353,+DIPA("FT"),2)),U,2)="P",$P($G(^(2)),U,4) S DIPA("FT1")=DIPA("FT") D CKFT^IBCIUT1(IBIFN) S Y="@615";W !,*7,"Must be a printable national form type";
"KRN",.402,2203,"DR",1,399,4)
.19///^S X=$G(DIPA("FT1"));S Y="@614";@615;D FTPRV^IBCEU5(DA);@62;S:IBDR20'["62" Y="@63";155;S:X=0 Y=156;157;156;S:'$D(IBOX) Y="@63";153;@63;S:IBDR20'["63" Y="@64";151;152;@64;S:IBDR20'["64" Y="@65";161;165;@65;
"KRN",.402,2203,"DR",1,399,5)
S:IBDR20'["65" Y="@66";D RCD^IBCU1;42;202;S:'X Y="@657";203;@657;I $P(^DGCR(399,DA,"U1"),"^",11)']"" S Y="@66";210;@66;@67;S:IBDR20'["67" Y="@68";S:'$D(^DGCR(399,DA,"I1")) Y="@672";218;@672;S:'$D(^DGCR(399,DA,"I2")) Y="@673";219;
"KRN",.402,2203,"DR",1,399,6)
@673;S:'$D(^DGCR(399,DA,"I3")) Y="@68";220;@68;K DIE("NO^");
"KRN",.402,2203,"DR",2,399.042)
.01;.02;.03;.04;.05;.09;.06;I '$P(^DGCR(399,DA(1),"RC",DA,0),U,6) S Y="@658";.07;@658;I +$P(^DGCR(399,DA(1),"RC",DA,0),U,8) S Y="@659";.1;.12;
"KRN",.402,2203,"DR",2,399.042,1)
I $P($G(^DGCR(399,DA(1),"RC",DA,0)),U,10)'=4!'$P(^DGCR(399,DA(1),"RC",DA,0),U,6) S Y="@659";D LINKCPT^IBCEU5(DA(1),DA);@659;
"KRN",.402,2203,"ROU")
^IBXS6
"KRN",.402,2203,"ROUOLD")
IBXS6
"KRN",.402,2633,-1)
0^3
"KRN",.402,2633,0)
IBEDIT INS CO1^3100811.1733^@^36^^@^3110726
"KRN",.402,2633,"DIAB",1,0,36,5)
EDI INST SECONDARY ID(1);"EDI - 1ST Inst Payer Sec. ID"
"KRN",.402,2633,"DIAB",1,0,36,14)
EDI PROF SECONDARY ID(2);"EDI - 2ND Prof Payer Sec. ID"
"KRN",.402,2633,"DIAB",1,0,36,15)
ELECTRONIC INSURANCE TYPE;"EDI - Insurance Type"
"KRN",.402,2633,"DIAB",1,0,36,16)
PRINT MRA 2NDARY CLAIM W/O MRA;"EDI - Print Medicare Sec Claims w/o MRA?"
"KRN",.402,2633,"DIAB",1,0,36,17)
PERF PROV SECOND ID TYPE UB;"Default ID (UB)"
"KRN",.402,2633,"DIAB",1,0,36,18)
ATT/REND ID BILL SEC ID PROF//NO;"Use Att/Rend ID as Billing Provider Sec. ID (1500)?"
"KRN",.402,2633,"DIAB",1,0,36,19)
USE VAMC AS BILL PROV ON UB04//NO;"Always use main VAMC as Billing Provider (UB-04)?"
"KRN",.402,2633,"DIAB",1,0,36,20)
USE BILL PROV VAMC ADDRESS//NO;"Use the Billing Provider (VAMC) Name and Street Address?"
"KRN",.402,2633,"DIAB",1,1,36.03,0)
ALL
"KRN",.402,2633,"DIAB",2,0,36,6)
EDI INST SECONDARY ID QUAL(2);"EDI - 2ND Inst Payer Sec. ID Qualifier"
"KRN",.402,2633,"DIAB",2,0,36,17)
SECONDARY ID REQUIREMENTS;"Require ID on Claim"
"KRN",.402,2633,"DIAB",2,0,36,18)
ATT/REND ID BILL SEC ID INST//NO;"Use Att/Rend ID as Billing Provider Sec. ID (UB)?"
"KRN",.402,2633,"DIAB",2,0,36,21)
ANOTHER CO. PROCESS IP CLAIMS?;T
"KRN",.402,2633,"DIAB",2,0,36,25)
INS COMPANY LINK TYPE;T
"KRN",.402,2633,"DIAB",3,0,36,1)
ANOTHER CO. PROCESS PRECERTS?;T
"KRN",.402,2633,"DIAB",3,0,36,16)
MAX NUMBER TEST BILLS PER DAY;"MAX # TEST BILLS TO TRANSMIT PER DAY"
"KRN",.402,2633,"DIAB",3,0,36,19)
SEND LAB OR FAC IDS FOR VAMC//YES;"Send VA Lab/Facility IDs or Facility Data for VAMC?"
"KRN",.402,2633,"DIAB",4,0,36,17)
REF PROV SEC ID DEF CMS-1500//UPIN;"Default ID (1500)"
"KRN",.402,2633,"DIAB",4,0,36,18)
USE VAMC AS BILL PROV ON 1500//NO;"Always use main VAMC as Billing Provider (1500)?"
"KRN",.402,2633,"DIAB",4,0,36,26)
INS COMPANY LINK PARENT;T
"KRN",.402,2633,"DIAB",5,0,36,3)
EDI INST SECONDARY ID QUAL(1);"EDI - 1ST Inst Payer Sec. ID Qualifier"
"KRN",.402,2633,"DIAB",5,0,36,11)
EDI PROF SECONDARY ID(1);"EDI - 1ST Prof Payer Sec. ID"
"KRN",.402,2633,"DIAB",5,0,36,17)
REF PROV SEC ID REQ ON CLAIMS;"Require ID on Claim"
"KRN",.402,2633,"DIAB",5,0,36,23)
ANOTHER CO. PROCESS APPEALS?;T
"KRN",.402,2633,"DIAB",6,0,36,2)
EDI ID NUMBER - INST;"EDI - Inst Payer Primary ID"
"KRN",.402,2633,"DIAB",6,0,36,12)
EDI PROF SECONDARY ID QUAL(2);"EDI - 2ND Prof Payer Sec. ID Qualifier"
"KRN",.402,2633,"DIAB",7,0,36,7)
EDI INST SECONDARY ID(2);"EDI - 2ND Inst Payer Sec. ID"
"KRN",.402,2633,"DIAB",7,0,36,8)
EDI ID NUMBER - PROF;"EDI - Prof Payer Primary ID"
"KRN",.402,2633,"DIAB",7,0,36,9)
EDI PROF SECONDARY ID QUAL(1);"EDI - 1ST Prof Payer Sec. ID Qualifier"
"KRN",.402,2633,"DIAB",7,0,36,16)
PERF PROV SECOND ID TYPE 1500;"Default ID (1500)"
"KRN",.402,2633,"DIAB",8,0,36,15)
BIN NUMBER;"EDI - Bin Number"
"KRN",.402,2633,"DIAB",9,0,36,15)
PRINT SEC/TERT AUTO CLAIMS?;"EDI - Print Sec/Tert Auto Claims?"
"KRN",.402,2633,"DIAB",11,0,36,1)
TRANSMIT ELECTRONICALLY;"EDI - Transmit?"
"KRN",.402,2633,"DIAB",13,0,36,0)
STANDARD FTF;"STANDARD FILING TIME FRAME"
"KRN",.402,2633,"DIAB",15,0,36,22)
ANOTHER CO. PROCESS RX CLAIMS?;T
"KRN",.402,2633,"DIAB",16,0,36,0)
STANDARD FTF VALUE;"STANDARD FILING TIME FRAME VALUE"
"KRN",.402,2633,"DIAB",22,0,36,21)
ANOTHER CO. PROCESS OP CLAIMS?;T
"KRN",.402,2633,"DIAB",25,0,36,23)
ANOTHER CO. PROCESS INQUIRIES?;T
"KRN",.402,2633,"DR",1,36)
S:",6,"'[IBY Y="@0";.01;@0;S:",0,1,6,12,"'[IBY Y="@10";S:",12,"[IBY Y="@18";2;1;.06;.07;.08;.09;.15;.18STANDARD FILING TIME FRAME~;I 'X S Y="@016";I '$$FTFV^IBCNSU31(X) S Y="@016";.19STANDARD FILING TIME FRAME VALUE~;@016;.12;.13;
"KRN",.402,2633,"DR",1,36,1)
.132;.134;.178T~;S:'X Y="@11";.139;S Y="@16";@11;.133;@16;I '$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@171";3.01EDI - Transmit?~;S DIPA("IBTX")=X;I X=$G(IBEDIKEY(1))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@1721";
"KRN",.402,2633,"DR",1,36,2)
3.01////^S X=$G(IBEDIKEY(1));I $$EDIKEY^IBCNSC();S Y="@171";@1721;I '$G(DIPA("IBTX")) S Y="@17";3.04EDI - Inst Payer Primary ID~;I X=$G(IBEDIKEY(4))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@17211";3.04////^S X=$G(IBEDIKEY(4));
"KRN",.402,2633,"DR",1,36,3)
I $$EDIKEY^IBCNSC();S Y="@171";@17211;I '$G(DIPA("IBTX")) S Y="@17";6.01EDI - 1ST Inst Payer Sec. ID Qualifier~;I X=""&($G(IBEDIKEY(3,6))="")&$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@1722";
"KRN",.402,2633,"DR",1,36,4)
I X=$G(IBEDIKEY(1,6))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@17212";6.01////^S X=$G(IBEDIKEY(1,6));6.02////^S X=$G(IBEDIKEY(2,6));I $$EDIKEY^IBCNSC();S Y="@171";@17212;I '$G(DIPA("IBTX")) S Y="@17";
"KRN",.402,2633,"DR",1,36,5)
6.02EDI - 1ST Inst Payer Sec. ID~;I X=$G(IBEDIKEY(2,6))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@17213";6.02////^S X=$G(IBEDIKEY(2,6));6.01////^S X=$G(IBEDIKEY(1,6));I $$EDIKEY^IBCNSC();S Y="@171";@17213;
"KRN",.402,2633,"DR",1,36,6)
I '$G(DIPA("IBTX")) S Y="@17";6.03EDI - 2ND Inst Payer Sec. ID Qualifier~;I X=""&$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@1722";I X=$G(IBEDIKEY(3,6))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@17214";
"KRN",.402,2633,"DR",1,36,7)
6.03////^S X=$G(IBEDIKEY(3,6));6.04////^S X=$G(IBEDIKEY(4,6));I $$EDIKEY^IBCNSC();S Y="@171";@17214;I '$G(DIPA("IBTX")) S Y="@17";6.04EDI - 2ND Inst Payer Sec. ID~;
"KRN",.402,2633,"DR",1,36,8)
I X=$G(IBEDIKEY(4,6))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@1722";6.04////^S X=$G(IBEDIKEY(4,6));6.03////^S X=$G(IBEDIKEY(3,6));I $$EDIKEY^IBCNSC();S Y="@171";@1722;3.02EDI - Prof Payer Primary ID~;
"KRN",.402,2633,"DR",1,36,9)
I X=$G(IBEDIKEY(2))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@17221";3.02////^S X=$G(IBEDIKEY(2));I $$EDIKEY^IBCNSC();S Y="@171";@17221;I '$G(DIPA("IBTX")) S Y="@17";6.05EDI - 1ST Prof Payer Sec. ID Qualifier~;
"KRN",.402,2633,"DR",1,36,10)
I X=""&($G(IBEDIKEY(7,6))="")&$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@1723";I X=$G(IBEDIKEY(5,6))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@17222";6.05////^S X=$G(IBEDIKEY(5,6));6.06////^S X=$G(IBEDIKEY(6,6));
"KRN",.402,2633,"DR",1,36,11)
I $$EDIKEY^IBCNSC();S Y="@171";@17222;I '$G(DIPA("IBTX")) S Y="@17";6.06EDI - 1ST Prof Payer Sec. ID~;I X=$G(IBEDIKEY(6,6))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@17223";6.06////^S X=$G(IBEDIKEY(6,6));
"KRN",.402,2633,"DR",1,36,12)
6.05////^S X=$G(IBEDIKEY(5,6));I $$EDIKEY^IBCNSC();S Y="@171";@17223;I '$G(DIPA("IBTX")) S Y="@17";6.07EDI - 2ND Prof Payer Sec. ID Qualifier~;I X=""&$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@1723";
"KRN",.402,2633,"DR",1,36,13)
I X=$G(IBEDIKEY(7,6))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@17224";6.07////^S X=$G(IBEDIKEY(7,6));6.08////^S X=$G(IBEDIKEY(8,6));I $$EDIKEY^IBCNSC();S Y="@171";@17224;I '$G(DIPA("IBTX")) S Y="@17";
"KRN",.402,2633,"DR",1,36,14)
6.08EDI - 2ND Prof Payer Sec. ID~;I X=$G(IBEDIKEY(8,6))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@1723";6.08////^S X=$G(IBEDIKEY(8,6));6.07////^S X=$G(IBEDIKEY(7,6));I $$EDIKEY^IBCNSC();S Y="@171";@1723;@17;
"KRN",.402,2633,"DR",1,36,15)
3.09EDI - Insurance Type~;I X=$G(IBEDIKEY(9))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@1724";3.09////^S X=$G(IBEDIKEY(9));I $$EDIKEY^IBCNSC();S Y="@171";@1724;@171;3.03EDI - Bin Number~;6.09EDI - Print Sec/Tert Auto Claims?~;
"KRN",.402,2633,"DR",1,36,16)
6.1EDI - Print Medicare Sec Claims w/o MRA?~;I $G(DIPA("IBTX"))'=2 S Y="@18";3.06MAX # TEST BILLS TO TRANSMIT PER DAY~;@18;S:",6,12,"'[IBY Y="@181";W !!,"Attending/Rendering Provider Secondary ID";4.01Default ID (1500)~;
"KRN",.402,2633,"DR",1,36,17)
4.02Default ID (UB)~;4.03Require ID on Claim~;W !!,"Referring Provider Secondary ID";4.04Default ID (1500)~//UPIN;4.05Require ID on Claim~;W !!,"Billing Provider Secondary IDs";
"KRN",.402,2633,"DR",1,36,18)
4.06Use Att/Rend ID as Billing Provider Sec. ID (1500)?~//NO;4.08Use Att/Rend ID as Billing Provider Sec. ID (UB)?~//NO;W !!,"Billing Provider/Service Facility";4.11Always use main VAMC as Billing Provider (1500)?~//NO;
"KRN",.402,2633,"DR",1,36,19)
4.12Always use main VAMC as Billing Provider (UB-04)?~//NO;N NODE4 S NODE4=$G(^DIC(36,DA,4)) I '$P(NODE4,U,11)&('$P(NODE4,U,12)) S Y="@181";4.07Send VA Lab/Facility IDs or Facility Data for VAMC?~//YES;
"KRN",.402,2633,"DR",1,36,20)
4.13Use the Billing Provider (VAMC) Name and Street Address?~//NO;@181;S:IBY["1" Y="@99";@10;S:",0,2,6,"'[IBY Y="@20";.111;S:X="" Y="@1";.112;S:X="" Y="@1";.113;@1;.114;.115;.116;.131;.119;S:(IBY["0")!(IBY["2") Y="@99";@20;
"KRN",.402,2633,"DR",1,36,21)
S:",3,6,"'[IBY Y="@30";.128T~;S:'X Y="@21";.127;S Y="@26";@21;.121;S:X="" Y="@2";.122;S:X="" Y="@2";.123;@2;.124;.125;.126;.135;.129;@26;S:IBY["3" Y="@99";@30;S:",10,6,"'[IBY Y="@80";.168T~;S:'X Y="@31";.167;S Y="@36";@31;.161;
"KRN",.402,2633,"DR",1,36,22)
S:X="" Y="@5";.162;S:X="" Y="@5";.163;@5;.164;.165;.166;.136;.169;@36;S:IBY["10" Y="@99";@80;S:",11,6,"'[IBY Y="@90";.188T~;S:'X Y="@81";.187;S Y="@86";@81;.181;S:X="" Y="@6";.182;S:X="" Y="@6";.183;@6;.184;.185;.186;.1311;.189;
"KRN",.402,2633,"DR",1,36,23)
@86;S:IBY["11" Y="@99";@90;S:",4,6,"'[IBY Y="@40";.148T~;S:'X Y="@41";.147;S Y="@46";@41;.141;S:X="" Y="@3";.142;S:X="" Y="@3";.143;@3;.144;.145;.146;.137;.149;@46;S:IBY["4" Y="@99";@40;S:",5,6,"'[IBY Y="@55";.158T~;S:'X Y="@51";
"KRN",.402,2633,"DR",1,36,24)
.157;S Y="@56";@51;.151;S:X="" Y="@4";.152;S:X="" Y="@4";.153;@4;.154;.155;.156;.138;.159;@56;S:IBY["5" Y="@99";@55;S:",13,6,"'[IBY Y="@60";I '$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@551";
"KRN",.402,2633,"DR",1,36,25)
I $D(^DIC(36,"APC",+$G(DA))),$P($G(^DIC(36,+$G(DA),3)),U,13)="P" S Y="@551";3.13T~;S DIPA("IBLNK")=X;I X=$G(IBEDIKEY(13))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@552";3.13////^S X=$G(IBEDIKEY(13));I $$EDIKEY^IBCNSC();
"KRN",.402,2633,"DR",1,36,26)
S Y="@551";@552;I $G(DIPA("IBLNK"))'="C" S Y="@551";3.14T~;I X=$G(IBEDIKEY(14))!$$KCHK^XUSRB("IB EDI INSURANCE EDIT") S Y="@553";3.14////^S X=$G(IBEDIKEY(14));I $$EDIKEY^IBCNSC();S Y="@551";@553;D COPY^IBCEPCID(+$G(DA));@551;
"KRN",.402,2633,"DR",1,36,27)
S:IBY=",13," Y="@99";@60;S:",7,6,"'[IBY Y="@50";3.1;@50;S:",8,6,"'[IBY Y="@70";11;S:IBY["8" Y="@99";@70;S:",9,6,"'[IBY Y="@99";10;@99;
"KRN",.402,2633,"DR",2,36.03)
.01
"KRN",.402,2673,-1)
0^5
"KRN",.402,2673,0)
IB SCREEN10^3100901.2016^@^399^^@^3100630
"KRN",.402,2673,"DR",1,399)
S:IBDR20'["101" Y="@102";208;@102;S:IBDR20'["102" Y="@103";@103;S:IBDR20'["103" Y="@104";@104;S:IBDR20'["104" Y="@105";@105;S:IBDR20'["105" Y="@106";207;@106;S:IBDR20'["106" Y="@107";213;@107;S:IBDR20'["107" Y="@108";@108;
"KRN",.402,2673,"DR",1,399,1)
S:IBDR20'["108" Y="@109";163;@109;
"KRN",.402,2673,"ROU")
^IBXSA
"KRN",.402,2673,"ROUOLD")
IBXSA
"KRN",.402,2677,-1)
0^6
"KRN",.402,2677,0)
IB SCREEN102^3101111.1721^@^399^^@^3110308
"KRN",.402,2677,"AR",399,120)
1^IBXSA27
"KRN",.402,2677,"DIAB",1,1,355.93,1)
FACILITY DEFAULT ID NUMBER;"LAB OR FACILITY PRIMARY ID"
"KRN",.402,2677,"DIAB",1,1,399.0222,2)
PERFORMED BY:355.93:
"KRN",.402,2677,"DIAB",1,2,355.9342,0)
ALL
"KRN",.402,2677,"DIAB",1,3,355.9342,0)
ALL
"KRN",.402,2677,"DIAB",4,0,399,0)
FORM LOCATOR 64A;T
"KRN",.402,2677,"DIAB",4,0,399,2)
NON-VA FACILITY:
"KRN",.402,2677,"DIAB",4,1,399.0222,8)
PRIM INS PROVIDER ID TYPE;T;REQ
"KRN",.402,2677,"DIAB",5,1,399.0222,8)
PRIMARY INS CO ID NUMBER;T
"KRN",.402,2677,"DIAB",6,0,399,0)
FORM LOCATOR 64B;T
"KRN",.402,2677,"DIAB",8,0,399,0)
FORM LOCATOR 64C;T
"KRN",.402,2677,"DIAB",8,1,399.0222,8)
SEC INS PROVIDER ID TYPE;T;REQ
"KRN",.402,2677,"DIAB",9,1,399.0222,8)
SECONDARY INS CO ID NUMBER;T
"KRN",.402,2677,"DIAB",9,2,355.93,1)
FACILITY DEFAULT ID NUMBER;"LAB OR FACILITY PRIMARY ID"
"KRN",.402,2677,"DIAB",10,0,399,0)
TREATMENT AUTHORIZATION CODE;"PRIMARY AUTHORIZATION CODE"
"KRN",.402,2677,"DIAB",11,0,399,1)
PPS;T
"KRN",.402,2677,"DIAB",12,1,399.0222,8)
TERT INS PROVIDER ID TYPE;T;REQ
"KRN",.402,2677,"DIAB",13,1,399.0222,8)
TERTIARY INS CO ID NUMBER;T
"KRN",.402,2677,"DR",1,399)
K DIPA S DIPA("I1")=$D(^DGCR(399,DA,"I1")),DIPA("I2")=$D(^("I2")),DIPA("I3")=$D(^("I3"));S:IBDR20'["101" Y="@102";402;453T~;S:'DIPA("I2") Y="@10111";454T~;S:'DIPA("I3") Y="@10111";455T~;@10111;163PRIMARY AUTHORIZATION CODE~;253;
"KRN",.402,2677,"DR",1,399,1)
S:'DIPA("I2") Y="@1011";230;254;S:'DIPA("I3") Y="@1011";231;255;@1011;I '$$INPAT^IBCEF(DA) S Y="@1012";215;S ICDVDT=$$BDATE^IBACSV(DA);170T~;@1012;159;@102;S:IBDR20'["102" Y="@103";@103;S:IBDR20'["103" Y="@104";222;@104;
"KRN",.402,2677,"DR",1,399,2)
S:IBDR20'["104" Y="@105";232;S DIPA("NVA_FC")=X S:DIPA("NVA_FC")="" Y="@1046";^355.93^IBA(355.93,^^S I(0,0)=D0 S Y(1)=$S($D(^DGCR(399,D0,"U2")):^("U2"),1:"") S X=$P(Y(1),U,10),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2677,"DR",1,399,3)
S DIK="^DGCR(399,",DIK(1)="232" D EN1^DIK;K DIK;244;D DISPTAX^IBCEP81($P($G(^DGCR(399,DA,"U3")),U,3),"Non-VA Facility");233;@1046;@105;S:IBDR20'["105" Y="@106";252;
"KRN",.402,2677,"DR",1,399,4)
D DISPTAX^IBCEP81($P($G(^DGCR(399,DA,"U3")),U,11),"Billing Provider");I $P($G(^DGCR(399,DA,"U3")),U,11) N X,Y,DIR S DIR(0)="EA",DIR("A")="Press Return to continue" D ^DIR K DIR;@106;S:IBDR20'["106" Y="@107";
"KRN",.402,2677,"DR",1,399,5)
I $$TEST^IBCEF84(DA) S Y="@1060";I '$P($G(^DGCR(399,DA,"TX")),U,8),'$$TXMT^IBCEF4(DA) S Y="@1061";I $$REQMRA^IBEFUNC(DA) S Y="@10611";27//NO FORCED PRINT;S Y="@1069";@1060;D MESSAGE^IBCEF84;S Y="@1069";@10611;28//NO FORCED PRINT;
"KRN",.402,2677,"DR",1,399,6)
S Y="@1069";@1061;N X,Y,DIR S DIR(0)="EA",DIR("A",1)="NO FIELDS AVAILABLE TO EDIT",DIR("A")="PRESS RETURN TO CONTINUE: " W ! D ^DIR K DIR;@1069;@107;S:IBDR20'["107" Y="@109";@109;
"KRN",.402,2677,"DR",2,355.93)
S DIPA("NVA_FC-0")=$G(^IBA(355.93,+DIPA("NVA_FC"),0)) S:$P(DIPA("NVA_FC-0"),U,5)'=""&($P(DIPA("NVA_FC-0"),U,6)'="")&($P(DIPA("NVA_FC-0"),U,7)'="") Y="@1041";.05;.1;.06;.07;.08;@1041;S:$P(DIPA("NVA_FC-0"),U,9)'="" Y="@1042";
"KRN",.402,2677,"DR",2,355.93,1)
.09LAB OR FACILITY PRIMARY ID~;@1042;S:$P(DIPA("NVA_FC-0"),U,11)'="" Y="@1043";.11;@1043;S:$P(DIPA("NVA_FC-0"),U,14)'="" Y="@1044";D EN2^IBCEP82(+DIPA("NVA_FC"),2);@1044;S:$D(^IBA(355.93,+DIPA("NVA_FC"),"TAXONOMY"))>0 Y="@1045";42;
"KRN",.402,2677,"DR",2,355.93,2)
@1045;
"KRN",.402,2677,"DR",2,399.0222)
.01;S DIPA("RF")=X S:$D(^XUSEC("IB PROVIDER EDIT",DUZ)) DLAYGO=355.93;.02;K DLAYGO S DIPA("PRF")=X S:DIPA("PRF")="" Y="@10399";N Z1 S Z1=$P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,2) S DIPA("NVA_PRV")=$S(Z1["IBA(355.93":+Z1,1:0);
"KRN",.402,2677,"DR",2,399.0222,1)
S:DIPA("NVA_PRV")=0 Y="@1038";
"KRN",.402,2677,"DR",2,399.0222,2)
^355.93^IBA(355.93,^^N DIERR X DR(99,1,9.2) K DIC S DIC="^IBA(355.93,",DIC(0)="MF" D ^DIC S (D,D0,D(0))=+Y S Y(101)=$S($D(^IBA(355.93,D0,0)):^(0),1:"") S X=$P(Y(101),U,1) S D0=I(0,0) S D1=I(1,0) S X=$S(D(0)>0:D(0),1:"");@1038;
"KRN",.402,2677,"DR",2,399.0222,3)
S DIK="^DGCR(399,"_DA(1)_",""PRV"",",DIK(1)=".02" D EN1^DIK K DIK;.15;D DISPTAX^IBCEP81($P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,15),"");
"KRN",.402,2677,"DR",2,399.0222,4)
N Z S Z=$$EXPAND^IBTRE(399.0222,.08,$P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,8)),DIPA("SPC")=$S(Z'="":Z,1:"UNSPECIFIED") W !,"    Prov Specialty On File: ",DIPA("SPC");
"KRN",.402,2677,"DR",2,399.0222,5)
S DIPA("CRD")=$$CRED^IBCEU($P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,2));.03;K DIPA("W1") S:$G(DIPA("CRD"))'=$P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,3) DIPA("W1")=1;I $G(DIPA("W1")) D WRT1^IBCSC10H($G(DIPA("CRD")));K DIPA("W1");
"KRN",.402,2677,"DR",2,399.0222,6)
I '$G(DIPA("I1")) S Y="@10305";D PROVID^IBCEP2B(DA(1),DA,1,.DIPA) S Y=$S(DIPA("EDIT")<0:"@10382",DIPA("EDIT")=1:"@10391",DIPA("EDIT")=2:"@10371",1:"");@10382;I '$G(DIPA("I2")) S Y="@10305";
"KRN",.402,2677,"DR",2,399.0222,7)
D PROVID^IBCEP2B(DA(1),DA,2,.DIPA) S Y=$S(DIPA("EDIT")<0:"@10383",DIPA("EDIT")=1:"@10392",DIPA("EDIT")=2:"@10372",1:"");@10383;I '$G(DIPA("I3")) S Y="@10305";
"KRN",.402,2677,"DR",2,399.0222,8)
D PROVID^IBCEP2B(DA(1),DA,3,.DIPA) S Y=$S(DIPA("EDIT")<0:"@10305",DIPA("EDIT")=1:"@10393",DIPA("EDIT")=2:"@10373",1:"");S Y="@10305";@10391;.12R~T~;.05T~;S Y="@10382";@10392;.13R~T~;.06T~;S Y="@10383";@10393;.14R~T~;.07T~;
"KRN",.402,2677,"DR",2,399.0222,9)
S Y="@10305";@10371;.12////^S X=DIPA("PRIDT");.05////^S X=DIPA("PRID");S Y="@10382";@10372;.13////^S X=DIPA("PRIDT");.06////^S X=DIPA("PRID");S Y="@10383";@10373;.14////^S X=DIPA("PRIDT");.07////^S X=DIPA("PRID");S Y="@10305";
"KRN",.402,2677,"DR",2,399.0222,10)
@10305;@10399;W @IOF;
"KRN",.402,2677,"DR",3,355.93)
S DIPA("NVA_PRV-0")=$G(^IBA(355.93,DIPA("NVA_PRV"),0));S:$P(DIPA("NVA_PRV-0"),U,2)=1 Y="@1032";S:$P(DIPA("NVA_PRV-0"),U,3)'="" Y="@1031";.03;@1031;S:$P(DIPA("NVA_PRV-0"),U,3)'="" Y="@1035";.04;S Y="@1035";@1032;
"KRN",.402,2677,"DR",3,355.93,1)
S:$P(DIPA("NVA_PRV-0"),U,5)'=""&($P(DIPA("NVA_PRV-0"),U,6)'="")&($P(DIPA("NVA_PRV-0"),U,7)'="") Y="@1033";.05;.1;.06;.07;.08;@1033;S:$P(DIPA("NVA_PRV-0"),U,9)'="" Y="@1034";.09LAB OR FACILITY PRIMARY ID~;@1034;
"KRN",.402,2677,"DR",3,355.93,2)
S:$P(DIPA("NVA_PRV-0"),U,11)'="" Y="@1035";.11;@1035;S:$P(DIPA("NVA_PRV-0"),U,14)'="" Y="@1036";D EN2^IBCEP82(DIPA("NVA_PRV"),4);@1036;S:$D(^IBA(355.93,DIPA("NVA_PRV"),"TAXONOMY"))>0 Y="@1037";42;@1037;
"KRN",.402,2677,"DR",3,355.9342)
.01:.03
"KRN",.402,2677,"DR",4,355.9342)
.01:.03
"KRN",.402,2677,"DR",99,1)
N DIERR X DR(99,1,9.2) K DIC S DIC="^IBA(355.93,",DIC(0)="MF" D ^DIC S (D,D0,D(0))=+Y S Y(101)=$S($D(^IBA(355.93,D0,0)):^(0),1:"") S X=$P(Y(101),U,1) S D0=I(0,0) S D1=I(1,0)
"KRN",.402,2677,"DR",99,1,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$$EXTERNAL^DIDU(399.0222,.02,"",$P(Y(1),U,2))
"KRN",.402,2677,"ROU")
^IBXSA2
"KRN",.402,2677,"ROUOLD")
IBXSA2
"KRN",.402,2678,-1)
0^7
"KRN",.402,2678,0)
IB SCREEN10H^3101111.1736^@^399^^@^3110801
"KRN",.402,2678,"AR",399,120)
1^IBXSAH8
"KRN",.402,2678,"DIAB",1,1,355.93,1)
FACILITY DEFAULT ID NUMBER;"LAB OR FACILITY PRIMARY ID"
"KRN",.402,2678,"DIAB",1,1,399.0222,2)
PERFORMED BY:355.93:
"KRN",.402,2678,"DIAB",1,2,355.9342,0)
ALL
"KRN",.402,2678,"DIAB",1,3,355.9342,0)
ALL
"KRN",.402,2678,"DIAB",2,0,399,2)
NON-VA FACILITY:
"KRN",.402,2678,"DIAB",4,0,399,1)
TREATMENT AUTHORIZATION CODE;"PRIMARY AUTHORIZATION CODE"
"KRN",.402,2678,"DIAB",4,1,399.0222,8)
PRIM INS PROVIDER ID TYPE;T;REQ
"KRN",.402,2678,"DIAB",5,1,399.0222,8)
PRIMARY INS CO ID NUMBER;T
"KRN",.402,2678,"DIAB",8,1,399.0222,8)
SEC INS PROVIDER ID TYPE;T;REQ
"KRN",.402,2678,"DIAB",9,1,399.0222,8)
SECONDARY INS CO ID NUMBER;T
"KRN",.402,2678,"DIAB",9,2,355.93,1)
FACILITY DEFAULT ID NUMBER;"LAB OR FACILITY PRIMARY ID"
"KRN",.402,2678,"DIAB",10,0,399,0)
FORM LOCATOR 64A;T
"KRN",.402,2678,"DIAB",12,0,399,0)
FORM LOCATOR 64B;T
"KRN",.402,2678,"DIAB",12,1,399.0222,8)
TERT INS PROVIDER ID TYPE;T;REQ
"KRN",.402,2678,"DIAB",13,1,399.0222,8)
TERTIARY INS CO ID NUMBER;T
"KRN",.402,2678,"DR",1,399)
K DIPA S DIPA("I1")=$D(^DGCR(399,DA,"I1")),DIPA("I2")=$D(^("I2")),DIPA("I3")=$D(^("I3"));S:IBDR20'["101" Y="@102";166;167;@102;S:IBDR20'["102" Y="@103";S:'$$INPAT^IBCEF(DA) Y="@1021";215;@1021;453T~;S:'DIPA("I2") Y="@1025";454T~;
"KRN",.402,2678,"DR",1,399,1)
S:'DIPA("I3") Y="@1025";455;@1025;163PRIMARY AUTHORIZATION CODE~;253;S:'DIPA("I2") Y="@1029";230;254;S:'DIPA("I3") Y="@1029";231;255;@1029;@103;S:IBDR20'["103" Y="@104";222;@104;S:IBDR20'["104" Y="@106";232;
"KRN",.402,2678,"DR",1,399,2)
S DIPA("NVA_FC")=X S:X="" Y="@1046";^355.93^IBA(355.93,^^S I(0,0)=D0 S Y(1)=$S($D(^DGCR(399,D0,"U2")):^("U2"),1:"") S X=$P(Y(1),U,10),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");S DIK="^DGCR(399,",DIK(1)="232" D EN1^DIK;K DIK;244;
"KRN",.402,2678,"DR",1,399,3)
D DISPTAX^IBCEP81($P($G(^DGCR(399,DA,"U3")),U,3),"Non-VA Facility");233;@1046;S DIPA("OLDCLIA")=$P($G(^DGCR(399,DA,"U2")),U,13);235;I X="",$G(DIPA("OLDCLIA"))'="" S IBMDOTCN=1;@1047;I '$$XRAY^IBCEP8A(DA) S Y="@1048";
"KRN",.402,2678,"DR",1,399,4)
D MAMMODP^IBCEP8A(DA);242;@1048;@106;S:IBDR20'["106" Y="@107";459;D ASK19^IBCEU3(DA);236;237;238////^S X=$S($P($G(^DGCR(399,DA,"U2")),U,16)'="":$P($G(^DGCR(399,DA,"U2")),U,16),$$WNRBILL^IBEFUNC(DA):"31",1:"");238;@107;
"KRN",.402,2678,"DR",1,399,5)
S:IBDR20'["107" Y="@108";252;D DISPTAX^IBCEP81($P($G(^DGCR(399,DA,"U3")),U,11),"Billing Provider");I $P($G(^DGCR(399,DA,"U3")),U,11) N X,Y,DIR S DIR(0)="EA",DIR("A")="Press Return to continue" D ^DIR K DIR;@108;
"KRN",.402,2678,"DR",1,399,6)
S:IBDR20'["108" Y="@109";I $$TEST^IBCEF84(DA) S Y="@1080";I '$P($G(^DGCR(399,DA,"TX")),U,8),'$$TXMT^IBCEF4(DA) S Y="@1082";I $$REQMRA^IBEFUNC(DA) S Y="@10811";27//NO FORCED PRINT;S Y="@1082";@1080;D MESSAGE^IBCEF84;S Y="@1082";
"KRN",.402,2678,"DR",1,399,7)
@10811;28//NO FORCED PRINT;@1082;@109;
"KRN",.402,2678,"DR",2,355.93)
S DIPA("NVA_FC-0")=$G(^IBA(355.93,+DIPA("NVA_FC"),0)) S:$P(DIPA("NVA_FC-0"),U,5)'=""&($P(DIPA("NVA_FC-0"),U,6)'="")&($P(DIPA("NVA_FC-0"),U,7)'="") Y="@1041";.05;.1;.06;.07;.08;@1041;S:$P(DIPA("NVA_FC-0"),U,9)'="" Y="@1042";
"KRN",.402,2678,"DR",2,355.93,1)
.09LAB OR FACILITY PRIMARY ID~;@1042;S:$P(DIPA("NVA_FC-0"),U,11)'="" Y="@1043";.11;@1043;S:$P(DIPA("NVA_FC-0"),U,14)'="" Y="@1044";D EN2^IBCEP82(+DIPA("NVA_FC"),2);@1044;S:$D(^IBA(355.93,+DIPA("NVA_FC"),"TAXONOMY"))>0 Y="@1045";42;
"KRN",.402,2678,"DR",2,355.93,2)
@1045;
"KRN",.402,2678,"DR",2,399.0222)
.01;S DIPA("RF")=X S:$D(^XUSEC("IB PROVIDER EDIT",DUZ)) DLAYGO=355.93;.02;K DLAYGO S DIPA("PRF")=X S:X="" Y="@10399";N Z1 S Z1=$P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,2) S DIPA("NVA_PRV")=$S(Z1["IBA(355.93":+Z1,1:0);
"KRN",.402,2678,"DR",2,399.0222,1)
S:DIPA("NVA_PRV")=0 Y="@1038";
"KRN",.402,2678,"DR",2,399.0222,2)
^355.93^IBA(355.93,^^N DIERR X DR(99,1,9.2) K DIC S DIC="^IBA(355.93,",DIC(0)="MF" D ^DIC S (D,D0,D(0))=+Y S Y(101)=$S($D(^IBA(355.93,D0,0)):^(0),1:"") S X=$P(Y(101),U,1) S D0=I(0,0) S D1=I(1,0) S X=$S(D(0)>0:D(0),1:"");@1038;
"KRN",.402,2678,"DR",2,399.0222,3)
S DIK="^DGCR(399,"_DA(1)_",""PRV"",",DIK(1)=".02" D EN1^DIK K DIK;.15;D DISPTAX^IBCEP81($P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,15),"");
"KRN",.402,2678,"DR",2,399.0222,4)
N Z S Z=$$EXPAND^IBTRE(399.0222,.08,$P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,8)),DIPA("SPC")=$S(Z'="":Z,1:"UNSPECIFIED") W !,"    Prov Specialty On File: ",DIPA("SPC");S DIPA("CRD")=$$CRED^IBCEU($P(^DGCR(399,DA(1),"PRV",DA,0),U,2));
"KRN",.402,2678,"DR",2,399.0222,5)
.03;K DIPA("W1") S:$G(DIPA("CRD"))'=$P(^DGCR(399,DA(1),"PRV",DA,0),U,3) DIPA("W1")=1;I $G(DIPA("W1")) D WRT1^IBCSC10H($G(DIPA("CRD")));K DIPA("W1");I '$G(DIPA("I1")) S Y="@10305";
"KRN",.402,2678,"DR",2,399.0222,6)
D PROVID^IBCEP2B(DA(1),DA,1,.DIPA) S Y=$S(DIPA("EDIT")<0:"@10382",DIPA("EDIT")=1:"@10391",DIPA("EDIT")=2:"@10371",1:"");@10382;I '$G(DIPA("I2")) S Y="@10305";
"KRN",.402,2678,"DR",2,399.0222,7)
D PROVID^IBCEP2B(DA(1),DA,2,.DIPA) S Y=$S(DIPA("EDIT")<0:"@10383",DIPA("EDIT")=1:"@10392",DIPA("EDIT")=2:"@10372",1:"");@10383;I '$G(DIPA("I3")) S Y="@10305";
"KRN",.402,2678,"DR",2,399.0222,8)
D PROVID^IBCEP2B(DA(1),DA,3,.DIPA) S Y=$S(DIPA("EDIT")<0:"@10305",DIPA("EDIT")=1:"@10393",DIPA("EDIT")=2:"@10373",1:"");S Y="@10305";@10391;.12R~T~;.05T~;S Y="@10382";@10392;.13R~T~;.06T~;S Y="@10383";@10393;.14R~T~;.07T~;
"KRN",.402,2678,"DR",2,399.0222,9)
S Y="@10305";@10371;.12////^S X=DIPA("PRIDT");.05////^S X=DIPA("PRID");S Y="@10382";@10372;.13////^S X=DIPA("PRIDT");.06////^S X=DIPA("PRID");S Y="@10383";@10373;.14////^S X=DIPA("PRIDT");.07////^S X=DIPA("PRID");S Y="@10305";
"KRN",.402,2678,"DR",2,399.0222,10)
@10305;@10399;W @IOF;
"KRN",.402,2678,"DR",3,355.93)
S DIPA("NVA_PRV-0")=$G(^IBA(355.93,DIPA("NVA_PRV"),0));S:$P(DIPA("NVA_PRV-0"),U,2)=1 Y="@1032";S:$P(DIPA("NVA_PRV-0"),U,3)'="" Y="@1031";.03;@1031;S:$P(DIPA("NVA_PRV-0"),U,3)'="" Y="@1035";.04;S Y="@1035";@1032;
"KRN",.402,2678,"DR",3,355.93,1)
S:$P(DIPA("NVA_PRV-0"),U,5)'=""&($P(DIPA("NVA_PRV-0"),U,6)'="")&($P(DIPA("NVA_PRV-0"),U,7)'="") Y="@1033";.05;.1;.06;.07;.08;@1033;S:$P(DIPA("NVA_PRV-0"),U,9)'="" Y="@1034";.09LAB OR FACILITY PRIMARY ID~;@1034;
"KRN",.402,2678,"DR",3,355.93,2)
S:$P(DIPA("NVA_PRV-0"),U,11)'="" Y="@1035";.11;@1035;S:$P(DIPA("NVA_PRV-0"),U,14)'="" Y="@1036";D EN2^IBCEP82(DIPA("NVA_PRV"),4);@1036;S:$D(^IBA(355.93,DIPA("NVA_PRV"),"TAXONOMY"))>0 Y="@1037";42;@1037;
"KRN",.402,2678,"DR",3,355.9342)
.01:.03
"KRN",.402,2678,"DR",4,355.9342)
.01:.03
"KRN",.402,2678,"DR",99,1)
N DIERR X DR(99,1,9.2) K DIC S DIC="^IBA(355.93,",DIC(0)="MF" D ^DIC S (D,D0,D(0))=+Y S Y(101)=$S($D(^IBA(355.93,D0,0)):^(0),1:"") S X=$P(Y(101),U,1) S D0=I(0,0) S D1=I(1,0)
"KRN",.402,2678,"DR",99,1,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$$EXTERNAL^DIDU(399.0222,.02,"",$P(Y(1),U,2))
"KRN",.402,2678,"ROU")
^IBXSAH
"KRN",.402,2678,"ROUOLD")
IBXSAH
"KRN",.402,2679,-1)
0^4
"KRN",.402,2679,0)
IB SCREEN8^3100902.1721^@^399^^@^3110518
"KRN",.402,2679,"DIAB",1,0,399,2)
SECONDARY SURGICAL PROC CODE;"Secondary Code"
"KRN",.402,2679,"DIAB",2,0,399,1)
AMBULANCE P/U ADDRESS 1;"P/U Address1"
"KRN",.402,2679,"DIAB",2,0,399,3)
ASSUMED CARE DATE;"Assumed Care Date"
"KRN",.402,2679,"DIAB",3,0,399,0)
COB TOTAL NON-COVERED AMOUNT;"COB Non-Covered Charge Amt"
"KRN",.402,2679,"DIAB",3,0,399,1)
AMBULANCE P/U ADDRESS 2;"P/U Address 2"
"KRN",.402,2679,"DIAB",3,0,399,3)
RELINQUISHED CARE DATE;"Relinquished Care Date"
"KRN",.402,2679,"DIAB",4,0,399,1)
AMBULANCE P/U CITY;"P/U City"
"KRN",.402,2679,"DIAB",4,0,399,2)
ATTACHMENT REPORT TYPE;"Report Type"
"KRN",.402,2679,"DIAB",5,0,399,1)
AMBULANCE P/U STATE;"P/U State"
"KRN",.402,2679,"DIAB",5,0,399,2)
ATTACHMENT REPORT TRANS CODE;"Transmission Method"
"KRN",.402,2679,"DIAB",6,0,399,0)
PROPERTY/CASUALTY CLAIM NUMBER;"Claim Number"
"KRN",.402,2679,"DIAB",6,0,399,1)
AMBULANCE P/U ZIP;"P/U Zip"
"KRN",.402,2679,"DIAB",6,0,399,2)
ATTACHMENT CONTROL NUMBER;"Attachment Control #"
"KRN",.402,2679,"DIAB",7,0,399,1)
AMBULANCE D/O LOCATION;"D/O Location"
"KRN",.402,2679,"DIAB",8,0,399,0)
PROP/CAS DATE OF 1ST CONTACT;"Date of 1st Contact"
"KRN",.402,2679,"DIAB",8,0,399,1)
AMBULANCE D/O ADDRESS 1;"D/O Address1"
"KRN",.402,2679,"DIAB",9,0,399,0)
PROPERTY/CASUALTY CONTACT NAME;"Contact Name"
"KRN",.402,2679,"DIAB",9,0,399,1)
AMBULANCE D/O ADDRESS 2;"D/O Address2"
"KRN",.402,2679,"DIAB",9,0,399,2)
DISABILITY START DATE;"Disability Start Date"
"KRN",.402,2679,"DIAB",10,0,399,0)
PROP/CAS COMMUNICATION NUMBER;"Contact Phone"
"KRN",.402,2679,"DIAB",10,0,399,1)
AMBULANCE D/O CITY;"D/O City"
"KRN",.402,2679,"DIAB",10,0,399,2)
DISABILITY END DATE;"Disability End Date"
"KRN",.402,2679,"DIAB",11,0,399,0)
PROP/CAS EXTENSION NUMBER;"Contact Phone Extension"
"KRN",.402,2679,"DIAB",11,0,399,1)
AMBULANCE D/O STATE;"D/O State"
"KRN",.402,2679,"DIAB",12,0,399,1)
AMBULANCE D/O ZIP;"D/O Zip"
"KRN",.402,2679,"DIAB",15,0,399,1)
PRIMARY SURGICAL PROC CODE;"Primary Code"
"KRN",.402,2679,"DR",1,399)
@81;S:IBDR20'["81" Y="@82";260COB Non-Covered Charge Amt~;@82;S:IBDR20'["82" Y="@83";261Claim Number~;S:IBT=3 Y="@85";262Date of 1st Contact~;268Contact Name~;269Contact Phone~;269.1Contact Phone Extension~;@83;
"KRN",.402,2679,"DR",1,399,1)
S:IBDR20'["83" Y="@84";271P/U Address1~;272P/U Address 2~;273P/U City~;274P/U State~;275P/U Zip~;276D/O Location~;277D/O Address1~;278D/O Address2~;279D/O City~;280D/O State~;281D/O Zip~;@84;S:IBDR20'["84" Y="@85";266Primary Code~;
"KRN",.402,2679,"DR",1,399,2)
267Secondary Code~;@85;S:IBDR20'["85" Y="@86";285Report Type~;286Transmission Method~;284Attachment Control #~;@86;S:IBDR20'["86" Y="@87";263Disability Start Date~;264Disability End Date~;@87;S:IBDR20'["87" Y="@899";
"KRN",.402,2679,"DR",1,399,3)
S:$P($G(^DGCR(IBIFN,0)),U,19)=3 Y="@899";282Assumed Care Date~;283Relinquished Care Date~;@899;
"KRN",.402,2679,"ROU")
^IBXS8
"KRN",.402,2679,"ROUOLD")
IBXS8
"KRN",.402,2694,-1)
1^1
"KRN",.402,2694,0)
IB SCREEN82    FILE #399
"KRN",.402,2695,-1)
1^2
"KRN",.402,2695,0)
IB SCREEN8H    FILE #399
"KRN",19,3372,-1)
2^5
"KRN",19,3372,0)
IB THIRD PARTY BILLING MENU^Third Party Billing Menu^^M^2441^^^^^^^200
"KRN",19,3372,10,0)
^19.01IP^21^21
"KRN",19,3372,10,20,0)
13175^CPST
"KRN",19,3372,10,20,"^")
IB COPY SECOND/THIRD
"KRN",19,3372,"U")
THIRD PARTY BILLING MENU
"KRN",19,6409,-1)
2^2
"KRN",19,6409,0)
IBCE 837 EDI MENU^EDI Menu For Electronic Bills^^M^101001^^^^^^^200
"KRN",19,6409,10,0)
^19.01IP^21^21
"KRN",19,6409,10,20,0)
13174^CBW^90
"KRN",19,6409,10,20,"^")
IBCE COB MANAGEMENT
"KRN",19,6409,10,21,0)
13223^PEB^95
"KRN",19,6409,10,21,"^")
IBCE PRINT EOB
"KRN",19,6409,"U")
EDI MENU FOR ELECTRONIC BILLS
"KRN",19,13174,-1)
0^1
"KRN",19,13174,0)
IBCE COB MANAGEMENT^COB Management Worklist^^R^^^^^^^^INTEGRATED BILLING^^1^1
"KRN",19,13174,1,0)
^19.06^3^3^3110902^^^^
"KRN",19,13174,1,1,0)
This will be a list manager screen with the option available to print an
"KRN",19,13174,1,2,0)
associated report. Using the screen, billing staff will be able to follow
"KRN",19,13174,1,3,0)
up on bills for secondary and tertiary billing for non-MRA bills.
"KRN",19,13174,15)
K IBMRANOT
"KRN",19,13174,20)
S IBMRANOT=1
"KRN",19,13174,25)
EN^IBCECOB
"KRN",19,13174,"U")
COB MANAGEMENT WORKLIST
"KRN",19,13175,-1)
0^3
"KRN",19,13175,0)
IB COPY SECOND/THIRD^Copy for Secondary/Tertiary Bill^^R^^^^^^^^INTEGRATED BILLING
"KRN",19,13175,1,0)
^19.06^4^4^3110819^^^
"KRN",19,13175,1,1,0)
This option is used to create Secondary and Tertiary bills.  
"KRN",19,13175,1,2,0)
The Primary bill is copied to create the bill to the Secondary payer.  The 
"KRN",19,13175,1,3,0)
Secondary bill is copied to create the bill to the Tertiary payer.  The bill
"KRN",19,13175,1,4,0)
being copied is not cancelled.  
"KRN",19,13175,25)
IBCCCB
"KRN",19,13175,"U")
COPY FOR SECONDARY/TERTIARY BI
"KRN",19,13223,-1)
0^4
"KRN",19,13223,0)
IBCE PRINT EOB^Print EOB^^R^^^^^^^^
"KRN",19,13223,1,0)
^19.06^1^1^3110818^^^^
"KRN",19,13223,1,1,0)
Print EOB.
"KRN",19,13223,25)
PRINTOPT^IBCAPR2
"KRN",19,13223,"U")
PRINT EOB
"KRN",101,1793,-1)
4^13
"KRN",101,1793,0)
IBCEM CLONE BILL
"KRN",101,2975,-1)
4^10
"KRN",101,2975,0)
IBCEM COPY SECOND/THIRD
"KRN",101,2978,-1)
4^17
"KRN",101,2978,0)
IBCEM COB CANCEL
"KRN",101,2981,-1)
4^12
"KRN",101,2981,0)
IBCEM COB EDIT BILL
"KRN",101,2983,-1)
4^9
"KRN",101,2983,0)
IBCEM COB EXIT
"KRN",101,3012,-1)
4^11
"KRN",101,3012,0)
IBCE EOB VIEW
"KRN",101,3797,-1)
4^14
"KRN",101,3797,0)
IBCEM COB TPJI
"KRN",101,4553,-1)
4^16
"KRN",101,4553,0)
IBCEM VIEW COMMENTS
"KRN",101,4555,-1)
4^15
"KRN",101,4555,0)
IBCEM MRA STATUS
"KRN",101,4694,-1)
0^1
"KRN",101,4694,0)
IBCEM COB MANAGEMENT 2^^^M^^^^^^^^INTEGRATED BILLING
"KRN",101,4694,1,0)
^101.06^2^2^3101015^^^^
"KRN",101,4694,1,1,0)
This is the main menu that contains the actions that can be performed to
"KRN",101,4694,1,2,0)
follow up on bills for secondary and tertiary billing.
"KRN",101,4694,4)
26^4
"KRN",101,4694,10,0)
^101.01PA^16^12
"KRN",101,4694,10,2,0)
2983^EX^100^
"KRN",101,4694,10,2,"^")
IBCEM COB EXIT
"KRN",101,4694,10,3,0)
2975^PC^10^
"KRN",101,4694,10,3,"^")
IBCEM COPY SECOND/THIRD
"KRN",101,4694,10,4,0)
3012^VE^20^
"KRN",101,4694,10,4,"^")
IBCE EOB VIEW
"KRN",101,4694,10,6,0)
4705^PE^70^^^Print EOB/MRA
"KRN",101,4694,10,6,"^")
IBCAPR2 MAIN ENTRY
"KRN",101,4694,10,7,0)
2981^VB^60^^^View Bill
"KRN",101,4694,10,7,"^")
IBCEM COB EDIT BILL
"KRN",101,4694,10,8,0)
1793^CC^50^
"KRN",101,4694,10,8,"^")
IBCEM CLONE BILL
"KRN",101,4694,10,9,0)
3797^TP^80^
"KRN",101,4694,10,9,"^")
IBCEM COB TPJI
"KRN",101,4694,10,12,0)
4555^RS^35^
"KRN",101,4694,10,12,"^")
IBCEM MRA STATUS
"KRN",101,4694,10,13,0)
4553^EC^33^^^Enter/View Comments
"KRN",101,4694,10,13,"^")
IBCEM VIEW COMMENTS
"KRN",101,4694,10,14,0)
4712^RM^65^^^Remove from Worklist
"KRN",101,4694,10,14,"^")
IBCEM REMOVE FROM WORKLIST
"KRN",101,4694,10,15,0)
2978^CB^40^
"KRN",101,4694,10,15,"^")
IBCEM COB CANCEL
"KRN",101,4694,10,16,0)
4711^CR^45^
"KRN",101,4694,10,16,"^")
IBCEM CORRECT REJECTED/DENIED BILL
"KRN",101,4694,15)
I $G(IBFASTXT) S VALMBCK="Q"
"KRN",101,4694,20)
K IBFASTXT
"KRN",101,4694,26)
D SHOW^VALM
"KRN",101,4694,28)
Select Action: 
"KRN",101,4694,29)

"KRN",101,4694,99)
62213,62445
"KRN",101,4695,-1)
0^5
"KRN",101,4695,0)
IBCAPR PRINTF^PRINT EOB^^A^^^^^^^^
"KRN",101,4695,4)
40^4^^PR
"KRN",101,4695,20)
D PRTOPT1^IBCAPR
"KRN",101,4695,99)
61990,59752
"KRN",101,4696,-1)
0^2
"KRN",101,4696,0)
IBCAPR MENU^EOB / MRA MENU^^M^^^^^^^^
"KRN",101,4696,4)
40^5^^IBCAPR_MENU
"KRN",101,4696,10,0)
^101.01PA^4^4
"KRN",101,4696,10,1,0)
4695^PR^1^^^EOB PRINT
"KRN",101,4696,10,1,"^")
IBCAPR PRINTF
"KRN",101,4696,10,2,0)
4697^PD^2^^^EOB PRINT DEFAULT
"KRN",101,4696,10,2,"^")
IBCAPR PRINTFD
"KRN",101,4696,10,3,0)
4703^MP^3^^^EOB/MRA PRINT
"KRN",101,4696,10,3,"^")
IBCAPR PRINT MAR
"KRN",101,4696,10,4,0)
4704^MD^4^^^EOB/MRA PRINT DEFAULT
"KRN",101,4696,10,4,"^")
IBCAPR PRINT MAR DEFAULT
"KRN",101,4696,26)
D SHOW^VALM
"KRN",101,4696,99)
61993,35307
"KRN",101,4697,-1)
0^6
"KRN",101,4697,0)
IBCAPR PRINTFD^PRINT EOB TO DEFAULT DEVICE^^A^^^^^^^^
"KRN",101,4697,4)
40^4^^PRD
"KRN",101,4697,20)
D PRTOPT2^IBCAPR
"KRN",101,4697,99)
61990,59917
"KRN",101,4703,-1)
0^3
"KRN",101,4703,0)
IBCAPR PRINT MAR^PRINT EOB/MAR^^A^^^^^^^^
"KRN",101,4703,4)
40^4^^MAR PRT
"KRN",101,4703,20)
D PRTOPT3^IBCAPR
"KRN",101,4703,99)
61993,34471
"KRN",101,4704,-1)
0^4
"KRN",101,4704,0)
IBCAPR PRINT MAR DEFAULT^PRINT EOB/MAR TO DEFAULT DEVICE^^A^^^^^^^^
"KRN",101,4704,4)
40^4^^PRINT MAR DEFAULT
"KRN",101,4704,20)
D PRTOPT4^IBCAPR
"KRN",101,4704,99)
61993,34739
"KRN",101,4705,-1)
0^19
"KRN",101,4705,0)
IBCAPR2 MAIN ENTRY^ACTION ITEM CALL TO IBCAPR2^^A^^^^^^^^
"KRN",101,4705,4)
26^2^^IBCAPR MAIN ENTRY
"KRN",101,4705,15)
S VALMBCK="R"
"KRN",101,4705,20)
D EN^IBCAPR2
"KRN",101,4705,99)
62095,58154
"KRN",101,4711,-1)
4^18
"KRN",101,4711,0)
IBCEM CORRECT REJECTED/DENIED BILL
"KRN",101,4712,-1)
0^8
"KRN",101,4712,0)
IBCEM REMOVE FROM WORKLIST^Remove From Worklist^^A^^^^^^^^INTEGRATED BILLING
"KRN",101,4712,20)
D WLRMV^IBCECOB1
"KRN",101,4712,99)
62005,66810
"KRN",409.61,823,-1)
0^1
"KRN",409.61,823,0)
IBCEM COB MANAGEMENT^1^^80^4^18^1^1^COB^IBCEM COB MANAGEMENT 2^COB Management WorkList^1^^1
"KRN",409.61,823,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,823,"ARRAY")
 ^TMP("IBCECOB",$J)
"KRN",409.61,823,"COL",0)
^409.621^14^7
"KRN",409.61,823,"COL",1,0)
BILL^5^12^Bill #^^
"KRN",409.61,823,"COL",2,0)
SERVICE^18^8^Svc Date^^
"KRN",409.61,823,"COL",9,0)
NUMBER^1^4^^^
"KRN",409.61,823,"COL",10,0)
PATNM^27^23^Patient Name        SSN
"KRN",409.61,823,"COL",12,0)
BTYPE^72^9^Care/Form
"KRN",409.61,823,"COL",13,0)
PTRESP^51^9^  Pt Resp
"KRN",409.61,823,"COL",14,0)
IBAMT^61^9^ Bill Amt
"KRN",409.61,823,"COL","B","BILL",1)

"KRN",409.61,823,"COL","B","BTYPE",12)

"KRN",409.61,823,"COL","B","IBAMT",14)

"KRN",409.61,823,"COL","B","NUMBER",9)

"KRN",409.61,823,"COL","B","PATNM",10)

"KRN",409.61,823,"COL","B","PTRESP",13)

"KRN",409.61,823,"COL","B","SERVICE",2)

"KRN",409.61,823,"EXP")
D EXP^IBCECOB
"KRN",409.61,823,"FNL")
D EXIT^IBCECOB
"KRN",409.61,823,"HDR")
D HDR^IBCECOB
"KRN",409.61,823,"HLP")
D HELP^IBCECOB
"KRN",409.61,823,"INIT")
D INIT^IBCECOB
"KRN",409.61,831,-1)
0^2
"KRN",409.61,831,0)
IBCAPR^1^^80^5^20^0^1^^IBCAPR MENU^IBCAPR^1^^1
"KRN",409.61,831,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,831,"ARRAY")
 ^TMP("IBCAPR",$J)
"KRN",409.61,831,"FNL")
D EXIT^IBCAPR
"KRN",409.61,831,"HDR")
D HDR^IBCAPR
"KRN",409.61,831,"HLP")
D HELP^IBCAPR
"KRN",409.61,831,"INIT")
D INIT^IBCAPR
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PGL",364.6,0,3,.03)
ASSOCIATED FORM DEFINITION^P364.6'^IBA(364.6,^0;3^Q
"PGL",364.7,0,5,.05)
INSURANCE COMPANY^P36'^DIC(36,^0;5^Q
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
432^3110916
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
100
"RTN","IBCAPP")
0^73^B19459268^n/a
"RTN","IBCAPP",1,0)
IBCAPP ;ALB/WCJ - Claims Auto Processing Main Processer;27-AUG-10
"RTN","IBCAPP",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCAPP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCAPP",4,0)
 G AWAY
"RTN","IBCAPP",5,0)
AWAY Q
"RTN","IBCAPP",6,0)
 ;
"RTN","IBCAPP",7,0)
EN(IBIFN,IBORIG,IBPYMT,IBWLF) ;
"RTN","IBCAPP",8,0)
 ; This is called from tag BULL^IBCNSBL2.  It is the starting point for the claims auto-processing.
"RTN","IBCAPP",9,0)
 ; Instead of sending a bulletin which started a manual process, the bulletin routine calls this routine
"RTN","IBCAPP",10,0)
 ; which will evaluate the claim and perform one of three actions.
"RTN","IBCAPP",11,0)
 ; 1) auto-process the claim to a subsequent payer.
"RTN","IBCAPP",12,0)
 ; 2) auto-print a claim in case the payer does not want to receive secondary/tertiary claims electronically
"RTN","IBCAPP",13,0)
 ; 3) put the claim on the new COB Management work list.
"RTN","IBCAPP",14,0)
 ;
"RTN","IBCAPP",15,0)
 ;   Input:    IBIFN  --  Pointer to AR (file #430), or Claim (file #399) (same internal number goes to files)
"RTN","IBCAPP",16,0)
 ;            IBORIG  --  Original amount of the claim
"RTN","IBCAPP",17,0)
 ;            IBPYMT  --  Total Amount paid on the claim
"RTN","IBCAPP",18,0)
 ;             IBWLF  --  1 if it should go straight to the work list or 
"RTN","IBCAPP",19,0)
 ;                        0 if it should be evaluated.
"RTN","IBCAPP",20,0)
 ;
"RTN","IBCAPP",21,0)
 N IBREASON,IBX,IBMRANOT,IBERRMSG,IBEOB,IBINS,Z,IB,IBF,IBFT,IBNCN,IBDV,IBREG,IBNCN
"RTN","IBCAPP",22,0)
 S IBMRANOT=1
"RTN","IBCAPP",23,0)
 ;
"RTN","IBCAPP",24,0)
 ; A specific non-human user for all reg 835 EOB filing processes.
"RTN","IBCAPP",25,0)
 ; Change the DUZ to be this user.
"RTN","IBCAPP",26,0)
 ; *** Integration Agreement 4129 - Activated on 30-June-2003 ***
"RTN","IBCAPP",27,0)
 S IBREG=$$IBREG()
"RTN","IBCAPP",28,0)
 I IBREG>0 NEW DUZ D DUZ^XUP(IBREG)  ; IA#4129
"RTN","IBCAPP",29,0)
 ;
"RTN","IBCAPP",30,0)
 ; Check if this is being forced to the work list.  
"RTN","IBCAPP",31,0)
 I $G(IBWLF) S IBREASON="IB813:CHAMPVA Center or TRICARE Fiscal Intermediary or TRICARE Supplemental policy." D PUTONWL(IBIFN,IBREASON) G ENX   ;IB*2*432
"RTN","IBCAPP",32,0)
 ;
"RTN","IBCAPP",33,0)
 I IBPYMT'<IBORIG D WLCK^IBCNSBL2(IBIFN) Q  ; no reason to continue if nothing else owed
"RTN","IBCAPP",34,0)
 ;
"RTN","IBCAPP",35,0)
 ; Make sure there is another payer
"RTN","IBCAPP",36,0)
 I '$P($G(^DGCR(399,IBIFN,"I"_($$COBN^IBCEF(IBIFN)+1))),U,1) D WLCK^IBCNSBL2(IBIFN) G ENX   ;IB*2*432
"RTN","IBCAPP",37,0)
 ;
"RTN","IBCAPP",38,0)
 ; stop if the subsequent claim was already created
"RTN","IBCAPP",39,0)
 I +$P($G(^DGCR(399,IBIFN,"M1")),U,$$COBN^IBCEF(IBIFN)+5) D WLCK^IBCNSBL2(IBIFN) G ENX ;IB*2*432
"RTN","IBCAPP",40,0)
 ;
"RTN","IBCAPP",41,0)
 ; stop if the subsequent payer is Medicare.  If there is a non-Medicare tertiary payer, force to worklist
"RTN","IBCAPP",42,0)
 I $$WNRBILL^IBEFUNC(IBIFN,$$COBN^IBCEF(IBIFN)+1) D  Q
"RTN","IBCAPP",43,0)
 .I $D(^DGCR(399,IBIFN,"I3")),'$$WNRBILL^IBEFUNC(IBIFN,3) D PUTONWL(IBIFN,"IB814") Q 
"RTN","IBCAPP",44,0)
 .D WLCK^IBCNSBL2(IBIFN) Q
"RTN","IBCAPP",45,0)
 ;
"RTN","IBCAPP",46,0)
 ; check the Commercial Auto Processing criteria
"RTN","IBCAPP",47,0)
 S IBX=$$CRIT^IBCAPP1(IBIFN,.IBEOB)
"RTN","IBCAPP",48,0)
 ; 
"RTN","IBCAPP",49,0)
 ; If it fails the criteria check, put it on the work list
"RTN","IBCAPP",50,0)
 I '+IBX D PUTONWL(IBIFN,$P(IBX,U,2)) G ENX   ;IB*2*432
"RTN","IBCAPP",51,0)
 ;
"RTN","IBCAPP",52,0)
 ; Auto Process this bad boy
"RTN","IBCAPP",53,0)
 ;
"RTN","IBCAPP",54,0)
 ; first check that if it's supposed to be printed locally, the printers are defined.
"RTN","IBCAPP",55,0)
 ; if not, put on the work list
"RTN","IBCAPP",56,0)
 ; if they are, then fall through 
"RTN","IBCAPP",57,0)
 S Z=$$COBN^IBCEF(IBIFN)+1
"RTN","IBCAPP",58,0)
 S IBINS=$$POLICY^IBCEF(IBIFN,1,Z)
"RTN","IBCAPP",59,0)
 S IBWLF=0
"RTN","IBCAPP",60,0)
 I $P($G(^DIC(36,IBINS,6)),U,9)=1 D  I IBWLF D PUTONWL(IBIFN,IBREASON) G ENX   ;IB*2*432
"RTN","IBCAPP",61,0)
 .I $$EOBPRT^IBCAPR()="" S IBWLF=1,IBREASON="IB811:Auto-printer not defined in IB Site Parameters" Q
"RTN","IBCAPP",62,0)
 .I $$MRAPRT^IBCAPR()="" S IBWLF=1,IBREASON="IB811:Auto-printer not defined in IB Site Parameters" Q
"RTN","IBCAPP",63,0)
 .S IB=$$FT^IBCU3(IBIFN) ; form type ien (2 or 3)
"RTN","IBCAPP",64,0)
 .I "^2^3^"'[(U_IB_U) S IBWLF=1,IBREASON="IB810:No Form Type defined" Q
"RTN","IBCAPP",65,0)
 .S IBFT=$$FTN^IBCU3(IB) ; form type name
"RTN","IBCAPP",66,0)
 .S IBF=$P($G(^IBE(353,+IB,2)),U,8)
"RTN","IBCAPP",67,0)
 .S:IBF="" IBF=IB ;Forces the use of the output formatter to print bills
"RTN","IBCAPP",68,0)
 .; get default CMS or UB printer (based on claim form type)
"RTN","IBCAPP",69,0)
 .S IBDV=$S(IB=2:$$CMS1500^IBCAPR1(),1:$$UB4PRT^IBCAPR1())
"RTN","IBCAPP",70,0)
 .I IBDV="" S IBWLF=1,IBREASON="IB811:Auto-printer not defined in IB Site Parameters" Q
"RTN","IBCAPP",71,0)
 I $G(IBREASON)]"" D PUTONWL(IBIFN,IBREASON) G ENX   ;IB*2*432
"RTN","IBCAPP",72,0)
 ;
"RTN","IBCAPP",73,0)
 ; create the new claim
"RTN","IBCAPP",74,0)
 S IBNCN=""   ; Initialize New Claim Number
"RTN","IBCAPP",75,0)
 D AUTOCOB^IBCEMQA(IBIFN,IBEOB,.IBERRMSG,IBMRANOT,.IBNCN)
"RTN","IBCAPP",76,0)
 ;
"RTN","IBCAPP",77,0)
 ; make sure everything was cool with creating the new claim.
"RTN","IBCAPP",78,0)
 I $G(IBERRMSG)]""!('+$G(IBNCN)) S IBREASON="IB812:Failed AUTOCOB Generation" D PUTONWL(IBIFN,IBREASON) G ENX   ;IB*2*432
"RTN","IBCAPP",79,0)
 ;
"RTN","IBCAPP",80,0)
 ; If it's to be auto printed, set force to local print flag on new claim 
"RTN","IBCAPP",81,0)
 S IBINS=$$POLICY^IBCEF(IBNCN,1,$$COBN^IBCEF(IBNCN))
"RTN","IBCAPP",82,0)
 I $P($G(^DIC(36,IBINS,6)),U,9)=1 D FORCEPRT(IBNCN)
"RTN","IBCAPP",83,0)
 ;
"RTN","IBCAPP",84,0)
 ; authorize the new claim
"RTN","IBCAPP",85,0)
 D AUTH^IBCEMQA(IBNCN,.IBERRMSG,IBMRANOT)
"RTN","IBCAPP",86,0)
 ;
"RTN","IBCAPP",87,0)
 ; If AUTH error occurred, file the automatic bill generation failure message
"RTN","IBCAPP",88,0)
 I $G(IBERRMSG)]"" D AUTOMSG^IBCESRV3(IBEOB,IBERRMSG) G ENX
"RTN","IBCAPP",89,0)
 ;
"RTN","IBCAPP",90,0)
 ; If local print, then print it
"RTN","IBCAPP",91,0)
 I $P($G(^DIC(36,IBINS,6)),U,9)=1 D STFLP^IBCAPR1(IBNCN)
"RTN","IBCAPP",92,0)
 ;
"RTN","IBCAPP",93,0)
ENX   ;Quit and Cleanup of Main Entry Point, added with IB*2*432
"RTN","IBCAPP",94,0)
 ;
"RTN","IBCAPP",95,0)
 ; DBIA #10111: Allows FM read access of ^XMB(3.8,D0,0) using DIC.
"RTN","IBCAPP",96,0)
 S DIC="^XMB(3.8,",DIC(0)="QM",X="IB DEV TEAM" D ^DIC
"RTN","IBCAPP",97,0)
 ;
"RTN","IBCAPP",98,0)
 Q
"RTN","IBCAPP",99,0)
 ;
"RTN","IBCAPP",100,0)
PUTONWL(IBIFN,IBREASON) ; Put a claim on the worklist
"RTN","IBCAPP",101,0)
 ; IBIFN - internal claim number
"RTN","IBCAPP",102,0)
 ; IBREASON - reason why this is being put on the worklist (error code:text)
"RTN","IBCAPP",103,0)
 ;
"RTN","IBCAPP",104,0)
 N DA,DIE,DR
"RTN","IBCAPP",105,0)
 S DA=IBIFN
"RTN","IBCAPP",106,0)
 S DIE="^DGCR(399,"
"RTN","IBCAPP",107,0)
 S DR="35///1"              ; place on the worklist
"RTN","IBCAPP",108,0)
 S DR=DR_";"_"36///"_$P(IBREASON,":")        ; why placed on worklist
"RTN","IBCAPP",109,0)
 D ^DIE
"RTN","IBCAPP",110,0)
 Q
"RTN","IBCAPP",111,0)
 ;
"RTN","IBCAPP",112,0)
FORCEPRT(IBIFN) ; set force to local print flag in claim
"RTN","IBCAPP",113,0)
 ; IBIFN - internal claim number 
"RTN","IBCAPP",114,0)
 ;
"RTN","IBCAPP",115,0)
 N DA,DIE,DR
"RTN","IBCAPP",116,0)
 S DA=IBIFN
"RTN","IBCAPP",117,0)
 S DIE="^DGCR(399,"
"RTN","IBCAPP",118,0)
 S DR="27///1"      ; Force Local Print
"RTN","IBCAPP",119,0)
 D ^DIE
"RTN","IBCAPP",120,0)
 Q
"RTN","IBCAPP",121,0)
 ;
"RTN","IBCAPP",122,0)
IBREG() ; Returns IEN (Internal Entry Number) from file #200 for
"RTN","IBCAPP",123,0)
 ; the Bill Authorizer of acceptable regular (non MRA) secondary claims,
"RTN","IBCAPP",124,0)
 ; namely, AUTHORIZER,IB REG
"RTN","IBCAPP",125,0)
 ;
"RTN","IBCAPP",126,0)
 ; Output:    -1   if record not on file
"RTN","IBCAPP",127,0)
 ;            IEN  if record is on file
"RTN","IBCAPP",128,0)
 ;
"RTN","IBCAPP",129,0)
 N DIC,X,Y
"RTN","IBCAPP",130,0)
 S DIC(0)="MO",DIC="^VA(200,",X="AUTHORIZER,IB REG"
"RTN","IBCAPP",131,0)
 ; call FM lookup utility
"RTN","IBCAPP",132,0)
 D ^DIC
"RTN","IBCAPP",133,0)
 ; if record is already on file, return IEN
"RTN","IBCAPP",134,0)
 ; else  return -1
"RTN","IBCAPP",135,0)
 Q +Y
"RTN","IBCAPP1")
0^65^B37999170^n/a
"RTN","IBCAPP1",1,0)
IBCAPP1 ;ALB/WCJ - Claims Auto Processing Utilities;27-AUG-10
"RTN","IBCAPP1",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCAPP1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCAPP1",4,0)
 G AWAY
"RTN","IBCAPP1",5,0)
AWAY Q
"RTN","IBCAPP1",6,0)
 ;
"RTN","IBCAPP1",7,0)
 ; Borrowed heavily from the Medicare auto processing 
"RTN","IBCAPP1",8,0)
CRIT(IBIFN,IBEOB) ; Function to determine if a claim meets the criteria for auto-authorization and
"RTN","IBCAPP1",9,0)
 ; secondary/tertiary claim submission for NON MEDICARE claims
"RTN","IBCAPP1",10,0)
 ;
"RTN","IBCAPP1",11,0)
 ; Input:  IBIFN - internal entry number for an entry in 399
"RTN","IBCAPP1",12,0)
 ;         IBEOB - by reference to it can be returned
"RTN","IBCAPP1",13,0)
 ; Output:  This function returns a pieced string
"RTN","IBCAPP1",14,0)
 ;          [1] 0 or 1, EOB meets criteria
"RTN","IBCAPP1",15,0)
 ;          [2] error message if the first piece is 0
"RTN","IBCAPP1",16,0)
 ;
"RTN","IBCAPP1",17,0)
 ; The IB system shall automatically generate a non-Medicare secondary/tertiary claim to the next payer on
"RTN","IBCAPP1",18,0)
 ; the claim when all services lines on the previous EOB(s) meet the following criteria:
"RTN","IBCAPP1",19,0)
 ;
"RTN","IBCAPP1",20,0)
 ; Adjustment group code of CO is associated with one of the following reason codes:
"RTN","IBCAPP1",21,0)
 ; A2; B6; 42; 45; 102; 104; 118; 131; 23; 232; 44; 59; 94; 97; or 10
"RTN","IBCAPP1",22,0)
 ; Patient Responsibility group code of PR is associated with one of the following reason codes:
"RTN","IBCAPP1",23,0)
 ; 1; 2; or 66 
"RTN","IBCAPP1",24,0)
 ; The sum of the deductible, coinsurance and co-payment amounts is greater than $0.00
"RTN","IBCAPP1",25,0)
 ; The claim status is Approved; and
"RTN","IBCAPP1",26,0)
 ; The CLP02 equals one of the following:1; 2; or 3
"RTN","IBCAPP1",27,0)
 N IB0,IBCT,IBI,IBILLCNT,IBPTRESP,IBSHEOB,REASON,Z,ERR
"RTN","IBCAPP1",28,0)
 S OK=0,REASON="Unknown",IBEOB=0
"RTN","IBCAPP1",29,0)
 ;
"RTN","IBCAPP1",30,0)
 ; Check the parameter value (Make sure this bad boy is turned on).
"RTN","IBCAPP1",31,0)
 I '+IBIFN S REASON="IB807:Need to pass in an internal claim number" G CRITX
"RTN","IBCAPP1",32,0)
 ;
"RTN","IBCAPP1",33,0)
 ; Check the parameter value (Make sure this baby is turned on).
"RTN","IBCAPP1",34,0)
 I '$P($G(^IBE(350.9,1,8)),U,17) S REASON="IB800:Automatic EOB Processing parameter is turned off.  File 350.9, Field 8.17." G CRITX
"RTN","IBCAPP1",35,0)
 ;
"RTN","IBCAPP1",36,0)
 ; Quit if we don't have any EOBs
"RTN","IBCAPP1",37,0)
 I '$D(^IBM(361.1,"B",IBIFN)),'$D(^IBM(361.1,"C",IBIFN)) S REASON="IB801:No EOB Data Found" G CRITX
"RTN","IBCAPP1",38,0)
 ;
"RTN","IBCAPP1",39,0)
 ; Let's go get us some EOBs
"RTN","IBCAPP1",40,0)
 S IBCT=0,IBI=0
"RTN","IBCAPP1",41,0)
 F  S IBI=$O(^IBM(361.1,"B",IBIFN,IBI)) Q:'IBI  D
"RTN","IBCAPP1",42,0)
 . S IB0=$G(^IBM(361.1,IBI,0))
"RTN","IBCAPP1",43,0)
 . Q:IB0=""
"RTN","IBCAPP1",44,0)
 . Q:$P(IB0,U,4)'=0  ; do not care about MRAs, only EOBs
"RTN","IBCAPP1",45,0)
 . S Z=+$O(^IBM(361.1,IBI,8,0))
"RTN","IBCAPP1",46,0)
 . I '$O(^IBM(361.1,IBI,8,Z)) S IBCT=IBCT+1,IBSHEOB(IBI)=0  ; Entire EOB belongs to the bill
"RTN","IBCAPP1",47,0)
 ;
"RTN","IBCAPP1",48,0)
 S IBI=0
"RTN","IBCAPP1",49,0)
 F  S IBI=$O(^IBM(361.1,"C",IBIFN,IBI)) Q:'IBI  D
"RTN","IBCAPP1",50,0)
 . S IB0=$G(^IBM(361.1,IBI,0))
"RTN","IBCAPP1",51,0)
 . Q:IB0=""
"RTN","IBCAPP1",52,0)
 . Q:$P(IB0,U,4)'=0  ; do not care about MRAs, only EOBs
"RTN","IBCAPP1",53,0)
 . I '$D(IBSHEOB(IBI)) S IBCT=IBCT+1 ; don't count it twice
"RTN","IBCAPP1",54,0)
 . S IBSHEOB(IBI)=1 ; EOB has been reapportioned at the site
"RTN","IBCAPP1",55,0)
 ;
"RTN","IBCAPP1",56,0)
 I '$D(IBSHEOB) S ERR=1,REASON="IB801:No EOB Data Found" G CRITX
"RTN","IBCAPP1",57,0)
 I $G(IBCT)>1 S ERR=1,REASON="IB802:Multiple EOBs found for this claim" G CRITX
"RTN","IBCAPP1",58,0)
 ;
"RTN","IBCAPP1",59,0)
 ; only one EOB
"RTN","IBCAPP1",60,0)
 S ERR=0
"RTN","IBCAPP1",61,0)
 S IBEOB=$O(IBSHEOB(0))
"RTN","IBCAPP1",62,0)
 ;
"RTN","IBCAPP1",63,0)
 I $D(^IBM(361.1,IBEOB,"ERR")) S REASON="IB803:EOB Filing Errors" G CRITX
"RTN","IBCAPP1",64,0)
 ;
"RTN","IBCAPP1",65,0)
 S IB0=$G(^IBM(361.1,IBEOB,0))
"RTN","IBCAPP1",66,0)
 I $P(IB0,U,13)'=1 S REASON="IB804:Claim Status must be PROCESSED" G CRITX
"RTN","IBCAPP1",67,0)
 ;
"RTN","IBCAPP1",68,0)
 ; If this EOB is a split EOB, then don't allow it
"RTN","IBCAPP1",69,0)
 I $$SPLIT^IBCEMU1(IBEOB) S REASON="IB805:Claim level remark code MA15 received.  Multiple EOBs." G CRITX
"RTN","IBCAPP1",70,0)
 ;
"RTN","IBCAPP1",71,0)
 ; More than one claim on this EOB
"RTN","IBCAPP1",72,0)
 S Z=0 F  S Z=$O(^IBM(361.1,IBEOB,8,Z)) Q:'Z  I $P($G(^IBM(361.1,IBEOB,8,Z,0)),U,3)'=IBIFN S REASON="IB809:EOB Split to more claims" G CRITX
"RTN","IBCAPP1",73,0)
 ;
"RTN","IBCAPP1",74,0)
 ; Call the function that checks the claim level and/or line level
"RTN","IBCAPP1",75,0)
 ; adjustments for this EOB
"RTN","IBCAPP1",76,0)
 I '$$CAS(IBEOB,"B",.REASON) S REASON="IB808:Failed adjustment criteria selection" G CRITX  ; "B" for both
"RTN","IBCAPP1",77,0)
 ;
"RTN","IBCAPP1",78,0)
 ; Make sure the balance remaining amount is greater than $0
"RTN","IBCAPP1",79,0)
 S IBPTRESP=$$TOT^IBCECOB2(IBIFN)
"RTN","IBCAPP1",80,0)
 I IBPTRESP'>0 S REASON="IB806:Balance remaining dollar amount is less than or equal to $0" G CRITX
"RTN","IBCAPP1",81,0)
 ;
"RTN","IBCAPP1",82,0)
 ; At this point, we're OK
"RTN","IBCAPP1",83,0)
 S OK=1,REASON=""
"RTN","IBCAPP1",84,0)
 ;
"RTN","IBCAPP1",85,0)
CRITX ;
"RTN","IBCAPP1",86,0)
 ;
"RTN","IBCAPP1",87,0)
 Q OK_U_REASON
"RTN","IBCAPP1",88,0)
 ;
"RTN","IBCAPP1",89,0)
 ;
"RTN","IBCAPP1",90,0)
CAS(IBEOB,ADJFLAG,REASON) ; This function determines if the EOB
"RTN","IBCAPP1",91,0)
 ; adjustment group codes and reason codes from file 361.1 (either
"RTN","IBCAPP1",92,0)
 ; claim level or line level or both) meet the criteria for auto-
"RTN","IBCAPP1",93,0)
 ; authorization and secondary claim submission.
"RTN","IBCAPP1",94,0)
 ;
"RTN","IBCAPP1",95,0)
 ; Input Parameters
"RTN","IBCAPP1",96,0)
 ;        IBEOB    - ien of entry in file 361.1
"RTN","IBCAPP1",97,0)
 ;      ADJFLAG    - adjustment flag
"RTN","IBCAPP1",98,0)
 ;                   "C" - look at claim level adjustments only
"RTN","IBCAPP1",99,0)
 ;                   "L" - look at line level adjustments only
"RTN","IBCAPP1",100,0)
 ;                   "B" - look at both claim and line level adjustments
"RTN","IBCAPP1",101,0)
 ; Output Parameter
"RTN","IBCAPP1",102,0)
 ;       REASON    - error message describing why it failed
"RTN","IBCAPP1",103,0)
 ;
"RTN","IBCAPP1",104,0)
 ; Function Value is either 0 or 1, indicating if it passed the criteria
"RTN","IBCAPP1",105,0)
 ;
"RTN","IBCAPP1",106,0)
 NEW EOBADJ,OK,OKCOMBO,PATRESP,STOP,LNIEN
"RTN","IBCAPP1",107,0)
 ;
"RTN","IBCAPP1",108,0)
 S IBEOB=+$G(IBEOB)
"RTN","IBCAPP1",109,0)
 S ADJFLAG=$G(ADJFLAG,"B")     ; default is "B" if not passed in
"RTN","IBCAPP1",110,0)
 D BUILD           ; build the array of OK group/reason combinations
"RTN","IBCAPP1",111,0)
 S PATRESP=0       ; patient responsibility flag (default false)
"RTN","IBCAPP1",112,0)
 S STOP=0          ; Stop flag
"RTN","IBCAPP1",113,0)
 S OK=0            ; OK flag (function value)
"RTN","IBCAPP1",114,0)
 S REASON=""       ; error reason text
"RTN","IBCAPP1",115,0)
 ;
"RTN","IBCAPP1",116,0)
 ; claim level adjustments
"RTN","IBCAPP1",117,0)
 I $F(".C.B.","."_ADJFLAG_".") D
"RTN","IBCAPP1",118,0)
 . KILL EOBADJ
"RTN","IBCAPP1",119,0)
 . M EOBADJ=^IBM(361.1,IBEOB,10)
"RTN","IBCAPP1",120,0)
 . D ADJCHK
"RTN","IBCAPP1",121,0)
 . Q
"RTN","IBCAPP1",122,0)
 ;
"RTN","IBCAPP1",123,0)
 ; Get out if the claim level adjustments failed
"RTN","IBCAPP1",124,0)
 I STOP G CASX
"RTN","IBCAPP1",125,0)
 ;
"RTN","IBCAPP1",126,0)
 ; line level adjustments
"RTN","IBCAPP1",127,0)
 I $F(".L.B.","."_ADJFLAG_".") D
"RTN","IBCAPP1",128,0)
 . S LNIEN=0
"RTN","IBCAPP1",129,0)
 . F  S LNIEN=$O(^IBM(361.1,IBEOB,15,LNIEN)) Q:'LNIEN  D  Q:STOP
"RTN","IBCAPP1",130,0)
 .. KILL EOBADJ
"RTN","IBCAPP1",131,0)
 .. M EOBADJ=^IBM(361.1,IBEOB,15,LNIEN,1)
"RTN","IBCAPP1",132,0)
 .. D ADJCHK
"RTN","IBCAPP1",133,0)
 .. Q
"RTN","IBCAPP1",134,0)
 . Q
"RTN","IBCAPP1",135,0)
 ;
"RTN","IBCAPP1",136,0)
 ; Get out if the line level adjustments failed
"RTN","IBCAPP1",137,0)
 I STOP G CASX
"RTN","IBCAPP1",138,0)
 ;
"RTN","IBCAPP1",139,0)
 ; Get out if there was no patient responsibility adjustments found
"RTN","IBCAPP1",140,0)
 I 'PATRESP S REASON="No Patient Responsibility Adjustments found" G CASX
"RTN","IBCAPP1",141,0)
 ;
"RTN","IBCAPP1",142,0)
 ; At this point, we're OK
"RTN","IBCAPP1",143,0)
 S OK=1,REASON=""
"RTN","IBCAPP1",144,0)
CASX ;
"RTN","IBCAPP1",145,0)
 Q OK
"RTN","IBCAPP1",146,0)
 ;
"RTN","IBCAPP1",147,0)
 ;
"RTN","IBCAPP1",148,0)
ADJCHK ; This procedure checks the adjustments for this EOB.  The group codes
"RTN","IBCAPP1",149,0)
 ; and reason codes are in the EOBADJ array structures from file 361.1.
"RTN","IBCAPP1",150,0)
 ;
"RTN","IBCAPP1",151,0)
 ;   Variables STOP and REASON will be returned on an error
"RTN","IBCAPP1",152,0)
 ;   Variable PATRESP will be returned if a valid PR adjustment found
"RTN","IBCAPP1",153,0)
 ;
"RTN","IBCAPP1",154,0)
 NEW ADJIEN,GROUP,RSNIEN,RSNCODE
"RTN","IBCAPP1",155,0)
 S ADJIEN=0
"RTN","IBCAPP1",156,0)
 F  S ADJIEN=$O(EOBADJ(ADJIEN)) Q:'ADJIEN  D  Q:STOP
"RTN","IBCAPP1",157,0)
 . S GROUP=$P($G(EOBADJ(ADJIEN,0)),U,1)
"RTN","IBCAPP1",158,0)
 . I GROUP="LQ" Q      ; line level remark code kludge: 42 rec [3]
"RTN","IBCAPP1",159,0)
 . I GROUP="" S GROUP="<Undefined>"
"RTN","IBCAPP1",160,0)
 . I '$D(OKCOMBO(GROUP)) S STOP=1,REASON="Unacceptable Claim Adjustment Group Code: "_GROUP Q
"RTN","IBCAPP1",161,0)
 . S RSNIEN=0
"RTN","IBCAPP1",162,0)
 . F  S RSNIEN=$O(EOBADJ(ADJIEN,1,RSNIEN)) Q:'RSNIEN  D  Q:STOP
"RTN","IBCAPP1",163,0)
 .. S RSNCODE=$P($G(EOBADJ(ADJIEN,1,RSNIEN,0)),U,1)
"RTN","IBCAPP1",164,0)
 .. ;
"RTN","IBCAPP1",165,0)
 .. ; Ignore some special adjustment data that is filed with the MRA
"RTN","IBCAPP1",166,0)
 .. I GROUP="PR",RSNCODE="AAA" Q    ; Allowed Amount: 41 rec [3]
"RTN","IBCAPP1",167,0)
 .. I GROUP="OA",RSNCODE="AB3" Q    ; Covered Amount: 15 rec [3]
"RTN","IBCAPP1",168,0)
 .. ;
"RTN","IBCAPP1",169,0)
 .. I RSNCODE="" S RSNCODE="<Undefined>"
"RTN","IBCAPP1",170,0)
 .. I '$D(OKCOMBO(GROUP,RSNCODE)) S STOP=1,REASON="Unacceptable Reason Code ("_RSNCODE_") for Claim Adjustment Group Code ("_GROUP_")" Q
"RTN","IBCAPP1",171,0)
 .. ;
"RTN","IBCAPP1",172,0)
 .. ; Set the flag if the group is PR
"RTN","IBCAPP1",173,0)
 .. I GROUP="PR" S PATRESP=1
"RTN","IBCAPP1",174,0)
 .. Q
"RTN","IBCAPP1",175,0)
 . Q
"RTN","IBCAPP1",176,0)
ADJCHKX ;
"RTN","IBCAPP1",177,0)
 Q
"RTN","IBCAPP1",178,0)
 ;
"RTN","IBCAPP1",179,0)
 ;
"RTN","IBCAPP1",180,0)
BUILD ; This procedure builds the OKCOMBO array which identifies which
"RTN","IBCAPP1",181,0)
 ; combinations of group codes and reason codes are acceptable
"RTN","IBCAPP1",182,0)
 ;
"RTN","IBCAPP1",183,0)
 NEW LN,LINE,GROUP,RSNLST,R,RSN
"RTN","IBCAPP1",184,0)
 KILL OKCOMBO
"RTN","IBCAPP1",185,0)
 F LN=1:1 D  Q:$P(LINE,";",4)=""&$D(OKCOMBO)
"RTN","IBCAPP1",186,0)
 . S LINE=$T(OKCOMBO+LN)
"RTN","IBCAPP1",187,0)
 . S GROUP=$P(LINE,";",3) Q:GROUP=""
"RTN","IBCAPP1",188,0)
 . S RSNLST=$P(LINE,";",4) Q:RSNLST=""
"RTN","IBCAPP1",189,0)
 . F R=1:1:$L(RSNLST,",") D
"RTN","IBCAPP1",190,0)
 .. S RSN=$P(RSNLST,",",R) Q:RSN=""
"RTN","IBCAPP1",191,0)
 .. S OKCOMBO(GROUP,RSN)=""
"RTN","IBCAPP1",192,0)
 .. Q
"RTN","IBCAPP1",193,0)
 . Q
"RTN","IBCAPP1",194,0)
BUILDX ;
"RTN","IBCAPP1",195,0)
 Q
"RTN","IBCAPP1",196,0)
 ;
"RTN","IBCAPP1",197,0)
 ;
"RTN","IBCAPP1",198,0)
OKCOMBO ; This section lists OK combinations of adjustment category group codes
"RTN","IBCAPP1",199,0)
 ; and associated reason codes.
"RTN","IBCAPP1",200,0)
 ; The format is as follows - semi-colon delimiter
"RTN","IBCAPP1",201,0)
 ;     [3] Adjustment category (group code)
"RTN","IBCAPP1",202,0)
 ;     [4] List of acceptable reason codes - comma delimiter
"RTN","IBCAPP1",203,0)
 ;
"RTN","IBCAPP1",204,0)
 ;;CO;A2,B6,42,45,102,104,118,131,23,232,44,59,94,97,10
"RTN","IBCAPP1",205,0)
 ;;PR;1,2,66
"RTN","IBCAPP1",206,0)
 ;
"RTN","IBCAPP2")
0^77^B40572879^n/a
"RTN","IBCAPP2",1,0)
IBCAPP2 ;ALB/GEF - Claims Auto Processing  ;14-OCT-10
"RTN","IBCAPP2",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCAPP2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCAPP2",4,0)
 ;
"RTN","IBCAPP2",5,0)
 ; IBMRANOT = 1 when dealing with the COB Management Worklist.   
"RTN","IBCAPP2",6,0)
 ;            It is set by the entry action in the option file. 
"RTN","IBCAPP2",7,0)
 ;
"RTN","IBCAPP2",8,0)
CAP ; Build list from CAP x-ref entrypoint.  Called from BLD^IBCECOB1 for non-MRA worklist
"RTN","IBCAPP2",9,0)
 N IBDA,IBIFN
"RTN","IBCAPP2",10,0)
 S IBIFN=0 F  S IBIFN=$O(^DGCR(399,"CAP",1,IBIFN)) Q:'IBIFN  D
"RTN","IBCAPP2",11,0)
 .; screen all eob's for the claim to see if claim can be on worklist
"RTN","IBCAPP2",12,0)
 .; IBDA= ien of 1st eob to pass all checks - or - 0 if none passed - or - -1 if process as paper EOB
"RTN","IBCAPP2",13,0)
 .S IBDA=$$MELG(IBIFN,IBMRADUP) Q:'IBDA
"RTN","IBCAPP2",14,0)
 .D BLD1(IBIFN,$S(IBDA=-1:"",1:IBDA))
"RTN","IBCAPP2",15,0)
 Q
"RTN","IBCAPP2",16,0)
BLD1(IBIFN,IBDA) ;
"RTN","IBCAPP2",17,0)
 N IB3611,IBTXT,IBX,IBPY,I,IB364,IBDT,IBAPY,IBB,IBB364,IBBPY,IBDAY,IBEUT
"RTN","IBCAPP2",18,0)
 N IBINS1,IBINS2,IBMRACNT,Z,Z0,IBMUT,IBNBAL,IBNDI1,IBNDI2,IBNDI3,IBNDM
"RTN","IBCAPP2",19,0)
 N IBPTRSP,IBQ,IBSEQ,IBSRVC,IBEXPY,IBFND,IBINS,IBNDS,IBOAM,IBPTNM,IBDENDUP
"RTN","IBCAPP2",20,0)
 Q:$D(^TMP("IBCOBSTX",$J,IBIFN))  ;show each bill once on the worklist
"RTN","IBCAPP2",21,0)
 S IBB=$G(^DGCR(399,IBIFN,0))
"RTN","IBCAPP2",22,0)
 S IBNDS=$G(^DGCR(399,IBIFN,"S")),IBNDI1=$G(^("I1")),IBNDI2=$G(^("I2")),IBNDI3=$G(^("I3")),IBNDM=$G(^("M"))
"RTN","IBCAPP2",23,0)
 S IBMUT=+$P(IBNDS,U,8),IBEUT=+$P(IBNDS,U,2)
"RTN","IBCAPP2",24,0)
 S IBINS="",IBSEQ=$$COBN^IBCEF(IBIFN),IB364="UNKNOWN",IBDT="UNKNOWN"
"RTN","IBCAPP2",25,0)
 S IB3611=$S($G(IBDA)'="":$G(^IBM(361.1,IBDA,0)),1:"")
"RTN","IBCAPP2",26,0)
 I $G(IB3611)'="" S IB364=$P(IB3611,U,19),IBDT=+$P(IB3611,U,6),IBSEQ=$P(IB3611,U,15)
"RTN","IBCAPP2",27,0)
 F I=1:1:3 S Z="IBNDI"_I I @Z D
"RTN","IBCAPP2",28,0)
 . N Q
"RTN","IBCAPP2",29,0)
 . S Q=(IBSEQ=I)
"RTN","IBCAPP2",30,0)
 . I Q S IBINS1=+@Z_U_$P($G(^DIC(36,+@Z,0)),U)
"RTN","IBCAPP2",31,0)
 . S IBINS=IBINS_$S(IBINS="":"",1:", ")_$P($G(^DIC(36,+@Z,0)),U)
"RTN","IBCAPP2",32,0)
 ; Get the payer/insurance company that comes after Medicare WNR
"RTN","IBCAPP2",33,0)
 ; If WNR is Primary, get the secondary ins. co.
"RTN","IBCAPP2",34,0)
 ; If WNR is secondary, get the tertiary ins. co.
"RTN","IBCAPP2",35,0)
 D  I $P($G(IBINS2),U,2)="" S $P(IBINS2,U,2)="UNKNOWN"
"RTN","IBCAPP2",36,0)
 . I $$WNRBILL^IBEFUNC(IBIFN,1) S IBINS2=+IBNDI2_U_$P($G(^DIC(36,+IBNDI2,0)),U) Q
"RTN","IBCAPP2",37,0)
 . S IBINS2=+IBNDI3_U_$P($G(^DIC(36,+IBNDI3,0)),U)
"RTN","IBCAPP2",38,0)
 S IBFND=0
"RTN","IBCAPP2",39,0)
 ; biller entry not ALL and no biller, then get entered/edited by user
"RTN","IBCAPP2",40,0)
 I $D(^TMP("IBBIL",$J)) D  Q:'IBFND
"RTN","IBCAPP2",41,0)
 . S IBFND=$S($D(^TMP("IBBIL",$J,IBMUT)):IBMUT,$D(^TMP("IBBIL",$J,IBEUT)):IBEUT,1:0)
"RTN","IBCAPP2",42,0)
 S Z=$S(IBFND:IBFND,IBMUT:IBMUT,1:IBEUT)
"RTN","IBCAPP2",43,0)
 S IBMUT=$P($G(^VA(200,+Z,0)),U)_"~"_Z
"RTN","IBCAPP2",44,0)
 S:'$P(IBMUT,"~",2) IBMUT="UNKNOWN~0"
"RTN","IBCAPP2",45,0)
 S IBBPY=+$$COBN^IBCEF(IBIFN),IBQ=1
"RTN","IBCAPP2",46,0)
 ;IBQ;1=EOB without subsequent insurer,0=COB,2=0 balance
"RTN","IBCAPP2",47,0)
 D  ;I IBQ Q
"RTN","IBCAPP2",48,0)
 . ;Check for no reimbursable subsequent insurance
"RTN","IBCAPP2",49,0)
 .  F I=IBBPY+1:1:3 D  Q:'IBQ
"RTN","IBCAPP2",50,0)
 .. S Z="IBNDI"_I,Z=$G(@Z)
"RTN","IBCAPP2",51,0)
 .. I $P($G(^DIC(36,+Z,0)),U,2)="N" S IBQ=0 Q
"RTN","IBCAPP2",52,0)
 . ;Check if next ins doesn't exist or next bill# already created
"RTN","IBCAPP2",53,0)
 . S Z="IBNDI"_(IBBPY+1),Z=$G(@Z)
"RTN","IBCAPP2",54,0)
 . I Z,'$P($G(^DGCR(399,IBIFN,"M1")),U,5+IBBPY) S IBQ=0
"RTN","IBCAPP2",55,0)
 ;
"RTN","IBCAPP2",56,0)
 ; Days since transmission of latest bill in COB - IBDAY
"RTN","IBCAPP2",57,0)
 S IBDAY=+$P($G(^DGCR(399,IBIFN,"TX")),U,2) I IBDAY S IBDAY=$$FMDIFF^XLFDT(DT,IBDAY,1)
"RTN","IBCAPP2",58,0)
 ; if no Last Electronic Extract Date on file 399, get it from file 364
"RTN","IBCAPP2",59,0)
 I 'IBDAY D  I IBDAY S IBDAY=$$FMDIFF^XLFDT(DT,IBDAY,1) ;calc. the difference
"RTN","IBCAPP2",60,0)
 . S IBB364=$$LAST364^IBCEF4(IBIFN) I IBB364'="" S IBDAY=+$P($P($G(^IBA(364,IBB364,0)),U,4),".",1)
"RTN","IBCAPP2",61,0)
 ;
"RTN","IBCAPP2",62,0)
 S IBAPY=$$TPR^PRCAFN(IBIFN) ; payment on this bill from A/R  IA#380
"RTN","IBCAPP2",63,0)
 S:$G(IBDA)'="" IBEXPY=+$G(^IBM(361.1,IBDA,1))       ; payer paid amount
"RTN","IBCAPP2",64,0)
 S IBPY=$S(IBAPY:IBAPY,1:+$G(IBEXPY))
"RTN","IBCAPP2",65,0)
 S IBOAM=+$G(^DGCR(399,IBIFN,"U1"))     ; total charges for bill
"RTN","IBCAPP2",66,0)
 S IBNBAL=IBOAM-IBPY
"RTN","IBCAPP2",67,0)
 S IBPTRSP=$S(IBNBAL>0:IBNBAL,1:0)
"RTN","IBCAPP2",68,0)
 I IBNBAL'>0 S IBQ=2
"RTN","IBCAPP2",69,0)
 S IBPTNM=$P($G(^DPT(+$P($G(^DGCR(399,IBIFN,0)),U,2),0)),U) I IBPTNM="" S IBPTNM="UNKNOWN"
"RTN","IBCAPP2",70,0)
 S IBSRVC=$P($G(^DGCR(399,IBIFN,"U")),U)
"RTN","IBCAPP2",71,0)
 S Z0=$S(IBSRT="B":IBMUT,IBSRT="D":-IBDAY,IBSRT="I":$P(IBINS2,U,2)_"~"_$P(IBINS2,U),IBSRT="M":$$EXTERNAL^DILFD(361.1,.13,"",$P(IB3611,"^",13)),IBSRT="R":-IBPTRSP,IBSRT="P":IBPTNM,IBSRT="S":+IBSRVC,1:+IBDT)
"RTN","IBCAPP2",72,0)
 S:((IBSRT="M")&(Z0="")) Z0="UNKNOWN"   ;USE UNKNOWN IF NOT SET - BI;IB*2.0*432
"RTN","IBCAPP2",73,0)
 S ^TMP("IBCOBST",$J,Z0,IBIFN)=IBSRVC_U_IBOAM_U_IBAPY_U_$S(IBNBAL>0:IBNBAL,1:0)_U_$P(IBB,U,5)_U_$P(IBB,U,19)_U_IBBPY_U_$P(IBMUT,"~")_U_IBINS_U_$G(IBDA)_U_$$HIS(IBIFN)_U_$G(IBDAY)_U_$G(IBDT)_U_IBQ_U_$G(IB364)_U_IBSEQ_U_$G(IBEXPY)_U_IBPTRSP
"RTN","IBCAPP2",74,0)
 S ^TMP("IBCOBST",$J,Z0,IBIFN,1)=$S($G(IB3611)="":"No EEOB Received ",1:$$EXTERNAL^DILFD(361.1,.13,"",$P(IB3611,"^",13))_", "_$$FMTE^XLFDT($P($P(IB3611,"^",6),"."))_"^"_$P(IB3611,"^",16))
"RTN","IBCAPP2",75,0)
 S ^TMP("IBCOBSTX",$J,IBIFN)=$G(IBDA)  ;keep track of compiled IBIFN's
"RTN","IBCAPP2",76,0)
 ;
"RTN","IBCAPP2",77,0)
 ; Save some data when there are multiple MRA's on file for this bill
"RTN","IBCAPP2",78,0)
 S IBMRACNT=$$MRACNT^IBCEMU1(IBIFN,$G(IBMRANOT))   ;WCJ IB*2.0*432
"RTN","IBCAPP2",79,0)
 I IBMRACNT>1 S $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,1)="Multiple "_$S($G(IBMRANOT):"EOBs",1:"MRA's")_" on file"  ;WCJ IB*2.0*432
"RTN","IBCAPP2",80,0)
 S $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,3)=IBMRACNT
"RTN","IBCAPP2",81,0)
 S $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,4)=$G(IBDENDUP)
"RTN","IBCAPP2",82,0)
 S:$G(IBDA)'="" $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,4)=$$DENDUP^IBCEMU4(IBDA,1)
"RTN","IBCAPP2",83,0)
 Q
"RTN","IBCAPP2",84,0)
 ;
"RTN","IBCAPP2",85,0)
HIS(IBIFN) ; COB history
"RTN","IBCAPP2",86,0)
 N A,B,IBST,IBBIL,IBHIS
"RTN","IBCAPP2",87,0)
 S IBHIS="",A=0 F  S A=$O(^IBM(361.1,"ABS",IBIFN,A)) Q:'A  S B=0 F  S B=$O(^IBM(361.1,"ABS",IBIFN,A,B)) Q:'B  D
"RTN","IBCAPP2",88,0)
 . S IBST=$P($G(^IBM(361.1,B,0)),U,4),IBBIL=$P($G(^DGCR(399,IBIFN,"M1")),U,4+A)   ;WCJ IB*2.0*432 added $G
"RTN","IBCAPP2",89,0)
 . Q:IBBIL=""
"RTN","IBCAPP2",90,0)
 . S IBHIS=IBHIS_$S(IBHIS="":"",1:";")_$S(A=1:"PRIMARY",A=2:"SECONDARY",1:"TERTIARY")_" "_$S(IBST:"MRA",1:"EOB")_" RECEIVED - "_IBBIL
"RTN","IBCAPP2",91,0)
 I '$D(^IBM(361.1,"ABS",IBIFN)) F A=1:1:3 S IBBIL=$P($G(^DGCR(399,IBIFN,"M1")),U,4+A) I IBBIL'="" S IBHIS=IBHIS_$S(IBHIS="":"",1:";")_$S(A=1:"PRIMARY",A=2:"SECONDARY",A=3:"TERTIARY",1:"UNKNOWN")_" No EOB RECEIVED - "_IBBIL
"RTN","IBCAPP2",92,0)
 Q IBHIS
"RTN","IBCAPP2",93,0)
 ;
"RTN","IBCAPP2",94,0)
MELG(IBIFN,IBMRADUP) ; function to check all EOBs for a claim and determine if they are
"RTN","IBCAPP2",95,0)
 ; eligible for inclusion on the COB management worklist, uses both B & C x-ref
"RTN","IBCAPP2",96,0)
 ; IBIFN - claim ien (required)
"RTN","IBCAPP2",97,0)
 ; IBMRADUP - indicates user said NO to "include denied for duplicate" prompt
"RTN","IBCAPP2",98,0)
 ;
"RTN","IBCAPP2",99,0)
 ; Returns EOB ien to use for display, if at least 1 EOB passed all checks
"RTN","IBCAPP2",100,0)
 ; if multiple EOBs passed but some have filing errors, returns the 1st EOB found that does NOT have filing errors
"RTN","IBCAPP2",101,0)
 ; if all EOBs have filing errors, tries to find one that is a PROCESSED status and return that one for CBW display
"RTN","IBCAPP2",102,0)
 ; Returns -1 if claim should appear on the worklist with no EOB
"RTN","IBCAPP2",103,0)
 ; Returns 0 if no EOBs passed the checks and claim should not appear on the worklist, also removes it
"RTN","IBCAPP2",104,0)
 ;
"RTN","IBCAPP2",105,0)
 ; IBCK = Total number of EOBs found for this claim ien
"RTN","IBCAPP2",106,0)
 ; IBECT = Total number of EOBs that failed the EOB TYPE check
"RTN","IBCAPP2",107,0)
 ; IBCT = Total number of EOBs for a claim that passed ALL the checks
"RTN","IBCAPP2",108,0)
 ;
"RTN","IBCAPP2",109,0)
 N IBDA,IBCT,IBEOBNDX,IBEOB,IB3611,IBCK,IBETC
"RTN","IBCAPP2",110,0)
 S IBCT=0,IBCK=0,IBETC=0
"RTN","IBCAPP2",111,0)
 F IBEOBNDX="B","C" D
"RTN","IBCAPP2",112,0)
 .S IBDA=0 F  S IBDA=$O(^IBM(361.1,IBEOBNDX,IBIFN,IBDA)) Q:'+IBDA  D
"RTN","IBCAPP2",113,0)
 ..Q:$D(IBEOB(IBDA))
"RTN","IBCAPP2",114,0)
 ..S IB3611=$G(^IBM(361.1,IBDA,0)),IBCK=IBCK+1
"RTN","IBCAPP2",115,0)
 ..; if this is a denied EOB and user does NOT want to include denied as duplicates and this EOB was denied as duplicate, don't include
"RTN","IBCAPP2",116,0)
 ..I $P(IB3611,U,13)=2,'$G(IBMRADUP),$$DENDUP^IBCEMU4(IBDA,1) Q
"RTN","IBCAPP2",117,0)
 ..; eob type must be correct for this worklist
"RTN","IBCAPP2",118,0)
 ..I $P(IB3611,U,4)=1 S IBETC=IBETC+1 Q
"RTN","IBCAPP2",119,0)
 ..; allow filing errors on worklist, but try to find at least 1 Processed EOB w/out errors
"RTN","IBCAPP2",120,0)
 ..I $D(^IBM(361.1,IBDA,"ERR")) S:$P($G(^IBM(361.1,IBDA,0)),U,13)'=1 IBEOB("DER",IBDA)="" S:$P($G(^IBM(361.1,IBDA,0)),U,13)=1 IBEOB("PER",IBDA)="" Q
"RTN","IBCAPP2",121,0)
 ..S IBEOB(IBDA)="",IBCT=IBCT+1
"RTN","IBCAPP2",122,0)
 ; if no EOB was found to check, return -1 to process as no EOB
"RTN","IBCAPP2",123,0)
 Q:IBCK=0 -1
"RTN","IBCAPP2",124,0)
 ; if no EOB passed, check to see if the EOBs were all MRA primaries that failed the EOB type check (2ndary/tertiaries were paper)
"RTN","IBCAPP2",125,0)
 I IBCT=0,$$WNRBILL^IBEFUNC(IBIFN,1),$$COBN^IBCEF(IBIFN)>1,(IBCK=IBETC) Q -1
"RTN","IBCAPP2",126,0)
 ; if no EOB's passed, check for filing errors and use that EOB, with Processed EOB's taking priority over denied
"RTN","IBCAPP2",127,0)
 I IBCT=0,$D(IBEOB("PER")) Q $O(IBEOB("PER",0))
"RTN","IBCAPP2",128,0)
 I IBCT=0,$D(IBEOB("DER")) Q $O(IBEOB("DER",0))
"RTN","IBCAPP2",129,0)
 ; if no EOB passed and not MRA primary w/subsequent paper EOB's or filing errors, do not put on CBW
"RTN","IBCAPP2",130,0)
 Q:IBCT=0 0
"RTN","IBCAPP2",131,0)
 ; if one or more EOBs passed, return the 1st one that passed the checks as the one to use for CBW display
"RTN","IBCAPP2",132,0)
 Q $O(IBEOB(0))
"RTN","IBCAPR")
0^45^B150582034^n/a
"RTN","IBCAPR",1,0)
IBCAPR ;ALB/BI - PRINT EOB/MRA ;20-SEP-2010
"RTN","IBCAPR",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCAPR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCAPR",4,0)
 ;
"RTN","IBCAPR",5,0)
 Q
"RTN","IBCAPR",6,0)
 ;
"RTN","IBCAPR",7,0)
EN(IBIFN) ; -- main entry point for IBCAPR
"RTN","IBCAPR",8,0)
 S VALMBCK="R"
"RTN","IBCAPR",9,0)
 I '$G(IBIFN),$D(VALMBG),$D(VALMLST) S IBIFN=$$GETIBIFN
"RTN","IBCAPR",10,0)
 Q:$G(IBIFN)=""
"RTN","IBCAPR",11,0)
 D EN^VALM("IBCAPR")
"RTN","IBCAPR",12,0)
 Q
"RTN","IBCAPR",13,0)
 ;
"RTN","IBCAPR",14,0)
HDR ; -- header code
"RTN","IBCAPR",15,0)
 N PTNAME,CLONED
"RTN","IBCAPR",16,0)
 S PTNAME=$$GET1^DIQ(399,IBIFN_", ",.02)
"RTN","IBCAPR",17,0)
 S VALMHDR(1)="PATIENT: "_PTNAME
"RTN","IBCAPR",18,0)
 ;
"RTN","IBCAPR",19,0)
 S CLONED=$$GET1^DIQ(399,IBIFN_", ",30)
"RTN","IBCAPR",20,0)
 S:CLONED'="" VALMHDR(2)="CLONED FROM: "_CLONED
"RTN","IBCAPR",21,0)
 Q
"RTN","IBCAPR",22,0)
 ;
"RTN","IBCAPR",23,0)
INIT ; -- init variables and list array
"RTN","IBCAPR",24,0)
 K ^TMP("IBCAPR",$J)
"RTN","IBCAPR",25,0)
 S VALMCNT=$$EOB(IBIFN)-1
"RTN","IBCAPR",26,0)
 Q
"RTN","IBCAPR",27,0)
 ;
"RTN","IBCAPR",28,0)
HELP ; -- help code
"RTN","IBCAPR",29,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCAPR",30,0)
 Q
"RTN","IBCAPR",31,0)
 ;
"RTN","IBCAPR",32,0)
EXIT ; -- exit code
"RTN","IBCAPR",33,0)
 K ^TMP("IBCAPR",$J)
"RTN","IBCAPR",34,0)
 D FULL^VALM1
"RTN","IBCAPR",35,0)
 Q
"RTN","IBCAPR",36,0)
 ;
"RTN","IBCAPR",37,0)
EXPND ; -- expand code
"RTN","IBCAPR",38,0)
 Q
"RTN","IBCAPR",39,0)
 ;
"RTN","IBCAPR",40,0)
EOB(IBIFN) ;  Obtain the EOB Information from Dictionary 361.1, EXPLANATION OF BENEFITS.
"RTN","IBCAPR",41,0)
 ;
"RTN","IBCAPR",42,0)
 N IBALL,IBI,IBILLCNT,IBLN,IBSHEOB
"RTN","IBCAPR",43,0)
 N IBCA,IBCN,IBCT,IBFT,IBMSG,IBPR,IBPT,IBPY,IBQUIT,IBREC1,IBST
"RTN","IBCAPR",44,0)
 N IBSTR,IBTA,IBTS,IBTY,IBX,IBXARRAY,IBXARRY,IBXDATA,IBXERR,IBXSAVE,IBZ,Z
"RTN","IBCAPR",45,0)
 ;
"RTN","IBCAPR",46,0)
 D GETEOBCL(IBIFN,.IBALL)   ; get all associated claims
"RTN","IBCAPR",47,0)
 ;
"RTN","IBCAPR",48,0)
 S IBLN=1,IBILLCNT=0
"RTN","IBCAPR",49,0)
 ;
"RTN","IBCAPR",50,0)
 S IBIFN=0
"RTN","IBCAPR",51,0)
 F  S IBIFN=$O(IBALL(IBIFN)) Q:IBIFN=""  D
"RTN","IBCAPR",52,0)
 .S IBI=0 F  S IBI=$O(^IBM(361.1,"B",IBIFN,IBI)) Q:'IBI  S Z=+$O(^IBM(361.1,IBI,8,0)) I '$O(^(Z)) S IBILLCNT=IBILLCNT+1,IBSHEOB(IBI)=0  ; Entire EOB belongs to the bill
"RTN","IBCAPR",53,0)
 .;
"RTN","IBCAPR",54,0)
 .S IBI=0 F  S IBI=$O(^IBM(361.1,"C",IBIFN,IBI)) Q:'IBI  S IBCT=IBCT+1,IBSHEOB(IBI)=1 ; EOB has been reapportioned at the site
"RTN","IBCAPR",55,0)
 ;
"RTN","IBCAPR",56,0)
 Q:'$D(IBSHEOB)    ; nothing to print
"RTN","IBCAPR",57,0)
 ;
"RTN","IBCAPR",58,0)
 S Z=0,IBI=0
"RTN","IBCAPR",59,0)
 F IBZ=1:1 S IBI=$O(IBSHEOB(IBI)) Q:'IBI  D  I $O(IBSHEOB(IBI)) W @IOF
"RTN","IBCAPR",60,0)
 . D REGION1(IBI,+IBSHEOB(IBI),IBZ,IBILLCNT)
"RTN","IBCAPR",61,0)
 . D REGION2,REGION3,REGION4
"RTN","IBCAPR",62,0)
 ;
"RTN","IBCAPR",63,0)
 Q IBLN
"RTN","IBCAPR",64,0)
 ;
"RTN","IBCAPR",65,0)
REGION1(IBI,IBSPL,IBEOBCT,IBCTOF) ; Claim Header Information
"RTN","IBCAPR",66,0)
 N IBD,IBSTR,IBX,IBM,IBM1,IBM2
"RTN","IBCAPR",67,0)
 ;
"RTN","IBCAPR",68,0)
 ; Line 1
"RTN","IBCAPR",69,0)
 S IBEOBCT=$G(IBEOBCT),IBCTOF=$G(IBCTOF)
"RTN","IBCAPR",70,0)
 S IBD="EOB/MRA Information"_$S(IBCTOF'="":" ("_IBEOBCT_" OF "_IBCTOF_")",1:"")
"RTN","IBCAPR",71,0)
 S IBSTR=$$SETLN(IBD,"",30,45),$E(IBSTR,1,2)=">>",IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",72,0)
 ;
"RTN","IBCAPR",73,0)
 ; Line 2
"RTN","IBCAPR",74,0)
 ; IBSPL = 0 if EOB represents one bill's payment
"RTN","IBCAPR",75,0)
 ;       = 1 if AR had to split the EOB between multiple bills
"RTN","IBCAPR",76,0)
 ; Assumes IBLN is defined and returns it with line count
"RTN","IBCAPR",77,0)
 S IBM=$G(^IBM(361.1,IBI,0))
"RTN","IBCAPR",78,0)
 S IBTY=$P(IBM,U,4),IBTY=$S(IBTY:"MEDICARE MRA",1:"NORMAL EOB")
"RTN","IBCAPR",79,0)
 I IBTY'["MRA",IBSPL S IBTY="A/R SPLIT/COVERS MORE THAN 1 BILL"
"RTN","IBCAPR",80,0)
 I $P(IBM,U,13)>1,$P(IBM,U,13)<5 S IBTY=IBTY_" ("_$$EXTERNAL^DILFD(361.1,.13,,$P(IBM,U,13))_")"
"RTN","IBCAPR",81,0)
 S IBD="EOB Type: "_IBTY,IBSTR=$$SETLN(IBD,"",5,59)
"RTN","IBCAPR",82,0)
 S IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",83,0)
 ;
"RTN","IBCAPR",84,0)
 ; Line 3
"RTN","IBCAPR",85,0)
 S IBCN=$P(IBM,U,14)
"RTN","IBCAPR",86,0)
 S IBX="0.00"
"RTN","IBCAPR",87,0)
 S IBD="ICN: "_IBCN,IBSTR=$$SETLN(IBD,"",10,30)
"RTN","IBCAPR",88,0)
 S IBM1=$G(^IBM(361.1,IBI,1))
"RTN","IBCAPR",89,0)
 S IBPT=$P(IBM1,U,2)   ; patient responsibility 1.02 field
"RTN","IBCAPR",90,0)
 I $P(IBM,U,4),$D(^IBM(361.1,IBI,"ERR")) S IBPT=0  ; filing error
"RTN","IBCAPR",91,0)
 ; If MRA & UB, then calculate patient responsiblity value
"RTN","IBCAPR",92,0)
 I $P(IBM,U,4),$$FT^IBCEF(+$P(IBM,U,1))=3 S IBPT=$$PTRESPI^IBCECOB1(IBI)
"RTN","IBCAPR",93,0)
 S IBD="Patient Resp Amount: "_$S('IBPT:IBX,1:IBPT)
"RTN","IBCAPR",94,0)
 S IBSTR=$$SETLN(IBD,IBSTR,44,35)
"RTN","IBCAPR",95,0)
 S IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",96,0)
 ;
"RTN","IBCAPR",97,0)
 ; Line 4
"RTN","IBCAPR",98,0)
 S IBPY=$$GET1^DIQ(36,+$P(IBM,U,2)_", ",.01)
"RTN","IBCAPR",99,0)
 S IBM2=$G(^IBM(361.1,IBI,2)),IBTA=$P(IBM2,U,3)
"RTN","IBCAPR",100,0)
 ; if no Total Allowed Amount, sum up amounts on Line Level Adjustment
"RTN","IBCAPR",101,0)
 I IBTA="" S IBTA=$$ALLOWED^IBCEMU2(IBI)
"RTN","IBCAPR",102,0)
 S IBD="Payer Name: "_IBPY,IBSTR=$$SETLN(IBD,"",3,40)
"RTN","IBCAPR",103,0)
 S IBD="Total Allowed Amount: "_$S('IBTA:IBX,1:IBTA)
"RTN","IBCAPR",104,0)
 S IBSTR=$$SETLN(IBD,IBSTR,43,36)
"RTN","IBCAPR",105,0)
 S IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",106,0)
 ;
"RTN","IBCAPR",107,0)
 ; Line 5
"RTN","IBCAPR",108,0)
 S IBTS=$P(IBM2,U,4)
"RTN","IBCAPR",109,0)
 S IBPR=$$FMTE^XLFDT($P(IBM,U,6))
"RTN","IBCAPR",110,0)
 S IBD="EOB Date: "_IBPR,IBSTR=$$SETLN(IBD,"",5,35)
"RTN","IBCAPR",111,0)
 S IBD="Total Submitted Charges: "_$S('IBTS:IBX,1:IBTS)
"RTN","IBCAPR",112,0)
 S IBSTR=$$SETLN(IBD,IBSTR,40,39)
"RTN","IBCAPR",113,0)
 S IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",114,0)
 ;
"RTN","IBCAPR",115,0)
 ; Line 6
"RTN","IBCAPR",116,0)
 S IBD="Svc From Dt: "_$$DAT1^IBOUTL($P(IBM1,U,10))
"RTN","IBCAPR",117,0)
 S IBSTR=$$SETLN(IBD,"",2,38)
"RTN","IBCAPR",118,0)
 S IBD="Svc To Dt: "_$$DAT1^IBOUTL($P(IBM1,U,11))
"RTN","IBCAPR",119,0)
 S IBSTR=$$SETLN(IBD,IBSTR,54,25)
"RTN","IBCAPR",120,0)
 S IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",121,0)
 ;
"RTN","IBCAPR",122,0)
 ; Line 7
"RTN","IBCAPR",123,0)
 S IBCA=$P(IBM1,U)
"RTN","IBCAPR",124,0)
 S IBST=$P(IBM,U,16),IBST=$$EXPAND^IBTRE(361.1,.16,+IBST)
"RTN","IBCAPR",125,0)
 S IBSTR=""
"RTN","IBCAPR",126,0)
 I IBTY["MRA" S IBD="MRA Review Status: "_IBST,IBSTR=$$SETLN(IBD,"",2,38)
"RTN","IBCAPR",127,0)
 S IBD=$S('$G(IBSPL):"  ",1:"**")_"Reported Payment Amt: "_$S('IBCA:$J(IBX,"",2),1:$J(+IBCA,"",2))
"RTN","IBCAPR",128,0)
 S IBSTR=$$SETLN(IBD,IBSTR,41,37)
"RTN","IBCAPR",129,0)
 S IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",130,0)
 ;
"RTN","IBCAPR",131,0)
REGION2 ; MEDICARE RA Information
"RTN","IBCAPR",132,0)
 ;
"RTN","IBCAPR",133,0)
 I IBTY["MRA",$D(^IBM(361.1,IBI,21)) D
"RTN","IBCAPR",134,0)
 . S IBD=$TR($J("",35)," ","-")_"Review"_$TR($J("",38)," ","-")
"RTN","IBCAPR",135,0)
 . S IBSTR=$$SETLN(IBD,"",1,79),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",136,0)
 . S (IBST,IBCN)=0 F  S IBCN=$O(^IBM(361.1,IBI,21,IBCN)) Q:'IBCN  S X=$G(^(IBCN,0)) D
"RTN","IBCAPR",137,0)
 .. S IBST=0
"RTN","IBCAPR",138,0)
 .. S IBD="Review Date: "_$$DAT1^IBOUTL($P(X,U))
"RTN","IBCAPR",139,0)
 .. S IBSTR=$$SETLN(IBD,"",1,30)
"RTN","IBCAPR",140,0)
 .. S IBD="Reviewed By: "_$$GET1^DIQ(200,+$P(X,U,2)_", ",.01)   ; DBIA 10060
"RTN","IBCAPR",141,0)
 .. S IBSTR=$$SETLN(IBD,IBSTR,40,39)
"RTN","IBCAPR",142,0)
 .. S IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",143,0)
 .. S IBD=0 F  S IBD=$O(^IBM(361.1,IBI,21,IBCN,1,IBD)) Q:'IBD  S IBSTR=$$SETLN($S('IBST:"Comments: ",1:"")_$G(^(IBD,0)),"",1,$S('IBST:69,1:79)),IBST=1,IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",144,0)
 . I 'IBST D
"RTN","IBCAPR",145,0)
 .. S IBSTR=$$SETLN("None","",1,10)
"RTN","IBCAPR",146,0)
 .. S IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",147,0)
 Q
"RTN","IBCAPR",148,0)
 ;
"RTN","IBCAPR",149,0)
REGION3 ; CLAIM and LINE level Information
"RTN","IBCAPR",150,0)
 N Z
"RTN","IBCAPR",151,0)
 K ^TMP("PRCA_EOB",$J)
"RTN","IBCAPR",152,0)
 D GETEOB^IBCECSA6(IBI,2)
"RTN","IBCAPR",153,0)
 S Z=0 F  S Z=$O(^TMP("PRCA_EOB",$J,IBI,Z)) Q:'Z  S IBSTR=$$SETLN($G(^TMP("PRCA_EOB",$J,IBI,Z)),"",1,79),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",154,0)
 K ^TMP("PRCA_EOB",$J)
"RTN","IBCAPR",155,0)
 Q
"RTN","IBCAPR",156,0)
 ;
"RTN","IBCAPR",157,0)
REGION4 ; Display information about any 361.1 message storage or filing errors
"RTN","IBCAPR",158,0)
 N Z
"RTN","IBCAPR",159,0)
 I '$O(^IBM(361.1,IBI,"ERR",0)) Q
"RTN","IBCAPR",160,0)
 S IBSTR=$$SETLN(" ** MESSAGE STORAGE ERRORS  **","",1,79),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",161,0)
 S Z=0 F  S Z=$O(^IBM(361.1,IBI,"ERR",Z)) Q:'Z  S IBSTR=$$SETLN($G(^(Z,0)),"",1,79),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBCAPR",162,0)
 Q
"RTN","IBCAPR",163,0)
 ;
"RTN","IBCAPR",164,0)
SETLN(S,V,X,L) ; -- insert text(S) into variable(V)
"RTN","IBCAPR",165,0)
 ;    S := string to insert
"RTN","IBCAPR",166,0)
 ;    V := destination string
"RTN","IBCAPR",167,0)
 ;    X := insert @ col X
"RTN","IBCAPR",168,0)
 ;    L := clear # of chars (length)
"RTN","IBCAPR",169,0)
 Q $E(V_$J("",X-1),1,X-1)_$E(S_$J("",L),1,L)_$E(V,X+L,999)
"RTN","IBCAPR",170,0)
 ;
"RTN","IBCAPR",171,0)
SET(STR,LN) ; set up TMP array with EOB Data
"RTN","IBCAPR",172,0)
 S ^TMP("IBCAPR",$J,LN,0)=STR
"RTN","IBCAPR",173,0)
 Q LN+1
"RTN","IBCAPR",174,0)
 ;
"RTN","IBCAPR",175,0)
PRTOPT1 ; LIST MANAGER FORM entry point to print EOB, asking for print device.
"RTN","IBCAPR",176,0)
 N IBSCAN
"RTN","IBCAPR",177,0)
 D FULL^VALM1
"RTN","IBCAPR",178,0)
 D ^%ZIS Q:POP
"RTN","IBCAPR",179,0)
 F IBSCAN=1:1:$O(^TMP("IBCAPR",$J,""),-1) D
"RTN","IBCAPR",180,0)
 . U IO W ^TMP("IBCAPR",$J,IBSCAN,0),!
"RTN","IBCAPR",181,0)
 D ^%ZISC
"RTN","IBCAPR",182,0)
 D PAUSE^VALM1
"RTN","IBCAPR",183,0)
 I X="^" S VALMBCK="Q" Q
"RTN","IBCAPR",184,0)
 S VALMBCK="R"
"RTN","IBCAPR",185,0)
 Q
"RTN","IBCAPR",186,0)
 ;
"RTN","IBCAPR",187,0)
PRTOPT2 ; LIST MANAGER FORM entry point to print to default print device.
"RTN","IBCAPR",188,0)
 N IBSCAN,X,IOP
"RTN","IBCAPR",189,0)
 D FULL^VALM1
"RTN","IBCAPR",190,0)
 S VALMBCK="R"
"RTN","IBCAPR",191,0)
 S IOP=$$EOBPRT
"RTN","IBCAPR",192,0)
 D:IOP=""
"RTN","IBCAPR",193,0)
 . Write !!,"*** The default EOB Printer doesn't seem to be defined ***"
"RTN","IBCAPR",194,0)
 . D PAUSE^VALM1
"RTN","IBCAPR",195,0)
 . S X="^"
"RTN","IBCAPR",196,0)
 Q:$G(X)="^" 
"RTN","IBCAPR",197,0)
 D ^%ZIS Q:POP
"RTN","IBCAPR",198,0)
 F IBSCAN=1:1:$O(^TMP("IBCAPR",$J,""),-1) D
"RTN","IBCAPR",199,0)
 . U IO W ^TMP("IBCAPR",$J,IBSCAN,0),!
"RTN","IBCAPR",200,0)
 D ^%ZISC
"RTN","IBCAPR",201,0)
 Q
"RTN","IBCAPR",202,0)
 ;
"RTN","IBCAPR",203,0)
PRTOPT3 ; LIST MANAGER FORM entry point to print EOB and MRA, asking for print devices.
"RTN","IBCAPR",204,0)
 N IBSCAN
"RTN","IBCAPR",205,0)
 D FULL^VALM1
"RTN","IBCAPR",206,0)
 W !!,"Select Printer for the EOB",!
"RTN","IBCAPR",207,0)
 D ^%ZIS Q:POP
"RTN","IBCAPR",208,0)
 F IBSCAN=1:1:$O(^TMP("IBCAPR",$J,""),-1) D
"RTN","IBCAPR",209,0)
 . U IO W ^TMP("IBCAPR",$J,IBSCAN,0),!
"RTN","IBCAPR",210,0)
 D ^%ZISC
"RTN","IBCAPR",211,0)
 D PAUSE^VALM1
"RTN","IBCAPR",212,0)
 I X="^" S VALMBCK="Q" Q
"RTN","IBCAPR",213,0)
 W !!,"Select Printer for the MRA",!
"RTN","IBCAPR",214,0)
 D MRA^IBCEMRAA(IBIFN)
"RTN","IBCAPR",215,0)
 D PAUSE^VALM1
"RTN","IBCAPR",216,0)
 I X="^" S VALMBCK="Q" Q
"RTN","IBCAPR",217,0)
 S VALMBCK="R"
"RTN","IBCAPR",218,0)
 Q
"RTN","IBCAPR",219,0)
 ;
"RTN","IBCAPR",220,0)
PRTOPT4 ; LIST MANAGER FORM entry point to print EOB and MRA to default print devices.
"RTN","IBCAPR",221,0)
 N IBSCAN,X,IOP
"RTN","IBCAPR",222,0)
 D FULL^VALM1
"RTN","IBCAPR",223,0)
 S VALMBCK="R"
"RTN","IBCAPR",224,0)
 S IOP=$$EOBPRT
"RTN","IBCAPR",225,0)
 D:IOP=""
"RTN","IBCAPR",226,0)
 . Write !!,"*** The default EOB Printer doesn't seem to be defined ***"
"RTN","IBCAPR",227,0)
 . D PAUSE^VALM1
"RTN","IBCAPR",228,0)
 . S X="^"
"RTN","IBCAPR",229,0)
 Q:$G(X)="^" 
"RTN","IBCAPR",230,0)
 D ^%ZIS
"RTN","IBCAPR",231,0)
 F IBSCAN=1:1:$O(^TMP("IBCAPR",$J,""),-1) D
"RTN","IBCAPR",232,0)
 . U IO W ^TMP("IBCAPR",$J,IBSCAN,0),!
"RTN","IBCAPR",233,0)
 D ^%ZISC
"RTN","IBCAPR",234,0)
 S IOP=$$MRAPRT
"RTN","IBCAPR",235,0)
 D:IOP=""
"RTN","IBCAPR",236,0)
 . Write !!,"*** The default MRA Printer doesn't seem to be defined ***"
"RTN","IBCAPR",237,0)
 . D PAUSE^VALM1
"RTN","IBCAPR",238,0)
 . S X="^"
"RTN","IBCAPR",239,0)
 Q:$G(X)="^" 
"RTN","IBCAPR",240,0)
 D ^%ZIS
"RTN","IBCAPR",241,0)
 U IO
"RTN","IBCAPR",242,0)
 D PROC^IBCEMRAA
"RTN","IBCAPR",243,0)
 D ^%ZISC
"RTN","IBCAPR",244,0)
 Q
"RTN","IBCAPR",245,0)
 ;
"RTN","IBCAPR",246,0)
PRTOPT5(IBIFN) ; External entry point to print EOB information, asking for print device.
"RTN","IBCAPR",247,0)
 N IBSCAN
"RTN","IBCAPR",248,0)
 D EOB(IBIFN)
"RTN","IBCAPR",249,0)
 D ^%ZIS Q:POP 0
"RTN","IBCAPR",250,0)
 F IBSCAN=1:1:$O(^TMP("IBCAPR",$J,""),-1) D
"RTN","IBCAPR",251,0)
 . U IO W ^TMP("IBCAPR",$J,IBSCAN,0),!
"RTN","IBCAPR",252,0)
 D ^%ZISC
"RTN","IBCAPR",253,0)
 K ^TMP("IBCAPR",$J)
"RTN","IBCAPR",254,0)
 Q 1
"RTN","IBCAPR",255,0)
 ;
"RTN","IBCAPR",256,0)
PRTOPT6(IBIFN) ; External entry point to print EOB information to default print device.
"RTN","IBCAPR",257,0)
 N IBSCAN,IOP
"RTN","IBCAPR",258,0)
 I '$$PRTCHK16 Q $$PRTCHK16
"RTN","IBCAPR",259,0)
 S IOP=$$EOBPRT
"RTN","IBCAPR",260,0)
 Q:IOP="" "0^EOB PRINTER NOT DEFINED"
"RTN","IBCAPR",261,0)
 D EOB(IBIFN)
"RTN","IBCAPR",262,0)
 D ^%ZIS Q:POP
"RTN","IBCAPR",263,0)
 F IBSCAN=1:1:$O(^TMP("IBCAPR",$J,""),-1) D
"RTN","IBCAPR",264,0)
 . U IO W ^TMP("IBCAPR",$J,IBSCAN,0),!
"RTN","IBCAPR",265,0)
 D ^%ZISC
"RTN","IBCAPR",266,0)
 K ^TMP("IBCAPR",$J)
"RTN","IBCAPR",267,0)
 Q 1
"RTN","IBCAPR",268,0)
 ;
"RTN","IBCAPR",269,0)
PRTOPT7(IBIFN) ; External entry point to print EOB and MRA information, asking for print devices.
"RTN","IBCAPR",270,0)
 N IBSCAN
"RTN","IBCAPR",271,0)
 D EOB(IBIFN)
"RTN","IBCAPR",272,0)
 W !!,"Select Printer for the EOB",!
"RTN","IBCAPR",273,0)
 D ^%ZIS Q:POP 0
"RTN","IBCAPR",274,0)
 F IBSCAN=1:1:$O(^TMP("IBCAPR",$J,""),-1) D
"RTN","IBCAPR",275,0)
 . U IO W ^TMP("IBCAPR",$J,IBSCAN,0),!
"RTN","IBCAPR",276,0)
 D ^%ZISC
"RTN","IBCAPR",277,0)
 K ^TMP("IBCAPR",$J)
"RTN","IBCAPR",278,0)
 W !!,"Select Printer for the MRA",!
"RTN","IBCAPR",279,0)
 D MRA^IBCEMRAA(IBIFN)
"RTN","IBCAPR",280,0)
 Q 1
"RTN","IBCAPR",281,0)
 ;
"RTN","IBCAPR",282,0)
PRTOPT8(IBIFN) ; External entry point to print EOB and MRA information to default print devices.
"RTN","IBCAPR",283,0)
 N IBSCAN,IOP
"RTN","IBCAPR",284,0)
 I '$$PRTCHK16 Q $$PRTCHK16
"RTN","IBCAPR",285,0)
 S IOP=$$EOBPRT
"RTN","IBCAPR",286,0)
 Q:IOP="" "0^EOB PRINTER NOT DEFINED"
"RTN","IBCAPR",287,0)
 D EOB(IBIFN)
"RTN","IBCAPR",288,0)
 D ^%ZIS Q:POP "0^EOB PRINTER NOT DEFINED CORRECTLY"
"RTN","IBCAPR",289,0)
 F IBSCAN=1:1:$O(^TMP("IBCAPR",$J,""),-1) D
"RTN","IBCAPR",290,0)
 . U IO W ^TMP("IBCAPR",$J,IBSCAN,0),!
"RTN","IBCAPR",291,0)
 D ^%ZISC
"RTN","IBCAPR",292,0)
 K ^TMP("IBCAPR",$J)
"RTN","IBCAPR",293,0)
 I '$$PRTCHK14 Q $$PRTCHK14
"RTN","IBCAPR",294,0)
 S IOP=$$MRAPRT
"RTN","IBCAPR",295,0)
 Q:IOP="" "0^MRA PRINTER NOT DEFINED"
"RTN","IBCAPR",296,0)
 D ^%ZIS Q:POP "0^MRA PRINTER NOT DEFINED CORRECTLY"
"RTN","IBCAPR",297,0)
 U IO
"RTN","IBCAPR",298,0)
 D PROC^IBCEMRAA
"RTN","IBCAPR",299,0)
 D ^%ZISC
"RTN","IBCAPR",300,0)
 Q 1
"RTN","IBCAPR",301,0)
 ;
"RTN","IBCAPR",302,0)
PRINT8Q(IBIFN) ; External entry point to QUEUE the EOB and MRA print jobs
"RTN","IBCAPR",303,0)
 ; Queue to Print EOB portion to the default EOB printer.
"RTN","IBCAPR",304,0)
 N %ZIS,ZTDTH,ZTRTN,ZTSAVE,ZTDESC,POP,IOP,IBTSK1,IBTSK2
"RTN","IBCAPR",305,0)
 I '$G(IBIFN) Q "0^CLAIM NUMBER NOT DEFINED"
"RTN","IBCAPR",306,0)
 I '$$PRTCHK16 Q $$PRTCHK16
"RTN","IBCAPR",307,0)
 S IOP=$$EOBPRT
"RTN","IBCAPR",308,0)
 Q:IOP="" "0^EOB PRINTER NOT DEFINED"
"RTN","IBCAPR",309,0)
 S %ZIS="QN"
"RTN","IBCAPR",310,0)
 D ^%ZIS I POP Q "0^EOB PRINTER NOT DEFINED CORRECTLY"
"RTN","IBCAPR",311,0)
 S ZTRTN="PRINT8Q1^IBCAPR"   ; Background re-entry point.
"RTN","IBCAPR",312,0)
 S ZTDESC="EOB PRINT"
"RTN","IBCAPR",313,0)
 S ZTSAVE("IB*")=""
"RTN","IBCAPR",314,0)
 S ZTDTH=$H
"RTN","IBCAPR",315,0)
 D ^%ZTLOAD S IBTSK1=$G(ZTSK)
"RTN","IBCAPR",316,0)
 K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBCAPR",317,0)
 ; Queue to Print MRA portion to the default MRA printer.
"RTN","IBCAPR",318,0)
 K %ZIS,ZTRTN,ZTSAVE,ZTDESC,POP
"RTN","IBCAPR",319,0)
 I '$$PRTCHK14 Q $$PRTCHK14
"RTN","IBCAPR",320,0)
 S IOP=$$MRAPRT
"RTN","IBCAPR",321,0)
 Q:IOP="" "0^MRA PRINTER NOT DEFINED"
"RTN","IBCAPR",322,0)
 S IBIFN=$$GETMRACL(IBIFN)
"RTN","IBCAPR",323,0)
 Q:'IBIFN "0^NO MRA CLAIM TO PRINT"
"RTN","IBCAPR",324,0)
 S %ZIS="QN"
"RTN","IBCAPR",325,0)
 D ^%ZIS I POP Q "0^MRA PRINTER NOT DEFINED CORRECTLY"
"RTN","IBCAPR",326,0)
 S ZTRTN="PROC^IBCEMRAA"   ; Background re-entry point.
"RTN","IBCAPR",327,0)
 S ZTDESC="MRA PRINT"
"RTN","IBCAPR",328,0)
 S ZTSAVE("IB*")=""
"RTN","IBCAPR",329,0)
 S ZTDTH=$H
"RTN","IBCAPR",330,0)
 D ^%ZTLOAD S IBTSK2=$G(ZTSK)
"RTN","IBCAPR",331,0)
 K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBCAPR",332,0)
 Q 1_"^"_IBTSK1_"^"_IBTSK2
"RTN","IBCAPR",333,0)
PRINT8Q1 ; Background re-entry point.
"RTN","IBCAPR",334,0)
 D EOB(IBIFN)
"RTN","IBCAPR",335,0)
 F IBSCAN=1:1:$O(^TMP("IBCAPR",$J,""),-1) D
"RTN","IBCAPR",336,0)
 . W ^TMP("IBCAPR",$J,IBSCAN,0),!
"RTN","IBCAPR",337,0)
 D ^%ZISC
"RTN","IBCAPR",338,0)
 Q
"RTN","IBCAPR",339,0)
 ;
"RTN","IBCAPR",340,0)
EOBPRT() ; Get EOB Printer Name
"RTN","IBCAPR",341,0)
 Q $$GET1^DIQ(350.9,"1, ",8.16)
"RTN","IBCAPR",342,0)
 ;
"RTN","IBCAPR",343,0)
MRAPRT() ; Get MRA Printer Name
"RTN","IBCAPR",344,0)
 Q $$GET1^DIQ(350.9,"1, ",8.19)
"RTN","IBCAPR",345,0)
 ;
"RTN","IBCAPR",346,0)
PRTCHK(ERROR) ;  ; Validate ALL printer parameters.
"RTN","IBCAPR",347,0)
 ; USAGE EXAMPLES:  W $$PRTCHK^IBCAPR(.ERRMSG)," ",ERRMSG,!
"RTN","IBCAPR",348,0)
 ;                  I '$$PRTCHK^IBCAPR Q
"RTN","IBCAPR",349,0)
 N X,ERR14,ERR15,ERR16,ERR19,STATUS
"RTN","IBCAPR",350,0)
 S ERROR="",STATUS=1
"RTN","IBCAPR",351,0)
 S:'$$PRTCHK14(.X,.ERR14) STATUS=0
"RTN","IBCAPR",352,0)
 S:'$$PRTCHK15(.X,.ERR15) STATUS=0
"RTN","IBCAPR",353,0)
 S:'$$PRTCHK16(.X,.ERR16) STATUS=0
"RTN","IBCAPR",354,0)
 S:'$$PRTCHK19(.X,.ERR19) STATUS=0
"RTN","IBCAPR",355,0)
 Q:STATUS 1
"RTN","IBCAPR",356,0)
 I ERR14'="" S ERROR=ERR14
"RTN","IBCAPR",357,0)
 I ERR15'="" S ERROR=ERROR_$S(ERROR="":ERR15,1:", "_ERR15)
"RTN","IBCAPR",358,0)
 I ERR16'="" S ERROR=ERROR_$S(ERROR="":ERR16,1:", "_ERR16)
"RTN","IBCAPR",359,0)
 I ERR19'="" S ERROR=ERROR_$S(ERROR="":ERR19,1:", "_ERR19)
"RTN","IBCAPR",360,0)
 Q 0
"RTN","IBCAPR",361,0)
 ;
"RTN","IBCAPR",362,0)
PRTCHK14(PRTNM,ERROR) ; Validate the CMS-1500 printer parameter.
"RTN","IBCAPR",363,0)
 ; USAGE EXAMPLES:  I $$PRTCHK14^IBCAPR(.NAME,.ERRMSG) S IOP=NAME
"RTN","IBCAPR",364,0)
 ;                  I '$$PRTCHK14^IBCAPR Q
"RTN","IBCAPR",365,0)
 N POP
"RTN","IBCAPR",366,0)
 S ERROR=""
"RTN","IBCAPR",367,0)
 S IOP=$$CMS1500^IBCAPR1(),PRTNM=IOP
"RTN","IBCAPR",368,0)
 I IOP="" S ERROR="CMS-1500 PRINTER NOT DEFINED" Q "0^"_ERROR
"RTN","IBCAPR",369,0)
 S %ZIS="QN"
"RTN","IBCAPR",370,0)
 D ^%ZIS I POP S ERROR="CMS-1500 PRINTER NOT DEFINED CORRECTLY" Q "0^"_ERROR
"RTN","IBCAPR",371,0)
 Q 1
"RTN","IBCAPR",372,0)
 ;
"RTN","IBCAPR",373,0)
PRTCHK15(PRTNM,ERROR) ; Validate the UB-04 printer parameter.
"RTN","IBCAPR",374,0)
 ; USAGE EXAMPLE:  I $$PRTCHK15^IBCAPR(.NAME,.ERRMSG) S IOP=NAME
"RTN","IBCAPR",375,0)
 ;                  I '$$PRTCHK15^IBCAPR Q
"RTN","IBCAPR",376,0)
 N POP
"RTN","IBCAPR",377,0)
 S ERROR=""
"RTN","IBCAPR",378,0)
 S IOP=$$UB4PRT^IBCAPR1(),PRTNM=IOP
"RTN","IBCAPR",379,0)
 I IOP="" S ERROR="UB-04 PRINTER NOT DEFINED" Q "0^"_ERROR
"RTN","IBCAPR",380,0)
 S %ZIS="QN"
"RTN","IBCAPR",381,0)
 D ^%ZIS I POP S ERROR="UB-04 PRINTER NOT DEFINED CORRECTLY" Q "0^"_ERROR
"RTN","IBCAPR",382,0)
 Q 1
"RTN","IBCAPR",383,0)
 ;
"RTN","IBCAPR",384,0)
PRTCHK16(PRTNM,ERROR) ; Validate the EOB printer parameter.
"RTN","IBCAPR",385,0)
 ; USAGE EXAMPLE:  I $$PRTCHK16^IBCAPR(.NAME,.ERRMSG) S IOP=NAME
"RTN","IBCAPR",386,0)
 ;                  I '$$PRTCHK16^IBCAPR Q
"RTN","IBCAPR",387,0)
 N POP
"RTN","IBCAPR",388,0)
 S ERROR=""
"RTN","IBCAPR",389,0)
 S IOP=$$EOBPRT(),PRTNM=IOP
"RTN","IBCAPR",390,0)
 I IOP="" S ERROR="EOB PRINTER NOT DEFINED" Q "0^"_ERROR
"RTN","IBCAPR",391,0)
 S %ZIS="QN"
"RTN","IBCAPR",392,0)
 D ^%ZIS I POP S ERROR="EOB PRINTER NOT DEFINED CORRECTLY" Q "0^"_ERROR
"RTN","IBCAPR",393,0)
 Q 1
"RTN","IBCAPR",394,0)
 ;
"RTN","IBCAPR",395,0)
PRTCHK19(PRTNM,ERROR) ; Validate the MRA printer parameter.
"RTN","IBCAPR",396,0)
 ; USAGE EXAMPLE:  I $$PRTCHK19^IBCAPR(.NAME,.ERRMSG) S IOP=NAME
"RTN","IBCAPR",397,0)
 ;                  I '$$PRTCHK19^IBCAPR Q
"RTN","IBCAPR",398,0)
 N POP
"RTN","IBCAPR",399,0)
 S ERROR=""
"RTN","IBCAPR",400,0)
 S IOP=$$MRAPRT(),PRTNM=IOP
"RTN","IBCAPR",401,0)
 I IOP="" S ERROR="MRA PRINTER NOT DEFINED" Q "0^"_ERROR
"RTN","IBCAPR",402,0)
 S %ZIS="QN"
"RTN","IBCAPR",403,0)
 D ^%ZIS I POP S ERROR="MRA PRINTER NOT DEFINED CORRECTLY" Q "0^"_ERROR
"RTN","IBCAPR",404,0)
 Q 1
"RTN","IBCAPR",405,0)
 ;
"RTN","IBCAPR",406,0)
GETIBIFN() ; Get Internal Claim Pointer
"RTN","IBCAPR",407,0)
 N DIR,IBDA,IBIFN S IBIFN=""
"RTN","IBCAPR",408,0)
 D FULL^VALM1
"RTN","IBCAPR",409,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","IBCAPR",410,0)
 S IBDA=$O(VALMY(0))
"RTN","IBCAPR",411,0)
 S:IBDA IBIFN=$P($G(^TMP("IBCECOB",$J,IBDA)),U,2)
"RTN","IBCAPR",412,0)
 Q IBIFN
"RTN","IBCAPR",413,0)
 ;
"RTN","IBCAPR",414,0)
GETMRACL(IBIFN) ; Get MRA claim #
"RTN","IBCAPR",415,0)
 ; Find if there was MEDICARE WNR on the bill being passed in and then get the claim associated with it.
"RTN","IBCAPR",416,0)
 N IBMRASEQ,IBWNRFL,IBM1,IBMRACL
"RTN","IBCAPR",417,0)
 F IBMRASEQ=1:1:3 S IBWNRFL=$$WNRBILL^IBEFUNC(IBIFN,IBMRASEQ) Q:+IBWNRFL
"RTN","IBCAPR",418,0)
 I '+IBWNRFL Q 0  ; No Medicare WNR on Bill
"RTN","IBCAPR",419,0)
 S IBM1=$G(^DGCR(399,IBIFN,"M1"))
"RTN","IBCAPR",420,0)
 S IBMRACL=$P(IBM1,U,4+IBMRASEQ)
"RTN","IBCAPR",421,0)
 I +IBMRACL Q IBMRACL
"RTN","IBCAPR",422,0)
 ;
"RTN","IBCAPR",423,0)
 ; Since Medicare WNR does not generate a new bill # and hence may not
"RTN","IBCAPR",424,0)
 ; point to a previous bill, this may need to grab the secondary bill
"RTN","IBCAPR",425,0)
 I IBMRASEQ=1 S IBMRACL=$P(IBM1,U,6)
"RTN","IBCAPR",426,0)
 ;
"RTN","IBCAPR",427,0)
 Q +IBMRACL
"RTN","IBCAPR",428,0)
 ;
"RTN","IBCAPR",429,0)
GETEOBCL(IBIFN,IBALL) ; Get all Claims associated with this one. 
"RTN","IBCAPR",430,0)
 ; If it's secondary, get primary
"RTN","IBCAPR",431,0)
 ; If it's a tertiary, get secondary and primary
"RTN","IBCAPR",432,0)
 ; Input: IBIFN - IEN to 399 for cliam being printed
"RTN","IBCAPR",433,0)
 ;        IBALL by reference 
"RTN","IBCAPR",434,0)
 ; Output: IBALL - Array of claim numbers which have EOBS for this claim.
"RTN","IBCAPR",435,0)
 N IBCOBN,IBPRVCL,IBM1,LOOP
"RTN","IBCAPR",436,0)
 S IBALL(IBIFN)=""
"RTN","IBCAPR",437,0)
 S IBM1=$G(^DGCR(399,IBIFN,"M1"))
"RTN","IBCAPR",438,0)
 S IBCOBN=$$COBN^IBCEF(IBIFN)-1
"RTN","IBCAPR",439,0)
 Q:IBCOBN<1
"RTN","IBCAPR",440,0)
 F LOOP=IBCOBN:-1:1 S IBPRVCL=$P(IBM1,U,4+LOOP) S:IBPRVCL]"" IBALL(IBPRVCL)=""
"RTN","IBCAPR",441,0)
 Q
"RTN","IBCAPR1")
0^54^B7280643^n/a
"RTN","IBCAPR1",1,0)
IBCAPR1 ;ALB/GEF - CAPR PRINT FUNCTIONS ;OCT 1 2010
"RTN","IBCAPR1",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCAPR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCAPR1",4,0)
 ;
"RTN","IBCAPR1",5,0)
 Q
"RTN","IBCAPR1",6,0)
 ;
"RTN","IBCAPR1",7,0)
STFLP(IBIFN) ;Secondary/Tertiary Force Local Print
"RTN","IBCAPR1",8,0)
 ; Forces automatically generated secondary/tertiary claims to electronic payers to print 
"RTN","IBCAPR1",9,0)
 ; locally based upon flag in the Insurance Company file 
"RTN","IBCAPR1",10,0)
 ; Required input = IBIFN (claim internal entry#)
"RTN","IBCAPR1",11,0)
 ; Returns 1 if printed successfully
"RTN","IBCAPR1",12,0)
 ; Otherwise, returns 0^Reason not printed
"RTN","IBCAPR1",13,0)
 ;
"RTN","IBCAPR1",14,0)
 N IBF,IB,IBFT,IBJ,IBDV,Z,IBINS
"RTN","IBCAPR1",15,0)
 S Z=$$COBN^IBCEF(IBIFN)
"RTN","IBCAPR1",16,0)
 S IBINS=$$POLICY^IBCEF(IBIFN,1,Z)
"RTN","IBCAPR1",17,0)
 Q:$P($G(^DIC(36,IBINS,6)),U,9)'=1 "0^Insurance Company not set to print locally"
"RTN","IBCAPR1",18,0)
 S IB=$$FT^IBCU3(IBIFN) ; form type ien (2 or 3)
"RTN","IBCAPR1",19,0)
 Q:"2^3"'[IB "0^Form type not 2 or 3"
"RTN","IBCAPR1",20,0)
 S IBFT=$$FTN^IBCU3(IB) ; form type name
"RTN","IBCAPR1",21,0)
 S IBF=$P($G(^IBE(353,+IB,2)),U,8)
"RTN","IBCAPR1",22,0)
 S:IBF="" IBF=IB ;Forces the use of the output formatter to print bills
"RTN","IBCAPR1",23,0)
 ; get default CMS or UB printer (based on claim form type)
"RTN","IBCAPR1",24,0)
 S IBDV=$S(IB=2:$$CMS1500(),1:$$UB4PRT())
"RTN","IBCAPR1",25,0)
 Q:IBDV="" "0^Auto-printer not defined in IB Site Parameters"
"RTN","IBCAPR1",26,0)
 Q:'$$FORM(IBF,IB,IBDV) "0^Claim Print not tasked"
"RTN","IBCAPR1",27,0)
 K ^TMP("IBQONE",$J)
"RTN","IBCAPR1",28,0)
 I IBF=2 D RXP
"RTN","IBCAPR1",29,0)
 ; Print EOB
"RTN","IBCAPR1",30,0)
 Q $$PRINT8Q^IBCAPR(IBIFN)
"RTN","IBCAPR1",31,0)
 ;
"RTN","IBCAPR1",32,0)
RXP ;queue an Rx Addendum for a bill, IBIFN must be defined
"RTN","IBCAPR1",33,0)
 N IBFORM1
"RTN","IBCAPR1",34,0)
 Q:'$D(^DGCR(399,+$G(IBIFN),0))  I '$D(^IBA(362.4,"AIFN"_+IBIFN)),'$D(^IBA(362.5,"AIFN"_+IBIFN)) Q
"RTN","IBCAPR1",35,0)
 N IBFT S IBFT=$$FNT^IBCU3("BILL ADDENDUM") Q:'IBFT  S (IBFORM1,ZTDESC)="BILL ADDENDUM FOR "_$P(^DGCR(399,+IBIFN,0),U,1)
"RTN","IBCAPR1",36,0)
 S ZTSAVE("IB*")="",ZTDTH=$H
"RTN","IBCAPR1",37,0)
 S ZTIO=$P($G(^IBE(353,IBFT,0)),"^",2),ZTRTN=$G(^IBE(353,IBFT,1)) I (ZTIO="")!(ZTRTN="") K ZTDESC,ZTSAVE,ZTDTH,ZTIO,ZTRTN Q
"RTN","IBCAPR1",38,0)
 D ^%ZTLOAD
"RTN","IBCAPR1",39,0)
 Q
"RTN","IBCAPR1",40,0)
 ;
"RTN","IBCAPR1",41,0)
FORM(IBFORM,IB,IBQUE) ;For ien IBFORM, extract data using output generater
"RTN","IBCAPR1",42,0)
 ; Queued job entrypoint - IBFORM needs to be defined
"RTN","IBCAPR1",43,0)
 ; IBQUE = the output queue for transmitted forms or the printer queue
"RTN","IBCAPR1",44,0)
 ;          for printed output
"RTN","IBCAPR1",45,0)
 ; Returns ZTSK if job is queued sucessfully
"RTN","IBCAPR1",46,0)
 ;
"RTN","IBCAPR1",47,0)
 N ZTIO,ZTRTN,ZTDESC,ZTSAVE,ZTREQ,ZTDTH,IBFT,IBFTP,IBJ,ZTSK
"RTN","IBCAPR1",48,0)
 S %ZIS="QN"
"RTN","IBCAPR1",49,0)
 S IBFT=IB,IBFTP="IBCFP"_IB,IBJ=$J
"RTN","IBCAPR1",50,0)
 K ^XTMP(IBFTP,$J),^TMP("IBQONE",$J)
"RTN","IBCAPR1",51,0)
 S ^XTMP(IBFTP,$J,1,1,1,IBIFN)="",^TMP("IBQONE",$J)=""
"RTN","IBCAPR1",52,0)
 S ZTRTN="FORMOUT^IBCEFG7",ZTIO=IBQUE,ZTDESC="OUTPUT FORMATTER - FORM: "_$P($G(^IBE(353,IBFORM,0)),U),ZTSAVE("IB*")="",ZTDTH=$$NOW^XLFDT()
"RTN","IBCAPR1",53,0)
 S:'$G(DUZ) DUZ=.5
"RTN","IBCAPR1",54,0)
 D ^%ZTLOAD
"RTN","IBCAPR1",55,0)
 Q:'$D(ZTSK) "0^Claim Print not tasked"
"RTN","IBCAPR1",56,0)
 Q "1^"_ZTSK
"RTN","IBCAPR1",57,0)
 ;
"RTN","IBCAPR1",58,0)
UB4PRT() ; Get UB4 Printer Name
"RTN","IBCAPR1",59,0)
 Q $$GET1^DIQ(350.9,"1, ",8.15)
"RTN","IBCAPR1",60,0)
 ;
"RTN","IBCAPR1",61,0)
CMS1500() ; Get CMS1500 Printer Name
"RTN","IBCAPR1",62,0)
 Q $$GET1^DIQ(350.9,"1, ",8.14)
"RTN","IBCAPR1",63,0)
 ;
"RTN","IBCAPR2")
0^100^B99779459^n/a
"RTN","IBCAPR2",1,0)
IBCAPR2 ;ALB/BI - PRINT EOB/MRA ;20-SEP-2010
"RTN","IBCAPR2",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCAPR2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCAPR2",4,0)
 ;
"RTN","IBCAPR2",5,0)
 Q
"RTN","IBCAPR2",6,0)
 ;
"RTN","IBCAPR2",7,0)
EN(IBIFN) ; -- main entry point for IBCAPR2
"RTN","IBCAPR2",8,0)
 N IBI,IBICNT,EOBDATE
"RTN","IBCAPR2",9,0)
 N FRMTYP,INPAT,IBALL,IBSHEOB
"RTN","IBCAPR2",10,0)
 ;
"RTN","IBCAPR2",11,0)
 S VALMBCK="R"
"RTN","IBCAPR2",12,0)
 I '$G(IBIFN),$D(VALMBG),$D(VALMLST) S IBIFN=$$GETIBIFN
"RTN","IBCAPR2",13,0)
 Q:$G(IBIFN)=""
"RTN","IBCAPR2",14,0)
 S FRMTYP=$$FT^IBCEF(IBIFN)    ;Form Type
"RTN","IBCAPR2",15,0)
 S INPAT=$$INPAT^IBCEF(IBIFN)  ;Inpatient Flag
"RTN","IBCAPR2",16,0)
 ;
"RTN","IBCAPR2",17,0)
 D GETEOBCL^IBCAPR(IBIFN,.IBALL)  ; get all associated claims
"RTN","IBCAPR2",18,0)
 D GETEOBS(.IBALL,.IBSHEOB)  ; get all eobs associated with these claims
"RTN","IBCAPR2",19,0)
 S IBICNT=$$MRACNT^IBCEMU1(IBIFN,0) ; count of MRAs
"RTN","IBCAPR2",20,0)
 I $D(IBSHEOB) S IBI="",IBICNT="" F  S IBI=$O(IBSHEOB(IBI)) Q:IBI=""  S IBICNT=IBICNT+1  ; count of EOBs (reset counter since MRAs are in here)
"RTN","IBCAPR2",21,0)
 ;
"RTN","IBCAPR2",22,0)
 I IBICNT<1 D  Q
"RTN","IBCAPR2",23,0)
 . D FULL^VALM1
"RTN","IBCAPR2",24,0)
 . W !!?5,"There is no electronic EOB for this claim."
"RTN","IBCAPR2",25,0)
 . D PAUSE^VALM1
"RTN","IBCAPR2",26,0)
 . Q
"RTN","IBCAPR2",27,0)
 I IBICNT=1 D  Q
"RTN","IBCAPR2",28,0)
 .S EOBDATE=$O(^IBM(361.1,"ABD",IBIFN,"")) Q:'EOBDATE
"RTN","IBCAPR2",29,0)
 .S IBI=$O(^IBM(361.1,"ABD",IBIFN,EOBDATE,0)) Q:'IBI
"RTN","IBCAPR2",30,0)
 .I $$MRACNT^IBCEMU1(IBIFN,0) D MRAPRINT(IBI) Q
"RTN","IBCAPR2",31,0)
 .I $$MRACNT^IBCEMU1(IBIFN,1) D EOBPRINT(IBI) Q
"RTN","IBCAPR2",32,0)
 ;
"RTN","IBCAPR2",33,0)
 S IBI=$$SEL(.IBSHEOB)
"RTN","IBCAPR2",34,0)
 I +IBI=0 Q
"RTN","IBCAPR2",35,0)
 ;
"RTN","IBCAPR2",36,0)
 I $P($G(^IBM(361.1,IBI,0)),U,4)=1 D MRAPRINT(IBI) Q
"RTN","IBCAPR2",37,0)
 ;
"RTN","IBCAPR2",38,0)
 I $P($G(^IBM(361.1,IBI,0)),U,4)'=1 D EOBPRINT(IBI) Q
"RTN","IBCAPR2",39,0)
 ;
"RTN","IBCAPR2",40,0)
 Q
"RTN","IBCAPR2",41,0)
 ;
"RTN","IBCAPR2",42,0)
EOBPRINT(IBI,IBSHEOB) ; PRINT THE REQUESTED EOB
"RTN","IBCAPR2",43,0)
 N %ZIS,POP,FULLSTOP
"RTN","IBCAPR2",44,0)
 S FULLSTOP=0
"RTN","IBCAPR2",45,0)
 S %ZIS("A")="EOB Device: "
"RTN","IBCAPR2",46,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","IBCAPR2",47,0)
 I $D(IO("Q")) D  G EOBQUIT
"RTN","IBCAPR2",48,0)
 . S ZTRTN="REGION0^IBCAPR2(IBI,.IBSHEOB)"
"RTN","IBCAPR2",49,0)
 . S ZTSAVE("IB*")="",ZTSAVE("IEN")="",ZTSAVE("FRMTYP")="",ZTSAVE("INPAT")="",ZTSAVE("EOBDATE")=""
"RTN","IBCAPR2",50,0)
 . S ZTDESC="IB - EOB PRINTING"
"RTN","IBCAPR2",51,0)
 . D ^%ZTLOAD
"RTN","IBCAPR2",52,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","IBCAPR2",53,0)
 . K IO("Q"),ZTSK D HOME^%ZIS
"RTN","IBCAPR2",54,0)
 U IO D REGION0(IBI,.IBSHEOB)
"RTN","IBCAPR2",55,0)
EOBQUIT ;
"RTN","IBCAPR2",56,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBCAPR2",57,0)
 I FULLSTOP=0,$E(IOST,1,2)["C-" D PAUSE^VALM1
"RTN","IBCAPR2",58,0)
 D ^%ZISC
"RTN","IBCAPR2",59,0)
 Q
"RTN","IBCAPR2",60,0)
 ;
"RTN","IBCAPR2",61,0)
MRAPRINT(IBI) ; PRINT THE REQUESTED MRA
"RTN","IBCAPR2",62,0)
 N IEN,%ZIS,POP
"RTN","IBCAPR2",63,0)
 N IBQUIT,IBPGN S IBQUIT=0
"RTN","IBCAPR2",64,0)
 S IEN=IBI
"RTN","IBCAPR2",65,0)
 S %ZIS("A")="MRA Device: "
"RTN","IBCAPR2",66,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","IBCAPR2",67,0)
 I $D(IO("Q")) D  G MRAQUIT
"RTN","IBCAPR2",68,0)
 . S ZTRTN="PRNTMRA^IBCEMRAA"
"RTN","IBCAPR2",69,0)
 . S ZTSAVE("IB*")="",ZTSAVE("IEN")="",ZTSAVE("FRMTYP")="",ZTSAVE("INPAT")="",ZTSAVE("EOBDATE")=""
"RTN","IBCAPR2",70,0)
 . S ZTDESC="IB - MRA PRINTING"
"RTN","IBCAPR2",71,0)
 . D ^%ZTLOAD
"RTN","IBCAPR2",72,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","IBCAPR2",73,0)
 . K IO("Q"),ZTSK D HOME^%ZIS
"RTN","IBCAPR2",74,0)
 U IO D PRNTMRA^IBCEMRAA
"RTN","IBCAPR2",75,0)
MRAQUIT ;
"RTN","IBCAPR2",76,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBCAPR2",77,0)
 I $E(IOST,1,2)["C-" D PAUSE^VALM1
"RTN","IBCAPR2",78,0)
 D ^%ZISC
"RTN","IBCAPR2",79,0)
 Q
"RTN","IBCAPR2",80,0)
 ;
"RTN","IBCAPR2",81,0)
GETIBIFN() ; Get Internal Claim Pointer
"RTN","IBCAPR2",82,0)
 N DIR,IBDA,IBIFN S IBIFN=""
"RTN","IBCAPR2",83,0)
 D FULL^VALM1
"RTN","IBCAPR2",84,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","IBCAPR2",85,0)
 S IBDA=$O(VALMY(0))
"RTN","IBCAPR2",86,0)
 S:IBDA IBIFN=$P($G(^TMP("IBCECOB",$J,IBDA)),U,2)
"RTN","IBCAPR2",87,0)
 Q IBIFN
"RTN","IBCAPR2",88,0)
 ;
"RTN","IBCAPR2",89,0)
WRITE(IBSTR) ;
"RTN","IBCAPR2",90,0)
 W IBSTR,!
"RTN","IBCAPR2",91,0)
 Q $$PAUSE
"RTN","IBCAPR2",92,0)
 ;
"RTN","IBCAPR2",93,0)
PAUSE() ;
"RTN","IBCAPR2",94,0)
 Q:$E(IOST,1,2)'["C-" 0
"RTN","IBCAPR2",95,0)
 I $Y>(IOSL-5) D  W @IOF,*13 I $D(DIRUT)!($D(DUOUT)) S FULLSTOP=1 K DIRUT,DTOUT,DUOUT Q 1
"RTN","IBCAPR2",96,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","IBCAPR2",97,0)
 Q 0
"RTN","IBCAPR2",98,0)
 ;
"RTN","IBCAPR2",99,0)
 ; ---------- Start of EOB Printing Section ----------
"RTN","IBCAPR2",100,0)
REGION0(IBI,IBSHEOB) ; Print one or several EOBS depending what is passed in.
"RTN","IBCAPR2",101,0)
 ; Input:  IEN to EOB file 361.1 if only one to be printed
"RTN","IBCAPR2",102,0)
 ; Input: IBSHEOB (optional) array of EOBs to be printed
"RTN","IBCAPR2",103,0)
 I $G(IBI) D REGION1(IBI) Q
"RTN","IBCAPR2",104,0)
 S IBI=0 F  S IBI=$O(IBSHEOB(IBI)) Q:'+IBI  D REGION1(IBI) I $O(IBSHEOB(IBI)) W @IOF
"RTN","IBCAPR2",105,0)
 Q
"RTN","IBCAPR2",106,0)
REGION1(IBI) ; EOB Claim Header Information 
"RTN","IBCAPR2",107,0)
 N IBD,IBSTR,IBX,IBM,IBM1,IBM2,IBCA,IBCN
"RTN","IBCAPR2",108,0)
 N IBPR,IBPT,IBPY,IBST,IBTA,IBTS,IBTY,IBSPL
"RTN","IBCAPR2",109,0)
 ;
"RTN","IBCAPR2",110,0)
 ; Line 1
"RTN","IBCAPR2",111,0)
 S IBD="EOB/MRA Information"
"RTN","IBCAPR2",112,0)
 S IBSTR=$$SETLN(IBD,"",30,45) Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",113,0)
 ;
"RTN","IBCAPR2",114,0)
 ; Line 2
"RTN","IBCAPR2",115,0)
 ; IBSPL = 0 if EOB represents one bill's payment
"RTN","IBCAPR2",116,0)
 ;       = 1 if AR had to split the EOB between multiple bills
"RTN","IBCAPR2",117,0)
 S IBSPL=+$O(^IBM(361.1,IBI,8,0)),IBSPL=(+$O(^(IBSPL))'=IBSPL)
"RTN","IBCAPR2",118,0)
 S IBM=$G(^IBM(361.1,IBI,0))
"RTN","IBCAPR2",119,0)
 S IBTY=$P(IBM,U,4),IBTY=$S(IBTY:"MEDICARE MRA",1:"NORMAL EOB")
"RTN","IBCAPR2",120,0)
 I IBTY'["MRA",IBSPL S IBTY="A/R SPLIT/COVERS MORE THAN 1 BILL"
"RTN","IBCAPR2",121,0)
 I $P(IBM,U,13)>1,$P(IBM,U,13)<5 S IBTY=IBTY_" ("_$$EXTERNAL^DILFD(361.1,.13,,$P(IBM,U,13))_")"
"RTN","IBCAPR2",122,0)
 S IBD="EOB Type: "_IBTY,IBSTR=$$SETLN(IBD,"",5,25)
"RTN","IBCAPR2",123,0)
 S IBD="Claim Number: "_$$GET1^DIQ(399,IBIFN_", ",.01),IBSTR=$$SETLN(IBD,IBSTR,51,25)
"RTN","IBCAPR2",124,0)
 Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",125,0)
 ;
"RTN","IBCAPR2",126,0)
 ; Line 3
"RTN","IBCAPR2",127,0)
 S IBCN=$P(IBM,U,14)
"RTN","IBCAPR2",128,0)
 S IBX="0.00"
"RTN","IBCAPR2",129,0)
 S IBD="ICN: "_IBCN,IBSTR=$$SETLN(IBD,"",10,30)
"RTN","IBCAPR2",130,0)
 S IBM1=$G(^IBM(361.1,IBI,1))
"RTN","IBCAPR2",131,0)
 S IBPT=$P(IBM1,U,2)   ; patient responsibility 1.02 field
"RTN","IBCAPR2",132,0)
 I $P(IBM,U,4),$D(^IBM(361.1,IBI,"ERR")) S IBPT=0  ; filing error
"RTN","IBCAPR2",133,0)
 ; If MRA & UB, then calculate patient responsiblity value
"RTN","IBCAPR2",134,0)
 I $P(IBM,U,4),$$FT^IBCEF(+$P(IBM,U,1))=3 S IBPT=$$PTRESPI^IBCECOB1(IBI)
"RTN","IBCAPR2",135,0)
 S IBD="Patient Resp Amount: "_$S('IBPT:IBX,1:IBPT)
"RTN","IBCAPR2",136,0)
 S IBSTR=$$SETLN(IBD,IBSTR,44,35)
"RTN","IBCAPR2",137,0)
 Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",138,0)
 ;
"RTN","IBCAPR2",139,0)
 ; Line 4
"RTN","IBCAPR2",140,0)
 S IBPY=$$GET1^DIQ(36,+$P(IBM,U,2)_", ",.01)
"RTN","IBCAPR2",141,0)
 S IBM2=$G(^IBM(361.1,IBI,2)),IBTA=$P(IBM2,U,3)
"RTN","IBCAPR2",142,0)
 ; if no Total Allowed Amount, sum up amounts on Line Level Adjustment
"RTN","IBCAPR2",143,0)
 I IBTA="" S IBTA=$$ALLOWED^IBCEMU2(IBI)
"RTN","IBCAPR2",144,0)
 S IBD="Payer Name: "_IBPY,IBSTR=$$SETLN(IBD,"",3,40)
"RTN","IBCAPR2",145,0)
 S IBD="Total Allowed Amount: "_$S('IBTA:IBX,1:IBTA)
"RTN","IBCAPR2",146,0)
 S IBSTR=$$SETLN(IBD,IBSTR,43,36)
"RTN","IBCAPR2",147,0)
 Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",148,0)
 ;
"RTN","IBCAPR2",149,0)
 ; Line 5
"RTN","IBCAPR2",150,0)
 S IBTS=$P(IBM2,U,4)
"RTN","IBCAPR2",151,0)
 S IBPR=$$FMTE^XLFDT($P(IBM,U,6))
"RTN","IBCAPR2",152,0)
 S IBD="EOB Date: "_IBPR,IBSTR=$$SETLN(IBD,"",5,35)
"RTN","IBCAPR2",153,0)
 S IBD="Total Submitted Charges: "_$S('IBTS:IBX,1:IBTS)
"RTN","IBCAPR2",154,0)
 S IBSTR=$$SETLN(IBD,IBSTR,40,39)
"RTN","IBCAPR2",155,0)
 Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",156,0)
 ;
"RTN","IBCAPR2",157,0)
 ; Line 6
"RTN","IBCAPR2",158,0)
 S IBD="Svc From Dt: "_$$DAT1^IBOUTL($P(IBM1,U,10))
"RTN","IBCAPR2",159,0)
 S IBSTR=$$SETLN(IBD,"",2,38)
"RTN","IBCAPR2",160,0)
 S IBD="Svc To Dt: "_$$DAT1^IBOUTL($P(IBM1,U,11))
"RTN","IBCAPR2",161,0)
 S IBSTR=$$SETLN(IBD,IBSTR,54,25)
"RTN","IBCAPR2",162,0)
 Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",163,0)
 ;
"RTN","IBCAPR2",164,0)
 ; Line 7
"RTN","IBCAPR2",165,0)
 S IBCA=$P(IBM1,U)
"RTN","IBCAPR2",166,0)
 S IBST=$P(IBM,U,16),IBST=$$EXPAND^IBTRE(361.1,.16,+IBST)
"RTN","IBCAPR2",167,0)
 S IBSTR=""
"RTN","IBCAPR2",168,0)
 I IBTY["MRA" S IBD="MRA Review Status: "_IBST,IBSTR=$$SETLN(IBD,"",2,38)
"RTN","IBCAPR2",169,0)
 S IBD=$S('$G(IBSPL):"  ",1:"**")_"Reported Payment Amt: "_$S('IBCA:$J(IBX,"",2),1:$J(+IBCA,"",2))
"RTN","IBCAPR2",170,0)
 S IBSTR=$$SETLN(IBD,IBSTR,41,37)
"RTN","IBCAPR2",171,0)
 Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",172,0)
 ;
"RTN","IBCAPR2",173,0)
REGION2 ; EOB MEDICARE RA Information
"RTN","IBCAPR2",174,0)
 ;
"RTN","IBCAPR2",175,0)
 I IBTY["MRA",$D(^IBM(361.1,IBI,21)) D
"RTN","IBCAPR2",176,0)
 . S IBD=$TR($J("",35)," ","-")_"Review"_$TR($J("",38)," ","-")
"RTN","IBCAPR2",177,0)
 . S IBSTR=$$SETLN(IBD,"",1,79) W IBSTR,!
"RTN","IBCAPR2",178,0)
 . S (IBST,IBCN)=0 F  S IBCN=$O(^IBM(361.1,IBI,21,IBCN)) Q:'IBCN  S X=$G(^(IBCN,0)) D
"RTN","IBCAPR2",179,0)
 .. S IBST=0
"RTN","IBCAPR2",180,0)
 .. S IBD="Review Date: "_$$DAT1^IBOUTL($P(X,U))
"RTN","IBCAPR2",181,0)
 .. S IBSTR=$$SETLN(IBD,"",1,30)
"RTN","IBCAPR2",182,0)
 .. S IBD="Reviewed By: "_$$GET1^DIQ(200,+$P(X,U,2)_", ",.01)   ; DBIA 10060
"RTN","IBCAPR2",183,0)
 .. S IBSTR=$$SETLN(IBD,IBSTR,40,39)
"RTN","IBCAPR2",184,0)
 .. Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",185,0)
 .. S IBD=0 F  S IBD=$O(^IBM(361.1,IBI,21,IBCN,1,IBD)) Q:'IBD  S IBSTR=$$SETLN($S('IBST:"Comments: ",1:"")_$G(^(IBD,0)),"",1,$S('IBST:69,1:79)),IBST=1 Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",186,0)
 . I 'IBST D
"RTN","IBCAPR2",187,0)
 .. S IBSTR=$$SETLN("None","",1,10)
"RTN","IBCAPR2",188,0)
 .. Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",189,0)
 ;
"RTN","IBCAPR2",190,0)
REGION3 ; EOB CLAIM and LINE level Information
"RTN","IBCAPR2",191,0)
 N Z
"RTN","IBCAPR2",192,0)
 K ^TMP("PRCA_EOB",$J)
"RTN","IBCAPR2",193,0)
 D GETEOB^IBCECSA6(IBI,2)
"RTN","IBCAPR2",194,0)
 S Z="" F  S Z=$O(^TMP("PRCA_EOB",$J,IBI,Z),-1) Q:Z=""  Q:$TR($G(^TMP("PRCA_EOB",$J,IBI,Z))," ","")'=""  D
"RTN","IBCAPR2",195,0)
 . K ^TMP("PRCA_EOB",$J,IBI,Z)
"RTN","IBCAPR2",196,0)
 S Z=0 F  S Z=$O(^TMP("PRCA_EOB",$J,IBI,Z)) Q:'Z  S IBSTR=$$SETLN($G(^TMP("PRCA_EOB",$J,IBI,Z)),"",1,79) Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",197,0)
 K ^TMP("PRCA_EOB",$J)
"RTN","IBCAPR2",198,0)
 ;
"RTN","IBCAPR2",199,0)
REGION4 ; EOB Display information about any 361.1 message storage or filing errors
"RTN","IBCAPR2",200,0)
 N Z
"RTN","IBCAPR2",201,0)
 I '$O(^IBM(361.1,IBI,"ERR",0)) Q
"RTN","IBCAPR2",202,0)
 S IBSTR=$$SETLN(" ** MESSAGE STORAGE ERRORS  **","",1,79) Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",203,0)
 S Z=0 F  S Z=$O(^IBM(361.1,IBI,"ERR",Z)) Q:'Z  S IBSTR=$$SETLN($G(^(Z,0)),"",1,79) Q:$$WRITE(IBSTR)
"RTN","IBCAPR2",204,0)
 Q
"RTN","IBCAPR2",205,0)
 ;
"RTN","IBCAPR2",206,0)
SETLN(S,V,X,L) ; -- insert text(S) into variable(V)
"RTN","IBCAPR2",207,0)
 ;    S := string to insert
"RTN","IBCAPR2",208,0)
 ;    V := destination string
"RTN","IBCAPR2",209,0)
 ;    X := insert @ col X
"RTN","IBCAPR2",210,0)
 ;    L := clear # of chars (length)
"RTN","IBCAPR2",211,0)
 Q $E(V_$J("",X-1),1,X-1)_$E(S_$J("",L),1,L)_$E(V,X+L,999)
"RTN","IBCAPR2",212,0)
 ;
"RTN","IBCAPR2",213,0)
 ; ---------- End of EOB Printing Section ----------
"RTN","IBCAPR2",214,0)
 ;
"RTN","IBCAPR2",215,0)
EOBALL(IBIFN) ;
"RTN","IBCAPR2",216,0)
 ;
"RTN","IBCAPR2",217,0)
 ; This is passed in a claim and prints all EOBs associated with the claim.
"RTN","IBCAPR2",218,0)
 ; Only ask the device once.
"RTN","IBCAPR2",219,0)
 ; It prints EOB for current payer sequence and works backwards.
"RTN","IBCAPR2",220,0)
 ;
"RTN","IBCAPR2",221,0)
 N IBALL,IBSHEOB,IBI,Z
"RTN","IBCAPR2",222,0)
 D GETEOBCL^IBCAPR(IBIFN,.IBALL)
"RTN","IBCAPR2",223,0)
 ;
"RTN","IBCAPR2",224,0)
 D GETEOBS(.IBALL,.IBSHEOB)
"RTN","IBCAPR2",225,0)
 Q:'$D(IBSHEOB)    ; nothing to print
"RTN","IBCAPR2",226,0)
 ;
"RTN","IBCAPR2",227,0)
 Q:'$$OKTOPRT()
"RTN","IBCAPR2",228,0)
 D EOBPRINT("",.IBSHEOB)
"RTN","IBCAPR2",229,0)
 Q
"RTN","IBCAPR2",230,0)
 ;
"RTN","IBCAPR2",231,0)
OKTOPRT() ; This procedure is called when the user is printing bills
"RTN","IBCAPR2",232,0)
 ; and we know that one or more EOBs exist for this bill.  We ask the
"RTN","IBCAPR2",233,0)
 ; user if the EOB(s) should be printed at this time too.
"RTN","IBCAPR2",234,0)
 ;
"RTN","IBCAPR2",235,0)
 NEW DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCAPR2",236,0)
 ;
"RTN","IBCAPR2",237,0)
 S DIR(0)="YO",DIR("B")="YES"
"RTN","IBCAPR2",238,0)
 S DIR("A",1)="There are one or more EOBs associated with this bill."
"RTN","IBCAPR2",239,0)
 S DIR("A")="Do you want to print them now"
"RTN","IBCAPR2",240,0)
 S DIR("?")="Please answer Yes or No.  If you answer Yes, then you will be asked to supply the output device and all EOBs associated with this bill will then be printed."
"RTN","IBCAPR2",241,0)
 W !!
"RTN","IBCAPR2",242,0)
 D ^DIR
"RTN","IBCAPR2",243,0)
 Q $S(Y:1,1:0)
"RTN","IBCAPR2",244,0)
 ;
"RTN","IBCAPR2",245,0)
GETEOBS(IBALL,IBSHEOB) ; Get all the EOBS
"RTN","IBCAPR2",246,0)
 ; INPUT - IBALL array of claim numbers (IEN to 399)
"RTN","IBCAPR2",247,0)
 ; OUTPUT - IBSHEOB array of EOBs (IEN to 361.1)
"RTN","IBCAPR2",248,0)
 ;
"RTN","IBCAPR2",249,0)
 N IBIFN
"RTN","IBCAPR2",250,0)
 S IBIFN=0
"RTN","IBCAPR2",251,0)
 F  S IBIFN=$O(IBALL(IBIFN)) Q:IBIFN=""  D
"RTN","IBCAPR2",252,0)
 .S IBI=0 F  S IBI=$O(^IBM(361.1,"B",IBIFN,IBI)) Q:'IBI  S Z=+$O(^IBM(361.1,IBI,8,0)) I '$O(^(Z)) S IBSHEOB(IBI)=0  ; Entire EOB belongs to the bill
"RTN","IBCAPR2",253,0)
 .;
"RTN","IBCAPR2",254,0)
 .S IBI=0 F  S IBI=$O(^IBM(361.1,"C",IBIFN,IBI)) Q:'IBI  S IBSHEOB(IBI)=1 ; EOB has been reapportioned at the site
"RTN","IBCAPR2",255,0)
 ;
"RTN","IBCAPR2",256,0)
 Q
"RTN","IBCAPR2",257,0)
 ;
"RTN","IBCAPR2",258,0)
SEL(IBSHEOB) ; Function to display and allow user selection
"RTN","IBCAPR2",259,0)
 ; of an EOB/MRA on file in 361.1 for a sequence of bills.
"RTN","IBCAPR2",260,0)
 ;
"RTN","IBCAPR2",261,0)
 ; Input:  IBSHEOB   - array of internal bill numbers (required)
"RTN","IBCAPR2",262,0)
 ;         ex IBSHEOB(361.1 IEN1)=""
"RTN","IBCAPR2",263,0)
 ;            IBSHEOB(361.1 IEN2)=""
"RTN","IBCAPR2",264,0)
 ;
"RTN","IBCAPR2",265,0)
 ; Function Value:  IEN to file 361.1 or nil if no selection made
"RTN","IBCAPR2",266,0)
 ;
"RTN","IBCAPR2",267,0)
 NEW IBEOB,EOBDATE,COUNT,IEN,IBM,INSCO,SEQ,EOBDT,EOBTYP,CLMSTAT,LIST
"RTN","IBCAPR2",268,0)
 NEW J,A,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,IBM1
"RTN","IBCAPR2",269,0)
 ;
"RTN","IBCAPR2",270,0)
 S IBEOB=""
"RTN","IBCAPR2",271,0)
 Q:'$D(IBSHEOB) IBEOB
"RTN","IBCAPR2",272,0)
 S IEN="",COUNT=0
"RTN","IBCAPR2",273,0)
 F  S IEN=$O(IBSHEOB(IEN)) Q:'+IEN  D 
"RTN","IBCAPR2",274,0)
 . S IBM=$G(^IBM(361.1,IEN,0))
"RTN","IBCAPR2",275,0)
 . S INSCO=$$EXTERNAL^DILFD(361.1,.02,,$P(IBM,U,2))
"RTN","IBCAPR2",276,0)
 . S SEQ=$E($$EXTERNAL^DILFD(361.1,.15,,$P(IBM,U,15)),1)
"RTN","IBCAPR2",277,0)
 . S EOBDT=$$FMTE^XLFDT($P($P(IBM,U,6),".",1),"2Z")
"RTN","IBCAPR2",278,0)
 . S EOBTYP=$P("EOB^MRA",U,$P(IBM,U,4)+1)
"RTN","IBCAPR2",279,0)
 . S CLMSTAT=$$EXTERNAL^DILFD(361.1,.13,"",$P(IBM,U,13))
"RTN","IBCAPR2",280,0)
 . S COUNT=COUNT+1
"RTN","IBCAPR2",281,0)
 . S LIST(COUNT)=IEN_U_SEQ_U_INSCO_U_EOBDT_U_EOBTYP_U_CLMSTAT
"RTN","IBCAPR2",282,0)
 ;
"RTN","IBCAPR2",283,0)
 I 'COUNT G SELX                           ; no mra/eob data found
"RTN","IBCAPR2",284,0)
 ;
"RTN","IBCAPR2",285,0)
 ; Display mra/eob data
"RTN","IBCAPR2",286,0)
 S J="EOB's/MRA's"
"RTN","IBCAPR2",287,0)
 I COUNT>1 W !!,"The selected bill has multiple ",J," on file.  Please choose one."
"RTN","IBCAPR2",288,0)
 W !!?7,"#",?11,"Seq",?17,"Insurance Company",?40,"EOB Date"
"RTN","IBCAPR2",289,0)
 W ?51,"Type",?57,"Claim Status"
"RTN","IBCAPR2",290,0)
 F J=1:1:COUNT S A=LIST(J) D
"RTN","IBCAPR2",291,0)
 . W !?5,$J(J,3),?11,"(",$P(A,U,2),")",?17,$E($P(A,U,3),1,20)
"RTN","IBCAPR2",292,0)
 . W ?40,$P(A,U,4),?51,$P(A,U,5),?57,$P(A,U,6)
"RTN","IBCAPR2",293,0)
 . Q
"RTN","IBCAPR2",294,0)
 ;
"RTN","IBCAPR2",295,0)
 ; User Selection
"RTN","IBCAPR2",296,0)
 W ! S DIR(0)="NO^1:"_COUNT,DIR("A")="Select an EOB/MRA"
"RTN","IBCAPR2",297,0)
 D ^DIR K DIR
"RTN","IBCAPR2",298,0)
 I 'Y G SELX    ; no selection made
"RTN","IBCAPR2",299,0)
 S IBEOB=+$G(LIST(Y))
"RTN","IBCAPR2",300,0)
 ;
"RTN","IBCAPR2",301,0)
SELX ;
"RTN","IBCAPR2",302,0)
 Q IBEOB
"RTN","IBCAPR2",303,0)
 ;
"RTN","IBCAPR2",304,0)
PRINTOPT   ; PRINT EOB OPTION
"RTN","IBCAPR2",305,0)
 N DIC,IBIFN,Y
"RTN","IBCAPR2",306,0)
 S DIC="^IBM(361.1,",DIC(0)="AEMQ",DIC("S")="I $P(^(0),U,4)='1"
"RTN","IBCAPR2",307,0)
 S DIC("W")="D EOBLST^IBCEMU1(Y)"   ; modify generic lister
"RTN","IBCAPR2",308,0)
 D ^DIC
"RTN","IBCAPR2",309,0)
 I Y<1!$D(DTOUT)!$D(DUOUT) S IBQUIT=1 Q
"RTN","IBCAPR2",310,0)
 S IBI=$P(Y,U,1),IBIFN=$P(Y,U,2)
"RTN","IBCAPR2",311,0)
 D EOBPRINT(IBI) ; PRINT THE REQUESTED EOB
"RTN","IBCAPR2",312,0)
 Q
"RTN","IBCAPU")
0^21^B877398^n/a
"RTN","IBCAPU",1,0)
IBCAPU ;ALB/WCJ - Claims Auto Processing Utilities;27-AUG-10
"RTN","IBCAPU",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCAPU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCAPU",4,0)
 Q
"RTN","IBCAPU",5,0)
 ; 
"RTN","IBCAPU",6,0)
CMSPRINT() ; Returns the CMS-1500 Printer defined in the IB Site Parameters. 
"RTN","IBCAPU",7,0)
 N DIC,DA,DR,DIC,DIQ,RESULT,D0
"RTN","IBCAPU",8,0)
 S DIC="^IBE(350.9,"
"RTN","IBCAPU",9,0)
 S DR="8.14"
"RTN","IBCAPU",10,0)
 S DA=1,DIQ="RESULT"
"RTN","IBCAPU",11,0)
 D EN^DIQ1
"RTN","IBCAPU",12,0)
 Q $G(RESULT(350.9,1,8.14))
"RTN","IBCAPU",13,0)
 ;
"RTN","IBCAPU",14,0)
UBPRINT() ; Returns the UB-04 Printer defined in the IB Site Parameters. 
"RTN","IBCAPU",15,0)
 N DIC,DA,DR,DIC,DIQ,RESULT,D0
"RTN","IBCAPU",16,0)
 S DIC="^IBE(350.9,"
"RTN","IBCAPU",17,0)
 S DR="8.15"
"RTN","IBCAPU",18,0)
 S DA=1,DIQ="RESULT"
"RTN","IBCAPU",19,0)
 D EN^DIQ1
"RTN","IBCAPU",20,0)
 Q $G(RESULT(350.9,1,8.15))
"RTN","IBCAPU",21,0)
 ;
"RTN","IBCAPU",22,0)
EOBPRINT() ; Returns the UB-04 Printer defined in the IB Site Parameters.  
"RTN","IBCAPU",23,0)
 N DIC,DA,DR,DIC,DIQ,RESULT,D0
"RTN","IBCAPU",24,0)
 S DIC="^IBE(350.9,"
"RTN","IBCAPU",25,0)
 S DR="8.16"
"RTN","IBCAPU",26,0)
 S DA=1,DIQ="RESULT"
"RTN","IBCAPU",27,0)
 D EN^DIQ1
"RTN","IBCAPU",28,0)
 Q $G(RESULT(350.9,1,8.16))
"RTN","IBCB1")
0^104^B67924398^B64732488
"RTN","IBCB1",1,0)
IBCB1 ;ALB/AAS - Process bill after enter/edited ;2-NOV-89
"RTN","IBCB1",2,0)
 ;;2.0;INTEGRATED BILLING;**70,106,51,137,161,182,155,327,432**;21-MAR-94;Build 192
"RTN","IBCB1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCB1",4,0)
 ;
"RTN","IBCB1",5,0)
 ;MAP TO DGCRB1
"RTN","IBCB1",6,0)
 ;
"RTN","IBCB1",7,0)
 ;IBQUIT = Flag to stop processing
"RTN","IBCB1",8,0)
 ;IBVIEW = Flag for Bill has been viewed
"RTN","IBCB1",9,0)
 ;IBDISP = Flag for Bill entering display been viewed.
"RTN","IBCB1",10,0)
 ;
"RTN","IBCB1",11,0)
 K ^UTILITY($J) I $D(IBAC),IBAC>1 G @IBAC
"RTN","IBCB1",12,0)
1 ;complete bill
"RTN","IBCB1",13,0)
 D END,EDITS^IBCB2 G:IBQUIT END
"RTN","IBCB1",14,0)
 ;
"RTN","IBCB1",15,0)
 I '$$IICM^IBCB2(IBIFN) G END ; Ingenix ClaimsManager
"RTN","IBCB1",16,0)
 I '$$IIQMED^IBCB2(IBIFN) G END ; DSS QuadraMed Claims Scrubber
"RTN","IBCB1",17,0)
 ;
"RTN","IBCB1",18,0)
3 ;authorize bill/request MRA
"RTN","IBCB1",19,0)
 I '$D(^XUSEC("IB AUTHORIZE",DUZ))!('$D(IBIFN)) W !!,"You do not hold the Authorize Key.",! G END
"RTN","IBCB1",20,0)
 I '$P($G(^IBE(350.9,1,1)),"^",23),DUZ=$P(^DGCR(399,IBIFN,"S"),"^",2) W !!,"Entering user can not authorize.",! G END
"RTN","IBCB1",21,0)
 I $P(^DGCR(399,IBIFN,"S"),"^",9) W !,"Already Approved, Can't change" G END
"RTN","IBCB1",22,0)
 D:'$G(IBAC)!($G(IBAC)>1) EDITS^IBCB2 G:IBQUIT END
"RTN","IBCB1",23,0)
 ;
"RTN","IBCB1",24,0)
 I $G(IBAC)'=1,'$$IICM^IBCB2(IBIFN) G END ; Ingenix ClaimsManager
"RTN","IBCB1",25,0)
 I $G(IBAC)'=1,'$$IIQMED^IBCB2(IBIFN) G END ; DSS QuadraMed Claims Scrubber
"RTN","IBCB1",26,0)
 ;
"RTN","IBCB1",27,0)
AUTH S IBMRA=$$REQMRA^IBEFUNC(IBIFN)
"RTN","IBCB1",28,0)
 S IBEND=0
"RTN","IBCB1",29,0)
 I IBMRA["R" D AUTH^IBCB11 G:IBEND END ;MRA normally required, but MEDIGAP ins co
"RTN","IBCB1",30,0)
 ;                         doesn't want/need it or MRA parameter off
"RTN","IBCB1",31,0)
 ;
"RTN","IBCB1",32,0)
 W !!,"THIS BILL WILL "_$P("NOT ^",U,$$TXMT^IBCEF4(IBIFN)+1)_"BE TRANSMITTED ELECTRONICALLY"
"RTN","IBCB1",33,0)
 W !!,"WANT TO ",$S('IBMRA:"AUTHORIZE BILL",1:"REQUEST AN MRA")," AT THIS TIME" S %=2 D YN^DICN G:%=-1!(%=2) END
"RTN","IBCB1",34,0)
 I '% W !?4,"YES - If finished entering bill information and to allow bill to be printed or transmitted",!?4,"No - To take no action" G AUTH
"RTN","IBCB1",35,0)
 S (DIC,DIE)=399,IBYY=$S('IBMRA:"@90",1:"@901"),DA=IBIFN,DR="[IB STATUS]" D ^DIE K DIC,DIE,IBYY D:$D(IBX3) DISAP^IBCBULL
"RTN","IBCB1",36,0)
 I $S('IBMRA:'$P(^DGCR(399,IBIFN,"S"),"^",9),1:'$P($G(^DGCR(399,IBIFN,"TX")),U,6)) G END
"RTN","IBCB1",37,0)
 ;
"RTN","IBCB1",38,0)
 ; Update the review status for all EOB's on file
"RTN","IBCB1",39,0)
 D STAT^IBCEMU2(IBIFN,3)     ; Accepted - Complete EOB
"RTN","IBCB1",40,0)
 ;
"RTN","IBCB1",41,0)
 D AUTOCK^IBCEU2(IBIFN) ; Checks for need to add any codes to bill based on information already on bill, specifically for EDI purposes
"RTN","IBCB1",42,0)
 S IBTXSTAT=$$TXMT^IBCEF4(IBIFN,,1)  ;Determine transmit, whether live/test
"RTN","IBCB1",43,0)
 I IBTXSTAT D  I IBMRA D CTCOPY^IBCCCB(IBIFN,1) G END
"RTN","IBCB1",44,0)
 .W !,"  Adding "
"RTN","IBCB1",45,0)
 .W:+IBTXSTAT=2 "test " W "bill to BILL TRANSMISSION File"_$S('IBMRA:"",1:" for MRA submission")_".",!
"RTN","IBCB1",46,0)
 .W:+IBTXSTAT=1&IBMRA "  Bill is no longer editable unless returned in error from Medicare."
"RTN","IBCB1",47,0)
 .S Y=$$ADDTBILL(IBIFN,+IBTXSTAT)
"RTN","IBCB1",48,0)
 .W ! W:'$P(Y,U,3) *7 W $S($P(Y,U,3):"  Bill will be submitted electronically",1:"  Error loading into transmit file - bill can not be transmitted.")
"RTN","IBCB1",49,0)
 .;
"RTN","IBCB1",50,0)
 ;
"RTN","IBCB1",51,0)
 W !,"Passing completed Bill to Accounts Receivable.  Bill is no longer editable."
"RTN","IBCB1",52,0)
 D ARPASS(IBIFN,1)
"RTN","IBCB1",53,0)
 G:'$G(PRCASV("OKAY")) END
"RTN","IBCB1",54,0)
 W !,"Completed Bill Successfully sent to Accounts Receivable." D FIND^IBOHCK(DFN,IBIFN)
"RTN","IBCB1",55,0)
 ;
"RTN","IBCB1",56,0)
 ; Check to see if any unreviewed status messages or EOBs on file and
"RTN","IBCB1",57,0)
 ; what to do about them
"RTN","IBCB1",58,0)
 N IBTXBARR
"RTN","IBCB1",59,0)
 S IBRESUB=$$RESUB^IBCECSA4($S($G(IBCNCOPY):$P($G(^DGCR(399,IBIFN,0)),U,15),1:IBIFN),+IBTXSTAT,"E",.IBTXBARR)
"RTN","IBCB1",60,0)
 I IBRESUB=2 D         ; update review statuses to be 'review complete'
"RTN","IBCB1",61,0)
 . N IBDA S IBDA=0
"RTN","IBCB1",62,0)
 . F  S IBDA=$O(IBTXBARR(IBDA)) Q:'IBDA  D UPDEDI^IBCEM(IBDA,$S($G(IBCNCOPY):"R",1:"E"))
"RTN","IBCB1",63,0)
 . Q
"RTN","IBCB1",64,0)
 ;
"RTN","IBCB1",65,0)
 K IBTXPRT
"RTN","IBCB1",66,0)
 ;
"RTN","IBCB1",67,0)
4 ;generate/print bill
"RTN","IBCB1",68,0)
 G:'$D(IBIFN) END
"RTN","IBCB1",69,0)
 S:'$D(IBMRA) IBMRA=+$$NEEDMRA^IBEFUNC(IBIFN)
"RTN","IBCB1",70,0)
 I 'IBMRA,'$P(^DGCR(399,IBIFN,"S"),"^",9) W !!,*7,"Not Authorized, Can Not Print!" G END
"RTN","IBCB1",71,0)
 I IBMRA,'$P(^DGCR(399,IBIFN,"TX"),"^",6) W !!,*7,"Not Ready For MRA Submission, Can Not Print!" G END
"RTN","IBCB1",72,0)
 S IBTXSTAT=$$TXMT^IBCEF4(IBIFN)
"RTN","IBCB1",73,0)
 I IBMRA,$$NEEDMRA^IBEFUNC(IBIFN)'["R" W !!,*7,"MRA Submission not yet confirmed by Austin, Can Not Print!" Q:$S('IBTXSTAT:1,1:"XP"'[$P($G(^IBA(364,+$$LAST364^IBCEF4(IBIFN),0)),U,3))
"RTN","IBCB1",74,0)
 I +IBTXSTAT,$D(^IBA(364,"ABDT",IBIFN)) S IBTXOK="" D  I 'IBTXOK S %=2 G GENTX
"RTN","IBCB1",75,0)
 . N IBX,IBTST
"RTN","IBCB1",76,0)
 . S IBX=+$$LAST364^IBCEF4(IBIFN),IBTST=""
"RTN","IBCB1",77,0)
 . I $$TEST^IBCEF4(IBIFN) S (IBTXOK,IBTST)=1
"RTN","IBCB1",78,0)
 . I "XP"[$P($G(^IBA(364,IBX,0)),U,3) D:'IBTST  Q
"RTN","IBCB1",79,0)
 .. W !!,*7,"This Bill Can Not Be Printed Until Transmit Confirmed" W:IBMRA " (to request an MRA)" D:'$D(IBVIEW) VIEW^IBCB2
"RTN","IBCB1",80,0)
 . W !!,"This Bill Has Already Been Transmitted" W:IBMRA " (to request an MRA)"
"RTN","IBCB1",81,0)
 . S DIR("B")="Y",DIR("A")="WANT TO PRINT IT ANYWAY",DIR(0)="Y" D ^DIR K DIR Q:$D(DTOUT)!$D(DUOUT)!'Y  S IBTXOK=1
"RTN","IBCB1",82,0)
 D DISP^IBCB2
"RTN","IBCB1",83,0)
 S:'$D(IBQUIT) IBQUIT=0
"RTN","IBCB1",84,0)
 D:'$D(IBVIEW) VIEW^IBCB2 G:IBQUIT END
"RTN","IBCB1",85,0)
 S IBPNT=$P(^DGCR(399,IBIFN,"S"),"^",12)
"RTN","IBCB1",86,0)
GEN I $$TEST^IBCEF4(IBIFN) W !!,"THIS BILL IS BEING USED AS A TRANSMISSION TEST BILL"
"RTN","IBCB1",87,0)
 W !!,"WANT TO ",$S(IBPNT]"":"RE-",1:""),"PRINT BILL AT THIS TIME" S %=2 D YN^DICN I %=-1 D:+$G(IBAC)=1 END,CTCOPY^IBCCCB(IBIFN) G END
"RTN","IBCB1",88,0)
 I '% W !?4,"YES - to print the bill now",!?4,"NO - To take no action" G GEN
"RTN","IBCB1",89,0)
GENTX I %'=1 D:+$G(IBAC)=1 END,CTCOPY^IBCCCB(IBIFN) G END
"RTN","IBCB1",90,0)
 ;
"RTN","IBCB1",91,0)
 ; Bill has never been printed.  First time print.
"RTN","IBCB1",92,0)
 I 'IBPNT D  G END
"RTN","IBCB1",93,0)
 . I $D(IBTXPRT) D TXPRTS
"RTN","IBCB1",94,0)
 . D EN1^IBCF
"RTN","IBCB1",95,0)
 . I $D(IBTXPRT) D TXPRT
"RTN","IBCB1",96,0)
 . ;D MRA^IBCEMU1(IBIFN)       ; Printing the MRA ;WCJ;IB*2.0*432;MRA may have a diffierent claim number if this is tertiary
"RTN","IBCB1",97,0)
 . D MRA^IBCEMU1($$GETMRACL^IBCAPR(IBIFN))  ;WCJ;IB*2.0*432;see above
"RTN","IBCB1",98,0)
 . I $G(IBMRANOT) D EOBALL^IBCAPR2(IBIFN)  ;WCJ;IB*2.0*432 print all the EOBs (ask device once)
"RTN","IBCB1",99,0)
 . I +$G(IBAC)=1 D END,CTCOPY^IBCCCB(IBIFN)
"RTN","IBCB1",100,0)
 . Q
"RTN","IBCB1",101,0)
 ;
"RTN","IBCB1",102,0)
 ; Below section is for re-prints
"RTN","IBCB1",103,0)
RPNT G:$$NEEDMRA^IBEFUNC(IBIFN) END
"RTN","IBCB1",104,0)
 R !!,"(2)nd Notice, (3)rd Notice, (C)opy or (O)riginal: C// ",IBPNT:DTIME S:IBPNT="" IBPNT="C" G:IBPNT["^" END
"RTN","IBCB1",105,0)
 S IBPNT=$E(IBPNT,1) I "23oOcC"'[IBPNT W !?5,"Enter 'O' to reprint the original bill or",!?5,"Enter 'C' to reprint the bill as a duplicate copy or",!?5,"Enter '2' or '3' to print 2nd or 3rd follow-up notices." S IBPNT=1 G RPNT
"RTN","IBCB1",106,0)
 W "  (",$S("cC"[IBPNT:"COPY","oO"[IBPNT:"ORIGINAL",IBPNT=2:"2nd NOTICE",IBPNT=3:"3rd NOTICE",1:""),")"
"RTN","IBCB1",107,0)
 I $D(IBTXPRT) D
"RTN","IBCB1",108,0)
 . D TXPRTS
"RTN","IBCB1",109,0)
 . I "oOcC"[IBPNT S IBRESUB=$$RESUB^IBCECSA4(IBIFN,1,"P")
"RTN","IBCB1",110,0)
 S IBPNT=$S("oO"[IBPNT:1,"cC"[IBPNT:0,1:IBPNT)
"RTN","IBCB1",111,0)
 D EN1X^IBCF D:$D(IBTXPRT) TXPRT
"RTN","IBCB1",112,0)
 D MRA^IBCEMU1(IBIFN)       ; Printing the MRA
"RTN","IBCB1",113,0)
 ;
"RTN","IBCB1",114,0)
 ;
"RTN","IBCB1",115,0)
END K IBER,IBEND D END^IBCBB1 K IBQUIT,IBVIEW,IBDISP,IBST,IB,PRCAERCD,PRCAERR,PRCASVC,PRCAT,DGRA2,IBBT,IBCH,IBNDS,IBOA,IBREV,IBX,DGXRF1,PRCAORA,IBX3,DGBILLBS,DGII,DGVISCNT,DGFIL,DGTE,IBTXOK,IBTXSTAT,IBMRA,IBNOFIX
"RTN","IBCB1",116,0)
 K %DT,DIC,DIE,I,J,X,Y,Y1,Y2,IBER,IBDFN,IBDSDT,IBJ,IBNDI1,IBZZ,VA,IBMA,IBXDT,DI,PRCAPAYR,DGBS,DGCNT,DGDA,DGPAG,DGREVC,DGRV,DGTEXT,DGTOTPAG,IBOPV,DGLCNT,DGTEXT1,DGRSPAC,DGSM,IBPNT,DGINPT,DGLL,IBCPTN,IBFL
"RTN","IBCB1",117,0)
 K IBRESUB,IBOPV1,IBOPV2,IBCHG,DGBIL1,DGU,DDH,IBA1,IBINS,IBPROC,PRCARI K:'$D(PRCASV("NOTICE")) PRCASV
"RTN","IBCB1",118,0)
 K ^TMP("IBXDATA",$J),^TMP("IBXEDIT",$J)
"RTN","IBCB1",119,0)
 K IBCISNT,IBCISTAT,IBCIERR   ; remove ClaimsManager variables
"RTN","IBCB1",120,0)
 Q
"RTN","IBCB1",121,0)
 ;
"RTN","IBCB1",122,0)
TX1(IBX,RESUB) ; Transmit a single bill from file 364 entry # IBX
"RTN","IBCB1",123,0)
 ; RESUB = flag (1 = resubmitting a bill, 0 = submitting bill 1st time)
"RTN","IBCB1",124,0)
 ; Returns 1 if successfully extracted to mailman queue for transmission,
"RTN","IBCB1",125,0)
 ;         0 if extract not successful
"RTN","IBCB1",126,0)
 N IBTXOK,IBVVSAVE
"RTN","IBCB1",127,0)
 K ^TMP("IBRESUBMIT",$J),^TMP("IBONE",$J)
"RTN","IBCB1",128,0)
 S IBVVSAVE("IBX")=IBX,^TMP("IBONE",$J)=+$G(RESUB),^($J,IBX)=""
"RTN","IBCB1",129,0)
 D ONE^IBCE837
"RTN","IBCB1",130,0)
 S IBX=IBVVSAVE("IBX")
"RTN","IBCB1",131,0)
 I $P($G(^IBA(364,IBX,0)),U,3)="P" S IBTXOK=1
"RTN","IBCB1",132,0)
 K ^TMP("IBONE",$J)
"RTN","IBCB1",133,0)
 Q $G(IBTXOK)
"RTN","IBCB1",134,0)
 ;
"RTN","IBCB1",135,0)
ARONLY(IBIFN) ; Pass bill to A/R, but that's all
"RTN","IBCB1",136,0)
 D ARPASS(IBIFN,0)
"RTN","IBCB1",137,0)
 Q
"RTN","IBCB1",138,0)
 ;
"RTN","IBCB1",139,0)
ARPASS(IBIFN,UPDOK) ;Pass bill to A/R as NEW BILL
"RTN","IBCB1",140,0)
 ;IBIFN = bill entry #
"RTN","IBCB1",141,0)
 ;UPDOK = flag 1: if error going to A/R, allow interactive edit
"RTN","IBCB1",142,0)
 ;             0: send bulletin to IB EDI for error going to A/R
"RTN","IBCB1",143,0)
 Q:+$$STA^PRCAFN(+IBIFN)'=201  ;Must not have been sent previously
"RTN","IBCB1",144,0)
 D GVAR^IBCBB
"RTN","IBCB1",145,0)
 ;Can't be an ins co that won't reimburse
"RTN","IBCB1",146,0)
 Q:$S($P($G(^DGCR(399,IBIFN,0)),U,11)="i":'IBNDMP,1:0)
"RTN","IBCB1",147,0)
 D ARRAY^IBCBB1,^PRCASVC6
"RTN","IBCB1",148,0)
 D REL^PRCASVC:$G(PRCASV("OKAY"))
"RTN","IBCB1",149,0)
 I '$G(PRCASV("OKAY")) D
"RTN","IBCB1",150,0)
 . N IBQUIT,IBQUIT1
"RTN","IBCB1",151,0)
 . S IBQUIT=0
"RTN","IBCB1",152,0)
 . I $G(UPDOK) D  Q
"RTN","IBCB1",153,0)
 .. F  D  Q:IBQUIT
"RTN","IBCB1",154,0)
 ... D DSPARERR^IBCB2("")
"RTN","IBCB1",155,0)
 ... Q:IBQUIT
"RTN","IBCB1",156,0)
 ... I $$ASKEDIT^IBCB2($G(IBAC)) D VIEW1^IBCB2 Q
"RTN","IBCB1",157,0)
 ... S IBQUIT=1
"RTN","IBCB1",158,0)
 . N XMSUB,XMY,XMTEXT,XMDUZ,IBT
"RTN","IBCB1",159,0)
 . S XMSUB="ERROR PASSING BILL TO A/R ON CONFIRMATION",XMTEXT="IBT(",XMY="G.IB EDI",XMDUZ=.5
"RTN","IBCB1",160,0)
 . S IBT(1)="A problem has been detected while trying to pass bill "_$P($G(^DGCR(399,IBIFN,0)),U)_" to"
"RTN","IBCB1",161,0)
 . S IBT(2)="Accounts Receivable when updating the bill's electronic confirmation."
"RTN","IBCB1",162,0)
 . S IBT(3)="Please use the option PASS BILL TO A/R to complete this process."
"RTN","IBCB1",163,0)
 . D ^XMD
"RTN","IBCB1",164,0)
 Q
"RTN","IBCB1",165,0)
 ;
"RTN","IBCB1",166,0)
ADDTBILL(IBIFN,TXST) ; Add new transmit bill rec to file 364 for bill IBIFN
"RTN","IBCB1",167,0)
 ; TXST = test flag 1=live, 2=test
"RTN","IBCB1",168,0)
 N COB,DD,DO,DIC,DLAYGO,X
"RTN","IBCB1",169,0)
 S TXST=($G(TXST)/2\1),COB=$$COB^IBCEF(IBIFN)
"RTN","IBCB1",170,0)
 S DIC(0)="L",DIC="^IBA(364,",DLAYGO=364,X=IBIFN,DIC("DR")=".03///X;.04///NOW;.07////"_TXST_";.08////"_COB D FILE^DICN
"RTN","IBCB1",171,0)
 Q Y
"RTN","IBCB1",172,0)
 ;
"RTN","IBCB1",173,0)
TXPRTS ; Save off last print date to see if bill was reprinted without queueing
"RTN","IBCB1",174,0)
 I '$$NEEDMRA^IBEFUNC(IBIFN) S IBTXPRT("PRT")=$P($G(^DGCR(399,IBIFN,"S")),U,14)
"RTN","IBCB1",175,0)
 Q
"RTN","IBCB1",176,0)
 ;
"RTN","IBCB1",177,0)
TXPRT ; Set variable if print was tasked or bill was printed (last print date changed)
"RTN","IBCB1",178,0)
 I '$$NEEDMRA^IBEFUNC(IBIFN),$S($G(ZTSK):1,1:IBTXPRT("PRT")'=$P($G(^DGCR(399,IBIFN,"S")),U,14)) S IBTXPRT=1
"RTN","IBCB1",179,0)
 Q
"RTN","IBCB1",180,0)
 ;
"RTN","IBCBB")
0^96^B73668257^B73522821
"RTN","IBCBB",1,0)
IBCBB ;ALB/AAS - EDIT CHECK ROUTINE TO BE INVOKED BEFORE ALL BILL APPROVAL ACTIONS ;2-NOV-89
"RTN","IBCBB",2,0)
 ;;2.0;INTEGRATED BILLING;**80,51,137,288,327,361,371,377,400,432**;21-MAR-94;Build 192
"RTN","IBCBB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB",4,0)
 ;
"RTN","IBCBB",5,0)
 ;MAP TO DGCRBB
"RTN","IBCBB",6,0)
 ;
"RTN","IBCBB",7,0)
 ;IBNDn = IBND(n) = ^ib(399,n)
"RTN","IBCBB",8,0)
 ;RETURNS:
"RTN","IBCBB",9,0)
 ;IBER=fields with errors separated by semi-colons
"RTN","IBCBB",10,0)
 ;PRCASV("OKAY")=1 if iber="" and $D(prcasv("array")) compete
"RTN","IBCBB",11,0)
 ;
"RTN","IBCBB",12,0)
GVAR ;set up variables for mccr
"RTN","IBCBB",13,0)
 Q:'$D(IBIFN)  F I=0,"M","U","U1","S","MP","TX","UF3","UF31","U2" S @("IBND"_I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBCBB",14,0)
 S IBBNO=$P(IBND0,"^"),DFN=$P(IBND0,"^",2),IBEVDT=$P(IBND0,"^",3)
"RTN","IBCBB",15,0)
 S IBLOC=$P(IBND0,"^",4),IBCL=$P(IBND0,"^",5),IBTF=$P(IBND0,"^",6)
"RTN","IBCBB",16,0)
 S IBAT=$P(IBND0,"^",7),IBWHO=$P(IBND0,"^",11),IBST=$P(IBND0,"^",13),IBFT=$P(IBND0,"^",19)
"RTN","IBCBB",17,0)
 S IBFDT=$P(IBNDU,"^",1),IBTDT=$P(IBNDU,"^",2)
"RTN","IBCBB",18,0)
 S IBTC=$P(IBNDU1,"^",1),IBFY=$P(IBNDU1,"^",9),IBFYC=$P(IBNDU1,"^",10)
"RTN","IBCBB",19,0)
 S IBEU=$P(IBNDS,"^",2),IBRU=$P(IBNDS,"^",5),IBAU=$P(IBNDS,"^",8)
"RTN","IBCBB",20,0)
 S IBTOB=$$TOB(IBND0),IBTOB12=$E(IBTOB,1,2)
"RTN","IBCBB",21,0)
 K ^TMP($J,"BILL-WARN")
"RTN","IBCBB",22,0)
 Q
"RTN","IBCBB",23,0)
 ;
"RTN","IBCBB",24,0)
EN ;Entry to check for errors
"RTN","IBCBB",25,0)
 N IBQ,IBXERR,IBXDATA,IBXSAVE,IBZPRC92,IBQUIT,IBISEQ,IDDATA,IBFOR,IBC
"RTN","IBCBB",26,0)
 I $D(IBFL) N IBFL
"RTN","IBCBB",27,0)
 K ^TMP($J)
"RTN","IBCBB",28,0)
 W !
"RTN","IBCBB",29,0)
 S IBER="" D GVAR I '$D(IBND0) S IBER=-1 Q
"RTN","IBCBB",30,0)
 ;
"RTN","IBCBB",31,0)
 ;patient in patient file
"RTN","IBCBB",32,0)
 I DFN="" S IBER=IBER_"IB057;"
"RTN","IBCBB",33,0)
 I DFN]"",'$D(^DPT(DFN)) S IBER=IBER_"IB057;"
"RTN","IBCBB",34,0)
 ;
"RTN","IBCBB",35,0)
 ;Event date in correct format
"RTN","IBCBB",36,0)
 I IBEVDT="" S IBER=IBER_"IB049;"
"RTN","IBCBB",37,0)
 I IBEVDT]"",IBEVDT'?7N&(IBEVDT'?7N1".".N) S IBER=IBER_"IB049;"
"RTN","IBCBB",38,0)
 ;
"RTN","IBCBB",39,0)
 ;Rate Type
"RTN","IBCBB",40,0)
 I IBAT="" S IBER=IBER_"IB059;"
"RTN","IBCBB",41,0)
 I IBAT]"",'$D(^DGCR(399.3,IBAT,0)) S IBER=IBER_"IB059;"
"RTN","IBCBB",42,0)
 I IBAT]"",$D(^DGCR(399.3,IBAT,0)),'$P(^(0),"^",6) S IBER=IBER_"IB059;",IBAT=""
"RTN","IBCBB",43,0)
 I IBAT]"",$P($G(^DGCR(399.3,IBAT,0)),"^",6) S IBARTP=$P($$CATN^PRCAFN($P(^DGCR(399.3,IBAT,0),"^",6)),"^",3)
"RTN","IBCBB",44,0)
 ;Check that AR category expects same debtor as defined in who's responsible.
"RTN","IBCBB",45,0)
 I $D(IBARTP),IBWHO="i"&(IBARTP'="T")!(IBWHO="p"&("PC"'[IBARTP))!(IBWHO="o"&(IBARTP'="N")) S IBER=IBER_"IB058;"
"RTN","IBCBB",46,0)
 ;
"RTN","IBCBB",47,0)
 ;Who's Responsible
"RTN","IBCBB",48,0)
 I IBWHO=""!($L(IBWHO)>1)!("iop"'[IBWHO) S IBER=IBER_"IB065;"
"RTN","IBCBB",49,0)
 S IBMRA=$S($$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN)):$$TXMT^IBCEF4(IBIFN)>0,1:0)
"RTN","IBCBB",50,0)
 ;  MCR will not reimburse is only valid if there is subsequent insurance
"RTN","IBCBB",51,0)
 ;   that will reimburse
"RTN","IBCBB",52,0)
 I IBWHO="i" D
"RTN","IBCBB",53,0)
 . I IBMRA D  Q
"RTN","IBCBB",54,0)
 .. N Z,IBZ
"RTN","IBCBB",55,0)
 .. S IBZ=0
"RTN","IBCBB",56,0)
 .. F Z=$$COBN^IBCEF(IBIFN):1:3 I $D(^DGCR(399,IBIFN,"I"_(Z+1))),$P($G(^DIC(36,+$G(^DGCR(399,IBIFN,"I"_(Z+1))),0)),U,2)'="N" S IBZ=1 Q
"RTN","IBCBB",57,0)
 .. I 'IBZ S IBER=IBER_"IB054;" D WARN^IBCBB11("A valid claim for MEDICARE WNR needs subsequent ins. that will reimburse")
"RTN","IBCBB",58,0)
 ..
"RTN","IBCBB",59,0)
 . I $$COB^IBCEF(IBIFN)="S",$$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN))=1,$D(^DGCR(399,IBIFN,"I3")) Q
"RTN","IBCBB",60,0)
 . I $S('IBNDMP:1,1:$P(IBNDMP,U,2)'=$$BPP^IBCNS2(IBIFN,1)) S IBER=IBER_"IB054;"
"RTN","IBCBB",61,0)
 I IBWHO="o",'$P(IBNDM,"^",11) S IBER=IBER_"IB053;"
"RTN","IBCBB",62,0)
 ;
"RTN","IBCBB",63,0)
 ; Billing Provider check - IB*2*400
"RTN","IBCBB",64,0)
 D BP^IBCBB0(IBIFN)
"RTN","IBCBB",65,0)
 ;
"RTN","IBCBB",66,0)
 ; Pay-to Provider check - IB*2*400
"RTN","IBCBB",67,0)
 D PAYTO^IBCBB0(IBIFN)
"RTN","IBCBB",68,0)
 ;
"RTN","IBCBB",69,0)
 ; All insurance subscribers must have a birth date on file
"RTN","IBCBB",70,0)
 ;  - 11/10/04 - IB*2.0*288
"RTN","IBCBB",71,0)
 ;  - 12/14/06 - IB*2.0*361 - must have INSURED'S SEX too
"RTN","IBCBB",72,0)
 ; IB error codes
"RTN","IBCBB",73,0)
 ;    IB221 - Primary insurance subscriber missing date of birth
"RTN","IBCBB",74,0)
 ;    IB222 - Secondary insurance subscriber missing date of birth
"RTN","IBCBB",75,0)
 ;    IB223 - Tertiary insurance subscriber missing date of birth
"RTN","IBCBB",76,0)
 ;    IB261 - Primary insurance subscriber is missing INSURED'S SEX
"RTN","IBCBB",77,0)
 ;    IB262 - Secondary insurance subscriber is missing INSURED'S SEX
"RTN","IBCBB",78,0)
 ;    IB263 - Tertiary insurance subscriber is missing INSURED'S SEX
"RTN","IBCBB",79,0)
 ;
"RTN","IBCBB",80,0)
 F IBISEQ=1:1:3 D
"RTN","IBCBB",81,0)
 . I '$P($G(^DGCR(399,IBIFN,"I"_IBISEQ)),U,1) Q   ; no insurance here
"RTN","IBCBB",82,0)
 . K ^UTILITY("VADM",$J),^UTILITY("VAPA",$J)
"RTN","IBCBB",83,0)
 . S IDDATA=$$INSDEM^IBCEF(IBIFN,IBISEQ)
"RTN","IBCBB",84,0)
 . K ^UTILITY("VADM",$J),^UTILITY("VAPA",$J)
"RTN","IBCBB",85,0)
 . ;
"RTN","IBCBB",86,0)
 . I '$P(IDDATA,U,1) D ERR(221)   ; birth date missing
"RTN","IBCBB",87,0)
 . ;
"RTN","IBCBB",88,0)
 . I "^M^F^"'[(U_$P(IDDATA,U,2)_U) D ERR(261)  ; sex missing
"RTN","IBCBB",89,0)
 . ;
"RTN","IBCBB",90,0)
 . ; IB*2*371 - esg - check for other missing insurance pieces
"RTN","IBCBB",91,0)
 . ; check insured's name, primary ID#, pt. relationship to insured,
"RTN","IBCBB",92,0)
 . ; and subscriber address data  
"RTN","IBCBB",93,0)
 . N INNAME,SUBID,PTREL,SFA,CAS,LN,FN
"RTN","IBCBB",94,0)
 . ;
"RTN","IBCBB",95,0)
 . ;          IB273 - Primary Insurance name of insured missing
"RTN","IBCBB",96,0)
 . ;          IB274 - Secondary Insurance name of insured missing
"RTN","IBCBB",97,0)
 . ;          IB275 - Tertiary Insurance name of insured missing
"RTN","IBCBB",98,0)
 . S INNAME=$$POLICY^IBCEF(IBIFN,17,IBISEQ)
"RTN","IBCBB",99,0)
 . S LN=$P(INNAME,",",1),FN=$P(INNAME,",",2)   ; last name,first name
"RTN","IBCBB",100,0)
 . S LN=$$NOPUNCT^IBCEF(LN,1)
"RTN","IBCBB",101,0)
 . S FN=$$NOPUNCT^IBCEF(FN,1)
"RTN","IBCBB",102,0)
 . I LN=""!(FN="") D ERR(273)   ; name of insured missing or invalid
"RTN","IBCBB",103,0)
 . S LN=$$NAME^IBCEFG1(INNAME)  ; additional name checks
"RTN","IBCBB",104,0)
 . S FN=$P(LN,U,2)
"RTN","IBCBB",105,0)
 . S LN=$P(LN,U,1)
"RTN","IBCBB",106,0)
 . I LN=""!(FN="") D ERR(273)   ; name of insured missing or invalid
"RTN","IBCBB",107,0)
 . ;
"RTN","IBCBB",108,0)
 . ;          IB276 - Primary Insurance subscriber ID missing
"RTN","IBCBB",109,0)
 . ;          IB277 - Secondary Insurance subscriber ID missing
"RTN","IBCBB",110,0)
 . ;          IB278 - Tertiary Insurance subscriber ID missing
"RTN","IBCBB",111,0)
 . S SUBID=$$NOPUNCT^IBCEF($$POLICY^IBCEF(IBIFN,2,IBISEQ),1)
"RTN","IBCBB",112,0)
 . I SUBID="" D ERR(276)     ; subscriber ID# missing
"RTN","IBCBB",113,0)
 . ;
"RTN","IBCBB",114,0)
 . ;          IB279 - Primary Insurance missing pt relationship
"RTN","IBCBB",115,0)
 . ;          IB280 - Secondary Insurance missing pt relationship
"RTN","IBCBB",116,0)
 . ;          IB281 - Tertiary Insurance missing pt relationship
"RTN","IBCBB",117,0)
 . S PTREL=$$POLICY^IBCEF(IBIFN,16,IBISEQ)
"RTN","IBCBB",118,0)
 . I PTREL="" D ERR(279)      ; missing patient relationship to insured
"RTN","IBCBB",119,0)
 . ;
"RTN","IBCBB",120,0)
 . ; subscriber address section
"RTN","IBCBB",121,0)
 . S SFA=$$INSADDR^IBCEF(IBIFN,IBISEQ)     ; full address all pieces
"RTN","IBCBB",122,0)
 . S CAS=$$NOPUNCT^IBCEF($P(SFA,U,2,5),1)  ; string city,st,zip,addr1
"RTN","IBCBB",123,0)
 . ;
"RTN","IBCBB",124,0)
 . ;          IB282 - Primary Insurance address line 1 missing
"RTN","IBCBB",125,0)
 . ;          IB283 - Secondary Insurance address line 1 missing
"RTN","IBCBB",126,0)
 . ;          IB284 - Tertiary Insurance address line 1 missing
"RTN","IBCBB",127,0)
 . I $$NOPUNCT^IBCEF($P(SFA,U,5),1)="" D   ; address line 1 is blank
"RTN","IBCBB",128,0)
 .. ; pat=subscriber and current insurance - address is required
"RTN","IBCBB",129,0)
 .. I +PTREL=1,IBISEQ=$$COBN^IBCEF(IBIFN) D ERR(282) Q
"RTN","IBCBB",130,0)
 .. ; if any part of the address is there, then all fields are required
"RTN","IBCBB",131,0)
 .. I CAS'="" D ERR(282) Q
"RTN","IBCBB",132,0)
 .. Q
"RTN","IBCBB",133,0)
 . ;
"RTN","IBCBB",134,0)
 . ;          IB285 - Primary Insurance city missing
"RTN","IBCBB",135,0)
 . ;          IB286 - Secondary Insurance city missing
"RTN","IBCBB",136,0)
 . ;          IB287 - Tertiary Insurance city missing
"RTN","IBCBB",137,0)
 . I $$NOPUNCT^IBCEF($P(SFA,U,2),1)="" D   ; city is blank
"RTN","IBCBB",138,0)
 .. ; pat=subscriber and current insurance - address is required
"RTN","IBCBB",139,0)
 .. I +PTREL=1,IBISEQ=$$COBN^IBCEF(IBIFN) D ERR(285) Q
"RTN","IBCBB",140,0)
 .. ; if any part of the address is there, then all fields are required
"RTN","IBCBB",141,0)
 .. I CAS'="" D ERR(285) Q
"RTN","IBCBB",142,0)
 .. Q
"RTN","IBCBB",143,0)
 . ;
"RTN","IBCBB",144,0)
 . ;          IB288 - Primary Insurance state missing
"RTN","IBCBB",145,0)
 . ;          IB289 - Secondary Insurance state missing
"RTN","IBCBB",146,0)
 . ;          IB290 - Tertiary Insurance state missing
"RTN","IBCBB",147,0)
 . I $$NOPUNCT^IBCEF($P(SFA,U,3),1)="" D   ; state is blank
"RTN","IBCBB",148,0)
 .. ; pat=subscriber and current insurance - address is required
"RTN","IBCBB",149,0)
 .. I +PTREL=1,IBISEQ=$$COBN^IBCEF(IBIFN) D ERR(288) Q
"RTN","IBCBB",150,0)
 .. ; if any part of the address is there, then all fields are required
"RTN","IBCBB",151,0)
 .. I CAS'="" D ERR(288) Q
"RTN","IBCBB",152,0)
 .. Q
"RTN","IBCBB",153,0)
 . ;
"RTN","IBCBB",154,0)
 . ;          IB291 - Primary Insurance zipcode missing
"RTN","IBCBB",155,0)
 . ;          IB292 - Secondary Insurance zipcode missing
"RTN","IBCBB",156,0)
 . ;          IB293 - Tertiary Insurance zipcode missing
"RTN","IBCBB",157,0)
 . I $$NOPUNCT^IBCEF($P(SFA,U,4),1)="" D   ; zipcode is blank
"RTN","IBCBB",158,0)
 .. ; pat=subscriber and current insurance - address is required
"RTN","IBCBB",159,0)
 .. I +PTREL=1,IBISEQ=$$COBN^IBCEF(IBIFN) D ERR(291) Q
"RTN","IBCBB",160,0)
 .. ; if any part of the address is there, then all fields are required
"RTN","IBCBB",161,0)
 .. I CAS'="" D ERR(291) Q
"RTN","IBCBB",162,0)
 .. Q
"RTN","IBCBB",163,0)
 . ;
"RTN","IBCBB",164,0)
 . Q
"RTN","IBCBB",165,0)
 ;
"RTN","IBCBB",166,0)
 ; esg - IB*2*371 - check patient address fields
"RTN","IBCBB",167,0)
 K ^UTILITY("VAPA",$J)
"RTN","IBCBB",168,0)
 ;
"RTN","IBCBB",169,0)
 S IBFOR=0                              ; foreign address flag
"RTN","IBCBB",170,0)
 S IBC=+$$PTADDR^IBCEF(IBIFN,25)        ; country code ien
"RTN","IBCBB",171,0)
 I IBC D
"RTN","IBCBB",172,0)
 . N CODE
"RTN","IBCBB",173,0)
 . S CODE=$$GET1^DIQ(779.004,IBC,.01)   ; .01 code field file 779.004
"RTN","IBCBB",174,0)
 . I CODE'="",CODE'="USA" S IBFOR=1     ; foreign country exists
"RTN","IBCBB",175,0)
 . Q
"RTN","IBCBB",176,0)
 ;
"RTN","IBCBB",177,0)
 I $$NOPUNCT^IBCEF($$PTADDR^IBCEF(IBIFN,1),1)="" S IBER=IBER_"IB269;"
"RTN","IBCBB",178,0)
 I $$NOPUNCT^IBCEF($$PTADDR^IBCEF(IBIFN,4),1)="" S IBER=IBER_"IB270;"
"RTN","IBCBB",179,0)
 I $$NOPUNCT^IBCEF($$PTADDR^IBCEF(IBIFN,5),1)="",'IBFOR S IBER=IBER_"IB271;"
"RTN","IBCBB",180,0)
 I $$NOPUNCT^IBCEF($$PTADDR^IBCEF(IBIFN,11),1)="",'IBFOR S IBER=IBER_"IB272;"
"RTN","IBCBB",181,0)
 K ^UTILITY("VAPA",$J)
"RTN","IBCBB",182,0)
 ;
"RTN","IBCBB",183,0)
 D PAYERADD^IBCBB0(IBIFN)     ; check the payer addresses
"RTN","IBCBB",184,0)
 D ^IBCBB1
"RTN","IBCBB",185,0)
 Q
"RTN","IBCBB",186,0)
 ; The remaining code below is being removed with Patch IB*2.0*432.
"RTN","IBCBB",187,0)
 ;
"RTN","IBCBB",188,0)
 ; esg - 9/20/07 - IB patch 371 - prevent EDI transmission for 3 payer
"RTN","IBCBB",189,0)
 ;       claims for all but the first payer.  To be removed when Emdeon
"RTN","IBCBB",190,0)
 ;       and FSC are able to deal with these.
"RTN","IBCBB",191,0)
 ;
"RTN","IBCBB",192,0)
 I +$G(^DGCR(399,IBIFN,"I2")),+$G(^DGCR(399,IBIFN,"I3")),$$TXMT^IBCEF4(IBIFN) D
"RTN","IBCBB",193,0)
 . ; for MRA request claims, make sure the MRA secondary claim is forced to print
"RTN","IBCBB",194,0)
 . I $$REQMRA^IBEFUNC(IBIFN) D  Q
"RTN","IBCBB",195,0)
 .. I '$P($G(^DGCR(399,IBIFN,"TX")),U,9) S IBER=IBER_"IB146;"
"RTN","IBCBB",196,0)
 .. Q
"RTN","IBCBB",197,0)
 . ;
"RTN","IBCBB",198,0)
 . I $$COBN^IBCEF(IBIFN)=1 Q   ; primary payer sequence claims are OK
"RTN","IBCBB",199,0)
 . ;
"RTN","IBCBB",200,0)
 . ; But claims with a payer sequence of 2 or 3 need to print locally
"RTN","IBCBB",201,0)
 . S IBER=IBER_"IB147;"
"RTN","IBCBB",202,0)
 . Q
"RTN","IBCBB",203,0)
 ;
"RTN","IBCBB",204,0)
 Q
"RTN","IBCBB",205,0)
 ;
"RTN","IBCBB",206,0)
EDIT(IBIFN) ; Run edits from within the billing edit screens
"RTN","IBCBB",207,0)
 N IBVIEW,IBDISP,IBNOFIX,DIR,X,Y
"RTN","IBCBB",208,0)
 S (IBNOFIX,IBVIEW,IBDISP)=1
"RTN","IBCBB",209,0)
 D EDITS^IBCB2
"RTN","IBCBB",210,0)
 W ! S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR
"RTN","IBCBB",211,0)
 Q
"RTN","IBCBB",212,0)
 ;
"RTN","IBCBB",213,0)
TOB(IBND0) ;
"RTN","IBCBB",214,0)
 ; IBND0 = the 0-node of the bill (file 399)
"RTN","IBCBB",215,0)
 Q ($P(IBND0,U,24)_$P($G(^DGCR(399.1,+$P(IBND0,U,25),0)),U,2)_$P(IBND0,U,26))
"RTN","IBCBB",216,0)
 ;
"RTN","IBCBB",217,0)
ERR(Z) ; update IBER variable from the above insurance checks
"RTN","IBCBB",218,0)
 ; Z is the IB error code# for the primary insurance error
"RTN","IBCBB",219,0)
 N IBERRNO
"RTN","IBCBB",220,0)
 S IBERRNO="IB"_(Z+IBISEQ-1)
"RTN","IBCBB",221,0)
 I IBER[IBERRNO Q
"RTN","IBCBB",222,0)
 S IBER=IBER_IBERRNO_";"
"RTN","IBCBB",223,0)
 Q
"RTN","IBCBB",224,0)
 ;
"RTN","IBCBB1")
0^5^B87354166^B72688329
"RTN","IBCBB1",1,0)
IBCBB1 ;ALB/AAS - CONTINUATION OF EDIT CHECK ROUTINE ;2-NOV-89
"RTN","IBCBB1",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,80,93,106,51,151,148,153,137,232,280,155,320,343,349,363,371,395,384,432**;21-MAR-94;Build 192
"RTN","IBCBB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB1",4,0)
 ;
"RTN","IBCBB1",5,0)
 ;MAP TO DGCRBB1
"RTN","IBCBB1",6,0)
 ;
"RTN","IBCBB1",7,0)
% ;Bill Status
"RTN","IBCBB1",8,0)
 N Z,Z0,Z1,IBFT
"RTN","IBCBB1",9,0)
 I $S(+IBST=0:1,1:"^1^2^3^4^7^"'[(U_IBST_U)) S IBER=IBER_"IB045;"
"RTN","IBCBB1",10,0)
 ;
"RTN","IBCBB1",11,0)
 ;Statement Covers From
"RTN","IBCBB1",12,0)
 I IBFDT="" S IBER=IBER_"IB061;"
"RTN","IBCBB1",13,0)
 I IBFDT]"",IBFDT'?7N&(IBFDT'?7N1".".N) S IBER=IBER_"IB061;"
"RTN","IBCBB1",14,0)
 I IBFDT>IBTDT S IBER=IBER_"IB061;" ; from must be on or before the to date 
"RTN","IBCBB1",15,0)
 S IBFFY=$$FY^IBOUTL(IBFDT)
"RTN","IBCBB1",16,0)
 ; if inpat - from date must not be prior to admit date.
"RTN","IBCBB1",17,0)
 I $$INPAT^IBCEF(IBIFN,1),(IBFDT<($P($G(^DGPT(+$P(IBND0,U,8),0)),U,2)\1))  S IBER=IBER_"IB061;"
"RTN","IBCBB1",18,0)
 ;
"RTN","IBCBB1",19,0)
 ;Statement Covers To
"RTN","IBCBB1",20,0)
 I IBTDT="" S IBER=IBER_"IB062;"
"RTN","IBCBB1",21,0)
 I IBTDT]"",IBTDT'?7N&(IBTDT'?7N1".".N) S IBER=IBER_"IB062;"
"RTN","IBCBB1",22,0)
 I IBTDT>DT!(IBTDT<IBFDT) S IBER=IBER_"IB062;"  ; to date must not be >than today's date
"RTN","IBCBB1",23,0)
 S IBTFY=$$FY^IBOUTL(IBTDT)
"RTN","IBCBB1",24,0)
 ;
"RTN","IBCBB1",25,0)
 ;Total Charges
"RTN","IBCBB1",26,0)
 I +IBTC'>0!(+IBTC'=IBTC) S IBER=IBER_"IB064;"
"RTN","IBCBB1",27,0)
 ;
"RTN","IBCBB1",28,0)
 ;Billable charges for secondary claim
"RTN","IBCBB1",29,0)
 I $$MCRONBIL^IBEFUNC(IBIFN)&(($P(IBNDU1,U,1)-$P(IBNDU1,U,2))'>0) S IBER=IBER_"IB094;"
"RTN","IBCBB1",30,0)
 ;Fiscal Year 1
"RTN","IBCBB1",31,0)
 S IBFFY=$$FY^IBOUTL(IBFDT)
"RTN","IBCBB1",32,0)
 ;
"RTN","IBCBB1",33,0)
 ;Check provider link for current user, enterer, reviewer and Authorizor
"RTN","IBCBB1",34,0)
 I '$D(^VA(200,DUZ,0)) S IBER=IBER_"IB048;"
"RTN","IBCBB1",35,0)
 I IBEU]"",'$D(^VA(200,IBEU,0)) S IBER=IBER_"IB048;"
"RTN","IBCBB1",36,0)
 I IBRU]"",'$D(^VA(200,IBRU,0)) S IBER=IBER_"IB060;"
"RTN","IBCBB1",37,0)
 I IBAU]"",'$D(^VA(200,IBAU,0)) S IBER=IBER_"IB041;"
"RTN","IBCBB1",38,0)
 ;
"RTN","IBCBB1",39,0)
 I IBER="",+$$STA^PRCAFN(IBIFN)=104 S IBER=IBER_"IB040;"
"RTN","IBCBB1",40,0)
 ; If ins bill, must have valid COB sequence
"RTN","IBCBB1",41,0)
 I $P(IBND0,U,11)="i",$S($P(IBND0,U,21)="":1,1:"PST"'[$P(IBND0,U,21)) S IBER=IBER_"IB324;"
"RTN","IBCBB1",42,0)
 ;
"RTN","IBCBB1",43,0)
 ; Check for valid sec provider id for current ins
"RTN","IBCBB1",44,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"PRV",Z)) Q:'Z  S Z0=$G(^(Z,0)),Z1=+$$COBN^IBCEF(IBIFN) I $P(Z0,U,4+Z1)'="",$P(Z0,U,11+Z1)'="" D
"RTN","IBCBB1",45,0)
 . I '$$SECIDCK^IBCEF74(IBIFN,Z1,$P(Z0,U,11+Z1),Z) D WARN^IBCBB11("Prov secondary id type for the "_$P("PRIMARY^SECONDARY^TERTIARY",U,Z1)_" "_$$EXTERNAL^DILFD(399.0222,.01,,+Z0)_" is invalid/won't transmit")
"RTN","IBCBB1",46,0)
 ; Check NPIs
"RTN","IBCBB1",47,0)
 D NPICHK^IBCBB11
"RTN","IBCBB1",48,0)
 ;
"RTN","IBCBB1",49,0)
 ; Check multiple rx NPIs
"RTN","IBCBB1",50,0)
 D RXNPI^IBCBB11(IBIFN)
"RTN","IBCBB1",51,0)
 ;
"RTN","IBCBB1",52,0)
 ; Check taxonomies
"RTN","IBCBB1",53,0)
 D TAXCHK^IBCBB11
"RTN","IBCBB1",54,0)
 ;
"RTN","IBCBB1",55,0)
 ; Check for Physician Name
"RTN","IBCBB1",56,0)
 K IBXDATA D F^IBCEF("N-ATT/REND PHYSICIAN NAME",,,IBIFN)
"RTN","IBCBB1",57,0)
 ; IB*2.0*432 - CMS1500 no longer needs a claim level rendering
"RTN","IBCBB1",58,0)
 S IBFT=$$FT^IBCEF(IBIFN)
"RTN","IBCBB1",59,0)
 I IBFT'=2,$P($G(IBXDATA),U)="" S IBER=IBER_"IB303;"
"RTN","IBCBB1",60,0)
 ;
"RTN","IBCBB1",61,0)
 N FUNCTION,IBINS
"RTN","IBCBB1",62,0)
 ; IB*2.0*432 - CMS1500 no longer needs a claim level rendering
"RTN","IBCBB1",63,0)
 ;S FUNCTION=$S($$FT^IBCEF(IBIFN)=3:4,1:3)
"RTN","IBCBB1",64,0)
 S FUNCTION=$S(IBFT=3:4,1:3)
"RTN","IBCBB1",65,0)
 I IBFT'=2,IBER'["IB303;" D
"RTN","IBCBB1",66,0)
 . F IBINS=1:1:3 D
"RTN","IBCBB1",67,0)
 .. S Z=$$GETTYP^IBCEP2A(IBIFN,IBINS)
"RTN","IBCBB1",68,0)
 .. I Z,$P(Z,U,2) D  ; Rendering/attending prov secondary id required
"RTN","IBCBB1",69,0)
 ... N IBID,IBOK,Q0
"RTN","IBCBB1",70,0)
 ... D PROVINF^IBCEF74(IBIFN,IBINS,.IBID,1,"C")  ; check all as though they were current
"RTN","IBCBB1",71,0)
 ... S IBOK=0
"RTN","IBCBB1",72,0)
 ... S Q0=0 F  S Q0=$O(IBID(1,FUNCTION,Q0)) Q:'Q0  I $P(IBID(1,FUNCTION,Q0),U,9)=+Z S IBOK=1 Q
"RTN","IBCBB1",73,0)
 ... I 'IBOK S IBER=IBER_$S(IBINS=1:"IB236;",IBINS=2:"IB237;",IBINS=3:"IB238;",1:"")
"RTN","IBCBB1",74,0)
 ;
"RTN","IBCBB1",75,0)
 ; Patch 432 enh5:The IB system shall no longer prevent users from authorizing(fatal error message)a claim because the system cannot find the providersSSNorEIN
"RTN","IBCBB1",76,0)
 ; D PRIIDCHK^IBCBB11
"RTN","IBCBB1",77,0)
 ;
"RTN","IBCBB1",78,0)
 N IBM,IBM1
"RTN","IBCBB1",79,0)
 S IBM=$G(^DGCR(399,IBIFN,"M"))
"RTN","IBCBB1",80,0)
 S IBM1=$G(^DGCR(399,IBIFN,"M1"))
"RTN","IBCBB1",81,0)
 I $P(IBM,U),$P($G(^DIC(36,$P(IBM,U),4)),U,6),$P(IBM1,U,2)="" S IBER=IBER_"IB244;"
"RTN","IBCBB1",82,0)
 I $P(IBM,U,2),$P($G(^DIC(36,$P(IBM,U,2),4)),U,6),$P(IBM1,U,3)="" S IBER=IBER_"IB245;"
"RTN","IBCBB1",83,0)
 I $P(IBM,U,3),$P($G(^DIC(36,$P(IBM,U,3),4)),U,6),$P(IBM1,U,4)="" S IBER=IBER_"IB246;"
"RTN","IBCBB1",84,0)
 ;
"RTN","IBCBB1",85,0)
 ; If outside facility, check for ID and qualifier in 355.93
"RTN","IBCBB1",86,0)
 ; 5/15/06 - esg - hard error IB243 turned into warning message instead
"RTN","IBCBB1",87,0)
 S Z=$P($G(^DGCR(399,IBIFN,"U2")),U,10)
"RTN","IBCBB1",88,0)
 I Z D
"RTN","IBCBB1",89,0)
 . I $P($G(^IBA(355.93,Z,0)),U,9)=""!($P($G(^IBA(355.93,Z,0)),U,13)="") D
"RTN","IBCBB1",90,0)
 .. N Z1,Z2
"RTN","IBCBB1",91,0)
 .. S Z1="Missing Lab or Facility Primary ID for non-VA facility, "
"RTN","IBCBB1",92,0)
 .. S Z2=$$EXTERNAL^DILFD(399,232,,Z)
"RTN","IBCBB1",93,0)
 .. I $L(Z2)'>19 D WARN^IBCBB11(Z1_Z2) Q
"RTN","IBCBB1",94,0)
 .. D WARN^IBCBB11(Z1),WARN^IBCBB11("     "_Z2)
"RTN","IBCBB1",95,0)
 .. Q
"RTN","IBCBB1",96,0)
 . Q
"RTN","IBCBB1",97,0)
 ;
"RTN","IBCBB1",98,0)
 ; Must be one and only one division on bill
"RTN","IBCBB1",99,0)
 S IBZ=$$MULTDIV^IBCBB11(IBIFN,IBND0)
"RTN","IBCBB1",100,0)
 ; I IBZ S IBER=IBER_$S(IBZ=1:"IB095;",IBZ=2:"IB104;",1:"IB105;")
"RTN","IBCBB1",101,0)
 ; Allow multi-divisional for OP instutional claims
"RTN","IBCBB1",102,0)
 I IBZ,$$INPAT^IBCEF(IBIFN)!'($$INSPRF^IBCEF(IBIFN)) S IBER=IBER_$S(IBZ=1:"IB095;",IBZ=2:"IB104;",1:"IB105;")
"RTN","IBCBB1",103,0)
 ; Still need error msg on OP Institutional if No Default division
"RTN","IBCBB1",104,0)
 I IBZ=3,'$$INPAT^IBCEF(IBIFN),$$INSPRF^IBCEF(IBIFN) S IBER=IBER_"IB105;"
"RTN","IBCBB1",105,0)
 ; Division address must be defined in institution file
"RTN","IBCBB1",106,0)
 I $P(IBND0,U,22) D
"RTN","IBCBB1",107,0)
 . N Z,Z0,Z1
"RTN","IBCBB1",108,0)
 . S Z0=$G(^DIC(4,+$P($G(^DG(40.8,+$P(IBND0,U,22),0)),U,7),0))
"RTN","IBCBB1",109,0)
 . S Z1=$G(^DIC(4,+$P($G(^DG(40.8,+$P(IBND0,U,22),0)),U,7),1))
"RTN","IBCBB1",110,0)
 . I $P(Z0,U,2)="" S IBER=IBER_"IB097;" Q
"RTN","IBCBB1",111,0)
 . F Z=1,3,4 I $P(Z1,U,Z)="" S IBER=IBER_"IB097;" Q
"RTN","IBCBB1",112,0)
 ;
"RTN","IBCBB1",113,0)
 ; IB*2.0*432 Check ambulance addresses, COB Non-covered amt. & Attachment Control
"RTN","IBCBB1",114,0)
 I $$AMBCK^IBCBB11(IBIFN)=1 S IBER=IBER_"IB329;"
"RTN","IBCBB1",115,0)
 I $$COBAMT^IBCBB11(IBIFN)=1 S IBER=IBER_"IB330;"
"RTN","IBCBB1",116,0)
 I $$TMCK^IBCBB11(IBIFN)=1 S IBER=IBER_"IB331;"
"RTN","IBCBB1",117,0)
 I $$ACCK^IBCBB11(IBIFN)=1 S IBER=IBER_"IB332;"
"RTN","IBCBB1",118,0)
 I $$COBMRA^IBCBB11(IBIFN)=1 S IBER=IBER_"IB342;"
"RTN","IBCBB1",119,0)
 I $$COBSEC^IBCBB11(IBIFN)=1 S IBER=IBER_"IB343;"
"RTN","IBCBB1",120,0)
 ;
"RTN","IBCBB1",121,0)
 ;CHAMPVA Rate Type and Primary Insurance Carriers Type of Coverage must match
"RTN","IBCBB1",122,0)
 S (IBRTCHV,IBPICHV)=0
"RTN","IBCBB1",123,0)
 I $P($G(^DGCR(399.3,+IBAT,0)),U,1)="CHAMPVA" S IBRTCHV=1
"RTN","IBCBB1",124,0)
 I $P($G(^IBE(355.2,+$P($G(^DIC(36,+IBNDMP,0)),U,13),0)),U,1)="CHAMPVA" S IBPICHV=1
"RTN","IBCBB1",125,0)
 I (+IBRTCHV!+IBPICHV)&('IBRTCHV!'IBPICHV) S IBER=IBER_"IB085;"
"RTN","IBCBB1",126,0)
 ;
"RTN","IBCBB1",127,0)
 N IBZPRC,IBZPRCUB
"RTN","IBCBB1",128,0)
 D F^IBCEF("N-ALL PROCEDURES","IBZPRC",,IBIFN)
"RTN","IBCBB1",129,0)
 ; Procedure Clinic is required for Surgical Procedures Outpt Facility Charges
"RTN","IBCBB1",130,0)
 I +$P(IBND0,U,27)'=2,$$BILLRATE^IBCRU3(IBAT,IBCL,IBEVDT,"RC OUTPATIENT") D
"RTN","IBCBB1",131,0)
 . N Z,Z0,Z1,ZE S (ZE,Z)=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  D  I +ZE S IBER=IBER_"IB320;" Q
"RTN","IBCBB1",132,0)
 .. S Z0=$G(^DGCR(399,IBIFN,"CP",Z,0)),Z1=+Z0 I Z0'[";ICPT(" Q
"RTN","IBCBB1",133,0)
 .. I '((Z1'<10000)&(Z1'>69999))&'((Z1'<93501)&(Z1'>93533)) Q
"RTN","IBCBB1",134,0)
 .. I '$P(Z0,U,7) S ZE=1
"RTN","IBCBB1",135,0)
 ;
"RTN","IBCBB1",136,0)
 ; Extract procedures for UB-04
"RTN","IBCBB1",137,0)
 D F^IBCEF("N-UB-04 PROCEDURES","IBZPRCUB",,IBIFN)
"RTN","IBCBB1",138,0)
 ; Does this bill have ANY prescriptions associated with it?
"RTN","IBCBB1",139,0)
 ; Must bill prescriptions separately from other charges
"RTN","IBCBB1",140,0)
 ;
"RTN","IBCBB1",141,0)
 ; DEM;432 - Call line level provider edit checks.
"RTN","IBCBB1",142,0)
 D LNPROV^IBCBB12(IBIFN)  ; DEM;432 - If there are line provider edits, then routine LNPROV^IBCBB12(IBIFN) updates IBER string.
"RTN","IBCBB1",143,0)
 ; DEM;432 - Call to Other Operating/Operating Provider edit checks.
"RTN","IBCBB1",144,0)
 I $$OPPROVCK^IBCBB12(IBIFN)=1 S IBER=IBER_"IB337;"  ; DEM;432
"RTN","IBCBB1",145,0)
 ; DEM;432 - Line level Attachment Control edits.
"RTN","IBCBB1",146,0)
 I $$LNTMCK^IBCBB11(IBIFN)=1 S IBER=IBER_"IB331;"  ; DEM;432
"RTN","IBCBB1",147,0)
 I $$LNACCK^IBCBB11(IBIFN)=1 S IBER=IBER_"IB332;"  ; DEM;432
"RTN","IBCBB1",148,0)
 ;
"RTN","IBCBB1",149,0)
 I $$ISRX^IBCEF1(IBIFN) D
"RTN","IBCBB1",150,0)
 . N IBZ,IBRXDEF
"RTN","IBCBB1",151,0)
 . S IBRXDEF=$P($G(^IBE(350.9,1,1)),U,30),IBZ=0
"RTN","IBCBB1",152,0)
 . F  S IBZ=$O(IBZPRCUB(IBZ)) Q:'IBZ  I IBZPRCUB(IBZ),+$P(IBZPRCUB(IBZ),U)'=IBRXDEF S IBER=IBER_"IB102;" Q
"RTN","IBCBB1",153,0)
 . K IBZ
"RTN","IBCBB1",154,0)
 ;
"RTN","IBCBB1",155,0)
 ; Check that COB sequences are not skipped
"RTN","IBCBB1",156,0)
 K Z
"RTN","IBCBB1",157,0)
 F Z=1:1:3 S:+$G(^DGCR(399,IBIFN,"I"_Z)) Z(Z)=""
"RTN","IBCBB1",158,0)
 F Z=0:1:2 S Z0=$O(Z(Z)) Q:'Z0  I Z0'=(Z+1) S IBER=IBER_"IB322;" Q
"RTN","IBCBB1",159,0)
 K Z
"RTN","IBCBB1",160,0)
 ; HD64676  IB*2*371 - OK for payer sequence to be blank when the Rate
"RTN","IBCBB1",161,0)
 ;    Type is either Interagency or Sharing Agreement
"RTN","IBCBB1",162,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,21)="",$P($G(^DGCR(399,IBIFN,0)),U,7)'=4,$P($G(^DGCR(399,IBIFN,0)),U,7)'=9 S IBER=IBER_"IB323;"
"RTN","IBCBB1",163,0)
 K IBXDATA D F^IBCEF("N-PROCEDURE CODING METHD",,,IBIFN)
"RTN","IBCBB1",164,0)
 ; Coding method should agree with types of procedure codes
"RTN","IBCBB1",165,0)
 S IBOK=$S('$O(IBZPRC(0))!(IBXDATA=""):1,1:0)
"RTN","IBCBB1",166,0)
 I 'IBOK S IBOK=1,IBZ=0 F  S IBZ=$O(IBZPRC(IBZ)) Q:'IBZ  I IBZPRC(IBZ),$P(IBZPRC(IBZ),U)'[$S(IBXDATA=9:"ICD",1:"ICP") S IBOK=0 Q
"RTN","IBCBB1",167,0)
 I 'IBOK D WARN^IBCBB11("Coding Method does not agree with all procedure codes found on bill")
"RTN","IBCBB1",168,0)
 D EDITMRA^IBCBB3(.IBQUIT,.IBER,IBIFN,IBFT)
"RTN","IBCBB1",169,0)
 Q:$G(IBQUIT)
"RTN","IBCBB1",170,0)
 ;
"RTN","IBCBB1",171,0)
 ;Other things that could be added:  Rev Code - calculating charges
"RTN","IBCBB1",172,0)
 ;        Diagnosis Coding, if MT copay - check for other co-payments
"RTN","IBCBB1",173,0)
 ;
"RTN","IBCBB1",174,0)
 I $P(IBNDTX,U,8),$$REQMRA^IBEFUNC(IBIFN) S IBER=IBER_"IB121;"   ; can't force MRAs to print
"RTN","IBCBB1",175,0)
 I $P(IBNDTX,U,8)!$P(IBNDTX,U,9) D WARN^IBCBB11($S($$REQMRA^IBEFUNC(IBIFN)&($P(IBNDTX,U,9)):"MRA Secondary ",1:"")_"Bill has been forced to print "_$S($P(IBNDTX,U,8)=1!($P(IBNDTX,U,9)=1):"locally",1:"at clearinghouse"))
"RTN","IBCBB1",176,0)
 N IBXZ,IBIZ F IBIZ=12,13,14 S IBXZ=$P(IBNDM,U,IBIZ) I +IBXZ S IBXZ=$P($G(^DPT(DFN,.312,IBXZ,0)),U,18) I +IBXZ S IBXZ=$G(^IBA(355.3,+IBXZ,0)) I +$P(IBXZ,U,12) D
"RTN","IBCBB1",177,0)
 . D WARN^IBCBB11($P($G(^DIC(36,+IBXZ,0)),U,1)_" requires Amb Care Certification")
"RTN","IBCBB1",178,0)
 ;
"RTN","IBCBB1",179,0)
 D VALNDC^IBCBB11(IBIFN,DFN)  ;validate NDC#
"RTN","IBCBB1",180,0)
 ;
"RTN","IBCBB1",181,0)
 ;Build AR array if no errors and MRA not needed or already rec'd
"RTN","IBCBB1",182,0)
 I IBER="",$S($$NEEDMRA^IBEFUNC(IBIFN)!($$REQMRA^IBEFUNC(IBIFN)):0,1:1) D ARRAY
"RTN","IBCBB1",183,0)
 ;
"RTN","IBCBB1",184,0)
 ;Check ROI
"RTN","IBCBB1",185,0)
 N ROIERR
"RTN","IBCBB1",186,0)
 S ROIERR=0 I $P($G(^DGCR(399,IBIFN,"U")),U,5)=1,+$P($G(^DGCR(399,IBIFN,"U")),U,7)=0 S ROIERR=1 ; screen 7 sensitive record and no ROI
"RTN","IBCBB1",187,0)
 I $$ROICHK^IBCBB11(IBIFN,DFN,+IBNDMP) S ROIERR=1 ; check file for sensitive Rx and missing ROI
"RTN","IBCBB1",188,0)
 I ROIERR S IBER=IBER_"IB328;"
"RTN","IBCBB1",189,0)
 ;
"RTN","IBCBB1",190,0)
END ;Don't kill IBIFN, IBER, DFN
"RTN","IBCBB1",191,0)
 I $O(^TMP($J,"BILL-WARN",0)),$G(IBER)="" S IBER="WARN" ;Warnings only
"RTN","IBCBB1",192,0)
 K IBBNO,IBEVDT,IBLOC,IBCL,IBTF,IBAT,IBWHO,IBST,IBFDT,IBTDT,IBTC,IBFY,IBFY1,IBAU,IBRU,IBEU,IBARTP,IBFYC,IBMRA,IBTOB,IBTOB12,IBNDU2,IBNDUF3,IBNDUF31,IBNDTX
"RTN","IBCBB1",193,0)
 K IBNDS,IBND0,IBNDU,IBNDM,IBNDMP,IBNDU1,IBFFY,IBTFY,IBFT,IBRTCHV,IBPICHV,IBXDATA,IBOK
"RTN","IBCBB1",194,0)
 I $D(IBER),IBER="" W !,"No Errors found for National edits"
"RTN","IBCBB1",195,0)
 Q
"RTN","IBCBB1",196,0)
 ;
"RTN","IBCBB1",197,0)
ARRAY ;Build PRCASV(array)
"RTN","IBCBB1",198,0)
 N IBCOBN,X
"RTN","IBCBB1",199,0)
 K PRCASV
"RTN","IBCBB1",200,0)
 Q:$$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN))
"RTN","IBCBB1",201,0)
 S IBCOBN=$$COBN^IBCEF(IBIFN)
"RTN","IBCBB1",202,0)
 S X=IBIFN
"RTN","IBCBB1",203,0)
 S PRCASV("BDT")=DT,PRCASV("ARREC")=IBIFN
"RTN","IBCBB1",204,0)
 S PRCASV("APR")=DUZ
"RTN","IBCBB1",205,0)
 S PRCASV("PAT")=DFN,PRCASV("CAT")=$P(^DGCR(399.3,IBAT,0),"^",6)
"RTN","IBCBB1",206,0)
 I IBWHO="i" S PRCASV("DEBTOR")=+IBNDMP_";DIC(36,"
"RTN","IBCBB1",207,0)
 S PRCASV("DEBTOR")=$S(IBWHO="p":DFN_";DPT(",IBWHO="o":$P(IBNDM,"^",11)_";DIC(4,",IBWHO="i":PRCASV("DEBTOR"),1:"")
"RTN","IBCBB1",208,0)
 S PRCASV("CARE")=$E($$TOB^IBCEF1(IBIFN),1,2)
"RTN","IBCBB1",209,0)
 S PRCASV("FY")=$$FY^IBOUTL(DT)_U_($P(IBNDU1,U)-$P(IBNDU1,U,2))
"RTN","IBCBB1",210,0)
 ;S PRCASV("FY")=$P(IBNDU1,U,9)_U_$S($P(IBNDU1,U,2)]"":($P(IBNDU1,U,10)-$P(IBNDU1,U,2)),1:$P(IBNDU1,U,10))_$S($P(IBNDU1,U,11)]"":U_$P(IBNDU1,U,11)_U_$P(IBNDU1,U,12),1:"")
"RTN","IBCBB1",211,0)
PLUS I IBWHO="i",$P(IBNDM,"^",2),$D(^DIC(36,$P(IBNDM,"^",2),0)) S PRCASV("2NDINS")=$P(IBNDM,"^",2)
"RTN","IBCBB1",212,0)
 I IBWHO="i",$P(IBNDM,"^",3),$D(^DIC(36,$P(IBNDM,"^",3),0)) S PRCASV("3RDINS")=$P(IBNDM,"^",3)
"RTN","IBCBB1",213,0)
 ;
"RTN","IBCBB1",214,0)
 N IBX S IBX=$P(IBND0,U,21),IBX=$S(IBX="P":"I1",IBX="S":"I2",IBX="T":"I3",1:"") Q:IBX=""
"RTN","IBCBB1",215,0)
 N IBNDI1
"RTN","IBCBB1",216,0)
 Q:'$D(^DGCR(399,IBIFN,IBX))  S IBNDI1=^(IBX)
"RTN","IBCBB1",217,0)
 S:$P(IBNDI1,"^",3)]"" PRCASV("GPNO")=$P(IBNDI1,"^",3)
"RTN","IBCBB1",218,0)
 S:$P(IBNDI1,"^",15)]"" PRCASV("GPNM")=$P(IBNDI1,"^",15)
"RTN","IBCBB1",219,0)
 S:$P(IBNDI1,"^",17)]"" PRCASV("INPA")=$P(IBNDI1,"^",17)
"RTN","IBCBB1",220,0)
 S:$P(IBNDI1,"^",2)]"" PRCASV("IDNO")=$P(IBNDI1,"^",2),PRCASV("INID")=PRCASV("IDNO")
"RTN","IBCBB1",221,0)
 ; Check that this is a secondary or tertiary bill and insurance for previous
"RTN","IBCBB1",222,0)
 ; COB sequence is Medicare WNR and MRA is active --> send data elements to AR
"RTN","IBCBB1",223,0)
 I IBCOBN>1,$$WNRBILL^IBEFUNC(IBIFN,IBCOBN-1),$$EDIACTV^IBCEF4(2) D MRA
"RTN","IBCBB1",224,0)
 Q
"RTN","IBCBB1",225,0)
 ;
"RTN","IBCBB1",226,0)
MRA N IBEOB S IBEOB=0
"RTN","IBCBB1",227,0)
 ;
"RTN","IBCBB1",228,0)
 K PRCASV("MEDURE"),PRCASV("MEDCA")
"RTN","IBCBB1",229,0)
 ; Get EOB data
"RTN","IBCBB1",230,0)
 F  S IBEOB=$O(^IBM(361.1,"B",IBIFN,IBEOB)) Q:'IBEOB  D
"RTN","IBCBB1",231,0)
 . D MRACALC^IBCEMU2(IBEOB,IBIFN,1,.PRCASV)
"RTN","IBCBB1",232,0)
 Q  ;MRA
"RTN","IBCBB1",233,0)
 ;
"RTN","IBCBB1",234,0)
 ;; PREGNANCY DX CODES: V22**-V24**, V27**-V28**, 630**-677**
"RTN","IBCBB1",235,0)
 ;; FLU SHOTS PROCEDURE CODES: 90724, G0008, 90732, G0009
"RTN","IBCBB11")
0^26^B97720533^B32717107
"RTN","IBCBB11",1,0)
IBCBB11 ;ALB/AAS/OIFO-BP/PIJ - CONTINUATION OF EDIT CHECK ROUTINE ;12 Jun 2006  3:45 PM
"RTN","IBCBB11",2,0)
 ;;2.0;INTEGRATED BILLING;**51,343,363,371,395,392,401,384,400,436,432**;21-MAR-94;Build 192
"RTN","IBCBB11",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB11",4,0)
 ;
"RTN","IBCBB11",5,0)
WARN(IBDISP) ; Set warning in global
"RTN","IBCBB11",6,0)
 ; DISP = warning text to display
"RTN","IBCBB11",7,0)
 ;
"RTN","IBCBB11",8,0)
 N Z
"RTN","IBCBB11",9,0)
 S Z=+$O(^TMP($J,"BILL-WARN",""),-1)
"RTN","IBCBB11",10,0)
 I Z=0 S ^TMP($J,"BILL-WARN",1)=$J("",5)_"**Warnings**:",Z=1
"RTN","IBCBB11",11,0)
 S Z=Z+1,^TMP($J,"BILL-WARN",Z)=$J("",5)_IBDISP
"RTN","IBCBB11",12,0)
 Q
"RTN","IBCBB11",13,0)
 ;
"RTN","IBCBB11",14,0)
MULTDIV(IBIFN,IBND0) ; Check for multiple divisions on a bill ien IBIFN
"RTN","IBCBB11",15,0)
 ; IBND0 = 0-node of bill
"RTN","IBCBB11",16,0)
 ;
"RTN","IBCBB11",17,0)
 ;  Function returns 1 if more than 1 division found on bill
"RTN","IBCBB11",18,0)
 N Z,Z0,Z1,MULT
"RTN","IBCBB11",19,0)
 S MULT=0,Z1=$P(IBND0,U,22)
"RTN","IBCBB11",20,0)
 I Z1 D
"RTN","IBCBB11",21,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$P(^(Z,0),U,7) I Z0,Z0'=Z1 S MULT=1 Q
"RTN","IBCBB11",22,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  S Z0=$P(^(Z,0),U,6) I Z0,Z0'=Z1 S MULT=2 Q
"RTN","IBCBB11",23,0)
 I 'Z1 S MULT=3
"RTN","IBCBB11",24,0)
 Q MULT
"RTN","IBCBB11",25,0)
 ;
"RTN","IBCBB11",26,0)
 ;; PREGNANCY DX CODES: V22**-V24**, V27**-V28**, 630**-677**
"RTN","IBCBB11",27,0)
 ;; FLU SHOTS PROCEDURE CODES: 90724, G0008, 90732, G0009
"RTN","IBCBB11",28,0)
 ;
"RTN","IBCBB11",29,0)
NPICHK ; Check for required NPIs
"RTN","IBCBB11",30,0)
 N IBNPIS,IBNONPI,IBNPIREQ,Z,IBNFI,IBTF,IBWC,IBXSAVE,IBPRV,IBLINE
"RTN","IBCBB11",31,0)
 ;*** pij start IB*20*436 ***
"RTN","IBCBB11",32,0)
 N IBRATYPE,IBLEGAL
"RTN","IBCBB11",33,0)
 S (IBRATYPE,IBLEGAL)=""
"RTN","IBCBB11",34,0)
 S IBRATYPE=$P($G(^DGCR(399,IBIFN,0)),U,7)
"RTN","IBCBB11",35,0)
 ; Legal types for this use.
"RTN","IBCBB11",36,0)
 ;  7=NO FAULT INS.
"RTN","IBCBB11",37,0)
 ; 10=TORT FEASOR
"RTN","IBCBB11",38,0)
 ; 11=WORKERS' COMP.
"RTN","IBCBB11",39,0)
 S IBNFI=$O(^DGCR(399.3,"B","NO FAULT INS.",0)) S:'IBNFI IBNFI=7
"RTN","IBCBB11",40,0)
 S IBTF=$O(^DGCR(399.3,"B","TORT FEASOR",0)) S:'IBTF IBTF=10
"RTN","IBCBB11",41,0)
 S IBWC=$O(^DGCR(399.3,"B","WORKERS' COMP.",0)) S:'IBWC IBWC=11
"RTN","IBCBB11",42,0)
 ;
"RTN","IBCBB11",43,0)
 I IBRATYPE=IBNFI!(IBRATYPE=IBTF)!(IBRATYPE=IBWC) D
"RTN","IBCBB11",44,0)
 . ; One of the legal types - force local print
"RTN","IBCBB11",45,0)
 . S IBLEGAL=1
"RTN","IBCBB11",46,0)
 ;*** pij end ***
"RTN","IBCBB11",47,0)
 S IBNPIREQ=$$NPIREQ^IBCEP81(DT)  ; Check if NPI is required
"RTN","IBCBB11",48,0)
 ; Check providers
"RTN","IBCBB11",49,0)
 ; IB*2.0*432 changed the NPI check to the new Provider Array
"RTN","IBCBB11",50,0)
 ;S IBNPIS=$$PROVNPI^IBCEF73A(IBIFN,.IBNONPI)
"RTN","IBCBB11",51,0)
 D ALLIDS^IBCEFP(IBIFN,.IBXSAVE,1)
"RTN","IBCBB11",52,0)
 S IBPRV=""
"RTN","IBCBB11",53,0)
 F  S IBPRV=$O(IBXSAVE("PROVINF",IBIFN,"C",1,IBPRV)) Q:'IBPRV  D
"RTN","IBCBB11",54,0)
 . I $P($G(IBXSAVE("PROVINF",IBIFN,"C",1,IBPRV,0)),U,4)="" S IBNONPI(IBPRV)=""
"RTN","IBCBB11",55,0)
 S IBLINE=""
"RTN","IBCBB11",56,0)
 F  S IBLINE=$O(IBXSAVE("L-PROV",IBIFN,IBLINE)) Q:'IBLINE  D
"RTN","IBCBB11",57,0)
 . S IBPRV=""
"RTN","IBCBB11",58,0)
 . F  S IBPRV=$O(IBXSAVE("L-PROV",IBIFN,IBLINE,"C",1,IBPRV)) Q:IBPRV=""  D
"RTN","IBCBB11",59,0)
 .. I $P($G(IBXSAVE("L-PROV",IBIFN,IBLINE,"C",1,IBPRV,0)),U,4)="" S IBNONPI(IBPRV)=""
"RTN","IBCBB11",60,0)
 I $D(IBNONPI) S IBPRV="" F  S IBPRV=$O(IBNONPI(IBPRV)) Q:'IBPRV  D
"RTN","IBCBB11",61,0)
 . ;*** pij start IB*20*436 ***
"RTN","IBCBB11",62,0)
 . ;I IBNPIREQ S IBER=IBER_"IB"_(140+$P(IBNONPI,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",63,0)
 . I IBNPIREQ,IBLEGAL="" S IBER=IBER_"IB"_(140+IBPRV)_";" Q  ; If required, set error
"RTN","IBCBB11",64,0)
 . ; ;*** pij end ***
"RTN","IBCBB11",65,0)
 . D WARN("NPI for the "_$P("referring^operating^rendering^attending^supervising^^^^other",U,IBPRV)_" provider has no value")  ; Else, set warning
"RTN","IBCBB11",66,0)
 ; Check organizations
"RTN","IBCBB11",67,0)
 S IBNONPI=""
"RTN","IBCBB11",68,0)
 S IBNPIS=$$ORGNPI^IBCEF73A(IBIFN,.IBNONPI)
"RTN","IBCBB11",69,0)
 I $L(IBNONPI) F Z=1:1:$L(IBNONPI,U) D
"RTN","IBCBB11",70,0)
 . ; Turn IB161, IB162 to a warning
"RTN","IBCBB11",71,0)
 . ;*** pij start IB*20*436 ***
"RTN","IBCBB11",72,0)
 . ;I IBNPIREQ,$P(IBNONPI,U,Z)=3 S IBER=IBER_"IB163;" Q
"RTN","IBCBB11",73,0)
 . I IBNPIREQ,$P(IBNONPI,U,Z)=3,IBLEGAL="" S IBER=IBER_"IB163;" Q
"RTN","IBCBB11",74,0)
 . ;*** pij end ***
"RTN","IBCBB11",75,0)
 . ; PRXM/KJH - Changed descriptions.
"RTN","IBCBB11",76,0)
 . D WARN("NPI for the "_$P("Service Facility^Non-VA Service Facility^Billing Provider",U,$P(IBNONPI,U,Z))_" has no value")  ; Else, set warning
"RTN","IBCBB11",77,0)
 . ;S IBER=IBER_$P("IB339;^IB340;^IB341;",U,$P(IBNONPI,U,Z))  ; DEM;432 Added NPI errors.
"RTN","IBCBB11",78,0)
 . ;IB*2.0*432/TAZ - Removed fatal error for Non-VA Service Facility NPI.
"RTN","IBCBB11",79,0)
 . S IBER=IBER_$P("IB339;^^IB341;",U,$P(IBNONPI,U,Z))
"RTN","IBCBB11",80,0)
 . Q
"RTN","IBCBB11",81,0)
 Q
"RTN","IBCBB11",82,0)
 ;
"RTN","IBCBB11",83,0)
TAXCHK ; Check for required taxonomies
"RTN","IBCBB11",84,0)
 N IBTAXS,IBNOTAX,IBTAXREQ,Z,IBXSAVE,IBLINE,IBPRV
"RTN","IBCBB11",85,0)
 S IBTAXREQ=$$TAXREQ^IBCEP81(DT)  ; Check if taxonomy is required
"RTN","IBCBB11",86,0)
 ; Check providers
"RTN","IBCBB11",87,0)
 ; IB*2.0*432 changed the Taxonomy check to the new Provider Array
"RTN","IBCBB11",88,0)
 ;S IBTAXS=$$PROVTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCBB11",89,0)
 D ALLIDS^IBCEFP(IBIFN,.IBXSAVE,1)
"RTN","IBCBB11",90,0)
 S IBPRV=""
"RTN","IBCBB11",91,0)
 F  S IBPRV=$O(IBXSAVE("PROVINF",IBIFN,"C",1,IBPRV)) Q:'IBPRV  D
"RTN","IBCBB11",92,0)
 . I $G(IBXSAVE("PROVINF",IBIFN,"C",1,IBPRV,"TAXONOMY"))="" S IBNOTAX(IBPRV)=""
"RTN","IBCBB11",93,0)
 S IBLINE=""
"RTN","IBCBB11",94,0)
 F  S IBLINE=$O(IBXSAVE("L-PROV",IBIFN,IBLINE)) Q:'IBLINE  D
"RTN","IBCBB11",95,0)
 . S IBPRV=""
"RTN","IBCBB11",96,0)
 . F  S IBPRV=$O(IBXSAVE("L-PROV",IBIFN,IBLINE,"C",1,IBPRV)) Q:IBPRV=""  D
"RTN","IBCBB11",97,0)
 .. I $G(IBXSAVE("L-PROV",IBIFN,IBLINE,"C",1,IBPRV,"TAXONOMY"))="" S IBNOTAX(IBPRV)=""
"RTN","IBCBB11",98,0)
 I $D(IBNOTAX) S IBPRV="" F  S IBPRV=$O(IBNOTAX(IBPRV)) Q:'IBPRV  D
"RTN","IBCBB11",99,0)
 . ; Only Referring, Rendering and Attending are currently sent to the payer
"RTN","IBCBB11",100,0)
 . I IBTAXREQ,"134"[IBPRV S IBER=IBER_"IB"_(250+IBPRV)_";" Q  ; If required, set error
"RTN","IBCBB11",101,0)
 . D WARN("Taxonomy for the "_$P("referring^operating^rendering^attending^supervising^^^^other",U,IBPRV)_" provider has no value")  ; Else, set warning
"RTN","IBCBB11",102,0)
 ; Check organizations
"RTN","IBCBB11",103,0)
 S IBNOTAX=""
"RTN","IBCBB11",104,0)
 S IBTAXS=$$ORGTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCBB11",105,0)
 I $L(IBNOTAX) F Z=1:1:$L(IBNOTAX,U) D
"RTN","IBCBB11",106,0)
 . ; Turn IB165, IB166 to a warning
"RTN","IBCBB11",107,0)
 . I IBTAXREQ,$P(IBNOTAX,U,Z)=3 S IBER=IBER_"IB167;" Q
"RTN","IBCBB11",108,0)
 . ; PRXM/KJH - Changed descriptions.
"RTN","IBCBB11",109,0)
 . D WARN("Taxonomy for the "_$P("Service Facility^Non-VA Service Facility^Billing Provider",U,$P(IBNOTAX,U,Z))_" has no value")  ; Else, set warning
"RTN","IBCBB11",110,0)
 Q
"RTN","IBCBB11",111,0)
 ;
"RTN","IBCBB11",112,0)
VALNDC(IBIFN,IBDFN) ; IB*2*363 - validate NDC# between PRESCRIPTION file (#52)
"RTN","IBCBB11",113,0)
 ; and IB BILL/CLAIMS PRESCRIPTION REFILL file (#362.4)
"RTN","IBCBB11",114,0)
 ; input - IBIFN = internal entry number of the billing record in the BILL/CLAIMS file (#399)
"RTN","IBCBB11",115,0)
 ;         IBDFN = internal entry number of patient record in the PATIENT file (#2)
"RTN","IBCBB11",116,0)
 N IBX,IBRXCOL
"RTN","IBCBB11",117,0)
 ; call program that determines if NDC differences exist
"RTN","IBCBB11",118,0)
 D VALNDC^IBEFUNC3(IBIFN,IBDFN,.IBRXCOL)
"RTN","IBCBB11",119,0)
 Q:'$D(IBRXCOL)
"RTN","IBCBB11",120,0)
 ; at least one RX on the IB record has an NDC discrepancy 
"RTN","IBCBB11",121,0)
 S IBX=0 F  S IBX=$O(IBRXCOL(IBX)) Q:'IBX  D WARN("NDC# on Bill does not equal the NDC# on Rx "_IBRXCOL(IBX))
"RTN","IBCBB11",122,0)
 Q
"RTN","IBCBB11",123,0)
 ;
"RTN","IBCBB11",124,0)
PRIIDCHK ; Check for required Pimarary ID (SSN/EIN)
"RTN","IBCBB11",125,0)
 ; If the provider is on the claim, he must have one
"RTN","IBCBB11",126,0)
 ; 
"RTN","IBCBB11",127,0)
 N IBI,IBZ
"RTN","IBCBB11",128,0)
 I $$TXMT^IBCEF4(IBIFN) D
"RTN","IBCBB11",129,0)
 . D F^IBCEF("N-ALL ATT/REND PROV SSN/EI","IBZ",,IBIFN)
"RTN","IBCBB11",130,0)
 . S IBI="" F  S IBI=$O(^DGCR(399,IBIFN,"PRV","B",IBI)) Q:IBI=""  D
"RTN","IBCBB11",131,0)
 .. I $P(IBZ,U,IBI)="" S IBER=IBER_$S(IBI=1:"IB151;",IBI=2:"IB152;",IBI=3!(IBI=4):"IB321;",IBI=5:"IB153;",IBI=9:"IB154;",1:"")
"RTN","IBCBB11",132,0)
 Q
"RTN","IBCBB11",133,0)
 ;
"RTN","IBCBB11",134,0)
RXNPI(IBIFN) ; check for multiple pharmacy npi's on the same bill
"RTN","IBCBB11",135,0)
 N IBORG,IBRXNPI,IBX,IBY
"RTN","IBCBB11",136,0)
 S IBORG=$$RXSITE^IBCEF73A(IBIFN,.IBORG)
"RTN","IBCBB11",137,0)
 S IBX=0 F  S IBX=$O(IBORG(IBX)) Q:'IBX  S IBY=0 F  S IBY=$O(IBORG(IBX,IBY)) Q:'IBY  S IBRXNPI(+IBORG(IBX,IBY))=""
"RTN","IBCBB11",138,0)
 S (IBX,IBY)=0 F  S IBX=$O(IBRXNPI(IBX)) Q:'IBX  S IBY=IBY+1
"RTN","IBCBB11",139,0)
 I IBY>1 D WARN("Bill has prescriptions resulting from "_IBY_" different NPI locations")
"RTN","IBCBB11",140,0)
 Q
"RTN","IBCBB11",141,0)
 ;
"RTN","IBCBB11",142,0)
ROICHK(IBIFN,IBDFN,IBINS) ; IB*2.0*384 - check prescriptions that contain the
"RTN","IBCBB11",143,0)
 ; special handling code U against the Claims Tracking ROI file (#356.25)
"RTN","IBCBB11",144,0)
 ; to see if an ROI is on file
"RTN","IBCBB11",145,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",146,0)
 ;         IBDFN = IEN of the patient
"RTN","IBCBB11",147,0)
 ;         IBINS = IEN of the payer insurance company (#36)
"RTN","IBCBB11",148,0)
 ; OUTPUT - 0 = no error        
"RTN","IBCBB11",149,0)
 ;          1 = a prescription is sensitive and there is no ROI on file
"RTN","IBCBB11",150,0)
 ;
"RTN","IBCBB11",151,0)
 N IBX,IBY0,IBRXIEN,IBDT,IBDRUG,ROIQ
"RTN","IBCBB11",152,0)
 S ROIQ=0
"RTN","IBCBB11",153,0)
 S IBX=0 F  S IBX=$O(^IBA(362.4,"C",IBIFN,IBX)) Q:'IBX  D
"RTN","IBCBB11",154,0)
 .S IBY0=^IBA(362.4,IBX,0),IBRXIEN=$P(IBY0,U,5) I 'IBRXIEN Q
"RTN","IBCBB11",155,0)
 .S IBDT=$P(IBY0,U,3),IBDRUG=$P(IBY0,U,4)
"RTN","IBCBB11",156,0)
 .D ZERO^IBRXUTL(IBDRUG)
"RTN","IBCBB11",157,0)
 .I ^TMP($J,"IBDRUG",IBDRUG,3)["U" D
"RTN","IBCBB11",158,0)
 .. I $$ROI^IBNCPDR4(IBDFN,IBDRUG,IBINS,IBDT) Q  ;ROI is on file
"RTN","IBCBB11",159,0)
 .. D WARN("ROI not on file for prescription "_$$RXAPI1^IBNCPUT1(IBRXIEN,.01,"E"))
"RTN","IBCBB11",160,0)
 .. S ROIQ=1
"RTN","IBCBB11",161,0)
ROICHKQ ;
"RTN","IBCBB11",162,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBCBB11",163,0)
 Q ROIQ
"RTN","IBCBB11",164,0)
 ;
"RTN","IBCBB11",165,0)
AMBCK(IBIFN)    ; IB*2.0*432 - if ambulance location defined, address must be defined
"RTN","IBCBB11",166,0)
 ; if there is anything entered in any of the address fields (either p/up or drop/off fields), than there needs to be: 
"RTN","IBCBB11",167,0)
 ; Address 1, State and ZIP unless the State is not a US state or possession, then zip code is not needed (CMS1500 only)
"RTN","IBCBB11",168,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",169,0)
 ; OUTPUT - 0 = no error        
"RTN","IBCBB11",170,0)
 ;          1 = Error
"RTN","IBCBB11",171,0)
 ;
"RTN","IBCBB11",172,0)
 N IBPAMB,IBDAMB,IBAMBR,IBCK
"RTN","IBCBB11",173,0)
 S IBAMBR=0
"RTN","IBCBB11",174,0)
 Q:$$INSPRF^IBCEF(IBIFN)'=0 IBAMBR
"RTN","IBCBB11",175,0)
 S IBPAMB=$G(^DGCR(399,IBIFN,"U5")),IBDAMB=$G(^DGCR(399,IBIFN,"U6"))
"RTN","IBCBB11",176,0)
 S IBCK(5)=$$NOPUNCT^IBCEF($P(IBPAMB,U,2,6),1),IBCK(6)=$$NOPUNCT^IBCEF($P(IBDAMB,U,1,6),1)
"RTN","IBCBB11",177,0)
 I IBCK(5)="",IBCK(6)="" Q IBAMBR
"RTN","IBCBB11",178,0)
 ; at this point we know that at least one ambulance field has data, so check to see if all have data
"RTN","IBCBB11",179,0)
 I IBCK(5)'="" F I=2,4,5 I $P(IBPAMB,U,I)="" S IBAMBR=1
"RTN","IBCBB11",180,0)
 I IBCK(6)'="" F I=1,2,4,5 I $P(IBDAMB,U,I)="" S IBAMBR=1
"RTN","IBCBB11",181,0)
 Q:IBAMBR=1 IBAMBR
"RTN","IBCBB11",182,0)
 ; now check zip code.  OK to be null if state is not a US Posession
"RTN","IBCBB11",183,0)
 F I="IBPAMB","IBDAMB" I $P(I,U,5)'="",$P($G(^DIC(5,$P(I,U,5),0)),U,6)=1,$P(I,U,6)="" S IBAMBR=1
"RTN","IBCBB11",184,0)
 Q IBAMBR
"RTN","IBCBB11",185,0)
 ;
"RTN","IBCBB11",186,0)
COBAMT(IBIFN)   ; IB*2.0*432 - IF there is a COB amt. it must equal the Total Claim Charge Amount
"RTN","IBCBB11",187,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",188,0)
 ; OUTPUT - 0 = no error        
"RTN","IBCBB11",189,0)
 ;          1 = Error
"RTN","IBCBB11",190,0)
 ;
"RTN","IBCBB11",191,0)
 Q:IBIFN="" 0
"RTN","IBCBB11",192,0)
 Q:$P($G(^DGCR(399,IBIFN,"U4")),U)="" 0
"RTN","IBCBB11",193,0)
 Q:+$P($G(^DGCR(399,IBIFN,"U1")),U)'=+$P($G(^DGCR(399,IBIFN,"U4")),U) 1
"RTN","IBCBB11",194,0)
 Q 0
"RTN","IBCBB11",195,0)
 ;
"RTN","IBCBB11",196,0)
COBMRA(IBIFN)   ; IB*2.0*432 - If there is a 'COB total non-covered amount' (File#399, Field#260), 
"RTN","IBCBB11",197,0)
 ; Primary Insurance must be Medicare that never went to Medicare, and this must be a 2ndary or tertiary claim
"RTN","IBCBB11",198,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",199,0)
 ; OUTPUT - 0 = no error        
"RTN","IBCBB11",200,0)
 ;          1 = Error
"RTN","IBCBB11",201,0)
 ;
"RTN","IBCBB11",202,0)
 N IBP
"RTN","IBCBB11",203,0)
 Q:IBIFN="" 0
"RTN","IBCBB11",204,0)
 Q:$P($G(^DGCR(399,IBIFN,"U4")),U)="" 0
"RTN","IBCBB11",205,0)
 S IBP=$P($G(^DGCR(399,IBIFN,"M1")),U,5) S:IBP="" IBP=IBIFN
"RTN","IBCBB11",206,0)
 I $$WNRBILL^IBEFUNC(IBIFN,1),$P($G(^DGCR(399,IBP,"S")),U,7)="",$$COBN^IBCEF(IBIFN)>1 Q 0
"RTN","IBCBB11",207,0)
 Q 1
"RTN","IBCBB11",208,0)
 ;
"RTN","IBCBB11",209,0)
COBSEC(IBIFN)   ; IB*2.0*432 - If there is NOT a 'COB total non-covered amount' (File#399, Field#260), 
"RTN","IBCBB11",210,0)
 ; and Primary Insurance is Medicare that never went to Medicare, 2ndary or tertiary claim cannot be set to transmit
"RTN","IBCBB11",211,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",212,0)
 ; OUTPUT - 0 = no error        
"RTN","IBCBB11",213,0)
 ;          1 = Error
"RTN","IBCBB11",214,0)
 ;
"RTN","IBCBB11",215,0)
 N IBP
"RTN","IBCBB11",216,0)
 Q:IBIFN="" 0
"RTN","IBCBB11",217,0)
 Q:$P($G(^DGCR(399,IBIFN,"U4")),U)'="" 0
"RTN","IBCBB11",218,0)
 Q:$$COBN^IBCEF(IBIFN)<2 0
"RTN","IBCBB11",219,0)
 S IBP=$P($G(^DGCR(399,IBIFN,"M1")),U,5) S:IBP="" IBP=IBIFN
"RTN","IBCBB11",220,0)
 I $$WNRBILL^IBEFUNC(IBIFN,1),$P($G(^DGCR(399,IBP,"S")),U,7)="",$P($G(^DGCR(399,IBIFN,"TX")),U,8)'=1 Q 1
"RTN","IBCBB11",221,0)
 Q 0
"RTN","IBCBB11",222,0)
 ;
"RTN","IBCBB11",223,0)
TMCK(IBIFN) ;  IB*2.0*432 - Attachment Control Number - REQUIRED when Transmission Method = BM, EL, EM, or FT
"RTN","IBCBB11",224,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",225,0)
 ; OUTPUT - 0 = no error        
"RTN","IBCBB11",226,0)
 ;          1 = Error
"RTN","IBCBB11",227,0)
 ;
"RTN","IBCBB11",228,0)
 N IBAC
"RTN","IBCBB11",229,0)
 Q:IBIFN="" 0
"RTN","IBCBB11",230,0)
 F I=1,3 S IBAC(I)=$P($G(^DGCR(399,IBIFN,"U8")),U,I)
"RTN","IBCBB11",231,0)
 Q:IBAC(3)="" 0
"RTN","IBCBB11",232,0)
 Q:IBAC(1)'="" 0
"RTN","IBCBB11",233,0)
 Q:IBAC(3)="AA" 0
"RTN","IBCBB11",234,0)
 Q 1
"RTN","IBCBB11",235,0)
 ;
"RTN","IBCBB11",236,0)
ACCK(IBIFN) ; IB*2.0*432 If any of the loop info is present, then Report Type & Transmission Method req'd
"RTN","IBCBB11",237,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",238,0)
 ; OUTPUT - 0 = no error        
"RTN","IBCBB11",239,0)
 ;          1 = Error
"RTN","IBCBB11",240,0)
 ;
"RTN","IBCBB11",241,0)
 N IBAC
"RTN","IBCBB11",242,0)
 Q:IBIFN="" 0
"RTN","IBCBB11",243,0)
 F I=1:1:3 S IBAC(I)=$P($G(^DGCR(399,IBIFN,"U8")),U,I)
"RTN","IBCBB11",244,0)
 ; All fields null, no error
"RTN","IBCBB11",245,0)
 I IBAC(1)="",IBAC(2)="",IBAC(3)="" Q 0
"RTN","IBCBB11",246,0)
 ; Both required fields complete, no error
"RTN","IBCBB11",247,0)
 I IBAC(2)'="",IBAC(3)'="" Q 0
"RTN","IBCBB11",248,0)
 ; At this point, one of the 2 required fields has data and one does not, so error
"RTN","IBCBB11",249,0)
 Q 1
"RTN","IBCBB11",250,0)
 ;
"RTN","IBCBB11",251,0)
LNTMCK(IBIFN) ;  DEM;IB*2.0*432 - (Line Level) Attachment Control Number - REQUIRED when Transmission Method = BM, EL, EM, or FT
"RTN","IBCBB11",252,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",253,0)
 ; OUTPUT - IBLNERR = 0 = no error        
"RTN","IBCBB11",254,0)
 ;          IBLNERR = 1 = Error
"RTN","IBCBB11",255,0)
 ;
"RTN","IBCBB11",256,0)
 N IBAC,IBPROCP,I,IBLNERR
"RTN","IBCBB11",257,0)
 S IBLNERR=0  ; DEM;432 - Initialize error flag IBLNERR to '0' for no errors.
"RTN","IBCBB11",258,0)
 Q:IBIFN="" IBLNERR
"RTN","IBCBB11",259,0)
 S IBPROCP=0 F  S IBPROCP=$O(^DGCR(399,IBIFN,"CP",IBPROCP)) Q:'IBPROCP  D  Q:IBLNERR
"RTN","IBCBB11",260,0)
 . Q:'($D(^DGCR(399,IBIFN,"CP",IBPROCP,0))#10)  ; DEM;432 - Node '0' is procedure node.
"RTN","IBCBB11",261,0)
 . Q:'($D(^DGCR(399,IBIFN,"CP",IBPROCP,1))#10)  ; DEM;432 - Node '1' is line level Attachment Control fields.
"RTN","IBCBB11",262,0)
 . F I=1,3 S IBAC(I)=$P(^DGCR(399,IBIFN,"CP",IBPROCP,1),U,I)
"RTN","IBCBB11",263,0)
 . I IBAC(3)="" S IBLNERR=0 Q
"RTN","IBCBB11",264,0)
 . I IBAC(1)'="" S IBLNERR=0 Q
"RTN","IBCBB11",265,0)
 . I (IBAC(3)="AA") S IBLNERR=0 Q
"RTN","IBCBB11",266,0)
 . S IBLNERR=1
"RTN","IBCBB11",267,0)
 . Q
"RTN","IBCBB11",268,0)
 ;
"RTN","IBCBB11",269,0)
 Q IBLNERR
"RTN","IBCBB11",270,0)
 ;
"RTN","IBCBB11",271,0)
LNACCK(IBIFN) ; DEM;IB*2.0*432 (Line Level) If any of the loop info is present, then Report Type & Transmission Method req'd
"RTN","IBCBB11",272,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",273,0)
 ; OUTPUT - IBLNERR = 0 = no error        
"RTN","IBCBB11",274,0)
 ;          IBLNERR = 1 = Error
"RTN","IBCBB11",275,0)
 ;
"RTN","IBCBB11",276,0)
 N IBAC,IBPROCP,I,IBLNERR
"RTN","IBCBB11",277,0)
 S IBLNERR=0  ; DEM;432 - Initialize error flag IBLNERR to '0' for no errors.
"RTN","IBCBB11",278,0)
 Q:IBIFN="" IBLNERR
"RTN","IBCBB11",279,0)
 S IBPROCP=0 F  S IBPROCP=$O(^DGCR(399,IBIFN,"CP",IBPROCP)) Q:'IBPROCP  D  Q:IBLNERR
"RTN","IBCBB11",280,0)
 . Q:'($D(^DGCR(399,IBIFN,"CP",IBPROCP,0))#10)  ; DEM;432 - Node '0' is procedure node.
"RTN","IBCBB11",281,0)
 . Q:'($D(^DGCR(399,IBIFN,"CP",IBPROCP,1))#10)  ; DEM;432 - Node '1' is line level Attachment Control fields.
"RTN","IBCBB11",282,0)
 . F I=1:1:3 S IBAC(I)=$P(^DGCR(399,IBIFN,"CP",IBPROCP,1),U,I)
"RTN","IBCBB11",283,0)
 . ; All fields null, no error
"RTN","IBCBB11",284,0)
 . I IBAC(1)="",IBAC(2)="",IBAC(3)="" S IBLNERR=0 Q
"RTN","IBCBB11",285,0)
 . ; Both required fields complete, no error
"RTN","IBCBB11",286,0)
 . I IBAC(2)'="",IBAC(3)'="" S IBLNERR=0 Q
"RTN","IBCBB11",287,0)
 . ; At this point, one of the 2 required fields has data and one does not, so error
"RTN","IBCBB11",288,0)
 . S IBLNERR=1
"RTN","IBCBB11",289,0)
 . Q
"RTN","IBCBB11",290,0)
 ;
"RTN","IBCBB11",291,0)
 Q IBLNERR
"RTN","IBCBB12")
0^81^B132831016^n/a
"RTN","IBCBB12",1,0)
IBCBB12 ;ALB/DEM - PROCEDURE AND LINE LEVEL PROVIDER EDITS ;17-OCT-2010
"RTN","IBCBB12",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCBB12",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB12",4,0)
 Q
"RTN","IBCBB12",5,0)
 ;
"RTN","IBCBB12",6,0)
LNPROV(IBIFN) ; DEM;432 - Edits for line level providers.
"RTN","IBCBB12",7,0)
 ;
"RTN","IBCBB12",8,0)
 ; Input:
"RTN","IBCBB12",9,0)
 ;       IBIFN - Claim number IEN.
"RTN","IBCBB12",10,0)
 ;
"RTN","IBCBB12",11,0)
 ; Output:
"RTN","IBCBB12",12,0)
 ;       OK - '1' Edits
"RTN","IBCBB12",13,0)
 ;            '0' No Edits.
"RTN","IBCBB12",14,0)
 ;       *Note: OK returned if called as function.
"RTN","IBCBB12",15,0)
 ;              Can be called as routine as well.
"RTN","IBCBB12",16,0)
 ;       IBER - Edit error string. Only updated if errors.
"RTN","IBCBB12",17,0)
 ;
"RTN","IBCBB12",18,0)
 ; Patch 432 EDITS:
"RTN","IBCBB12",19,0)
 ;
"RTN","IBCBB12",20,0)
 ; (1) Not all procedures have a Line Level Rendering Provider,
"RTN","IBCBB12",21,0)
 ;     and no Claim Level Rendering Provider.
"RTN","IBCBB12",22,0)
 ;     Error Message in Billing for Prof Rendering.
"RTN","IBCBB12",23,0)
 ;     *Note: Only applies to Rendering Provider Type.
"RTN","IBCBB12",24,0)
 ;
"RTN","IBCBB12",25,0)
 ; (2) All procedures have a Line Level Rendering Provider,
"RTN","IBCBB12",26,0)
 ;     and a Claim Level Rendering Provider who is different
"RTN","IBCBB12",27,0)
 ;     from any of the Line Level Rendering Providers.
"RTN","IBCBB12",28,0)
 ;     Error in Billing.
"RTN","IBCBB12",29,0)
 ;     *Note: Apply to all provider types (Rendering, Referring, Supervising, Attending, Operating, and Other Operating).
"RTN","IBCBB12",30,0)
 ;
"RTN","IBCBB12",31,0)
 N OK
"RTN","IBCBB12",32,0)
 S OK=0  ; Initialize OK=0 for FALSE.
"RTN","IBCBB12",33,0)
 Q:'$G(IBIFN) OK  ; Need claim number IEN to continue.
"RTN","IBCBB12",34,0)
 N IBPRVFUN,IBCLPRV,IBLNPRV,PRVFUN
"RTN","IBCBB12",35,0)
 S:'$G(IBFT) IBFT=$$FT^IBCEF(IBIFN)  ; Form Type for claim.
"RTN","IBCBB12",36,0)
 Q:(IBFT'=2)&(IBFT'=3) OK  ; Must be CMS-1500 (2) or UB-04 (3) Form Type.
"RTN","IBCBB12",37,0)
 S:IBFT=2 PRVFUN(2)="RENDERING,REFERRING,SUPERVISING"  ; Allowable line provider functions for CMS-1500.
"RTN","IBCBB12",38,0)
 S:IBFT=3 PRVFUN(3)="RENDERING,REFERRING,OPERATING,OTHER OPERATING"  ; Allowable line provider functions for UB-04.
"RTN","IBCBB12",39,0)
 F PRVFUN("CNT")=1:1:$L(PRVFUN(IBFT),",") S IBPRVFUN=$P(PRVFUN(IBFT),",",PRVFUN("CNT")) D
"RTN","IBCBB12",40,0)
 . I IBFT=2,IBPRVFUN="RENDERING",'$$LNPRV2(IBPRVFUN),'$D(^DGCR(399,IBIFN,"PRV","C",IBPRVFUN))  D  Q  ; Edit Check (1).
"RTN","IBCBB12",41,0)
 . . S OK=1  ; OK=1 indicates we have at least one error.
"RTN","IBCBB12",42,0)
 . . S IBER=IBER_"IB333;"
"RTN","IBCBB12",43,0)
 . . Q
"RTN","IBCBB12",44,0)
 . ;
"RTN","IBCBB12",45,0)
 . Q:'$$LNPRV2(IBPRVFUN,.IBLNPRV)  ; Quit if not all the procedures have a line level provider of the same provider type.
"RTN","IBCBB12",46,0)
 . Q:'$D(^DGCR(399,IBIFN,"PRV","C",IBPRVFUN))  ; No claim level provider for this provider type.
"RTN","IBCBB12",47,0)
 . ;
"RTN","IBCBB12",48,0)
 . Q:'$$CLPRV2(IBPRVFUN,.IBCLPRV)  ; Must have provider for provider type IBPRVFUN to continue (Edit (2)).
"RTN","IBCBB12",49,0)
 . ;
"RTN","IBCBB12",50,0)
 . S IBCLPRV=0 F  S IBCLPRV=$O(IBCLPRV(IBPRVFUN,IBCLPRV)) Q:'IBCLPRV  D  ; Edit Check (2).
"RTN","IBCBB12",51,0)
 . . Q:$D(IBLNPRV(IBPRVFUN,IBCLPRV))  ; Check against line provider array IBLNPRV.
"RTN","IBCBB12",52,0)
 . . S OK=1
"RTN","IBCBB12",53,0)
 . . S IBER=IBER_"IB334;"
"RTN","IBCBB12",54,0)
 . . Q
"RTN","IBCBB12",55,0)
 . Q
"RTN","IBCBB12",56,0)
 ;
"RTN","IBCBB12",57,0)
 Q OK
"RTN","IBCBB12",58,0)
 ;
"RTN","IBCBB12",59,0)
LNPRV2(IBPRVFUN,IBLNPRV) ; Function - Edit Check (2) for line level provider.
"RTN","IBCBB12",60,0)
 ; See Edit Check (2) at top of routine for details.
"RTN","IBCBB12",61,0)
 ;
"RTN","IBCBB12",62,0)
 ; Input:
"RTN","IBCBB12",63,0)
 ;       IBPRVFUN - Provider Type (FUNCTION). Example: RENDERING.
"RTN","IBCBB12",64,0)
 ;       IBLNPRV(Array) - Passed by reference. Intially undefined.
"RTN","IBCBB12",65,0)
 ;
"RTN","IBCBB12",66,0)
 ; Output:
"RTN","IBCBB12",67,0)
 ;       OK - If Edit Check (2) line level provider condition has
"RTN","IBCBB12",68,0)
 ;            been met, then OK will return '1' for TRUE, ELSE, '0'
"RTN","IBCBB12",69,0)
 ;            for FALSE.
"RTN","IBCBB12",70,0)
 ;            *See Edit Check (2) at top of routine for details.
"RTN","IBCBB12",71,0)
 ;       IBLNPRV(Array) - If Edit Check (2) condition has been met,
"RTN","IBCBB12",72,0)
 ;                        then IBLNPRV will contain the provider type,
"RTN","IBCBB12",73,0)
 ;                        and provider variable pointer as array
"RTN","IBCBB12",74,0)
 ;                        subscripts, and array element is SET to
"RTN","IBCBB12",75,0)
 ;                        NULL. => IBLNPRV(IBPRVFUN,IBLNPROV)="".
"RTN","IBCBB12",76,0)
 ;
"RTN","IBCBB12",77,0)
 N OK,IBPROCP,IBLPIEN,IBLNPROV
"RTN","IBCBB12",78,0)
 S IBPROCP=0 F  S IBPROCP=$O(^DGCR(399,IBIFN,"CP",IBPROCP)) Q:'IBPROCP  D  I $D(OK),'OK Q
"RTN","IBCBB12",79,0)
 . Q:'($D(^DGCR(399,IBIFN,"CP",IBPROCP,0))#10)
"RTN","IBCBB12",80,0)
 . I '$D(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV","C",IBPRVFUN)) S OK=0 Q  ; No line provider function for this procedure.
"RTN","IBCBB12",81,0)
 . S IBLPIEN=$O(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV","C",IBPRVFUN,0))
"RTN","IBCBB12",82,0)
 . I 'IBLPIEN S OK=0 Q  ; No line provider IEN for this line provider function.
"RTN","IBCBB12",83,0)
 . I '($D(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",IBLPIEN,0))#10) S OK=0 Q  ; No zero node for line level provider.
"RTN","IBCBB12",84,0)
 . S IBLNPROV=$P(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",IBLPIEN,0),"^",2)
"RTN","IBCBB12",85,0)
 . I 'IBLNPROV S OK=0 Q  ; No line provider for this line provider function.
"RTN","IBCBB12",86,0)
 . S IBLNPRV(IBPRVFUN,IBLNPROV)=""
"RTN","IBCBB12",87,0)
 . Q
"RTN","IBCBB12",88,0)
 ;
"RTN","IBCBB12",89,0)
 Q:$D(OK) OK  ; OK will never equal '1' for TRUE at this point.
"RTN","IBCBB12",90,0)
 I '$D(OK),'$D(IBLNPRV(IBPRVFUN)) S OK=0 Q OK  ; No line provider array for this line provider function.
"RTN","IBCBB12",91,0)
 S OK=1  ; Edit Check (2) line provider condition has been met.
"RTN","IBCBB12",92,0)
 Q OK
"RTN","IBCBB12",93,0)
 ;
"RTN","IBCBB12",94,0)
CLPRV2(IBPRVFUN,IBCLPRV) ; Function - Edit Check (2) for claim level provider.
"RTN","IBCBB12",95,0)
 ; See Edit Check (2) at top of routine for details.
"RTN","IBCBB12",96,0)
 ;
"RTN","IBCBB12",97,0)
 ; Input:
"RTN","IBCBB12",98,0)
 ;       IBPRVFUN - Provider Type (FUNCTION). Example: RENDERING.
"RTN","IBCBB12",99,0)
 ;       IBCLPRV(Array) - Passed by reference. Intially undefined.
"RTN","IBCBB12",100,0)
 ;
"RTN","IBCBB12",101,0)
 ; Output:
"RTN","IBCBB12",102,0)
 ;       OK - If Edit Check (2) claim level provider condition has
"RTN","IBCBB12",103,0)
 ;            been met, then OK will return '1' for TRUE, ELSE, '0'
"RTN","IBCBB12",104,0)
 ;            for FALSE.
"RTN","IBCBB12",105,0)
 ;            *See Edit Check (2) at top of routine for details.
"RTN","IBCBB12",106,0)
 ;       IBCLPRV(Array) - If Edit Check (2) condition has been met,
"RTN","IBCBB12",107,0)
 ;                        then IBCLPRV will contain the provider type,
"RTN","IBCBB12",108,0)
 ;                        and provider variable pointer as array
"RTN","IBCBB12",109,0)
 ;                        subscripts, and array element is SET to
"RTN","IBCBB12",110,0)
 ;                        NULL. => IBCLPRV(IBPRVFUN,IBCLPROV)="".
"RTN","IBCBB12",111,0)
 ;
"RTN","IBCBB12",112,0)
 N IBCLPIEN,IBCLPROV,OK
"RTN","IBCBB12",113,0)
 S OK=0  ; Initialize OK=0 for FALSE.
"RTN","IBCBB12",114,0)
 S IBCLPIEN=0 F  S IBCLPIEN=$O(^DGCR(399,IBIFN,"PRV","C",IBPRVFUN,IBCLPIEN)) Q:'IBCLPIEN  D  Q:OK
"RTN","IBCBB12",115,0)
 . Q:'($D(^DGCR(399,IBIFN,"PRV",IBCLPIEN,0))#10)
"RTN","IBCBB12",116,0)
 . S IBCLPROV=$P(^DGCR(399,IBIFN,"PRV",IBCLPIEN,0),"^",2)
"RTN","IBCBB12",117,0)
 . Q:'IBCLPROV
"RTN","IBCBB12",118,0)
 . S IBCLPRV(IBPRVFUN,IBCLPROV)=""  ; Set array for Edit Check (2) to compare claim level provider with line level provider.
"RTN","IBCBB12",119,0)
 . S OK=1  ; At this point we have our claim level provider of provider type IBPRVFUN. Set OK=1 for TRUE.
"RTN","IBCBB12",120,0)
 . Q
"RTN","IBCBB12",121,0)
 ;
"RTN","IBCBB12",122,0)
 Q:'OK OK
"RTN","IBCBB12",123,0)
 S OK=1
"RTN","IBCBB12",124,0)
 Q OK
"RTN","IBCBB12",125,0)
 ;
"RTN","IBCBB12",126,0)
OPPROVCK(IBIFN) ; DEM;432 - Other Operating Provider edit checks.
"RTN","IBCBB12",127,0)
 ;
"RTN","IBCBB12",128,0)
 ; Input:
"RTN","IBCBB12",129,0)
 ;       IBIFN - Claim number IEN.
"RTN","IBCBB12",130,0)
 ;
"RTN","IBCBB12",131,0)
 ; Output:
"RTN","IBCBB12",132,0)
 ;       OK - '1' Edits
"RTN","IBCBB12",133,0)
 ;            '0' No Edits.
"RTN","IBCBB12",134,0)
 ;       *Note: OK returned if called as function ($$).
"RTN","IBCBB12",135,0)
 ;              Can be called as routine as well.
"RTN","IBCBB12",136,0)
 ;
"RTN","IBCBB12",137,0)
 ; Patch 432 line level Other Operating Provider Edit checks:
"RTN","IBCBB12",138,0)
 ;
"RTN","IBCBB12",139,0)
 ; (1) If claim level Other Operating Provider, then
"RTN","IBCBB12",140,0)
 ;     (1.1) claim must have claim level Operating Provider.
"RTN","IBCBB12",141,0)
 ;           OR
"RTN","IBCBB12",142,0)
 ;     (1.2) every line must have Operating Provider.
"RTN","IBCBB12",143,0)
 ;
"RTN","IBCBB12",144,0)
 ;  If (1) Passes, then do edit check (2) below.
"RTN","IBCBB12",145,0)
 ;
"RTN","IBCBB12",146,0)
 ;  (2) If any claim line has Other Operating Provider, then
"RTN","IBCBB12",147,0)
 ;      (2.1) must have Operating Provider on same claim line,
"RTN","IBCBB12",148,0)
 ;            OR
"RTN","IBCBB12",149,0)
 ;      (2.2) must have claim level Operating Provider.
"RTN","IBCBB12",150,0)
 ;
"RTN","IBCBB12",151,0)
 N OK
"RTN","IBCBB12",152,0)
 S OK=0  ; Initialize OK=0 for FALSE.
"RTN","IBCBB12",153,0)
 Q:'$G(IBIFN) OK  ; Need claim number IEN to continue.
"RTN","IBCBB12",154,0)
 S:'$G(IBFT) IBFT=$$FT^IBCEF(IBIFN)  ; Form Type for claim.
"RTN","IBCBB12",155,0)
 Q:(IBFT'=2)&(IBFT'=3) OK  ; Must be CMS-1500 (2) or UB-04 (3) Form Type.
"RTN","IBCBB12",156,0)
 ;
"RTN","IBCBB12",157,0)
 N IBPRVFUN,IBLNFLAG,IBLNPRV,CLOK,LNOK
"RTN","IBCBB12",158,0)
 ;
"RTN","IBCBB12",159,0)
 ; Note: Claim level provider - OTHER and OTHER OPERATING are the same.
"RTN","IBCBB12",160,0)
 ; Check if condition (1) has been met.
"RTN","IBCBB12",161,0)
 F IBPRVFUN="OTHER","OTHER OPERATING" S CLOK=$$CLOPPRV1(IBPRVFUN) Q:CLOK
"RTN","IBCBB12",162,0)
 Q:'CLOK OK  ; No claim level OTHER OPERATING PROVIDER, then QUIT, no further checks.
"RTN","IBCBB12",163,0)
 S OK=0  ; Initialize OK=0 for FALSE. 
"RTN","IBCBB12",164,0)
 ; Condition (1) has been met, check condtion (1.1).
"RTN","IBCBB12",165,0)
 S CLOK=0  ; Initialize CLOK=0 for FALSE.
"RTN","IBCBB12",166,0)
 I $D(^DGCR(399,IBIFN,"PRV","C","OPERATING")) S IBPRVFUN="OPERATING",CLOK=$$CLOPPRV1(IBPRVFUN)  ; Check condition (1.1).
"RTN","IBCBB12",167,0)
 ; If CLOK at this point, then skip condition check (1.2) and continue to condition (2).
"RTN","IBCBB12",168,0)
 S LNOK=0  ; Initialize LNOK=0 for FALSE.
"RTN","IBCBB12",169,0)
 I 'CLOK S IBPRVFUN="OPERATING",LNOK=$$LNOPPRV1(IBPRVFUN) I 'LNOK S OK=1 Q OK  ; Check condition (1.2). If 'LNOK, then we have an error and QUIT.
"RTN","IBCBB12",170,0)
 ; If LNOK, then continue to condition check (2).
"RTN","IBCBB12",171,0)
 S LNOK=0  ; Initialize LNOK=0 for FALSE.
"RTN","IBCBB12",172,0)
 K IBLNPRV  ; KILL IBLNPRV array before call to $$LNOPPRV1(IBPRVFUN,1,.IBLNPRV).
"RTN","IBCBB12",173,0)
 S IBPRVFUN="OTHER OPERATING",LNOK=$$LNOPPRV1(IBPRVFUN,1,.IBLNPRV)  ; Condition check (2) start.
"RTN","IBCBB12",174,0)
 I '$D(IBLNPRV("PRVFUN")) S OK=0 Q OK  ; If no data in IBLNPRV("PRVFUN") array, then skip rest of checks, no error.
"RTN","IBCBB12",175,0)
 ; If data in IBLNPRV("PRVFUN") array, then check condition (2.1).
"RTN","IBCBB12",176,0)
 S IBPRVFUN="OPERATING",LNOK=$$LNOPPRV1(IBPRVFUN,1,.IBLNPRV)  ; Condition check (2.1) start.
"RTN","IBCBB12",177,0)
 S LNOK=0  ; Initialize LNOK=0 for FALSE.
"RTN","IBCBB12",178,0)
 D:$D(IBLNPRV("PRVFUN"))  ; If data in IBLNPRV("PRVFUN") array, then continue condition check (2.1).
"RTN","IBCBB12",179,0)
 . N IBPROCP
"RTN","IBCBB12",180,0)
 . S IBPROCP=0 F  S IBPROCP=$O(IBLNPRV("PROC",IBPROCP)) Q:'IBPROCP  D  Q:'LNOK
"RTN","IBCBB12",181,0)
 . . I $D(IBLNPRV("PROC",IBPROCP,"OTHER OPERATING")),'$D(IBLNPRV("PROC",IBPROCP,"OPERATING")) S LNOK=0 Q
"RTN","IBCBB12",182,0)
 . . S LNOK=1  ; At this point, we have at least one match. If there wasn't a match, then LNOK=0 and we would have QUIT.
"RTN","IBCBB12",183,0)
 . . Q
"RTN","IBCBB12",184,0)
 . Q
"RTN","IBCBB12",185,0)
 I LNOK S OK=0 Q OK  ; Conditions (2) and (2.1) are met (no error). SET OK=0 and QUIT.
"RTN","IBCBB12",186,0)
 ; If 'LNOK, then continue to condition check (2.2).
"RTN","IBCBB12",187,0)
 S CLOK=0  ; Initialize CLOK=0 for FALSE.
"RTN","IBCBB12",188,0)
 S IBPRVFUN="OPERATING",CLOK=$$CLOPPRV1(IBPRVFUN)  ; Condition check (2.2).
"RTN","IBCBB12",189,0)
 I CLOK S OK=0 Q OK  ; Conditions (2) and (2.2) are met (no error). SET OK=0 and QUIT.
"RTN","IBCBB12",190,0)
 ; At this point, we have an error. SET OK=1, and QUIT.
"RTN","IBCBB12",191,0)
 S OK=1
"RTN","IBCBB12",192,0)
 Q OK
"RTN","IBCBB12",193,0)
 ;
"RTN","IBCBB12",194,0)
CLOPPRV1(IBPRVFUN) ; Claim level provider/provider function check.
"RTN","IBCBB12",195,0)
 ;
"RTN","IBCBB12",196,0)
 ; Check if there is a claim level provider with provider function IBPRVFUN.
"RTN","IBCBB12",197,0)
 ;
"RTN","IBCBB12",198,0)
 ; Input:
"RTN","IBCBB12",199,0)
 ;       IBPRVFUN - PROVIDER FUNCTION.
"RTN","IBCBB12",200,0)
 ;
"RTN","IBCBB12",201,0)
 ; Output:
"RTN","IBCBB12",202,0)
 ;       OK - '1' Claim level provider exist for provider function IBPRVFUN.
"RTN","IBCBB12",203,0)
 ;            '0' No Claim level provider exist for provider function IBPRVFUN.
"RTN","IBCBB12",204,0)
 ;
"RTN","IBCBB12",205,0)
 N OK,IBCLPIEN,IBCLPROV
"RTN","IBCBB12",206,0)
 S OK=0  ; Initialize OK=0 for FALSE.
"RTN","IBCBB12",207,0)
 ;
"RTN","IBCBB12",208,0)
 I $D(^DGCR(399,IBIFN,"PRV","C",IBPRVFUN)) D
"RTN","IBCBB12",209,0)
 . S IBCLPIEN=0 F  S IBCLPIEN=$O(^DGCR(399,IBIFN,"PRV","C",IBPRVFUN,IBCLPIEN)) Q:'IBCLPIEN  D  Q:OK
"RTN","IBCBB12",210,0)
 . . Q:'($D(^DGCR(399,IBIFN,"PRV",IBCLPIEN,0))#10)
"RTN","IBCBB12",211,0)
 . . S IBCLPROV=$P(^DGCR(399,IBIFN,"PRV",IBCLPIEN,0),U,2)
"RTN","IBCBB12",212,0)
 . . Q:'IBCLPROV
"RTN","IBCBB12",213,0)
 . . S OK=1  ; At this point we have claim level provider with provider function IBPRVFUN and can QUIT function/subroutine.
"RTN","IBCBB12",214,0)
 . . Q
"RTN","IBCBB12",215,0)
 . Q
"RTN","IBCBB12",216,0)
 ;
"RTN","IBCBB12",217,0)
 Q OK
"RTN","IBCBB12",218,0)
 ;
"RTN","IBCBB12",219,0)
LNOPPRV1(IBPRVFUN,IBLNFLAG,IBLNPRV,IBPROCHK) ; Check every claim line for provider function IBPRVFUN.
"RTN","IBCBB12",220,0)
 ;
"RTN","IBCBB12",221,0)
 ;
"RTN","IBCBB12",222,0)
 ; Input:
"RTN","IBCBB12",223,0)
 ;       IBPRVFUN - PROVIDER FUNCTION.
"RTN","IBCBB12",224,0)
 ;       IBLNFLAG(Optional) = 1 or 0. 1 indicates return IBLNPRV array passed by reference, otherwise '0' for NO.
"RTN","IBCBB12",225,0)
 ;       IBLNPRV(Optional) - Array passed by reference => IF SET OK=1, then
"RTN","IBCBB12",226,0)
 ;                           I $G(IBLNFLAG) S IBLNPRV("PROC",IBPROCP,IBPRVFUN)="",IBLNPRV("PRVFUN",IBPRVFUN,IBPROCP)=""
"RTN","IBCBB12",227,0)
 ;       IBPROCHK - Condition on PROCEDURE (ICD, CPT, or HCFA procedure codes).
"RTN","IBCBB12",228,0)
 ;
"RTN","IBCBB12",229,0)
 ; Output:
"RTN","IBCBB12",230,0)
 ;       OK - '1' Every line level provider exist for provider function IBPRVFUN.
"RTN","IBCBB12",231,0)
 ;            '0' Not every line level provider exist for provider function IBPRVFUN.
"RTN","IBCBB12",232,0)
 ;
"RTN","IBCBB12",233,0)
 N OK
"RTN","IBCBB12",234,0)
 S OK=0  ; Initialize OK=0 for FALSE.
"RTN","IBCBB12",235,0)
 ;
"RTN","IBCBB12",236,0)
 N IBLPIEN,IBLNPROV,IBPROCP
"RTN","IBCBB12",237,0)
 S IBPROCP=0 F  S IBPROCP=$O(^DGCR(399,IBIFN,"CP",IBPROCP)) Q:'IBPROCP  D  Q:($D(^DGCR(399,IBIFN,"CP",IBPROCP,0))#10)&('OK)
"RTN","IBCBB12",238,0)
 . Q:'($D(^DGCR(399,IBIFN,"CP",IBPROCP,0))#10)  ; No procedure '0' node.
"RTN","IBCBB12",239,0)
 . I $G(IBPROCHK)'="" Q:$P(^DGCR(399,IBIFN,"CP",IBPROCP,0),U,1)'[IBPROCHK
"RTN","IBCBB12",240,0)
 . I '$D(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV","C",IBPRVFUN)) S OK=0 Q  ; No line provider function IBPRVFUN for this procedure.
"RTN","IBCBB12",241,0)
 . S IBLPIEN=$O(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV","C",IBPRVFUN,0))
"RTN","IBCBB12",242,0)
 . I 'IBLPIEN S OK=0 Q  ; No line provider IEN for this line provider function.
"RTN","IBCBB12",243,0)
 . I '($D(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",IBLPIEN,0))#10) S OK=0 Q  ; No '0' node for line level provider.
"RTN","IBCBB12",244,0)
 . S IBLNPROV=$P(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",IBLPIEN,0),U,2)
"RTN","IBCBB12",245,0)
 . I 'IBLNPROV S OK=0 Q  ; No line provider for this line provider function.
"RTN","IBCBB12",246,0)
 . ; At this point we have line level provider of type IBPRVFUN.
"RTN","IBCBB12",247,0)
 . ; S OK=1 for this claim line. OK can be changed back to '0', for FALSE, if claim line fails condition.
"RTN","IBCBB12",248,0)
 . ; We would not get to this point if any line level provider with provider function IBPRVFUN didn't exist.
"RTN","IBCBB12",249,0)
 . S OK=1
"RTN","IBCBB12",250,0)
 . I $G(IBLNFLAG) S IBLNPRV("PROC",IBPROCP,IBPRVFUN)="",IBLNPRV("PRVFUN",IBPRVFUN,IBPROCP)=""
"RTN","IBCBB12",251,0)
 . Q
"RTN","IBCBB12",252,0)
 ;
"RTN","IBCBB12",253,0)
 Q OK
"RTN","IBCBB12",254,0)
 ;
"RTN","IBCBB12",255,0)
UBPRVCK(IBIFN) ; DEM;432 - Check if claim requires operating provider.
"RTN","IBCBB12",256,0)
 ;
"RTN","IBCBB12",257,0)
 ; Description: This function checks if claim requires an operating provider.
"RTN","IBCBB12",258,0)
 ;
"RTN","IBCBB12",259,0)
 ;              Checks:
"RTN","IBCBB12",260,0)
 ;
"RTN","IBCBB12",261,0)
 ;              (1) If claim has a claim level operating provider,
"RTN","IBCBB12",262,0)
 ;                  then no further checks (OK=1=TRUE).
"RTN","IBCBB12",263,0)
 ;              (2) If claim doesn't have a claim level operating provider,
"RTN","IBCBB12",264,0)
 ;                  then check:
"RTN","IBCBB12",265,0)
 ;                  (2.1) Is this a UB-04 claim? NO = QUIT (OK=1), YES = Continue to next check.
"RTN","IBCBB12",266,0)
 ;                  (2.2) Check every claim line that includes HCPCS procs - operating provider.
"RTN","IBCBB12",267,0)
 ;                        If every claim line that includes HCPCS procs has an operating provider,
"RTN","IBCBB12",268,0)
 ;                        then we are OK and QUIT (OK=1).
"RTN","IBCBB12",269,0)
 ;                        If any claim line that includes HCPCS procs doesn't have an operating
"RTN","IBCBB12",270,0)
 ;                        provider, then we have an ERROR (OK=0). 
"RTN","IBCBB12",271,0)
 ;
"RTN","IBCBB12",272,0)
 ; Input:
"RTN","IBCBB12",273,0)
 ;       IBIFN = Claim number IEN.
"RTN","IBCBB12",274,0)
 ;
"RTN","IBCBB12",275,0)
 ; Output:
"RTN","IBCBB12",276,0)
 ;        OK = 0 = claim doesn't have an operating provider
"RTN","IBCBB12",277,0)
 ;                 when operating provider or rendering provider required.
"RTN","IBCBB12",278,0)
 ;        OK = 1 = claim has an operating provider, or,
"RTN","IBCBB12",279,0)
 ;                 claim doesn't require operating provider.
"RTN","IBCBB12",280,0)
 ;
"RTN","IBCBB12",281,0)
 N OK
"RTN","IBCBB12",282,0)
 ; If claim doesn't have any procedure codes, then no checks required.
"RTN","IBCBB12",283,0)
 I '$O(^DGCR(399,IBIFN,"CP",0)) S OK=1 Q OK
"RTN","IBCBB12",284,0)
 ;
"RTN","IBCBB12",285,0)
 S OK=$$CLOPPRV1("OPERATING")  ; Do we have a claim level OPERATING PROVIDER (OK=1=TRUE)?
"RTN","IBCBB12",286,0)
 Q:OK OK  ; QUIT, we have a claim level OPERATING PROVIDER (OK=1=TRUE).
"RTN","IBCBB12",287,0)
 ;
"RTN","IBCBB12",288,0)
 N IBFT
"RTN","IBCBB12",289,0)
 S IBFT=($$FT^IBCEF(IBIFN)=3)  ; UB-04 claim (1 = TRUE, 0 = FALSE)?
"RTN","IBCBB12",290,0)
 S OK=1  ; Initialize OK=1.
"RTN","IBCBB12",291,0)
 Q:'IBFT OK  ; QUIT OK=1, not a UB-04 claim.
"RTN","IBCBB12",292,0)
 ;
"RTN","IBCBB12",293,0)
 ; Claim level check did not pass, check claim lines.
"RTN","IBCBB12",294,0)
 ; No claim level OPERATING PROVIDER, so check every PROCEDURE for OPERATING PROVIDER.
"RTN","IBCBB12",295,0)
 S OK=$$UBPRVCK1("") ; Does every procedure have an OPERATING PROVIDER(1=TRUE,0=FALSE)?
"RTN","IBCBB12",296,0)
 ;
"RTN","IBCBB12",297,0)
 Q OK
"RTN","IBCBB12",298,0)
 ;
"RTN","IBCBB12",299,0)
UBPRVCK1(IBPROCHK,IBONE) ; DEM;432 - Continuation of UBPRVCK function.
"RTN","IBCBB12",300,0)
 ;
"RTN","IBCBB12",301,0)
 ; Input:
"RTN","IBCBB12",302,0)
 ;       IBPROCHK(Optional) - Optional condition on PROCEDURE CODE (ICD, CPT, or HCFA procedure codes).
"RTN","IBCBB12",303,0)
 ;       IBONE(Optional) - Quit if at least one line has an OPERATING
"RTN","IBCBB12",304,0)
 ;
"RTN","IBCBB12",305,0)
 ; Output:
"RTN","IBCBB12",306,0)
 ;       OK - '1' Every procedure code that contains IBPROCHK (optional check) has an OPERATING PROVIDER.
"RTN","IBCBB12",307,0)
 ;            or if IBONE, then at least one procedure code that contains IBPROCHK (optional check) has an OPERATING PROVIDER.
"RTN","IBCBB12",308,0)
 ;            '0' Not every procedure code that contains IBPROCHK (optional check) has an OPERATING PROVIDER.
"RTN","IBCBB12",309,0)
 ;            or if IBONE, then NO procedure codes that contain IBPROCHK (optional check) has an OPERATING PROVIDER.
"RTN","IBCBB12",310,0)
 ;
"RTN","IBCBB12",311,0)
 N OK
"RTN","IBCBB12",312,0)
 S OK=0  ; Initialize OK=0 for FALSE.
"RTN","IBCBB12",313,0)
 ;
"RTN","IBCBB12",314,0)
 N IBLPIEN,IBLNPROV,IBPROCP
"RTN","IBCBB12",315,0)
 S IBPROCP=0 F  S IBPROCP=$O(^DGCR(399,IBIFN,"CP",IBPROCP)) Q:'IBPROCP  D  Q:($D(^DGCR(399,IBIFN,"CP",IBPROCP,0))#10)&('OK)&('$G(IBONE))  I $G(IBONE),$G(OK) Q
"RTN","IBCBB12",316,0)
 . Q:'($D(^DGCR(399,IBIFN,"CP",IBPROCP,0))#10)  ; No procedure '0' node.
"RTN","IBCBB12",317,0)
 . I $G(IBPROCHK)'="" Q:$P(^DGCR(399,IBIFN,"CP",IBPROCP,0),U,1)'[IBPROCHK
"RTN","IBCBB12",318,0)
 . I '$D(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV","C","OPERATING")) S OK=0 Q  ; No line OPERATING PROVIDER for this procedure.
"RTN","IBCBB12",319,0)
 . S IBLPIEN=$O(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV","C","OPERATING",0))
"RTN","IBCBB12",320,0)
 . I 'IBLPIEN S OK=0 Q  ; No line provider IEN for this line provider function.
"RTN","IBCBB12",321,0)
 . I '($D(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",IBLPIEN,0))#10) S OK=0 Q  ; No '0' node for line level provider.
"RTN","IBCBB12",322,0)
 . S IBLNPROV=$P(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",IBLPIEN,0),U,2)
"RTN","IBCBB12",323,0)
 . I 'IBLNPROV S OK=0 Q  ; No line provider for this line provider function.
"RTN","IBCBB12",324,0)
 . ; At this point we have line level provider of type OPERATING.
"RTN","IBCBB12",325,0)
 . ; S OK=1 for this claim line. OK can be changed back to '0', for FALSE, if claim line fails condition.
"RTN","IBCBB12",326,0)
 . ; We would not get to this point if any line level provider with provider function OPERATING didn't exist.
"RTN","IBCBB12",327,0)
 . S OK=1
"RTN","IBCBB12",328,0)
 . Q
"RTN","IBCBB12",329,0)
 ;
"RTN","IBCBB12",330,0)
 Q OK
"RTN","IBCBB2")
0^48^B49120476^B44800809
"RTN","IBCBB2",1,0)
IBCBB2 ;ALB/ARH - CONTINUATION OF EDIT CHECKS ROUTINE (CMS-1500) ;04/14/92
"RTN","IBCBB2",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,210,245,232,296,320,349,371,403,432**;21-MAR-94;Build 192
"RTN","IBCBB2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB2",4,0)
 ;
"RTN","IBCBB2",5,0)
 ;MAP TO DGCRBB2
"RTN","IBCBB2",6,0)
 ;
"RTN","IBCBB2",7,0)
EN ;
"RTN","IBCBB2",8,0)
 N IBI,IBJ,IBN,IBY,IBDX,IBDXO,IBDXL,IBDXTYP,IBCPT,IBCPTL,IBOLAB,Z,IBXSAVE,IBLOC,IBTX,IBPS,IBSP,IBLCT,IBNVFLG,IBU3
"RTN","IBCBB2",9,0)
 I '$D(IBER) S IBER=""
"RTN","IBCBB2",10,0)
 S IBTX=$$TXMT^IBCEF4(IBIFN)
"RTN","IBCBB2",11,0)
 ;
"RTN","IBCBB2",12,0)
 ; Max 4 modifiers per CPT code allowed before warning
"RTN","IBCBB2",13,0)
 K IBXDATA
"RTN","IBCBB2",14,0)
 D F^IBCEF("N-HCFA 1500 MODIFIERS",,,IBIFN) ;Get modifiers
"RTN","IBCBB2",15,0)
 ;
"RTN","IBCBB2",16,0)
 S Z=0 F  S Z=$O(IBZPRC92(Z)) Q:'Z  I $P(IBZPRC92(Z),U)["ICPT(",$L($P(IBZPRC92(Z),U,15),",")>4 S IBI="Proc "_$$PRCD^IBCEF1($P(IBZPRC92(Z),U))_" has > 4 modifiers - only first 4 will be used" D WARN^IBCBB11(IBI)
"RTN","IBCBB2",17,0)
 ; ICD-9 diagnosis, at least 1 required
"RTN","IBCBB2",18,0)
 D SET^IBCSC4D(IBIFN,.IBDX,.IBDXO) I '$P(IBDX,U,2) S IBER=IBER_"IB071;"
"RTN","IBCBB2",19,0)
 S IBI=$O(IBDXO(0))
"RTN","IBCBB2",20,0)
 I IBI D
"RTN","IBCBB2",21,0)
 .S IBDXTYP=$E($$ICD9^IBACSV(+$P(IBDXO(IBI),U)))
"RTN","IBCBB2",22,0)
 .S:IBDXTYP="E" IBER=IBER_"IB117;"
"RTN","IBCBB2",23,0)
 .I $$INPAT^IBCEF(IBIFN,1),IBDXTYP="V" S Z="Principal Dx V-code may not be valid" D WARN^IBCBB11(Z)
"RTN","IBCBB2",24,0)
 .Q
"RTN","IBCBB2",25,0)
 ;
"RTN","IBCBB2",26,0)
 ; CPT procs must be associated with a dx, must have a defined provider
"RTN","IBCBB2",27,0)
 S (IBLOC,IBN,IBI,IBY)=0 F  S IBI=$O(^DGCR(399,IBIFN,"CP",IBI)) Q:IBI'?1N.N  S IBCPT=^(IBI,0) D  I +IBY S IBN=1
"RTN","IBCBB2",28,0)
 . I 'IBLOC,$P(IBCPT,U,15)'="",IBTX S Z="At least 1 charge has local box 24K data that will not be transmitted - " S IBLOC=1 D WARN^IBCBB11(Z) S Z="  This data will only print locally" D WARN^IBCBB11(Z)
"RTN","IBCBB2",29,0)
 . I $P(IBCPT,U)'["ICPT(" S:IBER'["IB092" IBER=IBER_"IB092;" Q
"RTN","IBCBB2",30,0)
 . S IBY=1 F IBJ=11:1:14 I +$P(IBCPT,"^",IBJ) S IBCPTL(+$P(IBCPT,"^",IBJ))="",IBY=0
"RTN","IBCBB2",31,0)
 I +IBN S IBER=IBER_"IB072;"
"RTN","IBCBB2",32,0)
 ;
"RTN","IBCBB2",33,0)
 I '$$OCC10(IBIFN,.IBDX,2) S IBER=IBER_"IB093;"
"RTN","IBCBB2",34,0)
 ; CMS-1500: dxs associated with procs must be defined dxs for the bill
"RTN","IBCBB2",35,0)
 S IBI=0 F  S IBI=$O(IBDX(IBI))  Q:'IBI  S IBDXL(IBDX(IBI))=""
"RTN","IBCBB2",36,0)
 S (IBN,IBI)=0 F  S IBI=$O(IBCPTL(IBI)) Q:'IBI  I '$D(IBDXL(IBI)) S IBN=1 Q
"RTN","IBCBB2",37,0)
 I +IBN S IBER=IBER_"IB073;"
"RTN","IBCBB2",38,0)
 ; ejk *296* Change # of diagnoses codes from 4 to 8 on CMS-1500 Claims. 
"RTN","IBCBB2",39,0)
 I IBTX S IBI=8 F  S IBI=$O(IBDXO(IBI)) Q:'IBI  S Z=+$G(IBDX(+$G(IBDXO(IBI)))) I Z,$D(IBCPTL(Z)) D WARN^IBCBB11("Too many diagnoses for claim & will be rejected - consider printing locally")
"RTN","IBCBB2",40,0)
 ;
"RTN","IBCBB2",41,0)
 I $$WNRBILL^IBEFUNC(IBIFN),$$MRATYPE^IBEFUNC(IBIFN)'="B" S IBER=IBER_"IB087;"
"RTN","IBCBB2",42,0)
 ;
"RTN","IBCBB2",43,0)
 ; IB*320 - CLIA# error/warning - error msg for MRA claims, else warning
"RTN","IBCBB2",44,0)
 I $P(IBNDU2,U,13)="",$$CLIAREQ^IBCEP8A(IBIFN) D
"RTN","IBCBB2",45,0)
 . I $$REQMRA^IBEFUNC(IBIFN) S IBER=IBER_"IB235;" Q
"RTN","IBCBB2",46,0)
 . D WARN^IBCBB11("Claim contains laboratory services. The payer may require a CLIA #.")
"RTN","IBCBB2",47,0)
 . Q
"RTN","IBCBB2",48,0)
 ;
"RTN","IBCBB2",49,0)
 ; Only one occurrence code can be present for event date for box 14
"RTN","IBCBB2",50,0)
 S Z=$$EVENT^IBCF22(IBIFN,.IBXSAVE,.IBI)
"RTN","IBCBB2",51,0)
 I IBI S IBER=IBER_"IB099;"
"RTN","IBCBB2",52,0)
 ;
"RTN","IBCBB2",53,0)
 ; esg - 6/6/07 - warning if missing non-VA care type for outside facility
"RTN","IBCBB2",54,0)
 S IBNVFLG=0
"RTN","IBCBB2",55,0)
 I $P(IBNDU2,U,10),'$P(IBNDU2,U,11) D WARN^IBCBB11("Non-VA facility indicated, but the Non-VA Care Type field is not defined") S IBNVFLG=1
"RTN","IBCBB2",56,0)
 ;
"RTN","IBCBB2",57,0)
 ; unit/charge limits
"RTN","IBCBB2",58,0)
 K IBXDATA
"RTN","IBCBB2",59,0)
 D F^IBCEF("N-HCFA 1500 SERVICES (PRINT)",,,IBIFN) ;Get charge lines
"RTN","IBCBB2",60,0)
 S (IBLCT,IBOLAB)=0,IBPS="",IBSP=$$BILLSPEC^IBCEU3(IBIFN)
"RTN","IBCBB2",61,0)
 S IBI=0 F  S IBI=$O(IBXDATA(IBI)) Q:'IBI  D  Q:IBER["IB310"!(IBER["IB311")
"RTN","IBCBB2",62,0)
 . S IBLCT=IBLCT+1
"RTN","IBCBB2",63,0)
 . I $P(IBNDU2,U,11) D
"RTN","IBCBB2",64,0)
 .. I '$P(IBXDATA(IBI),U,11) S IBPS=IBPS_$S(IBPS'="":",",1:"")_IBI Q
"RTN","IBCBB2",65,0)
 .. I $P(IBXDATA(IBI),U,14),"24"'[$P(IBNDU2,U,11) D WARN^IBCBB11("Outside lab charges exist on a non-lab NON-VA bill")
"RTN","IBCBB2",66,0)
 . I '$P(IBNDU2,U,11),$P(IBXDATA(IBI),U,11) D WARN^IBCBB11("Purchased service amounts are invalid unless this is a NON-VA bill")
"RTN","IBCBB2",67,0)
 . I IBNVFLG,'$P(IBXDATA(IBI),U,11) D WARN^IBCBB11("Non-VA facility indicated, but no purchased service charge on line# "_IBI)
"RTN","IBCBB2",68,0)
 . I $D(IBXDATA(IBI,"A")) S IBER=IBER_"IB310;" Q
"RTN","IBCBB2",69,0)
 . I $D(IBXDATA(IBI,"ARX")),IBER'["311;" S IBER=IBER_"IB311;" Q
"RTN","IBCBB2",70,0)
 . I $P(IBXDATA(IBI),U,14) S IBOLAB=IBOLAB+1
"RTN","IBCBB2",71,0)
 . ; Place of service required
"RTN","IBCBB2",72,0)
 . I $G(IBER)'["IB314;",$P(IBXDATA(IBI),U,3)="" S IBER=IBER_"IB314;"
"RTN","IBCBB2",73,0)
 . ; Type of service required
"RTN","IBCBB2",74,0)
 . I $G(IBER)'["IB313;",$P(IBXDATA(IBI),U,4)="" S IBER=IBER_"IB313;"
"RTN","IBCBB2",75,0)
 . ; 43 and 53 are invalid types of service
"RTN","IBCBB2",76,0)
 . I $G(IBER)'["IB110;",($P(IBXDATA(IBI),U,4)=43!($P(IBXDATA(IBI),U,4)=53)) S IBER=IBER_"IB110;"
"RTN","IBCBB2",77,0)
 . ; Units for the line item must be less than 100/1000
"RTN","IBCBB2",78,0)
 . I IBER'["IB088",$P(IBXDATA(IBI),U,9)'<100 D
"RTN","IBCBB2",79,0)
 .. I $P(IBXDATA(IBI),U,4)'=7 S IBER=IBER_"IB088;" Q
"RTN","IBCBB2",80,0)
 .. I $P(IBXDATA(IBI),U,9)'<1000 S IBER=IBER_"IB088;"
"RTN","IBCBB2",81,0)
 . ; Line item total charge must be less than $10,000.00, greater than 0
"RTN","IBCBB2",82,0)
 . ; IB*2.0*432 - The IB system shall provide the ability for users to enter maximum line item dollar amounts of 9999999.99.
"RTN","IBCBB2",83,0)
 . ; I IBER'["IB090",$P(IBXDATA(IBI),U,9)'<10000 S IBER=IBER_"IB090;"
"RTN","IBCBB2",84,0)
 . I IBER'["IB090",$P(IBXDATA(IBI),U,9)'<10000000 S IBER=IBER_"IB090;"
"RTN","IBCBB2",85,0)
 . I '($P(IBXDATA(IBI),U,9)*$P(IBXDATA(IBI),U,8)),$$COBN^IBCEF(IBIFN)'>1 S Z="Procedure "_$P(IBXDATA(IBI),U,5)_" has a 0-charge and will not be transmitted" D WARN^IBCBB11(Z)
"RTN","IBCBB2",86,0)
 I IBTX,IBLCT>50 D
"RTN","IBCBB2",87,0)
 . I '$$REQMRA^IBEFUNC(IBIFN) S IBER=IBER_"IB308;" Q
"RTN","IBCBB2",88,0)
 . I '$P(IBNDTX,U,9) S IBER=IBER_"IB325;"
"RTN","IBCBB2",89,0)
 S IBU3=$P($G(^DGCR(399,IBIFN,"U3")),U,4,7) I $TR(IBU3,U)'="" D
"RTN","IBCBB2",90,0)
 .; ib*2.0*432 add line-level check
"RTN","IBCBB2",91,0)
 .;I +IBSP'=35 D WARN^IBCBB11("Chiropractic service details only valid if provider specialty is '35'")
"RTN","IBCBB2",92,0)
 .I $$LINSPEC^IBCEU3(IBIFN)'[35 D WARN^IBCBB11("Chiropractic service details only valid if provider specialty is '35'")
"RTN","IBCBB2",93,0)
 .I $P(IBU3,U,2)="" S IBER=IBER_"IB137;"
"RTN","IBCBB2",94,0)
 .I $P(IBU3,U,4)="" S IBER=IBER_"IB138;" Q
"RTN","IBCBB2",95,0)
 .I $P(IBU3,U,3)="","AM"[$P(IBU3,U,4) S IBER=IBER_"IB139;"
"RTN","IBCBB2",96,0)
 .Q
"RTN","IBCBB2",97,0)
 I IBPS'="" D WARN^IBCBB11("NON-VA facility indicated, but no purchased service charge on line item"_$S(IBPS[",":"s",1:"")_" #"_IBPS)
"RTN","IBCBB2",98,0)
 I $P(IBNDU2,U,11),$P(IBNDU2,U,11)=4,IBOLAB>1 D WARN^IBCBB11("For proper payment, you must bill each outside lab on a separate claim form")
"RTN","IBCBB2",99,0)
 K IBXDATA
"RTN","IBCBB2",100,0)
 ;
"RTN","IBCBB2",101,0)
 ;       ; Check for Physician Name
"RTN","IBCBB2",102,0)
 D F^IBCEF("N-REFERRING PROVIDER NAME",,,IBIFN)
"RTN","IBCBB2",103,0)
 I $P($G(IBXDATA),U)]"" D
"RTN","IBCBB2",104,0)
 .N IBZ,FUNCTION,IBINS
"RTN","IBCBB2",105,0)
 .S FUNCTION=1
"RTN","IBCBB2",106,0)
 .F IBINS=1:1:3 D
"RTN","IBCBB2",107,0)
 .. S Z=$$GETTYP^IBCEP2A(IBIFN,IBINS,FUNCTION)
"RTN","IBCBB2",108,0)
 .. I Z,$P(Z,U,2) D  ; Rendering/attending prov secondary id required
"RTN","IBCBB2",109,0)
 ... N IBID,IBOK,Q0
"RTN","IBCBB2",110,0)
 ... D PROVINF^IBCEF74(IBIFN,IBINS,.IBID,1,"C")  ; check all as though they were current
"RTN","IBCBB2",111,0)
 ... S IBOK=0
"RTN","IBCBB2",112,0)
 ... S Q0=0 F  S Q0=$O(IBID(1,FUNCTION,Q0)) Q:'Q0  I $P(IBID(1,FUNCTION,Q0),U,9)=+Z S IBOK=1 Q
"RTN","IBCBB2",113,0)
 ... I 'IBOK S IBER=IBER_$S(IBINS=1:"IB239;",IBINS=2:"IB240;",IBINS=3:"IB241;",1:"")
"RTN","IBCBB2",114,0)
 ;
"RTN","IBCBB2",115,0)
 Q
"RTN","IBCBB2",116,0)
 ;
"RTN","IBCBB2",117,0)
OCC10(IBIFN,IBARR,IBFT) ; Determine if occurrence code 10 exists for pregnancy dx
"RTN","IBCBB2",118,0)
 ; IBARR=array subscripted by ien of DX code if IBFT=2 (CMS-1500 form)
"RTN","IBCBB2",119,0)
 ;                         by seq # and = ien of DX code if IBFT'=2
"RTN","IBCBB2",120,0)
 ;
"RTN","IBCBB2",121,0)
 N IBN,IBI,IBXDATA,IBXSAVE,IBDX,Z
"RTN","IBCBB2",122,0)
 S IBN=1
"RTN","IBCBB2",123,0)
 ;
"RTN","IBCBB2",124,0)
 I '$D(^TMP($J,"LMD")) D
"RTN","IBCBB2",125,0)
 . D F^IBCEF("N-OCCURRENCE CODES",,,IBIFN)
"RTN","IBCBB2",126,0)
 . S ^TMP($J,"LMD")=""
"RTN","IBCBB2",127,0)
 . S Z=0 F  S Z=$O(IBXSAVE("OCC",Z)) Q:'Z  I +IBXSAVE("OCC",Z)=10 S ^TMP($J,"LMD")=1 Q
"RTN","IBCBB2",128,0)
 ;
"RTN","IBCBB2",129,0)
 I '^TMP($J,"LMD") S IBI=0 F  S IBI=$O(IBARR(IBI))  Q:'IBI  D  Q:'IBN
"RTN","IBCBB2",130,0)
 . N Z,Z1
"RTN","IBCBB2",131,0)
 . ; If a pregnancy DX exists, must be an occurrence code 10 for LMP date
"RTN","IBCBB2",132,0)
 . ; dx ranges are: V22*-V24*, V27*-V28*, 630*-677*
"RTN","IBCBB2",133,0)
 . S IBDX=$S($G(IBFT)'=2:+IBARR(IBI),1:IBI)
"RTN","IBCBB2",134,0)
 . S Z=$E($P($$ICD9^IBACSV(IBDX),U),1,3),Z1=$E(Z,2,3)
"RTN","IBCBB2",135,0)
 . I $S(Z'<630&(Z<678):1,$E(Z)="V":$S(Z1'<22&(Z1<25):1,1:Z1'<27&(Z1<28)),1:0) S IBN=0 ;Pregnancy Dx exists
"RTN","IBCBB2",136,0)
 ;
"RTN","IBCBB2",137,0)
OCC10Q K ^TMP($J,"LMD")
"RTN","IBCBB2",138,0)
 Q IBN
"RTN","IBCBB2",139,0)
 ;
"RTN","IBCBB21")
0^41^B15422214^B13422784
"RTN","IBCBB21",1,0)
IBCBB21 ;ALB/AAS - CONTINUATION OF EDIT CHECK ROUTINE FOR UB-04 ;2-NOV-89
"RTN","IBCBB21",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,210,232,155,291,348,349,403,400,432**;21-MAR-94;Build 192
"RTN","IBCBB21",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB21",4,0)
 ;
"RTN","IBCBB21",5,0)
EN(IBZPRC92) ;
"RTN","IBCBB21",6,0)
 ;
"RTN","IBCBB21",7,0)
 N ECODE,IBTXMT,IBXDATA,IBDXTYP,IBLPRT,IBI,Z,Z0,Z1,IBREQMRA
"RTN","IBCBB21",8,0)
 I '$D(IBZPRC92) D ALLPROC^IBCVA1(IBIFN,.IBZPRC92)
"RTN","IBCBB21",9,0)
 S IBREQMRA=$$REQMRA^IBEFUNC(IBIFN)    ; MRA?
"RTN","IBCBB21",10,0)
 K IBQUIT S IBQUIT=0
"RTN","IBCBB21",11,0)
 S (Z,Z0,Z1)=0
"RTN","IBCBB21",12,0)
 F  S Z=$O(IBZPRC92(Z)) Q:'Z  S:IBZPRC92(Z)["CPT" Z0=Z0+1 S:IBZPRC92(Z)["ICD" Z1=Z1+1
"RTN","IBCBB21",13,0)
 S IBTXMT=$$TXMT^IBCEF4(IBIFN)
"RTN","IBCBB21",14,0)
 S IBZPRC92=Z0_U_Z1 ;Save # of CPT's and ICD9's
"RTN","IBCBB21",15,0)
 ; More than 50 procedures on a bill - must print locally
"RTN","IBCBB21",16,0)
 I IBTXMT,(+IBZPRC92>50!(+$P(IBZPRC92,U,2)>50)) D  Q:IBQUIT
"RTN","IBCBB21",17,0)
 . I 'IBREQMRA S IBQUIT=$$IBER^IBCBB3(.IBER,308) Q
"RTN","IBCBB21",18,0)
 . I '$P(IBNDTX,U,9) S IBQUIT=$$IBER^IBCBB3(.IBER,325)
"RTN","IBCBB21",19,0)
 ; removed 11x check ;WCJ IB*2.0*432
"RTN","IBCBB21",20,0)
 ; If ICD9 procedures with dates and charges, bill 11x or 83x needs operating physician
"RTN","IBCBB21",21,0)
 ;I IBTOB12="11",$P(IBZPRC92,U,2),'$$CKPROV^IBCEU(IBIFN,2) S IBER=IBER_"IB304;"
"RTN","IBCBB21",22,0)
 ;modify 83x check for line level providers and also chacnged the erro check slightly
"RTN","IBCBB21",23,0)
 ;I IBTOB12="83",$P(IBZPRC92,U,2),'$$CKPROV^IBCEU(IBIFN,2) S IBER=IBER_"IB312;"
"RTN","IBCBB21",24,0)
 I IBTOB12="83",'$$UBPRVCK^IBCBB12(IBIFN) S IBER=IBER_"IB312;"  ; DEM;432
"RTN","IBCBB21",25,0)
 ;
"RTN","IBCBB21",26,0)
 ; If any CPT procedures have more than 2 modifiers, warn
"RTN","IBCBB21",27,0)
 S Z=0 F  S Z=$O(IBZPRC92(Z)) Q:'Z  I $P(IBZPRC92(Z),U)["ICPT(",$L($P(IBZPRC92(Z),U,15),",")>2 S Z0="Proc "_$$PRCD^IBCEF1($P(IBZPRC92(Z),U))_" has > 2 modifiers - only first 2 will be used" D WARN^IBCBB11(Z0)
"RTN","IBCBB21",28,0)
 ;
"RTN","IBCBB21",29,0)
 I $$WNRBILL^IBEFUNC(IBIFN),$$MRATYPE^IBEFUNC(IBIFN)'="A" S IBER=IBER_"IB086;"
"RTN","IBCBB21",30,0)
 ;
"RTN","IBCBB21",31,0)
 ; UB-04 Diagnosis Codes
"RTN","IBCBB21",32,0)
 K IBXDATA D F^IBCEF("N-DIAGNOSES",,,IBIFN)
"RTN","IBCBB21",33,0)
 ;
"RTN","IBCBB21",34,0)
 ; Only 24 other dx's + 1 principal dx + 3 ecode dx's are allowed per claim
"RTN","IBCBB21",35,0)
 S (Z,ECODE,IBI)=0 F  S Z=$O(IBXDATA(Z)) Q:'Z  D  Q:IBER["309;"!(ECODE>3)
"RTN","IBCBB21",36,0)
 . S IBI=IBI+1
"RTN","IBCBB21",37,0)
 . I $E($$ICD9^IBACSV(+$P(IBXDATA(Z),U),$$BDATE^IBACSV(IBIFN)))="E" D
"RTN","IBCBB21",38,0)
 .. I ECODE>3 D WARN^IBCBB11("Claim contains more than 3 External Cause of Injury codes.") Q
"RTN","IBCBB21",39,0)
 .. S:ECODE<=3 ECODE=ECODE+1,IBI=IBI-1
"RTN","IBCBB21",40,0)
 .. Q
"RTN","IBCBB21",41,0)
 . ; max DX check does not apply to MRAs
"RTN","IBCBB21",42,0)
 . I IBTXMT,IBI>25 D
"RTN","IBCBB21",43,0)
 .. I 'IBREQMRA Q:$P(IBNDTX,U,8)  S IBER=IBER_"IB309;" Q
"RTN","IBCBB21",44,0)
 .. I '$P(IBNDTX,U,9) S IBER=IBER_"IB326;"
"RTN","IBCBB21",45,0)
 ;
"RTN","IBCBB21",46,0)
 I '$O(IBXDATA(0)) S IBER=IBER_"IB071;"   ;Require Diag code NOIS:OKL-0304-72495
"RTN","IBCBB21",47,0)
 I $O(IBXDATA(0)) D
"RTN","IBCBB21",48,0)
 .S IBDXTYP=$E($$ICD9^IBACSV(+$P(IBXDATA(1),U),$$BDATE^IBACSV(IBIFN)))
"RTN","IBCBB21",49,0)
 .S:IBDXTYP="E" IBER=IBER_"IB117;"
"RTN","IBCBB21",50,0)
 .I $$INPAT^IBCEF(IBIFN),IBDXTYP="V" S Z="Principal Dx V-code may not be valid" D WARN^IBCBB11(Z)
"RTN","IBCBB21",51,0)
 .Q
"RTN","IBCBB21",52,0)
 I '$$OCC10^IBCBB2(IBIFN,.IBXDATA,3) S IBER=IBER_"IB093;"
"RTN","IBCBB21",53,0)
 ; At least one PRV diagnosis is required for outpatient UB-04 claim
"RTN","IBCBB21",54,0)
 I '$$INPAT^IBCEF(IBIFN),$$CHKPRV^IBCSC10B=3 D WARN^IBCBB11("Outpatient Institutional claims should contain a Patient Reason for Visit.")
"RTN","IBCBB21",55,0)
 ;
"RTN","IBCBB21",56,0)
 K ^TMP($J,"IBC-RC")
"RTN","IBCBB21",57,0)
 D F^IBCEF("N-UB-04 SERVICE LINE (PRINT)",,,IBIFN)
"RTN","IBCBB21",58,0)
 S (Z0,IBI)=0 F  S IBI=$O(^TMP($J,"IBC-RC",IBI)) Q:'IBI  S Z=$G(^(IBI))  Q:+$P(Z,U,2)=1  I $P(Z,U,2),$P(Z,U,1)=1 D
"RTN","IBCBB21",59,0)
 . ; IB*2.0*432 - The IB system shall provide the ability for users to enter maximum line item dollar amounts of 9999999.99.
"RTN","IBCBB21",60,0)
 . ;I IBER'["IB090;",$P(Z,U,2)>1,($P(Z,U,7)>99999.99!($P(Z,U,8)>99999.99)) S IBER=IBER_"IB090;"
"RTN","IBCBB21",61,0)
 . I IBER'["IB090;",$P(Z,U,2)>1,($P(Z,U,7)>9999999.99!($P(Z,U,8)>9999999.99)) S IBER=IBER_"IB090;"
"RTN","IBCBB21",62,0)
 . Q:$P(Z,U,2)'<180&($P(Z,U,2)'>189)  ;Pass days (LOA) don't matter
"RTN","IBCBB21",63,0)
 . I '$P(Z,U,7),'$P(Z,U,8),'Z0,$$COBN^IBCEF(IBIFN)'>1  S Z0="Rev Code(s) having a 0-charge will not be transmitted for the bill" D WARN^IBCBB11(Z0) S Z0=1
"RTN","IBCBB21",64,0)
 K ^TMP($J,"IBC-RC")
"RTN","IBCBB21",65,0)
 Q
"RTN","IBCBB21",66,0)
 ;
"RTN","IBCBB3")
0^15^B41965627^B47525889
"RTN","IBCBB3",1,0)
IBCBB3 ;ALB/TMP - CONTINUATION OF EDIT CHECKS ROUTINE (MEDICARE) ;06/23/98
"RTN","IBCBB3",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,155,349,371,377,432**;21-MAR-94;Build 192
"RTN","IBCBB3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB3",4,0)
 ;
"RTN","IBCBB3",5,0)
EDITMRA(IBQUIT,IBER,IBIFN,IBFT) ;
"RTN","IBCBB3",6,0)
 ; Requires execution of GVAR^IBCBB, IBIFN defined
"RTN","IBCBB3",7,0)
 ; File IB ERROR (350.8) contains error codes/text
"RTN","IBCBB3",8,0)
 ;
"RTN","IBCBB3",9,0)
 N IBMRATYP,Z,IBZP,IBZP1,IBOK
"RTN","IBCBB3",10,0)
 S IBQUIT=0 ;Flag to say we have too many errors - quit edits
"RTN","IBCBB3",11,0)
 ;
"RTN","IBCBB3",12,0)
 S IBMRATYP=$$MRATYPE^IBEFUNC(IBIFN,"C")
"RTN","IBCBB3",13,0)
 ;
"RTN","IBCBB3",14,0)
 I IBFT=3 D
"RTN","IBCBB3",15,0)
 . D PARTA
"RTN","IBCBB3",16,0)
 ;
"RTN","IBCBB3",17,0)
 I IBFT=2 D PARTB^IBCBB9
"RTN","IBCBB3",18,0)
 ;
"RTN","IBCBB3",19,0)
 K IBXDATA D F^IBCEF("N-ADMITTING DIAGNOSIS",,,IBIFN)
"RTN","IBCBB3",20,0)
 ; Req. for UB-04 type of bills 11x!18x
"RTN","IBCBB3",21,0)
 I $G(IBXDATA)="",IBFT=3 D  Q:IBQUIT
"RTN","IBCBB3",22,0)
 . N Z
"RTN","IBCBB3",23,0)
 . I "^11^18^"[(U_IBTOB12_U) S IBQUIT=$$IBER(.IBER,231) Q
"RTN","IBCBB3",24,0)
 . I $$INPAT^IBCEF(IBIFN,1) S Z="Admitting Diagnosis may be required by payer, please verify" D WARN^IBCBB11(Z)
"RTN","IBCBB3",25,0)
 ;
"RTN","IBCBB3",26,0)
 D GETPRV^IBCEU(IBIFN,"2,3,4",.Z)
"RTN","IBCBB3",27,0)
 S IBOK=1,Z=0,IBZP=U F  S Z=$O(Z(Z)) Q:'Z  S:$S($P($G(Z(Z,1)),U,3)["VA(200":1,1:0) IBZP=IBZP_+$P(Z(Z,1),U,3)_U
"RTN","IBCBB3",28,0)
 D ALLPROC^IBCVA1(IBIFN,.IBZP1)
"RTN","IBCBB3",29,0)
 ;patch 432, enh5:  The IB system shall no longer provide users with a warning message when authorizing a claim when line level and claim level providers are not the same.
"RTN","IBCBB3",30,0)
 ;S Z=0 F  S Z=$O(IBZP1(Z)) Q:'Z  I $P(IBZP1(Z),U,18),IBZP'[(U_$P(IBZP1(Z),U,18)_U) S IBOK=0 Q
"RTN","IBCBB3",31,0)
 ;I 'IBOK D WARN^IBCBB11("At least one provider on a procedure does not match your "_$S(IBFT=2:"render",1:"attend")_"ing or operating provider")
"RTN","IBCBB3",32,0)
 I IBFT=2 D EN^IBCBB2
"RTN","IBCBB3",33,0)
 ; edit checks for UB-04 (institutional) forms
"RTN","IBCBB3",34,0)
 I IBFT=3 D EN^IBCBB21(.IBZPRC92)
"RTN","IBCBB3",35,0)
 ;
"RTN","IBCBB3",36,0)
 Q
"RTN","IBCBB3",37,0)
 ;
"RTN","IBCBB3",38,0)
PARTA ; MEDICARE specific edit checks for PART A claims (UB-04 formats)
"RTN","IBCBB3",39,0)
 ;
"RTN","IBCBB3",40,0)
 N IBI,IBJ,IBX,IBCTYP,VADM,VAPA,IBSTOP,IBDXC,IBDXARY,IBPR,IBLABS,REQMRA
"RTN","IBCBB3",41,0)
 N IBS,IBTUNIT,IBCAGE,IBREV1,IBOCCS,IBOCSDT,IBVALCD,IBOCCD,IBNOPR
"RTN","IBCBB3",42,0)
 N IBCCARY1,IBPATST,IBZADMIT,IBZDISCH,IBXIEN,IBXERR,IBXDATA,IBOCSP
"RTN","IBCBB3",43,0)
 N IBCOV,IBNCOV,IBREVC,IBREVDUP,IBBCPT,IBREVC12,IBREVTOT,IBECAT,IBINC
"RTN","IBCBB3",44,0)
 ;
"RTN","IBCBB3",45,0)
 ; Medicare is the current payer, but no diagnosis codes
"RTN","IBCBB3",46,0)
 I $$WNRBILL^IBEFUNC(IBIFN) D SET^IBCSC4D(IBIFN,.IBDX,.IBDXO) I '$P(IBDX,U,2) S IBQUIT=$$IBER(.IBER,120) Q:IBQUIT
"RTN","IBCBB3",47,0)
 ;
"RTN","IBCBB3",48,0)
 ; Type of Bill must be three digits
"RTN","IBCBB3",49,0)
 I IBTOB'?3N S X=$$IBER(.IBER,103) Q
"RTN","IBCBB3",50,0)
 ;
"RTN","IBCBB3",51,0)
 ; Covered Days
"RTN","IBCBB3",52,0)
 S IBCTYP=0
"RTN","IBCBB3",53,0)
 S IBCOV=$P(IBNDU2,U,2),IBNCOV=$P(IBNDU2,U,3)
"RTN","IBCBB3",54,0)
 ;
"RTN","IBCBB3",55,0)
 ; If interim bill, covered days must not be greater than 60
"RTN","IBCBB3",56,0)
 ; remove for IB*2.0*432
"RTN","IBCBB3",57,0)
 ; I "23"[$E(IBTOB,3),IBCOV>60 S IBQUIT=$$IBER(.IBER,"096") Q:IBQUIT
"RTN","IBCBB3",58,0)
 ;
"RTN","IBCBB3",59,0)
 ; I bill type is 11x or 18x or 21x then we need covered days
"RTN","IBCBB3",60,0)
 ; remove for IB*2.0*432
"RTN","IBCBB3",61,0)
 ; I "^11^18^21^"[(U_IBTOB12_U) S IBCTYP=1 I IBCOV="" S IBQUIT=$$IBER(.IBER,106) Q:IBQUIT
"RTN","IBCBB3",62,0)
 ;
"RTN","IBCBB3",63,0)
 S (IBI,IBJ)=0
"RTN","IBCBB3",64,0)
 K IBXDATA D F^IBCEF("N-CONDITION CODES",,,IBIFN)
"RTN","IBCBB3",65,0)
 ; Re-sort the condition codes by code
"RTN","IBCBB3",66,0)
 S IBI=0 F  S IBI=$O(IBXDATA(IBI)) Q:'IBI  S IBCCARY1($P(IBXDATA(IBI),U))=""
"RTN","IBCBB3",67,0)
 ;
"RTN","IBCBB3",68,0)
 ; for condition code 40, covered days must be 0
"RTN","IBCBB3",69,0)
 ; remove for IB*2.0*432
"RTN","IBCBB3",70,0)
 ; I $D(IBCCARY1(40)),IBCOV'=0 S IBQUIT=$$IBER(.IBER,107) Q:IBQUIT
"RTN","IBCBB3",71,0)
 ;
"RTN","IBCBB3",72,0)
 ; cov days+non=to date -from date unless the patient status = 30 (still
"RTN","IBCBB3",73,0)
 ;  pt) or outpatient or if the to date and from date are same then add 1
"RTN","IBCBB3",74,0)
 S IBPATST="",IBX=$P(IBNDU,U,12),IBPATST=$P($G(^DGCR(399.1,+IBX,0)),U,2)
"RTN","IBCBB3",75,0)
 S IBINC=$S(IBPATST=30!(IBFDT=IBTDT):1,1:0)
"RTN","IBCBB3",76,0)
 ; remove for IB*2.0*432
"RTN","IBCBB3",77,0)
 ;I $$INPAT^IBCEF(IBIFN,1),(IBCOV+IBNCOV)'=($$FMDIFF^XLFDT(IBTDT,IBFDT)+IBINC) S IBQUIT=$$IBER(.IBER,108) Q:IBQUIT
"RTN","IBCBB3",78,0)
 ;
"RTN","IBCBB3",79,0)
 ; if covered days >100 and type of bill is 21x or 18x error
"RTN","IBCBB3",80,0)
 ; remove for IB*2.0*432
"RTN","IBCBB3",81,0)
 ; I IBCOV>100,(IBTOB12=18!(IBTOB12=21)) S IBQUIT=$$IBER(.IBER,109) Q:IBQUIT
"RTN","IBCBB3",82,0)
 ;
"RTN","IBCBB3",83,0)
 S (IBJ,IBTUNIT,IBS,IBREVTOT("AC"),IBREVTOT("AI"),IBREVTOT("AO"),IBREVTOT)=0
"RTN","IBCBB3",84,0)
 ;
"RTN","IBCBB3",85,0)
 K IBXDATA D F^IBCEF("N-UB-04 SERVICE LINE (EDI)",,,IBIFN) ;Get rev codes
"RTN","IBCBB3",86,0)
 ;
"RTN","IBCBB3",87,0)
 ; Re-sort the revenue codes by code
"RTN","IBCBB3",88,0)
 ;>> IBREV1(rev code,x)=Rev code^ptr cpt^unit chg^units^total^tot unc
"RTN","IBCBB3",89,0)
 ;   IBREV1(rev code) = revenue code edit category
"RTN","IBCBB3",90,0)
 ;
"RTN","IBCBB3",91,0)
 ; IBNOPR = flag that determines if there are revenue codes with
"RTN","IBCBB3",92,0)
 ;          charges that do not have a procedure - no need to check
"RTN","IBCBB3",93,0)
 ;          for billable MCR procedures if at least one RC is billable
"RTN","IBCBB3",94,0)
 ;          1 = there is at least one billable revenue code without a
"RTN","IBCBB3",95,0)
 ;              procedure
"RTN","IBCBB3",96,0)
 ;
"RTN","IBCBB3",97,0)
 S REQMRA=$$REQMRA^IBEFUNC(IBIFN)
"RTN","IBCBB3",98,0)
 S (IBNOPR,IBI)=0
"RTN","IBCBB3",99,0)
 F  S IBI=$O(IBXDATA(IBI)) Q:'IBI  D
"RTN","IBCBB3",100,0)
 . I REQMRA D GYMODCHK(IBXDATA(IBI))      ; IB*2*377 GY modifier check
"RTN","IBCBB3",101,0)
 . S IBJ=$P(IBXDATA(IBI),U),IBECAT=""
"RTN","IBCBB3",102,0)
 . I 'IBNOPR D
"RTN","IBCBB3",103,0)
 .. I $P(IBXDATA(IBI),U,2)'="" S IBPR($P(IBXDATA(IBI),U,2))=IBI Q
"RTN","IBCBB3",104,0)
 .. S IBNOPR=1 K IBPR
"RTN","IBCBB3",105,0)
 . S:$D(IBREV1(IBJ)) IBECAT=$G(IBREV1(IBJ))
"RTN","IBCBB3",106,0)
 . I '$D(IBREV1(IBJ))!(IBECAT="") D  S IBREV1(IBJ)=IBECAT
"RTN","IBCBB3",107,0)
 . . ;
"RTN","IBCBB3",108,0)
 . . ; Accomodations (AC)
"RTN","IBCBB3",109,0)
 . . I (IBJ'<100&(IBJ'>219))!(IBJ=224) S IBECAT="AC" Q
"RTN","IBCBB3",110,0)
 . . ;
"RTN","IBCBB3",111,0)
 . . ; Ancillary Outpatient (AO)
"RTN","IBCBB3",112,0)
 . . I '$$INPAT^IBCEF(IBIFN,1) S IBECAT="AO" Q
"RTN","IBCBB3",113,0)
 . . ;
"RTN","IBCBB3",114,0)
 . . ; Ancillary Inpatient (AI)
"RTN","IBCBB3",115,0)
 . . S IBECAT="AI"
"RTN","IBCBB3",116,0)
 . ;
"RTN","IBCBB3",117,0)
 . S IBREV1(IBJ,+$O(IBREV1(IBJ,""),-1)+1)=IBXDATA(IBI)
"RTN","IBCBB3",118,0)
 . S IBREVTOT(IBECAT)=IBREVTOT(IBECAT)+$P(IBXDATA(IBI),U,6)
"RTN","IBCBB3",119,0)
 . I IBECAT="AC" S IBTUNIT=IBTUNIT+$P(IBXDATA(IBI),U,4)
"RTN","IBCBB3",120,0)
 ;
"RTN","IBCBB3",121,0)
 I $$NEEDMRA^IBEFUNC(IBIFN),$O(IBPR(""))'="" D  Q:IBQUIT
"RTN","IBCBB3",122,0)
 . ; Don't allow a bill containing only billable procedures for:
"RTN","IBCBB3",123,0)
 . ;    Oxygen, labs, or influenza shots
"RTN","IBCBB3",124,0)
 . ;  OR a bill with prosthetics on it
"RTN","IBCBB3",125,0)
 . ;    to be sent to MEDICARE for an MRA
"RTN","IBCBB3",126,0)
 . D NONMCR(.IBPR,.IBLABS) ; Remove Oxygen, labs, influenza shots
"RTN","IBCBB3",127,0)
 . I $G(IBLABS) D WARN^IBCBB11("There are Lab procedures on this claim."),WARN^IBCBB11("Please verify that MEDICARE does not reimburse these labs at 100%") Q
"RTN","IBCBB3",128,0)
 . I $O(IBPR(""))="" D
"RTN","IBCBB3",129,0)
 .. S IBQUIT=$$IBER(.IBER,"098")
"RTN","IBCBB3",130,0)
 ;
"RTN","IBCBB3",131,0)
 ; covered days+non covered = units of accom rev codes
"RTN","IBCBB3",132,0)
 ; Check room and board
"RTN","IBCBB3",133,0)
 ; remove for IB*2.0*432
"RTN","IBCBB3",134,0)
 ;I IBTUNIT,IBTUNIT'=(IBCOV+IBNCOV) S IBQUIT=$$IBER(.IBER,114) Q:IBQUIT
"RTN","IBCBB3",135,0)
 ;
"RTN","IBCBB3",136,0)
 ; Non Covered Days
"RTN","IBCBB3",137,0)
 ;   required when the type of bill is 11x,18x,21x or covered days=0
"RTN","IBCBB3",138,0)
 ; remove for IB*2.0*432
"RTN","IBCBB3",139,0)
 ; I IBNCOV="",(IBCTYP!(IBCOV=0)) S IBQUIT=$$IBER(.IBER,115) Q:IBQUIT
"RTN","IBCBB3",140,0)
 ;
"RTN","IBCBB3",141,0)
 ; if cc code=40 then non-covered days must be 1
"RTN","IBCBB3",142,0)
 ; remove for IB*2.0*432
"RTN","IBCBB3",143,0)
 ; I $D(IBCCARY1(40)),IBNCOV'=1 S IBQUIT=$$IBER(.IBER,116) Q:IBQUIT
"RTN","IBCBB3",144,0)
 ;
"RTN","IBCBB3",145,0)
 ; Patient Sex
"RTN","IBCBB3",146,0)
 ; must be "M" or "F"
"RTN","IBCBB3",147,0)
 D DEM^VADPT
"RTN","IBCBB3",148,0)
 I $P(VADM(5),U)'="M",$P(VADM(5),U)'="F" S IBQUIT=$$IBER(.IBER,124) Q:IBQUIT
"RTN","IBCBB3",149,0)
 ;
"RTN","IBCBB3",150,0)
 ; esg - 10/17/07 - patch 371
"RTN","IBCBB3",151,0)
 ; For Part A replacement MRA request claims, make sure
"RTN","IBCBB3",152,0)
 ; the Medicare ICN/DCN number is present and also text in FL-80.
"RTN","IBCBB3",153,0)
 I $$REQMRA^IBEFUNC(IBIFN),$F(".137.138.117.118.","."_IBTOB_".") D  Q:IBQUIT
"RTN","IBCBB3",154,0)
 . N IBZ,FL80TXT
"RTN","IBCBB3",155,0)
 . D F^IBCEF("N-CURR INS FORM LOC 64","IBZ",,IBIFN)  ; see CI3-11
"RTN","IBCBB3",156,0)
 . I IBZ="" S IBQUIT=$$IBER(.IBER,205) Q:IBQUIT      ; missing ICN/DCN
"RTN","IBCBB3",157,0)
 . S FL80TXT=$P($G(^DGCR(399,IBIFN,"UF2")),U,3)
"RTN","IBCBB3",158,0)
 . I FL80TXT="" S IBQUIT=$$IBER(.IBER,206) Q:IBQUIT  ; missing FL80 text
"RTN","IBCBB3",159,0)
 . Q
"RTN","IBCBB3",160,0)
 ;
"RTN","IBCBB3",161,0)
 D ^IBCBB4
"RTN","IBCBB3",162,0)
 Q
"RTN","IBCBB3",163,0)
 ;
"RTN","IBCBB3",164,0)
IBER(IBER,ERRNO) ; Sets error list
"RTN","IBCBB3",165,0)
 ; NOTE: add code to check error list > 20 ... If so, display message and
"RTN","IBCBB3",166,0)
 ;   quit so we don't get too many errors at once to handle
"RTN","IBCBB3",167,0)
 ;   Print all if printing list
"RTN","IBCBB3",168,0)
 ;
"RTN","IBCBB3",169,0)
 I '$G(IBQUIT) D
"RTN","IBCBB3",170,0)
 . I ERRNO?1N.N S:$L(ERRNO)<3 ERRNO=$E("00",1,3-$L(ERRNO))_ERRNO
"RTN","IBCBB3",171,0)
 . I $L(IBER,";")>19,'$G(IBPRT("PRT")) S IBER=IBER_"IB999;",IBQUIT=1
"RTN","IBCBB3",172,0)
 . I $G(IBER)'[("IB"_ERRNO_";") S IBER=IBER_"IB"_ERRNO_";"
"RTN","IBCBB3",173,0)
 Q IBQUIT
"RTN","IBCBB3",174,0)
 ;
"RTN","IBCBB3",175,0)
NONMCR(IBPR,IBLABS) ;  Delete all oxygen and lab, flu shot CPT entries from IBPR
"RTN","IBCBB3",176,0)
 ; IBPR = array subscripted by CPT codes from bill
"RTN","IBCBB3",177,0)
 ; IBLABS = flag returned =1 if labs found on bill
"RTN","IBCBB3",178,0)
 N Z S IBLABS=0
"RTN","IBCBB3",179,0)
 ; Oxygen
"RTN","IBCBB3",180,0)
 F Z="A0422","A4575","A4616","A4619","A4620","A4621","E0455","E1353","E1355" K IBPR(Z)
"RTN","IBCBB3",181,0)
 F Z=77:1:85 S Z0="E13"_Z K IBPR(Z0)
"RTN","IBCBB3",182,0)
 ; Labs
"RTN","IBCBB3",183,0)
 S Z="80000" F  S Z=$O(IBPR(Z)) Q:Z'?1"8"4N  S IBLABS=1
"RTN","IBCBB3",184,0)
 ; Flu shots
"RTN","IBCBB3",185,0)
 F Z="90724","G0008","90732","G0009","90657","90658","90659","90660" K IBPR(Z)
"RTN","IBCBB3",186,0)
 Q
"RTN","IBCBB3",187,0)
 ;
"RTN","IBCBB3",188,0)
MCRANUM(IBIFN) ; Determine MEDICARE A provider ID # from bedsection for
"RTN","IBCBB3",189,0)
 ; bill ien IBIFN
"RTN","IBCBB3",190,0)
 N IBX
"RTN","IBCBB3",191,0)
 ; PART A MRA (only) needed - determine if psych/non-psych claim
"RTN","IBCBB3",192,0)
 N IBX,IBI
"RTN","IBCBB3",193,0)
 S IBI=$P($G(^DGCR(399,IBIFN,"U")),U,11)
"RTN","IBCBB3",194,0)
 S IBX=$S($TR($P($G(^DGCR(399.1,+IBI,0)),U),"psych","PSYCH")'["PSYCH":670899,1:674499)
"RTN","IBCBB3",195,0)
 Q IBX
"RTN","IBCBB3",196,0)
 ;
"RTN","IBCBB3",197,0)
MCRACK(IBIFN,X,IBFLD) ; Check for MEDICARE A for bill IBIFN
"RTN","IBCBB3",198,0)
 ; Called from CLAIM STATUS MRA field (#24) xrefs in file 399
"RTN","IBCBB3",199,0)
 ; X = current value of field 399;24
"RTN","IBCBB3",200,0)
 ; IBFLD = 1 for primary ins co, 2 for secondary, 3 for tertiary
"RTN","IBCBB3",201,0)
 N IB
"RTN","IBCBB3",202,0)
 S IB=0
"RTN","IBCBB3",203,0)
 I +X,$$COBN^IBCEF(IBIFN)=IBFLD,$$WNRBILL^IBEFUNC(IBIFN,IBFLD),$$MRATYPE^IBEFUNC(IBIFN,"C")="A" S IB=1
"RTN","IBCBB3",204,0)
 Q IB
"RTN","IBCBB3",205,0)
 ;
"RTN","IBCBB3",206,0)
GYMODCHK(Z) ; GY modifier check procedure.  IB*2*377 - 2/4/08
"RTN","IBCBB3",207,0)
 ; Z is the IBXDATA(IBI) service line EDI
"RTN","IBCBB3",208,0)
 N MODS
"RTN","IBCBB3",209,0)
 I IBER["IB123" Q     ; error already found
"RTN","IBCBB3",210,0)
 S MODS=$P(Z,U,9)     ; list of modifiers separated by commas
"RTN","IBCBB3",211,0)
 I MODS'["GY" Q       ; GY modifier not here on this line item
"RTN","IBCBB3",212,0)
 I $P(Z,U,6) Q        ; non-covered charges exist on this line item
"RTN","IBCBB3",213,0)
 S IBQUIT=$$IBER(.IBER,123)
"RTN","IBCBB3",214,0)
GYMODX ;
"RTN","IBCBB3",215,0)
 Q
"RTN","IBCBB3",216,0)
 ;
"RTN","IBCBB9")
0^88^B8708481^B9034446
"RTN","IBCBB9",1,0)
IBCBB9 ;ALB/BGA MEDICARE PART B EDIT CHECKS ;10/15/98
"RTN","IBCBB9",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,155,349,371,432**;21-MAR-94;Build 192
"RTN","IBCBB9",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB9",4,0)
 ;
"RTN","IBCBB9",5,0)
PARTB ; MEDICARE specific edit checks for PART B claims (CMS-1500)
"RTN","IBCBB9",6,0)
 ;
"RTN","IBCBB9",7,0)
 N IBXDATA,IBXERR,IBXIEN,IBXSAVE,IBPR,IBDTFLG
"RTN","IBCBB9",8,0)
 ;
"RTN","IBCBB9",9,0)
 I $$NEEDMRA^IBEFUNC(IBIFN) D
"RTN","IBCBB9",10,0)
 . K IBXDATA
"RTN","IBCBB9",11,0)
 . D F^IBCEF("N-HCFA 1500 SERVICE LINE (EDI)",,,IBIFN)
"RTN","IBCBB9",12,0)
 . S IBI=0
"RTN","IBCBB9",13,0)
 . F  S IBI=$O(IBXDATA(IBI)) Q:'IBI  D
"RTN","IBCBB9",14,0)
 .. S IBJ=$P(IBXDATA(IBI),U,5)
"RTN","IBCBB9",15,0)
 .. I IBJ'="","^CJ^HC^"[(U_$P(IBXDATA(IBI),U,6)_U) S IBPR(IBJ)=""
"RTN","IBCBB9",16,0)
 . I $$REQMRA^IBEFUNC(IBIFN),$O(IBXDATA(""),-1)>12 D WARN^IBCBB11("This claim will be split into multiple EOB'S since there are more than 12"),WARN^IBCBB11("service lines being submitted on the claim.")
"RTN","IBCBB9",17,0)
 . I $$REQMRA^IBEFUNC(IBIFN),$E(IBFDT,1,3)'=$E(IBTDT,1,3) D WARN^IBCBB11("This claim will be split into multiple EOB'S due to the service dates"),WARN^IBCBB11("spanning different calendar years.")
"RTN","IBCBB9",18,0)
 . D NONMCR^IBCBB3(.IBPR,.IBLABS) ; Oxygen, labs, influenza shots
"RTN","IBCBB9",19,0)
 . S Z="80000" F  S Z=$O(IBPR(Z)) Q:Z'?1"8"4N  S IBLABS=1
"RTN","IBCBB9",20,0)
 . I $G(IBLABS) D WARN^IBCBB11("There are Lab procedures on this claim."),WARN^IBCBB11("Please verify that Medicare does not reimburse these labs at 100%.") Q
"RTN","IBCBB9",21,0)
 . I $O(IBPR(""))="" S IBQUIT=$$IBER^IBCBB3(.IBER,"098")
"RTN","IBCBB9",22,0)
 ;
"RTN","IBCBB9",23,0)
 ; First char of the pat's first and last name must be present and
"RTN","IBCBB9",24,0)
 ; must be an alpha
"RTN","IBCBB9",25,0)
 K IBXDATA D F^IBCEF("N-PATIENT NAME",,,IBIFN)
"RTN","IBCBB9",26,0)
 S IBXDATA=$$NAME^IBCEFG1(IBXDATA)
"RTN","IBCBB9",27,0)
 I $S($G(IBXDATA)="":1,$E($P(IBXDATA,U))=" "!($E($P(IBXDATA,U))'?1A):1,$E($P(IBXDATA,U,2))=" "!($E($P(IBXDATA,U,2))'?1A):1,1:0) S IBQUIT=$$IBER^IBCBB3(.IBER,300) Q:IBQUIT
"RTN","IBCBB9",28,0)
 ;
"RTN","IBCBB9",29,0)
 ; Must be a valid HIC #
"RTN","IBCBB9",30,0)
 I '$$VALID^IBCBB8(IBIFN) S IBQUIT=$$IBER^IBCBB3(.IBER,215) Q:IBQUIT
"RTN","IBCBB9",31,0)
 ;
"RTN","IBCBB9",32,0)
 ; Specialty code 99 is not valid for Medicare MRA request claims
"RTN","IBCBB9",33,0)
 ;I $$REQMRA^IBEFUNC(IBIFN),$$BILLSPEC^IBCEU3(IBIFN)=99 S IBQUIT=$$IBER^IBCBB3(.IBER,122) Q:IBQUIT
"RTN","IBCBB9",34,0)
 ; IB*2.0*432 add line-level check
"RTN","IBCBB9",35,0)
 I $$REQMRA^IBEFUNC(IBIFN),$$LINSPEC^IBCEU3(IBIFN)[99 S IBQUIT=$$IBER^IBCBB3(.IBER,122) Q:IBQUIT
"RTN","IBCBB9",36,0)
 ;
"RTN","IBCBB9",37,0)
 Q
"RTN","IBCBB9",38,0)
 ;
"RTN","IBCC")
0^62^B58814397^B55278048
"RTN","IBCC",1,0)
IBCC ;ALB/MJB - CANCEL THIRD PARTY BILL ;14 JUN 88  10:12
"RTN","IBCC",2,0)
 ;;2.0;INTEGRATED BILLING;**2,19,77,80,51,142,137,161,199,241,155,276,320,358,433,432**;21-MAR-94;Build 192
"RTN","IBCC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCC",4,0)
 ;
"RTN","IBCC",5,0)
 ;MAP TO DGCRC
"RTN","IBCC",6,0)
 ;
"RTN","IBCC",7,0)
 I '$D(IBCAN) S IBCAN=1
"RTN","IBCC",8,0)
ASK ;
"RTN","IBCC",9,0)
 ;***
"RTN","IBCC",10,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCC" D T1^%ZOSV ;stop rt clock
"RTN","IBCC",11,0)
 ;S XRTL=$ZU(0),XRTN="IBCC-1" D T0^%ZOSV ;start rt clock
"RTN","IBCC",12,0)
 ;
"RTN","IBCC",13,0)
 ; If called at entry point PROCESS, variable IBNOASK will exist.
"RTN","IBCC",14,0)
 ; First time through, IBNOASK=1
"RTN","IBCC",15,0)
 ; Second time through, IBNOASK=2 and it will quit
"RTN","IBCC",16,0)
 I $G(IBNOASK)=2 G Q
"RTN","IBCC",17,0)
 I $G(IBNOASK)=1 S IBNOASK=2
"RTN","IBCC",18,0)
 ;
"RTN","IBCC",19,0)
 G Q:$G(IBCE("EDI"))
"RTN","IBCC",20,0)
 D Q
"RTN","IBCC",21,0)
 S IBQUIT=0
"RTN","IBCC",22,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCC",23,0)
 I '$G(IBNOASK) S DIC="^DGCR(399,",DIC(0)="AEMQZ",DIC("A")="Enter BILL NUMBER or Patient NAME: " W !! D ^DIC I Y<1 S IBQUIT=1 G Q1
"RTN","IBCC",24,0)
 K IB364
"RTN","IBCC",25,0)
NOPTF ; Note if IB364 is >0 it will be used as the ien to update in file 364
"RTN","IBCC",26,0)
 N DA,I
"RTN","IBCC",27,0)
 I '$G(IBNOASK) S IBIFN=+$G(Y)
"RTN","IBCC",28,0)
 I '$G(IBIFN) G ASK
"RTN","IBCC",29,0)
 I IBCAN>1 D NOPTF^IBCB2 I 'IBAC1 D NOPTF1^IBCB2 G ASK
"RTN","IBCC",30,0)
 ;
"RTN","IBCC",31,0)
 I $G(IBCNCRD)=1,$P($P($G(^DGCR(399,IBIFN,0)),U),"-",2)>98 D  Q
"RTN","IBCC",32,0)
 .W !!,"Please note that you have exceeded the maximum number of iterations (99) for this claim."
"RTN","IBCC",33,0)
 .W "Copy and cancel (CLON) must be used to correct this bill."
"RTN","IBCC",34,0)
 .S IBQUIT=1 H 3
"RTN","IBCC",35,0)
 ; Check if bill has been referred to Counsel
"RTN","IBCC",36,0)
 I $P($G(^PRCA(430,IBIFN,6)),U,4) D  G ASK
"RTN","IBCC",37,0)
 . W !,"This bill has been referred to Regional Counsel and cannot be 'CANCELLED' in"
"RTN","IBCC",38,0)
 . W !,"Integrated Billing.  Please use the option 'TP Referred Follow-up'"
"RTN","IBCC",39,0)
 . W !,"[PRCA RC ACTION MENU] in Accounts Receivable to request that Regional"
"RTN","IBCC",40,0)
 . W !,"Counsel return the bill to your facility."
"RTN","IBCC",41,0)
 . Q
"RTN","IBCC",42,0)
 ;
"RTN","IBCC",43,0)
 F I=0,"S","U1" S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBCC",44,0)
 S IBSTAT=$P(IB(0),U,13)
"RTN","IBCC",45,0)
 ; New messages for CRD option IB*2.0*433  IA#5630
"RTN","IBCC",46,0)
 I $G(IBCNCRD)=1,IBSTAT'=2,'$$ACCK^PRCAACC(IBIFN) D  Q
"RTN","IBCC",47,0)
 .W !!,"This option cannot be used to correct some Billing Rate Types (Example: TRICARE)"
"RTN","IBCC",48,0)
 .W "Copy and cancel (CLON) must be used to correct this bill."
"RTN","IBCC",49,0)
 .S IBQUIT=1 H 3
"RTN","IBCC",50,0)
 ;
"RTN","IBCC",51,0)
 ; Restrict access to this process for REQUEST MRA bills
"RTN","IBCC",52,0)
 I IBSTAT=2,'$G(IBCE("EDI")),$$MRAWL^IBCEMU2(IBIFN) D  G ASK
"RTN","IBCC",53,0)
 . W !!?4,"This bill is in a status of REQUEST MRA and it does appear on the"
"RTN","IBCC",54,0)
 . W !?4,"MRA Management Work List.  Please use the 'MRA Management Menu' options"
"RTN","IBCC",55,0)
 . W !?4,"for all processing related to this bill."
"RTN","IBCC",56,0)
 . Q
"RTN","IBCC",57,0)
 ;
"RTN","IBCC",58,0)
 ; IB*2.0*432 Restrict access to claims on the new CBW Worklist
"RTN","IBCC",59,0)
 I $P($G(^DGCR(399,IBIFN,"S1")),U,7)=1,$G(IBMRANOT)'=1 D  G ASK
"RTN","IBCC",60,0)
 . W !!?4,"This bill appears on the CBW Management Work List.  Please use the"
"RTN","IBCC",61,0)
 . W !?4,"'CBW Management Menu' options for all processing related to this bill."
"RTN","IBCC",62,0)
 . Q
"RTN","IBCC",63,0)
 ;
"RTN","IBCC",64,0)
 ; Check if this is a paper claim. If not, check for split EOB.  If split, don't allow CRD unless more than 1 EOB has been returned
"RTN","IBCC",65,0)
 I $G(IBCNCRD)=1,$P($G(^DGCR(399,IBIFN,"TX")),U,8)'=1,$$SPLTMRA^IBCEMU1(IBIFN)=1 D  Q
"RTN","IBCC",66,0)
 .W !!,"There is a split EOB associated with this claim.  You cannot use this option to Correct this claim until the second EOB has been received."
"RTN","IBCC",67,0)
 .S IBQUIT=1 H 3
"RTN","IBCC",68,0)
 .Q
"RTN","IBCC",69,0)
 ;
"RTN","IBCC",70,0)
 ; Warning message if in a REQUEST MRA status with no MRA on file
"RTN","IBCC",71,0)
 I IBSTAT=2,'$$MRACNT^IBCEMU1(IBIFN) D
"RTN","IBCC",72,0)
 . N REJ
"RTN","IBCC",73,0)
 . D TXSTS^IBCEMU2(IBIFN,,.REJ)
"RTN","IBCC",74,0)
 . W *7,!!?4,"Warning!  This bill is in a status of REQUEST MRA."
"RTN","IBCC",75,0)
 . W !?4,"No MRAs have been received"
"RTN","IBCC",76,0)
 . I REJ W ", but the most recent transmission of this",!?4,"MRA request bill was rejected."
"RTN","IBCC",77,0)
 . I 'REJ W " and there are no rejection messages on file",!?4,"for the most recent transmission of this MRA request bill."
"RTN","IBCC",78,0)
 . Q
"RTN","IBCC",79,0)
 ;
"RTN","IBCC",80,0)
 I IBCAN=2,IB("S")]"",+$P(IB("S"),U,16),$P(IB("S"),U,17)]"" D  G 1
"RTN","IBCC",81,0)
 . W !!,"This bill was cancelled on " S Y=$P(IB("S"),U,17) X ^DD("DD") W Y," by ",$S($P(IB("S"),U,18)']"":IBU,$D(^VA(200,$P(IB("S"),U,18),0)):$P(^(0),U,1),1:IBU),"."
"RTN","IBCC",82,0)
 . S IBQUIT=1
"RTN","IBCC",83,0)
 ; Notify if a payment has been posted to this bill before cancel
"RTN","IBCC",84,0)
 N PRCABILL
"RTN","IBCC",85,0)
 S PRCABILL=$$TPR^PRCAFN(IBIFN)
"RTN","IBCC",86,0)
 I PRCABILL=-1 W !!,"Please note: PRCA was unable to determine if a payment has been posted." I $G(IBCNCRD)=1 W !,"Copy and cancel (CLON) must be used to correct this bill." S IBQUIT=1 H 3 Q
"RTN","IBCC",87,0)
 I PRCABILL>0 W !!,"Please note a PAYMENT of **$"_$$TPR^PRCAFN(IBIFN)_"** has been POSTED to this bill."
"RTN","IBCC",88,0)
 ; New message for CRD option
"RTN","IBCC",89,0)
 I $G(IBCNCRD)=1,PRCABILL>0 W !,"Copy and cancel (CLON) must be used to correct this bill." S IBQUIT=1 H 3 Q
"RTN","IBCC",90,0)
 ;
"RTN","IBCC",91,0)
 ; If bill was created via Electronic claims process then notify
"RTN","IBCC",92,0)
 ; user that cancellation should occur using ECME package
"RTN","IBCC",93,0)
 I $$GET1^DIQ(399,IBIFN_",",460)]"" D  G:'Y ASK
"RTN","IBCC",94,0)
 . W !!!?5,"This bill was created by the"
"RTN","IBCC",95,0)
 . W !?5,"Electronic Claims Management Engine (ECME)."
"RTN","IBCC",96,0)
 . W !?5,"Cancellation needs to occur in the ECME package by"
"RTN","IBCC",97,0)
 . W !?5,"submitting a REVERSAL to the Payer.",!!
"RTN","IBCC",98,0)
 . K DIR S DIR("A",1)="Has a REVERSAL for this e-Claim already been",DIR("A")="submitted to the payer via the ECME package (Y/N)",DIR(0)="Y",DIR("B")="NO" D ^DIR
"RTN","IBCC",99,0)
 . I Y=0 W !!,"<PLEASE SUBMIT A REVERSAL USING THE APPROPRIATE OPTION IN THE ECME PACKAGE>",$C(7)
"RTN","IBCC",100,0)
 ;
"RTN","IBCC",101,0)
CHK ;
"RTN","IBCC",102,0)
 ; if user came from CLON, make sure they know about the new CRD option
"RTN","IBCC",103,0)
 I $G(IBCNCOPY)=1 D
"RTN","IBCC",104,0)
 .W !!,*7,"Warning: This option should NOT be used to correct Rejected/Denied claims. It"
"RTN","IBCC",105,0)
 .W !,"should ONLY be used to correct DENIED claims which have payments posted against"
"RTN","IBCC",106,0)
 .W !,"them and claims with certain Billing Rate Types (Example: TRICARE)."
"RTN","IBCC",107,0)
 ;
"RTN","IBCC",108,0)
 S (IBCCCC,IBQUIT)=0 I '$G(IBCEAUTO),'$G(IBMCSCAN) W !!,"ARE YOU SURE YOU WANT TO CANCEL THIS BILL" S %=2 D YN^DICN G:%=0 HELP I %'=1 S IBQUIT=1 G NO
"RTN","IBCC",109,0)
 ;
"RTN","IBCC",110,0)
 I '$G(IBCEAUTO) W !!,"LAST CHANCE TO CHANGE YOUR MIND..."
"RTN","IBCC",111,0)
 S DIE=399,DA=IBIFN,DIE("NO^")=""
"RTN","IBCC",112,0)
 S DR="16;S:'X Y=0;19;S IBCCCC=1;"
"RTN","IBCC",113,0)
 I $G(IBCEAUTO) S DR="16////1;19////EDI/MRA TURNED OFF;S IBCCCC=1;"
"RTN","IBCC",114,0)
 ;
"RTN","IBCC",115,0)
 ; esg - 8/23/06 - IB*2*358 - fix semi-colon in free text field
"RTN","IBCC",116,0)
 I $G(IBMCSRSC)'="" S DR="16;S:'X Y=0;19//^S X=IBMCSRSC;S IBCCCC=1;"
"RTN","IBCC",117,0)
 D ^DIE K DIE,DR
"RTN","IBCC",118,0)
 ;
"RTN","IBCC",119,0)
NO I 'IBCCCC W !!,"<NO ACTION TAKEN>",*7 S IBQUIT=1 G ASK:IBCAN<2,Q
"RTN","IBCC",120,0)
 S IBCCR=$P($G(^DGCR(399,IBIFN,"S")),U,19)
"RTN","IBCC",121,0)
 ; update claim # with new iteration
"RTN","IBCC",122,0)
 D:$G(IBCNCRD)=1 CRD
"RTN","IBCC",123,0)
 W !!,"...Bill has been cancelled..." D BULL^IBCBULL,BSTAT^IBCDC(IBIFN),PRIOR^IBCCC2(IBIFN)
"RTN","IBCC",124,0)
 ;
"RTN","IBCC",125,0)
 ; cancelling in ingenix claimsmanager if ingenix is running
"RTN","IBCC",126,0)
 ; clean-up of variables is OK if not coming in from ListMan screen
"RTN","IBCC",127,0)
 I $$CM^IBCIUT1(IBIFN) S IBCISNT=4 D ST2^IBCIST I '$G(IBCICNCL) K IBCISNT,IBCISTAT,IBCIREDT,IBCIERR
"RTN","IBCC",128,0)
 ;
"RTN","IBCC",129,0)
 S IBEDI=$G(IB364)
"RTN","IBCC",130,0)
 I 'IBEDI S IBEDI=+$$LAST364^IBCEF4(IBIFN)
"RTN","IBCC",131,0)
 I IBEDI D UPDEDI^IBCEM(IBEDI,"C") ;Update EDI files, if needed
"RTN","IBCC",132,0)
 ;
"RTN","IBCC",133,0)
 F I="S","U1" S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"")
"RTN","IBCC",134,0)
 S PRCASV("ARREC")=IBIFN,PRCASV("AMT")=$S(IB("U1")']"":0,1:$P(IB("U1"),"^")),PRCASV("DATE")=$P(IB("S"),"^",17),PRCASV("BY")=$P(IB("S"),"^",18)
"RTN","IBCC",135,0)
 S PRCASV("COMMENT")=$S($P(IB("S"),U,19)]"":$P(IB("S"),U,19),$P(^IBE(350.9,1,2),"^",7)]"":$P(^(2),"^",7),1:"BILL CANCELLED IN MAS")
"RTN","IBCC",136,0)
 S PRCASV("BY")=$S($P(IB("S"),U,18)]"":$P(IB("S"),U,18),1:"")
"RTN","IBCC",137,0)
 ; IA#3374/IB*2.0*433 Pass the CRD flag so FMS knows to send a cancel record before the new E record is sent
"RTN","IBCC",138,0)
 ;S X=$$CANCEL^RCBEIB($G(PRCASV("ARREC")),$G(PRCASV("DATE")),$G(PRCASV("BY")),$G(PRCASV("AMT")),$G(PRCASV("COMMENT")))
"RTN","IBCC",139,0)
 S PRCASV("ARCRD")=$G(IBCNCRD)
"RTN","IBCC",140,0)
 S X=$$CANCEL^RCBEIB($G(PRCASV("ARREC")),$G(PRCASV("DATE")),$G(PRCASV("BY")),$G(PRCASV("AMT")),$G(PRCASV("COMMENT")),$G(PRCASV("ARCRD")))
"RTN","IBCC",141,0)
 W !,$S(X:">> The receivable associated with the claim was cancelled.",1:">> The receivable associated with the claim was not cancelled.")
"RTN","IBCC",142,0)
 I $P(X,U,2)]"" W !,">>> ",$P(X,U,2) ; The reason why the claim can not be cancelled.
"RTN","IBCC",143,0)
 I IBCAN<2 D RNB^IBCC1 ;assign a reason not billable
"RTN","IBCC",144,0)
 G ASK:IBCAN<2,Q
"RTN","IBCC",145,0)
 ;
"RTN","IBCC",146,0)
HELP W !,?3,"Answer 'YES' or 'Y' if you wish to cancel this bill.",!,?3,"Answer 'NO' or 'N' if you want to abort." G CHK
"RTN","IBCC",147,0)
 Q
"RTN","IBCC",148,0)
1 I $P(IB(0),U,13)=1 W !,"This record was re-opened on " S Y=$P(IB(0),U,14) X ^DD("DD") W Y,"." G CHK
"RTN","IBCC",149,0)
 G ASK
"RTN","IBCC",150,0)
Q1 K:IBCAN=1 IBQUIT K IBCAN
"RTN","IBCC",151,0)
Q K %,IBEPAR,IBSTAT,IBARST,IBAC1,IB,DFN,IBX,IBZ,DIC,DIE,DR,PRCASV,PRCASVC,X,Y,IBEDI
"RTN","IBCC",152,0)
 ;***
"RTN","IBCC",153,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCC" D T1^%ZOSV ;stop rt clock
"RTN","IBCC",154,0)
 Q
"RTN","IBCC",155,0)
CRD ; entry to point to add iteration # to claim
"RTN","IBCC",156,0)
 N IBFDA
"RTN","IBCC",157,0)
 S IBITN=$$ITN^IBCCC(IBIFN)
"RTN","IBCC",158,0)
 S IBFDA(399,IBIFN_",",.01)=IBITN
"RTN","IBCC",159,0)
 D FILE^DIE("","IBFDA")
"RTN","IBCC",160,0)
 ; this will re-open the claim, so reset to cancelled
"RTN","IBCC",161,0)
 S DIE=399,DA=IBIFN
"RTN","IBCC",162,0)
 S DR="16////1"
"RTN","IBCC",163,0)
 D ^DIE K DIE,DR
"RTN","IBCC",164,0)
 Q
"RTN","IBCC",165,0)
 ;
"RTN","IBCC",166,0)
PROCESS(IBIFN,IBCAN) ;
"RTN","IBCC",167,0)
 ; Entry point when the bill number is already known.  Use this when
"RTN","IBCC",168,0)
 ; you just want to try to cancel this bill and this bill only.
"RTN","IBCC",169,0)
 ; Input:
"RTN","IBCC",170,0)
 ;   IBIFN - Internal bill# (Required)
"RTN","IBCC",171,0)
 ;   IBCAN - Cancel Flag (optional, defaults to 1 if not included)
"RTN","IBCC",172,0)
 ;
"RTN","IBCC",173,0)
 NEW IBNOASK
"RTN","IBCC",174,0)
 S IBNOASK=1
"RTN","IBCC",175,0)
 S IBCAN=$G(IBCAN,1)
"RTN","IBCC",176,0)
 G ASK
"RTN","IBCC",177,0)
 ;
"RTN","IBCC",178,0)
 ;IBCC
"RTN","IBCCC")
0^59^B20747072^B19833336
"RTN","IBCCC",1,0)
IBCCC ;ALB/AAS - CANCEL AND CLONE A BILL ;25-JAN-90
"RTN","IBCCC",2,0)
 ;;2.0;INTEGRATED BILLING;**80,109,106,51,320,433,432**;21-MAR-94;Build 192
"RTN","IBCCC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCCC",4,0)
 ;
"RTN","IBCCC",5,0)
 ;MAP TO DGCRCC
"RTN","IBCCC",6,0)
 ;
"RTN","IBCCC",7,0)
 ;STEP 1 - cancel bill
"RTN","IBCCC",8,0)
 ;STEP 1.5 - entry to clone previously cancelled bill.  (must be cancel)
"RTN","IBCCC",9,0)
 ;STEP 2 - build array of IBIDS call screen that asks ok
"RTN","IBCCC",10,0)
 ;STEP 3 - pass stub entry to ar
"RTN","IBCCC",11,0)
 ;STEP 4 - store stub data in MCCR then x-ref
"RTN","IBCCC",12,0)
 ;STEP 4.5 - store claim clone info on "S1" node.
"RTN","IBCCC",13,0)
 ;STEP 5 - get remainder of data to move and store in MCCR then x-ref
"RTN","IBCCC",14,0)
 ;STEP 6 - go to screens, come out to IBB1 
"RTN","IBCCC",15,0)
EN ;
"RTN","IBCCC",16,0)
 N IBBCF,IBBCT,IBBCB,IBCCR,IBDBC,IBCNCOPY
"RTN","IBCCC",17,0)
 S IBDBC=DT    ;date claim was cloned
"RTN","IBCCC",18,0)
 S IBBCB=DUZ   ;user-id of person cloning the claim.
"RTN","IBCCC",19,0)
 S IBCNCOPY=1 ; flag indicating this function is entered as the copy/cancel option
"RTN","IBCCC",20,0)
 ;
"RTN","IBCCC",21,0)
STEP1 I $G(IBCE("EDI"))>1 G END1
"RTN","IBCCC",22,0)
 S IBCAN=2,IBQUIT=0,IBAC=6,IBU="UNSPECIFIED"
"RTN","IBCCC",23,0)
 I '$G(IBCE("EDI")) D ASK^IBCC
"RTN","IBCCC",24,0)
 I $G(IBCE("EDI"))=1 S IB364="" D NOPTF^IBCC
"RTN","IBCCC",25,0)
 G:IBQUIT END1
"RTN","IBCCC",26,0)
 I 'IBCCCC!('$D(IBIFN)) G STEP1:'$G(IBCE("EDI")),END1
"RTN","IBCCC",27,0)
 I $G(IBCE("EDI")) S IBCE("EDI")=2
"RTN","IBCCC",28,0)
EN1 ;
"RTN","IBCCC",29,0)
STEP1P5 I '$D(IBIFN) S IBCAN=2,IBQUIT=0,IBAC=6 W !,"Copy Previously Cancelled Bill.",!! S DIC="^DGCR(399,",DIC("S")="I $P(^(0),U,13)=7",DIC(0)="AEMQZ",DIC("A")="Enter BILL NUMBER or Patient NAME: " D ^DIC G:Y<1 END S IBIFN=+Y
"RTN","IBCCC",30,0)
 ;
"RTN","IBCCC",31,0)
 S IBBCF=IBIFN    ;this is the claim we are copying FROM
"RTN","IBCCC",32,0)
 S IBIDS(.15)=IBIFN K IBIFN
"RTN","IBCCC",33,0)
STEP2 S IBND0=^DGCR(399,IBIDS(.15),0) I $D(^("U")) S IBNDU=^("U")
"RTN","IBCCC",34,0)
 ; *** Note - all these fields should also be included in WHERE^IBCCC1
"RTN","IBCCC",35,0)
 ; IB*2.0*432 added check of variable IBSILENT to allow COB copy in background mode
"RTN","IBCCC",36,0)
 F I=2:1:12 S:$P(IBND0,"^",I)]"" IBIDS(I/100)=$P(IBND0,"^",I)
"RTN","IBCCC",37,0)
 F I=16:1:19,21:1:27 S:$P(IBND0,"^",I)]"" IBIDS(I/100)=$P(IBND0,"^",I)
"RTN","IBCCC",38,0)
 F I=151,152,155 S IBIDS(I)=$P(IBNDU,"^",(I-150))
"RTN","IBCCC",39,0)
 S IBIDS(159.5)=$P(IBNDU,U,20)
"RTN","IBCCC",40,0)
 ; ***
"RTN","IBCCC",41,0)
 D:$G(IBSILENT)="" HOME^%ZIS
"RTN","IBCCC",42,0)
 S DFN=IBIDS(.02) D DEM^VADPT
"RTN","IBCCC",43,0)
 I +$G(IBCTCOPY)!$G(IBCE("EDI")) G STEP3
"RTN","IBCCC",44,0)
 D ^IBCA1
"RTN","IBCCC",45,0)
ASK S IBYN=0 W !!,"IS THE ABOVE INFORMATION CORRECT AS SHOWN" S %=1 D YN^DICN G END:%=2,STEP3:%=1 I % G END
"RTN","IBCCC",46,0)
 W !!?4,"YES - If this information is correct as shown and you wish to file the bill.",!?4,"NO  - If you wish to change this information prior to filing."
"RTN","IBCCC",47,0)
 W !?4,"'^' - Enter the up-arrow character to DELETE this Bill at this time." G ASK
"RTN","IBCCC",48,0)
 ;
"RTN","IBCCC",49,0)
STEP3 ;
"RTN","IBCCC",50,0)
 S PRCASV("SER")=$P($G(^IBE(350.9,1,1)),"^",14)
"RTN","IBCCC",51,0)
 S PRCASV("SITE")=$P($$SITE^VASITE,"^",3),IBNWBL="",PRCASV("ARCRD")=$G(IBCNCRD)
"RTN","IBCCC",52,0)
 ; IA#386 & 1992  If user came from CRD option, need to pass old bill # and claim ien, as well as new iteration number
"RTN","IBCCC",53,0)
 I $G(IBCNCRD)=1 S PRCASV("ARREC")=IBBCF,PRCASV("ARBIL")=PRCASV("SITE")_"-"_$P(IBITN,"-"),PRCASV("ARITN")=PRCASV("SITE")_"-"_IBITN
"RTN","IBCCC",54,0)
 W:$G(IBSILENT)="" !,"Passing bill to Accounts Receivable Module..." D SETUP^PRCASVC3 I $S($P(PRCASV("ARREC"),"^")=-1:1,$P(PRCASV("ARBIL"),"^")=-1:1,1:0) W:$G(IBSILENT)="" *7,"  ",$P(PRCASV("ARREC"),"^",2),$P(PRCASV("ARBIL"),"^",2) G END
"RTN","IBCCC",55,0)
 S IBIDS(.01)=$P(PRCASV("ARBIL"),"-",2),IBIDS(.17)=$S($D(IBIDS(.17)):IBIDS(.17),1:PRCASV("ARREC"))
"RTN","IBCCC",56,0)
 I '$G(IBCE("EDI")) W !,"Billing Record #",IBIDS(.01)," being established for '",VADM(1),"'..." S IBIDS(.02)=DFN,IBHV("IBIFN")=$S($G(IBIFN):IBIFN,1:$G(IBIDS(.15)))
"RTN","IBCCC",57,0)
 G ^IBCCC1 ;go to step4
"RTN","IBCCC",58,0)
 Q
"RTN","IBCCC",59,0)
 ;
"RTN","IBCCC",60,0)
END W:$G(IBSILENT)="" !!,"No Billing Record Set up.  You must manually enter the bill."
"RTN","IBCCC",61,0)
END1 K %,%DT,IBCAN,IBAC,IBND0,IBNDU,IBYN,IBCCCC,IBIFN,IB,IBA,IBNWBL,IBBT,IBIDS,IBU,I,J,VA,VADM,X,X1,X2,X3,X4,D,Y
"RTN","IBCCC",62,0)
 ;I '$G(IBQUIT),$S(+$G(IBCNCOPY):1,1:'$G(IBCE("EDI"))) G STEP1
"RTN","IBCCC",63,0)
 I '$G(IBQUIT),$S(+$G(IBCNCOPY)!(+$G(IBCNCRD)):1,1:'$G(IBCE("EDI"))) G STEP1
"RTN","IBCCC",64,0)
 K IBQUIT,IBCNCOPY,IBCNCRD
"RTN","IBCCC",65,0)
 Q
"RTN","IBCCC",66,0)
 ;
"RTN","IBCCC",67,0)
ITN(IBX) ; determine iteration # for rejected or denied claim
"RTN","IBCCC",68,0)
 N IBCF,IBCL
"RTN","IBCCC",69,0)
 S IBCF=$P($G(^DGCR(399,IBX,"S1")),U,2)
"RTN","IBCCC",70,0)
 ; if this claim has never been cloned, iteration # is -01
"RTN","IBCCC",71,0)
 Q:IBCF="" $P($G(^DGCR(399,IBX,0)),U)_"-01"
"RTN","IBCCC",72,0)
 S IBCL=$P($G(^DGCR(399,IBCF,0)),U)
"RTN","IBCCC",73,0)
 ; if claim was a CLON 1st and now a CORRECT, this is the 1st iteration
"RTN","IBCCC",74,0)
 I $P(IBCL,"-")'=$P($P($G(^DGCR(399,IBX,0)),U),"-") Q $P($G(^DGCR(399,IBX,0)),U)_"-01"
"RTN","IBCCC",75,0)
 ; to determine iteration#, need to incriment from claim that was cloned from
"RTN","IBCCC",76,0)
 S IBITN=$P(IBCL,"-",2),IBITN=IBITN+1 I $L(IBITN)=1 S IBITN="0"_IBITN
"RTN","IBCCC",77,0)
 Q $P(IBCL,"-")_"-"_IBITN
"RTN","IBCCC",78,0)
 ;
"RTN","IBCCC",79,0)
CRD ; new entry point if user comes from CRD option instead of CLON  
"RTN","IBCCC",80,0)
 N IBBCF,IBBCT,IBBCB,IBCCR,IBDBC,IBCNCRD,IBITN
"RTN","IBCCC",81,0)
 S IBDBC=DT    ;date claim was cloned
"RTN","IBCCC",82,0)
 S IBBCB=DUZ   ;user-id of person cloning the claim.
"RTN","IBCCC",83,0)
 S IBCNCRD=1 ; flag indicating this function is entered as the CRD option
"RTN","IBCCC",84,0)
 G STEP1
"RTN","IBCCC",85,0)
 Q
"RTN","IBCCC",86,0)
 ;
"RTN","IBCCC1")
0^60^B10846914^B10538987
"RTN","IBCCC1",1,0)
IBCCC1 ;ALB/AAS - CANCEL AND CLONE A BILL - CONTINUED ;25-JAN-90
"RTN","IBCCC1",2,0)
 ;;2.0;INTEGRATED BILLING;**80,109,106,51,320,358,433,432**;21-MAR-94;Build 192
"RTN","IBCCC1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCCC1",4,0)
 ;
"RTN","IBCCC1",5,0)
 ;MAP TO DGCRCC1
"RTN","IBCCC1",6,0)
 ;
"RTN","IBCCC1",7,0)
 ;STEP 1 - cancel bill
"RTN","IBCCC1",8,0)
 ;STEP 1.5 - entry to clone previously cancelled bill.  (must be cancell)
"RTN","IBCCC1",9,0)
 ;STEP 2 - build array of IBIDS call screen that asks ok
"RTN","IBCCC1",10,0)
 ;STEP 3 - pass stub entry to ar
"RTN","IBCCC1",11,0)
 ;STEP 4 - store stub data in MCCR then x-ref
"RTN","IBCCC1",12,0)
 ;STEP 4.5 - store claim clone info on "S1" node.
"RTN","IBCCC1",13,0)
 ;STEP 5 - get remainder of data to move and store in MCCR then x-ref
"RTN","IBCCC1",14,0)
 ;STEP 6 - go to screens, come out to IBB1 or something like that
"RTN","IBCCC1",15,0)
 ;
"RTN","IBCCC1",16,0)
STEP4 S X=$P($T(WHERE),";;",2) F I=0:0 S I=$O(IBIDS(I)) Q:'I  S X1=$P($E(X,$F(X,I)+1,999),";",1),$P(IBDR($P(X1,"^",1)),"^",$P(X1,"^",2))=IBIDS(I)
"RTN","IBCCC1",17,0)
 S IBIFN=PRCASV("ARREC") F I=0,"C","M","M1","S","U","U1" I $D(IBDR(I)) S ^DGCR(399,IBIFN,I)=IBDR(I)
"RTN","IBCCC1",18,0)
 D  ; Protect variables;index entry;replace FT if copy/clone and it chngs
"RTN","IBCCC1",19,0)
 . N IBHOLD,DIE,DR,DA,X,Y
"RTN","IBCCC1",20,0)
 . S IBHOLD("FT")=$P($G(^DGCR(399,IBIFN,0)),U,19)
"RTN","IBCCC1",21,0)
 . S $P(^DGCR(399,0),"^",3)=IBIFN,$P(^(0),"^",4)=$P(^(0),"^",4)+1 W:$G(IBSILENT)="" !,"Cross-referencing new billing entry..." D INDEX^IBCCC2
"RTN","IBCCC1",22,0)
 .; I $G(IBCNCOPY),IBHOLD("FT"),IBHOLD("FT")'=$P($G(^DGCR(399,IBIFN,0)),U,19) S DA=IBIFN,DIE="^DGCR(399,",DR=".19////"_IBHOLD("FT") D ^DIE
"RTN","IBCCC1",23,0)
 . I $G(IBCNCOPY)!$G(IBCNCRD),IBHOLD("FT"),IBHOLD("FT")'=$P($G(^DGCR(399,IBIFN,0)),U,19) S DA=IBIFN,DIE="^DGCR(399,",DR=".19////"_IBHOLD("FT") D ^DIE
"RTN","IBCCC1",24,0)
 S IBYN=1 W:$G(IBSILENT)="" !!,*7,"Billing Record #",$P(^DGCR(399,+IBIFN,0),"^",1)," established for '",VADM(1),"'..."
"RTN","IBCCC1",25,0)
 S:$G(IBCE("EDI")) IBCE("EDI","NEW")=IBIFN
"RTN","IBCCC1",26,0)
 I $G(IBCE("EDI"))!($G(IBCTCOPY)=1) S IBHV("IBIFN1")=IBIFN ; New bill #
"RTN","IBCCC1",27,0)
 S IBBCT=IBIFN   ;bill the old claim was cloned TO.
"RTN","IBCCC1",28,0)
END K %,%DT,IB,IBA,IBNWBL,IBBT,IBIDS,I,J,VADM,X,X1,X2,X3,X4,Y
"RTN","IBCCC1",29,0)
 ;
"RTN","IBCCC1",30,0)
STEP4P5 ;added in patch 320
"RTN","IBCCC1",31,0)
 ;first, put the TO data on the FROM bill
"RTN","IBCCC1",32,0)
 ; Skip if not a CLON or CRD claim
"RTN","IBCCC1",33,0)
 ;
"RTN","IBCCC1",34,0)
 I '$G(IBCNCOPY)&('$G(IBCNCRD)) G STEP45X
"RTN","IBCCC1",35,0)
 S DIE="^DGCR(399,",DA=IBBCF,DR="29////"_$G(IBBCT) D ^DIE
"RTN","IBCCC1",36,0)
 S DIE="^DGCR(399,",DA=IBBCF,DR="31////"_$G(IBDBC) D ^DIE
"RTN","IBCCC1",37,0)
 S DIE="^DGCR(399,",DA=IBBCF,DR="32////"_$G(IBBCB) D ^DIE
"RTN","IBCCC1",38,0)
 ;
"RTN","IBCCC1",39,0)
 ; esg - 8/23/06 - IB*2*358 - fix semi-colon in free text field
"RTN","IBCCC1",40,0)
 S DIE="^DGCR(399,",DA=IBBCF,DR="33////^S X=$G(IBCCR)" D ^DIE
"RTN","IBCCC1",41,0)
 ;
"RTN","IBCCC1",42,0)
 ;now, put the FROM data on the TO bill
"RTN","IBCCC1",43,0)
 ;
"RTN","IBCCC1",44,0)
 S DIE="^DGCR(399,",DA=IBBCT,DR="30////"_$G(IBBCF) D ^DIE
"RTN","IBCCC1",45,0)
 ;
"RTN","IBCCC1",46,0)
STEP45X G ^IBCCC2 ;go to step 5
"RTN","IBCCC1",47,0)
 ;
"RTN","IBCCC1",48,0)
XREF F IBI1=0:0 S IBI1=$O(^DD(399,IBI,1,IBI1)) Q:'IBI1  I $D(^DD(399,IBI,1,IBI1,1)) S DA=IBIFN,X=IBIDS(IBI) I X]"" X ^DD(399,IBI,1,IBI1,1)
"RTN","IBCCC1",49,0)
 Q
"RTN","IBCCC1",50,0)
 ; NOTE:  any new or changed data nodes MAY need to be updated in IBNCPDP5
"RTN","IBCCC1",51,0)
WHERE ;;.01^0^1;.02^0^2;.03^0^3;.04^0^4;.05^0^5;.06^0^6;.07^0^7;.08^0^8;.09^0^9;.11^0^11;.12^0^12;.17^0^17;.18^0^18;.19^0^19;.15^0^15;.16^0^16;.21^0^21;.22^0^22;.23^0^23;.24^0^24;.25^0^25;.26^0^26;.27^0^27;151^U^1;152^U^2;155^U^5;159.5^U^20;
"RTN","IBCCC1",52,0)
 ;
"RTN","IBCCC2")
0^51^B89240196^B69917469
"RTN","IBCCC2",1,0)
IBCCC2 ;ALB/AAS - CANCEL AND CLONE A BILL - CONTINUED ;6/6/03 9:56am
"RTN","IBCCC2",2,0)
 ;;2.0;INTEGRATED BILLING;**80,106,124,138,51,151,137,161,182,211,245,155,296,320,348,349,371,400,433,432**;21-MAR-94;Build 192
"RTN","IBCCC2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCCC2",4,0)
 ;
"RTN","IBCCC2",5,0)
 ;MAP TO DGCRCC2
"RTN","IBCCC2",6,0)
 ;
"RTN","IBCCC2",7,0)
 ;STEP 5 - get remainder of data to move and store in MCCR then x-ref
"RTN","IBCCC2",8,0)
 ;STEP 6 - go to screens, come out to IBB1 or something like that
"RTN","IBCCC2",9,0)
 ;
"RTN","IBCCC2",10,0)
STEP5 S IBIFN1=$P(^DGCR(399,IBIFN,0),"^",15) G END:$S(IBIFN1="":1,'$D(^DGCR(399,IBIFN1,0)):1,1:0)
"RTN","IBCCC2",11,0)
 ; NOTE:  any new or changed data nodes may also need to be updated in IBNCPDP5
"RTN","IBCCC2",12,0)
 ;move pure data nodes
"RTN","IBCCC2",13,0)
 F I="I1","I2","I3","M1" I $D(^DGCR(399,IBIFN1,I)) S ^DGCR(399,IBIFN,I)=^DGCR(399,IBIFN1,I)
"RTN","IBCCC2",14,0)
 ;
"RTN","IBCCC2",15,0)
 ;move top level data node. ;Do not move 'TX' node except piece 8 (added with IB*2.0*432)
"RTN","IBCCC2",16,0)
 ;F I="U","U1","U2","U3","UF2","UF3","UF31","C","M" I $D(^DGCR(399,IBIFN1,I)) S IBND(I)=^(I) D @I
"RTN","IBCCC2",17,0)
 ; add new data nodes introduced with IB*2.0*432
"RTN","IBCCC2",18,0)
 F I="TX","U","U1","U2","U3","U4","U5","U6","U8","UF2","UF3","UF31","UF32","C","M" I $D(^DGCR(399,IBIFN1,I)) S IBND(I)=^(I) D @I
"RTN","IBCCC2",19,0)
 ;
"RTN","IBCCC2",20,0)
 ;move multiple level data
"RTN","IBCCC2",21,0)
 F I="CC","OC","OP","OT","RC","CP","CV","PRV" I $D(^DGCR(399,IBIFN1,I,0)) D @I
"RTN","IBCCC2",22,0)
 ;
"RTN","IBCCC2",23,0)
 ; IB*2.0*432  ADDED IBSILENT flag so that this can be processed in background
"RTN","IBCCC2",24,0)
 D FTPRV^IBCEU5(IBIFN,$G(IBSILENT)) ; Ask change prov type if form type not the same
"RTN","IBCCC2",25,0)
 D COBCHG(IBIFN,,.IBCOB)
"RTN","IBCCC2",26,0)
 ;
"RTN","IBCCC2",27,0)
 D ^IBCCC3 ; copy table files (362.3)
"RTN","IBCCC2",28,0)
 ;
"RTN","IBCCC2",29,0)
 S I=$G(^DGCR(399,IBIFN1,0)) I $P(I,U,13)=7,$P(I,U,20)=1 D COPYB^IBCDC(IBIFN1,IBIFN) ; update auto bill files
"RTN","IBCCC2",30,0)
 D PRIOR(IBIFN) ; add new bill to previous bills in series, primary/secondary
"RTN","IBCCC2",31,0)
 ;
"RTN","IBCCC2",32,0)
 I +$G(IBCTCOPY) N IBAUTO S IBAUTO=1 D PROC^IBCU7A(IBIFN),BILL^IBCRBC(IBIFN),CPTMOD26^IBCU73(IBIFN) D RECALL^DILFD(399,IBIFN_",",DUZ) G END
"RTN","IBCCC2",33,0)
 ;
"RTN","IBCCC2",34,0)
STEP6 N IBGOEND
"RTN","IBCCC2",35,0)
 ; need to kill CRD flag prior to entering billing screens in case a copy for corresponding claim is needed
"RTN","IBCCC2",36,0)
 K IBCNCRD
"RTN","IBCCC2",37,0)
 ; don't call IB bill edit screens if this is non-MRA background processing
"RTN","IBCCC2",38,0)
 I $G(IBSTSM)=1 G END
"RTN","IBCCC2",39,0)
 I '$G(IBCE("EDI"))!$G(IBCE("EDI","NEW")),'$G(IBCEAUTO) D IBSCEDT G END:$G(IBGOEND)
"RTN","IBCCC2",40,0)
 ;
"RTN","IBCCC2",41,0)
 ;
"RTN","IBCCC2",42,0)
END K DFN,IB,IBA,IBA2,IBAD,IBADD1,IBBNO,IBCAN,IBCCC,IBDA,IBDPT,IBDR,IBDT,IBI,IBI1,IBIDS,IBIFN,IBIFN1,IBND,IBQUIT,IBU,IBUN,IBARST,IBCOB,IBCNCOPY,IBCBCOPY,IBCNCRD,IBKEY
"RTN","IBCCC2",43,0)
 K IBV,IBV1,IBW,IBWW,IBYN,IBZZ,PRCASV,PRCAERCD,PRCAERR,PRCASVC,PRCAT,IBBT,IBCH,IBNDS,IBOA,IBREV,IBX,DGXRF1,VAEL,VAERR,IBAC,IBCCC,IBDD1,IBIN,DGREV,DGREV00,DGREVHDR,IBCHK
"RTN","IBCCC2",44,0)
 K IBBS,IBLS,DGPCM,IBIP,IBND0,IBNDU,IBO,IBPTF,IBST,IBUC,IBDD,D,%,%DT,DIC,VA,VADM,X,X1,X2,X3,X4,Y,I,J,K,DGRVRCAL,DDH,DGACTDT,DGAMNT,DGBR,DGBRN,DGBSI,DGBSLOS,IBA1,IBOD,IBINS,IBN,IBPROC,DGFUNC,DGIFN
"RTN","IBCCC2",45,0)
 Q
"RTN","IBCCC2",46,0)
 ;
"RTN","IBCCC2",47,0)
 ;
"RTN","IBCCC2",48,0)
IBSCEDT ; call the IB bill edit screens and validate the data
"RTN","IBCCC2",49,0)
 N IBV,IBPAR,IBAC,IBHV,IBH,IBCIREDT
"RTN","IBCCC2",50,0)
 ; if the user came from CBW->PC and this is a non-MRA claim w/a paper EOB, set force print flag IB*2.0*432
"RTN","IBCCC2",51,0)
 ; also, if the user came from CBW->PC and this is a non-MRA claim and the only EEOB we have has filing errors, set force print flag
"RTN","IBCCC2",52,0)
 I $G(IBMRANOT)=1,$$COBN^IBCEF(IBIFN)>1,$G(IBFROM)=2 D 
"RTN","IBCCC2",53,0)
 .I $G(IBDA)="" D FORCEPRT^IBCAPP($G(IBIFN)) Q
"RTN","IBCCC2",54,0)
 .I $D(^IBM(361.1,IBDA,"ERR")) D FORCEPRT^IBCAPP($G(IBIFN)) Q
"RTN","IBCCC2",55,0)
 D RECALL^DILFD(399,IBIFN_",",DUZ)
"RTN","IBCCC2",56,0)
ST1 S IBV=0 D ^IBCSCU,^IBCSC1 I $G(IBPOPOUT) S IBGOEND=1 G IBSCX
"RTN","IBCCC2",57,0)
 S IBAC=1
"RTN","IBCCC2",58,0)
 D ^IBCB1
"RTN","IBCCC2",59,0)
 I $G(IBCIREDT) G ST1
"RTN","IBCCC2",60,0)
IBSCX ;
"RTN","IBCCC2",61,0)
 Q
"RTN","IBCCC2",62,0)
 ;
"RTN","IBCCC2",63,0)
 ;
"RTN","IBCCC2",64,0)
TX F J=8 I $P(IBND("TX"),"^",J)]"" S $P(^DGCR(399,IBIFN,"TX"),"^",J)=$P(IBND("TX"),"^",J)
"RTN","IBCCC2",65,0)
 Q
"RTN","IBCCC2",66,0)
U F J=3,4,6:1:17,20 I $P(IBND("U"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U"),"^",J)=$P(IBND("U"),"^",J)
"RTN","IBCCC2",67,0)
 Q
"RTN","IBCCC2",68,0)
U1 F J=1:1:3,15 I $P(IBND("U1"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U1"),"^",J)=$P(IBND("U1"),"^",J)
"RTN","IBCCC2",69,0)
 Q
"RTN","IBCCC2",70,0)
U2 F J=1:1:19 I $P(IBND("U2"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U2"),"^",J)=$P(IBND("U2"),"^",J)
"RTN","IBCCC2",71,0)
 Q
"RTN","IBCCC2",72,0)
U3 F J=1:1:11 I $P(IBND("U3"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U3"),"^",J)=$P(IBND("U3"),"^",J)
"RTN","IBCCC2",73,0)
 Q
"RTN","IBCCC2",74,0)
UF2 F J=1,3 I $P(IBND("UF2"),"^",J)]"" S $P(^DGCR(399,IBIFN,"UF2"),"^",J)=$P(IBND("UF2"),"^",J)
"RTN","IBCCC2",75,0)
 Q
"RTN","IBCCC2",76,0)
UF3 F J=4:1:6 I $P(IBND("UF3"),"^",J)]"" S $P(^DGCR(399,IBIFN,"UF3"),"^",J)=$P(IBND("UF3"),"^",J)
"RTN","IBCCC2",77,0)
 Q
"RTN","IBCCC2",78,0)
U4 F J=1:1:14 I $P(IBND("U4"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U4"),"^",J)=$P(IBND("U4"),"^",J)
"RTN","IBCCC2",79,0)
 Q
"RTN","IBCCC2",80,0)
U5 F J=1:1:6 I $P(IBND("U5"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U5"),"^",J)=$P(IBND("U5"),"^",J)
"RTN","IBCCC2",81,0)
 Q
"RTN","IBCCC2",82,0)
U6 F J=1:1:6 I $P(IBND("U6"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U6"),"^",J)=$P(IBND("U6"),"^",J)
"RTN","IBCCC2",83,0)
 Q
"RTN","IBCCC2",84,0)
U8 F J=1:1:3 I $P(IBND("U8"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U8"),"^",J)=$P(IBND("U8"),"^",J)
"RTN","IBCCC2",85,0)
 Q
"RTN","IBCCC2",86,0)
UF31 F J=3 I $P(IBND("UF31"),"^",J)]"" S $P(^DGCR(399,IBIFN,"UF31"),"^",J)=$P(IBND("UF31"),"^",J)
"RTN","IBCCC2",87,0)
 Q
"RTN","IBCCC2",88,0)
UF32 F J=1:1:3 I $P(IBND("UF32"),"^",J)]"" S $P(^DGCR(399,IBIFN,"UF32"),"^",J)=$P(IBND("UF32"),"^",J)
"RTN","IBCCC2",89,0)
 Q
"RTN","IBCCC2",90,0)
C F J=10 I $P(IBND("C"),"^",J)]"" S $P(^DGCR(399,IBIFN,"C"),"^",J)=$P(IBND("C"),"^",J)
"RTN","IBCCC2",91,0)
 I '$D(^DGCR(399,IBIFN1,"CP")) D CP1
"RTN","IBCCC2",92,0)
 Q
"RTN","IBCCC2",93,0)
M F J=1:1:9,11:1:14 I $P(IBND("M"),"^",J)]"" S $P(^DGCR(399,IBIFN,"M"),"^",J)=$P(IBND("M"),"^",J)
"RTN","IBCCC2",94,0)
 Q
"RTN","IBCCC2",95,0)
CC S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",96,0)
 S IBDD=399.04 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",97,0)
OP S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",98,0)
 S IBDD=399.043 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",99,0)
 Q
"RTN","IBCCC2",100,0)
OC S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",101,0)
 S IBDD=399.041 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",102,0)
 Q
"RTN","IBCCC2",103,0)
OT S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",104,0)
 S IBDD=399.048 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",105,0)
 Q
"RTN","IBCCC2",106,0)
CV ; Don't copy value codes from inpatient inst to inpatient prof bills
"RTN","IBCCC2",107,0)
 I $$FT^IBCEF(IBIFN1)'=2,$$FT^IBCEF(IBIFN)=2 Q
"RTN","IBCCC2",108,0)
 S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",109,0)
 S IBDD=399.047 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",110,0)
 Q
"RTN","IBCCC2",111,0)
RC S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",112,0)
 S IBDD=399.042 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S IBND("RC")=^(0) F K=1:1:15 S $P(^DGCR(399,IBIFN,I,J,0),"^",K)=$P(IBND("RC"),"^",K),X=$P(IBND("RC"),"^",K)
"RTN","IBCCC2",113,0)
 Q
"RTN","IBCCC2",114,0)
CP S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",115,0)
 I +$G(IBNOCPT) Q
"RTN","IBCCC2",116,0)
 S IBDD=399.0304 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S IBND("CP")=^(0),IBND("CP1")=$G(^(1)),IBND("CP-AUX")=$G(^("AUX")) D
"RTN","IBCCC2",117,0)
 . F K=1:1:7,9:1:14,16:1:22 S $P(^DGCR(399,IBIFN,I,J,0),"^",K)=$P(IBND("CP"),"^",K)
"RTN","IBCCC2",118,0)
 . ; IB*2.0*432 add new 1 node
"RTN","IBCCC2",119,0)
 . F K=1:1:5 S $P(^DGCR(399,IBIFN,I,J,1),"^",K)=$P(IBND("CP1"),"^",K)
"RTN","IBCCC2",120,0)
 . ; esg - 11/2/06 - IB*2*348 - 50.09 field was added - AUX piece [9]
"RTN","IBCCC2",121,0)
 . I IBND("CP-AUX")'="" F K=1:1:9 S $P(^DGCR(399,IBIFN,I,J,"AUX"),"^",K)=$P(IBND("CP-AUX"),"^",K)
"RTN","IBCCC2",122,0)
 . ; IB*2.0*432 add new LNPRV multiple
"RTN","IBCCC2",123,0)
 . I $D(^DGCR(399,IBIFN1,I,J,"LNPRV",0)) S ^DGCR(399,IBIFN,I,J,"LNPRV",0)=^DGCR(399,IBIFN1,I,J,"LNPRV",0) D
"RTN","IBCCC2",124,0)
 .. S K=0 F  S K=$O(^DGCR(399,IBIFN1,I,J,"LNPRV",K)) Q:'K  D
"RTN","IBCCC2",125,0)
 ... S ^DGCR(399,IBIFN,I,J,"LNPRV",K,0)=^DGCR(399,IBIFN1,I,J,"LNPRV",K,0)
"RTN","IBCCC2",126,0)
 . I $D(^DGCR(399,IBIFN1,I,J,"MOD",0)) S ^DGCR(399,IBIFN,I,J,"MOD",0)=^DGCR(399,IBIFN1,I,J,"MOD",0) D
"RTN","IBCCC2",127,0)
 .. S K=0 F  S K=$O(^DGCR(399,IBIFN1,I,J,"MOD",K)) Q:'K  D
"RTN","IBCCC2",128,0)
 ... I $G(IBNOTC),$P($$MOD^ICPTMOD(+$P($G(^DGCR(399,IBIFN1,I,J,"MOD",K,0)),U,2),"I"),U,2)="TC" Q  ; Don't copy TC modifier from inst to prof bill
"RTN","IBCCC2",129,0)
 ... S ^DGCR(399,IBIFN,I,J,"MOD",K,0)=^DGCR(399,IBIFN1,I,J,"MOD",K,0)
"RTN","IBCCC2",130,0)
CP1 S IBCOD=$P($G(^DGCR(399,IBIFN,0)),"^",9) Q:IBCOD=""!('$D(^DGCR(399,IBIFN1,"C")))
"RTN","IBCCC2",131,0)
 I IBCOD=9 F DGI=4,5,6 I $P(^DGCR(399,IBIFN1,"C"),"^",DGI) S X=$P(^("C"),"^",DGI)_";ICD0(",DGPROCDT=$P(^("C"),"^",DGI+7) D FILE
"RTN","IBCCC2",132,0)
 I IBCOD=4 F DGI=1,2,3 I $P(^DGCR(399,IBIFN1,"C"),"^",DGI) S X=$P(^("C"),"^",DGI)_";ICPT(",DGPROCDT=$P(^("C"),"^",DGI+10) D FILE
"RTN","IBCCC2",133,0)
 I IBCOD=5 F DGI=7,8,9 I $P(^DGCR(399,IBIFN1,"C"),"^",DGI) S X=$P(^("C"),"^",DGI)_";ICPT(",DGPROCDT=$P(^("C"),"^",DGI+4) D FILE
"RTN","IBCCC2",134,0)
 Q
"RTN","IBCCC2",135,0)
 ;
"RTN","IBCCC2",136,0)
PRV S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",137,0)
 N Z,Z0
"RTN","IBCCC2",138,0)
 S Z=$P($G(^DGCR(399,IBIFN,0)),U,19),Z0=$P($G(^DGCR(399,IBIFN1,0)),U,19)
"RTN","IBCCC2",139,0)
 S IBDD=399.0222 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) D
"RTN","IBCCC2",140,0)
 . S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",141,0)
 . I Z'=Z0,$S(X=3:Z0=3,X=4:Z0=2,1:0) S $P(^DGCR(399,IBIFN,I,J,0),U)=(Z0+1)
"RTN","IBCCC2",142,0)
 Q
"RTN","IBCCC2",143,0)
 ;
"RTN","IBCCC2",144,0)
COB S J=0 F  S J=$O(IBCOB(I,J)) Q:'J  S $P(^DGCR(399,IBIFN,I),U,J)=IBCOB(I,J)
"RTN","IBCCC2",145,0)
 Q
"RTN","IBCCC2",146,0)
 ;
"RTN","IBCCC2",147,0)
FILE N DIC,DIE,DR,DA,X,Y,DLAYGO,DD,DO
"RTN","IBCCC2",148,0)
 I '$D(^DGCR(399,IBIFN,"CP",0)) S DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCCC2",149,0)
 S DIC(0)="L",DLAYGO=399,DA(1)=IBIFN,DIC="^DGCR(399,"_DA(1)_",""CP""," Q:X=""  D FILE^DICN K DO,DD Q:+Y<1  S DA=+Y
"RTN","IBCCC2",150,0)
 S DIE="^DGCR(399,"_DA(1)_",""CP"",",DR="1///"_DGPROCDT D ^DIE
"RTN","IBCCC2",151,0)
 K DGPROCDT
"RTN","IBCCC2",152,0)
 Q
"RTN","IBCCC2",153,0)
 ;
"RTN","IBCCC2",154,0)
INDEX ;index entire file (set logic)
"RTN","IBCCC2",155,0)
 S DIK="^DGCR(399,",DA=IBIFN D IX1^DIK K DA,DIK
"RTN","IBCCC2",156,0)
 Q
"RTN","IBCCC2",157,0)
 ;
"RTN","IBCCC2",158,0)
PRIOR(IBIFN) ; set Secondary/Tertiary Bill #s on prior bills, if the bill is cancelled remove it from prior bills
"RTN","IBCCC2",159,0)
 N IBSEQ,IBSEQN,IBM1,I,IBIFN1
"RTN","IBCCC2",160,0)
 S IBSEQ=$$COB^IBCEF(IBIFN)
"RTN","IBCCC2",161,0)
 S IBSEQN=$S(IBSEQ="S":6,IBSEQ="T":7,1:"") Q:'IBSEQN
"RTN","IBCCC2",162,0)
 ;
"RTN","IBCCC2",163,0)
 S IBM1=$G(^DGCR(399,IBIFN,"M1")) I +$P(^DGCR(399,IBIFN,0),U,13)=7 S IBIFN=""
"RTN","IBCCC2",164,0)
 F I=5,6 I I<IBSEQN  S IBIFN1=+$P(IBM1,U,I) I +IBIFN1,$D(^DGCR(399,+IBIFN1,0)) S $P(^DGCR(399,IBIFN1,"M1"),U,IBSEQN)=IBIFN
"RTN","IBCCC2",165,0)
 Q
"RTN","IBCCC2",166,0)
 ;
"RTN","IBCCC2",167,0)
COBCHG(IBIFN,IBINS,IBCOB) ; Make changes for a new COB payer for bill
"RTN","IBCCC2",168,0)
 ; IBIFN = ien of bill in file 399
"RTN","IBCCC2",169,0)
 ; IBINS = ien of bill's current insurance (optional)
"RTN","IBCCC2",170,0)
 ; IBCOB = array subscripted by node,piece of COB data field change
"RTN","IBCCC2",171,0)
 ;
"RTN","IBCCC2",172,0)
 N I,IBFRMTYP,IBTAXLST
"RTN","IBCCC2",173,0)
 ; Subtract the Prior Payments from the bill's Offset (these are re-added by triggers)
"RTN","IBCCC2",174,0)
 F I=4,5,6  S $P(^DGCR(399,IBIFN,"U1"),U,2)=$P($G(^DGCR(399,IBIFN,"U1")),U,2)-$P($G(^DGCR(399,IBIFN,"U2")),U,I)
"RTN","IBCCC2",175,0)
 ;
"RTN","IBCCC2",176,0)
 I $G(IBINS),$$MCRWNR^IBEFUNC(IBINS) D
"RTN","IBCCC2",177,0)
 . ;MCRWNR is current insurance ... move payer only
"RTN","IBCCC2",178,0)
 . N IBCOBN,IBX
"RTN","IBCCC2",179,0)
 . S IBCOBN=$$COBN^IBCEF(IBIFN)
"RTN","IBCCC2",180,0)
 . S IBCOB(0,21)=$P("S^T^",U,IBCOBN)
"RTN","IBCCC2",181,0)
 . S IBCOB("M1",IBCOBN+4)=IBIFN
"RTN","IBCCC2",182,0)
 . S IBCOB("TX",1)="",IBCOB("TX",2)=""
"RTN","IBCCC2",183,0)
 . S IBX=$$REQMRA^IBEFUNC(IBIFN)
"RTN","IBCCC2",184,0)
 . I IBX=0 S IBCOB("TX",5)=0                         ; MRA not needed
"RTN","IBCCC2",185,0)
 . I IBX["R" S IBCOB("TX",5)="A"                     ; MRA skipped
"RTN","IBCCC2",186,0)
 . I IBX=1,$$CHK^IBCEMU1(IBIFN) S IBCOB("TX",5)="C"  ; MRA on file
"RTN","IBCCC2",187,0)
 . I $G(IBPRCOB) S IBCOB("TX",5)="C"                 ; MRA being proc'd
"RTN","IBCCC2",188,0)
 . D PRIOR(IBIFN)
"RTN","IBCCC2",189,0)
 . Q
"RTN","IBCCC2",190,0)
 ;
"RTN","IBCCC2",191,0)
 ;reset fields for next Sequence Payer
"RTN","IBCCC2",192,0)
 F I=0,"M1","U2","TX" I $D(IBCOB(I)) D COB
"RTN","IBCCC2",193,0)
 ;
"RTN","IBCCC2",194,0)
 ; IB*2.0*211
"RTN","IBCCC2",195,0)
 ; save off Form Type
"RTN","IBCCC2",196,0)
 S IBFRMTYP=$P($G(^DGCR(399,IBIFN,0)),U,19)
"RTN","IBCCC2",197,0)
 ; Save off Taxonomies for providers.
"RTN","IBCCC2",198,0)
 S I=0 F  S I=$O(^DGCR(399,IBIFN,"PRV",I)) Q:'I  S IBTAXLST(I)=$P($G(^DGCR(399,IBIFN,"PRV",I,0)),U,15)
"RTN","IBCCC2",199,0)
 ;
"RTN","IBCCC2",200,0)
 ; fire xrefs set logic
"RTN","IBCCC2",201,0)
 D INDEX
"RTN","IBCCC2",202,0)
 ;
"RTN","IBCCC2",203,0)
 ; Restore Form Type if changed, but don't restore Form Type if
"RTN","IBCCC2",204,0)
 ;   creating CMS-1500 claim from CTCOPY1^IBCCCB
"RTN","IBCCC2",205,0)
 I $G(IBCTCOPY)'=1,IBFRMTYP'=$P($G(^DGCR(399,IBIFN,0)),U,19) N DA,DIE,DR S DA=IBIFN,DIE="^DGCR(399,",DR=".19////"_IBFRMTYP D ^DIE
"RTN","IBCCC2",206,0)
 ;
"RTN","IBCCC2",207,0)
 ; Restore Claim MRA Status field since triggers in fields 101 & 102
"RTN","IBCCC2",208,0)
 ;   will overwrite the correct value when processing the MRA/EOB.
"RTN","IBCCC2",209,0)
 ; If we're processing the MRA/EOB, then a valid MRA has been received.
"RTN","IBCCC2",210,0)
 I $G(IBPRCOB) N DA,DIE,DR S DA=IBIFN,DIE="^DGCR(399,",DR="24////C" D ^DIE
"RTN","IBCCC2",211,0)
 ;
"RTN","IBCCC2",212,0)
 ; Only if cloning, then restore Taxonomies in fields 243 and 244 and 252.
"RTN","IBCCC2",213,0)
 I '$G(IBINS),'$G(IBPRCOB) D
"RTN","IBCCC2",214,0)
 . S I=$P($G(IBND("U3")),U,2)
"RTN","IBCCC2",215,0)
 . I I'=$P($G(^DGCR(399,IBIFN,"U3")),U,2) D
"RTN","IBCCC2",216,0)
 .. N DA,DIE,DR S DA=IBIFN,DIE="^DGCR(399,",DR="243////"_$S(I'="":I,1:"@") D ^DIE
"RTN","IBCCC2",217,0)
 . ;
"RTN","IBCCC2",218,0)
 . S I=$P($G(IBND("U3")),U,3)
"RTN","IBCCC2",219,0)
 . I I'=$P($G(^DGCR(399,IBIFN,"U3")),U,3) D
"RTN","IBCCC2",220,0)
 .. N DA,DIE,DR S DA=IBIFN,DIE="^DGCR(399,",DR="244////"_$S(I'="":I,1:"@") D ^DIE
"RTN","IBCCC2",221,0)
 . ;
"RTN","IBCCC2",222,0)
 . S I=$P($G(IBND("U3")),U,11)
"RTN","IBCCC2",223,0)
 . I I'=$P($G(^DGCR(399,IBIFN,"U3")),U,11) D
"RTN","IBCCC2",224,0)
 .. N DA,DIE,DR S DA=IBIFN,DIE="^DGCR(399,",DR="252////"_$S(I'="":I,1:"@") D ^DIE
"RTN","IBCCC2",225,0)
 . Q
"RTN","IBCCC2",226,0)
 ;
"RTN","IBCCC2",227,0)
 ; Restore Taxonomies in field .15 in sub-file 399.0222.
"RTN","IBCCC2",228,0)
 S IBTAXLST=0 F  S IBTAXLST=$O(IBTAXLST(IBTAXLST)) Q:'IBTAXLST  D
"RTN","IBCCC2",229,0)
 . S I=IBTAXLST(IBTAXLST)
"RTN","IBCCC2",230,0)
 . I I=$P($G(^DGCR(399,IBIFN,"PRV",IBTAXLST,0)),U,15) Q  ; No change
"RTN","IBCCC2",231,0)
 . N DA,DIE,DR
"RTN","IBCCC2",232,0)
 . S DA(1)=IBIFN,DA=IBTAXLST
"RTN","IBCCC2",233,0)
 . S DIE="^DGCR(399,"_DA(1)_",""PRV"",",DR=".15////"_$S(I'="":I,1:"@")
"RTN","IBCCC2",234,0)
 . D ^DIE
"RTN","IBCCC2",235,0)
 . Q
"RTN","IBCCC2",236,0)
 ;
"RTN","IBCCC2",237,0)
 K IBCOB("TX")
"RTN","IBCCC2",238,0)
 Q
"RTN","IBCCC2",239,0)
 ;
"RTN","IBCCCB")
0^61^B88589489^B81507982
"RTN","IBCCCB",1,0)
IBCCCB ;ALB/ARH - COPY BILL FOR COB ;2/13/06 10:46am
"RTN","IBCCCB",2,0)
 ;;2.0;INTEGRATED BILLING;**80,106,51,151,137,182,155,323,436,432**;21-MAR-94;Build 192
"RTN","IBCCCB",3,0)
 ;;Per VHA Directive 2004-38, this routine should not be modified.
"RTN","IBCCCB",4,0)
 ;
"RTN","IBCCCB",5,0)
 ; Copy bill for COB w/out cancelling, update some flds
"RTN","IBCCCB",6,0)
 ; Primary->Secondary->Tertiary
"RTN","IBCCCB",7,0)
ASK ;
"RTN","IBCCCB",8,0)
 S IBCBCOPY=1 ; flag that copy function entered thru Copy COB option
"RTN","IBCCCB",9,0)
 ;
"RTN","IBCCCB",10,0)
 D KVAR S IBCAN=2,IBU="UNSPECIFIED"
"RTN","IBCCCB",11,0)
 ;
"RTN","IBCCCB",12,0)
 S IBX=$$PB^IBJTU2 S:+IBX=2 IBIFN=$P(IBX,U,2) I +IBX=1 S DFN=$P(IBX,U,2),IBV=1,IBAC=5 D DATE^IBCB
"RTN","IBCCCB",13,0)
 I '$G(IBIFN) G EXIT
"RTN","IBCCCB",14,0)
 ;
"RTN","IBCCCB",15,0)
 ; IB*2.0*432 Restrict access to only allow claims that are NOT on the new CBW Worklist
"RTN","IBCCCB",16,0)
 I $P($G(^DGCR(399,IBIFN,"S1")),U,7)=1,$G(IBMRANOT)'=1 D  G ASK
"RTN","IBCCCB",17,0)
 . W !!?4,"This bill appears on the CBW Management Work List.  Please use the"
"RTN","IBCCCB",18,0)
 . W !?4,"'CBW Management Menu' options for all processing related to this bill."
"RTN","IBCCCB",19,0)
 . Q
"RTN","IBCCCB",20,0)
 ;
"RTN","IBCCCB",21,0)
 ; Restrict access to this process for REQUEST MRA bills in 2 Cases:
"RTN","IBCCCB",22,0)
 ; 1. No MRA EOB's on File for bill
"RTN","IBCCCB",23,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)=2,'$$CHK^IBCEMU1(IBIFN) D  G ASK
"RTN","IBCCCB",24,0)
 . W !!?4,"This bill is in a status of REQUEST MRA and it has No MRA EOB's"
"RTN","IBCCCB",25,0)
 . W !?4,"on file.  Access to this bill is restricted."
"RTN","IBCCCB",26,0)
 ;
"RTN","IBCCCB",27,0)
 ; 2. At least one MRA EOB appears on the MRA management worklist
"RTN","IBCCCB",28,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)=2,$$MRAWL^IBCEMU2(IBIFN) D  G ASK
"RTN","IBCCCB",29,0)
 . W !!?4,"This bill is in a status of REQUEST MRA and it does appear on the"
"RTN","IBCCCB",30,0)
 . W !?4,"MRA Management Work List.  Please use the 'MRA Management Menu' options"
"RTN","IBCCCB",31,0)
 . W !?4,"for all processing related to this bill."
"RTN","IBCCCB",32,0)
 . Q
"RTN","IBCCCB",33,0)
 ;
"RTN","IBCCCB",34,0)
 ; If MRA is Activated and bill is in Entered/Not Reviewed status and current insurance Co. is WNR -->
"RTN","IBCCCB",35,0)
 ; ask if user wants to continue
"RTN","IBCCCB",36,0)
 I $$EDIACTV^IBCEF4(2),$P($G(^DGCR(399,IBIFN,0)),U,13)=1,$$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN)) D  I 'Y G ASK
"RTN","IBCCCB",37,0)
 . W !!?4,"This bill is in a status of ENTERED/NOT REVIEWED and current payer is "
"RTN","IBCCCB",38,0)
 . W !?4,"MEDICARE (WNR). No MRA has been requested for this bill."
"RTN","IBCCCB",39,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("A")="    Are you sure you want to continue to process this bill?: "
"RTN","IBCCCB",40,0)
 . D ^DIR K DIR
"RTN","IBCCCB",41,0)
 ;
"RTN","IBCCCB",42,0)
 ; Display related bills
"RTN","IBCCCB",43,0)
 D DSPRB^IBCCCB0(IBIFN)
"RTN","IBCCCB",44,0)
 ;
"RTN","IBCCCB",45,0)
CHKB ; Entrypoint-COB processing via EDI's COB Mgmt
"RTN","IBCCCB",46,0)
 ; Ask if final EOB was received for previous bill
"RTN","IBCCCB",47,0)
 I '$$FINALEOB^IBCCCB0(IBIFN) S IBSECHK=1
"RTN","IBCCCB",48,0)
 I $G(IBSECHK)=1,$$MCRONBIL^IBEFUNC(IBIFN) G EXIT
"RTN","IBCCCB",49,0)
 ;
"RTN","IBCCCB",50,0)
 ; Warn if previous bill not at least authorized
"RTN","IBCCCB",51,0)
 I '$$MCRONBIL^IBEFUNC(IBIFN) I '$$COBOK^IBCCCB0(IBIFN) G EXIT
"RTN","IBCCCB",52,0)
 ;
"RTN","IBCCCB",53,0)
CHKB1 ; Entry point for Automatic/Silent COB Processing.
"RTN","IBCCCB",54,0)
 ; No writes or reads can occur from this point forward if variable
"RTN","IBCCCB",55,0)
 ; IBSILENT=1.  Any and all error messages should be processed with
"RTN","IBCCCB",56,0)
 ; the ERROR procedure below.
"RTN","IBCCCB",57,0)
 ;
"RTN","IBCCCB",58,0)
 S IBX=$G(^DGCR(399,+IBIFN,0)),DFN=$P(IBX,U,2),IBDT=$P(IBX,U,3)\1,IBER=""
"RTN","IBCCCB",59,0)
 I IBCAN>1 D NOPTF^IBCB2 I 'IBAC1 D NOPTF1^IBCB2 G ASK1
"RTN","IBCCCB",60,0)
 ;
"RTN","IBCCCB",61,0)
 F IBI=0,"S","U1","M","MP","M1" S IB(IBI)=$G(^DGCR(399,IBIFN,IBI))
"RTN","IBCCCB",62,0)
 I IB(0)="" S IBER="Invalid Bill Number" D ERROR G ASK1
"RTN","IBCCCB",63,0)
 ;
"RTN","IBCCCB",64,0)
 ; check to see if the bill has been cancelled
"RTN","IBCCCB",65,0)
 I $P(IB("S"),U,16),$P(IB("S"),U,17) D  G ASK1
"RTN","IBCCCB",66,0)
 . N WHO
"RTN","IBCCCB",67,0)
 . S IBER="This bill was cancelled on "
"RTN","IBCCCB",68,0)
 . S IBER=IBER_$$FMTE^XLFDT($P(IB("S"),U,17),"1Z")_" by "
"RTN","IBCCCB",69,0)
 . S WHO="UNSPECIFIED"
"RTN","IBCCCB",70,0)
 . I $P(IB("S"),U,18) S WHO=$P($G(^VA(200,$P(IB("S"),U,18),0)),U,1)
"RTN","IBCCCB",71,0)
 . S IBER=IBER_WHO_"."
"RTN","IBCCCB",72,0)
 . D ERROR
"RTN","IBCCCB",73,0)
 . Q
"RTN","IBCCCB",74,0)
 ;
"RTN","IBCCCB",75,0)
 S IBCOB=$$COB^IBCEF(IBIFN),IBCOBN=$TR(IBCOB,"PSTA","12")
"RTN","IBCCCB",76,0)
 S IBMRAIO=+$$CURR^IBCEF2(IBIFN),IBMRAO=$$MCRWNR^IBEFUNC(IBMRAIO)
"RTN","IBCCCB",77,0)
 S IBNMOLD=$S(IBCOB="P":"Primary",IBCOB="S":"Secondary",IBCOB="T":"Tertiary",IBCOB="A":"Patient",1:"")_$S(IBMRAO:"-MRA Only",1:"")
"RTN","IBCCCB",78,0)
 S IBINSOLD=$G(^DIC(36,$S(IB("MP"):+IB("MP"),IBMRAO:IBMRAIO,1:0),0))
"RTN","IBCCCB",79,0)
 ;
"RTN","IBCCCB",80,0)
NEXTP ; If current bill=MEDICARE WNR and valid 'next payer', use same
"RTN","IBCCCB",81,0)
 ;  bill for new payer
"RTN","IBCCCB",82,0)
 ; If next valid 'payer' is ins co or MEDICARE WNR, create new bill
"RTN","IBCCCB",83,0)
 S IBCOBN=IBCOBN+1,IBNM=$S(IBCOBN=2:"Secondary Payer",IBCOBN=3:"Tertiary Payer",1:"")
"RTN","IBCCCB",84,0)
 ;
"RTN","IBCCCB",85,0)
 I IBNM="" S IBER=$P(IB(0),U,1)_" is a "_IBNMOLD_" bill, there is no next bill in the series." D ERROR G ASK1
"RTN","IBCCCB",86,0)
 ;
"RTN","IBCCCB",87,0)
 S IBX=+$P(IB("M1"),U,(4+IBCOBN)),IBY=$G(^DGCR(399,+IBX,0)),IBCOBIL(+IBIFN)=""
"RTN","IBCCCB",88,0)
 ;
"RTN","IBCCCB",89,0)
 I $P(IBY,U,13)=7 S IBER="The "_$P(IBNM," ",1)_" bill "_$P(IBY,U,1)_" has been cancelled." D ERROR S IBX=""
"RTN","IBCCCB",90,0)
 ;
"RTN","IBCCCB",91,0)
 I +IBX,$D(IBCOBIL(+IBX)) S IBER="Next bill in series can not be determined." D ERROR G ASK1
"RTN","IBCCCB",92,0)
 I +IBX S IBER=$P(IBNM," ",1)_" bill already defined for this series: "_$P(IBY,U,1) D ERROR S IBIFN=IBX G ASK1
"RTN","IBCCCB",93,0)
 ;
"RTN","IBCCCB",94,0)
 S IBINSN=$P(IB("M"),U,IBCOBN) I 'IBINSN S IBER="There is no "_IBNM_" for "_$P(IB(0),U,1)_"." D ERROR G ASK1
"RTN","IBCCCB",95,0)
 S IBINS=$G(^DIC(36,+IBINSN,0)) I IBINS="" S IBER="The "_IBNM_" for "_$P(IB(0),U,1)_" is not a valid Insurance Co." D ERROR G ASK1
"RTN","IBCCCB",96,0)
 ;
"RTN","IBCCCB",97,0)
 S IBMRA=0
"RTN","IBCCCB",98,0)
 I $P(IBINS,U,2)="N" S IBQ=0 D  G:IBQ NEXTP
"RTN","IBCCCB",99,0)
 . I $$MCRWNR^IBEFUNC(IBINSN) D  Q
"RTN","IBCCCB",100,0)
 .. ; Check if a valid tert ins if MCR WNR secondary
"RTN","IBCCCB",101,0)
 .. I IBCOBN'>2 D
"RTN","IBCCCB",102,0)
 ... N Z
"RTN","IBCCCB",103,0)
 ... S Z=+$P(IB("M"),U,IBCOBN+1)
"RTN","IBCCCB",104,0)
 ... I Z,$D(^DIC(36,Z,0)),$P(^(0),U,2)'="N" S IBMRA=1,IBNM=$P(IBNM," ")_"-MRA.Only"
"RTN","IBCCCB",105,0)
 .. I 'IBMRA S IBER="MEDICARE will not reimburse and no further valid insurance for bill" D ERROR S IBQ=1
"RTN","IBCCCB",106,0)
 . S IBER=$P(IB(0),U,1)_" "_IBNM_", "_$P(IBINS,U,1)_", will not Reimburse" D ERROR S IBQ=1
"RTN","IBCCCB",107,0)
 ;
"RTN","IBCCCB",108,0)
 ; If processing in silent mode, skip over the following reads
"RTN","IBCCCB",109,0)
 I $G(IBSILENT) G SKIP
"RTN","IBCCCB",110,0)
 ;
"RTN","IBCCCB",111,0)
 W !!
"RTN","IBCCCB",112,0)
 S DIR("?")="Enter Yes to "_$S('$G(IBMRAO):"create a new bill in the bill series for this care.  The new bill will be the "_$P(IBNM," ")_" bill ",1:"enter the MRA information and change the payer to the "_$P($P(IBNM,"-")," ")_" payer ")
"RTN","IBCCCB",113,0)
 S DIR("?")=DIR("?")_$S('IBMRA:"with the "_IBNM_" responsible for payment.",1:"and will request an MRA from MEDICARE.")
"RTN","IBCCCB",114,0)
 S DIR(0)="YO",DIR("A")=$S('$G(IBMRAO):"Copy "_$P(IB(0),U,1)_" for a bill to the ",1:"Change payer on bill "_$P(IB(0),U,1)_" to ")_IBNM_", "_$P(IBINS,U,1) D ^DIR K DIR I Y'=1 S IBSECHK=1 G ASK1
"RTN","IBCCCB",115,0)
 ;
"RTN","IBCCCB",116,0)
 W !
"RTN","IBCCCB",117,0)
 S IBQ=0
"RTN","IBCCCB",118,0)
 I '$G(IBMRAO) D  G:IBQ ASK1
"RTN","IBCCCB",119,0)
 . N Z
"RTN","IBCCCB",120,0)
 . S DIR("?")="Enter the amount of the payment from the payer of the "_IBNMOLD_" bill."
"RTN","IBCCCB",121,0)
 . S DIR("?")=DIR("?")_"  This will be added to the new bill as a prior payment and subtracted from the charges due for the new bill."
"RTN","IBCCCB",122,0)
 . S DIR("A")="Prior Payment from "_$P(IB(0),U,1)_" "_IBNMOLD_" Payer, "_$P(IBINSOLD,U,1)_": "
"RTN","IBCCCB",123,0)
 . S Z=$$EOBTOT^IBCEU1(IBIFN,$$COBN^IBCEF(IBIFN))
"RTN","IBCCCB",124,0)
 . S:Z DIR("B")=Z
"RTN","IBCCCB",125,0)
 . S DIR(0)="NOA^0:99999999:2"
"RTN","IBCCCB",126,0)
 . D ^DIR K DIR I Y=""!$D(DIRUT) S IBQ=1
"RTN","IBCCCB",127,0)
 . K IBCOB
"RTN","IBCCCB",128,0)
 . S IBCOB("U2",IBCOBN+2)=Y
"RTN","IBCCCB",129,0)
 . Q
"RTN","IBCCCB",130,0)
 ;
"RTN","IBCCCB",131,0)
SKIP ; Jump here if skipping over the preceeding reads
"RTN","IBCCCB",132,0)
 ;
"RTN","IBCCCB",133,0)
 ;** start IB*2*436 **
"RTN","IBCCCB",134,0)
 ;
"RTN","IBCCCB",135,0)
 ;IB2INSNO = Secondary Insurance Number - IEN 
"RTN","IBCCCB",136,0)
 ;IBGRPNO  = Group Insurance Number     - IEN 
"RTN","IBCCCB",137,0)
 ;IBTYNAME = TYPE OF PLAN name          - for example: MEDIGAP (SUPPLEMENTAL)
"RTN","IBCCCB",138,0)
 ;IBTYPLAN = TYPE OF PLAN               - IEN
"RTN","IBCCCB",139,0)
 ;IBPNCAT  = Plan category              - Part A or B
"RTN","IBCCCB",140,0)
 ;IBMDGFL  = Medigap Supplemental Flag
"RTN","IBCCCB",141,0)
 ;IBFRMTYP = Form type
"RTN","IBCCCB",142,0)
 ;
"RTN","IBCCCB",143,0)
 N IB2INSNO,IBGRPNO,IBMDGPFL,IBTYNAME,IBTYPLAN,IBINPAT,IBPNCAT,IBFRMTYP
"RTN","IBCCCB",144,0)
 S (IB2INSNO,IBGRPNO,IBTYNAME,IBTYPLAN,IBPNCAT,IBFRMTYP)=""
"RTN","IBCCCB",145,0)
 S IBMDGPFL=0
"RTN","IBCCCB",146,0)
 ;
"RTN","IBCCCB",147,0)
 ; Get secondary insurance information
"RTN","IBCCCB",148,0)
 I $D(^DGCR(399,IBIFN,"M")) D
"RTN","IBCCCB",149,0)
 . S IB2INSNO=+$P($G(^DGCR(399,IBIFN,"M")),U,2)  ; secondary insurance
"RTN","IBCCCB",150,0)
 . S IBGRPNO=+$P($G(^DGCR(399,IBIFN,"I2")),U,18) ; group plan number
"RTN","IBCCCB",151,0)
 . S IBTYPLAN=+$P($G(^IBA(355.3,IBGRPNO,0)),U,9) ; type of plan - IEN
"RTN","IBCCCB",152,0)
 . I (IBTYPLAN=0)!(IB2INSNO=0)!(IBGRPNO=0) Q
"RTN","IBCCCB",153,0)
 . S IBTYNAME=$P($G(^IBE(355.1,IBTYPLAN,0)),U,1) ; type of plan - name
"RTN","IBCCCB",154,0)
 . I IBTYNAME="MEDIGAP (SUPPLEMENTAL)" S IBMDGPFL=1 Q 
"RTN","IBCCCB",155,0)
 ;
"RTN","IBCCCB",156,0)
 S IBFRMTYP=$P($G(^DGCR(399,IBIFN,0)),U,19)  ; Form Type 2=1500, 3=UB
"RTN","IBCCCB",157,0)
 S IBPNCAT=$S(IBFRMTYP=2:"B",1:"A")    ; plan category - PART A or B
"RTN","IBCCCB",158,0)
 ;
"RTN","IBCCCB",159,0)
 ;
"RTN","IBCCCB",160,0)
 ; If payer is Medicare (WNR) update payer sequence and quit
"RTN","IBCCCB",161,0)
 I IBMRAO!($G(IBSTSM)=1) D  I $G(IBSTSM)'=1 G END
"RTN","IBCCCB",162,0)
 . N IBPRTOT,IBTOTCHG,IBPTRESP
"RTN","IBCCCB",163,0)
 . S IBTOTCHG=0
"RTN","IBCCCB",164,0)
 . ;
"RTN","IBCCCB",165,0)
 . ; Get Total Charges from BILLS/CLAIMS (#399) file
"RTN","IBCCCB",166,0)
 . S IBTOTCHG=$P($G(^DGCR(399,IBIFN,"U1")),U,1)
"RTN","IBCCCB",167,0)
 . ;
"RTN","IBCCCB",168,0)
 . ; Calculate Patient Responsibility for Bill
"RTN","IBCCCB",169,0)
 . S IBPTRESP=$$PREOBTOT^IBCEU0(IBIFN,$G(IBSTSM))
"RTN","IBCCCB",170,0)
 . S IBINPAT=$$INPAT^IBCEF(IBIFN)     ;Inpat/Outpat Flag
"RTN","IBCCCB",171,0)
 . ;
"RTN","IBCCCB",172,0)
 . ; Process inpatients (see IB*2*436 RSD/flow chart for details)
"RTN","IBCCCB",173,0)
 . I IBINPAT,$G(IBSTSM)'=1 D
"RTN","IBCCCB",174,0)
 . . I IBPNCAT="A" D  ; Plan type is A  (institutional claim)
"RTN","IBCCCB",175,0)
 . . . ;patient responsibility
"RTN","IBCCCB",176,0)
 . . . S IBPRTOT=IBTOTCHG-IBPTRESP
"RTN","IBCCCB",177,0)
 . . I IBPNCAT'="A" D   ; Other plan type   (Part B, professional claim)
"RTN","IBCCCB",178,0)
 . . . I 'IBMDGPFL D  ; Not MEDIGAP (SUPPLEMENTAL)
"RTN","IBCCCB",179,0)
 . . . . ;patient responsibility + Medicare unallowed amount (aka Medicare contr. adj.)
"RTN","IBCCCB",180,0)
 . . . . S IBPRTOT=IBTOTCHG-(IBPTRESP+$$MRACALC2^IBCEMU2(IBIFN))
"RTN","IBCCCB",181,0)
 . . . I IBMDGPFL D  ; MEDIGAP (SUPPLEMENTAL)
"RTN","IBCCCB",182,0)
 . . . . ;patient responsibility
"RTN","IBCCCB",183,0)
 . . . . S IBPRTOT=IBTOTCHG-IBPTRESP
"RTN","IBCCCB",184,0)
 . ;
"RTN","IBCCCB",185,0)
 . ; Process outpatients (see IB*2*436 RSD/flow chart for details)
"RTN","IBCCCB",186,0)
 . I 'IBINPAT,$G(IBSTSM)'=1  D  ; Outpatient processing
"RTN","IBCCCB",187,0)
 . . I IBMDGPFL D  ; MEDIGAP (SUPPLEMENTAL)
"RTN","IBCCCB",188,0)
 . . . ;patient responsibility
"RTN","IBCCCB",189,0)
 . . . S IBPRTOT=IBTOTCHG-IBPTRESP
"RTN","IBCCCB",190,0)
 . . I 'IBMDGPFL  D  ; Not MEDIGAP (SUPPLEMENTAL) 
"RTN","IBCCCB",191,0)
 . . . ;patient responsibility + Medicare unallowed amount (aka Medicare contr. adj.)
"RTN","IBCCCB",192,0)
 . . . S IBPRTOT=IBTOTCHG-(IBPTRESP+$$MRACALC2^IBCEMU2(IBIFN))
"RTN","IBCCCB",193,0)
 . ;
"RTN","IBCCCB",194,0)
 . ; ** End IB*2*436 **
"RTN","IBCCCB",195,0)
 . ;
"RTN","IBCCCB",196,0)
 . S:$G(IBSTSM)=1 IBPRTOT=$$EOBTOT^IBCEU1(IBIFN,$$COBN^IBCEF(IBIFN)) ;Pat Resp for non-medicare
"RTN","IBCCCB",197,0)
 . I IBPRTOT<0 S IBPRTOT=0      ; don't allow negative prior payment or offset
"RTN","IBCCCB",198,0)
 . S IBCOB("U2",IBCOBN+2)=IBPRTOT
"RTN","IBCCCB",199,0)
 . D:$G(IBSTSM)'=1 COBCHG^IBCCC2(IBIFN,IBMRAIO,.IBCOB)
"RTN","IBCCCB",200,0)
 . D STAT^IBCEMU2(IBIFN,1.5,1)     ; mra eob status update
"RTN","IBCCCB",201,0)
 . I $G(IBSILENT) S IBERRMSG=""
"RTN","IBCCCB",202,0)
 . Q
"RTN","IBCCCB",203,0)
 ;
"RTN","IBCCCB",204,0)
 ; We should NOT get to here in silent mode .... just in case
"RTN","IBCCCB",205,0)
 I $G(IBSILENT),$G(IBSTSM)'=1 G END    ; currently only MCRWNR in silent mode
"RTN","IBCCCB",206,0)
 ;
"RTN","IBCCCB",207,0)
 ; Payer is not Medicare (WNR) - Perform additional steps
"RTN","IBCCCB",208,0)
 S IBCOB(0,15)=""
"RTN","IBCCCB",209,0)
 S IBCOB(0,21)=$S(IBCOBN=2:"S",IBCOBN=3:"T",1:"")
"RTN","IBCCCB",210,0)
 I IBCOB(0,21)="" G END
"RTN","IBCCCB",211,0)
 S IBCOB("M1",IBCOBN+3)=IBIFN
"RTN","IBCCCB",212,0)
 S IBIDS(.15)=IBIFN
"RTN","IBCCCB",213,0)
 D KVAR
"RTN","IBCCCB",214,0)
 G STEP2^IBCCC
"RTN","IBCCCB",215,0)
 ;
"RTN","IBCCCB",216,0)
END ;
"RTN","IBCCCB",217,0)
 Q
"RTN","IBCCCB",218,0)
 ;
"RTN","IBCCCB",219,0)
 ;
"RTN","IBCCCB",220,0)
ASK1 ; If entering thru EDI COB processing, don't ask for new bill, quit
"RTN","IBCCCB",221,0)
 I $G(IBCBASK) G EXIT
"RTN","IBCCCB",222,0)
 G ASK
"RTN","IBCCCB",223,0)
 ;
"RTN","IBCCCB",224,0)
ERROR ; Display/Save error message
"RTN","IBCCCB",225,0)
 I '$G(IBSILENT) W !,IBER,!
"RTN","IBCCCB",226,0)
 E  S IBERRMSG=IBER
"RTN","IBCCCB",227,0)
 S IBER=""
"RTN","IBCCCB",228,0)
 I $D(IBSECHK) S IBSECHK=1
"RTN","IBCCCB",229,0)
 Q
"RTN","IBCCCB",230,0)
 ;
"RTN","IBCCCB",231,0)
EXIT K IBCAN,IBCOB,IBU
"RTN","IBCCCB",232,0)
KVAR K IBX,IBY,IBI,IBIFN,DFN,IBDT,IB,IBCOBN,IBNMOLD,IBINSOLD,IBNM,IBINSN,IBINS,IBER,DIR,IBAC,IBAC1,IBV,X,Y,IBDATA,IBT,IBND0,DIRUT,IBCOBIL,IBMRA,IBMRAI,IBMRAO,IBMRAIO,IBCBCOPY
"RTN","IBCCCB",233,0)
 K ^UTILITY($J)
"RTN","IBCCCB",234,0)
 Q
"RTN","IBCCCB",235,0)
 ;
"RTN","IBCCCB",236,0)
DSPRB(IBIFN) ; display related bills
"RTN","IBCCCB",237,0)
 ;
"RTN","IBCCCB",238,0)
 D DSPRB^IBCCCB0(IBIFN) ; Code moved for size too big
"RTN","IBCCCB",239,0)
 Q
"RTN","IBCCCB",240,0)
 ;
"RTN","IBCCCB",241,0)
 ; ==============
"RTN","IBCCCB",242,0)
 ; 
"RTN","IBCCCB",243,0)
 ; Copy a bill for Reasonable Charges without cancelling it, update certain fields
"RTN","IBCCCB",244,0)
 ;
"RTN","IBCCCB",245,0)
 ; there is always both inpt inst (created first) and prof charges, always need both bills
"RTN","IBCCCB",246,0)
 ; there may be both outpt inst (created first) and prof charges, may not need both bills
"RTN","IBCCCB",247,0)
 ; if billing by episode rather than by day (current standard) then may need multiple prof bills per day
"RTN","IBCCCB",248,0)
 ; 
"RTN","IBCCCB",249,0)
 ; Inst bills are copied to create prof Bills automatically
"RTN","IBCCCB",250,0)
 ; Subsequent prof bills may be created if the user wants them
"RTN","IBCCCB",251,0)
 ;
"RTN","IBCCCB",252,0)
 ; Only the first bill in the COB series of bills should be copied for the next prof bill
"RTN","IBCCCB",253,0)
 ; The primary inst bill should be copied to get the secondary inst bill
"RTN","IBCCCB",254,0)
 ; The primary prof bill should be copied to get the secondary prof bill
"RTN","IBCCCB",255,0)
 ;
"RTN","IBCCCB",256,0)
CTCOPY(IBIFN,IBMRA) ; based on the type of bill, copy without cancelling
"RTN","IBCCCB",257,0)
 ; IBMRA = 1 if an MRA bill and copy for prof components is desired
"RTN","IBCCCB",258,0)
 ;
"RTN","IBCCCB",259,0)
 D CTCOPY^IBCCCB0(IBIFN,$G(IBMRA)) ;Moved due to routine size
"RTN","IBCCCB",260,0)
 Q
"RTN","IBCCCB",261,0)
 ;
"RTN","IBCCPT")
0^69^B86719137^B67101074
"RTN","IBCCPT",1,0)
IBCCPT ;ALB/LDB - MCCR OUTPATIENT VISITS LISTING CONT. ;29 MAY 90
"RTN","IBCCPT",2,0)
 ;;2.0;INTEGRATED BILLING;**55,62,52,91,106,125,51,148,174,182,245,266,260,339,432**;21-MAR-94;Build 192
"RTN","IBCCPT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCCPT",4,0)
 ;
"RTN","IBCCPT",5,0)
 ;MAP TO DGCRCPT
"RTN","IBCCPT",6,0)
 ;
"RTN","IBCCPT",7,0)
EN1(IBQUERY,IBHLP) ;
"RTN","IBCCPT",8,0)
 K DIR
"RTN","IBCCPT",9,0)
EN D:$D(DIR) HLP W @IOF S DGU=0 K DGCPT,^UTILITY($J) D VST(.IBQUERY)
"RTN","IBCCPT",10,0)
 D CHDR,WRNO
"RTN","IBCCPT",11,0)
 N ICPTVDT S ICPTVDT=$$BDATE^IBACSV($G(IBIFN)) ; Code Text Version
"RTN","IBCCPT",12,0)
 S (DGCNT,DGCNT1)=0 F  S DGCNT=$O(^UTILITY($J,"CPT-CNT",DGCNT)) Q:'DGCNT  S DGNOD=^(DGCNT),DGCPT=+DGNOD,DGDAT=$P(DGNOD,"^",2),DGBIL=$P(DGNOD,"^",3),DGASC=$P(DGNOD,"^",4),DGDIV=$P(DGNOD,"^",5),DGCNT1=DGCNT1+1 D CPRT I DGU="^" S DGCNT=DGCNT-1 Q
"RTN","IBCCPT",13,0)
 I DGU'="^" F Y=$Y:1:IOSL-6 W !
"RTN","IBCCPT",14,0)
OK1 K Y Q:'$D(^UTILITY($J,"CPT-CNT"))!($D(DIR))!($G(IBHLP))
"RTN","IBCCPT",15,0)
OK S DIR(0)="LAO^1:"_DGCNT1_"^K:X[""."" X",DIR("?")="^N DIR D EN1^IBCCPT(.IBQUERY,1)",DIR("A")="SELECT CPT CODE(S) TO INCLUDE IN THIS BILL: "
"RTN","IBCCPT",16,0)
 D ^DIR K DIR I 'Y D Q1^IBCOPV1 Q
"RTN","IBCCPT",17,0)
 S IBFT=+$P(^DGCR(399,IBIFN,0),"^",19)
"RTN","IBCCPT",18,0)
OK2 W !,"YOU HAVE SELECTED CPT CODE(S) NUMBERED-",$E(Y,1,$L(Y)-1),!,"IS THIS CORRECT" S %=1 D YN^DICN I %=-1 S IBOUT=1 D Q^IBCOPV1 Q
"RTN","IBCCPT",19,0)
 I +Y,'% W !,"Respond 'Y'es to include these codes in the bill.",!,"Respond 'N'o to reselect." G OK2
"RTN","IBCCPT",20,0)
 I +Y,%=2 G OK
"RTN","IBCCPT",21,0)
 ;
"RTN","IBCCPT",22,0)
FILE S DGCPT1=Y,(DGCNT,DGCNT2)=0
"RTN","IBCCPT",23,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR=".09///5" D ^DIE K DR,DA,DIE
"RTN","IBCCPT",24,0)
 F I9=1:1 S I1=$P(DGCPT1,",",I9) Q:'I1  I $D(^UTILITY($J,"CPT-CNT",I1)) S DGNOD=^(I1),DGNOD("DX")=$G(^(I1,"DX")) D FILE1
"RTN","IBCCPT",25,0)
 D Q1^IBCOPV1 Q
"RTN","IBCCPT",26,0)
 ;
"RTN","IBCCPT",27,0)
FILE1 ;  file procedures, if BASC, only for 1 visit date
"RTN","IBCCPT",28,0)
 N IBDICSAV  ; IB*2.0*432 BI
"RTN","IBCCPT",29,0)
 K DGNOADD S (X,DINUM)=$P(DGNOD,"^",2) D VFILE1^IBCOPV1 K DINUM,X
"RTN","IBCCPT",30,0)
 N IBCPTNM S IBCPTNM=$$CPT^ICPTCOD(+DGNOD,+$P(DGNOD,U,2))
"RTN","IBCCPT",31,0)
 I $D(DGNOADD) W !?10,"Can't add Amb. Surg. ",$P(IBCPTNM,U,2)," without visit date!" Q  ;don't add cpt for date that can't go on bill
"RTN","IBCCPT",32,0)
 I IBFT'=2,+$P(DGNOD,"^",4),$$TOMANY($P(DGNOD,"^",2)) W !?10,"Can't add Billable Amb. Surg. ",$P(IBCPTNM,U,2)," when more than one visit date!",*7 Q
"RTN","IBCCPT",33,0)
 D DSPPRC(IBCPTNM,DGNOD,$G(DGNOD("DX")))
"RTN","IBCCPT",34,0)
 ;
"RTN","IBCCPT",35,0)
 S:'$D(^DGCR(399,IBIFN,"CP",0)) DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCCPT",36,0)
 ; IB*2.0*432 BI
"RTN","IBCCPT",37,0)
 ;S DLAYGO=399,DA(1)=IBIFN,DIC="^DGCR(399,"_DA(1)_",""CP"",",DIC(0)="L",X=+DGNOD_";ICPT(" K DD,DO D FILE^DICN S (DA,IBPROCP)=+Y K DO,DD,DLAYGO,DIC("P")
"RTN","IBCCPT",38,0)
 S DLAYGO=399,DA(1)=IBIFN,(DIC,IBDICSAV)="^DGCR(399,"_DA(1)_",""CP"",",DIC(0)="L",X=+DGNOD_";ICPT(" K DD,DO D FILE^DICN S (DA,IBPROCP)=+Y K DO,DD,DLAYGO,DIC("P")
"RTN","IBCCPT",39,0)
 S DR="1///"_$P(DGNOD,"^",2)
"RTN","IBCCPT",40,0)
 I +$P(DGNOD,"^",8) S DR=DR_";18///`"_+$P(DGNOD,"^",8)
"RTN","IBCCPT",41,0)
 I +$P(DGNOD,"^",9) S DR=DR_";6///`"_+$P(DGNOD,"^",9)
"RTN","IBCCPT",42,0)
 I +$P(DGNOD,"^",5) S DR=DR_";5////"_+$P(DGNOD,"^",5)
"RTN","IBCCPT",43,0)
 I +$P(DGNOD,"^",11) S DR=DR_";20////"_+$P(DGNOD,"^",11)
"RTN","IBCCPT",44,0)
 ;
"RTN","IBCCPT",45,0)
 ; file assoc dx if exists from pce
"RTN","IBCCPT",46,0)
 D:$G(DGNOD("DX")) ADDDX^IBCCPT1(IBIFN,IBPROCP,DGNOD("DX"),.DR)
"RTN","IBCCPT",47,0)
 ;
"RTN","IBCCPT",48,0)
 S DIC=IBDICSAV  ; IB*2.0*432 BI
"RTN","IBCCPT",49,0)
 S DIE=DIC D ^DIE
"RTN","IBCCPT",50,0)
 D:$P(DGNOD,U,10)'="" ADDMOD(IBIFN,IBPROCP,$P(DGNOD,U,10))
"RTN","IBCCPT",51,0)
 ;
"RTN","IBCCPT",52,0)
 K DR
"RTN","IBCCPT",53,0)
 S DR="16"
"RTN","IBCCPT",54,0)
 ;
"RTN","IBCCPT",55,0)
 ; DEM;432 - $P(DGNOD,"^",8) is the provider pointer for
"RTN","IBCCPT",56,0)
 ;           this outpatient procedure, and if present will
"RTN","IBCCPT",57,0)
 ;           be the default RENDERING PROVIDER for this
"RTN","IBCCPT",58,0)
 ;           procedure if the RENDERING PROVIDER doesn't
"RTN","IBCCPT",59,0)
 ;           already exist for this procedure in file 399.0404.
"RTN","IBCCPT",60,0)
 ;
"RTN","IBCCPT",61,0)
 ; D:$P(DGNOD,"^",8)  ; DEM;432 - Outpatient procedure has provider.
"RTN","IBCCPT",62,0)
 S DIC=IBDICSAV  ; IB*2.0*432 BI
"RTN","IBCCPT",63,0)
 S DIE=DIC D ^DIE  ; DEM;432 - DR=16 (CPT MODIFIER SEQUENCE).
"RTN","IBCCPT",64,0)
 K DR
"RTN","IBCCPT",65,0)
 S DR=""
"RTN","IBCCPT",66,0)
 Q:$D(^DGCR(399,DA(1),"CP",DA,"LNPRV","B","RENDERING"))  ; DEM;432 - Quit if RENDERING PROVIDER already exist in 399.0404 for this procedure.
"RTN","IBCCPT",67,0)
 S IBLNPRV("IBCCPT")=$P($G(^VA(200,+$P(DGNOD,U,8),0)),U,1)  ; DEM;432 - Flag for call to routine EN^IBCU7B.
"RTN","IBCCPT",68,0)
 D EN^IBCU7B ; DEM;432 - Call to line level provider user input.
"RTN","IBCCPT",69,0)
 K IBLNPRV("IBCCPT")  ; DEM;432 - Kill flag after return from EN^IBCU7B.
"RTN","IBCCPT",70,0)
 S DA=IBPROCP  ; DEM;432 - DA=IBPROCP before call to EN^IBCU7B.
"RTN","IBCCPT",71,0)
 K DR
"RTN","IBCCPT",72,0)
 ;
"RTN","IBCCPT",73,0)
 I IBFT=3,'$$INPAT^IBCEF(IBIFN) D
"RTN","IBCCPT",74,0)
 . S DR=""
"RTN","IBCCPT",75,0)
 . D ATTACH^IBCU7
"RTN","IBCCPT",76,0)
 . K DR
"RTN","IBCCPT",77,0)
 ;
"RTN","IBCCPT",78,0)
 S DR=""
"RTN","IBCCPT",79,0)
 ;
"RTN","IBCCPT",80,0)
 I '$P(DGNOD,"^",8) S DR=$S(DR'="":DR_";18",1:18)  ; DEM;432 - Added $SELECT since DR can equal field or NULL.
"RTN","IBCCPT",81,0)
 I '$P(DGNOD,"^",9) S DR=$S(DR'="":DR_";6",1:6)  ; DEM;432 - Added $SELECT since DR can equal field or NULL.
"RTN","IBCCPT",82,0)
 I '$P(DGNOD,"^",5) S DR=$S(DR'="":DR_";5",1:5)  ; DEM;432 - Added $SELECT since DR can equal field or NULL.
"RTN","IBCCPT",83,0)
 S:IBFT=2 DR=$S(DR'="":DR_";8;9;17//NO",1:"8;9;17//NO")  ; DEM;432 - Added $SELECT since DR can equal field or NULL.
"RTN","IBCCPT",84,0)
 S DIC=IBDICSAV  ; IB*2.0*432 BI
"RTN","IBCCPT",85,0)
 I DR'="" S DIE=DIC D ^DIE  ; DEM;432 - Added contion of DR'="".
"RTN","IBCCPT",86,0)
 S DR=$$SPCUNIT^IBCU7(IBIFN,IBPROCP) I DR'="" D ^DIE ; miles/minutes/hours
"RTN","IBCCPT",87,0)
 ;
"RTN","IBCCPT",88,0)
 ; DSS QuadraMed Interface: CPT Sequence and Diagnosis Linkage for Single CPT
"RTN","IBCCPT",89,0)
 I $$QMED^IBCU1("DX^VEJDIBE1",IBIFN) D DX^VEJDIBE1(IBIFN,IBPROCP)
"RTN","IBCCPT",90,0)
 ;
"RTN","IBCCPT",91,0)
 Q:$D(Y)
"RTN","IBCCPT",92,0)
 D DX^IBCU72(IBIFN,IBPROCP):IBFT=2
"RTN","IBCCPT",93,0)
 I IBFT=2 S X=$$ADDTNL^IBCU7(IBIFN,.DA)
"RTN","IBCCPT",94,0)
 L ^DGCR(399,IBIFN):1
"RTN","IBCCPT",95,0)
 K DIE,DIC,DR,DA,IBPROCP
"RTN","IBCCPT",96,0)
 Q
"RTN","IBCCPT",97,0)
 ;
"RTN","IBCCPT",98,0)
CPRT D:$Y+6>IOSL SCR Q:DGU="^"
"RTN","IBCCPT",99,0)
 N IBCPTNM,IBNBM,IBMODS,J,IBZ,IBDATE
"RTN","IBCCPT",100,0)
 S IBDATE=$$BDATE^IBACSV($G(IBIFN))
"RTN","IBCCPT",101,0)
 S IBNBM="",IBCPTNM=$$CPT^ICPTCOD(DGCPT,IBDATE) Q:IBCPTNM'>0
"RTN","IBCCPT",102,0)
 W !,DGCNT,")",?5,$P(IBCPTNM,U,2),?13,$E($P(IBCPTNM,U,3),1,24),?39,$E($P($G(^SC(+$P(DGNOD,U,9),0)),U,1),1,15),?56,$$FMTE^XLFDT(DGDAT,2)
"RTN","IBCCPT",103,0)
 I +DGBIL,+$P($G(DGNOD),U,6) S IBNBM="  *ON BILL/"_$E($P(DGNOD,U,7),1,4)_"*"
"RTN","IBCCPT",104,0)
 I IBNBM="",DGBIL S IBNBM="  *ON THIS BILL*"
"RTN","IBCCPT",105,0)
 I IBNBM="",+$P($G(DGNOD),U,6) S IBNBM="  "_$E($P(DGNOD,U,7),1,12)
"RTN","IBCCPT",106,0)
 W ?64,IBNBM
"RTN","IBCCPT",107,0)
 ;
"RTN","IBCCPT",108,0)
 S IBMODS=$P($G(DGNOD),U,10) F J=1:1 S IBZ=$P(IBMODS,",",J) Q:IBZ=""  S IBZ=$$MOD^ICPTMOD(IBZ,"I",IBDATE) W !,?13,$P(IBZ,U,2),?18,$P(IBZ,U,3)
"RTN","IBCCPT",109,0)
 Q
"RTN","IBCCPT",110,0)
CHDR W @IOF,!,?15,"<<CURRENT PROCEDURAL TERMINOLOGY CODES>>",!!,?10,"LISTING FROM VISIT DATES WITH ASSOCIATED CPT CODES",!,?22,"IN OUTPT ENCOUNTERS FILE",!
"RTN","IBCCPT",111,0)
 K ^TMP("IBVIS",$J)
"RTN","IBCCPT",112,0)
 S L="",$P(L,"=",80)="" W !,L,!,"NO.",?5,"CODE",?13,"SHORT NAME",?39,"CLINIC",?56,"DATE",!,L,! K L
"RTN","IBCCPT",113,0)
 Q
"RTN","IBCCPT",114,0)
ADDMOD(IBIFN,IBY,IBMOD) ; Add modifier(s) from PCE procedure to CPT code mult
"RTN","IBCCPT",115,0)
 N DIE,DR,DIC,DA,DO,DD,IBS,IBM
"RTN","IBCCPT",116,0)
 F IBS=1:1:$L(IBMOD,",") S DA(2)=IBIFN,DA(1)=IBY,X=$O(^DGCR(399,DA(2),"CP",DA(1),"MOD","B",""),-1)+1 S IBM=$P(IBMOD,",",IBS) I IBM'="" D
"RTN","IBCCPT",117,0)
 . S:'$D(^DGCR(399,DA(2),"CP",DA(1),"MOD")) DIC("P")=$$GETSPEC^IBEFUNC(399.0304,16)
"RTN","IBCCPT",118,0)
 . S DIC(0)="L",DIC="^DGCR(399,"_IBIFN_",""CP"","_IBY_",""MOD"",",DLAYGO=399.30416,DIC("DR")=".02////"_IBM
"RTN","IBCCPT",119,0)
 . D FILE^DICN K DIC,DO,DD
"RTN","IBCCPT",120,0)
 Q
"RTN","IBCCPT",121,0)
 ;
"RTN","IBCCPT",122,0)
DSPPRC(CPTNM,NOD,DX) ; display summary of procedure being added
"RTN","IBCCPT",123,0)
 N IBI,IBL,IBMODS,IBMOD,IBPRVTYP,IBPRV,IBDATE,IBP,IBDXT
"RTN","IBCCPT",124,0)
 I $G(CPTNM)=""!($G(NOD)="") Q
"RTN","IBCCPT",125,0)
 S IBMODS=$P(NOD,U,10),IBPRVTYP="",IBPRV=""
"RTN","IBCCPT",126,0)
 I +$P(NOD,U,8) S IBPRV=$P($G(^VA(200,+$P(NOD,U,8),0)),U,1),IBPRVTYP=$P($$PRVTYP^IBCRU6(+$P(NOD,U,8)),U,3) S IBL=$S(($L(IBPRVTYP)+$L(IBPRV))>32:"",1:" - ")
"RTN","IBCCPT",127,0)
 ;
"RTN","IBCCPT",128,0)
 W !!?4,"Adding CPT Procedure: ",$P(CPTNM,U,2),?34,$P(CPTNM,U,3)
"RTN","IBCCPT",129,0)
 S IBDATE=$$BDATE^IBACSV($G(IBIFN))
"RTN","IBCCPT",130,0)
 I IBMODS'="" F IBI=1:1 S IBMOD=$P(IBMODS,",",IBI) Q:'IBMOD  S IBMOD=$$MOD^ICPTMOD(IBMOD,"I",IBDATE) W !,?34,$P(IBMOD,U,2)," - ",$E($P(IBMOD,U,3),1,40)
"RTN","IBCCPT",131,0)
 W !,?34,"Visit: ",$$FMTE^XLFDT(+$P(NOD,U,2),2),", ",$E($P($G(^SC(+$P(NOD,U,9),0)),U,1),1,29)
"RTN","IBCCPT",132,0)
 I IBPRV'="" W !,?34,"Provider: ",$E(IBPRV,1,35) I IBPRVTYP'="" W:IBL="" !,?44 W IBL,IBPRVTYP
"RTN","IBCCPT",133,0)
 I DX F IBP=1:1 Q:'$P(DX,"^",IBP)  S IBDXT=$$ICD9^IBACSV($P(DX,"^",IBP),+$P(NOD,U,2)) W !,?34,"Assoc Dx: ",$E($P(IBDXT,"^")_" "_$P(IBDXT,"^",3),1,35)
"RTN","IBCCPT",134,0)
 W !
"RTN","IBCCPT",135,0)
 Q
"RTN","IBCCPT",136,0)
 ;
"RTN","IBCCPT",137,0)
VST(IBQUERY) ;Procedures for outpatient visits ... If IBQUERY is defined
"RTN","IBCCPT",138,0)
 ;  on entry, the QUERY OBJECT defined by this value will be used for
"RTN","IBCCPT",139,0)
 ;  loop to extract procedures for visits, otherwise, a new QUERY will be opened
"RTN","IBCCPT",140,0)
 ;  If passed by reference, IBQUERY will be ret'd as the new QUERY ref #
"RTN","IBCCPT",141,0)
 S DGCNT=0 I $O(^DGCR(399,IBIFN,"OP",0)) F V=0:0 S V=$O(^DGCR(399,IBIFN,"OP",V)) Q:'V  S (IBOPV1,IBOPV2)=V D PROC(.IBQUERY)
"RTN","IBCCPT",142,0)
 I $O(^DGCR(399,IBIFN,"OP",0)) K ^TMP("IBVIS",$J) G VSTQ
"RTN","IBCCPT",143,0)
 S IBOPV1=$P(^DGCR(399,IBIFN,"U"),"^"),IBOPV2=$P(^("U"),"^",2)
"RTN","IBCCPT",144,0)
 D PROC(.IBQUERY) K ^TMP("IBVIS",$J)
"RTN","IBCCPT",145,0)
VSTQ Q
"RTN","IBCCPT",146,0)
 ;
"RTN","IBCCPT",147,0)
WRNO W:'$O(^UTILITY($J,"CPT-CNT",0)) !,"NO CPT CODES ON FILE FOR THE ",$S($O(^DGCR(399,IBIFN,"OP",0)):"VISIT DATES ON THIS BILL",1:"PERIOD THAT THIS STATEMENT COVERS")
"RTN","IBCCPT",148,0)
 Q
"RTN","IBCCPT",149,0)
SCR Q:DGU="^"  I $E(IOST,1,2)["C-",$Y+6>IOSL F Y=$Y:1:IOSL-5 W !
"RTN","IBCCPT",150,0)
 I  R !,"Press return to continue or ""^"" to exit display ",DGU:DTIME D:DGU'="^" CHDR
"RTN","IBCCPT",151,0)
 Q
"RTN","IBCCPT",152,0)
HLP W !!,"Enter a number between 1 and ",DGCNT1," or a range of numbers separated with commas",!,"or dashes, e.g., 1,3,5 or 2-4,8"
"RTN","IBCCPT",153,0)
 W !,"The number(s) must appear as a selectable number in the sequential list." R H:5 K H Q
"RTN","IBCCPT",154,0)
CPT S DA(1)=IBIFN,IBCCPTZ=$P(^DGCR(399,DA(1),0),U,9),IBCCPTX=$S($D(^DGCR(399,DA(1),"C"))&IBCCPTZ:1,1:0)
"RTN","IBCCPT",155,0)
 K DIK,DGTE,I1 Q
"RTN","IBCCPT",156,0)
 ;
"RTN","IBCCPT",157,0)
PROC(IBQUERY) ;  -find outpatient procedures, flag if billable
"RTN","IBCCPT",158,0)
 ;  -  ^utility($j,cpt-cnt,count)=code^date^on bill^is BASC^divis^nb^nb mess^provider^clinic^mod,mod^Opt Enc Ptr
"RTN","IBCCPT",159,0)
 ;  -  ^utility($j,cpt-cnt,count,"dx")=assoc dx(1)^assoc dx(2)^assoc dx(3)^assoc dx(4)
"RTN","IBCCPT",160,0)
 N IBVAL,IBCBK,IBFILTER
"RTN","IBCCPT",161,0)
 S IBVAL("DFN")=DFN,IBVAL("BDT")=IBOPV1,IBVAL("EDT")=(IBOPV2+.99)
"RTN","IBCCPT",162,0)
 ; Must be a billable appt type and outpt enctr status of CHECKED OUT
"RTN","IBCCPT",163,0)
 S IBFILTER=""
"RTN","IBCCPT",164,0)
 S IBCBK="I '$P(Y0,U,6),$P(Y0,U,7),$$DSP^IBEFUNC($P(Y0,U,10),+Y0),'$D(^TMP(""IBVIS"",$J,+$P(Y0,U,5))) S ^TMP(""IBVIS"",$J,+$P(Y0,U,5))="""" D EXTPROC^IBCCPT(IBIFN,Y,Y0,.DGCNT)"
"RTN","IBCCPT",165,0)
 D SCAN^IBSDU("PATIENT/DATE",.IBVAL,IBFILTER,IBCBK,0,.IBQUERY) K ^TMP("DIERR",$J)
"RTN","IBCCPT",166,0)
 ;
"RTN","IBCCPT",167,0)
 Q
"RTN","IBCCPT",168,0)
EXTPROC(IBIFN,IBOE,IBOE0,IBCNT) ; Extract procedures for an encounter
"RTN","IBCCPT",169,0)
 ; IBIFN = the ien of the bill
"RTN","IBCCPT",170,0)
 ; IBOE0 = 0-node of the outpatient encounter file entry IBOE
"RTN","IBCCPT",171,0)
 ; IBCNT  extracted entry counter
"RTN","IBCCPT",172,0)
 N I2,I7,IBCPT,IBCPTS,IBDIV,IBOED,IBZERR,Z,IBCPTDAT,IBCPTPRV,IBCLINIC,IBZ,IBONBILL,IBMODS,IBARR,IBDT,DFN,IBEX,IBDX,IBOEDP
"RTN","IBCCPT",173,0)
 ; make sure i have this variable
"RTN","IBCCPT",174,0)
 S:$G(IBOE0)="" IBOE0=$$SCE^IBSDU(+IBOE)
"RTN","IBCCPT",175,0)
 D GETCPT^SDOE(IBOE,"IBCPTS","IBZERR")
"RTN","IBCCPT",176,0)
 Q:'$O(IBCPTS(0))  ;No procedures for this encounter
"RTN","IBCCPT",177,0)
 I '$$BDSRC^IBEFUNC3($P($G(IBOE0),U,5)) Q  ; non-billable visit data source
"RTN","IBCCPT",178,0)
 S IBOED=$$NBOE^IBCU81(IBOE,IBOE0)
"RTN","IBCCPT",179,0)
 S I7=IBOE0\1,IBDIV=$P(IBOE0,U,11)
"RTN","IBCCPT",180,0)
 S IBCLINIC="" I +$P(IBOE0,U,4),+$$CLNSCRN^IBCU(I7,+$P(IBOE0,U,4)) S IBCLINIC=+$P(IBOE0,U,4)
"RTN","IBCCPT",181,0)
 S I2=0 F  S I2=$O(IBCPTS(I2)) Q:'I2  D
"RTN","IBCCPT",182,0)
 . S IBCPT=$P(IBCPTS(I2),U)
"RTN","IBCCPT",183,0)
 . S IBCPTPRV=$P($G(IBCPTS(I2,12)),U,4)
"RTN","IBCCPT",184,0)
 . S IBONBILL=0 S IBZ=0 F  S IBZ=$O(^DGCR(399,IBIFN,"CP","B",IBCPT_";ICPT(",IBZ)) Q:'IBZ  I $P($G(^DGCR(399,IBIFN,"CP",IBZ,0)),U,2)=I7 S IBONBILL=1
"RTN","IBCCPT",185,0)
 . S IBMODS="",IBZ=0 F  S IBZ=$O(IBCPTS(I2,1,IBZ)) Q:'IBZ  S IBMODS=IBMODS_$S(IBMODS="":"",1:",")_+$G(IBCPTS(I2,1,IBZ,0))
"RTN","IBCCPT",186,0)
 . ;
"RTN","IBCCPT",187,0)
 . ; look up of a procedure is non-billable and get assoc dx
"RTN","IBCCPT",188,0)
 . S IBOEDP=IBOED I IBOEDP="" S IBOEDP=$$NBOEP^IBCCPT1(IBOE0,IBCPT,.IBDX) I IBOEDP'="" S IBOEDP=4_U_IBOEDP
"RTN","IBCCPT",189,0)
 . S IBCPTDAT=IBCPT_U_I7_U_IBONBILL_U_0_U_IBDIV_U_$P(IBOEDP,U,1)_U_$P(IBOEDP,U,2)_U_IBCPTPRV_U_IBCLINIC_U_IBMODS_U_IBOE
"RTN","IBCCPT",190,0)
 . F Z=1:1:$P(IBCPTS(I2),U,16) S IBCNT=IBCNT+1,^UTILITY($J,"CPT-CNT",IBCNT)=IBCPTDAT,^UTILITY($J,"CPT-CNT",IBCNT,"DX")=$G(IBDX)
"RTN","IBCCPT",191,0)
 . K IBDX
"RTN","IBCCPT",192,0)
 I $O(IBARR("CPT",0)),'$D(^UTILITY($J,"CPT",+IBOE0,0)) S ^(0)="Y"
"RTN","IBCCPT",193,0)
 Q
"RTN","IBCCPT",194,0)
 ;
"RTN","IBCCPT",195,0)
TOMANY(DATE) ;  - returns 1 if more than 1 visit date on bill (for basc)
"RTN","IBCCPT",196,0)
 G TOMANYQ:'$D(DATE)
"RTN","IBCCPT",197,0)
 S DGVCNT=+$P($G(^DGCR(399,IBIFN,"OP",0)),"^",4)
"RTN","IBCCPT",198,0)
 I DGVCNT>1!(DGVCNT=1&('$D(^DGCR(399,IBIFN,"OP",DATE)))) K DGVCNT Q 1
"RTN","IBCCPT",199,0)
TOMANYQ Q 0
"RTN","IBCCPT",200,0)
 ;
"RTN","IBCECOB")
0^8^B17473873^B16479682
"RTN","IBCECOB",1,0)
IBCECOB ;ALB/CXW - IB COB MANAGEMENT SCREEN ;16-JUN-1999
"RTN","IBCECOB",2,0)
 ;;2.0;INTEGRATED BILLING;**137,155,288,432**;21-MAR-1994;Build 192
"RTN","IBCECOB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCECOB",4,0)
 ;
"RTN","IBCECOB",5,0)
EN ; -- main entry point for COB management
"RTN","IBCECOB",6,0)
 K IBSRT,IBMRADUP
"RTN","IBCECOB",7,0)
 I $G(IBMRANOT) D EN^VALM("IBCEM COB MANAGEMENT") ;WCJ;IB*2.0*432
"RTN","IBCECOB",8,0)
 I '$G(IBMRANOT) D EN^VALM("IBCEM MRA MANAGEMENT") ;WCJ;IB*2.0*432
"RTN","IBCECOB",9,0)
 Q
"RTN","IBCECOB",10,0)
 ;
"RTN","IBCECOB",11,0)
HDR ; -- header code
"RTN","IBCECOB",12,0)
 Q
"RTN","IBCECOB",13,0)
 ;
"RTN","IBCECOB",14,0)
INIT ; -- init variables and list array
"RTN","IBCECOB",15,0)
 N DIC,DIRUT,DIROUT,DTOUT,DUOUT,X,Y,DIR,IB1
"RTN","IBCECOB",16,0)
 K ^TMP("IBBIL",$J)
"RTN","IBCECOB",17,0)
 S IBSRT=""
"RTN","IBCECOB",18,0)
 S IB1=1
"RTN","IBCECOB",19,0)
 W !
"RTN","IBCECOB",20,0)
 F  S DIC="^VA(200,",DIC(0)="AEMQ",DIC("A")="Select "_$S('IB1:"Another ",1:"")_"BILLER: "_$S('IB1:"",1:"ALL//") D ^DIC K DIC D  Q:Y<0
"RTN","IBCECOB",21,0)
 . Q:Y<0
"RTN","IBCECOB",22,0)
 . I $D(^TMP("IBBIL",$J,+Y)) W !,"This biller has already been selected" Q
"RTN","IBCECOB",23,0)
 . S ^TMP("IBBIL",$J,+Y)=""
"RTN","IBCECOB",24,0)
 . S IB1=0
"RTN","IBCECOB",25,0)
 I $D(DTOUT)!$D(DUOUT) S VALMQUIT=1 G INITQ
"RTN","IBCECOB",26,0)
 ;
"RTN","IBCECOB",27,0)
 S DIR("A")="Sort By: ",DIR("B")="BILLER"
"RTN","IBCECOB",28,0)
 S DIR(0)="SBA^B:BILLER;D:DAYS SINCE TRANSMISSION OF LATEST BILL;L:DATE LAST "_$S($G(IBMRANOT):"EOB",1:"MRA")_" RECEIVED;"
"RTN","IBCECOB",29,0)
 S DIR(0)=DIR(0)_"I:SECONDARY INSURANCE COMPANY;M:"_$S($G(IBMRANOT):"EOB",1:"MRA")_" STATUS;P:PATIENT NAME;R:PATIENT RESPONSIBILITY;S:SERVICE DATE"
"RTN","IBCECOB",30,0)
 S DIR("?")="Enter the code to indicate how the list should be sorted." D ^DIR K DIR
"RTN","IBCECOB",31,0)
 I $D(DTOUT)!$D(DUOUT) S VALMQUIT=1 G INITQ
"RTN","IBCECOB",32,0)
 S IBSRT=Y
"RTN","IBCECOB",33,0)
 ;
"RTN","IBCECOB",34,0)
 W !
"RTN","IBCECOB",35,0)
 S IBMRADUP=0
"RTN","IBCECOB",36,0)
 S DIR("A")="Do you want to include Denied "_$S($G(IBMRANOT):"EOB",1:"MRA")_"s for Duplicate Claim/Service",DIR("B")="No",DIR(0)="YO"
"RTN","IBCECOB",37,0)
 D ^DIR K DIR
"RTN","IBCECOB",38,0)
 I $D(DTOUT)!$D(DUOUT) S VALMQUIT=1 G INITQ
"RTN","IBCECOB",39,0)
 I Y S IBMRADUP=1
"RTN","IBCECOB",40,0)
 ;
"RTN","IBCECOB",41,0)
 D BLD^IBCECOB1
"RTN","IBCECOB",42,0)
INITQ Q
"RTN","IBCECOB",43,0)
 ;
"RTN","IBCECOB",44,0)
HELP ; -- help code
"RTN","IBCECOB",45,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCECOB",46,0)
 Q
"RTN","IBCECOB",47,0)
 ;
"RTN","IBCECOB",48,0)
EXIT ; -- exit code
"RTN","IBCECOB",49,0)
 K ^TMP("IBCECOB",$J),^TMP("IBCOBST",$J),^TMP("IBBIL",$J)
"RTN","IBCECOB",50,0)
 K ^TMP("IBCECOB1",$J),^TMP("IBCOBSTX",$J)
"RTN","IBCECOB",51,0)
 D CLEAN^VALM10
"RTN","IBCECOB",52,0)
 Q
"RTN","IBCECOB",53,0)
 ;
"RTN","IBCECOB",54,0)
EXP ; -- expand code to show additional details of the EOB record
"RTN","IBCECOB",55,0)
 NEW IBDA,IBIFN,LSTENTRY
"RTN","IBCECOB",56,0)
 D SEL^IBCECOB2(.IBDA,1)                       ; selects a bill
"RTN","IBCECOB",57,0)
 S LSTENTRY=+$O(IBDA(0)) I 'LSTENTRY G EXPQ    ; list entry number
"RTN","IBCECOB",58,0)
 S IBIFN=+$G(IBDA(LSTENTRY)) I 'IBIFN G EXPQ   ; bill#
"RTN","IBCECOB",59,0)
 ;
"RTN","IBCECOB",60,0)
 ; If only one MRA on file, call the listman screen and quit
"RTN","IBCECOB",61,0)
 I $$MRACNT^IBCEMU1(IBIFN)=1 D EN^VALM("IBCEM MRA DETAIL") G EXPQ
"RTN","IBCECOB",62,0)
 ;
"RTN","IBCECOB",63,0)
EXPLOOP ; At this point, we know there are multiple MRA's on file
"RTN","IBCECOB",64,0)
 ;
"RTN","IBCECOB",65,0)
 D FULL^VALM1
"RTN","IBCECOB",66,0)
 I $$SEL^IBCEMU1(IBIFN,1,LSTENTRY) D  G EXPLOOP  ; MRA lister/selection
"RTN","IBCECOB",67,0)
 . NEW IBIFN,LSTENTRY,IBDASAVE                   ; protect variables
"RTN","IBCECOB",68,0)
 . M IBDASAVE=IBDA                               ; save off IBDA array
"RTN","IBCECOB",69,0)
 . D EN^VALM("IBCEM MRA DETAIL")                 ; call the listman
"RTN","IBCECOB",70,0)
 . M IBDA=IBDASAVE                               ; restore IBDA array
"RTN","IBCECOB",71,0)
 . Q
"RTN","IBCECOB",72,0)
EXPQ ;
"RTN","IBCECOB",73,0)
 S VALMBCK="R"
"RTN","IBCECOB",74,0)
 Q
"RTN","IBCECOB",75,0)
 ;
"RTN","IBCECOB",76,0)
COBPOSS(IB364) ; Returns 1 if transmit bill ien in IB364 is currently
"RTN","IBCECOB",77,0)
 ; in a status where COB may be performed on the bill
"RTN","IBCECOB",78,0)
 ; Used by index "ACOB", file 364
"RTN","IBCECOB",79,0)
 N IBWNR,IBNSEQ,IB01,IBM1,IBU1,IB0,IBOK,IBMRA
"RTN","IBCECOB",80,0)
 S IBOK=1
"RTN","IBCECOB",81,0)
 S IB0=$G(^IBA(364,IB364,0))
"RTN","IBCECOB",82,0)
 S IBWNR=$$WNRBILL^IBEFUNC(+IB0),IBMRA=$P($G(^DGCR(399,+IB0,"TX")),U,5)
"RTN","IBCECOB",83,0)
 S IB01=$G(^DGCR(399,+IB0,0)),IBM1=$G(^("M1")),IBU1=$G(^("U1"))
"RTN","IBCECOB",84,0)
 I 'IBWNR,IBU1-$P(IBU1,U,2)'>0 S IBOK=0 G COBQ ; Bill has a 0 balance
"RTN","IBCECOB",85,0)
 I $S('IBWNR:$E($P(IB0,U,3))'="A",1:IBMRA'="1N"&(IBMRA'="A")) S IBOK=0 G COBQ ; Not in correct transmit status
"RTN","IBCECOB",86,0)
 S IBNSEQ=+$TR($P(IB0,U,8),"PST","230")
"RTN","IBCECOB",87,0)
 I 'IBNSEQ!'$D(^DGCR(399,+IB0,"I"_IBNSEQ)) S IBOK=0 G COBQ ; No next ins
"RTN","IBCECOB",88,0)
 I "234"'[$P(IB01,U,13) S IBOK=0 G COBQ ; Bill invalid status for COB
"RTN","IBCECOB",89,0)
 I IBNSEQ D
"RTN","IBCECOB",90,0)
 . N Z,IBSTOP
"RTN","IBCECOB",91,0)
 . S IBSTOP=0
"RTN","IBCECOB",92,0)
 . F Z=IBNSEQ:1:3 D  Q:IBSTOP
"RTN","IBCECOB",93,0)
 .. I $D(^DGCR(399,+IB0,"I"_Z)) D
"RTN","IBCECOB",94,0)
 ... ;Insurance must reimburse
"RTN","IBCECOB",95,0)
 ... I $P($G(^DIC(36,+^DGCR(399,+IB0,"I"_Z),0)),U,2)="N" S IBOK=0 Q
"RTN","IBCECOB",96,0)
 ... I $P(IBM1,U,4+Z) S IBOK=0,IBSTOP=1 Q  ; Already has a next seq bill
"RTN","IBCECOB",97,0)
 ... S (IBOK,IBSTOP)=1
"RTN","IBCECOB",98,0)
 ;
"RTN","IBCECOB",99,0)
COBQ Q IBOK
"RTN","IBCECOB",100,0)
 ;
"RTN","IBCECOB1")
0^11^B99389484^B69046565
"RTN","IBCECOB1",1,0)
IBCECOB1 ;ALB/CXW - IB COB MANAGEMENT SCREEN/REPORT ;14-JUN-99
"RTN","IBCECOB1",2,0)
 ;;2.0;INTEGRATED BILLING;**137,155,288,348,377,417,432**;21-MAR-94;Build 192
"RTN","IBCECOB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCECOB1",4,0)
 ;
"RTN","IBCECOB1",5,0)
 ; IBMRANOT = 1 when dealing with the COB Management Worklist.   
"RTN","IBCECOB1",6,0)
 ;            It is set by the entry action in the option file. 
"RTN","IBCECOB1",7,0)
 ;
"RTN","IBCECOB1",8,0)
BLD ; Build list entrypoint
"RTN","IBCECOB1",9,0)
 N I,IBFND,IBB,IBIFN,IB364,IBDA1,IBDTN,IBDA,IBDAY,IBHIS,IBNDS,IBEUT,IBAPY,IBOAM,IBDT,IBMUT,IBBPY,IBINS,IBNDM,IBQ,IBNDI1,IBNDI2,IBNDI3,Z,Z0,IBSEQ,IB3611,IBINS1,IBINS2,IBEXPY,IBNBAL,IBPTRSP,IBAMT,IBMRACNT,IBPTNM,IBSRVC,IBPY,IBB364
"RTN","IBCECOB1",10,0)
 N IBEOBREV,IBDENDUP,EOBTYPE
"RTN","IBCECOB1",11,0)
 K ^TMP("IBCECOB",$J),^TMP("IBCECOB1",$J),^TMP("IBCOBST",$J),^TMP("IBCOBSTX",$J)
"RTN","IBCECOB1",12,0)
 D CLEAN^VALM10      ; kill data and video control arrays
"RTN","IBCECOB1",13,0)
 S VALMCNT=0,IBHIS=""
"RTN","IBCECOB1",14,0)
 ; IB*2.0*432 IF not MRA, use new CAP index on 399 file
"RTN","IBCECOB1",15,0)
 D:$G(IBMRANOT)=1 CAP^IBCAPP2
"RTN","IBCECOB1",16,0)
 ; since 0 is a valid Review Status, init w/null
"RTN","IBCECOB1",17,0)
 S IBEOBREV=""
"RTN","IBCECOB1",18,0)
 ; get EOB's w/Review Status of 0, 1, 1.5 or 2; If 3 or higher, not needed
"RTN","IBCECOB1",19,0)
 I $G(IBMRANOT)'=1 F  S IBEOBREV=$O(^IBM(361.1,"AMRA",1,IBEOBREV)) Q:IBEOBREV=""  Q:IBEOBREV>2  D
"RTN","IBCECOB1",20,0)
 . S IBDA="A" F  S IBDA=$O(^IBM(361.1,"AMRA",1,IBEOBREV,IBDA),-1) Q:'IBDA  D BLD1
"RTN","IBCECOB1",21,0)
 ; no data accumulated
"RTN","IBCECOB1",22,0)
 I $O(^TMP("IBCOBST",$J,""))="" D NMAT Q
"RTN","IBCECOB1",23,0)
 ; display accumulated data
"RTN","IBCECOB1",24,0)
 D SCRN
"RTN","IBCECOB1",25,0)
 Q
"RTN","IBCECOB1",26,0)
BLD1 ;
"RTN","IBCECOB1",27,0)
 I '$$ELIG(IBDA) Q
"RTN","IBCECOB1",28,0)
 S IBDENDUP=$$DENDUP^IBCEMU4(IBDA,$G(IBMRANOT))
"RTN","IBCECOB1",29,0)
 I '$G(IBMRADUP),IBDENDUP Q     ; don't include denied MRAs/EOBs for Duplicate Claim/Service
"RTN","IBCECOB1",30,0)
 S IB3611=$G(^IBM(361.1,IBDA,0))
"RTN","IBCECOB1",31,0)
 S IBIFN=+IB3611,IB364=$P(IB3611,U,19),IBDT=+$P(IB3611,U,6)
"RTN","IBCECOB1",32,0)
 I $D(^TMP("IBCOBSTX",$J,IBIFN)) Q  ;show each bill once on the worklist
"RTN","IBCECOB1",33,0)
 S IBB=$G(^DGCR(399,IBIFN,0))
"RTN","IBCECOB1",34,0)
 S IBNDS=$G(^DGCR(399,IBIFN,"S")),IBNDI1=$G(^("I1")),IBNDI2=$G(^("I2")),IBNDI3=$G(^("I3")),IBNDM=$G(^("M"))
"RTN","IBCECOB1",35,0)
 S IBMUT=+$P(IBNDS,U,8),IBEUT=+$P(IBNDS,U,2)
"RTN","IBCECOB1",36,0)
 S IBINS="",IBSEQ=$P(IB3611,U,15)
"RTN","IBCECOB1",37,0)
 F I=1:1:3 S Z="IBNDI"_I I @Z D
"RTN","IBCECOB1",38,0)
 . N Q
"RTN","IBCECOB1",39,0)
 . S Q=(IBSEQ=I)
"RTN","IBCECOB1",40,0)
 . I Q S IBINS1=+@Z_U_$P($G(^DIC(36,+@Z,0)),U)
"RTN","IBCECOB1",41,0)
 . S IBINS=IBINS_$S(IBINS="":"",1:", ")_$P($G(^DIC(36,+@Z,0)),U)
"RTN","IBCECOB1",42,0)
 ; Get the payer/insurance company that comes after Medicare WNR
"RTN","IBCECOB1",43,0)
 ; If WNR is Primary, get the secondary ins. co.
"RTN","IBCECOB1",44,0)
 ; If WNR is secondary, get the tertiary ins. co.
"RTN","IBCECOB1",45,0)
 D  I $P($G(IBINS2),U,2)="" S $P(IBINS2,U,2)="UNKNOWN"
"RTN","IBCECOB1",46,0)
 . I $$WNRBILL^IBEFUNC(IBIFN,1) S IBINS2=+IBNDI2_U_$P($G(^DIC(36,+IBNDI2,0)),U) Q
"RTN","IBCECOB1",47,0)
 . S IBINS2=+IBNDI3_U_$P($G(^DIC(36,+IBNDI3,0)),U)
"RTN","IBCECOB1",48,0)
 S IBFND=0
"RTN","IBCECOB1",49,0)
 ; biller entry not ALL and no biller, then get entered/edited by user
"RTN","IBCECOB1",50,0)
 I $D(^TMP("IBBIL",$J)) D  Q:'IBFND
"RTN","IBCECOB1",51,0)
 . S IBFND=$S($D(^TMP("IBBIL",$J,IBMUT)):IBMUT,$D(^TMP("IBBIL",$J,IBEUT)):IBEUT,1:0)
"RTN","IBCECOB1",52,0)
 S Z=$S(IBFND:IBFND,IBMUT:IBMUT,1:IBEUT)
"RTN","IBCECOB1",53,0)
 S IBMUT=$P($G(^VA(200,+Z,0)),U)_"~"_Z
"RTN","IBCECOB1",54,0)
 S:'$P(IBMUT,"~",2) IBMUT="UNKNOWN~0"
"RTN","IBCECOB1",55,0)
 S IBBPY=+$$COBN^IBCEF(IBIFN),IBQ=1
"RTN","IBCECOB1",56,0)
 ;IBQ;1=EOB without subsequent insurer,0=COB,2=0 balance
"RTN","IBCECOB1",57,0)
 D  ;I IBQ Q
"RTN","IBCECOB1",58,0)
 . ;Check for no reimbursable subsequent insurance
"RTN","IBCECOB1",59,0)
 .  F I=IBBPY+1:1:3 D  Q:'IBQ
"RTN","IBCECOB1",60,0)
 .. S Z="IBNDI"_I,Z=$G(@Z)
"RTN","IBCECOB1",61,0)
 .. I $P($G(^DIC(36,+Z,0)),U,2)="N" S IBQ=0 Q
"RTN","IBCECOB1",62,0)
 . ;Check if next ins doesn't exist or next bill# already created
"RTN","IBCECOB1",63,0)
 . S Z="IBNDI"_(IBBPY+1),Z=$G(@Z)
"RTN","IBCECOB1",64,0)
 . I Z,'$P($G(^DGCR(399,IBIFN,"M1")),U,5+IBBPY) S IBQ=0
"RTN","IBCECOB1",65,0)
 ;
"RTN","IBCECOB1",66,0)
 ; Days since transmission of latest bill in COB - IBDAY
"RTN","IBCECOB1",67,0)
 S IBDAY=+$P($G(^DGCR(399,IBIFN,"TX")),U,2) I IBDAY S IBDAY=$$FMDIFF^XLFDT(DT,IBDAY,1)
"RTN","IBCECOB1",68,0)
 ; if no Last Electronic Extract Date on file 399, get it from file 364
"RTN","IBCECOB1",69,0)
 I 'IBDAY D  I IBDAY S IBDAY=$$FMDIFF^XLFDT(DT,IBDAY,1) ;calc. the difference
"RTN","IBCECOB1",70,0)
 . S IBB364=$$LAST364^IBCEF4(IBIFN) I IBB364'="" S IBDAY=+$P($P($G(^IBA(364,IBB364,0)),U,4),".",1)
"RTN","IBCECOB1",71,0)
 ;
"RTN","IBCECOB1",72,0)
 S IBAPY=$$TPR^PRCAFN(IBIFN) ; payment on this bill from A/R
"RTN","IBCECOB1",73,0)
 S IBEXPY=+$G(^IBM(361.1,IBDA,1))       ; payer paid amount
"RTN","IBCECOB1",74,0)
 S IBPTRSP=$$PREOBTOT^IBCEU0(IBIFN)     ; patient resp. function
"RTN","IBCECOB1",75,0)
 S IBPY=$S(IBAPY:IBAPY,1:IBEXPY)
"RTN","IBCECOB1",76,0)
 S IBOAM=+$G(^DGCR(399,IBIFN,"U1"))     ; total charges for bill
"RTN","IBCECOB1",77,0)
 S IBNBAL=IBOAM-IBPY
"RTN","IBCECOB1",78,0)
 I IBNBAL'>0 S IBQ=2
"RTN","IBCECOB1",79,0)
 S IBPTNM=$P($G(^DPT(+$P($G(^DGCR(399,IBIFN,0)),U,2),0)),U) I IBPTNM="" S IBPTNM="UNKNOWN"
"RTN","IBCECOB1",80,0)
 S IBSRVC=$P($G(^DGCR(399,IBIFN,"U")),U)
"RTN","IBCECOB1",81,0)
 S Z0=$S(IBSRT="B":IBMUT,IBSRT="D":-IBDAY,IBSRT="I":$P(IBINS2,U,2)_"~"_$P(IBINS2,U),IBSRT="M":$$EXTERNAL^DILFD(361.1,.13,"",$P(IB3611,"^",13)),IBSRT="R":-IBPTRSP,IBSRT="P":IBPTNM,IBSRT="S":+IBSRVC,1:+IBDT)
"RTN","IBCECOB1",82,0)
 S:((IBSRT="M")&(Z0="")) Z0="UNKNOWN"   ;USE UNKNOWN IF NOT SET - BI;IB*2.0*432
"RTN","IBCECOB1",83,0)
 S ^TMP("IBCOBST",$J,Z0,IBIFN)=IBSRVC_U_IBOAM_U_IBAPY_U_$S(IBNBAL>0:IBNBAL,1:0)_U_$P(IBB,U,5)_U_$P(IBB,U,19)_U_IBBPY_U_$P(IBMUT,"~")_U_IBINS_U_IBDA_U_$$HIS(IBIFN)_U_IBDAY_U_IBDT_U_IBQ_U_IB364_U_IBSEQ_U_IBEXPY_U_IBPTRSP
"RTN","IBCECOB1",84,0)
 S ^TMP("IBCOBST",$J,Z0,IBIFN,1)=$$EXTERNAL^DILFD(361.1,.13,"",$P(IB3611,"^",13))_", "_$$FMTE^XLFDT($P($P(IB3611,"^",6),"."))_"^"_$P(IB3611,"^",16)
"RTN","IBCECOB1",85,0)
 S ^TMP("IBCOBSTX",$J,IBIFN)=IBDA  ;keep track of compiled IBIFN's
"RTN","IBCECOB1",86,0)
 ;
"RTN","IBCECOB1",87,0)
 ; Save some data when there are multiple MRA's on file for this bill
"RTN","IBCECOB1",88,0)
 S IBMRACNT=$$MRACNT^IBCEMU1(IBIFN,$G(IBMRANOT))   ;WCJ IB*2.0*432
"RTN","IBCECOB1",89,0)
 I IBMRACNT>1 S $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,1)="Multiple "_$S($G(IBMRANOT):"EOBs",1:"MRA's")_" on file"  ;WCJ IB*2.0*432
"RTN","IBCECOB1",90,0)
 S $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,3)=IBMRACNT
"RTN","IBCECOB1",91,0)
 S $P(^TMP("IBCOBST",$J,Z0,IBIFN,1),U,4)=IBDENDUP
"RTN","IBCECOB1",92,0)
 Q
"RTN","IBCECOB1",93,0)
 ;
"RTN","IBCECOB1",94,0)
HIS(IBIFN) ; COB history
"RTN","IBCECOB1",95,0)
 N A,B,IBST,IBBIL,IBHIS
"RTN","IBCECOB1",96,0)
 S IBHIS="",A=0 F  S A=$O(^IBM(361.1,"ABS",IBIFN,A)) Q:'A  S B=0 F  S B=$O(^IBM(361.1,"ABS",IBIFN,A,B)) Q:'B  D
"RTN","IBCECOB1",97,0)
 . S IBST=$P($G(^IBM(361.1,B,0)),U,4),IBBIL=$P($G(^DGCR(399,IBIFN,"M1")),U,4+A)   ;WCJ IB*2.0*432 added $G
"RTN","IBCECOB1",98,0)
 . Q:IBBIL=""
"RTN","IBCECOB1",99,0)
 . S IBHIS=IBHIS_$S(IBHIS="":"",1:";")_$S(A=1:"PRIMARY",A=2:"SECONDARY",1:"TERTIARY")_" "_$S(IBST:"MRA",1:"EOB")_" RECEIVED - "_IBBIL
"RTN","IBCECOB1",100,0)
 Q IBHIS
"RTN","IBCECOB1",101,0)
 ;
"RTN","IBCECOB1",102,0)
NMAT ;No COB list
"RTN","IBCECOB1",103,0)
 S VALMCNT=2,IBCNT=2
"RTN","IBCECOB1",104,0)
 S ^TMP("IBCECOB",$J,1,0)=" "
"RTN","IBCECOB1",105,0)
 S ^TMP("IBCECOB",$J,2,0)="    No "_$S($G(IBMRANOT)=1:"EOB's",1:"MRA's")_" Matching Selection Criteria Were Found"
"RTN","IBCECOB1",106,0)
 Q
"RTN","IBCECOB1",107,0)
 ;
"RTN","IBCECOB1",108,0)
SCRN ;
"RTN","IBCECOB1",109,0)
 N IBX,IBCNT,IBIFN,IBDA,IB,X,IBS1,IBPAT,Z,IBK,IBFORM
"RTN","IBCECOB1",110,0)
 S IBCNT=0
"RTN","IBCECOB1",111,0)
 S IBS1=$S(IBSRT="B":"BILLER",IBSRT="D":"Days Since Last Transmission",IBSRT="L":"Date Last "_$S($G(IBMRANOT):"EOB",1:"MRA")_" Received",IBSRT="I":"SECONDARY INSURANCE COMPANY",IBSRT="M":$S($G(IBMRANOT):"EOB",1:"MRA")_" Status",1:"")
"RTN","IBCECOB1",112,0)
 S IBX="" F  S IBX=$O(^TMP("IBCOBST",$J,IBX)) Q:IBX=""  D
"RTN","IBCECOB1",113,0)
 . I IBSRT="B"!(IBSRT="I")!(IBSRT="M") D
"RTN","IBCECOB1",114,0)
 .. D:IBCNT SET("",IBCNT+1)
"RTN","IBCECOB1",115,0)
 .. D SET(IBS1_": "_$P(IBX,"~"),IBCNT+1)
"RTN","IBCECOB1",116,0)
 . S IBIFN=0 F  S IBIFN=$O(^TMP("IBCOBST",$J,IBX,IBIFN)) Q:'IBIFN  D
"RTN","IBCECOB1",117,0)
 .. S IB=$G(^TMP("IBCOBST",$J,IBX,IBIFN))
"RTN","IBCECOB1",118,0)
 .. S Z=$G(^DPT(+$P($G(^DGCR(399,IBIFN,0)),U,2),0))
"RTN","IBCECOB1",119,0)
 .. S IBPAT=$$LJ^XLFSTR($E($P(Z,U),1,18),18," ")_" "_$E($P(Z,U,9),6,9)
"RTN","IBCECOB1",120,0)
 .. S IBDA=$P(IB,U,10) ;361.1-ien
"RTN","IBCECOB1",121,0)
 .. S IBQ=$P(IB,U,14),IB364=$P(IB,U,15)
"RTN","IBCECOB1",122,0)
 .. S IBFORM=$$EXTERNAL^DILFD(399,.19,,+$P(IB,U,6))
"RTN","IBCECOB1",123,0)
 .. I +$P(IB,U,6)=2 S IBFORM=1500   ; for space reasons
"RTN","IBCECOB1",124,0)
 .. S IBPTRSP=$P(IB,U,18)
"RTN","IBCECOB1",125,0)
 .. S IBAMT=$P(IB,U,2)
"RTN","IBCECOB1",126,0)
 .. S IBCNT=IBCNT+1
"RTN","IBCECOB1",127,0)
 .. S X=""
"RTN","IBCECOB1",128,0)
 .. S X=$$SETFLD^VALM1(IBCNT,X,"NUMBER")
"RTN","IBCECOB1",129,0)
 .. S X=$$SETFLD^VALM1($$BN1^PRCAFN(IBIFN)_$S($P($G(^DGCR(399,IBIFN,"TX")),U,10)=1:"*",1:""),X,"BILL")
"RTN","IBCECOB1",130,0)
 .. S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IB,U)),X,"SERVICE")
"RTN","IBCECOB1",131,0)
 .. S X=$$SETFLD^VALM1(IBPAT,X,"PATNM")
"RTN","IBCECOB1",132,0)
 .. S X=$$SETFLD^VALM1($$RJ^XLFSTR($FN(IBPTRSP,"",2),9," "),X,"PTRESP")
"RTN","IBCECOB1",133,0)
 .. S X=$$SETFLD^VALM1($$RJ^XLFSTR($FN(IBAMT,"",2),9," "),X,"IBAMT")
"RTN","IBCECOB1",134,0)
 .. S X=$$SETFLD^VALM1($$TYPE^IBJTLA1($P(IB,U,5))_"/"_IBFORM,X,"BTYPE")
"RTN","IBCECOB1",135,0)
 .. D SET(X,IBCNT,IBIFN,IBDA,IBQ,IB364,IBX,IB)
"RTN","IBCECOB1",136,0)
 .. ;For R (Pt Resp), P (Pt Name) and S (Service Date) don't display sub-headers
"RTN","IBCECOB1",137,0)
 .. I "BIMRPS"'[IBSRT D
"RTN","IBCECOB1",138,0)
 ... S Z=$S(IBSRT="L":$$DAT1^IBOUTL(IBX),IBSRT="D":-IBX,1:IBX)
"RTN","IBCECOB1",139,0)
 ... D SET("   "_IBS1_": "_Z,IBCNT)
"RTN","IBCECOB1",140,0)
 .. S X=$$SETSTR^VALM1("Insurers:  "_$P(IB,U,9),"",7,74)
"RTN","IBCECOB1",141,0)
 .. D SET(X,IBCNT,IBIFN,IBDA,IBQ,IB364,IBX,IB)
"RTN","IBCECOB1",142,0)
 .. ;
"RTN","IBCECOB1",143,0)
 .. ; line 3 of display:  MRA status/date/split claim indicator
"RTN","IBCECOB1",144,0)
 .. S X=$$SETSTR^VALM1($S($G(IBMRANOT):"EOB",1:"MRA")_" Status:  ","",5,13)
"RTN","IBCECOB1",145,0)
 .. S IBK=$G(^TMP("IBCOBST",$J,IBX,IBIFN,1))
"RTN","IBCECOB1",146,0)
 .. S X=$$SETSTR^VALM1($P(IBK,U,1),X,18,63)
"RTN","IBCECOB1",147,0)
 .. I $P(IBK,U,2)=2 S X=$$SETSTR^VALM1("** SPLIT CLAIM **",X,63,18)
"RTN","IBCECOB1",148,0)
 .. I $P(IBK,U,4),$P(IBK,U,2)'=2,$P(IBK,U,3)=1 S X=$$SETSTR^VALM1("** Denied for Duplicate **",X,54,27)
"RTN","IBCECOB1",149,0)
 .. D SET(X,IBCNT,IBIFN,IBDA,IBQ,IB364,IBX,IB)
"RTN","IBCECOB1",150,0)
 .. ;
"RTN","IBCECOB1",151,0)
 .. ; conditionally update video attributes of line 3
"RTN","IBCECOB1",152,0)
 .. I '$D(IOINHI) D ENS^%ZISS
"RTN","IBCECOB1",153,0)
 .. ; split claim
"RTN","IBCECOB1",154,0)
 .. I $P(IBK,U,2)=2 D CNTRL^VALM10(VALMCNT,63,17,IOINHI,IOINORM)
"RTN","IBCECOB1",155,0)
 .. ; multiple mra's on file
"RTN","IBCECOB1",156,0)
 .. I $P(IBK,U,3)>1 D CNTRL^VALM10(VALMCNT,18,22,IOINHI,IOINORM)
"RTN","IBCECOB1",157,0)
 .. ; Denied for Duplicate - no split claim and single MRA only
"RTN","IBCECOB1",158,0)
 .. I $P(IBK,U,4),$P(IBK,U,2)'=2,$P(IBK,U,3)=1 D CNTRL^VALM10(VALMCNT,54,26,IOINHI,IOINORM)
"RTN","IBCECOB1",159,0)
 .. Q
"RTN","IBCECOB1",160,0)
 Q
"RTN","IBCECOB1",161,0)
 ;
"RTN","IBCECOB1",162,0)
SET(X,CNT,IBIFN,IBDA,IBQ,IB364,IBX,IB) ;set up list manager screen array
"RTN","IBCECOB1",163,0)
 S VALMCNT=VALMCNT+1
"RTN","IBCECOB1",164,0)
 S ^TMP("IBCECOB",$J,VALMCNT,0)=X
"RTN","IBCECOB1",165,0)
 S ^TMP("IBCECOB",$J,"IDX",VALMCNT,CNT)=""
"RTN","IBCECOB1",166,0)
 I $G(IBIFN),$G(^TMP("IBCECOB",$J,CNT))="" S ^TMP("IBCECOB",$J,CNT)=VALMCNT_U_IBIFN_U_IB364_U_IBDA_U_IBQ_U_IBX,^TMP("IBCECOB1",$J,CNT)=IB
"RTN","IBCECOB1",167,0)
 Q
"RTN","IBCECOB1",168,0)
 ;
"RTN","IBCECOB1",169,0)
FTYPE(Y) ;type classification
"RTN","IBCECOB1",170,0)
 Q $E($P($G(^IBE(353,Y,0)),U),1,8)
"RTN","IBCECOB1",171,0)
 ;
"RTN","IBCECOB1",172,0)
PTRESPI(IBEOB) ; Function - Computes the Patient's Responsibility based on IBEOB
"RTN","IBCECOB1",173,0)
 ; of 361.1 for Claims/Bills with form type 3=UB
"RTN","IBCECOB1",174,0)
 ; Input IBEOB - a single EOB ien; Required
"RTN","IBCECOB1",175,0)
 ; Output      - Function Returns IBPTRES - Patient Responsibility Amount for the EOB
"RTN","IBCECOB1",176,0)
 ;
"RTN","IBCECOB1",177,0)
 N IBPTRES,IBC,EOBADJ
"RTN","IBCECOB1",178,0)
 S IBPTRES=0,IBEOB=+$G(IBEOB)
"RTN","IBCECOB1",179,0)
 I 'IBEOB Q IBPTRES   ;PTRESPI
"RTN","IBCECOB1",180,0)
 ; filing error
"RTN","IBCECOB1",181,0)
 Q:$D(^IBM(361.1,IBEOB,"ERR")) IBPTRES
"RTN","IBCECOB1",182,0)
 ;
"RTN","IBCECOB1",183,0)
 ; get claim level adjustments
"RTN","IBCECOB1",184,0)
 K EOBADJ M EOBADJ=^IBM(361.1,IBEOB,10)
"RTN","IBCECOB1",185,0)
 S IBPTRES=$$CALCPR^IBCEU0(.EOBADJ)
"RTN","IBCECOB1",186,0)
 ;
"RTN","IBCECOB1",187,0)
 ; get line level adjustments
"RTN","IBCECOB1",188,0)
 S IBC=0 F  S IBC=$O(^IBM(361.1,IBEOB,15,IBC)) Q:'IBC  D
"RTN","IBCECOB1",189,0)
 . K EOBADJ M EOBADJ=^IBM(361.1,IBEOB,15,IBC,1)
"RTN","IBCECOB1",190,0)
 . S IBPTRES=IBPTRES+$$CALCPR^IBCEU0(.EOBADJ)
"RTN","IBCECOB1",191,0)
 Q IBPTRES
"RTN","IBCECOB1",192,0)
 ;
"RTN","IBCECOB1",193,0)
ELIG(IBEOB) ; Function to determine if an EOB entry is eligible for
"RTN","IBCECOB1",194,0)
 ; inclusion on the MRA or COB management worklist or not.
"RTN","IBCECOB1",195,0)
 ; IBEOB - ien into file 361.1 (required)
"RTN","IBCECOB1",196,0)
 ; Returns 1 if EOB should appear on the worklist
"RTN","IBCECOB1",197,0)
 ; Returns 0 if EOB should not appear on the worklist
"RTN","IBCECOB1",198,0)
 ;
"RTN","IBCECOB1",199,0)
 NEW ELIG,IB3611,IBIFN
"RTN","IBCECOB1",200,0)
 S ELIG=0,IBEOB=+$G(IBEOB)
"RTN","IBCECOB1",201,0)
 S IB3611=$G(^IBM(361.1,IBEOB,0))
"RTN","IBCECOB1",202,0)
 I $P(IB3611,U,4)'=1 G ELIGX    ; eob type must be correct for this worklist
"RTN","IBCECOB1",203,0)
 I $P(IB3611,U,16)>2 G ELIGX    ; review status must be <= 2
"RTN","IBCECOB1",204,0)
 S IBIFN=+IB3611
"RTN","IBCECOB1",205,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)'=2 G ELIGX  ; Request MRA bill status
"RTN","IBCECOB1",206,0)
 I $D(^IBM(361.1,IBEOB,"ERR")) G ELIGX         ; filing errors
"RTN","IBCECOB1",207,0)
 ;
"RTN","IBCECOB1",208,0)
 S ELIG=1    ; this EOB is eligible for the worklist
"RTN","IBCECOB1",209,0)
 ;
"RTN","IBCECOB1",210,0)
ELIGX ;
"RTN","IBCECOB1",211,0)
 Q ELIG
"RTN","IBCECOB1",212,0)
 ;
"RTN","IBCECOB1",213,0)
WLRMV ; REMOVE FROM EOB WORK LIST
"RTN","IBCECOB1",214,0)
 ; IBDA(IBDA)=IBIFN^IB364^ien of 361.1^user selection seq^user name~duz#
"RTN","IBCECOB1",215,0)
 N IBIFN,IBDA,DIR,DTOUT,DUOUT,DA,DIE,DR,X
"RTN","IBCECOB1",216,0)
 D SEL^IBCECOB2(.IBDA,1)
"RTN","IBCECOB1",217,0)
 S VALMBCK="R"
"RTN","IBCECOB1",218,0)
 S IBDA=$O(IBDA(0)) I 'IBDA Q
"RTN","IBCECOB1",219,0)
 S IBIFN=$P(IBDA(IBDA),U,1) I 'IBIFN Q
"RTN","IBCECOB1",220,0)
 S DIR("A",1)=""
"RTN","IBCECOB1",221,0)
 S DIR("A",2)="    Bill #: "_$$GET1^DIQ(399,IBIFN_", ",.01,"E")
"RTN","IBCECOB1",222,0)
 S DIR("A",3)="   Patient: "_$$GET1^DIQ(399,IBIFN_", ",.02,"E")
"RTN","IBCECOB1",223,0)
 S DIR("A",4)=" Bill Type: "_$$GET1^DIQ(399,IBIFN_", ",.05,"E")
"RTN","IBCECOB1",224,0)
 S DIR("A",5)="Bill Dates: "_$$GET1^DIQ(399,IBIFN_", ",151,"E")_" - "_$$GET1^DIQ(399,IBIFN_", ",152,"E")
"RTN","IBCECOB1",225,0)
 S DIR("A",6)=" "
"RTN","IBCECOB1",226,0)
 S DIR("A")="Are you sure remove this claim from the worklist? "
"RTN","IBCECOB1",227,0)
 S DIR("B")="NO"
"RTN","IBCECOB1",228,0)
 S DIR(0)="YA" D ^DIR K DIR
"RTN","IBCECOB1",229,0)
 I $D(DTOUT)!$D(DUOUT)!'Y Q
"RTN","IBCECOB1",230,0)
 ;FLAG IF USER ANSWERS YES
"RTN","IBCECOB1",231,0)
 S X=$$WLRMVF^IBCECOB1(IBIFN,"RM")
"RTN","IBCECOB1",232,0)
 D BLD^IBCECOB1
"RTN","IBCECOB1",233,0)
 Q
"RTN","IBCECOB1",234,0)
 ;
"RTN","IBCECOB1",235,0)
WLRMVF(IBIFN,METHOD,BKFL) ;
"RTN","IBCECOB1",236,0)
 ; BFKL = 1 means background process, remove NOT initiated by a user
"RTN","IBCECOB1",237,0)
 N SOC,SOCCNT,SOCLIST,STATUS,IBDUZ
"RTN","IBCECOB1",238,0)
 S STATUS=0
"RTN","IBCECOB1",239,0)
 Q:'$G(DUZ) STATUS_"^MISSING DUZ"
"RTN","IBCECOB1",240,0)
 Q:'$G(IBIFN) STATUS_"^MISSING IBIFN"
"RTN","IBCECOB1",241,0)
 Q:'$D(^DGCR(399,IBIFN)) STATUS_"^INVALID IBIFN"
"RTN","IBCECOB1",242,0)
 ; if this is a background process, set user who removed to AUTHORIZER,IB REG
"RTN","IBCECOB1",243,0)
 S IBDUZ=$S($G(BKFL)=1:$$IBREG^IBCAPP(),1:$G(DUZ))
"RTN","IBCECOB1",244,0)
 ; GET DICTIONARY SET OF CODES.
"RTN","IBCECOB1",245,0)
 ; SOC("POINTER")="RM:REMOVE ACTION;PC:PROCESS COB ACTION;CL:CLONE ACTION;"
"RTN","IBCECOB1",246,0)
 D FIELD^DID(399,38,"","POINTER","SOC")
"RTN","IBCECOB1",247,0)
 S SOC=$G(SOC("POINTER"))
"RTN","IBCECOB1",248,0)
 F SOCCNT=1:1:$L(SOC,";")-1 S SOCLIST($P($P(SOC,";",SOCCNT),":",1))=""
"RTN","IBCECOB1",249,0)
 Q:$D(SOCLIST(METHOD))=0 STATUS_"^INVALID METHOD"
"RTN","IBCECOB1",250,0)
 S DA=IBIFN
"RTN","IBCECOB1",251,0)
 S DIE="^DGCR(399,"
"RTN","IBCECOB1",252,0)
 S DR="35////4"                ; AUTO PROCESS, NO LONGER ON WORKLIST
"RTN","IBCECOB1",253,0)
 S:IBDUZ'=-1 DR=DR_";"_"37////"_IBDUZ    ; WHO REMOVED FROM WORKLIST
"RTN","IBCECOB1",254,0)
 S DR=DR_";"_"38////"_METHOD   ; METHOD USED TO REMOVE FROM WORKLIST
"RTN","IBCECOB1",255,0)
 S DR=DR_";"_"39///NOW"        ; DATE STAMP WHEN REMOVED FOR WORKLIST
"RTN","IBCECOB1",256,0)
 D ^DIE
"RTN","IBCECOB1",257,0)
 S STATUS=1
"RTN","IBCECOB1",258,0)
 Q STATUS
"RTN","IBCECOB2")
0^71^B156849928^B78530862
"RTN","IBCECOB2",1,0)
IBCECOB2 ;ALB/CXW - IB COB MANAGEMENT SCREEN ;16-JUN-1999
"RTN","IBCECOB2",2,0)
 ;;2.0;INTEGRATED BILLING;**137,155,433,432**;21-MAR-1994;Build 192
"RTN","IBCECOB2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCECOB2",4,0)
 ;
"RTN","IBCECOB2",5,0)
EDI ;history detail display
"RTN","IBCECOB2",6,0)
 N IBIFN,IBDA
"RTN","IBCECOB2",7,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",8,0)
 S IBDA=+$O(IBDA(0)),IBIFN=+$G(IBDA(IBDA))
"RTN","IBCECOB2",9,0)
 D EDI1(IBIFN)
"RTN","IBCECOB2",10,0)
 S VALMBCK="R"
"RTN","IBCECOB2",11,0)
 Q
"RTN","IBCECOB2",12,0)
 ;
"RTN","IBCECOB2",13,0)
EDI1(IBIFN) ;
"RTN","IBCECOB2",14,0)
 N DFN
"RTN","IBCECOB2",15,0)
 Q:'IBIFN
"RTN","IBCECOB2",16,0)
 S DFN=$P($G(^DGCR(399,IBIFN,0)),U,2)
"RTN","IBCECOB2",17,0)
 D EN^VALM("IBJT EDI STATUS")
"RTN","IBCECOB2",18,0)
 K:$D(IBFASTXT) IBFASTXT
"RTN","IBCECOB2",19,0)
 Q
"RTN","IBCECOB2",20,0)
 ;
"RTN","IBCECOB2",21,0)
EDI2(IBIFN) ;
"RTN","IBCECOB2",22,0)
 N DFN
"RTN","IBCECOB2",23,0)
 Q:'IBIFN
"RTN","IBCECOB2",24,0)
 S DFN=$P($G(^DGCR(399,IBIFN,0)),U,2)
"RTN","IBCECOB2",25,0)
 D EN^VALM("IBJT EDI STATUS ALONE")
"RTN","IBCECOB2",26,0)
 K:$D(IBFASTXT) IBFASTXT
"RTN","IBCECOB2",27,0)
 Q
"RTN","IBCECOB2",28,0)
 ;
"RTN","IBCECOB2",29,0)
CSA ;claims status awaiting resolution
"RTN","IBCECOB2",30,0)
 N IBDAX
"RTN","IBCECOB2",31,0)
 D EN^IBCECSA
"RTN","IBCECOB2",32,0)
 I $D(IBFASTXT) K IBFASTXT
"RTN","IBCECOB2",33,0)
 S VALMBCK="R"
"RTN","IBCECOB2",34,0)
 Q
"RTN","IBCECOB2",35,0)
 ;
"RTN","IBCECOB2",36,0)
RVEOB ;Review EOB
"RTN","IBCECOB2",37,0)
 D FULL^VALM1 W !
"RTN","IBCECOB2",38,0)
 N IBDA,IBIFN,IBCMT,IBSEL
"RTN","IBCECOB2",39,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",40,0)
 S IBSEL=+$O(IBDA(0))
"RTN","IBCECOB2",41,0)
 S IBDA=$G(IBDA(IBSEL))
"RTN","IBCECOB2",42,0)
 S IBIFN=$P(IBDA,U),IBDA=$P(IBDA,U,3)
"RTN","IBCECOB2",43,0)
 I 'IBIFN G VEOBQ
"RTN","IBCECOB2",44,0)
 S IBCMT=$G(^TMP("IBCECOB1",$J,IBSEL))
"RTN","IBCECOB2",45,0)
 I IBCMT'="" D EN^VALM("IBCEM MRA REVIEW")
"RTN","IBCECOB2",46,0)
VEOBQ K ^TMP("IBCECOC",$J)
"RTN","IBCECOB2",47,0)
 S VALMBCK="R"
"RTN","IBCECOB2",48,0)
 Q
"RTN","IBCECOB2",49,0)
 ;
"RTN","IBCECOB2",50,0)
TPJI ;Third Party joint Inquiry
"RTN","IBCECOB2",51,0)
 N IBDA,IBIFN
"RTN","IBCECOB2",52,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",53,0)
 S IBDA=+$O(IBDA(0)),IBIFN=+$G(IBDA(IBDA))
"RTN","IBCECOB2",54,0)
 I IBDA="" G TPJIQ
"RTN","IBCECOB2",55,0)
 D TPJI1(IBIFN)
"RTN","IBCECOB2",56,0)
TPJIQ S VALMBCK="R"
"RTN","IBCECOB2",57,0)
 Q
"RTN","IBCECOB2",58,0)
 ;
"RTN","IBCECOB2",59,0)
TPJI1(IBIFN) ;
"RTN","IBCECOB2",60,0)
 N DFN,IBNOTPJI
"RTN","IBCECOB2",61,0)
 Q:'IBIFN
"RTN","IBCECOB2",62,0)
 S DFN=$P($G(^DGCR(399,IBIFN,0)),U,2),IBNOTPJI=1
"RTN","IBCECOB2",63,0)
 D EN^VALM("IBJT CLAIM INFO")
"RTN","IBCECOB2",64,0)
 K:$D(IBFASTXT) IBFASTXT
"RTN","IBCECOB2",65,0)
 Q
"RTN","IBCECOB2",66,0)
 ;
"RTN","IBCECOB2",67,0)
PBILL ;Print bill
"RTN","IBCECOB2",68,0)
 N IBIFN,IBDA,IBRESUB
"RTN","IBCECOB2",69,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",70,0)
 S IBDA=$O(IBDA(0)),IBIFN=+$G(IBDA(+IBDA))
"RTN","IBCECOB2",71,0)
 I IBDA="" G PBOUT
"RTN","IBCECOB2",72,0)
 S IBRESUB=$$RESUB^IBCECSA4(IBIFN,1,"P")
"RTN","IBCECOB2",73,0)
 I IBRESUB'>0 W !,*7,"This is not a transmittable bill or review not needed" D PAUSE^VALM1 G PBOUT
"RTN","IBCECOB2",74,0)
 I IBRESUB=2 D  G PBOUT
"RTN","IBCECOB2",75,0)
 . N IB364
"RTN","IBCECOB2",76,0)
 . S IB364=+$P($G(IBDA(IBDA)),U,2)
"RTN","IBCECOB2",77,0)
 . D PRINT1^IBCEM03(IBIFN,.IBDA,IB364)
"RTN","IBCECOB2",78,0)
 D PBILL1(IBIFN)
"RTN","IBCECOB2",79,0)
PBOUT S VALMBCK="R"
"RTN","IBCECOB2",80,0)
 Q
"RTN","IBCECOB2",81,0)
 ;
"RTN","IBCECOB2",82,0)
PMRA ;Print MRA
"RTN","IBCECOB2",83,0)
 N IBIFN,IBDA
"RTN","IBCECOB2",84,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",85,0)
 S IBDA=$O(IBDA(0)),IBIFN=+$G(IBDA(+IBDA))
"RTN","IBCECOB2",86,0)
 G:'IBIFN PRMQ
"RTN","IBCECOB2",87,0)
 D MRA^IBCEMRAA(.IBIFN)
"RTN","IBCECOB2",88,0)
PRMQ S VALMBCK="R"
"RTN","IBCECOB2",89,0)
 Q
"RTN","IBCECOB2",90,0)
PBILL1(IBIFN) ;
"RTN","IBCECOB2",91,0)
 N IBAC1,IBAC,DFN
"RTN","IBCECOB2",92,0)
 Q:'IBIFN
"RTN","IBCECOB2",93,0)
 S DFN=$P($G(^DGCR(399,IBIFN,0)),U,2)
"RTN","IBCECOB2",94,0)
 S IBAC=4,IBAC1=1
"RTN","IBCECOB2",95,0)
 D 4^IBCB1
"RTN","IBCECOB2",96,0)
 D FULL^VALM1,PAUSE^VALM1
"RTN","IBCECOB2",97,0)
 Q
"RTN","IBCECOB2",98,0)
 ;
"RTN","IBCECOB2",99,0)
CANCEL ;Cancel bill
"RTN","IBCECOB2",100,0)
 ; IBDA(IBDA)=IBIFN^IB364^ien of 361.1^user selection seq^user name~duz#
"RTN","IBCECOB2",101,0)
 ;
"RTN","IBCECOB2",102,0)
 N IBIFN,IBDA,IB364,IBEOBIFN,X,IBDENCT
"RTN","IBCECOB2",103,0)
 ;
"RTN","IBCECOB2",104,0)
 ; Check for security key
"RTN","IBCECOB2",105,0)
 I '$$KCHK^XUSRB("IB AUTHORIZE") D  G CANCELQ
"RTN","IBCECOB2",106,0)
 . D FULL^VALM1 S VALMBCK="R"
"RTN","IBCECOB2",107,0)
 . W !!?5,"You don't hold the proper security key to access this function."
"RTN","IBCECOB2",108,0)
 . W !?5,"The necessary key is IB AUTHORIZE.  Please see your manager."
"RTN","IBCECOB2",109,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",110,0)
 . Q
"RTN","IBCECOB2",111,0)
 ;
"RTN","IBCECOB2",112,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",113,0)
 S IBDA=$O(IBDA(0)),IBIFN=+$G(IBDA(+IBDA)),IB364=$P($G(IBDA(+IBDA)),U,2)
"RTN","IBCECOB2",114,0)
 S IBEOBIFN=$P($G(IBDA(+IBDA)),U,3)
"RTN","IBCECOB2",115,0)
 ;
"RTN","IBCECOB2",116,0)
 ; IB*2.0*432 - if not mra, only allow cancel of denied claims.  If no EOB, check AR status instead
"RTN","IBCECOB2",117,0)
 I 'IBEOBIFN,$G(IBMRANOT)=1,$P($$ARSTATA^IBJTU4(IBIFN),U)="COLLECTED/CLOSED" D  G CANCELQ
"RTN","IBCECOB2",118,0)
 . D FULL^VALM1 S VALMBCK="R"
"RTN","IBCECOB2",119,0)
 . W !!,*7,"You can only cancel denied claims.  This claim is in a COLLECTED/CLOSED status"
"RTN","IBCECOB2",120,0)
 . W !,"Use Remove Action to remove claim from this worklist."
"RTN","IBCECOB2",121,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",122,0)
 . Q
"RTN","IBCECOB2",123,0)
 ;
"RTN","IBCECOB2",124,0)
 ; IB*2.0*432 - if not mra, only allow cancel of claims with multiple EOBS if none have processed.
"RTN","IBCECOB2",125,0)
 I $G(IBMRANOT)=1,'$$DENCHK(IBIFN,.IBDENCT),$G(IBDENCT)>1 D  G CANCELQ
"RTN","IBCECOB2",126,0)
 . D FULL^VALM1 S VALMBCK="R"
"RTN","IBCECOB2",127,0)
 . W !!,*7,"Multiple EOBs exist for this claim and at least one has EOB status of PROCESSED."
"RTN","IBCECOB2",128,0)
 . W !,"Use Remove Action to remove claim from this worklist."
"RTN","IBCECOB2",129,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",130,0)
 . Q
"RTN","IBCECOB2",131,0)
 ;
"RTN","IBCECOB2",132,0)
 ; IB*2.0*432 - if not mra, only allow cancel of denied claims
"RTN","IBCECOB2",133,0)
 I IBEOBIFN,$G(IBMRANOT)=1,$P($G(^IBM(361.1,IBEOBIFN,0)),U,13)'=2 D  G CANCELQ
"RTN","IBCECOB2",134,0)
 . D FULL^VALM1 S VALMBCK="R"
"RTN","IBCECOB2",135,0)
 . W !!?5,*7,"You can only cancel denied claims."
"RTN","IBCECOB2",136,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",137,0)
 . Q
"RTN","IBCECOB2",138,0)
 ;
"RTN","IBCECOB2",139,0)
 I IBDA D
"RTN","IBCECOB2",140,0)
 . I '$$LOCK^IBCEU0(361.1,IBEOBIFN) Q
"RTN","IBCECOB2",141,0)
 . D CANCEL^IBCEM3(.IBDA,IBIFN,IB364)
"RTN","IBCECOB2",142,0)
 . D UNLOCK^IBCEU0(361.1,IBEOBIFN)
"RTN","IBCECOB2",143,0)
 S VALMBCK="R"
"RTN","IBCECOB2",144,0)
 ;
"RTN","IBCECOB2",145,0)
 ; for non-MRA claims cancelled from worklist, set field 38
"RTN","IBCECOB2",146,0)
 I $G(IBMRANOT)=1,$P($G(^DGCR(399,IBIFN,0)),U,13)=7 S X=$$WLRMVF^IBCECOB1($S($G(IBIFN)'="":IBIFN,1:+$G(IBDA(IBDA))),"CA")
"RTN","IBCECOB2",147,0)
 I $G(IBDA)'="" D BLD^IBCECOB1
"RTN","IBCECOB2",148,0)
CANCELQ Q
"RTN","IBCECOB2",149,0)
 ;
"RTN","IBCECOB2",150,0)
CRD ; Correct Rejected/Denied claim protocol action
"RTN","IBCECOB2",151,0)
 N IBCNCRD
"RTN","IBCECOB2",152,0)
 S IBCNCRD=1
"RTN","IBCECOB2",153,0)
CLONE ; 'Copy/cancel bill' protocol action
"RTN","IBCECOB2",154,0)
 N IBDA,IBQ,IBEOBIFN,IBKEY,X,IBDENCT
"RTN","IBCECOB2",155,0)
 ;
"RTN","IBCECOB2",156,0)
 ; Check for security key
"RTN","IBCECOB2",157,0)
 ;I '$$KCHK^XUSRB("IB AUTHORIZE") D  G CLONEQ
"RTN","IBCECOB2",158,0)
 S IBKEY=$S($G(IBCNCRD)=1:"IB AUTHORIZE",1:"IB CLON")
"RTN","IBCECOB2",159,0)
 I '$$KCHK^XUSRB(IBKEY) D  G CLONEQ
"RTN","IBCECOB2",160,0)
 . D FULL^VALM1 S VALMBCK="R"
"RTN","IBCECOB2",161,0)
 . ;W !!?5,"You don't hold the proper security key to access this function."
"RTN","IBCECOB2",162,0)
 . ;W !?5,"The necessary key is IB AUTHORIZE.  Please see your manager."
"RTN","IBCECOB2",163,0)
 . W !!?5,"You must hold the "_IBKEY_" security key to access this function."
"RTN","IBCECOB2",164,0)
 . W !?5,"Please see your manager."
"RTN","IBCECOB2",165,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",166,0)
 . Q
"RTN","IBCECOB2",167,0)
 ;
"RTN","IBCECOB2",168,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",169,0)
 S IBDA=$O(IBDA(""))
"RTN","IBCECOB2",170,0)
 I IBDA="" G CLONEQ
"RTN","IBCECOB2",171,0)
 ;
"RTN","IBCECOB2",172,0)
 ; IB*2.0*432 - if not mra, only allow cancel of claims with multiple EOBS if none have processed.
"RTN","IBCECOB2",173,0)
 I $G(IBMRANOT)=1,'$$DENCHK(+IBDA(IBDA),.IBDENCT),$G(IBDENCT)>1 D  G CANCELQ
"RTN","IBCECOB2",174,0)
 . D FULL^VALM1 S VALMBCK="R"
"RTN","IBCECOB2",175,0)
 . W !!,*7,"Multiple EOBs exist for this claim and at least one has EOB status of PROCESSED."
"RTN","IBCECOB2",176,0)
 . W !,"Use Remove Action to remove claim from this worklist."
"RTN","IBCECOB2",177,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",178,0)
 . Q
"RTN","IBCECOB2",179,0)
 ;
"RTN","IBCECOB2",180,0)
 S IBEOBIFN=$P($G(IBDA(+IBDA)),U,3)
"RTN","IBCECOB2",181,0)
 I '$$LOCK^IBCEU0(361.1,IBEOBIFN) G CLONEQ
"RTN","IBCECOB2",182,0)
 D COPYCLON(+$G(IBDA(IBDA)),$P($G(IBDA(+IBDA)),U,2),.IBQ)
"RTN","IBCECOB2",183,0)
 D UNLOCK^IBCEU0(361.1,IBEOBIFN)
"RTN","IBCECOB2",184,0)
 ;
"RTN","IBCECOB2",185,0)
 ; for non-MRA claims cloned or corrected from worklist, set field 38
"RTN","IBCECOB2",186,0)
 I $G(IBMRANOT)=1,$G(IBQ)'="" S X=$$WLRMVF^IBCECOB1(+$G(IBDA(IBDA)),$S($G(IBCNCRD)=1:"CR",1:"CL"))
"RTN","IBCECOB2",187,0)
 ;
"RTN","IBCECOB2",188,0)
CLONEQ ;
"RTN","IBCECOB2",189,0)
 S VALMBCK="R"
"RTN","IBCECOB2",190,0)
 D:$G(IBQ)'="" BLD^IBCECOB1
"RTN","IBCECOB2",191,0)
 Q
"RTN","IBCECOB2",192,0)
 ;
"RTN","IBCECOB2",193,0)
COPYCLON(IBIFN,IB364,IBQ) ; Generic entry point for clone a bill from EDI processing
"RTN","IBCECOB2",194,0)
 ; IBIFN = original bill ien
"RTN","IBCECOB2",195,0)
 ; IB364 = the ien of the transmission bill entry in file 364
"RTN","IBCECOB2",196,0)
 ; IBQ = If bill is not cancelled, this is returned as null
"RTN","IBCECOB2",197,0)
 ;        - pass by reference -
"RTN","IBCECOB2",198,0)
 ;
"RTN","IBCECOB2",199,0)
 N IBQUIT,IBCCCC,IBHV,Y,IBCAN,IBCE,IBDA,IBCNCOPY
"RTN","IBCECOB2",200,0)
 ;I '$$CANCKS^IBCEM3("CC",IBIFN) S IBQ="" G CCQ
"RTN","IBCECOB2",201,0)
 I $G(IBCNCRD)'=1,'$$CANCKS^IBCEM3("CC",IBIFN) S IBQ="" G CCQ
"RTN","IBCECOB2",202,0)
 ;
"RTN","IBCECOB2",203,0)
 ;S IBCAN=2,IBCE("EDI")=1,Y=IBIFN,IBCCCC=0,IBHV("IBIFN")=IBIFN,IBHV("IBIFN1")="",IBCNCOPY=1
"RTN","IBCECOB2",204,0)
 S IBCAN=2,IBCE("EDI")=1,Y=IBIFN,IBCCCC=0,IBHV("IBIFN")=IBIFN,IBHV("IBIFN1")=""
"RTN","IBCECOB2",205,0)
 I $G(IBCNCRD)'=1 S IBCNCOPY=1 D ^IBCCC
"RTN","IBCECOB2",206,0)
 I $G(IBCNCRD)=1 D CRD^IBCCC
"RTN","IBCECOB2",207,0)
 ;D ^IBCCC
"RTN","IBCECOB2",208,0)
 S IBIFN=IBHV("IBIFN")
"RTN","IBCECOB2",209,0)
 K IBCE("EDI") S IBQ=1
"RTN","IBCECOB2",210,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)'=7 S IBQ=""
"RTN","IBCECOB2",211,0)
 I IBHV("IBIFN1") D
"RTN","IBCECOB2",212,0)
 . N IBU
"RTN","IBCECOB2",213,0)
 . S IBU="R"
"RTN","IBCECOB2",214,0)
 . S IBNIEN=+IBHV("IBIFN1")
"RTN","IBCECOB2",215,0)
 . I "23"'[$P($G(^DGCR(399,+IBHV("IBIFN1"),0)),U,13) D
"RTN","IBCECOB2",216,0)
 .. W:'$G(IBCEAUTO) !,*7,"Please note: the new bill was not AUTHORIZED.",!,"It can only be accessed now via the normal, non-EDI functions.",!,"Status of new bill is ",$$EXPAND^IBTRE(399,.13,$P(^DGCR(399,IBHV("IBIFN1"),0),U,13)) S IBU="C"
"RTN","IBCECOB2",217,0)
 . D UPDEDI^IBCEM(IB364,IBU)
"RTN","IBCECOB2",218,0)
 ;
"RTN","IBCECOB2",219,0)
 I '$G(IBCEAUTO) D PAUSE^VALM1
"RTN","IBCECOB2",220,0)
CCQ Q
"RTN","IBCECOB2",221,0)
 ;
"RTN","IBCECOB2",222,0)
PRO ; Copy for secondary/tertiary bill
"RTN","IBCECOB2",223,0)
 N VALMY,IBDA,Z,IBIFN,IBIFNH,IB364,IBCE,IBNCN
"RTN","IBCECOB2",224,0)
 ;I '$P($G(^IBE(350.9,1,8)),U,12) D  G PROQ
"RTN","IBCECOB2",225,0)
 I '$P($G(^IBE(350.9,1,8)),U,12),$G(IBMRANOT)'=1 D  G PROQ
"RTN","IBCECOB2",226,0)
 . D FULL^VALM1
"RTN","IBCECOB2",227,0)
 . W !!?5,"MRA's may not be processed at this time."
"RTN","IBCECOB2",228,0)
 . W !?5,"The IB site parameter ""Allow MRA Processing?"" is set to NO."
"RTN","IBCECOB2",229,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",230,0)
 . Q
"RTN","IBCECOB2",231,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",232,0)
 S Z=$O(IBDA(0)),Z=$G(IBDA(+Z)) G:'Z PROQ
"RTN","IBCECOB2",233,0)
 S IBIFN=$P(Z,U),IB364=$P(Z,U,2),IBDA=$P(Z,U,3),IBIFNH=IBIFN
"RTN","IBCECOB2",234,0)
 I 'IBIFN G PROQ
"RTN","IBCECOB2",235,0)
 I '$$LOCK^IBCEU0(361.1,IBDA) G PROQ
"RTN","IBCECOB2",236,0)
 D COBCOPY(IBIFN,IB364,2,IBDA,"BLD^IBCECOB1",.IBNCN)
"RTN","IBCECOB2",237,0)
 D UNLOCK^IBCEU0(361.1,IBDA)
"RTN","IBCECOB2",238,0)
 ;
"RTN","IBCECOB2",239,0)
 ; for non-MRA claims copied from work list, set field 38
"RTN","IBCECOB2",240,0)
 I $G(IBMRANOT)=1,$G(IBNCN)'="",($G(IBNCN)'=$G(IBIFN)) D
"RTN","IBCECOB2",241,0)
 .S X=$$WLRMVF^IBCECOB1($G(IBIFN),"PC")
"RTN","IBCECOB2",242,0)
 .I $P($G(^DGCR(399,+IBNCN,"S")),U,9)'=1 D
"RTN","IBCECOB2",243,0)
 ..W:'$G(IBCEAUTO) !,*7,"Please note: the new bill was not AUTHORIZED.",!,"It can only be accessed now via the normal, non-EDI functions.",!,"Status of new bill is ",$$EXPAND^IBTRE(399,.13,$P(^DGCR(399,IBNCN,0),U,13))
"RTN","IBCECOB2",244,0)
 ..D PAUSE^VALM1
"RTN","IBCECOB2",245,0)
 .D:$G(IBMRANOT)=1 BLD^IBCECOB1
"RTN","IBCECOB2",246,0)
 .Q
"RTN","IBCECOB2",247,0)
 ;
"RTN","IBCECOB2",248,0)
PROQ S VALMBCK="R"
"RTN","IBCECOB2",249,0)
 Q
"RTN","IBCECOB2",250,0)
 ;
"RTN","IBCECOB2",251,0)
COBCOPY(IBIFN,IB364,IBFROM,IBIEN,IBBLD,IBNCN) ; Generic entry point for EDI COB copy
"RTN","IBCECOB2",252,0)
 ; IBIFN = original bill ien
"RTN","IBCECOB2",253,0)
 ; IB364 = the ien of the transmission bill entry in file 364
"RTN","IBCECOB2",254,0)
 ; IBFROM = 1 if called from CSA, 2 if called from COB/EOB processing
"RTN","IBCECOB2",255,0)
 ; IBIEN = entry in 361 (IBFROM=1) or 361.1 (IBFROM=2) being processed
"RTN","IBCECOB2",256,0)
 ; IBBLD = the name of the entrypoint that will rebuild the display
"RTN","IBCECOB2",257,0)
 ; IBNCN = by reference, returns the new claim ien if user completed the Copy process
"RTN","IBCECOB2",258,0)
 ;
"RTN","IBCECOB2",259,0)
 N IBCBASK,IBCBCOPY,IBCAN,IBIFNH,IBNSTAT,IBOSTAT,IBPRCOB,IBSECHK,IBLMVAR,IBAC,IBMRAIEN,IBDA,IBAUTO
"RTN","IBCECOB2",260,0)
 N IBCOB,IBCOBIL,IBCOBN,IBINS,IBINSN,IBINSOLD,IBMRAIO,IBMRAO,IBNMOLD,IBQUIT
"RTN","IBCECOB2",261,0)
 S (IBCBASK,IBCBCOPY,IBCAN,IBAUTO)=1,(IBPRCOB,IBSECHK)=0,(IBMRAIEN,IBDA)=IBIEN
"RTN","IBCECOB2",262,0)
 I $G(IBMRANOT)'=1,'IB364!'IBIFN W !,"Transmission record is missing for this bill" D PAUSE^VALM1 G COBCOPX
"RTN","IBCECOB2",263,0)
 ;
"RTN","IBCECOB2",264,0)
 S IBIFNH=IBIFN
"RTN","IBCECOB2",265,0)
 I IBFROM=2 S IBPRCOB=1
"RTN","IBCECOB2",266,0)
 ;
"RTN","IBCECOB2",267,0)
 I $S($G(IBMRANOT)=1:$$TOT(IBIFN)'>0,1:$$PREOBTOT^IBCEU0(IBIFN,$G(IBMRANOT))'>0) D  G COBCOPX
"RTN","IBCECOB2",268,0)
 . D FULL^VALM1
"RTN","IBCECOB2",269,0)
 . W !!?5,"There is no "_$S($G(IBMRANOT)=1:"balance remaining",1:"patient responsibility")_" for this claim."
"RTN","IBCECOB2",270,0)
 . W !?5,"This claim may not be processed."
"RTN","IBCECOB2",271,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",272,0)
 . Q
"RTN","IBCECOB2",273,0)
 ;
"RTN","IBCECOB2",274,0)
 I $G(IBDA)'="",$P($G(^IBM(361.1,IBDA,0)),U,16)="1.5" D  G COBCOPX
"RTN","IBCECOB2",275,0)
 . W !!,"This claim has already been processed as a sec/tert claim."
"RTN","IBCECOB2",276,0)
 . W !,"You will need to complete the authorization process for this claim."
"RTN","IBCECOB2",277,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",278,0)
 . D AUTH
"RTN","IBCECOB2",279,0)
 . Q
"RTN","IBCECOB2",280,0)
 ;
"RTN","IBCECOB2",281,0)
 ; If multiple EOBs and one is processed, make sure collected closed.
"RTN","IBCECOB2",282,0)
 I $G(IBMRANOT),$$CCCHK(IBIFN)<0 D  G COBCOPX
"RTN","IBCECOB2",283,0)
 . W !,"Multiple EOBs exist for this claim and at least one has EOB status of PROCESSED."
"RTN","IBCECOB2",284,0)
 . W !,"Claim cannot be sent to next payer until AR status is Collected/Closed."
"RTN","IBCECOB2",285,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",286,0)
 . Q
"RTN","IBCECOB2",287,0)
 ;
"RTN","IBCECOB2",288,0)
 ; Get out if no next payer
"RTN","IBCECOB2",289,0)
 I '$P($G(^DGCR(399,IBIFN,"I"_($$COBN^IBCEF(IBIFN)+1))),U,1) D  G COBCOPX
"RTN","IBCECOB2",290,0)
 . W !,"There is no next payer for this bill"
"RTN","IBCECOB2",291,0)
 . D PAUSE^VALM1
"RTN","IBCECOB2",292,0)
 . Q
"RTN","IBCECOB2",293,0)
 ;
"RTN","IBCECOB2",294,0)
 D DSPRB^IBCCCB0(IBIFN)        ; display related bills
"RTN","IBCECOB2",295,0)
 S IBCE("EDI")=1
"RTN","IBCECOB2",296,0)
 D CHKB^IBCCCB                 ; process COB, create secondary bill
"RTN","IBCECOB2",297,0)
 S IBNCN=$G(IBCE("EDI","NEW")) ; get new claim ien
"RTN","IBCECOB2",298,0)
 S IBIFN=IBIFNH
"RTN","IBCECOB2",299,0)
 I IBSECHK G COBCOPX
"RTN","IBCECOB2",300,0)
 ;
"RTN","IBCECOB2",301,0)
 ; if user came from CBW, no need to view and authorize a 2nd time (already happens in IBCCCB)
"RTN","IBCECOB2",302,0)
 Q:$G(IBMRANOT)=1
"RTN","IBCECOB2",303,0)
 S IBV=1 D VIEW^IBCB2          ; display billing screens
"RTN","IBCECOB2",304,0)
 D AUTH                        ; authorize bill
"RTN","IBCECOB2",305,0)
COBCOPX ;
"RTN","IBCECOB2",306,0)
 Q
"RTN","IBCECOB2",307,0)
 ;
"RTN","IBCECOB2",308,0)
AUTH ; procedure to authorize the claim and refresh the screen
"RTN","IBCECOB2",309,0)
 K ^UTILITY($J) S IBAC=1,IBQUIT=0 D 3^IBCB1
"RTN","IBCECOB2",310,0)
 I '$D(IOUON)!'$D(IORVON) D ENS^%ZISS
"RTN","IBCECOB2",311,0)
 I $P($G(^IBM(361.1,IBMRAIEN,0)),U,16)=3 D UPDEDI^IBCEM(IB364,"Z")
"RTN","IBCECOB2",312,0)
 I $G(IBBLD)'="" D @IBBLD
"RTN","IBCECOB2",313,0)
 D PAUSE^VALM1
"RTN","IBCECOB2",314,0)
AUTHX ;
"RTN","IBCECOB2",315,0)
 Q
"RTN","IBCECOB2",316,0)
 ;
"RTN","IBCECOB2",317,0)
RES ;Resubmit bill by print
"RTN","IBCECOB2",318,0)
 N IBDA,IBIFN,IB364
"RTN","IBCECOB2",319,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",320,0)
 S IBDA=+$O(IBDA(0)),IBIFN=+$G(IBDA(+IBDA)),IB364=+$P($G(IBDA(IBDA)),U,2)
"RTN","IBCECOB2",321,0)
 I 'IBIFN G RESQ
"RTN","IBCECOB2",322,0)
 D PRINT1^IBCEM03(IBIFN,.IBDA,IB364)
"RTN","IBCECOB2",323,0)
 D PAUSE^VALM1
"RTN","IBCECOB2",324,0)
 I $G(IBDA)'="" D BLD^IBCECOB1
"RTN","IBCECOB2",325,0)
RESQ S VALMBCK="R"
"RTN","IBCECOB2",326,0)
 Q
"RTN","IBCECOB2",327,0)
 ;
"RTN","IBCECOB2",328,0)
EBI ;View an unauthorized transmitted bill
"RTN","IBCECOB2",329,0)
 N IBFLG,IBDA,IBIFN,IB364,DFN
"RTN","IBCECOB2",330,0)
 K ^TMP($J,"IBBILL")
"RTN","IBCECOB2",331,0)
 D FULL^VALM1
"RTN","IBCECOB2",332,0)
 ;
"RTN","IBCECOB2",333,0)
 D SEL(.IBDA,1)
"RTN","IBCECOB2",334,0)
 S IBDA=+$O(IBDA(""))
"RTN","IBCECOB2",335,0)
 S IBIFN=+$G(IBDA(IBDA)),IB364=+$P($G(IBDA(IBDA)),U,2),DFN=$P($G(^DGCR(399,IBIFN,0)),U,2)
"RTN","IBCECOB2",336,0)
 G:'IBIFN EDITQ
"RTN","IBCECOB2",337,0)
 S IBV=1 D VIEW^IBCB2
"RTN","IBCECOB2",338,0)
 I '$D(IOUON)!'$D(IORVON) D ENS^%ZISS
"RTN","IBCECOB2",339,0)
 D BLD^IBCECOB1
"RTN","IBCECOB2",340,0)
EDITQ S VALMBCK="R"
"RTN","IBCECOB2",341,0)
 Q
"RTN","IBCECOB2",342,0)
 ;
"RTN","IBCECOB2",343,0)
SEL(IBDA,ONE) ; Select entry(s) from list
"RTN","IBCECOB2",344,0)
 ; IBDA = array returned if selections made
"RTN","IBCECOB2",345,0)
 ;    IBDA(n)=ien of bill selected (file 399)
"RTN","IBCECOB2",346,0)
 ; ONE = if set to 1, only one selection can be made at a time
"RTN","IBCECOB2",347,0)
 N IB
"RTN","IBCECOB2",348,0)
 K IBDA
"RTN","IBCECOB2",349,0)
 D FULL^VALM1
"RTN","IBCECOB2",350,0)
 D EN^VALM2($G(XQORNOD(0)),$S('$G(ONE):"",1:"S"))
"RTN","IBCECOB2",351,0)
 S IBDA=0 F  S IBDA=$O(VALMY(IBDA)) Q:'IBDA  S IBDA(IBDA)=$P($G(^TMP("IBCECOB",$J,+IBDA)),U,2,6)
"RTN","IBCECOB2",352,0)
 Q
"RTN","IBCECOB2",353,0)
 ;
"RTN","IBCECOB2",354,0)
EXIT ; Exit out of COB
"RTN","IBCECOB2",355,0)
 D FASTEXIT^IBCEFG4
"RTN","IBCECOB2",356,0)
 I $G(IBFASTXT)=1 S IBFASTXT=5
"RTN","IBCECOB2",357,0)
 Q
"RTN","IBCECOB2",358,0)
 ;
"RTN","IBCECOB2",359,0)
TOT(IBIFN) ; calculate if any balance remaining on non-MRA claim
"RTN","IBCECOB2",360,0)
 ; IBIFN = claim ien
"RTN","IBCECOB2",361,0)
 N IBPRTOT
"RTN","IBCECOB2",362,0)
 ; total up the payer paid amounts
"RTN","IBCECOB2",363,0)
 S IBPRTOT=$$EOBTOT^IBCEU1(IBIFN,$$COBN^IBCEF(IBIFN))
"RTN","IBCECOB2",364,0)
 I IBPRTOT<0 S IBPRTOT=0      ; don't allow negative prior payment or offset
"RTN","IBCECOB2",365,0)
 ; Subtract payer paid amount from Total Charges from BILLS/CLAIMS (#399) file
"RTN","IBCECOB2",366,0)
 Q $P($G(^DGCR(399,IBIFN,"U1")),U,1)-IBPRTOT
"RTN","IBCECOB2",367,0)
 ;
"RTN","IBCECOB2",368,0)
CCCHK(IBIFN) ; If there are multiple EOBS on file for this claim, then one of them must be processed and AR status must be collected closed to process.
"RTN","IBCECOB2",369,0)
 ; returns 1 if true
"RTN","IBCECOB2",370,0)
 ;         0 if there are not multiple EOBs or mulitple EOBs and none are processed (all denials)
"RTN","IBCECOB2",371,0)
 ;        -1 if false
"RTN","IBCECOB2",372,0)
 N IBDA,IBCT,IBPROC,IBARSTAT,IBEOBNDX,IBEOB
"RTN","IBCECOB2",373,0)
 S IBCT=0,IBPROC=0
"RTN","IBCECOB2",374,0)
 F IBEOBNDX="B","C" D
"RTN","IBCECOB2",375,0)
 .S IBDA=0 F  S IBDA=$O(^IBM(361.1,IBEOBNDX,IBIFN,IBDA)) Q:'+IBDA  D
"RTN","IBCECOB2",376,0)
 ..Q:$D(IBEOB(IBDA))
"RTN","IBCECOB2",377,0)
 ..Q:$P($G(^IBM(361.1,IBDA,0)),U,4)=1    ; only count EOBs
"RTN","IBCECOB2",378,0)
 ..S IBEOB(IBDA)="",IBCT=IBCT+1
"RTN","IBCECOB2",379,0)
 ..I $P($G(^IBM(361.1,IBDA,0)),U,13)=1 S IBPROC=1
"RTN","IBCECOB2",380,0)
 I IBCT<2 Q 0  ; less than 2 EOBs
"RTN","IBCECOB2",381,0)
 I 'IBPROC Q 0  ; no EOBs with status processed 
"RTN","IBCECOB2",382,0)
 S IBARSTAT=$$ARSTATA^IBJTU4(IBIFN)  ; get status of AR
"RTN","IBCECOB2",383,0)
 I $P(IBARSTAT,U)="COLLECTED/CLOSED" Q 1
"RTN","IBCECOB2",384,0)
 Q -1
"RTN","IBCECOB2",385,0)
 ;
"RTN","IBCECOB2",386,0)
DENCHK(IBIFN,IBCT) ; Make sure all EOBs from this claim are denied.
"RTN","IBCECOB2",387,0)
 ; Input: IBIFN - IEN to 399
"RTN","IBCECOB2",388,0)
 ;        IBCT - by reference. Return count of EOBs.
"RTN","IBCECOB2",389,0)
 ; Output: returns 1 if there is at least one EOB and that none of the EOBS are processed.
"RTN","IBCECOB2",390,0)
 ; otherwise 0
"RTN","IBCECOB2",391,0)
 ;
"RTN","IBCECOB2",392,0)
 N IBDA,IBPROC,IBEOBNDX,IBEOB
"RTN","IBCECOB2",393,0)
 S IBCT=0,IBPROC=0
"RTN","IBCECOB2",394,0)
 F IBEOBNDX="B","C" D
"RTN","IBCECOB2",395,0)
 .S IBDA=0 F  S IBDA=$O(^IBM(361.1,IBEOBNDX,IBIFN,IBDA)) Q:'+IBDA  D
"RTN","IBCECOB2",396,0)
 ..Q:$D(IBEOB(IBDA))
"RTN","IBCECOB2",397,0)
 ..Q:$P($G(^IBM(361.1,IBDA,0)),U,4)=1    ; only count EOBs
"RTN","IBCECOB2",398,0)
 ..S IBEOB(IBDA)="",IBCT=IBCT+1
"RTN","IBCECOB2",399,0)
 ..I $P($G(^IBM(361.1,IBDA,0)),U,13)=1 S IBPROC=1
"RTN","IBCECOB2",400,0)
 I IBCT,'IBPROC Q 1  ; there is at least one EOB and none of the EOBS are processed.
"RTN","IBCECOB2",401,0)
 Q 0  ;
"RTN","IBCECOB6")
0^17^B54280340^B23813020
"RTN","IBCECOB6",1,0)
IBCECOB6 ;YMG/BP - IB COB MANAGEMENT SCREEN ;26-Dec-2007
"RTN","IBCECOB6",2,0)
 ;;2.0;INTEGRATED BILLING;**377,432**;21-MAR-94;Build 192
"RTN","IBCECOB6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCECOB6",4,0)
 ;
"RTN","IBCECOB6",5,0)
EN ; view MRA comments - entry point from MRA Worklist
"RTN","IBCECOB6",6,0)
 N IBDA,IBIFN
"RTN","IBCECOB6",7,0)
 ; we need to select a claim and set IBIFN
"RTN","IBCECOB6",8,0)
 D SEL^IBCECOB2(.IBDA,1) S:$O(IBDA(0)) IBIFN=+IBDA($O(IBDA(0)))
"RTN","IBCECOB6",9,0)
 D:$G(IBIFN) EN^VALM("IBCEM MRA COMMENTS")
"RTN","IBCECOB6",10,0)
 S VALMBCK="R"
"RTN","IBCECOB6",11,0)
 Q
"RTN","IBCECOB6",12,0)
 ;
"RTN","IBCECOB6",13,0)
HDR ; header code
"RTN","IBCECOB6",14,0)
 S VALMHDR(1)=$S($G(IBMRANOT):"EOB",1:"MRA")_" Claim "_$P($G(^DGCR(399,IBIFN,0)),U)   ;WCJ IB*2.0*432
"RTN","IBCECOB6",15,0)
 S:$G(IBMRANOT)=1 VALM("TITLE")="Claim Comment History"
"RTN","IBCECOB6",16,0)
 Q
"RTN","IBCECOB6",17,0)
 ;
"RTN","IBCECOB6",18,0)
INIT ; init variables and list array
"RTN","IBCECOB6",19,0)
 N CMLN,CMSTR,I,IB0,IBDATE,IBDUZ,LEN,LN,MAX,POS,STR
"RTN","IBCECOB6",20,0)
 S LN=1
"RTN","IBCECOB6",21,0)
 ; IB*2.0*432 - if user came from new CBW, show all comments (AR & IB) 
"RTN","IBCECOB6",22,0)
 I $G(IBMRANOT)=1 D BLD^IBJTTC Q
"RTN","IBCECOB6",23,0)
 ; check if we have any comments to display - IB*2.0*432 add EOB claim comments
"RTN","IBCECOB6",24,0)
 ; I '$D(^DGCR(399,IBIFN,"TXC","B")) D  Q
"RTN","IBCECOB6",25,0)
 I '$D(^DGCR(399,IBIFN,"TXC","B"))&('$D(^DGCR(399,IBIFN,"TXC2","B"))) D  Q
"RTN","IBCECOB6",26,0)
 .S STR="",STR=$$SETFLD^VALM1("No comments found for this claim.",STR,"MESSAGE")
"RTN","IBCECOB6",27,0)
 .D SET^VALM10(LN,STR),FLDCTRL^VALM10(LN,"MESSAGE",IOINHI,IOINORM)
"RTN","IBCECOB6",28,0)
 .S VALMCNT=LN
"RTN","IBCECOB6",29,0)
 .Q
"RTN","IBCECOB6",30,0)
 ; loop through all available comments
"RTN","IBCECOB6",31,0)
 S IBDATE="" F  S IBDATE=$O(^DGCR(399,IBIFN,"TXC","B",IBDATE),-1) Q:IBDATE=""  D
"RTN","IBCECOB6",32,0)
 .S I=$O(^DGCR(399,IBIFN,"TXC","B",IBDATE,"")),IB0=^DGCR(399,IBIFN,"TXC",I,0),IBDUZ=$P(IB0,U,2)
"RTN","IBCECOB6",33,0)
 .D SET^VALM10(LN,"") S LN=LN+1
"RTN","IBCECOB6",34,0)
 .S STR="",STR=$$SETFLD^VALM1("Entered by "_$$GET1^DIQ(200,IBDUZ,.01)_" on "_$$FMTE^XLFDT(IBDATE,"2Z"),STR,"ENTERED")
"RTN","IBCECOB6",35,0)
 .D SET^VALM10(LN,STR),FLDCTRL^VALM10(LN) S LN=LN+1
"RTN","IBCECOB6",36,0)
 .; loop through comment lines
"RTN","IBCECOB6",37,0)
 .S CMLN=0 F  S CMLN=$O(^DGCR(399,IBIFN,"TXC",I,1,CMLN)) Q:CMLN=""  D
"RTN","IBCECOB6",38,0)
 ..S CMSTR=^DGCR(399,IBIFN,"TXC",I,1,CMLN,0) ; complete comment line
"RTN","IBCECOB6",39,0)
 ..S MAX=$P(VALMDDF("MESSAGE"),U,3) ; max. number of characters in the "MESSAGE" field
"RTN","IBCECOB6",40,0)
 ..; if comment line is too long, split it into chunks that fit in the "MESSAGE" field
"RTN","IBCECOB6",41,0)
 ..F  D  Q:CMSTR=""
"RTN","IBCECOB6",42,0)
 ...S (POS,LEN)=$L(CMSTR) I LEN>MAX S POS=MAX F  Q:POS=0  Q:$E(CMSTR,POS)=" "  S POS=POS-1 ; try to make a split on a space char.
"RTN","IBCECOB6",43,0)
 ...S:'POS POS=MAX ; if we couldn't find a space, split at the max. number of chars
"RTN","IBCECOB6",44,0)
 ...; populate list manager array with this substring and remove it from the comment line
"RTN","IBCECOB6",45,0)
 ...S STR="",STR=$$SETFLD^VALM1($E(CMSTR,1,POS),STR,"MESSAGE") D SET^VALM10(LN,STR) S LN=LN+1,CMSTR=$E(CMSTR,POS+1,LEN)
"RTN","IBCECOB6",46,0)
 ...Q
"RTN","IBCECOB6",47,0)
 ..Q
"RTN","IBCECOB6",48,0)
 .Q
"RTN","IBCECOB6",49,0)
 D EOBCM
"RTN","IBCECOB6",50,0)
 S VALMCNT=LN-1,VALMBG=1
"RTN","IBCECOB6",51,0)
 D CLEAN^DILF
"RTN","IBCECOB6",52,0)
 Q
"RTN","IBCECOB6",53,0)
 ;
"RTN","IBCECOB6",54,0)
HELP ; help code
"RTN","IBCECOB6",55,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCECOB6",56,0)
 Q
"RTN","IBCECOB6",57,0)
 ;
"RTN","IBCECOB6",58,0)
EXIT ; exit code
"RTN","IBCECOB6",59,0)
 N COL,I,LN,STR,WIDTH,Z0,Z1,Z2,IBWRKLST   ;WCJ IB*2.0*432
"RTN","IBCECOB6",60,0)
 ; update status for this claim in MRW list - could have been changed from View Comments
"RTN","IBCECOB6",61,0)
 S (Z0,Z1)=0,Z2=""
"RTN","IBCECOB6",62,0)
 S IBWRKLST=$S($G(IBMRANOT):"IBCEM COB MANAGEMENT",1:"IBCEM MRA MANAGEMENT")   ;WCJ IB*2.0*432
"RTN","IBCECOB6",63,0)
 S Z0=$$FIND1^DIC(409.61,,"X",IBWRKLST)   ;WCJ IB*2.0*432
"RTN","IBCECOB6",64,0)
 S:+Z0 Z1=$$FIND1^DIC(409.621,","_Z0_",","X","BILL")
"RTN","IBCECOB6",65,0)
 S:+Z1 Z2=Z1_","_Z0_","
"RTN","IBCECOB6",66,0)
 I Z2'="" D
"RTN","IBCECOB6",67,0)
 .S COL=$$GET1^DIQ(409.621,Z2,.02)
"RTN","IBCECOB6",68,0)
 .S WIDTH=$$GET1^DIQ(409.621,Z2,.03)
"RTN","IBCECOB6",69,0)
 .Q:COL=""!(WIDTH="")
"RTN","IBCECOB6",70,0)
 .S LN=($O(VALMY(""))-1)*3+2,STR=$E($$BN1^PRCAFN(IBIFN)_$S($P($G(^DGCR(399,IBIFN,"TX")),U,10)=1:"*",1:" "),1,WIDTH)
"RTN","IBCECOB6",71,0)
 .F I=1:1:$L(STR) S $E(^TMP("IBCECOB",$J,LN,0),COL+I-1)=$E(STR,I)
"RTN","IBCECOB6",72,0)
 .Q
"RTN","IBCECOB6",73,0)
 ; clean up variables
"RTN","IBCECOB6",74,0)
 D CLEAR^VALM1,CLEAN^VALM10
"RTN","IBCECOB6",75,0)
 Q
"RTN","IBCECOB6",76,0)
 ;
"RTN","IBCECOB6",77,0)
CMNTW ; enter MRA comments - entry point from MRA Worklist screen
"RTN","IBCECOB6",78,0)
 ; we need to select a claim and set IBIFN
"RTN","IBCECOB6",79,0)
 N IBDA,IBIFN,MRAFLG
"RTN","IBCECOB6",80,0)
 S MRAFLG=1
"RTN","IBCECOB6",81,0)
 D SEL^IBCECOB2(.IBDA,1) S:$O(IBDA(0)) IBIFN=+IBDA($O(IBDA(0))) D:$G(IBIFN) CMNT
"RTN","IBCECOB6",82,0)
 S VALMBCK="R"
"RTN","IBCECOB6",83,0)
 Q
"RTN","IBCECOB6",84,0)
 ;
"RTN","IBCECOB6",85,0)
CMNTV ; enter MRA comments - entry point from View MRA Comments screen
"RTN","IBCECOB6",86,0)
 ; IBIFN should already be defined, only need to set a flag used to rebuild list of comments
"RTN","IBCECOB6",87,0)
 N MRAFLG,VCFLG
"RTN","IBCECOB6",88,0)
 S (MRAFLG,VCFLG)=1 D:$G(IBIFN) CMNT
"RTN","IBCECOB6",89,0)
 S VALMBCK="R"
"RTN","IBCECOB6",90,0)
 Q
"RTN","IBCECOB6",91,0)
 ;
"RTN","IBCECOB6",92,0)
CMNT ; enter MRA comments, called from entry points CMNTV and CMNTW above. Also called from ARCA^IBJTA1 (TPJI)
"RTN","IBCECOB6",93,0)
 N DA,DD,DIC,DIK,DLAYGO,X,Y
"RTN","IBCECOB6",94,0)
 W !
"RTN","IBCECOB6",95,0)
 ; make sure this entry is not locked already
"RTN","IBCECOB6",96,0)
 L +^DGCR(399,IBIFN):3 I '$T W !,*7,"Sorry, another user currently editing this entry." D PAUSE^VALM1 Q
"RTN","IBCECOB6",97,0)
 ; IB*2.0*432 - if user came from new CBW, edit new EOB comments, not MRA 
"RTN","IBCECOB6",98,0)
 I $G(IBMRANOT)=1 D EOCMT Q
"RTN","IBCECOB6",99,0)
 K DO S DIC="^DGCR(399,"_IBIFN_",""TXC"",",DIC(0)="L",DIC("DR")=".03",DA(1)=IBIFN,X=$$NOW^XLFDT,DLAYGO=399.077
"RTN","IBCECOB6",100,0)
 D FILE^DICN
"RTN","IBCECOB6",101,0)
 S DA=+Y I DA>0 D
"RTN","IBCECOB6",102,0)
 .; if no comment has been added, delete the created entry in comments subfile
"RTN","IBCECOB6",103,0)
 .I '$D(^DGCR(399,IBIFN,"TXC",DA,1)) S DIK=DIC D ^DIK Q
"RTN","IBCECOB6",104,0)
 .; if we got here, comment has been added successfully
"RTN","IBCECOB6",105,0)
 .; if called from MRA Worklist or View MRA Comments, ask if status needs to be changed
"RTN","IBCECOB6",106,0)
 .I $G(MRAFLG) S DIE=399,DA=IBIFN,DR="28.1"_$S($G(IBMRANOT):"EOB",1:"MRA")_" REVIEW STATUS//REVIEW IN PROCESS" D ^DIE D:'$G(VCFLG) BLD^IBCECOB1  ;WCJ IB*2.0*432
"RTN","IBCECOB6",107,0)
 .; if action was invoked from View Comments, rebuild the list of comments
"RTN","IBCECOB6",108,0)
 .D:$G(VCFLG) CLEAN^VALM10,INIT
"RTN","IBCECOB6",109,0)
 .Q
"RTN","IBCECOB6",110,0)
 D CLEAN^DILF
"RTN","IBCECOB6",111,0)
 L -^DGCR(399,IBIFN)
"RTN","IBCECOB6",112,0)
 Q
"RTN","IBCECOB6",113,0)
 ;
"RTN","IBCECOB6",114,0)
STATUS ; change MRA review status
"RTN","IBCECOB6",115,0)
 N DA,DIE,DR,IBDA,IBIFN,SEL
"RTN","IBCECOB6",116,0)
 D SEL^IBCECOB2(.IBDA,1) S:$O(IBDA(0)) IBIFN=+IBDA($O(IBDA(0))) G:'$G(IBIFN) STATUSX
"RTN","IBCECOB6",117,0)
 W !
"RTN","IBCECOB6",118,0)
 ; make sure this entry is not locked already
"RTN","IBCECOB6",119,0)
 L +^DGCR(399,IBIFN):3 I '$T W !,*7,"Sorry, another user currently editing this entry." D PAUSE^VALM1 G STATUSX
"RTN","IBCECOB6",120,0)
 S DIE=399,DA=IBIFN,DR="28.1"_$S($G(IBMRANOT):"EOB",1:"MRA")_" REVIEW STATUS//REVIEW IN PROCESS" D ^DIE,CLEAN^DILF   ;WCJ*2.0*432
"RTN","IBCECOB6",121,0)
 ;update list manager display
"RTN","IBCECOB6",122,0)
 D BLD^IBCECOB1
"RTN","IBCECOB6",123,0)
 L -^DGCR(399,IBIFN)
"RTN","IBCECOB6",124,0)
STATUSX ;
"RTN","IBCECOB6",125,0)
 S VALMBCK="R"
"RTN","IBCECOB6",126,0)
 Q
"RTN","IBCECOB6",127,0)
EOBCM ; init variables and list array for new EOB Claim Comments IB*2.0*432
"RTN","IBCECOB6",128,0)
 ; loop through all available comments
"RTN","IBCECOB6",129,0)
 S IBDATE="" F  S IBDATE=$O(^DGCR(399,IBIFN,"TXC2","B",IBDATE),-1) Q:IBDATE=""  D
"RTN","IBCECOB6",130,0)
 .S I=$O(^DGCR(399,IBIFN,"TXC2","B",IBDATE,"")),IB0=^DGCR(399,IBIFN,"TXC2",I,0),IBDUZ=$P(IB0,U,2)
"RTN","IBCECOB6",131,0)
 .D SET^VALM10(LN,"") S LN=LN+1
"RTN","IBCECOB6",132,0)
 .S STR="",STR=$$SETFLD^VALM1("Entered by "_$$GET1^DIQ(200,IBDUZ,.01)_" on "_$$FMTE^XLFDT(IBDATE,"2Z"),STR,"ENTERED")
"RTN","IBCECOB6",133,0)
 .D SET^VALM10(LN,STR),FLDCTRL^VALM10(LN) S LN=LN+1
"RTN","IBCECOB6",134,0)
 .; loop through comment lines
"RTN","IBCECOB6",135,0)
 .S CMLN=0 F  S CMLN=$O(^DGCR(399,IBIFN,"TXC2",I,1,CMLN)) Q:CMLN=""  D
"RTN","IBCECOB6",136,0)
 ..S CMSTR=^DGCR(399,IBIFN,"TXC2",I,1,CMLN,0) ; complete comment line
"RTN","IBCECOB6",137,0)
 ..S MAX=$P(VALMDDF("MESSAGE"),U,3) ; max. number of characters in the "MESSAGE" field
"RTN","IBCECOB6",138,0)
 ..; if comment line is too long, split it into chunks that fit in the "MESSAGE" field
"RTN","IBCECOB6",139,0)
 ..F  D  Q:CMSTR=""
"RTN","IBCECOB6",140,0)
 ...S (POS,LEN)=$L(CMSTR) I LEN>MAX S POS=MAX F  Q:POS=0  Q:$E(CMSTR,POS)=" "  S POS=POS-1 ; try to make a split on a space char.
"RTN","IBCECOB6",141,0)
 ...S:'POS POS=MAX ; if we couldn't find a space, split at the max. number of chars
"RTN","IBCECOB6",142,0)
 ...; populate list manager array with this substring and remove it from the comment line
"RTN","IBCECOB6",143,0)
 ...S STR="",STR=$$SETFLD^VALM1($E(CMSTR,1,POS),STR,"MESSAGE") D SET^VALM10(LN,STR) S LN=LN+1,CMSTR=$E(CMSTR,POS+1,LEN)
"RTN","IBCECOB6",144,0)
 ...Q
"RTN","IBCECOB6",145,0)
 ..Q
"RTN","IBCECOB6",146,0)
 .Q
"RTN","IBCECOB6",147,0)
 Q
"RTN","IBCECOB6",148,0)
 ;
"RTN","IBCECOB6",149,0)
EOCMT ; IB*2.0*432 - edit new EOB comments
"RTN","IBCECOB6",150,0)
 K DO S DIC="^DGCR(399,"_IBIFN_",""TXC2"",",DIC(0)="L",DIC("DR")=".03",DA(1)=IBIFN,X=$$NOW^XLFDT,DLAYGO=399.078
"RTN","IBCECOB6",151,0)
 D FILE^DICN
"RTN","IBCECOB6",152,0)
 S DA=+Y I DA>0 D
"RTN","IBCECOB6",153,0)
 .; if no comment has been added, delete the created entry in comments subfile
"RTN","IBCECOB6",154,0)
 .I '$D(^DGCR(399,IBIFN,"TXC2",DA,1)) S DIK=DIC D ^DIK Q
"RTN","IBCECOB6",155,0)
 .; if we got here, comment has been added successfully
"RTN","IBCECOB6",156,0)
 .; if called from CBW Worklist or View CBW Comments, ask if status needs to be changed
"RTN","IBCECOB6",157,0)
 .I $G(MRAFLG) S DIE=399,DA=IBIFN,DR="28.1"_$S($G(IBMRANOT):"EOB",1:"MRA")_" REVIEW STATUS//REVIEW IN PROCESS" D ^DIE D:'$G(VCFLG) BLD^IBCECOB1  ;WCJ IB*2.0*432
"RTN","IBCECOB6",158,0)
 .; if action was invoked from View Comments, rebuild the list of comments
"RTN","IBCECOB6",159,0)
 .D:$G(VCFLG) CLEAN^VALM10,INIT
"RTN","IBCECOB6",160,0)
 .Q
"RTN","IBCECOB6",161,0)
 D CLEAN^DILF
"RTN","IBCECOB6",162,0)
 L -^DGCR(399,IBIFN)
"RTN","IBCECOB6",163,0)
 Q
"RTN","IBCECOB6",164,0)
 ;
"RTN","IBCEF11")
0^46^B72157495^B51577775
"RTN","IBCEF11",1,0)
IBCEF11 ;ALB/TMP - FORMATTER SPECIFIC BILL FUNCTIONS - CONT ;30-JAN-96
"RTN","IBCEF11",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,155,309,335,348,349,371,432**;21-MAR-94;Build 192
"RTN","IBCEF11",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF11",4,0)
 ;
"RTN","IBCEF11",5,0)
BOX24D(A,IB) ; Returns the lines for boxes 19-24 of the CMS-1500 display
"RTN","IBCEF11",6,0)
 ; IB = flag is 1 if only box 24 is needed
"RTN","IBCEF11",7,0)
 Q $S('$G(IB):"36",1:"44")_"^55"
"RTN","IBCEF11",8,0)
 ;
"RTN","IBCEF11",9,0)
RCBOX() ; Returns the lines for revenue code boxes of the UB-04 display
"RTN","IBCEF11",10,0)
 Q "19^41"
"RTN","IBCEF11",11,0)
 ;
"RTN","IBCEF11",12,0)
OUTPT(IBIFN,IBPRINT) ; Returns an array of service line data from
"RTN","IBCEF11",13,0)
 ;                 CMS-1500 box 24.  Output is in IBXDATA(n)
"RTN","IBCEF11",14,0)
 ; IBPRINT = print flag  1: return print fields
"RTN","IBCEF11",15,0)
 ;                       0: return EDI fields
"RTN","IBCEF11",16,0)
 ; Uses diagnosis array ^TMP("IBXSAVE",$J,"DX",IBIFN,DIAG CODE)=SEQ #
"RTN","IBCEF11",17,0)
 ;   if it already exists. If not, it builds it from N-DIAGNOSES element
"RTN","IBCEF11",18,0)
 ;
"RTN","IBCEF11",19,0)
 ; For EDI call: Returns IBXDATA(n)=
"RTN","IBCEF11",20,0)
 ;   begin date(YYYYMMDD)^end date(YYYYMMDD)^pos^tos^
"RTN","IBCEF11",21,0)
 ;   proc code/revenue code - if no procedure (not the pointers)^
"RTN","IBCEF11",22,0)
 ;   type of code^dx pointer(s)^unit charge^units^modifiers separated by;
"RTN","IBCEF11",23,0)
 ;   ^purchased charge amount ^anesthesia minutes^emergency indicator^
"RTN","IBCEF11",24,0)
 ;   lab-type service flag.
"RTN","IBCEF11",25,0)
 ;
"RTN","IBCEF11",26,0)
 ;   Also Returns IBXDATA(IBI,"COB",COB,m) with COB data for each line
"RTN","IBCEF11",27,0)
 ;      item found in an accepted EOB for the bill and = the reference
"RTN","IBCEF11",28,0)
 ;      line in the first '^' piece followed by the '0' node data of file
"RTN","IBCEF11",29,0)
 ;      361.115 (LINE LEVEL ADJUSTMENTS)
"RTN","IBCEF11",30,0)
 ;       COB = COB sequence # of adjustment's ins co, m = seq #
"RTN","IBCEF11",31,0)
 ;         -- AND --
"RTN","IBCEF11",32,0)
 ;    IBXDATA(IBI,"COB",COB,m,z,p)=
"RTN","IBCEF11",33,0)
 ;           the data on the '0' node for each subordinate entry of file
"RTN","IBCEF11",34,0)
 ;           361.11511 (REASONS) (Only first 3 pieces for 837 output)
"RTN","IBCEF11",35,0)
 ;       z = group code, sometimes preceeded by a space   p = seq #
"RTN","IBCEF11",36,0)
 ;
"RTN","IBCEF11",37,0)
 ; For Print call: Returns begin date(DDMMYYYY)^end date(DDMMYYYY) or
"RTN","IBCEF11",38,0)
 ;   null if equal to begin date^pos^tos^bedsection name(if no procedure)
"RTN","IBCEF11",39,0)
 ;   or procedure code(not the pointer)^ ... refer to EDI call results
"RTN","IBCEF11",40,0)
 ;   Also, IBXDATA(n,"TEXT")=the text to print on first line of box 24,
"RTN","IBCEF11",41,0)
 ;   If no procedure code, returns IBXDATA(n,"A")=rev code abbrev
"RTN","IBCEF11",42,0)
 ;
"RTN","IBCEF11",43,0)
 ;  For both calls, returns IBXDATA(n,item type,item ptr)=""
"RTN","IBCEF11",44,0)
 ;      -- AND --
"RTN","IBCEF11",45,0)
 ;   IBXDATA(n,"RX")=RX#^drug name^NDC^refill #^(re)fill date^qty^days
"RTN","IBCEF11",46,0)
 ;                   ^chrge^ien of file 362.4^NDC format
"RTN","IBCEF11",47,0)
 ;           If line references a prescription
"RTN","IBCEF11",48,0)
 ;      -- AND --
"RTN","IBCEF11",49,0)
 ;   If no revenue code for a prescription, returns IBXDATA(n,"ARX")=""
"RTN","IBCEF11",50,0)
 ;      -- AND --
"RTN","IBCEF11",51,0)
 ;   IBXDATA(n,"AUX")='AUX' node of the procedure entry
"RTN","IBCEF11",52,0)
 ;
"RTN","IBCEF11",53,0)
 ; Also returns IBXDATA(n,"CPLNK") = soft link to corresponding entry in PROCEDURES multiple of file 399
"RTN","IBCEF11",54,0)
 ;
"RTN","IBCEF11",55,0)
 N IB,IBI,IBJ,IBFLD,IBDXI,IBXIEN,Z,IBXTRA,IBRX,IBRX0,IBRX1,Z0,Z1
"RTN","IBCEF11",56,0)
 ;
"RTN","IBCEF11",57,0)
 K ^TMP($J,"IBITEM")
"RTN","IBCEF11",58,0)
 S ^TMP($J,"IBITEM")=""
"RTN","IBCEF11",59,0)
 ; Build diagnosis array if not already built
"RTN","IBCEF11",60,0)
 I $O(^TMP("IBXSAVE",$J,"DX",IBIFN,""))="",$O(^IBA(362.3,"AIFN"_IBIFN,"")) D
"RTN","IBCEF11",61,0)
 .N Z,IBXDATA D F^IBCEF("N-DIAGNOSES",,,IBIFN)
"RTN","IBCEF11",62,0)
 .S Z="" F  S Z=$O(IBXDATA(Z)) K:$O(IBXDATA(0))=""&(Z="") IBXDATA Q:Z=""  S:$P(IBXDATA(Z),U,2) ^TMP("IBXSAVE",$J,"DX",IBIFN,$P(IBXDATA(Z),U,2))=Z
"RTN","IBCEF11",63,0)
 ;
"RTN","IBCEF11",64,0)
 S IB(0)=$G(^DGCR(399,IBIFN,0)),IB("U")=$G(^("U")),IB("U1")=$G(^("U1"))
"RTN","IBCEF11",65,0)
 S IBI="" F  S IBI=$O(^TMP("IBXSAVE",$J,"DX",IBIFN,IBI)) Q:IBI=""  S IBDXI(IBI)=^(IBI)
"RTN","IBCEF11",66,0)
 I '$G(IBPRINT) D RVCE^IBCF23(IBIFN,IBIFN)
"RTN","IBCEF11",67,0)
 I $G(IBPRINT) D RVCE^IBCF23(,IBIFN)
"RTN","IBCEF11",68,0)
 ; Returns IBFLD(24) = begin date^end date^pos^tos^
"RTN","IBCEF11",69,0)
 ;     proc/bedsection/revenue code^dx pointer^unit charge^
"RTN","IBCEF11",70,0)
 ;     units^modifiers^ purchased charge amount ^anesthesia minutes^
"RTN","IBCEF11",71,0)
 ;     emergency indicator ^ soft pointer to PROCEDURES multiple in file 399 AND
"RTN","IBCEF11",72,0)
 ;         IBFLD(24,n,type,item)=""
"RTN","IBCEF11",73,0)
 ;         IBFLD(24,n_"A") = revenue code abbreviation if no procedure
"RTN","IBCEF11",74,0)
 ;         IBFLD(24,n,"AUX") = 'AUX' node of line item 
"RTN","IBCEF11",75,0)
 ;         IBFLD(24,n,"RX") = soft pointer to file 362.4 from 'item' fld
"RTN","IBCEF11",76,0)
 ;                            (can be null)
"RTN","IBCEF11",77,0)
 ;
"RTN","IBCEF11",78,0)
 D SET^IBCSC5A(IBIFN,.IBRX) ;prescriptions
"RTN","IBCEF11",79,0)
 ; IBRX1(ien 362.4)=RX#^drug ien^NDC^refil #^(re)fil date^qty^days^chrge
"RTN","IBCEF11",80,0)
 I IBRX S IBRX="" F  S IBRX=$O(IBRX(IBRX)) Q:IBRX=""  S IBRX0=0 F  S IBRX0=$O(IBRX(IBRX,IBRX0)) Q:'IBRX0  D
"RTN","IBCEF11",81,0)
 . N IBRXH
"RTN","IBCEF11",82,0)
 . S IBRXH=IBRX(IBRX,IBRX0)
"RTN","IBCEF11",83,0)
 . ; **IB*2.0*432** added _U_$P(IBRXH,U,9) (Rx Date) to Output Formatter
"RTN","IBCEF11",84,0)
 . S IBRX1(+IBRXH)=IBRX_U_$P(IBRXH,U,2)_U_$P(IBRXH,U,5)_U_$P(IBRXH,U,7)_U_IBRX0_U_$P(IBRXH,U,4)_U_$P(IBRXH,U,3)_U_$P(IBRXH,U,6)_U_+IBRXH_U_$P(IBRXH,U,8)_U_$P(IBRXH,U,9)
"RTN","IBCEF11",85,0)
 K IBRX
"RTN","IBCEF11",86,0)
 ;
"RTN","IBCEF11",87,0)
 ; for EDI, remove any $0 line items from the IBFLD array before 
"RTN","IBCEF11",88,0)
 ; dropping down into the next loop (IB*2*371)
"RTN","IBCEF11",89,0)
 I '$G(IBPRINT) D
"RTN","IBCEF11",90,0)
 . NEW IBZ,IBI,Z
"RTN","IBCEF11",91,0)
 . M IBZ=IBFLD K IBFLD
"RTN","IBCEF11",92,0)
 . S (IBI,Z)=0
"RTN","IBCEF11",93,0)
 . F  S IBI=$O(IBZ(24,IBI)) Q:IBI'=+IBI  D
"RTN","IBCEF11",94,0)
 .. I $P(IBZ(24,IBI),U,7)*$P(IBZ(24,IBI),U,8)'>0 Q
"RTN","IBCEF11",95,0)
 .. S Z=Z+1
"RTN","IBCEF11",96,0)
 .. M IBFLD(24,Z)=IBZ(24,IBI)
"RTN","IBCEF11",97,0)
 .. S IBFLD(24)=Z
"RTN","IBCEF11",98,0)
 .. Q
"RTN","IBCEF11",99,0)
 . Q
"RTN","IBCEF11",100,0)
 ;
"RTN","IBCEF11",101,0)
 S IBI=0
"RTN","IBCEF11",102,0)
 F  S IBI=$O(IBFLD(24,IBI)) Q:IBI'=+IBI  D
"RTN","IBCEF11",103,0)
 . S IBRX1=0
"RTN","IBCEF11",104,0)
 . S IBXDATA(IBI)=$P(IBFLD(24,IBI),U)_U_$P(IBFLD(24,IBI),U,$S($P(IBFLD(24,IBI),U,2)=""&'$G(IBPRINT):1,1:2))
"RTN","IBCEF11",105,0)
 . S $P(IBXDATA(IBI),U,3,5)=$P(IBFLD(24,IBI),U,3,5)
"RTN","IBCEF11",106,0)
 . S $P(IBXDATA(IBI),U,6)=$S($D(IBFLD(24,IBI_"X")):"CJ",1:"HC")
"RTN","IBCEF11",107,0)
 . S $P(IBXDATA(IBI),U,7,13)=$P(IBFLD(24,IBI),U,6,12)
"RTN","IBCEF11",108,0)
 . S $P(IBXDATA(IBI),U,14)=+$$ISLAB(IBXDATA(IBI))
"RTN","IBCEF11",109,0)
 . ;
"RTN","IBCEF11",110,0)
 . I $D(IBFLD(24,IBI,"RX")) D  ;Rx
"RTN","IBCEF11",111,0)
 .. S IBRX1=1
"RTN","IBCEF11",112,0)
 .. I $P($G(IBFLD(24,IBI,"AUX")),U,8)'="" S $P(IBFLD(24,IBI,"AUX"),U,8)="",$P(IBFLD(24,IBI,"AUX"),U,9)=""  ;No free text allowed for rx's
"RTN","IBCEF11",113,0)
 .. I $D(IBRX1(+IBFLD(24,IBI,"RX"))) D  Q  ;Soft link exists
"RTN","IBCEF11",114,0)
 ...D ZERO^IBRXUTL(+$P(IBRX1(+IBFLD(24,IBI,"RX")),U,2))
"RTN","IBCEF11",115,0)
 ... S IBXDATA(IBI,"RX")=IBRX1(+IBFLD(24,IBI,"RX")),$P(IBXDATA(IBI,"RX"),U,2)=$E($G(^TMP($J,"IBDRUG",+$P(IBRX1(+IBFLD(24,IBI,"RX")),U,2),.01)),1,30)
"RTN","IBCEF11",116,0)
 ... K IBRX1(+IBFLD(24,IBI,"RX"))
"RTN","IBCEF11",117,0)
 ... ; No soft link - must find the first Rx with the same charge
"RTN","IBCEF11",118,0)
 .. S IBRX="" F  S IBRX=$O(IBRX1(IBRX)) Q:'IBRX  I +$P(IBRX1(IBRX),U,8)=+$P(IBXDATA(IBI),U,8) D  Q
"RTN","IBCEF11",119,0)
 ... D ZERO^IBRXUTL(+$P(IBRX1(IBRX),U,2))
"RTN","IBCEF11",120,0)
 ... S IBXDATA(IBI,"RX")=IBRX1(IBRX),$P(IBXDATA(IBI,"RX"),U,2)=$E($G(^TMP($J,"IBDRUG",+$P(IBRX1(IBRX),U,2),.01)),1,30) K IBRX1(IBRX) Q
"RTN","IBCEF11",121,0)
 ... Q
"RTN","IBCEF11",122,0)
 .. Q
"RTN","IBCEF11",123,0)
 . ;
"RTN","IBCEF11",124,0)
 . I $G(IBFLD(24,IBI,"AUX"))'="" D
"RTN","IBCEF11",125,0)
 .. I $G(IBPRINT),$P(IBFLD(24,IBI,"AUX"),U,8)'="" S IBXDATA(IBI,"TEXT")=$P(IBFLD(24,IBI,"AUX"),U,8),$P(IBFLD(24,IBI,"AUX"),U,8)=""
"RTN","IBCEF11",126,0)
 .. S IBXDATA(IBI,"AUX")=IBFLD(24,IBI,"AUX")
"RTN","IBCEF11",127,0)
 .. Q
"RTN","IBCEF11",128,0)
 . ;
"RTN","IBCEF11",129,0)
 . I $G(IBPRINT) D
"RTN","IBCEF11",130,0)
 .. I '$P(IBXDATA(IBI),U,8),'$G(IBXDATA(IBI,"RX")) D  Q
"RTN","IBCEF11",131,0)
 ... I $G(IBNOSHOW) Q    ; don't show errors/warnings
"RTN","IBCEF11",132,0)
 ... S IBXDATA(IBI,"TEXT")="Warning:** REV CODE UNITS < #PROCEDURES, THEY MUST BE ="
"RTN","IBCEF11",133,0)
 ... I $D(IBXDATA(IBI,"AUX")) S $P(IBXDATA(IBI,"AUX"),U,9)=""
"RTN","IBCEF11",134,0)
 ... Q
"RTN","IBCEF11",135,0)
 .. ;
"RTN","IBCEF11",136,0)
 .. I $G(IBFLD(24,IBI_"A"))'="" D  Q
"RTN","IBCEF11",137,0)
 ... S IBXDATA(IBI,"A")=IBFLD(24,IBI_"A")
"RTN","IBCEF11",138,0)
 ... I $G(IBNOSHOW) Q    ; don't show errors/warnings
"RTN","IBCEF11",139,0)
 ... S IBXDATA(IBI,"TEXT")="Warning:** REV CODE UNITS > #PROCEDURES, THEY MUST BE=: "_IBFLD(24,IBI_"A")
"RTN","IBCEF11",140,0)
 ... I $D(IBXDATA(IBI,"AUX")) S $P(IBXDATA(IBI,"AUX"),U,9)=""
"RTN","IBCEF11",141,0)
 ... Q
"RTN","IBCEF11",142,0)
 .. ;
"RTN","IBCEF11",143,0)
 .. S IBRX=$G(IBXDATA(IBI,"RX"))
"RTN","IBCEF11",144,0)
 .. I IBRX'="" D  ;Format Rx detail
"RTN","IBCEF11",145,0)
 ... N Z
"RTN","IBCEF11",146,0)
 ... S Z=$P(IBRX,U)
"RTN","IBCEF11",147,0)
 ... S Z=$S(Z'="":"Rx#"_Z_" ",1:"RX: ")
"RTN","IBCEF11",148,0)
 ... S IBXDATA(IBI,"TEXT")=Z_$S($P(IBRX,U,3)'="":"NDC: "_$P(IBRX,U,3),1:"NOC: "_$P(IBRX,U,2))_" Qty: "_$P(IBRX,U,6)_" Days: "_$P(IBRX,U,7)
"RTN","IBCEF11",149,0)
 ... S $P(IBXDATA(IBI,"AUX"),U,9)="N4"   ; service line comment qualifier for RX's
"RTN","IBCEF11",150,0)
 ... Q
"RTN","IBCEF11",151,0)
 .. Q
"RTN","IBCEF11",152,0)
 . S IBXDATA(IBI,"CPLNK")=$P(IBFLD(24,IBI),U,13)
"RTN","IBCEF11",153,0)
 . I '$G(IBPRINT) D COBLINE^IBCEU6(IBIFN,IBI,.IBXDATA,,.IBXTRA)
"RTN","IBCEF11",154,0)
 . Q
"RTN","IBCEF11",155,0)
 ;
"RTN","IBCEF11",156,0)
 I $G(IBPRINT) D
"RTN","IBCEF11",157,0)
 . S IBRX=0 F  S IBRX=$O(IBRX1(IBRX)) Q:'IBRX  D
"RTN","IBCEF11",158,0)
 .. S IBI=+$O(IBXDATA(""),-1)+1
"RTN","IBCEF11",159,0)
 .. S IBXDATA(IBI)=$$DATE($P(IBRX1(IBRX),U,5))
"RTN","IBCEF11",160,0)
 .. S IBXDATA(IBI,"TEXT")="**** ERROR - NO PROC LINK TO REV CODE FOR DRUG: RX#: "_$P(IBRX1(IBRX),U)_"  NDC #: "_$P(IBRX1(IBRX),U,3)
"RTN","IBCEF11",161,0)
 .. I $D(IBXDATA(IBI,"AUX")) S $P(IBXDATA(IBI,"AUX"),U,9)=""
"RTN","IBCEF11",162,0)
 .. S IBXDATA(IBI,"ARX")=""
"RTN","IBCEF11",163,0)
 .. D ZERO^IBRXUTL(+$P(IBRX1(IBRX),U,2))
"RTN","IBCEF11",164,0)
 .. S IBXDATA(IBI,"RX")=IBRX1(IBRX),$P(IBXDATA(IBI,"RX"),U,2)=$E($G(^TMP($J,"IBDRUG",+$P(IBRX1(IBRX),U,2),.01)),1,30) K IBRX1(IBRX)
"RTN","IBCEF11",165,0)
 .. Q
"RTN","IBCEF11",166,0)
 . Q
"RTN","IBCEF11",167,0)
 ;
"RTN","IBCEF11",168,0)
 I '$G(IBPRINT),$D(IBXTRA) D COMBO^IBCEU2(.IBXDATA,.IBXTRA,0) ;Handle bundled/unbundled lines
"RTN","IBCEF11",169,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBCEF11",170,0)
 Q
"RTN","IBCEF11",171,0)
 ;
"RTN","IBCEF11",172,0)
ISLAB(LDATA) ; Returns 0/1 if line item data indicates the item is a lab (1)
"RTN","IBCEF11",173,0)
 ; 'LAB' is defined here as type of service = 5
"RTN","IBCEF11",174,0)
 Q $E($P(LDATA,U,4))="5"
"RTN","IBCEF11",175,0)
 ;
"RTN","IBCEF11",176,0)
FMT(DATA,DLEN,FLEN) ; Returns a string in DATA with a max length of DLEN
"RTN","IBCEF11",177,0)
 ;  and a field length of FLEN
"RTN","IBCEF11",178,0)
 Q $E($E(DATA,1,DLEN)_$J("",FLEN),1,FLEN)
"RTN","IBCEF11",179,0)
 ;
"RTN","IBCEF11",180,0)
DATE(X,DEL) ;  Returns FM date in X as MMxDDxYYYY  where x=DEL
"RTN","IBCEF11",181,0)
 S DEL=$G(DEL)
"RTN","IBCEF11",182,0)
 S X=$$DATE^IBCF2(X,1,1)
"RTN","IBCEF11",183,0)
 I X'="" S X=$E(X,1,2)_DEL_$E(X,3,4)_DEL_$E(X,5,8)
"RTN","IBCEF11",184,0)
 Q X
"RTN","IBCEF11",185,0)
 ;
"RTN","IBCEF11",186,0)
BATCH() ; Sets up record for and stores/returns the next batch number
"RTN","IBCEF11",187,0)
 N NUM,FAC,DO,DD,DLAYGO,DIC,X,Y
"RTN","IBCEF11",188,0)
 ;Keep latest batch number for view/print edi bill extract data option
"RTN","IBCEF11",189,0)
 I $D(IBVNUM) S NUM=IBVNUM G BATCHQ
"RTN","IBCEF11",190,0)
 ;Check for batch resubmit - if yes, use same number as original batch
"RTN","IBCEF11",191,0)
 I $P($G(^TMP("IBRESUBMIT",$J)),U,3)=1 S NUM=$P(^($J),U) G BATCHQ
"RTN","IBCEF11",192,0)
 L +^IBA(364.1,0):5 I '$T Q 0
"RTN","IBCEF11",193,0)
 S FAC=+$P($$SITE^VASITE(),U,3),NUM=$O(^IBA(364.1,"B",""),-1)
"RTN","IBCEF11",194,0)
 I $D(^IBA(364.1,+NUM,0)),$P(^(0),U,2)="" F  D  Q:'NUM!($P($G(^IBA(364.1,+NUM,0)),U,2)'="")
"RTN","IBCEF11",195,0)
 . I $D(^IBA(364.1,NUM,0)) S DA=NUM,DIK="^IBA(364.1," D ^DIK
"RTN","IBCEF11",196,0)
 . S NUM=$O(^IBA(364.1,"B",""),-1)
"RTN","IBCEF11",197,0)
 F  S NUM=$S($P(NUM,FAC,2)'="":NUM+1,1:FAC_"0000001") Q:'$D(^IBA(364.1,"B",NUM))
"RTN","IBCEF11",198,0)
 K DO,DD S DIC="^IBA(364.1,",DLAYGO=364.1,DIC(0)="L",X=NUM D FILE^DICN K DD,DO I Y'>0 S NUM=0
"RTN","IBCEF11",199,0)
 L -^IBA(364.1,0)
"RTN","IBCEF11",200,0)
BATCHQ Q NUM
"RTN","IBCEF11",201,0)
 ;
"RTN","IBCEF11",202,0)
GETLDAT(IBXIEN) ; Extract data for 837 transmission LDAT record
"RTN","IBCEF11",203,0)
 ; IBXIEN - ien in file 399
"RTN","IBCEF11",204,0)
 ; Sets up IBXSAVE("LDAT",n) array:
"RTN","IBCEF11",205,0)
 ; Attachment report type ^ Attachment report transmission code ^ Attachment control number ^ 
"RTN","IBCEF11",206,0)
 ; OB Anesthesia Additional Units ^ Purchase Service Provider ID ^ Purchase Service Amount ^
"RTN","IBCEF11",207,0)
 N CPIEN,FTYPE,IBXDATA,IDS,NODE1,PSAMNT,PSPID,Z,PCE1,LINE
"RTN","IBCEF11",208,0)
 I '+$G(IBXIEN) Q
"RTN","IBCEF11",209,0)
 K IBXSAVE("LDAT")
"RTN","IBCEF11",210,0)
 S FTYPE=$$FT^IBCEF(IBXIEN)
"RTN","IBCEF11",211,0)
 I FTYPE=2 D OUTPT(IBXIEN,0)
"RTN","IBCEF11",212,0)
 I FTYPE=3 D HOS^IBCEF2(IBXIEN)
"RTN","IBCEF11",213,0)
 D ALLIDS^IBCEFP(IBXIEN,.IDS,1)
"RTN","IBCEF11",214,0)
 S PSPID=$P($G(IDS("LAB/FAC",IBXIEN,"C",1,1)),U,2)
"RTN","IBCEF11",215,0)
 I PSPID="" S PSPID=$P($$ORGNPI^IBCEF73A(IBXIEN),U,1)
"RTN","IBCEF11",216,0)
 ;IB*2.0*432/TAZ - Get Rendering Provider NPI if Facility NPI is null.
"RTN","IBCEF11",217,0)
 I PSPID="" S PSPID=$P($G(IDS("PROVINF",IBIFN,"C",1,3,0)),U,4)  ; Get claim level Rendering Provider NPI
"RTN","IBCEF11",218,0)
 I PSPID="",$D(IDS("L-PROV")) D  ; Get 1st line level Rendering Provider NPI
"RTN","IBCEF11",219,0)
 . F LINE=1:1:$O(IDS("L-PROV",IBIFN,""),-1) D  I PSPID'="" Q
"RTN","IBCEF11",220,0)
 .. S PSPID=$P($G(IDS("L-PROV",IBIFN,LINE,"C",1,3,0)),U,4)
"RTN","IBCEF11",221,0)
 ;IB*2.0*432/TAZ - END
"RTN","IBCEF11",222,0)
 S Z=0 F  S Z=$O(IBXDATA(Z)) Q:'Z  D
"RTN","IBCEF11",223,0)
 .S CPIEN=+$G(IBXDATA(Z,"CPLNK")) ;I 'CPIEN Q
"RTN","IBCEF11",224,0)
 .I FTYPE=2 S PSAMNT=$$DOLLAR^IBCEFG1($P($G(IBXDATA(Z)),U,11))
"RTN","IBCEF11",225,0)
 .I FTYPE=3 S PSPID="" ;S PSAMNT=$P($G(IBXDATA(Z)),U,5) ;WCJ; not a purchased service
"RTN","IBCEF11",226,0)
 .I '$$SUB1OK^IBCEP8A(IBXIEN) S (PSPID,PSAMT)=""
"RTN","IBCEF11",227,0)
 .S (PCE1,NODE1)=""
"RTN","IBCEF11",228,0)
 .I CPIEN D
"RTN","IBCEF11",229,0)
 ..S NODE1=$G(^DGCR(399,IBXIEN,"CP",CPIEN,1))
"RTN","IBCEF11",230,0)
 ..S PCE1=$$GET1^DIQ(399.0304,CPIEN_","_IBXIEN_",",71)
"RTN","IBCEF11",231,0)
 .S IBXSAVE("LDAT",Z)=PCE1_U_$P(NODE1,U,3)_U_$P(NODE1,U)_U_$P(NODE1,U,5)_U_$G(PSPID)_U_$G(PSAMNT)
"RTN","IBCEF11",232,0)
 .Q
"RTN","IBCEF11",233,0)
 Q
"RTN","IBCEF2")
0^99^B64226101^B62563812
"RTN","IBCEF2",1,0)
IBCEF2 ;ALB/TMP - FORMATTER SPECIFIC BILL FUNCTIONS ;8/6/03 10:54am
"RTN","IBCEF2",2,0)
 ;;2.0;INTEGRATED BILLING;**52,85,51,137,232,155,296,349,403,400,432**;21-MAR-94;Build 192
"RTN","IBCEF2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF2",4,0)
 ;
"RTN","IBCEF2",5,0)
HOS(IBIFN) ; Extract rev codes for inst. episode into IBXDATA
"RTN","IBCEF2",6,0)
 ; Moved for space
"RTN","IBCEF2",7,0)
 D HOS^IBCEF22(IBIFN)
"RTN","IBCEF2",8,0)
 Q
"RTN","IBCEF2",9,0)
 ;
"RTN","IBCEF2",10,0)
OTHINS(IBIFN) ;Determine 'other insurance' node (I1,I2)
"RTN","IBCEF2",11,0)
 ; If primary bill, other ins is secondary
"RTN","IBCEF2",12,0)
 ; If sec or tert bill, other ins is primary
"RTN","IBCEF2",13,0)
 ;IBIFN = bill ien
"RTN","IBCEF2",14,0)
 N Z
"RTN","IBCEF2",15,0)
 S Z=$$COBN^IBCEF(IBIFN)
"RTN","IBCEF2",16,0)
 Q "I"_$S(Z=1:2,1:1)
"RTN","IBCEF2",17,0)
 ;
"RTN","IBCEF2",18,0)
OTHINS1(IBIFN) ; Returns the COB #'s of all 'other insurance' as a string
"RTN","IBCEF2",19,0)
 ;IBIFN = bill ien
"RTN","IBCEF2",20,0)
 N IBC,Z
"RTN","IBCEF2",21,0)
 S Z=$$COBN^IBCEF(IBIFN)
"RTN","IBCEF2",22,0)
 I Z=1 S IBC=$S($D(^DGCR(399,IBIFN,"I2")):$S($D(^DGCR(399,IBIFN,"I3")):23,1:2),1:"") ;Primary=>2 or 23
"RTN","IBCEF2",23,0)
 I Z=2 S IBC="1"_$S($D(^DGCR(399,IBIFN,"I3")):3,1:"") ;Secondary=>1 or 13
"RTN","IBCEF2",24,0)
 I Z=3 S IBC="12" ;Tertiary =>12
"RTN","IBCEF2",25,0)
OTHQ Q IBC
"RTN","IBCEF2",26,0)
 ;
"RTN","IBCEF2",27,0)
RECVR(IBIFN) ; Returns the V.A. internal routing id of the current ins
"RTN","IBCEF2",28,0)
 ; co for 837
"RTN","IBCEF2",29,0)
 ;IBIFN = bill ien
"RTN","IBCEF2",30,0)
 N MCR,NUM,IBPH
"RTN","IBCEF2",31,0)
 S IBPH=$P("P^H",U,$$FT^IBCEF(IBIFN)-1)
"RTN","IBCEF2",32,0)
 S NUM="ENVOY"_IBPH
"RTN","IBCEF2",33,0)
 ; If rate type is CHAMPVA, send 'CHAMVA'
"RTN","IBCEF2",34,0)
 I $P($G(^DGCR(399.3,+$P($G(^DGCR(399,IBIFN,0)),U,7),0)),U)="CHAMPVA" S NUM="CHAMV"_IBPH
"RTN","IBCEF2",35,0)
 I NUM["ENVOY",$$MCRWNR^IBEFUNC(+$$CURR(IBIFN)) D
"RTN","IBCEF2",36,0)
 . S MCR=$P("B^A",U,$$FT^IBCEF(IBIFN)-1)    ; PART A/B for MEDICARE
"RTN","IBCEF2",37,0)
 . S NUM="PART"_MCR
"RTN","IBCEF2",38,0)
 Q NUM
"RTN","IBCEF2",39,0)
 ;
"RTN","IBCEF2",40,0)
ALLPAYID(IBIFN,IBXDATA,SEQ) ; Returns clearinghouse id for all (SEQ="")
"RTN","IBCEF2",41,0)
 ;  or a specific (SEQ=1,2,3) ins co's for 837 in IBXDATA(n) for bill ien
"RTN","IBCEF2",42,0)
 ;  IBIFN
"RTN","IBCEF2",43,0)
 ; EJK *296* Add IBMRA - MRA Claim type. 
"RTN","IBCEF2",44,0)
 ; EJK *296* Add IBEBI - Electronic Billing ID
"RTN","IBCEF2",45,0)
 N Z,Z0,Z1,A,IBM,IBINST,IBMCR,IBX,IBMRA,IBEBI
"RTN","IBCEF2",46,0)
 S IBXDATA="",IBM=$G(^DGCR(399,IBIFN,"M"))
"RTN","IBCEF2",47,0)
 F Z=1:1:3 I $S('$G(SEQ):1,1:Z=SEQ) S Z0=$P(IBM,U,Z) I Z0 D  S:A'="" IBXDATA(Z)=A
"RTN","IBCEF2",48,0)
 . S A=""
"RTN","IBCEF2",49,0)
 . S IBINST=($$FT^IBCEF(IBIFN)=3) ;Is bill UB-04?
"RTN","IBCEF2",50,0)
 . ; EJK *296* Get IBEBI based on Prof. or Inst. claim
"RTN","IBCEF2",51,0)
 . I IBINST S IBEBI=$P($G(^DIC(36,Z0,3)),U,4)
"RTN","IBCEF2",52,0)
 . I 'IBINST S IBEBI=$P($G(^DIC(36,Z0,3)),U,2)
"RTN","IBCEF2",53,0)
 . S IBEBI=$$UP^XLFSTR(IBEBI)
"RTN","IBCEF2",54,0)
 . ; EJK *296* If this is a Medicare claim, it may be printed or transmitted. 
"RTN","IBCEF2",55,0)
 . S IBMRA=$$MRASEC^IBCEF4(IBIFN)   ;Is claim 2ndary to an MRA? 
"RTN","IBCEF2",56,0)
 . S IBMCR=$$MCRONBIL^IBEFUNC(IBIFN),Z1=$G(^DGCR(399,IBIFN,"TX"))
"RTN","IBCEF2",57,0)
 . Q:$P(Z1,U,8)=1!$S('$P(Z1,U,9):0,1:$$MRASEC^IBCEF4(IBIFN))  ;Force local prnt
"RTN","IBCEF2",58,0)
 . S A=$S($P(Z1,U,8)'=2:$P($G(^DIC(36,Z0,3)),U,$S(IBINST:4,1:2)),1:"")
"RTN","IBCEF2",59,0)
 . S A=$$UP^XLFSTR(A)
"RTN","IBCEF2",60,0)
 . ;
"RTN","IBCEF2",61,0)
 . ; RPRNT = CMS-1500 Rx bills
"RTN","IBCEF2",62,0)
 . ; IPRNT = Inst MRA secondary claims
"RTN","IBCEF2",63,0)
 . ; PPRNT = Prof MRA secondary claims
"RTN","IBCEF2",64,0)
 . ; HPRNT = inst printed bills (non-MRA, force print at clearinghouse)
"RTN","IBCEF2",65,0)
 . ; SPRNT = prof printed bills (non-MRA, force print at clearinghouse)
"RTN","IBCEF2",66,0)
 . ;
"RTN","IBCEF2",67,0)
 . ; Default to appropriate 'xPRNT' if Rx bill or COB bill or forced to
"RTN","IBCEF2",68,0)
 . ;    print - claims must print at clearinghouse
"RTN","IBCEF2",69,0)
 . ;
"RTN","IBCEF2",70,0)
 . ; Rx bills on CMS-1500
"RTN","IBCEF2",71,0)
 . ;IB*2.0*432/TAZ Claims no longer print at clearinghouse
"RTN","IBCEF2",72,0)
 . ;I 'IBINST,$$ISRX^IBCEF1(IBIFN) S A="RPRNT" Q
"RTN","IBCEF2",73,0)
 . ;
"RTN","IBCEF2",74,0)
 . ; Claim forced to print at clearinghouse (Field #27)
"RTN","IBCEF2",75,0)
 . I $P(Z1,U,8)=2 S A=$S(IBINST:"H",1:"S")_"PRNT" Q
"RTN","IBCEF2",76,0)
 . ;
"RTN","IBCEF2",77,0)
 . ; EJK *296* Send IBEBI for MRA secondary claims if it exists
"RTN","IBCEF2",78,0)
 . I Z>1,IBMRA,IBEBI'="" S A=IBEBI Q
"RTN","IBCEF2",79,0)
 . ;
"RTN","IBCEF2",80,0)
 . ; MRA secondary claim
"RTN","IBCEF2",81,0)
 . I Z>1,IBMCR=1,$P(Z1,U,5)="C" S A=$S(IBINST:"I",1:"P")_"PRNT" Q
"RTN","IBCEF2",82,0)
 . ;
"RTN","IBCEF2",83,0)
 . ; Medicare is current payer (MRA request claim)
"RTN","IBCEF2",84,0)
 . I $$WNRBILL^IBEFUNC(IBIFN,Z) S A=$S(IBINST:"12M61",1:"SMTX1") Q
"RTN","IBCEF2",85,0)
 . ;
"RTN","IBCEF2",86,0)
 . ; IB*296 - Do not modify the payer ID for CHAMPVA (HAC)
"RTN","IBCEF2",87,0)
 . I A=84146 Q
"RTN","IBCEF2",88,0)
 . I A=84147 Q
"RTN","IBCEF2",89,0)
 . ;
"RTN","IBCEF2",90,0)
 . ; If not a primary bill force to print
"RTN","IBCEF2",91,0)
 . ;IB*2.0*432/TAZ secondary bills will now be processed
"RTN","IBCEF2",92,0)
 . ;I Z>1,Z=$$COBN^IBCEF(IBIFN) S A=$S(IBINST:"H",1:"S")_"PRNT" Q
"RTN","IBCEF2",93,0)
 . Q
"RTN","IBCEF2",94,0)
 ;
"RTN","IBCEF2",95,0)
 Q
"RTN","IBCEF2",96,0)
 ;
"RTN","IBCEF2",97,0)
PAYERID(IBIFN) ; Returns clearinghouse id for current ins co
"RTN","IBCEF2",98,0)
 ; IBIFN = bill ien
"RTN","IBCEF2",99,0)
 N NUM,IBSEQ
"RTN","IBCEF2",100,0)
 ; Determine the current ins co's # to identify at WEBMD
"RTN","IBCEF2",101,0)
 ; Envoy changed to WEBMD in patch 232
"RTN","IBCEF2",102,0)
 S IBSEQ=+$$COBN^IBCEF(IBIFN)
"RTN","IBCEF2",103,0)
 D ALLPAYID(IBIFN,.NUM,IBSEQ) S NUM=$G(NUM(IBSEQ))
"RTN","IBCEF2",104,0)
 Q $G(NUM)
"RTN","IBCEF2",105,0)
 ;
"RTN","IBCEF2",106,0)
CURR(IBIFN) ; Returns ien of the current insurance
"RTN","IBCEF2",107,0)
 ; company for bill ien IBIFN
"RTN","IBCEF2",108,0)
 Q $$FINDINS^IBCEF1(IBIFN)
"RTN","IBCEF2",109,0)
 ;
"RTN","IBCEF2",110,0)
ADMDT(IBIFN,NOOUTCK) ; Calculate admission/start of care date/time
"RTN","IBCEF2",111,0)
 D ADMDT^IBCEF21(IBIFN,$G(NOOUTCK))      ; Moved for space
"RTN","IBCEF2",112,0)
 Q
"RTN","IBCEF2",113,0)
 ;
"RTN","IBCEF2",114,0)
DISDT(IBIFN) ; Calculate discharge date
"RTN","IBCEF2",115,0)
 D DISDT^IBCEF21(IBIFN)                  ; Moved for space
"RTN","IBCEF2",116,0)
 Q
"RTN","IBCEF2",117,0)
 ;
"RTN","IBCEF2",118,0)
INDTS(IBIFN) ; Function returns the admit ^ discharge date/time of admission if patient is an inpatient on bill's event date
"RTN","IBCEF2",119,0)
 N Z,Z0,DFN,VAINDT,VAIN S Z0=""
"RTN","IBCEF2",120,0)
 S Z=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(Z,U,2),VAINDT=$P(Z,U,3)
"RTN","IBCEF2",121,0)
 I +DFN,+VAINDT D INP^VADPT I +VAIN(1) S Z0=+VAIN(7)_U_+$G(^DGPM(+$P($G(^DGPM(+VAIN(1),0)),U,17),0))
"RTN","IBCEF2",122,0)
 Q Z0
"RTN","IBCEF2",123,0)
 ;
"RTN","IBCEF2",124,0)
TXMT(IBIFN) ; Function moved - use new call in IBCEF4
"RTN","IBCEF2",125,0)
 Q $$TXMT^IBCEF4(IBIFN)
"RTN","IBCEF2",126,0)
 ;
"RTN","IBCEF2",127,0)
 ;
"RTN","IBCEF2",128,0)
ID(LN,VAL) ; Set EXTRACT GLOBAL for multi-valued record
"RTN","IBCEF2",129,0)
 ; ids for Austin
"RTN","IBCEF2",130,0)
 ; LN = the line # being extracted
"RTN","IBCEF2",131,0)
 ; VAL = the value of the element being extracted
"RTN","IBCEF2",132,0)
 ;
"RTN","IBCEF2",133,0)
 ; Assumes IBXPG exists
"RTN","IBCEF2",134,0)
 ;
"RTN","IBCEF2",135,0)
 Q:LN<2
"RTN","IBCEF2",136,0)
 D SETGBL^IBCEFG(IBXPG,LN,1,VAL,.IBXSIZE)
"RTN","IBCEF2",137,0)
 Q
"RTN","IBCEF2",138,0)
 ;
"RTN","IBCEF2",139,0)
ID1(LN,DX,CT) ;Special entrypoint for diagnoses to 'save' the fact
"RTN","IBCEF2",140,0)
 ;   a dx code is an e-code.
"RTN","IBCEF2",141,0)
 ; LN is last entry # output, returned as the entry # (IBXLINE) to assign to this entry
"RTN","IBCEF2",142,0)
 ; DX = the actual Dx code array(RECORD ID). Pass by reference, DX returned null if
"RTN","IBCEF2",143,0)
 ;      dx was not output
"RTN","IBCEF2",144,0)
 ; CT = the ct on the 'DC' entry.  pass by reference, returned null if
"RTN","IBCEF2",145,0)
 ;      the end of the valid dx codes has been reached
"RTN","IBCEF2",146,0)
 N IBINS,VAL,CNT,DXIEN,DXQ,EDX,I,POA
"RTN","IBCEF2",147,0)
 S IBINS=($$FT^IBCEF(IBXIEN)=3)
"RTN","IBCEF2",148,0)
 S VAL="DC"_CT
"RTN","IBCEF2",149,0)
 S VAL=$E(VAL_" ",1,4)
"RTN","IBCEF2",150,0)
 S EDX=($E($G(DX))="E") ; TRUE if e-code DX
"RTN","IBCEF2",151,0)
 S I=$S(EDX:3,1:2)
"RTN","IBCEF2",152,0)
 S:'EDX DXQ=$S(+$G(^TMP("DCX",$J,2))>0:"BF",1:"BK") ; first non e-code DX is principal (qulifier "BK"), the rest have qualifier "BF"
"RTN","IBCEF2",153,0)
 I IBINS D
"RTN","IBCEF2",154,0)
 .I CT>28 S CT="" Q     ; Max of 28 codes for institutional/UB
"RTN","IBCEF2",155,0)
 .S DXIEN=$P(DX(CT),U,2) Q:DXIEN=""
"RTN","IBCEF2",156,0)
 .S POA=$P($G(^IBA(362.3,DXIEN,0)),U,4) I POA="",$$INPAT^IBCEF(IBXIEN) S POA=1 ; POA indicator defaults to "1", if not present on inpatient claim
"RTN","IBCEF2",157,0)
 .S:EDX DXQ="BN" ; e-code DX qualifier
"RTN","IBCEF2",158,0)
 .Q
"RTN","IBCEF2",159,0)
 I 'IBINS S:EDX DXQ="BF" S POA="" ; on CMS-1500 e-code DX qualifiers are "BF" and there's no POA
"RTN","IBCEF2",160,0)
 I 'IBINS,CT>8 S ^TMP("IBXSAVE",$J,"DX",IBXIEN)=$G(^TMP("IBXSAVE",$J,"DX",IBXIEN))+1,^TMP("IBXSAVE",$J,"DX",IBXIEN,$P(DX(+^TMP("IBXSAVE",$J,"DX",IBXIEN)),U,2))=$G(^TMP("IBXSAVE",$J,"DX",IBXIEN)) S DX="" Q
"RTN","IBCEF2",161,0)
 I CT'="",DX'="" D
"RTN","IBCEF2",162,0)
 .; populate ^TMP("DCX") scratch global
"RTN","IBCEF2",163,0)
 .S ^TMP("DCX",$J,1)=CT,CNT=$G(^TMP("DCX",$J,I))+1,^TMP("DCX",$J,I)=CNT
"RTN","IBCEF2",164,0)
 .S (^TMP("DCX",$J,I,CNT),^TMP("DCX",$J,1,CT))=DX_U_DXQ_U_POA
"RTN","IBCEF2",165,0)
 .S LN=LN+1 D ID(LN,VAL) S ^TMP("IBXSAVE",$J,"DX",IBXIEN,$P(DX(LN),U,2))=LN,^TMP("IBXSAVE",$J,"DX",IBXIEN)=CT,CT=CT+1
"RTN","IBCEF2",166,0)
 .Q
"RTN","IBCEF2",167,0)
 Q
"RTN","IBCEF2",168,0)
 ;
"RTN","IBCEF2",169,0)
M(CT) ; Calculate multi-valued field for 837 extract
"RTN","IBCEF2",170,0)
 ; CT = passed by reference/the record ID counter
"RTN","IBCEF2",171,0)
 S CT=CT+1
"RTN","IBCEF2",172,0)
 Q $E(CT#12+$S(CT#12:0,1:12)_" ",1,2)
"RTN","IBCEF2",173,0)
 ;
"RTN","IBCEF2",174,0)
SVITM(IBA,LINE) ; Saves the linked items from the bill data extract into
"RTN","IBCEF2",175,0)
 ; an array the formatter will use to link Rxs and prosthetics
"RTN","IBCEF2",176,0)
 ; to an SV1 or SV2 line item, if possible.  Kills off IBA array entries
"RTN","IBCEF2",177,0)
 ; after they are 'moved'
"RTN","IBCEF2",178,0)
 ; IBA = array that contains the data to be saved
"RTN","IBCEF2",179,0)
 ;   subscripts are (line #,item type,item pointer)=ct
"RTN","IBCEF2",180,0)
 N Z0,Z1
"RTN","IBCEF2",181,0)
 S Z0="" F  S Z0=$O(IBA("OUTPT",LINE,Z0)) Q:Z0=""  I Z0?1N.N  S Z1="" F  S Z1=$O(IBA("OUTPT",LINE,Z0,Z1)) Q:Z1=""  S ^TMP($J,"IBITEM",Z0,Z1,LINE)=IBA("OUTPT",LINE,Z0,Z1) K IBA("OUTPT",LINE,Z0,Z1)
"RTN","IBCEF2",182,0)
 Q
"RTN","IBCEF2",183,0)
 ;
"RTN","IBCEF2",184,0)
LINK(IBTYP,IBDATA) ; Link the item with a service line, if possible
"RTN","IBCEF2",185,0)
 ; IBTYP = the code for the type of item
"RTN","IBCEF2",186,0)
 ;         returned incremented if no link is made
"RTN","IBCEF2",187,0)
 ; IBDATA = the extracted data string that identifies the item. 
"RTN","IBCEF2",188,0)
 ; Returns the line to link to or null if no link
"RTN","IBCEF2",189,0)
 N IBLN,IBKEY,Z
"RTN","IBCEF2",190,0)
 S IBLN=""
"RTN","IBCEF2",191,0)
 S IBKEY=$S(IBTYP=3:$P(IBDATA,U,9),IBTYP=5:$P(IBDATA,U,4),1:"") Q:IBKEY=""
"RTN","IBCEF2",192,0)
 I $D(^TMP($J,"IBITEM",IBTYP,IBKEY)) D  G:IBLN LINKQ
"RTN","IBCEF2",193,0)
 .S Z=0 F  S Z=$O(^TMP($J,"IBITEM",IBTYP,IBKEY,Z)) Q:'Z  I ^TMP($J,"IBITEM",IBTYP,IBKEY,Z) S IBLN=Z,^TMP($J,"IBITEM",IBTYP,IBKEY,Z)=^TMP($J,"IBITEM",IBTYP,IBKEY,Z)-1 Q
"RTN","IBCEF2",194,0)
 I $D(^TMP($J,"IBITEM",IBTYP,0)) S IBKEY=0 D
"RTN","IBCEF2",195,0)
 .S Z=0 F  S Z=$O(^TMP($J,"IBITEM",IBTYP,IBKEY,Z)) Q:'Z  I ^TMP($J,"IBITEM",IBTYP,IBKEY,Z) S IBLN=Z,^TMP($J,"IBITEM",IBTYP,IBKEY,Z)=^TMP($J,"IBITEM",IBTYP,IBKEY,Z)-1 Q
"RTN","IBCEF2",196,0)
LINKQ Q IBLN
"RTN","IBCEF2",197,0)
 ;
"RTN","IBCEF2",198,0)
COID(IBIFN) ; Claim office ID - moved for space
"RTN","IBCEF2",199,0)
 Q $$COID^IBCEF21(IBIFN)
"RTN","IBCEF2",200,0)
 ;
"RTN","IBCEF2",201,0)
PPOL(IBIFN,COB) ; return IFN of patient policy on a bill defined by COB (fields 399,112-114)
"RTN","IBCEF2",202,0)
 N X,Y,PPOL S PPOL=""
"RTN","IBCEF2",203,0)
 I +$G(IBIFN) S X=$G(^DGCR(399,+IBIFN,"M")) I +$G(COB),COB<4 S Y=COB+11,PPOL=$P(X,U,Y)
"RTN","IBCEF2",204,0)
 Q PPOL
"RTN","IBCEF2",205,0)
 ;
"RTN","IBCEF2",206,0)
LADJ(SUB,LINE,SEQ1,GRP,IBXSAVE,PIECE) ; Extract line level adjustments
"RTN","IBCEF2",207,0)
 ; SUB     = 1st subscript in IBXSAVE array to use
"RTN","IBCEF2",208,0)
 ; LINE    = 2nd subscript
"RTN","IBCEF2",209,0)
 ; SEQ1    = 4th subscript
"RTN","IBCEF2",210,0)
 ; GRP     = 5th subscript
"RTN","IBCEF2",211,0)
 ; IBXSAVE = array that has the data for COB line level adjustments
"RTN","IBCEF2",212,0)
 ; PIECE   = # of the piece on the 0-node of the line level
"RTN","IBCEF2",213,0)
 ;           adjustment reason to be extracted
"RTN","IBCEF2",214,0)
 ;
"RTN","IBCEF2",215,0)
 N A,B
"RTN","IBCEF2",216,0)
 S (A,B)=0
"RTN","IBCEF2",217,0)
 F  S A=$O(IBXSAVE(SUB,LINE,"COB",SEQ1,GRP,A)) Q:'A  D
"RTN","IBCEF2",218,0)
 . S B=B+1,IBXDATA(B)=$P(IBXSAVE(SUB,LINE,"COB",SEQ1,GRP,A),U,PIECE)
"RTN","IBCEF2",219,0)
 Q
"RTN","IBCEF2",220,0)
 ;
"RTN","IBCEF2",221,0)
ESGHPST(IBIFN,COB) ; return insureds employ status if bill policy defined by COB is an Employer Sponsored Group Health Plan
"RTN","IBCEF2",222,0)
 Q $$ESGHPST^IBCEF21(IBIFN,COB) ;Tag moved
"RTN","IBCEF2",223,0)
 ;
"RTN","IBCEF2",224,0)
ESGHPNL(IBIFN,COB) ; return employer name and location if bill policy defined by COB is an Employer Sponsored Group Health Plan
"RTN","IBCEF2",225,0)
 Q $$ESGHPNL^IBCEF21(IBIFN,COB) ;Tag moved
"RTN","IBCEF2",226,0)
 ;
"RTN","IBCEF2",227,0)
AMTOUT(A,B,C,IBXSAVE) ; format output amount
"RTN","IBCEF2",228,0)
 ;
"RTN","IBCEF2",229,0)
 N Z,K,IBZ,IBARR K IBXDATA S (IBZ,K)=0,IBARR="IBXSAVE("""_A_""")" F  S IBZ=$O(@IBARR@(IBZ)) Q:'IBZ  S K=K+1,Z=0 F  S Z=$O(@IBARR@(IBZ,Z)) Q:'Z  I $P($G(@IBARR@(IBZ,Z,B)),U,C) S IBXDATA(K)=$$DOLLAR^IBCEFG1($G(IBXDATA(K))+$P(@IBARR@(IBZ,Z,B),U,C))
"RTN","IBCEF2",230,0)
 Q
"RTN","IBCEF22")
0^53^B61306963^B52286279
"RTN","IBCEF22",1,0)
IBCEF22 ;ALB/TMP - FORMATTER SPECIFIC BILL FUNCTIONS ;06-FEB-96
"RTN","IBCEF22",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,135,155,309,349,389,432**;21-MAR-94;Build 192
"RTN","IBCEF22",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF22",4,0)
 ;
"RTN","IBCEF22",5,0)
 ;  OVERFLOW FROM ROUTINE IBCEF2
"RTN","IBCEF22",6,0)
HOS(IBIFN) ; Extract rev codes for episode billed on a UB-04 into IBXDATA
"RTN","IBCEF22",7,0)
 ; IBIFN = bill ien
"RTN","IBCEF22",8,0)
 ; Format: IBXDATA(n) =
"RTN","IBCEF22",9,0)
 ;  rev cd ptr ^ CPT CODE ptr ^ unit chg ^ units ^ tot charge
"RTN","IBCEF22",10,0)
 ;    ^ tot uncov^ FL49 value ^ ien of rev code multiple entry(s)
"RTN","IBCEF22",11,0)
 ;      (separated by ";")
"RTN","IBCEF22",12,0)
 ;    ^ modifiers specific to rev code/proc (separated by ",")
"RTN","IBCEF22",13,0)
 ;    ^ rev code date, if it can be determined by a corresponding proc
"RTN","IBCEF22",14,0)
 ;
"RTN","IBCEF22",15,0)
 ;   Also Returns IBXDATA(IBI,"COB",COB,m) with COB data for each line
"RTN","IBCEF22",16,0)
 ;      item found in an accepted EOB for the bill and = the reference
"RTN","IBCEF22",17,0)
 ;      line in the first '^' piece followed by the '0' node of file
"RTN","IBCEF22",18,0)
 ;      361.115 (LINE LEVEL ADJUSTMENTS)
"RTN","IBCEF22",19,0)
 ;       COB = COB seq # of adjustment's ins co, m = seq #
"RTN","IBCEF22",20,0)
 ;         -- AND --
"RTN","IBCEF22",21,0)
 ;    IBXDATA(IBI,"COB",COB,m,z,p)=
"RTN","IBCEF22",22,0)
 ;           the '0' node for each subordinate entry of file
"RTN","IBCEF22",23,0)
 ;           361.11511 (REASONS) (Only first 3 pieces for 837)
"RTN","IBCEF22",24,0)
 ;       z = group code, sometimes preceeded by a space   p = seq #
"RTN","IBCEF22",25,0)
 ;
"RTN","IBCEF22",26,0)
 ;         -- AND --
"RTN","IBCEF22",27,0)
 ;    IBXDATA(n,"CPLNK") = soft link to corresponding entry in PROCEDURES multiple of file 399
"RTN","IBCEF22",28,0)
 ;
"RTN","IBCEF22",29,0)
 N IBDA,IBCOMB,IBINPAT,IBLN,IBX,IBY,IBZ,IBS,IBSS,IBXTRA,IBX1,IBXS,IBP,IBPO,IBP1,IBDEF,Z,Z0,Z1,ZX,QQ,IBMOD
"RTN","IBCEF22",30,0)
 S IBINPAT=$$INPAT^IBCEF(IBIFN,1)
"RTN","IBCEF22",31,0)
 I 'IBINPAT D F^IBCEF("N-STATEMENT COVERS FROM DATE","IBZ",,IBIFN)
"RTN","IBCEF22",32,0)
 S IBDEF=$G(IBZ)
"RTN","IBCEF22",33,0)
 ; loop through all proc codes - sort by procedure, modifiers and print order
"RTN","IBCEF22",34,0)
 S IBDA=0 F  S IBDA=$O(^DGCR(399,IBIFN,"CP",IBDA)) Q:'IBDA  S IBZ=$G(^(IBDA,0)) I IBZ D
"RTN","IBCEF22",35,0)
 . S IBP(+$P(IBZ,U)_U_$$GETMOD^IBEFUNC(IBIFN,IBDA,1),$S($P(IBZ,U,4):$P(IBZ,U,4),1:999),IBDA)=$P(IBZ,U,2)
"RTN","IBCEF22",36,0)
 ; loop through all rev codes - sort by rev code
"RTN","IBCEF22",37,0)
 S IBDA=0 F  S IBDA=$O(^DGCR(399,IBIFN,"RC",IBDA)) Q:'IBDA  S IBZ=$G(^(IBDA,0)) I IBZ S IBMOD="" D
"RTN","IBCEF22",38,0)
 . S IBX=$G(^DGCR(399.2,+IBZ,0)),IBX1="",IBPO=0
"RTN","IBCEF22",39,0)
 . ; Auto-added procedure charge
"RTN","IBCEF22",40,0)
 . I $P(IBZ,U,10)=4,$P(IBZ,U,11) D  ; Soft link to proc
"RTN","IBCEF22",41,0)
 .. S Z=$G(^DGCR(399,IBIFN,"CP",$P(IBZ,U,11),0))
"RTN","IBCEF22",42,0)
 .. Q:Z=""
"RTN","IBCEF22",43,0)
 .. S ZX=+Z_U_$$GETMOD^IBEFUNC(IBIFN,$P(IBZ,U,11),1)
"RTN","IBCEF22",44,0)
 .. Q:'$O(IBP(ZX,0))&'$O(IBP1(ZX,0))
"RTN","IBCEF22",45,0)
 .. I $P(IBZ,U,6) Q:$S($P(Z,U)'["ICPT":1,1:+$P(Z,U)'=$P(IBZ,U,6))
"RTN","IBCEF22",46,0)
 .. S Z0=$S($D(IBP(ZX)):$O(IBP(ZX,0)),1:$O(IBP1(ZX,0)))
"RTN","IBCEF22",47,0)
 .. S:'Z0 Z0=999
"RTN","IBCEF22",48,0)
 .. Q:'$D(IBP(ZX,+Z0,$P(IBZ,U,11)))&'$D(IBP1(ZX,+Z0,$P(IBZ,U,11)))
"RTN","IBCEF22",49,0)
 .. I '$D(IBP1(ZX,+Z0,$P(IBZ,U,11))) S IBP1(ZX,+Z0,$P(IBZ,U,11))=IBP(ZX,+Z0,$P(IBZ,U,11)) K IBP(ZX,+Z0,$P(IBZ,U,11))
"RTN","IBCEF22",50,0)
 .. S IBX1=$P(Z,U,2),IBPO=+Z0,IBMOD=$P(ZX,U,2)
"RTN","IBCEF22",51,0)
 . ; Manually added charge with a procedure
"RTN","IBCEF22",52,0)
 . I $P(IBZ,U,6),$S($P(IBZ,U,10)=4:'$P(IBZ,U,11),1:1),+$O(IBP($P(IBZ,U,6)))=$P(IBZ,U,6) D
"RTN","IBCEF22",53,0)
 .. ; No direct link, but a proc exists on rev code and in procedure mult without and then with modifiers
"RTN","IBCEF22",54,0)
 .. S ZX=$O(IBP($P(IBZ,U,6)))
"RTN","IBCEF22",55,0)
 .. F QQ=1,2 Q:IBPO  S Z="" F  S Z=$O(IBP(ZX,Z),-1) Q:'Z!(IBPO)  S Z0=0 F  S Z0=$O(IBP(ZX,Z,Z0)) Q:'Z0  S Z1=$G(^DGCR(399,IBIFN,"CP",Z0,0)) D  Q:IBPO
"RTN","IBCEF22",56,0)
 ... ; Ignore if not a CPT or a modifier exists and this is first pass
"RTN","IBCEF22",57,0)
 ... S IBMOD=$$GETMOD^IBEFUNC(IBIFN,Z0,1)
"RTN","IBCEF22",58,0)
 ... Q:$S($P(Z1,U)'["ICPT":1,QQ=1:IBMOD'="",1:0)
"RTN","IBCEF22",59,0)
 ... S IBPO=+$P(Z1,U,4),IBX1=$P(Z1,U,2)
"RTN","IBCEF22",60,0)
 ... K IBP(+Z1_U_IBMOD,Z,Z0)
"RTN","IBCEF22",61,0)
 . ;
"RTN","IBCEF22",62,0)
 . I IBX'="" D  ; revenue code is valid
"RTN","IBCEF22",63,0)
 .. F Z=900:1 S Z0=$S(IBPO:IBPO,$D(IBX(" "_$P(IBX,U),Z)):0,1:Z) I Z0 S IBPO=Z0 Q
"RTN","IBCEF22",64,0)
 .. S IBX(" "_$P(IBX,U),IBPO,IBDA)=IBX,IBX(" "_$P(IBX,U),IBPO,IBDA,"DT")=$S(IBX1:IBX1,1:IBDEF),IBX(" "_$P(IBX,U),IBPO,IBDA,"MOD")=IBMOD
"RTN","IBCEF22",65,0)
 ;
"RTN","IBCEF22",66,0)
 S IBS="" F  S IBS=$O(IBX(IBS)) Q:IBS=""  S IBPO=0 F  S IBPO=$O(IBX(IBS,IBPO)) Q:'IBPO  D
"RTN","IBCEF22",67,0)
 . S IBDA=0 F  S IBDA=$O(IBX(IBS,IBPO,IBDA)) Q:'IBDA  S IBX=$G(IBX(IBS,IBPO,IBDA)),IBZ=$G(^DGCR(399,IBIFN,"RC",IBDA,0)) I IBX'="" D
"RTN","IBCEF22",68,0)
 .. ;S IBXS=$P(IBZ,U,2)_U_$P(IBZ,U,6)_U_$G(IBX(IBS,IBPO,IBDA,"MOD"))
"RTN","IBCEF22",69,0)
 .. S IBXS=U_$P(IBZ,U,6)_U_$G(IBX(IBS,IBPO,IBDA,"MOD")) ;combine same proc and modifiers regardless of rate
"RTN","IBCEF22",70,0)
 .. S:IBPO'<900&'$$ACCRV($P(IBS," ",2))&$S(IBINPAT:$P(IBZ,U,6),1:1) IBCOMB(IBS,IBXS,IBPO)=IBDA
"RTN","IBCEF22",71,0)
 .. S:'$D(IBX1(IBS,IBPO,IBXS,1)) IBX1(IBS,IBPO,IBXS,1)=IBX,IBX1(IBS,IBPO,IBXS,2)=IBZ
"RTN","IBCEF22",72,0)
 .. S $P(IBX1(IBS,IBPO,IBXS),U)=$P($G(IBX1(IBS,IBPO,IBXS)),U)+$P(IBZ,U,3)
"RTN","IBCEF22",73,0)
 .. S $P(IBX1(IBS,IBPO,IBXS),U,2)=$P($G(IBX1(IBS,IBPO,IBXS)),U,2)+$P(IBZ,U,4)
"RTN","IBCEF22",74,0)
 .. S IBX1(IBS,IBPO,IBXS,"DT")=$G(IBX(IBS,IBPO,IBDA,"DT")),IBX1(IBS,IBPO,IBXS,"IEN")=$G(IBX1(IBS,IBPO,IBXS,"IEN"))_$S($G(IBX1(IBS,IBPO,IBXS,"IEN")):";",1:"")_IBDA
"RTN","IBCEF22",75,0)
 ;
"RTN","IBCEF22",76,0)
 S IBS="" F  S IBS=$O(IBX1(IBS)) Q:IBS=""  S IBPO=899 F  S IBPO=$O(IBX1(IBS,IBPO)) Q:'IBPO  D  ; Check to combine like rev codes without print order
"RTN","IBCEF22",77,0)
 . N Q,Q0,Q1,Z,Z0,Z1,Z2,IBZ1,IBZ2
"RTN","IBCEF22",78,0)
 . S Z=""
"RTN","IBCEF22",79,0)
 . N IBACC
"RTN","IBCEF22",80,0)
 . F  S Z=$O(IBX1(IBS,IBPO,Z)) Q:Z=""  S Q=IBPO F  S Q=$O(IBCOMB(IBS,Z,Q)) Q:'Q  I Q'=IBPO S IBZ1=$G(IBX1(IBS,IBPO,Z,1)),IBZ2=$G(IBX1(IBS,IBPO,Z,2)) D
"RTN","IBCEF22",81,0)
 .. Q:$G(IBX1(IBS,IBPO,Z,1))'=$G(IBX1(IBS,Q,Z,1))
"RTN","IBCEF22",82,0)
 .. S Q1=1,IBACC=$$ACCRV(+$P(IBS," ",2))
"RTN","IBCEF22",83,0)
 .. F Q0=1,5:1:7,10:1:13,15 D  Q:'Q1
"RTN","IBCEF22",84,0)
 ... I IBACC Q:Q0=5!(Q0>6)
"RTN","IBCEF22",85,0)
 ... I (Q0=11!(Q0=15))&($P($G(IBX1(IBS,Q,Z,2)),U,10)=3) Q
"RTN","IBCEF22",86,0)
 ... I Q0=5,'IBINPAT Q
"RTN","IBCEF22",87,0)
 ... I $P($G(IBX1(IBS,IBPO,Z,2)),U,Q0)'=$P($G(IBX1(IBS,Q,Z,2)),U,Q0) S Q1=0
"RTN","IBCEF22",88,0)
 .. Q:'Q1
"RTN","IBCEF22",89,0)
 .. S $P(IBX1(IBS,IBPO,Z,2),U,3)=$P(IBX1(IBS,IBPO,Z,2),U,3)+$P(IBX1(IBS,Q,Z,2),U,3)
"RTN","IBCEF22",90,0)
 .. S $P(IBX1(IBS,IBPO,Z,2),U,4)=$P(IBX1(IBS,IBPO,Z,2),U,4)+$P(IBX1(IBS,Q,Z,2),U,4)
"RTN","IBCEF22",91,0)
 .. S $P(IBX1(IBS,IBPO,Z,2),U,9)=$P(IBX1(IBS,IBPO,Z,2),U,9)+$P(IBX1(IBS,Q,Z,2),U,9)
"RTN","IBCEF22",92,0)
 .. S IBX1(IBS,IBPO,Z)=$P(IBX1(IBS,IBPO,Z,2),U,3)_U_$P(IBX1(IBS,IBPO,Z,2),U,4)
"RTN","IBCEF22",93,0)
 .. S IBX1(IBS,IBPO,Z,"IEN")=IBX1(IBS,IBPO,Z,"IEN")_";"_IBX1(IBS,Q,Z,"IEN")
"RTN","IBCEF22",94,0)
 .. K IBX1(IBS,Q,Z)
"RTN","IBCEF22",95,0)
 ;
"RTN","IBCEF22",96,0)
 S IBS="",IBLN=0
"RTN","IBCEF22",97,0)
 F  S IBS=$O(IBX1(IBS)) Q:IBS=""  S IBPO=0 F  S IBPO=$O(IBX1(IBS,IBPO)) Q:'IBPO  S IBSS="" F  S IBSS=$O(IBX1(IBS,IBPO,IBSS)) Q:IBSS=""  D
"RTN","IBCEF22",98,0)
 . S IBX=$G(IBX1(IBS,IBPO,IBSS,1)),IBZ=$G(IBX1(IBS,IBPO,IBSS,2))
"RTN","IBCEF22",99,0)
 . S IBLN=$G(IBLN)+1,IBXDATA(IBLN)=$P(IBX,U)_U_$P(IBZ,U,6)_U_$P(IBZ,U,2)_U_+IBX1(IBS,IBPO,IBSS)_U_+$P(IBX1(IBS,IBPO,IBSS),U,2),$P(IBXDATA(IBLN),U,10)=$G(IBX1(IBS,IBPO,IBSS,"DT"))
"RTN","IBCEF22",100,0)
 . S $P(IBXDATA(IBLN),U,6)=$P(IBZ,U,9),$P(IBXDATA(IBLN),U,7)=$P(IBZ,U,13),$P(IBXDATA(IBLN),U,8)=$G(IBX1(IBS,IBPO,IBSS,"IEN")),$P(IBXDATA(IBLN),U,9)=$P($P(IBSS,U,3),",",1,2)
"RTN","IBCEF22",101,0)
 . S IBXDATA(IBLN,"CPLNK")=$$RC2CP(IBIFN,$P($P(IBXDATA(IBLN),U,8),";"))
"RTN","IBCEF22",102,0)
 . ; Extract line lev COB data for sec or tert bill
"RTN","IBCEF22",103,0)
 . I $$COBN^IBCEF(IBIFN)>1 D COBLINE^IBCEU6(IBIFN,IBLN,.IBXDATA,,.IBXTRA) I $D(IBXTRA) D COMBO^IBCEU2(.IBXDATA,.IBXTRA,1) ;Handle bundled/unbundled
"RTN","IBCEF22",104,0)
 I $D(^IBA(362.4,"AIFN"_IBIFN))!$D(^IBA(362.5,"AIFN"_IBIFN)) D
"RTN","IBCEF22",105,0)
 . N IBARRAY,IBX,IBZ,IBRX,IBLCNT
"RTN","IBCEF22",106,0)
 . S IBLCNT=0
"RTN","IBCEF22",107,0)
 . ; Print prescriptions, prosthetics on front of UB-04
"RTN","IBCEF22",108,0)
 . D SET^IBCSC5A(IBIFN,.IBARRAY)
"RTN","IBCEF22",109,0)
 . I $P(IBARRAY,U,2) D
"RTN","IBCEF22",110,0)
 .. S IBX=+$P(IBARRAY,U,2)+2
"RTN","IBCEF22",111,0)
 .. S IBLCNT=IBLCNT+1,IBXSAVE("RX-UB-04",IBLCNT)=""
"RTN","IBCEF22",112,0)
 .. S IBLCNT=IBLCNT+1,IBXSAVE("RX-UB-04",IBLCNT)="PRESCRIPTION REFILLS:",IBLCNT=2
"RTN","IBCEF22",113,0)
 .. S IBX=0 F  S IBX=$O(IBARRAY(IBX)) Q:IBX=""  S IBY=0 F  S IBY=$O(IBARRAY(IBX,IBY)) Q:'IBY  S IBRX=IBARRAY(IBX,IBY) D
"RTN","IBCEF22",114,0)
 ... D ZERO^IBRXUTL(+$P(IBRX,U,2))
"RTN","IBCEF22",115,0)
 ... S IBLCNT=IBLCNT+1,IBXSAVE("RX-UB-04",IBLCNT)=IBX_$J(" ",(11-$L(IBX)))_" "_$J($S($P(IBRX,U,6):"$"_$FN($P(IBRX,U,6),",",2),1:""),10)_"  "_$J($$FMTE^XLFDT(IBY,2),8)_"  "_$G(^TMP($J,"IBDRUG",+$P(IBRX,U,2),.01))
"RTN","IBCEF22",116,0)
 ... S IBZ=$S(+$P(IBRX,U,4):"QTY: "_$P(IBRX,U,4)_" ",1:"")_$S(+$P(IBRX,U,3):"for "_$P(IBRX,U,3)_" days supply ",1:"") I IBZ'="" S IBLCNT=IBLCNT+1,IBXSAVE("RX-UB-04",IBLCNT)=$J(" ",35)_IBZ
"RTN","IBCEF22",117,0)
 ... S IBZ=$S($P(IBRX,U,5)'="":"NDC #: "_$P(IBRX,U,5),1:"") I IBZ'="" S IBLCNT=IBLCNT+1,IBXSAVE("RX-UB-04",IBLCNT)=$J(" ",35)_IBZ
"RTN","IBCEF22",118,0)
 ... K ^TMP($J,"IBDRUG")
"RTN","IBCEF22",119,0)
 ... Q
"RTN","IBCEF22",120,0)
 . ;
"RTN","IBCEF22",121,0)
 . D SET^IBCSC5B(IBIFN,.IBARRAY)
"RTN","IBCEF22",122,0)
 . I $P(IBARRAY,U,2) D
"RTN","IBCEF22",123,0)
 .. S IBLCNT=0
"RTN","IBCEF22",124,0)
 .. S IBX=+$P(IBARRAY,U,2)+2
"RTN","IBCEF22",125,0)
 .. S IBLCNT=IBLCNT+1,IBXSAVE("PROS-UB-04",IBLCNT)=""
"RTN","IBCEF22",126,0)
 .. S IBLCNT=IBLCNT+1,IBXSAVE("PROS-UB-04",IBLCNT)="PROSTHETIC REFILLS:",IBLCNT=2
"RTN","IBCEF22",127,0)
 .. S IBX=0 F  S IBX=$O(IBARRAY(IBX)) Q:IBX=""  S IBY=0 F  S IBY=$O(IBARRAY(IBX,IBY)) Q:'IBY  D
"RTN","IBCEF22",128,0)
 ... S IBLCNT=IBLCNT+1,IBXSAVE("PROS-UB-04",IBLCNT)=$$FMTE^XLFDT(IBX,2)_" "_$J($S($P(IBARRAY(IBX,IBY),U,2):"$"_$FN($P(IBARRAY(IBX,IBY),U,2),",",2),1:""),10)_"  "_$E($$PINB^IBCSC5B(+IBARRAY(IBX,IBY)),1,54)
"RTN","IBCEF22",129,0)
 Q
"RTN","IBCEF22",130,0)
 ;
"RTN","IBCEF22",131,0)
ACCRV(X) ; Returns 1 if X is an accomodation RC, 0 if not
"RTN","IBCEF22",132,0)
 Q ((X'<100&(X'>219))!(X=224))
"RTN","IBCEF22",133,0)
 ;
"RTN","IBCEF22",134,0)
RC2CP(IBIFN,IBRCIEN) ; returns "CP" multiple pointer that corresponds to a given "RC" multiple pointer in file 399
"RTN","IBCEF22",135,0)
 ; IBIFN - ien in file 399, top level
"RTN","IBCEF22",136,0)
 ; IBRCIEN, ien in sub-file 399.042 (REVENUE CODE)
"RTN","IBCEF22",137,0)
 ;
"RTN","IBCEF22",138,0)
 ; returns pointer to sub-file 399.0304 (PROCEDURES) or 0 if no valid pointer can be found.
"RTN","IBCEF22",139,0)
 ;
"RTN","IBCEF22",140,0)
 N IBRC0,IBCPIEN
"RTN","IBCEF22",141,0)
 I +IBIFN'>0 Q 0
"RTN","IBCEF22",142,0)
 I +IBRCIEN'>0 Q 0
"RTN","IBCEF22",143,0)
 S IBRC0=$G(^DGCR(399,IBIFN,"RC",IBRCIEN,0)),IBCPIEN=0
"RTN","IBCEF22",144,0)
 I $P(IBRC0,U,10)=4 S IBCPIEN=+$P(IBRC0,U,11) ; type = CPT
"RTN","IBCEF22",145,0)
 I $P(IBRC0,U,10)=3 S IBCPIEN=+$P(IBRC0,U,15) ; type = RX
"RTN","IBCEF22",146,0)
 I 'IBCPIEN D
"RTN","IBCEF22",147,0)
 . S IBRC=$P(IBRC0,U,6)
"RTN","IBCEF22",148,0)
 . N IBCPTIEN S IBCPTIEN=IBRC
"RTN","IBCEF22",149,0)
 . F  S IBCPTIEN=$O(^DGCR(399,IBIFN,"CP","B",IBCPTIEN)) Q:(+IBCPTIEN'=IBRC)!IBCPIEN  D
"RTN","IBCEF22",150,0)
 .. N OK,Z S OK="",Z=""
"RTN","IBCEF22",151,0)
 .. S Z=$O(^DGCR(399,IBIFN,"CP","B",IBCPTIEN,Z)) Q:'Z!OK  D
"RTN","IBCEF22",152,0)
 ... N CNTR S CNTR=0
"RTN","IBCEF22",153,0)
 ... F  S CNTR=$O(IBXDATA(CNTR)) Q:'CNTR!'OK  D
"RTN","IBCEF22",154,0)
 .... I $G(IBXDATA(CNTR,"CPLNK"))=Z S OK=0 Q
"RTN","IBCEF22",155,0)
 ... I OK="" S OK=1,IBCPIEN=Z
"RTN","IBCEF22",156,0)
 I IBCPIEN,'$D(^DGCR(399,IBIFN,"CP",IBCPIEN)) S IBCPIEN=0
"RTN","IBCEF22",157,0)
 Q IBCPIEN
"RTN","IBCEF31")
0^27^B12054415^B8824956
"RTN","IBCEF31",1,0)
IBCEF31 ;ALB/ESG - FORMATTER SPECIFIC BILL FLD FUNCTIONS - CONT ;14-NOV-03
"RTN","IBCEF31",2,0)
 ;;2.0;INTEGRATED BILLING;**155,296,349,400,432**;21-MAR-94;Build 192
"RTN","IBCEF31",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF31",4,0)
 ;
"RTN","IBCEF31",5,0)
 Q
"RTN","IBCEF31",6,0)
 ;
"RTN","IBCEF31",7,0)
ALLTYP(IBIFN) ; returns codes to translate to ALL ins types on a bill
"RTN","IBCEF31",8,0)
 ; IBIFN = ien of bill
"RTN","IBCEF31",9,0)
 N IBX,Z
"RTN","IBCEF31",10,0)
 F Z=1:1:3 S $P(IBX,U,Z)=$$INSTYP(IBIFN,Z)
"RTN","IBCEF31",11,0)
 ; IBX = primary code^secondary code^tertiary code
"RTN","IBCEF31",12,0)
 Q IBX
"RTN","IBCEF31",13,0)
 ;
"RTN","IBCEF31",14,0)
INSTYP(IBIFN,SEQ) ; Returns insurance type code for an ins on a bill
"RTN","IBCEF31",15,0)
 ; IBIFN = ien of bill
"RTN","IBCEF31",16,0)
 ; SEQ = sequence (1,2,3) of insurance wanted - prim, second, tert
"RTN","IBCEF31",17,0)
 ;       Default is current insurance co
"RTN","IBCEF31",18,0)
 ;
"RTN","IBCEF31",19,0)
 N IBA,Z
"RTN","IBCEF31",20,0)
 ;
"RTN","IBCEF31",21,0)
 I '$G(SEQ) S SEQ=$$COBN^IBCEF(IBIFN)
"RTN","IBCEF31",22,0)
 S Z=+$G(^DGCR(399,IBIFN,"I"_SEQ))
"RTN","IBCEF31",23,0)
 ;Codes 1:HMO;2:COMMERCIAL;3:MEDICARE;4:MEDICAID;5:GROUP POLICY;9:OTHER
"RTN","IBCEF31",24,0)
 I Z D
"RTN","IBCEF31",25,0)
 . S IBA=$P($G(^DIC(36,Z,3)),U,9)
"RTN","IBCEF31",26,0)
 . I $$MCRWNR^IBEFUNC(Z) S IBA=3   ; force Medicare (WNR) definition to be correct
"RTN","IBCEF31",27,0)
 . I IBA="" S IBA=5 ;Default is group policy - 5 if blank
"RTN","IBCEF31",28,0)
 ;
"RTN","IBCEF31",29,0)
 Q $G(IBA)
"RTN","IBCEF31",30,0)
 ;
"RTN","IBCEF31",31,0)
POLTYP(IBIFN,IBSEQ) ; Returns ins electronic policy type code for one
"RTN","IBCEF31",32,0)
 ;   ins policy on a bill
"RTN","IBCEF31",33,0)
 ; IBIFN = ien of bill
"RTN","IBCEF31",34,0)
 ; IBSEQ = sequence (1,2,3) of ins policy wanted - prim, second, tert
"RTN","IBCEF31",35,0)
 ;       Default is current insurance co
"RTN","IBCEF31",36,0)
 ;
"RTN","IBCEF31",37,0)
 N IBPLAN,IBPLTYP
"RTN","IBCEF31",38,0)
 ;
"RTN","IBCEF31",39,0)
 I '$G(IBSEQ) S IBSEQ=+$$COBN^IBCEF(IBIFN)
"RTN","IBCEF31",40,0)
 S IBPLAN=$G(^IBA(355.3,+$P($G(^DGCR(399,IBIFN,"I"_IBSEQ)),U,18),0))
"RTN","IBCEF31",41,0)
 S IBPLTYP=$P(IBPLAN,U,15)
"RTN","IBCEF31",42,0)
 ;
"RTN","IBCEF31",43,0)
 ; esg - 06/30/05 - IB*2.0*296 - Force Medicare (WNR) to be correct
"RTN","IBCEF31",44,0)
 I $$WNRBILL^IBEFUNC(IBIFN,IBSEQ),$$FT^IBCEF(IBIFN)=2 S IBPLTYP="MB"   ; CMS-1500 ----> Medicare Part B
"RTN","IBCEF31",45,0)
 I $$WNRBILL^IBEFUNC(IBIFN,IBSEQ),$$FT^IBCEF(IBIFN)=3 S IBPLTYP="MA"   ; UB-04 -------> Medicare Part A
"RTN","IBCEF31",46,0)
 ;
"RTN","IBCEF31",47,0)
 I IBPLTYP="" S IBPLTYP="CI" ;Default is commercial - 'CI'
"RTN","IBCEF31",48,0)
 I IBPLTYP="MX" D
"RTN","IBCEF31",49,0)
 . I $P(IBPLAN,U,14)'="","AB"[$P(IBPLAN,U,14) S IBPLTYP="M"_$P(IBPLAN,U,14) Q
"RTN","IBCEF31",50,0)
 . S IBPLTYP="CI"
"RTN","IBCEF31",51,0)
 Q $G(IBPLTYP)
"RTN","IBCEF31",52,0)
 ;
"RTN","IBCEF31",53,0)
ALLPTYP(IBIFN) ; returns insurance policy type codes for ALL ins on a bill
"RTN","IBCEF31",54,0)
 ; IBIFN = ien of bill
"RTN","IBCEF31",55,0)
 N IBX,Z S IBX=""
"RTN","IBCEF31",56,0)
 F Z=1:1:3 I $D(^DGCR(399,IBIFN,"I"_Z)) S $P(IBX,U,Z)=$$POLTYP(IBIFN,Z)
"RTN","IBCEF31",57,0)
 ; IBX = primary code^secondary code^tertiary code
"RTN","IBCEF31",58,0)
 Q IBX
"RTN","IBCEF31",59,0)
 ;
"RTN","IBCEF31",60,0)
PGDX(DXCNT,IBX0,IBXDA,IBXLN,IBXCOL,IBXSIZE,IBXSAVE) ; Subroutine - Checks for Diagnosis Codes (Dx) beyond 
"RTN","IBCEF31",61,0)
 ; the first four, that relate to the current Dx position passed in DXCNT.
"RTN","IBCEF31",62,0)
 ; This subroutine stores the Diagnosis Codes in output global using display parameters (IBXLN,IBXCOL)
"RTN","IBCEF31",63,0)
 ; If DXCNT is 1, check for Dx's 5,9,...etc & display on pages 2,3,...etc
"RTN","IBCEF31",64,0)
 ; If DXCNT is 2, check for Dx's 6,10,...etc & display on pages 2,3,...etc
"RTN","IBCEF31",65,0)
 ; If DXCNT is 3, check for Dx's 7,11,...etc & display on pages 2,3,...etc
"RTN","IBCEF31",66,0)
 ; If DXCNT is 4, check for Dx's 8,12,...etc & display on pages 2,3,...etc
"RTN","IBCEF31",67,0)
 ;
"RTN","IBCEF31",68,0)
 ; Input: DXCNT= position of current Dx (from 1 to 4)
"RTN","IBCEF31",69,0)
 ;        IBX0= zero-level of file 364.7 of current Dx
"RTN","IBCEF31",70,0)
 ;        IBXDA= ien# of file 364.6 of current Dx
"RTN","IBCEF31",71,0)
 ;        IBXLN IBXCOL= line# & Column# of current Dx
"RTN","IBCEF31",72,0)
 ;        IBXSIZE= size counter
"RTN","IBCEF31",73,0)
 ;        IBXSAVE("DX")= local array with all Dx's on current bill
"RTN","IBCEF31",74,0)
 ;
"RTN","IBCEF31",75,0)
 N JUMP,IBPG,VAL
"RTN","IBCEF31",76,0)
 F JUMP=DXCNT+4:4 Q:'$D(IBXSAVE("DX",JUMP))  D  ;
"RTN","IBCEF31",77,0)
 . ;calculate page number where Dx number JUMP will print
"RTN","IBCEF31",78,0)
 . S IBPG=JUMP\4+(JUMP#4>0)
"RTN","IBCEF31",79,0)
 . S VAL=$P($$ICD9^IBACSV(+IBXSAVE("DX",JUMP)),U)   ; resolve Dx pointer
"RTN","IBCEF31",80,0)
 . S VAL=$$FORMAT^IBCEF3(VAL,$G(IBX0),$G(IBXDA))  ;format Dx value
"RTN","IBCEF31",81,0)
 . D SETGBL^IBCEFG(IBPG,IBXLN,IBXCOL,VAL,.IBXSIZE) ;store in output global
"RTN","IBCEF31",82,0)
 Q  ;PGDX
"RTN","IBCEF31",83,0)
 ;
"RTN","IBCEF31",84,0)
DXSV(IB,IBXSAVE) ; output formatter subroutine
"RTN","IBCEF31",85,0)
 ; save off DX codes in IBXSAVE("DX")
"RTN","IBCEF31",86,0)
 N Z,IBCT
"RTN","IBCEF31",87,0)
 S (Z,IBCT)=0
"RTN","IBCEF31",88,0)
 F  S Z=$O(IB(Z)) Q:'Z  I $G(IB(Z)) S IBCT=IBCT+1 M IBXSAVE("DX",IBCT)=IB(Z)
"RTN","IBCEF31",89,0)
 Q
"RTN","IBCEF31",90,0)
 ;
"RTN","IBCEF31",91,0)
AUTRF(IBXIEN,IBL,Z) ; returns auth # and referral# if room for both, separated by a space - IB*2.0*432
"RTN","IBCEF31",92,0)
 ; IBXIEN=  claim ien
"RTN","IBCEF31",93,0)
 ; IBL   =  field length-1 to allow for 1 blank space between numbers (28 for CMS 1500, 30 for UB-04)
"RTN","IBCEF31",94,0)
 ; Z     =  1 for PRIMARY, 2 for SECONDARY, 3 for TERTIARY
"RTN","IBCEF31",95,0)
 ; 
"RTN","IBCEF31",96,0)
 N IBXDATA,IBZ
"RTN","IBCEF31",97,0)
 Q:$G(IBXIEN)="" ""
"RTN","IBCEF31",98,0)
 ; if CMS 1500, find current codes
"RTN","IBCEF31",99,0)
 I $G(Z)="",$G(IBL)=28 S Z=$$COBN^IBCEF(IBXIEN)
"RTN","IBCEF31",100,0)
 Q:$G(Z)="" ""
"RTN","IBCEF31",101,0)
 ; if length not defined, default to shortest
"RTN","IBCEF31",102,0)
 S:IBL="" IBL=28
"RTN","IBCEF31",103,0)
 D F^IBCEF("N-"_$P("PRIMARY^SECONDARY^TERTIARY",U,Z)_" AUTH CODE",,,IBXIEN)
"RTN","IBCEF31",104,0)
 D F^IBCEF("N-"_$P("PRIMARY^SECONDARY^TERTIARY",U,Z)_" REFERRAL NUMBER","IBZ",,IBXIEN)
"RTN","IBCEF31",105,0)
 ; if length of auth and referral combined is too long, only return auth code
"RTN","IBCEF31",106,0)
 Q $S(IBZ="":IBXDATA,IBXDATA="":IBZ,$L(IBXDATA)+$L(IBZ)>IBL:IBXDATA,1:IBXDATA_" "_IBZ)
"RTN","IBCEF7")
0^84^B50797975^B49975711
"RTN","IBCEF7",1,0)
IBCEF7 ;WOIFO/SS - FORMATTER AND EXTRACTOR SPECIFIC BILL FUNCTIONS ;8/6/03 10:56am
"RTN","IBCEF7",2,0)
 ;;2.0;INTEGRATED BILLING;**232,349,432**;21-MAR-94;Build 192
"RTN","IBCEF7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF7",4,0)
 ;
"RTN","IBCEF7",5,0)
ALLPROV ;called from #364.5 entry "N-ALL CUR/OTH PROVIDER INFO"
"RTN","IBCEF7",6,0)
 ;*342/TAZ - Added call to LPRV^IBCEF80 for line level providers; restructured due to line length
"RTN","IBCEF7",7,0)
 I +$G(IBXSAVE("PROVINF",IBXIEN))=0 D
"RTN","IBCEF7",8,0)
 . N IBZ
"RTN","IBCEF7",9,0)
 . D PROVIDER(IBXIEN,"C",.IBZ),PROVIDER(IBXIEN,"O",.IBZ) S IBXSAVE("PROVINF",IBXIEN)=IBXIEN M IBXSAVE("PROVINF",IBXIEN)=IBZ
"RTN","IBCEF7",10,0)
 Q
"RTN","IBCEF7",11,0)
 ;for PRV1
"RTN","IBCEF7",12,0)
 ;Input:
"RTN","IBCEF7",13,0)
 ; IB399 ien of #399
"RTN","IBCEF7",14,0)
PRV1(IB399) ;
"RTN","IBCEF7",15,0)
 N IBN,IBZ,IBZ1,IBZN,IBZD,IBRES,IBIND,IBDEF,IBDEFTYP,IBQ,IBFRMTYP,IBZNAME
"RTN","IBCEF7",16,0)
 S IBFRMTYP=+$$FT^IBCEF(IB399)
"RTN","IBCEF7",17,0)
 S IBN=0,IBIND=0,IBRES="",IBQ=0
"RTN","IBCEF7",18,0)
 S IBDEF=$P($G(^DGCR(399,IB399,"M1")),U,$$COBN^IBCEF(IB399)+1),IBDEFTYP=""
"RTN","IBCEF7",19,0)
 I IBDEF'="" S IBDEFTYP=$$SOP^IBCEP2B(IB399,"")
"RTN","IBCEF7",20,0)
 I IBDEFTYP'="",$$CHCKPRV1^IBCEF73($S(IBFRMTYP=2:2,IBFRMTYP=3:1,1:0),IBDEFTYP)=0 S (IBDEF,IBDEFTYP)=""
"RTN","IBCEF7",21,0)
 I IBDEF'="",IBDEFTYP'="" S IBIND=IBIND+2,$P(IBRES,U,IBIND)=(IBDEFTYP_U_IBDEF)
"RTN","IBCEF7",22,0)
 F  S IBN=$O(^IBE(355.97,IBN)) Q:+IBN=0!(IBQ=1)  D
"RTN","IBCEF7",23,0)
 . S IBZ=$G(^IBE(355.97,IBN,0)),IBZ1=$G(^(1))
"RTN","IBCEF7",24,0)
 . Q:$P(IBZ,"^",4)=""!$P(IBZ1,U,9)  ;if no FACILITY'S DEFAULT ID #
"RTN","IBCEF7",25,0)
 . Q:$P(IBZ1,"^",4)!(IBDEFTYP=$P(IBZ,U,3))
"RTN","IBCEF7",26,0)
 . S IBZN=$P(IBZ,"^",3),IBZNAME=$P(IBZ,"^",1)
"RTN","IBCEF7",27,0)
 . I IBFRMTYP=2 Q:IBZN="1A"!(IBZNAME="MEDICARE PART A")  ;1500
"RTN","IBCEF7",28,0)
 . I IBFRMTYP=3 Q:IBZN="1B"!(IBZNAME="MEDICARE PART B")  ;UB
"RTN","IBCEF7",29,0)
 . Q:$$CHCKPRV1^IBCEF73($S(IBFRMTYP=2:2,IBFRMTYP=3:1,1:0),IBZN)=0
"RTN","IBCEF7",30,0)
 . I $P(IBZ,"^",2)=0!($P(IBZ,"^",2)=2) D
"RTN","IBCEF7",31,0)
 . . S IBIND=IBIND+2
"RTN","IBCEF7",32,0)
 . . I IBIND>14 S IBQ=1 Q
"RTN","IBCEF7",33,0)
 . . S $P(IBRES,"^",IBIND)=IBZN_"^"_$P(IBZ,"^",4)
"RTN","IBCEF7",34,0)
 ;Remove any duplicate entries
"RTN","IBCEF7",35,0)
 N I,Q,QUAL,QUALC,IBRESTMP,SEQ
"RTN","IBCEF7",36,0)
 F I=2:2:($L(IBRES,"^")-1) D
"RTN","IBCEF7",37,0)
 . S QUAL=$P(IBRES,"^",I)
"RTN","IBCEF7",38,0)
 . I $G(IBRESTMP(QUAL))="" S IBRESTMP(QUAL)=$P(IBRES,"^",(I+1))
"RTN","IBCEF7",39,0)
 S Q=2
"RTN","IBCEF7",40,0)
 S I="",QUAL=""
"RTN","IBCEF7",41,0)
 K IBRES
"RTN","IBCEF7",42,0)
 S IBRES=""
"RTN","IBCEF7",43,0)
 S SEQ=0
"RTN","IBCEF7",44,0)
 F  S QUAL=$O(IBRESTMP(QUAL)) Q:QUAL=""  D
"RTN","IBCEF7",45,0)
 . S SEQ=SEQ+2
"RTN","IBCEF7",46,0)
 . S $P(IBRES,"^",SEQ)=QUAL,$P(IBRES,"^",(SEQ+1))=IBRESTMP(QUAL)
"RTN","IBCEF7",47,0)
 Q IBRES
"RTN","IBCEF7",48,0)
 ;
"RTN","IBCEF7",49,0)
 ; creates array of SUBSCR IDs for all "other insurances"
"RTN","IBCEF7",50,0)
 ;Input :
"RTN","IBCEF7",51,0)
 ; IBXIEN - ien in #399
"RTN","IBCEF7",52,0)
 ;Output:
"RTN","IBCEF7",53,0)
 ; IBZOUT(Z) - array with ien of #36 
"RTN","IBCEF7",54,0)
OTHSBID(IBXIEN,IBZOUT) ;
"RTN","IBCEF7",55,0)
 N Z,Z0,Z1,IBZ,C
"RTN","IBCEF7",56,0)
 D F^IBCEF("N-ALL INSURANCE CO 837 ID","IBZ")
"RTN","IBCEF7",57,0)
 F Z=1,2,3 S IBZ(Z)=$$POLICY^IBCEF(IBXIEN,2,$E("PST",Z))
"RTN","IBCEF7",58,0)
 K IBXDATA
"RTN","IBCEF7",59,0)
 S C=$$OTHINS1^IBCEF2(IBXIEN)
"RTN","IBCEF7",60,0)
 F Z=1,2 I $G(IBZ(Z))'="",$E(C,Z) D
"RTN","IBCEF7",61,0)
 . S IBZOUT(Z)=IBZ(+$E(C,Z))
"RTN","IBCEF7",62,0)
 Q
"RTN","IBCEF7",63,0)
 ;Input :
"RTN","IBCEF7",64,0)
 ; IBXIEN - ien in #399
"RTN","IBCEF7",65,0)
 ; IBP - # piece in address string : STR LINE1|STR LINE2|CITY|STATE|ZIP
"RTN","IBCEF7",66,0)
 ;Output:
"RTN","IBCEF7",67,0)
 ; IBARR - output array m by reference
"RTN","IBCEF7",68,0)
ELMADD2(IBXIEN,IBP,IBARR) ;
"RTN","IBCEF7",69,0)
 N IBZZZ,A,CHECK,IB1
"RTN","IBCEF7",70,0)
 I '$D(IBXSAVE("OTH_INSURED_ADDR")) D OTHADD2(IBXIEN,.IBZZZ) M IBXSAVE("OTH_INSURED_ADDR")=IBZZZ
"RTN","IBCEF7",71,0)
 S IB1=0
"RTN","IBCEF7",72,0)
 F  S IB1=$O(IBXSAVE("OTH_INSURED_ADDR",IB1)) Q:'IB1  D
"RTN","IBCEF7",73,0)
 . ;IF ANY PORTION OF ADDRESS IS NULL SET CHECK VALUE, ERASE ENTRY
"RTN","IBCEF7",74,0)
 . S CHECK=0
"RTN","IBCEF7",75,0)
 . F A=1,3,4,5 I $P(IBXSAVE("OTH_INSURED_ADDR",IB1),"|",A)="" S CHECK=1 K IBXSAVE("OTH_INSURED_ADDR",IB1) Q
"RTN","IBCEF7",76,0)
 . I 'CHECK D
"RTN","IBCEF7",77,0)
 . . I IBP=0 S IBARR(IB1)=$G(IBXSAVE("OTH_INSURED_ADDR",IB1)) Q
"RTN","IBCEF7",78,0)
 . . S IBARR(IB1)=$P($G(IBXSAVE("OTH_INSURED_ADDR",IB1)),"|",IBP)
"RTN","IBCEF7",79,0)
 Q
"RTN","IBCEF7",80,0)
 ;creates an array with address info for all other insured persons
"RTN","IBCEF7",81,0)
 ;Input :
"RTN","IBCEF7",82,0)
 ; IBXIEN - ien in #399
"RTN","IBCEF7",83,0)
 ;Output:
"RTN","IBCEF7",84,0)
 ; IBZOUT(Z) - array with STR LINE1|STR LINE2|CITY|STATE|ZIP 
"RTN","IBCEF7",85,0)
OTHADD2(IBXIEN,IBZOUT) ;
"RTN","IBCEF7",86,0)
 N C,Z,Z0,Z1,IBZ,IBZIP,IB1,IBDFN1
"RTN","IBCEF7",87,0)
 S IBZOUT=""
"RTN","IBCEF7",88,0)
 D OTHP36^IBCEF72(IBXIEN,.IBZ) ;array with iens of file #36
"RTN","IBCEF7",89,0)
 K IBXDATA
"RTN","IBCEF7",90,0)
 S C=$$OTHINS1^IBCEF2(IBXIEN)
"RTN","IBCEF7",91,0)
 F Z=1,2 I $G(IBZ(Z))'="",$E(C,Z) D
"RTN","IBCEF7",92,0)
 . S IBINS=+IBZ(+$E(C,Z))
"RTN","IBCEF7",93,0)
 . S IBDFN1=$P($G(^DGCR(399,IBXIEN,0)),"^",2)
"RTN","IBCEF7",94,0)
 . S IBZOUT(Z)=$$FR2PAT(IBDFN1,IBINS)
"RTN","IBCEF7",95,0)
 Q
"RTN","IBCEF7",96,0)
 ;Input:
"RTN","IBCEF7",97,0)
 ; IBDFN-patient ien
"RTN","IBCEF7",98,0)
 ; IBINS - input array with insurance pointers to 36
"RTN","IBCEF7",99,0)
 ;Output 
"RTN","IBCEF7",100,0)
 ; STR LINE1|STR LINE2|CITY|STATE|ZIP
"RTN","IBCEF7",101,0)
FR2PAT(IBDFN,IBINS) ;information about "other insured" address
"RTN","IBCEF7",102,0)
 N Z3,Z4,Z5,IBZIP
"RTN","IBCEF7",103,0)
 S Z3=$O(^DPT(IBDFN,.312,"B",$G(IBINS),0))
"RTN","IBCEF7",104,0)
 Q:+Z3=0 "||||"
"RTN","IBCEF7",105,0)
 S Z4=$G(^DPT(IBDFN,.312,Z3,3))
"RTN","IBCEF7",106,0)
 S IBZIP=$P($G(^DIC(5,+$P(Z4,"^",9),0)),"^",2)
"RTN","IBCEF7",107,0)
 S Z5=$P(Z4,"^",6,8)_"^"_IBZIP_"^"_$P(Z4,"^",10)
"RTN","IBCEF7",108,0)
 Q $TR(Z5,"^","|")
"RTN","IBCEF7",109,0)
 ;
"RTN","IBCEF7",110,0)
 ;Input :
"RTN","IBCEF7",111,0)
 ; IBXIEN - ien in #399
"RTN","IBCEF7",112,0)
 ; IBP - # piece in address string : STR LINE1|STR LINE2|CITY|STATE|ZIP
"RTN","IBCEF7",113,0)
 ; if IBP=0 then returns whole string
"RTN","IBCEF7",114,0)
 ;Output:
"RTN","IBCEF7",115,0)
 ; IBARR - output array m by reference
"RTN","IBCEF7",116,0)
ELMADDR(IBXIEN,IBP,IBARR) ;
"RTN","IBCEF7",117,0)
 N IB1,A,CHECK
"RTN","IBCEF7",118,0)
 D:'$D(IBXSAVE("OTH_PROV_ADDR")) OTHADDR(IBXIEN)
"RTN","IBCEF7",119,0)
 S IB1=0
"RTN","IBCEF7",120,0)
 F  S IB1=$O(IBXSAVE("OTH_PROV_ADDR",IB1)) Q:'IB1  D
"RTN","IBCEF7",121,0)
 . S CHECK=0
"RTN","IBCEF7",122,0)
 . ;EXCLUDE ADD LINE 2 SECOND PC SINCE IT'S OK FOR THAT TO BE EMPTY
"RTN","IBCEF7",123,0)
 . F A=1,3,4,5 I $P(IBXSAVE("OTH_PROV_ADDR",IB1),"|",A)="" D  Q
"RTN","IBCEF7",124,0)
 . . ;IF ANY PORTION OF ADDRESS IS NULL SET CHECK VALUE, ERASE ENTRY
"RTN","IBCEF7",125,0)
 . . S CHECK=1 K IBXSAVE("OTH_PROV_ADDR",IB1)
"RTN","IBCEF7",126,0)
 . I 'CHECK D
"RTN","IBCEF7",127,0)
 . . I IBP=0 S IBARR(IB1)=$G(IBXSAVE("OTH_PROV_ADDR",IB1)) Q
"RTN","IBCEF7",128,0)
 . . S IBARR(IB1)=$P($G(IBXSAVE("OTH_PROV_ADDR",IB1)),"|",IBP)
"RTN","IBCEF7",129,0)
 Q
"RTN","IBCEF7",130,0)
 ;
"RTN","IBCEF7",131,0)
 ;creates an array with address info for all insurances
"RTN","IBCEF7",132,0)
 ;Input :
"RTN","IBCEF7",133,0)
 ; IBXIEN - ien in #399
"RTN","IBCEF7",134,0)
 ;Output:
"RTN","IBCEF7",135,0)
 ; IBXSAVE("OTH_PROV_ADDR",Z) 
"RTN","IBCEF7",136,0)
OTHADDR(IBXIEN) ;
"RTN","IBCEF7",137,0)
 N C,Z,Z0,Z1,IBZ,IBZIP,IB1,IBINS
"RTN","IBCEF7",138,0)
 D F^IBCEF("N-OTH INSURANCE CO IEN 36") ;array with iens of file #36
"RTN","IBCEF7",139,0)
 M IBZ=IBXDATA
"RTN","IBCEF7",140,0)
 K IBXDATA
"RTN","IBCEF7",141,0)
 S C=$$OTHINS1^IBCEF2(IBXIEN)
"RTN","IBCEF7",142,0)
 F Z=1,2 I $G(IBZ(Z))'="",$E(C,Z) D
"RTN","IBCEF7",143,0)
 . S IBINS=+IBZ(+$E(C,Z))
"RTN","IBCEF7",144,0)
 . S IBZIP=$P($G(^DIC(5,+$P($G(^DIC(36,IBINS,.11)),"^",5),0)),"^",2)
"RTN","IBCEF7",145,0)
 . S IB1=$P($G(^DIC(36,IBINS,.11)),"^",1,2)_"^"_$P($G(^DIC(36,IBINS,.11)),"^",4)_"^"_IBZIP_"^"_$P($G(^DIC(36,IBINS,.11)),"^",6)
"RTN","IBCEF7",146,0)
 . S IBXSAVE("OTH_PROV_ADDR",Z)=$TR(IB1,"^","|")
"RTN","IBCEF7",147,0)
 Q
"RTN","IBCEF7",148,0)
 ;
"RTN","IBCEF7",149,0)
 ;Retrieves pointer to get info about the service provider
"RTN","IBCEF7",150,0)
 ;IBIEN399 - ien in #399
"RTN","IBCEF7",151,0)
 ;IBFUNC -function (3-RENDERING,etc)
"RTN","IBCEF7",152,0)
 ;Output: VARIABLE POINTER (PTR;file_root)
"RTN","IBCEF7",153,0)
PROVPTR(IBIEN399,IBFUNC) ;
"RTN","IBCEF7",154,0)
 ;*432/TAZ - No longer used for IBXSAVE array setup
"RTN","IBCEF7",155,0)
 N IBN
"RTN","IBCEF7",156,0)
 S IBN=$O(^DGCR(399,IBIEN399,"PRV","B",IBFUNC,0))
"RTN","IBCEF7",157,0)
 I +IBN=0 Q 0
"RTN","IBCEF7",158,0)
 Q $P($G(^DGCR(399,IBIEN399,"PRV",+IBN,0)),"^",2)
"RTN","IBCEF7",159,0)
 ;
"RTN","IBCEF7",160,0)
 ;Retrieves SSN from #200
"RTN","IBCEF7",161,0)
 ;IBPTR-  VARIABLE POINTER to #200
"RTN","IBCEF7",162,0)
PROVSSN(IBIEN399) ;
"RTN","IBCEF7",163,0)
 N IBRETVAL S IBRETVAL=""
"RTN","IBCEF7",164,0)
 N IBPTR,IBFT
"RTN","IBCEF7",165,0)
 F IBFT=1:1:9 D
"RTN","IBCEF7",166,0)
 . S IBPTR=$$PROVPTR(IBIEN399,IBFT)
"RTN","IBCEF7",167,0)
 . S $P(IBRETVAL,"^",IBFT)=$$GETSSN^IBCEF72(IBPTR)
"RTN","IBCEF7",168,0)
 Q IBRETVAL
"RTN","IBCEF7",169,0)
 ;
"RTN","IBCEF7",170,0)
 ;Input:
"RTN","IBCEF7",171,0)
 ; IBPTR- ptr to ^VA(200 or ^IBA(355.93
"RTN","IBCEF7",172,0)
 ;Output:
"RTN","IBCEF7",173,0)
 ; SSN or null
"RTN","IBCEF7",174,0)
GETNMEL(IBFULL,IBEL) ;Get name element
"RTN","IBCEF7",175,0)
 D NAMECOMP^XLFNAME(.IBFULL)
"RTN","IBCEF7",176,0)
 Q $G(IBFULL(IBEL))
"RTN","IBCEF7",177,0)
 ;-
"RTN","IBCEF7",178,0)
 ;PROVIDER
"RTN","IBCEF7",179,0)
 ;Input:
"RTN","IBCEF7",180,0)
 ; IB399 - ien of #399
"RTN","IBCEF7",181,0)
 ; IBPROV:
"RTN","IBCEF7",182,0)
 ;   "C"- to get info for CURRENT provider
"RTN","IBCEF7",183,0)
 ;   "O"- to get info for all others (in this case the array will contain info fot two providers
"RTN","IBCEF7",184,0)
 ; IBRES - array for results (by reference)
"RTN","IBCEF7",185,0)
 ;
"RTN","IBCEF7",186,0)
 ;Output:
"RTN","IBCEF7",187,0)
 ; IBRES - array to get back info (by reference)
"RTN","IBCEF7",188,0)
 ; IBRES(IBPROV,PRNUM,PRTYPE,SEQ#)=PROV^INSUR^IDTYPE^ID^FORMTYP^CARETYP
"RTN","IBCEF7",189,0)
 ; where:
"RTN","IBCEF7",190,0)
 ; IBPROV - see input parameter
"RTN","IBCEF7",191,0)
 ; PRNUM: 1=primary insurance provider, 2= secondary, 3 -tretiary
"RTN","IBCEF7",192,0)
 ; PRTYPE: Provider type(FUNCTION) 
"RTN","IBCEF7",193,0)
 ; SEQ# : sequence number (1st is used for ID1, 2nd - for ID2, etc)
"RTN","IBCEF7",194,0)
 ; PROV : provider/VARIABLEPTR
"RTN","IBCEF7",195,0)
 ; INSUR: Insurance PTR #36 or NONE
"RTN","IBCEF7",196,0)
 ; IDTYPE: ID type
"RTN","IBCEF7",197,0)
 ; ID: ID 
"RTN","IBCEF7",198,0)
 ; FORMTYP: Form type 1=UB,2=1500
"RTN","IBCEF7",199,0)
 ; CARETYP: Care type 0=both inp/outp,1=inpatient, 2=outpatient
"RTN","IBCEF7",200,0)
PROVIDER(IB399,IBPROV,IBRES) ;
"RTN","IBCEF7",201,0)
 N IBCURR,IBZ,IBRESARR
"RTN","IBCEF7",202,0)
 S IBRESARR=""
"RTN","IBCEF7",203,0)
 S IBCURR=$$COB^IBCEF(IB399) ;current bill payer sequence
"RTN","IBCEF7",204,0)
 Q:IBPROV="A"  ;PATIENT's bill
"RTN","IBCEF7",205,0)
 I IBPROV="C" D
"RTN","IBCEF7",206,0)
 . D:$$ISINSUR^IBCEF71(IBCURR,IB399) PROVINF(IB399,$S(IBCURR="T":3,IBCURR="S":2,IBCURR="P":1,1:1),.IBRESARR,1,IBPROV)
"RTN","IBCEF7",207,0)
 I IBPROV="O" D
"RTN","IBCEF7",208,0)
 . I IBCURR="P" D:$$ISINSUR^IBCEF71("S",IB399) PROVINF(IB399,2,.IBRESARR,1,IBPROV) D:$$ISINSUR^IBCEF71("T",IB399) PROVINF(IB399,3,.IBRESARR,2,IBPROV)
"RTN","IBCEF7",209,0)
 . I IBCURR="S" D:$$ISINSUR^IBCEF71("P",IB399) PROVINF(IB399,1,.IBRESARR,1,IBPROV) D:$$ISINSUR^IBCEF71("T",IB399) PROVINF(IB399,3,.IBRESARR,2,IBPROV)
"RTN","IBCEF7",210,0)
 . I IBCURR="T" D:$$ISINSUR^IBCEF71("P",IB399) PROVINF(IB399,1,.IBRESARR,1,IBPROV) D:$$ISINSUR^IBCEF71("S",IB399) PROVINF(IB399,2,.IBRESARR,2,IBPROV)
"RTN","IBCEF7",211,0)
 M IBRES(IBPROV)=IBRESARR
"RTN","IBCEF7",212,0)
 Q
"RTN","IBCEF7",213,0)
 ;
"RTN","IBCEF7",214,0)
PROVINF(IB399,IBPRNUM,IBRES,IBSORT,IBINSTP) ;
"RTN","IBCEF7",215,0)
 D PROVINF^IBCEF74(IB399,IBPRNUM,.IBRES,IBSORT,IBINSTP)
"RTN","IBCEF7",216,0)
 Q
"RTN","IBCEF7",217,0)
 ;
"RTN","IBCEF7",218,0)
PSPRV(IBIFN) ; Returns information for bill ien IBIFN for purchased svc 
"RTN","IBCEF7",219,0)
 ; Returns 4 digit data in following format:
"RTN","IBCEF7",220,0)
 ;  1st digit: 0 if not outside facility
"RTN","IBCEF7",221,0)
 ;             1 if outside facility
"RTN","IBCEF7",222,0)
 ;  2nd digit: 0 if not non-VA provider for rendering/attending
"RTN","IBCEF7",223,0)
 ;             1 if non-VA provider for rendering/attending
"RTN","IBCEF7",224,0)
 ;  3rd digit: 0 if not purchased svc
"RTN","IBCEF7",225,0)
 ;             1 if purchased svc
"RTN","IBCEF7",226,0)
 ;  4th digit: 0 if 1500 bill
"RTN","IBCEF7",227,0)
 ;             1 if UB bill
"RTN","IBCEF7",228,0)
 N IBSVC,Z,Z0,IBU2
"RTN","IBCEF7",229,0)
 S IBSVC="000"_+$$INSFT^IBCEU5(IBIFN),IBU2=$G(^DGCR(399,IBIFN,"U2"))
"RTN","IBCEF7",230,0)
 I $P(IBU2,U,10) S $E(IBSVC,1)=1 ; NON-VA FACILITY
"RTN","IBCEF7",231,0)
 S Z=($$FT^IBCEF(IBIFN)=3)+3,Z0=+$O(^DGCR(399,IBIFN,"PRV","B",Z,0))
"RTN","IBCEF7",232,0)
 I $P($G(^DGCR(399,IBIFN,"PRV",Z0,0)),U,2)["IBA(355.93" S $E(IBSVC,2)=1
"RTN","IBCEF7",233,0)
 I $P(IBU2,U,11)>0,$P(IBU2,U,11)'>2 S $E(IBSVC,3)=1
"RTN","IBCEF7",234,0)
PSPRVQ Q IBSVC
"RTN","IBCEF7",235,0)
 ;
"RTN","IBCEF7",236,0)
CHKADD ;CHECK ALL ADDRESS ELEMENTS PRESENT IF NOT KILL ALL ADDRESS ELEMENTS
"RTN","IBCEF7",237,0)
 ;EXPECT IBXSAVE("CADR") AS SOURCE ARRAY
"RTN","IBCEF7",238,0)
 N Z,CHECK
"RTN","IBCEF7",239,0)
 S Z="",CHECK=0
"RTN","IBCEF7",240,0)
 F Z=1,4,5,6 D
"RTN","IBCEF7",241,0)
 . I $P($G(IBXSAVE("CADR")),"^",Z)="" S CHECK=1
"RTN","IBCEF7",242,0)
 I CHECK=1 S IBXSAVE("CADR")=""
"RTN","IBCEF7",243,0)
 Q
"RTN","IBCEF7",244,0)
 ;
"RTN","IBCEF71")
0^80^B65598873^B63782219
"RTN","IBCEF71",1,0)
IBCEF71 ;WOIFO/SS - FORMATTER AND EXTRACTOR SPECIFIC BILL FUNCTIONS ;31-JUL-03
"RTN","IBCEF71",2,0)
 ;;2.0;INTEGRATED BILLING;**232,155,288,320,349,432**;21-MAR-94;Build 192
"RTN","IBCEF71",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF71",4,0)
 ;
"RTN","IBCEF71",5,0)
 ;---------
"RTN","IBCEF71",6,0)
 ;OTHPAYC - from FORMAT code for OP1,OP2 ...
"RTN","IBCEF71",7,0)
 ;Input:
"RTN","IBCEF71",8,0)
 ;IBXIEN - ien #399
"RTN","IBCEF71",9,0)
 ;IBSAVE - "in" array (i.e. IBXSAVE)
"RTN","IBCEF71",10,0)
 ;IBDATA - "out" array (i.e. IBXDATA)
"RTN","IBCEF71",11,0)
 ;IBFUNC - FUNCTION from #399 (1-refering,2-operating,etc)
"RTN","IBCEF71",12,0)
 ;IBVAL - output value
"RTN","IBCEF71",13,0)
 ;Output:
"RTN","IBCEF71",14,0)
 ; IBDATA with formatted output
"RTN","IBCEF71",15,0)
OTHPAYC(IBXIEN,IBSAVE,IBDATA,IBFUNC,IBVAL) ;
"RTN","IBCEF71",16,0)
 N IB1,IB2,IBINS,IBFL
"RTN","IBCEF71",17,0)
 S IBFL=$S(IBFUNC=3!(IBFUNC=4):1,1:0)
"RTN","IBCEF71",18,0)
 F IB1=1,2 D
"RTN","IBCEF71",19,0)
 . I $$ISINSUR($G(IBSAVE("PROVINF",IBXIEN,"O",IB1)),IBXIEN) D  Q  ;don't create anything if no such insurance
"RTN","IBCEF71",20,0)
 .. ;*432/TAZ Attending/Rendering is no longer either/or so there can be both
"RTN","IBCEF71",21,0)
 .. ;I IBFL S IBFUNC=$S($O(IBSAVE("PROVINF",IBXIEN,"O",IB1,3,0)):3,1:4)
"RTN","IBCEF71",22,0)
 .. S:$O(IBSAVE("PROVINF",IBXIEN,"O",IB1,IBFUNC,0)) IBDATA(IB1)=IBVAL
"RTN","IBCEF71",23,0)
 Q
"RTN","IBCEF71",24,0)
 ;----
"RTN","IBCEF71",25,0)
 ;OTHPAYV - called from FORMAT code for OP1,OP2 ...
"RTN","IBCEF71",26,0)
 ;Input:
"RTN","IBCEF71",27,0)
 ;IBXIEN - ien #399
"RTN","IBCEF71",28,0)
 ;IBSAVE - "in" array (i.e. IBXSAVE)
"RTN","IBCEF71",29,0)
 ;IBDATA - "out" array (i.e. IBXDATA)
"RTN","IBCEF71",30,0)
 ;IBFUNC - FUNCTION from #399 (1-refering, 2-operating, etc)
"RTN","IBCEF71",31,0)
 ;IBSEQN - seq # of ID/QUAL
"RTN","IBCEF71",32,0)
 ;IBFLDTYP
"RTN","IBCEF71",33,0)
 ; "I" - ID  "Q" - ID QUAL
"RTN","IBCEF71",34,0)
 ;Output:
"RTN","IBCEF71",35,0)
 ; IBDATA with formatted output
"RTN","IBCEF71",36,0)
OTHPAYV(IBXIEN,IBSAVE,IBDATA,IBFUNC,IBFLDTYP,IBSEQN) ;
"RTN","IBCEF71",37,0)
 N IB1,IB2,IBPIECE,IBINS,IBFL
"RTN","IBCEF71",38,0)
 S IBFL=$S(IBFUNC=3!(IBFUNC=4):1,1:0)
"RTN","IBCEF71",39,0)
 S IBPIECE=$S(IBFLDTYP="I":4,IBFLDTYP="Q":3,1:3)
"RTN","IBCEF71",40,0)
 F IB1=1,2 D
"RTN","IBCEF71",41,0)
 . I $$ISINSUR($G(IBSAVE("PROVINF",IBXIEN,"O",IB1)),IBXIEN) D  Q  ;don't create anything if there is no such insurance
"RTN","IBCEF71",42,0)
 .. ;*432/TAZ Attending/Rendering is no longer either/or so there can be both
"RTN","IBCEF71",43,0)
 .. ;I IBFL S IBFUNC=$S($O(IBSAVE("PROVINF",IBXIEN,"O",IB1,3,0)):3,1:4),IBFL=0
"RTN","IBCEF71",44,0)
 .. S IBDATA(IB1)=$P($G(IBSAVE("PROVINF",IBXIEN,"O",IB1,IBFUNC,IBSEQN)),U,IBPIECE)
"RTN","IBCEF71",45,0)
 Q
"RTN","IBCEF71",46,0)
 ;
"RTN","IBCEF71",47,0)
 ;chk for ins
"RTN","IBCEF71",48,0)
 ;Input:
"RTN","IBCEF71",49,0)
 ; IBINS = "P","S","T"
"RTN","IBCEF71",50,0)
 ; IBXIEN - ien file #399
"RTN","IBCEF71",51,0)
 ;Output:
"RTN","IBCEF71",52,0)
 ; returns 1-exists , 0-doesn't
"RTN","IBCEF71",53,0)
ISINSUR(IBINS,IBXIEN) ;
"RTN","IBCEF71",54,0)
 N IBINSNOD
"RTN","IBCEF71",55,0)
 S IBINSNOD=$S(IBINS="P":"I1",IBINS="S":"I2",IBINS="T":"I3",1:"")
"RTN","IBCEF71",56,0)
 I IBINSNOD="" Q 0
"RTN","IBCEF71",57,0)
 Q $D(^DGCR(399,IBXIEN,IBINSNOD))
"RTN","IBCEF71",58,0)
 ;
"RTN","IBCEF71",59,0)
 ;---PRACT----
"RTN","IBCEF71",60,0)
 ;Get list of all 355.9 or 355.93 records for prov
"RTN","IBCEF71",61,0)
 ;Input: 
"RTN","IBCEF71",62,0)
 ;IB399INS - ins co for bill to match PRACTIONER from 355.9
"RTN","IBCEF71",63,0)
 ;IB399FRM - form type (0=unknwn/both,1=UB,2=1500) to 
"RTN","IBCEF71",64,0)
 ;   match PRACTIONER from 355.9
"RTN","IBCEF71",65,0)
 ;IB399CAR - BILL CARE (0=unknwn or both inp/outp,1=inpatient,
"RTN","IBCEF71",66,0)
 ;   2=outpatient/3=Rx) to match PROV from 355.9
"RTN","IBCEF71",67,0)
 ;    OR   - DIVISION PTR to file 40.8 for entries in file 355.92
"RTN","IBCEF71",68,0)
 ;IBPROV - VARIABLE PTR VA prov
"RTN","IBCEF71",69,0)
 ;IBARR - array by reference for result
"RTN","IBCEF71",70,0)
 ;IBPROVTP- function (2-operating, 3-RENDERING,etc 0-facility)
"RTN","IBCEF71",71,0)
 ;IBINSTP - "C" -current ins , "O"-other
"RTN","IBCEF71",72,0)
 ;IBFILE - 355.92 for facility ids or 355.9 (default) for provider ids
"RTN","IBCEF71",73,0)
 ;IBINS - 1 if to include ids for the ins co for all provs
"RTN","IBCEF71",74,0)
 ;Ouput:
"RTN","IBCEF71",75,0)
 ;IBARR - array by ref for result
"RTN","IBCEF71",76,0)
 ; prov var ptr^ins ptr^X12 id cd^ID^form typ^care typ or division ptr^st ptr^id rec ptr^id type ptr
"RTN","IBCEF71",77,0)
PRACT(IB399INS,IB399FRM,IB399CAR,IBPROV,IBARR,IBPROVTP,IBINSTP,IBFILE,IBINS) ;
"RTN","IBCEF71",78,0)
 N IB1,IB2,IBDAT,IBF,IBFX,IB3559,IBINSCO,IBFRMTYP,IBIDTYP,IBID,IBIDT,IBDIV,IBQ,IBS1,IBS2,IBARRX,Z,Z1,Z2,IBCARE
"RTN","IBCEF71",79,0)
 I $G(IBFILE)="" S IBFILE=355.9
"RTN","IBCEF71",80,0)
 S IBINS=$G(IBINS)
"RTN","IBCEF71",81,0)
 S (IBARR,IB3559,IB1)=0
"RTN","IBCEF71",82,0)
 F IBF="",1 Q:IBF=1&$S(IBFILE'=355.9:1,1:'IBINS)  S IBFX=IBFILE_IBF F IB2=1:1 S IB3559=$O(^IBA(IBFX,"B",$S(IBFILE=355.9&(IBF=""):IBPROV,1:IB399INS),IB3559)) Q:IB3559=""  D
"RTN","IBCEF71",83,0)
 . S IBINSCO=$P($G(^IBA(IBFX,IB3559,0)),"^",$S(IBFILE=355.9&(IBF=""):2,1:1)) ;ins co. ptr
"RTN","IBCEF71",84,0)
 . I IBINSCO'="" I IBINSCO'=IB399INS Q  ;exclude if different ins
"RTN","IBCEF71",85,0)
 . S:IBINSCO="" IBINSCO="NONE" ;NONE will be included in the array
"RTN","IBCEF71",86,0)
 . S IBFRMTYP=+$P($G(^IBA(IBFX,IB3559,0)),"^",4) ;form type (0=both,1=UB,2=1500)
"RTN","IBCEF71",87,0)
 . I '(IBFRMTYP=0!(IB399FRM=0)) Q:IBFRMTYP'=IB399FRM  ;exclude if not "both" and different
"RTN","IBCEF71",88,0)
 . S IBCARE=+$P($G(^IBA(IBFX,IB3559,0)),"^",5) ;0=both(inp and outp),1=inp,2=outp,3=prescr  -- OR -- division ptr
"RTN","IBCEF71",89,0)
 . I $S(IBFILE=355.92:0,1:IBCARE=3) I IB399CAR'=3 Q  ; Id is only for Rx
"RTN","IBCEF71",90,0)
 . I $S(IBFILE=355.92:0,1:IBCARE=1!(IBCARE=2)) I IB399CAR=1!(IB399CAR=2) Q:IBCARE'=IB399CAR  ;both is OK
"RTN","IBCEF71",91,0)
 . I IBFILE=355.92,IBCARE Q:IB399CAR'=IBCARE  ; Division doesn't match
"RTN","IBCEF71",92,0)
 . S IBIDTYP=+$P($G(^IBA(IBFX,IB3559,0)),"^",6) ;prov ID type
"RTN","IBCEF71",93,0)
 . I IBFILE=355.9,IBIDTYP=$$TAXID^IBCEP8(),$S(IBPROV["VA(200":1,1:$P($G(^IBA(355.93,+IBPROV,0)),U,2)=2) Q  ; Don't extract tax id # id for indiv prov
"RTN","IBCEF71",94,0)
 . S IBIDT=IBIDTYP
"RTN","IBCEF71",95,0)
 . S IBIDTYP=$P($G(^IBE(355.97,IBIDTYP,0)),"^",3)
"RTN","IBCEF71",96,0)
 . Q:$P($G(^IBE(355.97,+IBIDT,1)),U,9)
"RTN","IBCEF71",97,0)
 . Q:IBFILE=355.9&(IBIDTYP="X4")  ;exclude CLIA #
"RTN","IBCEF71",98,0)
 . S IBID=$P($G(^IBA(IBFX,IB3559,0)),"^",7) ;prov ID value
"RTN","IBCEF71",99,0)
 . I $G(IBPROVTP)'="",$G(IBINSTP)'="",IBPROVTP'=0 I '$$CHCKSEC^IBCEF73(IB399FRM,IBPROVTP,IBINSTP,IBIDTYP) Q  ; No qualifier chk for fac
"RTN","IBCEF71",100,0)
 . I IBID'="" S IBDAT=IBPROV_"^"_IBINSCO_"^"_IBIDTYP_"^"_IBID_"^"_IBFRMTYP_"^"_IBCARE_"^"_"^"_IB3559_U_IBIDT,IBS2=$S(IBFX'=355.91:"",1:"INS DEF^")_IB3559
"RTN","IBCEF71",101,0)
 . I IBFILE'=355.92,IBID'="",IB399CAR=3 S IBQ=0 D  Q:IBQ
"RTN","IBCEF71",102,0)
 .. I $G(IBARRX(IBIDT))!(IBCARE=1) S IBQ=1 Q
"RTN","IBCEF71",103,0)
 .. I IBCARE=3&(IB399CAR=3) S IBARRX(IBIDT)=1 Q  ; Rx match
"RTN","IBCEF71",104,0)
 .. I IBCARE=0!(IBCARE=2) S IBARRX(IBIDT,IBINSCO,IBS2)=IBDAT,IBQ=1 Q
"RTN","IBCEF71",105,0)
 . I IBID'="" S IBARR(IBINSCO,IBS2)=IBDAT
"RTN","IBCEF71",106,0)
 ;
"RTN","IBCEF71",107,0)
 I IB399CAR=3 S Z=0 F  S Z=$O(IBARRX(Z)) Q:'Z  I '$G(IBARRX(Z)) D
"RTN","IBCEF71",108,0)
 . S Z1="" F  S Z1=$O(IBARRX(Z,Z1)) Q:Z1=""  S Z2="" F  S Z2=$O(IBARRX(Z,Z1,Z2)) Q:Z2=""  S IBARR(Z1,Z2)=IBARRX(Z,Z1,Z2)
"RTN","IBCEF71",109,0)
 ;
"RTN","IBCEF71",110,0)
 I IBPROV["VA(200," D  ; Get lic #s from file 2 for VA providers
"RTN","IBCEF71",111,0)
 . N Z,IBLIC
"RTN","IBCEF71",112,0)
 . S IBLIC=+IBPROV,IBLIC=$$GETLIC^IBCEP5D(.IBLIC)
"RTN","IBCEF71",113,0)
 . S IBIDTYP=$P($G(^IBE(355.97,+$$STLIC^IBCEP8(),0)),U,3)
"RTN","IBCEF71",114,0)
 . S Z=0 F  S Z=$O(IBLIC(Z)) Q:'Z  S:$$CHCKSEC^IBCEF73(IB399FRM,IBPROVTP,IBINSTP,IBIDTYP) IBARR("NONE","LIC"_Z_"^"_IBPROV)=IBPROV_U_"NONE"_U_IBIDTYP_U_IBLIC(Z)_U_"0"_U_"0"_U_Z_U_U_+$$STLIC^IBCEP8()
"RTN","IBCEF71",115,0)
 I IBPROV["IBA(355.93" D
"RTN","IBCEF71",116,0)
 . Q:$P($G(^IBA(355.93,+IBPROV,0)),U,12)=""
"RTN","IBCEF71",117,0)
 . S IBIDTYP=$P($G(^IBE(355.97,+$$STLIC^IBCEP8(),0)),U,3)
"RTN","IBCEF71",118,0)
 . I $$CHCKSEC^IBCEF73(IB399FRM,IBPROVTP,IBINSTP,IBIDTYP) D
"RTN","IBCEF71",119,0)
 . . S IBARR("NONE","LIC"_$P($G(^DIC(5,+$P(^IBA(355.93,+IBPROV,0),U,7),0)),U,2)_"^"_IBPROV)=IBPROV_U_"NONE"_U_IBIDTYP_U_$P(^IBA(355.93,+IBPROV,0),U,12)_U_"0"_U_"0"_U_$P(^IBA(355.93,+IBPROV,0),U,7)_U_U_+IBPROV
"RTN","IBCEF71",120,0)
 Q
"RTN","IBCEF71",121,0)
 ;
"RTN","IBCEF71",122,0)
ALLPRFAC(IBXIEN,IBXSAVE) ; Return all non-VA/outside facility prov ids
"RTN","IBCEF71",123,0)
 ; and all VA alternate prov ids
"RTN","IBCEF71",124,0)
 ; IBXIEN = ien file 399
"RTN","IBCEF71",125,0)
 ; IBXSAVE = subscripted array returned
"RTN","IBCEF71",126,0)
 N IBPROV,IBFRMTYP,IBCARE,IBRETARR,IBRET1,IBCOBN,Z,Z0,Z1,ZZ
"RTN","IBCEF71",127,0)
 K IBXSAVE("PROVINF_FAC",IBXIEN) ; Always rebuild this
"RTN","IBCEF71",128,0)
 S IBCOBN=+$$COBN^IBCEF(IBXIEN)
"RTN","IBCEF71",129,0)
 S IBFRMTYP=$$FT^IBCEF(IBXIEN),IBFRMTYP=$S(IBFRMTYP=2:2,IBFRMTYP=3:1,1:0)
"RTN","IBCEF71",130,0)
 S IBPROV=$P($G(^DGCR(399,IBXIEN,"U2")),U,10)
"RTN","IBCEF71",131,0)
 ; IB patch 320 - Build IBPROV variable better when a non-VA facility exists
"RTN","IBCEF71",132,0)
 I IBPROV S IBPROV=IBPROV_";IBA(355.93,"
"RTN","IBCEF71",133,0)
 I 'IBPROV S IBCARE=$P($G(^DGCR(399,IBXIEN,0)),U,22)
"RTN","IBCEF71",134,0)
 I IBPROV D
"RTN","IBCEF71",135,0)
 . S IBCARE=$S($$ISRX^IBCEF1(IBXIEN):3,1:0) ;if Rx refill bill
"RTN","IBCEF71",136,0)
 . S:IBCARE=0 IBCARE=$$INPAT^IBCEF(IBXIEN,1) S:'IBCARE IBCARE=2 ;1-inp, 2-out
"RTN","IBCEF71",137,0)
 F Z=1:1:3 K IBRETARR I $G(^DGCR(399,IBXIEN,"I"_Z)) D
"RTN","IBCEF71",138,0)
 . D PRACT(+^DGCR(399,IBXIEN,"I"_Z),IBFRMTYP,IBCARE,IBPROV,.IBRETARR,0,$S(Z=IBCOBN:"C",1:"O"),$S('IBPROV:355.92,1:355.9))
"RTN","IBCEF71",139,0)
 . K IBRET1
"RTN","IBCEF71",140,0)
 . S Z0="" F  S Z0=$O(IBRETARR(Z0)) Q:Z0=""  S Z1="" F  S Z1=$O(IBRETARR(Z0,Z1)) Q:Z1=""  D
"RTN","IBCEF71",141,0)
 .. ; Sort by div/id type
"RTN","IBCEF71",142,0)
 .. S IBRET1($S(IBPROV:0,1:+$P(IBRETARR(Z0,Z1),U,6)),+$P(IBRETARR(Z0,Z1),U,9))=IBRETARR(Z0,Z1)
"RTN","IBCEF71",143,0)
 .. Q
"RTN","IBCEF71",144,0)
 . ;
"RTN","IBCEF71",145,0)
 . S Z0=$O(IBRET1(""),-1) Q:Z0=""  D
"RTN","IBCEF71",146,0)
 .. ; IB patch 320 - loop thru all ID's
"RTN","IBCEF71",147,0)
 .. S Z1="" F  S Z1=$O(IBRET1(Z0,Z1)) Q:Z1=""  D
"RTN","IBCEF71",148,0)
 ... I Z=IBCOBN S IBXSAVE("PROVINF_FAC",IBXIEN,"C",1,0,$O(IBXSAVE("PROVINF_FAC",IBXIEN,"C",1,0," "),-1)+1)=IBRET1(Z0,Z1) Q
"RTN","IBCEF71",149,0)
 ... S ZZ=$S(Z=1:1,Z=2:(IBCOBN=3)+1,1:2)
"RTN","IBCEF71",150,0)
 ... S IBXSAVE("PROVINF_FAC",IBXIEN,"O",ZZ,0,$O(IBXSAVE("PROVINF_FAC",IBXIEN,"O",ZZ,0," "),-1)+1)=IBRET1(Z0,Z1),IBXSAVE("PROVINF_FAC",IBXIEN,"O",ZZ)=$E("PST",Z)
"RTN","IBCEF71",151,0)
 ... Q
"RTN","IBCEF71",152,0)
 .. Q
"RTN","IBCEF71",153,0)
 . Q
"RTN","IBCEF71",154,0)
 ;
"RTN","IBCEF71",155,0)
 S IBXSAVE("PROVINF_FAC",IBXIEN)=IBXIEN,IBXSAVE("PROVINF_FAC",IBXIEN,"C",1)=$E("PST",IBCOBN)
"RTN","IBCEF71",156,0)
 Q
"RTN","IBCEF71",157,0)
 ;
"RTN","IBCEF71",158,0)
OTHID(IBXSAVE,IBXDATA,IBXIEN,PRIDSEQ,PRTYP,IBQ,IBFAC) ; From data in IBXSAVE,
"RTN","IBCEF71",159,0)
 ;  determine id or qualifier to output in the 837 records OP*
"RTN","IBCEF71",160,0)
 ; Returns IBXDATA array IBXDATA(n)=data
"RTN","IBCEF71",161,0)
 ; IBXIEN = ien of the bill-file 399
"RTN","IBCEF71",162,0)
 ; PRIDSEQ = sequence of the payer id needed
"RTN","IBCEF71",163,0)
 ; PRTYP = provider type to check for data
"RTN","IBCEF71",164,0)
 ; IBQ = 1 if qualifier needed, 0/null if id needed
"RTN","IBCEF71",165,0)
 ; IBFAC = 1 if facility id, 0 for individual provider id
"RTN","IBCEF71",166,0)
 ; 
"RTN","IBCEF71",167,0)
 N Z,Z0,Z1
"RTN","IBCEF71",168,0)
 S Z0="PROVINF"_$S('$G(IBFAC):"",1:"_FAC"),Z1=$S($G(IBQ):3,1:4)
"RTN","IBCEF71",169,0)
 S Z=0 F  S Z=$O(IBXSAVE("OSQ",Z)) Q:'Z  D
"RTN","IBCEF71",170,0)
 . I $P($G(IBXSAVE(Z0,IBXIEN,"O",Z,+$G(PRTYP),+$G(PRIDSEQ))),U,4)'="" S IBXDATA(IBXSAVE("OSQ",Z))=$P(IBXSAVE(Z0,IBXIEN,"O",Z,+$G(PRTYP),+$G(PRIDSEQ)),U,Z1)
"RTN","IBCEF71",171,0)
 Q
"RTN","IBCEF71",172,0)
 ;
"RTN","IBCEF71",173,0)
SETSEQ(IBXIEN,IBXSAVE,IBXDATA,PRTYP,IBFAC,IBOP) ; Sets up IBXSAVE("OSQ")
"RTN","IBCEF71",174,0)
 ;  array for other id seq in 837 records OP*
"RTN","IBCEF71",175,0)
 ; Returns IBXDATA(n)=cob seq indicator for ids
"RTN","IBCEF71",176,0)
 ; IBXIEN = ien of bill-399
"RTN","IBCEF71",177,0)
 ; PRTYP = the provider type to check for data for indiv provider
"RTN","IBCEF71",178,0)
 ; IBFAC = 1 if facility id, 0 for individual provider id
"RTN","IBCEF71",179,0)
 ; IBOP = segement # in OP being output
"RTN","IBCEF71",180,0)
 N C,Z,Z0,Z1,OK
"RTN","IBCEF71",181,0)
 S C=0,Z0="PROVINF"_$S('$G(IBFAC):"",1:"_FAC")
"RTN","IBCEF71",182,0)
 S:$G(IBFAC) PRTYP=0
"RTN","IBCEF71",183,0)
 S Z=0 F  S Z=$O(IBXSAVE(Z0,IBXIEN,"O",Z)) Q:'Z  S OK=0 D
"RTN","IBCEF71",184,0)
 . N Z1 F Z1=1:1 Q:'$D(IBXSAVE(Z0,IBXIEN,"O",Z,+$G(PRTYP),Z1))  I $P(IBXSAVE(Z0,IBXIEN,"O",Z,+$G(PRTYP),Z1),U,4)'="""" S OK=1 Q
"RTN","IBCEF71",185,0)
 . I OK S C=C+1,IBXSAVE("OSQ",Z)=C
"RTN","IBCEF71",186,0)
 S Z=0 F  S Z=$O(IBXSAVE("OSQ",Z)) Q:'Z  S IBXDATA(IBXSAVE("OSQ",Z))=$G(IBXSAVE(Z0,IBXIEN,"O",Z)) D:IBXSAVE("OSQ",Z)>1 ID^IBCEF2(IBXSAVE("OSQ",Z),"OP"_$G(IBOP)_" ")
"RTN","IBCEF71",187,0)
 Q
"RTN","IBCEF71",188,0)
 ;
"RTN","IBCEF71",189,0)
PSPRV(IBIFN) ;
"RTN","IBCEF71",190,0)
 Q $$PSPRV^IBCEF7(IBIFN) ; Moved
"RTN","IBCEF71",191,0)
 ;
"RTN","IBCEF72")
0^98^B54190068^B53742177
"RTN","IBCEF72",1,0)
IBCEF72 ;WOIFO/SS - FORMATTER AND EXTRACTOR SPECIFIC BILL FUNCTIONS ;8/6/03 10:56am
"RTN","IBCEF72",2,0)
 ;;2.0;INTEGRATED BILLING;**232,320,349,432**;21-MAR-94;Build 192
"RTN","IBCEF72",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF72",4,0)
 ;
"RTN","IBCEF72",5,0)
 ;
"RTN","IBCEF72",6,0)
 ;Input:
"RTN","IBCEF72",7,0)
 ;IBINSCO - ptr to #36
"RTN","IBCEF72",8,0)
 ;IBFRMTYP 0=unknwn/both,1=UB,2=1500
"RTN","IBCEF72",9,0)
 ;IBCARE - 0=unknwn or both inp/outp,1=inpatient, 2=outpatient, 3 -RX
"RTN","IBCEF72",10,0)
 ;Output: X12 IDtype^ID^ID TYPE ptr to file 355.97
"RTN","IBCEF72",11,0)
CH35591(IBINSCO,IBFRMTYP,IBCARE) ;
"RTN","IBCEF72",12,0)
 N IB35591,IBRET,IB1
"RTN","IBCEF72",13,0)
 S IB35591=0,IBRET=""
"RTN","IBCEF72",14,0)
 F  S IB35591=$O(^IBA(355.91,"B",IBINSCO,IB35591)) Q:+IB35591=0  Q:IBRET'=""  D
"RTN","IBCEF72",15,0)
 . S IB1=$G(^IBA(355.91,IB35591,0))
"RTN","IBCEF72",16,0)
 . I '($P(IB1,"^",4)=0!(IBFRMTYP=0)) Q:$P(IB1,"^",4)'=IBFRMTYP  ;if wrong form type
"RTN","IBCEF72",17,0)
 . I ($P(IB1,"^",5)=3)!(IBCARE=3) Q:IBCARE'=$P(IB1,"^",5)  ;if not RX
"RTN","IBCEF72",18,0)
 . I ($P(IB1,"^",5)=1)!($P(IB1,"^",5)=2) I (IBCARE=1)!(IBCARE=2) Q:$P(IB1,"^",5)'=IBCARE  ;if wrong care type
"RTN","IBCEF72",19,0)
 . S IBRET=$P($G(^IBE(355.97,+$P(IB1,"^",6),0)),"^",3)_"^"_$P(IB1,"^",7)_U_+$P(IB1,U,6)
"RTN","IBCEF72",20,0)
 Q IBRET
"RTN","IBCEF72",21,0)
 ;
"RTN","IBCEF72",22,0)
FINDEIN(IBXIEN,IBPROV,IBFAC,IBS) ; find EIN for facility/ SSN for person
"RTN","IBCEF72",23,0)
 ; IBXIEN = ien of bill entry file 399
"RTN","IBCEF72",24,0)
 ; IBFAC = 1 if facility, 0 if individual provider
"RTN","IBCEF72",25,0)
 ; IBPROV = ien of provider (vp format)
"RTN","IBCEF72",26,0)
 ; IBS = 1 if person's EIN should be returned if there, otherwise SSN
"RTN","IBCEF72",27,0)
 ; FUNCTION RETURNS 
"RTN","IBCEF72",28,0)
 ;    EIN or SSN ^ 24 for EIN, 34 for SSN or null if none found
"RTN","IBCEF72",29,0)
 N Z,Z0,IBARR,IBEIN,IBSSN
"RTN","IBCEF72",30,0)
 S (IBEIN,IBSSN)=""
"RTN","IBCEF72",31,0)
 D ALLID^IBCEP8(IBPROV,"",.IBARR)
"RTN","IBCEF72",32,0)
 S Z=0 F  S Z=$O(IBARR(Z)) Q:'Z  D  Q:IBEIN'=""
"RTN","IBCEF72",33,0)
 . I $G(IBFAC) Q:$P(IBARR(Z),U,7)'="EI"  S IBEIN=$P(IBARR(Z),U,2)_U_24 Q
"RTN","IBCEF72",34,0)
 . I $P(IBARR(Z),U,7)="SY" D  Q
"RTN","IBCEF72",35,0)
 .. I $G(IBS) S IBSSN=$P(IBARR(Z),U,2)_U_34 Q
"RTN","IBCEF72",36,0)
 . S IBEIN=$P(IBARR(Z),U,2)_U_24
"RTN","IBCEF72",37,0)
 . I $G(IBS),$P(IBARR(Z),U,7)="EI" S IBEIN=$P(IBARR(Z),U,2)_U_24
"RTN","IBCEF72",38,0)
 I $G(IBS),IBEIN="" S IBEIN=IBSSN
"RTN","IBCEF72",39,0)
 Q IBEIN
"RTN","IBCEF72",40,0)
 ;
"RTN","IBCEF72",41,0)
 ;
"RTN","IBCEF72",42,0)
NONVAID(IBXIEN,IBX,IBFAC,IBS) ; Find the non-VA provider default id
"RTN","IBCEF72",43,0)
 ; IBXIEN = the ien of the bill (file 399)
"RTN","IBCEF72",44,0)
 ; IBX = id data returned if passed by reference
"RTN","IBCEF72",45,0)
 ; IBFAC = 1 if getting the id for the facility or 0 for rendering prov
"RTN","IBCEF72",46,0)
 ; IBS = 1 if getting id for person, but need the EIN if there
"RTN","IBCEF72",47,0)
 ; Function returns the id^type of id^person/facility flag:
"RTN","IBCEF72",48,0)
 ;   Type of id: 1 = SSN    2 = EIN   0 = not found
"RTN","IBCEF72",49,0)
 ;   person/facility: 1 = person   2 = facility
"RTN","IBCEF72",50,0)
 N Z,IBXSAVE,IBU2,IBTYPE,IBZ,IBF,IBPROV,Q,Q0
"RTN","IBCEF72",51,0)
 S IBTYPE=2,IBU2=$G(^DGCR(399,IBXIEN,"U2")),IBF=2,IBPROV=""
"RTN","IBCEF72",52,0)
 ;
"RTN","IBCEF72",53,0)
 S Z=$P(IBU2,U,10)
"RTN","IBCEF72",54,0)
 I 'Z S IBX="",IBTYPE=0 G NONVAQ ; Not a non-VA facility
"RTN","IBCEF72",55,0)
 S IBPROV=Z_";IBA(355.93,"
"RTN","IBCEF72",56,0)
 ;
"RTN","IBCEF72",57,0)
 ; Get EIN
"RTN","IBCEF72",58,0)
 I $G(IBFAC) D  G NONVAQ
"RTN","IBCEF72",59,0)
 . S IBX=$P($$FINDEIN(IBXIEN,IBPROV,IBFAC),U),IBTYPE=2
"RTN","IBCEF72",60,0)
 ;
"RTN","IBCEF72",61,0)
 ; Get EIN/SSN
"RTN","IBCEF72",62,0)
 I '$G(IBFAC) D  G NONVAQ
"RTN","IBCEF72",63,0)
 . S IBX="",IBF=1
"RTN","IBCEF72",64,0)
 . S Q0=($$FT^IBCEF(IBXIEN)=3)+3 ; 3 for rendering/4 for attending
"RTN","IBCEF72",65,0)
 . S Q=+$O(^DGCR(399,IBXIEN,"PRV","B",Q0,0))
"RTN","IBCEF72",66,0)
 . S IBPROV=$P($G(^DGCR(399,IBXIEN,"PRV",Q,0)),U,2)
"RTN","IBCEF72",67,0)
 . I IBPROV S IBX=$$FINDEIN(IBXIEN,IBPROV,IBFAC,$G(IBS)),IBTYPE=$S($P(IBX,U,2)=24:2,$P(IBX,U,2)=34:1,1:0),IBX=$P(IBX,U)
"RTN","IBCEF72",68,0)
 ;
"RTN","IBCEF72",69,0)
NONVAQ I IBTYPE,IBX="",$P(IBU2,U,12)'="" S IBX=$P(IBU2,U,12) ; pull from 399
"RTN","IBCEF72",70,0)
 S IBX=$G(IBX)
"RTN","IBCEF72",71,0)
 Q IBX_U_IBTYPE_U_IBF
"RTN","IBCEF72",72,0)
 ;----
"RTN","IBCEF72",73,0)
 ;checks if there is data for OP* segments and 
"RTN","IBCEF72",74,0)
 ;then populates PROV COB SEQ
"RTN","IBCEF72",75,0)
 ;Input:
"RTN","IBCEF72",76,0)
 ;IBXIEN - ien in #399
"RTN","IBCEF72",77,0)
 ;IBSAVE - "in" array (i.e. IBXSAVE)
"RTN","IBCEF72",78,0)
 ;IBDATA - "out" array (i.e. IBXDATA)
"RTN","IBCEF72",79,0)
 ;IBFUNC - FUNCTION from #399 (1-refering, 2 -operating, etc)
"RTN","IBCEF72",80,0)
 ;IBSEGM - segment record ID, optional
"RTN","IBCEF72",81,0)
 ;Output:
"RTN","IBCEF72",82,0)
 ; IBDATA with formatted output
"RTN","IBCEF72",83,0)
PROVSEQ(IBXIEN,IBSAVE,IBDATA,IBFUNC,IBSEGM) ;
"RTN","IBCEF72",84,0)
 N IB1,IBINS,IBFL
"RTN","IBCEF72",85,0)
 ;S IBFL=$S(IBFUNC=3!(IBFUNC=4):1,1:0)
"RTN","IBCEF72",86,0)
 F IB1=1,2 D
"RTN","IBCEF72",87,0)
 . I '$$ISINSUR^IBCEF71($G(IBSAVE("PROVINF",IBXIEN,"O",IB1)),IBXIEN) Q  ;don't create anything if there is no such insurance
"RTN","IBCEF72",88,0)
 . ;*432/TAZ - Removed. Attending and Rendering can be on same bill now.
"RTN","IBCEF72",89,0)
 . ;I IBFL S IBFUNC=$S($O(IBSAVE("PROVINF",IBXIEN,"O",IB1,3,0)):3,1:4)
"RTN","IBCEF72",90,0)
 . I '$O(IBSAVE("PROVINF",IBXIEN,"O",IB1,IBFUNC,0)) Q
"RTN","IBCEF72",91,0)
 . S IBDATA(IB1)=$G(IBSAVE("PROVINF",IBXIEN,"O",IB1))
"RTN","IBCEF72",92,0)
 . I $G(IBSEGM)'="" D ID^IBCEF2(IB1,IBSEGM)
"RTN","IBCEF72",93,0)
 Q
"RTN","IBCEF72",94,0)
 ;
"RTN","IBCEF72",95,0)
OUTPRVID(IBXIEN,IBXSAVE) ; Extract the outside provider or facility ids
"RTN","IBCEF72",96,0)
 ; into IBXSAVE array
"RTN","IBCEF72",97,0)
 ; Function returns 1 if person or 2 if facility ids or "" if neither
"RTN","IBCEF72",98,0)
 N Z,IBXDATA,IBPERSON,TAG
"RTN","IBCEF72",99,0)
 ;WCJ;11/1/2005 Extract the first 3 chars of Z instead.
"RTN","IBCEF72",100,0)
 S Z=$E($$PSPRV^IBCEF7(IBXIEN),1,3),IBPERSON=""
"RTN","IBCEF72",101,0)
 ;EJK 8/23/05 IB*320 - CHANGED Z=101 TO Z=1010. Z WILL ALWAYS BE A 4 DIGIT #. 
"RTN","IBCEF72",102,0)
 ; WCJ 11/1/2005 ; Removed EJK's change and added above change
"RTN","IBCEF72",103,0)
 I Z=111!(Z=101) S TAG=$S(Z=101:"OUTSIDE FAC PROVIDER INF",1:"CUR/OTH PROVIDER INFO") D F^IBCEF("N-ALL "_TAG) S IBPERSON=$S('$E(Z,2):2,1:1)
"RTN","IBCEF72",104,0)
 Q IBPERSON
"RTN","IBCEF72",105,0)
 ;
"RTN","IBCEF72",106,0)
OUTPRV(IBREC,IBXIEN,IBXSAVE) ; Extract the outside provider or facility ids
"RTN","IBCEF72",107,0)
 ; into IBXSAVE array
"RTN","IBCEF72",108,0)
 ; Function returns 1 if person or 2 if facility ids or "" if neither
"RTN","IBCEF72",109,0)
 ; IBREC = the record whose ids should be returned
"RTN","IBCEF72",110,0)
 N IBPERSON,IBFRM,IBTYPE,IBFAC
"RTN","IBCEF72",111,0)
 I IBREC="SUB1"!(IBREC="OP6") D
"RTN","IBCEF72",112,0)
 . K IBXSAVE("PROVINF",IBXIEN),IBXSAVE("PROVINF_FAC",IBXIEN)
"RTN","IBCEF72",113,0)
 . S IBPERSON=$$OUTPRVID(IBXIEN,.IBXSAVE),IBFAC=$S(IBPERSON=1:0,1:1)
"RTN","IBCEF72",114,0)
 E  D
"RTN","IBCEF72",115,0)
 . K IBXSAVE("PROVINF_FAC",IBXIEN)
"RTN","IBCEF72",116,0)
 . D F^IBCEF("N-ALL OUTSIDE FAC PROVIDER INF")
"RTN","IBCEF72",117,0)
 . S IBPERSON=2,IBFAC=1
"RTN","IBCEF72",118,0)
 S IBFRM=$$FT^IBCEF(IBXIEN),IBFRM=$S(IBFRM=2:2,1:1)
"RTN","IBCEF72",119,0)
 S IBTYPE=$S(IBREC["SUB":"C",1:"O")
"RTN","IBCEF72",120,0)
 D CHCKSUB^IBCEF73(IBFRM,IBREC,IBFAC,IBTYPE,.IBXSAVE)
"RTN","IBCEF72",121,0)
 Q IBPERSON
"RTN","IBCEF72",122,0)
 ;
"RTN","IBCEF72",123,0)
 ;get IENs in file #36 for other insurances
"RTN","IBCEF72",124,0)
OTHINS(IB399,IBRES) ;
"RTN","IBCEF72",125,0)
 N IBFRMTYP,Z,Z1,Z2,Z4
"RTN","IBCEF72",126,0)
 S Z=$$COBN^IBCEF(IB399),Z0=0
"RTN","IBCEF72",127,0)
 F Z1=1:1:3 I Z1'=Z,$D(^DGCR(399,IB399,"I"_Z1)) S Z0=Z0+1,IBRES(Z0)=+$G(^DGCR(399,IB399,"I"_Z1))
"RTN","IBCEF72",128,0)
 Q
"RTN","IBCEF72",129,0)
 ;get other insurance EDI ID NUMBERs
"RTN","IBCEF72",130,0)
OTHINSID(IB399,IBRES) ;insurance EDI 
"RTN","IBCEF72",131,0)
 N IBFRMTYP,IBZ,Z0,Z1,Z4
"RTN","IBCEF72",132,0)
 S IBFRMTYP=$$FT^IBCEF(IB399),IBFRMTYP=$S(IBFRMTYP=2:2,IBFRMTYP=3:1,1:0)
"RTN","IBCEF72",133,0)
 S Z4=$S(IBFRMTYP=1:4,1:2) ;UB - piece4,1500 or BOTH -piece 2
"RTN","IBCEF72",134,0)
 D OTHINS(IB399,.IBZ)
"RTN","IBCEF72",135,0)
 S Z1=0
"RTN","IBCEF72",136,0)
 F Z0=1:1:2 I $G(IBZ(Z0)) S IBRES(Z0)=$S($$MCRWNR^IBEFUNC(+IBZ(Z0)):$S(IBFRMTYP=1:"12M61",1:"SMTX1"),1:$P($G(^DIC(36,+IBZ(Z0),3)),U,Z4))
"RTN","IBCEF72",137,0)
 Q
"RTN","IBCEF72",138,0)
 ;
"RTN","IBCEF72",139,0)
 ;get other insurance addresses
"RTN","IBCEF72",140,0)
OTHINADR(IB399,IBRES,IBADDFLD) ;insurance EDI
"RTN","IBCEF72",141,0)
 N IBZ,Z0,Z1,Z4
"RTN","IBCEF72",142,0)
 D OTHINS(IB399,.IBZ)
"RTN","IBCEF72",143,0)
 S Z1=0
"RTN","IBCEF72",144,0)
 I IBADDFLD=18 D  Q
"RTN","IBCEF72",145,0)
 . F Z0=1:1:2 I $G(IBZ(Z0)) D
"RTN","IBCEF72",146,0)
 . . S IBRES(Z0)=$P($G(^DIC(36,+IBZ(Z0),.11)),U,1)
"RTN","IBCEF72",147,0)
 . . S IBRES(Z0)=$E(IBRES(Z0),1,55)
"RTN","IBCEF72",148,0)
 I IBADDFLD=18.9 D  Q
"RTN","IBCEF72",149,0)
 . F Z0=1:1:2 I $G(IBZ(Z0)) D
"RTN","IBCEF72",150,0)
 . . S IBRES(Z0)=$P($G(^DIC(36,+IBZ(Z0),.11)),U,1)
"RTN","IBCEF72",151,0)
 . . S Z4=$P($G(^DIC(36,+IBZ(Z0),.11)),U,2) S:Z4'="" IBRES(Z0)=IBRES(Z0)_", "_Z4
"RTN","IBCEF72",152,0)
 . . S Z4=$P($G(^DIC(36,+IBZ(Z0),.11)),U,3) S:Z4'="" IBRES(Z0)=IBRES(Z0)_", "_Z4
"RTN","IBCEF72",153,0)
 . . S Z4=$P($G(^DIC(36,+IBZ(Z0),.11)),U,4) S:Z4'="" IBRES(Z0)=IBRES(Z0)_", "_Z4
"RTN","IBCEF72",154,0)
 . . S Z4=$P($G(^DIC(5,+$P($G(^DIC(36,+IBZ(Z0),.11)),U,5),0)),U,2) S:Z4'="" IBRES(Z0)=IBRES(Z0)_", "_Z4
"RTN","IBCEF72",155,0)
 . . S Z4=$P($G(^DIC(36,+IBZ(Z0),.11)),U,6) S:Z4'="" IBRES(Z0)=IBRES(Z0)_", "_Z4
"RTN","IBCEF72",156,0)
 . . S IBRES(Z0)=$E(IBRES(Z0),1,157)
"RTN","IBCEF72",157,0)
 I IBADDFLD=19 D  Q
"RTN","IBCEF72",158,0)
 . F Z0=1:1:2 I $G(IBZ(Z0)) D
"RTN","IBCEF72",159,0)
 . . S IBRES(Z0)=$P($G(^DIC(36,+IBZ(Z0),.11)),U,2)
"RTN","IBCEF72",160,0)
 . . S IBRES(Z0)=IBRES(Z0)_" "_$P($G(^DIC(36,+IBZ(Z0),.11)),U,3)
"RTN","IBCEF72",161,0)
 . . S IBRES(Z0)=$E(IBRES(Z0),1,55)
"RTN","IBCEF72",162,0)
 I IBADDFLD=20 D  Q
"RTN","IBCEF72",163,0)
 . F Z0=1:1:2 I $G(IBZ(Z0)) D
"RTN","IBCEF72",164,0)
 . . S IBRES(Z0)=$P($G(^DIC(36,+IBZ(Z0),.11)),U,4)
"RTN","IBCEF72",165,0)
 . . S IBRES(Z0)=$E(IBRES(Z0),1,30)
"RTN","IBCEF72",166,0)
 I IBADDFLD=21 D  Q
"RTN","IBCEF72",167,0)
 . F Z0=1:1:2 I $G(IBZ(Z0)) D
"RTN","IBCEF72",168,0)
 . . S IBRES(Z0)=$P($G(^DIC(5,+$P($G(^DIC(36,+IBZ(Z0),.11)),U,5),0)),U,2)
"RTN","IBCEF72",169,0)
 . . S IBRES(Z0)=$E(IBRES(Z0),1,2)
"RTN","IBCEF72",170,0)
 I IBADDFLD=22 D  Q
"RTN","IBCEF72",171,0)
 . F Z0=1:1:2 I $G(IBZ(Z0)) D
"RTN","IBCEF72",172,0)
 . . S IBRES(Z0)=$P($G(^DIC(36,+IBZ(Z0),.11)),U,6)
"RTN","IBCEF72",173,0)
 . . S IBRES(Z0)=$E(IBRES(Z0),1,15)
"RTN","IBCEF72",174,0)
 Q
"RTN","IBCEF72",175,0)
 ;
"RTN","IBCEF72",176,0)
SFIDQ(IBXIEN,IBXSAVE,IBXDATA) ; Find the service facility id qualifier for
"RTN","IBCEF72",177,0)
 ; 837 record SUB2-5
"RTN","IBCEF72",178,0)
 ;IBXIEN = ien of 399
"RTN","IBCEF72",179,0)
 ;Pass by reference: IBXSAVE (input/output)  IBXDATA (output)
"RTN","IBCEF72",180,0)
 N B,Z
"RTN","IBCEF72",181,0)
 K IBXSAVE("NVID")
"RTN","IBCEF72",182,0)
 D  ; protect IBXDATA
"RTN","IBCEF72",183,0)
 . N IBXDATA
"RTN","IBCEF72",184,0)
 . D F^IBCEF("N-RENDERING INSTITUTION")
"RTN","IBCEF72",185,0)
 . S:IBXDATA'="" IBXSAVE("IBFAC")=IBXDATA
"RTN","IBCEF72",186,0)
 I $P($G(IBXSAVE("IBFAC")),U,2)'=1 K IBXDATA Q
"RTN","IBCEF72",187,0)
 S Z=$$PSPRV^IBCEF7(IBXIEN)
"RTN","IBCEF72",188,0)
 ;WCJ 11/04/2005 If a Non-VA facility 
"RTN","IBCEF72",189,0)
 I $E(Z) D
"RTN","IBCEF72",190,0)
 . S IBXSAVE("NVID")=$$NONVAID^IBCEF72(IBXIEN,.B,$E(Z),1)
"RTN","IBCEF72",191,0)
 .; S IBXSAVE("NVID")=$$NONVAID^IBCEF72(IBXIEN,.B,'$E(Z,2),1)
"RTN","IBCEF72",192,0)
 . S IBXDATA=$P("^34^24",U,$P(IBXSAVE("NVID"),U,2)+1)
"RTN","IBCEF72",193,0)
 ;S Z=$$PSPRV^IBCEF7(IBXIEN),IBXSAVE("NVID")=$$NONVAID^IBCEF72(IBXIEN,.B,'$E(Z,2),1),IBXDATA=24
"RTN","IBCEF72",194,0)
 Q
"RTN","IBCEF72",195,0)
 ;
"RTN","IBCEF72",196,0)
OTHP36(IBXIEN,IBZOUT)   ;
"RTN","IBCEF72",197,0)
 N Z,Z0,Z1,IBZ
"RTN","IBCEF72",198,0)
 D F^IBCEF("N-ALL INSURANCE CO 837 ID","IBZ")
"RTN","IBCEF72",199,0)
 F Z=1,2,3 S IBZOUT(Z)=+$$POLICY^IBCEF(IBXIEN,1,$E("PST",Z))
"RTN","IBCEF72",200,0)
 Q
"RTN","IBCEF72",201,0)
 ;
"RTN","IBCEF72",202,0)
 ;---------SORT-----------
"RTN","IBCEF72",203,0)
 ;IBPRNUM - seq #
"RTN","IBCEF72",204,0)
 ;IBPRTYP - type of provider (use FUNCTION value from file 399, fld 222)
"RTN","IBCEF72",205,0)
 ;IB399 = ien file 399
"RTN","IBCEF72",206,0)
 ;IBSRC,IBDST - source,destination arrays
"RTN","IBCEF72",207,0)
 ;IBN - starting #
"RTN","IBCEF72",208,0)
 ;Output:
"RTN","IBCEF72",209,0)
 ; IBDST(1-primary/2-secondary provider,Provider type(FUNCTION),N)=
"RTN","IBCEF72",210,0)
 ; =provider/VARIABLEPTR^Insurance PTR #36 or NONE^ID type^ID^Form type^Care type^state ptr #5 for state license #
"RTN","IBCEF72",211,0)
 ; where N is numeration (1 for ID1, 2 for ID2, etc)
"RTN","IBCEF72",212,0)
GETSSN(IBPTR)   ;look for SSN in #200 first and if not found then look at #355.9
"RTN","IBCEF72",213,0)
 ;if in file #200
"RTN","IBCEF72",214,0)
 I $P(IBPTR,";",2)="VA(200," Q $$SSN200^IBCEF73(IBPTR)
"RTN","IBCEF72",215,0)
 ;if in 355.93 then use 355.9
"RTN","IBCEF72",216,0)
 Q $$SSN3559^IBCEF73(IBPTR)
"RTN","IBCEF72",217,0)
 ;--
"RTN","IBCEF72",218,0)
 ;SSN3559
"RTN","IBCEF72",219,0)
 ;Find SSN from 355.9
"RTN","IBCEF72",220,0)
 ;Input:
"RTN","IBCEF72",221,0)
 ; Variable pointer to ^VA(200 or ^IBA(355.93
"RTN","IBCEF72",222,0)
 ;Output:
"RTN","IBCEF72",223,0)
 ; SSN or null
"RTN","IBCEF72",224,0)
 ;
"RTN","IBCEF72",225,0)
PADNDC(Z) ;PAD LEADING ZERO'S INTO A NON 5-4-2 FORMAT NDC NUMBER
"RTN","IBCEF72",226,0)
 ;Z IS ITERATION, ONLY PAD CURRENT NDC NUMBER
"RTN","IBCEF72",227,0)
 N NDC
"RTN","IBCEF72",228,0)
 S NDC=$P(IBXSAVE("OUTPT",Z,"RX"),"^",3)
"RTN","IBCEF72",229,0)
 Q:$L(NDC)=13
"RTN","IBCEF72",230,0)
 I $L(NDC)=14 D  Q
"RTN","IBCEF72",231,0)
 . S $P(NDC,"-",1)=$E($P(NDC,"-",1),2,$L($P(NDC,"-",1)))
"RTN","IBCEF72",232,0)
 . S $P(IBXSAVE("OUTPT",Z,"RX"),"^",3)=NDC
"RTN","IBCEF72",233,0)
 I $L($P(NDC,"-",1))'=5 S $P(NDC,"-",1)="0"_$P(NDC,"-",1)
"RTN","IBCEF72",234,0)
 I $L($P(NDC,"-",2))'=4 S $P(NDC,"-",2)="0"_$P(NDC,"-",2)
"RTN","IBCEF72",235,0)
 I $L($P(NDC,"-",3))'=2 S $P(NDC,"-",3)="0"_$P(NDC,"-",3)
"RTN","IBCEF72",236,0)
 S $P(IBXSAVE("OUTPT",Z,"RX"),"^",3)=NDC
"RTN","IBCEF72",237,0)
 Q
"RTN","IBCEF72",238,0)
 ;
"RTN","IBCEF73A")
0^97^B55865498^B53924008
"RTN","IBCEF73A",1,0)
IBCEF73A ;ALB/KJH - FORMATTER AND EXTRACTOR SPECIFIC (NPI) BILL FUNCTIONS ;30 Aug 2006  10:38 AM
"RTN","IBCEF73A",2,0)
 ;;2.0;INTEGRATED BILLING;**343,374,395,391,400,432**;21-MAR-94;Build 192
"RTN","IBCEF73A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF73A",4,0)
 Q
"RTN","IBCEF73A",5,0)
 ;
"RTN","IBCEF73A",6,0)
PROVNPI(IBIEN399,IBNONPI) ;
"RTN","IBCEF73A",7,0)
 ;Retrieves NPIs from #200 or 355.93
"RTN","IBCEF73A",8,0)
 ; Input:
"RTN","IBCEF73A",9,0)
 ;       IBIEN399 - IEN of record in BILL/CLAIMS file 399
"RTN","IBCEF73A",10,0)
 ;       IBNONPI - variable to pass info on missing NPI to calling routine.  Pass by reference
"RTN","IBCEF73A",11,0)
 ; Output:
"RTN","IBCEF73A",12,0)
 ;       NPI codes for all providers
"RTN","IBCEF73A",13,0)
 ;       IBNONPI - U-delimited list of provider types with missing NPIs
"RTN","IBCEF73A",14,0)
 N IBRETVAL,IBPTR,IBFT
"RTN","IBCEF73A",15,0)
 S IBRETVAL="",IBNONPI=""
"RTN","IBCEF73A",16,0)
 F IBFT=1:1:9 D
"RTN","IBCEF73A",17,0)
 . S IBPTR=$$PROVPTR^IBCEF7(IBIEN399,IBFT)
"RTN","IBCEF73A",18,0)
 . I IBPTR S $P(IBRETVAL,"^",IBFT)=$$GETNPI(IBPTR)
"RTN","IBCEF73A",19,0)
 Q IBRETVAL
"RTN","IBCEF73A",20,0)
GETNPI(IBPTR) ;look for NPI in #200 or #355.93
"RTN","IBCEF73A",21,0)
 ;Input: IBPTR from 399.0222, field .02
"RTN","IBCEF73A",22,0)
 ;Output: NPI
"RTN","IBCEF73A",23,0)
 ;if in file #200
"RTN","IBCEF73A",24,0)
 N NPI
"RTN","IBCEF73A",25,0)
 S NPI=""
"RTN","IBCEF73A",26,0)
 ;if in 200 then get it from 200
"RTN","IBCEF73A",27,0)
 I $P(IBPTR,";",2)="VA(200," S NPI=$P($$NPI^XUSNPI("Individual_ID",$P(IBPTR,";")),U) S:NPI<1 NPI=""
"RTN","IBCEF73A",28,0)
 ;if in 355.93 then use 355.93
"RTN","IBCEF73A",29,0)
 I $P(IBPTR,";",2)="IBA(355.93," S NPI=$$NPIGET^IBCEP81($P(IBPTR,";"))
"RTN","IBCEF73A",30,0)
 I NPI="",$D(IBNONPI) S IBNONPI=$S(IBNONPI="":IBFT,1:IBNONPI_U_IBFT)
"RTN","IBCEF73A",31,0)
 Q NPI
"RTN","IBCEF73A",32,0)
 ;
"RTN","IBCEF73A",33,0)
SPECTAX(IBIEN399,IBNOSPEC) ;
"RTN","IBCEF73A",34,0)
 ;Retrieves Specialty Codes from Current Taxonomy entries for a claim from #399
"RTN","IBCEF73A",35,0)
 ; Input:
"RTN","IBCEF73A",36,0)
 ;       IBIEN399 - IEN of record in BILL/CLAIMS file 399
"RTN","IBCEF73A",37,0)
 ;       IBNOSPEC - variable to pass info on missing taxonomies to calling routine.  Pass by reference
"RTN","IBCEF73A",38,0)
 ; Output:
"RTN","IBCEF73A",39,0)
 ;       Taxonomy Specialty Codes for all providers
"RTN","IBCEF73A",40,0)
 ;       IBNOSPEC - U-delimited list of provider types with missing Taxonomy Specialty codes
"RTN","IBCEF73A",41,0)
 N IBRETVAL,IBN,IBFT,IBSPEC,SPEC
"RTN","IBCEF73A",42,0)
 S IBRETVAL="",IBNOSPEC=""
"RTN","IBCEF73A",43,0)
 I $G(IBIEN399)="" Q ""
"RTN","IBCEF73A",44,0)
 F IBFT=1:1:9 D
"RTN","IBCEF73A",45,0)
 . S IBN=$O(^DGCR(399,IBIEN399,"PRV","B",IBFT,0))
"RTN","IBCEF73A",46,0)
 . I +IBN=0 Q
"RTN","IBCEF73A",47,0)
 . S IBSPEC=$P($G(^DGCR(399,IBIEN399,"PRV",+IBN,0)),"^",15)
"RTN","IBCEF73A",48,0)
 . S SPEC=$$GET1^DIQ(8932.1,IBSPEC,"SPECIALTY CODE")
"RTN","IBCEF73A",49,0)
 . S $P(IBRETVAL,"^",IBFT)=SPEC
"RTN","IBCEF73A",50,0)
 . I SPEC="",$D(IBNOSPEC) S IBNOSPEC=$S(IBNOSPEC="":IBFT,1:IBNOSPEC_U_IBFT)
"RTN","IBCEF73A",51,0)
 Q IBRETVAL
"RTN","IBCEF73A",52,0)
 ;
"RTN","IBCEF73A",53,0)
PROVTAX(IBIEN399,IBNOTAX) ;
"RTN","IBCEF73A",54,0)
 ;Retrieves Current Taxonomy entries for a claim from #399
"RTN","IBCEF73A",55,0)
 ; Input:
"RTN","IBCEF73A",56,0)
 ;       IBIEN399 - IEN of record in BILL/CLAIMS file 399
"RTN","IBCEF73A",57,0)
 ;       IBNOTAX - variable to pass info on missing taxonomies to calling routine.  Pass by reference
"RTN","IBCEF73A",58,0)
 ; Output:
"RTN","IBCEF73A",59,0)
 ;       Taxonomy X12 codes for all providers
"RTN","IBCEF73A",60,0)
 ;       IBNOTAX - U-delimited list of provider types with missing Taxonomy X12 codes
"RTN","IBCEF73A",61,0)
 N IBRETVAL,IBN,IBFT,IBTAX,TAX
"RTN","IBCEF73A",62,0)
 S IBRETVAL="",IBNOTAX=""
"RTN","IBCEF73A",63,0)
 I $G(IBIEN399)="" Q ""
"RTN","IBCEF73A",64,0)
 F IBFT=1:1:9 D
"RTN","IBCEF73A",65,0)
 . S IBN=$O(^DGCR(399,IBIEN399,"PRV","B",IBFT,0))
"RTN","IBCEF73A",66,0)
 . I +IBN=0 Q
"RTN","IBCEF73A",67,0)
 . S IBTAX=$P($G(^DGCR(399,IBIEN399,"PRV",+IBN,0)),"^",15)
"RTN","IBCEF73A",68,0)
 . S TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",69,0)
 . S $P(IBRETVAL,"^",IBFT)=TAX
"RTN","IBCEF73A",70,0)
 . I TAX="",$D(IBNOTAX) S IBNOTAX=$S(IBNOTAX="":IBFT,1:IBNOTAX_U_IBFT)
"RTN","IBCEF73A",71,0)
 Q IBRETVAL
"RTN","IBCEF73A",72,0)
GETTAX(IBPTR,IBDTEV) ;look for Taxonomy in #200 or #355.93
"RTN","IBCEF73A",73,0)
 ;Input: IBPTR from 399.0222, field .02, IBDTEV from 399, field .03
"RTN","IBCEF73A",74,0)
 ;       IBPTR can be from 399.0404, field .02, as well (DEM;432)
"RTN","IBCEF73A",75,0)
 ;Output: Taxonomy X12 code_"^"_IEN
"RTN","IBCEF73A",76,0)
 N TAX,IBX12
"RTN","IBCEF73A",77,0)
 S TAX="^",IBX12=""
"RTN","IBCEF73A",78,0)
 S:'$G(IBDTEV) IBDTEV=DT
"RTN","IBCEF73A",79,0)
 ;if in 200 then get it from 200
"RTN","IBCEF73A",80,0)
 I $P(IBPTR,";",2)="VA(200," S IBX12=$P($$GET^XUA4A72($P(IBPTR,";"),IBDTEV),U,1),TAX=$S(IBX12'>0:TAX,1:$$GET1^DIQ(8932.1,IBX12,6)_U_IBX12)
"RTN","IBCEF73A",81,0)
 ;if in 355.93 then use 355.93
"RTN","IBCEF73A",82,0)
 I $P(IBPTR,";",2)="IBA(355.93," S TAX=$$TAXGET^IBCEP81($P(IBPTR,";"))
"RTN","IBCEF73A",83,0)
 Q TAX
"RTN","IBCEF73A",84,0)
 ;
"RTN","IBCEF73A",85,0)
ORGNPI(IBIEN399,IBNONPI) ; Extract NPIs for organizations on this claim
"RTN","IBCEF73A",86,0)
 ; Input
"RTN","IBCEF73A",87,0)
 ;       IBIEN399 - Claim IEN in file 399
"RTN","IBCEF73A",88,0)
 ;       IBNONPI - Variable to pass info on missing NPI back to calling routine.  Pass by reference.
"RTN","IBCEF73A",89,0)
 ; Output - NPI codes for facilities
"RTN","IBCEF73A",90,0)
 ;        Piece 1) Service Facility NPI code (with IB patch 400, a claim may not have a service facility)
"RTN","IBCEF73A",91,0)
 ;        Piece 2) Non-VA Service Facility NPI code
"RTN","IBCEF73A",92,0)
 ;        Piece 3) Billing Provider NPI code (IB patch 400 definition)
"RTN","IBCEF73A",93,0)
 ;
"RTN","IBCEF73A",94,0)
 N IBRETVAL,IBORG,IBEVDT,IBDIV,NPI,BSZ,SWBCK
"RTN","IBCEF73A",95,0)
 S IBNONPI=""
"RTN","IBCEF73A",96,0)
 I $G(IBIEN399)="" Q ""
"RTN","IBCEF73A",97,0)
 S IBRETVAL=""
"RTN","IBCEF73A",98,0)
 S BSZ=$$B^IBCEF79(IBIEN399)    ; get billing provider/service facility information
"RTN","IBCEF73A",99,0)
 ;
"RTN","IBCEF73A",100,0)
 S SWBCK=(+$$INSFLGS^IBCEF79(IBIEN399)>0)    ; pre-patch 400 switchback flag & processing
"RTN","IBCEF73A",101,0)
 I SWBCK D  G ORGNPIX
"RTN","IBCEF73A",102,0)
 . N PHARM,DPORG,PHARMNPI
"RTN","IBCEF73A",103,0)
 . S PHARM=+$$ISRX^IBCEF1(IBIEN399)          ; pharmacy claim flag switchback
"RTN","IBCEF73A",104,0)
 . S PHARMNPI=""
"RTN","IBCEF73A",105,0)
 . I PHARM S DPORG=$$RXSITE(IBIEN399) I DPORG S PHARMNPI=$P($$NPI^XUSNPI("Organization_ID",DPORG),U,1)
"RTN","IBCEF73A",106,0)
 . ;
"RTN","IBCEF73A",107,0)
 . ; service facility NPI switchback
"RTN","IBCEF73A",108,0)
 . S NPI=""
"RTN","IBCEF73A",109,0)
 . S IBORG=+$P(BSZ,U,4)    ; service facility ien (either ptr file 4 or 355.93)
"RTN","IBCEF73A",110,0)
 . I $P(BSZ,U,3)=0,IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U,1)    ; file 4
"RTN","IBCEF73A",111,0)
 . I $P(BSZ,U,3)=1,IBORG S NPI=$$NPIGET^IBCEP81(IBORG)                          ; file 355.93
"RTN","IBCEF73A",112,0)
 . I PHARM S NPI=PHARMNPI      ; in switchback mode for pharmacy claims, use the pharmacy NPI
"RTN","IBCEF73A",113,0)
 . I NPI>0 S $P(IBRETVAL,U,1)=NPI
"RTN","IBCEF73A",114,0)
 . I NPI<1 S IBNONPI=1
"RTN","IBCEF73A",115,0)
 . ;
"RTN","IBCEF73A",116,0)
 . ; non-VA facility NPI switchback
"RTN","IBCEF73A",117,0)
 . S IBORG=$$GET1^DIQ(399,IBIEN399_",",232,"I")
"RTN","IBCEF73A",118,0)
 . I IBORG S NPI=$$NPIGET^IBCEP81(IBORG),$P(IBRETVAL,U,2)=NPI I 'NPI S IBNONPI=$S(IBNONPI="":2,1:IBNONPI_U_2)
"RTN","IBCEF73A",119,0)
 . ;
"RTN","IBCEF73A",120,0)
 . ; billing provider NPI switchback
"RTN","IBCEF73A",121,0)
 . S IBORG=+$P(BSZ,U,1),NPI=""
"RTN","IBCEF73A",122,0)
 . I IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U,1)
"RTN","IBCEF73A",123,0)
 . I PHARM S NPI=PHARMNPI      ; in switchback mode for pharmacy claims, use the pharmacy NPI
"RTN","IBCEF73A",124,0)
 . I NPI>0 S $P(IBRETVAL,U,3)=NPI
"RTN","IBCEF73A",125,0)
 . I NPI<1 S IBNONPI=$S(IBNONPI="":3,1:IBNONPI_U_3)
"RTN","IBCEF73A",126,0)
 . ;
"RTN","IBCEF73A",127,0)
 . Q
"RTN","IBCEF73A",128,0)
 ;
"RTN","IBCEF73A",129,0)
 ; service facility NPI regular
"RTN","IBCEF73A",130,0)
 S NPI=""
"RTN","IBCEF73A",131,0)
 S IBORG=+$P(BSZ,U,4)    ; service facility ien (either ptr file 4 or 355.93)
"RTN","IBCEF73A",132,0)
 I $P(BSZ,U,3)=0,IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U,1)    ; file 4
"RTN","IBCEF73A",133,0)
 I $P(BSZ,U,3)=1,IBORG S NPI=$$NPIGET^IBCEP81(IBORG)                          ; file 355.93
"RTN","IBCEF73A",134,0)
 I NPI>0 S $P(IBRETVAL,U,1)=NPI
"RTN","IBCEF73A",135,0)
 I NPI<1,$P(BSZ,U,3)=1 S IBNONPI=1   ; only report missing service facility NPI for non-VA facilities
"RTN","IBCEF73A",136,0)
 ;
"RTN","IBCEF73A",137,0)
 ; non-VA facility NPI regular
"RTN","IBCEF73A",138,0)
 S IBORG=$$GET1^DIQ(399,IBIEN399_",",232,"I")
"RTN","IBCEF73A",139,0)
 ; Let this one (#2) override #1 if both #1 and #2 are missing
"RTN","IBCEF73A",140,0)
 I IBORG S NPI=$$NPIGET^IBCEP81(IBORG),$P(IBRETVAL,U,2)=NPI I 'NPI S IBNONPI=2
"RTN","IBCEF73A",141,0)
 ;
"RTN","IBCEF73A",142,0)
 ; billing provider NPI regular
"RTN","IBCEF73A",143,0)
 S IBORG=+$P(BSZ,U,1),NPI=""
"RTN","IBCEF73A",144,0)
 I IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U,1) S:NPI>0 $P(IBRETVAL,U,3)=NPI
"RTN","IBCEF73A",145,0)
 I NPI<1 S IBNONPI=$S(IBNONPI="":3,1:IBNONPI_U_3)
"RTN","IBCEF73A",146,0)
 ;
"RTN","IBCEF73A",147,0)
ORGNPIX ;
"RTN","IBCEF73A",148,0)
 ;
"RTN","IBCEF73A",149,0)
 Q IBRETVAL
"RTN","IBCEF73A",150,0)
 ;
"RTN","IBCEF73A",151,0)
ORGTAX(IBIEN399,IBNOTAX) ; Extract Taxonomies for organizations on this claim
"RTN","IBCEF73A",152,0)
 ; Input
"RTN","IBCEF73A",153,0)
 ;       IBIEN399 - Claim IEN in file 399
"RTN","IBCEF73A",154,0)
 ;       IBNOTAX - Variable to pass info on missing taxonomies back to calling routine.  Pass by reference.
"RTN","IBCEF73A",155,0)
 ; Output - Taxonomy X12 codes for facilities
"RTN","IBCEF73A",156,0)
 ;        Piece 1) Service Facility Taxonomy X12 code (with IB patch 400, a claim may not have a service facility)
"RTN","IBCEF73A",157,0)
 ;        Piece 2) Non-VA Service Facility Taxonomy X12 code
"RTN","IBCEF73A",158,0)
 ;        Piece 3) Billing Provider Taxonomy X12 code (IB patch 400 definition)
"RTN","IBCEF73A",159,0)
 N IBRETVAL,IBTAX,TAX,BSZ
"RTN","IBCEF73A",160,0)
 ;
"RTN","IBCEF73A",161,0)
 S BSZ=$$B^IBCEF79(IBIEN399)    ; get billing provider/service facility information
"RTN","IBCEF73A",162,0)
 ;
"RTN","IBCEF73A",163,0)
 ; claim field# 243 - service facility taxonomy code
"RTN","IBCEF73A",164,0)
 I $P(BSZ,U,3)="" S (IBTAX,TAX)=""     ; no service facility
"RTN","IBCEF73A",165,0)
 I $P(BSZ,U,3)'="" S IBTAX=$$GET1^DIQ(399,IBIEN399_",",243,"I"),TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",166,0)
 S $P(IBRETVAL,U,1)=TAX
"RTN","IBCEF73A",167,0)
 ; only record service facility taxonomy code missing if there is a service facility
"RTN","IBCEF73A",168,0)
 I '$L(TAX),$D(IBNOTAX),$P(BSZ,U,3)'="" S IBNOTAX=1
"RTN","IBCEF73A",169,0)
 ;
"RTN","IBCEF73A",170,0)
 ; claim field# 244 - non-VA facility taxonomy code
"RTN","IBCEF73A",171,0)
 S IBTAX=$$GET1^DIQ(399,IBIEN399_",",244,"I")
"RTN","IBCEF73A",172,0)
 S TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",173,0)
 S $P(IBRETVAL,U,2)=TAX
"RTN","IBCEF73A",174,0)
 I '$L(TAX),$$GET1^DIQ(399,IBIEN399_",",232,"I"),$D(IBNOTAX) S IBNOTAX=$S(IBNOTAX="":2,1:IBNOTAX_U_2)
"RTN","IBCEF73A",175,0)
 ;
"RTN","IBCEF73A",176,0)
 ; claim field# 252 - billing provider taxonomy code
"RTN","IBCEF73A",177,0)
 S IBTAX=$$GET1^DIQ(399,IBIEN399_",",252,"I")
"RTN","IBCEF73A",178,0)
 S TAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEF73A",179,0)
 S $P(IBRETVAL,U,3)=TAX
"RTN","IBCEF73A",180,0)
 I '$L(TAX),$D(IBNOTAX) S IBNOTAX=$S(IBNOTAX="":3,1:IBNOTAX_U_3)
"RTN","IBCEF73A",181,0)
 ;
"RTN","IBCEF73A",182,0)
 Q IBRETVAL
"RTN","IBCEF73A",183,0)
 ;
"RTN","IBCEF73A",184,0)
RXSITE(IBIEN399,IBLIST) ; returns prescription organization (file 4) pointer
"RTN","IBCEF73A",185,0)
 ; for the given bill.  If IBLIST passed by reference, then a list of
"RTN","IBCEF73A",186,0)
 ; the possible organizations are returned for a bill, since a bill may
"RTN","IBCEF73A",187,0)
 ; have more than one prescription.  If more than one rx on the bill, the
"RTN","IBCEF73A",188,0)
 ; $$ return is the pointer of the last prescription found.
"RTN","IBCEF73A",189,0)
 ; IBLIST(rx ien,fill date)=ORGINATION (file 4 pointer)
"RTN","IBCEF73A",190,0)
 ;
"RTN","IBCEF73A",191,0)
 N IBX,IBDATA,IBORG,IBRX,IBDT,IBY,IBRXN,DFN
"RTN","IBCEF73A",192,0)
 K ^TMP($J,"IBCEF73A")
"RTN","IBCEF73A",193,0)
 S IBORG=0,DFN=$P($G(^DGCR(399,IBIEN399,0)),"^",2),IBLIST="IBCEF73A"
"RTN","IBCEF73A",194,0)
 S IBRXN=0 F  S IBRXN=$O(^IBA(362.4,"AIFN"_IBIEN399,IBRXN)) Q:'IBRXN  S IBX=0 F  S IBX=$O(^IBA(362.4,"AIFN"_IBIEN399,IBRXN,IBX)) Q:'IBX  D
"RTN","IBCEF73A",195,0)
 . S IBDATA=$G(^IBA(362.4,IBX,0))
"RTN","IBCEF73A",196,0)
 . S IBRX=$P(IBDATA,"^",5),IBDT=$P(IBDATA,"^",3) Q:'IBRX!('IBDT)
"RTN","IBCEF73A",197,0)
 . D RX^PSO52API(DFN,IBLIST,IBRX,,"0,2,R")
"RTN","IBCEF73A",198,0)
 . I IBDT=+$G(^TMP($J,"IBCEF73A",DFN,IBRX,22)) S (IBORG,IBLIST(IBRX,IBDT))=$$PSONPI(+$G(^TMP($J,"IBCEF73A",DFN,IBRX,20))) Q
"RTN","IBCEF73A",199,0)
 . S IBY=0 F  S IBY=$O(^TMP($J,"IBCEF73A",DFN,IBRX,"RF",IBY)) Q:'IBY  I IBDT=+$G(^TMP($J,"IBCEF73A",DFN,IBRX,"RF",IBY,.01)) S (IBORG,IBLIST(IBRX,IBDT))=$$PSONPI(+$G(^TMP($J,"IBCEF73A",DFN,IBRX,"RF",IBY,8))) Q
"RTN","IBCEF73A",200,0)
 K ^TMP($J,"IBCEF73A")
"RTN","IBCEF73A",201,0)
 Q IBORG
"RTN","IBCEF73A",202,0)
 ;
"RTN","IBCEF73A",203,0)
PSONPI(IB59IEN) ; returns institution ien for a file 59 ien
"RTN","IBCEF73A",204,0)
 N IB4IEN
"RTN","IBCEF73A",205,0)
 K ^TMP($J,"IBCEF59")
"RTN","IBCEF73A",206,0)
 D PSS^PSO59(IB59IEN,,"IBCEF59")
"RTN","IBCEF73A",207,0)
 S IB4IEN=+$G(^TMP($J,"IBCEF59",IB59IEN,101))
"RTN","IBCEF73A",208,0)
 K ^TMP($J,"IBCEF59")
"RTN","IBCEF73A",209,0)
 Q IB4IEN
"RTN","IBCEF74")
0^85^B47493658^B57770095
"RTN","IBCEF74",1,0)
IBCEF74 ;WOIFO/SS - FORMATTER/EXTRACT BILL FUNCTIONS ;31-JUL-03
"RTN","IBCEF74",2,0)
 ;;2.0;INTEGRATED BILLING;**232,280,155,290,291,320,358,343,374,432**;21-MAR-94;Build 192
"RTN","IBCEF74",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF74",4,0)
 ;
"RTN","IBCEF74",5,0)
SORT(IBPRNUM,IBPRTYP,IB399,IBSRC,IBDST,IBN,IBEXC,IBSEQ,IBLIMIT) ;
"RTN","IBCEF74",6,0)
 D SORT^IBCEF77($G(IBPRNUM),$G(IBPRTYP),$G(IB399),.IBSRC,.IBDST,$G(IBN),$G(IBEXC),$G(IBSEQ),$G(IBLIMIT))
"RTN","IBCEF74",7,0)
 Q
"RTN","IBCEF74",8,0)
 ;
"RTN","IBCEF74",9,0)
 ;-- PROVINF --
"RTN","IBCEF74",10,0)
 ;Create array with prov info
"RTN","IBCEF74",11,0)
 ;Input:
"RTN","IBCEF74",12,0)
 ; IB399 - ien #399
"RTN","IBCEF74",13,0)
 ; IBPRNUM - 1=prim ins, 2= sec, 3 -tert
"RTN","IBCEF74",14,0)
 ; IBRES - for results
"RTN","IBCEF74",15,0)
 ; IBSORT - to sort OTHER INSURANCE data 
"RTN","IBCEF74",16,0)
 ;  if PROVINF is called for "C" mode of PROVIDER subroutine then 
"RTN","IBCEF74",17,0)
 ;    IBSORT can be any (say 1)
"RTN","IBCEF74",18,0)
 ;  if PROVINF is called for "O" mode then can be more than set of data
"RTN","IBCEF74",19,0)
 ;    - need to sort array to use it (like IBXDATA(1) and IBXDATA(2))
"RTN","IBCEF74",20,0)
 ;    for mode "O" it should be 1 or 2 (see PROVIDER section)
"RTN","IBCEF74",21,0)
 ;IBINSTP -  "C" -current ins, "O"-other
"RTN","IBCEF74",22,0)
 ;Output:
"RTN","IBCEF74",23,0)
 ; IBRES(PRNUM,PRTYPE,SEQ#)=PROV^INSUR^IDTYPE^ID^FORMTYP^CARETYP
"RTN","IBCEF74",24,0)
 ; where:(see PROVIDER)
"RTN","IBCEF74",25,0)
PROVINF(IB399,IBPRNUM,IBRES,IBSORT,IBINSTP) ;
"RTN","IBCEF74",26,0)
 I $G(IB399)="" Q
"RTN","IBCEF74",27,0)
 I +$G(IBSORT)=0 S IBSORT=$G(IBPRNUM)
"RTN","IBCEF74",28,0)
 N IBPRTYP,IBINSCO,IBPROV,IBFRMTYP,IBCARE,IB35591,IBN,IBCURR,IBEXC,IBLIMIT
"RTN","IBCEF74",29,0)
 S IBN=0
"RTN","IBCEF74",30,0)
 S IBINSCO=+$P($G(^DGCR(399,IB399,"M")),"^",IBPRNUM)
"RTN","IBCEF74",31,0)
 S IBFRMTYP=$$FT^IBCEF(IB399),IBFRMTYP=$S(IBFRMTYP=2:2,IBFRMTYP=3:1,1:0)
"RTN","IBCEF74",32,0)
 S IBCARE=$S($$ISRX^IBCEF1(IB399):3,1:0) ;if an Rx refill bill
"RTN","IBCEF74",33,0)
 S:IBCARE=0 IBCARE=$$INPAT^IBCEF(IB399,1) S:'IBCARE IBCARE=2 ;1-inp,2-out
"RTN","IBCEF74",34,0)
 S IBLIMIT=$S($G(IBINSTP)="C":5,1:3)  ; Limits on secondary IDs
"RTN","IBCEF74",35,0)
 F IBPRTYP=1:1:9 D
"RTN","IBCEF74",36,0)
 . N Z,IB355OV
"RTN","IBCEF74",37,0)
 . S IBPROV=$$PROVPTR^IBCEF7(IB399,IBPRTYP)
"RTN","IBCEF74",38,0)
 . Q:+IBPROV=0
"RTN","IBCEF74",39,0)
 . ;don't create anything if form type not CMS-1500 or UB
"RTN","IBCEF74",40,0)
 . Q:IBFRMTYP=0
"RTN","IBCEF74",41,0)
 . N IBRETARR S IBRETARR=0
"RTN","IBCEF74",42,0)
 . D PRACT^IBCEF71(IBINSCO,IBFRMTYP,IBCARE,IBPROV,.IBRETARR,IBPRTYP,$G(IBINSTP))
"RTN","IBCEF74",43,0)
 . S IB355OV="",IBEXC=""
"RTN","IBCEF74",44,0)
 . S Z=$O(^DGCR(399,IB399,"PRV","B",IBPRTYP,0))
"RTN","IBCEF74",45,0)
 . I Z S Z=$G(^DGCR(399,IB399,"PRV",Z,0)) D
"RTN","IBCEF74",46,0)
 .. I $P(Z,U,IBPRNUM+4)'="",$P(Z,U,IBPRNUM+11)'="" S IB355OV=$P(Z,U,IBPRNUM+4)_U_$P(Z,U,IBPRNUM+11)
"RTN","IBCEF74",47,0)
 . S IBCURR=$$COB^IBCEF(IB399)
"RTN","IBCEF74",48,0)
 . S IBN=0,IB35591=$$CH35591^IBCEF72(IBINSCO,IBFRMTYP,IBCARE)
"RTN","IBCEF74",49,0)
 . I $G(IBINSTP)="C",$G(IBPRNUM)=1,"34"[$G(IBPRTYP),"P"[$G(IBCURR),$G(IBFRMTYP)=2,$$MCRONBIL^IBEFUNC(IB399) S IB355OV=$$MCR24K^IBCEU3(IB399)_"^12"
"RTN","IBCEF74",50,0)
 . I $G(IBINSTP)="O","34"[$G(IBPRTYP),"ST"[$G(IBCURR),$G(IBFRMTYP)=2,$$MCRONBIL^IBEFUNC(IB399) S IB355OV=$$MCR24K^IBCEU3(IB399)_"^12" ;Calculate MEDICARE (WNR) specific provider qualifier and ID for CMS-1500 secondary claims
"RTN","IBCEF74",51,0)
 . I $P(IB355OV,U,2) D
"RTN","IBCEF74",52,0)
 .. I $$CHCKSEC^IBCEF73(IBFRMTYP,IBPRTYP,$G(IBINSTP),$P($G(^IBE(355.97,+$P(IB355OV,U,2),0)),U,3)) D
"RTN","IBCEF74",53,0)
 ... S IBEXC=$P(IB355OV,U,2),IBN=IBN+1,IBRES(IBSORT,IBPRTYP,IBN)="OVERRIDE^"_IBINSCO_U_$P($G(^IBE(355.97,+IBEXC,0)),U,3)_U_$P(IB355OV,U)_"^^^^^"_+IBEXC
"RTN","IBCEF74",54,0)
 . I IB35591'="",IBEXC'=$P(IB35591,U,3) S:$$CHCKSEC^IBCEF73(IBFRMTYP,IBPRTYP,$G(IBINSTP),$P(IB35591,"^")) IBN=IBN+1,IBRES(IBSORT,IBPRTYP,IBN)="DEFAULT^"_IBINSCO_"^"_IB35591_"^^",$P(IBRES(IBSORT,IBPRTYP,IBN),U,9)=$P(IB35591,U,3)
"RTN","IBCEF74",55,0)
 . D SORT(IBSORT,IBPRTYP,IB399,.IBRETARR,.IBRES,IBN,IBEXC,IBPRNUM,IBLIMIT)
"RTN","IBCEF74",56,0)
 . S IBRES(IBSORT,IBPRTYP)=IBPROV
"RTN","IBCEF74",57,0)
 S IBRES(IBSORT)=$S(IBPRNUM=3:"T",IBPRNUM=2:"S",1:"P")
"RTN","IBCEF74",58,0)
 Q
"RTN","IBCEF74",59,0)
 ;
"RTN","IBCEF74",60,0)
SECIDCK(IBIFN,IBSEQ,IBTYP,IBIFN1) ; Function returns 1 if ID type ptr in
"RTN","IBCEF74",61,0)
 ;  IBTYP is valid X12 code for the claim/prov function (IBPROVF)
"RTN","IBCEF74",62,0)
 ;  as a sec id
"RTN","IBCEF74",63,0)
 ; IBSEQ = COB seq being checked
"RTN","IBCEF74",64,0)
 ; IBIFN1 = entry # in PRV multiple being checked
"RTN","IBCEF74",65,0)
 ;  Called from input transform of fields .12-.14, subfile 399.0222
"RTN","IBCEF74",66,0)
 I $G(IBIFN)="" Q
"RTN","IBCEF74",67,0)
 N IBOK,IBFRM,IBCOBN,IBX12,IBPROVF
"RTN","IBCEF74",68,0)
 S IBPROVF=+$G(^DGCR(399,IBIFN,"PRV",IBIFN1,0))
"RTN","IBCEF74",69,0)
 S IBFRM=$$FT^IBCEF(IBIFN),IBFRM=$S(IBFRM=3:1,1:2) ; Form type
"RTN","IBCEF74",70,0)
 S IBCOBN=$$COBN^IBCEF(IBIFN) S:'IBCOBN IBCOBN=1 ; Current COB seq
"RTN","IBCEF74",71,0)
 S IBX12=$P($G(^IBE(355.97,+IBTYP,0)),U,3) ; X12 code for prov id typ
"RTN","IBCEF74",72,0)
 Q $$CHSEC^IBCEF73(IBFRM,IBPROVF,$S(IBSEQ=IBCOBN:"C",1:"O"),IBX12)
"RTN","IBCEF74",73,0)
 ;
"RTN","IBCEF74",74,0)
DEFID(IBIFN,IBPRV) ;
"RTN","IBCEF74",75,0)
 ; IBIFN = ien of bill
"RTN","IBCEF74",76,0)
 ; IBPRV = ien of entry subfile 399.0222
"RTN","IBCEF74",77,0)
 ;  Function returns default ids: prim id def^sec id def^tert id def
"RTN","IBCEF74",78,0)
 ;  SSN cannot be the default ID
"RTN","IBCEF74",79,0)
 I $G(IBIFN)="" Q ""
"RTN","IBCEF74",80,0)
 N Z,Z1,ID,IBZ,IBINS,IBINS4,IBUB
"RTN","IBCEF74",81,0)
 S IBZ=""
"RTN","IBCEF74",82,0)
 S IBUB=($$FT^IBCEF(IBIFN)=3)
"RTN","IBCEF74",83,0)
 D F^IBCEF("N-ALL ATT/REND PROV SSN/EI","IBZ","",IBIFN)
"RTN","IBCEF74",84,0)
 S Z=$G(^DGCR(399,IBIFN,"PRV",IBPRV,0)),ID=$P(Z,U,5,7)
"RTN","IBCEF74",85,0)
 F Z1=1:1:3 I $P(ID,U,Z1)="" D
"RTN","IBCEF74",86,0)
 . Q:'$G(^DGCR(399,IBIFN,"I"_Z1))  S IBINS=+^("I"_Z1)
"RTN","IBCEF74",87,0)
 . S $P(ID,U,Z1)=$$GETID^IBCEP2(IBIFN,2,$P(Z,U,2),Z1)
"RTN","IBCEF74",88,0)
 . ; Set default if null
"RTN","IBCEF74",89,0)
 . I $P(ID,U,Z1)="" S $P(ID,U,Z1)="VAD000"
"RTN","IBCEF74",90,0)
 Q ID
"RTN","IBCEF74",91,0)
 ;
"RTN","IBCEF74",92,0)
DISPID(IBXIEN) ; Display list of all prov and fac ids that will
"RTN","IBCEF74",93,0)
 ; extract for this bill if transmitted electronically
"RTN","IBCEF74",94,0)
 I $G(IBXIEN)="" Q
"RTN","IBCEF74",95,0)
 N IBID,IBID1,IBZ,IBCT,IBFRM,IBCOBN,IBQUIT,IBTYP,DIR,IBIFN,X,Y,Z,Z0,Z1,CO,IBN,IBCODE
"RTN","IBCEF74",96,0)
 S IBIFN=IBXIEN
"RTN","IBCEF74",97,0)
 S IBFRM=$$FT^IBCEF(IBIFN),IBCOBN=$$COBN^IBCEF(IBIFN)
"RTN","IBCEF74",98,0)
 W @IOF
"RTN","IBCEF74",99,0)
 W !,"If this bill is transmitted electronically, the following IDs will be sent:"
"RTN","IBCEF74",100,0)
 ; Returns all prov sec ids to be transmitted in indicated segments
"RTN","IBCEF74",101,0)
 S Z=+$G(^DGCR(399,IBIFN,"I1")) I Z W !,"  Primary Ins Co: ",$$EXTERNAL^DILFD(399,101,"",Z) I IBCOBN=1 W ?54,"<<<Current Ins"
"RTN","IBCEF74",102,0)
 S Z=+$G(^DGCR(399,IBIFN,"I2")) I Z W !,"Secondary Ins Co: ",$$EXTERNAL^DILFD(399,101,"",Z) I IBCOBN=2 W ?54,"<<<Current Ins"
"RTN","IBCEF74",103,0)
 S Z=+$G(^DGCR(399,IBIFN,"I3")) I Z W !," Tertiary Ins Co: ",$$EXTERNAL^DILFD(399,101,"",Z) I IBCOBN=3 W ?54,"<<<Current Ins"
"RTN","IBCEF74",104,0)
 W !!,"Provider IDs: (VistA Records OP1,OP2,OP4,OP8,OP9,OPR2,OPR3,OPR4,OPR5,OPR8):"
"RTN","IBCEF74",105,0)
 ;F Z=1:1:3 I $G(^DGCR(399,IBIFN,"I"_Z)) D PROVINF(IBIFN,Z,.IBID,"",$S(IBCOBN=Z:"C",1:"O"))
"RTN","IBCEF74",106,0)
 ;*432/TAZ - Added call to gather line providers and apply business rules
"RTN","IBCEF74",107,0)
 D ALLIDS^IBCEFP(IBIFN,.IBID)
"RTN","IBCEF74",108,0)
 ;*432/TAZ - Rewrote following code to take info from the IBID array instead of File 399.  This allows changes from the application of the business rules.
"RTN","IBCEF74",109,0)
 S IBQUIT=0
"RTN","IBCEF74",110,0)
 ;
"RTN","IBCEF74",111,0)
 F IBPRV=4,3,1,2,5,9 D  ; Process providers in order: Attending, Rendering, Referring, Operating, Supervising, and Other Operating if they exist
"RTN","IBCEF74",112,0)
 . I '$D(IBID("PROVINF",IBIFN,"C",1,IBPRV)) Q
"RTN","IBCEF74",113,0)
 . I ($Y+5)>IOSL S IBQUIT=$$NOMORE() Q:IBQUIT
"RTN","IBCEF74",114,0)
 . W !!?5,$$EXTERNAL^DILFD(399.0222,.01,"",IBPRV),": "_$$EXTERNAL^DILFD(399.0222,.02,"",$P(IBID("PROVINF",IBIFN,"C",1,IBPRV),U))
"RTN","IBCEF74",115,0)
 . W !?8,"NPI: ",?40,$S($P($G(IBID("PROVINF",IBIFN,"C",1,IBPRV,0)),U,4)]"":$P(IBID("PROVINF",IBIFN,"C",1,IBPRV,0),U,4),1:"***MISSING***")
"RTN","IBCEF74",116,0)
 . K IBTYP
"RTN","IBCEF74",117,0)
 . F CO="C","O" D
"RTN","IBCEF74",118,0)
 .. F IBN=1,2 I $D(IBID("PROVINF",IBIFN,CO,IBN,IBPRV)) D
"RTN","IBCEF74",119,0)
 ... F Z0=1:1 Q:'$D(IBID("PROVINF",IBIFN,CO,IBN,IBPRV,Z0))!IBQUIT  D
"RTN","IBCEF74",120,0)
 .... S IBCODE=+$P(IBID("PROVINF",IBIFN,CO,IBN,IBPRV,Z0),U,9)
"RTN","IBCEF74",121,0)
 .... Q:$D(IBTYP(IBCODE))  ;1st of each type transmits
"RTN","IBCEF74",122,0)
 .... I ($Y+5)>IOSL S IBQUIT=$$NOMORE() Q:IBQUIT
"RTN","IBCEF74",123,0)
 .... S IBTYP(IBCODE)=""
"RTN","IBCEF74",124,0)
 .... W !,?8,"(",IBID("PROVINF",IBIFN,CO,IBN),") ",$$EXTERNAL^DILFD(36,4.01,"",IBCODE),?40,$P(IBID("PROVINF",IBIFN,CO,IBN,IBPRV,Z0),U,4)
"RTN","IBCEF74",125,0)
 ;
"RTN","IBCEF74",126,0)
 I IBQUIT G DISPIDX
"RTN","IBCEF74",127,0)
 ;
"RTN","IBCEF74",128,0)
 ; IB*2*320 - display additional IDs for ?ID
"RTN","IBCEF74",129,0)
 D EN^IBCEF74A(IBIFN,.IBQUIT,.IBID)
"RTN","IBCEF74",130,0)
 ;
"RTN","IBCEF74",131,0)
DISPIDX ;
"RTN","IBCEF74",132,0)
 I '$G(IBQUIT) S DIR(0)="EA",DIR("A")="Press RETURN to continue " W ! D ^DIR K DIR
"RTN","IBCEF74",133,0)
 Q
"RTN","IBCEF74",134,0)
 ;
"RTN","IBCEF74",135,0)
NOMORE() ;
"RTN","IBCEF74",136,0)
 S DIR(0)="EA",DIR("A")="Press RETURN for more IDs or '^' to exit: " W ! D ^DIR
"RTN","IBCEF74",137,0)
 W @IOF
"RTN","IBCEF74",138,0)
 Q (Y'=1)
"RTN","IBCEF74",139,0)
 ;
"RTN","IBCEF74",140,0)
DEFSEC(IBIFN,IBARR) ; Returns array in IBARR for default prov sec ids for ien IBIFN
"RTN","IBCEF74",141,0)
 ; IBARR if passed by ref is returned   IBARR(prov function,COBN)=def id
"RTN","IBCEF74",142,0)
 I $G(IBIFN)=""
"RTN","IBCEF74",143,0)
 N IBCAR,IBCOBN,IBPC,IBINS,IBARRX,Q,Z,Z0,ZINS,X
"RTN","IBCEF74",144,0)
 K IBARR
"RTN","IBCEF74",145,0)
 S ZINS="",IBCOBN=$$COBN^IBCEF(IBIFN),IBPC=$S($$FT^IBCEF(IBIFN)=3:2,1:1)
"RTN","IBCEF74",146,0)
 S IBCAR=$$INPAT^IBCEF(IBIFN,1),IBCAR=$S('IBCAR:2,1:1)
"RTN","IBCEF74",147,0)
 F Z=1:1:3 S ZINS=ZINS_+$G(^DGCR(399,IBIFN,"I"_Z))_U
"RTN","IBCEF74",148,0)
 F Z=1:1:3 I $P(ZINS,U,Z),'$P($G(^DIC(36,+$P(ZINS,U,Z),4)),U,IBPC) S $P(ZINS,U,Z)=""
"RTN","IBCEF74",149,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"PRV",Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","IBCEF74",150,0)
 . F Q=1:1:3 D
"RTN","IBCEF74",151,0)
 .. I $P(Z0,U,Q+4)'="" S IBARR(+Z0,Q)=$P(Z0,U,Q+4) Q  ; Override
"RTN","IBCEF74",152,0)
 .. S IBINS=$P(ZINS,U,Q)
"RTN","IBCEF74",153,0)
 .. Q:'IBINS
"RTN","IBCEF74",154,0)
 .. S X=$$IDFIND^IBCEP2(IBIFN,"",$P(Z0,U,2),Q,1)
"RTN","IBCEF74",155,0)
 .. I X'="" S IBARR(+Z0,Q)=X
"RTN","IBCEF74",156,0)
 Q
"RTN","IBCEF74",157,0)
 ;
"RTN","IBCEF74A")
0^86^B39969650^B23472039
"RTN","IBCEF74A",1,0)
IBCEF74A ;ALB/ESG - Provider ID maint ?ID continuation ;7 Mar 2006
"RTN","IBCEF74A",2,0)
 ;;2.0;INTEGRATED BILLING;**320,343,349,395,400,432**;21-MAR-94;Build 192
"RTN","IBCEF74A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF74A",4,0)
 ;
"RTN","IBCEF74A",5,0)
 Q
"RTN","IBCEF74A",6,0)
 ;
"RTN","IBCEF74A",7,0)
EN(IBIFN,IBQUIT,IBID) ; Display billing provider and service provider IDs as part
"RTN","IBCEF74A",8,0)
 ; of the ?ID display/help in the billing screens.
"RTN","IBCEF74A",9,0)
 ; Called from DISPID^IBCEF74.
"RTN","IBCEF74A",10,0)
 NEW IBX,Z,ZI,ZN,SEQ,PSIN,DATA,QUALNM,IDNUM,FACNAME,IBZ,ORGNPI,BPZ,BPNAME,BPNPI,BPTAX,SFNPI,SFTAX
"RTN","IBCEF74A",11,0)
 ;
"RTN","IBCEF74A",12,0)
 ;D ALLIDS^IBCEF75(IBIFN,.IBID)
"RTN","IBCEF74A",13,0)
 ;
"RTN","IBCEF74A",14,0)
 ; Re-sort array by insurance sequence (P/S/T)
"RTN","IBCEF74A",15,0)
 K IBX
"RTN","IBCEF74A",16,0)
 F Z="BILLING PRV","LAB/FAC" F ZI="C","O" S ZN=0 F  S ZN=$O(IBID(Z,IBIFN,ZI,ZN)) Q:'ZN  D
"RTN","IBCEF74A",17,0)
 . S SEQ=$P($G(IBID(Z,IBIFN,ZI,ZN)),U,1) Q:SEQ=""
"RTN","IBCEF74A",18,0)
 . S IBX(Z,SEQ,ZI,ZN)=""
"RTN","IBCEF74A",19,0)
 . Q
"RTN","IBCEF74A",20,0)
 ;
"RTN","IBCEF74A",21,0)
 ; Display billing provider information - IB*2*400
"RTN","IBCEF74A",22,0)
 S BPZ=$$B^IBCEF79(IBIFN)
"RTN","IBCEF74A",23,0)
 D GETBP^IBCEF79(IBIFN,"",+BPZ,"?ID",.IBZ)
"RTN","IBCEF74A",24,0)
 S ORGNPI=$$ORGNPI^IBCEF73A(IBIFN)
"RTN","IBCEF74A",25,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",26,0)
 W !!,"Billing Provider Name and ID Information"
"RTN","IBCEF74A",27,0)
 S BPNAME=$G(IBZ("?ID","NAME"))
"RTN","IBCEF74A",28,0)
 I BPNAME="" S BPNAME="***MISSING***"
"RTN","IBCEF74A",29,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",30,0)
 W !,"Billing Provider:  ",BPNAME
"RTN","IBCEF74A",31,0)
 ;
"RTN","IBCEF74A",32,0)
 S BPNPI=$P(ORGNPI,U,3)
"RTN","IBCEF74A",33,0)
 I BPNPI="" S BPNPI="***MISSING***"
"RTN","IBCEF74A",34,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",35,0)
 W !?5,"Billing Provider NPI:  ",BPNPI
"RTN","IBCEF74A",36,0)
 ;
"RTN","IBCEF74A",37,0)
 S BPTAX=$$NOPUNCT^IBCEF($P($G(^IBE(350.9,1,1)),U,5),1)
"RTN","IBCEF74A",38,0)
 I BPTAX="" S BPTAX="***MISSING***"
"RTN","IBCEF74A",39,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",40,0)
 W !?5,"Billing Provider Tax ID (VistA Record PRV):  ",BPTAX
"RTN","IBCEF74A",41,0)
 ;
"RTN","IBCEF74A",42,0)
 ; Display billing provider secondary ID's (current ins only)
"RTN","IBCEF74A",43,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",44,0)
 W !?5,"Billing Provider Secondary IDs (VistA Record CI1A):"
"RTN","IBCEF74A",45,0)
 S Z="BILLING PRV"
"RTN","IBCEF74A",46,0)
 D SECID(Z,.IBQUIT)
"RTN","IBCEF74A",47,0)
 I IBQUIT G EX
"RTN","IBCEF74A",48,0)
 ;
"RTN","IBCEF74A",49,0)
 ; Now display the lab or facility primary and secondary IDs
"RTN","IBCEF74A",50,0)
 ; This is the service facility information
"RTN","IBCEF74A",51,0)
 ; IB*2*400 - check to make sure there is a service facility
"RTN","IBCEF74A",52,0)
 ;
"RTN","IBCEF74A",53,0)
 I $P(BPZ,U,3)="" G LPRV     ; no service facility information to display
"RTN","IBCEF74A",54,0)
 ;
"RTN","IBCEF74A",55,0)
 ; Service facility name, similar code as found in SUB-2
"RTN","IBCEF74A",56,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",57,0)
 W !!,"Service Facility Name and ID Information"
"RTN","IBCEF74A",58,0)
 ;
"RTN","IBCEF74A",59,0)
 ; Display note if ins co flag to suppress lab/fac data is set (only applies in switchback mode)
"RTN","IBCEF74A",60,0)
 I '$$SENDSF^IBCEF79(IBIFN) D  I IBQUIT G EX
"RTN","IBCEF74A",61,0)
 . I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() Q:IBQUIT
"RTN","IBCEF74A",62,0)
 . W !!,"Note:  Service Facility Data not sent for Current Insurance"
"RTN","IBCEF74A",63,0)
 . W !,"       'Send VA Lab/Facility IDs or Facility Data for VAMC?' is set to NO",!
"RTN","IBCEF74A",64,0)
 . Q
"RTN","IBCEF74A",65,0)
 ;
"RTN","IBCEF74A",66,0)
 S FACNAME=$$GETFAC^IBCEP8(+$P(BPZ,U,4),$P(BPZ,U,3),0)
"RTN","IBCEF74A",67,0)
 I FACNAME="" S FACNAME="***MISSING***"
"RTN","IBCEF74A",68,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",69,0)
 W !?5,"Facility:  ",FACNAME
"RTN","IBCEF74A",70,0)
 ;
"RTN","IBCEF74A",71,0)
 S SFNPI=$P(ORGNPI,U,1)
"RTN","IBCEF74A",72,0)
 I SFNPI="" S SFNPI="***MISSING***"
"RTN","IBCEF74A",73,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",74,0)
 W !?5,"Lab or Facility NPI:  ",SFNPI
"RTN","IBCEF74A",75,0)
 ;
"RTN","IBCEF74A",76,0)
 S SFTAX=$$NOPUNCT^IBCEF($$EIN^IBCEP8A(IBIFN),1)
"RTN","IBCEF74A",77,0)
 I SFTAX="" S SFTAX="***MISSING***"
"RTN","IBCEF74A",78,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",79,0)
 W !?5,"Lab or Facility Tax ID (VistA Record SUB):  ",SFTAX
"RTN","IBCEF74A",80,0)
 ;
"RTN","IBCEF74A",81,0)
 ; lab/fac secondary IDs
"RTN","IBCEF74A",82,0)
 I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT G EX
"RTN","IBCEF74A",83,0)
 W !?5,"Lab or Facility Secondary IDs (VistA Records SUB1,SUB2,OP3,OP6,OP7):"
"RTN","IBCEF74A",84,0)
 S Z="LAB/FAC"
"RTN","IBCEF74A",85,0)
 D SECID(Z,.IBQUIT)
"RTN","IBCEF74A",86,0)
 I IBQUIT G EX
"RTN","IBCEF74A",87,0)
 ;
"RTN","IBCEF74A",88,0)
LPRV ;Service Line Providers
"RTN","IBCEF74A",89,0)
 I '$D(IBID("L-PROV")) G EX  ; No Line Level Providers
"RTN","IBCEF74A",90,0)
 N IBSLC,IBN,CO,IBCODE,IBTYP,IBPRTYP,Z0
"RTN","IBCEF74A",91,0)
 S IBSLC=0
"RTN","IBCEF74A",92,0)
 W !!,"Service Line Providers"
"RTN","IBCEF74A",93,0)
 F  S IBSLC=$O(IBID("L-PROV",IBIFN,IBSLC)) Q:'IBSLC  D  I IBQUIT Q
"RTN","IBCEF74A",94,0)
 . I ($Y+6)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT Q
"RTN","IBCEF74A",95,0)
 . W !!?5,"Service Line: ",IBSLC
"RTN","IBCEF74A",96,0)
 . F IBPRTYP=4,3,1,2,5,9 I $D(IBID("L-PROV",IBIFN,IBSLC,"C",1,IBPRTYP)) D  ; Process providers in order: Attending, Rendering, Referring, Operating, Supervising, and Other Operating if they exist
"RTN","IBCEF74A",97,0)
 .. I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() I IBQUIT Q
"RTN","IBCEF74A",98,0)
 .. W !?5,$$EXTERNAL^DILFD(399.0404,.01,"",IBPRTYP),": ",$$EXTERNAL^DILFD(399.0404,.02,"",$P(IBID("L-PROV",IBIFN,IBSLC,"C",1,IBPRTYP),U,1))
"RTN","IBCEF74A",99,0)
 .. W !?8,"NPI:",?40,$S($P(IBID("L-PROV",IBIFN,IBSLC,"C",1,IBPRTYP,0),U,4)]"":$P(IBID("L-PROV",IBIFN,IBSLC,"C",1,IBPRTYP,0),U,4),1:"***MISSING***")
"RTN","IBCEF74A",100,0)
 .. K IBTYP
"RTN","IBCEF74A",101,0)
 .. F CO="C","O" D
"RTN","IBCEF74A",102,0)
 ... F IBN=1,2 D
"RTN","IBCEF74A",103,0)
 .... F Z0=1:1 Q:'$D(IBID("L-PROV",IBIFN,IBSLC,CO,IBN,IBPRTYP,Z0))!IBQUIT  D
"RTN","IBCEF74A",104,0)
 ..... S IBCODE=$P(IBID("L-PROV",IBIFN,IBSLC,CO,IBN,IBPRTYP,Z0),U,9)
"RTN","IBCEF74A",105,0)
 ..... Q:$D(IBTYP(IBCODE))  ; 1st of each type transmits
"RTN","IBCEF74A",106,0)
 ..... I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() Q:IBQUIT
"RTN","IBCEF74A",107,0)
 ..... S IBTYP(IBCODE)=""
"RTN","IBCEF74A",108,0)
 ..... W !,?8,"(",IBID("L-PROV",IBIFN,IBSLC,CO,IBN),") ",$$EXTERNAL^DILFD(36,4.01,"",IBCODE),?40,$P(IBID("L-PROV",IBIFN,IBSLC,CO,IBN,IBPRTYP,Z0),U,4)
"RTN","IBCEF74A",109,0)
 ;
"RTN","IBCEF74A",110,0)
EX ;
"RTN","IBCEF74A",111,0)
 Q
"RTN","IBCEF74A",112,0)
 ;
"RTN","IBCEF74A",113,0)
QUAL(Z,FORMTYPE) ; turn the qualifier code into a qualifier description
"RTN","IBCEF74A",114,0)
 NEW QUAL,IEN
"RTN","IBCEF74A",115,0)
 S QUAL=""
"RTN","IBCEF74A",116,0)
 I $G(Z)="" G QUALX
"RTN","IBCEF74A",117,0)
 I Z="1C" D  G QUALX   ; qualifier for Medicare Part ?
"RTN","IBCEF74A",118,0)
 . I $G(FORMTYPE)=2 S QUAL="MEDICARE PART B"   ; 1500
"RTN","IBCEF74A",119,0)
 . I $G(FORMTYPE)=3 S QUAL="MEDICARE PART A"   ; ub
"RTN","IBCEF74A",120,0)
 . Q
"RTN","IBCEF74A",121,0)
 I Z=34 S Z="SY"       ; qualifier for SSN
"RTN","IBCEF74A",122,0)
 S IEN=+$O(^IBE(355.97,"C",Z,"")) I 'IEN G QUALX
"RTN","IBCEF74A",123,0)
 S QUAL=$P($G(^IBE(355.97,IEN,0)),U,1)
"RTN","IBCEF74A",124,0)
QUALX ;
"RTN","IBCEF74A",125,0)
 Q QUAL
"RTN","IBCEF74A",126,0)
 ;
"RTN","IBCEF74A",127,0)
SECID(Z,IBQUIT) ; Display secondary ID and qualifier information
"RTN","IBCEF74A",128,0)
 ; Z is the type of IDs passed in; either BILLING PRV or LAB/FAC
"RTN","IBCEF74A",129,0)
 ; IBQUIT is returned if passed by reference
"RTN","IBCEF74A",130,0)
 NEW SEQ,ZI,ZN,PSIN,DATA,QUALNM,IDNUM,NODATA
"RTN","IBCEF74A",131,0)
 S IBQUIT=0,NODATA=1
"RTN","IBCEF74A",132,0)
 F SEQ="P","S","T" D  Q:IBQUIT
"RTN","IBCEF74A",133,0)
 . ;
"RTN","IBCEF74A",134,0)
 . ; current ins only for billing provider secondary IDs
"RTN","IBCEF74A",135,0)
 . I Z="BILLING PRV",SEQ'=$$COB^IBCEF(IBIFN) Q
"RTN","IBCEF74A",136,0)
 . S ZI=""
"RTN","IBCEF74A",137,0)
 . F  S ZI=$O(IBX(Z,SEQ,ZI)) Q:ZI=""  D  Q:IBQUIT
"RTN","IBCEF74A",138,0)
 .. S ZN=0
"RTN","IBCEF74A",139,0)
 .. F  S ZN=$O(IBX(Z,SEQ,ZI,ZN)) Q:'ZN  D  Q:IBQUIT
"RTN","IBCEF74A",140,0)
 ... S PSIN=0   ; start at 0 to skip primary IDs
"RTN","IBCEF74A",141,0)
 ... ;*432/TAZ - Changed Q:PSIN="" to Q:'PSIN to prevent "CONTACTS" node from printing as secondary ID
"RTN","IBCEF74A",142,0)
 ... F  S PSIN=$O(IBID(Z,IBIFN,ZI,ZN,PSIN)) Q:'PSIN  D  Q:IBQUIT
"RTN","IBCEF74A",143,0)
 .... S DATA=$G(IBID(Z,IBIFN,ZI,ZN,PSIN))
"RTN","IBCEF74A",144,0)
 .... S QUALNM=$$QUAL($P(DATA,U,1),$$FT^IBCEF(IBIFN))
"RTN","IBCEF74A",145,0)
 .... S IDNUM=$P(DATA,U,2)
"RTN","IBCEF74A",146,0)
 .... I ($Y+5)>IOSL S IBQUIT=$$NOMORE^IBCEF74() Q:IBQUIT
"RTN","IBCEF74A",147,0)
 .... S NODATA=0
"RTN","IBCEF74A",148,0)
 .... W !?8,"(",SEQ,") ",QUALNM,?40,IDNUM
"RTN","IBCEF74A",149,0)
 .... I Z="LAB/FAC",$D(^DGCR(399,IBIFN,"I2")),SEQ=$$COB^IBCEF(IBIFN) W ?54,"<<<Current Ins"
"RTN","IBCEF74A",150,0)
 .... I Z="BILLING PRV",PSIN=1 W ?54,"<<<System Generated ID"
"RTN","IBCEF74A",151,0)
 .... Q
"RTN","IBCEF74A",152,0)
 ... Q
"RTN","IBCEF74A",153,0)
 .. Q
"RTN","IBCEF74A",154,0)
 . Q
"RTN","IBCEF74A",155,0)
 I NODATA,'IBQUIT W !?8,"(-) None Found"
"RTN","IBCEF74A",156,0)
SECIDX ;
"RTN","IBCEF74A",157,0)
 Q
"RTN","IBCEF74A",158,0)
 ;
"RTN","IBCEF75")
0^42^B24683660^B23882452
"RTN","IBCEF75",1,0)
IBCEF75 ;ALB/WCJ - Provider ID functions ;13 Feb 2006
"RTN","IBCEF75",2,0)
 ;;2.0;INTEGRATED BILLING;**320,371,400,432**;21-MAR-94;Build 192
"RTN","IBCEF75",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF75",4,0)
 ;
"RTN","IBCEF75",5,0)
 G AWAY
"RTN","IBCEF75",6,0)
AWAY Q
"RTN","IBCEF75",7,0)
 ;
"RTN","IBCEF75",8,0)
ALLIDS(IBIFN,IBXSAVE,IBSTRIP,SEG) ; Return all of the Provider IDS 
"RTN","IBCEF75",9,0)
 I '$D(IBSTRIP) S IBSTRIP=0
"RTN","IBCEF75",10,0)
 I '$D(SEG) S SEG=""
"RTN","IBCEF75",11,0)
 N IBXIEN,ARINFO,ARID,ARQ,IBFRMTYP,ARIEN,ARINS,Z0,DAT,I,SORT1,SORT2,SORT3,COB,IBCCOB
"RTN","IBCEF75",12,0)
 ;
"RTN","IBCEF75",13,0)
 S IBXIEN=IBIFN
"RTN","IBCEF75",14,0)
 D ALLPROV^IBCEF7    ; Get the Person ID's (Returns IBXSAVE)
"RTN","IBCEF75",15,0)
 S DAT=$$PROVID^IBCEF73(IBIFN)
"RTN","IBCEF75",16,0)
 S DAT("QUAL")=IBXSAVE("ID")  ; this value was also passed back by above function
"RTN","IBCEF75",17,0)
 S SORT1="" F  S SORT1=$O(IBXSAVE("PROVINF",IBIFN,SORT1)) Q:SORT1=""  D
"RTN","IBCEF75",18,0)
 . S SORT2=0 F  S SORT2=$O(IBXSAVE("PROVINF",IBIFN,SORT1,SORT2)) Q:SORT2=""  D
"RTN","IBCEF75",19,0)
 .. S SORT3=0 F  S SORT3=$O(IBXSAVE("PROVINF",IBIFN,SORT1,SORT2,SORT3))  Q:SORT3=""  D
"RTN","IBCEF75",20,0)
 ... ;*432/TAZ - Primary node now points to NPI
"RTN","IBCEF75",21,0)
 ... N IBPRVPTR,IBNPI
"RTN","IBCEF75",22,0)
 ... S IBPRVPTR=IBXSAVE("PROVINF",IBIFN,SORT1,SORT2,SORT3),IBNPI=$$GETNPI^IBCEF73A(IBPRVPTR)
"RTN","IBCEF75",23,0)
 ... S IBXSAVE("PROVINF",IBIFN,SORT1,SORT2,SORT3,0)="PRIMARY"_U_U_$$STRIP^IBCEF76($S(IBNPI]"":"XX",1:"")_U_IBNPI,1,U,IBSTRIP)
"RTN","IBCEF75",24,0)
 ... F I=1:1 Q:'$D(IBXSAVE("PROVINF",IBIFN,SORT1,SORT2,SORT3,I))  D
"RTN","IBCEF75",25,0)
 .... S $P(IBXSAVE("PROVINF",IBIFN,SORT1,SORT2,SORT3,I),U,3,4)=$$STRIP^IBCEF76($P(IBXSAVE("PROVINF",IBIFN,SORT1,SORT2,SORT3,I),U,3,4),1,U,IBSTRIP)
"RTN","IBCEF75",26,0)
 ;
"RTN","IBCEF75",27,0)
 D LFIDS^IBCEF76(IBIFN,.IBXSAVE,IBSTRIP,SEG)   ; Get the Lab/Facility IDs
"RTN","IBCEF75",28,0)
 ;
"RTN","IBCEF75",29,0)
 S IBFRMTYP=$$FT^IBCEF(IBIFN)
"RTN","IBCEF75",30,0)
 S ARIEN=$S(IBFRMTYP=2:3,1:4)
"RTN","IBCEF75",31,0)
 S IBCCOB=$$COBN^IBCEF(IBIFN)  ; Current Insurance
"RTN","IBCEF75",32,0)
 F COB=1:1:3 D
"RTN","IBCEF75",33,0)
 . S SORT1=$S(COB=IBCCOB:"C",1:"O")
"RTN","IBCEF75",34,0)
 . S SORT2=$S(SORT1="C":1,COB=1:1,COB=2&(IBCCOB=1):1,1:2)
"RTN","IBCEF75",35,0)
 . S ARINFO=$G(IBXSAVE("PROVINF",IBIFN,SORT1,SORT2,ARIEN,1))
"RTN","IBCEF75",36,0)
 . ;
"RTN","IBCEF75",37,0)
 . D BPIDS(IBIFN,.IBXSAVE,SORT1,SORT2,COB,IBSTRIP,SEG)
"RTN","IBCEF75",38,0)
 Q
"RTN","IBCEF75",39,0)
 ; 
"RTN","IBCEF75",40,0)
BPIDS(IBIFN,IDS,SORT1,SORT2,COB,IBSTRIP,SEG) ; Get all the billing provider IDs and qualifiers from the claim and file 355.92
"RTN","IBCEF75",41,0)
 N DAT,IBFRMTYP,IBCARE,IBDIV,IBINS,MAIN,IBCCOB,USED,PLANTYPE,I,CNT,QUAL,ARF,M1,DEF,IDDIV,IBLIMIT,IEN,ID,IB2
"RTN","IBCEF75",42,0)
 ;
"RTN","IBCEF75",43,0)
 S DAT=$G(^DGCR(399,IBIFN,0))
"RTN","IBCEF75",44,0)
 S IBFRMTYP=$$FT^IBCEF(IBIFN),IBFRMTYP=$S(IBFRMTYP=2:2,IBFRMTYP=3:1,1:0)
"RTN","IBCEF75",45,0)
 S IBCARE=$S($$ISRX^IBCEF1(IBIFN):3,1:0) ;if an Rx refill bill
"RTN","IBCEF75",46,0)
 S:IBCARE=0 IBCARE=$$INPAT^IBCEF(IBIFN) S:'IBCARE IBCARE=2 ;1-inp,2-out
"RTN","IBCEF75",47,0)
 S IBDIV=+$P(DAT,U,22)
"RTN","IBCEF75",48,0)
 S MAIN=$$MAIN^IBCEP2B()  ; get the IEN for main Division
"RTN","IBCEF75",49,0)
 S IBCCOB=$$COBN^IBCEF(IBIFN)  ; Current Insurance
"RTN","IBCEF75",50,0)
 S IBINS=$P($G(^DGCR(399,IBIFN,"I"_COB)),U)
"RTN","IBCEF75",51,0)
 Q:IBINS=""
"RTN","IBCEF75",52,0)
 ;
"RTN","IBCEF75",53,0)
 S IDS("BILLING PRV",IBIFN,SORT1,SORT2)=$E("PST",COB)
"RTN","IBCEF75",54,0)
 ;
"RTN","IBCEF75",55,0)
 ; Primary ID
"RTN","IBCEF75",56,0)
 S IDS("BILLING PRV",IBIFN,SORT1,SORT2,0)=$$STRIP^IBCEF76($$TAXID(),1,U,IBSTRIP)
"RTN","IBCEF75",57,0)
 S USED($P(IDS("BILLING PRV",IBIFN,SORT1,SORT2,0),U))=""
"RTN","IBCEF75",58,0)
 ;
"RTN","IBCEF75",59,0)
 ; Secondary #1 - This is the ID Emdeon uses for sorting
"RTN","IBCEF75",60,0)
 S IDS("BILLING PRV",IBIFN,SORT1,SORT2,1)=$$STRIP^IBCEF76($$BPSID1(IBDIV),1,U,IBSTRIP)
"RTN","IBCEF75",61,0)
 S USED($P(IDS("BILLING PRV",IBIFN,SORT1,SORT2,1),U))=""
"RTN","IBCEF75",62,0)
 ;
"RTN","IBCEF75",63,0)
 ; Check if this is a plan type which gets no secondary IDs
"RTN","IBCEF75",64,0)
 S M1=$G(^DGCR(399,IBIFN,"M1"))
"RTN","IBCEF75",65,0)
 ; the following check is the current value of the flag, not when the claim was created. 
"RTN","IBCEF75",66,0)
 S PLANTYPE=$$POLTYP^IBCEF3(IBIFN,COB)
"RTN","IBCEF75",67,0)
 I PLANTYPE]"",$D(^DIC(36,IBINS,13,"B",PLANTYPE)) Q 
"RTN","IBCEF75",68,0)
 ;
"RTN","IBCEF75",69,0)
 ; Secondary #2
"RTN","IBCEF75",70,0)
 ; If there is a ID  send with quailifer (stored or computed)
"RTN","IBCEF75",71,0)
 I $TR($P(M1,U,COB+1)," ")]"" D
"RTN","IBCEF75",72,0)
 . S QUAL=""
"RTN","IBCEF75",73,0)
 . S DAT=$P(M1,U,COB+9)
"RTN","IBCEF75",74,0)
 . I DAT S QUAL=$$STRIP^IBCEF76($P($G(^IBE(355.97,DAT,0)),U,3),1,,IBSTRIP)
"RTN","IBCEF75",75,0)
 . ; the null check is needed to be backwards compatible
"RTN","IBCEF75",76,0)
 . I QUAL=""!(QUAL="1J") S QUAL=$$STRIP^IBCEF76($$OLDWAY(IBIFN,COB),1,,IBSTRIP)
"RTN","IBCEF75",77,0)
 . S IB2=QUAL_U_$$STRIP^IBCEF76($P(M1,U,COB+1),1,,IBSTRIP)
"RTN","IBCEF75",78,0)
 ;
"RTN","IBCEF75",79,0)
 ;WCJ;IB*2.0*432;START
"RTN","IBCEF75",80,0)
 ;I $TR($P(M1,U,COB+1)," ")="" S IB2=$$STRIP^IBCEF76($$OLDWAY(IBIFN,COB),1,,IBSTRIP)_U_$$STRIP^IBCEF76($$GET1^DIQ(350.9,1,1.05),1,,IBSTRIP)
"RTN","IBCEF75",81,0)
 ;
"RTN","IBCEF75",82,0)
 I $G(IB2)]"",$P(IB2,U)]"",$P(IB2,U,2)]"" D  ;TAZ - Changed $G(IB2) to $G(IB2)]""
"RTN","IBCEF75",83,0)
 . S IDS("BILLING PRV",IBIFN,SORT1,SORT2,2)=IB2
"RTN","IBCEF75",84,0)
 . ;S IDS("BILLING PRV",IBIFN,SORT1,SORT2,2,"PTQ")=$$OLDWAY(IBIFN,COB)
"RTN","IBCEF75",85,0)
 . S USED($P(IB2,U))=""
"RTN","IBCEF75",86,0)
 ;WCJ;IB*2.0*432
"RTN","IBCEF75",87,0)
 ;
"RTN","IBCEF75",88,0)
 S CNT=$S('$D(IDS("BILLING PRV",IBIFN,SORT1,SORT2,2)):2,1:3)
"RTN","IBCEF75",89,0)
 S IBLIMIT=8
"RTN","IBCEF75",90,0)
 S IEN=0 F  S IEN=$O(^IBA(355.92,"B",IBINS,IEN)) Q:IEN=""  D  Q:CNT>IBLIMIT
"RTN","IBCEF75",91,0)
 . S DAT=$G(^IBA(355.92,IEN,0))
"RTN","IBCEF75",92,0)
 . Q:$P(DAT,U,8)'="A"   ; only allow additional IDs
"RTN","IBCEF75",93,0)
 . Q:$P(DAT,U,7)=""  ; No Provider ID
"RTN","IBCEF75",94,0)
 . Q:$P(DAT,U,6)=""  ; No ID Qualifier
"RTN","IBCEF75",95,0)
 . I IBFRMTYP=1 Q:$P(DAT,U,4)=2
"RTN","IBCEF75",96,0)
 . I IBFRMTYP=2 Q:$P(DAT,U,4)=1
"RTN","IBCEF75",97,0)
 . ;
"RTN","IBCEF75",98,0)
 . ; Check if we already have one of these
"RTN","IBCEF75",99,0)
 . S QUAL=$$STRIP^IBCEF76($P(DAT,U,6),1,,IBSTRIP)
"RTN","IBCEF75",100,0)
 . S QUAL=$P($G(^IBE(355.97,QUAL,0)),U,3)
"RTN","IBCEF75",101,0)
 . Q:QUAL=""
"RTN","IBCEF75",102,0)
 . Q:$D(USED(QUAL))
"RTN","IBCEF75",103,0)
 . ;
"RTN","IBCEF75",104,0)
 . S IDS("BILLING PRV",IBIFN,SORT1,SORT2,CNT)=QUAL_U_$$STRIP^IBCEF76($P(DAT,U,7),1,,IBSTRIP)
"RTN","IBCEF75",105,0)
 . S CNT=CNT+1,USED(QUAL)=""
"RTN","IBCEF75",106,0)
 ;
"RTN","IBCEF75",107,0)
 Q
"RTN","IBCEF75",108,0)
 ;
"RTN","IBCEF75",109,0)
OLDWAY(IBIFN,COB) ; Figure out the qualifier the old way if it's not stored with the claim.
"RTN","IBCEF75",110,0)
 ; It's based on the plan type.  This is used for Billing Provider Secondary ID #2
"RTN","IBCEF75",111,0)
 N PLANTYPE
"RTN","IBCEF75",112,0)
 S PLANTYPE=$$POLTYP^IBCEF3(IBIFN,COB)
"RTN","IBCEF75",113,0)
 Q $$SOP^IBCEP2B(IBIFN,PLANTYPE)
"RTN","IBCEF75",114,0)
 ;
"RTN","IBCEF75",115,0)
BPSID1(DIV) ; Return the Billing Provider Secondary ID #1 and qualifier which Emdeon uses to sort IBIFNs
"RTN","IBCEF75",116,0)
 N DATA
"RTN","IBCEF75",117,0)
 S DATA=$P($$SITE^VASITE(DT,$S(DIV:DIV,1:+$$PRIM^VASITE(DT))),U,3)
"RTN","IBCEF75",118,0)
 S DATA=$E("0000",1,7-$L(DATA))_$E(DATA,4,7)
"RTN","IBCEF75",119,0)
 Q "G5"_U_DATA
"RTN","IBCEF75",120,0)
 ;
"RTN","IBCEF75",121,0)
TAXID() ; Return the Billing Provider Primary ID and qualifier which is the TAXID for the site and also the qualifier
"RTN","IBCEF75",122,0)
 N DATA
"RTN","IBCEF75",123,0)
 S DATA=$P($G(^IBE(350.9,1,1)),U,5)
"RTN","IBCEF75",124,0)
 S DATA=$$NOPUNCT^IBCEF(DATA,1)
"RTN","IBCEF75",125,0)
 Q 24_U_DATA
"RTN","IBCEF75",126,0)
 ;
"RTN","IBCEF75",127,0)
CLEANUP(IBXSAVE) ; Clean up 
"RTN","IBCEF75",128,0)
 K IBXSAVE("PROVINF")
"RTN","IBCEF75",129,0)
 K IBXSAVE("LAB/FAC")
"RTN","IBCEF75",130,0)
 K IBXSAVE("BILLING PRV")
"RTN","IBCEF75",131,0)
 K IBXSAVE("ID")
"RTN","IBCEF75",132,0)
 Q
"RTN","IBCEF76")
0^91^B45722940^B37942879
"RTN","IBCEF76",1,0)
IBCEF76 ;ALB/WCJ - Provider ID functions ;13 Feb 2006
"RTN","IBCEF76",2,0)
 ;;2.0;INTEGRATED BILLING;**320,349,400,432**;21-MAR-94;Build 192
"RTN","IBCEF76",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF76",4,0)
 ;
"RTN","IBCEF76",5,0)
 G AWAY
"RTN","IBCEF76",6,0)
AWAY Q
"RTN","IBCEF76",7,0)
 ;
"RTN","IBCEF76",8,0)
LFIDS(IBIFN,IDS,IBSTRIP,SEG) ;
"RTN","IBCEF76",9,0)
 ;  Pass in the the internal claim number and return the array of IDS.
"RTN","IBCEF76",10,0)
 ;  IDS("C"urrent or "O"ther, Order of Insurance within subscript 1, order of ID within subscript 2)
"RTN","IBCEF76",11,0)
 ;  IDS("C",1)="P"
"RTN","IBCEF76",12,0)
 ;  IDS("C",1,0)=Qualifier^Primary ID
"RTN","IBCEF76",13,0)
 ;  IDS("C",1,1)=Qualifier^Sec ID #1
"RTN","IBCEF76",14,0)
 ;  IDS("C",1,2)=Qualifier^Sec ID #2
"RTN","IBCEF76",15,0)
 ;
"RTN","IBCEF76",16,0)
 N DAT,IBFRMTYP,IBCARE,IBDIV,IBINS,OUTFAC,MAIN,IBCCOB,TMPIDS,COB,IBSORT1,IBSORT2,IBLIMIT,IBLF
"RTN","IBCEF76",17,0)
 ;
"RTN","IBCEF76",18,0)
 S DAT=$G(^DGCR(399,IBIFN,0))
"RTN","IBCEF76",19,0)
 S IBFRMTYP=$$FT^IBCEF(IBIFN),IBFRMTYP=$S(IBFRMTYP=2:2,IBFRMTYP=3:1,1:0)
"RTN","IBCEF76",20,0)
 S IBCARE=$S($$ISRX^IBCEF1(IBIFN):3,1:0) ;if an Rx refill bill
"RTN","IBCEF76",21,0)
 S:IBCARE=0 IBCARE=$$INPAT^IBCEF(IBIFN) S:'IBCARE IBCARE=2 ;1-inp,2-out
"RTN","IBCEF76",22,0)
 S IBDIV=+$P(DAT,U,22)
"RTN","IBCEF76",23,0)
 S OUTFAC=$P($G(^DGCR(399,IBIFN,"U2")),U,10)
"RTN","IBCEF76",24,0)
 S MAIN=$$MAIN^IBCEP2B()  ; get the IEN for main Division
"RTN","IBCEF76",25,0)
 ;
"RTN","IBCEF76",26,0)
 S IBCCOB=$$COBN^IBCEF(IBIFN)
"RTN","IBCEF76",27,0)
 F COB=1:1:3 D
"RTN","IBCEF76",28,0)
 . S IBSORT1=$S(COB=IBCCOB:"C",1:"O")
"RTN","IBCEF76",29,0)
 . S IBSORT2=$S(IBSORT1="C":1,COB=1:1,COB=2&(IBCCOB=1):1,1:2)
"RTN","IBCEF76",30,0)
 . S IBLIMIT=$S(IBSORT1="C":5,1:3)  ; Limit secondary IDs
"RTN","IBCEF76",31,0)
 . S DAT=$G(^DGCR(399,IBIFN,"I"_COB))
"RTN","IBCEF76",32,0)
 . ;
"RTN","IBCEF76",33,0)
 . S IBINS=$P(DAT,U)  ; insurance PTR 36
"RTN","IBCEF76",34,0)
 . Q:IBINS=""
"RTN","IBCEF76",35,0)
 . ;
"RTN","IBCEF76",36,0)
 . ; IB*2*400 - esg - 9/24/08, 2/24/09 - if there is no service facility for this claim at this COB, then get out
"RTN","IBCEF76",37,0)
 . S IBLF=$$B^IBCEF79(IBIFN,COB)       ; billing provider/service facility function
"RTN","IBCEF76",38,0)
 . I $P(IBLF,U,3)="" Q                 ; no service facility data at this COB, don't build this "LAB/FAC" area
"RTN","IBCEF76",39,0)
 . ;
"RTN","IBCEF76",40,0)
 . I OUTFAC]"" D  Q
"RTN","IBCEF76",41,0)
 .. D NONVALF(IBIFN,OUTFAC_";IBA(355.93,",IBINS,IBFRMTYP,IBCARE,.IDS,IBSORT1,IBSORT2,COB,IBLIMIT,IBSTRIP,SEG)
"RTN","IBCEF76",42,0)
 . ;
"RTN","IBCEF76",43,0)
 . I OUTFAC="" D
"RTN","IBCEF76",44,0)
 .. ;
"RTN","IBCEF76",45,0)
 .. ; if ins co flag says to not send svc fac data and we're sending an EDI claim, then get out
"RTN","IBCEF76",46,0)
 .. I '$$SENDSF^IBCEF79(IBIFN,COB),$G(^TMP("IBTX",$J,IBIFN)) Q
"RTN","IBCEF76",47,0)
 .. ;
"RTN","IBCEF76",48,0)
 .. ;IB*2.0*432/TAZ Moved Taxid setup inside VALF look to send as secondary ID for Medicare claims.
"RTN","IBCEF76",49,0)
 .. ;S IDS("LAB/FAC",IBIFN,IBSORT1,IBSORT2,0)=$$STRIP($$TAXID^IBCEF75(),1,U,IBSTRIP)
"RTN","IBCEF76",50,0)
 .. D VALF(IBIFN,IBINS,IBFRMTYP,IBDIV,.IDS,IBSORT1,IBSORT2,COB,IBLIMIT,IBSTRIP,SEG)
"RTN","IBCEF76",51,0)
 Q
"RTN","IBCEF76",52,0)
 ;
"RTN","IBCEF76",53,0)
VALF(IBIFN,INS,FT,DIV,IDS,SORT1,SORT2,COB,IBLIMIT,IBSTRIP,SEG) ; Get VA Lab/Fac Secondary IDs
"RTN","IBCEF76",54,0)
 ; Pass in INS - IEN to file 36
"RTN","IBCEF76",55,0)
 ; FT - 1 = UB 2 = 1500
"RTN","IBCEF76",56,0)
 ; DIV - PTR to 40.8
"RTN","IBCEF76",57,0)
 ;
"RTN","IBCEF76",58,0)
 N Z,Z0,ID,QUAL,MAIN,IDTBL,CNT,Z,IBMCR
"RTN","IBCEF76",59,0)
 S MAIN=$$MAIN^IBCEP2B()  ; get the IEN for main Division
"RTN","IBCEF76",60,0)
 S Z=0 F  S Z=$O(^IBA(355.92,"B",INS,Z)) Q:'Z  D
"RTN","IBCEF76",61,0)
 . S Z0=$G(^IBA(355.92,Z,0))
"RTN","IBCEF76",62,0)
 . Q:$P(Z0,U,8)'="LF"   ; Screen out anything other than Lab or Facility
"RTN","IBCEF76",63,0)
 . I +$P(Z0,U,4) Q:$P(Z0,U,4)'=FT   ; Form type must match that passed in or be a 0 which allows both
"RTN","IBCEF76",64,0)
 . S ID=$$STRIP($P(Z0,U,7),1,,IBSTRIP)
"RTN","IBCEF76",65,0)
 . S QUAL=$$STRIP($P(Z0,U,6),1,,IBSTRIP)
"RTN","IBCEF76",66,0)
 . Q:QUAL=""   ; Needs a qualifier
"RTN","IBCEF76",67,0)
 . S QUAL=$P($G(^IBE(355.97,QUAL,0)),U,3)
"RTN","IBCEF76",68,0)
 . I FT=1,SORT1="O" Q:$$OP3^IBCEF73(FT)'[(U_QUAL_U)   ; Institutional
"RTN","IBCEF76",69,0)
 . I FT=2,SORT1="O" Q:$$OP7^IBCEF73(FT)'[(U_QUAL_U)   ; Professional
"RTN","IBCEF76",70,0)
 . I $P(Z0,U,5)=""!($P(Z0,U,5)=0)!($P(Z0,U,5)=MAIN) S IDTBL("DEF",QUAL)=ID  ; set up default for main division
"RTN","IBCEF76",71,0)
 . I $P(Z0,U,5)=DIV S IDTBL("DIV",QUAL)=ID  ; set up default for division
"RTN","IBCEF76",72,0)
 S CNT=0
"RTN","IBCEF76",73,0)
 S IDS("LAB/FAC",IBIFN,SORT1,SORT2)=$E("PST",COB)
"RTN","IBCEF76",74,0)
 ;IB*2.0*432/TAZ If Medicare send Tax ID as 1st Secondary ID ; only if it's not a printed form
"RTN","IBCEF76",75,0)
 S IBMCR=""
"RTN","IBCEF76",76,0)
 I '(($G(IBXFORM)=2)!($G(IBXFORM)=3)) S IBMCR=$$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEF76",77,0)
 I IBMCR S CNT=CNT+1,IDS("LAB/FAC",IBIFN,SORT1,SORT2,CNT)="LU"_U_$$STRIP($P($$TAXID^IBCEF75(),U,2),1,U,IBSTRIP)
"RTN","IBCEF76",78,0)
 I $D(IDTBL("DIV")) D  Q
"RTN","IBCEF76",79,0)
 . S Z="" F  S Z=$O(IDTBL("DIV",Z)) Q:Z=""  D
"RTN","IBCEF76",80,0)
 .. ;IB*2.0*432/TAZ If Medicare, screen out Tax ID
"RTN","IBCEF76",81,0)
 .. I IBMCR,(Z=24) Q
"RTN","IBCEF76",82,0)
 .. S CNT=CNT+1,IDS("LAB/FAC",IBIFN,SORT1,SORT2,CNT)=Z_U_IDTBL("DIV",Z) Q:CNT=IBLIMIT
"RTN","IBCEF76",83,0)
 I $D(IDTBL("DEF")) D  Q
"RTN","IBCEF76",84,0)
 . S Z="" F  S Z=$O(IDTBL("DEF",Z)) Q:Z=""  D
"RTN","IBCEF76",85,0)
 .. ;IB*2.0*432/TAZ If Medicare, screen out Tax ID
"RTN","IBCEF76",86,0)
 .. I IBMCR,(Z=24) Q
"RTN","IBCEF76",87,0)
 .. S CNT=CNT+1,IDS("LAB/FAC",IBIFN,SORT1,SORT2,CNT)=Z_U_IDTBL("DEF",Z) Q:CNT=IBLIMIT
"RTN","IBCEF76",88,0)
 Q
"RTN","IBCEF76",89,0)
 ;
"RTN","IBCEF76",90,0)
NONVALF(IBIFN,PRV,INS,FT,PT,IDS,SORT1,SORT2,COB,IBLIMIT,IBSTRIP,SEG) ; Get Non VA Lab/Fac Secondary IDs
"RTN","IBCEF76",91,0)
 ; Pass in PRV - VPTR - PTR to 355.93 (in format of variabel pointer IEN;IBA(355.93,
"RTN","IBCEF76",92,0)
 ; Pass in INS - PTR to 36 of null (not provide by insurance company)
"RTN","IBCEF76",93,0)
 ; FT - 1 = UB 2 = 1500
"RTN","IBCEF76",94,0)
 ; PT - Patient Type - 1 inpatient 2 outpatient
"RTN","IBCEF76",95,0)
 ; IDS array being returned
"RTN","IBCEF76",96,0)
 ; SORT1 - "C"urrent or "O"ther
"RTN","IBCEF76",97,0)
 ; SORT2 - 1 if current or (1 or 2 if other)
"RTN","IBCEF76",98,0)
 N Z,Z0,ID,QUAL,IDTBL,CNT,IBMCR
"RTN","IBCEF76",99,0)
 S Z=0 F  S Z=$O(^IBA(355.9,"B",PRV,Z)) Q:'Z  D
"RTN","IBCEF76",100,0)
 . S Z0=$G(^IBA(355.9,Z,0))
"RTN","IBCEF76",101,0)
 . I +$P(Z0,U,4) Q:$P(Z0,U,4)'=FT   ; Form type must match that passed in or be a 0 which allows both UB and 1500
"RTN","IBCEF76",102,0)
 . I +$P(Z0,U,5) Q:$P(Z0,U,5)'=PT   ; Patient type must match that passed in or be a 0 which allows both in patient and outpatient
"RTN","IBCEF76",103,0)
 . I INS]"",$P(Z0,U,2)]"",INS'=$P(Z0,U,2) Q
"RTN","IBCEF76",104,0)
 . S ID=$$STRIP($P(Z0,U,7),1,,IBSTRIP)
"RTN","IBCEF76",105,0)
 . Q:ID=""
"RTN","IBCEF76",106,0)
 . S QUAL=$$STRIP($P(Z0,U,6),1,,IBSTRIP)
"RTN","IBCEF76",107,0)
 . Q:QUAL=""   ; Needs a qualifier
"RTN","IBCEF76",108,0)
 . S QUAL=$P($G(^IBE(355.97,QUAL,0)),U,3)
"RTN","IBCEF76",109,0)
 . Q:QUAL=""
"RTN","IBCEF76",110,0)
 . I FT=1,SORT1="O" Q:$$OP3^IBCEF73(FT)'[(U_QUAL_U)   ; Institutional
"RTN","IBCEF76",111,0)
 . I FT=2,SORT1="O" Q:$$OP7^IBCEF73(FT)'[(U_QUAL_U)   ; Professional
"RTN","IBCEF76",112,0)
 . I $G(SEG)="SUB1" Q:$$SUB1^IBCEF73(FT)'[(U_QUAL_U)
"RTN","IBCEF76",113,0)
 . I $P(Z0,U,2)="" S IDTBL("OWN",QUAL)=ID  ; set up default of lab or facilities own ids
"RTN","IBCEF76",114,0)
 . I $P(Z0,U,2)=INS S IDTBL("INS",QUAL)=ID  ; set up default for division
"RTN","IBCEF76",115,0)
 ;
"RTN","IBCEF76",116,0)
 S CNT=0
"RTN","IBCEF76",117,0)
 S IDS("LAB/FAC",IBIFN,SORT1,SORT2)=$E("PST",COB)_U_PRV
"RTN","IBCEF76",118,0)
 S IDS("LAB/FAC",IBIFN,SORT1,SORT2,"CONTACT")=$G(^IBA(355.93,+PRV,1))
"RTN","IBCEF76",119,0)
 ; get primary
"RTN","IBCEF76",120,0)
 S Z0=$G(^IBA(355.93,+PRV,0))
"RTN","IBCEF76",121,0)
 ;IB*2.0*432/TAZ If Medicare send Tax ID as 1st Secondary ID
"RTN","IBCEF76",122,0)
 S IBMCR=""
"RTN","IBCEF76",123,0)
 I '(($G(IBXFORM)=2)!($G(IBXFORM)=3)) S IBMCR=$$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEF76",124,0)
 ;I $P(Z0,U,9)]"",$P(Z0,U,13)]"",IBMCR S CNT=CNT+1,IDS("LAB/FAC",IBIFN,SORT1,SORT2,CNT)="LU"_U_$$STRIP($P($G(^IBE(355.97,$P(Z0,U,13),0)),U,3)_U_$P(Z0,U,9),1,U,IBSTRIP)
"RTN","IBCEF76",125,0)
 I $P(Z0,U,9)]"",$P(Z0,U,13)]"",IBMCR S CNT=CNT+1,IDS("LAB/FAC",IBIFN,SORT1,SORT2,CNT)="LU"_U_$$STRIP($P(Z0,U,9),1,U,IBSTRIP)
"RTN","IBCEF76",126,0)
 ; get secondarys in order
"RTN","IBCEF76",127,0)
 I $D(IDTBL("INS")) D
"RTN","IBCEF76",128,0)
 . N Z S Z="" F  S Z=$O(IDTBL("INS",Z)) Q:Z=""  D
"RTN","IBCEF76",129,0)
 .. ;IB*2.0*432/TAZ If Medicare, screen out Tax ID
"RTN","IBCEF76",130,0)
 .. I IBMCR,(Z=24) Q
"RTN","IBCEF76",131,0)
 .. S CNT=CNT+1,IDS("LAB/FAC",IBIFN,SORT1,SORT2,CNT)=Z_U_IDTBL("INS",Z) Q:CNT=IBLIMIT
"RTN","IBCEF76",132,0)
 I $D(IDTBL("OWN")),CNT'=IBLIMIT D
"RTN","IBCEF76",133,0)
 . N Z S Z="" F  S Z=$O(IDTBL("OWN",Z)) Q:Z=""  D
"RTN","IBCEF76",134,0)
 .. ;IB*2.0*432/TAZ If Medicare, screen out Tax ID
"RTN","IBCEF76",135,0)
 .. I IBMCR,(Z=24) Q
"RTN","IBCEF76",136,0)
 .. I '$D(IDTBL("INS",Z)) S CNT=CNT+1,IDS("LAB/FAC",IBIFN,SORT1,SORT2,CNT)=Z_U_IDTBL("OWN",Z) Q:CNT=IBLIMIT
"RTN","IBCEF76",137,0)
 Q
"RTN","IBCEF76",138,0)
 ;
"RTN","IBCEF76",139,0)
STRIP(X,SPACE,EXC,IBSTRIP) ;
"RTN","IBCEF76",140,0)
 ; Strip punctuation from data in X
"RTN","IBCEF76",141,0)
 ; SPACE = flag if 1 strip SPACES
"RTN","IBCEF76",142,0)
 ; EXC = list of punct not to strip
"RTN","IBCEF76",143,0)
 ; 
"RTN","IBCEF76",144,0)
 Q:'$G(IBSTRIP) X
"RTN","IBCEF76",145,0)
 Q $$NOPUNCT^IBCEF(X,$G(SPACE),$G(EXC))
"RTN","IBCEF76",146,0)
 ;
"RTN","IBCEF76",147,0)
OTH(IBIFN,IBXSAVE,IBXDATA,COND,SEG) ; Procedure used in piece 2 of some output
"RTN","IBCEF76",148,0)
 ; formatter segments for other insurance
"RTN","IBCEF76",149,0)
 ; COND = 0/1 value passed in that determines whether or not to call the
"RTN","IBCEF76",150,0)
 ;        provider ID function
"RTN","IBCEF76",151,0)
 ;  SEG = name of segment for use in calling ID^IBCEF2 (4 characters)
"RTN","IBCEF76",152,0)
 ;
"RTN","IBCEF76",153,0)
 N Z
"RTN","IBCEF76",154,0)
 ;*432/TAZ - Changed Clean up and Setup routines to IBCEFP*
"RTN","IBCEF76",155,0)
 ;D CLEANUP^IBCEF75(.IBXSAVE)
"RTN","IBCEF76",156,0)
 ;I COND D ALLIDS^IBCEF75(IBIFN,.IBXSAVE,1)
"RTN","IBCEF76",157,0)
 D CLEANUP^IBCEFP1(.IBXSAVE)
"RTN","IBCEF76",158,0)
 I COND D ALLIDS^IBCEFP(IBIFN,.IBXSAVE,1)
"RTN","IBCEF76",159,0)
 ;
"RTN","IBCEF76",160,0)
 ; Special Check:  if Other Insurance #2 has secondary ID's while Other
"RTN","IBCEF76",161,0)
 ; Insurance #1 does not, then move up #2 to be #1 here.  This is to
"RTN","IBCEF76",162,0)
 ; ensure the output formatter IBXDATA array is built properly.
"RTN","IBCEF76",163,0)
 ;
"RTN","IBCEF76",164,0)
 I $O(IBXSAVE("LAB/FAC",IBIFN,"O",2,0)),'$O(IBXSAVE("LAB/FAC",IBIFN,"O",1,0)) D
"RTN","IBCEF76",165,0)
 . K IBXSAVE("LAB/FAC",IBIFN,"O",1)
"RTN","IBCEF76",166,0)
 . M IBXSAVE("LAB/FAC",IBIFN,"O",1)=IBXSAVE("LAB/FAC",IBIFN,"O",2)
"RTN","IBCEF76",167,0)
 . K IBXSAVE("LAB/FAC",IBIFN,"O",2)
"RTN","IBCEF76",168,0)
 . Q
"RTN","IBCEF76",169,0)
 ;
"RTN","IBCEF76",170,0)
 K IBXDATA
"RTN","IBCEF76",171,0)
 S Z=0
"RTN","IBCEF76",172,0)
 F  S Z=$O(IBXSAVE("LAB/FAC",IBIFN,"O",Z)) Q:'Z  D
"RTN","IBCEF76",173,0)
 . I '$O(IBXSAVE("LAB/FAC",IBIFN,"O",Z,0)) Q
"RTN","IBCEF76",174,0)
 . S IBXDATA(Z)=$P($G(IBXSAVE("LAB/FAC",IBIFN,"O",Z)),U,1)
"RTN","IBCEF76",175,0)
 . I Z>1 D ID^IBCEF2(Z,SEG)
"RTN","IBCEF76",176,0)
 . Q
"RTN","IBCEF76",177,0)
OTHX ;
"RTN","IBCEF76",178,0)
 Q
"RTN","IBCEF76",179,0)
 ;
"RTN","IBCEF79")
0^72^B170462166^B126776634
"RTN","IBCEF79",1,0)
IBCEF79 ;ALB/ESG - Billing Provider functions ;13-Aug-2008
"RTN","IBCEF79",2,0)
 ;;2.0;INTEGRATED BILLING;**400,419,432**;21-MAR-94;Build 192
"RTN","IBCEF79",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF79",4,0)
 ;
"RTN","IBCEF79",5,0)
 Q
"RTN","IBCEF79",6,0)
 ;
"RTN","IBCEF79",7,0)
B(IBIFN,COB) ; Determine Billing Provider and Service Facility information
"RTN","IBCEF79",8,0)
 ; This function returns a string in the following format:
"RTN","IBCEF79",9,0)
 ;  [1] billing provider Institution file pointer (IEN to file 4) or "0"
"RTN","IBCEF79",10,0)
 ;      if the billing provider cannot be determined
"RTN","IBCEF79",11,0)
 ;  [2] billing provider name (.01 field in file 4) or Error reason why
"RTN","IBCEF79",12,0)
 ;      the billing provider cannot be determined - used when piece [1]=0
"RTN","IBCEF79",13,0)
 ;  [3] 0 if the service facility is a VA institution in file 4
"RTN","IBCEF79",14,0)
 ;      1 if the service facility is a non-VA facility in file 355.93
"RTN","IBCEF79",15,0)
 ;      "" if the service facility is blank - when there is no service facility
"RTN","IBCEF79",16,0)
 ;  [4] service facility IEN - either an IEN to file 4 or to file 355.93
"RTN","IBCEF79",17,0)
 ;      or "" if the service facility is blank
"RTN","IBCEF79",18,0)
 ;
"RTN","IBCEF79",19,0)
 ; Input parameters
"RTN","IBCEF79",20,0)
 ;   IBIFN - claim# required
"RTN","IBCEF79",21,0)
 ;     COB - payer sequence# - optional - defaults to current payer sequence# if not passed in
"RTN","IBCEF79",22,0)
 ;
"RTN","IBCEF79",23,0)
 NEW %,Z,IBU2,NVAFAC,BP,IB0,EVDT,IBDIV,BPDIV,BPDIVCHK,RXFLG,D,D0,DI,DIQ2,X,Y
"RTN","IBCEF79",24,0)
 S Z=""
"RTN","IBCEF79",25,0)
 S IBIFN=+$G(IBIFN)
"RTN","IBCEF79",26,0)
 I 'IBIFN S Z="0^Invalid claim.^^" G BX
"RTN","IBCEF79",27,0)
 I '$D(^DGCR(399,IBIFN,0)) S Z="0^Claim doesn't exist.^^" G BX
"RTN","IBCEF79",28,0)
 I '$G(COB) S COB=$$COBN^IBCEF(IBIFN)    ; current payer sequence default
"RTN","IBCEF79",29,0)
 I '$F(".1.2.3.","."_COB_".") S Z="0^Invalid Payer Sequence#: """_COB_"""^^" G BX
"RTN","IBCEF79",30,0)
 ;
"RTN","IBCEF79",31,0)
 ; set some initial variables for all claims
"RTN","IBCEF79",32,0)
 S IB0=$G(^DGCR(399,IBIFN,0))
"RTN","IBCEF79",33,0)
 S EVDT=$P(IB0,U,3)                      ; claim event date
"RTN","IBCEF79",34,0)
 I 'EVDT S EVDT=DT                       ;   - default today if undefined
"RTN","IBCEF79",35,0)
 S IBDIV=+$P(IB0,U,22)                   ; division ptr file 40.8
"RTN","IBCEF79",36,0)
 I 'IBDIV S IBDIV=$$PRIM^VASITE(EVDT)    ;   - default primary division as of event date
"RTN","IBCEF79",37,0)
 I IBDIV'>0 S $P(Z,U,1,2)="0^Invalid Division for Event Date "_$$FMTE^XLFDT(EVDT,"5Z")_"." G BX
"RTN","IBCEF79",38,0)
 S BPDIV=+$$SITE^VASITE(EVDT,IBDIV)      ; division institution ptr file 4
"RTN","IBCEF79",39,0)
 I BPDIV'>0 S $P(Z,U,1,2)="0^Invalid Institution for Event Date "_$$FMTE^XLFDT(EVDT,"5Z")_"." G BX
"RTN","IBCEF79",40,0)
 ;
"RTN","IBCEF79",41,0)
 ; check ins co switchback flag
"RTN","IBCEF79",42,0)
 I $$INSFLGS(IBIFN,COB)>0 D  G BX
"RTN","IBCEF79",43,0)
 . N IBZ,SVCIEN,SVCTYP
"RTN","IBCEF79",44,0)
 . ; revert billing provider and service facility calculation to pre-patch 400 methods
"RTN","IBCEF79",45,0)
 . ;
"RTN","IBCEF79",46,0)
 . ; service facility is legacy N-RENDERING INSTITUTION data
"RTN","IBCEF79",47,0)
 . D F^IBCEF("N-RENDERING INSTITUTION","IBZ",,IBIFN)
"RTN","IBCEF79",48,0)
 . S SVCIEN=+IBZ              ; service facility ien
"RTN","IBCEF79",49,0)
 . S SVCTYP=+$P(IBZ,U,2)      ; service facility type - 0=VA inst, 1=non-VA facility
"RTN","IBCEF79",50,0)
 . ;
"RTN","IBCEF79",51,0)
 . I 'SVCIEN S $P(Z,U,3)="",$P(Z,U,4)=""          ;  no svc fac
"RTN","IBCEF79",52,0)
 . I SVCIEN S $P(Z,U,3)=SVCTYP,$P(Z,U,4)=SVCIEN   ; yes svc fac
"RTN","IBCEF79",53,0)
 . ;
"RTN","IBCEF79",54,0)
 . ; billing provider = institution of main division in the database
"RTN","IBCEF79",55,0)
 . S BP=+$$SITE^VASITE
"RTN","IBCEF79",56,0)
 . I BP,$$BPFACTYP(BP) S $P(Z,U,1,2)=$$CHK(BP) Q
"RTN","IBCEF79",57,0)
 . S $P(Z,U,1,2)="0^Facility Type of Main Division Institution is invalid."
"RTN","IBCEF79",58,0)
 . Q
"RTN","IBCEF79",59,0)
 ;
"RTN","IBCEF79",60,0)
 S IBU2=$G(^DGCR(399,IBIFN,"U2"))
"RTN","IBCEF79",61,0)
 S NVAFAC=+$P(IBU2,U,10)          ; non-VA facility
"RTN","IBCEF79",62,0)
 I NVAFAC D  G BX
"RTN","IBCEF79",63,0)
 . S $P(Z,U,3)=1                  ; service facility is the non-VA facility
"RTN","IBCEF79",64,0)
 . S $P(Z,U,4)=NVAFAC             ; ien to file 355.93
"RTN","IBCEF79",65,0)
 . S BP=BPDIV                     ; institution of division on claim (IB*2*419)
"RTN","IBCEF79",66,0)
 . I BP,$$BPFACTYP(BP) S $P(Z,U,1,2)=$$CHK(BP) Q
"RTN","IBCEF79",67,0)
 . S $P(Z,U,1,2)="0^Facility Type of Claim's Division is invalid for the Billing Provider."
"RTN","IBCEF79",68,0)
 . Q
"RTN","IBCEF79",69,0)
 ;
"RTN","IBCEF79",70,0)
 S BPDIVCHK=0                            ; flag indicating if the div inst has been checked
"RTN","IBCEF79",71,0)
 S RXFLG=$$ISRX^IBCEF1(IBIFN)            ; pharmacy flag
"RTN","IBCEF79",72,0)
 ;
"RTN","IBCEF79",73,0)
 I RXFLG D
"RTN","IBCEF79",74,0)
 . S BP=+$$RXSITE^IBCEF73A(IBIFN)        ; dispensing pharmacy ien for pharmacy claims
"RTN","IBCEF79",75,0)
 . I 'BP S BP=BPDIV,BPDIVCHK=1           ; use division institution if pharmacy not found
"RTN","IBCEF79",76,0)
 . Q
"RTN","IBCEF79",77,0)
 ;
"RTN","IBCEF79",78,0)
 I 'RXFLG S BP=BPDIV,BPDIVCHK=1          ; non-Rx claims use division institution
"RTN","IBCEF79",79,0)
 ;
"RTN","IBCEF79",80,0)
 I BP,$$BPFACTYP(BP) D  G BX             ; billing provider type is valid
"RTN","IBCEF79",81,0)
 . S $P(Z,U,1,2)=$$CHK(BP)
"RTN","IBCEF79",82,0)
 . ;
"RTN","IBCEF79",83,0)
 . ; 3/27/09 - Special Case
"RTN","IBCEF79",84,0)
 . ;   If we are printing the CMS-1500 claim form, then populate the service facility with the billing provider.
"RTN","IBCEF79",85,0)
 . ;   For any other calculation, the service facility is blank here.
"RTN","IBCEF79",86,0)
 . ;
"RTN","IBCEF79",87,0)
 . I $G(^TMP("IB 1500 PRINT",$J,IBIFN)) D
"RTN","IBCEF79",88,0)
 .. S $P(Z,U,3)=0           ; service facility is in file 4
"RTN","IBCEF79",89,0)
 .. S $P(Z,U,4)=$P(Z,U,1)   ; move billing provider ien over
"RTN","IBCEF79",90,0)
 .. Q
"RTN","IBCEF79",91,0)
 . Q
"RTN","IBCEF79",92,0)
 ;
"RTN","IBCEF79",93,0)
 ; here, the BP has an invalid billing provider facility type
"RTN","IBCEF79",94,0)
 ; move this BP over to the service facility
"RTN","IBCEF79",95,0)
 S $P(Z,U,3)=0    ; service facility is in file 4
"RTN","IBCEF79",96,0)
 S $P(Z,U,4)=BP   ; move this BP over to the service facility
"RTN","IBCEF79",97,0)
 ;
"RTN","IBCEF79",98,0)
 I BPDIVCHK G B1  ; the division institution has already been checked...skip down to tag B1 to check the parent
"RTN","IBCEF79",99,0)
 ;
"RTN","IBCEF79",100,0)
 ; check the division institution
"RTN","IBCEF79",101,0)
 S BP=BPDIV,BPDIVCHK=1
"RTN","IBCEF79",102,0)
 I BP,$$BPFACTYP(BP) S $P(Z,U,1,2)=$$CHK(BP) G BX
"RTN","IBCEF79",103,0)
 ;
"RTN","IBCEF79",104,0)
B1 ;
"RTN","IBCEF79",105,0)
 ; check the parent
"RTN","IBCEF79",106,0)
 S BP=$$BPPAR(BPDIV)    ; institution of the parent of the division
"RTN","IBCEF79",107,0)
 I BP,$$BPFACTYP(BP) S $P(Z,U,1,2)=$$CHK(BP) G BX
"RTN","IBCEF79",108,0)
 ;
"RTN","IBCEF79",109,0)
 ; here, the facility type of the parent is also not valid, so it is an error
"RTN","IBCEF79",110,0)
 S $P(Z,U,1,2)="0^Facility Type of Division and the Division's Parent Institution are Invalid."
"RTN","IBCEF79",111,0)
BX ;
"RTN","IBCEF79",112,0)
 Q Z
"RTN","IBCEF79",113,0)
 ;
"RTN","IBCEF79",114,0)
CHK(IEN) ; Perform final billing provider checks on passed in Institution
"RTN","IBCEF79",115,0)
 ; file pointer - File 4 ien
"RTN","IBCEF79",116,0)
 ; Function returns final pieces 1 and 2 of $$B function as described above
"RTN","IBCEF79",117,0)
 NEW BP
"RTN","IBCEF79",118,0)
 S IEN=+$G(IEN)
"RTN","IBCEF79",119,0)
 I 'IEN S BP="0^Invalid Institution pointer IEN." G CHKX
"RTN","IBCEF79",120,0)
 I '$$BPCHKN(IEN) S BP="0^Not a National Institution." G CHKX
"RTN","IBCEF79",121,0)
 I '$$BPCHKA(IEN) S BP="0^Not an Active Institution." G CHKX
"RTN","IBCEF79",122,0)
 ;
"RTN","IBCEF79",123,0)
 S BP=IEN_U_$P($$NS^XUAF4(IEN),U,1)    ; ien^name  DBIA# 2171
"RTN","IBCEF79",124,0)
CHKX ;
"RTN","IBCEF79",125,0)
 Q BP
"RTN","IBCEF79",126,0)
 ;
"RTN","IBCEF79",127,0)
BPCHKN(IEN) ; Is this a national Institution?
"RTN","IBCEF79",128,0)
 N Z S Z=0
"RTN","IBCEF79",129,0)
 I $$STATUS^XUAF4(+IEN)="N" S Z=1    ; DBIA# 2171
"RTN","IBCEF79",130,0)
BPCHKNX ;
"RTN","IBCEF79",131,0)
 Q Z
"RTN","IBCEF79",132,0)
 ;
"RTN","IBCEF79",133,0)
BPCHKA(IEN) ; Is this an active Institution?
"RTN","IBCEF79",134,0)
 N Z S Z=0
"RTN","IBCEF79",135,0)
 I $$ACTIVE^XUAF4(+IEN) S Z=1        ; DBIA# 2171
"RTN","IBCEF79",136,0)
BPCHKAX ;
"RTN","IBCEF79",137,0)
 Q Z
"RTN","IBCEF79",138,0)
 ;
"RTN","IBCEF79",139,0)
BPFACTYP(IEN) ; Is the facility type of this Institution a valid Billing Provider facility type?
"RTN","IBCEF79",140,0)
 N Z S Z=0
"RTN","IBCEF79",141,0)
 I $D(^IBE(350.9,1,20,"B",+$$GET1^DIQ(4,+IEN_",",13,"I"))) S Z=1
"RTN","IBCEF79",142,0)
BPFACTPX ;
"RTN","IBCEF79",143,0)
 Q Z
"RTN","IBCEF79",144,0)
 ;
"RTN","IBCEF79",145,0)
BPPAR(IEN) ; Who is the parent for this Institution?
"RTN","IBCEF79",146,0)
 ; Function returns the IEN to file 4 of the parent institution as defined in File 4
"RTN","IBCEF79",147,0)
 N Z,PIA
"RTN","IBCEF79",148,0)
 D PARENT^XUAF4($NA(PIA),("`"_+IEN),"PARENT FACILITY")    ; DBIA# 2171
"RTN","IBCEF79",149,0)
 S Z=+$O(PIA("P",""))
"RTN","IBCEF79",150,0)
BPPARX ;
"RTN","IBCEF79",151,0)
 Q Z
"RTN","IBCEF79",152,0)
 ;
"RTN","IBCEF79",153,0)
TAX(IBIFN) ; Update default billing provider and service facility taxonomy codes
"RTN","IBCEF79",154,0)
 ; and billing provider secondary IDs and Qualifiers.
"RTN","IBCEF79",155,0)
 ; This is called via new style xrefs to update the default value of these fields
"RTN","IBCEF79",156,0)
 ;
"RTN","IBCEF79",157,0)
 N BPZ,BPTAX,SFTAX,IENS,IBTAXO,IBU3,IBM1,BPID1,BPQL1,BPID2,BPQL2,BPID3,BPQL3
"RTN","IBCEF79",158,0)
 N D,D0,DI,DIQ2,X,Y
"RTN","IBCEF79",159,0)
 ;
"RTN","IBCEF79",160,0)
 I '$G(IBIFN) G TAXQ
"RTN","IBCEF79",161,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)'=1 G TAXQ      ; claim is not editable
"RTN","IBCEF79",162,0)
 ;
"RTN","IBCEF79",163,0)
 S BPZ=$$B(IBIFN)     ; billing provider/service facility string
"RTN","IBCEF79",164,0)
 ;
"RTN","IBCEF79",165,0)
 ; billing provider taxonomy
"RTN","IBCEF79",166,0)
 S BPTAX=""
"RTN","IBCEF79",167,0)
 I +BPZ S BPTAX=+$P($$TAXORG^XUSTAX(+BPZ),U,2)      ; ien to file 8932.1 for VA billing provider
"RTN","IBCEF79",168,0)
 I 'BPTAX S BPTAX=""
"RTN","IBCEF79",169,0)
 ;
"RTN","IBCEF79",170,0)
 ; service facility taxonomy
"RTN","IBCEF79",171,0)
 S SFTAX=""
"RTN","IBCEF79",172,0)
 I $P(BPZ,U,3)=0,+$P(BPZ,U,4) S SFTAX=+$P($$TAXORG^XUSTAX(+$P(BPZ,U,4)),U,2)     ; ien to file 8932.1 for VA svc fac
"RTN","IBCEF79",173,0)
 I $P(BPZ,U,3)=1,+$P(BPZ,U,4) S SFTAX=+$P($$TAXGET^IBCEP81(+$P(BPZ,U,4)),U,2)    ; ien to file 8932.1 for non-VA svc fac
"RTN","IBCEF79",174,0)
 I 'SFTAX S SFTAX=""
"RTN","IBCEF79",175,0)
 ;
"RTN","IBCEF79",176,0)
 ; billing provider secondary ID#2 and qualifier#2 for each payer on the claim
"RTN","IBCEF79",177,0)
 S BPID1=$$PRVNUM^IBCU(IBIFN,,1)    ; #122
"RTN","IBCEF79",178,0)
 S BPQL1=$$PRVQUAL^IBCU(IBIFN,,1)   ; #128
"RTN","IBCEF79",179,0)
 S BPID2=$$PRVNUM^IBCU(IBIFN,,2)    ; #123
"RTN","IBCEF79",180,0)
 S BPQL2=$$PRVQUAL^IBCU(IBIFN,,2)   ; #129
"RTN","IBCEF79",181,0)
 S BPID3=$$PRVNUM^IBCU(IBIFN,,3)    ; #124
"RTN","IBCEF79",182,0)
 S BPQL3=$$PRVQUAL^IBCU(IBIFN,,3)   ; #130
"RTN","IBCEF79",183,0)
 ;
"RTN","IBCEF79",184,0)
 ; Use FileMan DBS call to update these fields if changes are necessary
"RTN","IBCEF79",185,0)
 S IENS=IBIFN_","
"RTN","IBCEF79",186,0)
 S IBU3=$G(^DGCR(399,IBIFN,"U3"))
"RTN","IBCEF79",187,0)
 S IBM1=$G(^DGCR(399,IBIFN,"M1"))
"RTN","IBCEF79",188,0)
 I SFTAX'=$P(IBU3,U,2) S IBTAXO(399,IENS,243)=SFTAX        ; service facility taxonomy
"RTN","IBCEF79",189,0)
 I BPTAX'=$P(IBU3,U,11) S IBTAXO(399,IENS,252)=BPTAX       ; billing provider taxonomy
"RTN","IBCEF79",190,0)
 I BPID1'=$P(IBM1,U,2) S IBTAXO(399,IENS,122)=BPID1        ; primary ID
"RTN","IBCEF79",191,0)
 I BPQL1'=$P(IBM1,U,10) S IBTAXO(399,IENS,128)=BPQL1       ; primary Qual
"RTN","IBCEF79",192,0)
 I BPID2'=$P(IBM1,U,3) S IBTAXO(399,IENS,123)=BPID2        ; secondary ID
"RTN","IBCEF79",193,0)
 I BPQL2'=$P(IBM1,U,11) S IBTAXO(399,IENS,129)=BPQL2       ; secondary Qual
"RTN","IBCEF79",194,0)
 I BPID3'=$P(IBM1,U,4) S IBTAXO(399,IENS,124)=BPID3        ; tertiary ID
"RTN","IBCEF79",195,0)
 I BPQL3'=$P(IBM1,U,12) S IBTAXO(399,IENS,130)=BPQL3       ; tertiary Qual
"RTN","IBCEF79",196,0)
 ;
"RTN","IBCEF79",197,0)
 I '$D(IBTAXO) G TAXQ    ; no changes necessary
"RTN","IBCEF79",198,0)
 ;
"RTN","IBCEF79",199,0)
 D FILE^DIE(,"IBTAXO")   ; update fields
"RTN","IBCEF79",200,0)
TAXQ ;
"RTN","IBCEF79",201,0)
 Q
"RTN","IBCEF79",202,0)
 ;
"RTN","IBCEF79",203,0)
INSFLGS(IBIFN,COB) ; get insurance company flags for a given claim
"RTN","IBCEF79",204,0)
 ; returns string of flags in the following format:
"RTN","IBCEF79",205,0)
 ; switchback flag ^ send service facility flag ^ institution file address flag ^ error
"RTN","IBCEF79",206,0)
 ; switchback flag: field 36/4.11 or 36/4.12, depending on form type. "-1" if error has occurred.
"RTN","IBCEF79",207,0)
 ; send service facility flag: field 36/4.07, empty if error has occurred or switchback flag is not set.
"RTN","IBCEF79",208,0)
 ; institution file address flag: field 36/4.13, empty if error has occurred or switchback flag is not set.
"RTN","IBCEF79",209,0)
 ; 
"RTN","IBCEF79",210,0)
 N FLGS,FT,INSIEN,INS4
"RTN","IBCEF79",211,0)
 S IBIFN=+$G(IBIFN) I 'IBIFN Q "-1^^^Invalid claim."
"RTN","IBCEF79",212,0)
 I '$D(^DGCR(399,IBIFN,0)) Q "-1^^^Claim doesn't exist."
"RTN","IBCEF79",213,0)
 I '$G(COB) S COB=$$COBN^IBCEF(IBIFN)    ; current payer sequence default
"RTN","IBCEF79",214,0)
 I '(".1.2.3."[("."_COB_".")) Q "-1^^^Invalid Payer Sequence#: """_COB_"""."
"RTN","IBCEF79",215,0)
 S INSIEN=$$POLICY^IBCEF(IBIFN,1,COB) I 'INSIEN Q "-1^^^No insurance company associated with the claim."
"RTN","IBCEF79",216,0)
 S INS4=$G(^DIC(36,INSIEN,4)),FT=$$FT^IBCEF(IBIFN)
"RTN","IBCEF79",217,0)
 S FLGS=$P(INS4,U,$S(FT=2:11,1:12)) I '+FLGS Q FLGS ; we are done if switchback flag is not set
"RTN","IBCEF79",218,0)
 S $P(FLGS,U,2)=$P(INS4,U,7),$P(FLGS,U,3)=$P(INS4,U,13) ; if switchback is set, get the other 2 flags
"RTN","IBCEF79",219,0)
 Q FLGS
"RTN","IBCEF79",220,0)
 ;
"RTN","IBCEF79",221,0)
GETBP(IBIFN,COB,INST,SUB,IBXSAVE) ; Get billing provider data for claim output
"RTN","IBCEF79",222,0)
 ; Used to extract billing provider name, address, and phone# for PRV segment and for CMS-1500, Box 33
"RTN","IBCEF79",223,0)
 ;   IBIFN - claim ien required
"RTN","IBCEF79",224,0)
 ;     COB - payer sequence (optional, defaults to current payer seq)
"RTN","IBCEF79",225,0)
 ;    INST - billing provider VA file 4 ien required
"RTN","IBCEF79",226,0)
 ;     SUB - subscript to use in IBXSAVE local array required
"RTN","IBCEF79",227,0)
 ; IBXSAVE - pass by reference
"RTN","IBCEF79",228,0)
 ;           Returns IBXSAVE(SUB,"NAME")
"RTN","IBCEF79",229,0)
 ;                   IBXSAVE(SUB,"ADDR1")
"RTN","IBCEF79",230,0)
 ;                   IBXSAVE(SUB,"ADDR2")
"RTN","IBCEF79",231,0)
 ;                   IBXSAVE(SUB,"CITY")
"RTN","IBCEF79",232,0)
 ;                   IBXSAVE(SUB,"ST")
"RTN","IBCEF79",233,0)
 ;                   IBXSAVE(SUB,"ZIP")
"RTN","IBCEF79",234,0)
 ;                   IBXSAVE(SUB,"PHONE")
"RTN","IBCEF79",235,0)
 NEW INSFLGS,SWBFLG,BPTP,MAINPTP,IBZ
"RTN","IBCEF79",236,0)
 K IBXSAVE(SUB)
"RTN","IBCEF79",237,0)
 I '$G(COB) S COB=$$COBN^IBCEF(IBIFN)
"RTN","IBCEF79",238,0)
 ;
"RTN","IBCEF79",239,0)
 S INSFLGS=$$INSFLGS(IBIFN,COB)           ; all ins co flags
"RTN","IBCEF79",240,0)
 S SWBFLG=(+INSFLGS>0)                    ; main switchback flag
"RTN","IBCEF79",241,0)
 S (BPTP,MAINPTP)=""                      ; initialize vars used only in switchback mode
"RTN","IBCEF79",242,0)
 I SWBFLG D
"RTN","IBCEF79",243,0)
 . S BPTP=$$MAINPRV^IBJPS3                ; main division pay-to provider data string
"RTN","IBCEF79",244,0)
 . S MAINPTP=($P(BPTP,U,10)'["IB177")     ; flag that says whether main div exists as a pay-to
"RTN","IBCEF79",245,0)
 . Q
"RTN","IBCEF79",246,0)
 ;
"RTN","IBCEF79",247,0)
 ; If Switchback is ON and the ins. company parameter Use billing provider VAMC address is not on and
"RTN","IBCEF79",248,0)
 ; main div pay-to exists, then use the pay-to provider data for the main division in the database.
"RTN","IBCEF79",249,0)
 ; This is the "normal" switchback data.
"RTN","IBCEF79",250,0)
 I SWBFLG,'$P(INSFLGS,U,3),MAINPTP D  G GETBPX    ; switchback + billing provider address flag + main ptp exists
"RTN","IBCEF79",251,0)
 . ; IB*2.0*432 - Retrieve the BP name from "gold standard" name field of file #4 and if not populated, retrieve from .01 field - IA#2171
"RTN","IBCEF79",252,0)
 . ;S IBXSAVE(SUB,"NAME")=$P(BPTP,U,1)
"RTN","IBCEF79",253,0)
 . S IBXSAVE(SUB,"NAME")=$$BNIEN^XUAF4(INST)
"RTN","IBCEF79",254,0)
 . S:IBXSAVE(SUB,"NAME")="" IBXSAVE(SUB,"NAME")=$P(BPTP,U,1)
"RTN","IBCEF79",255,0)
 . S IBXSAVE(SUB,"ADDR1")=$P(BPTP,U,5)
"RTN","IBCEF79",256,0)
 . S IBXSAVE(SUB,"ADDR2")=$P(BPTP,U,6)
"RTN","IBCEF79",257,0)
 . S IBXSAVE(SUB,"CITY")=$P(BPTP,U,7)
"RTN","IBCEF79",258,0)
 . S IBXSAVE(SUB,"ST")=$P(BPTP,U,8)
"RTN","IBCEF79",259,0)
 . S IBXSAVE(SUB,"ZIP")=$P(BPTP,U,9)
"RTN","IBCEF79",260,0)
 . S IBXSAVE(SUB,"PHONE")=$P(BPTP,U,4)
"RTN","IBCEF79",261,0)
 . Q
"RTN","IBCEF79",262,0)
 ;
"RTN","IBCEF79",263,0)
 ; Special Case:  Switchback is ON, the ins. company parameter Use billing provider VAMC address
"RTN","IBCEF79",264,0)
 ; is not on, but the main division is NOT defined as a Pay-To provider.
"RTN","IBCEF79",265,0)
 ; Get the name from the Institution File, but everything else from the claim's Pay-to provider
"RTN","IBCEF79",266,0)
 I SWBFLG,'$P(INSFLGS,U,3),'MAINPTP D  G GETBPX
"RTN","IBCEF79",267,0)
 . ; IB*2.0*432 - Retrieve the BP name from "gold standard" name field of file #4 and if not populated, retrieve from .01 field - IA#2171
"RTN","IBCEF79",268,0)
 . ;S IBXSAVE(SUB,"NAME")=$$GETFAC^IBCEP8(INST,0,0)
"RTN","IBCEF79",269,0)
 . S IBXSAVE(SUB,"NAME")=$$BNIEN^XUAF4(INST)
"RTN","IBCEF79",270,0)
 . S:IBXSAVE(SUB,"NAME")="" IBXSAVE(SUB,"NAME")=$$GETFAC^IBCEP8(INST,0,0)   ; Inst name
"RTN","IBCEF79",271,0)
 . S IBZ=$$PRVDATA^IBJPS3(IBIFN)
"RTN","IBCEF79",272,0)
 . S IBXSAVE(SUB,"ADDR1")=$P(IBZ,U,5)
"RTN","IBCEF79",273,0)
 . S IBXSAVE(SUB,"ADDR2")=$P(IBZ,U,6)
"RTN","IBCEF79",274,0)
 . S IBXSAVE(SUB,"CITY")=$P(IBZ,U,7)
"RTN","IBCEF79",275,0)
 . S IBXSAVE(SUB,"ST")=$P(IBZ,U,8)
"RTN","IBCEF79",276,0)
 . S IBXSAVE(SUB,"ZIP")=$P(IBZ,U,9)
"RTN","IBCEF79",277,0)
 . S IBXSAVE(SUB,"PHONE")=$P(IBZ,U,4)
"RTN","IBCEF79",278,0)
 . Q
"RTN","IBCEF79",279,0)
 ;
"RTN","IBCEF79",280,0)
 ; At this point, we want to get the billing provider data from the Institution file
"RTN","IBCEF79",281,0)
 ; IB*2.0*432 - Retrieve the BP name from "gold standard" name field of file #4 and if not populated, retrieve from .01 field - IA#2171
"RTN","IBCEF79",282,0)
 ;S IBXSAVE(SUB,"NAME")=$$GETFAC^IBCEP8(INST,0,0)
"RTN","IBCEF79",283,0)
 S IBXSAVE(SUB,"NAME")=$$BNIEN^XUAF4(INST)
"RTN","IBCEF79",284,0)
 S:IBXSAVE(SUB,"NAME")="" IBXSAVE(SUB,"NAME")=$$GETFAC^IBCEP8(INST,0,0)
"RTN","IBCEF79",285,0)
 S IBXSAVE(SUB,"ADDR1")=$$GETFAC^IBCEP8(INST,0,1)
"RTN","IBCEF79",286,0)
 S IBXSAVE(SUB,"ADDR2")=$$GETFAC^IBCEP8(INST,0,2)
"RTN","IBCEF79",287,0)
 S IBXSAVE(SUB,"CITY")=$$GETFAC^IBCEP8(INST,0,"3C")
"RTN","IBCEF79",288,0)
 S IBXSAVE(SUB,"ST")=$$GETFAC^IBCEP8(INST,0,"3S")
"RTN","IBCEF79",289,0)
 S IBXSAVE(SUB,"ZIP")=$$GETFAC^IBCEP8(INST,0,"3Z")
"RTN","IBCEF79",290,0)
 S IBXSAVE(SUB,"PHONE")=$$PRVPHONE^IBJPS3(IBIFN)        ; pay-to phone for claim
"RTN","IBCEF79",291,0)
 I SWBFLG,MAINPTP S IBXSAVE(SUB,"PHONE")=$P(BPTP,U,4)   ; switchback: pay-to phone for main division
"RTN","IBCEF79",292,0)
 ;
"RTN","IBCEF79",293,0)
 ; 3/30/09 - new requirement - for locally printed CMS-1500 claims, use the pay-to provider address information - Box 33
"RTN","IBCEF79",294,0)
 I 'SWBFLG,SUB="BOX33" D
"RTN","IBCEF79",295,0)
 . S IBZ=$$PRVDATA^IBJPS3(IBIFN)
"RTN","IBCEF79",296,0)
 . S IBXSAVE(SUB,"ADDR1")=$P(IBZ,U,5)
"RTN","IBCEF79",297,0)
 . S IBXSAVE(SUB,"ADDR2")=$P(IBZ,U,6)
"RTN","IBCEF79",298,0)
 . S IBXSAVE(SUB,"CITY")=$P(IBZ,U,7)
"RTN","IBCEF79",299,0)
 . S IBXSAVE(SUB,"ST")=$P(IBZ,U,8)
"RTN","IBCEF79",300,0)
 . S IBXSAVE(SUB,"ZIP")=$P(IBZ,U,9)
"RTN","IBCEF79",301,0)
 . Q
"RTN","IBCEF79",302,0)
 ;
"RTN","IBCEF79",303,0)
GETBPX ;
"RTN","IBCEF79",304,0)
 Q
"RTN","IBCEF79",305,0)
 ;
"RTN","IBCEF79",306,0)
SENDSF(IBIFN,COB) ; Send service facility information for the EDI claim?
"RTN","IBCEF79",307,0)
 ; Function value returns 1 (send service facility information) or 0 (don't send it)
"RTN","IBCEF79",308,0)
 ; The only time this function returns 0 is when the pre-patch 400 switchback flag is set, and
"RTN","IBCEF79",309,0)
 ; care was provided at the main division (VAMC) in the database, and the 36,4.07 ins. co. flag is set to NO.
"RTN","IBCEF79",310,0)
 ; This function is used in the EDI claim (segments SUB, SUB2, NPI-16, and NPI-17).
"RTN","IBCEF79",311,0)
 ; IBIFN required
"RTN","IBCEF79",312,0)
 ; COB optional, defaults to current payer sequence
"RTN","IBCEF79",313,0)
 NEW SEND,INSFLGS,IBDIV,MAIN
"RTN","IBCEF79",314,0)
 S SEND=1
"RTN","IBCEF79",315,0)
 I '$G(COB) S COB=$$COBN^IBCEF(IBIFN)       ; current payer sequence default
"RTN","IBCEF79",316,0)
 S INSFLGS=$$INSFLGS(IBIFN,COB)             ; all ins co flags
"RTN","IBCEF79",317,0)
 I +INSFLGS'>0 G SENDSFX                    ; switchback is OFF...get out
"RTN","IBCEF79",318,0)
 ;
"RTN","IBCEF79",319,0)
 I $P($G(^DGCR(399,IBIFN,"U2")),U,10) G SENDSFX    ; if we have a non-VA facility on the claim, always send it
"RTN","IBCEF79",320,0)
 ;
"RTN","IBCEF79",321,0)
 S IBDIV=+$P($G(^DGCR(399,IBIFN,0)),U,22)   ; division on claim
"RTN","IBCEF79",322,0)
 S MAIN=$$MAIN^IBCEP2B()                    ; main division in database
"RTN","IBCEF79",323,0)
 I IBDIV'=MAIN G SENDSFX                    ; care was not provided at the main division - always send it
"RTN","IBCEF79",324,0)
 ;
"RTN","IBCEF79",325,0)
 I $P(INSFLGS,U,2) G SENDSFX                ; ins. co. flag is ON so send it
"RTN","IBCEF79",326,0)
 ;
"RTN","IBCEF79",327,0)
 S SEND=0                                   ; otherwise, do not send service facility data
"RTN","IBCEF79",328,0)
 ;
"RTN","IBCEF79",329,0)
SENDSFX ;
"RTN","IBCEF79",330,0)
 Q SEND
"RTN","IBCEF79",331,0)
 ;
"RTN","IBCEF79",332,0)
SLPROV(IBXIEN,TYPE) ; return array of service line provider data
"RTN","IBCEF79",333,0)
 ; IBXIEN - ien in file 399
"RTN","IBCEF79",334,0)
 ; TYPE: O1 = operating physician, O2 = other operating physician, RE = rendering provider,
"RTN","IBCEF79",335,0)
 ;       P = purchase service provider, S = supervising provider, RF = referring provider
"RTN","IBCEF79",336,0)
 ;
"RTN","IBCEF79",337,0)
 ; returns IBXSAVE("SLPRV", counter) = last name ^ first name ^ middle name ^ suffix
"RTN","IBCEF79",338,0)
 ; ^ taxonomy code ^ primary id ^ secondary id (1) ^ secondary id qualifier (1) ^ ...
"RTN","IBCEF79",339,0)
 ; ^ secondary id (n) ^ secondary id qualifier (n)
"RTN","IBCEF79",340,0)
 ; IBXSAVE("SLPRV", counter,"SLC") = service line conter
"RTN","IBCEF79",341,0)
 ;
"RTN","IBCEF79",342,0)
 N DATA,IBN,IBX,IENS,MODE,NAME,PRNUM,PRTYPE,OUT,SLC,TMP,IBCNT
"RTN","IBCEF79",343,0)
 I '+IBXIEN Q
"RTN","IBCEF79",344,0)
 D ALLIDS^IBCEFP(IBXIEN,.IBX,1)
"RTN","IBCEF79",345,0)
 S IBCNT=0
"RTN","IBCEF79",346,0)
 ;
"RTN","IBCEF79",347,0)
 S SLC="" F  S SLC=$O(IBX("L-PROV",IBXIEN,SLC)) Q:'SLC  D
"RTN","IBCEF79",348,0)
 . I '$D(IBX("L-PROV",IBXIEN,SLC,"C",1,TYPE)) Q
"RTN","IBCEF79",349,0)
 .I TYPE="O1",PRTYPE'=2 Q                ; not operating
"RTN","IBCEF79",350,0)
 .I TYPE="O2",PRTYPE'=9 Q                ; not other operating
"RTN","IBCEF79",351,0)
 .I TYPE="RE",PRTYPE'=3 Q                ; not rendering
"RTN","IBCEF79",352,0)
 .I TYPE="S",PRTYPE'=5 Q                 ; not supervising
"RTN","IBCEF79",353,0)
 .I TYPE="RF",PRTYPE'=1 Q                ; not referring
"RTN","IBCEF79",354,0)
 .;
"RTN","IBCEF79",355,0)
 .S DATA=$G(IBX("L-PROV",IBXIEN,SLC,"C",1,PRTYPE))
"RTN","IBCEF79",356,0)
 .; name components
"RTN","IBCEF79",357,0)
 .S IENS=$P($P(DATA,U),";")_","
"RTN","IBCEF79",358,0)
 .I $P(DATA,U)["VA(200" S NAME=$$GET1^DIQ(200,IENS,.01)
"RTN","IBCEF79",359,0)
 .I $P(DATA,U)["IBA(355.93" S NAME=$$GET1^DIQ(355.93,IENS,.01)
"RTN","IBCEF79",360,0)
 .S TMP=$P(NAME,",",2),OUT=$P(NAME,",")_U_$P(TMP," ")_U_$P(TMP," ",2)_U_$P(TMP," ",3)
"RTN","IBCEF79",361,0)
 .; taxonomy code
"RTN","IBCEF79",362,0)
 .S $P(OUT,U,5)=$P($$GETTAX^IBCEF73A($P(DATA,U)),U)
"RTN","IBCEF79",363,0)
 .S IBN="" F  S IBN=$O(IBX("L-PROV",IBXIEN,SLC,"C",1,PRTYPE,IBN)) Q:IBN=""  D
"RTN","IBCEF79",364,0)
 ..S DATA=$G(IBX("L-PROV",IBXIEN,SLC,"C",1,PRTYPE,IBN))
"RTN","IBCEF79",365,0)
 ..; primary id
"RTN","IBCEF79",366,0)
 ..I IBN=0 S $P(OUT,U,6)=$P(DATA,U,4) Q
"RTN","IBCEF79",367,0)
 ..;
"RTN","IBCEF79",368,0)
 ..; secondary ids
"RTN","IBCEF79",369,0)
 ..S OUT=OUT_U_$P(DATA,U,4)_U_$P(DATA,U,3)
"RTN","IBCEF79",370,0)
 ..Q
"RTN","IBCEF79",371,0)
 .Q
"RTN","IBCEF79",372,0)
 S IBCNT=IBCNT+1
"RTN","IBCEF79",373,0)
 S IBXSAVE("SLPRV",IBCNT)=OUT
"RTN","IBCEF79",374,0)
 S IBXSAVE("SLPRV",IBCNT,"SLC")=SLC
"RTN","IBCEF79",375,0)
 Q
"RTN","IBCEF80")
0^94^B53774560^n/a
"RTN","IBCEF80",1,0)
IBCEF80 ;ALB/TAZ - Provider ID functions ;13 Feb 2006
"RTN","IBCEF80",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCEF80",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF80",4,0)
 ;
"RTN","IBCEF80",5,0)
 G AWAY
"RTN","IBCEF80",6,0)
AWAY Q
"RTN","IBCEF80",7,0)
 ;
"RTN","IBCEF80",8,0)
LPRV(IBIFN,IBXSAVE,IBSTRIP,SEG) ; Return array of Line Providers
"RTN","IBCEF80",9,0)
 N IBCARE,IBCURR,IBFRMTYP,IBINSCO,IBLIMIT,IBPRTYP,IBXIEN,IBXDATA,IBZ,Z,SLC,CPLNK
"RTN","IBCEF80",10,0)
 ;
"RTN","IBCEF80",11,0)
 I '$D(IBSTRIP) S IBSTRIP=0
"RTN","IBCEF80",12,0)
 I '$D(SEG) S SEG=""
"RTN","IBCEF80",13,0)
 S IBXIEN=IBIFN
"RTN","IBCEF80",14,0)
 S IBFRMTYP=$$FT^IBCEF(IBXIEN),IBFRMTYP=$S(IBFRMTYP=2:2,IBFRMTYP=3:1,1:0)
"RTN","IBCEF80",15,0)
 I 'IBFRMTYP G LPRVX
"RTN","IBCEF80",16,0)
 I IBFRMTYP=2 D OUTPT^IBCEF11(IBXIEN,0)
"RTN","IBCEF80",17,0)
 I IBFRMTYP=1 D HOS^IBCEF22(IBXIEN)
"RTN","IBCEF80",18,0)
 S IBCURR=$$COB^IBCEF(IBXIEN) ;current bill payer sequence
"RTN","IBCEF80",19,0)
 S SLC=0
"RTN","IBCEF80",20,0)
 F  S SLC=$O(IBXDATA(SLC)) Q:'SLC   S IBXSAVE("SLC")=+SLC D
"RTN","IBCEF80",21,0)
 . S CPLNK=$G(IBXDATA(SLC,"CPLNK")) I 'CPLNK Q
"RTN","IBCEF80",22,0)
 . K IBZ
"RTN","IBCEF80",23,0)
 . D PROVIDER(IBXIEN,CPLNK,"C",.IBZ,IBCURR),PROVIDER(IBXIEN,CPLNK,"O",.IBZ,IBCURR)
"RTN","IBCEF80",24,0)
 . M IBXSAVE("L-PROV",IBXIEN,SLC)=IBZ
"RTN","IBCEF80",25,0)
 D EN^IBCEF81(.IBXSAVE)
"RTN","IBCEF80",26,0)
 S SLC=0 F  S SLC=$O(IBXSAVE("L-PROV",IBXIEN,SLC)) Q:'SLC  D
"RTN","IBCEF80",27,0)
 . F Z="C","O" I '$O(IBXSAVE("L-PROV",IBXIEN,SLC,Z,"")) K IBXSAVE("L-PROV",IBXIEN,SLC,Z)
"RTN","IBCEF80",28,0)
 ;
"RTN","IBCEF80",29,0)
LPRVX ;Exit Line Provider Setup
"RTN","IBCEF80",30,0)
 Q
"RTN","IBCEF80",31,0)
 ;
"RTN","IBCEF80",32,0)
PROVIDER(IB399,IBCPIEN,IBPROV,IBRES,IBCURR) ;
"RTN","IBCEF80",33,0)
 N IBZ,IBRESARR
"RTN","IBCEF80",34,0)
 S IBRESARR=""
"RTN","IBCEF80",35,0)
 Q:IBPROV="A"  ;PATIENT's bill
"RTN","IBCEF80",36,0)
 I IBPROV="C" D
"RTN","IBCEF80",37,0)
 . D:$$ISINSUR^IBCEF71(IBCURR,IB399) PROVINF(IB399,$S(IBCURR="T":3,IBCURR="S":2,IBCURR="P":1,1:1),.IBRESARR,1,IBPROV,IBCPIEN)
"RTN","IBCEF80",38,0)
 I IBPROV="O" D
"RTN","IBCEF80",39,0)
 . I IBCURR="P" D:$$ISINSUR^IBCEF71("S",IB399) PROVINF(IB399,2,.IBRESARR,1,IBPROV,IBCPIEN) D:$$ISINSUR^IBCEF71("T",IB399) PROVINF(IB399,3,.IBRESARR,2,IBPROV,IBCPIEN)
"RTN","IBCEF80",40,0)
 . I IBCURR="S" D:$$ISINSUR^IBCEF71("P",IB399) PROVINF(IB399,1,.IBRESARR,1,IBPROV,IBCPIEN) D:$$ISINSUR^IBCEF71("T",IB399) PROVINF(IB399,3,.IBRESARR,2,IBPROV,IBCPIEN)
"RTN","IBCEF80",41,0)
 . I IBCURR="T" D:$$ISINSUR^IBCEF71("P",IB399) PROVINF(IB399,1,.IBRESARR,1,IBPROV,IBCPIEN) D:$$ISINSUR^IBCEF71("S",IB399) PROVINF(IB399,2,.IBRESARR,2,IBPROV,IBCPIEN)
"RTN","IBCEF80",42,0)
 M IBRES(IBPROV)=IBRESARR
"RTN","IBCEF80",43,0)
 Q
"RTN","IBCEF80",44,0)
 ;
"RTN","IBCEF80",45,0)
  ;-- PROVINF --
"RTN","IBCEF80",46,0)
 ;Create array with prov info
"RTN","IBCEF80",47,0)
 ;Input:
"RTN","IBCEF80",48,0)
 ; IB399 - ien #399
"RTN","IBCEF80",49,0)
 ; IBPRNUM - 1=prim ins, 2= sec, 3 -tert
"RTN","IBCEF80",50,0)
 ; IBRES - for results (IBRESARR passed by reference)
"RTN","IBCEF80",51,0)
 ; IBSORT - to sort OTHER INSURANCE data 
"RTN","IBCEF80",52,0)
 ;  if PROVINF is called for "C" mode of PROVIDER subroutine then 
"RTN","IBCEF80",53,0)
 ;    IBSORT can be any (say 1)
"RTN","IBCEF80",54,0)
 ;  if PROVINF is called for "O" mode then can be more than set of data
"RTN","IBCEF80",55,0)
 ;    - need to sort array to use it (like IBXDATA(1) and IBXDATA(2))
"RTN","IBCEF80",56,0)
 ;    for mode "O" it should be 1 or 2 (see PROVIDER section)
"RTN","IBCEF80",57,0)
 ;IBINSTP -  "C" -current ins, "O"-other
"RTN","IBCEF80",58,0)
 ;IBCPPTR - Pointer to the Procedure Global
"RTN","IBCEF80",59,0)
 ;Output:
"RTN","IBCEF80",60,0)
 ; IBRES(PRNUM,PRTYPE,SEQ#)=PROV^INSUR^IDTYPE^ID^FORMTYP^CARETYP
"RTN","IBCEF80",61,0)
 ; where:(see PROVIDER)
"RTN","IBCEF80",62,0)
PROVINF(IB399,IBPRNUM,IBRES,IBSORT,IBINSTP,IBCPPTR) ;
"RTN","IBCEF80",63,0)
 I $G(IB399)="" Q
"RTN","IBCEF80",64,0)
 I +$G(IBSORT)=0 S IBSORT=$G(IBPRNUM)
"RTN","IBCEF80",65,0)
 N IBPRTYP,IBINSCO,IBPRVPTR,IBCARE,IB35591,IBN,IBCURR,IBEXC,IBALLSSN,IBSSNIEN,IBLIMIT,IBSSN,I
"RTN","IBCEF80",66,0)
 S IBN=0
"RTN","IBCEF80",67,0)
 S IBINSCO=+$P($G(^DGCR(399,IB399,"M")),"^",IBPRNUM) ;Current insurance company ien
"RTN","IBCEF80",68,0)
 S IBCARE=$S($$ISRX^IBCEF1(IB399):3,1:0) ;if an Rx refill bill
"RTN","IBCEF80",69,0)
 S:IBCARE=0 IBCARE=$$INPAT^IBCEF(IB399,1) S:'IBCARE IBCARE=2 ;1-inp,2-out
"RTN","IBCEF80",70,0)
 S IBLIMIT=$S($G(IBINSTP)="C":5,1:3)  ; Limits on secondary IDs
"RTN","IBCEF80",71,0)
 S IBCURR=$$COB^IBCEF(IB399) ; current insurance company position (P,S,T)
"RTN","IBCEF80",72,0)
 F IBPRTYP=1:1:9 D
"RTN","IBCEF80",73,0)
 . N Z,IB355OV,IBNPI,IBSSN,IBTAXID
"RTN","IBCEF80",74,0)
 . S IBPRVPTR=$$PROVPTR(IB399,IBPRTYP,IBCPPTR) Q:'+IBPRVPTR
"RTN","IBCEF80",75,0)
 . S $P(IBSSN,U,IBPRTYP)=$$GETSSN^IBCEF72(IBPRVPTR) I '$P(IBSSN,U,IBPRTYP)="" S $P(IBSSN,U,IBPRTYP)=$$TAX3559^IBCEF73(IBPRVPTR)
"RTN","IBCEF80",76,0)
 . N IBRETARR S IBRETARR=0
"RTN","IBCEF80",77,0)
 . ;params: ins co ien, form type, inpt/outpt/rx, prov ptr, return array, provider type, Current/Other
"RTN","IBCEF80",78,0)
 . D PRACT^IBCEF71(IBINSCO,IBFRMTYP,IBCARE,IBPRVPTR,.IBRETARR,IBPRTYP,$G(IBINSTP))
"RTN","IBCEF80",79,0)
 . S IB355OV="",IBEXC=""
"RTN","IBCEF80",80,0)
 . S Z=$O(^DGCR(399,IB399,"CP",IBCPPTR,"LNPRV","B",IBPRTYP,0))
"RTN","IBCEF80",81,0)
 . I Z S Z=$G(^DGCR(399,IB399,"CP",IBCPPTR,"LNPRV",Z,0)) D
"RTN","IBCEF80",82,0)
 .. I $P(Z,U,IBPRNUM+4)'="",$P(Z,U,IBPRNUM+11)'="" S IB355OV=$P(Z,U,IBPRNUM+4)_U_$P(Z,U,IBPRNUM+11)
"RTN","IBCEF80",83,0)
 . S IBN=0,IB35591=$$CH35591^IBCEF72(IBINSCO,IBFRMTYP,IBCARE)
"RTN","IBCEF80",84,0)
 . I $G(IBINSTP)="C",$G(IBPRNUM)=1,"34"[$G(IBPRTYP),"P"[$G(IBCURR),$G(IBFRMTYP)=2,$$MCRONBIL^IBEFUNC(IB399) S IB355OV=$$MCR24K^IBCEU3(IB399)_"^12"
"RTN","IBCEF80",85,0)
 . I $G(IBINSTP)="O","34"[$G(IBPRTYP),"ST"[$G(IBCURR),$G(IBFRMTYP)=2,$$MCRONBIL^IBEFUNC(IB399) S IB355OV=$$MCR24K^IBCEU3(IB399)_"^12" ;Calculate MEDICARE (WNR) specific provider qualifier and ID for CMS-1500 secondary claims
"RTN","IBCEF80",86,0)
 . I $P(IB355OV,U,2) D
"RTN","IBCEF80",87,0)
 .. ;params: form type, provider type, current/other
"RTN","IBCEF80",88,0)
 .. I $$CHCKSEC^IBCEF73(IBFRMTYP,IBPRTYP,$G(IBINSTP),$P($G(^IBE(355.97,+$P(IB355OV,U,2),0)),U,3)) D
"RTN","IBCEF80",89,0)
 ... S IBEXC=$P(IB355OV,U,2),IBN=IBN+1,IBRES(IBSORT,IBPRTYP,IBN)="OVERRIDE^"_IBINSCO_U_$P($G(^IBE(355.97,+IBEXC,0)),U,3)_U_$P(IB355OV,U)_"^^^^^"_+IBEXC
"RTN","IBCEF80",90,0)
 . I IB35591'="",IBEXC'=$P(IB35591,U,3) S:$$CHCKSEC^IBCEF73(IBFRMTYP,IBPRTYP,$G(IBINSTP),$P(IB35591,"^")) IBN=IBN+1,IBRES(IBSORT,IBPRTYP,IBN)="DEFAULT^"_IBINSCO_"^"_IB35591_"^^",$P(IBRES(IBSORT,IBPRTYP,IBN),U,9)=$P(IB35591,U,3)
"RTN","IBCEF80",91,0)
 . D SORT(IBSORT,IBPRTYP,IB399,.IBRETARR,.IBRES,IBN,IBEXC,IBPRNUM,IBLIMIT,IBSSN,IBCPPTR)
"RTN","IBCEF80",92,0)
 . S IBRES(IBSORT,IBPRTYP)=IBPRVPTR
"RTN","IBCEF80",93,0)
 . S IBNPI=$$GETNPI^IBCEF73A(IBPRVPTR)
"RTN","IBCEF80",94,0)
 . S IBRES(IBSORT,IBPRTYP,0)="PRIMARY"_U_U_$$STRIP^IBCEF76($S(IBNPI]"":"XX",1:"")_U_IBNPI,1,U,IBSTRIP)
"RTN","IBCEF80",95,0)
 . F I=1:1 Q:'$D(IBRES(IBSORT,IBPRTYP,I))  D
"RTN","IBCEF80",96,0)
 .. S $P(IBRES(IBSORT,IBPRTYP,I),U,3,4)=$$STRIP^IBCEF76($P(IBRES(IBSORT,IBPRTYP,I),U,3,4),1,U,IBSTRIP)
"RTN","IBCEF80",97,0)
 I $O(IBRES(IBSORT,"")) S IBRES(IBSORT)=$S(IBPRNUM=3:"T",IBPRNUM=2:"S",1:"P")
"RTN","IBCEF80",98,0)
 Q
"RTN","IBCEF80",99,0)
 ;
"RTN","IBCEF80",100,0)
PROVPTR(IBIEN399,IBFUNC,IBCP) ;
"RTN","IBCEF80",101,0)
 N IBN
"RTN","IBCEF80",102,0)
 S IBN=$O(^DGCR(399,IBIEN399,"CP",IBCP,"LNPRV","B",IBFUNC,0))
"RTN","IBCEF80",103,0)
 I +IBN=0 Q 0
"RTN","IBCEF80",104,0)
 Q $P($G(^DGCR(399,IBIEN399,"CP",IBCP,"LNPRV",+IBN,0)),U,2)
"RTN","IBCEF80",105,0)
 ;
"RTN","IBCEF80",106,0)
 ;SORT
"RTN","IBCEF80",107,0)
 ; Input
"RTN","IBCEF80",108,0)
 ;  IBPRNUM - 1 or 2
"RTN","IBCEF80",109,0)
 ;  IBPRTYP - Provide Type
"RTN","IBCEF80",110,0)
 ;  IB399   - IEN of Bill/Claim file
"RTN","IBCEF80",111,0)
 ;  IBSRC   - Source Array - IBRETARR passed by reference
"RTN","IBCEF80",112,0)
 ;  IBDST   - Destination Array - IBRES passed by reference
"RTN","IBCEF80",113,0)
 ;  IBN     - 
"RTN","IBCEF80",114,0)
 ;  IBEXC   - Override the ID
"RTN","IBCEF80",115,0)
 ;  IBSEQ   - 
"RTN","IBCEF80",116,0)
 ;  IBLIMIT - Limits on secondary ID's
"RTN","IBCEF80",117,0)
 ;  IBZ     - String containing SSN/EIN for the line providers
"RTN","IBCEF80",118,0)
 ;  IBCPPTR - Pointer to the Procedure Global
"RTN","IBCEF80",119,0)
SORT(IBPRNUM,IBPRTYP,IB399,IBSRC,IBDST,IBN,IBEXC,IBSEQ,IBLIMIT,IBZ,IBCPPTR) ;
"RTN","IBCEF80",120,0)
 N IBXIEN,IBXDATA,IBNET,IBTRI,IB1,IB2,IBID,Z,IBZ1,IBSVP
"RTN","IBCEF80",121,0)
 S (IB1,IB2,IBZ1,IBTRI)=""
"RTN","IBCEF80",122,0)
 ;IBZ1=All policy types on Bill
"RTN","IBCEF80",123,0)
 S IBZ1=$$ALLPTYP^IBCEF3(IB399)
"RTN","IBCEF80",124,0)
 F Z=1:1:3 S $P(IBZ1,U,Z)=$S($P(IBZ1,U,Z)="CH":1,1:"") S:$P(IBZ1,U,Z) IBTRI=1
"RTN","IBCEF80",125,0)
 S IBNET=$$NETID^IBCEP() ; netwrk id type
"RTN","IBCEF80",126,0)
 I $G(IBN) D
"RTN","IBCEF80",127,0)
 . S Z=0 F  S Z=$O(IBDST(IBPRNUM,IBPRTYP,Z)) Q:'Z  S IBID(+$P(IBDST(IBPRNUM,IBPRTYP,Z),U,9))=""
"RTN","IBCEF80",128,0)
 F  S IB1=$O(IBSRC(IB1)) Q:IB1=""  D  Q:IBN=IBLIMIT
"RTN","IBCEF80",129,0)
 . N OK,IBSTLIC
"RTN","IBCEF80",130,0)
 . S IBSTLIC=""
"RTN","IBCEF80",131,0)
 . F  S IB2=$O(IBSRC(IB1,IB2)) Q:IB2=""  D  Q:IBN=IBLIMIT
"RTN","IBCEF80",132,0)
 . . S IBSVP=$P(IBSRC(IB1,IB2),U)
"RTN","IBCEF80",133,0)
 . . ; If ID overridden, output no others of this type
"RTN","IBCEF80",134,0)
 . . I $G(IBEXC),$P($G(IBSRC(IB1,IB2)),U,9)=IBEXC Q
"RTN","IBCEF80",135,0)
 . . ; Ck state of care/lic match if st lic#
"RTN","IBCEF80",136,0)
 . . I $P($G(IBSRC(IB1,IB2)),U,3)="0B" S OK=1 D  Q:'OK
"RTN","IBCEF80",137,0)
 . . . I +$$CAREST^IBCEP2A(IB399)'=$P(IBSRC(IB1,IB2),U,7) S IBSTLIC=1 Q
"RTN","IBCEF80",138,0)
 . . . I $G(IBSTLIC(0))'="" S OK=0 Q
"RTN","IBCEF80",139,0)
 . . . S IBSTLIC(0)=$G(IBSRC(IB1,IB2)),OK=0
"RTN","IBCEF80",140,0)
 . . ; Exclude SSN from sec ids unless required
"RTN","IBCEF80",141,0)
 . . I $P($G(IBSRC(IB1,IB2)),U,3)="SY" Q
"RTN","IBCEF80",142,0)
 . . ; Only 1 of each prov id type
"RTN","IBCEF80",143,0)
 . . Q:$D(IBID(+$P($G(IBSRC(IB1,IB2)),U,9)))
"RTN","IBCEF80",144,0)
 . . S IBN=IBN+1,IBID(+$P($G(IBSRC(IB1,IB2)),U,9))=""
"RTN","IBCEF80",145,0)
 . . S IBDST(IBPRNUM,IBPRTYP,IBN)=$G(IBSRC(IB1,IB2))
"RTN","IBCEF80",146,0)
 . I IBN'=IBLIMIT,'$G(IBSTLIC),$G(IBSTLIC(0))'="" S IBN=IBN+1,IBDST(IBPRNUM,IBPRTYP,IBN)=IBSTLIC(0)
"RTN","IBCEF80",147,0)
 I $$FT^IBCEF(IB399)=2,$G(IBID(IBNET))="",IBTRI,$P(IBZ1,U,IBSEQ) D    ; WCJ 02/13/2006
"RTN","IBCEF80",148,0)
 . Q:$P(IBZ,U,IBPRTYP)=""
"RTN","IBCEF80",149,0)
 . ; here, no network id & TRICARE ins co.
"RTN","IBCEF80",150,0)
 . N Z
"RTN","IBCEF80",151,0)
 . S Z=+$O(^DGCR(399,IB399,"CP",IBCPPTR,"LNPRV","B",IBPRTYP,0)),Z=$P($G(^DGCR(399,IB399,"CP",IBCPPTR,"LNPRV",Z,0)),U,2)
"RTN","IBCEF80",152,0)
 . S IBN=IBN+1,IBDST(IBPRNUM,IBPRTYP,IBN)=Z_U_+$$POLICY^IBCEF(IB399,1,IBSEQ)_U_$P($G(^IBE(355.97,IBNET,0)),U,3)_U_$P(IBZ,U,IBPRTYP)_U_"0^0^^^"_IBNET
"RTN","IBCEF80",153,0)
 Q
"RTN","IBCEF81")
0^79^B105842498^n/a
"RTN","IBCEF81",1,0)
IBCEF81 ;ALB/BI - PROVIDER ADJUSTMENTS ;11-OCT-2010
"RTN","IBCEF81",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCEF81",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF81",4,0)
 ;
"RTN","IBCEF81",5,0)
 Q
"RTN","IBCEF81",6,0)
 ;
"RTN","IBCEF81",7,0)
EN(INPUT)    ; FIRST ENTRY POINT
"RTN","IBCEF81",8,0)
 N INSLEVEL,PRTYPE,OUTPUT,IBIEN,CMODE,CPRNUM,STATUS
"RTN","IBCEF81",9,0)
 S STATUS=1
"RTN","IBCEF81",10,0)
 I $D(INPUT)=0 S STATUS=0 Q STATUS
"RTN","IBCEF81",11,0)
 I (($G(IBXFORM)=2)!($G(IBXFORM)=3)) D EN^IBCEF82(.INPUT) Q STATUS    ; PERFORM LOCAL PRINT BUSINESS RULES
"RTN","IBCEF81",12,0)
 K OUTPUT M OUTPUT=INPUT
"RTN","IBCEF81",13,0)
 D CINIT1 Q:IBIEN="" STATUS
"RTN","IBCEF81",14,0)
 F INSLEVEL="P","S","T" D    ; P=PRIMARY, S=SECONDARY, T=TERTIARY
"RTN","IBCEF81",15,0)
 . D CINIT2
"RTN","IBCEF81",16,0)
 . F PRTYPE=1,2,3,5,9 D    ; 1=REFERRING, 2=OPERATING, 3=RENDERING, 5=SUPERVISING, 9=OTHER OPERATING
"RTN","IBCEF81",17,0)
 .. D START(INSLEVEL,PRTYPE,.OUTPUT)
"RTN","IBCEF81",18,0)
 K INPUT M INPUT=OUTPUT
"RTN","IBCEF81",19,0)
 Q STATUS
"RTN","IBCEF81",20,0)
START(INSLEVEL,PRTYPE,OUTPUT)     ; START PROCESSING
"RTN","IBCEF81",21,0)
 N INTERM,PROVINFO,MAXAINFO
"RTN","IBCEF81",22,0)
 S INTERM="A"
"RTN","IBCEF81",23,0)
 S INTERM=INTERM_$$TEST1    ; Does Claim Level Provider Exist, 0=NO, 1=YES
"RTN","IBCEF81",24,0)
 S INTERM=INTERM_$$TEST2    ; All procedures have a line level provider, 0=NO, 1=YES
"RTN","IBCEF81",25,0)
 S INTERM=INTERM_$$TEST3    ; One Line Level provider is most significant, 0=NO, 1=YES
"RTN","IBCEF81",26,0)
 S INTERM=INTERM_$$TEST4    ; At least one line level provider matches the claim level provider, 0=NO, 1=YES
"RTN","IBCEF81",27,0)
 S INTERM=INTERM_$$TEST5    ; There is only one procedure without a line level provider, 0=NO, 1=YES
"RTN","IBCEF81",28,0)
 D @INTERM
"RTN","IBCEF81",29,0)
 Q 
"RTN","IBCEF81",30,0)
 ;
"RTN","IBCEF81",31,0)
TEST1() ; Does Claim Level Provider Exist, 0=NO, 1=YES
"RTN","IBCEF81",32,0)
 N PROVX,PROVY
"RTN","IBCEF81",33,0)
 I $D(CMODE(INSLEVEL))#10=0 Q 0
"RTN","IBCEF81",34,0)
 I $D(CPRNUM(INSLEVEL))#10=0 Q 0
"RTN","IBCEF81",35,0)
 S (PROVX,PROVY)=$G(INPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)) Q:PROVX="" 0
"RTN","IBCEF81",36,0)
 S PROVX="^"_$P(PROVX,";",2)_$P(PROVX,";",1)_")"
"RTN","IBCEF81",37,0)
 I $D(@PROVX) D  Q 1    ;CLAIM PROVIDER EXISTS, RETURN TRUE.
"RTN","IBCEF81",38,0)
 . ; LOAD CLAIM LEVEL PROVIDER INFORMATION
"RTN","IBCEF81",39,0)
 . S PROVINFO=PROVY
"RTN","IBCEF81",40,0)
 . S PROVINFO("PROVINF",IBIEN)=IBIEN
"RTN","IBCEF81",41,0)
 . S PROVINFO("PROVINF",IBIEN,CMODE(INSLEVEL))=""
"RTN","IBCEF81",42,0)
 . S PROVINFO("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL))=INSLEVEL
"RTN","IBCEF81",43,0)
 . M PROVINFO("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)=INPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)
"RTN","IBCEF81",44,0)
 Q 0
"RTN","IBCEF81",45,0)
 ;
"RTN","IBCEF81",46,0)
TEST2() ; All procedures have a line level provider, 0=NO, 1=YES
"RTN","IBCEF81",47,0)
 N SLC,RESULT,LMODE,LPRNUM,PROVX,LINECNT
"RTN","IBCEF81",48,0)
 S SLC=0,RESULT=1,LINECNT=0
"RTN","IBCEF81",49,0)
 F  S SLC=$$LINIT1(SLC) Q:+SLC=0  D
"RTN","IBCEF81",50,0)
 . S LINECNT=LINECNT+1
"RTN","IBCEF81",51,0)
 . D LINIT2
"RTN","IBCEF81",52,0)
 . I $D(LMODE(INSLEVEL))#10=0 S RESULT=0 Q
"RTN","IBCEF81",53,0)
 . I $D(LPRNUM(INSLEVEL))#10=0 S RESULT=0 Q
"RTN","IBCEF81",54,0)
 . S PROVX=$G(INPUT("L-PROV",IBIEN,SLC,LMODE(INSLEVEL),LPRNUM(INSLEVEL),PRTYPE))
"RTN","IBCEF81",55,0)
 . I PROVX="" D  Q
"RTN","IBCEF81",56,0)
 .. S RESULT=RESULT*0
"RTN","IBCEF81",57,0)
 . S PROVX="^"_$P(PROVX,";",2)_$P(PROVX,";",1)_")"
"RTN","IBCEF81",58,0)
 . S RESULT=RESULT*($D(@PROVX)'=0)
"RTN","IBCEF81",59,0)
 I +$G(INPUT("SLC"))'=0,INPUT("SLC")>LINECNT S RESULT=0
"RTN","IBCEF81",60,0)
 Q RESULT
"RTN","IBCEF81",61,0)
 ;
"RTN","IBCEF81",62,0)
TEST3() ; One Line Level provider is most significant, 0=NO, 1=YES
"RTN","IBCEF81",63,0)
 N SLC,RESULT,LMODE,LPRNUM,PCOUNT,PCOUNTF,PCOUNTL,PROVX,TEMPNODE
"RTN","IBCEF81",64,0)
 S SLC=0,RESULT=0
"RTN","IBCEF81",65,0)
 F  S SLC=$$LINIT1(SLC) Q:+SLC=0  D
"RTN","IBCEF81",66,0)
 . D LINIT2
"RTN","IBCEF81",67,0)
 . I $D(LMODE(INSLEVEL))#10=0 Q
"RTN","IBCEF81",68,0)
 . I $D(LPRNUM(INSLEVEL))#10=0 Q
"RTN","IBCEF81",69,0)
 . S PROVX=$G(INPUT("L-PROV",IBIEN,SLC,LMODE(INSLEVEL),LPRNUM(INSLEVEL),PRTYPE)) Q:PROVX=""
"RTN","IBCEF81",70,0)
 . S PCOUNT(PROVX)=$P($G(PCOUNT(PROVX)),"^",1)+1_"^"_SLC_"^"_LMODE(INSLEVEL)_"^"_LPRNUM(INSLEVEL)_"^"_PRTYPE
"RTN","IBCEF81",71,0)
 S PROVX="" F  S PROVX=$O(PCOUNT(PROVX)) Q:PROVX=""  D
"RTN","IBCEF81",72,0)
 . S PCOUNTF($P(PCOUNT(PROVX),"^",1),PROVX)=$P(PCOUNT(PROVX),"^",2,5)
"RTN","IBCEF81",73,0)
 S PCOUNTL(1)=$O(PCOUNTF(""),-1) Q:PCOUNTL(1)="" RESULT
"RTN","IBCEF81",74,0)
 S PCOUNTL(2,1)=$O(PCOUNTF(PCOUNTL(1),""),-1) Q:PCOUNTL(2,1)="" RESULT
"RTN","IBCEF81",75,0)
 S PCOUNTL(2,2)=$O(PCOUNTF(PCOUNTL(1),PCOUNTL(2,1)),-1)
"RTN","IBCEF81",76,0)
 I PCOUNTL(2,2)="" D
"RTN","IBCEF81",77,0)
 . S RESULT=1
"RTN","IBCEF81",78,0)
 . ; LOAD MOST SIGNIFICANT LINE LEVEL PROVIDER INFORMATION
"RTN","IBCEF81",79,0)
 . S MAXAINFO=PCOUNTL(2,1)
"RTN","IBCEF81",80,0)
 . S TEMPNODE=PCOUNTF(PCOUNTL(1),PCOUNTL(2,1))
"RTN","IBCEF81",81,0)
 . S MAXAINFO("L-PROV",IBIEN)=IBIEN
"RTN","IBCEF81",82,0)
 . S MAXAINFO("L-PROV",IBIEN,$P(TEMPNODE,"^",2),$P(TEMPNODE,"^",3))=INSLEVEL
"RTN","IBCEF81",83,0)
 . M MAXAINFO("L-PROV",IBIEN,$P(TEMPNODE,"^",2),$P(TEMPNODE,"^",3),$P(TEMPNODE,"^",4))=INPUT("L-PROV",IBIEN,$P(TEMPNODE,"^",1),$P(TEMPNODE,"^",2),$P(TEMPNODE,"^",3),$P(TEMPNODE,"^",4))
"RTN","IBCEF81",84,0)
 Q RESULT
"RTN","IBCEF81",85,0)
 ;
"RTN","IBCEF81",86,0)
TEST4() ; At least one line level provider matches the claim level provider, 0=NO, 1=YES
"RTN","IBCEF81",87,0)
 N CPROV,RESULT,LMODE,LPRNUM,LPROV,SLC
"RTN","IBCEF81",88,0)
 I $D(CMODE(INSLEVEL))#10=0 Q 0
"RTN","IBCEF81",89,0)
 I $D(CPRNUM(INSLEVEL))#10=0 Q 0
"RTN","IBCEF81",90,0)
 S CPROV=$G(INPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)) Q:CPROV="" 0
"RTN","IBCEF81",91,0)
 S SLC=0,RESULT=0
"RTN","IBCEF81",92,0)
 F  S SLC=$$LINIT1(SLC) Q:+SLC=0  D
"RTN","IBCEF81",93,0)
 . D LINIT2
"RTN","IBCEF81",94,0)
 . I $D(LMODE(INSLEVEL))#10=0 Q
"RTN","IBCEF81",95,0)
 . I $D(LPRNUM(INSLEVEL))#10=0 Q
"RTN","IBCEF81",96,0)
 . S LPROV=$G(INPUT("L-PROV",IBIEN,SLC,LMODE(INSLEVEL),LPRNUM(INSLEVEL),PRTYPE))  Q:LPROV=""
"RTN","IBCEF81",97,0)
 . I LPROV=CPROV S RESULT=1
"RTN","IBCEF81",98,0)
 Q RESULT
"RTN","IBCEF81",99,0)
 ;
"RTN","IBCEF81",100,0)
TEST5() ; There is only one procedure without a line level provider, 0=NO, 1=YES
"RTN","IBCEF81",101,0)
 N SLC,LMODE,LPRNUM,PROVCNT,RESULT
"RTN","IBCEF81",102,0)
 S SLC=0,PROVCNT=0,RESULT=0
"RTN","IBCEF81",103,0)
 F  S SLC=$$LINIT1(SLC) Q:+SLC=0  D
"RTN","IBCEF81",104,0)
 . D LINIT2
"RTN","IBCEF81",105,0)
 . I $D(LMODE(INSLEVEL))#10=0 Q
"RTN","IBCEF81",106,0)
 . I $D(LPRNUM(INSLEVEL))#10=0 Q
"RTN","IBCEF81",107,0)
 . S PROVX=$G(INPUT("L-PROV",IBIEN,SLC,LMODE(INSLEVEL),LPRNUM(INSLEVEL),PRTYPE))
"RTN","IBCEF81",108,0)
 . S:PROVX'="" PROVCNT=PROVCNT+1
"RTN","IBCEF81",109,0)
 I +$G(INPUT("SLC"))'=0,INPUT("SLC")=(PROVCNT+1) S RESULT=1
"RTN","IBCEF81",110,0)
 Q RESULT
"RTN","IBCEF81",111,0)
 ;
"RTN","IBCEF81",112,0)
A00000     ;  Case 1
"RTN","IBCEF81",113,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF81",114,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",115,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF81",116,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",117,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",118,0)
 ;
"RTN","IBCEF81",119,0)
 ; ACTIONS: Transmit as is.
"RTN","IBCEF81",120,0)
 ;
"RTN","IBCEF81",121,0)
 Q
"RTN","IBCEF81",122,0)
 ;
"RTN","IBCEF81",123,0)
A00001     ;  Case 2
"RTN","IBCEF81",124,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF81",125,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",126,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF81",127,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",128,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF81",129,0)
 ;
"RTN","IBCEF81",130,0)
 ; ACTIONS: Transmit as is.
"RTN","IBCEF81",131,0)
 ;
"RTN","IBCEF81",132,0)
 Q
"RTN","IBCEF81",133,0)
 ;
"RTN","IBCEF81",134,0)
A00010     ;  Case 3 - This case can never happen!
"RTN","IBCEF81",135,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",136,0)
 Q
"RTN","IBCEF81",137,0)
 ;
"RTN","IBCEF81",138,0)
A00011     ;  Case 4 - This case can never happen!
"RTN","IBCEF81",139,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",140,0)
 Q
"RTN","IBCEF81",141,0)
 ;
"RTN","IBCEF81",142,0)
A00100     ;  Case 5
"RTN","IBCEF81",143,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF81",144,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",145,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF81",146,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",147,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",148,0)
 ;
"RTN","IBCEF81",149,0)
 ; ACTIONS: Transmit as is.
"RTN","IBCEF81",150,0)
 ;
"RTN","IBCEF81",151,0)
 Q
"RTN","IBCEF81",152,0)
 ;
"RTN","IBCEF81",153,0)
A00101     ;  Case 6
"RTN","IBCEF81",154,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF81",155,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",156,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF81",157,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",158,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF81",159,0)
 ;
"RTN","IBCEF81",160,0)
 ; ACTIONS: Transmit as is.
"RTN","IBCEF81",161,0)
 ;
"RTN","IBCEF81",162,0)
 Q
"RTN","IBCEF81",163,0)
 ;
"RTN","IBCEF81",164,0)
A00110     ;  Case 7 - This case can never happen!
"RTN","IBCEF81",165,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",166,0)
 Q
"RTN","IBCEF81",167,0)
 ;
"RTN","IBCEF81",168,0)
A00111     ;  Case 8 - This case can never happen!
"RTN","IBCEF81",169,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",170,0)
 Q
"RTN","IBCEF81",171,0)
 ;
"RTN","IBCEF81",172,0)
A01000     ;  Case 9
"RTN","IBCEF81",173,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF81",174,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF81",175,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF81",176,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",177,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",178,0)
 ;
"RTN","IBCEF81",179,0)
 ; ACTIONS: Transmit as is.
"RTN","IBCEF81",180,0)
 ;
"RTN","IBCEF81",181,0)
 Q
"RTN","IBCEF81",182,0)
 ;
"RTN","IBCEF81",183,0)
A01001     ; Case 10 - This case can never happen!
"RTN","IBCEF81",184,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",185,0)
 Q
"RTN","IBCEF81",186,0)
 ;
"RTN","IBCEF81",187,0)
A01010     ; Case 11 - This case can never happen!
"RTN","IBCEF81",188,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",189,0)
 Q
"RTN","IBCEF81",190,0)
 ;
"RTN","IBCEF81",191,0)
A01011     ; Case 12 - This case can never happen!
"RTN","IBCEF81",192,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",193,0)
 Q
"RTN","IBCEF81",194,0)
 ;
"RTN","IBCEF81",195,0)
A01100     ; Case 13
"RTN","IBCEF81",196,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF81",197,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF81",198,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF81",199,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",200,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",201,0)
 ;
"RTN","IBCEF81",202,0)
 ; ACTIONS: 1. Take the most frequently used line level provider and
"RTN","IBCEF81",203,0)
 ;             make that provider the claim level provider.
"RTN","IBCEF81",204,0)
 ;          2. Remove the new claim level provider from the lines where
"RTN","IBCEF81",205,0)
 ;             they are listed as provider.
"RTN","IBCEF81",206,0)
 ;
"RTN","IBCEF81",207,0)
 ; Set the claim level provider equal to the most significant line level provider.
"RTN","IBCEF81",208,0)
 I $G(MAXAINFO)="" Q
"RTN","IBCEF81",209,0)
 M OUTPUT("PROVINF",IBIEN)=MAXAINFO("L-PROV",IBIEN)
"RTN","IBCEF81",210,0)
 ;
"RTN","IBCEF81",211,0)
 ; Remove the claim lines associated with the primary provider.
"RTN","IBCEF81",212,0)
 S PROVINFO=MAXAINFO
"RTN","IBCEF81",213,0)
 D REMOVELN
"RTN","IBCEF81",214,0)
 ;
"RTN","IBCEF81",215,0)
 Q
"RTN","IBCEF81",216,0)
 ;
"RTN","IBCEF81",217,0)
A01101     ; Case 14 - This case can never happen!
"RTN","IBCEF81",218,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",219,0)
 Q
"RTN","IBCEF81",220,0)
 ;
"RTN","IBCEF81",221,0)
A01110     ; Case 15 - This case can never happen!
"RTN","IBCEF81",222,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",223,0)
 Q
"RTN","IBCEF81",224,0)
 ;
"RTN","IBCEF81",225,0)
A01111     ; Case 16 - This case can never happen!
"RTN","IBCEF81",226,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",227,0)
 Q
"RTN","IBCEF81",228,0)
 ;
"RTN","IBCEF81",229,0)
A10000    ; Case 17
"RTN","IBCEF81",230,0)
 ;                            TESTS: Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",231,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",232,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF81",233,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",234,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",235,0)
 ;
"RTN","IBCEF81",236,0)
 ; ACTIONS: Transmit as is.
"RTN","IBCEF81",237,0)
 ;
"RTN","IBCEF81",238,0)
 Q
"RTN","IBCEF81",239,0)
 ;
"RTN","IBCEF81",240,0)
A10001    ; Case 18
"RTN","IBCEF81",241,0)
 ;                            TESTS: Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",242,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",243,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF81",244,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",245,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF81",246,0)
 ;
"RTN","IBCEF81",247,0)
 ; Don't perform this action for a single line claim.
"RTN","IBCEF81",248,0)
 I $G(INPUT("SLC"))=1 Q
"RTN","IBCEF81",249,0)
 ;
"RTN","IBCEF81",250,0)
 ; Determine Line with Missing Provider.
"RTN","IBCEF81",251,0)
 N SLC
"RTN","IBCEF81",252,0)
 S SLC=0 F  S SLC=$O(^DGCR(399,IBIEN,"RC",SLC)) Q:+SLC=0  D
"RTN","IBCEF81",253,0)
 . I $D(INPUT("L-PROV",IBIEN,SLC))=0 D
"RTN","IBCEF81",254,0)
 .. ; ACTIONS: Copy claim level provider to the lines without a provider.
"RTN","IBCEF81",255,0)
 .. M OUTPUT("L-PROV",IBIEN,SLC)=PROVINFO("PROVINF",IBIEN)
"RTN","IBCEF81",256,0)
 ;
"RTN","IBCEF81",257,0)
 ; ACTION:  Remove CLAIM LEVEL provider.
"RTN","IBCEF81",258,0)
 I $G(INSLEVEL)="" Q
"RTN","IBCEF81",259,0)
 I $G(PRTYPE)="" Q
"RTN","IBCEF81",260,0)
 I $G(CMODE(INSLEVEL))="" Q
"RTN","IBCEF81",261,0)
 I $G(CPRNUM(INSLEVEL))="" Q
"RTN","IBCEF81",262,0)
 K OUTPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)
"RTN","IBCEF81",263,0)
 I $D(OUTPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL)))=1 K OUTPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL))
"RTN","IBCEF81",264,0)
 ;
"RTN","IBCEF81",265,0)
 Q
"RTN","IBCEF81",266,0)
 ;
"RTN","IBCEF81",267,0)
A10010     ; Case 19
"RTN","IBCEF81",268,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",269,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",270,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF81",271,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF81",272,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",273,0)
 ;
"RTN","IBCEF81",274,0)
 ; ACTIONS: 1. Remove the claim level provider from the lines where the
"RTN","IBCEF81",275,0)
 ;             they are listed as provider.
"RTN","IBCEF81",276,0)
 ;
"RTN","IBCEF81",277,0)
 ; Remove the claim lines associated with the claim level provider.
"RTN","IBCEF81",278,0)
 D REMOVELN
"RTN","IBCEF81",279,0)
 ;
"RTN","IBCEF81",280,0)
 Q
"RTN","IBCEF81",281,0)
 ;
"RTN","IBCEF81",282,0)
A10011     ; Case 20
"RTN","IBCEF81",283,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",284,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",285,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF81",286,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF81",287,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF81",288,0)
 ;
"RTN","IBCEF81",289,0)
 ; ACTIONS: 1. Remove the claim level provider from the lines where the
"RTN","IBCEF81",290,0)
 ;             they are listed as provider.
"RTN","IBCEF81",291,0)
 ;
"RTN","IBCEF81",292,0)
 ; Remove the claim lines associated with the claim level provider.
"RTN","IBCEF81",293,0)
 D REMOVELN
"RTN","IBCEF81",294,0)
 ;
"RTN","IBCEF81",295,0)
 Q
"RTN","IBCEF81",296,0)
 ;
"RTN","IBCEF81",297,0)
A10100     ; Case 21
"RTN","IBCEF81",298,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",299,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",300,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF81",301,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",302,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",303,0)
 ;
"RTN","IBCEF81",304,0)
 ; ACTIONS: Transmit as is.
"RTN","IBCEF81",305,0)
 ;
"RTN","IBCEF81",306,0)
 Q
"RTN","IBCEF81",307,0)
 ;
"RTN","IBCEF81",308,0)
A10101     ; Case 22
"RTN","IBCEF81",309,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",310,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",311,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF81",312,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",313,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF81",314,0)
 ;
"RTN","IBCEF81",315,0)
 ; ACTIONS: Transmit as is.
"RTN","IBCEF81",316,0)
 ;
"RTN","IBCEF81",317,0)
 Q
"RTN","IBCEF81",318,0)
 ;
"RTN","IBCEF81",319,0)
A10110     ; Case 23
"RTN","IBCEF81",320,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",321,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",322,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF81",323,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF81",324,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",325,0)
 ;
"RTN","IBCEF81",326,0)
 ; Remove the claim lines associated with the claim level provider.
"RTN","IBCEF81",327,0)
 D REMOVELN
"RTN","IBCEF81",328,0)
 ;
"RTN","IBCEF81",329,0)
 Q
"RTN","IBCEF81",330,0)
 ;
"RTN","IBCEF81",331,0)
A10111     ; Case 24
"RTN","IBCEF81",332,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",333,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF81",334,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF81",335,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF81",336,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF81",337,0)
 ;
"RTN","IBCEF81",338,0)
 ; Remove the claim lines associated with the claim level provider.
"RTN","IBCEF81",339,0)
 D REMOVELN
"RTN","IBCEF81",340,0)
 ;
"RTN","IBCEF81",341,0)
 Q
"RTN","IBCEF81",342,0)
 ;
"RTN","IBCEF81",343,0)
A11000     ; Case 25
"RTN","IBCEF81",344,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",345,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF81",346,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF81",347,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",348,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",349,0)
 ;
"RTN","IBCEF81",350,0)
 ; ACTIONS: 1. Transmit as is.
"RTN","IBCEF81",351,0)
 ;          2. The function will return an error message.
"RTN","IBCEF81",352,0)
 ;
"RTN","IBCEF81",353,0)
 S STATUS="0^CASE 25 ERROR"
"RTN","IBCEF81",354,0)
 ;
"RTN","IBCEF81",355,0)
 Q
"RTN","IBCEF81",356,0)
 ;
"RTN","IBCEF81",357,0)
A11001     ; Case 26 - This case can never happen!
"RTN","IBCEF81",358,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",359,0)
 Q
"RTN","IBCEF81",360,0)
 ;
"RTN","IBCEF81",361,0)
A11010     ; Case 27
"RTN","IBCEF81",362,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",363,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF81",364,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF81",365,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF81",366,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",367,0)
 ;
"RTN","IBCEF81",368,0)
 ; ACTIONS: 1. Remove the claim level provider from the lines where the
"RTN","IBCEF81",369,0)
 ;             they are listed as provider.
"RTN","IBCEF81",370,0)
 ;
"RTN","IBCEF81",371,0)
 ; Remove the claim lines associated with the claim level provider.
"RTN","IBCEF81",372,0)
 D REMOVELN
"RTN","IBCEF81",373,0)
 ;
"RTN","IBCEF81",374,0)
 Q
"RTN","IBCEF81",375,0)
 ;
"RTN","IBCEF81",376,0)
A11011     ; Case 28 - This case can never happen!
"RTN","IBCEF81",377,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",378,0)
 Q
"RTN","IBCEF81",379,0)
 ;
"RTN","IBCEF81",380,0)
A11100     ; Case 29
"RTN","IBCEF81",381,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",382,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF81",383,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF81",384,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF81",385,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",386,0)
 ;
"RTN","IBCEF81",387,0)
 ; ACTIONS: 1. Transmit as is.
"RTN","IBCEF81",388,0)
 ;          2. The function will return an error message.
"RTN","IBCEF81",389,0)
 ;
"RTN","IBCEF81",390,0)
 S STATUS="0^CASE 29 ERROR"
"RTN","IBCEF81",391,0)
 ;
"RTN","IBCEF81",392,0)
 Q
"RTN","IBCEF81",393,0)
 ;
"RTN","IBCEF81",394,0)
A11101     ; Case 30 - This case can never happen!
"RTN","IBCEF81",395,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",396,0)
 Q
"RTN","IBCEF81",397,0)
 ;
"RTN","IBCEF81",398,0)
A11110     ; Case 31
"RTN","IBCEF81",399,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF81",400,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF81",401,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF81",402,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF81",403,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF81",404,0)
 ;
"RTN","IBCEF81",405,0)
 ; Remove the claim lines associated with the claim level provider.
"RTN","IBCEF81",406,0)
 D REMOVELN
"RTN","IBCEF81",407,0)
 ;
"RTN","IBCEF81",408,0)
 Q
"RTN","IBCEF81",409,0)
 ;
"RTN","IBCEF81",410,0)
A11111     ; Case 32 - This case can never happen!
"RTN","IBCEF81",411,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF81",412,0)
 Q
"RTN","IBCEF81",413,0)
 ;
"RTN","IBCEF81",414,0)
CINIT1    ; Claim level initiation
"RTN","IBCEF81",415,0)
 S IBIEN=$O(INPUT("L-PROV",0))
"RTN","IBCEF81",416,0)
 I IBIEN="" S IBIEN=$O(INPUT("PROVINF",0))
"RTN","IBCEF81",417,0)
 I IBIEN="" S IBIEN=$O(INPUT("LAB/FAC",0))
"RTN","IBCEF81",418,0)
 Q
"RTN","IBCEF81",419,0)
 ;
"RTN","IBCEF81",420,0)
CINIT2    ; Claim level initiation
"RTN","IBCEF81",421,0)
 N MODEX,PRNUMX,PROVX
"RTN","IBCEF81",422,0)
 F MODEX="C","O" D
"RTN","IBCEF81",423,0)
 . S PRNUMX=0 F  S PRNUMX=$O(INPUT("PROVINF",IBIEN,MODEX,PRNUMX)) Q:+PRNUMX=0  D
"RTN","IBCEF81",424,0)
 .. I $G(INPUT("PROVINF",IBIEN,MODEX,PRNUMX))="" Q
"RTN","IBCEF81",425,0)
 .. I INPUT("PROVINF",IBIEN,MODEX,PRNUMX)=INSLEVEL S CMODE(INSLEVEL)=MODEX,CPRNUM(INSLEVEL)=PRNUMX
"RTN","IBCEF81",426,0)
 Q
"RTN","IBCEF81",427,0)
 ;
"RTN","IBCEF81",428,0)
LINIT1(SLC)    ; Line level initiation
"RTN","IBCEF81",429,0)
 Q $O(INPUT("L-PROV",IBIEN,SLC))
"RTN","IBCEF81",430,0)
 ;
"RTN","IBCEF81",431,0)
LINIT2    ; Line level initiation
"RTN","IBCEF81",432,0)
 N MODEX,PRNUMX,PROVX
"RTN","IBCEF81",433,0)
 F MODEX="C","O" D
"RTN","IBCEF81",434,0)
 . S PRNUMX=0 F  S PRNUMX=$O(INPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX)) Q:+PRNUMX=0  D
"RTN","IBCEF81",435,0)
 .. I INPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX)=INSLEVEL S LMODE(INSLEVEL)=MODEX,LPRNUM(INSLEVEL)=PRNUMX
"RTN","IBCEF81",436,0)
 Q
"RTN","IBCEF81",437,0)
 ;
"RTN","IBCEF81",438,0)
REMOVELN    ; Remove the claim lines associated with the claim level provider.
"RTN","IBCEF81",439,0)
 N MODEX,PRNUMX,PROVX
"RTN","IBCEF81",440,0)
 S SLC=0 F  S SLC=$O(OUTPUT("L-PROV",IBIEN,SLC)) Q:+SLC=0  D
"RTN","IBCEF81",441,0)
 . F MODEX="C","O" D
"RTN","IBCEF81",442,0)
 .. S PRNUMX=0 F  S PRNUMX=$O(OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX)) Q:+PRNUMX=0  D
"RTN","IBCEF81",443,0)
 ... Q:$G(PROVINFO)=""
"RTN","IBCEF81",444,0)
 ... I $G(OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX,PRTYPE))=PROVINFO D
"RTN","IBCEF81",445,0)
 .... K OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX,PRTYPE)
"RTN","IBCEF81",446,0)
 .... I $D(OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX))=1 K OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX)
"RTN","IBCEF81",447,0)
 .... I $D(OUTPUT("L-PROV",IBIEN,SLC,MODEX))=1 K OUTPUT("L-PROV",IBIEN,SLC,MODEX)
"RTN","IBCEF81",448,0)
 .... I $D(OUTPUT("L-PROV",IBIEN,SLC))=1 K OUTPUT("L-PROV",IBIEN,SLC)
"RTN","IBCEF81",449,0)
 Q
"RTN","IBCEF82")
0^82^B111186112^n/a
"RTN","IBCEF82",1,0)
IBCEF82 ;ALB/BI - PROVIDER ADJUSTMENTS ;20-OCT-2010
"RTN","IBCEF82",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCEF82",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF82",4,0)
 ;
"RTN","IBCEF82",5,0)
 Q
"RTN","IBCEF82",6,0)
 ;
"RTN","IBCEF82",7,0)
EN(INPUT)    ; ENTRY POINT FOR LOCAL PRINTING
"RTN","IBCEF82",8,0)
 N INSLEVEL,PRTYPE,OUTPUT,IBIEN,CMODE,CPRNUM,STATUS
"RTN","IBCEF82",9,0)
 S STATUS=1
"RTN","IBCEF82",10,0)
 I $D(INPUT)=0 S STATUS=0 Q STATUS
"RTN","IBCEF82",11,0)
 K OUTPUT M OUTPUT=INPUT
"RTN","IBCEF82",12,0)
 D CINIT1 Q:IBIEN="" STATUS
"RTN","IBCEF82",13,0)
 F INSLEVEL="P","S","T" D    ; P=PRIMARY, S=SECONDARY, T=TERTIARY
"RTN","IBCEF82",14,0)
 . D CINIT2
"RTN","IBCEF82",15,0)
 . F PRTYPE=1,2,3,5,9 D    ; 1=REFERRING, 2=OPERATING, 3=RENDERING, 5=SUPERVISING, 9=OTHER OPERATING
"RTN","IBCEF82",16,0)
 .. D START(INSLEVEL,PRTYPE,.OUTPUT)
"RTN","IBCEF82",17,0)
 K INPUT M INPUT=OUTPUT
"RTN","IBCEF82",18,0)
 Q STATUS
"RTN","IBCEF82",19,0)
START(INSLEVEL,PRTYPE,OUTPUT)     ; START PROCESSING
"RTN","IBCEF82",20,0)
 N INTERM,PROVINFO,MAXAINFO
"RTN","IBCEF82",21,0)
 S INTERM="A"
"RTN","IBCEF82",22,0)
 S INTERM=INTERM_$$TEST1    ; Does Claim Level Provider Exist, 0=NO, 1=YES
"RTN","IBCEF82",23,0)
 S INTERM=INTERM_$$TEST2    ; All procedures have a line level provider, 0=NO, 1=YES
"RTN","IBCEF82",24,0)
 S INTERM=INTERM_$$TEST3    ; One Line Level provider is most significant, 0=NO, 1=YES
"RTN","IBCEF82",25,0)
 S INTERM=INTERM_$$TEST4    ; At least one line level provider matches the claim level provider, 0=NO, 1=YES
"RTN","IBCEF82",26,0)
 S INTERM=INTERM_$$TEST5    ; There is only one procedure without a line level provider, 0=NO, 1=YES
"RTN","IBCEF82",27,0)
 D @INTERM
"RTN","IBCEF82",28,0)
 Q 
"RTN","IBCEF82",29,0)
 ;
"RTN","IBCEF82",30,0)
TEST1() ; Does Claim Level Provider Exist, 0=NO, 1=YES
"RTN","IBCEF82",31,0)
 N PROVX
"RTN","IBCEF82",32,0)
 I $D(CMODE(INSLEVEL))#10=0 Q 0
"RTN","IBCEF82",33,0)
 I $D(CPRNUM(INSLEVEL))#10=0 Q 0
"RTN","IBCEF82",34,0)
 S (PROVX,PROVY)=$G(INPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)) Q:PROVX="" 0
"RTN","IBCEF82",35,0)
 S PROVX="^"_$P(PROVX,";",2)_$P(PROVX,";",1)_")"
"RTN","IBCEF82",36,0)
 I $D(@PROVX) D  Q 1    ;CLAIM PROVIDER EXISTS, RETURN TRUE.
"RTN","IBCEF82",37,0)
 . ; LOAD CLAIM LEVEL PROVIDER INFORMATION
"RTN","IBCEF82",38,0)
 . S PROVINFO=PROVY
"RTN","IBCEF82",39,0)
 . S PROVINFO("PROVINF",IBIEN)=IBIEN
"RTN","IBCEF82",40,0)
 . S PROVINFO("PROVINF",IBIEN,CMODE(INSLEVEL))=""
"RTN","IBCEF82",41,0)
 . S PROVINFO("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL))=INSLEVEL
"RTN","IBCEF82",42,0)
 . M PROVINFO("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)=INPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)
"RTN","IBCEF82",43,0)
 Q 0
"RTN","IBCEF82",44,0)
 ;
"RTN","IBCEF82",45,0)
TEST2() ; All procedures have a line level provider, 0=NO, 1=YES
"RTN","IBCEF82",46,0)
 N SLC,RESULT,LMODE,LPRNUM,PROVX,LINECNT
"RTN","IBCEF82",47,0)
 S SLC=0,RESULT=1,LINECNT=0
"RTN","IBCEF82",48,0)
 F  S SLC=$$LINIT1(SLC) Q:+SLC=0  D
"RTN","IBCEF82",49,0)
 . D LINIT2
"RTN","IBCEF82",50,0)
 . S LINECNT=LINECNT+1
"RTN","IBCEF82",51,0)
 . I $D(LMODE(INSLEVEL))#10=0 S RESULT=0 Q
"RTN","IBCEF82",52,0)
 . I $D(LPRNUM(INSLEVEL))#10=0 S RESULT=0 Q
"RTN","IBCEF82",53,0)
 . S PROVX=$G(INPUT("L-PROV",IBIEN,SLC,LMODE(INSLEVEL),LPRNUM(INSLEVEL),PRTYPE))
"RTN","IBCEF82",54,0)
 . I PROVX="" D  Q
"RTN","IBCEF82",55,0)
 .. S RESULT=RESULT*0
"RTN","IBCEF82",56,0)
 . S PROVX="^"_$P(PROVX,";",2)_$P(PROVX,";",1)_")"
"RTN","IBCEF82",57,0)
 . S RESULT=RESULT*($D(@PROVX)'=0)
"RTN","IBCEF82",58,0)
 I +$G(INPUT("SLC"))'=0,INPUT("SLC")>LINECNT S RESULT=0
"RTN","IBCEF82",59,0)
 Q RESULT
"RTN","IBCEF82",60,0)
 ;
"RTN","IBCEF82",61,0)
TEST3() ; One Line Level provider is most significant, 0=NO, 1=YES
"RTN","IBCEF82",62,0)
 N SLC,RESULT,LMODE,LPRNUM,PCOUNT,PCOUNTF,PCOUNTL,PROVX,TEMPNODE
"RTN","IBCEF82",63,0)
 S SLC=0,RESULT=0
"RTN","IBCEF82",64,0)
 F  S SLC=$$LINIT1(SLC) Q:+SLC=0  D
"RTN","IBCEF82",65,0)
 . D LINIT2
"RTN","IBCEF82",66,0)
 . I $D(LMODE(INSLEVEL))#10=0 Q
"RTN","IBCEF82",67,0)
 . I $D(LPRNUM(INSLEVEL))#10=0 Q
"RTN","IBCEF82",68,0)
 . S PROVX=$G(INPUT("L-PROV",IBIEN,SLC,LMODE(INSLEVEL),LPRNUM(INSLEVEL),PRTYPE)) Q:PROVX=""
"RTN","IBCEF82",69,0)
 . S PCOUNT(PROVX)=$P($G(PCOUNT(PROVX)),"^",1)+1_"^"_SLC_"^"_LMODE(INSLEVEL)_"^"_LPRNUM(INSLEVEL)_"^"_PRTYPE
"RTN","IBCEF82",70,0)
 S PROVX="" F  S PROVX=$O(PCOUNT(PROVX)) Q:PROVX=""  D
"RTN","IBCEF82",71,0)
 . S PCOUNTF($P(PCOUNT(PROVX),"^",1),PROVX)=$P(PCOUNT(PROVX),"^",2,5)
"RTN","IBCEF82",72,0)
 S PCOUNTL(1)=$O(PCOUNTF(""),-1) Q:PCOUNTL(1)="" RESULT
"RTN","IBCEF82",73,0)
 S PCOUNTL(2,1)=$O(PCOUNTF(PCOUNTL(1),""),-1) Q:PCOUNTL(2,1)="" RESULT
"RTN","IBCEF82",74,0)
 S PCOUNTL(2,2)=$O(PCOUNTF(PCOUNTL(1),PCOUNTL(2,1)),-1)
"RTN","IBCEF82",75,0)
 I PCOUNTL(2,2)="" D
"RTN","IBCEF82",76,0)
 . S RESULT=1
"RTN","IBCEF82",77,0)
 . ; LOAD MOST SIGNIFICANT LINE LEVEL PROVIDER INFORMATION
"RTN","IBCEF82",78,0)
 . S MAXAINFO=PCOUNTL(2,1)
"RTN","IBCEF82",79,0)
 . S TEMPNODE=PCOUNTF(PCOUNTL(1),PCOUNTL(2,1))
"RTN","IBCEF82",80,0)
 . S MAXAINFO("L-PROV",IBIEN)=IBIEN
"RTN","IBCEF82",81,0)
 . S MAXAINFO("L-PROV",IBIEN,$P(TEMPNODE,"^",2),$P(TEMPNODE,"^",3))=INSLEVEL
"RTN","IBCEF82",82,0)
 . M MAXAINFO("L-PROV",IBIEN,$P(TEMPNODE,"^",2),$P(TEMPNODE,"^",3),$P(TEMPNODE,"^",4))=INPUT("L-PROV",IBIEN,$P(TEMPNODE,"^",1),$P(TEMPNODE,"^",2),$P(TEMPNODE,"^",3),$P(TEMPNODE,"^",4))
"RTN","IBCEF82",83,0)
 Q RESULT
"RTN","IBCEF82",84,0)
 ;
"RTN","IBCEF82",85,0)
TEST4() ; At least one line level provider matches the claim level provider, 0=NO, 1=YES
"RTN","IBCEF82",86,0)
 N CPROV,RESULT,LMODE,LPRNUM,LPROV,SLC
"RTN","IBCEF82",87,0)
 I $D(CMODE(INSLEVEL))#10=0 Q 0
"RTN","IBCEF82",88,0)
 I $D(CPRNUM(INSLEVEL))#10=0 Q 0
"RTN","IBCEF82",89,0)
 S CPROV=$G(INPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)) Q:CPROV="" 0
"RTN","IBCEF82",90,0)
 S SLC=0,RESULT=0
"RTN","IBCEF82",91,0)
 F  S SLC=$$LINIT1(SLC) Q:+SLC=0  D
"RTN","IBCEF82",92,0)
 . D LINIT2
"RTN","IBCEF82",93,0)
 . I $D(LMODE(INSLEVEL))#10=0 Q
"RTN","IBCEF82",94,0)
 . I $D(LPRNUM(INSLEVEL))#10=0 Q
"RTN","IBCEF82",95,0)
 . S LPROV=$G(INPUT("L-PROV",IBIEN,SLC,LMODE(INSLEVEL),LPRNUM(INSLEVEL),PRTYPE))  Q:LPROV=""
"RTN","IBCEF82",96,0)
 . I LPROV=CPROV S RESULT=1
"RTN","IBCEF82",97,0)
 Q RESULT
"RTN","IBCEF82",98,0)
 ;
"RTN","IBCEF82",99,0)
TEST5() ; There is only one procedure without a line level provider, 0=NO, 1=YES
"RTN","IBCEF82",100,0)
 N SLC,LMODE,LPRNUM,PROVCNT,RESULT
"RTN","IBCEF82",101,0)
 S SLC=0,PROVCNT=0,RESULT=0
"RTN","IBCEF82",102,0)
 F  S SLC=$$LINIT1(SLC) Q:+SLC=0  D
"RTN","IBCEF82",103,0)
 . D LINIT2
"RTN","IBCEF82",104,0)
 . I $D(LMODE(INSLEVEL))#10=0 Q
"RTN","IBCEF82",105,0)
 . I $D(LPRNUM(INSLEVEL))#10=0 Q
"RTN","IBCEF82",106,0)
 . S PROVX=$G(INPUT("L-PROV",IBIEN,SLC,LMODE(INSLEVEL),LPRNUM(INSLEVEL),PRTYPE))
"RTN","IBCEF82",107,0)
 . S:PROVX'="" PROVCNT=PROVCNT+1
"RTN","IBCEF82",108,0)
 I +$G(INPUT("SLC"))'=0,INPUT("SLC")=(PROVCNT+1) S RESULT=1
"RTN","IBCEF82",109,0)
 Q RESULT
"RTN","IBCEF82",110,0)
 ;
"RTN","IBCEF82",111,0)
A00000     ;  Case 1
"RTN","IBCEF82",112,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF82",113,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",114,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF82",115,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",116,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",117,0)
 ;
"RTN","IBCEF82",118,0)
 ; ACTIONS: Error Message
"RTN","IBCEF82",119,0)
 ;
"RTN","IBCEF82",120,0)
 Q
"RTN","IBCEF82",121,0)
 ;
"RTN","IBCEF82",122,0)
A00001     ;  Case 2
"RTN","IBCEF82",123,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF82",124,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",125,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF82",126,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",127,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF82",128,0)
 ;
"RTN","IBCEF82",129,0)
 ; ACTIONS: Error Message
"RTN","IBCEF82",130,0)
 ;
"RTN","IBCEF82",131,0)
 Q
"RTN","IBCEF82",132,0)
 ;
"RTN","IBCEF82",133,0)
A00010     ;  Case 3 - This case can never happen!
"RTN","IBCEF82",134,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",135,0)
 Q
"RTN","IBCEF82",136,0)
 ;
"RTN","IBCEF82",137,0)
A00011     ;  Case 4 - This case can never happen!
"RTN","IBCEF82",138,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",139,0)
 Q
"RTN","IBCEF82",140,0)
 ;
"RTN","IBCEF82",141,0)
A00100     ;  Case 5
"RTN","IBCEF82",142,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF82",143,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",144,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF82",145,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",146,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",147,0)
 ;
"RTN","IBCEF82",148,0)
 ; ACTIONS: Error Message
"RTN","IBCEF82",149,0)
 ;
"RTN","IBCEF82",150,0)
 Q
"RTN","IBCEF82",151,0)
 ;
"RTN","IBCEF82",152,0)
A00101     ;  Case 6
"RTN","IBCEF82",153,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF82",154,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",155,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF82",156,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",157,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF82",158,0)
 ;
"RTN","IBCEF82",159,0)
 ; ACTIONS: Error Message
"RTN","IBCEF82",160,0)
 ;
"RTN","IBCEF82",161,0)
 Q
"RTN","IBCEF82",162,0)
 ;
"RTN","IBCEF82",163,0)
A00110     ;  Case 7 - This case can never happen!
"RTN","IBCEF82",164,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",165,0)
 Q
"RTN","IBCEF82",166,0)
 ;
"RTN","IBCEF82",167,0)
A00111     ;  Case 8 - This case can never happen!
"RTN","IBCEF82",168,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",169,0)
 Q
"RTN","IBCEF82",170,0)
 ;
"RTN","IBCEF82",171,0)
A01000     ;  Case 9
"RTN","IBCEF82",172,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF82",173,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF82",174,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF82",175,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",176,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",177,0)
 ;
"RTN","IBCEF82",178,0)
 ; ACTIONS: Return the first Line Level Provider.
"RTN","IBCEF82",179,0)
 ;
"RTN","IBCEF82",180,0)
 ; Move the first line level provider to the claim level.
"RTN","IBCEF82",181,0)
 S SLC=1
"RTN","IBCEF82",182,0)
 I $D(OUTPUT("L-PROV",IBIEN,SLC,"C",1,PRTYPE)) D
"RTN","IBCEF82",183,0)
 . K OUTPUT("PROVINF",IBIEN,"C",1,PRTYPE)
"RTN","IBCEF82",184,0)
 . M OUTPUT("PROVINF",IBIEN,"C",1,PRTYPE)=OUTPUT("L-PROV",IBIEN,SLC,"C",1,PRTYPE)
"RTN","IBCEF82",185,0)
 . S OUTPUT("PROVINF",IBIEN,"C",1)="P"
"RTN","IBCEF82",186,0)
 I $D(OUTPUT("L-PROV",IBIEN,SLC,"O",1,PRTYPE)) D
"RTN","IBCEF82",187,0)
 . K OUTPUT("PROVINF",IBIEN,"O",1,PRTYPE)
"RTN","IBCEF82",188,0)
 . M OUTPUT("PROVINF",IBIEN,"O",1,PRTYPE)=OUTPUT("L-PROV",IBIEN,SLC,"O",1,PRTYPE)
"RTN","IBCEF82",189,0)
 . S OUTPUT("PROVINF",IBIEN,"O",1)="S"
"RTN","IBCEF82",190,0)
 I $D(OUTPUT("L-PROV",IBIEN,SLC,"O",2,PRTYPE)) D
"RTN","IBCEF82",191,0)
 . K OUTPUT("PROVINF",IBIEN,"O",2,PRTYPE)
"RTN","IBCEF82",192,0)
 . M OUTPUT("PROVINF",IBIEN,"O",2,PRTYPE)=OUTPUT("L-PROV",IBIEN,SLC,"O",2,PRTYPE)
"RTN","IBCEF82",193,0)
 . S OUTPUT("PROVINF",IBIEN,"O",2)="T"
"RTN","IBCEF82",194,0)
 ;
"RTN","IBCEF82",195,0)
 Q
"RTN","IBCEF82",196,0)
 ;
"RTN","IBCEF82",197,0)
A01001     ; Case 10 - This case can never happen!
"RTN","IBCEF82",198,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",199,0)
 Q
"RTN","IBCEF82",200,0)
 ;
"RTN","IBCEF82",201,0)
A01010     ; Case 11 - This case can never happen!
"RTN","IBCEF82",202,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",203,0)
 Q
"RTN","IBCEF82",204,0)
 ;
"RTN","IBCEF82",205,0)
A01011     ; Case 12 - This case can never happen!
"RTN","IBCEF82",206,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",207,0)
 Q
"RTN","IBCEF82",208,0)
 ;
"RTN","IBCEF82",209,0)
A01100     ; Case 13
"RTN","IBCEF82",210,0)
 ; TESTS:                            Does Claim Level Provider Exist: 0=NO
"RTN","IBCEF82",211,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF82",212,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF82",213,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",214,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",215,0)
 ;
"RTN","IBCEF82",216,0)
 ; ACTIONS: Make the most significant provider the Claim Level Provider.
"RTN","IBCEF82",217,0)
 ;
"RTN","IBCEF82",218,0)
 ; Set the claim level provider equal to the most significant line level provider.
"RTN","IBCEF82",219,0)
 I $G(MAXAINFO)="" Q
"RTN","IBCEF82",220,0)
 M OUTPUT("PROVINF",IBIEN)=MAXAINFO("L-PROV",IBIEN)
"RTN","IBCEF82",221,0)
 ;
"RTN","IBCEF82",222,0)
 Q
"RTN","IBCEF82",223,0)
 ;
"RTN","IBCEF82",224,0)
A01101     ; Case 14 - This case can never happen!
"RTN","IBCEF82",225,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",226,0)
 Q
"RTN","IBCEF82",227,0)
 ;
"RTN","IBCEF82",228,0)
A01110     ; Case 15 - This case can never happen!
"RTN","IBCEF82",229,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",230,0)
 Q
"RTN","IBCEF82",231,0)
 ;
"RTN","IBCEF82",232,0)
A01111     ; Case 16 - This case can never happen!
"RTN","IBCEF82",233,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",234,0)
 Q
"RTN","IBCEF82",235,0)
 ;
"RTN","IBCEF82",236,0)
A10000    ; Case 17
"RTN","IBCEF82",237,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",238,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",239,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF82",240,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",241,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",242,0)
 ;
"RTN","IBCEF82",243,0)
 ; ACTIONS: Take no Action, use claim level provider.
"RTN","IBCEF82",244,0)
 ;
"RTN","IBCEF82",245,0)
 Q
"RTN","IBCEF82",246,0)
 ;
"RTN","IBCEF82",247,0)
A10001    ; Case 18
"RTN","IBCEF82",248,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",249,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",250,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF82",251,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",252,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF82",253,0)
 ;
"RTN","IBCEF82",254,0)
 ; ACTIONS: 1.  Move the Claim Level Provider to the Line Level.
"RTN","IBCEF82",255,0)
 ;          2.  Use the first line level provider for the claim level.
"RTN","IBCEF82",256,0)
 ;
"RTN","IBCEF82",257,0)
 ; Don't perform this action for a single line claim.
"RTN","IBCEF82",258,0)
 I $G(INPUT("SLC"))=1 Q
"RTN","IBCEF82",259,0)
 ;
"RTN","IBCEF82",260,0)
 ; Determine Line with Missing Provider.
"RTN","IBCEF82",261,0)
 N SLC
"RTN","IBCEF82",262,0)
 S SLC=0 F  S SLC=$O(^DGCR(399,IBIEN,"RC",SLC)) Q:+SLC=0  D
"RTN","IBCEF82",263,0)
 . I $D(INPUT("L-PROV",IBIEN,SLC))=0 D
"RTN","IBCEF82",264,0)
 .. ; Move claim level provider to the lines without a provider.
"RTN","IBCEF82",265,0)
 .. M OUTPUT("L-PROV",IBIEN,SLC)=PROVINFO("PROVINF",IBIEN)
"RTN","IBCEF82",266,0)
 ;
"RTN","IBCEF82",267,0)
 ; Move the first line level provider to the claim level.
"RTN","IBCEF82",268,0)
 S SLC=1
"RTN","IBCEF82",269,0)
 I $D(CMODE(INSLEVEL))'=1 Q
"RTN","IBCEF82",270,0)
 I $D(CPRNUM(INSLEVEL))'=1 Q
"RTN","IBCEF82",271,0)
 I $D(OUTPUT("L-PROV",IBIEN,SLC,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)) D
"RTN","IBCEF82",272,0)
 . K OUTPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)
"RTN","IBCEF82",273,0)
 . M OUTPUT("PROVINF",IBIEN,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)=OUTPUT("L-PROV",IBIEN,SLC,CMODE(INSLEVEL),CPRNUM(INSLEVEL),PRTYPE)
"RTN","IBCEF82",274,0)
 ;
"RTN","IBCEF82",275,0)
 Q
"RTN","IBCEF82",276,0)
 ;
"RTN","IBCEF82",277,0)
A10010     ; Case 19
"RTN","IBCEF82",278,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",279,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",280,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF82",281,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF82",282,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",283,0)
 ;
"RTN","IBCEF82",284,0)
 ; ACTIONS: Take no Action, use claim level provider.
"RTN","IBCEF82",285,0)
 ;
"RTN","IBCEF82",286,0)
 Q
"RTN","IBCEF82",287,0)
 ;
"RTN","IBCEF82",288,0)
A10011     ; Case 20
"RTN","IBCEF82",289,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",290,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",291,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF82",292,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF82",293,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF82",294,0)
 ;
"RTN","IBCEF82",295,0)
 ; ACTIONS: Take no Action, use claim level provider.
"RTN","IBCEF82",296,0)
 ;
"RTN","IBCEF82",297,0)
 Q
"RTN","IBCEF82",298,0)
 ;
"RTN","IBCEF82",299,0)
A10100     ; Case 21
"RTN","IBCEF82",300,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",301,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",302,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF82",303,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",304,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",305,0)
 ;
"RTN","IBCEF82",306,0)
 ; ACTIONS: Take no Action, use claim level provider.
"RTN","IBCEF82",307,0)
 ;
"RTN","IBCEF82",308,0)
 Q
"RTN","IBCEF82",309,0)
 ;
"RTN","IBCEF82",310,0)
A10101     ; Case 22
"RTN","IBCEF82",311,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",312,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",313,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF82",314,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",315,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF82",316,0)
 ;
"RTN","IBCEF82",317,0)
 ; ACTIONS: Take no Action, use claim level provider.
"RTN","IBCEF82",318,0)
 ;
"RTN","IBCEF82",319,0)
 Q
"RTN","IBCEF82",320,0)
 ;
"RTN","IBCEF82",321,0)
A10110     ; Case 23
"RTN","IBCEF82",322,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",323,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",324,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF82",325,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF82",326,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",327,0)
 ;
"RTN","IBCEF82",328,0)
 ; ACTIONS: Take no Action, use claim level provider.
"RTN","IBCEF82",329,0)
 ;
"RTN","IBCEF82",330,0)
 Q
"RTN","IBCEF82",331,0)
 ;
"RTN","IBCEF82",332,0)
A10111     ; Case 24
"RTN","IBCEF82",333,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",334,0)
 ;                         All procedures have a line level provider: 0=NO
"RTN","IBCEF82",335,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF82",336,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF82",337,0)
 ;         There is only one procedure without a line level provider: 1=YES
"RTN","IBCEF82",338,0)
 ;
"RTN","IBCEF82",339,0)
 ; ACTIONS: Take no Action, use claim level provider.
"RTN","IBCEF82",340,0)
 ;
"RTN","IBCEF82",341,0)
 Q
"RTN","IBCEF82",342,0)
 ;
"RTN","IBCEF82",343,0)
A11000     ; Case 25
"RTN","IBCEF82",344,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",345,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF82",346,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF82",347,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",348,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",349,0)
 ;
"RTN","IBCEF82",350,0)
 ; ACTIONS: Error in Billing
"RTN","IBCEF82",351,0)
 ;
"RTN","IBCEF82",352,0)
 Q
"RTN","IBCEF82",353,0)
 ;
"RTN","IBCEF82",354,0)
A11001     ; Case 26 - This case can never happen!
"RTN","IBCEF82",355,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",356,0)
 Q
"RTN","IBCEF82",357,0)
 ;
"RTN","IBCEF82",358,0)
A11010     ; Case 27
"RTN","IBCEF82",359,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",360,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF82",361,0)
 ;                       One Line Level provider is most significant: 0=NO
"RTN","IBCEF82",362,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF82",363,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",364,0)
 ;
"RTN","IBCEF82",365,0)
 ; ACTIONS: Take no Action, use claim level provider.
"RTN","IBCEF82",366,0)
 ;
"RTN","IBCEF82",367,0)
 Q
"RTN","IBCEF82",368,0)
 ;
"RTN","IBCEF82",369,0)
A11011     ; Case 28 - This case can never happen!
"RTN","IBCEF82",370,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",371,0)
 Q
"RTN","IBCEF82",372,0)
 ;
"RTN","IBCEF82",373,0)
A11100     ; Case 29
"RTN","IBCEF82",374,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",375,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF82",376,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF82",377,0)
 ; At least one line level provider matches the claim level provider: 0=NO
"RTN","IBCEF82",378,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",379,0)
 ;
"RTN","IBCEF82",380,0)
 ; ACTIONS: Error in Billing
"RTN","IBCEF82",381,0)
 ;
"RTN","IBCEF82",382,0)
 Q
"RTN","IBCEF82",383,0)
 ;
"RTN","IBCEF82",384,0)
A11101     ; Case 30 - This case can never happen!
"RTN","IBCEF82",385,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",386,0)
 Q
"RTN","IBCEF82",387,0)
 ;
"RTN","IBCEF82",388,0)
A11110     ; Case 31
"RTN","IBCEF82",389,0)
 ; TESTS:                            Does Claim Level Provider Exist: 1=YES
"RTN","IBCEF82",390,0)
 ;                         All procedures have a line level provider: 1=YES
"RTN","IBCEF82",391,0)
 ;                       One Line Level provider is most significant: 1=YES
"RTN","IBCEF82",392,0)
 ; At least one line level provider matches the claim level provider: 1=YES
"RTN","IBCEF82",393,0)
 ;         There is only one procedure without a line level provider: 0=NO
"RTN","IBCEF82",394,0)
 ;
"RTN","IBCEF82",395,0)
 ; ACTIONS: Take no Action, use claim level provider.
"RTN","IBCEF82",396,0)
 ;
"RTN","IBCEF82",397,0)
 Q
"RTN","IBCEF82",398,0)
 ;
"RTN","IBCEF82",399,0)
A11111     ; Case 32 - This case can never happen!
"RTN","IBCEF82",400,0)
 ; ACTIONS: N/A - Transmit as is.
"RTN","IBCEF82",401,0)
 Q
"RTN","IBCEF82",402,0)
 ;
"RTN","IBCEF82",403,0)
CINIT1    ; Claim level initiation
"RTN","IBCEF82",404,0)
 S IBIEN=$O(INPUT("L-PROV",0))
"RTN","IBCEF82",405,0)
 I IBIEN="" S IBIEN=$O(INPUT("PROVINF",0))
"RTN","IBCEF82",406,0)
 I IBIEN="" S IBIEN=$O(INPUT("LAB/FAC",0))
"RTN","IBCEF82",407,0)
 Q
"RTN","IBCEF82",408,0)
 ;
"RTN","IBCEF82",409,0)
CINIT2    ; Claim level initiation
"RTN","IBCEF82",410,0)
 N MODEX,PRNUMX,PROVX
"RTN","IBCEF82",411,0)
 F MODEX="C","O" D
"RTN","IBCEF82",412,0)
 . S PRNUMX=0 F  S PRNUMX=$O(INPUT("PROVINF",IBIEN,MODEX,PRNUMX)) Q:+PRNUMX=0  D
"RTN","IBCEF82",413,0)
 .. I $G(INPUT("PROVINF",IBIEN,MODEX,PRNUMX))="" Q
"RTN","IBCEF82",414,0)
 .. I INPUT("PROVINF",IBIEN,MODEX,PRNUMX)=INSLEVEL S CMODE(INSLEVEL)=MODEX,CPRNUM(INSLEVEL)=PRNUMX
"RTN","IBCEF82",415,0)
 Q
"RTN","IBCEF82",416,0)
 ;
"RTN","IBCEF82",417,0)
LINIT1(SLC)    ; Line level initiation
"RTN","IBCEF82",418,0)
 Q $O(INPUT("L-PROV",IBIEN,SLC))
"RTN","IBCEF82",419,0)
 ;
"RTN","IBCEF82",420,0)
LINIT2    ; Line level initiation
"RTN","IBCEF82",421,0)
 N MODEX,PRNUMX,PROVX
"RTN","IBCEF82",422,0)
 F MODEX="C","O" D
"RTN","IBCEF82",423,0)
 . S PRNUMX=0 F  S PRNUMX=$O(INPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX)) Q:+PRNUMX=0  D
"RTN","IBCEF82",424,0)
 .. I INPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX)=INSLEVEL S LMODE(INSLEVEL)=MODEX,LPRNUM(INSLEVEL)=PRNUMX
"RTN","IBCEF82",425,0)
 Q
"RTN","IBCEF82",426,0)
 ;
"RTN","IBCEF82",427,0)
REMOVELN    ; Remove the claim lines associated with the claim level provider.
"RTN","IBCEF82",428,0)
 N MODEX,PRNUMX,PROVX
"RTN","IBCEF82",429,0)
 S SLC=0 F  S SLC=$O(OUTPUT("L-PROV",IBIEN,SLC)) Q:+SLC=0  D
"RTN","IBCEF82",430,0)
 . F MODEX="C","O" D
"RTN","IBCEF82",431,0)
 .. S PRNUMX=0 F  S PRNUMX=$O(OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX)) Q:+PRNUMX=0  D
"RTN","IBCEF82",432,0)
 ... Q:$G(PROVINFO)=""
"RTN","IBCEF82",433,0)
 ... I $G(OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX,PRTYPE))=PROVINFO D
"RTN","IBCEF82",434,0)
 .... K OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX,PRTYPE)
"RTN","IBCEF82",435,0)
 .... I $D(OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX))=1 K OUTPUT("L-PROV",IBIEN,SLC,MODEX,PRNUMX)
"RTN","IBCEF82",436,0)
 .... I $D(OUTPUT("L-PROV",IBIEN,SLC,MODEX))=1 K OUTPUT("L-PROV",IBIEN,SLC,MODEX)
"RTN","IBCEF82",437,0)
 .... I $D(OUTPUT("L-PROV",IBIEN,SLC))=1 K OUTPUT("L-PROV",IBIEN,SLC)
"RTN","IBCEF82",438,0)
 Q
"RTN","IBCEF83")
0^83^B56319703^n/a
"RTN","IBCEF83",1,0)
IBCEF83 ;ALB/BI - GET PROVIDER FUNCTIONS ;26-OCT-2010
"RTN","IBCEF83",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCEF83",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF83",4,0)
 Q
"RTN","IBCEF83",5,0)
 ;
"RTN","IBCEF83",6,0)
GETPRV(IBIEN,CPST,IBPRTYP,IBITEM)    ; MAIN ENTRY POINT.
"RTN","IBCEF83",7,0)
 ; INPUTS:  IBIEN    - INTERNAL BILLING/CLAIM NUMBER.
"RTN","IBCEF83",8,0)
 ;
"RTN","IBCEF83",9,0)
 ;          CPST     - INSURANCE LEVEL: C = CURRENT(DEFAULT),
"RTN","IBCEF83",10,0)
 ;                                      P = PRIMARY,
"RTN","IBCEF83",11,0)
 ;                                      S = SECONDARY,
"RTN","IBCEF83",12,0)
 ;                                      T = TERTIARY.
"RTN","IBCEF83",13,0)
 ;
"RTN","IBCEF83",14,0)
 ;          IBPRTYPE - PROVIDER TYPE:   1 = REFERRING,
"RTN","IBCEF83",15,0)
 ;                                      2 = OPERATING,
"RTN","IBCEF83",16,0)
 ;                                      3 = RENDERING,
"RTN","IBCEF83",17,0)
 ;                                      4 = ATTENDING,
"RTN","IBCEF83",18,0)
 ;                                      5 = SUPERVISING,
"RTN","IBCEF83",19,0)
 ;                                      9 = OTHER OPERATING.
"RTN","IBCEF83",20,0)
 ;
"RTN","IBCEF83",21,0)
 ;          IBITEM   - ITEM REQUESTED: A0 = PROVIDER VARIABLE POINTER
"RTN","IBCEF83",22,0)
 ;                                     A1 = PROVIDER FULL NAME
"RTN","IBCEF83",23,0)
 ;                                     A2 = PROVIDER LAST NAME
"RTN","IBCEF83",24,0)
 ;                                     A3 = PROVIDER FIRST NAME
"RTN","IBCEF83",25,0)
 ;                                     A4 = PROVIDER MIDDLE NAME
"RTN","IBCEF83",26,0)
 ;                                     A5 = PROVIDER SUFFIX
"RTN","IBCEF83",27,0)
 ;                                     A6 = PROVIDER CREDENTIALS
"RTN","IBCEF83",28,0)
 ;                                     A7 = PROVIDER CURRENT COB ID
"RTN","IBCEF83",29,0)
 ;                                     A8 = 
"RTN","IBCEF83",30,0)
 ;                                     A9 = 
"RTN","IBCEF83",31,0)
 ;
"RTN","IBCEF83",32,0)
 ;                                     B1 = PROVIDER QUALIFIER
"RTN","IBCEF83",33,0)
 ;                                     B2 = PROVIDER ID
"RTN","IBCEF83",34,0)
 ;                                     B3 = PROVIDER NPI
"RTN","IBCEF83",35,0)
 ;
"RTN","IBCEF83",36,0)
 ;                                     C1 = REVENUE CODE LINE COUNT (SLC)
"RTN","IBCEF83",37,0)
 ;
"RTN","IBCEF83",38,0)
 ; RETURN:  SPECIFIC REQUESTED DATA ELEMENT.
"RTN","IBCEF83",39,0)
 ;
"RTN","IBCEF83",40,0)
 N CPSTDATA,IBDATA,ACTION
"RTN","IBCEF83",41,0)
 I $D(IBIEN)=0 Q ""
"RTN","IBCEF83",42,0)
 I '$G(IBXFORM) N IBXPROV
"RTN","IBCEF83",43,0)
 I $D(IBXPROV("CPST",IBIEN))=0 D
"RTN","IBCEF83",44,0)
 . K IBXPROV
"RTN","IBCEF83",45,0)
 . D ALLIDS^IBCEFP(IBIEN,.IBXPROV)
"RTN","IBCEF83",46,0)
 . D CPSTINDX
"RTN","IBCEF83",47,0)
 I (($G(IBPRTYP)="")!($G(IBITEM)="")) Q ""
"RTN","IBCEF83",48,0)
 I $G(CPST)="" S CPST="C"
"RTN","IBCEF83",49,0)
 S CPSTDATA=$G(IBXPROV("CPST",IBIEN,CPST))
"RTN","IBCEF83",50,0)
 I CPSTDATA="" Q ""
"RTN","IBCEF83",51,0)
 M IBDATA=IBXPROV("PROVINF",IBIEN,$P(CPSTDATA,U,1),$P(CPSTDATA,U,2),IBPRTYP)
"RTN","IBCEF83",52,0)
 ;I ((IBPRTYP=3)!(IBPRTYP=4)),$$MCRONBIL^IBEFUNC(IBIEN) D MCRONBIL
"RTN","IBCEF83",53,0)
 I $D(IBDATA)=0 Q ""
"RTN","IBCEF83",54,0)
 S ACTION="IBX"_IBITEM
"RTN","IBCEF83",55,0)
 I $T(@ACTION)="" Q ""
"RTN","IBCEF83",56,0)
 Q $$@ACTION
"RTN","IBCEF83",57,0)
 ;
"RTN","IBCEF83",58,0)
CPSTINDX    ; CREATE THE CPST INDEX FOR PROCESSING
"RTN","IBCEF83",59,0)
 N IBMODE,IBN
"RTN","IBCEF83",60,0)
 I $D(IBXPROV("PROVINF","C",1)) S IBXPROV("CPST",IBIEN,"C")="C"_U_"1"
"RTN","IBCEF83",61,0)
 S IBMODE="" F  S IBMODE=$O(IBXPROV("PROVINF",IBIEN,IBMODE)) Q:IBMODE=""  D
"RTN","IBCEF83",62,0)
 . S IBN="" F  S IBN=$O(IBXPROV("PROVINF",IBIEN,IBMODE,IBN)) Q:IBN=""  D
"RTN","IBCEF83",63,0)
 .. I $G(IBXPROV("PROVINF",IBIEN,IBMODE,IBN))="" Q
"RTN","IBCEF83",64,0)
 .. I IBXPROV("PROVINF",IBIEN,IBMODE,IBN)="P" D
"RTN","IBCEF83",65,0)
 ... S IBXPROV("CPST",IBIEN,"P")=IBMODE_U_IBN
"RTN","IBCEF83",66,0)
 ... I $D(IBXPROV("CPST",IBIEN,"C"))=0  S IBXPROV("CPST",IBIEN,"C")=IBMODE_U_IBN
"RTN","IBCEF83",67,0)
 .. I IBXPROV("PROVINF",IBIEN,IBMODE,IBN)="S" D
"RTN","IBCEF83",68,0)
 ... S IBXPROV("CPST",IBIEN,"S")=IBMODE_U_IBN
"RTN","IBCEF83",69,0)
 ... I $D(IBXPROV("CPST",IBIEN,"C"))=0  S IBXPROV("CPST",IBIEN,"C")=IBMODE_U_IBN
"RTN","IBCEF83",70,0)
 .. I IBXPROV("PROVINF",IBIEN,IBMODE,IBN)="T" D
"RTN","IBCEF83",71,0)
 ... S IBXPROV("CPST",IBIEN,"T")=IBMODE_U_IBN
"RTN","IBCEF83",72,0)
 ... I $D(IBXPROV("CPST",IBIEN,"C"))=0  S IBXPROV("CPST",IBIEN,"C")=IBMODE_U_IBN
"RTN","IBCEF83",73,0)
 Q
"RTN","IBCEF83",74,0)
 ;
"RTN","IBCEF83",75,0)
IBXA0()    ; PROVIDER VARIABLE POINTER
"RTN","IBCEF83",76,0)
 Q $P(IBDATA,U,1)
"RTN","IBCEF83",77,0)
 ;
"RTN","IBCEF83",78,0)
IBXA1()    ; PROVIDER FULL NAME
"RTN","IBCEF83",79,0)
 N X S X=""
"RTN","IBCEF83",80,0)
 I X="",$$IBXA2'="" D
"RTN","IBCEF83",81,0)
 . S X=$$IBXA2
"RTN","IBCEF83",82,0)
 . S:$$IBXA3'="" X=X_","_$$IBXA3
"RTN","IBCEF83",83,0)
 . S:$$IBXA4'="" X=X_" "_$$IBXA4
"RTN","IBCEF83",84,0)
 . S:$$IBXA5'="" X=X_" "_$$IBXA5
"RTN","IBCEF83",85,0)
 I X="" S X=$$EXPAND^IBTRE(399.0222,.02,$$IBXA0)
"RTN","IBCEF83",86,0)
 Q X
"RTN","IBCEF83",87,0)
 ;
"RTN","IBCEF83",88,0)
IBXA2()    ; PROVIDER LAST NAME
"RTN","IBCEF83",89,0)
 N X S X=""
"RTN","IBCEF83",90,0)
 S X=$P($G(IBDATA("NAME")),U,1)
"RTN","IBCEF83",91,0)
 Q X
"RTN","IBCEF83",92,0)
 ;
"RTN","IBCEF83",93,0)
IBXA3()    ; PROVIDER FIRST NAME
"RTN","IBCEF83",94,0)
 N X S X=""
"RTN","IBCEF83",95,0)
 S X=$P($G(IBDATA("NAME")),U,2)
"RTN","IBCEF83",96,0)
 Q X
"RTN","IBCEF83",97,0)
 ;
"RTN","IBCEF83",98,0)
IBXA4()    ; PROVIDER MIDDLE NAME
"RTN","IBCEF83",99,0)
 N X S X=""
"RTN","IBCEF83",100,0)
 S X=$P($G(IBDATA("NAME")),U,3)
"RTN","IBCEF83",101,0)
 Q X
"RTN","IBCEF83",102,0)
 ;
"RTN","IBCEF83",103,0)
IBXA5()    ; PROVIDER SUFFIX
"RTN","IBCEF83",104,0)
 N X S X=""
"RTN","IBCEF83",105,0)
 S X=$P($G(IBDATA("NAME")),U,5)
"RTN","IBCEF83",106,0)
 Q X
"RTN","IBCEF83",107,0)
 ;
"RTN","IBCEF83",108,0)
IBXA6()    ; PROVIDER CREDENTIALS
"RTN","IBCEF83",109,0)
 N X S X=""
"RTN","IBCEF83",110,0)
 S X=$P($G(IBDATA("NAME")),U,4)
"RTN","IBCEF83",111,0)
 I X="" S X=$$CRED^IBCEU($$IBXA0)
"RTN","IBCEF83",112,0)
 Q X
"RTN","IBCEF83",113,0)
 ;
"RTN","IBCEF83",114,0)
IBXA7()    ; PROVIDER CURRENT COB ID
"RTN","IBCEF83",115,0)
 N X S X=""
"RTN","IBCEF83",116,0)
 I X="" S X=$P($G(IBDATA("COBID")),U,1)
"RTN","IBCEF83",117,0)
 Q X
"RTN","IBCEF83",118,0)
 ;
"RTN","IBCEF83",119,0)
IBXB1()    ; PROVIDER QUALIFIER
"RTN","IBCEF83",120,0)
 N X S X=""
"RTN","IBCEF83",121,0)
 S X=$P($G(IBDATA(1)),U,3)
"RTN","IBCEF83",122,0)
 Q X
"RTN","IBCEF83",123,0)
 ;
"RTN","IBCEF83",124,0)
IBXB2()    ; PROVIDER ID
"RTN","IBCEF83",125,0)
 N X S X=""
"RTN","IBCEF83",126,0)
 S X=$P($G(IBDATA(1)),U,4)
"RTN","IBCEF83",127,0)
 Q X
"RTN","IBCEF83",128,0)
 ;
"RTN","IBCEF83",129,0)
IBXB3()    ; PROVIDER NPI
"RTN","IBCEF83",130,0)
 N X S X=""
"RTN","IBCEF83",131,0)
 S X=$P($G(IBDATA(0)),U,4)
"RTN","IBCEF83",132,0)
 Q X
"RTN","IBCEF83",133,0)
 ;
"RTN","IBCEF83",134,0)
IBXC1()    ; CLAIM LINE COUNT
"RTN","IBCEF83",135,0)
 N X S X=""
"RTN","IBCEF83",136,0)
 S X=$P($G(IBXPROV("SLC")),U,1)
"RTN","IBCEF83",137,0)
 Q X
"RTN","IBCEF83",138,0)
 ;
"RTN","IBCEF83",139,0)
CMSBOX24(IBIEN,IBXIJ,IBXDATA)    ; PROVIDER QUALIFIER or PROVIDER ID and PROVIDER NPI FOR CMS-1500 BOX J
"RTN","IBCEF83",140,0)
 ;
"RTN","IBCEF83",141,0)
 ; IBIEN = CLAIM/BILL INTERNAL NUMBER
"RTN","IBCEF83",142,0)
 ; IBXIJ = "I" for COLUMN I or "J" for COLUMN J
"RTN","IBCEF83",143,0)
 ; IBXDATA = RETURN DATA ARRAY
"RTN","IBCEF83",144,0)
 ;
"RTN","IBCEF83",145,0)
 K IBXDATA
"RTN","IBCEF83",146,0)
 I $G(IBIEN)="" Q
"RTN","IBCEF83",147,0)
 I $G(IBXIJ)="" Q
"RTN","IBCEF83",148,0)
 I '$G(IBXFORM) N IBXFORM S IBXFORM=99
"RTN","IBCEF83",149,0)
 N CLINE,X,IBREND,CPLNK,IBXDCNT
"RTN","IBCEF83",150,0)
 S X=$$GETPRV(IBIEN)
"RTN","IBCEF83",151,0)
 I $D(IBXPROV("CMBX24IX"))=0 D CMBX24IX
"RTN","IBCEF83",152,0)
 S IBXDCNT=0
"RTN","IBCEF83",153,0)
 S CLINE=0 F  S CLINE=$O(IBXSAVE("BOX24",CLINE)) Q:+CLINE=0  D
"RTN","IBCEF83",154,0)
 . S CPLNK=$G(IBXSAVE("BOX24",CLINE,"CPLNK")) Q:CPLNK=""
"RTN","IBCEF83",155,0)
 . S IBREND=$P($G(IBXPROV("L-PROV",IBIEN,CPLNK,"C",1,3)),U,1)
"RTN","IBCEF83",156,0)
 . I IBREND'="" S IBREND=$G(IBXPROV("CMBX24IX",IBREND))
"RTN","IBCEF83",157,0)
 . I IBREND="" S IBREND=$G(IBXPROV("CMBX24IX","CLAIM"))
"RTN","IBCEF83",158,0)
 . S:IBXIJ="I" IBXDCNT=IBXDCNT+1,IBXDATA(IBXDCNT)=$P(IBREND,U,2)
"RTN","IBCEF83",159,0)
 . S:IBXIJ="I" IBXDCNT=IBXDCNT+1,IBXDATA(IBXDCNT)=""
"RTN","IBCEF83",160,0)
 . S:IBXIJ="J" IBXDCNT=IBXDCNT+1,IBXDATA(IBXDCNT)=$P(IBREND,U,3)
"RTN","IBCEF83",161,0)
 . S:IBXIJ="J" IBXDCNT=IBXDCNT+1,IBXDATA(IBXDCNT)=$P(IBREND,U,1)
"RTN","IBCEF83",162,0)
 I IBXFORM=99 K IBXPROV
"RTN","IBCEF83",163,0)
 Q
"RTN","IBCEF83",164,0)
 ;
"RTN","IBCEF83",165,0)
CMBX24IX    ; PROVIDER INDEX FOR CMS-1500 BOX I and J.
"RTN","IBCEF83",166,0)
 N SLC,IBXPTR
"RTN","IBCEF83",167,0)
 S SLC=0 F  S SLC=$O(IBXPROV("L-PROV",IBIEN,SLC)) Q:+SLC=0  D
"RTN","IBCEF83",168,0)
 . S IBXPTR=$P($G(IBXPROV("L-PROV",IBIEN,SLC,"C",1,3)),U,1)
"RTN","IBCEF83",169,0)
 . Q:IBXPTR=""
"RTN","IBCEF83",170,0)
 . S IBXPROV("CMBX24IX",IBXPTR)=""
"RTN","IBCEF83",171,0)
 . S IBXPROV("CMBX24IX",IBXPTR)=IBXPROV("CMBX24IX",IBXPTR)_$P($G(IBXPROV("L-PROV",IBIEN,SLC,"C",1,3,0)),U,4)_U  ; PROVIDER NPI
"RTN","IBCEF83",172,0)
 . S IBXPROV("CMBX24IX",IBXPTR)=IBXPROV("CMBX24IX",IBXPTR)_$P($G(IBXPROV("L-PROV",IBIEN,SLC,"C",1,3,1)),U,3)_U  ; PROVIDER QUALIFIER
"RTN","IBCEF83",173,0)
 . S IBXPROV("CMBX24IX",IBXPTR)=IBXPROV("CMBX24IX",IBXPTR)_$P($G(IBXPROV("L-PROV",IBIEN,SLC,"C",1,3,1)),U,4)    ; PROVIDER ID
"RTN","IBCEF83",174,0)
 S IBXPTR=$P($G(IBXPROV("PROVINF",IBIEN,"C",1,3)),U,1)
"RTN","IBCEF83",175,0)
 Q:IBXPTR=""
"RTN","IBCEF83",176,0)
 S IBXPROV("CMBX24IX",IBXPTR)=""
"RTN","IBCEF83",177,0)
 S IBXPROV("CMBX24IX",IBXPTR)=IBXPROV("CMBX24IX",IBXPTR)_$P($G(IBXPROV("PROVINF",IBIEN,"C",1,3,0)),U,4)_U       ; PROVIDER NPI
"RTN","IBCEF83",178,0)
 S IBXPROV("CMBX24IX",IBXPTR)=IBXPROV("CMBX24IX",IBXPTR)_$P($G(IBXPROV("PROVINF",IBIEN,"C",1,3,1)),U,3)_U       ; PROVIDER QUALIFIER
"RTN","IBCEF83",179,0)
 S IBXPROV("CMBX24IX",IBXPTR)=IBXPROV("CMBX24IX",IBXPTR)_$P($G(IBXPROV("PROVINF",IBIEN,"C",1,3,1)),U,4)         ; PROVIDER ID
"RTN","IBCEF83",180,0)
 S IBXPROV("CMBX24IX","CLAIM")=""
"RTN","IBCEF83",181,0)
 S IBXPROV("CMBX24IX","CLAIM")=IBXPROV("CMBX24IX","CLAIM")_$P($G(IBXPROV("PROVINF",IBIEN,"C",1,3,0)),U,4)_U     ; PROVIDER NPI
"RTN","IBCEF83",182,0)
 S IBXPROV("CMBX24IX","CLAIM")=IBXPROV("CMBX24IX","CLAIM")_$P($G(IBXPROV("PROVINF",IBIEN,"C",1,3,1)),U,3)_U     ; PROVIDER QUALIFIER
"RTN","IBCEF83",183,0)
 S IBXPROV("CMBX24IX","CLAIM")=IBXPROV("CMBX24IX","CLAIM")_$P($G(IBXPROV("PROVINF",IBIEN,"C",1,3,1)),U,4)       ; PROVIDER ID
"RTN","IBCEF83",184,0)
 Q
"RTN","IBCEF83",185,0)
 ;
"RTN","IBCEF83",186,0)
MCRONBIL    ; DEFAULT NAME and COB ID.
"RTN","IBCEF83",187,0)
 S $P(IBDATA,U,1)=""
"RTN","IBCEF83",188,0)
 S $P(IBDATA("NAME"),U,1)="DEPT VETERANS AFFAIRS"
"RTN","IBCEF83",189,0)
 S $P(IBDATA("NAME"),U,2)=""
"RTN","IBCEF83",190,0)
 S $P(IBDATA("NAME"),U,3)=""
"RTN","IBCEF83",191,0)
 S $P(IBDATA("NAME"),U,4)=""
"RTN","IBCEF83",192,0)
 S $P(IBDATA("NAME"),U,5)=""
"RTN","IBCEF83",193,0)
 S $P(IBDATA("COBID"),U,1)="VAD000"
"RTN","IBCEF83",194,0)
 Q
"RTN","IBCEF83",195,0)
 ;
"RTN","IBCEF83",196,0)
UB047879(IBXIEN,X)     ; LOAD X ARRAY WITH THE DATA FOR UB FIELD 78 AND 79.
"RTN","IBCEF83",197,0)
 N Y
"RTN","IBCEF83",198,0)
 K X S X(1)="",X(2)=""
"RTN","IBCEF83",199,0)
 F Y=9,1,3 Q:X(2)'=""  D
"RTN","IBCEF83",200,0)
 . I X(1)'="" S X(2)=$$GETPRV(IBXIEN,,Y,"A1") Q:X(2)=""  D
"RTN","IBCEF83",201,0)
 .. I X(1)'="" S X(2)=X(2)_"^"_$$GETPRV(IBXIEN,,Y,"B1")
"RTN","IBCEF83",202,0)
 .. I X(1)'="" S X(2)=X(2)_"^"_$$GETPRV(IBXIEN,,Y,"B2")
"RTN","IBCEF83",203,0)
 .. I X(1)'="" S X(2)=X(2)_"^"_$$GETPRV(IBXIEN,,Y,"B3")
"RTN","IBCEF83",204,0)
 . Q:X(1)'=""
"RTN","IBCEF83",205,0)
 . S X(1)=$$GETPRV(IBXIEN,,Y,"A1") Q:X(1)=""
"RTN","IBCEF83",206,0)
 . S X(1)=X(1)_"^"_$$GETPRV(IBXIEN,,Y,"B1")
"RTN","IBCEF83",207,0)
 . S X(1)=X(1)_"^"_$$GETPRV(IBXIEN,,Y,"B2")
"RTN","IBCEF83",208,0)
 . S X(1)=X(1)_"^"_$$GETPRV(IBXIEN,,Y,"B3")
"RTN","IBCEF83",209,0)
 Q
"RTN","IBCEF84")
0^92^B4728757^n/a
"RTN","IBCEF84",1,0)
IBCEF84 ;ALB/BI - GET PROVIDER FUNCTIONS ;26-OCT-2010
"RTN","IBCEF84",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCEF84",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEF84",4,0)
 Q
"RTN","IBCEF84",5,0)
 ;
"RTN","IBCEF84",6,0)
CREATE(DA)    ; CREATE CONDITION ENTRY POINT.
"RTN","IBCEF84",7,0)
 ; CALLED FROM DICT 399, FIELDS .21 & 101 TRIGGERS FOR FIELD 27.
"RTN","IBCEF84",8,0)
 N TEST,X,INSDA,IBP
"RTN","IBCEF84",9,0)
 S TEST=0
"RTN","IBCEF84",10,0)
 ;
"RTN","IBCEF84",11,0)
 ; Test for Medicare Secondary and CURRENT BILL PAYER SEQUENCE ="T"
"RTN","IBCEF84",12,0)
 I $$GET1^DIQ(399,DA_",",.21,"I")="T",$$WNRBILL^IBEFUNC(DA,2) S TEST=1 Q TEST
"RTN","IBCEF84",13,0)
 ;
"RTN","IBCEF84",14,0)
 ; Test the CURRENT BILL PAYER SEQUENCE for "SECONDARY"
"RTN","IBCEF84",15,0)
 I $$GET1^DIQ(399,DA_",",.21,"I")'="S" Q TEST
"RTN","IBCEF84",16,0)
 ;
"RTN","IBCEF84",17,0)
 ; Test the PRIMARY INSURANCE CARRIER for "MEDICARE (WNR)"
"RTN","IBCEF84",18,0)
 I '$$WNRBILL^IBEFUNC(DA,1) Q TEST
"RTN","IBCEF84",19,0)
 ;
"RTN","IBCEF84",20,0)
 ; Set Primary Claim/Bill number.
"RTN","IBCEF84",21,0)
 S IBP=$$GET1^DIQ(399,DA_",",125,"I")
"RTN","IBCEF84",22,0)
 ; Test if the Primary Claim/Bill contains a MRA REQUESTED DATE.
"RTN","IBCEF84",23,0)
 I IBP'="",$$GET1^DIQ(399,IBP_",",7,"I")'="" Q TEST
"RTN","IBCEF84",24,0)
 ;
"RTN","IBCEF84",25,0)
 ; Test the PRINT SEC MED CLAIMS W/O MRA flag in dictionary 36 for YES.
"RTN","IBCEF84",26,0)
 S INSDA=$$GET1^DIQ(399,DA_",",102,"I")
"RTN","IBCEF84",27,0)
 I $$GET1^DIQ(36,INSDA_",",6.1,"I")'=1 Q TEST
"RTN","IBCEF84",28,0)
 ;
"RTN","IBCEF84",29,0)
 S TEST=1
"RTN","IBCEF84",30,0)
 Q TEST
"RTN","IBCEF84",31,0)
 ;
"RTN","IBCEF84",32,0)
DELETE(DA)    ; DELETE CONDITION ENTRY POINT.
"RTN","IBCEF84",33,0)
 ; CALLED FROM DICT 399, FIELDS .21 & 101 TRIGGERS FOR FIELD 27.
"RTN","IBCEF84",34,0)
 N TEST,X,INSDA
"RTN","IBCEF84",35,0)
 S TEST=0
"RTN","IBCEF84",36,0)
 ;
"RTN","IBCEF84",37,0)
 ; Test for Medicare Secondary and CURRENT BILL PAYER SEQUENCE ="T"
"RTN","IBCEF84",38,0)
 I $$GET1^DIQ(399,DA_",",.21,"I")="T",$$WNRBILL^IBEFUNC(DA,2) Q TEST
"RTN","IBCEF84",39,0)
 ;
"RTN","IBCEF84",40,0)
 ; Test the current value of FORCE CLAIM TO PRINT for "1"
"RTN","IBCEF84",41,0)
 I $$GET1^DIQ(399,DA_",",27,"I")'="1" Q TEST
"RTN","IBCEF84",42,0)
 ;
"RTN","IBCEF84",43,0)
 S TEST=1
"RTN","IBCEF84",44,0)
 ; 
"RTN","IBCEF84",45,0)
 ; Test the CURRENT BILL PAYER SEQUENCE for "SECONDARY"
"RTN","IBCEF84",46,0)
 I $$GET1^DIQ(399,DA_",",.21,"I")'="S" Q TEST
"RTN","IBCEF84",47,0)
 ;
"RTN","IBCEF84",48,0)
 ; Test the PRIMARY INSURANCE CARRIER for "MEDICARE (WNR)"
"RTN","IBCEF84",49,0)
 I '$$WNRBILL^IBEFUNC(DA,1) Q TEST
"RTN","IBCEF84",50,0)
 ;
"RTN","IBCEF84",51,0)
 ; Set Primary Claim/Bill number.
"RTN","IBCEF84",52,0)
 S IBP=$$GET1^DIQ(399,DA_",",125,"I")
"RTN","IBCEF84",53,0)
 ; Test if the Primary Claim/Bill contains a MRA REQUESTED DATE.
"RTN","IBCEF84",54,0)
 I IBP'="",$$GET1^DIQ(399,IBP_",",7,"I")'="" Q TEST
"RTN","IBCEF84",55,0)
 ;
"RTN","IBCEF84",56,0)
 ; Test the PRINT SEC MED CLAIMS W/O MRA flag in dictionary 36 for YES.
"RTN","IBCEF84",57,0)
 S INSDA=$$GET1^DIQ(399,DA_",",102,"I")
"RTN","IBCEF84",58,0)
 I $$GET1^DIQ(36,INSDA_",",6.1,"I")'=1 Q TEST
"RTN","IBCEF84",59,0)
 ;
"RTN","IBCEF84",60,0)
 S TEST=0
"RTN","IBCEF84",61,0)
 Q TEST
"RTN","IBCEF84",62,0)
 ;
"RTN","IBCEF84",63,0)
TEST(DA)    ; Tag to be called by the input template.
"RTN","IBCEF84",64,0)
 Q $$CREATE(DA)
"RTN","IBCEF84",65,0)
 ;
"RTN","IBCEF84",66,0)
MESSAGE    ; IF THE ABOVE TEST IS TRUE, THE FOLLOWING MESSAGE WILL BE DISPLAYED.
"RTN","IBCEF84",67,0)
 N X,Y,DIR
"RTN","IBCEF84",68,0)
 S DIR(0)="EA"
"RTN","IBCEF84",69,0)
 S DIR("A",1)="THIS FIELD CAN'T BE CHANGE"
"RTN","IBCEF84",70,0)
 S DIR("A")="PRESS RETURN TO CONTINUE: "
"RTN","IBCEF84",71,0)
 D ^DIR
"RTN","IBCEF84",72,0)
 Q
"RTN","IBCEFP")
0^89^B85133537^n/a
"RTN","IBCEFP",1,0)
IBCEFP ;ALB/TAZ - Provider ID functions ;28-OCT-10
"RTN","IBCEFP",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCEFP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEFP",4,0)
 ;
"RTN","IBCEFP",5,0)
 Q
"RTN","IBCEFP",6,0)
 ;
"RTN","IBCEFP",7,0)
ALLIDS(IBIFN,IBXSAVE,IBSTRIP,SEG) ; Return all of the Provider IDS
"RTN","IBCEFP",8,0)
 I '$D(IBSTRIP) S IBSTRIP=0
"RTN","IBCEFP",9,0)
 I '$D(SEG) S SEG=""
"RTN","IBCEFP",10,0)
 N IBXIEN,ARINFO,ARID,ARQ,IBFRMTYP,ARIEN,ARINS,Z0,DAT,I,SORT1,SORT2,SORT3,COB,IBCCOB,IBCARE,IBCURR,IBXDATA,NPI,CUROTH
"RTN","IBCEFP",11,0)
 ;
"RTN","IBCEFP",12,0)
 S IBFRMTYP=$$FT^IBCEF(IBIFN),IBFRMTYP=$S(IBFRMTYP=2:2,IBFRMTYP=3:1,1:0)
"RTN","IBCEFP",13,0)
 S IBCARE=$S($$ISRX^IBCEF1(IBIFN):3,1:0) ;if an Rx refill bill
"RTN","IBCEFP",14,0)
 S:IBCARE=0 IBCARE=$$INPAT^IBCEF(IBIFN,1) S:'IBCARE IBCARE=2 ;1-inp,2-out
"RTN","IBCEFP",15,0)
 S IBCURR=$$COB^IBCEF(IBIFN) ;current bill payer sequence
"RTN","IBCEFP",16,0)
 ;don't create anything if form type not CMS-1500 or UB
"RTN","IBCEFP",17,0)
 I IBFRMTYP,'+$G(IBXSAVE("PROVINF",IBIFN)) D
"RTN","IBCEFP",18,0)
 . N IBZ,CUROTH
"RTN","IBCEFP",19,0)
 . I IBFRMTYP=2 D OUTPT^IBCEF11(IBIFN,0)
"RTN","IBCEFP",20,0)
 . I IBFRMTYP=1 D HOS^IBCEF22(IBIFN)
"RTN","IBCEFP",21,0)
 . F CUROTH="C","O" D PROVIDER(IBIFN,CUROTH,.IBZ,IBFRMTYP,IBCARE,IBCURR,.IBXDATA) M IBXSAVE=IBZ
"RTN","IBCEFP",22,0)
 . S IBXSAVE("PROVINF",IBIFN)=IBIFN
"RTN","IBCEFP",23,0)
 . Q
"RTN","IBCEFP",24,0)
 ;
"RTN","IBCEFP",25,0)
 D LFIDS^IBCEF76(IBIFN,.IBXSAVE,IBSTRIP,SEG)   ; Get the Lab/Facility IDs
"RTN","IBCEFP",26,0)
 S NPI=$P($$ORGNPI^IBCEF73A(IBIFN),U,1)
"RTN","IBCEFP",27,0)
 F CUROTH="C","O" D
"RTN","IBCEFP",28,0)
 . S IBXSAVE("LAB/FAC",IBIFN,CUROTH,1,0)=$S(NPI]"":"XX",1:"")_U_NPI
"RTN","IBCEFP",29,0)
 ;
"RTN","IBCEFP",30,0)
 S IBFRMTYP=$$FT^IBCEF(IBIFN)
"RTN","IBCEFP",31,0)
 S ARIEN=$S(IBFRMTYP=2:3,1:4)
"RTN","IBCEFP",32,0)
 S IBCCOB=$$COBN^IBCEF(IBIFN)  ; Current Insurance
"RTN","IBCEFP",33,0)
 F COB=1:1:3 D
"RTN","IBCEFP",34,0)
 . S SORT1=$S(COB=IBCCOB:"C",1:"O")
"RTN","IBCEFP",35,0)
 . S SORT2=$S(SORT1="C":1,COB=1:1,COB=2&(IBCCOB=1):1,1:2)
"RTN","IBCEFP",36,0)
 . S ARINFO=$G(IBXSAVE("PROVINF",IBIFN,SORT1,SORT2,ARIEN,1))
"RTN","IBCEFP",37,0)
 . ;
"RTN","IBCEFP",38,0)
 . D BPIDS^IBCEF75(IBIFN,.IBXSAVE,SORT1,SORT2,COB,IBSTRIP,SEG)
"RTN","IBCEFP",39,0)
 ;
"RTN","IBCEFP",40,0)
 D EN^IBCEF81(.IBXSAVE)
"RTN","IBCEFP",41,0)
 ;
"RTN","IBCEFP",42,0)
 I SEG="OPR1" D
"RTN","IBCEFP",43,0)
 . I '$D(IBXSAVE("PROVINF",IBIFN,"C",1,3)) D  G ALLIDSQ
"RTN","IBCEFP",44,0)
 .. N SLC,CRED S SLC=0
"RTN","IBCEFP",45,0)
 .. F  S SLC=$O(IBXSAVE("L-PROV",IBIFN,SLC)) Q:'SLC  D  I $D(IBXSAVE("PROVINF",IBIFN,"C",1,3,"NAME")) Q
"RTN","IBCEFP",46,0)
 ... S CRED=$P($G(IBXSAVE("L-PROV",IBIFN,SLC,"C",1,3,"NAME")),U,4)
"RTN","IBCEFP",47,0)
 ... I CRED]"" S $P(IBXSAVE("PROVINF",IBIFN,"C",1,3,"NAME"),U,4)=CRED
"RTN","IBCEFP",48,0)
 ;
"RTN","IBCEFP",49,0)
 I SEG="LPUR",$$SUB1OK^IBCEP8A(IBIFN),$G(IBXSAVE("SLC")) D  G ALLIDSQ
"RTN","IBCEFP",50,0)
 . N IBCNT,OUT,SID,SIDQ,IBPID,LINE
"RTN","IBCEFP",51,0)
 . S (SID,SIDQ)=""
"RTN","IBCEFP",52,0)
 . F LINE=1:1 Q:'$D(IBXSAVE("LAB/FAC",IBIFN,"C",1,LINE))  D  I SID'="" Q
"RTN","IBCEFP",53,0)
 .. S SIDQ=$P($G(IBXSAVE("LAB/FAC",IBIFN,"C",1,LINE)),U) I ",0B,1G,G2,"'[(","_SIDQ_",") Q
"RTN","IBCEFP",54,0)
 .. S SID=$P($G(IBXSAVE("LAB/FAC",IBIFN,"C",1,LINE)),U,2)
"RTN","IBCEFP",55,0)
 . ;S $P(OUT,U,6)=$P($G(IBXSAVE("LAB/FAC",IBIFN,"C",1,0)),U,2) ; primary id
"RTN","IBCEFP",56,0)
 . ;IB*2.0*432/TAZ - changed to make sure there is an ID for the Non-VA Service Facility
"RTN","IBCEFP",57,0)
 . S IBPID=$P($G(IBXSAVE("LAB/FAC",IBIFN,"C",1,0)),U,2) ; primary id
"RTN","IBCEFP",58,0)
 . I (IBPID=""),(SID="") D
"RTN","IBCEFP",59,0)
 .. S IBPID=$P($G(IBXSAVE("PROVINF",IBIFN,"C",1,3,0)),U,4)  ; Get claim level Rendering Provider NPI
"RTN","IBCEFP",60,0)
 .. I IBPID="",$D(IBXSAVE("L-PROV")) D
"RTN","IBCEFP",61,0)
 ... F LINE=1:1:$O(IBXSAVE("L-PROV",IBIFN,""),-1) D  I IBPID'="" Q
"RTN","IBCEFP",62,0)
 .... S IBPID=$P($G(IBXSAVE("L-PROV",IBIFN,LINE,"C",1,3,0)),U,4)
"RTN","IBCEFP",63,0)
 . S $P(OUT,U,6)=IBPID
"RTN","IBCEFP",64,0)
 . S $P(OUT,U,7)=SID ; secondary id (1)
"RTN","IBCEFP",65,0)
 . S $P(OUT,U,8)=SIDQ ; secondary id qualifier(1)
"RTN","IBCEFP",66,0)
 . F IBCNT=1:1:IBXSAVE("SLC") S IBXSAVE("SLPRV",IBCNT)=OUT,IBXSAVE("SLPRV",IBCNT,"SLC")=IBCNT
"RTN","IBCEFP",67,0)
 ;
"RTN","IBCEFP",68,0)
 I SEG="LOPE" D SLPRV(IBIFN,.IBXSAVE,2) G ALLIDSQ
"RTN","IBCEFP",69,0)
 I SEG="LOP1" D SLPRV(IBIFN,.IBXSAVE,9) G ALLIDSQ
"RTN","IBCEFP",70,0)
 I SEG="LREN" D SLPRV(IBIFN,.IBXSAVE,3) G ALLIDSQ
"RTN","IBCEFP",71,0)
 I SEG="LSUP" D SLPRV(IBIFN,.IBXSAVE,5) G ALLIDSQ
"RTN","IBCEFP",72,0)
 I SEG="LREF" D SLPRV(IBIFN,.IBXSAVE,1) G ALLIDSQ
"RTN","IBCEFP",73,0)
 ;
"RTN","IBCEFP",74,0)
ALLIDSQ ;
"RTN","IBCEFP",75,0)
 Q
"RTN","IBCEFP",76,0)
 ;
"RTN","IBCEFP",77,0)
SLPRV(IBXIEN,IBX,PRTYPE) ;Build SLPRV nodes for the line provider type record
"RTN","IBCEFP",78,0)
 N SLC,DATA,IBCNT,NAME,OUT
"RTN","IBCEFP",79,0)
 S (SLC,IBCNT)=0
"RTN","IBCEFP",80,0)
 F  S SLC=$O(IBX("L-PROV",IBXIEN,SLC)) Q:'SLC  D
"RTN","IBCEFP",81,0)
 . I '$D(IBX("L-PROV",IBXIEN,SLC,"C",1,PRTYPE)) Q
"RTN","IBCEFP",82,0)
 . S NAME=$G(IBX("L-PROV",IBXIEN,SLC,"C",1,PRTYPE,"NAME"))
"RTN","IBCEFP",83,0)
 . S OUT=$P(NAME,U,1,3)_U_$P(NAME,U,5)_U_$G(IBX("L-PROV",IBXIEN,SLC,"C",1,PRTYPE,"TAXONOMY"))_U_$P($G(IBX("L-PROV",IBXIEN,SLC,"C",1,PRTYPE,0)),U,4)
"RTN","IBCEFP",84,0)
 . F IBN=1:1 Q:'$D(IBX("L-PROV",IBXIEN,SLC,"C",1,PRTYPE,IBN))  D
"RTN","IBCEFP",85,0)
 .. S DATA=$G(IBX("L-PROV",IBXIEN,SLC,"C",1,PRTYPE,IBN))
"RTN","IBCEFP",86,0)
 .. I ",0B,1G,G2,LU,"[(","_$P(DATA,U,3)_",") S OUT=OUT_U_$P(DATA,U,4)_U_$P(DATA,U,3)
"RTN","IBCEFP",87,0)
 . S IBCNT=IBCNT+1
"RTN","IBCEFP",88,0)
 . S IBX("SLPRV",IBCNT)=OUT
"RTN","IBCEFP",89,0)
 . S IBX("SLPRV",IBCNT,"SLC")=SLC
"RTN","IBCEFP",90,0)
SLPRVQ ;
"RTN","IBCEFP",91,0)
 Q
"RTN","IBCEFP",92,0)
 ;
"RTN","IBCEFP",93,0)
 ;PROVIDER
"RTN","IBCEFP",94,0)
 ;Input:
"RTN","IBCEFP",95,0)
 ; IB399 - ien of #399
"RTN","IBCEFP",96,0)
 ; IBPROV:
"RTN","IBCEFP",97,0)
 ;   "C"- to get info for CURRENT provider
"RTN","IBCEFP",98,0)
 ;   "O"- to get info for all others (in this case the array will contain info fot two providers
"RTN","IBCEFP",99,0)
 ; IBRES - array for results (by reference)
"RTN","IBCEFP",100,0)
 ; IBFRMTYP - Form Type
"RTN","IBCEFP",101,0)
 ; IBCARE - Care Type
"RTN","IBCEFP",102,0)
 ; IBCURR - current bill payer sequence
"RTN","IBCEFP",103,0)
 ;
"RTN","IBCEFP",104,0)
 ;Output:
"RTN","IBCEFP",105,0)
 ; IBRES - array to get back info (by reference)
"RTN","IBCEFP",106,0)
 ; IBRES(IBPROV,PRNUM,PRTYPE,SEQ#)=PROV^INSUR^IDTYPE^ID^FORMTYP^CARETYP
"RTN","IBCEFP",107,0)
 ; where:
"RTN","IBCEFP",108,0)
 ; IBPROV - see input parameter
"RTN","IBCEFP",109,0)
 ; PRNUM: 1=primary insurance provider, 2= secondary, 3 -tretiary
"RTN","IBCEFP",110,0)
 ; PRTYPE: Provider type(FUNCTION) 
"RTN","IBCEFP",111,0)
 ; SEQ# : sequence number (1st is used for ID1, 2nd - for ID2, etc)
"RTN","IBCEFP",112,0)
 ; PROV : provider/VARIABLEPTR
"RTN","IBCEFP",113,0)
 ; INSUR: Insurance PTR #36 or NONE
"RTN","IBCEFP",114,0)
 ; IDTYPE: ID type
"RTN","IBCEFP",115,0)
 ; ID: ID 
"RTN","IBCEFP",116,0)
 ; FORMTYP: Form type 1=UB,2=1500
"RTN","IBCEFP",117,0)
 ; CARETYP: Care type 0=both inp/outp,1=inpatient, 2=outpatient
"RTN","IBCEFP",118,0)
PROVIDER(IB399,IBPROV,IBRES,IBFRMTYP,IBCARE,IBCURR,IBXDATA) ;
"RTN","IBCEFP",119,0)
 N IBZ,IBRESARR,IBLIMIT
"RTN","IBCEFP",120,0)
 S IBRESARR=""
"RTN","IBCEFP",121,0)
 Q:IBPROV="A"  ;PATIENT's bill
"RTN","IBCEFP",122,0)
 I IBPROV="C" D
"RTN","IBCEFP",123,0)
 . S IBLIMIT=5
"RTN","IBCEFP",124,0)
 . D:$$ISINSUR^IBCEF71(IBCURR,IB399) PROVINF(IB399,$S(IBCURR="T":3,IBCURR="S":2,IBCURR="P":1,1:1),.IBRESARR,1,IBPROV,IBFRMTYP,IBCARE,IBLIMIT,IBCURR,.IBXDATA)
"RTN","IBCEFP",125,0)
 I IBPROV="O" D
"RTN","IBCEFP",126,0)
 . S IBLIMIT=3
"RTN","IBCEFP",127,0)
 . I IBCURR="P" D
"RTN","IBCEFP",128,0)
 .. D:$$ISINSUR^IBCEF71("S",IB399) PROVINF(IB399,2,.IBRESARR,1,IBPROV,IBFRMTYP,IBCARE,IBLIMIT,IBCURR,.IBXDATA)
"RTN","IBCEFP",129,0)
 .. D:$$ISINSUR^IBCEF71("T",IB399) PROVINF(IB399,3,.IBRESARR,2,IBPROV,IBFRMTYP,IBCARE,IBLIMIT,IBCURR,.IBXDATA)
"RTN","IBCEFP",130,0)
 . I IBCURR="S" D
"RTN","IBCEFP",131,0)
 .. D:$$ISINSUR^IBCEF71("P",IB399) PROVINF(IB399,1,.IBRESARR,1,IBPROV,IBFRMTYP,IBCARE,IBLIMIT,IBCURR,.IBXDATA)
"RTN","IBCEFP",132,0)
 .. D:$$ISINSUR^IBCEF71("T",IB399) PROVINF(IB399,3,.IBRESARR,2,IBPROV,IBFRMTYP,IBCARE,IBLIMIT,IBCURR,.IBXDATA)
"RTN","IBCEFP",133,0)
 . I IBCURR="T" D
"RTN","IBCEFP",134,0)
 .. D:$$ISINSUR^IBCEF71("P",IB399) PROVINF(IB399,1,.IBRESARR,1,IBPROV,IBFRMTYP,IBCARE,IBLIMIT,IBCURR,.IBXDATA)
"RTN","IBCEFP",135,0)
 .. D:$$ISINSUR^IBCEF71("S",IB399) PROVINF(IB399,2,.IBRESARR,2,IBPROV,IBFRMTYP,IBCARE,IBLIMIT,IBCURR,.IBXDATA)
"RTN","IBCEFP",136,0)
 M IBRES=IBRESARR
"RTN","IBCEFP",137,0)
 Q
"RTN","IBCEFP",138,0)
 ;
"RTN","IBCEFP",139,0)
 ;-- PROVINF --
"RTN","IBCEFP",140,0)
 ;Create array with prov info
"RTN","IBCEFP",141,0)
 ;Input:
"RTN","IBCEFP",142,0)
 ; IB399 - ien #399
"RTN","IBCEFP",143,0)
 ; IBPRNUM - 1=prim ins, 2= sec, 3 -tert
"RTN","IBCEFP",144,0)
 ; IBRES - for results
"RTN","IBCEFP",145,0)
 ; IBSORT - to sort OTHER INSURANCE data 
"RTN","IBCEFP",146,0)
 ;  if PROVINF is called for "C" mode of PROVIDER subroutine then 
"RTN","IBCEFP",147,0)
 ;    IBSORT can be any (say 1)
"RTN","IBCEFP",148,0)
 ;  if PROVINF is called for "O" mode then can be more than set of data
"RTN","IBCEFP",149,0)
 ;    - need to sort array to use it (like IBXDATA(1) and IBXDATA(2))
"RTN","IBCEFP",150,0)
 ;    for mode "O" it should be 1 or 2 (see PROVIDER section)
"RTN","IBCEFP",151,0)
 ;IBINSTP -  "C" -current ins, "O"-other
"RTN","IBCEFP",152,0)
 ;IBFRMTYP - Form Type
"RTN","IBCEFP",153,0)
 ;IBCARE - Care Type
"RTN","IBCEFP",154,0)
 ;IBLIMIT - Limits on Secondary
"RTN","IBCEFP",155,0)
 ;IBCURR - Current Insurance
"RTN","IBCEFP",156,0)
 ;IBXDAYA - Revenue Code Array
"RTN","IBCEFP",157,0)
 ;Output:
"RTN","IBCEFP",158,0)
 ; IBRES(PRNUM,PRTYPE,SEQ#)=PROV^INSUR^IDTYPE^ID^FORMTYP^CARETYP
"RTN","IBCEFP",159,0)
 ; where:(see PROVIDER)
"RTN","IBCEFP",160,0)
PROVINF(IB399,IBPRNUM,IBRES,IBSORT,IBINSTP,IBFRMTYP,IBCARE,IBLIMIT,IBCURR,IBXDATA) ;
"RTN","IBCEFP",161,0)
 I $G(IB399)="" G PROVINFQ
"RTN","IBCEFP",162,0)
 I $G(IBINSTP)="" G PROVINFQ
"RTN","IBCEFP",163,0)
 I +$G(IBSORT)=0 S IBSORT=$G(IBPRNUM)
"RTN","IBCEFP",164,0)
 N IBPRTYP,IBINSCO,IBPROV,IB35591,IBN,IBEXC
"RTN","IBCEFP",165,0)
 S IBN=0
"RTN","IBCEFP",166,0)
 S IBINSCO=+$P($G(^DGCR(399,IB399,"M")),"^",IBPRNUM)
"RTN","IBCEFP",167,0)
 S IB35591=$$CH35591^IBCEF72(IBINSCO,IBFRMTYP,IBCARE)
"RTN","IBCEFP",168,0)
 S IBPRTYP=0
"RTN","IBCEFP",169,0)
 F  S IBPRTYP=$O(^DGCR(399,IB399,"PRV","B",IBPRTYP)) Q:'IBPRTYP  D
"RTN","IBCEFP",170,0)
 . N Z,IB355OV,IBPROV,IBARR
"RTN","IBCEFP",171,0)
 . S IBPROV=$$PROVPTR(IB399,IBPRTYP,0),IBEXC=""
"RTN","IBCEFP",172,0)
 . Q:+IBPROV=0
"RTN","IBCEFP",173,0)
 . S Z=$O(^DGCR(399,IB399,"PRV","B",IBPRTYP,0)) I Z S Z=$G(^DGCR(399,IB399,"PRV",Z,0))
"RTN","IBCEFP",174,0)
 . D GETPRV(IBINSCO,IBFRMTYP,IBCARE,IBPROV,.IBARR,IBPRTYP,IBINSTP,Z)
"RTN","IBCEFP",175,0)
 . M IBRES("PROVINF",IB399,IBINSTP)=IBARR
"RTN","IBCEFP",176,0)
 I $D(IBRES("PROVINF",IB399,IBINSTP,IBSORT))>1 S IBRES("PROVINF",IB399,IBINSTP,IBSORT)=$S(IBPRNUM=3:"T",IBPRNUM=2:"S",1:"P")
"RTN","IBCEFP",177,0)
 N SLC,CPLNK
"RTN","IBCEFP",178,0)
 S SLC=0
"RTN","IBCEFP",179,0)
 F  S SLC=$O(IBXDATA(SLC)) Q:'SLC   S IBXSAVE("SLC")=+SLC D
"RTN","IBCEFP",180,0)
 . S CPLNK=$G(IBXDATA(SLC,"CPLNK")) I 'CPLNK Q
"RTN","IBCEFP",181,0)
 . S IBPRTYP=0
"RTN","IBCEFP",182,0)
 . F  S IBPRTYP=$O(^DGCR(399,IB399,"CP",CPLNK,"LNPRV","B",IBPRTYP)) Q:'IBPRTYP  D
"RTN","IBCEFP",183,0)
 .. N Z,IBPROV,IBARR
"RTN","IBCEFP",184,0)
 .. S IBPROV=$$PROVPTR(IB399,IBPRTYP,CPLNK),IBEXC=""
"RTN","IBCEFP",185,0)
 .. Q:'+IBPROV
"RTN","IBCEFP",186,0)
 .. S Z=$O(^DGCR(399,IB399,"CP",CPLNK,"LNPRV","B",IBPRTYP,0)) I Z S Z=$G(^DGCR(399,IB399,"CP",CPLNK,"LNPRV",Z,0))
"RTN","IBCEFP",187,0)
 .. D GETPRV(IBINSCO,IBFRMTYP,IBCARE,IBPROV,.IBARR,IBPRTYP,IBINSTP,Z)
"RTN","IBCEFP",188,0)
 .. M IBRES("L-PROV",IB399,SLC,IBINSTP)=IBARR
"RTN","IBCEFP",189,0)
 . I $D(IBRES("L-PROV",IB399,SLC,IBINSTP,IBSORT))>1 S IBRES("L-PROV",IB399,SLC,IBINSTP,IBSORT)=$S(IBPRNUM=3:"T",IBPRNUM=2:"S",1:"P")
"RTN","IBCEFP",190,0)
 ;
"RTN","IBCEFP",191,0)
PROVINFQ ;Exit PROVINF
"RTN","IBCEFP",192,0)
 Q
"RTN","IBCEFP",193,0)
 ;
"RTN","IBCEFP",194,0)
GETPRV(IBINSCO,IBFRMTYP,IBCARE,IBPROV,IBRES,IBPRTYP,IBINSTP,IBD) ;
"RTN","IBCEFP",195,0)
 I "CO"'[$G(IBINSTP) G GETPRVQ
"RTN","IBCEFP",196,0)
 N IBRETARR,IBNPI,IBN,IBMRAND,IB355OV S IBRETARR=0,IB355OV=""
"RTN","IBCEFP",197,0)
 D PRACT^IBCEF71(IBINSCO,IBFRMTYP,IBCARE,IBPROV,.IBRETARR,IBPRTYP,$G(IBINSTP))
"RTN","IBCEFP",198,0)
 I $P(IBD,U,IBPRNUM+4)'="",$P(IBD,U,IBPRNUM+11)'="" S IB355OV=$P(IBD,U,IBPRNUM+4)_U_$P(IBD,U,IBPRNUM+11)
"RTN","IBCEFP",199,0)
 S IBN=0,IBMRAND=$$MCRONBIL^IBEFUNC(IB399)
"RTN","IBCEFP",200,0)
 ;Calculate MEDICARE (WNR) specific provider qualifier and ID for CMS-1500 secondary claims
"RTN","IBCEFP",201,0)
 I "34"[$G(IBPRTYP),$G(IBFRMTYP)=2,IBMRAND S IB355OV=$$MCR24K^IBCEU3(IB399,IBPROV)_"^12"
"RTN","IBCEFP",202,0)
 I $P(IB355OV,U,2) D
"RTN","IBCEFP",203,0)
 . I $$CHCKSEC^IBCEF73(IBFRMTYP,IBPRTYP,$G(IBINSTP),$P($G(^IBE(355.97,+$P(IB355OV,U,2),0)),U,3)) D
"RTN","IBCEFP",204,0)
 .. S IBEXC=$P(IB355OV,U,2),IBN=IBN+1,IBRES(IBSORT,IBPRTYP,IBN)="OVERRIDE^"_IBINSCO_U_$P($G(^IBE(355.97,+IBEXC,0)),U,3)_U_$P(IB355OV,U)_"^^^^^"_+IBEXC
"RTN","IBCEFP",205,0)
 I IB35591'="",IBEXC'=$P(IB35591,U,3) I $$CHCKSEC^IBCEF73(IBFRMTYP,IBPRTYP,$G(IBINSTP),$P(IB35591,"^")) D
"RTN","IBCEFP",206,0)
 . S IBN=IBN+1,IBRES(IBSORT,IBPRTYP,IBN)="DEFAULT^"_IBINSCO_"^"_IB35591_"^^",$P(IBRES(IBSORT,IBPRTYP,IBN),U,9)=$P(IB35591,U,3)
"RTN","IBCEFP",207,0)
 S IBNPI=$$NPI^IBCEFP1(IBPROV)
"RTN","IBCEFP",208,0)
 D SORT^IBCEF77(IBSORT,IBPRTYP,IB399,.IBRETARR,.IBRES,IBN,IBEXC,IBPRNUM,IBLIMIT)
"RTN","IBCEFP",209,0)
 S IBRES(IBSORT,IBPRTYP,0)="PRIMARY"_U_U_$$STRIP^IBCEF76($S(IBNPI]"":"XX",1:"")_U_IBNPI,1,U,IBSTRIP)
"RTN","IBCEFP",210,0)
 F IBN=1:1 Q:'$D(IBRES(IBSORT,IBPRTYP,IBN))  S $P(IBRES(IBSORT,IBPRTYP,IBN),U,3,4)=$$STRIP^IBCEF76($P(IBRES(IBSORT,IBPRTYP,IBN),U,3,4),1,U,IBSTRIP)
"RTN","IBCEFP",211,0)
 S IBRES(IBSORT,IBPRTYP,"NAME")=$$NAME^IBCEFP1(IBPROV,IBIFN,$P(IBD,U,3),$P(IBD,U,8))
"RTN","IBCEFP",212,0)
 S IBRES(IBSORT,IBPRTYP,"ENTITY TYPE")=$S(IBPROV'["355.93,":1,$P($G(^IBA(355.93,+IBPROV,0)),U,2)=2:1,1:2)
"RTN","IBCEFP",213,0)
 S IBRES(IBSORT,IBPRTYP,"TAXONOMY")=$$TAXON^IBCEFP1(IBPROV,$P(IBD,U,15))
"RTN","IBCEFP",214,0)
 S IBRES(IBSORT,IBPRTYP,"COBID")=$$COBID^IBCEFP1(IB399,IBPRTYP,IBMRAND,IBD)
"RTN","IBCEFP",215,0)
 S IBRES(IBSORT,IBPRTYP)=IBPROV
"RTN","IBCEFP",216,0)
GETPRVQ ;
"RTN","IBCEFP",217,0)
 Q
"RTN","IBCEFP",218,0)
 ;
"RTN","IBCEFP",219,0)
PROVPTR(IBIEN399,IBFUNC,IBCP) ; Retrieve Provider Pointer from appropriate file
"RTN","IBCEFP",220,0)
 N IBN,RSLT
"RTN","IBCEFP",221,0)
 S IBCP=+$G(IBCP)
"RTN","IBCEFP",222,0)
 I 'IBCP D
"RTN","IBCEFP",223,0)
 . S IBN=$O(^DGCR(399,IBIEN399,"PRV","B",IBFUNC,0))
"RTN","IBCEFP",224,0)
 . I +IBN=0 S RSLT=0 Q
"RTN","IBCEFP",225,0)
 . S RSLT=$P($G(^DGCR(399,IBIEN399,"PRV",+IBN,0)),U,2)
"RTN","IBCEFP",226,0)
 I IBCP D
"RTN","IBCEFP",227,0)
 . S IBN=$O(^DGCR(399,IBIEN399,"CP",IBCP,"LNPRV","B",IBFUNC,0))
"RTN","IBCEFP",228,0)
 . I +IBN=0 S RSLT=0 Q
"RTN","IBCEFP",229,0)
 . S RSLT=$P($G(^DGCR(399,IBIEN399,"CP",IBCP,"LNPRV",+IBN,0)),U,2)
"RTN","IBCEFP",230,0)
 Q RSLT
"RTN","IBCEFP",231,0)
 ;
"RTN","IBCEFP1")
0^90^B10606502^n/a
"RTN","IBCEFP1",1,0)
IBCEFP1 ;ALB/GEF - OUTPUT FORMATTER PROVIDER UTILITIES ;28-OCT-10
"RTN","IBCEFP1",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCEFP1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEFP1",4,0)
 ;
"RTN","IBCEFP1",5,0)
 Q
"RTN","IBCEFP1",6,0)
 ;
"RTN","IBCEFP1",7,0)
NAME(IBDATA,IBIFN,IBCRED,IBSPEC) ; Parse person's nm into 6 pieces LAST^FIRST^MIDDLE^CRED^SUFFIX^SPECIALITY
"RTN","IBCEFP1",8,0)
 ; IBDATA = IEN;GLOBAL REFERENCE of Variable Pointer
"RTN","IBCEFP1",9,0)
 ; IBIFN = Claim ien 
"RTN","IBCEFP1",10,0)
 ;
"RTN","IBCEFP1",11,0)
 N IBNM,IBNMC,IBGLB,IBFN,IBDT
"RTN","IBCEFP1",12,0)
 S IBGLB=$P(IBDATA,";",2),IBFN=$TR($P(IBGLB,"(",2),",","")
"RTN","IBCEFP1",13,0)
 S IBNMC=$$GET1^DIQ(IBFN,+IBDATA,.01)
"RTN","IBCEFP1",14,0)
 I $G(IBCRED)="" S IBCRED=$$CRED^IBCEU(IBDATA) ;Degree
"RTN","IBCEFP1",15,0)
 S IBDT=$S($G(IBIFN):$P($G(^DGCR(399,+IBIFN,"U")),U),1:DT)  ; use statement from date
"RTN","IBCEFP1",16,0)
 I IBNMC="DEPT VETERANS AFFAIRS" S IBNMC="VETERANS AFFAIRS,DEPT"
"RTN","IBCEFP1",17,0)
 I IBNMC["," D  G NAMEQ
"RTN","IBCEFP1",18,0)
 . S IBNMC=$TR(IBNMC,".") D NAMECOMP^XLFNAME(.IBNMC)
"RTN","IBCEFP1",19,0)
 . S IBNM=$G(IBNMC("FAMILY"))_U_$G(IBNMC("GIVEN"))_U_$G(IBNMC("MIDDLE"))_U_IBCRED_U_$G(IBNMC("SUFFIX"))
"RTN","IBCEFP1",20,0)
 D STDNAME^XLFNAME(.IBNMC,"C")
"RTN","IBCEFP1",21,0)
 S IBNM=$G(IBNMC("FAMILY"))_U_$G(IBNMC("GIVEN"))_U_$G(IBNMC("MIDDLE"))_U_IBCRED_U_$G(IBNMC("SUFFIX"))
"RTN","IBCEFP1",22,0)
 ; 1= facility/group
"RTN","IBCEFP1",23,0)
 I IBFN=355.93,$P($G(^IBA(355.93,+IBDATA,0)),U,2)=1 S IBNM=IBNMC_U_U_U_IBCRED_U ; group performing provider
"RTN","IBCEFP1",24,0)
 ;
"RTN","IBCEFP1",25,0)
 ; add specialty code
"RTN","IBCEFP1",26,0)
NAMEQ ;
"RTN","IBCEFP1",27,0)
 I $G(IBSPEC)="" S IBSPEC=$$SPEC^IBCEU(IBDATA,IBDT)
"RTN","IBCEFP1",28,0)
 I +IBSPEC S IBSPEC=$$GET1^DIQ(42.4,IBSPEC,.01,"")
"RTN","IBCEFP1",29,0)
 S $P(IBNM,U,6)=IBSPEC
"RTN","IBCEFP1",30,0)
 Q IBNM
"RTN","IBCEFP1",31,0)
 ;
"RTN","IBCEFP1",32,0)
TAXON(IBDATA,IBTAX) ; RETURNS taxonomy code from NEW PERSON or non/other VA BP
"RTN","IBCEFP1",33,0)
 I $G(IBTAX) S IBTAX=$$GET1^DIQ(8932.1,IBTAX,"X12 CODE")
"RTN","IBCEFP1",34,0)
 I $G(IBTAX)="" S IBTAX=$P($$GETTAX^IBCEF73A(IBDATA),U)
"RTN","IBCEFP1",35,0)
 Q IBTAX
"RTN","IBCEFP1",36,0)
 ;
"RTN","IBCEFP1",37,0)
NPI(IBDATA) ; look for NPI in #200 or #355.93
"RTN","IBCEFP1",38,0)
 Q $$GETNPI^IBCEF73A(IBDATA)
"RTN","IBCEFP1",39,0)
 ;
"RTN","IBCEFP1",40,0)
CLEANUP(IBXSAVE) ; Clean up 
"RTN","IBCEFP1",41,0)
 K IBXSAVE("PROVINF")
"RTN","IBCEFP1",42,0)
 K IBXSAVE("L-PROV")
"RTN","IBCEFP1",43,0)
 K IBXSAVE("LAB/FAC")
"RTN","IBCEFP1",44,0)
 K IBXSAVE("BILLING PRV")
"RTN","IBCEFP1",45,0)
 K IBXSAVE("ID")
"RTN","IBCEFP1",46,0)
 K IBXSAVE("SLPRV")
"RTN","IBCEFP1",47,0)
 K IBXSAVE("SLC")
"RTN","IBCEFP1",48,0)
 Q
"RTN","IBCEFP1",49,0)
 ;
"RTN","IBCEFP1",50,0)
 ;COBID Input
"RTN","IBCEFP1",51,0)
 ; IBIFN - IEN of Bill/Claim File
"RTN","IBCEFP1",52,0)
 ; IBTYP - Provider Type
"RTN","IBCEFP1",53,0)
 ; IBMRAND - $$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEFP1",54,0)
 ; IBD - Provider zero node from array.
"RTN","IBCEFP1",55,0)
COBID(IBIFN,IBTYP,IBMRAND,IBD) ;Get COB ID
"RTN","IBCEFP1",56,0)
 N IBPROV,IBZ,IBY,IBID,IBWNR,COBID
"RTN","IBCEFP1",57,0)
 S COBID=""
"RTN","IBCEFP1",58,0)
 I $G(IBMRAND)="" S IBMRAND=$$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEFP1",59,0)
 D F^IBCEF("N-CURRENT INS POLICY TYPE","IBZ",,IBIFN)
"RTN","IBCEFP1",60,0)
 S IBPRV=U_$G(IBZ),IBY=0
"RTN","IBCEFP1",61,0)
 I IBMRAND D
"RTN","IBCEFP1",62,0)
 . S IBPRV(IBTYP)=$S(IBTYP=3!(IBTYP=4):"DEPT VETERANS AFFAIRS",1:"")_"^VAD000"
"RTN","IBCEFP1",63,0)
 . I '$$INPAT^IBCEF(IBIFN,1),$$FT^IBCEF(IBIFN)=3 S IBPRV(4,1)="^SLF000"
"RTN","IBCEFP1",64,0)
 S IBID=4+$$COBN^IBCEF(IBIFN),IBWNR=$$WNRBILL^IBEFUNC(IBIFN)
"RTN","IBCEFP1",65,0)
 I '$P(IBD,U,2) G COBIDX
"RTN","IBCEFP1",66,0)
 I IBWNR G:'$D(IBPRV(IBTYP)) COBIDX S $P(IBD,U,IBID)=$P(IBPRV(IBTYP),U,2)
"RTN","IBCEFP1",67,0)
 I $P(IBD,U,IBID)'="" S COBID=$P(IBD,U,IBID) G COBIDX
"RTN","IBCEFP1",68,0)
 I $P($G(IBPRV(IBY)),U,2)'="" S COBID=$P(IBPRV(IBY),U,2) G COBIDX
"RTN","IBCEFP1",69,0)
 S COBID=$P($$DEFID(IBIFN,$P(IBD,U,2)),U,IBID-4)
"RTN","IBCEFP1",70,0)
COBIDX ;
"RTN","IBCEFP1",71,0)
 Q COBID
"RTN","IBCEFP1",72,0)
 ;
"RTN","IBCEFP1",73,0)
DEFID(IBIFN,IBPRV) ;
"RTN","IBCEFP1",74,0)
 ; IBIFN = ien of bill
"RTN","IBCEFP1",75,0)
 ; IBPRV = ien of entry subfile 399.0222
"RTN","IBCEFP1",76,0)
 ;  Function returns default ids: prim id def^sec id def^tert id def
"RTN","IBCEFP1",77,0)
 ;  SSN cannot be the default ID
"RTN","IBCEFP1",78,0)
 I $G(IBIFN)="" Q ""
"RTN","IBCEFP1",79,0)
 N Z,Z1,ID,IBZ,IBINS,IBINS4,IBUB
"RTN","IBCEFP1",80,0)
 S IBZ=""
"RTN","IBCEFP1",81,0)
 S IBUB=($$FT^IBCEF(IBIFN)=3)
"RTN","IBCEFP1",82,0)
 S Z=IBPRV,ID=$P(Z,U,5,7)
"RTN","IBCEFP1",83,0)
 F Z1=1:1:3 I $P(ID,U,Z1)="" D
"RTN","IBCEFP1",84,0)
 . Q:'$G(^DGCR(399,IBIFN,"I"_Z1))
"RTN","IBCEFP1",85,0)
 . S $P(ID,U,Z1)=$$GETID^IBCEP2(IBIFN,2,$P(Z,U,2),Z1)
"RTN","IBCEFP1",86,0)
 . ; Set default if null
"RTN","IBCEFP1",87,0)
 . I $P(ID,U,Z1)="" S $P(ID,U,Z1)="VAD000"
"RTN","IBCEFP1",88,0)
 Q ID
"RTN","IBCEMQA")
0^70^B15212408^B12911228
"RTN","IBCEMQA",1,0)
IBCEMQA ;DAOU/ESG - MRA QUIET BILL AUTHORIZATION ;25-MAR-2003
"RTN","IBCEMQA",2,0)
 ;;2.0;INTEGRATED BILLING;**155,432**;21-MAR-94;Build 192
"RTN","IBCEMQA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEMQA",4,0)
 ;
"RTN","IBCEMQA",5,0)
 Q   ; must be called at proper entry point
"RTN","IBCEMQA",6,0)
 ;
"RTN","IBCEMQA",7,0)
 ;
"RTN","IBCEMQA",8,0)
AUTOCOB(IBIFN,IBEOB,ERRMSG,IBMRANOT,IBNCN) ; This procedure mimics and automates the
"RTN","IBCEMQA",9,0)
 ; Process COB action on the MRA management screen.  This is intended
"RTN","IBCEMQA",10,0)
 ; to be called in background mode (no user interface).
"RTN","IBCEMQA",11,0)
 ;
"RTN","IBCEMQA",12,0)
 ; Input
"RTN","IBCEMQA",13,0)
 ;    IBIFN - bill#
"RTN","IBCEMQA",14,0)
 ;    IBEOB - ien of entry in file 361.1 (MRA)
"RTN","IBCEMQA",15,0)
 ;    IBMRANOT - 1 indicates process is NOT from MRA
"RTN","IBCEMQA",16,0)
 ;    IBNCN - By Reference.  Need to pass back the new claim number
"RTN","IBCEMQA",17,0)
 ;
"RTN","IBCEMQA",18,0)
 ; Output
"RTN","IBCEMQA",19,0)
 ;    ERRMSG - optional output parameter, passed by reference
"RTN","IBCEMQA",20,0)
 ;           - error message text
"RTN","IBCEMQA",21,0)
 ;
"RTN","IBCEMQA",22,0)
 NEW MRADATA,IB364,IBCBASK,IBCBCOPY,IBCAN,IBIFNH,IBAUTO,IBDA
"RTN","IBCEMQA",23,0)
 NEW IBCE,IBSILENT,IBPRCOB,IBERRMSG,IBSTSM
"RTN","IBCEMQA",24,0)
 NEW IBCOB,IBCOBIL,IBCOBN,IBINS,IBINSN,IBINSOLD,IBMRAIO,IBMRAO,IBNMOLD
"RTN","IBCEMQA",25,0)
 S (IBIFN,IBIFNH)=+$G(IBIFN),IBEOB=+$G(IBEOB),ERRMSG=""
"RTN","IBCEMQA",26,0)
 ;
"RTN","IBCEMQA",27,0)
 S MRADATA=$G(^IBM(361.1,IBEOB,0))
"RTN","IBCEMQA",28,0)
 ; IB*2.0*432 - Add auto-process of non-MRA's
"RTN","IBCEMQA",29,0)
 I $G(IBMRANOT)'=1,$P(MRADATA,U,1)'=IBIFN S ERRMSG="Incorrect Bill or MRA EOB" G AUCOBX
"RTN","IBCEMQA",30,0)
 I $G(IBMRANOT)'=1,$P(MRADATA,U,4)'=1 S ERRMSG="EOB is not a Medicare MRA" G AUCOBX
"RTN","IBCEMQA",31,0)
 S IB364=+$P(MRADATA,U,19)
"RTN","IBCEMQA",32,0)
 I $G(IBMRANOT)'=1,'IB364 S ERRMSG="Missing or incorrect Transmission record" G AUCOBX
"RTN","IBCEMQA",33,0)
 ;
"RTN","IBCEMQA",34,0)
 I '$P($G(^DGCR(399,IBIFN,"I"_($$COBN^IBCEF(IBIFN)+1))),U,1) D  G AUCOBX
"RTN","IBCEMQA",35,0)
 . S ERRMSG="No next payer for this bill"
"RTN","IBCEMQA",36,0)
 . Q
"RTN","IBCEMQA",37,0)
 ;
"RTN","IBCEMQA",38,0)
 ; Make sure that Medicare WNR is the current insurance for this bill if MRA processing
"RTN","IBCEMQA",39,0)
 I $G(IBMRANOT)'=1,'$$WNRBILL^IBEFUNC(IBIFN) D  G AUCOBX
"RTN","IBCEMQA",40,0)
 . S ERRMSG="Medicare (WNR) is not the current payer for this bill"
"RTN","IBCEMQA",41,0)
 . Q
"RTN","IBCEMQA",42,0)
 ;
"RTN","IBCEMQA",43,0)
 ; Set variable flags for use in IBCCCB/IBCCC2
"RTN","IBCEMQA",44,0)
 S (IBCBASK,IBCBCOPY,IBCAN,IBAUTO,IBCE("EDI"),IBSILENT,IBPRCOB)=1
"RTN","IBCEMQA",45,0)
 ; IB*2.0*432 - if non-MRA processing, set Secondary/Tertiary Silent mode=1
"RTN","IBCEMQA",46,0)
 S:$G(IBMRANOT)=1 IBSTSM=1
"RTN","IBCEMQA",47,0)
 S IBDA=IBEOB
"RTN","IBCEMQA",48,0)
 ;
"RTN","IBCEMQA",49,0)
 D CHKB1^IBCCCB
"RTN","IBCEMQA",50,0)
 ;
"RTN","IBCEMQA",51,0)
 I $G(IBMRANOT)=1 S IBNCN=$S($G(IBCE("EDI","NEW")):IBCE("EDI","NEW"),1:$G(IBHV("IBIFN1")))
"RTN","IBCEMQA",52,0)
 S IBIFN=IBIFNH                                   ; restore bill#
"RTN","IBCEMQA",53,0)
 I $G(IBERRMSG)'="" S ERRMSG=IBERRMSG G AUCOBX    ; error message
"RTN","IBCEMQA",54,0)
 D UPDEDI^IBCEM(IB364,"Z")                        ; status updates
"RTN","IBCEMQA",55,0)
AUCOBX ;
"RTN","IBCEMQA",56,0)
 Q
"RTN","IBCEMQA",57,0)
 ;
"RTN","IBCEMQA",58,0)
 ;
"RTN","IBCEMQA",59,0)
AUTH(IBIFN,ERRMSG,IBMRANOT) ; Entry Point
"RTN","IBCEMQA",60,0)
 ; This procedure's job is to authorize this bill.  The manual
"RTN","IBCEMQA",61,0)
 ; process to authorize a bill is found in routine IBCB1.  This
"RTN","IBCEMQA",62,0)
 ; routine borrows heavily from that routine.
"RTN","IBCEMQA",63,0)
 ;
"RTN","IBCEMQA",64,0)
 ; *** Any changes here should be considered also in IBCB1 ***
"RTN","IBCEMQA",65,0)
 ;
"RTN","IBCEMQA",66,0)
 ; This routine is called when receiving an incoming MRA from
"RTN","IBCEMQA",67,0)
 ; Medicare.  If that MRA/EOB meets certain criteria, then the bill
"RTN","IBCEMQA",68,0)
 ; will become a secondary bill and we will try to authorize it (using
"RTN","IBCEMQA",69,0)
 ; this procedure) and put it in the EDI queue ready for extract.
"RTN","IBCEMQA",70,0)
 ;
"RTN","IBCEMQA",71,0)
 ; Input
"RTN","IBCEMQA",72,0)
 ;    IBIFN - internal bill#
"RTN","IBCEMQA",73,0)
 ;    IBMRANOT - 1 indicates process is NOT from MRA
"RTN","IBCEMQA",74,0)
 ;
"RTN","IBCEMQA",75,0)
 ; Output
"RTN","IBCEMQA",76,0)
 ;    ERRMSG - optional output parameter, passed by reference
"RTN","IBCEMQA",77,0)
 ;           - error message text
"RTN","IBCEMQA",78,0)
 ;
"RTN","IBCEMQA",79,0)
 NEW CST,IBTXSTAT,IB364,PRCASV,DFN,STSMSG
"RTN","IBCEMQA",80,0)
 NEW DIE,DA,DR,IBYY
"RTN","IBCEMQA",81,0)
 ;
"RTN","IBCEMQA",82,0)
 ; Check the bill, make sure the current status is valid
"RTN","IBCEMQA",83,0)
 S IBIFN=+$G(IBIFN),ERRMSG=""
"RTN","IBCEMQA",84,0)
 S CST=$P($G(^DGCR(399,IBIFN,0)),U,13)
"RTN","IBCEMQA",85,0)
 I CST="" S ERRMSG="Bill has no current status defined." G AUTHX
"RTN","IBCEMQA",86,0)
 ; IB*2.0*432  add auto-processing of non-MRA's
"RTN","IBCEMQA",87,0)
 I $G(IBMRANOT)'=1,CST'=2 S ERRMSG="This bill's status is "_$$GET1^DIQ(399,IBIFN_",",.13)_".  It must be REQUEST MRA." G AUTHX
"RTN","IBCEMQA",88,0)
 ;
"RTN","IBCEMQA",89,0)
 ; authorize the bill quietly
"RTN","IBCEMQA",90,0)
 S DIE=399,DA=IBIFN,DR="[IB STATUS]",IBYY="@902" D ^DIE
"RTN","IBCEMQA",91,0)
 ;
"RTN","IBCEMQA",92,0)
 ; Update the review status for all EOB's on file
"RTN","IBCEMQA",93,0)
 D STAT^IBCEMU2(IBIFN,3)     ; Accepted - Complete EOB
"RTN","IBCEMQA",94,0)
 ;
"RTN","IBCEMQA",95,0)
 ; Checks for need to add any codes to bill for EDI (call in quiet mode)
"RTN","IBCEMQA",96,0)
 D AUTOCK^IBCEU2(IBIFN,1)
"RTN","IBCEMQA",97,0)
 ;
"RTN","IBCEMQA",98,0)
 ; Calculate transmittable status
"RTN","IBCEMQA",99,0)
 ;   0 = not transmittable
"RTN","IBCEMQA",100,0)
 ;   1 = yes, live transmittable
"RTN","IBCEMQA",101,0)
 ;   2 = yes, test transmittable
"RTN","IBCEMQA",102,0)
 ; P432 add MRANOT flag so it will create new entry in trans file for non-MRA's
"RTN","IBCEMQA",103,0)
 S IBTXSTAT=+$$TXMT^IBCEF4(IBIFN,,$G(IBMRANOT))
"RTN","IBCEMQA",104,0)
 ;
"RTN","IBCEMQA",105,0)
 ; If transmittable, add this bill to the bill transmission file
"RTN","IBCEMQA",106,0)
 I IBTXSTAT D  I ERRMSG'="" G AUTHX
"RTN","IBCEMQA",107,0)
 . S IB364=$$ADDTBILL^IBCB1(IBIFN,IBTXSTAT)
"RTN","IBCEMQA",108,0)
 . I '$P(IB364,U,3) S ERRMSG="Error loading bill into transmit file."
"RTN","IBCEMQA",109,0)
 . Q
"RTN","IBCEMQA",110,0)
 ;
"RTN","IBCEMQA",111,0)
 ; Pass completed bill to Accounts Receivable (quietly)
"RTN","IBCEMQA",112,0)
 D ARPASS^IBCB1(IBIFN,0)
"RTN","IBCEMQA",113,0)
 I '$G(PRCASV("OKAY")) S ERRMSG="Error while passing bill to A/R." G AUTHX
"RTN","IBCEMQA",114,0)
 ;
"RTN","IBCEMQA",115,0)
 ; Find and process any IB charges on hold
"RTN","IBCEMQA",116,0)
 S DFN=+$P($G(^DGCR(399,IBIFN,0)),U,2)
"RTN","IBCEMQA",117,0)
 D FIND^IBOHCK(DFN,IBIFN)
"RTN","IBCEMQA",118,0)
 ;
"RTN","IBCEMQA",119,0)
 ; If transmittable, check for unreviewed items & update 364 status
"RTN","IBCEMQA",120,0)
 I IBTXSTAT D
"RTN","IBCEMQA",121,0)
 . S STSMSG=$$STATUS^IBCEF4(IBIFN)
"RTN","IBCEMQA",122,0)
 . I $P(STSMSG,U,1) D UPDEDI^IBCEM($P(STSMSG,U,1),"E")
"RTN","IBCEMQA",123,0)
 . I $P(STSMSG,U,2),$P(STSMSG,U,2)'=$P(STSMSG,U,1) D UPDEDI^IBCEM($P(STSMSG,U,2),"E")
"RTN","IBCEMQA",124,0)
 . Q
"RTN","IBCEMQA",125,0)
 ;
"RTN","IBCEMQA",126,0)
AUTHX ;
"RTN","IBCEMQA",127,0)
 Q
"RTN","IBCEMQA",128,0)
 ;
"RTN","IBCEMRAX")
0^18^B48296303^B48242861
"RTN","IBCEMRAX",1,0)
IBCEMRAX ;ALB/DSM - MEDICARE REMITTANCE ADVICE DETAIL-PART A Cont'd ;25-APR-2003
"RTN","IBCEMRAX",2,0)
 ;;2.0;INTEGRATED BILLING;**155,432**;21-MAR-94;Build 192
"RTN","IBCEMRAX",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEMRAX",4,0)
 ;
"RTN","IBCEMRAX",5,0)
 Q
"RTN","IBCEMRAX",6,0)
 ;
"RTN","IBCEMRAX",7,0)
DEV(IBIFN,IBMRANOT) ; Prompt the user for a device  ; WCJ IB*2.0*432
"RTN","IBCEMRAX",8,0)
 ; Input: IBIFN= ien# of Claim file
"RTN","IBCEMRAX",9,0)
 ;    IBMRANOT = 1 if NOT an MRA    ; WCJ IB*2.0*432
"RTN","IBCEMRAX",10,0)
 N %ZIS,ZTRTN,ZTSAVE,ZTDESC,POP,MRACNT
"RTN","IBCEMRAX",11,0)
 I '$G(IBIFN) Q  ;DEV
"RTN","IBCEMRAX",12,0)
 W !!,"This report displays Medicare-equivalent Remittance Advice Detail."
"RTN","IBCEMRAX",13,0)
 S MRACNT=$$MRACNT^IBCEMU1(IBIFN,$G(IBMRANOT))
"RTN","IBCEMRAX",14,0)
 I MRACNT>1 W !,"*** Multiple MRAs on File for this claim.  ",MRACNT," MRAs will be printed. ***"
"RTN","IBCEMRAX",15,0)
 W !,"You will need a 132 column printer for this report",!
"RTN","IBCEMRAX",16,0)
 ;
"RTN","IBCEMRAX",17,0)
 S %ZIS="QM" D ^%ZIS I POP S IBQUIT=1 Q
"RTN","IBCEMRAX",18,0)
 ; handle queuing report next
"RTN","IBCEMRAX",19,0)
 I $D(IO("Q")) D  S IBQUIT=1 Q
"RTN","IBCEMRAX",20,0)
 . S ZTRTN="PROC^IBCEMRAA"   ; background re-entry point
"RTN","IBCEMRAX",21,0)
 . S ZTDESC="Medicare-equivalent Remittance Advice Detail Print"
"RTN","IBCEMRAX",22,0)
 . S ZTSAVE("IB*")=""
"RTN","IBCEMRAX",23,0)
 . D ^%ZTLOAD
"RTN","IBCEMRAX",24,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","IBCEMRAX",25,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBCEMRAX",26,0)
 U IO    ; Output device
"RTN","IBCEMRAX",27,0)
 Q  ;DEV
"RTN","IBCEMRAX",28,0)
 ;
"RTN","IBCEMRAX",29,0)
SRVHDR ; Print Srvice Level Header
"RTN","IBCEMRAX",30,0)
 ; ROW 23 -
"RTN","IBCEMRAX",31,0)
 ; Service (Line) Level Adjustments Data
"RTN","IBCEMRAX",32,0)
 W !!! I '$G(INPAT) W "SERV DATE"  ;print only on outpatient claims
"RTN","IBCEMRAX",33,0)
 W ?12,"PT",?15,"PROC",?21,"MODS",?30,"REV",?35,"APC",?43,"UNITS",?50,"TOT CHARGES"
"RTN","IBCEMRAX",34,0)
 W ?67,"DEDUCT",?80,"COINS",?90,"ALLOWED",?102,"PAYMENT",?111,"GRP-RC",?123,"ADJ AMT"
"RTN","IBCEMRAX",35,0)
 Q  ;SRVHDR
"RTN","IBCEMRAX",36,0)
 ;
"RTN","IBCEMRAX",37,0)
SRVDATA ; Get Service Level Data of EOB file (#361.1 Level 15)
"RTN","IBCEMRAX",38,0)
 ; 
"RTN","IBCEMRAX",39,0)
 N LNLVL,RLVL,GLVL,RLVLD,GLVLD,SRVDED,GRPCD,RSNCD,SRVCOIN,I,MOD,SRMKS,LNLVLD
"RTN","IBCEMRAX",40,0)
 N PRCD,REVCD,UNIT,SRVDT,PRCTYP,ALWD,PAID,SRVDED,GLVL,RCNT,OPRCD,TOTL,LNORD,LNCNT
"RTN","IBCEMRAX",41,0)
 ; Use array LNORD to sort Service Lines in order of Referenced Line #
"RTN","IBCEMRAX",42,0)
 S LNLVL=0,LNCNT=1000
"RTN","IBCEMRAX",43,0)
 F  S LNLVL=$O(^IBM(361.1,IEN,15,LNLVL)) Q:'LNLVL  S LNORD=$P(^(LNLVL,0),U,12) D  ;
"RTN","IBCEMRAX",44,0)
 . I LNORD S LNORD(LNORD)=LNLVL Q
"RTN","IBCEMRAX",45,0)
 . S LNORD(LNCNT)=LNLVL,LNCNT=LNCNT+1
"RTN","IBCEMRAX",46,0)
 ;
"RTN","IBCEMRAX",47,0)
 S LNORD=0
"RTN","IBCEMRAX",48,0)
 F  S LNORD=$O(LNORD(LNORD)) Q:'LNORD  S LNLVL=LNORD(LNORD) D  I IBQUIT Q
"RTN","IBCEMRAX",49,0)
 . S LNLVLD=$G(^IBM(361.1,IEN,15,LNLVL,0)) I LNLVLD="" Q
"RTN","IBCEMRAX",50,0)
 . I ($Y+4)>IOSL D  I IBQUIT Q
"RTN","IBCEMRAX",51,0)
 . . D PAUSE I IBQUIT Q
"RTN","IBCEMRAX",52,0)
 . . W @IOF D CLMHDR^IBCEMRAA
"RTN","IBCEMRAX",53,0)
 . . D SRVHDR
"RTN","IBCEMRAX",54,0)
 . ;
"RTN","IBCEMRAX",55,0)
 . K MOD,RCNT,TOTL S RCNT=0
"RTN","IBCEMRAX",56,0)
 . ; Procedure Code, Revenue Code, Units, From Service Date, Procedure Type
"RTN","IBCEMRAX",57,0)
 . S PRCD=$P(LNLVLD,U,4),REVCD=$P(LNLVLD,U,10),UNIT=$P(LNLVLD,U,11),SRVDT=$P(LNLVLD,U,16)
"RTN","IBCEMRAX",58,0)
 . S PRCTYP=$P(LNLVLD,U,18) I PRCTYP="NU" S PRCTYP="" ;don't display NU for Proc Type
"RTN","IBCEMRAX",59,0)
 . ; Resolve Revenue Code Pointer
"RTN","IBCEMRAX",60,0)
 . I REVCD'="" S REVCD=$P($G(^DGCR(399.2,REVCD,0)),U)
"RTN","IBCEMRAX",61,0)
 . ; Allowed, Payment, Original Procedure Code
"RTN","IBCEMRAX",62,0)
 . S ALWD=$P(LNLVLD,U,13),PAID=$P(LNLVLD,U,3),OPRCD=$P(LNLVLD,U,15)
"RTN","IBCEMRAX",63,0)
 . ; Handle Multiple Paid Modifiers from the Service Line Level (may have 4 mod's, could only fit 3)
"RTN","IBCEMRAX",64,0)
 . M MOD=^IBM(361.1,IEN,15,LNLVL,2) S MOD="" F I=1:1:3 Q:'$D(MOD(I))  S MOD=MOD_$S(MOD="":"",1:",")_MOD(I,0)
"RTN","IBCEMRAX",65,0)
 . ; Get Total Charge by matching 837 Extract Records with Bill's Original Line# on the current Service Line (LNLVLD)
"RTN","IBCEMRAX",66,0)
 . S TOTL=$P($G(IBZDATA($P(LNLVLD,U,12))),U,5)
"RTN","IBCEMRAX",67,0)
 . ; Service Line Level Remarks Codes
"RTN","IBCEMRAX",68,0)
 . S SRMKS=$G(^IBM(361.1,IEN,15,LNLVL,3))
"RTN","IBCEMRAX",69,0)
 . ; Row 24  - print Service date only on Outpatient claims (skip on Inpatients)
"RTN","IBCEMRAX",70,0)
 . W ! I '$G(INPAT) W $$FMTE^XLFDT(SRVDT,5)
"RTN","IBCEMRAX",71,0)
 . W ?12,PRCTYP,?15,PRCD,?21,MOD,?30,REVCD,?41,$J(UNIT,7),?49,$J($G(TOTL),12,2)
"RTN","IBCEMRAX",72,0)
 . ;
"RTN","IBCEMRAX",73,0)
 . ; Get Service Level Group Code/Reason Code Data
"RTN","IBCEMRAX",74,0)
 . ; RLVLD=reason_code^amount^quantity^reason text
"RTN","IBCEMRAX",75,0)
 . S (SRVDED,GLVL,RCNT,SRVCOIN)=0 K RSNCD
"RTN","IBCEMRAX",76,0)
 . F  S GLVL=$O(^IBM(361.1,IEN,15,LNLVL,1,GLVL)) Q:'GLVL  S GLVLD=^(GLVL,0) D  ;
"RTN","IBCEMRAX",77,0)
 . . S GRPCD=$P(GLVLD,U),RLVL=0
"RTN","IBCEMRAX",78,0)
 . . F  S RLVL=$O(^IBM(361.1,IEN,15,LNLVL,1,GLVL,1,RLVL)) Q:'RLVL  S RLVLD=^(RLVL,0),RSNCD=$P(RLVLD,U) D  ;
"RTN","IBCEMRAX",79,0)
 . . . I GRPCD="PR",RSNCD="AAA" Q   ;exception
"RTN","IBCEMRAX",80,0)
 . . . I GRPCD="OA",RSNCD="AB3" Q   ;exception
"RTN","IBCEMRAX",81,0)
 . . . I GRPCD="LQ" Q               ;exception
"RTN","IBCEMRAX",82,0)
 . . . I GRPCD="PR",RSNCD=1!(RSNCD=66) S SRVDED=SRVDED+$P(RLVLD,U,2) Q  ;deductible
"RTN","IBCEMRAX",83,0)
 . . . I GRPCD="PR",RSNCD=2 S SRVCOIN=$P(RLVLD,U,2) Q  ;coinsurance
"RTN","IBCEMRAX",84,0)
 . . . S RCNT=RCNT+1,RSNCD(RCNT)=GRPCD_"-"_RSNCD_U_$P(RLVLD,U,2)
"RTN","IBCEMRAX",85,0)
 . ; Print Service Level Group Code/Reason Code Data
"RTN","IBCEMRAX",86,0)
 . ; Service Level deductible, Coinsurance, Allowed, Paid Amount
"RTN","IBCEMRAX",87,0)
 . W ?62,$J(SRVDED,11,2),?74,$J(SRVCOIN,11,2),?86,$J(ALWD,11,2),?98,$J(PAID,11,2)
"RTN","IBCEMRAX",88,0)
 . ; Print Group Code-Reason Code, Adjustment Amount
"RTN","IBCEMRAX",89,0)
 . F I=1:1:RCNT W:I>1 ! W ?111,$P(RSNCD(I),U),?118,$J($P(RSNCD(I),U,2),12,2)
"RTN","IBCEMRAX",90,0)
 . ; Row 25
"RTN","IBCEMRAX",91,0)
 . I OPRCD="",(SRMKS="") Q
"RTN","IBCEMRAX",92,0)
 . W ! I OPRCD'="" W ?15,"(",$E(OPRCD,1,4),")"
"RTN","IBCEMRAX",93,0)
 . I SRMKS'="" W ?26,"REM:",?30,$P(SRMKS,U)
"RTN","IBCEMRAX",94,0)
 ;
"RTN","IBCEMRAX",95,0)
 Q  ;SRVDATA
"RTN","IBCEMRAX",96,0)
 ;
"RTN","IBCEMRAX",97,0)
PAUSE ; Pause at the bottom of screen. This section is called
"RTN","IBCEMRAX",98,0)
 ; from different points of the MRA report.
"RTN","IBCEMRAX",99,0)
 ;
"RTN","IBCEMRAX",100,0)
 I $E(IOST,1,2)'["C-" Q  ;if not terminal, don't pause
"RTN","IBCEMRAX",101,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","IBCEMRAX",102,0)
 S DIR(0)="E" D ^DIR
"RTN","IBCEMRAX",103,0)
 I $D(DIRUT)!($D(DUOUT)) S IBQUIT=1 Q
"RTN","IBCEMRAX",104,0)
 Q  ;PAUSE
"RTN","IBCEMRAX",105,0)
 ;
"RTN","IBCEMRAX",106,0)
DSCLMR ;
"RTN","IBCEMRAX",107,0)
 N LINE
"RTN","IBCEMRAX",108,0)
 S $P(LINE,"-",122)=""
"RTN","IBCEMRAX",109,0)
 W !!,LINE
"RTN","IBCEMRAX",110,0)
 W !,"This is a printed representation of a remittance advice, developed through a joint effort between the Centers for Medicare and"
"RTN","IBCEMRAX",111,0)
 W !,"Medicaid Services and the Department of Veterans Affairs, for a claim for services or supplies furnished to a Medicare-eligible"
"RTN","IBCEMRAX",112,0)
 W !,"veteran through a facility of the Department of Veterans Affairs.  The remittance advice shows the amount that Medicare would have"
"RTN","IBCEMRAX",113,0)
 W !,"paid had the claim been payable by Medicare, as well as the coinsurance and deductible amounts that would have applied."
"RTN","IBCEMRAX",114,0)
 W !,"The claim is not payable under the Medicare program, and no Medicare payment was issued."
"RTN","IBCEMRAX",115,0)
 W !
"RTN","IBCEMRAX",116,0)
 Q  ;DSCLMR
"RTN","IBCEMRAX",117,0)
 ;
"RTN","IBCEMRAX",118,0)
LINELVL ; This section is called when printing Institutional Reports
"RTN","IBCEMRAX",119,0)
 ; The values of Coinsurance, Contractual Adjustment, Noncovered Charges
"RTN","IBCEMRAX",120,0)
 ; and Deductible are calculated from the Service Line level and not
"RTN","IBCEMRAX",121,0)
 ; from the Claim level.
"RTN","IBCEMRAX",122,0)
 ;
"RTN","IBCEMRAX",123,0)
 ; RLVLD=reason_code^amount^quantity^reason text
"RTN","IBCEMRAX",124,0)
 ; IBCOINS,IBCTADJ,NCVRCHRG,CLMADJ are set to zero in the calling section CLMDATA
"RTN","IBCEMRAX",125,0)
 ;
"RTN","IBCEMRAX",126,0)
 N LNLVL,LNLVLD,GLVL,GLVLD,RLVL,RLVLD,GRPCD,RSNCD
"RTN","IBCEMRAX",127,0)
 S LNLVL=0
"RTN","IBCEMRAX",128,0)
 F  S LNLVL=$O(^IBM(361.1,IEN,15,LNLVL)) Q:'LNLVL  S LNLVLD=^(LNLVL,0) D  ;
"RTN","IBCEMRAX",129,0)
 . S GLVL=0 F  S GLVL=$O(^IBM(361.1,IEN,15,LNLVL,1,GLVL)) Q:'GLVL  S GLVLD=^(GLVL,0) D  ;
"RTN","IBCEMRAX",130,0)
 . . S GRPCD=$P(GLVLD,U),RLVL=0
"RTN","IBCEMRAX",131,0)
 . . F  S RLVL=$O(^IBM(361.1,IEN,15,LNLVL,1,GLVL,1,RLVL)) Q:'RLVL  S RLVLD=^(RLVL,0),RSNCD=$P(RLVLD,U) D  ;
"RTN","IBCEMRAX",132,0)
 . . . I GRPCD="PR",RSNCD="AAA" Q   ;exception
"RTN","IBCEMRAX",133,0)
 . . . I GRPCD="OA",RSNCD="AB3" Q   ;exception
"RTN","IBCEMRAX",134,0)
 . . . I GRPCD="LQ" Q               ;exception
"RTN","IBCEMRAX",135,0)
 . . . ; set Claim Adjustment only if none were found at the claim level (don't check for group code)
"RTN","IBCEMRAX",136,0)
 . . . I RCLMADJ[(","_RSNCD_",") S CLMADJ=CLMADJ+$P(RLVLD,U,2)
"RTN","IBCEMRAX",137,0)
 . . . ; Coinsurance
"RTN","IBCEMRAX",138,0)
 . . . I GRPCD="PR",RCOINS[(","_RSNCD_",") S IBCOINS=IBCOINS+$P(RLVLD,U,2) Q
"RTN","IBCEMRAX",139,0)
 . . . ; Deductible
"RTN","IBCEMRAX",140,0)
 . . . I GRPCD="PR" I RCDED[(","_RSNCD_",") S IBDED=IBDED+$P(RLVLD,U,2) Q
"RTN","IBCEMRAX",141,0)
 . . . I GRPCD="CO" D  ;
"RTN","IBCEMRAX",142,0)
 . . . . ; Contractual Adjustment
"RTN","IBCEMRAX",143,0)
 . . . . I RCTADJ[(","_RSNCD_",") S IBCTADJ=IBCTADJ+$P(RLVLD,U,2)
"RTN","IBCEMRAX",144,0)
 . . . . ; Noncovered Charges
"RTN","IBCEMRAX",145,0)
 . . . . I RCNCVR'[(","_RSNCD_",") S NCVRCHRG=NCVRCHRG+$P(RLVLD,U,2)
"RTN","IBCEMRAX",146,0)
 Q  ;LINELVL
"RTN","IBCEMRAX",147,0)
 ;
"RTN","IBCEMU1")
0^13^B59079187^B56645809
"RTN","IBCEMU1",1,0)
IBCEMU1 ;ALB/DSM - IB MRA Utility ;26-MAR-2003
"RTN","IBCEMU1",2,0)
 ;;2.0;INTEGRATED BILLING;**135,155,432**;21-MAR-94;Build 192
"RTN","IBCEMU1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEMU1",4,0)
 ;
"RTN","IBCEMU1",5,0)
MRAUSR() ;; Function
"RTN","IBCEMU1",6,0)
 ; Returns IEN (Internal Entry Number) from file #200 for
"RTN","IBCEMU1",7,0)
 ; the Bill Authorizer of acceptable MRA secondary claims,
"RTN","IBCEMU1",8,0)
 ; namely, AUTHORIZER,IB MRA
"RTN","IBCEMU1",9,0)
 ;
"RTN","IBCEMU1",10,0)
 ; Output:    -1   if record not on file
"RTN","IBCEMU1",11,0)
 ;            IEN  if record is on file
"RTN","IBCEMU1",12,0)
 ;
"RTN","IBCEMU1",13,0)
 N DIC,X,Y
"RTN","IBCEMU1",14,0)
 S DIC(0)="MO",DIC="^VA(200,",X="AUTHORIZER,IB MRA"
"RTN","IBCEMU1",15,0)
 ; call FM lookup utility
"RTN","IBCEMU1",16,0)
 D ^DIC
"RTN","IBCEMU1",17,0)
 ; if record is already on file, return IEN
"RTN","IBCEMU1",18,0)
 ; else  return -1
"RTN","IBCEMU1",19,0)
 Q +Y
"RTN","IBCEMU1",20,0)
 ;
"RTN","IBCEMU1",21,0)
 ;
"RTN","IBCEMU1",22,0)
MRA(IBIFN) ; Utility driver procedure - this is what gets called
"RTN","IBCEMU1",23,0)
 I $$MRAEXIST(IBIFN) D PRINTMRA(IBIFN)
"RTN","IBCEMU1",24,0)
MRAX ;
"RTN","IBCEMU1",25,0)
 Q
"RTN","IBCEMU1",26,0)
 ;
"RTN","IBCEMU1",27,0)
 ;
"RTN","IBCEMU1",28,0)
MRAEXIST(IBIFN) ; This function determines if any MRA exists for the
"RTN","IBCEMU1",29,0)
 ; passed bill (IBIFN).
"RTN","IBCEMU1",30,0)
 ;
"RTN","IBCEMU1",31,0)
 ; This function is called from the IB package as well as the AR package.
"RTN","IBCEMU1",32,0)
 ;
"RTN","IBCEMU1",33,0)
 ; This function returns a true value (1) under the following
"RTN","IBCEMU1",34,0)
 ; conditions:
"RTN","IBCEMU1",35,0)
 ;
"RTN","IBCEMU1",36,0)
 ; - The current payer sequence is secondary or tertiary for the bill
"RTN","IBCEMU1",37,0)
 ; - Medicare WNR is a payer on the bill
"RTN","IBCEMU1",38,0)
 ; - At least one MRA EOB is on file for the bill
"RTN","IBCEMU1",39,0)
 ; - Medicare is primary, bill is 2nd/3rd
"RTN","IBCEMU1",40,0)
 ; - or, Medicare is secondary, bill is 3rd
"RTN","IBCEMU1",41,0)
 ;
"RTN","IBCEMU1",42,0)
 NEW OK,IBCOB,PRIMBILL
"RTN","IBCEMU1",43,0)
 S IBIFN=+$G(IBIFN)
"RTN","IBCEMU1",44,0)
 S OK=0
"RTN","IBCEMU1",45,0)
 I '$D(^DGCR(399,IBIFN,0)) G MRAEX         ; Check for valid bill
"RTN","IBCEMU1",46,0)
 S IBCOB=$$COBN^IBCEF(IBIFN)               ; Current payer sequence
"RTN","IBCEMU1",47,0)
 I IBCOB=1 G MRAEX                         ; Must be secondary or tert
"RTN","IBCEMU1",48,0)
 I '$$MCRONBIL^IBEFUNC(IBIFN) G MRAEX      ; Medicare not on bill
"RTN","IBCEMU1",49,0)
 ;
"RTN","IBCEMU1",50,0)
 ; If bill is secondary and Medicare is primary, then we know the bill#
"RTN","IBCEMU1",51,0)
 I IBCOB=2,$$WNRBILL^IBEFUNC(IBIFN,1) S OK=$$CHK(IBIFN) G MRAEX
"RTN","IBCEMU1",52,0)
 ;
"RTN","IBCEMU1",53,0)
 ; Similarly if bill is tert and Medicare is 2nd, then we know the bill#
"RTN","IBCEMU1",54,0)
 I IBCOB=3,$$WNRBILL^IBEFUNC(IBIFN,2) S OK=$$CHK(IBIFN) G MRAEX
"RTN","IBCEMU1",55,0)
 ;
"RTN","IBCEMU1",56,0)
 ; If bill is tert and Medicare is first, then we have to get the bill#
"RTN","IBCEMU1",57,0)
 I IBCOB=3,$$WNRBILL^IBEFUNC(IBIFN,1) D  G MRAEX
"RTN","IBCEMU1",58,0)
 . S PRIMBILL=+$P($G(^DGCR(399,IBIFN,"M1")),U,5)
"RTN","IBCEMU1",59,0)
 . I PRIMBILL S OK=$$CHK(PRIMBILL)
"RTN","IBCEMU1",60,0)
 . Q
"RTN","IBCEMU1",61,0)
 ;
"RTN","IBCEMU1",62,0)
MRAEX ;
"RTN","IBCEMU1",63,0)
 Q OK
"RTN","IBCEMU1",64,0)
 ;
"RTN","IBCEMU1",65,0)
CHK(IBIFN) ; This function returns 1 if there is at least 1 MRA EOB for
"RTN","IBCEMU1",66,0)
 ; this bill# in file 361.1.
"RTN","IBCEMU1",67,0)
 NEW OK,IEN
"RTN","IBCEMU1",68,0)
 S (OK,IEN)=0
"RTN","IBCEMU1",69,0)
 F  S IEN=$O(^IBM(361.1,"B",+$G(IBIFN),IEN)) Q:'IEN  D  Q:OK
"RTN","IBCEMU1",70,0)
 . I $P($G(^IBM(361.1,IEN,0)),U,4)=1 S OK=1 Q
"RTN","IBCEMU1",71,0)
 . Q
"RTN","IBCEMU1",72,0)
CHKX ;
"RTN","IBCEMU1",73,0)
 Q OK
"RTN","IBCEMU1",74,0)
 ;
"RTN","IBCEMU1",75,0)
 ;
"RTN","IBCEMU1",76,0)
PRINTMRA(IBIFN) ; This procedure is called when the user is printing bills
"RTN","IBCEMU1",77,0)
 ; and we know that one or more MRA's exist for this bill.  We ask the
"RTN","IBCEMU1",78,0)
 ; user if the MRA(s) should be printed at this time too.
"RTN","IBCEMU1",79,0)
 ;
"RTN","IBCEMU1",80,0)
 NEW CNT,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCEMU1",81,0)
 S IBIFN=+$G(IBIFN) I 'IBIFN G PRMRAX
"RTN","IBCEMU1",82,0)
 S CNT=$$MRACNT(IBIFN) I 'CNT G PRMRAX
"RTN","IBCEMU1",83,0)
 ;
"RTN","IBCEMU1",84,0)
 S DIR(0)="YO",DIR("B")="YES"
"RTN","IBCEMU1",85,0)
 S DIR("A",1)="There is an MRA associated with this bill."
"RTN","IBCEMU1",86,0)
 S DIR("A")="Do you want to print this MRA now"
"RTN","IBCEMU1",87,0)
 I CNT>1 D
"RTN","IBCEMU1",88,0)
 . S DIR("A",1)="There are "_CNT_" MRA's associated with this bill."
"RTN","IBCEMU1",89,0)
 . S DIR("A")="Do you want to print these MRA's now"
"RTN","IBCEMU1",90,0)
 . Q
"RTN","IBCEMU1",91,0)
 S DIR("?")="Please answer Yes or No.  If you answer Yes, then you will be asked to supply the output device and all MRA's associated with this bill will then be printed."
"RTN","IBCEMU1",92,0)
 W !!
"RTN","IBCEMU1",93,0)
 D ^DIR K DIR
"RTN","IBCEMU1",94,0)
 I 'Y G PRMRAX
"RTN","IBCEMU1",95,0)
 ;
"RTN","IBCEMU1",96,0)
 ; At this point, the user wants to print the MRA's
"RTN","IBCEMU1",97,0)
 D MRA^IBCEMRAA(IBIFN)
"RTN","IBCEMU1",98,0)
 ;
"RTN","IBCEMU1",99,0)
PRMRAX ;
"RTN","IBCEMU1",100,0)
 Q
"RTN","IBCEMU1",101,0)
 ;
"RTN","IBCEMU1",102,0)
 ;
"RTN","IBCEMU1",103,0)
MRACNT(IBIFN,IBMRANOT) ; This function counts up the number of MRA EOB's in file  ;WCJ IB*2.0*432
"RTN","IBCEMU1",104,0)
 ; 361.1 for this bill#
"RTN","IBCEMU1",105,0)
 NEW CNT,IEN
"RTN","IBCEMU1",106,0)
 S (CNT,IEN)=0
"RTN","IBCEMU1",107,0)
 F  S IEN=$O(^IBM(361.1,"B",+$G(IBIFN),IEN)) Q:'IEN  D
"RTN","IBCEMU1",108,0)
 . I $P($G(^IBM(361.1,IEN,0)),U,4)'=$S($G(IBMRANOT):0,1:1) Q  ;WCJ IB*2.0*432
"RTN","IBCEMU1",109,0)
 . S CNT=CNT+1
"RTN","IBCEMU1",110,0)
 . Q
"RTN","IBCEMU1",111,0)
MRACNTX ;
"RTN","IBCEMU1",112,0)
 Q CNT
"RTN","IBCEMU1",113,0)
 ;
"RTN","IBCEMU1",114,0)
SPLTMRA(IBIFN) ; This function returns the number of Split MRA's for a 
"RTN","IBCEMU1",115,0)
 ; given bill#.
"RTN","IBCEMU1",116,0)
 ;
"RTN","IBCEMU1",117,0)
 NEW NUM,IEN
"RTN","IBCEMU1",118,0)
 S (NUM,IEN)=0
"RTN","IBCEMU1",119,0)
 F  S IEN=$O(^IBM(361.1,"B",+$G(IBIFN),IEN)) Q:'IEN  I $$SPLIT(IEN) S NUM=NUM+1
"RTN","IBCEMU1",120,0)
SPLTX ;
"RTN","IBCEMU1",121,0)
 Q NUM
"RTN","IBCEMU1",122,0)
 ;
"RTN","IBCEMU1",123,0)
SPLIT(IBEOB) ; This function returns whether or not the given EOB is a
"RTN","IBCEMU1",124,0)
 ; split EOB as indicated in the claim level remark code.
"RTN","IBCEMU1",125,0)
 ; Check the remittance advice remark codes looking for code MA15.  This
"RTN","IBCEMU1",126,0)
 ; code indicates that the claim has been separated to expedite
"RTN","IBCEMU1",127,0)
 ; handling.  This means that this is an incomplete EOB.
"RTN","IBCEMU1",128,0)
 ;
"RTN","IBCEMU1",129,0)
 NEW SPLIT,IBM3,IBM5,PCE,REMC
"RTN","IBCEMU1",130,0)
 S SPLIT=0,IBEOB=+$G(IBEOB)
"RTN","IBCEMU1",131,0)
 S IBM3=$G(^IBM(361.1,IBEOB,3))
"RTN","IBCEMU1",132,0)
 S IBM5=$G(^IBM(361.1,IBEOB,5))
"RTN","IBCEMU1",133,0)
 F PCE=3:1:7 S REMC=$P(IBM3,U,PCE) I REMC="MA15" S SPLIT=1 Q
"RTN","IBCEMU1",134,0)
 I SPLIT G SPLITX
"RTN","IBCEMU1",135,0)
 F PCE=1:1:5 S REMC=$P(IBM5,U,PCE) I REMC="MA15" S SPLIT=1 Q
"RTN","IBCEMU1",136,0)
SPLITX ;
"RTN","IBCEMU1",137,0)
 Q SPLIT
"RTN","IBCEMU1",138,0)
 ;
"RTN","IBCEMU1",139,0)
 ;
"RTN","IBCEMU1",140,0)
EOBLST(IBEOB) ; Standard FileMan lister code for entries in the EOB file
"RTN","IBCEMU1",141,0)
 ; Input parameter IBEOB is the IEN into file 361.1
"RTN","IBCEMU1",142,0)
 ; This can be used by setting DIC("W")="D EOBLST^IBCEMU1(Y)" prior
"RTN","IBCEMU1",143,0)
 ; to FileMan lister calls.
"RTN","IBCEMU1",144,0)
 ;
"RTN","IBCEMU1",145,0)
 NEW IBM,IBIFN,IB,PATNAME,INSCO,SEQ
"RTN","IBCEMU1",146,0)
 NEW EOBDT,EOBTYP,CLMSTAT
"RTN","IBCEMU1",147,0)
 S IBM=$G(^IBM(361.1,IBEOB,0))
"RTN","IBCEMU1",148,0)
 S IBIFN=+IBM
"RTN","IBCEMU1",149,0)
 S IB=$G(^DGCR(399,IBIFN,0))
"RTN","IBCEMU1",150,0)
 S PATNAME=$P($G(^DPT(+$P(IB,U,2),0)),U,1)
"RTN","IBCEMU1",151,0)
 S INSCO=" "_$$EXTERNAL^DILFD(361.1,.02,,$P(IBM,U,2))
"RTN","IBCEMU1",152,0)
 S SEQ=$E($$EXTERNAL^DILFD(361.1,.15,,$P(IBM,U,15)),1,3)
"RTN","IBCEMU1",153,0)
 S EOBDT=" "_$$FMTE^XLFDT($P($P(IBM,U,6),".",1),"2Z")
"RTN","IBCEMU1",154,0)
 S EOBTYP=" "_$P("EOB^MRA",U,$P(IBM,U,4)+1)
"RTN","IBCEMU1",155,0)
 S CLMSTAT=" "_$$EXTERNAL^DILFD(361.1,.13,"",$P(IBM,U,13))
"RTN","IBCEMU1",156,0)
 W $E(PATNAME,1,19)," (",$E(SEQ),")",$E(INSCO,1,17),?56,EOBDT
"RTN","IBCEMU1",157,0)
 W ?66,EOBTYP,?70,CLMSTAT
"RTN","IBCEMU1",158,0)
EOBLSTX ;
"RTN","IBCEMU1",159,0)
 Q
"RTN","IBCEMU1",160,0)
 ;
"RTN","IBCEMU1",161,0)
SEL(IBIFN,MRAONLY,IBDA) ; Function to display and allow user selection
"RTN","IBCEMU1",162,0)
 ; of an EOB/MRA on file in 361.1 for the given bill.
"RTN","IBCEMU1",163,0)
 ;
"RTN","IBCEMU1",164,0)
 ; Input:  IBIFN   - internal bill number (required)
"RTN","IBCEMU1",165,0)
 ;         MRAONLY - 1 if only MRA EOB's should be included here
"RTN","IBCEMU1",166,0)
 ;         IBDA    - list entry number of user selection (optional)
"RTN","IBCEMU1",167,0)
 ;
"RTN","IBCEMU1",168,0)
 ; Function Value:  IEN to file 361.1 or nil if no selection made
"RTN","IBCEMU1",169,0)
 ;
"RTN","IBCEMU1",170,0)
 NEW IBEOB,EOBDATE,COUNT,IEN,IBM,INSCO,SEQ,EOBDT,EOBTYP,CLMSTAT,LIST
"RTN","IBCEMU1",171,0)
 NEW J,A,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,IBM1
"RTN","IBCEMU1",172,0)
 S IBEOB="",IBIFN=+$G(IBIFN),EOBDATE=0,COUNT=0,IBDA=+$G(IBDA)
"RTN","IBCEMU1",173,0)
 F  S EOBDATE=$O(^IBM(361.1,"ABD",IBIFN,EOBDATE)) Q:'EOBDATE  D
"RTN","IBCEMU1",174,0)
 . S IEN=0
"RTN","IBCEMU1",175,0)
 . F  S IEN=$O(^IBM(361.1,"ABD",IBIFN,EOBDATE,IEN)) Q:'IEN  D
"RTN","IBCEMU1",176,0)
 .. S IBM=$G(^IBM(361.1,IEN,0))
"RTN","IBCEMU1",177,0)
 .. I '$G(IBMRANOT),$G(MRAONLY),'$P(IBM,U,4) Q     ; mra only check
"RTN","IBCEMU1",178,0)
 .. I $G(IBMRANOT),$G(MRAONLY),$P(IBM,U,4) Q     ; EOB only check
"RTN","IBCEMU1",179,0)
 .. S INSCO=$$EXTERNAL^DILFD(361.1,.02,,$P(IBM,U,2))
"RTN","IBCEMU1",180,0)
 .. S SEQ=$E($$EXTERNAL^DILFD(361.1,.15,,$P(IBM,U,15)),1)
"RTN","IBCEMU1",181,0)
 .. S EOBDT=$$FMTE^XLFDT($P($P(IBM,U,6),".",1),"2Z")
"RTN","IBCEMU1",182,0)
 .. S EOBTYP=$P("EOB^MRA",U,$P(IBM,U,4)+1)
"RTN","IBCEMU1",183,0)
 .. S CLMSTAT=$$EXTERNAL^DILFD(361.1,.13,"",$P(IBM,U,13))
"RTN","IBCEMU1",184,0)
 .. S COUNT=COUNT+1
"RTN","IBCEMU1",185,0)
 .. S LIST(COUNT)=IEN_U_SEQ_U_INSCO_U_EOBDT_U_EOBTYP_U_CLMSTAT
"RTN","IBCEMU1",186,0)
 .. Q
"RTN","IBCEMU1",187,0)
 . Q
"RTN","IBCEMU1",188,0)
 ;
"RTN","IBCEMU1",189,0)
 I 'COUNT G SELX                           ; no mra/eob data found
"RTN","IBCEMU1",190,0)
 ;
"RTN","IBCEMU1",191,0)
 ; Display mra/eob data
"RTN","IBCEMU1",192,0)
 S J="EOB's/MRA's"
"RTN","IBCEMU1",193,0)
 ;I $G(MRAONLY) S J="MRA's"
"RTN","IBCEMU1",194,0)
 S:$G(IBMRANOT)'=1 J="MRA's"
"RTN","IBCEMU1",195,0)
 I COUNT>1 W !!,"The selected bill has multiple ",J," on file.  Please choose one."
"RTN","IBCEMU1",196,0)
 W !!?7,"#",?11,"Seq",?17,"Insurance Company",?40,"EOB Date"
"RTN","IBCEMU1",197,0)
 W ?51,"Type",?57,"Claim Status"
"RTN","IBCEMU1",198,0)
 F J=1:1:COUNT S A=LIST(J) D
"RTN","IBCEMU1",199,0)
 . W !?5,$J(J,3),?11,"(",$P(A,U,2),")",?17,$E($P(A,U,3),1,20)
"RTN","IBCEMU1",200,0)
 . W ?40,$P(A,U,4),?51,$P(A,U,5),?57,$P(A,U,6)
"RTN","IBCEMU1",201,0)
 . Q
"RTN","IBCEMU1",202,0)
 ;
"RTN","IBCEMU1",203,0)
 ; User Selection
"RTN","IBCEMU1",204,0)
 W ! S DIR(0)="NO^1:"_COUNT,DIR("A")="Select an EOB/MRA"
"RTN","IBCEMU1",205,0)
 ;I $G(MRAONLY) S DIR("A")="Select an MRA"
"RTN","IBCEMU1",206,0)
 S:$G(IBMRANOT)'=1 DIR("A")="Select an MRA"
"RTN","IBCEMU1",207,0)
 D ^DIR K DIR
"RTN","IBCEMU1",208,0)
 I 'Y G SELX    ; no selection made
"RTN","IBCEMU1",209,0)
 S IBEOB=+$G(LIST(Y))
"RTN","IBCEMU1",210,0)
 ;
"RTN","IBCEMU1",211,0)
 ; At this point we need to update the scratch globals with this
"RTN","IBCEMU1",212,0)
 ; EOB specific data
"RTN","IBCEMU1",213,0)
 S IBM=$G(^IBM(361.1,IBEOB,0)) I IBM="" G SELX
"RTN","IBCEMU1",214,0)
 S IBM1=$G(^IBM(361.1,IBEOB,1))
"RTN","IBCEMU1",215,0)
 ;
"RTN","IBCEMU1",216,0)
 I IBDA,$P($G(^TMP("IBCECOB",$J,IBDA)),U,2)=IBIFN D
"RTN","IBCEMU1",217,0)
 . S $P(^TMP("IBCECOB",$J,IBDA),U,3)=$P(IBM,U,19)    ; ptr 364
"RTN","IBCEMU1",218,0)
 . S $P(^TMP("IBCECOB",$J,IBDA),U,4)=IBEOB           ; 361.1 ien
"RTN","IBCEMU1",219,0)
 . Q
"RTN","IBCEMU1",220,0)
 ;
"RTN","IBCEMU1",221,0)
 I IBDA,$D(^TMP("IBCECOB1",$J,IBDA)) D
"RTN","IBCEMU1",222,0)
 . S $P(^TMP("IBCECOB1",$J,IBDA),U,10)=IBEOB         ; 361.1 ien
"RTN","IBCEMU1",223,0)
 . S $P(^TMP("IBCECOB1",$J,IBDA),U,13)=$P(IBM,U,6)   ; eob paid date
"RTN","IBCEMU1",224,0)
 . S $P(^TMP("IBCECOB1",$J,IBDA),U,15)=$P(IBM,U,19)  ; ptr 364
"RTN","IBCEMU1",225,0)
 . S $P(^TMP("IBCECOB1",$J,IBDA),U,16)=$P(IBM,U,15)  ; ins seq
"RTN","IBCEMU1",226,0)
 . S $P(^TMP("IBCECOB1",$J,IBDA),U,17)=$P(IBM1,U,1)  ; payer paid amt
"RTN","IBCEMU1",227,0)
 . Q
"RTN","IBCEMU1",228,0)
SELX ;
"RTN","IBCEMU1",229,0)
 Q IBEOB
"RTN","IBCEMU1",230,0)
 ;
"RTN","IBCEMU1",231,0)
 ;
"RTN","IBCEMU1",232,0)
CHKSUM(IBARRAY) ; Incoming 835 checksum calculation
"RTN","IBCEMU1",233,0)
 ; This function calculates the checksum of the raw 835 data from
"RTN","IBCEMU1",234,0)
 ; the data in array IBARRAY.  This is done to prevent duplicates.
"RTN","IBCEMU1",235,0)
 ; Input parameter IBARRAY is the array reference where the data exists
"RTN","IBCEMU1",236,0)
 ;    at @IBARRAY@(n,0) where n is a sequential #
"RTN","IBCEMU1",237,0)
 ; For file 364.2, IBARRAY = "^IBA(364.2,IBIEN,2)" where IBIEN = the ien
"RTN","IBCEMU1",238,0)
 ;    of the entry in file 364.2 being evaluated
"RTN","IBCEMU1",239,0)
 ;
"RTN","IBCEMU1",240,0)
 NEW Y,LN,DATA,IBREC,POS,EOBFLG
"RTN","IBCEMU1",241,0)
 S Y=0,EOBFLG=0
"RTN","IBCEMU1",242,0)
 S LN=0
"RTN","IBCEMU1",243,0)
 F  S LN=$O(@IBARRAY@(LN)) Q:'LN  D
"RTN","IBCEMU1",244,0)
 . S DATA=$$EXT($G(@IBARRAY@(LN,0))) Q:DATA=""
"RTN","IBCEMU1",245,0)
 . S IBREC=$P(DATA,U,1)
"RTN","IBCEMU1",246,0)
 . I IBREC="835EOB"!(IBREC="835ERA") S EOBFLG=1 Q      ; set the EOB flag
"RTN","IBCEMU1",247,0)
 . I IBREC<1 Q             ; rec# too low
"RTN","IBCEMU1",248,0)
 . I IBREC'<99 Q           ; rec# too high
"RTN","IBCEMU1",249,0)
 . F POS=1:1:$L(DATA) S Y=Y+($A(DATA,POS)*POS)
"RTN","IBCEMU1",250,0)
 . Q
"RTN","IBCEMU1",251,0)
 ;
"RTN","IBCEMU1",252,0)
 I 'EOBFLG S Y=0   ; if this array is not an 835
"RTN","IBCEMU1",253,0)
 Q Y
"RTN","IBCEMU1",254,0)
 ;
"RTN","IBCEMU1",255,0)
EXT(DATA) ; Extracts from the text in DATA if the text contains 
"RTN","IBCEMU1",256,0)
 ;  "##RAW DATA: "
"RTN","IBCEMU1",257,0)
 Q $S(DATA["##RAW DATA: ":$P(DATA,"##RAW DATA: ",2,99),1:DATA)
"RTN","IBCEMU1",258,0)
 ;
"RTN","IBCEMU4")
0^12^B1508771^B1146588
"RTN","IBCEMU4",1,0)
IBCEMU4 ;ALB/ESG - MRA UTILITIES ;25-OCT-2004
"RTN","IBCEMU4",2,0)
 ;;2.0;INTEGRATED BILLING;**288,432**;21-MAR-94;Build 192
"RTN","IBCEMU4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEMU4",4,0)
 ;
"RTN","IBCEMU4",5,0)
 Q
"RTN","IBCEMU4",6,0)
 ;
"RTN","IBCEMU4",7,0)
DENDUP(IBEOB,IBMRANOT) ; Denied for Duplicate Function ;WCJ IB*2.0*432
"RTN","IBCEMU4",8,0)
 ; Function returns true if MRA is Denied AND Reason code 18 is present (Duplicate claim/service)
"RTN","IBCEMU4",9,0)
 NEW IBX,IBM,LINE,DUP,ADJ
"RTN","IBCEMU4",10,0)
 S IBX=0,IBM=$G(^IBM(361.1,+$G(IBEOB),0))
"RTN","IBCEMU4",11,0)
 I '$G(IBMRANOT),$P(IBM,U,4)'=1 G DENDUPX    ; not an MRA  ;WCJ IB*2.0*432
"RTN","IBCEMU4",12,0)
 I $G(IBMRANOT),$P(IBM,U,4)'=0 G DENDUPX    ; not an EOB ;WCJ IB*2.0*432
"RTN","IBCEMU4",13,0)
 I $P(IBM,U,13)'=2 G DENDUPX   ; not Denied
"RTN","IBCEMU4",14,0)
 ;
"RTN","IBCEMU4",15,0)
 ; check line item adjustments for reason code 18
"RTN","IBCEMU4",16,0)
 S LINE=0,DUP=0
"RTN","IBCEMU4",17,0)
 F  S LINE=$O(^IBM(361.1,IBEOB,15,LINE)) Q:'LINE  D  Q:DUP
"RTN","IBCEMU4",18,0)
 . S ADJ=0
"RTN","IBCEMU4",19,0)
 . F  S ADJ=$O(^IBM(361.1,IBEOB,15,LINE,1,ADJ)) Q:'ADJ  D  Q:DUP
"RTN","IBCEMU4",20,0)
 .. I $D(^IBM(361.1,IBEOB,15,LINE,1,ADJ,1,"B",18)) S DUP=1 Q
"RTN","IBCEMU4",21,0)
 .. Q
"RTN","IBCEMU4",22,0)
 . Q
"RTN","IBCEMU4",23,0)
 ;
"RTN","IBCEMU4",24,0)
 I DUP S IBX=1
"RTN","IBCEMU4",25,0)
DENDUPX ;
"RTN","IBCEMU4",26,0)
 Q IBX
"RTN","IBCEMU4",27,0)
 ;
"RTN","IBCEOB")
0^103^B95746536^B81821331
"RTN","IBCEOB",1,0)
IBCEOB ;ALB/TMP/PJH - 835 EDI EOB MESSAGE PROCESSING ; 8/19/10 6:33pm
"RTN","IBCEOB",2,0)
 ;;2.0;INTEGRATED BILLING;**137,135,265,155,377,407,431,432**;21-MAR-94;Build 192
"RTN","IBCEOB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEOB",4,0)
 ;
"RTN","IBCEOB",5,0)
 Q
"RTN","IBCEOB",6,0)
 ;
"RTN","IBCEOB",7,0)
UPDEOB(IBTDA) ; Update EXPLANATION OF BENEFITS file (#361.1) from return msg
"RTN","IBCEOB",8,0)
 ; IBTDA = ien of return message
"RTN","IBCEOB",9,0)
 ; Function returns ien of EOB file entry or "" if errors found
"RTN","IBCEOB",10,0)
 ;          the data.  Any errors found are
"RTN","IBCEOB",11,0)
 ;          stored in array ^TMP("IBCERR-EOB",$J,n) in text format
"RTN","IBCEOB",12,0)
 ;          n = seq # and are stored with the EOB in a wp field
"RTN","IBCEOB",13,0)
 ;
"RTN","IBCEOB",14,0)
 N IB0,IB100,IBBTCH,IBE,IBMNUM,IBT,DLAYGO,DIC,DD,DO,X,Y,Z,Z0,Z1,IBEOB,IBBAD,IBOK,IB,IBA1,IBIFN,IBFILE
"RTN","IBCEOB",15,0)
 K ^TMP($J),^TMP("IBCERR-EOB",$J)
"RTN","IBCEOB",16,0)
 ;
"RTN","IBCEOB",17,0)
 S (IBBAD,IBEOB)=""
"RTN","IBCEOB",18,0)
 S IB0=$G(^IBA(364.2,IBTDA,0))
"RTN","IBCEOB",19,0)
 S IBMNUM=+$P(IB0,U)
"RTN","IBCEOB",20,0)
 S X=+$G(^IBA(364,+$P(IB0,U,5),0))
"RTN","IBCEOB",21,0)
 ;
"RTN","IBCEOB",22,0)
 I IBMNUM=""!(X="") G UPDQ
"RTN","IBCEOB",23,0)
 ;
"RTN","IBCEOB",24,0)
 ; Duplicate EOB Check
"RTN","IBCEOB",25,0)
 S IBFILE="^IBA(364.2,"_IBTDA_",2)"
"RTN","IBCEOB",26,0)
 I $$DUP(IBFILE,X) D DELMSG^IBCESRV2(IBTDA) G UPDQ
"RTN","IBCEOB",27,0)
 ;
"RTN","IBCEOB",28,0)
 I '$$LOCK^IBCEM(IBTDA) G UPDQ ;Lock msg file 364.2
"RTN","IBCEOB",29,0)
 S IBEOB=+$$ADD3611(IBMNUM,$P(IB0,U,5),$P(IB0,U,4),X,0,IBFILE)
"RTN","IBCEOB",30,0)
 L -^IBA(364.2,IBTDA,0)
"RTN","IBCEOB",31,0)
 ;
"RTN","IBCEOB",32,0)
 I IBEOB<0 S IBEOB="" G UPDQ
"RTN","IBCEOB",33,0)
 D UPD3611(IBEOB,IBTDA,0)
"RTN","IBCEOB",34,0)
 ;
"RTN","IBCEOB",35,0)
UPDQ I IBEOB,$O(^TMP("IBCERR-EOB",$J,0)) D ERRUPD(IBEOB,"IBCERR-EOB")
"RTN","IBCEOB",36,0)
 ;
"RTN","IBCEOB",37,0)
 K ^TMP($J),^TMP("IBCERR-EOB",$J)
"RTN","IBCEOB",38,0)
 D CLEAN^DILF
"RTN","IBCEOB",39,0)
 Q +IBEOB
"RTN","IBCEOB",40,0)
 ;
"RTN","IBCEOB",41,0)
 ;
"RTN","IBCEOB",42,0)
 ; NOTE: **** For all variables IB0,IBEGBL,IBEOB below:
"RTN","IBCEOB",43,0)
 ; IB0 = raw data received for this record type on the 835 flat file
"RTN","IBCEOB",44,0)
 ; IBEGBL = subscript to use in error global
"RTN","IBCEOB",45,0)
 ; IBEOB = ien in file 361.1 for this EOB
"RTN","IBCEOB",46,0)
 ;
"RTN","IBCEOB",47,0)
835(IB0,IBEGBL,IBEOB) ; Store header
"RTN","IBCEOB",48,0)
 ;
"RTN","IBCEOB",49,0)
 Q $$HDR^IBCEOB1(IB0,IBEGBL,IBEOB,.HIPAA)
"RTN","IBCEOB",50,0)
 ;
"RTN","IBCEOB",51,0)
5(IB0,IBEGBL,IBEOB) ; Record '05'
"RTN","IBCEOB",52,0)
 ;
"RTN","IBCEOB",53,0)
 N IBOK,DA,DR,DIE,X,Y
"RTN","IBCEOB",54,0)
 K IBZDATA
"RTN","IBCEOB",55,0)
 S DR=";",IBOK=1
"RTN","IBCEOB",56,0)
 S DIE="^IBM(361.1,",DA=IBEOB
"RTN","IBCEOB",57,0)
 ;
"RTN","IBCEOB",58,0)
 I $P(IB0,U,9) S DR=DR_"1.1///"_$$DATE^IBCEU($P(IB0,U,9))_";"         ; statement start date
"RTN","IBCEOB",59,0)
 I $P(IB0,U,10) S DR=DR_"1.11///"_$$DATE^IBCEU($P(IB0,U,10))_";"      ; statement end date
"RTN","IBCEOB",60,0)
 I $P(IB0,U,11) S DR=DR_"1.12///"_$$DATE^IBCEU($P(IB0,U,11))_";"      ; claim received date
"RTN","IBCEOB",61,0)
 S DR=$P(DR,";",2,$L(DR,";")-1)
"RTN","IBCEOB",62,0)
 I DR'="" D ^DIE S IBOK=$D(Y)=0
"RTN","IBCEOB",63,0)
 I 'IBOK S ^TMP(IBEGBL,$J,+$O(^TMP(IBEGBL,$J,""),-1)+1)="Bad record 5 data"
"RTN","IBCEOB",64,0)
 Q IBOK
"RTN","IBCEOB",65,0)
 ;
"RTN","IBCEOB",66,0)
6(IB0,IBEGBL,IBEOB) ; Record '06' - corrected patient name and/or ID#
"RTN","IBCEOB",67,0)
 ; This data is not going to be filed into file 361.1 so the value of this function will always be a 1 so as to
"RTN","IBCEOB",68,0)
 ; not interrupt the filing process of the EOB/MRA data into file 361.1.
"RTN","IBCEOB",69,0)
 ;
"RTN","IBCEOB",70,0)
 ; perform overall integrity checks on the incoming 06 record.  If anything is out of place, don't update anything
"RTN","IBCEOB",71,0)
 ; and report the problem and get out.
"RTN","IBCEOB",72,0)
 NEW CLM,SITE,IBM,IBIFN,IBIFN1,DFN,SEQ,DIE,DA,DR
"RTN","IBCEOB",73,0)
 S DIE=361.1,DA=IBEOB,DR="61.01////^S X=IB0" D ^DIE    ; archive the raw 06 record data
"RTN","IBCEOB",74,0)
 S CLM=$P(IB0,U,2),SITE=+CLM,CLM=$P(CLM,"-",2) I CLM="" D MSG(IBEOB,"The claim# in piece 2 is invalid.") G Q6
"RTN","IBCEOB",75,0)
 S IBM=$G(^IBM(361.1,IBEOB,0))
"RTN","IBCEOB",76,0)
 I $P(IBM,U,4)'=1 D MSG(IBEOB,"This is a non-Medicare EOB.") G Q6
"RTN","IBCEOB",77,0)
 S IBIFN=+$P(IBM,U,1)                    ; claim# from MRA
"RTN","IBCEOB",78,0)
 S IBIFN1=+$O(^DGCR(399,"B",CLM,""))     ; claim# from 06 record
"RTN","IBCEOB",79,0)
 I IBIFN'=IBIFN1 D MSG(IBEOB,"Claim mismatch error."_IBIFN_","_IBIFN1_","_CLM_".") G Q6
"RTN","IBCEOB",80,0)
 I $P($$SITE^VASITE,U,3)'=SITE D MSG(IBEOB,"Invalid station# mismatch."_$P($$SITE^VASITE,U,3)_","_SITE_".") G Q6
"RTN","IBCEOB",81,0)
 S SEQ=$$COBN^IBCEF(IBIFN)               ; current payer sequence# on claim
"RTN","IBCEOB",82,0)
 I '$$WNRBILL^IBEFUNC(IBIFN,SEQ) D MSG(IBEOB,"The current payer on this claim is not MEDICARE (WNR).") G Q6
"RTN","IBCEOB",83,0)
 S DFN=+$P($G(^DGCR(399,IBIFN,0)),U,2)   ; patient ien
"RTN","IBCEOB",84,0)
 I 'DFN D MSG(IBEOB,"The patient DFN cannot be determined.") G Q6
"RTN","IBCEOB",85,0)
 ;
"RTN","IBCEOB",86,0)
 D UPD^IBCEOB01(IB0,IBEOB,IBIFN,DFN,SEQ)     ; update patient insurance policy data
"RTN","IBCEOB",87,0)
 ;
"RTN","IBCEOB",88,0)
Q6 ; exit point for $$6 function
"RTN","IBCEOB",89,0)
 Q 1
"RTN","IBCEOB",90,0)
 ;
"RTN","IBCEOB",91,0)
10(IB0,IBEGBL,IBEOB) ; Record '10'
"RTN","IBCEOB",92,0)
 ;
"RTN","IBCEOB",93,0)
 N DA,DR,DIE,X,Y,VAL,IBOK,IB361
"RTN","IBCEOB",94,0)
 S DIE="^IBM(361.1,",DA=IBEOB
"RTN","IBCEOB",95,0)
 ; put denied non-MRA claims on the worklist IB*2.0*432
"RTN","IBCEOB",96,0)
 ;S IB361=$G(^IBM(361.1,DA,0))
"RTN","IBCEOB",97,0)
 ;I $P(IB361,U,4)=0,$P(IB0,U,4)="Y" D PUTONWL^IBCAPP($P(IB361,U),"IB804:EOB Claim Status must be PROCESSED")
"RTN","IBCEOB",98,0)
 S DR=".13////"_$S($P(IB0,U,3)="Y":1,$P(IB0,U,4)="Y":2,$P(IB0,U,5)="Y":3,$P(IB0,U,6)="Y":4,1:5)_";.21////"_$P(IB0,U,7)
"RTN","IBCEOB",99,0)
 S DR=DR_";2.04////"_$$DOLLAR($P(IB0,U,10))_";1.01////"_$$DOLLAR($P(IB0,U,11))_$S($P(IB0,U,12)'="":";.14///"_$P(IB0,U,12),1:"")
"RTN","IBCEOB",100,0)
 S DR=DR_$S($P(IB0,U,13)'="":";.1///"_$P(IB0,U,13),1:"")_";.11///"_($P(IB0,U,14)/10000)_";.12///"_($P(IB0,U,15)/100)
"RTN","IBCEOB",101,0)
 I $P(IB0,U,8)'="" S DR=DR_";.08////"_$P(IB0,U,8)_$S($P(IB0,U,9)'="":";.09///"_$P(IB0,U,9),1:"")
"RTN","IBCEOB",102,0)
 I HIPAA,$P(IB0,U,16) S DR=DR_";1.13///"_$$DATE^IBCEU($P(IB0,U,16))_";"      ; coverage exp. date
"RTN","IBCEOB",103,0)
 ;
"RTN","IBCEOB",104,0)
 D ^DIE
"RTN","IBCEOB",105,0)
 S IBOK=($D(Y)=0)
"RTN","IBCEOB",106,0)
 I 'IBOK S ^TMP(IBEGBL,$J,+$O(^TMP(IBEGBL,$J,""),-1)+1)="Bad record 10 data" G Q10
"RTN","IBCEOB",107,0)
 ;
"RTN","IBCEOB",108,0)
 ; File ICN in Bill
"RTN","IBCEOB",109,0)
 D ICN^IBCEOB00(IBEOB,$P(IB0,U,12),$P($G(^IBM(361.1,IBEOB,0)),U,15),.IBOK)
"RTN","IBCEOB",110,0)
 ;
"RTN","IBCEOB",111,0)
Q10 Q IBOK
"RTN","IBCEOB",112,0)
 ;
"RTN","IBCEOB",113,0)
12(IB0,IBEGL,IBEOB) ; Record '12'
"RTN","IBCEOB",114,0)
 ;
"RTN","IBCEOB",115,0)
 N DA,DR,DIE,X,Y,VAL,IBOK
"RTN","IBCEOB",116,0)
 I HIPAA'=5010 S IBOK=1 G Q12
"RTN","IBCEOB",117,0)
 S DIE="^IBM(361.1,",DA=IBEOB,DR=";"
"RTN","IBCEOB",118,0)
 I $P(IB0,U,3)'="" S DR=DR_"1.14////"_$P(IB0,U,3)_";"
"RTN","IBCEOB",119,0)
 I $P(IB0,U,4)'="" S DR=DR_"1.15////"_$P(IB0,U,4)_";"
"RTN","IBCEOB",120,0)
 I $P(IB0,U,5)'="" S DR=DR_"1.16////"_$P(IB0,U,5)_";"
"RTN","IBCEOB",121,0)
 S DR=$P(DR,";",2,$L(DR,";")-1)
"RTN","IBCEOB",122,0)
 ;
"RTN","IBCEOB",123,0)
 D ^DIE
"RTN","IBCEOB",124,0)
 S IBOK=($D(Y)=0)
"RTN","IBCEOB",125,0)
 I 'IBOK S ^TMP(IBEGBL,$J,+$O(^TMP(IBEGBL,$J,""),-1)+1)="Bad record 12 data"
"RTN","IBCEOB",126,0)
 ;
"RTN","IBCEOB",127,0)
Q12 Q IBOK
"RTN","IBCEOB",128,0)
 ;
"RTN","IBCEOB",129,0)
13(IB0,IBEGL,IBEOB) ; Record '13'
"RTN","IBCEOB",130,0)
 ;
"RTN","IBCEOB",131,0)
 N DA,DR,DIE,X,Y,VAL,IBOK,NAME
"RTN","IBCEOB",132,0)
 I HIPAA'=5010 S IBOK=1 G Q13
"RTN","IBCEOB",133,0)
 S DIE="^IBM(361.1,",DA=IBEOB
"RTN","IBCEOB",134,0)
 S NAME=$P(IB0,U,3) I NAME="" S IBOK=1 G Q13
"RTN","IBCEOB",135,0)
 I $P(IB0,U,4)'="" S NAME=NAME_","_$P(IB0,U,4)
"RTN","IBCEOB",136,0)
 I $P(IB0,U,5)'="" S NAME=NAME_","_$P(IB0,U,5)
"RTN","IBCEOB",137,0)
 S DR="1.17////"_NAME ; Other Subscriber Name
"RTN","IBCEOB",138,0)
 ;
"RTN","IBCEOB",139,0)
 D ^DIE
"RTN","IBCEOB",140,0)
 S IBOK=($D(Y)=0)
"RTN","IBCEOB",141,0)
 I 'IBOK S ^TMP(IBEGBL,$J,+$O(^TMP(IBEGBL,$J,""),-1)+1)="Bad record 13 data"
"RTN","IBCEOB",142,0)
 ;
"RTN","IBCEOB",143,0)
Q13 Q IBOK
"RTN","IBCEOB",144,0)
 ;
"RTN","IBCEOB",145,0)
15(IB0,IBEGBL,IBEOB) ; Record '15'
"RTN","IBCEOB",146,0)
 ; Moved due to space constraints
"RTN","IBCEOB",147,0)
Q15 Q $$15^IBCEOB00(IB0,IBEGBL,IBEOB)
"RTN","IBCEOB",148,0)
 ;
"RTN","IBCEOB",149,0)
17(IB0,IBEGBL,IBEOB) ; Record '17'
"RTN","IBCEOB",150,0)
 N A,DATA,IBOK
"RTN","IBCEOB",151,0)
 ;Old Format
"RTN","IBCEOB",152,0)
 S DATA=IB0
"RTN","IBCEOB",153,0)
 ;New Format - store incoming data in first available field
"RTN","IBCEOB",154,0)
 I HIPAA>0 D
"RTN","IBCEOB",155,0)
 .N CNT
"RTN","IBCEOB",156,0)
 .S CNT=4,DATA=$P(DATA,U,1,3) ;Claim Contact Name
"RTN","IBCEOB",157,0)
 .I $P(IB0,U,4)'="" S $P(DATA,U,CNT)=$P(IB0,U,4),$P(DATA,U,CNT+1)="TE",CNT=CNT+2 ;Tel
"RTN","IBCEOB",158,0)
 .I $P(IB0,U,5)'="" S $P(DATA,U,CNT)=$P(IB0,U,5),$P(DATA,U,CNT+1)="FX",CNT=CNT+2 ;Fax
"RTN","IBCEOB",159,0)
 .I $P(IB0,U,6)'="" S $P(DATA,U,CNT)=$P(IB0,U,6),$P(DATA,U,CNT+1)="EM" ;email
"RTN","IBCEOB",160,0)
 ;
"RTN","IBCEOB",161,0)
 S A="3;25.01;0;1;0^4;25.02;0;1;0^5;25.03;0;1;0^6;25.04;0;1;0^7;25.05;0;1;0^8;25.06;0;1;0^9;25.07;0;1;0"
"RTN","IBCEOB",162,0)
 S IBOK=$$STORE^IBCEOB1(A,DATA,IBEOB)
"RTN","IBCEOB",163,0)
 I 'IBOK S ^TMP(IBEGBL,$J,+$O(^TMP(IBEGBL,$J,""),-1)+1)="Bad record 17 data"
"RTN","IBCEOB",164,0)
Q17 Q IBOK
"RTN","IBCEOB",165,0)
 ;
"RTN","IBCEOB",166,0)
20(IB0,IBEGBL,IBEOB) ; Record '20'
"RTN","IBCEOB",167,0)
 ; Moved due to space constraints
"RTN","IBCEOB",168,0)
Q20 Q $$20^IBCEOB00(IB0,IBEGBL,IBEOB)
"RTN","IBCEOB",169,0)
 ;
"RTN","IBCEOB",170,0)
30(IB0,IBEGBL,IBEOB) ; Record '30'
"RTN","IBCEOB",171,0)
 ;
"RTN","IBCEOB",172,0)
 N IBOK
"RTN","IBCEOB",173,0)
 D 30^IBCEOB0(IB0,IBEOB,.IBOK)
"RTN","IBCEOB",174,0)
Q30 Q $G(IBOK)
"RTN","IBCEOB",175,0)
 ;
"RTN","IBCEOB",176,0)
35(IB0,IBEGBL,IBEOB) ; Record '35'
"RTN","IBCEOB",177,0)
 ; Moved due to space constraints
"RTN","IBCEOB",178,0)
Q35 Q $$35^IBCEOB00(IB0,IBEGBL,IBEOB)
"RTN","IBCEOB",179,0)
 ;
"RTN","IBCEOB",180,0)
37(IB0,IBEGBL,IBEOB) ; Record '37'
"RTN","IBCEOB",181,0)
 ; Moved due to space constraints
"RTN","IBCEOB",182,0)
Q37 Q $$37^IBCEOB00(IB0,IBEGBL,IBEOB)
"RTN","IBCEOB",183,0)
 ;
"RTN","IBCEOB",184,0)
40(IB0,IBEGBL,IBEOB) ; Record '40'
"RTN","IBCEOB",185,0)
 ;
"RTN","IBCEOB",186,0)
 N IBOK
"RTN","IBCEOB",187,0)
 D 40^IBCEOB0(IB0,IBEOB,.IBOK)
"RTN","IBCEOB",188,0)
Q40 Q $G(IBOK)
"RTN","IBCEOB",189,0)
 ;
"RTN","IBCEOB",190,0)
41(IB0,IBEGBL,IBEOB) ; Record '41'
"RTN","IBCEOB",191,0)
 ;
"RTN","IBCEOB",192,0)
 N IBOK
"RTN","IBCEOB",193,0)
 D 41^IBCEOB0(IB0,IBEOB,.IBOK)
"RTN","IBCEOB",194,0)
Q41 Q $G(IBOK)
"RTN","IBCEOB",195,0)
 ;
"RTN","IBCEOB",196,0)
42(IB0,IBEGBL,IBEOB) ; Record '42'
"RTN","IBCEOB",197,0)
 ;
"RTN","IBCEOB",198,0)
 N IBOK
"RTN","IBCEOB",199,0)
 D 42^IBCEOB0(IB0,IBEOB,.IBOK)
"RTN","IBCEOB",200,0)
Q42 Q $G(IBOK)
"RTN","IBCEOB",201,0)
 ;
"RTN","IBCEOB",202,0)
45(IB0,IBEGBL,IBEOB) ; Record '45'
"RTN","IBCEOB",203,0)
 ;
"RTN","IBCEOB",204,0)
 N IBOK
"RTN","IBCEOB",205,0)
 D 45^IBCEOB0(IB0,IBEOB,.IBOK)
"RTN","IBCEOB",206,0)
 Q $G(IBOK)
"RTN","IBCEOB",207,0)
 ;
"RTN","IBCEOB",208,0)
 ;
"RTN","IBCEOB",209,0)
46(IB0,IBEGBL,IBEOB) ; Record '46'
"RTN","IBCEOB",210,0)
 ;
"RTN","IBCEOB",211,0)
 N IBOK
"RTN","IBCEOB",212,0)
 I HIPAA'=5010 S IBOK=1 G Q46
"RTN","IBCEOB",213,0)
 D 46^IBCEOB0(IB0,IBEOB,.IBOK)
"RTN","IBCEOB",214,0)
Q46 Q $G(IBOK)
"RTN","IBCEOB",215,0)
 ;
"RTN","IBCEOB",216,0)
MSG(IBEOB,MSG) ; procedure to file message into field 6.03
"RTN","IBCEOB",217,0)
 ; Results of processing of the "06" record type
"RTN","IBCEOB",218,0)
 N DIE,DA,DR,Z
"RTN","IBCEOB",219,0)
 S DIE=361.1,DA=+$G(IBEOB)
"RTN","IBCEOB",220,0)
 I $G(MSG)="" G MSGX
"RTN","IBCEOB",221,0)
 S Z=$P($G(^IBM(361.1,DA,6)),U,3)    ; already existing message
"RTN","IBCEOB",222,0)
 I Z'="" S MSG=Z_"  "_MSG            ; append new message to existing message
"RTN","IBCEOB",223,0)
 S MSG=$E(MSG,1,190)
"RTN","IBCEOB",224,0)
 S DR="6.03///^S X=MSG"
"RTN","IBCEOB",225,0)
 D ^DIE
"RTN","IBCEOB",226,0)
MSGX ;
"RTN","IBCEOB",227,0)
 Q
"RTN","IBCEOB",228,0)
 ;
"RTN","IBCEOB",229,0)
DOLLAR(X) ; Convert value in X to dollar format XXX.XX
"RTN","IBCEOB",230,0)
 Q $S(+X:$J(X/100,$L(+X),2),1:0)
"RTN","IBCEOB",231,0)
 ;
"RTN","IBCEOB",232,0)
ADD3611(IBMNUM,IBTBILL,IBBATCH,X,IBAR,IBFILE) ; Add stub record to file 361.1
"RTN","IBCEOB",233,0)
 ; X = the ien of the referenced bill in file 399
"RTN","IBCEOB",234,0)
 ; IBTBILL = ien of transmitted bill (optional)
"RTN","IBCEOB",235,0)
 ; IBBATCH = ien of batch # the transmitted bill was in (optional)
"RTN","IBCEOB",236,0)
 ; IBMNUM = the message # from which this record originally came
"RTN","IBCEOB",237,0)
 ; IBAR = 1 only if called from AR
"RTN","IBCEOB",238,0)
 ; IBFILE = array reference of raw EOB data
"RTN","IBCEOB",239,0)
 ;
"RTN","IBCEOB",240,0)
 N DIC,DA,DR,DO,DD,DLAYGO,Y,REVSTAT,BS,MMI
"RTN","IBCEOB",241,0)
 F  L +^IBM(361.1,0):10 Q:$T
"RTN","IBCEOB",242,0)
 ;
"RTN","IBCEOB",243,0)
 ; default proper review status
"RTN","IBCEOB",244,0)
 S BS=$P($G(^DGCR(399,X,0)),U,13)   ; bill status
"RTN","IBCEOB",245,0)
 S REVSTAT=$S(BS=7:9,BS=3:3,BS=4:3,1:0)
"RTN","IBCEOB",246,0)
 S MMI=$$NET^XMRENT(IBMNUM)         ; MailMan header info
"RTN","IBCEOB",247,0)
 S DIC(0)="L",DIC="^IBM(361.1,",DLAYGO=361.1
"RTN","IBCEOB",248,0)
 S DIC("DR")=".16////"_REVSTAT_";.17////0"_";100.02////"_IBMNUM_$S('$G(IBAR):";.19////"_+IBTBILL_";100.01////"_IBBATCH,1:"")
"RTN","IBCEOB",249,0)
 S DIC("DR")=DIC("DR")_";100.05////"_$$CHKSUM^IBCEMU1(IBFILE)_";62.01////^S X=MMI"
"RTN","IBCEOB",250,0)
 D FILE^DICN
"RTN","IBCEOB",251,0)
 L -^IBM(361.1,0)
"RTN","IBCEOB",252,0)
 Q +Y
"RTN","IBCEOB",253,0)
 ;
"RTN","IBCEOB",254,0)
UPD3611(IBEOB,IBTDA,IBAR) ; From flat file 835 format, add EOB record
"RTN","IBCEOB",255,0)
 ; IBEOB = the ien of the entry in file 361.1 being updated
"RTN","IBCEOB",256,0)
 ; IBTDA = the ien in the source file
"RTN","IBCEOB",257,0)
 ; IBAR = 1 if being called from AR
"RTN","IBCEOB",258,0)
 N HIPAA,IBA1,IBFILE,IBEGBL,Z,IBREC,Q
"RTN","IBCEOB",259,0)
 S IBFILE=$S('$G(IBAR):"^IBA(364.2,"_IBTDA_",2)",1:"^TMP("_$J_",""RCDP-EOB"","_IBTDA_")")
"RTN","IBCEOB",260,0)
 S IBEGBL=$S('$G(IBAR):"IBCERR-EOB",1:"RCDPERR-EOB")
"RTN","IBCEOB",261,0)
 S HIPAA=0
"RTN","IBCEOB",262,0)
 I $G(IBAR),'$$HDR^IBCEOB1($G(^TMP($J,"RCDPEOB","HDR")),IBEGBL,IBEOB,.HIPAA) Q
"RTN","IBCEOB",263,0)
 S IBA1=0
"RTN","IBCEOB",264,0)
 F  S IBA1=$O(@IBFILE@(IBA1)) Q:'IBA1  S IB0=$S('$G(IBAR):$P($G(^(IBA1,0)),"##RAW DATA: ",2),1:$G(@IBFILE@(IBA1,0))) I IB0'="" D
"RTN","IBCEOB",265,0)
 . S IBREC=+IB0
"RTN","IBCEOB",266,0)
 . I IBREC'=37 K ^TMP($J,37)
"RTN","IBCEOB",267,0)
 . I IBREC S IB="S IBOK=$$"_IBREC_"(IB0,IBEGBL,IBEOB)",Q=IBREC_"^IBCEOB" I $T(@Q)'="" X IB S:'IBOK ^TMP(IBEGBL,$J,+$O(^TMP(IBEGBL,$J,""),-1)+1)=$S('$G(IBAR):"  ##RAW DATA: ",1:"")_IB0
"RTN","IBCEOB",268,0)
 ; If a DENIED non MRA EOB with no filing errors is updated, put on the CBW worklist if the 
"RTN","IBCEOB",269,0)
 ; claim isn't already COLLECTED/CLOSED and there is a subsequent payer (incl. Tricare & ChampVA)
"RTN","IBCEOB",270,0)
 I IBEOB,'$O(^TMP(IBEGBL,$J,0)) D
"RTN","IBCEOB",271,0)
 .N IB361,IBIFN,IBX,IBTXT,IBPYMT
"RTN","IBCEOB",272,0)
 .; must be non-MRA EOB and DENIED
"RTN","IBCEOB",273,0)
 .S IB361=$G(^IBM(361.1,IBEOB,0)),IBIFN=$P(IB361,U) Q:$P(IB361,U,4)'=0
"RTN","IBCEOB",274,0)
 .Q:$P(IB361,U,13)'=2
"RTN","IBCEOB",275,0)
 .Q:$P($$ARSTATA^IBJTU4(IBIFN),U)="COLLECTED/CLOSED"
"RTN","IBCEOB",276,0)
 .; payment on this bill from A/R IA#380 OR payer paid amount from EOB
"RTN","IBCEOB",277,0)
 .S IBPYMT=$$TPR^PRCAFN(IBIFN) S:IBPYMT="" IBPYMT=+$G(^IBM(361.1,IBEOB,1))
"RTN","IBCEOB",278,0)
 .; check for subsequent payer
"RTN","IBCEOB",279,0)
 .S IBX=$$EOB^IBCNSBL2($G(IBIFN),+$G(^DGCR(399,IBIFN,"U1")),$G(IBPYMT),.IBTXT) Q:'$D(IBTXT)
"RTN","IBCEOB",280,0)
 .D PUTONWL^IBCAPP($P(IB361,U),"IB804:EOB Claim Status must be PROCESSED")
"RTN","IBCEOB",281,0)
 ;
"RTN","IBCEOB",282,0)
 Q
"RTN","IBCEOB",283,0)
 ;
"RTN","IBCEOB",284,0)
ERRUPD(IBEOB,IBEGBL) ; Update error text in entry, if needed
"RTN","IBCEOB",285,0)
 D WP^DIE(361.1,IBEOB_",",20,"","^TMP(IBEGBL,$J)","")
"RTN","IBCEOB",286,0)
 Q
"RTN","IBCEOB",287,0)
 ;
"RTN","IBCEOB",288,0)
 ;
"RTN","IBCEOB",289,0)
DUP(IBARRAY,IBIFN) ; Duplicate Check
"RTN","IBCEOB",290,0)
 ; This function determines if the EOB data already exists in file
"RTN","IBCEOB",291,0)
 ; 361.1 by comparing the checksums of the raw 835 data.
"RTN","IBCEOB",292,0)
 ;
"RTN","IBCEOB",293,0)
 ; IBARRAY = Literal array reference where the raw 835 data exists.
"RTN","IBCEOB",294,0)
 ;           The data exists at @IBARRAY@(n,0), where n is the seq#.
"RTN","IBCEOB",295,0)
 ;           For example, IBARRAY = "^IBA(364.2,IBIEN,2)"
"RTN","IBCEOB",296,0)
 ;
"RTN","IBCEOB",297,0)
 ; IBIFN = the bill # (ptr to 399).  The checksums of the EOB's on 
"RTN","IBCEOB",298,0)
 ;         file for this bill will be compared to the checksum of the
"RTN","IBCEOB",299,0)
 ;         835 raw data in the IBARRAY reference.
"RTN","IBCEOB",300,0)
 ;
"RTN","IBCEOB",301,0)
 ; This function returns 0 if the entry is not found (no duplicate),
"RTN","IBCEOB",302,0)
 ; Otherwise, the IEN of the entry in file 361.1 is returned if this
"RTN","IBCEOB",303,0)
 ; is a duplicate EOB.
"RTN","IBCEOB",304,0)
 ;
"RTN","IBCEOB",305,0)
 NEW DUP,IBEOB,CHKSUM1,CHKSUM2
"RTN","IBCEOB",306,0)
 S DUP=0,IBIFN=+$G(IBIFN)
"RTN","IBCEOB",307,0)
 I $G(IBARRAY)=""!'IBIFN G DUPX
"RTN","IBCEOB",308,0)
 I '$D(^IBM(361.1,"B",IBIFN)) G DUPX     ; no EOB's on file yet
"RTN","IBCEOB",309,0)
 S CHKSUM1=$$CHKSUM^IBCEMU1(IBARRAY)     ; checksum of current EOB
"RTN","IBCEOB",310,0)
 I 'CHKSUM1 G DUPX                       ; must be able to be calculated
"RTN","IBCEOB",311,0)
 S IBEOB=0
"RTN","IBCEOB",312,0)
 F  S IBEOB=$O(^IBM(361.1,"B",IBIFN,IBEOB)) Q:'IBEOB  D  Q:DUP
"RTN","IBCEOB",313,0)
 . S CHKSUM2=+$P($G(^IBM(361.1,IBEOB,100)),U,5)   ; checksum of old EOB
"RTN","IBCEOB",314,0)
 . I 'CHKSUM2 Q
"RTN","IBCEOB",315,0)
 . I CHKSUM1=CHKSUM2 S DUP=IBEOB Q                    ; comparison
"RTN","IBCEOB",316,0)
 . Q
"RTN","IBCEOB",317,0)
DUPX ;
"RTN","IBCEOB",318,0)
 Q DUP
"RTN","IBCEOB",319,0)
 ;
"RTN","IBCEOB21")
0^64^B26316775^B24441262
"RTN","IBCEOB21",1,0)
IBCEOB21 ;ALB/TMP - EOB MAINTENANCE ACTIONS ;18-FEB-99
"RTN","IBCEOB21",2,0)
 ;;2.0;INTEGRATED BILLING;**137,155,432**;21-MAR-94;Build 192
"RTN","IBCEOB21",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEOB21",4,0)
 Q
"RTN","IBCEOB21",5,0)
 ;
"RTN","IBCEOB21",6,0)
EDIT ; Edit a previously entered manual EOB
"RTN","IBCEOB21",7,0)
 N IBDA,IB0,DIE,DR,X,Y,DA
"RTN","IBCEOB21",8,0)
 ;
"RTN","IBCEOB21",9,0)
 D FULL^VALM1
"RTN","IBCEOB21",10,0)
 S IBDA=$$SEL()
"RTN","IBCEOB21",11,0)
 G:'IBDA EDITQ
"RTN","IBCEOB21",12,0)
 ;
"RTN","IBCEOB21",13,0)
 S IB0=$G(^IBM(361.1,IBDA,0))
"RTN","IBCEOB21",14,0)
 I $P(IB0,U,17)'=1 D  G EDITQ
"RTN","IBCEOB21",15,0)
 . W !,*7,"Cannot edit an EOB that was not entered manually!!"
"RTN","IBCEOB21",16,0)
 . D PAUSE^VALM1
"RTN","IBCEOB21",17,0)
 ;
"RTN","IBCEOB21",18,0)
 I $P(IB0,U,15)'=$$COBN^IBCEF(IBIFN) D  G EDITQ
"RTN","IBCEOB21",19,0)
 . W !,*7,"Can only edit an EOB for the current insurance sequence"
"RTN","IBCEOB21",20,0)
 . D PAUSE^VALM1
"RTN","IBCEOB21",21,0)
 ;
"RTN","IBCEOB21",22,0)
 S DIE="^IBM(361.1,",DA=IBDA
"RTN","IBCEOB21",23,0)
 S DR="100.03///"_DUZ_";100.04///^S X=""NOW"";.06;.13;.16//^S X=$$EXTERNAL^DILFD(361.1,.16,,3)"_$S($$AMTCHG(DA):";1.01",1:"")_";21"
"RTN","IBCEOB21",24,0)
 D ^DIE
"RTN","IBCEOB21",25,0)
 ;
"RTN","IBCEOB21",26,0)
 D BLD^IBCEOB2
"RTN","IBCEOB21",27,0)
 ;
"RTN","IBCEOB21",28,0)
 D PAUSE^VALM1
"RTN","IBCEOB21",29,0)
EDITQ S VALMBCK="R"
"RTN","IBCEOB21",30,0)
 Q
"RTN","IBCEOB21",31,0)
 ;
"RTN","IBCEOB21",32,0)
DELETE ; Delete a previously entered manual EOB
"RTN","IBCEOB21",33,0)
 N IB0,IBDA,IBE,DIR,X,Y,DA,DIK
"RTN","IBCEOB21",34,0)
 ;
"RTN","IBCEOB21",35,0)
 D FULL^VALM1
"RTN","IBCEOB21",36,0)
 S IBDA=$$SEL(.IBE)
"RTN","IBCEOB21",37,0)
 G:'IBDA DELQ
"RTN","IBCEOB21",38,0)
 ;
"RTN","IBCEOB21",39,0)
 S IB0=$G(^IBM(361.1,IBDA,0))
"RTN","IBCEOB21",40,0)
 I $P(IB0,U,17)'=1 D  G DELQ
"RTN","IBCEOB21",41,0)
 . W !,*7,"Cannot delete an EOB that was not entered manually!!"
"RTN","IBCEOB21",42,0)
 . D PAUSE^VALM1
"RTN","IBCEOB21",43,0)
 ;
"RTN","IBCEOB21",44,0)
 I $P(IB0,U,15)'=$$COBN^IBCEF(IBIFN) D  G DELQ
"RTN","IBCEOB21",45,0)
 . W !,*7,"Cannot only edit an EOB for the current insurance sequence"
"RTN","IBCEOB21",46,0)
 . D PAUSE^VALM1
"RTN","IBCEOB21",47,0)
 ;
"RTN","IBCEOB21",48,0)
 W !!,IBE,!
"RTN","IBCEOB21",49,0)
 S DIR("A")="ARE YOU REALLY SURE YOU WANT TO DELETE THIS EOB?: ",DIR("B")="NO",DIR(0)="YA" D ^DIR K DIR
"RTN","IBCEOB21",50,0)
 G:Y'=1 DELQ
"RTN","IBCEOB21",51,0)
 ;
"RTN","IBCEOB21",52,0)
 S DIK="^IBM(361.1,",DA=IBDA D ^DIK
"RTN","IBCEOB21",53,0)
 W !!,"EOB Deleted!!",!
"RTN","IBCEOB21",54,0)
 ;
"RTN","IBCEOB21",55,0)
 D BLD^IBCEOB2
"RTN","IBCEOB21",56,0)
 ;
"RTN","IBCEOB21",57,0)
 D PAUSE^VALM1
"RTN","IBCEOB21",58,0)
DELQ S VALMBCK="R"
"RTN","IBCEOB21",59,0)
 Q
"RTN","IBCEOB21",60,0)
 ;
"RTN","IBCEOB21",61,0)
NEW ; Add a manual EOB for the current COB sequence for the claim
"RTN","IBCEOB21",62,0)
 N DO,DD,DIC,DIE,DLAYGO,Y,X,IBEOB,IBOK,IB364
"RTN","IBCEOB21",63,0)
 ;
"RTN","IBCEOB21",64,0)
 D FULL^VALM1
"RTN","IBCEOB21",65,0)
 ;
"RTN","IBCEOB21",66,0)
 K DO,DD
"RTN","IBCEOB21",67,0)
 S IB364=$$LAST364^IBCEF4(IBIFN)
"RTN","IBCEOB21",68,0)
 S DIC="^IBM(361.1,",DIC(0)="L",X=IBIFN,DLAYGO=361.1
"RTN","IBCEOB21",69,0)
 S DIC("DR")=".15////"_$$COBN^IBCEF(IBIFN)_";.04////0;.05////"_$$NOW^XLFDT_";.17////1;.18///"_DUZ_$S(IB364:";.19////"_IB364,1:"")
"RTN","IBCEOB21",70,0)
 D FILE^DICN K DO,DD,DLAYGO,DIC
"RTN","IBCEOB21",71,0)
 G:Y<0 NEWQ
"RTN","IBCEOB21",72,0)
 S DIE="^IBM(361.1,",DA=+Y,DR=".06//^S X=""NOW"";S DIE(""NO^"")="""";.13//^S X=$$EXTERNAL^DILFD(361.1,.13,,1);.16//^S X=$$EXTERNAL^DILFD(361.1,.16,,3);K DIE(""NO^"");1.01;21"
"RTN","IBCEOB21",73,0)
 W ! D ^DIE K DIE
"RTN","IBCEOB21",74,0)
 S IBEOB=$P($G(^IBM(361.1,DA,0)),U,6),IBOK=1
"RTN","IBCEOB21",75,0)
 I IBEOB D
"RTN","IBCEOB21",76,0)
 . I $P($G(^IBM(361.1,DA,1)),U,1)="" D
"RTN","IBCEOB21",77,0)
 .. S DIR(0)="YA",DIR("A",1)="Nothing entered for payer amt paid",DIR("A")="Are you sure you want to file this EOB?: ",DIR("B")="NO"
"RTN","IBCEOB21",78,0)
 .. W ! D ^DIR W ! K DIR
"RTN","IBCEOB21",79,0)
 .. I Y'=1 S (IBEOB,IBOK)=0
"RTN","IBCEOB21",80,0)
 . I IBOK W !,"EOB added",!
"RTN","IBCEOB21",81,0)
 I 'IBEOB D
"RTN","IBCEOB21",82,0)
 . Q:DA'>0
"RTN","IBCEOB21",83,0)
 . S DIK="^IBM(361.1," D ^DIK
"RTN","IBCEOB21",84,0)
 . I IBOK W !!,"EOB Date/Time needed, not entered"
"RTN","IBCEOB21",85,0)
 . W !,"No EOB added!!",!
"RTN","IBCEOB21",86,0)
 D BLD^IBCEOB2
"RTN","IBCEOB21",87,0)
NEWQ D PAUSE^VALM1
"RTN","IBCEOB21",88,0)
 S VALMBCK="R"
"RTN","IBCEOB21",89,0)
 Q
"RTN","IBCEOB21",90,0)
 ;
"RTN","IBCEOB21",91,0)
VIEW ; View an MRA
"RTN","IBCEOB21",92,0)
 N IBDA,IBSEL,IBIFN,IBEOBIFN,IBIFNSAV
"RTN","IBCEOB21",93,0)
 ;
"RTN","IBCEOB21",94,0)
 D FULL^VALM1
"RTN","IBCEOB21",95,0)
 D SEL(.IBDA,1)     ; select a bill from the main list
"RTN","IBCEOB21",96,0)
 S IBSEL=+$O(IBDA(0)) I 'IBSEL G VIEWQ                    ; list#
"RTN","IBCEOB21",97,0)
 S IBIFN=$P($G(IBDA(IBSEL)),U,1) I 'IBIFN G VIEWQ         ; bill#
"RTN","IBCEOB21",98,0)
 ; IB*2.0*432 if nothing in EOB file for non-MRA claim, warn user and quit.
"RTN","IBCEOB21",99,0)
 ;S IBEOBIFN=$P($G(IBDA(IBSEL)),U,3) I 'IBEOBIFN G VIEWQ   ; eob ien
"RTN","IBCEOB21",100,0)
 S IBEOBIFN=$P($G(IBDA(IBSEL)),U,3) I 'IBEOBIFN,$G(IBMRANOT)=1 D  G VIEWQ
"RTN","IBCEOB21",101,0)
 . D FULL^VALM1
"RTN","IBCEOB21",102,0)
 . W !!?5,"There is no electronic EOB for this claim."
"RTN","IBCEOB21",103,0)
 . D PAUSE^VALM1
"RTN","IBCEOB21",104,0)
 . Q
"RTN","IBCEOB21",105,0)
 ;
"RTN","IBCEOB21",106,0)
 ; If only one MRA on file, then call the Listman and quit
"RTN","IBCEOB21",107,0)
 I $$MRACNT^IBCEMU1(IBIFN,$G(IBMRANOT))=1 D EN^VALM("IBCEM VIEW EOB") G VIEWQ
"RTN","IBCEOB21",108,0)
 ;
"RTN","IBCEOB21",109,0)
VLOOP ; Multiple MRA's on file.  Allow user to select the MRA to view
"RTN","IBCEOB21",110,0)
 D FULL^VALM1
"RTN","IBCEOB21",111,0)
 S IBEOBIFN=$$SEL^IBCEMU1(IBIFN,1)
"RTN","IBCEOB21",112,0)
 I 'IBEOBIFN G VIEWQ
"RTN","IBCEOB21",113,0)
 S IBIFNSAV=IBIFN                 ; save off the bill#
"RTN","IBCEOB21",114,0)
 D EN^VALM("IBCEM VIEW EOB")      ; call the Listman
"RTN","IBCEOB21",115,0)
 S IBIFN=IBIFNSAV                 ; restore the bill# (just in case)
"RTN","IBCEOB21",116,0)
 G VLOOP
"RTN","IBCEOB21",117,0)
 ;
"RTN","IBCEOB21",118,0)
VIEWQ ;
"RTN","IBCEOB21",119,0)
 S VALMBCK="R"
"RTN","IBCEOB21",120,0)
 Q
"RTN","IBCEOB21",121,0)
 ;
"RTN","IBCEOB21",122,0)
AMTCHG(DA) ; Function to determine if amt on EOB can be modified
"RTN","IBCEOB21",123,0)
 ; DA = ien of EOB entry (file 361.1)
"RTN","IBCEOB21",124,0)
 ; Function returns 1 if OK to change, 0 if the next bill in COB
"RTN","IBCEOB21",125,0)
 ;  sequence has already been sent or the bill has been closed.
"RTN","IBCEOB21",126,0)
 N IBOK,IBIFN,IBCOBN,IB0,IBNB
"RTN","IBCEOB21",127,0)
 S IBOK=1
"RTN","IBCEOB21",128,0)
 S IBIFN=+$G(^IBM(361.1,+DA,0)),IB0=$G(^DGCR(399,IBIFN,0))
"RTN","IBCEOB21",129,0)
 I $P(IB0,U,13)=6 S IBOK=0 G AMTQ ; Bill is closed...can't change EOB amt
"RTN","IBCEOB21",130,0)
 S IBCOBN=$$COBN^IBCEF(IBIFN)
"RTN","IBCEOB21",131,0)
 I IBCOBN=3 G AMTQ ; Already the last bill
"RTN","IBCEOB21",132,0)
 S IBNB=+$P($G(^DGCR(399,IBIFN,"M")),U,IBCOBN+5) ; Get next bill #
"RTN","IBCEOB21",133,0)
 I 'IBNB G AMTQ ; No next bill
"RTN","IBCEOB21",134,0)
 I $P($G(^DGCR(399,IBNB,0)),U,13)<3 G AMTQ
"RTN","IBCEOB21",135,0)
 S IBOK=0
"RTN","IBCEOB21",136,0)
 ;
"RTN","IBCEOB21",137,0)
AMTQ Q IBOK
"RTN","IBCEOB21",138,0)
 ;
"RTN","IBCEOB21",139,0)
SEL(IBDA,ONE) ; Select entry(s) from list
"RTN","IBCEOB21",140,0)
 ; IBDA = array returned if selections made
"RTN","IBCEOB21",141,0)
 ; ONE = if set to 1, only one selection can be made at a time
"RTN","IBCEOB21",142,0)
 N VALMY
"RTN","IBCEOB21",143,0)
 K IBDA
"RTN","IBCEOB21",144,0)
 D EN^VALM2($G(XQORNOD(0)),$S('$G(ONE):"",1:"S"))
"RTN","IBCEOB21",145,0)
 S IBDA=0 F  S IBDA=$O(VALMY(IBDA)) Q:'IBDA  S IBDA(IBDA)=$P($G(^TMP("IBCECOB",$J,+IBDA)),U,2,6)
"RTN","IBCEOB21",146,0)
 Q
"RTN","IBCEOB21",147,0)
 ;
"RTN","IBCEOB21",148,0)
CHANGE ; Select another bill to display
"RTN","IBCEOB21",149,0)
 N IBNULL,IBIFN1
"RTN","IBCEOB21",150,0)
 D FULL^VALM1
"RTN","IBCEOB21",151,0)
 K VALMQUIT
"RTN","IBCEOB21",152,0)
 S IBIFN1=IBIFN
"RTN","IBCEOB21",153,0)
 S IBIFN=$$BILL^IBCEOB2(.VALMQUIT,.IBNULL)
"RTN","IBCEOB21",154,0)
 I '$G(IBNULL) S IBIFN=IBIFN1 K VALMQUIT
"RTN","IBCEOB21",155,0)
 I '$D(VALMQUIT) S VALMBCK="R"
"RTN","IBCEOB21",156,0)
 Q
"RTN","IBCEOB21",157,0)
 ;
"RTN","IBCEP2")
0^58^B54308373^B43750443
"RTN","IBCEP2",1,0)
IBCEP2 ;ALB/TMP - EDI UTILITIES for provider ID ;13-DEC-99
"RTN","IBCEP2",2,0)
 ;;2.0;INTEGRATED BILLING;**137,181,232,280,320,349,432**;21-MAR-94;Build 192
"RTN","IBCEP2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEP2",4,0)
 ; DBIA for access to fields 53.2,54.1,54.2 in file 200: 224
"RTN","IBCEP2",5,0)
 ;
"RTN","IBCEP2",6,0)
GETID(IBIFN,IBTYPE,IBPROV,IBSEQ,IBT,IBT1,IBFUNC) ; Extract IBTYPE id for the bill
"RTN","IBCEP2",7,0)
 ; IBIFN = bill ien (file 399)
"RTN","IBCEP2",8,0)
 ; IBTYPE = 2:PERFORMING PROVIDER ID (1 and 3 deleted)
"RTN","IBCEP2",9,0)
 ; IBSEQ = numeric COB sequence of the insurance on bill
"RTN","IBCEP2",10,0)
 ; IBFUNC = 1:REFERRING;2:OPERATING;3:RENDERING;4:ATTENDING;5:SUPERVISING;9:OTHER;
"RTN","IBCEP2",11,0)
 ; Returns IBT = ien of the provider id type^ien of entry^file # for id
"RTN","IBCEP2",12,0)
 ;
"RTN","IBCEP2",13,0)
 S IBT=0
"RTN","IBCEP2",14,0)
 Q:IBTYPE'=2 ""
"RTN","IBCEP2",15,0)
 N IBID,IBPTYP
"RTN","IBCEP2",16,0)
 S IBID=$$IDFIND(IBIFN,"",IBPROV,IBSEQ,1,.IBT,$G(IBFUNC))
"RTN","IBCEP2",17,0)
 I IBID="" S IBT=""
"RTN","IBCEP2",18,0)
 ;
"RTN","IBCEP2",19,0)
 Q IBID
"RTN","IBCEP2",20,0)
 ;
"RTN","IBCEP2",21,0)
IDFIND(IBIFN,IBPTYP,IBPROV,IBSEQ,IBPERF,IBT,IBFUNC) ;Loop thru source levels
"RTN","IBCEP2",22,0)
 ;   (if id definition allows) to find correct ID
"RTN","IBCEP2",23,0)
 ; IBIFN = bill ien (file 399)
"RTN","IBCEP2",24,0)
 ; IBPTYP = ien of the provider id type in file 355.97 or if null,
"RTN","IBCEP2",25,0)
 ;          the default performing provider ID type for the ins co. in
"RTN","IBCEP2",26,0)
 ;          COB sequence IBSEQ will be calculated
"RTN","IBCEP2",27,0)
 ; IBPROV = (variable pointer syntax) provider on bill IBIFN
"RTN","IBCEP2",28,0)
 ; IBSEQ = numeric COB sequence of the bill
"RTN","IBCEP2",29,0)
 ; IBPERF = 1 if the performing provider id is needed
"RTN","IBCEP2",30,0)
 ; IBFUNC = 1:REFERRING;2:OPERATING;3:RENDERING;4:ATTENDING;5:SUPERVISING;9:OTHER;
"RTN","IBCEP2",31,0)
 ; Returns IBT = ptr to file 355.97^entry #^file #
"RTN","IBCEP2",32,0)
 ;
"RTN","IBCEP2",33,0)
 S IBT=+$G(IBPTYP)
"RTN","IBCEP2",34,0)
 Q:'$G(IBPERF)!'$G(IBPROV) ""
"RTN","IBCEP2",35,0)
 N IBSPEC,IBINS,IBINS4,IBSRC,IBUP,IBID,IBALT,IBPROF,Z
"RTN","IBCEP2",36,0)
 I $G(IBSEQ)="" S IBSEQ=+$$COBN^IBCEF(IBIFN) ; Default to current COB seq
"RTN","IBCEP2",37,0)
 S IBINS=+$P($G(^DGCR(399,IBIFN,"I"_IBSEQ)),U),IBINS4=$G(^DIC(36,+IBINS,4))
"RTN","IBCEP2",38,0)
 S IBPROF=($$FT^IBCEF(IBIFN)=2) S:'IBPROF IBPROF=2
"RTN","IBCEP2",39,0)
 ; form type is CMS-1500 (prof)=1, UB-04 (inst)=2
"RTN","IBCEP2",40,0)
 I $G(IBPTYP)="",$G(IBFUNC)=1,IBPROF=1 S (IBT,IBPTYP)=+$P(IBINS4,U,4) ; Referring Default ID on CMS-1500
"RTN","IBCEP2",41,0)
 I $G(IBPTYP)="" S (IBT,IBPTYP)=+$P(IBINS4,U,IBPROF) ; Def to perf prv typ for form
"RTN","IBCEP2",42,0)
 I 'IBPTYP Q ""  ; No default id type
"RTN","IBCEP2",43,0)
 S IBSPEC=$G(^IBE(355.97,IBPTYP,1)),IBSRC=$P($G(^IBE(355.97,+IBPTYP,0)),U,2),IBSRC=$S('IBSRC:5,1:IBSRC),IBUP=1
"RTN","IBCEP2",44,0)
 S IBALT=0
"RTN","IBCEP2",45,0)
 ;
"RTN","IBCEP2",46,0)
 F  D  Q:'IBUP!($G(IBID)'="")  S IBSRC=IBSRC-1 Q:'IBSRC
"RTN","IBCEP2",47,0)
 . ;
"RTN","IBCEP2",48,0)
 . I IBSRC=1,$TR($P(IBSPEC,U,1,3),"^0")'="" D  Q  ; Indiv prov default
"RTN","IBCEP2",49,0)
 .. N IBSTATE
"RTN","IBCEP2",50,0)
 .. I $P(IBSPEC,U,2) D  Q  ; Federal DEA # from field 53.2 file 200
"RTN","IBCEP2",51,0)
 ... S IBID=$P($G(^VA(200,+IBPROV,"PS")),U,2) ; DBIA224
"RTN","IBCEP2",52,0)
 ... S $P(IBT,U,2,3)=(IBPROV_U_200)
"RTN","IBCEP2",53,0)
 .. S IBSTATE=+$$CAREST^IBCEP2A(IBIFN)
"RTN","IBCEP2",54,0)
 .. I $P(IBSPEC,U) D  Q  ; State issued DEA # needed
"RTN","IBCEP2",55,0)
 ... Q:'IBSTATE
"RTN","IBCEP2",56,0)
 ... ; Extract the state issuing DEA # from field 54.2 file 200
"RTN","IBCEP2",57,0)
 ... S Z=+$O(^VA(200,+IBPROV,"PS2","B",IBSTATE,0)),IBID=$P($G(^VA(200,+IBPROV,"PS2",Z,0)),U,2) ; DBIA224
"RTN","IBCEP2",58,0)
 ... S $P(IBT,U,2,3)=(+IBPROV_";"_Z_U_200)
"RTN","IBCEP2",59,0)
 .. I $P(IBSPEC,U,3) D  Q  ; State license # needed
"RTN","IBCEP2",60,0)
 ... Q:'IBSTATE
"RTN","IBCEP2",61,0)
 ... ; Extract the state license # from field 54.1 file 200
"RTN","IBCEP2",62,0)
 ... I IBPROV["VA(200" S Z=+$O(^VA(200,+IBPROV,"PS1","B",IBSTATE,0)),IBID=$P($G(^VA(200,+IBPROV,"PS1",Z,0)),U,2),$P(IBT,U,2,3)=(+IBPROV_";"_IBSTATE_U_200) ; DBIA224
"RTN","IBCEP2",63,0)
 ... I IBPROV["IBA(355.93" S IBID=$P($G(^IBA(355.93,+IBPROV,0)),U,12),$P(IBT,U,2,3)=(+IBPROV_U_355.93)
"RTN","IBCEP2",64,0)
 . ;
"RTN","IBCEP2",65,0)
 . I IBSRC=2,$P(IBSPEC,U,4) D  Q  ; FACILITY FED TAX ID #
"RTN","IBCEP2",66,0)
 .. N IBXDATA
"RTN","IBCEP2",67,0)
 .. D F^IBCEF("N-FEDERAL TAX ID",,,IBIFN)
"RTN","IBCEP2",68,0)
 .. S IBID=IBXDATA,$P(IBT,U,2,3)=(U_350.9)
"RTN","IBCEP2",69,0)
 . ;
"RTN","IBCEP2",70,0)
 . I IBSRC=1 S IBID=$$SRC1(IBIFN,"*ALL*",IBPTYP,IBPROV,.IBT) Q
"RTN","IBCEP2",71,0)
 . ;
"RTN","IBCEP2",72,0)
 . I IBSRC=2 S IBID=$$SRC2(IBPTYP,.IBT) Q
"RTN","IBCEP2",73,0)
 . ;
"RTN","IBCEP2",74,0)
 . I IBSRC=3 S IBID=$$SRC3(IBIFN,IBINS,IBPTYP,.IBT) Q
"RTN","IBCEP2",75,0)
 . ; 
"RTN","IBCEP2",76,0)
 . I IBSRC=4 S IBID=$$SRC4(IBIFN,IBINS,IBPTYP,IBPROV,.IBT) Q
"RTN","IBCEP2",77,0)
 . ;
"RTN","IBCEP2",78,0)
 . I IBSRC=5 S IBID=$$SRC5(IBIFN,IBINS,IBPTYP,IBSEQ,.IBT,$G(IBFUNC)) Q
"RTN","IBCEP2",79,0)
 . ;
"RTN","IBCEP2",80,0)
 . I IBSRC=6 S IBID=$$SRC6(IBIFN,IBINS,IBPTYP,IBPROV,IBSEQ,.IBT) Q
"RTN","IBCEP2",81,0)
 ;
"RTN","IBCEP2",82,0)
 Q $G(IBID)
"RTN","IBCEP2",83,0)
 ;
"RTN","IBCEP2",84,0)
GETALL(IBTYPE,IBIFN,IBPROV,IBPID) ; Extract all performing prov id's for a
"RTN","IBCEP2",85,0)
 ; provider (IBPROV - vp format) on bill IBIFN
"RTN","IBCEP2",86,0)
 ; IBTYPE = type of ID to return (see GETID above)
"RTN","IBCEP2",87,0)
 ;
"RTN","IBCEP2",88,0)
 ; Returns array IBPID(COB SEQ #)=id (pass by reference) AND
"RTN","IBCEP2",89,0)
 ;   IBPID(COB SEQ #,1)=ien of id type (ptr to 355.97)
"RTN","IBCEP2",90,0)
 ;   IBPID = current insurance co's id
"RTN","IBCEP2",91,0)
 ;
"RTN","IBCEP2",92,0)
 N Z,COB,Z1,IBT
"RTN","IBCEP2",93,0)
 S COB=$$COBN^IBCEF(IBIFN)
"RTN","IBCEP2",94,0)
 F Z=1:1:3 Q:'$D(^DGCR(399,IBIFN,"I"_Z))  S IBPID(Z)=$$GETID(IBTYPE,IBIFN,IBPROV,Z,.IBT),IBPID(Z,1)=IBT I Z=COB S Z1=IBPID(Z)
"RTN","IBCEP2",95,0)
 Q $G(Z1)
"RTN","IBCEP2",96,0)
 ;
"RTN","IBCEP2",97,0)
SRC1(IBIFN,IBINS,IBPTYP,IBPROV,IBT) ; Licensing/gov't issued # - provider specific
"RTN","IBCEP2",98,0)
 ; Parameter definitions for SRC1, SRC3, SRC4, SRC5, SRC6:
"RTN","IBCEP2",99,0)
 ;   IBIFN = ien of bill (file 399)
"RTN","IBCEP2",100,0)
 ;   IBINS = ien of insurance co (file 36) or *ALL* for all insurance
"RTN","IBCEP2",101,0)
 ;           (always *ALL* for SRC1)
"RTN","IBCEP2",102,0)
 ;   IBPTYP = ien of the provider id type in file 355.97
"RTN","IBCEP2",103,0)
 ;   IBPROV = (variable pointer syntax) provider on bill IBIFN
"RTN","IBCEP2",104,0)
 ;   IBT = returned as type ien^file ien^file #
"RTN","IBCEP2",105,0)
 ;
"RTN","IBCEP2",106,0)
 N IBID,IB,IBRX,IBIDSV
"RTN","IBCEP2",107,0)
 S IBID="",IB=0,IBRX=$$ISRX^IBCEF1(IBIFN),IBIDSV=""
"RTN","IBCEP2",108,0)
 I $G(IBPROV) F  S IB=$O(^IBA(355.9,"AD",IBPTYP,IBPROV,IBINS,IB)) Q:'IB  D  Q:IBID'=""
"RTN","IBCEP2",109,0)
 . S IBID=$$UNIQ1(IBIFN,IBINS,IBPTYP,IBPROV,"",IB)
"RTN","IBCEP2",110,0)
 . I IBRX,$P($G(^IBA(355.9,IB,0)),U,5)'=3 S:IBIDSV="" IBIDSV=IBID S IBID="" ; Save 1st 'match' if no rx specific id
"RTN","IBCEP2",111,0)
 I IBID="",IBIDSV'="" S IBID=IBIDSV
"RTN","IBCEP2",112,0)
 Q IBID
"RTN","IBCEP2",113,0)
 ;
"RTN","IBCEP2",114,0)
SRC2(IB35597,IBT) ; Facility default - all providers
"RTN","IBCEP2",115,0)
 ; IB35597 = ien of the provider id type entry in file 355.97
"RTN","IBCEP2",116,0)
 ; IBT = returned as type ien^file ien^file #
"RTN","IBCEP2",117,0)
 ;
"RTN","IBCEP2",118,0)
 S $P(IBT,U,2,3)=(+IB35597_U_355.97)
"RTN","IBCEP2",119,0)
 Q $P($G(^IBE(355.97,+IB35597,0)),U,4)
"RTN","IBCEP2",120,0)
 ;
"RTN","IBCEP2",121,0)
SRC3(IBIFN,IBINS,IBPTYP,IBT) ; Ins co/all providers
"RTN","IBCEP2",122,0)
 ; See SRC1 for parameter definitions
"RTN","IBCEP2",123,0)
 N IB,IBID,IBRX,IBIDSV
"RTN","IBCEP2",124,0)
 S IBID="",IB=0,IBRX=$$ISRX^IBCEF1(IBIFN),IBIDSV=""
"RTN","IBCEP2",125,0)
 F  S IB=$O(^IBA(355.91,"AC",IBINS,IBPTYP,"*N/A*",IB)) Q:'IB  D  Q:IBID'=""
"RTN","IBCEP2",126,0)
 . S IBID=$$UNIQ2(IBIFN,IBINS,IBPTYP,"",IB,.IBT)
"RTN","IBCEP2",127,0)
 . I IBRX,$P($G(^IBA(355.91,IB,0)),U,5)'=3 S:IBIDSV="" IBIDSV=IBID S IBID="" ; Save 1st 'match' if no rx specific id
"RTN","IBCEP2",128,0)
 I IBID="",IBIDSV'="" S IBID=IBIDSV
"RTN","IBCEP2",129,0)
 Q IBID
"RTN","IBCEP2",130,0)
 ;
"RTN","IBCEP2",131,0)
SRC4(IBIFN,IBINS,IBPTYP,IBPROV,IBT) ;  Insurance co/individual provider
"RTN","IBCEP2",132,0)
 ; See SRC1 for parameter definitions
"RTN","IBCEP2",133,0)
 ;
"RTN","IBCEP2",134,0)
 N IBID,IB,IBRX,IBIDSV
"RTN","IBCEP2",135,0)
 S IBID="",IB=0,IBRX=$$ISRX^IBCEF1(IBIFN),IBIDSV=""
"RTN","IBCEP2",136,0)
 I $G(IBPROV) F  S IB=$O(^IBA(355.9,"AD",IBPTYP,IBPROV,IBINS,IB)) Q:'IB  D  Q:IBID'=""
"RTN","IBCEP2",137,0)
 . S IBID=$$UNIQ1(IBIFN,IBINS,IBPTYP,IBPROV,"",IB,.IBT)
"RTN","IBCEP2",138,0)
 . I IBRX,$P($G(^IBA(355.9,IB,0)),U,5)'=3 S:IBIDSV="" IBIDSV=IBID S IBID="" ; Save 1st 'match' if no rx specific id
"RTN","IBCEP2",139,0)
 I IBID="",IBIDSV'="" S IBID=IBIDSV
"RTN","IBCEP2",140,0)
 Q IBID
"RTN","IBCEP2",141,0)
 ;
"RTN","IBCEP2",142,0)
SRC5(IBIFN,IBINS,IBPTYP,IBSEQ,IBT,IBFUNC) ; Ins co/all providers/care unit
"RTN","IBCEP2",143,0)
 ; See SRC1 for missing parameter definitions
"RTN","IBCEP2",144,0)
 ; IBSEQ = the numeric COB sequence of the insurance on the bill
"RTN","IBCEP2",145,0)
 ;
"RTN","IBCEP2",146,0)
 Q ""  ;DEM;432 - Pieces 9, 10, and 11 were deleted in 2006. So, code doesn't do anything other than return NULL.
"RTN","IBCEP2",147,0)
 N IBP,IBUNIT,IBID,IB,Z,IBIDSV,IBRX
"RTN","IBCEP2",148,0)
 S IBID="",Z=0,IBRX=$$ISRX^IBCEF1(IBIFN),IBIDSV=""
"RTN","IBCEP2",149,0)
 ; DEM;432 - IBLNPRV variable is a flag to indicate if user input
"RTN","IBCEP2",150,0)
 ;           is claim level provider or line level provider user input.
"RTN","IBCEP2",151,0)
 ; DEM;432 - Line provider interested in fuction 1 and 3, referring and rendering respectively.
"RTN","IBCEP2",152,0)
 I '$G(IBLNPRV) S IBP=+$O(^DGCR(399,IBIFN,"PRV","B",$S($G(IBFUNC)=1:1,$$FT^IBCEF(IBIFN)=3:4,1:3),0)),IBUNIT=$P($G(^DGCR(399,IBIFN,"PRV",IBP,0)),U,8+IBSEQ)
"RTN","IBCEP2",153,0)
 I $G(IBLNPRV) S IBP=+$O(^DGCR(399,IBIFN,"CP",IBLNPRV("PROCIEN"),"LNPRV","B",$S($G(IBFUNC)=1:1,1:3),0)),IBUNIT=$P($G(^DGCR(399,IBIFN,"CP",IBLNPRV("PROCIEN"),"LNPRV",IBP,0)),U,8+IBSEQ)
"RTN","IBCEP2",154,0)
 I IBUNIT'="" F  S Z=$O(^IBA(355.96,"AC",IBINS,IBPTYP,Z)) Q:'Z  D  Q:IBID'=""
"RTN","IBCEP2",155,0)
 . S IB=0 F  S IB=$O(^IBA(355.91,"ACARE",Z,IB)) Q:'IB  D  Q:IBID'=""
"RTN","IBCEP2",156,0)
 .. S IBID=$$UNIQ2(IBIFN,IBINS,IBPTYP,IBUNIT,IB,.IBT)
"RTN","IBCEP2",157,0)
 .. I IBRX,$P($G(^IBA(355.91,IB,0)),U,5)'=3 S:IBIDSV="" IBIDSV=IBID S IBID="" ; Save 1st 'match' if no rx specific id
"RTN","IBCEP2",158,0)
 I IBID="",IBIDSV'="" S IBID=IBIDSV
"RTN","IBCEP2",159,0)
 Q IBID
"RTN","IBCEP2",160,0)
 ;
"RTN","IBCEP2",161,0)
SRC6(IBIFN,IBINS,IBPTYP,IBPROV,IBSEQ,IBT) ; Ins co/ind provider/care unit
"RTN","IBCEP2",162,0)
 ; See SRC1 for missing parameter definitions
"RTN","IBCEP2",163,0)
 ; IBSEQ = the numeric COB sequence of the insurance on the bill
"RTN","IBCEP2",164,0)
 ;
"RTN","IBCEP2",165,0)
 Q ""  ;DEM;432 - Pieces 9, 10, and 11 were deleted in 2006. So, code doesn't do anything other than return NULL.
"RTN","IBCEP2",166,0)
 N IBUNIT,IBP,IBID,IB
"RTN","IBCEP2",167,0)
 S IBID="",IB=0
"RTN","IBCEP2",168,0)
 I '$G(IBLNPRV) S IBP=+$O(^DGCR(399,"PRV","B",$S($$FT^IBCEF(IBIFN)=3:3,1:4),0)),IBUNIT=$P($G(^DGCR(399,IBIFN,"PRV",IBP,0)),U,8+IBSEQ)
"RTN","IBCEP2",169,0)
 I $G(IBLNPRV) S IBP=+$O(^DGCR(399,IBIFN,"CP",IBLNPRV("PROCIEN"),"LNPRV","B",$S($$FT^IBCEF(IBIFN)=3:3,1:4),0)),IBUNIT=$P($G(^DGCR(399,IBIFN,"CP",IBLNPRV("PROCIEN"),"LNPRV",IBP,0)),U,8+IBSEQ)
"RTN","IBCEP2",170,0)
 I $G(IBPROV),IBUNIT'="" F  S IB=$O(^IBA(355.9,"AD",IBPTYP,IBPROV,IBINS,IB)) Q:'IB  D  Q:IBID'=""
"RTN","IBCEP2",171,0)
 . S IBID=$$UNIQ1(IBIFN,IBINS,IBPTYP,IBPROV,IBUNIT,IB,.IBT)
"RTN","IBCEP2",172,0)
 Q IBID
"RTN","IBCEP2",173,0)
 ;
"RTN","IBCEP2",174,0)
UNIQ1(IBIFN,IBINS,IBPTYP,IBPROV,IBUNIT,IBCU,IBT) ; Match most-least specific
"RTN","IBCEP2",175,0)
 ; *** SEE PARAMETER DEFINITIONS IN IBCEP3 ***
"RTN","IBCEP2",176,0)
 ;
"RTN","IBCEP2",177,0)
 ; Start in file 355.9 (Specific Provider)
"RTN","IBCEP2",178,0)
 ;   IBPROV = (variable pointer syntax) provider on bill IBIFN
"RTN","IBCEP2",179,0)
 ;
"RTN","IBCEP2",180,0)
 Q $$UNIQ1^IBCEP2A($G(IBIFN),$G(IBINS),$G(IBPTYP),$G(IBPROV),$G(IBUNIT),$G(IBCU),$G(IBT))
"RTN","IBCEP2",181,0)
 ;
"RTN","IBCEP2",182,0)
UNIQ2(IBIFN,IBINS,IBPTYP,IBUNIT,IBCU,IBT) ; Match on most-least specific
"RTN","IBCEP2",183,0)
 ; *** SEE PARAMETER DEFINITIONS IN IBCEP3 ***
"RTN","IBCEP2",184,0)
 ;
"RTN","IBCEP2",185,0)
 ; Start in file 355.91 (Specific Insurance)
"RTN","IBCEP2",186,0)
 ;
"RTN","IBCEP2",187,0)
 Q $$UNIQ2^IBCEP2A($G(IBIFN),$G(IBINS),$G(IBPTYP),$G(IBUNIT),$G(IBCU),$G(IBT))
"RTN","IBCEP2B")
0^52^B59761091^B52920482
"RTN","IBCEP2B",1,0)
IBCEP2B ;ALB/TMP - EDI UTILITIES for provider ID ;18-MAY-04
"RTN","IBCEP2B",2,0)
 ;;2.0;INTEGRATED BILLING;**232,320,400,432**;21-MAR-94;Build 192
"RTN","IBCEP2B",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEP2B",4,0)
 ;
"RTN","IBCEP2B",5,0)
PROVID(IBIFN,IBPRIEN,IBCOBN,DIPA) ; Provider id entry on billing screen 10, and line level provider input on billing screens 4&5.
"RTN","IBCEP2B",6,0)
 ; IBIFN = ien file 399
"RTN","IBCEP2B",7,0)
 ; IBPRIEN = ien file 399.0222, or ien file 399.0404.
"RTN","IBCEP2B",8,0)
 ; IBCOBN = the COB number of the id being edited
"RTN","IBCEP2B",9,0)
 ; DIPA = passed by ref, returned with id data
"RTN","IBCEP2B",10,0)
 ; DIPA("EDIT")=-1 if no id editing  = 1 if edit id   = 2 if stuff id
"RTN","IBCEP2B",11,0)
 ; DIPA("PRID")= id to stuff   DIPA("PRIDT")= id type to stuff
"RTN","IBCEP2B",12,0)
 N PRN0,Z
"RTN","IBCEP2B",13,0)
 Q:'$G(^DGCR(399,IBIFN,"I1"))
"RTN","IBCEP2B",14,0)
 I $G(IBLNPRV),'$G(IBLNPRV("LNPRVIEN")),'$G(IBLNPRV("PROCIEN")) Q  ; DEM;432 - If line provider user input.
"RTN","IBCEP2B",15,0)
 ; DEM;432 - Updated variable PRNO to be equal to line level provider if we are coming from line level provider user input.
"RTN","IBCEP2B",16,0)
 S PRN0=$S($G(IBLNPRV):$G(^DGCR(399,IBIFN,"CP",IBLNPRV("PROCIEN"),"LNPRV",IBLNPRV("LNPRVIEN"),0)),1:$G(^DGCR(399,IBIFN,"PRV",IBPRIEN,0)))
"RTN","IBCEP2B",17,0)
 S DIPA("EDIT")=1,(DIPA("PRID"),DIPA("PRIDT"))=""
"RTN","IBCEP2B",18,0)
 W @IOF
"RTN","IBCEP2B",19,0)
 W !,?19,"**** SECONDARY PERFORMING PROVIDER IDs ****"
"RTN","IBCEP2B",20,0)
 W !!,$P("PRIMARY^SECONDARY^TERTIARY",U,IBCOBN)_" INSURANCE CO: "_$P($G(^DIC(36,+$G(^DGCR(399,IBIFN,"I"_IBCOBN)),0)),U)
"RTN","IBCEP2B",21,0)
 ; DEM;432 - Added line and conditions if line level provider user input.
"RTN","IBCEP2B",22,0)
 I '$G(IBLNPRV) W !,"PROVIDER: "_$$EXTERNAL^DILFD(399.0222,.02,"",$P(PRN0,U,2))_" ("_$$EXTERNAL^DILFD(399.0222,.01,"",+PRN0)_")",!
"RTN","IBCEP2B",23,0)
 I $G(IBLNPRV) W !,"Line Level Provider: "_$$EXTERNAL^DILFD(399.0404,.02,"",$P(PRN0,U,2))_" ("_$$EXTERNAL^DILFD(399.0404,.01,"",+PRN0)_")",!
"RTN","IBCEP2B",24,0)
 ;
"RTN","IBCEP2B",25,0)
 I $P(PRN0,U,4+IBCOBN)="" K DIPA("PRID"),DIPA("PRIDT") D NEWID(IBIFN,IBPRIEN,IBCOBN,.DIPA) ; No id currently exists for the ins seq/prov
"RTN","IBCEP2B",26,0)
 ;
"RTN","IBCEP2B",27,0)
 Q
"RTN","IBCEP2B",28,0)
 ;
"RTN","IBCEP2B",29,0)
NEWID(IBIFN,IBPRIEN,IBCOBN,DIPA) ;
"RTN","IBCEP2B",30,0)
 N IBDEF,IBCT,IBNUM,IBINS,IBFRM,IBCAR,IBARR,IBARRS,IB0,IBM,IBQUIT,IBSEL,PRN,PRT,PRN,PRN0,DIR,X,Y,Z,Z0,IBZ,IBZ1,IBTYP,IBREQ,IBREQT,IBTYPN,IBID,IBUSED
"RTN","IBCEP2B",31,0)
 S IBREQ=0,IBREQT=""
"RTN","IBCEP2B",32,0)
 Q:($G(IBLNPRV))&('$G(IBLNPRV("LNPRVIEN"))&'$G(IBLNPRV("PROCIEN")))  ; DEM;432 - If line provider user input.
"RTN","IBCEP2B",33,0)
 ; DEM;432 - Updated variable PRNO to be equal to line level provider if we are coming from line level provider user input.
"RTN","IBCEP2B",34,0)
 S PRN0=$S($G(IBLNPRV):$G(^DGCR(399,IBIFN,"CP",IBLNPRV("PROCIEN"),"LNPRV",IBLNPRV("LNPRVIEN"),0)),1:$G(^DGCR(399,IBIFN,"PRV",IBPRIEN,0)))
"RTN","IBCEP2B",35,0)
 S Z(IBCOBN)=$S($G(DIPA("I"_IBCOBN)):$$GETTYP^IBCEP2A(IBIFN,IBCOBN,$P(PRN0,U)),1:"")
"RTN","IBCEP2B",36,0)
 S IBINS=+$G(^DGCR(399,IBIFN,"I"_IBCOBN)),IB0=$S($G(IBLNPRV):$G(^DGCR(399,IBIFN,"CP",IBLNPRV("PROCIEN"),"LNPRV",IBLNPRV("LNPRVIEN"),0)),1:$G(^DGCR(399,IBIFN,"PRV",IBPRIEN,0)))
"RTN","IBCEP2B",37,0)
 S IBCAR=$$INPAT^IBCEF(IBIFN),IBCAR=$S('IBCAR:2,1:1)
"RTN","IBCEP2B",38,0)
 S IBFRM=$$FT^IBCEF(IBIFN),IBFRM=$S(IBFRM=2:2,1:1)
"RTN","IBCEP2B",39,0)
 I $P(Z(IBCOBN),U) D
"RTN","IBCEP2B",40,0)
 . W !,"INS. COMPANY'S DEFAULT SECONDARY ID TYPE IS: "_$$EXTERNAL^DILFD(36,4.01,"",$P(Z(IBCOBN),U)) S IBREQT=+Z(IBCOBN)
"RTN","IBCEP2B",41,0)
 . I $P(Z(IBCOBN),U,2) W !,?2," AND IS REQUIRED TO BE ENTERED FOR THIS CLAIM" S IBREQ=1
"RTN","IBCEP2B",42,0)
 I $$CUNEED^IBCEP3(IBIFN,IBCOBN) W !,"CARE UNITS ARE DEFINED"_$S($P($G(^DIC(36,IBINS,4)),U,9)'="":" AS "_$P(^(4),U,9),1:"")_" FOR THESE IDs"
"RTN","IBCEP2B",43,0)
 D PRACT^IBCEF71(IBINS,IBFRM,IBCAR,$P(IB0,U,2),.IBARR,$P(IB0,U),$S($$COBN^IBCEF(IBIFN)=IBCOBN:"C",1:"O"),355.9,1)
"RTN","IBCEP2B",44,0)
 S (IBNUM,IBCT)=0,IBDEF=""
"RTN","IBCEP2B",45,0)
 I $O(IBARR(""))="" S IBCT=IBCT+1,DIR("A",IBCT)="NO SECONDARY IDS ARE DEFINED FOR THIS PROV THAT ARE VALID FOR THIS CLAIM"
"RTN","IBCEP2B",46,0)
 S IBCT=IBCT+1,DIR("A",IBCT)="SELECT A SECONDARY ID OR ACTION FROM THE LIST BELOW: ",IBCT=IBCT+1,DIR("A",IBCT)=" "
"RTN","IBCEP2B",47,0)
 ;
"RTN","IBCEP2B",48,0)
 S IBCT=IBCT+1,IBNUM=IBNUM+1,DIR("A",IBCT)="  "_$E(IBNUM_$J("",3),1,3)_" -  NO SECONDARY ID NEEDED",IBNUM=IBNUM+1,IBCT=IBCT+1,DIR("A",IBCT)="  "_$E(IBNUM_$J("",3),1,3)_" -  ADD AN ID FOR THIS CLAIM ONLY"
"RTN","IBCEP2B",49,0)
 I $O(IBARR(""))="" S IBDEF=1,DIPA("EDIT")=$$SELID(.DIR,IBDEF,.IBID,.DIPA,IBNUM) Q
"RTN","IBCEP2B",50,0)
 ;
"RTN","IBCEP2B",51,0)
 S PRN=$$GETID^IBCEP2(IBIFN,2,$P(PRN0,U,2),IBCOBN,.PRT,,$P(PRN0,U)),IBDEF=""
"RTN","IBCEP2B",52,0)
 ;
"RTN","IBCEP2B",53,0)
 I PRN'="",PRT D
"RTN","IBCEP2B",54,0)
 . N PRT1
"RTN","IBCEP2B",55,0)
 . S PRT1=$P($G(^IBE(355.97,+PRT,0)),U)
"RTN","IBCEP2B",56,0)
 . I $P($G(^IBE(355.97,+PRT,1)),U,3) S PRT1="ST LIC("_$P($G(^DIC(5,+$$CAREST^IBCEP2A(IBIFN),0)),U,2)_")"
"RTN","IBCEP2B",57,0)
 . S IBCT=IBCT+1,IBNUM=IBNUM+1
"RTN","IBCEP2B",58,0)
 . S DIR("A",IBCT)="  "_$E(IBNUM_$J("",3),1,3)_" -  "_$E("<DEFAULT> "_PRN_$J("",29),1,29)_"  "_$E(PRT1_$J("",15),1,15)
"RTN","IBCEP2B",59,0)
 . S DIR("A",IBCT)=DIR("A",IBCT)_"  "_$S($P(PRT,U,3)'["355.9":"",$P($G(^IBA(+$P(PRT,U,3),+$P(PRT,U,2),0)),U,3)'="":$$EXTERNAL^DILFD(355.9,.03,"",$P($G(^IBA(+$P(PRT,U,3),+$P(PRT,U,2),0)),U,3)),1:"")
"RTN","IBCEP2B",60,0)
 . S IBID(IBNUM)=PRN_U_+PRT,IBDEF=IBNUM,IBID(IBNUM,1)=DIR("A",IBCT),IBDEF=IBNUM,IBDEF("IEN")=$P(PRT,U,2,3)
"RTN","IBCEP2B",61,0)
 . S IBUSED(PRT,PRN,0)=""
"RTN","IBCEP2B",62,0)
 ;
"RTN","IBCEP2B",63,0)
 S IBQUIT=0,IBSEL=1
"RTN","IBCEP2B",64,0)
 ; Sort ids by id type
"RTN","IBCEP2B",65,0)
 S IBZ="" F  S IBZ=$O(IBARR(IBZ)) Q:IBZ=""  S IBZ1="" F  S IBZ1=$O(IBARR(IBZ,IBZ1)) Q:IBZ1=""  D
"RTN","IBCEP2B",66,0)
 . S IBTYP=+$P(IBARR(IBZ,IBZ1),U,9)
"RTN","IBCEP2B",67,0)
 . I $P(IBARR(IBZ,IBZ1),U,4)]"" Q:$D(IBUSED(IBTYP,$P(IBARR(IBZ,IBZ1),U,4),+$P(IBARR(IBZ,IBZ1),U,7)))
"RTN","IBCEP2B",68,0)
 . I $P($G(IBDEF("IEN")),U,2)["355.9",$P(IBARR(IBZ,IBZ1),U,8),$P(IBARR(IBZ,IBZ1),U,8)=+$G(IBDEF("IEN")) Q:$S($P(IBZ1,U)'["INS DEF":$P($G(IBDEF("IEN")),U,2)=355.9,1:$P($G(IBDEF("IEN")),U,2)=355.91)
"RTN","IBCEP2B",69,0)
 . S IBARRS(IBTYP,IBZ,IBZ1)=IBARR(IBZ,IBZ1)
"RTN","IBCEP2B",70,0)
 . I $P(IBARR(IBZ,IBZ1),U,4)]"" S IBUSED(IBTYP,$P(IBARR(IBZ,IBZ1),U,4),+$P(IBARR(IBZ,IBZ1),U,7))=""
"RTN","IBCEP2B",71,0)
 S IBTYP="" F  S IBTYP=$O(IBARRS(IBTYP)) Q:IBTYP=""  S IBZ="" F  S IBZ=$O(IBARRS(IBTYP,IBZ)) Q:IBZ=""  D  Q:IBQUIT
"RTN","IBCEP2B",72,0)
 . S IBZ1="" F  S IBZ1=$O(IBARRS(IBTYP,IBZ,IBZ1)) Q:IBZ1=""  S IBCT=IBCT+1,IBNUM=IBNUM+1 D  Q:IBQUIT
"RTN","IBCEP2B",73,0)
 .. S Z0=IBARRS(IBTYP,IBZ,IBZ1)
"RTN","IBCEP2B",74,0)
 .. S IBARR=$S($P(Z0,U,8)&(IBZ1'["LIC"):$G(^IBA("355.9"_$S($P(IBZ1,U)'="INS DEF":"",1:1),+$P(Z0,U,8),0)),1:"")
"RTN","IBCEP2B",75,0)
 .. S IBTYPN=$S(IBTYP=+$$STLIC^IBCEP8():"ST LIC ("_$P($G(^DIC(5,+$P(Z0,U,7),0)),U,2)_")",1:$P($G(^IBE(355.97,IBTYP,0)),U))
"RTN","IBCEP2B",76,0)
 .. S DIR("A",IBCT)="  "_$E(IBNUM_$J("",3),1,3)_" -  "_$E($S($P(IBZ1,U)="INS DEF":"<INS DEF> ",1:"")_$P(Z0,U,4)_$J("",29),1,29)_"  "_$E(IBTYPN_$J("",15),1,15)_"  "_$S($P(IBARR,U,3):$$EXTERNAL^DILFD(355.9,.03,"",$P(IBARR,U,3)),1:"")
"RTN","IBCEP2B",77,0)
 .. S IBID(IBNUM,1)=DIR("A",IBCT),IBID(IBNUM)=$P(Z0,U,4)_U_IBTYP
"RTN","IBCEP2B",78,0)
 .. I (IBNUM#15)=0 S IBM=$$MORE(.DIR) D  Q:IBQUIT
"RTN","IBCEP2B",79,0)
 ... I IBM<0 S IBQUIT=1,IBSEL=0 Q  ; User aborted list
"RTN","IBCEP2B",80,0)
 ... I 'IBM S IBQUIT=1 Q  ; User wants to select
"RTN","IBCEP2B",81,0)
 ... W ! K DIR S IBCT=1
"RTN","IBCEP2B",82,0)
 I 'IBSEL S DIPA("EDIT")=-1
"RTN","IBCEP2B",83,0)
 I IBSEL S:IBDEF=""&$G(IBREQ) IBDEF=2 S DIPA("EDIT")=$$SELID(.DIR,IBDEF,.IBID,.DIPA,IBNUM)
"RTN","IBCEP2B",84,0)
 Q
"RTN","IBCEP2B",85,0)
 ;
"RTN","IBCEP2B",86,0)
SELID(DIR,IBDEF,IBID,DIPA,IBNUM) ; Returns the selection from the array of possible IDs/ID actions
"RTN","IBCEP2B",87,0)
 N IDACT,IDSEL,X,Y
"RTN","IBCEP2B",88,0)
 S IDACT=""
"RTN","IBCEP2B",89,0)
 S DIR("B")=$S('$G(IBDEF):1,1:IBDEF),DIR("A",+$O(DIR("A",""),-1)+1)=" "
"RTN","IBCEP2B",90,0)
 S DIR(0)="NA^1:"_IBNUM,DIR("A")="Selection: " W ! D ^DIR K DIR
"RTN","IBCEP2B",91,0)
 I $D(DTOUT)!$D(DUOUT)!(Y=1) S IDACT=-1 G SELIDQ
"RTN","IBCEP2B",92,0)
 I Y=2 S IDACT=1 G SELIDQ
"RTN","IBCEP2B",93,0)
 S IDSEL=Y
"RTN","IBCEP2B",94,0)
 S DIR("A",1)="ID SELECTED:",DIR("A",2)="  "_$G(IBID(+Y,1)),DIR("A")="IS THIS CORRECT?: ",DIR("B")="YES",DIR(0)="YA" W ! D ^DIR K DIR
"RTN","IBCEP2B",95,0)
 I Y'=1 S IDACT=-1 G SELIDQ
"RTN","IBCEP2B",96,0)
 S DIPA("PRID")=$P(IBID(IDSEL),U),DIPA("PRIDT")=$P(IBID(IDSEL),U,2),IDACT=2
"RTN","IBCEP2B",97,0)
 ;
"RTN","IBCEP2B",98,0)
SELIDQ Q IDACT
"RTN","IBCEP2B",99,0)
 ;
"RTN","IBCEP2B",100,0)
MORE(DIR) ;
"RTN","IBCEP2B",101,0)
 N DIR,X,Y,DUOUT,DTOUT
"RTN","IBCEP2B",102,0)
 S DIR(0)="YA",DIR("A")="MORE?: ",DIR("B")="NO" W ! D ^DIR K DIR("B")
"RTN","IBCEP2B",103,0)
 Q $S($D(DTOUT)!$D(DUOUT):-1,1:Y)
"RTN","IBCEP2B",104,0)
 ;
"RTN","IBCEP2B",105,0)
 ; IBFIDFL = E = Electronic Form Type
"RTN","IBCEP2B",106,0)
 ;           A = Additional ID's
"RTN","IBCEP2B",107,0)
 ;           LF - VA Lab/Facility
"RTN","IBCEP2B",108,0)
FACID(IBINS,IBFIDFL) ; Enter/edit billing facility ids
"RTN","IBCEP2B",109,0)
 ; IBINS = ien of ins co (file 36)
"RTN","IBCEP2B",110,0)
 N IBID,Z,Z0,Y
"RTN","IBCEP2B",111,0)
 K ^TMP($J,"IBBF_ID")
"RTN","IBCEP2B",112,0)
 W @IOF
"RTN","IBCEP2B",113,0)
 D GETBPNUM(IBINS)
"RTN","IBCEP2B",114,0)
 K ^TMP("IBCE_PRVFAC_MAINT_INS",$J)
"RTN","IBCEP2B",115,0)
 S ^TMP("IBCE_PRVFAC_MAINT_INS",$J)=IBFIDFL_U_IBINS_U_"1"
"RTN","IBCEP2B",116,0)
 D EN^VALM("IBCE PRVFAC MAINT")
"RTN","IBCEP2B",117,0)
 K ^TMP("IBCE_PRVFAC_MAINT_INS",$J)
"RTN","IBCEP2B",118,0)
 W @IOF
"RTN","IBCEP2B",119,0)
 D FULL^VALM1
"RTN","IBCEP2B",120,0)
 Q
"RTN","IBCEP2B",121,0)
 ;
"RTN","IBCEP2B",122,0)
GETBPNUM(IBINS) ;
"RTN","IBCEP2B",123,0)
 N Z,Z0,IBID,IBMAIN
"RTN","IBCEP2B",124,0)
 S IBMAIN=$$MAIN(),^TMP($J,"IBBF_ID")=IBMAIN
"RTN","IBCEP2B",125,0)
 S IBID=$$BF^IBCU()
"RTN","IBCEP2B",126,0)
 S Z=0 F  S Z=$O(^IBA(355.92,"B",IBINS,Z)) Q:'Z  D
"RTN","IBCEP2B",127,0)
 . S Z0=$G(^IBA(355.92,Z,0))
"RTN","IBCEP2B",128,0)
 . Q:$P(Z0,U,8)'="E"  ; WCJ 1/13/06  There are several ID types in this file 
"RTN","IBCEP2B",129,0)
 . Q:$P(Z0,U,3)]""
"RTN","IBCEP2B",130,0)
 . S ^TMP($J,"IBBF_ID",$S($P(Z0,U,5)=IBMAIN:0,1:+$P(Z0,U,5)),+$P(Z0,U,4))=$P(Z0,U,7)
"RTN","IBCEP2B",131,0)
 . S ^TMP($J,"IBBF_ID",$S($P(Z0,U,5)=IBMAIN:0,1:+$P(Z0,U,5)),+$P(Z0,U,4),"QUAL")=$P(Z0,U,6)
"RTN","IBCEP2B",132,0)
 Q
"RTN","IBCEP2B",133,0)
 ;
"RTN","IBCEP2B",134,0)
MAIN() ; Returns ien of main division of the database
"RTN","IBCEP2B",135,0)
 Q +$$PRIM^VASITE()
"RTN","IBCEP2B",136,0)
 ;
"RTN","IBCEP2B",137,0)
FACNUM(IBIFN,IBCOB,IBQF) ; Function returns the current division's fac billing
"RTN","IBCEP2B",138,0)
 ; prov id for the COB insurance sequence from file 355.92
"RTN","IBCEP2B",139,0)
 ; IBIFN = ien file 399
"RTN","IBCEP2B",140,0)
 ; IBCOB = # of COB ins seq or if "", current assumed
"RTN","IBCEP2B",141,0)
 ; IBQF - 1 if qualifier is to be returned instead of ID
"RTN","IBCEP2B",142,0)
 N Z,IBDIV,IBFT,X,BPZ
"RTN","IBCEP2B",143,0)
 S X="",IBDIV=0
"RTN","IBCEP2B",144,0)
 S:'$G(IBCOB) IBCOB=+$$COBN^IBCEF(IBIFN)
"RTN","IBCEP2B",145,0)
 ;
"RTN","IBCEP2B",146,0)
 ; IB*2*400 - esg - 11/7/08 - Determine the division associated with the billing provider first
"RTN","IBCEP2B",147,0)
 S BPZ=+$$B^IBCEF79(IBIFN,IBCOB)                     ; Inst file pointer as the billing provider for payer seq IBCOB
"RTN","IBCEP2B",148,0)
 I BPZ S IBDIV=+$O(^DG(40.8,"AD",BPZ,0))             ; Billing Provider division (may not exist)
"RTN","IBCEP2B",149,0)
 ;
"RTN","IBCEP2B",150,0)
 I 'IBDIV S IBDIV=+$P($G(^DGCR(399,IBIFN,0)),U,22)   ; Division on claim
"RTN","IBCEP2B",151,0)
 I 'IBDIV S IBDIV=$$MAIN()                           ; main division
"RTN","IBCEP2B",152,0)
 ;
"RTN","IBCEP2B",153,0)
 S IBFT=$$FT^IBCEF(IBIFN),IBFT=$S(IBFT=3:1,1:2)
"RTN","IBCEP2B",154,0)
 K ^TMP($J,"IBBF_ID")
"RTN","IBCEP2B",155,0)
 D GETBPNUM(+$P($G(^DGCR(399,IBIFN,"M")),U,IBCOB))
"RTN","IBCEP2B",156,0)
 I IBDIV=+$G(^TMP($J,"IBBF_ID")) S IBDIV=0
"RTN","IBCEP2B",157,0)
 I '$G(IBQF) S X=$S($D(^TMP($J,"IBBF_ID",IBDIV,IBFT)):^(IBFT),1:$G(^TMP($J,"IBBF_ID",0,IBFT)))
"RTN","IBCEP2B",158,0)
 I $G(IBQF) S X=$S($D(^TMP($J,"IBBF_ID",IBDIV,IBFT,"QUAL")):^("QUAL"),1:$G(^TMP($J,"IBBF_ID",0,IBFT,"QUAL")))
"RTN","IBCEP2B",159,0)
 K ^TMP($J,"IBBF_ID")
"RTN","IBCEP2B",160,0)
 Q X
"RTN","IBCEP2B",161,0)
 ;
"RTN","IBCEP2B",162,0)
SOP(IBIFN,IBZD) ; Returns X12 current source of pay code for bill ien IBIFN
"RTN","IBCEP2B",163,0)
 ; IBZD = the current ins policy type, if known
"RTN","IBCEP2B",164,0)
 N IBZ
"RTN","IBCEP2B",165,0)
 S IBZ=""
"RTN","IBCEP2B",166,0)
 I $G(IBZD)="" D F^IBCEF("N-CURRENT INS POLICY TYPE","IBZD",,IBIFN)
"RTN","IBCEP2B",167,0)
 S IBZ=$S($G(IBZD)="":"G2","MAMB16"[IBZD:"1C",IBZD="TV"!(IBZD="MC"):"1D",IBZD="CH":"1H",IBZD="BL":$S($$FT^IBCEF(IBIFN)=2:"1B",1:"1A"),1:"G2")
"RTN","IBCEP2B",168,0)
 Q IBZ
"RTN","IBCEP2B",169,0)
 ;
"RTN","IBCEP8")
0^9^B124106207^B118559850
"RTN","IBCEP8",1,0)
IBCEP8 ;ALB/TMP/OIFO-BP/RBN - Functions for NON-VA PROVIDER ;11-07-00
"RTN","IBCEP8",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,232,288,320,343,374,377,391,400,436,432**;21-MAR-94;Build 192
"RTN","IBCEP8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEP8",4,0)
 ;
"RTN","IBCEP8",5,0)
EN ; -- main entry point
"RTN","IBCEP8",6,0)
 N IBNPRV
"RTN","IBCEP8",7,0)
 K IBFASTXT
"RTN","IBCEP8",8,0)
 D FULL^VALM1
"RTN","IBCEP8",9,0)
 D EN^VALM("IBCE PRVNVA MAINT")
"RTN","IBCEP8",10,0)
 Q
"RTN","IBCEP8",11,0)
 ;
"RTN","IBCEP8",12,0)
HDR ; -- header code
"RTN","IBCEP8",13,0)
 K VALMHDR
"RTN","IBCEP8",14,0)
 Q
"RTN","IBCEP8",15,0)
 ;
"RTN","IBCEP8",16,0)
INIT ; Initialization
"RTN","IBCEP8",17,0)
 N DIC,DA,X,Y,DLAYGO,IBIF,DIR,DTOUT,DUOUT
"RTN","IBCEP8",18,0)
 K ^TMP("IBCE_PRVNVA_MAINT",$J)
"RTN","IBCEP8",19,0)
 ;
"RTN","IBCEP8",20,0)
 ; if coming in from main routine ^IBCEP6 this special variable IBNVPMIF is set already
"RTN","IBCEP8",21,0)
 I $G(IBNVPMIF)'="" S IBIF=IBNVPMIF G INIT1
"RTN","IBCEP8",22,0)
 ;
"RTN","IBCEP8",23,0)
 S DIR("A")="(I)NDIVIDUAL OR (F)ACILITY?: ",DIR(0)="SA^I:INDIVIDUAL;F:FACILITY" D ^DIR K DIR
"RTN","IBCEP8",24,0)
 I $D(DUOUT)!$D(DTOUT) S VALMQUIT=1 G INITQ
"RTN","IBCEP8",25,0)
 S IBIF=Y
"RTN","IBCEP8",26,0)
 ;
"RTN","IBCEP8",27,0)
INIT1 ;
"RTN","IBCEP8",28,0)
 ;
"RTN","IBCEP8",29,0)
 ; Begin IB*2.0*436 - RBN
"RTN","IBCEP8",30,0)
 ;
"RTN","IBCEP8",31,0)
 ;I IBIF="F" D
"RTN","IBCEP8",32,0)
 ;. S VALM("TITLE")="Non-VA Lab or Facility Info"
"RTN","IBCEP8",33,0)
 ;. K VALM("PROTOCOL")
"RTN","IBCEP8",34,0)
 ;. S Y=$$FIND1^DIC(101,,,"IBCE PRVNVA NONIND MAINT")
"RTN","IBCEP8",35,0)
 ;. I Y S VALM("PROTOCOL")=+Y_";ORD(101,"
"RTN","IBCEP8",36,0)
 ;
"RTN","IBCEP8",37,0)
 ; End IB*2.0*436 - RBN
"RTN","IBCEP8",38,0)
 ;
"RTN","IBCEP8",39,0)
 S DIC="^IBA(355.93,",DIC("DR")=".02///"_$S(IBIF'="F":2,1:1)
"RTN","IBCEP8",40,0)
 S DIC("S")="I $P(^(0),U,2)="_$S(IBIF'="F":2,1:1)
"RTN","IBCEP8",41,0)
 S DLAYGO=355.93,DIC(0)="AELMQ",DIC("A")="Select a NON"_$S(IBIF="I":"-",1:"/OTHER ")_"VA PROVIDER: "
"RTN","IBCEP8",42,0)
 D ^DIC K DIC,DLAYGO
"RTN","IBCEP8",43,0)
 I Y'>0 S VALMQUIT=1 G INITQ
"RTN","IBCEP8",44,0)
 S IBNPRV=+Y
"RTN","IBCEP8",45,0)
 ;
"RTN","IBCEP8",46,0)
 ; *** Begin IB*2.0*436 - RBN
"RTN","IBCEP8",47,0)
 ;
"RTN","IBCEP8",48,0)
 N NEWENTRY
"RTN","IBCEP8",49,0)
 S IBNPRV=+Y,NEWENTRY=$P($G(Y),U,3),IBFLPFLP=0
"RTN","IBCEP8",50,0)
 I 'NEWENTRY D
"RTN","IBCEP8",51,0)
 . N DA,X,Y,DIE,DR
"RTN","IBCEP8",52,0)
 . ;D EN^DDIOL(" ")
"RTN","IBCEP8",53,0)
 . ;D EN^DDIOL("If you do NOT want to edit the provider name or the provider type,","","!")
"RTN","IBCEP8",54,0)
 . ;D EN^DDIOL("then press return at the following NAME prompt.  Otherwise,")
"RTN","IBCEP8",55,0)
 . ;D EN^DDIOL("retype the name as you want it entered into the system.")
"RTN","IBCEP8",56,0)
 . ;D EN^DDIOL(" ")
"RTN","IBCEP8",57,0)
 . ;S DA=IBNPRV
"RTN","IBCEP8",58,0)
 . ;S DIE="^IBA(355.93,"
"RTN","IBCEP8",59,0)
 . ;S DR=".01"
"RTN","IBCEP8",60,0)
 . ;D ^DIE
"RTN","IBCEP8",61,0)
 . D SCREEN(IBNPRV)
"RTN","IBCEP8",62,0)
 . I $D(Y) S VALMQUIT=1 G INITQ
"RTN","IBCEP8",63,0)
 . I $G(IBFLPFLP) S IBIF=$S(IBIF="F":"I",1:"F")
"RTN","IBCEP8",64,0)
 ;
"RTN","IBCEP8",65,0)
 ; *** End IB*2.0*436 - rbn
"RTN","IBCEP8",66,0)
 ;
"RTN","IBCEP8",67,0)
 I IBIF="F" D
"RTN","IBCEP8",68,0)
 . S VALM("TITLE")="Non-VA Lab or Facility Info"
"RTN","IBCEP8",69,0)
 . K VALM("PROTOCOL")
"RTN","IBCEP8",70,0)
 . S Y=$$FIND1^DIC(101,,,"IBCE PRVNVA NONIND MAINT")
"RTN","IBCEP8",71,0)
 . I Y S VALM("PROTOCOL")=+Y_";ORD(101,"
"RTN","IBCEP8",72,0)
 D BLD^IBCEP8B(IBNPRV)
"RTN","IBCEP8",73,0)
INITQ Q
"RTN","IBCEP8",74,0)
 ;
"RTN","IBCEP8",75,0)
EXPND ;
"RTN","IBCEP8",76,0)
 Q
"RTN","IBCEP8",77,0)
 ;
"RTN","IBCEP8",78,0)
HELP ;
"RTN","IBCEP8",79,0)
 Q
"RTN","IBCEP8",80,0)
 ;
"RTN","IBCEP8",81,0)
EXIT ;
"RTN","IBCEP8",82,0)
 K ^TMP("IBCE_PRVNVA_MAINT",$J)
"RTN","IBCEP8",83,0)
 D CLEAN^VALM10
"RTN","IBCEP8",84,0)
 K IBFASTXT
"RTN","IBCEP8",85,0)
 Q
"RTN","IBCEP8",86,0)
 ;
"RTN","IBCEP8",87,0)
EDIT1(IBNPRV,IBNOLM) ; Edit non-VA provider/facility demographics
"RTN","IBCEP8",88,0)
 ; IBNPRV = ien of entry in file 355.93
"RTN","IBCEP8",89,0)
 ; IBNOLM = 1 if not called from list manager
"RTN","IBCEP8",90,0)
 ;
"RTN","IBCEP8",91,0)
 N DA,X,Y,DIE,DR,IBP
"RTN","IBCEP8",92,0)
 I '$G(IBNOLM) D FULL^VALM1
"RTN","IBCEP8",93,0)
 I IBNPRV D
"RTN","IBCEP8",94,0)
 . I '$G(IBNOLM) D CLEAR^VALM1
"RTN","IBCEP8",95,0)
 . S DIE="^IBA(355.93,",DA=IBNPRV,IBP=($P($G(^IBA(355.93,IBNPRV,0)),U,2)=2)
"RTN","IBCEP8",96,0)
 . ; PRXM/KJH - Added NPI and Taxonomy to the list of fields to be edited. Put a "NO^" around the Taxonomy multiple (#42) since some of the sub-field entries are 'required'.
"RTN","IBCEP8",97,0)
 . ; Begin IB*2.0*436 - RBN
"RTN","IBCEP8",98,0)
 . ;S DR=".01;"_$S(IBP:".03;.04",1:".05;.1;.06;.07;.08;.13///24;W !,""ID Qualifier: 24 - EMPLOYER'S IDENTIFICATION #"";.09Lab or Facility Primary ID;.11;.15")_";D PRENPI^IBCEP81(IBNPRV);D EN^IBCEP82(IBNPRV);S DIE(""NO^"")="""";42;K DIE(""NO^"")"
"RTN","IBCEP8",99,0)
 . ;S DR=$S(IBP:".03;.04",1:".05;.1;.06;.07;.08;.13///24;W !,""ID Qualifier: 24 - EMPLOYER'S IDENTIFICATION #"";.09Lab or Facility Primary ID;.11;.15")_";D PRENPI^IBCEP81(IBNPRV);D EN^IBCEP82(IBNPRV);S DIE(""NO^"")="""";42;K DIE(""NO^"")"
"RTN","IBCEP8",100,0)
 . ; End IB*2.0*436 - RBN
"RTN","IBCEP8",101,0)
 . ;IB*2.0*432 - add contact phone and name
"RTN","IBCEP8",102,0)
 . S DR=$S(IBP:".03;.04",1:".05;.1;.06;.07;.08;1.01;I X="""" S Y=""@2"";1.02R;S Y=""@3"";@2;1.02;@3;1.03;.13///24;W !,""ID Qualifier: 24 - EMPLOYER'S IDENTIFICATION #"";.09Lab or Facility Primary ID;.11;.15")
"RTN","IBCEP8",103,0)
 . S DR=DR_";D PRENPI^IBCEP81(IBNPRV);D EN^IBCEP82(IBNPRV);S DIE(""NO^"")="""";42;K DIE(""NO^"")"
"RTN","IBCEP8",104,0)
 . D ^DIE
"RTN","IBCEP8",105,0)
 . Q:$G(IBNOLM)
"RTN","IBCEP8",106,0)
 . D BLD^IBCEP8B(IBNPRV)
"RTN","IBCEP8",107,0)
 I '$G(IBNOLM) K VALMBCK S VALMBCK="R"
"RTN","IBCEP8",108,0)
 Q
"RTN","IBCEP8",109,0)
 ;
"RTN","IBCEP8",110,0)
EDITID(IBNPRV,IBSLEV) ; Link from this list template to maintain provider-specific ids
"RTN","IBCEP8",111,0)
 ; This entry point is called by 4 action protocols.
"RTN","IBCEP8",112,0)
 ; IBNPRV = ien of entry in file 355.93 (can be either an individual or a facility) (required)
"RTN","IBCEP8",113,0)
 ; IBSLEV = 1 for facility/provider own ID's
"RTN","IBCEP8",114,0)
 ; IBSLEV = 2 for facility/provider ID's furnished by an insurance company
"RTN","IBCEP8",115,0)
 ;
"RTN","IBCEP8",116,0)
 Q:'$G(IBNPRV)
"RTN","IBCEP8",117,0)
 Q:'$G(IBSLEV)
"RTN","IBCEP8",118,0)
 N IBPRV,IBIF
"RTN","IBCEP8",119,0)
 D FULL^VALM1    ; set full scrolling region
"RTN","IBCEP8",120,0)
 D CLEAR^VALM1   ; clear screen
"RTN","IBCEP8",121,0)
 S IBPRV=IBNPRV
"RTN","IBCEP8",122,0)
 ;
"RTN","IBCEP8",123,0)
 K IBFASTXT
"RTN","IBCEP8",124,0)
 S IBIF=$$GET1^DIQ(355.93,IBPRV,.02,"I")    ; 1=facility/group      2=individual
"RTN","IBCEP8",125,0)
 D EN^VALM("IBCE PRVPRV MAINT")
"RTN","IBCEP8",126,0)
 ;
"RTN","IBCEP8",127,0)
 K VALMQUIT
"RTN","IBCEP8",128,0)
 S VALMBCK=$S($G(IBFASTXT)'="":"Q",1:"R")
"RTN","IBCEP8",129,0)
 Q
"RTN","IBCEP8",130,0)
 ;
"RTN","IBCEP8",131,0)
NVAFAC ; Enter/edit Non-VA facility information
"RTN","IBCEP8",132,0)
 ; This entry point is called by the menu system for option IBCE PRVNVA FAC EDIT
"RTN","IBCEP8",133,0)
 N X,Y,DA,DIC,IBNPRV,DLAYGO
"RTN","IBCEP8",134,0)
 S DIC="^IBA(355.93,",DIC("S")="I $P(^(0),U,2)=1",DIC("DR")=".02///1"
"RTN","IBCEP8",135,0)
 S DLAYGO=355.93,DIC(0)="AELMQ",DIC("A")="Select a NON/Other VA FACILITY: "
"RTN","IBCEP8",136,0)
 D ^DIC K DIC,DLAYGO
"RTN","IBCEP8",137,0)
 I Y'>0 S VALMQUIT=1 G NVAFACQ
"RTN","IBCEP8",138,0)
 S IBNPRV=+Y
"RTN","IBCEP8",139,0)
 D EDIT1(IBNPRV,1)
"RTN","IBCEP8",140,0)
 ;
"RTN","IBCEP8",141,0)
NVAFACQ Q
"RTN","IBCEP8",142,0)
 ;
"RTN","IBCEP8",143,0)
GETFAC(IB,IBFILE,IBELE,CSZLEN) ; Returns facility name, address lines or city-state-zip
"RTN","IBCEP8",144,0)
 ;        IB = ien of entry in file
"RTN","IBCEP8",145,0)
 ;    IBFILE = 0 for retrieval from file 4, 1 for retrieval from file 355.93
"RTN","IBCEP8",146,0)
 ;  If IBELE = 0, returns name
"RTN","IBCEP8",147,0)
 ;           = 1, returns address line 1
"RTN","IBCEP8",148,0)
 ;           = 2, returns address line 2
"RTN","IBCEP8",149,0)
 ;           = 12, returns address lines 1 and 2 together
"RTN","IBCEP8",150,0)
 ;           = 3, returns city, state zip
"RTN","IBCEP8",151,0)
 ;           = "3C", returns city    = "3S", state    = "3Z", zip
"RTN","IBCEP8",152,0)
 ;    CSZLEN = max length allowed for city,st,zip string - Only applies when IBELE=3
"RTN","IBCEP8",153,0)
 ;
"RTN","IBCEP8",154,0)
 N Z,IBX,IC,IS,IZ,DIFF
"RTN","IBCEP8",155,0)
 S IBX=""
"RTN","IBCEP8",156,0)
 ;
"RTN","IBCEP8",157,0)
 S Z=$S('IBFILE:$G(^DIC(4,+IB,1)),1:$G(^IBA(355.93,+IB,0)))
"RTN","IBCEP8",158,0)
 I +IBELE=0 S IBX=$S('IBFILE:$P($G(^DIC(4,+IB,0)),U),1:$P($G(^IBA(355.93,+IB,0)),U))
"RTN","IBCEP8",159,0)
 I IBELE=1!(IBELE=12) S IBX=$S('IBFILE:$P(Z,U),1:$P(Z,U,5))
"RTN","IBCEP8",160,0)
 I IBELE=2!(IBELE=12) S IBX=$S(IBELE=12:IBX_" ",1:"")_$S('IBFILE:$P(Z,U,2),1:$P(Z,U,10))
"RTN","IBCEP8",161,0)
 ;
"RTN","IBCEP8",162,0)
 I +IBELE=3 D
"RTN","IBCEP8",163,0)
 . I 'IBFILE S IC=$P(Z,U,3),IS=$$STATE^IBCEFG1($P($G(^DIC(4,+IB,0)),U,2)),IZ=$P(Z,U,4)
"RTN","IBCEP8",164,0)
 . I IBFILE S IC=$P(Z,U,6),IS=$$STATE^IBCEFG1($P(Z,U,7)),IZ=$P(Z,U,8)
"RTN","IBCEP8",165,0)
 . ;
"RTN","IBCEP8",166,0)
 . I IBELE="3C" S IBX=IC Q
"RTN","IBCEP8",167,0)
 . I IBELE="3S" S IBX=IS Q
"RTN","IBCEP8",168,0)
 . I IBELE="3Z" S IBX=IZ Q
"RTN","IBCEP8",169,0)
 . ;
"RTN","IBCEP8",170,0)
 . S IBX=$$CSZ(IC,IS,IZ,+$G(CSZLEN))    ; build the city, st zip string since IBELE=3 here
"RTN","IBCEP8",171,0)
 . Q
"RTN","IBCEP8",172,0)
 ;
"RTN","IBCEP8",173,0)
GETFACX ;
"RTN","IBCEP8",174,0)
 Q IBX
"RTN","IBCEP8",175,0)
 ;
"RTN","IBCEP8",176,0)
CSZ(IC,IS,IZ,CSZLEN) ; build city, state, zip string
"RTN","IBCEP8",177,0)
 ; IC - city
"RTN","IBCEP8",178,0)
 ; IS - state abbreviation
"RTN","IBCEP8",179,0)
 ; IZ - zip
"RTN","IBCEP8",180,0)
 ; CSZLEN - max length allowed for city, st zip string
"RTN","IBCEP8",181,0)
 ;
"RTN","IBCEP8",182,0)
 NEW IBX,DIFF
"RTN","IBCEP8",183,0)
 ;
"RTN","IBCEP8",184,0)
 ; build the full city, st zip string
"RTN","IBCEP8",185,0)
 S IBX=IC_$S(IC'="":", ",1:"")_IS_" "_IZ
"RTN","IBCEP8",186,0)
 ;
"RTN","IBCEP8",187,0)
 I '$G(CSZLEN) G CSZX          ; no max length to worry about
"RTN","IBCEP8",188,0)
 I $L(IBX)'>CSZLEN G CSZX      ; length is OK so get out
"RTN","IBCEP8",189,0)
 ;
"RTN","IBCEP8",190,0)
 ; string is too long so try to shorten the zip if it has a dash
"RTN","IBCEP8",191,0)
 I IZ["-" S IZ=$P(IZ,"-",1),IBX=IC_$S(IC'="":", ",1:"")_IS_" "_IZ I $L(IBX)'>CSZLEN G CSZX
"RTN","IBCEP8",192,0)
 ;
"RTN","IBCEP8",193,0)
 ; string is still too long so truncate the city name until it fits
"RTN","IBCEP8",194,0)
 S DIFF=$L(IBX)-CSZLEN
"RTN","IBCEP8",195,0)
 S IC=$E(IC,1,$L(IC)-DIFF)
"RTN","IBCEP8",196,0)
 S IBX=IC_$S(IC'="":", ",1:"")_IS_" "_IZ
"RTN","IBCEP8",197,0)
CSZX ;
"RTN","IBCEP8",198,0)
 Q IBX
"RTN","IBCEP8",199,0)
 ;
"RTN","IBCEP8",200,0)
ALLID(IBPRV,IBPTYP,IBZ) ; Returns array IBZ for all ids for provider IBPRV
"RTN","IBCEP8",201,0)
 ; for all provider id types or for id type in IBPTYP
"RTN","IBCEP8",202,0)
 ; IBPRV = vp ien of provider
"RTN","IBCEP8",203,0)
 ; IBPTYP = ien of provider id type to return or "" for all
"RTN","IBCEP8",204,0)
 ; IBZ = array returned with internal data:
"RTN","IBCEP8",205,0)
 ;  IBZ(file 355.9 ien)=ID type^ID#^ins co^form type^bill care type^care un^X12 code for id type
"RTN","IBCEP8",206,0)
 N Z,Z0
"RTN","IBCEP8",207,0)
 K IBZ
"RTN","IBCEP8",208,0)
 G:'$G(IBPRV) ALLIDQ
"RTN","IBCEP8",209,0)
 S IBPTYP=$G(IBPTYP)
"RTN","IBCEP8",210,0)
 S Z=0 F  S Z=$O(^IBA(355.9,"B",IBPRV,Z)) Q:'Z  S Z0=$G(^IBA(355.9,Z,0)) D
"RTN","IBCEP8",211,0)
 . I $S(IBPTYP="":1,1:($P(Z0,U,6)=IBPTYP)) S IBZ(Z)=($P(Z0,U,6)_U_$P(Z0,U,7)_U_$P(Z0,U,2)_U_$P(Z0,U,4)_U_$P(Z0,U,5)_U_$P(Z0,U,3))_U_$P($G(^IBE(355.97,+$P(Z0,U,6),0)),U,3)
"RTN","IBCEP8",212,0)
 ;
"RTN","IBCEP8",213,0)
ALLIDQ Q
"RTN","IBCEP8",214,0)
 ;
"RTN","IBCEP8",215,0)
CLIA() ; Returns ien of CLIA # provider id type
"RTN","IBCEP8",216,0)
 N Z,IBZ
"RTN","IBCEP8",217,0)
 S (IBZ,Z)=0 F  S Z=$O(^IBE(355.97,Z)) Q:'Z  I $P($G(^(Z,0)),U,3)="X4",$P(^(0),U)["CLIA" S IBZ=Z Q
"RTN","IBCEP8",218,0)
 Q IBZ
"RTN","IBCEP8",219,0)
 ;
"RTN","IBCEP8",220,0)
STLIC() ; Returns ien of STLIC# provider id type
"RTN","IBCEP8",221,0)
 N Z,IBZ
"RTN","IBCEP8",222,0)
 S (IBZ,Z)=0 F  S Z=$O(^IBE(355.97,Z)) Q:'Z  I $P($G(^(Z,1)),U,3) S IBZ=Z Q
"RTN","IBCEP8",223,0)
 Q IBZ
"RTN","IBCEP8",224,0)
 ;
"RTN","IBCEP8",225,0)
TAXID() ; Returns ien of Fed tax id provider id type
"RTN","IBCEP8",226,0)
 N Z,IBZ
"RTN","IBCEP8",227,0)
 S (IBZ,Z)=0 F  S Z=$O(^IBE(355.97,Z)) Q:'Z  I $P($G(^(Z,1)),U,4) S IBZ=Z Q
"RTN","IBCEP8",228,0)
 Q IBZ
"RTN","IBCEP8",229,0)
 ;
"RTN","IBCEP8",230,0)
CLIANVA(IBIFN) ; Returns CLIA # for a non-VA facility on bill ien IBIFN
"RTN","IBCEP8",231,0)
 N IBCLIA,IBZ,IBNVA,Z
"RTN","IBCEP8",232,0)
 S IBCLIA="",IBZ=$$CLIA()
"RTN","IBCEP8",233,0)
 I IBZ D
"RTN","IBCEP8",234,0)
 . S IBNVA=$P($G(^DGCR(399,IBIFN,"U2")),U,10) Q:'IBNVA
"RTN","IBCEP8",235,0)
 . S IBCLIA=$$IDFIND^IBCEP2(IBIFN,IBZ,IBNVA_";IBA(355.93,","",1)
"RTN","IBCEP8",236,0)
 Q IBCLIA
"RTN","IBCEP8",237,0)
 ;
"RTN","IBCEP8",238,0)
VALFAC(X) ; Function returns 1 if format is valid for X12 facility name
"RTN","IBCEP8",239,0)
 ; Alpha/numeric/certain punctuation valid.  Must start with an Alpha
"RTN","IBCEP8",240,0)
 N OK,VAL
"RTN","IBCEP8",241,0)
 S OK=1
"RTN","IBCEP8",242,0)
 S VAL("A")="",VAL("N")="",VAL=",.- "
"RTN","IBCEP8",243,0)
 I $E(X)'?1A!'$$VALFMT(X,.VAL) S OK=0
"RTN","IBCEP8",244,0)
 Q OK
"RTN","IBCEP8",245,0)
 ;
"RTN","IBCEP8",246,0)
VALFMT(X,VAL) ; Returns 1 if format of X is valid, 0 if not
"RTN","IBCEP8",247,0)
 ; X = data to be examined
"RTN","IBCEP8",248,0)
 ; VAL = a 'string' of valid characters AND/OR (passed by reference)
"RTN","IBCEP8",249,0)
 ;    if VAL("A") defined ==> Alpha
"RTN","IBCEP8",250,0)
 ;    if VAL("A") defined ==> Numeric valid
"RTN","IBCEP8",251,0)
 ;    if VAL("A") defined ==> Punctuation valid
"RTN","IBCEP8",252,0)
 ;   any other character included in the string is checked individually
"RTN","IBCEP8",253,0)
 N Z
"RTN","IBCEP8",254,0)
 I $D(VAL("A")) D
"RTN","IBCEP8",255,0)
 . N Z0
"RTN","IBCEP8",256,0)
 . F Z=1:1:$L(X) I $E(X,Z)?1A S Z0(Z)=""
"RTN","IBCEP8",257,0)
 . S Z0="" F  S Z0=$O(Z0(Z0),-1) Q:'Z0  S $E(X,Z0)=""
"RTN","IBCEP8",258,0)
 I $D(VAL("N")) D
"RTN","IBCEP8",259,0)
 . N Z0
"RTN","IBCEP8",260,0)
 . F Z=1:1:$L(X) I $E(X,Z)?1N S Z0(Z)=""
"RTN","IBCEP8",261,0)
 . S Z0="" F  S Z0=$O(Z0(Z0),-1) Q:'Z0  S $E(X,Z0)=""
"RTN","IBCEP8",262,0)
 I $D(VAL("P")) D
"RTN","IBCEP8",263,0)
 . N Z0
"RTN","IBCEP8",264,0)
 . F Z=1:1:$L(X) I $E(X,Z)?1P S Z0(Z)=""
"RTN","IBCEP8",265,0)
 . S Z0="" F  S Z0=$O(Z0(Z0),-1) Q:'Z0  S $E(X,Z0)=""
"RTN","IBCEP8",266,0)
 I $G(VAL)'="" S X=$TR(X,VAL,"")
"RTN","IBCEP8",267,0)
 Q (X="")
"RTN","IBCEP8",268,0)
 ;
"RTN","IBCEP8",269,0)
PS(IBXSAVE) ; Returns 1 if IBXSAVE("PSVC") indicates the svc was non-lab
"RTN","IBCEP8",270,0)
 ; 
"RTN","IBCEP8",271,0)
 Q $S($G(IBXSAVE("PSVC"))="":0,1:"13"[IBXSAVE("PSVC"))
"RTN","IBCEP8",272,0)
 ;
"RTN","IBCEP8",273,0)
 ; Pass in the Internal Entry number to File 355.93
"RTN","IBCEP8",274,0)
 ; Return the Primary ID and Qualifier (ID Type) from 355.9
"RTN","IBCEP8",275,0)
PRIMID(IEN35593) ; Return External Primary ID and ID Quailier
"RTN","IBCEP8",276,0)
 N INDXVAL,LIST,MSG,IDCODE
"RTN","IBCEP8",277,0)
 S INDXVAL=IEN35593_";IBA(355.93,"
"RTN","IBCEP8",278,0)
 N SCREEN S SCREEN="I $P(^(0),U,8)"
"RTN","IBCEP8",279,0)
 D FIND^DIC(355.9,,"@;.06EI;.07","Q",INDXVAL,,,SCREEN,,"LIST","MSG")
"RTN","IBCEP8",280,0)
 I '+$G(LIST("DILIST",0)) Q ""   ; No Primary ID
"RTN","IBCEP8",281,0)
 I +$G(LIST("DILIST",0))>1 Q "***ERROR***^***ERROR***"  ; Bad.  More than one. 
"RTN","IBCEP8",282,0)
 ; Found just one
"RTN","IBCEP8",283,0)
 S IDCODE=$$GET1^DIQ(355.97,LIST("DILIST","ID",1,.06,"I"),.03)
"RTN","IBCEP8",284,0)
 Q $G(LIST("DILIST","ID",1,.07))_U_IDCODE_" - "_$G(LIST("DILIST","ID",1,.06,"E"))
"RTN","IBCEP8",285,0)
 ;
"RTN","IBCEP8",286,0)
 ; Begin IB*2.0*436 - RBN
"RTN","IBCEP8",287,0)
 ;
"RTN","IBCEP8",288,0)
PRVFMT ;  called only by the INPUT TRANSFORM of #355.93,.01
"RTN","IBCEP8",289,0)
 ;      no other calls are allowed to this tag
"RTN","IBCEP8",290,0)
 ;
"RTN","IBCEP8",291,0)
 ; DESCRIPTION  : Sets the NAME (.01) and the ENTITY TYPE (.02) fields
"RTN","IBCEP8",292,0)
 ;                of file 355.93.  Allows the user to change the ENTITY
"RTN","IBCEP8",293,0)
 ;                TYPE and forces reentry of the provider data so
"RTN","IBCEP8",294,0)
 ;                that it matches the ENTITY TYPE.  Also formats the 
"RTN","IBCEP8",295,0)
 ;                NAME to correspond to the ENTITY TYPE. Disallows
"RTN","IBCEP8",296,0)
 ;                changing of the NAME field from ANYWHERE other than
"RTN","IBCEP8",297,0)
 ;                PROVIDER ID MAINTENANCE or IB EDIT BILLING INFO 
"RTN","IBCEP8",298,0)
 ;                (billing screens).  Adding new entries directly from
"RTN","IBCEP8",299,0)
 ;                FileMan is no longer permitted.
"RTN","IBCEP8",300,0)
 ; 
"RTN","IBCEP8",301,0)
 ; INPUTS       : Variables set by user selected option, screen actions
"RTN","IBCEP8",302,0)
 ;                and user input:
"RTN","IBCEP8",303,0)
 ;                X        - Provider name passed in by .01 field input
"RTN","IBCEP8",304,0)
 ;                           transform.
"RTN","IBCEP8",305,0)
 ;                XQY0     - IB option selected by the user.
"RTN","IBCEP8",306,0)
 ;                DA       - IEN of the record selected by the user
"RTN","IBCEP8",307,0)
 ;                IBNVPMIF - ENTITY TYPE flag passed in from ListManager
"RTN","IBCEP8",308,0)
 ;                           (F=Facility,I=Individual).
"RTN","IBCEP8",309,0)
 ;                IBSCNN   - IB variable indication of the actions/submenu:
"RTN","IBCEP8",310,0)
 ;                           #3, #4, and #7 found on bill screen #8
"RTN","IBCEP8",311,0)
 ;
"RTN","IBCEP8",312,0)
 ; OUTPUTS      : IBFLPFLP - Indicate that the user is changing the
"RTN","IBCEP8",313,0)
 ;                           ENTITY TYPE (flip flop).  Possible states:
"RTN","IBCEP8",314,0)
 ;
"RTN","IBCEP8",315,0)
 ;                   IBFLPFLP = 0 - The type was not changed.
"RTN","IBCEP8",316,0)
 ;                            = 1 - The type changed to facility type.
"RTN","IBCEP8",317,0)
 ;                            = 2 - The type changed to individual type.
"RTN","IBCEP8",318,0)
 ;
"RTN","IBCEP8",319,0)
 ; 
"RTN","IBCEP8",320,0)
 ; GLOBALS      : ^IBA(355.93  - IB NON/OTHER VA BILLING PROVIDER file
"RTN","IBCEP8",321,0)
 ; 
"RTN","IBCEP8",322,0)
 ; 
"RTN","IBCEP8",323,0)
 ;
"RTN","IBCEP8",324,0)
 N OKRTN,IBNAM,IBCEPDA,IBTYPE
"RTN","IBCEP8",325,0)
 S (IBFLPFLP,OKRTN)=0,IBNAM=X,IBCEPDA=$G(DA)
"RTN","IBCEP8",326,0)
 ;
"RTN","IBCEP8",327,0)
 ; Prevent modification of NAME (#.01) in file #355.93 from anywhere
"RTN","IBCEP8",328,0)
 ; but the PROVIDER ID MAINTENANCE or IB EDIT BILLING INFO screens.
"RTN","IBCEP8",329,0)
 ;
"RTN","IBCEP8",330,0)
 I $P($G(XQY0),U,1)="IB EDIT BILLING INFO" D PRVINIT,PRVMANT S OKRTN=1
"RTN","IBCEP8",331,0)
 I $P($G(XQY0),U,1)="IBCE PROVIDER MAINT" D PRVINIT,PRVMANT S OKRTN=1
"RTN","IBCEP8",332,0)
 I 'OKRTN K X
"RTN","IBCEP8",333,0)
 Q
"RTN","IBCEP8",334,0)
 ;==========================
"RTN","IBCEP8",335,0)
PRVINIT ; initialization
"RTN","IBCEP8",336,0)
 ;
"RTN","IBCEP8",337,0)
 ; If arriving from the billing screens (IBSCNN is 3 or 4) the
"RTN","IBCEP8",338,0)
 ; variable DA is the ien of the bill (file #399) - need to find the ien
"RTN","IBCEP8",339,0)
 ; of 355.93 of the provider that the user entered/selected
"RTN","IBCEP8",340,0)
 ;
"RTN","IBCEP8",341,0)
 ; *** Begin IB*2.0*436 -RBN ***
"RTN","IBCEP8",342,0)
 ;I $G(IBSCNN)=3!($G(IBSCNN)=4) S IBCEPDA=$O(^IBA(355.93,"B",IBNAM,"")),IBTYPE=$S(IBSCNN=3:2,1:1)
"RTN","IBCEP8",343,0)
 I $G(IBDR20),'$G(IBCEP6FL) S IBCEPDA=$O(^IBA(355.93,"B",IBNAM,"")),IBTYPE=$S(IBDR20=84:1,IBDR20=104:1,1:2)
"RTN","IBCEP8",344,0)
 ; *** End IB*2.0*436 -RBN ***
"RTN","IBCEP8",345,0)
 ;
"RTN","IBCEP8",346,0)
 ; If arriving from the Provider ID Maintenance call (billing screen or
"RTN","IBCEP8",347,0)
 ; direct call to the option) & the user entered a brand new record, the
"RTN","IBCEP8",348,0)
 ; IBNVPMIF variable is set to indicate if the user was entering a
"RTN","IBCEP8",349,0)
 ; Non-VA facility ("F") or a Non-VA Provider (ie. individual) ("I")
"RTN","IBCEP8",350,0)
 I '$G(IBCEPDA)&$D(IBNVPMIF) S IBTYPE=$S(IBNVPMIF="F":1,1:2)
"RTN","IBCEP8",351,0)
 ;
"RTN","IBCEP8",352,0)
 ; If arriving from the Provider ID Maintenance call (billing screen or
"RTN","IBCEP8",353,0)
 ; direct call to the option) & the user selected an existing record
"RTN","IBCEP8",354,0)
 I $G(IBCEPDA) S IBTYPE=$P($G(^IBA(355.93,IBCEPDA,0)),U,2)
"RTN","IBCEP8",355,0)
 Q
"RTN","IBCEP8",356,0)
 ;----------------------------
"RTN","IBCEP8",357,0)
PRVMANT ; is the user flipping the provider type (for existing records only)
"RTN","IBCEP8",358,0)
 N TXT,TXT2,%
"RTN","IBCEP8",359,0)
 ;
"RTN","IBCEP8",360,0)
 ; IBTYPE - based on the current value of provider type (#355.93,.02)
"RTN","IBCEP8",361,0)
 ;          where "1" = Facility/Group  & "2" = Individual
"RTN","IBCEP8",362,0)
 ;
"RTN","IBCEP8",363,0)
 I '$G(IBTYPE) Q    ; one of the calls that triggers this routine needs
"RTN","IBCEP8",364,0)
 ;               ; this check when creating a new record in file #355.93
"RTN","IBCEP8",365,0)
 ;
"RTN","IBCEP8",366,0)
 ; If record is not brand new (IBCEPDA exists) - give the user the
"RTN","IBCEP8",367,0)
 ; opportunity to change the provider type field (#355.93,.02)
"RTN","IBCEP8",368,0)
 I IBTYPE,$G(IBCEPDA) D
"RTN","IBCEP8",369,0)
 . ;
"RTN","IBCEP8",370,0)
 . S %=2  ; Default answer is no
"RTN","IBCEP8",371,0)
 . ;
"RTN","IBCEP8",372,0)
 . I IBTYPE=1 S TXT="Facility",TXT2="Individual/Provider"
"RTN","IBCEP8",373,0)
 . I IBTYPE=2 S TXT="Individual/Provider",TXT2="Facility"
"RTN","IBCEP8",374,0)
 . ;
"RTN","IBCEP8",375,0)
 . D EN^DDIOL("This provider name exists and is a "_TXT_".","","!")
"RTN","IBCEP8",376,0)
 . D EN^DDIOL("Do you want to change this record to be a "_TXT2)
"RTN","IBCEP8",377,0)
 . ;
"RTN","IBCEP8",378,0)
 . D YN^DICN
"RTN","IBCEP8",379,0)
 . ;
"RTN","IBCEP8",380,0)
 . I %=1 D
"RTN","IBCEP8",381,0)
 . . ;
"RTN","IBCEP8",382,0)
 . . S IBTYPE=$S(IBTYPE=1:2,1:1),IBFLPFLP=IBTYPE
"RTN","IBCEP8",383,0)
 ;
"RTN","IBCEP8",384,0)
 I IBTYPE=2 D STDNAME^XLFNAME(.IBNAM,"GP") S X=IBNAM
"RTN","IBCEP8",385,0)
 I IBTYPE=1,('$$VALFAC^IBCEP8(IBNAM)) K X
"RTN","IBCEP8",386,0)
 Q
"RTN","IBCEP8",387,0)
 ;
"RTN","IBCEP8",388,0)
 ; DESCRIPTION: This routine inputs a provider name and formats it appropriately as an 
"RTN","IBCEP8",389,0)
 ;              individual or a facility name.
"RTN","IBCEP8",390,0)
 ; 
"RTN","IBCEP8",391,0)
 ; INPUTS     : name
"RTN","IBCEP8",392,0)
 ; 
"RTN","IBCEP8",393,0)
 ; OUTPUTS    : formatted name and provider type
"RTN","IBCEP8",394,0)
 ; 
"RTN","IBCEP8",395,0)
 ; VARIABLES  :
"RTN","IBCEP8",396,0)
 ; 
"RTN","IBCEP8",397,0)
 ; GLOBALS      : 
"RTN","IBCEP8",398,0)
 ; 
"RTN","IBCEP8",399,0)
 ; FUNCTIONS    : None
"RTN","IBCEP8",400,0)
 ; 
"RTN","IBCEP8",401,0)
 ; SUBROUTINES  : 
"RTN","IBCEP8",402,0)
 ; 
"RTN","IBCEP8",403,0)
 ; HISTORY    : Original version - 21 September 2010
"RTN","IBCEP8",404,0)
 ;
"RTN","IBCEP8",405,0)
SCREEN(IBNPRV) ;
"RTN","IBCEP8",406,0)
 N IBNPRVN,IBNAME,DR,DIR,DA,DIRUT,X,DTOUT,DUOUT
"RTN","IBCEP8",407,0)
 S IBNPRVN=""
"RTN","IBCEP8",408,0)
 D EN^DDIOL(" ")
"RTN","IBCEP8",409,0)
 D EN^DDIOL("If you do NOT want to edit the provider name or the provider type,","","!")
"RTN","IBCEP8",410,0)
 D EN^DDIOL("then press return at the following NAME prompt.  Otherwise,")
"RTN","IBCEP8",411,0)
 D EN^DDIOL("retype the name as you want it entered into the system.")
"RTN","IBCEP8",412,0)
 D EN^DDIOL(" ")
"RTN","IBCEP8",413,0)
 ;
"RTN","IBCEP8",414,0)
 ; Get the current provider name
"RTN","IBCEP8",415,0)
 ;
"RTN","IBCEP8",416,0)
 S IBNAME=$P(^IBA(355.93,IBNPRV,0),U,1)
"RTN","IBCEP8",417,0)
 ;
"RTN","IBCEP8",418,0)
 ; Get the user's input
"RTN","IBCEP8",419,0)
 ;
"RTN","IBCEP8",420,0)
INPUT ;
"RTN","IBCEP8",421,0)
 S DIR(0)="FOUr^3:30"
"RTN","IBCEP8",422,0)
 S DIR("A")="NAME: "_IBNAME_"//"
"RTN","IBCEP8",423,0)
 ;
"RTN","IBCEP8",424,0)
 S DIR("?")=" "
"RTN","IBCEP8",425,0)
 S DIR("?",1)="Press <ENTER> to accept the displayed provider name"
"RTN","IBCEP8",426,0)
 S DIR("?",2)="or enter the name as you would like it displayed."
"RTN","IBCEP8",427,0)
 ;
"RTN","IBCEP8",428,0)
 S DIR("??")="IB PROV ID MAINT^"
"RTN","IBCEP8",429,0)
 ;
"RTN","IBCEP8",430,0)
 D ^DIR
"RTN","IBCEP8",431,0)
 ;
"RTN","IBCEP8",432,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","IBCEP8",433,0)
 I X["?" G INPUT
"RTN","IBCEP8",434,0)
 S:'$D(DIRUT) IBNPRVN=X
"RTN","IBCEP8",435,0)
 ; The user entered something else
"RTN","IBCEP8",436,0)
 ;
"RTN","IBCEP8",437,0)
 S DIE="^IBA(355.93,"
"RTN","IBCEP8",438,0)
 S DA=IBNPRV
"RTN","IBCEP8",439,0)
 S DR=".01///"_IBNPRVN
"RTN","IBCEP8",440,0)
 D ^DIE
"RTN","IBCEP8",441,0)
 Q
"RTN","IBCEP8",442,0)
 ;
"RTN","IBCEP8",443,0)
 ; End IB*2.0*436 - RBN
"RTN","IBCEP8",444,0)
 ;
"RTN","IBCEP8B")
0^10^B12352923^B10681479
"RTN","IBCEP8B",1,0)
IBCEP8B ;ALB/CJS - Functions for NON-VA PROVIDER cont'd ;06-06-08
"RTN","IBCEP8B",2,0)
 ;;2.0;INTEGRATED BILLING;**391,432**;21-MAR-94;Build 192
"RTN","IBCEP8B",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEP8B",4,0)
 ;
"RTN","IBCEP8B",5,0)
BLD(IBNPRV) ; Build/Rebuild display
"RTN","IBCEP8B",6,0)
 N IBLCT,IBCT,IBLST,IBPRI,IBIEN,Z,Z1,Z2,IB1
"RTN","IBCEP8B",7,0)
 K @VALMAR
"RTN","IBCEP8B",8,0)
 ;S (IBLCT,IBCT)=0,Z=$G(^IBA(355.93,IBNPRV,0))
"RTN","IBCEP8B",9,0)
 S (IBLCT,IBCT)=0,Z=$G(^IBA(355.93,IBNPRV,0)),IB1=$G(^IBA(355.93,IBNPRV,1))
"RTN","IBCEP8B",10,0)
 S IBCT=IBCT+1
"RTN","IBCEP8B",11,0)
 S Z1=$J("Name: ",15)_$P(Z,U) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",12,0)
 I $P(Z,U,2)=2 D
"RTN","IBCEP8B",13,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",14,0)
 . S Z1=$J("Type: ",15)_$S($P(Z,U,2)=2:"INDIVIDUAL PROVIDER",1:"OUTSIDE OR OTHER VA FACILITY") D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",15,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",16,0)
 . S Z1=$J("Credentials: ",15)_$P(Z,U,3) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",17,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",18,0)
 . S Z1=$J("Specialty: ",15)_$P(Z,U,4) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",19,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",20,0)
 . S Z1=$J("NPI: ",15)_$$NPIGET^IBCEP81(IBNPRV) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",21,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",22,0)
 . S IBPRI=$$TAXGET^IBCEP81(IBNPRV,.IBLST)
"RTN","IBCEP8B",23,0)
 . S Z1=$J("Taxonomy Code: ",15)_$P(IBPRI,U)
"RTN","IBCEP8B",24,0)
 . I $D(IBLST) S Z1=Z1_" ("_$S($P(IBLST(IBLST),U,3)=1:"Primary",1:"Secondary")_")"
"RTN","IBCEP8B",25,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",26,0)
 . S IBIEN=""
"RTN","IBCEP8B",27,0)
 . F  S IBIEN=$O(IBLST(IBIEN)) Q:IBIEN=""  D
"RTN","IBCEP8B",28,0)
 .. I IBIEN=IBLST Q
"RTN","IBCEP8B",29,0)
 .. S IBCT=IBCT+1
"RTN","IBCEP8B",30,0)
 .. S Z1=$J("",15)_$P(IBLST(IBIEN),U)_" ("_$S($P(IBLST(IBIEN),U,3)=1:"Primary",1:"Secondary")_")"
"RTN","IBCEP8B",31,0)
 .. D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",32,0)
 E  D
"RTN","IBCEP8B",33,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",34,0)
 . S Z1=$J("Address: ",15)_$P(Z,U,5) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",35,0)
 . I $P(Z,U,10) D
"RTN","IBCEP8B",36,0)
 .. S IBCT=IBCT+1
"RTN","IBCEP8B",37,0)
 .. S Z1=$J("",15)_$P(Z,U,10)
"RTN","IBCEP8B",38,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",39,0)
 . S Z1=$J("",15)_$P(Z,U,6)_$S($P(Z,U,6)'="":", ",1:"")_$S($P(Z,U,7):$$EXTERNAL^DILFD(355.93,.07,"",$P(Z,U,7))_"  ",1:"")_$P(Z,U,8)
"RTN","IBCEP8B",40,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",41,0)
 . ; start contact changes here
"RTN","IBCEP8B",42,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",43,0)
 . S Z1=$J("Contact Name: ",15)_$P(IB1,U,1) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",44,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",45,0)
 . S Z1=$J("Contact Phone: ",15)_$P(IB1,U,2)_"  "_$P(IB1,U,3) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",46,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",47,0)
 . S Z1=" " D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",48,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",49,0)
 . S Z1=$J("Type of Facility: ",30)_$$EXTERNAL^DILFD(355.93,.11,,$P(Z,U,11))
"RTN","IBCEP8B",50,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",51,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",52,0)
 . S Z1=$J("Primary ID: ",30)_$P(Z,U,9)
"RTN","IBCEP8B",53,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",54,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",55,0)
 . S Z1=$J("ID Qualifier: ",30)_$$GET1^DIQ(355.97,$P(Z,U,13),.03) I $P(Z,U,13)]"" S Z1=Z1_" - "_$$GET1^DIQ(355.97,$P(Z,U,13),.01)
"RTN","IBCEP8B",56,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",57,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",58,0)
 . S Z1=$J("Mammography Certification #: ",30)_$P(Z,U,15)
"RTN","IBCEP8B",59,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",60,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",61,0)
 . S Z1=$J("NPI: ",30)_$$NPIGET^IBCEP81(IBNPRV) D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",62,0)
 . S IBCT=IBCT+1
"RTN","IBCEP8B",63,0)
 . S IBPRI=$$TAXGET^IBCEP81(IBNPRV,.IBLST)
"RTN","IBCEP8B",64,0)
 . S Z1=$J("Taxonomy Code: ",30)_$P(IBPRI,U)
"RTN","IBCEP8B",65,0)
 . I $D(IBLST) S Z1=Z1_" ("_$S($P(IBLST(IBLST),U,3)=1:"Primary",1:"Secondary")_")"
"RTN","IBCEP8B",66,0)
 . D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",67,0)
 . S IBIEN=""
"RTN","IBCEP8B",68,0)
 . F  S IBIEN=$O(IBLST(IBIEN)) Q:IBIEN=""  D
"RTN","IBCEP8B",69,0)
 .. I IBIEN=IBLST Q
"RTN","IBCEP8B",70,0)
 .. S IBCT=IBCT+1
"RTN","IBCEP8B",71,0)
 .. S Z1=$J("",30)_$P(IBLST(IBIEN),U)_" ("_$S($P(IBLST(IBIEN),U,3)=1:"Primary",1:"Secondary")_")"
"RTN","IBCEP8B",72,0)
 .. D SET1(.IBLCT,Z1,IBCT)
"RTN","IBCEP8B",73,0)
 K VALMBG,VALMCNT
"RTN","IBCEP8B",74,0)
 S VALMBG=1,VALMCNT=IBLCT
"RTN","IBCEP8B",75,0)
 Q
"RTN","IBCEP8B",76,0)
 ;
"RTN","IBCEP8B",77,0)
SET1(IBLCT,TEXT,IBCT) ;
"RTN","IBCEP8B",78,0)
 S IBLCT=IBLCT+1 D SET^VALM10(IBLCT,TEXT,$G(IBCT))
"RTN","IBCEP8B",79,0)
 Q
"RTN","IBCEU")
0^47^B105674829^B57127468
"RTN","IBCEU",1,0)
IBCEU ;ALB/TMP - EDI UTILITIES ;02-OCT-96
"RTN","IBCEU",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,207,232,349,432**;21-MAR-94;Build 192
"RTN","IBCEU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEU",4,0)
 ; DBIA SUPPORTED REF: GET^XUA4A72 = 1625
"RTN","IBCEU",5,0)
 ; DBIA SUPPORTED REF: $$ESBLOCK^XUSESIG1 = 1557
"RTN","IBCEU",6,0)
 Q
"RTN","IBCEU",7,0)
 ;
"RTN","IBCEU",8,0)
TESTPT(DFN) ; Determine if pt is test pt
"RTN","IBCEU",9,0)
 ; Returns 1 if a test pt, 0 if not
"RTN","IBCEU",10,0)
 Q $E($P($G(^DPT(+DFN,0)),U,9),1,5)="00000"
"RTN","IBCEU",11,0)
 ;
"RTN","IBCEU",12,0)
MAINPRV(IBIFN) ; Returns name^id^ien^type code of 'main' prov on bill IBIFN
"RTN","IBCEU",13,0)
 N IBPRV,IBCOB,IBQ,Z
"RTN","IBCEU",14,0)
 D GETPRV(IBIFN,"3,4",.IBPRV)
"RTN","IBCEU",15,0)
 S IBQ="",IBCOB=$$COBN^IBCEF(IBIFN)
"RTN","IBCEU",16,0)
 F Z=3,4 I $G(IBPRV(Z,1))'="" D  Q
"RTN","IBCEU",17,0)
 . S IBQ=IBPRV(Z,1),$P(IBQ,U,4)=Z
"RTN","IBCEU",18,0)
 . I $G(IBPRV(Z,1,IBCOB))'="" S $P(IBQ,U,2)=IBPRV(Z,1,IBCOB)
"RTN","IBCEU",19,0)
 Q IBQ
"RTN","IBCEU",20,0)
 ;
"RTN","IBCEU",21,0)
PRVOK(VAL,IBIFN) ; Check bill form & prov function agree
"RTN","IBCEU",22,0)
 ; VAL = internal value of prov function
"RTN","IBCEU",23,0)
 ;
"RTN","IBCEU",24,0)
 N OK,IBBT
"RTN","IBCEU",25,0)
 S OK=0
"RTN","IBCEU",26,0)
 Q:VAL="" OK
"RTN","IBCEU",27,0)
 Q:'IBIFN OK
"RTN","IBCEU",28,0)
 S IBBT=$$FT^IBCEF(IBIFN) ; 2 If CMS-1500, 3 If UB-04
"RTN","IBCEU",29,0)
 I IBBT=2 D
"RTN","IBCEU",30,0)
 . I VAL=1 S OK=1 Q   ; CMS-1500, REFERRING
"RTN","IBCEU",31,0)
 . I VAL=3 S OK=1 Q   ; CMS-1500, RENDERING
"RTN","IBCEU",32,0)
 . I VAL=5 S OK=1 Q   ; CMS-1500, SUPERVISING
"RTN","IBCEU",33,0)
 I 'OK,IBBT=3 D
"RTN","IBCEU",34,0)
 . I VAL=1 S OK=1 Q   ; UB-04, REFERRING
"RTN","IBCEU",35,0)
 . I VAL=2 S OK=1 Q   ; UB-04, OPERATING
"RTN","IBCEU",36,0)
 . I VAL=3 S OK=1 Q   ; UB-04, RENDERING
"RTN","IBCEU",37,0)
 . I VAL=4 S OK=1 Q   ; UB-04, ATTENDING
"RTN","IBCEU",38,0)
 . I VAL=9 S OK=1 Q   ; UB-04, OTHER
"RTN","IBCEU",39,0)
 ;
"RTN","IBCEU",40,0)
 Q OK
"RTN","IBCEU",41,0)
 ;
"RTN","IBCEU",42,0)
PRVOK1(VAL,IBIFN) ; Check for both attending and rendering on bill
"RTN","IBCEU",43,0)
 N OK
"RTN","IBCEU",44,0)
 S OK=1
"RTN","IBCEU",45,0)
 Q:$$FT^IBCEF(IBIFN)=3 1  ; both are allowed on UB
"RTN","IBCEU",46,0)
 I $S("34"'[VAL:0,1:$D(^DGCR(399,IBIFN,"PRV","B",$S(VAL=3:4,1:3)))) D EN^DDIOL($S(VAL=3:"ATTENDING",1:"RENDERING")_" ALREADY EXISTS - CAN'T HAVE BOTH ON ONE BILL") S OK=0
"RTN","IBCEU",47,0)
 Q OK
"RTN","IBCEU",48,0)
 ;
"RTN","IBCEU",49,0)
SPEC(IBPRV,IBDT) ; Returns spec code for vp ien IBPRV from file 355.9
"RTN","IBCEU",50,0)
 ;  (for new person entries, as of date in IBDT)
"RTN","IBCEU",51,0)
 ; DBIA 1625
"RTN","IBCEU",52,0)
 N IBSPEC
"RTN","IBCEU",53,0)
 S:'$G(IBDT) IBDT=DT
"RTN","IBCEU",54,0)
 I IBPRV'["IBA(355.93" S IBSPEC=$S(IBPRV:$P($$GET^XUA4A72(+IBPRV,IBDT),U,8),1:"") ; VA
"RTN","IBCEU",55,0)
 I IBPRV["IBA(355.93" S IBSPEC=$P($G(^IBA(355.93,+IBPRV,0)),U,4) ; Non-VA
"RTN","IBCEU",56,0)
 Q IBSPEC
"RTN","IBCEU",57,0)
 ;
"RTN","IBCEU",58,0)
CRED(IBPRV,IBIFN,IBPIEN,IBTYP) ; Returns prov credentials
"RTN","IBCEU",59,0)
 ; IBPRV = vp of provider for file 200 or 355.93
"RTN","IBCEU",60,0)
 ; IBIFN = bill ien in file 399 (optional)
"RTN","IBCEU",61,0)
 ; IBPIEN = prov ien - file 399.0222 (optional)
"RTN","IBCEU",62,0)
 ;          DEM;432 - prov ien can be from file 399.0404
"RTN","IBCEU",63,0)
 ;          as well (optional).
"RTN","IBCEU",64,0)
 ; IBTYP = the prov type
"RTN","IBCEU",65,0)
 ;
"RTN","IBCEU",66,0)
 N IBCRED
"RTN","IBCEU",67,0)
 S IBCRED=""
"RTN","IBCEU",68,0)
 ;
"RTN","IBCEU",69,0)
 ; DEM;432 - Provider can come from either file 399.0222, or
"RTN","IBCEU",70,0)
 ;           file 399.0404. Variable IBLNPRV is the flag
"RTN","IBCEU",71,0)
 ;           that indicates we want prov ien from file 399.0404.
"RTN","IBCEU",72,0)
 ;
"RTN","IBCEU",73,0)
 I '$G(IBLNPRV),$G(IBIFN),'$D(^DGCR(399,IBIFN,"PRV",0)) G CREDQ
"RTN","IBCEU",74,0)
 ;
"RTN","IBCEU",75,0)
 ; DEM;432 - Next line if for line level provider. Variable IBPROCP,
"RTN","IBCEU",76,0)
 ;           if it exist, is the procedure ien. File 399.0404 is a
"RTN","IBCEU",77,0)
 ;           multiple of the Procedure File 399.0304.
"RTN","IBCEU",78,0)
 ;
"RTN","IBCEU",79,0)
 I $G(IBLNPRV),$G(IBIFN),$G(IBPROCP),'$D(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",0)) G CREDQ
"RTN","IBCEU",80,0)
 I '$G(IBLNPRV),$G(IBIFN),($G(IBPIEN)!$G(IBTYP)) D
"RTN","IBCEU",81,0)
 . I '$G(IBPIEN) S IBPIEN=+$O(^DGCR(399,IBIFN,"PRV","B",IBTYP,0))
"RTN","IBCEU",82,0)
 . S IBCRED=$P($G(^DGCR(399,IBIFN,"PRV",IBPIEN,0)),U,3)
"RTN","IBCEU",83,0)
 ;
"RTN","IBCEU",84,0)
 I $G(IBLNPRV),$G(IBIFN),$G(IBPROCP),($G(IBPIEN)!$G(IBTYP)) D  ; DEM;432 - Line Provider File 399.0404.
"RTN","IBCEU",85,0)
 . I '$G(IBPIEN) S IBPIEN=+$O(^DGCR(399,IBIFN,"CP",IBPROCP,"B",IBTYP,0))
"RTN","IBCEU",86,0)
 . S IBCRED=$P($G(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",IBPIEN,0)),U,3)
"RTN","IBCEU",87,0)
 ;
"RTN","IBCEU",88,0)
CREDQ ;
"RTN","IBCEU",89,0)
 I $G(IBPRV),IBCRED="" D
"RTN","IBCEU",90,0)
 . I IBPRV'["IBA(355.93" S IBCRED=$P($$ESBLOCK^XUSESIG1(+IBPRV),U,2)
"RTN","IBCEU",91,0)
 . I IBPRV["IBA(355.93" S IBCRED=$P($G(^IBA(355.93,+IBPRV,0)),U,3)
"RTN","IBCEU",92,0)
 Q IBCRED
"RTN","IBCEU",93,0)
 ;
"RTN","IBCEU",94,0)
GETPRV(IBIFN,IBTYP,IBPRV) ; Returns prov(s) of type(s) IBTYP for
"RTN","IBCEU",95,0)
 ;  bill ien IBIFN.
"RTN","IBCEU",96,0)
 ;  IBTYP = prov types needed, separated by ',' or ALL
"RTN","IBCEU",97,0)
 ; 
"RTN","IBCEU",98,0)
 ; OUTPUT:
"RTN","IBCEU",99,0)
 ;  IBPRV array: IBPRV(type)= 1 if prov is from old prov flds
"RTN","IBCEU",100,0)
 ;               IBPRV(type,ct)=name^current COB id^vp provider ien^cred
"RTN","IBCEU",101,0)
 ;               IBPRV(type,ct,seq)=COB seq specific id
"RTN","IBCEU",102,0)
 ;               IBPRV(type)=default nm^def id
"RTN","IBCEU",103,0)
 ;               IBPRV(type,"NOTOPT")= defined if a required prov type
"RTN","IBCEU",104,0)
 ;
"RTN","IBCEU",105,0)
 N IB,IBCT,IBD,IBY,IBZ,IBMRAND,IBID,IBWNR,IBPNM,Z ;,IBZFID
"RTN","IBCEU",106,0)
 ;S IBZFID=""
"RTN","IBCEU",107,0)
 D F^IBCEF("N-CURRENT INS POLICY TYPE","IBZ",,IBIFN)
"RTN","IBCEU",108,0)
 ;I IBZ="CI" D F^IBCEF("N-FEDERAL TAX ID","IBZFID",,IBIFN) S IBZFID=$TR(IBZFID,"-")
"RTN","IBCEU",109,0)
 S IBPRV=U_$G(IBZ),IBY=0
"RTN","IBCEU",110,0)
 S IBMRAND=$$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEU",111,0)
 ;WCJ;IB*2.0*432;Remove Default
"RTN","IBCEU",112,0)
 I IBMRAND D
"RTN","IBCEU",113,0)
 .; F Z=1:1:3,5,6,7,8,9 S:Z=3&($$FT^IBCEF(IBIFN)=3) Z=4 S IBPRV(Z)=$S(Z=3!(Z=4):"DEPT VETERANS AFFAIRS",1:"")_"^VAD000"
"RTN","IBCEU",114,0)
 . F Z=1:1:9 S IBPRV(Z)="^VAD000"
"RTN","IBCEU",115,0)
 . I '$$INPAT^IBCEF(IBIFN,1),$$FT^IBCEF(IBIFN)=3 S IBPRV(4,1)="^SLF000"
"RTN","IBCEU",116,0)
 ;WCJ;IB*2.0*432;End changes
"RTN","IBCEU",117,0)
 ;
"RTN","IBCEU",118,0)
 ; For backwards compatability (before the claim level provider mulitple)
"RTN","IBCEU",119,0)
 I '$D(^DGCR(399,+IBIFN,"PRV",0)) D  G GETQ
"RTN","IBCEU",120,0)
 . N IBALL
"RTN","IBCEU",121,0)
 . S IBALL=(IBTYP="ALL")
"RTN","IBCEU",122,0)
 . I IBTYP[4!IBALL S:$P($G(^DGCR(399,+IBIFN,"U1")),U,13)'="" IBPRV(4,1)=$P(^("U1"),U,13),IBPRV(4)=1 Q:IBTYP=4
"RTN","IBCEU",123,0)
 . I IBTYP[3!IBALL S:$P($G(^DGCR(399,+IBIFN,"UF2")),U)'="" IBPRV(3,1)=$P(^("UF2"),U),IBPRV(3)=1 Q:IBTYP=3
"RTN","IBCEU",124,0)
 . I IBTYP[9!IBALL S:$P($G(^DGCR(399,+IBIFN,"U1")),U,14)'="" IBPRV(9,1)=$P(^("U1"),U,14),IBPRV(9)=1
"RTN","IBCEU",125,0)
 ;
"RTN","IBCEU",126,0)
 S IBID=4+$$COBN^IBCEF(IBIFN),IBWNR=$$WNRBILL^IBEFUNC(IBIFN)
"RTN","IBCEU",127,0)
 F IBZ=1:1:$S(IBTYP="ALL":99,1:$L(IBTYP,",")) S (IBCT,IB)=0,IBY=$S(IBTYP'="ALL":$P(IBTYP,",",IBZ),1:$O(^DGCR(399,+IBIFN,"PRV","B",IBY))) Q:IBY=""  F  S IB=$O(^DGCR(399,+IBIFN,"PRV","B",IBY,IB)) Q:'IB  D
"RTN","IBCEU",128,0)
 . S IBCT=IBCT+1
"RTN","IBCEU",129,0)
 . S IBD=$G(^DGCR(399,+IBIFN,"PRV",IB,0))
"RTN","IBCEU",130,0)
 . Q:'$P(IBD,U,2)
"RTN","IBCEU",131,0)
 . S IBPNM=$$EXPAND^IBTRE(399.0222,.02,$P(IBD,U,2))
"RTN","IBCEU",132,0)
 . I IBWNR Q:'$D(IBPRV(IBY))  S $P(IBD,U,IBID)=$P(IBPRV(IBY),U,2)
"RTN","IBCEU",133,0)
 . S IBPRV(IBY,IBCT)=IBPNM_U_$S($P(IBD,U,IBID)'="":$P(IBD,U,IBID),$P($G(IBPRV(IBY)),U,2)'="":$P(IBPRV(IBY),U,2),1:$P($$DEFID^IBCEF74(IBIFN,IB),U,IBID-4))_U_$P(IBD,U,2)
"RTN","IBCEU",134,0)
 . S $P(IBPRV(IBY,IBCT),U,4)=$$CRED($P(IBPRV(IBY,IBCT),U,3),IBIFN,$S($P(IBD,U,3)'=""!'$P(IBPRV(IBY,IBCT),U,3):IB,1:""))
"RTN","IBCEU",135,0)
 . F Z=1:1:3 D
"RTN","IBCEU",136,0)
 .. ;I IBZFID'="",'$$INPAT^IBCEF(IBIFN,1),$P(IBPRV(IBY,IBCT),U,2)="SLF000" S IBZFID=""
"RTN","IBCEU",137,0)
 .. ;I $S(Z=1:1,1:$D(^DGCR(399,IBIFN,"I"_Z))) S IBPRV(IBY,IBCT,Z)=$S($G(IBZFID)'="":IBZFID,$P(IBD,U,Z+4)'="":$P(IBD,U,Z+4),1:"")
"RTN","IBCEU",138,0)
 .. I $S(Z=1:1,1:$D(^DGCR(399,IBIFN,"I"_Z))) S IBPRV(IBY,IBCT,Z)=$S($P(IBD,U,Z+4)'="":$P(IBD,U,Z+4),1:$P($$DEFID^IBCEF74(IBIFN,IB),U,Z))
"RTN","IBCEU",139,0)
GETQ D NEEDPRV(IBIFN,IBTYP,.IBPRV)
"RTN","IBCEU",140,0)
 Q
"RTN","IBCEU",141,0)
 ;
"RTN","IBCEU",142,0)
NEEDPRV(IBIFN,IBTYP,IBPRV) ; Check for needed prov
"RTN","IBCEU",143,0)
 ; If needed, not entered, insert defaults for MCR only
"RTN","IBCEU",144,0)
 N IB0,IBINP,IBFT,IBMRAND,IBTOB
"RTN","IBCEU",145,0)
 S IB0=$G(^DGCR(399,+IBIFN,0))
"RTN","IBCEU",146,0)
 S IBFT=($$FT^IBCEF(IBIFN)=3),IBINP=$$INPAT^IBCEF(IBIFN,1),IBTOB=$$TOB^IBCBB(IB0)
"RTN","IBCEU",147,0)
 ; Only allow defaults for MCR
"RTN","IBCEU",148,0)
 S IBMRAND=$$WNRBILL^IBEFUNC(IBIFN) ;$$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEU",149,0)
 ;
"RTN","IBCEU",150,0)
 I IBTYP="ALL"!((IBTYP_",")["1,") D
"RTN","IBCEU",151,0)
 . ; DEM;432 - UB-04 or CMS-1500 SITUATIONAL
"RTN","IBCEU",152,0)
 . S IBPRV(1,"SITUATIONAL")=1
"RTN","IBCEU",153,0)
 . Q
"RTN","IBCEU",154,0)
 ;
"RTN","IBCEU",155,0)
 I IBTYP="ALL"!((IBTYP_",")["2,") D:IBFT
"RTN","IBCEU",156,0)
 . ; only for bill type inpt - 11X, outpt - 83X
"RTN","IBCEU",157,0)
 . S IBPRV(2,"SITUATIONAL")=1  ; DEM;432 - Default to "SITUATIONAL". If conditions below are met, then IBPRV(2,"SITUATIONAL") is KILLED and IBRPV is SET according to conditions.
"RTN","IBCEU",158,0)
 . Q:$S(IBINP:$E(IBTOB,1,2)'="11",1:$E(IBTOB,1,2)'="83")
"RTN","IBCEU",159,0)
 . ; UB-04 bill includes HCPCS procs - operating phys situational
"RTN","IBCEU",160,0)
 . N Z
"RTN","IBCEU",161,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  I $P($G(^(Z,0)),U)["ICP" D  Q
"RTN","IBCEU",162,0)
 .. K IBPRV(2,"SITUATIONAL")  ; DEM;432 - We have met one of the condtions, so KILL IBPRV(2,"SITUATIONAL"). 
"RTN","IBCEU",163,0)
 .. I IBINP S IBPRV(2,"SITUATIONAL")=1 Q  ; DEM;432 - If UB-04 (inpatient), then operating provider situational.
"RTN","IBCEU",164,0)
 .. I 'IBINP S IBPRV(2,"NOTOPT")=1  ; DEM;432 - If UB-04 (outpatient), then operating provider required.
"RTN","IBCEU",165,0)
 .. Q:'IBMRAND
"RTN","IBCEU",166,0)
 .. I '$O(IBPRV(2,0)) S IBPRV(2,"REQ")=1,IBPRV(2,1)=$G(IBPRV(2))
"RTN","IBCEU",167,0)
 ;
"RTN","IBCEU",168,0)
 I IBTYP="ALL"!((IBTYP_",")["3,") D
"RTN","IBCEU",169,0)
 . ; if a CMS-1500 bill, rendering is required
"RTN","IBCEU",170,0)
 . I 'IBFT S IBPRV(3,"NOTOPT")=1
"RTN","IBCEU",171,0)
 . ; DEM;432 - if UB-04, rendering is situational.
"RTN","IBCEU",172,0)
 . I IBFT S IBPRV(3,"SITUATIONAL")=1 Q
"RTN","IBCEU",173,0)
 . Q:'IBMRAND
"RTN","IBCEU",174,0)
 . I '$O(IBPRV(3,0)) S IBPRV(3,1)=$G(IBPRV(3)),IBPRV(3,"REQ")=1
"RTN","IBCEU",175,0)
 ;
"RTN","IBCEU",176,0)
 I IBTYP="ALL"!((IBTYP_",")["4,") D:IBFT
"RTN","IBCEU",177,0)
 . ; if a UB-04, attending required
"RTN","IBCEU",178,0)
 . S IBPRV(4,"NOTOPT")=1
"RTN","IBCEU",179,0)
 . Q:'IBMRAND
"RTN","IBCEU",180,0)
 . I '$O(IBPRV(4,0)) S IBPRV(4,1)=$G(IBPRV(4)),IBPRV(4,"REQ")=1
"RTN","IBCEU",181,0)
 Q
"RTN","IBCEU",182,0)
 ;
"RTN","IBCEU",183,0)
CKPROV(IBIFN,IBTYP,IBVAL) ; Checks if prov of type IBTYP in 'PRV' node
"RTN","IBCEU",184,0)
 ; of bill IBIFN
"RTN","IBCEU",185,0)
 ; If IBVAL = 1, skips the check for an existing provider, just looks
"RTN","IBCEU",186,0)
 ;               for existence of the function itself
"RTN","IBCEU",187,0)
 N OK,IBFT,Z,R
"RTN","IBCEU",188,0)
 S OK=0,IBFT=$$FT^IBCEF(IBIFN)
"RTN","IBCEU",189,0)
 S Z=+$O(^DGCR(399,IBIFN,"PRV","B",+IBTYP,0))
"RTN","IBCEU",190,0)
 I $G(^DGCR(399,IBIFN,"PRV",Z,0))'="" D
"RTN","IBCEU",191,0)
 . ; Only outpt UB-04 can have SLF000 as prov ID with no name
"RTN","IBCEU",192,0)
 . I IBFT=3,'$$INPAT^IBCEF(IBIFN,1),$P(^DGCR(399,IBIFN,"PRV",Z,0),U,2)="",$P(^(0),U,5)="SLF000" S OK=1 Q
"RTN","IBCEU",193,0)
 . I '$G(IBVAL) Q:$P(^DGCR(399,IBIFN,"PRV",Z,0),U,2)=""
"RTN","IBCEU",194,0)
 . S OK=1
"RTN","IBCEU",195,0)
 Q OK
"RTN","IBCEU",196,0)
 ;
"RTN","IBCEU",197,0)
XFER(IBQ) ; Transfer DILIST
"RTN","IBCEU",198,0)
 ; IBQ = # of entries already found
"RTN","IBCEU",199,0)
 N Z,IBZ
"RTN","IBCEU",200,0)
 S (Z,IBZ)=0
"RTN","IBCEU",201,0)
 F  S Z=$O(^TMP("DILIST",$J,1,Z)) Q:'Z  S IBZ=IBZ+1,^TMP("IBLIST",$J,1,IBZ+IBQ)=^TMP("DILIST",$J,1,Z),^TMP("IBLIST",$J,2,IBZ+IBQ)=^TMP("DILIST",$J,2,Z) M ^TMP("IBLIST",$J,"ID",IBZ+IBQ)=^TMP("DILIST",$J,"ID",Z)
"RTN","IBCEU",202,0)
 ;
"RTN","IBCEU",203,0)
 I $D(^TMP("DILIST",$J,0)) S ^TMP("IBLIST",$J,0)=^TMP("DILIST",$J,0)
"RTN","IBCEU",204,0)
 S $P(^TMP("IBLIST",$J,0),U)=IBQ+IBZ
"RTN","IBCEU",205,0)
 Q
"RTN","IBCEU",206,0)
 ;
"RTN","IBCEU",207,0)
DATE(X) ; Convert date X in YYYYMMDD or YYMMDD to FM format
"RTN","IBCEU",208,0)
 ; FP = flag to indicate if past or future dates are expected
"RTN","IBCEU",209,0)
 N %DT,Y
"RTN","IBCEU",210,0)
 I $L(X)=8,$E(X,1,4)<2100,$E(X,5,6)<13,$E(X,7,8)<32 S X=$E(X,1,4)-1700_$E(X,5,8) G DTQ
"RTN","IBCEU",211,0)
 I $L(X)=6,$E(X,3,4)<13,$E(X,5,6)<32 S X=$E(X,3,4)_"/"_$E(X,5,6)_"/"_$E(X,1,2),%DT="N" D ^%DT I Y>0 S X=Y
"RTN","IBCEU",212,0)
DTQ Q X
"RTN","IBCEU",213,0)
 ;
"RTN","IBCEU",214,0)
BCLASS(IBIFN) ; Returns actual bill classif. code from ptr fld
"RTN","IBCEU",215,0)
 ;  .25 in file 399 for bill ien IBIFN
"RTN","IBCEU",216,0)
 Q $P($G(^DGCR(399.1,+$P($G(^DGCR(399,IBIFN,0)),U,25),0)),U,2)
"RTN","IBCEU",217,0)
 ;
"RTN","IBCEU",218,0)
ADMHR(IBIFN,IBDTTM) ; Extract admit hr from admit dt/tm
"RTN","IBCEU",219,0)
 ;  Default 00 if no time and bill is 11X or 18X
"RTN","IBCEU",220,0)
 N TM
"RTN","IBCEU",221,0)
 S TM=$P(IBDTTM,".",2)
"RTN","IBCEU",222,0)
 I TM="","18"[$$BCLASS(IBIFN),$P($G(^DGCR(399,IBIFN,0)),U,24)=1 S TM="00"
"RTN","IBCEU",223,0)
 I TM'="",TM'="00" S TM=$E(TM_"0000",1,4)
"RTN","IBCEU",224,0)
 Q TM
"RTN","IBCEU",225,0)
 ;
"RTN","IBCEU",226,0)
OLAB(IBIFN) ; Returns 1 if bill IBIFN is outside lab
"RTN","IBCEU",227,0)
 N IBL,IBLAB
"RTN","IBCEU",228,0)
 S IBL=0
"RTN","IBCEU",229,0)
 S IBLAB=$P($G(^DGCR(399,IBIFN,"U2")),U,11)
"RTN","IBCEU",230,0)
 I IBLAB,"24"[IBLAB S IBL=1
"RTN","IBCEU",231,0)
 Q IBL
"RTN","IBCEU",232,0)
 ;
"RTN","IBCEU",233,0)
PSRV(IBIFN) ; Returns 1 if bill IBIFN has any purch services
"RTN","IBCEU",234,0)
 N IBZ,IBXDATA,IBXSAVE,Z
"RTN","IBCEU",235,0)
 S IBZ=0
"RTN","IBCEU",236,0)
 D F^IBCEF("N-HCFA 1500 PROCEDURES",,,IBIFN)
"RTN","IBCEU",237,0)
 S Z=0 F  S Z=$O(IBXSAVE("BOX24",Z)) Q:'Z  I $P(IBXSAVE("BOX24",Z),U,11) S IBZ=1 Q
"RTN","IBCEU",238,0)
 Q IBZ
"RTN","IBCEU",239,0)
 ;
"RTN","IBCEU",240,0)
SEQBILL(IBIFN) ; Returns the ien's of all bills in COB sequence for bill IBIFN
"RTN","IBCEU",241,0)
 ; Return value is "^" delimited: primary ien^secondary ien^tertiary ien
"RTN","IBCEU",242,0)
 N IBSEQ,Z
"RTN","IBCEU",243,0)
 S IBSEQ=$P($G(^DGCR(399,IBIFN,"M1")),U,5,7)
"RTN","IBCEU",244,0)
 S Z=$$COBN^IBCEF(IBIFN)
"RTN","IBCEU",245,0)
 I $P(IBSEQ,U,Z)="" S $P(IBSEQ,U,Z)=IBIFN
"RTN","IBCEU",246,0)
 Q IBSEQ
"RTN","IBCEU",247,0)
 ;
"RTN","IBCEU",248,0)
 ;IB*2.0*432/TAZ Added to take into account the line level providers.
"RTN","IBCEU",249,0)
GETPRV1(IBIFN,IBTYP,IBPRV) ; Returns prov(s) of type(s) IBTYP for
"RTN","IBCEU",250,0)
 ;  bill ien IBIFN for TPJI display
"RTN","IBCEU",251,0)
 ;  IBTYP = prov types needed, separated by ',' or ALL
"RTN","IBCEU",252,0)
 ; 
"RTN","IBCEU",253,0)
 ; OUTPUT:
"RTN","IBCEU",254,0)
 ;  IBPRV array: IBPRV(level,type,ct)=name^current COB id^vp provider ien^cred
"RTN","IBCEU",255,0)
 ;
"RTN","IBCEU",256,0)
 N IB,IBCT,IBD,IBY,IBZ,IBMRAND,IBID,IBWNR,IBPNM,Z,IBPRTYP
"RTN","IBCEU",257,0)
 D F^IBCEF("N-CURRENT INS POLICY TYPE","IBZ",,IBIFN)
"RTN","IBCEU",258,0)
 S IBPRV=U_$G(IBZ),IBY=0
"RTN","IBCEU",259,0)
 D ALLIDS^IBCEFP(IBIFN,.IBXSAVE)
"RTN","IBCEU",260,0)
 S IBCT=0
"RTN","IBCEU",261,0)
 F  S IBCT=$O(IBXSAVE("PROVINF",IBIFN,"C",IBCT)) Q:'IBCT  D
"RTN","IBCEU",262,0)
 . S IBPRTYP=""
"RTN","IBCEU",263,0)
 . F  S IBPRTYP=$O(IBXSAVE("PROVINF",IBIFN,"C",IBCT,IBPRTYP)) Q:'IBPRTYP  D
"RTN","IBCEU",264,0)
 .. I IBTYP'="ALL",IBTYP'[IBPRTYP Q  ;Screen out unwanted providers
"RTN","IBCEU",265,0)
 .. N IBPRIEN,OBPRNM,IBCOBID
"RTN","IBCEU",266,0)
 .. S IBPRIEN=$P(IBXSAVE("PROVINF",IBIFN,"C",IBCT,IBPRTYP),U)
"RTN","IBCEU",267,0)
 .. S $P(IBPRV(1,IBCT,IBPRTYP),U,1)=$$EXPAND^IBTRE(399.0222,.02,IBPRIEN)
"RTN","IBCEU",268,0)
 .. S $P(IBPRV(1,IBCT,IBPRTYP),U,2)=IBXSAVE("PROVINF",IBIFN,"C",IBCT,IBPRTYP,"COBID")
"RTN","IBCEU",269,0)
 .. S $P(IBPRV(1,IBCT,IBPRTYP),U,3)=IBPRIEN
"RTN","IBCEU",270,0)
 .. S $P(IBPRV(1,IBCT,IBPRTYP),U,4)=$P(IBXSAVE("PROVINF",IBIFN,"C",IBCT,IBPRTYP,"NAME"),U,4)
"RTN","IBCEU",271,0)
 S IBCT=0
"RTN","IBCEU",272,0)
 F  S IBCT=$O(IBXSAVE("L-PROV",IBIFN,IBCT)) Q:'IBCT  D
"RTN","IBCEU",273,0)
 . S IBPRTYP=""
"RTN","IBCEU",274,0)
 . F  S IBPRTYP=$O(IBXSAVE("L-PROV",IBIFN,IBCT,"C",1,IBPRTYP)) Q:'IBPRTYP  D
"RTN","IBCEU",275,0)
 .. I IBTYP'="ALL",IBTYP'[IBPRTYP Q  ;Screen out unwanted providers
"RTN","IBCEU",276,0)
 .. N IBPRIEN
"RTN","IBCEU",277,0)
 .. S IBPRIEN=$P(IBXSAVE("L-PROV",IBIFN,IBCT,"C",1,IBPRTYP),U)
"RTN","IBCEU",278,0)
 .. S IBPRV(2,IBCT,IBPRTYP)=$$EXPAND^IBTRE(399.0222,.02,IBPRIEN)
"RTN","IBCEU",279,0)
 .. S $P(IBPRV(2,IBCT,IBPRTYP),U,2)=IBXSAVE("L-PROV",IBIFN,IBCT,"C",1,IBPRTYP,"COBID")
"RTN","IBCEU",280,0)
 .. S $P(IBPRV(2,IBCT,IBPRTYP),U,3)=IBPRIEN
"RTN","IBCEU",281,0)
 .. S $P(IBPRV(2,IBCT,IBPRTYP),U,4)=$P(IBXSAVE("L-PROV",IBIFN,IBCT,"C",1,IBPRTYP,"NAME"),U,4)
"RTN","IBCEU",282,0)
 Q 
"RTN","IBCEU0")
0^76^B65545551^B63678448
"RTN","IBCEU0",1,0)
IBCEU0 ;ALB/TMP - EDI UTILITIES ;02-OCT-96
"RTN","IBCEU0",2,0)
 ;;2.0;INTEGRATED BILLING;**137,197,155,296,349,417,432**;21-MAR-94;Build 192
"RTN","IBCEU0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEU0",4,0)
 ;
"RTN","IBCEU0",5,0)
NOTECHG(IBDA,IBNTEXT) ; Enter who/when review stat change was entered
"RTN","IBCEU0",6,0)
 ; IBDA = ien of entry in file 361.1
"RTN","IBCEU0",7,0)
 ; IBNTEXT = array containing the lines of text to store if not using the
"RTN","IBCEU0",8,0)
 ;           default text  IBNTEXT = # of lines  IBNTEXT(#)=line text
"RTN","IBCEU0",9,0)
 N IBIEN,IBTEXT,DA,X,Y,DIC,DO,DLAYGO,DD
"RTN","IBCEU0",10,0)
 S DA(1)=IBDA,DIC="^IBM(361.1,"_DA(1)_",2,",DIC(0)="L",DLAYGO=361.121
"RTN","IBCEU0",11,0)
 S X=$$NOW^XLFDT
"RTN","IBCEU0",12,0)
 D FILE^DICN K DIC,DD,DO,DLAYGO
"RTN","IBCEU0",13,0)
 Q:Y'>0
"RTN","IBCEU0",14,0)
 S DA(2)=DA(1),DA(1)=+Y,IBIEN=DA(1)_","_DA(2)_","
"RTN","IBCEU0",15,0)
 I $G(IBNTEXT) D
"RTN","IBCEU0",16,0)
 . M IBTEXT=IBNTEXT
"RTN","IBCEU0",17,0)
 E  D
"RTN","IBCEU0",18,0)
 . S IBTEXT(1)="REVIEW STATUS CHANGED TO '"_$$EXTERNAL^DILFD(361.1,.2,,$P(^IBM(361.1,DA(2),0),U,20))_"'  BY: "_$$EXTERNAL^DILFD(361.121,.02,,+$G(DUZ))
"RTN","IBCEU0",19,0)
 D WP^DIE(361.121,IBIEN,.03,,"IBTEXT") K ^TMP("DIERR",$J)
"RTN","IBCEU0",20,0)
 Q
"RTN","IBCEU0",21,0)
 ;
"RTN","IBCEU0",22,0)
LOCK(IBFILE,IBREC) ; Lock record # IBREC in file #IBFILE (361 or 361.1)
"RTN","IBCEU0",23,0)
 N OK
"RTN","IBCEU0",24,0)
 S OK=0
"RTN","IBCEU0",25,0)
 L +^IBM(IBFILE,IBREC):3 I $T S OK=1
"RTN","IBCEU0",26,0)
 I 'OK D
"RTN","IBCEU0",27,0)
 . W !,"Another user has locked this record - try again later"
"RTN","IBCEU0",28,0)
 . D PAUSE^VALM1
"RTN","IBCEU0",29,0)
 Q OK
"RTN","IBCEU0",30,0)
 ;
"RTN","IBCEU0",31,0)
UNLOCK(IBFILE,IBREC) ; Unlock record # IBREC in file #IBFILE
"RTN","IBCEU0",32,0)
 I $G(IBREC) L -^IBM(IBFILE,IBREC)
"RTN","IBCEU0",33,0)
 Q
"RTN","IBCEU0",34,0)
 ;
"RTN","IBCEU0",35,0)
MSTAT ; Enter reviewed by selected range
"RTN","IBCEU0",36,0)
 N IBDAX,IBA,IBCLOSE,IBLOOK,IBOK,IBSTOP,IBREBLD,IBCLOK,DA,DIR,X,Y,DIE,DR
"RTN","IBCEU0",37,0)
 D FULL^VALM1
"RTN","IBCEU0",38,0)
 D SEL^IBCECSA4(.IBDAX)
"RTN","IBCEU0",39,0)
 S IBREBLD=0
"RTN","IBCEU0",40,0)
 I $O(IBDAX(""))="" G MSTATQ
"RTN","IBCEU0",41,0)
 S DIR("?,1")="ONLY SELECT TO CLOSE THE TRANSMIT RECORDS IF YOU KNOW THESE ARE THE FINAL",DIR("?",2)="  ELECTRONIC MESSAGES YOU WILL RECEIVE FOR ALL THE BILLS REFERENCED BY",DIR("?")="  THESE MESSAGES"
"RTN","IBCEU0",42,0)
 S DIR(0)="YA",DIR("A",1)="DO YOU WANT TO AUTOMATICALLY CLOSE THE TRANSMIT RECORDS FOR ANY MESSAGES",DIR("A")=" THAT AREN'T REJECTS?: ",DIR("B")="NO" W ! D ^DIR K DIR W !
"RTN","IBCEU0",43,0)
 G:$D(DIRUT) MSTATQ
"RTN","IBCEU0",44,0)
 S IBCLOSE=(Y=1)
"RTN","IBCEU0",45,0)
 S DIR(0)="YA",DIR("A")="DO YOU WANT TO SEE EACH MESSAGE BEFORE MARKING IT REVIEWED?: ",DIR("B")="NO"
"RTN","IBCEU0",46,0)
 S DIR("?",1)="IF YOU OPT TO SEE EACH MESSAGE, YOU CAN CONTROL WHETHER OR NOT THE MESSAGE",DIR("?",2)="  IS MARKED AS REVIEWED"
"RTN","IBCEU0",47,0)
 I 'IBCLOSE S DIR("?")=DIR("?",2) K DIR("?",2)
"RTN","IBCEU0",48,0)
 I IBCLOSE S DIR("?",2)=DIR("?",2)_" AND, FOR NON-REJECTS, WHETHER OR NOT TO CLOSE THE",DIR("?")="  TRANSMIT RECORD FOR THE BILL"
"RTN","IBCEU0",49,0)
 W ! D ^DIR K DIR W !
"RTN","IBCEU0",50,0)
 G:$D(DIRUT) MSTATQ
"RTN","IBCEU0",51,0)
 S IBLOOK=(Y=1)
"RTN","IBCEU0",52,0)
 S IBDAX=0,IBSTOP=0
"RTN","IBCEU0",53,0)
 F  S IBDAX=+$O(IBDAX(IBDAX)) Q:'IBDAX  D  Q:IBSTOP
"RTN","IBCEU0",54,0)
 . S IBA=$G(IBDAX(IBDAX))
"RTN","IBCEU0",55,0)
 . S DIE="^IBM(361,",DA=$P(IBA,U,2),DR=""
"RTN","IBCEU0",56,0)
 . I DA D
"RTN","IBCEU0",57,0)
 .. S IBOK=1
"RTN","IBCEU0",58,0)
 .. S IBCLOK=$S(IBCLOSE:1,1:0)
"RTN","IBCEU0",59,0)
 .. I IBLOOK D  Q:'IBOK
"RTN","IBCEU0",60,0)
 ... S DIC="^IBM(361," D EN^DIQ
"RTN","IBCEU0",61,0)
 ... I '$$LOCK(361,DA) W ! S IBOK=0 Q
"RTN","IBCEU0",62,0)
 ... S DIR(0)="YA",DIR("A")="OK TO MARK REVIEWED?: ",DIR("B")="YES",DIR("?",1)="IF YOU ENTER YES, THIS MESSAGE WILL BE MARKED REVIEWED"
"RTN","IBCEU0",63,0)
 ... S DIR("?",2)="IF YOU ENTER NO, THIS MESSAGE WILL NOT BE ALTERED",DIR("?",3)="IF YOU ENTER AN ^, THIS MESSAGE WILL NOT BE ALTERED & NONE OF THE",DIR("?")="   REMAINING MESSAGES WILL BE PROCESSED" D ^DIR K DIR
"RTN","IBCEU0",64,0)
 ... I Y'>0 S IBOK=0 S:$D(DIRUT) IBSTOP=1 Q
"RTN","IBCEU0",65,0)
 ... I 'IBCLOSE D
"RTN","IBCEU0",66,0)
 .... S DIR(0)="YA",DIR("A")="OK TO CLOSE THIS BILL'S TRANSMIT RECORD?: ",DIR("B")="NO"
"RTN","IBCEU0",67,0)
 .... S DIR("?",1)="If you respond YES to this prompt, the transmit status of this bill will",DIR("?",2)="  be set to CLOSED.  No further electronic processing of this bill will be"
"RTN","IBCEU0",68,0)
 .... S DIR("?",3)="  allowed.  If you respond NO to this prompt, this electronic message will",DIR("?",4)="  be filed as reviewed, but the bill's transmit status will not be changed."
"RTN","IBCEU0",69,0)
 .... S DIR("?",5)="  You may wish to periodically print a list of bills with a non-final",DIR("?",6)="  (closed/cancelled/etc) status to ensure the electronic processing of all"
"RTN","IBCEU0",70,0)
 .... S DIR("?",7)="  bills has been completed.  Closing the transmit bill record here will",DIR("?")="  eliminate the bill from this list."
"RTN","IBCEU0",71,0)
 .... W ! D ^DIR K DIR W !
"RTN","IBCEU0",72,0)
 .... I Y'=1 S IBCLOK=0
"RTN","IBCEU0",73,0)
 .. I 'IBLOOK,$P($G(^IBM(361,DA,0)),U,3)="R" D  Q:'IBOK
"RTN","IBCEU0",74,0)
 ... S DR="1",DIC="^IBM(361," D EN^DIQ W !,"Bill Number: ",$$EXPAND^IBTRE(361,.01,+^IBM(361,DA,0))
"RTN","IBCEU0",75,0)
 ... S DIR(0)="YA",DIR("A")="THIS IS A REJECTION ... ARE YOU SURE YOU WANT TO MARK IT REVIEWED?: ",DIR("B")="NO"
"RTN","IBCEU0",76,0)
 ... S DIR("?",1)="IF YOU ENTER YES, THIS MESSAGE WILL BE MARKED REVIEWED"
"RTN","IBCEU0",77,0)
 ... S DIR("?",2)="IF YOU ENTER NO, THIS MESSAGE WILL NOT BE ALTERED",DIR("?",3)="IF YOU ENTER AN ^, THIS MESSAGE WILL NOT BE ALTERED & NONE OF THE",DIR("?")="   MESSAGES FOLLOWING THIS ONE WILL BE PROCESSED" D ^DIR K DIR
"RTN","IBCEU0",78,0)
 ... I Y'=1 S IBOK=0 S:$D(DIRUT) IBSTOP=1
"RTN","IBCEU0",79,0)
 .. S:'IBREBLD IBREBLD=1
"RTN","IBCEU0",80,0)
 .. S DR=".09////2;.1////F" D ^DIE
"RTN","IBCEU0",81,0)
 .. N IBUPD
"RTN","IBCEU0",82,0)
 .. S IBUPD=0
"RTN","IBCEU0",83,0)
 .. I $$PRINTUPD($G(^IBM(361,DA,1,1,0)),+$P(^IBM(361,DA,0),U,11)) S IBUPD=1
"RTN","IBCEU0",84,0)
 .. I $G(^IBM(361,DA,1,1,0))["CLAIM SENT TO PAYER" D UPDTX^IBCECSA2(+$P(^IBM(361,DA,0),U,11),$S(IBCLOK:"Z",1:"A2")) S IBUPD=1
"RTN","IBCEU0",85,0)
 .. I $G(^IBM(361,DA,1,1,0))["CLAIM REJECTED" D UPDTX^IBCECSA2(+$P(^IBM(361,DA,0),U,11),"E") S IBUPD=1
"RTN","IBCEU0",86,0)
 .. I IBCLOK,'IBUPD D UPDTX^IBCECSA2(+$P(^IBM(361,DA,0),U,11),"Z")
"RTN","IBCEU0",87,0)
 .. I 'IBLOOK D
"RTN","IBCEU0",88,0)
 ... W !,"Seq #: ",IBDAX,"  Bill number: ",$$EXPAND^IBTRE(361,.01,+^IBM(361,DA,0)),?45,"REVIEWED"
"RTN","IBCEU0",89,0)
 .. D NOTECHG^IBCECSA2(DA,1)
"RTN","IBCEU0",90,0)
 .. D UNLOCK(361,DA)
"RTN","IBCEU0",91,0)
 W !!,"LAST SELECTION PROCESSED",!
"RTN","IBCEU0",92,0)
 D PAUSE^VALM1
"RTN","IBCEU0",93,0)
MSTATQ S VALMBCK="R"
"RTN","IBCEU0",94,0)
 I IBREBLD D BLD^IBCECSA1
"RTN","IBCEU0",95,0)
 Q
"RTN","IBCEU0",96,0)
 ;
"RTN","IBCEU0",97,0)
PRPAY(IBIFN,IBMCR) ; Returns total amount of prior payments applied to
"RTN","IBCEU0",98,0)
 ; bill ien IBIFN
"RTN","IBCEU0",99,0)
 ; IBMCR = flag passed in as 1 if MRA total should be included
"RTN","IBCEU0",100,0)
 ;
"RTN","IBCEU0",101,0)
 N IBTOT,IBZ,IBSEQ
"RTN","IBCEU0",102,0)
 S IBSEQ=$$COBN^IBCEF(IBIFN)
"RTN","IBCEU0",103,0)
 I IBSEQ'>1 S IBTOT=0 G PRPAYQ
"RTN","IBCEU0",104,0)
 D F^IBCEF("N-PRIOR PAYMENTS","IBZ",,IBIFN)
"RTN","IBCEU0",105,0)
 S IBTOT=IBZ
"RTN","IBCEU0",106,0)
 I $G(IBMCR),$$MCRONBIL^IBEFUNC(IBIFN)=1 D  ; MCR on bill before curr ins
"RTN","IBCEU0",107,0)
 . N Z,Z0,Z2,Q
"RTN","IBCEU0",108,0)
 . F Z=1:1:IBSEQ-1 I $$WNRBILL^IBEFUNC(IBIFN,Z) D
"RTN","IBCEU0",109,0)
 .. S IBTOT=+$$MCRPAY(IBIFN)
"RTN","IBCEU0",110,0)
PRPAYQ Q IBTOT
"RTN","IBCEU0",111,0)
 ;
"RTN","IBCEU0",112,0)
PRINTUPD(IBTEXT,IBDA) ; If the status message indicates claim was printed
"RTN","IBCEU0",113,0)
 ;    or the claim record in file 399 says it was, update the transmit
"RTN","IBCEU0",114,0)
 ;    message status to closed
"RTN","IBCEU0",115,0)
 ; IBTEXT = the first line text of the status message (optional)
"RTN","IBCEU0",116,0)
 ; IBDA = the ien of the transmission record in file 364
"RTN","IBCEU0",117,0)
 ;
"RTN","IBCEU0",118,0)
 ; FUNCTION returns 1 if message status changed
"RTN","IBCEU0",119,0)
 ;
"RTN","IBCEU0",120,0)
 N IBP,IBP1
"RTN","IBCEU0",121,0)
 S IBP=0,IBP1=$P($G(^DGCR(399,+$G(^IBA(364,+$G(IBDA),0)),"TX")),U,7)
"RTN","IBCEU0",122,0)
 I $G(IBTEXT)["CLAIM RECEIVED, PRINTED AND MAILED BY PRINT CENTER"!IBP1 D
"RTN","IBCEU0",123,0)
 . N Z
"RTN","IBCEU0",124,0)
 . S Z=$E($P($G(^IBA(364,IBDA,0)),U,3),1)
"RTN","IBCEU0",125,0)
 . I "AP"'[Z Q  ; Only change if status is pending or received/accepted
"RTN","IBCEU0",126,0)
 . D UPDTX^IBCECSA2(IBDA,"Z") S IBP=1
"RTN","IBCEU0",127,0)
 Q IBP
"RTN","IBCEU0",128,0)
 ;
"RTN","IBCEU0",129,0)
MCRPAY(IBIFN) ; Calculate MRA total for the bill IBIFN
"RTN","IBCEU0",130,0)
 N IBPAY,Q,Z0
"RTN","IBCEU0",131,0)
 S IBPAY=0
"RTN","IBCEU0",132,0)
 ;include eligible bill for process
"RTN","IBCEU0",133,0)
 ; 432 - added MRA flag to IBCEU1 to not always screen out non-MRA's
"RTN","IBCEU0",134,0)
 S Q=0 F  S Q=$O(^IBM(361.1,"B",IBIFN,Q)) Q:'Q  I $$EOBELIG^IBCEU1(Q,1) S IBPAY=IBPAY+$P($G(^IBM(361.1,Q,1)),U,1)
"RTN","IBCEU0",135,0)
 Q IBPAY
"RTN","IBCEU0",136,0)
 ;
"RTN","IBCEU0",137,0)
PREOBTOT(IBIFN,IBMRANOT) ; Function - Calculates Patient Responsibility Amount
"RTN","IBCEU0",138,0)
 ; Input:  IBIFN - ien of Bill Number (ien of file 399)
"RTN","IBCEU0",139,0)
 ;         IBMRANOT - flag to indicate that this is NOT and MRA
"RTN","IBCEU0",140,0)
 ; Output Function returns: Patient Responsibility Amount for all EOB's for bill
"RTN","IBCEU0",141,0)
 ;
"RTN","IBCEU0",142,0)
 N FRMTYP,IBPTRES
"RTN","IBCEU0",143,0)
 S IBPTRES=0
"RTN","IBCEU0",144,0)
 ; Form Type 2=CMS-1500; 3=UB-04
"RTN","IBCEU0",145,0)
 S FRMTYP=$$FT^IBCEF(IBIFN)
"RTN","IBCEU0",146,0)
 ;
"RTN","IBCEU0",147,0)
 ; For bills w/CMS-1500 Form Type, total up Pt Resp amount from top
"RTN","IBCEU0",148,0)
 ; level of EOB (field 1.02) for All MRA type EOB's on file for that
"RTN","IBCEU0",149,0)
 ; bill (IBIFN)
"RTN","IBCEU0",150,0)
 ;  
"RTN","IBCEU0",151,0)
 I FRMTYP=2 D  Q IBPTRES
"RTN","IBCEU0",152,0)
 . N IBEOB,EOBREC,EOBREC1,IBPRTOT
"RTN","IBCEU0",153,0)
 . S (IBEOB,IBPRTOT,IBPTRES)=0
"RTN","IBCEU0",154,0)
 . F  S IBEOB=$O(^IBM(361.1,"B",IBIFN,IBEOB)) Q:'IBEOB  D  ;
"RTN","IBCEU0",155,0)
 . . S EOBREC=$G(^IBM(361.1,IBEOB,0)),EOBREC1=$G(^(1))
"RTN","IBCEU0",156,0)
 .. ; IB*2.0*432 allow for non-MRA's
"RTN","IBCEU0",157,0)
 . . I $G(IBMRANOT)'=1,$P(EOBREC,U,4)'=1 Q  ;make sure it's an MRA
"RTN","IBCEU0",158,0)
 . . Q:$D(^IBM(361.1,IBEOB,"ERR"))  ;no filing error
"RTN","IBCEU0",159,0)
 . . ; Total up Pt Resp Amounts on all valid MRA's
"RTN","IBCEU0",160,0)
 . . S IBPTRES=IBPTRES+$P(EOBREC1,U,2)
"RTN","IBCEU0",161,0)
 ;
"RTN","IBCEU0",162,0)
 ; For bills w/UB-04 Form Type, loop through all EOB's and sum up amounts
"RTN","IBCEU0",163,0)
 ; on both Line level and on Claim level
"RTN","IBCEU0",164,0)
 N EOBADJ,IBEOB,LNLVL
"RTN","IBCEU0",165,0)
 S IBEOB=0
"RTN","IBCEU0",166,0)
 F  S IBEOB=$O(^IBM(361.1,"B",IBIFN,IBEOB)) Q:'IBEOB  D  ;
"RTN","IBCEU0",167,0)
 . ; IB*2.0*432 allow for non-MRA's
"RTN","IBCEU0",168,0)
 . I $G(IBMRANOT)'=1,$P($G(^IBM(361.1,IBEOB,0)),U,4)'=1 Q    ; must be an MRA
"RTN","IBCEU0",169,0)
 . Q:$D(^IBM(361.1,IBEOB,"ERR"))  ; no filing error
"RTN","IBCEU0",170,0)
 . ; get claim level adjustments
"RTN","IBCEU0",171,0)
 . K EOBADJ M EOBADJ=^IBM(361.1,IBEOB,10)
"RTN","IBCEU0",172,0)
 . S IBPTRES=IBPTRES+$$CALCPR(.EOBADJ)
"RTN","IBCEU0",173,0)
 . ;
"RTN","IBCEU0",174,0)
 . ; get line level adjustments
"RTN","IBCEU0",175,0)
 . S LNLVL=0
"RTN","IBCEU0",176,0)
 . F  S LNLVL=$O(^IBM(361.1,IBEOB,15,LNLVL)) Q:'LNLVL  D  ;
"RTN","IBCEU0",177,0)
 . . K EOBADJ M EOBADJ=^IBM(361.1,IBEOB,15,LNLVL,1)
"RTN","IBCEU0",178,0)
 . . S IBPTRES=IBPTRES+$$CALCPR(.EOBADJ)
"RTN","IBCEU0",179,0)
 Q IBPTRES
"RTN","IBCEU0",180,0)
 ;
"RTN","IBCEU0",181,0)
CALCPR(EOBADJ) ; Function - Calculate Patient Responsibilty Amount
"RTN","IBCEU0",182,0)
 ; For Group Code PR; Ignore the PR-AAA kludge
"RTN","IBCEU0",183,0)
 ; Input - EOBADJ = Array of Group Codes & Reason Codes from either the Claim
"RTN","IBCEU0",184,0)
 ;                 Level (10) or Service Line Level (15) of EOB file (#361.1)
"RTN","IBCEU0",185,0)
 ; Output - Function returns Patient Responsibility Amount
"RTN","IBCEU0",186,0)
 ;
"RTN","IBCEU0",187,0)
 N GRPLVL,RSNCD,RSNAMT,PTRESP
"RTN","IBCEU0",188,0)
 S (GRPLVL,PTRESP)=0
"RTN","IBCEU0",189,0)
 F  S GRPLVL=$O(EOBADJ(GRPLVL)) Q:'GRPLVL  D
"RTN","IBCEU0",190,0)
 . I $P($G(EOBADJ(GRPLVL,0)),U)'="PR" Q  ;grp code must be PR
"RTN","IBCEU0",191,0)
 . S RSNCD=0
"RTN","IBCEU0",192,0)
 . F  S RSNCD=$O(EOBADJ(GRPLVL,1,RSNCD)) Q:'RSNCD  D
"RTN","IBCEU0",193,0)
 . . I $P($G(EOBADJ(GRPLVL,1,RSNCD,0)),U,1)="AAA" Q   ; ignore PR-AAA
"RTN","IBCEU0",194,0)
 . . S RSNAMT=$P($G(EOBADJ(GRPLVL,1,RSNCD,0)),U,2)
"RTN","IBCEU0",195,0)
 . . S PTRESP=PTRESP+RSNAMT
"RTN","IBCEU0",196,0)
 Q PTRESP
"RTN","IBCEU0",197,0)
 ;
"RTN","IBCEU0",198,0)
COBMOD(IBXSAVE,IBXDATA,SEQ) ; output the modifiers from the COB
"RTN","IBCEU0",199,0)
 ; SEQ is which modifier we're extracting (1-4)
"RTN","IBCEU0",200,0)
 ; Build IBXDATA(line#)=Modifier# SEQ
"RTN","IBCEU0",201,0)
 NEW LN,N,Z,MOD,LNSEQ
"RTN","IBCEU0",202,0)
 KILL IBXDATA
"RTN","IBCEU0",203,0)
 I '$G(SEQ) Q
"RTN","IBCEU0",204,0)
 S (LN,LNSEQ)=0
"RTN","IBCEU0",205,0)
 F  S LN=$O(IBXSAVE("LCOB",LN)) Q:'LN  D
"RTN","IBCEU0",206,0)
 . S LNSEQ=LNSEQ+1
"RTN","IBCEU0",207,0)
 . S (N,Z)=0
"RTN","IBCEU0",208,0)
 . F  S Z=$O(IBXSAVE("LCOB",LN,"COBMOD",Z)) Q:'Z  D
"RTN","IBCEU0",209,0)
 .. S N=N+1
"RTN","IBCEU0",210,0)
 .. S MOD(LNSEQ,N)=$P($G(IBXSAVE("LCOB",LN,"COBMOD",Z,0)),U,1)
"RTN","IBCEU0",211,0)
 .. Q
"RTN","IBCEU0",212,0)
 . S MOD=$G(MOD(LNSEQ,SEQ))
"RTN","IBCEU0",213,0)
 . I MOD'="" S IBXDATA(LNSEQ)=MOD
"RTN","IBCEU0",214,0)
 . Q
"RTN","IBCEU0",215,0)
 Q
"RTN","IBCEU0",216,0)
 ;
"RTN","IBCEU1")
0^95^B59089714^B42998590
"RTN","IBCEU1",1,0)
IBCEU1 ;ALB/TMP - EDI UTILITIES FOR EOB PROCESSING ;10-FEB-99
"RTN","IBCEU1",2,0)
 ;;2.0;INTEGRATED BILLING;**137,155,296,349,371,432**;21-MAR-94;Build 192
"RTN","IBCEU1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEU1",4,0)
 ;
"RTN","IBCEU1",5,0)
CCOB1(IBIFN,NODE,SEQ) ; Extract Claim level COB data
"RTN","IBCEU1",6,0)
 ; for a bill IBIFN
"RTN","IBCEU1",7,0)
 ; NODE = the file 361.1 node(s) to be returned, separated by commas
"RTN","IBCEU1",8,0)
 ; SEQ = the specific insurance sequence you want returned.  If not =
"RTN","IBCEU1",9,0)
 ;       1, 2, or 3, all are returned
"RTN","IBCEU1",10,0)
 ; Returns IBXDATA(COB,n,node)  where COB = COB insurance sequence,
"RTN","IBCEU1",11,0)
 ;  n is the entry number in file 361.1 and node is the node requested
"RTN","IBCEU1",12,0)
 ;   = the requested node's data
"RTN","IBCEU1",13,0)
 ;
"RTN","IBCEU1",14,0)
 N IB,IBN,IBBILL,IBS,A,B,C,IBCURR,IBMRAF
"RTN","IBCEU1",15,0)
 ;
"RTN","IBCEU1",16,0)
 K IBXDATA
"RTN","IBCEU1",17,0)
 ;
"RTN","IBCEU1",18,0)
 S:$G(NODE)="" NODE=1
"RTN","IBCEU1",19,0)
 S IB=$P($G(^DGCR(399,IBIFN,"M1")),U,5,7)
"RTN","IBCEU1",20,0)
 S IBCURR=$$COB^IBCEF(IBIFN)
"RTN","IBCEU1",21,0)
 S IBMRAF=$$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEU1",22,0)
 ;
"RTN","IBCEU1",23,0)
 S:"123"'[$G(SEQ) SEQ=""
"RTN","IBCEU1",24,0)
 ;
"RTN","IBCEU1",25,0)
 F B=1:1:3 S IBBILL=$P(IB,U,B) I IBBILL S C=0 F  S C=$O(^IBM(361.1,"B",IBBILL,C)) Q:'C  D
"RTN","IBCEU1",26,0)
 . I '$$EOBELIG(C,IBMRAF,IBCURR) Q      ; eob not eligible for secondary claim
"RTN","IBCEU1",27,0)
 . S IBS=$P($G(^IBM(361.1,C,0)),U,15)   ; insurance sequence
"RTN","IBCEU1",28,0)
 . I $S('$G(SEQ):1,1:SEQ=IBS) D
"RTN","IBCEU1",29,0)
 .. F Z=1:1:$L(NODE,",") D
"RTN","IBCEU1",30,0)
 ... S A=$P(NODE,",",Z)
"RTN","IBCEU1",31,0)
 ... Q:A=""
"RTN","IBCEU1",32,0)
 ... S IBN=$G(^IBM(361.1,C,A))
"RTN","IBCEU1",33,0)
 ... I $TR(IBN,U)'="" S IBXDATA(IBS,C,A)=IBN
"RTN","IBCEU1",34,0)
 ;
"RTN","IBCEU1",35,0)
 Q
"RTN","IBCEU1",36,0)
 ;
"RTN","IBCEU1",37,0)
CCAS1(IBIFN,SEQ) ; Extract all MEDICARE COB claim level adjustment data
"RTN","IBCEU1",38,0)
 ; for a bill IBIFN (subfile 361.11 in file 361.1)
"RTN","IBCEU1",39,0)
 ; SEQ = the specific insurance sequence you want returned.  If not =
"RTN","IBCEU1",40,0)
 ;       1, 2, or 3, all are returned
"RTN","IBCEU1",41,0)
 ; Returns IBXDATA(COB,n)  where COB = COB insurance sequence,
"RTN","IBCEU1",42,0)
 ;       n is the entry number in file 361.1 and
"RTN","IBCEU1",43,0)
 ;       = the 0-node of the subfile entry (361.11)
"RTN","IBCEU1",44,0)
 ;    and IBXDATA(COB,n,m) where m is a sequential # and
"RTN","IBCEU1",45,0)
 ;                         = this level's 0-node
"RTN","IBCEU1",46,0)
 N IB,IBA,IBS,IB0,IB00,IBBILL,B,C,D,E
"RTN","IBCEU1",47,0)
 ;
"RTN","IBCEU1",48,0)
 S IB=$P($G(^DGCR(399,IBIFN,"M1")),U,5,7)
"RTN","IBCEU1",49,0)
 S:"123"'[$G(SEQ) SEQ=""
"RTN","IBCEU1",50,0)
 ;
"RTN","IBCEU1",51,0)
 F B=1:1:3 S IBBILL=$P(IB,U,B) I IBBILL S C=0 F  S C=$O(^IBM(361.1,"B",IBBILL,C)) Q:'C  D
"RTN","IBCEU1",52,0)
 . I '$$EOBELIG(C) Q      ; eob not eligible for secondary claim
"RTN","IBCEU1",53,0)
 . S IBS=$P($G(^IBM(361.1,C,0)),U,15)   ; insurance sequence
"RTN","IBCEU1",54,0)
 . I $S('$G(SEQ):1,1:SEQ=IBS) D
"RTN","IBCEU1",55,0)
 .. S (IBA,D)=0 F  S D=$O(^IBM(361.1,C,10,D)) Q:'D  S IB0=$G(^(D,0)) D
"RTN","IBCEU1",56,0)
 ... S IBXDATA(IBS,D)=IB0
"RTN","IBCEU1",57,0)
 ... S (IBA,E)=0
"RTN","IBCEU1",58,0)
 ... F  S E=$O(^IBM(361.1,C,10,D,1,E)) Q:'E  S IB00=$G(^(E,0)) D
"RTN","IBCEU1",59,0)
 .... S IBA=IBA+1
"RTN","IBCEU1",60,0)
 .... I $TR(IB00,U)'="" S IBXDATA(IBS,D,IBA)=IB00
"RTN","IBCEU1",61,0)
 ;
"RTN","IBCEU1",62,0)
 Q
"RTN","IBCEU1",63,0)
 ;
"RTN","IBCEU1",64,0)
SEQ(A) ; Translate sequence # A into corresponding letter representation
"RTN","IBCEU1",65,0)
 S A=$E("PST",A)
"RTN","IBCEU1",66,0)
 I $S(A'="":"PST"'[A,1:1) S A="P"
"RTN","IBCEU1",67,0)
 Q A
"RTN","IBCEU1",68,0)
 ;
"RTN","IBCEU1",69,0)
EOBTOT(IBIFN,IBCOBN) ; Total all EOB's for a bill's COB sequence
"RTN","IBCEU1",70,0)
 ; Function returns the total of all EOB's for a specific COB seq
"RTN","IBCEU1",71,0)
 ; IBIFN = ien of bill in file 399
"RTN","IBCEU1",72,0)
 ; IBCOBN = the # of the COB sequence you want EOB/MRA total for (1-3)
"RTN","IBCEU1",73,0)
 ;
"RTN","IBCEU1",74,0)
 N Z,Z0,IBTOT
"RTN","IBCEU1",75,0)
 S IBTOT=0
"RTN","IBCEU1",76,0)
 I $O(^IBM(361.1,"ABS",IBIFN,IBCOBN,0)) D
"RTN","IBCEU1",77,0)
 . ; Set up prior payment field here from MRA/EOB(s)
"RTN","IBCEU1",78,0)
 . S (IBTOT,Z)=0
"RTN","IBCEU1",79,0)
 . F  S Z=$O(^IBM(361.1,"ABS",IBIFN,IBCOBN,Z)) Q:'Z  D
"RTN","IBCEU1",80,0)
 .. ; HD64841 IB*2*371 - total up the payer paid amounts
"RTN","IBCEU1",81,0)
 .. S IBTOT=IBTOT+$P($G(^IBM(361.1,Z,1)),U,1)
"RTN","IBCEU1",82,0)
 Q IBTOT
"RTN","IBCEU1",83,0)
 ;
"RTN","IBCEU1",84,0)
 ;
"RTN","IBCEU1",85,0)
LCOBOUT(IBXSAVE,IBXDATA,COL) ; Output the line adjustment reasons COB
"RTN","IBCEU1",86,0)
 ;  line # data for an electronic claim
"RTN","IBCEU1",87,0)
 ; IBXSAVE,IBXDATA = arrays holding formatter information for claim -
"RTN","IBCEU1",88,0)
 ;                   pass by reference
"RTN","IBCEU1",89,0)
 ; COL = the column in the 837 flat file being output for LCAS record
"RTN","IBCEU1",90,0)
 N LINE,COBSEQ,RECCT,GRPCD,SEQ,RCCT,RCPC,DATA,RCREC,SEQLINE K IBXDATA
"RTN","IBCEU1",91,0)
 S (LINE,RECCT)=0
"RTN","IBCEU1",92,0)
 S RCPC=(COL#3) S:'RCPC RCPC=3
"RTN","IBCEU1",93,0)
 S RCREC=$S(COL'<4:COL-1\3,1:0)
"RTN","IBCEU1",94,0)
 ;S RCREC=$S(COL'<4:COL+5\6-1,1:0)
"RTN","IBCEU1",95,0)
 F  S LINE=$O(IBXSAVE("LCOB",LINE)) Q:'LINE  D
"RTN","IBCEU1",96,0)
 . S COBSEQ=0
"RTN","IBCEU1",97,0)
 . F  S COBSEQ=$O(IBXSAVE("LCOB",LINE,"COB",COBSEQ)) Q:'COBSEQ  S SEQLINE=0 F  S SEQLINE=$O(IBXSAVE("LCOB",LINE,"COB",COBSEQ,SEQLINE)) Q:'SEQLINE  S GRPCD="" F  S GRPCD=$O(IBXSAVE("LCOB",LINE,"COB",COBSEQ,SEQLINE,GRPCD)) Q:GRPCD=""  D
"RTN","IBCEU1",98,0)
 .. S RECCT=RECCT+1
"RTN","IBCEU1",99,0)
 .. ;IB*2.0*432/TAZ Added payer sequence in piece 22 of LCAS record (parameter Z)
"RTN","IBCEU1",100,0)
 .. I COL="Z" S IBXDATA(RECCT)=$E("PST",COBSEQ) I RECCT>1 D ID^IBCEF2(RECCT,"LCAS")
"RTN","IBCEU1",101,0)
 .. I COL=2 S IBXDATA(RECCT)=LINE,DATA=LINE D:RECCT>1 ID^IBCEF2(RECCT,"LCAS")
"RTN","IBCEU1",102,0)
 .. I COL=3 S IBXDATA(RECCT)=$TR(GRPCD," ")
"RTN","IBCEU1",103,0)
 .. S (SEQ,RCCT)=0
"RTN","IBCEU1",104,0)
 .. F  S SEQ=$O(IBXSAVE("LCOB",LINE,"COB",COBSEQ,SEQLINE,GRPCD,SEQ)) Q:'SEQ  I $TR($G(IBXSAVE("LCOB",LINE,"COB",COBSEQ,SEQLINE,GRPCD,SEQ)),U)'="" D
"RTN","IBCEU1",105,0)
 ... S RCCT=RCCT+1
"RTN","IBCEU1",106,0)
 ... Q:COL'<4&(RCCT'=RCREC)&(RCCT'>6)
"RTN","IBCEU1",107,0)
 ... S DATA=$S(COL=2:LINE,COL=3:$TR(GRPCD," "),1:$P($G(IBXSAVE("LCOB",LINE,"COB",COBSEQ,SEQLINE,GRPCD,SEQ)),U,RCPC))
"RTN","IBCEU1",108,0)
 ... I COL'<4,RCCT=RCREC S:DATA'="" IBXDATA(RECCT)=DATA Q
"RTN","IBCEU1",109,0)
 ... I RCCT>6 S RCCT=1,RECCT=RECCT+1 D:COL=2 ID^IBCEF2(RECCT,"LCAS") I DATA'="",$S(COL'>3:1,1:RCCT=RCREC) S IBXDATA(RECCT)=DATA
"RTN","IBCEU1",110,0)
 Q
"RTN","IBCEU1",111,0)
 ;
"RTN","IBCEU1",112,0)
CCOBOUT(IBXSAVE,IBXDATA,COL) ; Output the claim adjustment reasons COB
"RTN","IBCEU1",113,0)
 ;  data for an electronic claim
"RTN","IBCEU1",114,0)
 ; IBXSAVE,IBXDATA = arrays holding formatter information for claim -
"RTN","IBCEU1",115,0)
 ;                   pass by reference
"RTN","IBCEU1",116,0)
 ; COL = the column in the 837 flat file being output for CCAS record
"RTN","IBCEU1",117,0)
 N COBSEQ,RECCT,GRPSEQ,SEQ,RCPC,RCCT,RCREC,DATA K IBXDATA
"RTN","IBCEU1",118,0)
 S RECCT=0
"RTN","IBCEU1",119,0)
 S RCPC=(COL#3) S:'RCPC RCPC=3
"RTN","IBCEU1",120,0)
 S RCREC=$S(COL'<4:COL+5\6-1,1:0)
"RTN","IBCEU1",121,0)
 S COBSEQ=0
"RTN","IBCEU1",122,0)
 F  S COBSEQ=$O(IBXSAVE("CCAS",COBSEQ)) Q:'COBSEQ  S GRPSEQ="" F  S GRPSEQ=$O(IBXSAVE("CCAS",COBSEQ,GRPSEQ)) Q:GRPSEQ=""  D
"RTN","IBCEU1",123,0)
 . S RECCT=RECCT+1
"RTN","IBCEU1",124,0)
 . I COL=2 S IBXDATA(RECCT)=COBSEQ D:RECCT>1 ID^IBCEF2(RECCT,"CCAS")
"RTN","IBCEU1",125,0)
 . I COL=3 S IBXDATA(RECCT)=$P($G(IBXSAVE("CCAS",COBSEQ,GRPSEQ)),U)
"RTN","IBCEU1",126,0)
 . S (SEQ,RCCT)=0
"RTN","IBCEU1",127,0)
 . F  S SEQ=$O(IBXSAVE("CCAS",COBSEQ,GRPSEQ,SEQ)) Q:'SEQ  I $TR($G(IBXSAVE("CCAS",COBSEQ,GRPSEQ,SEQ)),U)'="" D
"RTN","IBCEU1",128,0)
 .. S RCCT=RCCT+1
"RTN","IBCEU1",129,0)
 .. Q:COL'<4&(RCCT'=RCREC)&(RCCT'>6)
"RTN","IBCEU1",130,0)
 .. S DATA=$S(COL=2:COBSEQ,COL=3:$P($G(IBXSAVE("CCAS",COBSEQ,GRPSEQ)),U),1:$P($G(IBXSAVE("CCAS",COBSEQ,GRPSEQ,SEQ)),U,RCPC))
"RTN","IBCEU1",131,0)
 .. I COL'<4,RCCT=RCREC S:DATA'="" IBXDATA(RECCT)=DATA Q
"RTN","IBCEU1",132,0)
 .. I RCCT>6 S RCCT=1,RECCT=RECCT+1 D:COL=2 ID^IBCEF2(RECCT,"CCAS") I DATA'="",$S(COL'>3:1,1:RCCT=RCREC) S IBXDATA(RECCT)=DATA
"RTN","IBCEU1",133,0)
 Q
"RTN","IBCEU1",134,0)
 ;
"RTN","IBCEU1",135,0)
COBOUT(IBXSAVE,IBXDATA,CL) ; build LCOB segment data
"RTN","IBCEU1",136,0)
 ; The IBXSAVE array used here is built by INS-2, then LCOB-1.9
"RTN","IBCEU1",137,0)
 ; This is basically the 361.115, but all the piece numbers here in this
"RTN","IBCEU1",138,0)
 ; local array are one higher than the pieces in subfile 361.115.
"RTN","IBCEU1",139,0)
 N Z,M,N,P,PCCL
"RTN","IBCEU1",140,0)
 S (N,Z)=0
"RTN","IBCEU1",141,0)
 F  S Z=$O(IBXSAVE("LCOB",Z)) Q:'Z  D
"RTN","IBCEU1",142,0)
 . S M=0 F  S M=$O(IBXSAVE("LCOB",Z,"COB",M)) Q:'M  D
"RTN","IBCEU1",143,0)
 .. S P=0 F  S P=$O(IBXSAVE("LCOB",Z,"COB",M,P)) Q:'P  D
"RTN","IBCEU1",144,0)
 ... S N=N+1
"RTN","IBCEU1",145,0)
 ... I CL="Z" S IBXDATA(N)=$E("PST",M) Q
"RTN","IBCEU1",146,0)
 ... S PCCL=$P($G(IBXSAVE("LCOB",Z,"COB",M,P)),U,CL)
"RTN","IBCEU1",147,0)
 ... ;IB*2.0*432/TAZ - If the revenue code is blank for the EOB get it from the Primary Level
"RTN","IBCEU1",148,0)
 ... I PCCL="",CL=11 S PCCL=$P($G(IBXSAVE("LCOB",Z)),U)
"RTN","IBCEU1",149,0)
 ... S:PCCL'="" IBXDATA(N)=PCCL
"RTN","IBCEU1",150,0)
 Q
"RTN","IBCEU1",151,0)
 ;
"RTN","IBCEU1",152,0)
 ;IB*2.0*432/TAZ - XCOBOUT is the original code which did not capture all the LCOB records.
"RTN","IBCEU1",153,0)
XCOBOUT(IBXSAVE,IBXDATA,CL) ; build LCOB segment data
"RTN","IBCEU1",154,0)
 ; The IBXSAVE array used here is built by INS-2, then LCOB-1.9
"RTN","IBCEU1",155,0)
 ; This is basically the 361.115, but all the piece numbers here in this
"RTN","IBCEU1",156,0)
 ; local array are one higher than the pieces in subfile 361.115.
"RTN","IBCEU1",157,0)
 N Z,M,N,P,PCCL
"RTN","IBCEU1",158,0)
 S (N,Z,P)=0 F  S Z=$O(IBXSAVE("LCOB",Z)) Q:'Z  D
"RTN","IBCEU1",159,0)
 . S N=N+1
"RTN","IBCEU1",160,0)
 . S M=$O(IBXSAVE("LCOB",Z,"COB",""),-1) Q:'M
"RTN","IBCEU1",161,0)
 . S P=$O(IBXSAVE("LCOB",Z,"COB",M,""),-1) Q:'P
"RTN","IBCEU1",162,0)
 . ;IB*2.0*432/TAZ Added Payer Sequence to piece 18 of the LCOB record
"RTN","IBCEU1",163,0)
 . I CL="Z" S IBXDATA(N)=$E("PST",M) Q
"RTN","IBCEU1",164,0)
 . S PCCL=$P($G(IBXSAVE("LCOB",Z,"COB",M,P)),U,CL)
"RTN","IBCEU1",165,0)
 . S:PCCL'="" IBXDATA(N)=PCCL
"RTN","IBCEU1",166,0)
 . Q
"RTN","IBCEU1",167,0)
 Q
"RTN","IBCEU1",168,0)
 ;
"RTN","IBCEU1",169,0)
COBPYRID(IBXIEN,IBXSAVE,IBXDATA) ; cob insurance company payer id
"RTN","IBCEU1",170,0)
 N CT,N,NUM,Z
"RTN","IBCEU1",171,0)
 K IBXDATA
"RTN","IBCEU1",172,0)
 I '$D(IBXSAVE("LCOB")) G COBPYRX
"RTN","IBCEU1",173,0)
 ;
"RTN","IBCEU1",174,0)
 ;IB*2.0*432/TAZ - Replaced following code with loop to insure that all LCOB records have the Payer ID
"RTN","IBCEU1",175,0)
 ;D ALLPAYID^IBCEF2(IBXIEN,.NUM,1)
"RTN","IBCEU1",176,0)
 ;S NUM=$G(NUM(1))
"RTN","IBCEU1",177,0)
 ;S NUM=$E(NUM_$J("",5),1,5)
"RTN","IBCEU1",178,0)
 ;S (CT,N)=0
"RTN","IBCEU1",179,0)
 ;F  S N=$O(IBXSAVE("LCOB",N)) Q:'N  S CT=CT+1,IBXDATA(CT)=NUM
"RTN","IBCEU1",180,0)
 ;
"RTN","IBCEU1",181,0)
 D ALLPAYID^IBCEF2(IBXIEN,.NUM)
"RTN","IBCEU1",182,0)
 S (CT,N)=0
"RTN","IBCEU1",183,0)
 F  S N=$O(IBXSAVE("LCOB",N)) Q:'N  D
"RTN","IBCEU1",184,0)
 . S Z=0
"RTN","IBCEU1",185,0)
 . F  S Z=$O(IBXSAVE("LCOB",N,"COB",Z)) Q:'Z  D
"RTN","IBCEU1",186,0)
 .. S CT=CT+1,IBXDATA(CT)=$G(NUM(Z))
"RTN","IBCEU1",187,0)
COBPYRX ;
"RTN","IBCEU1",188,0)
 Q
"RTN","IBCEU1",189,0)
 ;
"RTN","IBCEU1",190,0)
EOBELIG(IBEOB,IBMRAF,IBCURR) ; EOB eligibility for secondary claim
"RTN","IBCEU1",191,0)
 ; Function to decide if EOB entry in file 361.1 (ien=IBEOB) is
"RTN","IBCEU1",192,0)
 ; eligible to be included for secondary claim creation process
"RTN","IBCEU1",193,0)
 ; The EOB is not eligible if the review status is not 3, or if there
"RTN","IBCEU1",194,0)
 ; is no insurance sequence indicator, or if the EOB has been DENIED
"RTN","IBCEU1",195,0)
 ; and the patient responsibility for that EOB is $0 and that EOB is
"RTN","IBCEU1",196,0)
 ; not a split EOB.  Split EOB's need to be included (IB*2*371).
"RTN","IBCEU1",197,0)
 ;
"RTN","IBCEU1",198,0)
 ; 432 - added new flag IBMRAF to indicate if we need to check only MRA's or all EOB's
"RTN","IBCEU1",199,0)
 ; IBMRAF = 1 if only need MRA EOB's
"RTN","IBCEU1",200,0)
 ;
"RTN","IBCEU1",201,0)
 NEW ELIG,IBDATA,PTRESP
"RTN","IBCEU1",202,0)
 S ELIG=0
"RTN","IBCEU1",203,0)
 ; IB*2.0*432/TAZ Get current Payer sequence if not passed in.
"RTN","IBCEU1",204,0)
 I '$G(IBCURR) S IBCURR=$$COB^IBCEF(IBIFN)
"RTN","IBCEU1",205,0)
 I '$G(IBEOB) G EOBELIGX
"RTN","IBCEU1",206,0)
 S IBDATA=$G(^IBM(361.1,IBEOB,0))
"RTN","IBCEU1",207,0)
 I $G(IBMRAF)=1,$P(IBDATA,U,4)'=1 G EOBELIGX      ; Only MRA EOB's for now if flag = 1
"RTN","IBCEU1",208,0)
 I $D(^IBM(361.1,IBEOB,"ERR")) G EOBELIGX     ; filing error
"RTN","IBCEU1",209,0)
 I $P(IBDATA,U,16)'=3 G EOBELIGX     ; review status - accepted-complete
"RTN","IBCEU1",210,0)
 I '$P(IBDATA,U,15) G EOBELIGX       ; insurance sequence must exist
"RTN","IBCEU1",211,0)
 ; IB*2.0*432/TAZ Don't send EOB data for current payer
"RTN","IBCEU1",212,0)
 I $P(IBDATA,U,15)=IBCURR G EOBELIGX ; Don't send EOB data for current payer (this is for retransmits)
"RTN","IBCEU1",213,0)
 S PTRESP=$P($G(^IBM(361.1,IBEOB,1)),U,2)     ; Pt Resp Amount for 1500s
"RTN","IBCEU1",214,0)
 I $$FT^IBCEF(+IBDATA)=3 S PTRESP=$$PTRESPI^IBCECOB1(IBEOB)  ; for UBs
"RTN","IBCEU1",215,0)
 I PTRESP'>0,$P(IBDATA,U,13)=2,'$$SPLIT^IBCEMU1(IBEOB) G EOBELIGX     ; Denied & No Pt. Resp. & not a split MRA
"RTN","IBCEU1",216,0)
 ;
"RTN","IBCEU1",217,0)
 S ELIG=1
"RTN","IBCEU1",218,0)
EOBELIGX ;
"RTN","IBCEU1",219,0)
 Q ELIG
"RTN","IBCEU1",220,0)
 ;
"RTN","IBCEU1",221,0)
EOBCNT(IBIFN) ; This function counts up the number of EOBs that are eligible
"RTN","IBCEU1",222,0)
 ; for the secondary claim creation process for a given bill#.
"RTN","IBCEU1",223,0)
 NEW CNT,IEN
"RTN","IBCEU1",224,0)
 S (CNT,IEN)=0
"RTN","IBCEU1",225,0)
 F  S IEN=$O(^IBM(361.1,"B",+$G(IBIFN),IEN)) Q:'IEN  D
"RTN","IBCEU1",226,0)
 . I $$EOBELIG(IEN) S CNT=CNT+1
"RTN","IBCEU1",227,0)
 . Q
"RTN","IBCEU1",228,0)
EOBCNTX ;
"RTN","IBCEU1",229,0)
 Q CNT
"RTN","IBCEU1",230,0)
 ;
"RTN","IBCEU3")
0^87^B75406373^B60382991
"RTN","IBCEU3",1,0)
IBCEU3 ;ALB/TMP - EDI UTILITIES FOR 1500 CLAIM FORM ;12/29/05 9:58am
"RTN","IBCEU3",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,155,323,348,371,400,432**;21-MAR-94;Build 192
"RTN","IBCEU3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEU3",4,0)
 ;
"RTN","IBCEU3",5,0)
BOX19(IBIFN) ; Returns the text that should print in box 19 of the CMS-1500
"RTN","IBCEU3",6,0)
 ;   for bill ien IBIFN
"RTN","IBCEU3",7,0)
 ; Data is derived from a combo of data throughout
"RTN","IBCEU3",8,0)
 ; the system and is limited to 80 characters.  The hierarchy for
"RTN","IBCEU3",9,0)
 ; including data is as follows (until 80 characters have been used):
"RTN","IBCEU3",10,0)
 ;   DATE LAST SEEN and REFERRING PHYSICIAN ID# (physical therapy)
"RTN","IBCEU3",11,0)
 ;                      specialty codes = 025,065,073,067,048
"RTN","IBCEU3",12,0)
 ;   LAST X-RAY DATE (chiropractic) specialty code = 35
"RTN","IBCEU3",13,0)
 ;   HOMEBOUND INDICATOR (independent lab renders an EKG or obtains
"RTN","IBCEU3",14,0)
 ;                        a specimen from a homebound patient)
"RTN","IBCEU3",15,0)
 ;   NO ASSIGNMENT OF BENEFITS (if no assignment of benefits indicated)
"RTN","IBCEU3",16,0)
 ;   Hearing aid testing (if applicable)
"RTN","IBCEU3",17,0)
 ;   ATTENDING PHYSICIAN NOT HOSPICE EMPLOYEE (if applicable)
"RTN","IBCEU3",18,0)
 ;   SPECIAL PROGRAM indicator if Medicare demonstration project for
"RTN","IBCEU3",19,0)
 ;                   lung volume reduction surgery study is set
"RTN","IBCEU3",20,0)
 ;   COMMENTS FOUND IN BOX 19 DATA FIELD FOR THE CLAIM
"RTN","IBCEU3",21,0)
 ;   REMARKS FOUND IN BILL COMMENT FOR THE CLAIM, INCLUDING PROSTHETICS
"RTN","IBCEU3",22,0)
 ;     DETAIL
"RTN","IBCEU3",23,0)
 ;
"RTN","IBCEU3",24,0)
 N IBGO,IBHOSP,IBID,IBLSDT,IBXDATA,IB19,IBHAID,IBXRAY,IBSPEC,Z,Z0,IBSUB,IBPRT,IBREM,IBSPI
"RTN","IBCEU3",25,0)
 S IB19="",IBGO=1
"RTN","IBCEU3",26,0)
 S IBSUB=$S('$G(^TMP("IBTX",$J,IBIFN)):"BOX24",1:"OUTPT")
"RTN","IBCEU3",27,0)
 I $D(IBXSAVE(IBSUB)) N IBXSAVE
"RTN","IBCEU3",28,0)
 S IBPRT=(IBSUB["24")
"RTN","IBCEU3",29,0)
 ;
"RTN","IBCEU3",30,0)
 S IBSPEC=$$BILLSPEC(IBIFN)
"RTN","IBCEU3",31,0)
 G:'IBPRT NPRT
"RTN","IBCEU3",32,0)
 ; Check for chiropractic services
"RTN","IBCEU3",33,0)
 I $P($G(^DGCR(399,IBIFN,"U3")),U,5)'="" S:$P($G(^DGCR(399,IBIFN,"U3")),U,4)'="" IBGO=$$LENOK("Last X-ray: "_$TR($$DATE^IBCF2($P(^DGCR(399,IBIFN,"U3"),U,4))," ","/"),.IB19)
"RTN","IBCEU3",34,0)
 G:'IBGO BOX19Q
"RTN","IBCEU3",35,0)
 ;
"RTN","IBCEU3",36,0)
 I "^25^65^73^67^48^"[(U_IBSPEC_U) D
"RTN","IBCEU3",37,0)
 . K IBXDATA D F^IBCEF("N-DATE LAST SEEN",,,IBIFN)
"RTN","IBCEU3",38,0)
 . I IBXDATA'="" S IBID="",IBLSDT=$$DATE^IBCF2(IBXDATA,0,1) D  I IBLSDT'="" S IBGO=$$LENOK("Date Last Seen:"_IBLSDT_IBID,.IB19)
"RTN","IBCEU3",39,0)
 .. ; Only print if specialty is OT or PT or proc for routine foot care
"RTN","IBCEU3",40,0)
 .. D F^IBCEF("N-REFERRING PROVIDER ID",,,IBIFN) I IBXDATA'="" S IBID=" By:"_IBXDATA
"RTN","IBCEU3",41,0)
 ;
"RTN","IBCEU3",42,0)
 G:'IBGO BOX19Q
"RTN","IBCEU3",43,0)
 K IBXDATA D F^IBCEF("N-HOMEBOUND",,,IBIFN)
"RTN","IBCEU3",44,0)
 I IBXDATA G:'$$LENOK("Homebound",.IB19) BOX19Q
"RTN","IBCEU3",45,0)
 ;
"RTN","IBCEU3",46,0)
 K IBXDATA D F^IBCEF("N-ASSIGN OF BENEFITS INDICATOR",,,IBIFN)
"RTN","IBCEU3",47,0)
 I "Nn0"[IBXDATA&(IBXDATA'="") G:'$$LENOK("Patient refuses to assign benefits",.IB19) BOX19Q
"RTN","IBCEU3",48,0)
 ;
"RTN","IBCEU3",49,0)
 I '$D(IBXSAVE(IBSUB)) D B24^IBCEF3(.IBXSAVE,IBIFN,$S($G(IBNOSHOW)=0:0,1:1))
"RTN","IBCEU3",50,0)
 ;
"RTN","IBCEU3",51,0)
 S (IBHAID,IBHOSP,IBXRAY)=0
"RTN","IBCEU3",52,0)
 ;
"RTN","IBCEU3",53,0)
 S Z=0 F  S Z=$O(IBXSAVE(IBSUB,Z)) Q:'Z  D  G:'IBGO BOX19Q
"RTN","IBCEU3",54,0)
 . I $D(IBXSAVE(IBSUB,Z,"RX")),$P(IBXSAVE(IBSUB,Z,"RX"),U,3)="" S IBGO=$$LENOK("NOC Drug:"_$P(IBXSAVE(IBSUB,Z,"RX"),U,2)_" Units:"_+$P(IBXSAVE(IBSUB,Z,"RX"),U,6),.IB19)
"RTN","IBCEU3",55,0)
 . ;
"RTN","IBCEU3",56,0)
 . Q:'IBGO
"RTN","IBCEU3",57,0)
 . I 'IBHAID,$P(IBXSAVE(IBSUB,Z),U,5)="V5010",$$COBCT^IBCEF(IBIFN)>1 D  Q
"RTN","IBCEU3",58,0)
 .. S IBHAID=1,IBGO=$$LENOK("Testing for hearing aid",.IB19) Q
"RTN","IBCEU3",59,0)
 . ;
"RTN","IBCEU3",60,0)
 . Q:'IBGO
"RTN","IBCEU3",61,0)
 . I 'IBHOSP,$P($G(IBXSAVE(IBSUB,Z,"AUX")),U,3) S IBHOSP=1,IBGO=$$LENOK("Attending physician,not hospice employee",.IB19) Q
"RTN","IBCEU3",62,0)
 G:'IBGO BOX19Q
"RTN","IBCEU3",63,0)
 K IBXDATA D F^IBCEF("N-SPECIAL PROGRAM",,,IBIFN)
"RTN","IBCEU3",64,0)
 I IBXDATA=30 G:'$$LENOK("Medicare demonstration project for lung volume reduction surgery study",.IB19) BOX19Q
"RTN","IBCEU3",65,0)
 ;
"RTN","IBCEU3",66,0)
 ; SPECIAL PROGRAM INDICATOR field code.
"RTN","IBCEU3",67,0)
 S IBSPI=$$GET1^DIQ(399,IBIFN_",",238,"E")
"RTN","IBCEU3",68,0)
 I IBSPI'="" S IBGO=$$LENOK(IBSPI,.IB19)
"RTN","IBCEU3",69,0)
 ;
"RTN","IBCEU3",70,0)
 G:'IBGO BOX19Q
"RTN","IBCEU3",71,0)
NPRT K IBXDATA D F^IBCEF("N-HCFA 1500 BOX 19 RAW DATA",,,IBIFN)
"RTN","IBCEU3",72,0)
 S IBREM=0
"RTN","IBCEU3",73,0)
 I IBXDATA'="" G:'$$LENOK("Remarks:"_IBXDATA,.IB19) BOX19Q S IBREM=1
"RTN","IBCEU3",74,0)
 K IBXDATA D F^IBCEF("N-BILL REMARKS",,,IBIFN)
"RTN","IBCEU3",75,0)
 I IBXDATA'="" G:'$$LENOK($S('IBREM:"Remarks:",1:"")_IBXDATA,.IB19) BOX19Q
"RTN","IBCEU3",76,0)
 ;
"RTN","IBCEU3",77,0)
BOX19Q Q IB19
"RTN","IBCEU3",78,0)
 ;
"RTN","IBCEU3",79,0)
LENOK(IBDATA,IB19) ; Add text IBDATA to box 19 string (IB19 passed by ref)
"RTN","IBCEU3",80,0)
 ; Check length of box 19 data - truncate at 96 (max length)
"RTN","IBCEU3",81,0)
 ; Returns 0 if max length reached or exceeded, otherwise, 1
"RTN","IBCEU3",82,0)
 N OK
"RTN","IBCEU3",83,0)
 S OK=1
"RTN","IBCEU3",84,0)
 S IB19=IB19_$S(IB19'="":" ",1:"")_$G(IBDATA)
"RTN","IBCEU3",85,0)
 I $L(IB19)'<96 S OK=0,IB19=$E(IB19,1,96) G LENOKQ
"RTN","IBCEU3",86,0)
LENOKQ Q OK
"RTN","IBCEU3",87,0)
 ;
"RTN","IBCEU3",88,0)
ASK19(IBIFN) ; Ask to display CMS-1500 box 19 data for current IBIFN
"RTN","IBCEU3",89,0)
 N DIR,DIC,X,Y,DIE,DR,Z
"RTN","IBCEU3",90,0)
 S DIR(0)="YA",DIR("B")="NO",DIR("A")="DISPLAY THE FULL CMS-1500 BOX 19?: "
"RTN","IBCEU3",91,0)
 D ^DIR
"RTN","IBCEU3",92,0)
 I Y=1 S Z=$$BOX19(IBIFN) W !!,?4,"19",?20,$E(Z,1,32) W:$L(Z)>32 !,?4,$E(Z,33,80),!
"RTN","IBCEU3",93,0)
 Q
"RTN","IBCEU3",94,0)
 ;
"RTN","IBCEU3",95,0)
ONLAB(IBIFN) ; Functions returns 1 if the bill IBIFN is outside non-lab
"RTN","IBCEU3",96,0)
 N IBP,IBPUR
"RTN","IBCEU3",97,0)
 S IBP=0
"RTN","IBCEU3",98,0)
 S IBPUR=$P($G(^DGCR(399,IBIFN,"U2")),U,11)
"RTN","IBCEU3",99,0)
 I IBPUR,"13"[IBPUR S IBP=1
"RTN","IBCEU3",100,0)
 Q IBP
"RTN","IBCEU3",101,0)
 ;
"RTN","IBCEU3",102,0)
TEXT24(FLD,IBXSAVE,IBXDATA,IBSUB) ; Format the text line of box 24 by fld
"RTN","IBCEU3",103,0)
 ; INPUT:
"RTN","IBCEU3",104,0)
 ;   FLD = the letter of the field in box 24 (A-J)
"RTN","IBCEU3",105,0)
 ;   IBXSAVE = passed by reference = extracted data for the box 24 lines
"RTN","IBCEU3",106,0)
 ;   IBSUB = the subscript of the IBXSAVE array to use.
"RTN","IBCEU3",107,0)
 ;           If null, use "BOX24"
"RTN","IBCEU3",108,0)
 ; OUTPUT:
"RTN","IBCEU3",109,0)
 ;   IBXDATA = passed by reference, set to the correct part of the
"RTN","IBCEU3",110,0)
 ;             text that will print in the field's positions
"RTN","IBCEU3",111,0)
 ;
"RTN","IBCEU3",112,0)
 ; esg - 8/14/06 - modified for the new cms-1500 form - IB*2*348
"RTN","IBCEU3",113,0)
 ;
"RTN","IBCEU3",114,0)
 N Z,IBLINE,IBVAL,IBS,IBE,IBTEXT,IBAUX,IBDAT,IBZ,IBREN,IBRENQ,IBRENNPI,IBRENSID
"RTN","IBCEU3",115,0)
 K IBXDATA
"RTN","IBCEU3",116,0)
 S (IBLINE,Z)=0 S:$G(IBSUB)="" IBSUB="BOX24"
"RTN","IBCEU3",117,0)
 ;
"RTN","IBCEU3",118,0)
 I FLD="I"!(FLD="J") D   ; extract the Rendering provider data
"RTN","IBCEU3",119,0)
 . I '$G(IBXIEN) Q       ; assume that the claim# exists
"RTN","IBCEU3",120,0)
 . S IBREN=$$CFIDS^IBCEF77(IBXIEN)
"RTN","IBCEU3",121,0)
 . S IBRENQ=$P(IBREN,U,1)    ; qual
"RTN","IBCEU3",122,0)
 . S IBRENSID=$P(IBREN,U,2)  ; id
"RTN","IBCEU3",123,0)
 . S IBRENNPI=$P(IBREN,U,3)  ; npi
"RTN","IBCEU3",124,0)
 . Q
"RTN","IBCEU3",125,0)
 ;
"RTN","IBCEU3",126,0)
 F  S Z=$O(IBXSAVE(IBSUB,Z)) Q:'Z  D
"RTN","IBCEU3",127,0)
 . S IBDAT=$G(IBXSAVE(IBSUB,Z))
"RTN","IBCEU3",128,0)
 . S IBAUX=$G(IBXSAVE(IBSUB,Z,"AUX"))
"RTN","IBCEU3",129,0)
 . S IBTEXT=$G(IBXSAVE(IBSUB,Z,"TEXT"))
"RTN","IBCEU3",130,0)
 . S IBZ=$P(IBAUX,U,9)
"RTN","IBCEU3",131,0)
 . I IBZ="" S IBZ="  "
"RTN","IBCEU3",132,0)
 . S IBTEXT=IBZ_IBTEXT
"RTN","IBCEU3",133,0)
 . ;
"RTN","IBCEU3",134,0)
 . I $S($G(IBAC)=4:$S($D(IBXSAVE(IBSUB,Z,"ARX")):1,1:$D(IBXSAVE(IBSUB,Z,"A"))),$D(IBXSAVE(IBSUB,Z,"RX")):0,1:$G(IBNOSHOW)) S IBTEXT=""
"RTN","IBCEU3",135,0)
 . ;
"RTN","IBCEU3",136,0)
 . I FLD="AF" S IBVAL=$P(IBDAT,U),IBS=1,IBE=9 D   ; From date of service
"RTN","IBCEU3",137,0)
 .. S IBVAL=$E(IBVAL,1,2)_" "_$E(IBVAL,3,4)_" "_$E(IBVAL,7,8)
"RTN","IBCEU3",138,0)
 .. Q
"RTN","IBCEU3",139,0)
 . ;
"RTN","IBCEU3",140,0)
 . I FLD="AT" S IBVAL=$S($P(IBDAT,U,2):$P(IBDAT,U,2),1:$P(IBDAT,U)),IBS=10,IBE=18 D    ; To date of service
"RTN","IBCEU3",141,0)
 .. S IBVAL=$E(IBVAL,1,2)_" "_$E(IBVAL,3,4)_" "_$E(IBVAL,7,8)
"RTN","IBCEU3",142,0)
 .. Q
"RTN","IBCEU3",143,0)
 . ;
"RTN","IBCEU3",144,0)
 . I FLD="B" S IBVAL=$P(IBDAT,U,3),IBS=19,IBE=21   ; place of service
"RTN","IBCEU3",145,0)
 . I FLD="C" S IBVAL=$S($P(IBDAT,U,13)=1:"Y",1:""),IBS=22,IBE=24   ; emergency indicator
"RTN","IBCEU3",146,0)
 . I FLD="D" S IBVAL=$P(IBDAT,U,5),IBS=25,IBE=44 D   ; procedures and modifiers
"RTN","IBCEU3",147,0)
 .. N M S M=$$MODLST^IBEFUNC($P(IBDAT,U,10))       ; modifier list
"RTN","IBCEU3",148,0)
 .. S IBVAL=$$FO^IBCNEUT1(IBVAL,6)_"  "            ; procedure code
"RTN","IBCEU3",149,0)
 .. S IBVAL=IBVAL_$$FO^IBCNEUT1($P(M,",",1),3)     ; mod#1
"RTN","IBCEU3",150,0)
 .. S IBVAL=IBVAL_$$FO^IBCNEUT1($P(M,",",2),3)     ; mod#2
"RTN","IBCEU3",151,0)
 .. S IBVAL=IBVAL_$$FO^IBCNEUT1($P(M,",",3),3)     ; mod#3
"RTN","IBCEU3",152,0)
 .. S IBVAL=IBVAL_$$FO^IBCNEUT1($P(M,",",4),3)     ; mod#4
"RTN","IBCEU3",153,0)
 .. Q
"RTN","IBCEU3",154,0)
 . ;
"RTN","IBCEU3",155,0)
 . I FLD="E" S IBVAL=$TR($P(IBDAT,U,7),","),IBS=45,IBE=48  ; diagnosis pointer
"RTN","IBCEU3",156,0)
 . I FLD="F" S IBVAL=$P(IBDAT,U,8)*$P(IBDAT,U,9),IBS=49,IBE=57 D
"RTN","IBCEU3",157,0)
 .. ; total charges
"RTN","IBCEU3",158,0)
 .. S IBVAL=$$DOL^IBCEF77(IBVAL,8)
"RTN","IBCEU3",159,0)
 .. I $L(IBVAL)>8 S IBVAL=$E(IBVAL,$L(IBVAL)-7,$L(IBVAL))
"RTN","IBCEU3",160,0)
 .. Q
"RTN","IBCEU3",161,0)
 . ;
"RTN","IBCEU3",162,0)
 . I FLD="G" S IBVAL=$S($P(IBDAT,U,12):$P(IBDAT,U,12),1:$P(IBDAT,U,9)),IBS=58,IBE=61 D
"RTN","IBCEU3",163,0)
 .. ; days or units or anesthesia minutes
"RTN","IBCEU3",164,0)
 .. S IBVAL=$J(+IBVAL,4)
"RTN","IBCEU3",165,0)
 .. Q
"RTN","IBCEU3",166,0)
 . ;
"RTN","IBCEU3",167,0)
 . ; columns H,I,J don't have any free text supplemental information
"RTN","IBCEU3",168,0)
 . ;
"RTN","IBCEU3",169,0)
 . I FLD="H" D     ; epsdt family plan
"RTN","IBCEU3",170,0)
 .. S IBVAL=$P(IBAUX,U,7),IBS=0,IBE=0,IBTEXT=""   ; line 1 blank
"RTN","IBCEU3",171,0)
 .. I IBVAL S IBVAL="Y"
"RTN","IBCEU3",172,0)
 .. Q
"RTN","IBCEU3",173,0)
 . I FLD="I" D     ; ID qualifier for rendering provider
"RTN","IBCEU3",174,0)
 .. S IBVAL="",IBS=1,IBE=2   ; line 2 blank
"RTN","IBCEU3",175,0)
 .. S IBTEXT=$G(IBRENQ)      ; qualifier on line 1
"RTN","IBCEU3",176,0)
 .. Q
"RTN","IBCEU3",177,0)
 . I FLD="J" D     ; rendering provider ID and NPI
"RTN","IBCEU3",178,0)
 .. S IBTEXT=$G(IBRENSID),IBS=1,IBE=11   ; secondary ID line 1
"RTN","IBCEU3",179,0)
 .. S IBVAL=$G(IBRENNPI)                 ; NPI# line 2
"RTN","IBCEU3",180,0)
 .. Q
"RTN","IBCEU3",181,0)
 . ;
"RTN","IBCEU3",182,0)
 . S IBLINE=IBLINE+1                      ; top line
"RTN","IBCEU3",183,0)
 . S IBXDATA(IBLINE)=$E(IBTEXT,IBS,IBE)   ; text in shaded area (top)
"RTN","IBCEU3",184,0)
 . S IBLINE=IBLINE+1             ; bottom line
"RTN","IBCEU3",185,0)
 . S IBXDATA(IBLINE)=IBVAL       ; field value in unshaded area (bottom)
"RTN","IBCEU3",186,0)
 . Q
"RTN","IBCEU3",187,0)
 ;
"RTN","IBCEU3",188,0)
 Q
"RTN","IBCEU3",189,0)
 ;
"RTN","IBCEU3",190,0)
LINSPEC(IBIFN) ; Checks the specialities of line and claim level providers
"RTN","IBCEU3",191,0)
 ; called from IBCBB2 to check for Chiro codes & IBCBB9 to check for 99's on Medicare
"RTN","IBCEU3",192,0)
 ; Default = 99 if no valid SPEC code found for line and claim level provider
"RTN","IBCEU3",193,0)
 ; Get rendering for professional, attending for institutional
"RTN","IBCEU3",194,0)
 ; If multiple lines w/ rendering or attending, returns a string of spec codes
"RTN","IBCEU3",195,0)
 N Z,IBSPEC,IBINS,IBDT,IBCP,IBSPC
"RTN","IBCEU3",196,0)
 S IBSPC=""
"RTN","IBCEU3",197,0)
 S IBDT=$P($G(^DGCR(399,+IBIFN,"U")),U,1)  ; use statement from date
"RTN","IBCEU3",198,0)
 S IBINS=($$FT^IBCEF(IBIFN)=3)
"RTN","IBCEU3",199,0)
 D GETPRV^IBCEU(IBIFN,"ALL",.IBPRV)
"RTN","IBCEU3",200,0)
 S Z=$S('IBINS:3,1:4)
"RTN","IBCEU3",201,0)
 ; check claim level
"RTN","IBCEU3",202,0)
 I $G(IBPRV(Z,1))'="" D
"RTN","IBCEU3",203,0)
 . I $P(IBPRV(Z,1),U,3) S IBSPEC=$$SPEC^IBCEU($P($G(IBPRV(Z,1)),U,3),IBDT) I IBSPEC'="" S IBSPC=IBSPC_U_IBSPEC Q
"RTN","IBCEU3",204,0)
 . S Z0=+$O(^DGCR(399,IBIFN,"PRV","B",Z,0))
"RTN","IBCEU3",205,0)
 . I Z0 S IBSPEC=$P($G(^DGCR(399,IBIFN,"PRV",Z0,0)),U,8) S:IBSPEC="" IBSPEC=99 S IBSPC=IBSPC_U_IBSPEC
"RTN","IBCEU3",206,0)
 ; Check line level
"RTN","IBCEU3",207,0)
 S IBCP=0 F  S IBCP=$O(^DGCR(399,IBIFN,"CP",IBCP)) Q:'IBCP  D
"RTN","IBCEU3",208,0)
 .S Z0=+$O(^DGCR(399,IBIFN,"CP",IBCP,"LNPRV","B",Z,0))
"RTN","IBCEU3",209,0)
 .I Z0 S IBSPEC=$P($G(^DGCR(399,IBIFN,"CP",IBCP,"LNPRV",Z0,0)),U,8) S:IBSPEC="" IBSPEC="99" S IBSPC=IBSPC_U_IBSPEC
"RTN","IBCEU3",210,0)
 S:IBSPC="" IBSPC=99
"RTN","IBCEU3",211,0)
 Q IBSPC
"RTN","IBCEU3",212,0)
 ;
"RTN","IBCEU3",213,0)
BILLSPEC(IBIFN,IBPRV) ;  Returns the specialty of the provider on bill IBIFN
"RTN","IBCEU3",214,0)
 ; If IBPRV is supplied, returns the data for that provider, otherwise,
"RTN","IBCEU3",215,0)
 ;  returns the specialty of the 'main/required' provider on the bill.
"RTN","IBCEU3",216,0)
 ;  Default = 99 if no valid code found
"RTN","IBCEU3",217,0)
 ; IBPRV = vp of provider (file 200 or 355.93)
"RTN","IBCEU3",218,0)
 N Z,IBSPEC,IBINS,IBDT
"RTN","IBCEU3",219,0)
 S IBSPEC="",IBPRV=$G(IBPRV)
"RTN","IBCEU3",220,0)
 S IBDT=$P($G(^DGCR(399,+IBIFN,"U")),U,1)  ; use statement from date
"RTN","IBCEU3",221,0)
 ;
"RTN","IBCEU3",222,0)
 I $G(IBPRV) D  G SPECQ
"RTN","IBCEU3",223,0)
 . S IBSPEC=$$SPEC^IBCEU(IBPRV,IBDT)
"RTN","IBCEU3",224,0)
 ;
"RTN","IBCEU3",225,0)
 ;Get rendering for professional, attending for institutional,
"RTN","IBCEU3",226,0)
 S IBINS=($$FT^IBCEF(IBIFN)=3)
"RTN","IBCEU3",227,0)
 D GETPRV^IBCEU(IBIFN,"ALL",.IBPRV)
"RTN","IBCEU3",228,0)
 S Z=$S('IBINS:3,1:4)
"RTN","IBCEU3",229,0)
 I $G(IBPRV(Z,1))'="" D
"RTN","IBCEU3",230,0)
 . I $P(IBPRV(Z,1),U,3) S IBSPEC=$$SPEC^IBCEU($P($G(IBPRV(Z,1)),U,3),IBDT) Q:IBSPEC'=""
"RTN","IBCEU3",231,0)
 . S Z0=+$O(^DGCR(399,IBIFN,"PRV","B",Z,0))
"RTN","IBCEU3",232,0)
 . I Z0,$P($G(^DGCR(399,IBIFN,"PRV",Z0,0)),U,8)'="" S IBSPEC=$P(^(0),U,8)
"RTN","IBCEU3",233,0)
 ;
"RTN","IBCEU3",234,0)
SPECQ I IBSPEC="" S IBSPEC="99"
"RTN","IBCEU3",235,0)
 Q IBSPEC
"RTN","IBCEU3",236,0)
 ;
"RTN","IBCEU3",237,0)
CHAMPVA(IBIFN) ; Returns 1 if the bill IBIFN has a CHAMPVA rate type
"RTN","IBCEU3",238,0)
 Q $E($P($G(^DGCR(399.3,+$P($G(^DGCR(399,IBIFN,0)),U,7),0)),U),1,7)="CHAMPVA"
"RTN","IBCEU3",239,0)
 ;
"RTN","IBCEU3",240,0)
FAC(IBIFN) ; Obsolete function.  Used by old output formatter field and data element N-RENDERING INSTITUTION
"RTN","IBCEU3",241,0)
 Q ""
"RTN","IBCEU3",242,0)
 ;
"RTN","IBCEU3",243,0)
MCR24K(IBIFN,IBPRV) ;Function returns MEDICARE id# for professional (CMS-1500) box 24k for bill IBIFN if appropriate
"RTN","IBCEU3",244,0)
 ;*432/TAZ - Added IBPRV to allow circumvent the call to F^IBCEF("N-SPECIALTY CODE","IBZ",,IBIFN) in MCRSPEC^IBCEU4
"RTN","IBCEU3",245,0)
 Q $S($$FT^IBCEF(IBIFN)=2&$$MCRONBIL^IBEFUNC(IBIFN):"V"_$$MCRSPEC^IBCEU4(IBIFN,1,$G(IBPRV))_$P($$SITE^VASITE,U,3),1:"")
"RTN","IBCEU5")
0^50^B79445173^B87835412
"RTN","IBCEU5",1,0)
IBCEU5 ;ALB/TMP - EDI UTILITIES (continued) FOR CMS-1500 ;13-DEC-99
"RTN","IBCEU5",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,232,348,349,432**;21-MAR-94;Build 192
"RTN","IBCEU5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEU5",4,0)
 Q
"RTN","IBCEU5",5,0)
 ;
"RTN","IBCEU5",6,0)
EXTCR(IBPRV) ; Called by trigger on field .02 of file 399.0222
"RTN","IBCEU5",7,0)
 ; Also called by trigger on field .02 of file 399.0404 (DEM;432).
"RTN","IBCEU5",8,0)
 ; Function returns the first 3 digits of the provider's degree if
"RTN","IBCEU5",9,0)
 ; a VA provider or the credentials in file 355.9 if non-VA provider
"RTN","IBCEU5",10,0)
 ; IBPRV = vp to file 200 or 355.93
"RTN","IBCEU5",11,0)
 Q $E($$CRED^IBCEU(IBPRV),1,3)
"RTN","IBCEU5",12,0)
 ; 
"RTN","IBCEU5",13,0)
FTPRV(IBIFN,NOASK) ; If form type changes from UB-04 to CMS-1500 or vice
"RTN","IBCEU5",14,0)
 ; versa, ask to change provider function to appropriate function for
"RTN","IBCEU5",15,0)
 ; form type (ATTENDING = UB-04, RENDERING = CMS-1500)
"RTN","IBCEU5",16,0)
 ; IBIFN = ien of bill in file 399
"RTN","IBCEU5",17,0)
 ; NOASK (flag) = 1 if change should happen without asking first
"RTN","IBCEU5",18,0)
 N ATT,REN,FT
"RTN","IBCEU5",19,0)
 S FT=$$FT^IBCEF(IBIFN)
"RTN","IBCEU5",20,0)
 S REN=$$CKPROV^IBCEU(IBIFN,3,1)
"RTN","IBCEU5",21,0)
 S ATT=$$CKPROV^IBCEU(IBIFN,4,1)
"RTN","IBCEU5",22,0)
 I $S(FT=2:'REN&ATT,FT=3:'ATT&REN,1:0) D
"RTN","IBCEU5",23,0)
 . I '$G(NOASK) D TXFERPRV(IBIFN,FT) Q
"RTN","IBCEU5",24,0)
 . D PRVCHG(IBIFN,FT)
"RTN","IBCEU5",25,0)
 D CLEANUP(IBIFN,FT)
"RTN","IBCEU5",26,0)
 Q
"RTN","IBCEU5",27,0)
 ;
"RTN","IBCEU5",28,0)
TXFERPRV(IBIFN,FT) ; Ask to change the function of the main provider on
"RTN","IBCEU5",29,0)
 ;  bill IBIFN to the function appropriate to the form type FT
"RTN","IBCEU5",30,0)
 ;  
"RTN","IBCEU5",31,0)
 N DIR,X,Y,Z,DIE,DA,DR,HAVE,NEED,IBZ
"RTN","IBCEU5",32,0)
 ; DEM;432 - Changed the prompt from uppercase to mixed case.
"RTN","IBCEU5",33,0)
 W ! S DIR("A")="  Change the Claim Level "_$S(FT=3:"Rendering",1:"Attending")_" provider's function to "_$S(FT=3:"Attending",1:"Rendering")_"?: "
"RTN","IBCEU5",34,0)
 S DIR(0)="YA",DIR("B")="NO",DIR("?",1)="If you answer YES here, you will make the claim level provider functions",DIR("?")="  consistent with the form type of the bill"
"RTN","IBCEU5",35,0)
 D ^DIR K DIR
"RTN","IBCEU5",36,0)
 I Y'=1 Q
"RTN","IBCEU5",37,0)
 D PRVCHG(IBIFN,FT)
"RTN","IBCEU5",38,0)
 Q
"RTN","IBCEU5",39,0)
 ;
"RTN","IBCEU5",40,0)
PRVCHG(IBIFN,IBFT) ; Change provider type to type consistent with current
"RTN","IBCEU5",41,0)
 ; data on bill
"RTN","IBCEU5",42,0)
 N Z,IBZ,HAVE,NEED,DIE,DA,X,Y
"RTN","IBCEU5",43,0)
 S HAVE=$S(IBFT=3:3,1:4)
"RTN","IBCEU5",44,0)
 S NEED=$S(IBFT=3:4,1:3)
"RTN","IBCEU5",45,0)
 S Z=$O(^DGCR(399,IBIFN,"PRV","B",HAVE,0))
"RTN","IBCEU5",46,0)
 I Z D
"RTN","IBCEU5",47,0)
 . S DA(1)=IBIFN,DA=+Z
"RTN","IBCEU5",48,0)
 . D FDA^DILF(399.0222,.DA,.01,,NEED,"IBZ")
"RTN","IBCEU5",49,0)
 . D FILE^DIE(,"IBZ")
"RTN","IBCEU5",50,0)
 ;I Z S DA(1)=IBIFN,DIE="^DGCR(399,"_DA(1)_",""PRV"",",DA=+Z,DR=".01////"_NEED D FILE^DIE(,DIE
"RTN","IBCEU5",51,0)
 Q
"RTN","IBCEU5",52,0)
 ;
"RTN","IBCEU5",53,0)
CLEANUP(IBIFN,FT)  ; If form type changes remove any extra provider FUNCTIONS.
"RTN","IBCEU5",54,0)
 N X,PRV,CLEAN,DA,DIE
"RTN","IBCEU5",55,0)
 ;
"RTN","IBCEU5",56,0)
 ; (3) If form type changes from CMS-1500 to UB-04, remove any extra provider FUNCTIONS. 
"RTN","IBCEU5",57,0)
 I FT=3 F X=5 D  ; 5-SUPERVISING
"RTN","IBCEU5",58,0)
 .I $D(^DGCR(399,IBIFN,"PRV","B",X)) D
"RTN","IBCEU5",59,0)
 .. S PRV=0 F  S PRV=$O(^DGCR(399,IBIFN,"PRV","B",X,PRV)) Q:+PRV=0  D
"RTN","IBCEU5",60,0)
 ... S DA(1)=IBIFN,DA=PRV D FDA^DILF(399.0222,.DA,.01,,"@","CLEAN")
"RTN","IBCEU5",61,0)
 ;
"RTN","IBCEU5",62,0)
 ; (2) If form type changes from UB-04 to CMS-1500, remove any extra provider FUNCTIONS. 
"RTN","IBCEU5",63,0)
 I FT=2 F X=2,4,9 D  ; 2-OPERATING, 4-ATTENDING, 9-OTHER
"RTN","IBCEU5",64,0)
 .I $D(^DGCR(399,IBIFN,"PRV","B",X)) D
"RTN","IBCEU5",65,0)
 .. S PRV=0 F  S PRV=$O(^DGCR(399,IBIFN,"PRV","B",X,PRV)) Q:+PRV=0  D
"RTN","IBCEU5",66,0)
 ... S DA(1)=IBIFN,DA=PRV D FDA^DILF(399.0222,.DA,.01,,"@","CLEAN")
"RTN","IBCEU5",67,0)
 ;
"RTN","IBCEU5",68,0)
 I $D(CLEAN) D FILE^DIE(,"CLEAN")
"RTN","IBCEU5",69,0)
 Q
"RTN","IBCEU5",70,0)
 ;
"RTN","IBCEU5",71,0)
PRVHELP ; Text for the provider function help
"RTN","IBCEU5",72,0)
 Q:$G(X)'="??"
"RTN","IBCEU5",73,0)
 N IBZ,IBQUIT,IB,IB1,DIR,Z
"RTN","IBCEU5",74,0)
 S IBQUIT=0
"RTN","IBCEU5",75,0)
 S Z=""
"RTN","IBCEU5",76,0)
 I '$D(IOSL)!'$D(IOST) D HOME^%ZIS
"RTN","IBCEU5",77,0)
 Q:IOST'["C-"
"RTN","IBCEU5",78,0)
 D:$G(D0) SPECIFIC(D0)
"RTN","IBCEU5",79,0)
 N DIR,X,Y S DIR(0)="E" D ^DIR K DIR W @IOF
"RTN","IBCEU5",80,0)
 S:$G(D0) Z=$$FT^IBCEF(D0)
"RTN","IBCEU5",81,0)
 S IB=IOSL,IB1=1
"RTN","IBCEU5",82,0)
 F IBZ=1:1 S:$P($T(HLPTXT+IBZ),";;",2)="" IBQUIT=1 Q:IBQUIT  S IB1=1 D
"RTN","IBCEU5",83,0)
 . I $Y>(IB-3) N DIR,X,Y S IB1=0,DIR(0)="E" D ^DIR K DIR S IB=IB+IOSL I Y'=1 S IBQUIT=1 Q
"RTN","IBCEU5",84,0)
 . W !,$P($T(HLPTXT+IBZ),";;",2)
"RTN","IBCEU5",85,0)
 I IB1 D
"RTN","IBCEU5",86,0)
 . N DIR,X,Y S DIR(0)="E" D ^DIR K DIR
"RTN","IBCEU5",87,0)
 W @IOF
"RTN","IBCEU5",88,0)
 Q
"RTN","IBCEU5",89,0)
 ;
"RTN","IBCEU5",90,0)
SPECIFIC(IBIFN) ; Display specific provider requirements for the bill IBIFN
"RTN","IBCEU5",91,0)
 N IBFT,IBPRV,IBR,ONBILL,Z,IBZ
"RTN","IBCEU5",92,0)
 S IBFT=$$FT^IBCEF(IBIFN)
"RTN","IBCEU5",93,0)
 D GETPRV^IBCEU(IBIFN,"ALL",.IBPRV) ;Returns needed providers
"RTN","IBCEU5",94,0)
 W !,"This bill is ",$S(IBFT=3:"UB-04",1:"CMS-1500"),"/",$S($$INPAT^IBCEF(IBIFN):"Inpatient",1:"Outpatient")
"RTN","IBCEU5",95,0)
 W !!,"The valid provider functions for this bill are:"
"RTN","IBCEU5",96,0)
 F IBZ=1:1:5,9 I $$PRVOK^IBCEU(IBZ,IBIFN) D
"RTN","IBCEU5",97,0)
 . S ONBILL=$$CKPROV^IBCEU(IBIFN,IBZ)
"RTN","IBCEU5",98,0)
 . S IBR=$S($G(IBPRV(IBZ,"NOTOPT")):1,$G(IBPRV(IBZ,"SITUATIONAL")):2,1:0)  ; DEM;432 added "SITUATIONAL" check.
"RTN","IBCEU5",99,0)
 . ; ib2.0*432
"RTN","IBCEU5",100,0)
 . ; W !,IBZ,"  ",$$EXPAND^IBTRE(399.0222,.01,IBZ),?18,$S(IBR&'ONBILL:"**",1:""),?20,$S(IBR:"REQUIRED",1:"OPTIONAL"),$S(ONBILL:" - ALREADY ON BILL",1:" - NOT ON BILL")
"RTN","IBCEU5",101,0)
 . W !,IBZ,"  ",$$EXPAND^IBTRE(399.0222,.01,IBZ),?18,$S(IBR&'ONBILL:"**",1:""),?20,$S(IBR=1:"REQUIRED",IBR=2:"SITUATIONAL",1:"OPTIONAL")
"RTN","IBCEU5",102,0)
 W !
"RTN","IBCEU5",103,0)
 Q
"RTN","IBCEU5",104,0)
 ;
"RTN","IBCEU5",105,0)
HLPTXT ; Helptext for provider function
"RTN","IBCEU5",106,0)
 ;; 
"RTN","IBCEU5",107,0)
 ;;PROVIDER FUNCTION requirements:
"RTN","IBCEU5",108,0)
 ;; 
"RTN","IBCEU5",109,0)
 ;;RENDERING: UB-04 Situational or CMS-1500 REQUIRED (CMS-1500)
"RTN","IBCEU5",110,0)
 ;;            This is the provider who performed a service.
"RTN","IBCEU5",111,0)
 ;; 
"RTN","IBCEU5",112,0)
 ;;ATTENDING: UB-04 REQUIRED
"RTN","IBCEU5",113,0)
 ;;           The physician who has primary responsibility
"RTN","IBCEU5",114,0)
 ;;           for the patient's medical care and treatment. 
"RTN","IBCEU5",115,0)
 ;; 
"RTN","IBCEU5",116,0)
 ;;OPERATING: UB-04 SITUATIONAL 
"RTN","IBCEU5",117,0)
 ;;           The provider who performed the principal procedure(s)
"RTN","IBCEU5",118,0)
 ;;           being billed.
"RTN","IBCEU5",119,0)
 ;; UB-04 (inpatient): Situational IF type of bill has first 2
"RTN","IBCEU5",120,0)
 ;;                    digits of 11, and there is a principal
"RTN","IBCEU5",121,0)
 ;;                    procedure that will print in Form
"RTN","IBCEU5",122,0)
 ;;                    Locator 74 of the claim, there must be
"RTN","IBCEU5",123,0)
 ;;                    an Operating or Rendering Provider.
"RTN","IBCEU5",124,0)
 ;; UB-04 (outpatient):REQUIRED IF type of bill has first 2
"RTN","IBCEU5",125,0)
 ;;                    digits of 83, and there is a principal
"RTN","IBCEU5",126,0)
 ;;                    procedure that will print in Form
"RTN","IBCEU5",127,0)
 ;;                    Locator 74 of the claim.
"RTN","IBCEU5",128,0)
 ;; 
"RTN","IBCEU5",129,0)
 ;;REFERRING: UB-04 or CMS-1500 SITUATIONAL
"RTN","IBCEU5",130,0)
 ;;           The provider who referred the patient for the services being billed. 
"RTN","IBCEU5",131,0)
 ;; 
"RTN","IBCEU5",132,0)
 ;;SUPERVISING: CMS-1500 OPTIONAL
"RTN","IBCEU5",133,0)
 ;;           Required when the rendering provider is supervised
"RTN","IBCEU5",134,0)
 ;;           by another provider. Data will not be printed.
"RTN","IBCEU5",135,0)
 ;; 
"RTN","IBCEU5",136,0)
 ;;OTHER OPERATING: UB-04 SITUATIONAL
"RTN","IBCEU5",137,0)
 ;;           Used to report another Operating Physician.  There must
"RTN","IBCEU5",138,0)
 ;;           also be an Operating Physician on the claim.
"RTN","IBCEU5",139,0)
 ;; 
"RTN","IBCEU5",140,0)
 ;;           There are providers who performed specific functions for
"RTN","IBCEU5",141,0)
 ;;           the services on this bill.  These providers are needed to
"RTN","IBCEU5",142,0)
 ;;           enable the V.A. to collect reimbursement when more than
"RTN","IBCEU5",143,0)
 ;;           one provider function is involved in the billable episode
"RTN","IBCEU5",144,0)
 ;;           (like an operating physician or referring provider). 
"RTN","IBCEU5",145,0)
 ;; 
"RTN","IBCEU5",146,0)
 ;;           This data identifies the type of function that was performed
"RTN","IBCEU5",147,0)
 ;;           by a provider.
"RTN","IBCEU5",148,0)
 ;;
"RTN","IBCEU5",149,0)
 ;
"RTN","IBCEU5",150,0)
LINKRX(IBIFN,IBREV) ; Ask for revenue code's RX if not already there
"RTN","IBCEU5",151,0)
 N DIR,X,Y,IBZ,IBRX,Z,Z0,DA
"RTN","IBCEU5",152,0)
 Q:$P($G(^DGCR(399,IBIFN,"RC",IBREV,0)),U,11)!($P($G(^(0)),U,10)'=3)
"RTN","IBCEU5",153,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  I Z'=IBREV S Z0=$G(^(Z,0)) I $P(Z0,U,10)=3,$P(Z0,U,11) S IBRX(+$P(Z0,U,11))=""
"RTN","IBCEU5",154,0)
 S DIR(0)="PAO^IBA(362.4,:AEMQ",DIR("S")="I $P(^(0),U,2)=IBIFN,'$D(IBRX(+Y))"
"RTN","IBCEU5",155,0)
 S DIR("A")="Select Rx for this charge: "
"RTN","IBCEU5",156,0)
 S DIR("?",1)="Enter an Rx# for this revenue code"
"RTN","IBCEU5",157,0)
 S DIR("?")=" The Rx must not already have an associated revenue code"
"RTN","IBCEU5",158,0)
 D ^DIR K DIR
"RTN","IBCEU5",159,0)
 I Y>0 D
"RTN","IBCEU5",160,0)
 . S DA(1)=IBIFN,DA=IBREV,IBZ=""
"RTN","IBCEU5",161,0)
 . D FDA^DILF(399.042,.DA,.11,"R",+Y,"IBZ")
"RTN","IBCEU5",162,0)
 . D FILE^DIE(,"IBZ")
"RTN","IBCEU5",163,0)
 Q
"RTN","IBCEU5",164,0)
 ;
"RTN","IBCEU5",165,0)
LINKCPT(IBIFN,IBREV) ; Ask for revenue code's CPT
"RTN","IBCEU5",166,0)
 N DIR,X,Y,IBZ,IBCP,Z,Z0,Z1,DA,IBRC,IBP
"RTN","IBCEU5",167,0)
 S IBRC=$G(^DGCR(399,IBIFN,"RC",IBREV,0))
"RTN","IBCEU5",168,0)
 Q:$P(IBRC,U,8)!($P(IBRC,U,10)'=4)
"RTN","IBCEU5",169,0)
 S IBP=+$P(IBRC,U,6)
"RTN","IBCEU5",170,0)
 I $P(IBRC,U,11) W !,"PROCEDURE #"_$P(IBRC,U,11)_" HAS BEEN ASSOCIATED WITH THIS MANUAL CHARGE"
"RTN","IBCEU5",171,0)
 I '$P(IBRC,U,11) D  Q:IBRC=""
"RTN","IBCEU5",172,0)
 . S DIR("?",1)="Respond YES if this revenue code charge specifically references the data for"
"RTN","IBCEU5",173,0)
 . S DIR("?",2)="  a particular procedure that was manually entered on the previous screen."
"RTN","IBCEU5",174,0)
 . S DIR("?",3)="  For outpatient UB-04 bills, associating a manual revenue code charge with",DIR("?")="  a procedure is the only way to print a modifier in box 44"
"RTN","IBCEU5",175,0)
 . S DIR(0)="YA",DIR("A")="SHOULD A PROCEDURE ENTRY BE ASSOCIATED WITH THIS CHARGE?: ",DIR("B")=$S(IBP:"YES",1:"NO") W ! D ^DIR K DIR W !
"RTN","IBCEU5",176,0)
 . I Y'=1 S IBRC="" Q
"RTN","IBCEU5",177,0)
 I $P(IBRC,U,11) D
"RTN","IBCEU5",178,0)
 . S DIR("?",1)="Respond YES if you no longer want this revenue code charge to reference a",DIR("?")="  specific manually entered procedure"
"RTN","IBCEU5",179,0)
 . S DIR(0)="YA",DIR("A")="DELETE THE EXISTING PROCEDURE ASSOCIATION?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","IBCEU5",180,0)
 . I Y=1 D UPDPTR(IBIFN,IBREV,"") S $P(IBRC,U,11)=""
"RTN","IBCEU5",181,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) I IBREV'=Z,$P(Z0,U,11) D
"RTN","IBCEU5",182,0)
 . ; Don't allow to link to 'used' proc
"RTN","IBCEU5",183,0)
 . I $P(Z0,U,10)=4 S IBCP($P(Z0,U,11))="" Q
"RTN","IBCEU5",184,0)
 . I $P(Z0,U,10)=3,$P(Z0,U,15) S IBCP($P(Z0,U,15))=""
"RTN","IBCEU5",185,0)
 S DIR(0)="PAO^DGCR(399,"_IBIFN_",""CP"",:AEMQ",DIR("S")="I '$D(IBCP(+Y)),$P(^(0),U)[""CPT"",+^(0)="_+$P($G(^DGCR(399,IBIFN,"RC",IBREV,0)),U,6)
"RTN","IBCEU5",186,0)
 S DIR("A")="SELECT A PROCEDURE ENTRY: "_$S($P(IBRC,U,11):"#"_$P(IBRC,U,11)_" - "_$$EXPAND^IBTRE(399.0304,.01,$P($G(^DGCR(399,IBIFN,"CP",$P(IBRC,U,11),0)),U))_"// ",1:"")
"RTN","IBCEU5",187,0)
 S DIR("?")="Enter a manually-added CPT procedure to associate with this charge"
"RTN","IBCEU5",188,0)
 S DA(1)=IBIFN
"RTN","IBCEU5",189,0)
 D ^DIR K DIR W !
"RTN","IBCEU5",190,0)
 I Y>0 D UPDPTR(IBIFN,IBREV,+Y)
"RTN","IBCEU5",191,0)
 Q
"RTN","IBCEU5",192,0)
 ;
"RTN","IBCEU5",193,0)
UPDPTR(IBIFN,IBREV,Y) ;
"RTN","IBCEU5",194,0)
 N IBZ,DA
"RTN","IBCEU5",195,0)
 S DA(1)=IBIFN,DA=IBREV,IBZ=""
"RTN","IBCEU5",196,0)
 D FDA^DILF(399.042,.DA,.11,"R",$S(Y:+Y,1:""),"IBZ")
"RTN","IBCEU5",197,0)
 D FILE^DIE(,"IBZ")
"RTN","IBCEU5",198,0)
 Q
"RTN","IBCEU5",199,0)
 ;
"RTN","IBCEU5",200,0)
INSFT(IBIFN) ; Returns 1 if form type is UB-04, 0 if CMS-1500
"RTN","IBCEU5",201,0)
 Q ($$FT^IBCEF(IBIFN)=3)
"RTN","IBCEU6")
0^101^B13249318^B10687368
"RTN","IBCEU6",1,0)
IBCEU6 ;ALB/ESG - EDI UTILITIES FOR EOB PROCESSING ;29-JUL-2003
"RTN","IBCEU6",2,0)
 ;;2.0;INTEGRATED BILLING;**155,371,432**;21-MAR-94;Build 192
"RTN","IBCEU6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEU6",4,0)
 Q
"RTN","IBCEU6",5,0)
 ;
"RTN","IBCEU6",6,0)
COBLINE(IBIFN,IBI,IBXDATA,SORT,IBXTRA) ; Extract all COB data for line item
"RTN","IBCEU6",7,0)
 ;  from file 361.1 (EOB), subfile 15 into IBXDATA(IBI,"COB",n)
"RTN","IBCEU6",8,0)
 ;
"RTN","IBCEU6",9,0)
 ; IBIFN = bill entry #
"RTN","IBCEU6",10,0)
 ; IBI = VistA outbound line item #
"RTN","IBCEU6",11,0)
 ; IBXDATA = array returned with COB line item data/pass by reference
"RTN","IBCEU6",12,0)
 ; SORT = flag that determines whether the data should be sorted for
"RTN","IBCEU6",13,0)
 ;        output for the 837 record ('PR' group always there and has
"RTN","IBCEU6",14,0)
 ;        a reason code for deductible first and co-insurance second -
"RTN","IBCEU6",15,0)
 ;        even if they are 0).
"RTN","IBCEU6",16,0)
 ;        1 = sort, 0 = no sort needed
"RTN","IBCEU6",17,0)
 ;
"RTN","IBCEU6",18,0)
 ;   Returns IBXDATA(IBI,"COB",COB,n) with COB data for each line item
"RTN","IBCEU6",19,0)
 ;      found in an accepted EOB for the bill and = the '0' node data of
"RTN","IBCEU6",20,0)
 ;      file 361.115 (LINE LEVEL ADJUSTMENTS)
"RTN","IBCEU6",21,0)
 ;         -- AND --
"RTN","IBCEU6",22,0)
 ;    IBXDATA(IBI,"COB",COB,n,z,p)=
"RTN","IBCEU6",23,0)
 ;           the data on the '0' node for each subordinate entry of file
"RTN","IBCEU6",24,0)
 ;           361.11511 (REASONS) (Only first 3 pieces for 837 output)
"RTN","IBCEU6",25,0)
 ;               z = this is either piece 1 of the 0-node for subfile
"RTN","IBCEU6",26,0)
 ;                   361.1151 (ADJUSTMENTS)
"RTN","IBCEU6",27,0)
 ;                          OR
"RTN","IBCEU6",28,0)
 ;                   for the 837 COB 'sorted' output, this will be ' PR'
"RTN","IBCEU6",29,0)
 ;                    for the forced/extracted entries for deductible
"RTN","IBCEU6",30,0)
 ;                    and co-insurance so they are always output first
"RTN","IBCEU6",31,0)
 ;                    The space needs to be stripped off on output
"RTN","IBCEU6",32,0)
 ;         -- AND --
"RTN","IBCEU6",33,0)
 ; IBXTRA = array returned if passed by reference if line is found
"RTN","IBCEU6",34,0)
 ;          associated with line IBI due to bundling/unbundling
"RTN","IBCEU6",35,0)
 ;          IBXTRA("ALL",x,paid procedure)=COB SEQ ^ seq # corresponding
"RTN","IBCEU6",36,0)
 ;                        to subscript n in IBXDATA(,"COB",COB,n
"RTN","IBCEU6",37,0)
 ;                (x = line #-original proc-service dt)
"RTN","IBCEU6",38,0)
 ;
"RTN","IBCEU6",39,0)
 ;IB*2.0*432/TAZ - Added loop to extract data from all associated EOBs.
"RTN","IBCEU6",40,0)
 ;
"RTN","IBCEU6",41,0)
 N IB,IBBILL,IBCURR
"RTN","IBCEU6",42,0)
 S IBCURR=$$COB^IBCEF(IBIFN)
"RTN","IBCEU6",43,0)
 S IBMRAF=$$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEU6",44,0)
 S IB=$P($G(^DGCR(399,IBIFN,"M1")),U,5,7)
"RTN","IBCEU6",45,0)
 ;
"RTN","IBCEU6",46,0)
 F B=1:1:3 S IBBILL=$P(IB,U,B) I IBBILL D COB1(IBBILL,.IBXDATA,IBMRAF,IBCURR)
"RTN","IBCEU6",47,0)
 Q
"RTN","IBCEU6",48,0)
 ;
"RTN","IBCEU6",49,0)
COB1(IBIFN,IBXDATA,IBMRAF,IBCURR) ; Process the EOB
"RTN","IBCEU6",50,0)
 ;
"RTN","IBCEU6",51,0)
 N A,B,B1,C,D,IBDATA,IB0,IB00,IBA,IBB,IBDED,IBCOI,IBS,IBN,IBDT
"RTN","IBCEU6",52,0)
 ;
"RTN","IBCEU6",53,0)
 ; If multiple EOB's reference this line for the same COB sequence,
"RTN","IBCEU6",54,0)
 ;   extract only the last one marked accepted containing this line item.
"RTN","IBCEU6",55,0)
 ;
"RTN","IBCEU6",56,0)
 S A=0
"RTN","IBCEU6",57,0)
 F  S A=$O(^IBM(361.1,"B",IBIFN,A)) Q:'A  D
"RTN","IBCEU6",58,0)
 . 
"RTN","IBCEU6",59,0)
 . I '$$EOBELIG^IBCEU1(A,IBMRAF,IBCURR) Q   ; eob not eligible for secondary claim
"RTN","IBCEU6",60,0)
 . I '$D(^IBM(361.1,A,15,"AC",IBI)) Q   ; this EOB does not reference VistA line# IBI
"RTN","IBCEU6",61,0)
 . S IBA=0
"RTN","IBCEU6",62,0)
 . S IBDATA=$G(^IBM(361.1,A,0))
"RTN","IBCEU6",63,0)
 . S IBS=$P(IBDATA,U,15)      ; insurance sequence#
"RTN","IBCEU6",64,0)
 . S IBN=+$O(IBXDATA(IBI,"COB",IBS,0))
"RTN","IBCEU6",65,0)
 . I IBN D  Q:IBN  ; check for later EOB
"RTN","IBCEU6",66,0)
 .. I $G(IBDT(IBI,IBS)),IBDT(IBI,IBS)<$P(IBDATA,U,6) K IBDT(IBI,IBS),IBXDATA(IBI,"COB",IBS) S IBN=0
"RTN","IBCEU6",67,0)
 . ;
"RTN","IBCEU6",68,0)
 . S IBDT(IBI,IBS)=$P(IBDATA,U,6)
"RTN","IBCEU6",69,0)
 . S B=0
"RTN","IBCEU6",70,0)
 . F  S B=$O(^IBM(361.1,A,15,"AC",IBI,B)) Q:'B  S IB0=$G(^IBM(361.1,A,15,B,0)),IB0=IB0_U_IBDT(IBI,IBS) D
"RTN","IBCEU6",71,0)
 .. Q:$TR(IB0,U)=""
"RTN","IBCEU6",72,0)
 .. S IBA=IBA+1,IBXDATA(IBI,"COB",IBS,IBA)=IBI_U_IB0
"RTN","IBCEU6",73,0)
 .. ;
"RTN","IBCEU6",74,0)
 .. ; capture the modifiers (361.1152)
"RTN","IBCEU6",75,0)
 .. I $D(^IBM(361.1,A,15,B,2)) M IBXDATA(IBI,"COBMOD")=^IBM(361.1,A,15,B,2)
"RTN","IBCEU6",76,0)
 .. I $P(IB0,U,15)'="" D  ;Line involved in bundling/unbundling
"RTN","IBCEU6",77,0)
 ... N Z0 S Z0=IBI_"-"_$P(IB0,U,15)_"-"_$P(IB0,U,16)
"RTN","IBCEU6",78,0)
 ... S IBXTRA("ALL",Z0,$P(IB0,U,4))=IBS_U_IBA,$P(IBXDATA(IBI,"COB",IBS,IBA),U)=""
"RTN","IBCEU6",79,0)
 .. S C=0,(IBDED(IBA),IBCOI(IBA))="0^0" ;Assume 0 if not found in list
"RTN","IBCEU6",80,0)
 .. F  S C=$O(^IBM(361.1,A,15,B,1,C)) Q:'C  S IB0=$G(^(C,0)) D
"RTN","IBCEU6",81,0)
 ... S D=0
"RTN","IBCEU6",82,0)
 ... F  S D=$O(^IBM(361.1,A,15,B,1,C,1,D)) Q:'D  S IB00=$S($G(SORT):$P($G(^(D,0)),U,1,3),1:$G(^(D,0))) D
"RTN","IBCEU6",83,0)
 .... I $G(SORT),$P(IB0,U)="PR" D  ;Check for deductible or co-ins
"RTN","IBCEU6",84,0)
 ..... I 'IBDED(IBA),$P(IB00,U)=1 S IBDED(IBA)=IB00,IB00="" Q
"RTN","IBCEU6",85,0)
 ..... I 'IBCOI(IBA),$P(IB00,U)=2 S IBCOI(IBA)=IB00,IB00="" Q
"RTN","IBCEU6",86,0)
 .... I $TR(IB00,U)'="" S IBB=$O(IBXDATA(IBI,"COB",IBS,IBA,$P(IB0,U),""),-1)+1,IBXDATA(IBI,"COB",IBS,IBA,$P(IB0,U),IBB)=IB00
"RTN","IBCEU6",87,0)
 .. Q:'$G(SORT)
"RTN","IBCEU6",88,0)
 .. S IBXDATA(IBI,"COB",IBS,IBA," PR",1)=IBDED(IBA)
"RTN","IBCEU6",89,0)
 .. S IBXDATA(IBI,"COB",IBS,IBA," PR",2)=IBCOI(IBA)
"RTN","IBCEU6",90,0)
 Q
"RTN","IBCEU6",91,0)
 ;
"RTN","IBCEU7")
0^56^B28602980^n/a
"RTN","IBCEU7",1,0)
IBCEU7 ;ALB/DEM - EDI UTILITIES ;26-SEP-2010
"RTN","IBCEU7",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCEU7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEU7",4,0)
 Q
"RTN","IBCEU7",5,0)
 ;
"RTN","IBCEU7",6,0)
LNPRVOK(VAL,IBIFN) ; Check bill form & line prov function agree
"RTN","IBCEU7",7,0)
 ; DEM;432 - New routine for Claim Line Provider.
"RTN","IBCEU7",8,0)
 ; VAL = internal value of prov function
"RTN","IBCEU7",9,0)
 ;
"RTN","IBCEU7",10,0)
 ; Allowable line provider functions for UB04 (FORM TYPE = 3)
"RTN","IBCEU7",11,0)
 ; Inpatient and UB04 Outpatient:
"RTN","IBCEU7",12,0)
 ;   - Rendering Provider(3).
"RTN","IBCEU7",13,0)
 ;   - Referring Provider(1).
"RTN","IBCEU7",14,0)
 ;   - Operating Physician(2).
"RTN","IBCEU7",15,0)
 ;   - Other Operating Physician(9).
"RTN","IBCEU7",16,0)
 ;
"RTN","IBCEU7",17,0)
 ; Allowable line provider functions for CMS 1500 (FORM TYPE = 2)
"RTN","IBCEU7",18,0)
 ; Inpatient and CMS 1500 Outpatient:
"RTN","IBCEU7",19,0)
 ;   - Rendering Provider(3).
"RTN","IBCEU7",20,0)
 ;   - Referring Provider(1).
"RTN","IBCEU7",21,0)
 ;   - Supervising Provider(5).
"RTN","IBCEU7",22,0)
 ;
"RTN","IBCEU7",23,0)
 N OK,IBUB
"RTN","IBCEU7",24,0)
 S VAL=$$UP^XLFSTR(VAL)
"RTN","IBCEU7",25,0)
 S OK=$S(VAL'="":1,1:0)
"RTN","IBCEU7",26,0)
 G:'OK!'$G(IBIFN) PRVQ
"RTN","IBCEU7",27,0)
 ;
"RTN","IBCEU7",28,0)
 S IBUB=($$FT^IBCEF(IBIFN)=3) ; 1 if UB-04 ; 0 if CMS-1500
"RTN","IBCEU7",29,0)
 ;
"RTN","IBCEU7",30,0)
 ;
"RTN","IBCEU7",31,0)
 S OK=0
"RTN","IBCEU7",32,0)
 S:(IBUB)&("1239"[VAL) OK=1  ; UB-04
"RTN","IBCEU7",33,0)
 S:('IBUB)&("135"[VAL) OK=1  ; CMS-1500
"RTN","IBCEU7",34,0)
 ;
"RTN","IBCEU7",35,0)
PRVQ Q OK
"RTN","IBCEU7",36,0)
 ;
"RTN","IBCEU7",37,0)
LNPRVHLP ;Helptext for line provider function.
"RTN","IBCEU7",38,0)
 ;
"RTN","IBCEU7",39,0)
 N IBZ,IBQUIT,VALUE,FORMAT
"RTN","IBCEU7",40,0)
 F IBZ=1:1 S:$P($T(HLPTXT+IBZ),";;",2)="END" IBQUIT=1 Q:$G(IBQUIT)  D
"RTN","IBCEU7",41,0)
 . S VALUE=$P($T(HLPTXT+IBZ),";;",2)
"RTN","IBCEU7",42,0)
 . S FORMAT=$S(VALUE="":"!",1:"")
"RTN","IBCEU7",43,0)
 . D EN^DDIOL(VALUE,"",FORMAT)
"RTN","IBCEU7",44,0)
 . Q
"RTN","IBCEU7",45,0)
 Q
"RTN","IBCEU7",46,0)
 ;
"RTN","IBCEU7",47,0)
HLPTXT ; Helptext for line provider function.
"RTN","IBCEU7",48,0)
 ;;
"RTN","IBCEU7",49,0)
 ;;Enter the name of the line level provider who provided this service.
"RTN","IBCEU7",50,0)
 ;;Line level providers are optional and should only be entered if
"RTN","IBCEU7",51,0)
 ;;different from the claim level provider.
"RTN","IBCEU7",52,0)
 ;;
"RTN","IBCEU7",53,0)
 ;;
"RTN","IBCEU7",54,0)
 ;;END
"RTN","IBCEU7",55,0)
 ;
"RTN","IBCEU7",56,0)
HLPTXT2 ; ***Currently, not activated*** - Helptext for line provider function.
"RTN","IBCEU7",57,0)
 ;;
"RTN","IBCEU7",58,0)
 ;;LINE PROVIDER FUNCTION requirements:
"RTN","IBCEU7",59,0)
 ;;
"RTN","IBCEU7",60,0)
 ;;Allowable line provider functions for UB04 Inpatient and Outpatient:
"RTN","IBCEU7",61,0)
 ;;
"RTN","IBCEU7",62,0)
 ;;  - Rendering Provider(3).
"RTN","IBCEU7",63,0)
 ;;  - Referring Provider(1).
"RTN","IBCEU7",64,0)
 ;;  - Operating Physician(2).
"RTN","IBCEU7",65,0)
 ;;  - Other Operating Physician(9).
"RTN","IBCEU7",66,0)
 ;;
"RTN","IBCEU7",67,0)
 ;;Allowable line provider functions for CMS 1500 Inpatient and Outpatient:
"RTN","IBCEU7",68,0)
 ;;
"RTN","IBCEU7",69,0)
 ;;  - Rendering Provider(3).
"RTN","IBCEU7",70,0)
 ;;  - Referring Provider(1).
"RTN","IBCEU7",71,0)
 ;;  - Supervising Provider(5).
"RTN","IBCEU7",72,0)
 ;;
"RTN","IBCEU7",73,0)
 ;;END
"RTN","IBCEU7",74,0)
 Q
"RTN","IBCEU7",75,0)
 ;
"RTN","IBCEU7",76,0)
LNPRVFT(IBFT,IBLNPRV) ; DEM;432 - Field Index "AK" (#301) on FORM TYPE field (399,.19).
"RTN","IBCEU7",77,0)
 ;
"RTN","IBCEU7",78,0)
 ; Description:
"RTN","IBCEU7",79,0)
 ;
"RTN","IBCEU7",80,0)
 ; This function is called by the FORM TYPE (399,.19) "AK" field index.
"RTN","IBCEU7",81,0)
 ; In the case when the FORM TYPE field is changed, then the line
"RTN","IBCEU7",82,0)
 ; provider types are checked to see if any, or all, line providers
"RTN","IBCEU7",83,0)
 ; need to be deleted from the claim.
"RTN","IBCEU7",84,0)
 ;
"RTN","IBCEU7",85,0)
 ; Input:
"RTN","IBCEU7",86,0)
 ;
"RTN","IBCEU7",87,0)
 ; IBFT = FORM TYPE = 2 = (CMS-1500), or FORM TYPE = 3 = (UB-04).
"RTN","IBCEU7",88,0)
 ;        Must be either FORM TYPE 2, or FORM TYPE 3 to continue.
"RTN","IBCEU7",89,0)
 ;        See allowable line provider functions by FORM TYPE below.
"RTN","IBCEU7",90,0)
 ; IBLNPRV = Array passed by reference.
"RTN","IBCEU7",91,0)
 ;
"RTN","IBCEU7",92,0)
 ; Output:
"RTN","IBCEU7",93,0)
 ;
"RTN","IBCEU7",94,0)
 ; OK = 1 = line providers to delete, OK = 0 = no line providers to delete.
"RTN","IBCEU7",95,0)
 ; IBLNPRV Array = If line providers to delete, then array contains
"RTN","IBCEU7",96,0)
 ;                 these line providers - IBLNPRV(399.0404,"IENS",.01)="@"
"RTN","IBCEU7",97,0)
 ;
"RTN","IBCEU7",98,0)
 ; Allowable line provider functions for UB04 (FORM TYPE = 3)
"RTN","IBCEU7",99,0)
 ; Inpatient and UB04 Outpatient:
"RTN","IBCEU7",100,0)
 ;   - Rendering Provider(VAL=3).
"RTN","IBCEU7",101,0)
 ;   - Referring Provider(VAL=1).
"RTN","IBCEU7",102,0)
 ;   - Operating Physician(VAL=2).
"RTN","IBCEU7",103,0)
 ;   - Other Operating Physician(VAL=9).
"RTN","IBCEU7",104,0)
 ;
"RTN","IBCEU7",105,0)
 ; Allowable line provider functions for CMS 1500 (FORM TYPE = 2)
"RTN","IBCEU7",106,0)
 ; Inpatient and CMS 1500 Outpatient:
"RTN","IBCEU7",107,0)
 ;   - Rendering Provider(VAL=3).
"RTN","IBCEU7",108,0)
 ;   - Referring Provider(VAL=1).
"RTN","IBCEU7",109,0)
 ;   - Supervising Provider(VAL=5).
"RTN","IBCEU7",110,0)
 ;
"RTN","IBCEU7",111,0)
 Q:'$G(IBIFN) 0  ; QUIT 0 if no claim number.
"RTN","IBCEU7",112,0)
 Q:'$G(IBFT) 0  ; QUIT 0 if no FORM TYPE.
"RTN","IBCEU7",113,0)
 Q:(IBFT'=2)&(IBFT'=3) 0  ; QUIT 0 - Must be CMS-1500 (2) or UB-04 (3) FORM TYPE.
"RTN","IBCEU7",114,0)
 ;
"RTN","IBCEU7",115,0)
 N IBPRVFUN,OK
"RTN","IBCEU7",116,0)
 S:IBFT=3 IBPRVFUN("VAL",IBFT)="1239"  ; Allowable LINE PROVIDER FUNCTIONs for UB-04.
"RTN","IBCEU7",117,0)
 S:IBFT=2 IBPRVFUN("VAL",IBFT)="135"  ; Allowable LINE PROVIDER FUNCTIONs for CMS-1500.
"RTN","IBCEU7",118,0)
 ;
"RTN","IBCEU7",119,0)
 S OK=0  ; Initialize OK=0.
"RTN","IBCEU7",120,0)
 ;
"RTN","IBCEU7",121,0)
 N IBPROCP,IBLPIEN,IBLNPROV,DA
"RTN","IBCEU7",122,0)
 S IBPROCP=0 F  S IBPROCP=$O(^DGCR(399,IBIFN,"CP",IBPROCP)) Q:'IBPROCP  D  ; Loop on PROCEDURES multiple.
"RTN","IBCEU7",123,0)
 . Q:'($D(^DGCR(399,IBIFN,"CP",IBPROCP,0))#10)  ; No zero node for procedure.
"RTN","IBCEU7",124,0)
 . S IBPRVFUN=0 F  S IBPRVFUN=$O(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV","B",IBPRVFUN)) Q:'IBPRVFUN  D:IBPRVFUN("VAL",IBFT)'[IBPRVFUN
"RTN","IBCEU7",125,0)
 . . S IBLPIEN=0 F  S IBLPIEN=$O(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV","B",IBPRVFUN,IBLPIEN)) Q:'IBLPIEN  D
"RTN","IBCEU7",126,0)
 . . . Q:'($D(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",IBLPIEN,0))#10)  ; No zero node for line level provider.
"RTN","IBCEU7",127,0)
 . . . S IBLNPROV=$P(^DGCR(399,IBIFN,"CP",IBPROCP,"LNPRV",IBLPIEN,0),U,2)
"RTN","IBCEU7",128,0)
 . . . Q:'IBLNPROV  ; No line provider for this line provider function.
"RTN","IBCEU7",129,0)
 . . . S OK=1,IBLNPRV(399.0404,IBLPIEN_","_IBPROCP_","_IBIFN_",",.01)="@"  ; We have at leaset one line provider to delete from claim.
"RTN","IBCEU7",130,0)
 . . . Q
"RTN","IBCEU7",131,0)
 . . Q
"RTN","IBCEU7",132,0)
 . Q
"RTN","IBCEU7",133,0)
 ;
"RTN","IBCEU7",134,0)
 Q OK
"RTN","IBCEU7",135,0)
 ;
"RTN","IBCEU7",136,0)
REMOVE(IBIFN,IBFT) ; This will be used to remove all line level providers and all line level attachments from inpatient UB claims
"RTN","IBCEU7",137,0)
 ;
"RTN","IBCEU7",138,0)
 ; Input IBIFN - Claim Number
"RTN","IBCEU7",139,0)
 ;
"RTN","IBCEU7",140,0)
 Q:IBFT'=3   ; Only worried about UBs
"RTN","IBCEU7",141,0)
 N IBINPAT
"RTN","IBCEU7",142,0)
 S IBINPAT=$$INPAT^IBCEF(IBIFN) Q:'IBINPAT   ; Quit if it's not an inpatient
"RTN","IBCEU7",143,0)
 ;
"RTN","IBCEU7",144,0)
 ; If we got here, we have an inpatient UB
"RTN","IBCEU7",145,0)
 ; In which case, we should not have any line level providers or line level attachment control numbers
"RTN","IBCEU7",146,0)
 ; If we do, then let's remove them
"RTN","IBCEU7",147,0)
 ;
"RTN","IBCEU7",148,0)
 N CPIEN,LNPRVIEN,FDA,ERR
"RTN","IBCEU7",149,0)
 S CPIEN=0 F  S CPIEN=$O(^DGCR(399,IBIFN,"CP",CPIEN)) Q:'+CPIEN  D
"RTN","IBCEU7",150,0)
 . ;
"RTN","IBCEU7",151,0)
 . ; Remove the Line level attachments
"RTN","IBCEU7",152,0)
 . S FDA(399.0304,CPIEN_","_IBIFN_",",70)="@"
"RTN","IBCEU7",153,0)
 . S FDA(399.0304,CPIEN_","_IBIFN_",",71)="@"
"RTN","IBCEU7",154,0)
 . S FDA(399.0304,CPIEN_","_IBIFN_",",72)="@"
"RTN","IBCEU7",155,0)
 . D FILE^DIE("E","FDA")
"RTN","IBCEU7",156,0)
 . ;
"RTN","IBCEU7",157,0)
 . K FDA
"RTN","IBCEU7",158,0)
 . S LNPRVIEN=0 F  S LNPRVIEN=$O(^DGCR(399,IBIFN,"CP",CPIEN,"LNPRV",LNPRVIEN)) Q:'+LNPRVIEN  D
"RTN","IBCEU7",159,0)
 .. ;
"RTN","IBCEU7",160,0)
 .. ;Remove the line level providers
"RTN","IBCEU7",161,0)
 .. S FDA(399.0404,LNPRVIEN_","_CPIEN_","_IBIFN_",",.01)="@"
"RTN","IBCEU7",162,0)
 . I $D(FDA) D FILE^DIE("E","FDA")
"RTN","IBCEU7",163,0)
 Q
"RTN","IBCF23")
0^67^B40963193^B39555399
"RTN","IBCF23",1,0)
IBCF23 ;ALB/ARH - HCFA 1500 19-90 DATA (block 24, procs and charges) ;12-JUN-93
"RTN","IBCF23",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,106,122,51,152,137,402,432**;21-MAR-94;Build 192
"RTN","IBCF23",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCF23",4,0)
 ;
"RTN","IBCF23",5,0)
 ;requires IBIFN,IB(0),IB("U"),IB("U1"), returns # of line items in IBFLD(24)
"RTN","IBCF23",6,0)
 ;rev code array: IBRC("proc^division^basc flag^bedsection^rev code^unit chrg^Rx seq #")=units
"RTN","IBCF23",7,0)
 ;proc array:    IBCP(initial print ord)=proc date^proc^division^basc flag^dx^pos^tos^modifier^unit chrg^purch chrg amt^anesthesia mins^emerg indicator
"RTN","IBCF23",8,0)
 ;                    IBCP(initial print order,seq #)=auxillary data
"RTN","IBCF23",9,0)
 ;proc array:    IBSS("proc^division^basc flag^dx^pos^tos^modifier^unit chrg^Rx seq #")=lowest inital print order
"RTN","IBCF23",10,0)
 ;print order array:  IBPO(final print ord,emerg indicator,initial print order)=""
"RTN","IBCF23",11,0)
 ;print array:        IBFLD(24,I)=begin dt^end dt^pos^tos^proc^dx^unit chrg^units^modifier pointer ien(s) separated by commas^purch chrg amt^anesthesia mins^emerg indicator
"RTN","IBCF23",12,0)
 ;                    IBFLD(24,I,"AUX")=[auxillary data]
"RTN","IBCF23",13,0)
 ;                                 = "AUX" node of proc entry
"RTN","IBCF23",14,0)
 ;                    IBFLD(24,I,"RX")= soft link to file 362.4 or null
"RTN","IBCF23",15,0)
 ;                         if service is Rx, but no soft link
"RTN","IBCF23",16,0)
 ;                                   
"RTN","IBCF23",17,0)
 ;charge item link:   IBLINK(CPT IFN in multiple,RCIFN) = proc^division^basc flag^bedsection^rev code^unit chrg^rx seq #
"RTN","IBCF23",18,0)
 ;
"RTN","IBCF23",19,0)
 ; dx's used in arrays are ref #s
"RTN","IBCF23",20,0)
 ;
"RTN","IBCF23",21,0)
RVC ; charges array
"RTN","IBCF23",22,0)
 D RVCE(,IBIFN)
"RTN","IBCF23",23,0)
 Q
"RTN","IBCF23",24,0)
 ;
"RTN","IBCF23",25,0)
RVCE(IBXIEN,IBIFN) ;Entry for EDI formatter call (IBXIEN will be defined)
"RTN","IBCF23",26,0)
 ; IBIFN required
"RTN","IBCF23",27,0)
 N IBRC,IBCP,IBSS,IBSSO,IBSS1,IBPO,IBLINK,IBLINK1,IBLINKRX,IBK,IBAUXLN
"RTN","IBCF23",28,0)
 N IBI,IBJ,IB11,IBLN,IBPDT,IBCHARG,IBMOD,IBPC,IBRX,IBRXF,IBPO2A,IBAUX
"RTN","IBCF23",29,0)
 ;
"RTN","IBCF23",30,0)
 S IBRX=0
"RTN","IBCF23",31,0)
 S IBI=0 F  S IBI=$O(^DGCR(399,IBIFN,"RC",IBI)) Q:'IBI  S IBLN=^(IBI,0) D
"RTN","IBCF23",32,0)
 . S IBSS="",IBPC=0 F IBJ=6,7,0,5,1,2,14 S IBPC=IBPC+1 S:IBJ $P(IBSS,U,IBPC,IBPC+1)=($P(IBLN,U,IBJ)_U)
"RTN","IBCF23",33,0)
 . I $P(IBSS,U,2)="" S $P(IBSS,U,2)=$P(^DGCR(399,IBIFN,0),U,22)
"RTN","IBCF23",34,0)
 . I +IBSS S $P(IBSS,U)=$P(IBSS,U)_";ICPT("
"RTN","IBCF23",35,0)
 . S $P(IBSS,U,3)=$S($D(^DGCR(399,"ASC1",+$P(IBLN,U,6),IBIFN,IBI)):1,1:"")
"RTN","IBCF23",36,0)
 . I +$P(IBLN,U,10)=3 D  Q  ; Rx
"RTN","IBCF23",37,0)
 .. I '$P(IBLN,U,15) S IBRX=IBRX+1,$P(IBSS,U,8)=(100+IBRX)
"RTN","IBCF23",38,0)
 .. I $P(IBLN,U,15) S $P(IBSS,U,8)=$P(IBLN,U,15)
"RTN","IBCF23",39,0)
 .. S IBRC(IBSS,"RX")=$P(IBLN,U,11)_U_IBI_U_$P(IBLN,U,15)
"RTN","IBCF23",40,0)
 .. S IBRC(IBSS)=$G(IBRC(IBSS))+1
"RTN","IBCF23",41,0)
 . ;
"RTN","IBCF23",42,0)
 . S IBRC(IBSS)=$G(IBRC(IBSS))+$P(IBLN,U,3) ; total units for similar RC
"RTN","IBCF23",43,0)
 . I "4"[+$P(IBLN,U,10),$P(IBLN,U,11) D  ; Soft-link proc with the rev cd
"RTN","IBCF23",44,0)
 .. S IBLINK(+$P(IBLN,U,11),IBI)=IBSS
"RTN","IBCF23",45,0)
 .. S $P(IBLINK(+$P(IBLN,U,11),IBI),U,7)=$P(IBLN,U,14)
"RTN","IBCF23",46,0)
 . I $P(IBLN,U,10) D
"RTN","IBCF23",47,0)
 .. S IBLINK1(IBSS,IBI)=$P(IBLN,U,10)_U_+$P(IBLN,U,11)
"RTN","IBCF23",48,0)
 . S IBRC(IBSS,"LNK")=IBI
"RTN","IBCF23",49,0)
 ;
"RTN","IBCF23",50,0)
 S IBSSO="" F  S IBSSO=$O(IBRC(IBSSO)) Q:IBSSO=""  I $D(IBRC(IBSSO,"RX")) D
"RTN","IBCF23",51,0)
 . S IBSS=IBSSO,IBI=$P(IBRC(IBSSO,"RX"),U,2),IB11=$P(IBRC(IBSSO,"RX"),U,3)
"RTN","IBCF23",52,0)
 . S IBRC(IBSSO)=1,IBLINKRX($S($P(IBSSO,U)>0:$P(IBSSO,U),$P($G(^DGCR(399,IBIFN,"CP",+IB11,0)),U)'="":$P(^(0),U),1:0),+IB11,+IBRC(IBSSO,"RX"))=IBSSO K IBRC(IBSSO,"RX")
"RTN","IBCF23",53,0)
 ;
"RTN","IBCF23",54,0)
 D PRC^IBCF23A ; Extract procedures
"RTN","IBCF23",55,0)
PO ; print order array w/chrgs
"RTN","IBCF23",56,0)
 ; combine multiple entries of same proc onto one line item via print order
"RTN","IBCF23",57,0)
 ;if both have print orders defined then they should not be combined onto one line item
"RTN","IBCF23",58,0)
 ;"proc^division^basc^dx^pos^tos^modifier(s)^unit chrg^purchased chg" must all be the same as well as the emergency indicator and all 'aux flds'
"RTN","IBCF23",59,0)
 N IBP,Z,IBPO11
"RTN","IBCF23",60,0)
 S IBPO="" F  S IBPO=$O(IBCP(IBPO)) Q:'IBPO  S IBCP=IBCP(IBPO),IBSS=$P(IBCP,U,2,9),IBSS1="*"_$G(IBCP(IBPO,"AUX")),IBAUX=0 D
"RTN","IBCF23",61,0)
 . I $D(IBSS(IBSS)),'$D(IBCP(IBPO,"RX")),IBPO>1000 D  Q  ; combine lines
"RTN","IBCF23",62,0)
 .. I 'IBAUX S IBAUX=$$AUXOK^IBCF23A(.IBSS,IBSS1)
"RTN","IBCF23",63,0)
 .. S IBPO1=$S(IBAUX:IBSS(IBSS,IBAUX),1:IBPO)
"RTN","IBCF23",64,0)
 .. I 'IBAUX S Z=+$O(IBSS(IBSS,"A"),-1)+1,IBSS(IBSS,Z)=IBPO
"RTN","IBCF23",65,0)
 .. I IBPO>1000!(IBPO1>1000) S IBPO(IBPO1,+$P(IBCP,U,12),IBPO)="" D
"RTN","IBCF23",66,0)
 ... I $O(IBCP(IBPO,"L",0)) S Z=$O(IBCP(IBPO,"L",0)),IBPO(IBPO1,+$P(IBCP,U,12),IBPO,"L",Z)=IBCP(IBPO,"L",Z) K IBCP(IBPO,"L",Z)
"RTN","IBCF23",67,0)
 . S IBAUX=+$O(IBSS(IBSS,"A"),-1)+1,IBSS(IBSS,"AUX-X",IBAUX)=IBSS1
"RTN","IBCF23",68,0)
 . S IBSS(IBSS,IBAUX)=+IBPO,IBPO(+IBPO,+$P(IBCP,U,12),IBPO)=""
"RTN","IBCF23",69,0)
 . S Z=0 F  S Z=$O(IBCP(IBPO,Z)) Q:'Z  S IBPO(+IBPO,+$P(IBCP,U,12),IBPO,Z)=""
"RTN","IBCF23",70,0)
 . I $O(IBCP(IBPO,"L",0)) S Z=$O(IBCP(IBPO,"L",0)),IBPO(+IBPO,+$P(IBCP,U,12),IBPO,"L",Z)=IBCP(IBPO,"L",Z) K IBCP(IBPO,"L",Z)
"RTN","IBCF23",71,0)
 . S IBSS(IBSS,IBAUX,"AUX")=IBSS1,IBPO(+IBPO,+$P(IBCP,U,12),IBPO,"AUX")=$E(IBSS1,2,$L(IBSS1))
"RTN","IBCF23",72,0)
 . I $D(IBCP(IBPO,"RX")) S IBPO(+IBPO,+$P(IBCP,U,12),IBPO,"RX")=IBCP(IBPO,"RX"),IBSS(IBSS,IBAUX,"RX")=IBCP(IBPO)
"RTN","IBCF23",73,0)
 ;
"RTN","IBCF23",74,0)
 ; Find any remaining rev codes w/units that ref existing procedures
"RTN","IBCF23",75,0)
 S IBP(0)=0
"RTN","IBCF23",76,0)
 F IBP=3,2 Q:$G(IBP(0))  S IBRV="" F  S IBRV=$O(IBRC(IBRV)) Q:IBRV=""  I IBRV,IBRC(IBRV) D
"RTN","IBCF23",77,0)
 . S IBSS1=$O(IBSS($P(IBRV,U,1,IBP))) Q:$P(IBRV,U,1,IBP)'=$P(IBSS1,U,1,IBP)
"RTN","IBCF23",78,0)
 . S IBP(0)=1,Z=0
"RTN","IBCF23",79,0)
 . F  S Z=$O(IBSS(IBSS1,Z)) Q:'Z  I $G(IBSS(IBSS1,Z)) D  Q
"RTN","IBCF23",80,0)
 .. I $D(IBCP(IBSS(IBSS1,Z))),$P(IBCP(IBSS(IBSS1,Z)),U,9)=$P(IBSS1,U,8) D
"RTN","IBCF23",81,0)
 ... N Q,Q0
"RTN","IBCF23",82,0)
 ... S Q=$O(IBCP(""),-1)+1,Q0=$P(IBCP(IBSS(IBSS1,Z)),U,12)
"RTN","IBCF23",83,0)
 ... M IBPO(Q,$P(IBCP(IBSS(IBSS1,Z)),U,12),Q)=IBPO(IBSS(IBSS1,Z),$P(IBCP(IBSS(IBSS1,Z)),U,12),IBSS(IBSS1,Z)),IBCP(Q)=IBCP(IBSS(IBSS1,Z))
"RTN","IBCF23",84,0)
 ... S $P(IBCP(Q),U,9)=$P(IBRV,U,6)
"RTN","IBCF23",85,0)
 ... F Z0=1:1:(IBRC(IBRV)-1) S IBPO(Q,Q0,Q+(Z0*.01))=IBPO(Q,Q0,Q) I Z0=99,(IBRC(IBRV)'=100) S IBPO(Q,Q0,Q_".991")=(IBRC(IBRV)-1)_"^99" Q  ; Only put first 99 in array
"RTN","IBCF23",86,0)
 ... S IBRC(IBRV)=0
"RTN","IBCF23",87,0)
 ;
"RTN","IBCF23",88,0)
PRTARR ;print proc array
"RTN","IBCF23",89,0)
 S IBREV="",IBPO1="",IBI=0 F  S IBPO1=$O(IBPO(IBPO1)) Q:IBPO1=""  D
"RTN","IBCF23",90,0)
 . K IBRXF
"RTN","IBCF23",91,0)
 . S IBEMG="" F  S IBEMG=$O(IBPO(IBPO1,IBEMG)) Q:IBEMG=""!("01"'[IBEMG)  S IBPO2="" D
"RTN","IBCF23",92,0)
 .. S IBDT1=99999999,IBDT2="",(IBMIN,IBUNIT)=0,(IBCHARG,IBAUX)=""
"RTN","IBCF23",93,0)
 .. F  S IBPO2=$O(IBPO(IBPO1,IBEMG,IBPO2)) Q:IBPO2=""  D
"RTN","IBCF23",94,0)
 ... I IBPO2#1=.991 D  Q:IBPO2#1=.991
"RTN","IBCF23",95,0)
 .... N Z
"RTN","IBCF23",96,0)
 .... S Z=$G(IBPO(IBPO1,IBEMG,IBPO2)) Q:'Z
"RTN","IBCF23",97,0)
 .... I ($P(Z,U,2)+1)>Z Q
"RTN","IBCF23",98,0)
 .... S $P(IBPO(IBPO1,IBEMG,IBPO2),U,2)=($P(Z,U,2)+1),IBPO2=(IBPO2\1)_".99"
"RTN","IBCF23",99,0)
 ... S Z=0 F  S Z=$O(IBPO(IBPO1,IBEMG,IBPO2,Z)) Q:'Z  S IBUNIT=IBUNIT+1
"RTN","IBCF23",100,0)
 ... I $D(IBCP(IBPO1)) S IBPO11=IBPO1
"RTN","IBCF23",101,0)
 ... S IBPO2A=$S($D(IBCP(IBPO2\1)):IBPO2\1,'$D(IBCP(IBPO2)):IBPO11,1:IBPO2)
"RTN","IBCF23",102,0)
 ... S IBCHARG=$P(IBCP(IBPO2A),U,9),IBPCHG=$P(IBCP(IBPO2A),U,10)
"RTN","IBCF23",103,0)
 ... I IBCHARG<10000,IBCHARG*(IBUNIT+1)'<10000 D  Q  ;$9,999 limit per line
"RTN","IBCF23",104,0)
 .... N Z S Z=$O(IBPO(IBPO1\1+1),-1),Z=Z+$S(IBPO1+.001'=Z:.001,1:0) M IBPO(Z,IBEMG,IBPO2)=IBPO(IBPO1,IBEMG,IBPO2) K IBPO(IBPO1,IBEMG,IBPO2)
"RTN","IBCF23",105,0)
 ... S IBUNIT=IBUNIT+1,IBSS=IBCP(IBPO2A),IBMIN=IBMIN+$P(IBSS,U,11)
"RTN","IBCF23",106,0)
 ... S IBSS=$G(IBSS)_U_$G(IBCP(IBPO2A,"LNK"))
"RTN","IBCF23",107,0)
 ... S Z=$O(IBPO(IBPO1,IBEMG,IBPO2,"L",0)) I Z D
"RTN","IBCF23",108,0)
 .... S Z0=0
"RTN","IBCF23",109,0)
 .... F Z=Z:1 Q:'$O(IBPO(IBPO1,IBEMG,IBPO2,"L",0))!(Z0=IBUNIT)  I $D(IBPO(IBPO1,IBEMG,IBPO2,"L",Z))  S IBSS("L",Z)=IBPO(IBPO1,IBEMG,IBPO2,"L",Z),Z0=Z0+1 K IBPO(IBPO1,IBEMG,IBPO2,"L",Z)
"RTN","IBCF23",110,0)
 ... S:IBDT1>+IBSS IBDT1=+IBSS S:IBDT2<+IBSS IBDT2=+IBSS
"RTN","IBCF23",111,0)
 .. S IBAUX=$G(IBCP(IBPO1,"AUX")) S:$D(IBCP(IBPO1,"RX")) IBRXF=IBCP(IBPO1,"RX")
"RTN","IBCF23",112,0)
 .. I IBUNIT D B24^IBCF23A
"RTN","IBCF23",113,0)
 .. K IBRXF
"RTN","IBCF23",114,0)
 ;
"RTN","IBCF23",115,0)
 ;print any chrgs not associated with a proc (ie. not enough procs or proc not in "CP" level)
"RTN","IBCF23",116,0)
 S IBRV="" F  S IBRV=$O(IBRC(IBRV)) Q:IBRV=""  I +IBRC(IBRV) D  D B24^IBCF23A K IBRXF
"RTN","IBCF23",117,0)
 . S IBUNIT=+IBRC(IBRV),IBCHARG=$P(IBRV,U,6),IBDT1=+IB("U"),IBDT2=$P(IB("U"),U,2),IBREV=$P(IBRV,U,5),IBEMG=0,IBAUX=""
"RTN","IBCF23",118,0)
 . S IBSS="^"_$S(+IBRV:$P(IBRV,U),1:$P($G(^DGCR(399.1,+$P(IBRV,U,4),0)),U))
"RTN","IBCF23",119,0)
 . S IBSS=$G(IBSS)_U_$$RC2CP^IBCEF22(IBIFN,+$G(IBRC(IBRV,"LNK")))
"RTN","IBCF23",120,0)
 . S Z=$O(IBLINK1(IBRV,0)) I Z D
"RTN","IBCF23",121,0)
 .. S Z0=0
"RTN","IBCF23",122,0)
 .. F Z=Z:1 Q:'$O(IBLINK1(IBRV,0))!(Z0=IBUNIT)  I $D(IBLINK1(IBRV,Z)) S IBSS("L",Z)=IBLINK1(IBRV,Z),Z0=Z0+1 K IBLINK1(IBRV,Z)
"RTN","IBCF23",123,0)
 ;
"RTN","IBCF23",124,0)
OFFSET ;
"RTN","IBCF23",125,0)
 S IBFLD(24)=IBI ;line item count
"RTN","IBCF23",126,0)
 K IBRC,IBCP,IBSS,IBPO,IBPO1,IBPO2,IBLN,IBRV,IBRV1,IBPDT,IBDT1,IBDT2,IBCHARG,IBMIN,IBUNIT,IBREV,IBLINK,IBLINK1,IBEMG,IBPCHG,Z
"RTN","IBCF23",127,0)
 Q
"RTN","IBCF23",128,0)
 ;
"RTN","IBCF23",129,0)
DATE(X) ; Fm dt in X ==> YYYYMMDD
"RTN","IBCF23",130,0)
 Q $$DT^IBCEFG1(X,,"D8")
"RTN","IBCF23",131,0)
 ;
"RTN","IBCF23",132,0)
B24 ; Moved to IBCF23A for space
"RTN","IBCF23",133,0)
 D B24^IBCF23A
"RTN","IBCF23",134,0)
 Q
"RTN","IBCF23",135,0)
 ;
"RTN","IBCF23A")
0^68^B19444201^B18929865
"RTN","IBCF23A",1,0)
IBCF23A ;ALB/ARH - HCFA 1500 19-90 DATA - Split from IBCF23 ;12-JUN-93
"RTN","IBCF23A",2,0)
 ;;2.0;INTEGRATED BILLING;**51,432**;21-MAR-94;Build 192
"RTN","IBCF23A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCF23A",4,0)
 ;
"RTN","IBCF23A",5,0)
B24 ; set individual entries in print array, external format
"RTN","IBCF23A",6,0)
 ; IBAUX = additional data for EDI output
"RTN","IBCF23A",7,0)
 ; IBRXF = array of RX procedures
"RTN","IBCF23A",8,0)
 N IBX,Z,IBD1,IBD2
"RTN","IBCF23A",9,0)
 S IBI=IBI+1,IBPROC=$P(IBSS,U,2),IBD1=$$DATE^IBCF23(IBDT1),IBD2=$S(IBDT1'=IBDT2:$$DATE^IBCF23(IBDT2),1:"")
"RTN","IBCF23A",10,0)
 I '$D(IBXIEN) S IBD1=$E(IBD1,5,8)_$E(IBD1,1,4),IBD2=$E(IBD2,5,8)_$E(IBD2,1,4)
"RTN","IBCF23A",11,0)
 S IBFLD(24,IBI)=IBD1_U_IBD2_U_$P($G(^IBE(353.1,+$P(IBSS,U,6),0)),U)_U_$P($G(^IBE(353.2,+$P(IBSS,U,7),0)),U)
"RTN","IBCF23A",12,0)
 I +IBPROC D
"RTN","IBCF23A",13,0)
 . S IBFLD(24,IBI)=IBFLD(24,IBI)_U_$P($$PRCD^IBCEF1(IBPROC,1),U,2) S:$P(IBPROC,";",2)'["ICPT" IBFLD(24,IBI_"X")=""
"RTN","IBCF23A",14,0)
 I 'IBPROC S IBFLD(24,IBI)=IBFLD(24,IBI)_U_$S('$D(IBXIEN):IBPROC,1:+IBREV),IBFLD(24,IBI_"A")=$P($G(^DGCR(399.2,+IBREV,0)),U,2)
"RTN","IBCF23A",15,0)
 I $D(IBRXF),IBCHARG="" S IBFLD(24,IBI_"A")=$P($G(^DGCR(399.2,+IBREV,0)),U,2)
"RTN","IBCF23A",16,0)
 S IBFLD(24,IBI)=IBFLD(24,IBI)_U_$P(IBSS,U,5)_U_IBCHARG_U_IBUNIT_U_$P(IBSS,U,8)_U_$G(IBPCHG)_U_$G(IBMIN)_U_$G(IBEMG)
"RTN","IBCF23A",17,0)
 I $D(IBSS("L")) S Z=0 F  S Z=$O(IBSS("L",Z)) Q:'Z  S IBFLD(24,IBI,$P(IBSS("L",Z),U),$P(IBSS("L",Z),U,2))=$G(IBFLD(24,IBI,$P(IBSS("L",Z),U),$P(IBSS("L",Z),U,2)))+1
"RTN","IBCF23A",18,0)
 S:$TR($G(IBAUX),U)'="" IBFLD(24,IBI,"AUX")=$G(IBAUX)
"RTN","IBCF23A",19,0)
 S:$D(IBRXF) IBFLD(24,IBI,"RX")=IBRXF
"RTN","IBCF23A",20,0)
 K IBPROC,IBSS("L")
"RTN","IBCF23A",21,0)
 S IBFLD(24,IBI)=IBFLD(24,IBI)_U_$P(IBSS,U,$L(IBSS,U))
"RTN","IBCF23A",22,0)
 Q
"RTN","IBCF23A",23,0)
 ;
"RTN","IBCF23A",24,0)
AUXOK(IBSS,IBSS1) ; Check all other flds are the same to combine procs
"RTN","IBCF23A",25,0)
 ; IBSS = subscript of IBCP to check for dups to combine - pass by ref
"RTN","IBCF23A",26,0)
 ; IBSS(IBSS,"AUX-X",n) = all the previously extracted line items for the
"RTN","IBCF23A",27,0)
 ;  same set of basic data, but having different "AUX" data
"RTN","IBCF23A",28,0)
 ; IBSS1 = the "AUX" data of the current IBCP entry
"RTN","IBCF23A",29,0)
 ;
"RTN","IBCF23A",30,0)
 ; Returns entry # in IBSS array if match found, or 0 if no match
"RTN","IBCF23A",31,0)
 ; Set the IBSS "AUX-X" node for no match
"RTN","IBCF23A",32,0)
 N Z,Z0
"RTN","IBCF23A",33,0)
 S Z=0 F  S Z=$O(IBSS(IBSS,"AUX-X",Z)) Q:'Z  I IBSS1=IBSS(IBSS,"AUX-X",Z) Q
"RTN","IBCF23A",34,0)
 I 'Z S Z0=+$O(IBSS(IBSS,"AUX-X",""),-1)+1,IBSS(IBSS,"AUX-X",Z0)=IBSS1
"RTN","IBCF23A",35,0)
 Q +Z
"RTN","IBCF23A",36,0)
 ;
"RTN","IBCF23A",37,0)
PRC ; Extract procedure data for HCFA 1500
"RTN","IBCF23A",38,0)
 ; IBRC(IBSS) = #rev codes with same billing criteria (IBSS)
"RTN","IBCF23A",39,0)
 ; IBLINK('CP' ien,'RC' ien) = IBSS including modifiers,rx seq in pc 7,8
"RTN","IBCF23A",40,0)
 ; IBLINK1(IBSS, 'RC' ien) =  auto (1)^ 'CP' ien (soft link)
"RTN","IBCF23A",41,0)
 ;
"RTN","IBCF23A",42,0)
 ; proc array w/chrg
"RTN","IBCF23A",43,0)
 N IBPR,IBP
"RTN","IBCF23A",44,0)
 S IBI=0 F  S IBI=$O(^DGCR(399,IBIFN,"CP",IBI)) Q:'IBI  S IBLN=^(IBI,0),IBAUXLN=$G(^("AUX")) D
"RTN","IBCF23A",45,0)
 . N Z,Z0,Z1,Q1
"RTN","IBCF23A",46,0)
 . S IBPDT=$P(IBLN,U,2)
"RTN","IBCF23A",47,0)
 . S IBSS=$$IBSS(IBI,.IBDXI,IBLN)
"RTN","IBCF23A",48,0)
 . S IBPO=$S($P(IBLN,U,4):+$P(IBLN,U,4),1:IBI+1000) ;Set print order
"RTN","IBCF23A",49,0)
 . S IBCP(IBPO)=IBPDT_"^"_IBSS,IBCP(IBPO,"AUX")=IBAUXLN
"RTN","IBCF23A",50,0)
 . S IBCP(IBPO,"LNK")=IBI
"RTN","IBCF23A",51,0)
 . ; Rx
"RTN","IBCF23A",52,0)
 . N IBZ,IBITEM
"RTN","IBCF23A",53,0)
 . S IBZ=$S($P(IBSS,U):$P(IBSS,U),1:"")
"RTN","IBCF23A",54,0)
 . I IBZ'="",$D(IBLINKRX(IBZ,IBI)) D  Q:IBCHARG'=""
"RTN","IBCF23A",55,0)
 .. S IBPO1=IBPO
"RTN","IBCF23A",56,0)
 .. S IBITEM=+$O(IBLINKRX(IBZ,IBI,0)),IBRV=$G(IBLINKRX(IBZ,IBI,IBITEM))
"RTN","IBCF23A",57,0)
 .. Q:$S(IBRV="":1,1:'$G(IBRC(IBRV)))
"RTN","IBCF23A",58,0)
 .. S IBCHARG=$P(IBRV,U,6),IBRC(IBRV)=IBRC(IBRV)-1
"RTN","IBCF23A",59,0)
 .. S $P(IBCP(IBPO1),U,9)=IBCHARG,IBCP(IBPO1,"RX")=IBITEM K IBLINKRX(IBZ,IBI,IBITEM)
"RTN","IBCF23A",60,0)
 . ; find chrgs directly linked to proc
"RTN","IBCF23A",61,0)
 . S IBK=0 F  S IBK=$O(IBLINK(IBI,IBK)) Q:'IBK  S IBRV1=IBLINK(IBI,IBK),IBRV=$P(IBRV1,U,1,6) I +IBRC(IBRV1) D
"RTN","IBCF23A",62,0)
 .. S IBCHARG=$P(IBRV,U,6),IBRC(IBRV1)=IBRC(IBRV1)-1
"RTN","IBCF23A",63,0)
 .. I IBCHARG'="" S $P(IBSS,U,8)=IBCHARG,IBCP(IBPO)=IBPDT_"^"_IBSS,IBPO=IBPO+.1
"RTN","IBCF23A",64,0)
 ;
"RTN","IBCF23A",65,0)
 ; add chrgs associated with a proc (not a direct link)
"RTN","IBCF23A",66,0)
 ; find chrg associated with proc, if any (match proc,div,+/-basc)
"RTN","IBCF23A",67,0)
 K IBP(0)
"RTN","IBCF23A",68,0)
 F IBP=3,2 Q:$D(IBP(0))  S IBPO="" F  S IBPO=$O(IBCP(IBPO)) Q:'IBPO  I $P(IBCP(IBPO),U,9)="" D
"RTN","IBCF23A",69,0)
 . S IBSS=$P(IBCP(IBPO),U,2,9)
"RTN","IBCF23A",70,0)
 . S IBCHARG="",(IBRV,IBSS)=$P(IBSS,U,1,IBP) F  S IBRV=$O(IBRC(IBRV)) Q:$P(IBRV,U,1,IBP)'=IBSS  S IBP(0)=0 I +IBRC(IBRV) D  Q
"RTN","IBCF23A",71,0)
 .. S IBCHARG=$P(IBRV,U,6),IBRC(IBRV)=IBRC(IBRV)-1
"RTN","IBCF23A",72,0)
 .. I IBRC(IBRV) S Z=0 F  S Z=$O(IBCP(IBPO,Z)) Q:'Z  S IBRC(IBRV)=IBRC(IBRV)-1
"RTN","IBCF23A",73,0)
 . S $P(IBCP(IBPO),U,9)=IBCHARG
"RTN","IBCF23A",74,0)
 . I IBCHARG'="" S Z=$O(IBLINK1(IBRV,0)) I Z S IBCP(IBPO,"L",Z)=IBLINK1(IBRV,Z) K IBLINK1(IBRV,Z)
"RTN","IBCF23A",75,0)
 ;
"RTN","IBCF23A",76,0)
 ; add chrgs not associated with a proc to first proc with no chrg
"RTN","IBCF23A",77,0)
 ; Aggggh!!! TP
"RTN","IBCF23A",78,0)
 S IBPO="" F  S IBPO=$O(IBCP(IBPO)) Q:'IBPO  I $P(IBCP(IBPO),U,9)="" D
"RTN","IBCF23A",79,0)
 . S IBCHARG="",IBRV="^" F  S IBRV=$O(IBRC(IBRV)) Q:IBRV=""!+IBRV  I +IBRC(IBRV) D  Q
"RTN","IBCF23A",80,0)
 .. S IBCHARG=$P(IBRV,U,6),IBRC(IBRV)=IBRC(IBRV)-1
"RTN","IBCF23A",81,0)
 .. S Z=$O(IBLINK1(IBRV,0)) I Z S IBCP(IBPO,"L",Z)=IBLINK1(IBRV,Z) K IBLINK1(IBRV,Z)
"RTN","IBCF23A",82,0)
 . S $P(IBCP(IBPO),U,9)=IBCHARG
"RTN","IBCF23A",83,0)
 ;
"RTN","IBCF23A",84,0)
 Q
"RTN","IBCF23A",85,0)
IBSS(IBI,IBDXI,IBLN) ; Creates index sequence for procedure
"RTN","IBCF23A",86,0)
 N IBPC,IBJ,IBSS
"RTN","IBCF23A",87,0)
 S IBPC=0
"RTN","IBCF23A",88,0)
 F IBJ=1,6,5,0,9,10 S IBPC=IBPC+1 S:IBJ $P(IBSS,U,IBPC,IBPC+1)=($P(IBLN,U,IBJ)_U)
"RTN","IBCF23A",89,0)
 S $P(IBSS,U,7)=($$GETMOD^IBEFUNC(IBIFN,IBI)_U) ;Modifiers
"RTN","IBCF23A",90,0)
 F IBJ=11:1:14 I $P(IBLN,U,IBJ) S $P(IBSS,U,4)=$P(IBSS,U,4)_$S(IBJ>11:",",1:"")_$G(IBDXI(+$P(IBLN,U,IBJ))) ; dx
"RTN","IBCF23A",91,0)
 S $P(IBSS,U,10)=$P(IBLN,U,16),$P(IBSS,U,9)=$P(IBLN,U,19),$P(IBSS,U,11)=+$P(IBLN,U,17)
"RTN","IBCF23A",92,0)
 Q IBSS
"RTN","IBCF23A",93,0)
 ;
"RTN","IBCNSBL2")
0^78^B33173974^B28176933
"RTN","IBCNSBL2",1,0)
IBCNSBL2 ;ALB/CPM - 'BILL NEXT PAYOR' BULLETIN ;08-AUG-96
"RTN","IBCNSBL2",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,153,240,432**;21-MAR-94;Build 192
"RTN","IBCNSBL2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCNSBL2",4,0)
 ;
"RTN","IBCNSBL2",5,0)
EOB(IBIFN,IBORIG,IBPYMT,IBTXT) ; determine if there may be another payer for this claim that should be billed
"RTN","IBCNSBL2",6,0)
 ; in general the EOB of the current bill is required to be sent with the next TP bill in the series
"RTN","IBCNSBL2",7,0)
 ; if there is another Third Party Payer then returns true, if any other payer (including patient) then set array
"RTN","IBCNSBL2",8,0)
 ;
"RTN","IBCNSBL2",9,0)
 ;   Input:    IBIFN  --  Pointer to AR (file #430), or Claim (file #399)
"RTN","IBCNSBL2",10,0)
 ;            IBORIG  --  Original amount of the claim
"RTN","IBCNSBL2",11,0)
 ;            IBPYMT  --  Total Amount paid on the claim
"RTN","IBCNSBL2",12,0)
 ;
"RTN","IBCNSBL2",13,0)
 ;  Output:    IBTXT  -- Array, pass by reference, if needed
"RTN","IBCNSBL2",14,0)
 ;                       If a another payer (third party or patient) for the claim can be found, 
"RTN","IBCNSBL2",15,0)
 ;                       this array will contain the text that explains who the next payer is
"RTN","IBCNSBL2",16,0)
 ;
"RTN","IBCNSBL2",17,0)
 ; Returns:     0     -- no need to forward EOB (no next Third Party payer found or payment=>amount due)
"RTN","IBCNSBL2",18,0)
 ;           'true^Next payer' --  if the EOB of the bill needs to be forwarded for inclusion in the next bill,
"RTN","IBCNSBL2",19,0)
 ;                                 generally there must be another payer for the bill that is
"RTN","IBCNSBL2",20,0)
 ;                                 third party, non-patient, and payment was not the amount due
"RTN","IBCNSBL2",21,0)
 ;
"RTN","IBCNSBL2",22,0)
 N X,IB,IBPOL,IBCS,IBARCAT,IBSEC,IBRETURN,IBSEQ,IBINS S IBRETURN=0
"RTN","IBCNSBL2",23,0)
 I '$G(IBIFN) G EOBQ
"RTN","IBCNSBL2",24,0)
 I $G(^PRCA(430,IBIFN,0))="" G EOBQ
"RTN","IBCNSBL2",25,0)
 I '$G(IBORIG) G EOBQ
"RTN","IBCNSBL2",26,0)
 I $G(IBPYMT)="" G EOBQ
"RTN","IBCNSBL2",27,0)
 ;
"RTN","IBCNSBL2",28,0)
 S IB=$G(^DGCR(399,IBIFN,0)) I IB="" G EOBQ
"RTN","IBCNSBL2",29,0)
 ;
"RTN","IBCNSBL2",30,0)
 ; - quit if there is no remaining balance on the bill
"RTN","IBCNSBL2",31,0)
 I IBPYMT'<IBORIG G EOBQ
"RTN","IBCNSBL2",32,0)
 ;
"RTN","IBCNSBL2",33,0)
 S IBARCAT=$P($G(^DGCR(399.3,+$P(IB,"^",7),0)),"^",6) I 'IBARCAT G EOBQ
"RTN","IBCNSBL2",34,0)
 ;
"RTN","IBCNSBL2",35,0)
 ; - for Champva third party claims, bill the Champva Center next
"RTN","IBCNSBL2",36,0)
 I IBARCAT=28 D  G EOBQ
"RTN","IBCNSBL2",37,0)
 . S IBTXT(14)="You should prepare a claim to be sent to the CHAMPVA Center.",IBRETURN="1^CHAMPVA Center"
"RTN","IBCNSBL2",38,0)
 ;
"RTN","IBCNSBL2",39,0)
 ; - for Tricare third party claims, next bill Tricare or the patient
"RTN","IBCNSBL2",40,0)
 I IBARCAT=32 D  G EOBQ
"RTN","IBCNSBL2",41,0)
 . ;
"RTN","IBCNSBL2",42,0)
 . ; - third party bill went to Tricare Supplemental carrier, bill patient next
"RTN","IBCNSBL2",43,0)
 . S IBSEQ=$P($G(^DGCR(399,IBIFN,0)),U,21),IBSEQ=$S(IBSEQ="P":"I1",IBSEQ="S":"I2",IBSEQ="T":"I3",1:-1)
"RTN","IBCNSBL2",44,0)
 . S IBPOL=$G(^DGCR(399,IBIFN,IBSEQ))
"RTN","IBCNSBL2",45,0)
 . S IBCS=$D(^IBE(355.1,"D","CS",+$P($G(^IBA(355.3,+$P(IBPOL,"^",18),0)),"^",9)))>0
"RTN","IBCNSBL2",46,0)
 . I IBCS D  Q
"RTN","IBCNSBL2",47,0)
 .. S IBTXT(14)="This claim was sent to the TRICARE Supplemental insurance carrier."
"RTN","IBCNSBL2",48,0)
 .. S IBTXT(15)="You should send a copayment charge to the patient."
"RTN","IBCNSBL2",49,0)
 . ;
"RTN","IBCNSBL2",50,0)
 . ; - otherwise third party bill went to patients Reimb. Ins carrier, bill the tricare FI next
"RTN","IBCNSBL2",51,0)
 . S IBRETURN="1^TRICARE Fiscal Intermediary"
"RTN","IBCNSBL2",52,0)
 . S IBTXT(14)="You should prepare a claim to send to the TRICARE Fiscal Intermediary."
"RTN","IBCNSBL2",53,0)
 ;
"RTN","IBCNSBL2",54,0)
 ; - for Tricare claims, bill the patient or Tricare supplemental policy
"RTN","IBCNSBL2",55,0)
 I IBARCAT=30 D  G EOBQ
"RTN","IBCNSBL2",56,0)
 . ;
"RTN","IBCNSBL2",57,0)
 . ; - if the patient has a Tricare supplemental policy, bill it
"RTN","IBCNSBL2",58,0)
 . I $$CHPSUP(+$P(IB,"^",2)) D  Q
"RTN","IBCNSBL2",59,0)
 .. S IBRETURN="1^TRICARE Supplemental policy"
"RTN","IBCNSBL2",60,0)
 .. S IBTXT(14)="The patient has a TRICARE Supplemental policy."
"RTN","IBCNSBL2",61,0)
 .. S IBTXT(15)="You should prepare a claim to be sent to that carrier."
"RTN","IBCNSBL2",62,0)
 . ;
"RTN","IBCNSBL2",63,0)
 . ; - otherwise, bill the patient
"RTN","IBCNSBL2",64,0)
 . S IBTXT(14)="You should send a copayment charge to the patient."
"RTN","IBCNSBL2",65,0)
 ;
"RTN","IBCNSBL2",66,0)
 ; - all other bills:  if there is a next payer in the series then a bill needs to be created for that payer
"RTN","IBCNSBL2",67,0)
 S IBSEQ=$P($G(^DGCR(399,IBIFN,0)),U,21),IBSEQ=$S(IBSEQ="P":2,IBSEQ="S":3,1:"")
"RTN","IBCNSBL2",68,0)
 I +IBSEQ S IBINS=$P($G(^DGCR(399,IBIFN,"M")),U,IBSEQ) I +IBINS D
"RTN","IBCNSBL2",69,0)
 . S IBRETURN=+IBINS_U_$P($G(^DIC(36,+IBINS,0)),U,1)
"RTN","IBCNSBL2",70,0)
 . S IBTXT(14)="There is a "_$S(IBSEQ=2:"secondary",1:"tertiary")_" payor associated with this claim."
"RTN","IBCNSBL2",71,0)
 . S IBTXT(15)="You may need to prepare a claim to be sent to "_$P(IBRETURN,U,2)_"."
"RTN","IBCNSBL2",72,0)
 ;
"RTN","IBCNSBL2",73,0)
EOBQ Q IBRETURN
"RTN","IBCNSBL2",74,0)
 ;
"RTN","IBCNSBL2",75,0)
BULL(IBIFN,IBORIG,IBPYMT) ; Generate bulletin detailing next payer for a claim, if any
"RTN","IBCNSBL2",76,0)
 ;
"RTN","IBCNSBL2",77,0)
 ;   Input:    IBIFN  --  Pointer to AR (file #430), or Claim (file #399)
"RTN","IBCNSBL2",78,0)
 ;            IBORIG  --  Original amount of the claim
"RTN","IBCNSBL2",79,0)
 ;            IBPYMT  --  Total Amount paid on the claim
"RTN","IBCNSBL2",80,0)
 ;
"RTN","IBCNSBL2",81,0)
 ;  Output:   Bulletin:   Mail Group MEANS TEST BILLING MAIL GROUP: IB MEANS TEST (350.9,.11)
"RTN","IBCNSBL2",82,0)
 ;                        If a secondary payor for the claim can be found, a bulletin will be sent
"RTN","IBCNSBL2",83,0)
 ;                        to the billing unit to alert them to forward the claim to that payor.
"RTN","IBCNSBL2",84,0)
 ;
"RTN","IBCNSBL2",85,0)
 N X,IB,IBX,IBTXT,IBP,IBGRP,IBWLF  ;WCJ;IB*2.0*432
"RTN","IBCNSBL2",86,0)
 ;
"RTN","IBCNSBL2",87,0)
 S IBX=$$EOB($G(IBIFN),$G(IBORIG),$G(IBPYMT),.IBTXT) I '$D(IBTXT) D WLCK(IBIFN) G BULLQ
"RTN","IBCNSBL2",88,0)
 ;
"RTN","IBCNSBL2",89,0)
 ; WCJ;IB*2.0*432;Trigger commercial auto processing.  
"RTN","IBCNSBL2",90,0)
 ; This will replace the bulletin when activated.  
"RTN","IBCNSBL2",91,0)
 ; (not using a master switch just yet so it's automatically activated)
"RTN","IBCNSBL2",92,0)
 ;I $$GET1^DIQ(350.9,1,8.18) D  G BULLQ
"RTN","IBCNSBL2",93,0)
 ; check if these should go directly to the worklist
"RTN","IBCNSBL2",94,0)
 S IBWLF=$S('IBX:1,".CHAMPVA Center.TRICARE Fiscal Intermediary.TRICARE Supplemental policy."[("."_$P(IBX,U,2)_"."):1,1:0)
"RTN","IBCNSBL2",95,0)
 D EN^IBCAPP(IBIFN,IBORIG,IBPYMT,IBWLF)
"RTN","IBCNSBL2",96,0)
 G BULLQ
"RTN","IBCNSBL2",97,0)
 ; WCJ;IB*2.0*432;end changes
"RTN","IBCNSBL2",98,0)
 ;
"RTN","IBCNSBL2",99,0)
 S IB=$G(^DGCR(399,IBIFN,0)) I IB="" G BULLQ
"RTN","IBCNSBL2",100,0)
 S IBP=$$PT^IBEFUNC(+$P(IB,"^",2))
"RTN","IBCNSBL2",101,0)
 ;
"RTN","IBCNSBL2",102,0)
 ; - create remainder of bulletin
"RTN","IBCNSBL2",103,0)
 N XMDUZ,XMTEXT,XMY,XMSUB
"RTN","IBCNSBL2",104,0)
 S XMSUB="Notification of Subsequent Payor"
"RTN","IBCNSBL2",105,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBTXT("
"RTN","IBCNSBL2",106,0)
 K XMY S XMY(DUZ)=""
"RTN","IBCNSBL2",107,0)
 ;
"RTN","IBCNSBL2",108,0)
 S IBTXT(1)="A payment has been made on the following claim, which has been identified"
"RTN","IBCNSBL2",109,0)
 S IBTXT(2)="as potentially having a subsequent payor:"
"RTN","IBCNSBL2",110,0)
 S IBTXT(3)=" "
"RTN","IBCNSBL2",111,0)
 S IBTXT(4)="  Bill Number: "_$P($G(^PRCA(430,IBIFN,0)),"^")
"RTN","IBCNSBL2",112,0)
 S IBTXT(5)="      Patient: "_$E($P(IBP,"^"),1,30)_"   Pt. Id: "_$P(IBP,"^",2)
"RTN","IBCNSBL2",113,0)
 S IBTXT(6)="    Bill Type: "_$P($G(^DGCR(399.3,+$P(IB,"^",7),0)),"^")
"RTN","IBCNSBL2",114,0)
 S IBTXT(7)="  Orig Amount: $"_$J(IBORIG,0,2)
"RTN","IBCNSBL2",115,0)
 S IBTXT(8)="  Amount Paid: $"_$J(IBPYMT,0,2)
"RTN","IBCNSBL2",116,0)
 S IBTXT(9)=" "
"RTN","IBCNSBL2",117,0)
 ;
"RTN","IBCNSBL2",118,0)
 S IBX=$G(^DGCR(399,IBIFN,0))
"RTN","IBCNSBL2",119,0)
 S IBTXT(10)="Bill Sequence: "_$$EXSET^IBEFUNC($P(IBX,U,21),399,.21)
"RTN","IBCNSBL2",120,0)
 S IBTXT(11)="   Bill Payer: "_$E($P($G(^DIC(36,+$G(^DGCR(399,IBIFN,"MP")),0)),U,1),1,20)
"RTN","IBCNSBL2",121,0)
 ;
"RTN","IBCNSBL2",122,0)
 S IBX=$G(^DGCR(399,IBIFN,"M"))
"RTN","IBCNSBL2",123,0)
 I IBX S IBTXT(10)=IBTXT(10)_$J("",(40-$L(IBTXT(10))))_"  Primary Carrier: "_$E($P($G(^DIC(36,+IBX,0)),U,1),1,20)
"RTN","IBCNSBL2",124,0)
 I +$P(IBX,U,2) S IBTXT(11)=IBTXT(11)_$J("",(40-$L(IBTXT(11))))_"Secondary Carrier: "_$E($P($G(^DIC(36,+$P(IBX,U,2),0)),U,1),1,20)
"RTN","IBCNSBL2",125,0)
 I +$P(IBX,U,3) S IBTXT(12)=$J("",40)_" Tertiary Carrier: "_$E($P($G(^DIC(36,+$P(IBX,U,3),0)),U,1),1,20)
"RTN","IBCNSBL2",126,0)
 S IBTXT(13)=" "
"RTN","IBCNSBL2",127,0)
 ;
"RTN","IBCNSBL2",128,0)
 ; - send to the Means Test billing mailgroup (for now)
"RTN","IBCNSBL2",129,0)
 S IBGRP=$P($G(^XMB(3.8,+$P($G(^IBE(350.9,1,0)),"^",11),0)),"^")
"RTN","IBCNSBL2",130,0)
 I IBGRP]"" S XMY("G."_IBGRP_"@"_^XMB("NETNAME"))=""
"RTN","IBCNSBL2",131,0)
 ;
"RTN","IBCNSBL2",132,0)
 D ^XMD
"RTN","IBCNSBL2",133,0)
 ;
"RTN","IBCNSBL2",134,0)
BULLQ Q
"RTN","IBCNSBL2",135,0)
 ;
"RTN","IBCNSBL2",136,0)
 ;
"RTN","IBCNSBL2",137,0)
CHPSUP(DFN) ; Does the patient have a TRICARE Supplemental policy?
"RTN","IBCNSBL2",138,0)
 ;  Input:   DFN  --  Pointer to the patient in file #2
"RTN","IBCNSBL2",139,0)
 ; Output:   0 - Has no TRICARE Supplemental policy
"RTN","IBCNSBL2",140,0)
 ;           1 - Yes, patient has such a policy.
"RTN","IBCNSBL2",141,0)
 ;
"RTN","IBCNSBL2",142,0)
 N X,IBINS,IBCS
"RTN","IBCNSBL2",143,0)
 D ALL^IBCNS1(DFN,"IBINS",1,DT)
"RTN","IBCNSBL2",144,0)
 S (IBCS,X)=0 F  S X=$O(IBINS(X)) Q:'X  D  Q:IBCS
"RTN","IBCNSBL2",145,0)
 .I $D(^IBE(355.1,"D","CS",+$P($G(IBINS(X,355.3)),"^",9))) S IBCS=1
"RTN","IBCNSBL2",146,0)
 Q IBCS
"RTN","IBCNSBL2",147,0)
 ;
"RTN","IBCNSBL2",148,0)
WLCK(IBIFN) ; does this claim need to be removed from the worklist?
"RTN","IBCNSBL2",149,0)
 ; IBIFN = claim ien, if collected/closed and NO subsequent payer, remove from worklist if there
"RTN","IBCNSBL2",150,0)
 ; 
"RTN","IBCNSBL2",151,0)
 N X
"RTN","IBCNSBL2",152,0)
 Q:$P($$BILL^RCJIBFN2(IBIFN),U,2)'=22  ;  AR status DBIA 1452
"RTN","IBCNSBL2",153,0)
 Q:'$D(^DGCR(399,"CAP",1,IBIFN))  ; not on worklist
"RTN","IBCNSBL2",154,0)
 S X=$$WLRMVF^IBCECOB1(IBIFN,"RM",1)
"RTN","IBCNSBL2",155,0)
 Q 
"RTN","IBCNSC01")
0^106^B55647455^B53646224
"RTN","IBCNSC01",1,0)
IBCNSC01 ;ALB/NLR - INSURANCE COMPANY EDIT ;6/1/05 10:06am
"RTN","IBCNSC01",2,0)
 ;;2.0;INTEGRATED BILLING;**52,137,191,184,232,320,349,371,399,416,432**;21-MAR-94;Build 192
"RTN","IBCNSC01",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCNSC01",4,0)
 ;
"RTN","IBCNSC01",5,0)
PARAM ; -- Insurance company parameters region
"RTN","IBCNSC01",6,0)
 N OFFSET,START,IBCNS0,IBCNS03,IBCNS06,IBCNS08,IBCNS13,IBCNS3
"RTN","IBCNSC01",7,0)
 S IBCNS0=$G(^DIC(36,+IBCNS,0)),IBCNS3=$G(^(3))
"RTN","IBCNSC01",8,0)
 S IBCNS03=$P(IBCNS0,"^",3),IBCNS06=$P(IBCNS0,"^",6),IBCNS08=$P(IBCNS0,"^",8)
"RTN","IBCNSC01",9,0)
 S IBCNS13=$G(^DIC(36,+IBCNS,.13))
"RTN","IBCNSC01",10,0)
 S START=1,OFFSET=2
"RTN","IBCNSC01",11,0)
 D SET^IBCNSP(START,OFFSET+25," Billing Parameters ",IORVON,IORVOFF)
"RTN","IBCNSC01",12,0)
 ;
"RTN","IBCNSC01",13,0)
 D SET^IBCNSP(START+1,OFFSET+1,"Signature Required?: "_$S(+IBCNS03:"YES",1:"NO"))
"RTN","IBCNSC01",14,0)
 D SET^IBCNSP(START+2,OFFSET+10,"Reimburse?: "_$E($$EXPAND^IBTRE(36,1,$P(IBCNS0,"^",2)),1,21))
"RTN","IBCNSC01",15,0)
 D SET^IBCNSP(START+3,OFFSET+3,"Mult. Bedsections: "_$S(+IBCNS06:"YES",IBCNS06=0:"NO",1:""))
"RTN","IBCNSC01",16,0)
 D SET^IBCNSP(START+4,OFFSET+6,"One Opt. Visit: "_$S(+IBCNS08:"YES",1:"NO"))
"RTN","IBCNSC01",17,0)
 D SET^IBCNSP(START+5,OFFSET+4,"Diff. Rev. Codes: "_$P(IBCNS0,"^",7))
"RTN","IBCNSC01",18,0)
 D SET^IBCNSP(START+6,OFFSET+1,"Amb. Sur. Rev. Code: "_$P(IBCNS0,"^",9))
"RTN","IBCNSC01",19,0)
 D SET^IBCNSP(START+7,OFFSET+1,"Rx Refill Rev. Code: "_$P(IBCNS0,"^",15))
"RTN","IBCNSC01",20,0)
 D SET^IBCNSP(START+8,OFFSET+3,"Filing Time Frame: "_$P(IBCNS0,"^",12)_$S(+$P(IBCNS0,"^",18):" ("_$$FTFN^IBCNSU31(,+IBCNS)_")",1:""))
"RTN","IBCNSC01",21,0)
 ;
"RTN","IBCNSC01",22,0)
 S OFFSET=45
"RTN","IBCNSC01",23,0)
 D SET^IBCNSP(START+1,OFFSET+4,"Type Of Coverage: "_$$EXPAND^IBTRE(36,.13,+$P(IBCNS0,U,13)))
"RTN","IBCNSC01",24,0)
 D SET^IBCNSP(START+2,OFFSET+7,"Billing Phone: "_$P(IBCNS13,"^",2))
"RTN","IBCNSC01",25,0)
 D SET^IBCNSP(START+3,OFFSET+2,"Verification Phone: "_$P(IBCNS13,"^",4))
"RTN","IBCNSC01",26,0)
 D SET^IBCNSP(START+4,OFFSET+2,"Precert Comp. Name: "_$P($G(^DIC(36,+$P(IBCNS13,"^",9),0)),"^",1))
"RTN","IBCNSC01",27,0)
 D SET^IBCNSP(START+5,OFFSET+7,"Precert Phone: "_$$PHONE(IBCNS13))
"RTN","IBCNSC01",28,0)
 I +IBCNS3=2 D SET^IBCNSP(START+6,OFFSET,"Max # Test Bills/Day: "_$P(IBCNS3,U,6))
"RTN","IBCNSC01",29,0)
 ;
"RTN","IBCNSC01",30,0)
 S START=11,OFFSET=2
"RTN","IBCNSC01",31,0)
 D SET^IBCNSP(START,OFFSET+28," EDI Parameters ",IORVON,IORVOFF)
"RTN","IBCNSC01",32,0)
 D SET^IBCNSP(START+1,OFFSET+13,"Transmit?: "_$S(+IBCNS3=1:"YES-LIVE",+IBCNS3=2:"TEST ONLY",1:"NO"))
"RTN","IBCNSC01",33,0)
 D SET^IBCNSP(START+2,OFFSET+1,"Inst Payer Primary ID: "_$P(IBCNS3,U,4))
"RTN","IBCNSC01",34,0)
 D SET^IBCNSP(START+3,OFFSET,"Inst Payer Sec ID Qual: "_$$GET1^DIQ(36,+IBCNS,6.01))
"RTN","IBCNSC01",35,0)
 D SET^IBCNSP(START+4,OFFSET+5,"Inst Payer Sec ID: "_$$GET1^DIQ(36,+IBCNS,6.02))
"RTN","IBCNSC01",36,0)
 D SET^IBCNSP(START+5,OFFSET,"Inst Payer Sec ID Qual: "_$$GET1^DIQ(36,+IBCNS,6.03))
"RTN","IBCNSC01",37,0)
 D SET^IBCNSP(START+6,OFFSET+5,"Inst Payer Sec ID: "_$$GET1^DIQ(36,+IBCNS,6.04))
"RTN","IBCNSC01",38,0)
 D SET^IBCNSP(START+7,OFFSET+12,"Bin Number: "_$P($G(^DIC(36,+IBCNS,3)),"^",3)) ;
"RTN","IBCNSC01",39,0)
 ;
"RTN","IBCNSC01",40,0)
 S OFFSET=41
"RTN","IBCNSC01",41,0)
 D SET^IBCNSP(START+1,OFFSET+8," Insurance Type: "_$$EXPAND^IBTRE(36,3.09,+$P(IBCNS3,U,9)))
"RTN","IBCNSC01",42,0)
 D SET^IBCNSP(START+2,OFFSET+1," Prof Payer Primary ID: "_$P(IBCNS3,U,2))
"RTN","IBCNSC01",43,0)
 D SET^IBCNSP(START+3,OFFSET," Prof Payer Sec ID Qual: "_$$GET1^DIQ(36,+IBCNS,6.05))
"RTN","IBCNSC01",44,0)
 D SET^IBCNSP(START+4,OFFSET+5," Prof Payer Sec ID: "_$$GET1^DIQ(36,+IBCNS,6.06))
"RTN","IBCNSC01",45,0)
 D SET^IBCNSP(START+5,OFFSET," Prof Payer Sec ID Qual: "_$$GET1^DIQ(36,+IBCNS,6.07))
"RTN","IBCNSC01",46,0)
 D SET^IBCNSP(START+6,OFFSET+5," Prof Payer Sec ID: "_$$GET1^DIQ(36,+IBCNS,6.08))
"RTN","IBCNSC01",47,0)
 ;IB*2.0*432/TAZ Added fields 6.09 and 6.1
"RTN","IBCNSC01",48,0)
 D SET^IBCNSP(START+7,OFFSET-3," Prnt Sec/Tert Auto Claims: "_$$GET1^DIQ(36,+IBCNS,6.09))
"RTN","IBCNSC01",49,0)
 D SET^IBCNSP(START+8,OFFSET-5," Prnt Med Sec Claims w/o MRA: "_$$GET1^DIQ(36,+IBCNS,6.1))
"RTN","IBCNSC01",50,0)
 Q
"RTN","IBCNSC01",51,0)
 ;
"RTN","IBCNSC01",52,0)
PHONE(IBCNS13) ; -- Compute precert company phone
"RTN","IBCNSC01",53,0)
 N IBX,IBSAVE,IBCNT S IBX=""
"RTN","IBCNSC01",54,0)
 I '$P(IBCNS13,"^",9) S IBX=$P(IBCNS13,"^",3) G PHONEQ
"RTN","IBCNSC01",55,0)
REDOX S IBSAVE=+$P(IBCNS13,"^",9)
"RTN","IBCNSC01",56,0)
 S IBCNT=$G(IBCNT)+1
"RTN","IBCNSC01",57,0)
 ; -- if you process the same co. more than once you are in an infinite loop
"RTN","IBCNSC01",58,0)
 I $D(IBCNT(IBCNS)) G PHONEQ
"RTN","IBCNSC01",59,0)
 S IBCNT(IBCNS)=""
"RTN","IBCNSC01",60,0)
 S IBCNS13=$G(^DIC(36,+$P(IBCNS13,"^",9),.13))
"RTN","IBCNSC01",61,0)
 S IBX=$P(IBCNS13,"^") S:$L($P(IBCNS13,"^",3)) IBX=$P(IBCNS13,"^",3)
"RTN","IBCNSC01",62,0)
 ; -- if process the same co. more than once you are in an infinite loop
"RTN","IBCNSC01",63,0)
 I $P(IBCNS13,"^",9),$P(IBCNS13,"^",9)'=IBSAVE G REDOX
"RTN","IBCNSC01",64,0)
PHONEQ Q IBX
"RTN","IBCNSC01",65,0)
 ;
"RTN","IBCNSC01",66,0)
MAIN ; -- Insurance company main address
"RTN","IBCNSC01",67,0)
 N OFFSET,START,IBCNS11,IBCNS13,IBADD
"RTN","IBCNSC01",68,0)
 S IBCNS11=$G(^DIC(36,+IBCNS,.11))
"RTN","IBCNSC01",69,0)
 S IBCNS13=$G(^DIC(36,+IBCNS,.13))
"RTN","IBCNSC01",70,0)
 S START=21,OFFSET=25
"RTN","IBCNSC01",71,0)
 D SET^IBCNSP(START,OFFSET," Main Mailing Address ",IORVON,IORVOFF)
"RTN","IBCNSC01",72,0)
 N OFFSET S OFFSET=2
"RTN","IBCNSC01",73,0)
 D SET^IBCNSP(START+1,OFFSET,"       Street: "_$P(IBCNS11,"^",1)) S IBADD=1
"RTN","IBCNSC01",74,0)
 D SET^IBCNSP(START+2,OFFSET,"     Street 2: "_$P(IBCNS11,"^",2)) S IBADD=2
"RTN","IBCNSC01",75,0)
 D SET^IBCNSP(START+3,OFFSET,"     Street 3: "_$P(IBCNS11,"^",3)) S IBADD=3
"RTN","IBCNSC01",76,0)
 ; D SET^IBCNSP(START+4,OFFSET,"Claim Off. ID: "_$P(IBCNS11,U,11))
"RTN","IBCNSC01",77,0)
 N OFFSET S OFFSET=45
"RTN","IBCNSC01",78,0)
 D SET^IBCNSP(START+1,OFFSET,"   City/State: "_$E($P(IBCNS11,"^",4),1,15)_$S($P(IBCNS11,"^",4)="":"",1:", ")_$P($G(^DIC(5,+$P(IBCNS11,"^",5),0)),"^",2)_" "_$E($P(IBCNS11,"^",6),1,5))
"RTN","IBCNSC01",79,0)
 D SET^IBCNSP(START+2,OFFSET,"        Phone: "_$P(IBCNS13,"^",1))
"RTN","IBCNSC01",80,0)
 D SET^IBCNSP(START+3,OFFSET,"          Fax: "_$P(IBCNS11,"^",9))
"RTN","IBCNSC01",81,0)
 Q
"RTN","IBCNSC01",82,0)
 ;
"RTN","IBCNSC01",83,0)
 ;
"RTN","IBCNSC01",84,0)
PAYER ; This procedure builds the display for the payer associated with
"RTN","IBCNSC01",85,0)
 ; this insurance company.
"RTN","IBCNSC01",86,0)
 ; ESG - 7/29/02 - IIV project
"RTN","IBCNSC01",87,0)
 ;     -  9/9/09 - eIV updated
"RTN","IBCNSC01",88,0)
 ;
"RTN","IBCNSC01",89,0)
 NEW PAYERIEN,PAYR,APPDATA,APP,DATA,APPNAME,A1,A2,A3,A4,A5,A6,A7,A8
"RTN","IBCNSC01",90,0)
 NEW START,TITLE,OFFSET,IBLINE
"RTN","IBCNSC01",91,0)
 S PAYERIEN=$P($G(^DIC(36,+IBCNS,3)),U,10),PAYR="",APPDATA=0
"RTN","IBCNSC01",92,0)
 I PAYERIEN D
"RTN","IBCNSC01",93,0)
 . S PAYR=$G(^IBE(365.12,PAYERIEN,0))
"RTN","IBCNSC01",94,0)
 . S APP=0
"RTN","IBCNSC01",95,0)
 . F  S APP=$O(^IBE(365.12,PAYERIEN,1,APP)) Q:'APP  D
"RTN","IBCNSC01",96,0)
 .. S DATA=$G(^IBE(365.12,PAYERIEN,1,APP,0))
"RTN","IBCNSC01",97,0)
 .. S APPNAME=$$EXTERNAL^DILFD(365.121,.01,"",$P(DATA,U,1))
"RTN","IBCNSC01",98,0)
 .. I APPNAME="" Q
"RTN","IBCNSC01",99,0)
 .. I APPNAME="IIV" S APPNAME="eIV"   ; IB*2*416 - change external display to be eIV
"RTN","IBCNSC01",100,0)
 .. I $D(APPDATA(APPNAME)) Q
"RTN","IBCNSC01",101,0)
 .. S (A1,A2,A3,A4,A5,A6,A7)="NO",A8=""
"RTN","IBCNSC01",102,0)
 .. I $P(DATA,U,2) S A1="YES"      ; national active
"RTN","IBCNSC01",103,0)
 .. I $P(DATA,U,3) S A2="YES"      ; local active
"RTN","IBCNSC01",104,0)
 .. I $P(DATA,U,7) S A3="YES"      ; auto-accept
"RTN","IBCNSC01",105,0)
 .. I $P(DATA,U,8) S A4="YES"      ; ident inquiries require subscr ID (*416 field not used)
"RTN","IBCNSC01",106,0)
 .. I $P(DATA,U,9) S A5="YES"      ; use SSN for subscriber ID (*416 field not used)
"RTN","IBCNSC01",107,0)
 .. I $P(DATA,U,10) S A6="YES"     ; transmit SSN (*416 field not used)
"RTN","IBCNSC01",108,0)
 .. I $P(DATA,U,11) S A7="YES"     ; deactivated?
"RTN","IBCNSC01",109,0)
 .. ; A8 = deactivation date
"RTN","IBCNSC01",110,0)
 .. I $P(DATA,U,12) S A8=$P($$FMTE^XLFDT($P(DATA,U,12),"5Z"),"@",1)
"RTN","IBCNSC01",111,0)
 .. S APPDATA(APPNAME)=A1_U_A2_U_A3_U_A4_U_A5_U_A6_U_A7_U_A8
"RTN","IBCNSC01",112,0)
 .. S APPDATA=APPDATA+1
"RTN","IBCNSC01",113,0)
 .. Q
"RTN","IBCNSC01",114,0)
 . Q
"RTN","IBCNSC01",115,0)
 ;
"RTN","IBCNSC01",116,0)
 S START=$O(^TMP("IBCNSC",$J,""),-1)+1
"RTN","IBCNSC01",117,0)
 S IB1ST("PAYER")=START
"RTN","IBCNSC01",118,0)
 S TITLE=" Payer Information:  e-IV, e-Pharmacy "
"RTN","IBCNSC01",119,0)
 S OFFSET=(40-($L(TITLE)/2))\1+1
"RTN","IBCNSC01",120,0)
 D SET^IBCNSP(START,OFFSET,TITLE,IORVON,IORVOFF)
"RTN","IBCNSC01",121,0)
 D SET^IBCNSP(START+1,9,"Payer Name: "_$P(PAYR,U,1))
"RTN","IBCNSC01",122,0)
 D SET^IBCNSP(START+2,5,"VA National ID: "_$P(PAYR,U,2))
"RTN","IBCNSC01",123,0)
 D SET^IBCNSP(START+2,51,"CMS National ID: "_$P(PAYR,U,3))
"RTN","IBCNSC01",124,0)
 S IBLINE=START+2
"RTN","IBCNSC01",125,0)
 ;
"RTN","IBCNSC01",126,0)
 ; Handle the case where no application data is defined
"RTN","IBCNSC01",127,0)
 I 'APPDATA D  G PAYERX
"RTN","IBCNSC01",128,0)
 . S IBLINE=IBLINE+1
"RTN","IBCNSC01",129,0)
 . D SET^IBCNSP(IBLINE,2," ")    ; blank line
"RTN","IBCNSC01",130,0)
 . S IBLINE=IBLINE+1
"RTN","IBCNSC01",131,0)
 . D SET^IBCNSP(IBLINE,16,"Payer Application data is not defined!")
"RTN","IBCNSC01",132,0)
 . Q
"RTN","IBCNSC01",133,0)
 ;
"RTN","IBCNSC01",134,0)
 ; Display all the applications
"RTN","IBCNSC01",135,0)
 S APPNAME=""
"RTN","IBCNSC01",136,0)
 F  S APPNAME=$O(APPDATA(APPNAME)) Q:APPNAME=""  D
"RTN","IBCNSC01",137,0)
 . S IBLINE=IBLINE+1
"RTN","IBCNSC01",138,0)
 . D SET^IBCNSP(IBLINE,2," ")    ; blank line
"RTN","IBCNSC01",139,0)
 . ;
"RTN","IBCNSC01",140,0)
 . S IBLINE=IBLINE+1
"RTN","IBCNSC01",141,0)
 . D SET^IBCNSP(IBLINE,2,"Payer Application: "_APPNAME)
"RTN","IBCNSC01",142,0)
 . D SET^IBCNSP(IBLINE,51,"FSC Auto-Update: "_$P(APPDATA(APPNAME),U,3))
"RTN","IBCNSC01",143,0)
 . ;
"RTN","IBCNSC01",144,0)
 . S IBLINE=IBLINE+1
"RTN","IBCNSC01",145,0)
 . D SET^IBCNSP(IBLINE,4,"National Active: "_$P(APPDATA(APPNAME),U,1))
"RTN","IBCNSC01",146,0)
 . D SET^IBCNSP(IBLINE,55,"Deactivated: "_$P(APPDATA(APPNAME),U,7))
"RTN","IBCNSC01",147,0)
 . ;
"RTN","IBCNSC01",148,0)
 . S IBLINE=IBLINE+1
"RTN","IBCNSC01",149,0)
 . D SET^IBCNSP(IBLINE,7,"Local Active: "_$P(APPDATA(APPNAME),U,2))
"RTN","IBCNSC01",150,0)
 . ;
"RTN","IBCNSC01",151,0)
 . ; If no deactivated date, then exit
"RTN","IBCNSC01",152,0)
 . I $P(APPDATA(APPNAME),U,8)="" Q
"RTN","IBCNSC01",153,0)
 . ;
"RTN","IBCNSC01",154,0)
 . D SET^IBCNSP(IBLINE,50,"Date Deactivated: "_$P(APPDATA(APPNAME),U,8))
"RTN","IBCNSC01",155,0)
 . ;
"RTN","IBCNSC01",156,0)
 . Q
"RTN","IBCNSC01",157,0)
PAYERX ;
"RTN","IBCNSC01",158,0)
 ; Two trailing blank lines after payer information display
"RTN","IBCNSC01",159,0)
 S IBLINE=IBLINE+1
"RTN","IBCNSC01",160,0)
 D SET^IBCNSP(IBLINE,2," ")    ; blank line
"RTN","IBCNSC01",161,0)
 S IBLINE=IBLINE+1
"RTN","IBCNSC01",162,0)
 D SET^IBCNSP(IBLINE,2," ")    ; blank line
"RTN","IBCNSC01",163,0)
 Q
"RTN","IBCNSC01",164,0)
 ;
"RTN","IBCNSC01",165,0)
 ;
"RTN","IBCNSC01",166,0)
REMARKS ;
"RTN","IBCNSC01",167,0)
 ;
"RTN","IBCNSC01",168,0)
 N OFFSET,START,IBLCNT,IBI
"RTN","IBCNSC01",169,0)
 S START=$O(^TMP("IBCNSC",$J,""),-1)+1,OFFSET=2
"RTN","IBCNSC01",170,0)
 S IB1ST("REM")=START
"RTN","IBCNSC01",171,0)
 ;
"RTN","IBCNSC01",172,0)
 D SET^IBCNSP(START,OFFSET," Remarks ",IORVON,IORVOFF)
"RTN","IBCNSC01",173,0)
 S (IBLCNT,IBI)=0 F  S IBI=$O(^DIC(36,+IBCNS,11,IBI)) Q:IBI<1  D
"RTN","IBCNSC01",174,0)
 . S IBLCNT=IBLCNT+1
"RTN","IBCNSC01",175,0)
 . D SET^IBCNSP(START+IBLCNT,OFFSET,"  "_$E($G(^DIC(36,+IBCNS,11,IBI,0)),1,80))
"RTN","IBCNSC01",176,0)
 . Q
"RTN","IBCNSC01",177,0)
 D SET^IBCNSP(START+IBLCNT+1,OFFSET," ")   ; blank line after remarks
"RTN","IBCNSC01",178,0)
 Q
"RTN","IBCNSC01",179,0)
 ;
"RTN","IBCNSC01",180,0)
SYN ;
"RTN","IBCNSC01",181,0)
 N OFFSET,START,SYN,SYNOI
"RTN","IBCNSC01",182,0)
 S START=$O(^TMP("IBCNSC",$J,""),-1)+1,OFFSET=2
"RTN","IBCNSC01",183,0)
 S IB1ST("SYN")=START
"RTN","IBCNSC01",184,0)
 D SET^IBCNSP(START,OFFSET," Synonyms ",IORVON,IORVOFF)
"RTN","IBCNSC01",185,0)
 S SYN="" F SYNOI=1:1:8 S SYN=$O(^DIC(36,+IBCNS,10,"B",SYN)) Q:SYN=""  D SET^IBCNSP(START+SYNOI,OFFSET,$S(SYNOI>7:"  ...edit to see more...",1:"  "_SYN))
"RTN","IBCNSC01",186,0)
 Q
"RTN","IBCNSC01",187,0)
 ;
"RTN","IBCSC10")
0^32^B3383615^n/a
"RTN","IBCSC10",1,0)
IBCSC10 ;ALB/MJB - MCCR SCREEN 10 (UB-82 BILL SPECIFIC INFO)  ;27 MAY 88 10:20
"RTN","IBCSC10",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCSC10",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC10",4,0)
 ;
"RTN","IBCSC10",5,0)
 ;MAP TO DGCRSC8
"RTN","IBCSC10",6,0)
 ;
"RTN","IBCSC10",7,0)
 ; DEM;432 - Moved IBCSC8* billing screen routines to IBCSC10* billing screen
"RTN","IBCSC10",8,0)
 ;           routines and created a new billing screen 8 routine IBCSC8.
"RTN","IBCSC10",9,0)
 ;
"RTN","IBCSC10",10,0)
EN S IBCUBFT=$$FT^IBCU3(IBIFN) I IBCUBFT=2 K IBCUBFT G ^IBCSC10H ; hcfa 1500
"RTN","IBCSC10",11,0)
 I IBCUBFT=3 K IBCUBFT G ^IBCSC102 ; ub-92
"RTN","IBCSC10",12,0)
 ;I $P(^DGCR(399,IBIFN,0),"^",19)=2 G ^IBCSC10H ;hcfa 1500
"RTN","IBCSC10",13,0)
 D ^IBCSCU S IBSR=10,IBSR1="",IBV1="000000000" S:IBV IBV1="111111111" F I="U","U1",0 S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"")
"RTN","IBCSC10",14,0)
 D H^IBCSCU
"RTN","IBCSC10",15,0)
 S Z=1,IBW=1 X IBWW W " Bill Remark    : ",$S($P(IB("U1"),U,8)]"":$P(IB("U1"),U,8),1:IBUN)
"RTN","IBCSC10",16,0)
 S IBX="^^^2^9^27^45" F I=4:1:7 S Z=(I-2),IBW=1 X IBWW W " Form Locator ",$P(IBX,U,I),$S($E($P(IBX,U,I),2)="":" : ",1:": "),$S($P(IB("U1"),U,I)]"":$P(IB("U1"),U,I),1:IBUN)
"RTN","IBCSC10",17,0)
 S IBX=91 F I=13,14 S Z=(I-7),IBW=1,IBX=IBX+1 X IBWW W " Form Locator ",IBX,": ",$S($P(IB("U1"),U,I)]"":$P(IB("U1"),U,I),1:IBUN)
"RTN","IBCSC10",18,0)
 S Z=8,IBW=1 X IBWW W " Tx Auth. Code  : ",$S($P(IB("U"),U,13)]"":$P(IB("U"),U,13),1:IBUN)
"RTN","IBCSC10",19,0)
 G ^IBCSCP
"RTN","IBCSC10",20,0)
Q Q
"RTN","IBCSC10",21,0)
 ;IBCSC10
"RTN","IBCSC102")
0^33^B40563126^n/a
"RTN","IBCSC102",1,0)
IBCSC102 ;ALB/MJB - MCCR SCREEN 10 (UB-04 BILL SPECIFIC INFO) ;27 MAY 88 10:20
"RTN","IBCSC102",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCSC102",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC102",4,0)
 ;
"RTN","IBCSC102",5,0)
 ; DEM;432 - Moved IBCSC8* billing screen routines to IBCSC10* billing screen
"RTN","IBCSC102",6,0)
 ;           routines and created a new billing screen 8 routine IBCSC8.
"RTN","IBCSC102",7,0)
 ;
"RTN","IBCSC102",8,0)
EN S IBCUBFT=$$FT^IBCU3(IBIFN) I IBCUBFT=2 K IBCUBFT G ^IBCSC10H ;CMS-1500
"RTN","IBCSC102",9,0)
 ;
"RTN","IBCSC102",10,0)
 N FIRSTPRV,I,IB,IBINP,IBX,PRV,PRVS,Z
"RTN","IBCSC102",11,0)
 S IBINP=$$INPAT^IBCEF(IBIFN)
"RTN","IBCSC102",12,0)
 D ^IBCSCU
"RTN","IBCSC102",13,0)
 S IBSR=10,IBSR1=2,IBV1="0000000" S:IBINP $E(IBV1,2)=1 S:IBV IBV1="1111111"
"RTN","IBCSC102",14,0)
 F I="U","U1",0,"UF3","UF31","UF32","U2","TX","U3" S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBCSC102",15,0)
 N IBZ,IBPRV,IBREQ,IBMRASEC,TEXT,BPZ,TXMT,IBZCNT
"RTN","IBCSC102",16,0)
 D GETPRV^IBCEU(IBIFN,"ALL",.IBPRV)
"RTN","IBCSC102",17,0)
 K IB("PRV")
"RTN","IBCSC102",18,0)
 S IBZ=0 F  S IBZ=$O(IBPRV(IBZ)) Q:'IBZ  I $O(IBPRV(IBZ,0))!$D(IBPRV(IBZ,"NOTOPT")) M IB("PRV",IBZ)=IBPRV(IBZ)
"RTN","IBCSC102",19,0)
 ;
"RTN","IBCSC102",20,0)
 D H^IBCSCU
"RTN","IBCSC102",21,0)
 ;
"RTN","IBCSC102",22,0)
 ; Section 1
"RTN","IBCSC102",23,0)
 S Z=1,IBW=1 X IBWW W " Bill Remarks",!?5,"- FL-80",?22,": "
"RTN","IBCSC102",24,0)
 S TEXT=$P($G(^DGCR(399,IBIFN,"UF2")),U,3)  ; field# 402
"RTN","IBCSC102",25,0)
 I TEXT="" W IBUN                           ; unspecified [not required]
"RTN","IBCSC102",26,0)
 I TEXT'="" D
"RTN","IBCSC102",27,0)
 . N IBZ,Z
"RTN","IBCSC102",28,0)
 . D REMARK^IBCEF77(IBIFN,.IBZ)
"RTN","IBCSC102",29,0)
 . S Z=0 F  S Z=$O(IBZ(Z)) Q:'Z  D
"RTN","IBCSC102",30,0)
 .. W ?24,$G(IBZ(Z))
"RTN","IBCSC102",31,0)
 .. I Z>4 W ?48,$G(IBVI)," <--- This Line Will Not Print ",$G(IBVO)
"RTN","IBCSC102",32,0)
 .. I $O(IBZ(Z)) W !
"RTN","IBCSC102",33,0)
 .. Q
"RTN","IBCSC102",34,0)
 . Q
"RTN","IBCSC102",35,0)
 ;
"RTN","IBCSC102",36,0)
 S IBZCNT=0,IBZ(IBZCNT)=""
"RTN","IBCSC102",37,0)
 I $P(IB("UF3"),U,4)]"" S IBZ(IBZCNT)="P: "_$P(IB("UF3"),U,4),IBZCNT=IBZCNT+1
"RTN","IBCSC102",38,0)
 I $P(IB("UF3"),U,5)]"" S IBZ(IBZCNT)="S: "_$P(IB("UF3"),U,5),IBZCNT=IBZCNT+1
"RTN","IBCSC102",39,0)
 I $P(IB("UF3"),U,6)]"" S IBZ(IBZCNT)="T: "_$P(IB("UF3"),U,6)
"RTN","IBCSC102",40,0)
 ;S IBZ(0)="",IBZ=$S($P(IB("UF3"),U,4)]"":"Pri: "_$P(IB("UF3"),U,4),1:"")_$S($P(IB("UF3"),U,5)'="":"  Sec: "_$P(IB("UF3"),U,5),1:"")_$S($P(IB("UF3"),U,6)'="":" Ter: "_$P(IB("UF3"),U,6),1:"")
"RTN","IBCSC102",41,0)
 S:IBZ(0)="" IBZ(0)=IBUN
"RTN","IBCSC102",42,0)
 W !?4,"ICN/DCN(s)        : ",IBZ(0)
"RTN","IBCSC102",43,0)
 F IBZCNT=1:1 Q:'$D(IBZ(IBZCNT))  W !?24,IBZ(IBZCNT)
"RTN","IBCSC102",44,0)
 K IBZ
"RTN","IBCSC102",45,0)
 S IBZCNT=0,IBZ(IBZCNT)=""
"RTN","IBCSC102",46,0)
 I $P(IB("U"),U,13)]"" S IBZ(IBZCNT)="P: "_$P(IB("U"),U,13),IBZCNT=IBZCNT+1
"RTN","IBCSC102",47,0)
 I $P(IB("U2"),U,8)'="" S IBZ(IBZCNT)="S: "_$P(IB("U2"),U,8),IBZCNT=IBZCNT+1
"RTN","IBCSC102",48,0)
 I $P(IB("U2"),U,9)'="" S IBZ(IBZCNT)="T: "_$P(IB("U2"),U,9),IBZCNT=IBZCNT+1
"RTN","IBCSC102",49,0)
 I $P(IB("UF32"),U,1)'="" S IBZ(IBZCNT)="P: "_$P(IB("UF32"),U,1),IBZCNT=IBZCNT+1
"RTN","IBCSC102",50,0)
 I $P(IB("UF32"),U,2)'="" S IBZ(IBZCNT)="S: "_$P(IB("UF32"),U,2),IBZCNT=IBZCNT+1
"RTN","IBCSC102",51,0)
 I $P(IB("UF32"),U,3)'="" S IBZ(IBZCNT)="T: "_$P(IB("UF32"),U,3)
"RTN","IBCSC102",52,0)
 S IBZ="",IBZ=$S($P(IB("U"),U,13)]"":"P: "_$P(IB("U"),U,13),1:"")
"RTN","IBCSC102",53,0)
 S:IBZ(0)="" IBZ(0)=IBUN
"RTN","IBCSC102",54,0)
 W !,?3," Auth/Referral     : ",IBZ(0)
"RTN","IBCSC102",55,0)
 F IBZCNT=1:1 Q:'$D(IBZ(IBZCNT))  W !?24,IBZ(IBZCNT)
"RTN","IBCSC102",56,0)
 K IBZ S IBZ=""
"RTN","IBCSC102",57,0)
 ;
"RTN","IBCSC102",58,0)
 ; IB*2*400 - Admitting diagnosis only for inpatients
"RTN","IBCSC102",59,0)
 I IBINP W !,?3," Admitting Dx      : " S IBX=$$ICD9^IBACSV(+IB("U2"),$$BDATE^IBACSV(IBIFN)) W $S(IBX'="":$P(IBX,U)_" - "_$P(IBX,U,3),1:IBU)
"RTN","IBCSC102",60,0)
 ;
"RTN","IBCSC102",61,0)
 ; IB*2*400 - esg - display PPS (DRG) info for inpatient, UB claims
"RTN","IBCSC102",62,0)
 I IBINP D
"RTN","IBCSC102",63,0)
 . N PPS,PPSDISP
"RTN","IBCSC102",64,0)
 . S PPS=+$P(IB("U1"),U,15)
"RTN","IBCSC102",65,0)
 . I 'PPS S PPSDISP=IBUN
"RTN","IBCSC102",66,0)
 . I PPS S PPSDISP=$$FO^IBCNEUT1(PPS,4,"R",0)_" - "_$$DRGTD^IBACSV(PPS,$$BDATE^IBACSV(IBIFN))
"RTN","IBCSC102",67,0)
 . W !?4,"PPS (DRG)",?22,": ",$E(PPSDISP,1,56)
"RTN","IBCSC102",68,0)
 . Q
"RTN","IBCSC102",69,0)
 ;
"RTN","IBCSC102",70,0)
 I 'IBINP W !,?3," Admission Source  : " S IBX=$$EXTERNAL^DILFD(399,159,,$P(IB("U"),U,9)) W $S(IBX'="":IBX,1:IBU)   ; Outpatient only
"RTN","IBCSC102",71,0)
 ;
"RTN","IBCSC102",72,0)
 ; Section 2
"RTN","IBCSC102",73,0)
 S Z=2,IBW=1 X IBWW
"RTN","IBCSC102",74,0)
 S PRVS=$TR($P(IB("U3"),U,8,10),U) W " Pt Reason f/Visit : " I PRVS="" W IBU_$S(IBINP:" [NOT USED]",1:"")
"RTN","IBCSC102",75,0)
 I PRVS'="" S FIRSTPRV=1 F I=8:1:10 D
"RTN","IBCSC102",76,0)
 .S PRV=$$ICD9^IBACSV($P(IB("U3"),U,I),$$BDATE^IBACSV(IBIFN)) I PRV'="" W:'FIRSTPRV !,?24 W $P(PRV,U,3)_" - "_$P(PRV,U) S FIRSTPRV=0
"RTN","IBCSC102",77,0)
 .Q
"RTN","IBCSC102",78,0)
 ;
"RTN","IBCSC102",79,0)
 ; Section 3
"RTN","IBCSC102",80,0)
 S Z=3,IBW=1 X IBWW
"RTN","IBCSC102",81,0)
 W " Providers         : ",$S('$O(IB("PRV",0)):IBU,1:"")
"RTN","IBCSC102",82,0)
 I $D(IB("PRV")) D
"RTN","IBCSC102",83,0)
 . N Z,IBT,IBQ,IBARR,IBTAX,IBNOTAX,IBSPEC,IBNOSPEC
"RTN","IBCSC102",84,0)
 . S IBZ=0
"RTN","IBCSC102",85,0)
 . D DEFSEC^IBCEF74(IBIFN,.IBARR)
"RTN","IBCSC102",86,0)
 . ; PRXM/KJH - Add Taxonomy code to display for patch 343. Moved secondary IDs slightly (below).
"RTN","IBCSC102",87,0)
 . S IBTAX=$$PROVTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCSC102",88,0)
 . S IBSPEC=$$SPECTAX^IBCEF73A(IBIFN,.IBNOSPEC)
"RTN","IBCSC102",89,0)
 . F  S IBZ=$O(IB("PRV",IBZ)) Q:'IBZ  D
"RTN","IBCSC102",90,0)
 .. N A,A1
"RTN","IBCSC102",91,0)
 .. S IBQ=""
"RTN","IBCSC102",92,0)
 .. W !,?5,"- "
"RTN","IBCSC102",93,0)
 .. S A=$$EXPAND^IBTRE(399.0222,.01,IBZ)
"RTN","IBCSC102",94,0)
 .. I $P($G(IB("PRV",IBZ,1)),U,4)'="" S A1=" ("_$E($P(IB("PRV",IBZ,1),U,4),1,3)_")",A=$E(A,1,15-$L(A1))_A1
"RTN","IBCSC102",95,0)
 .. W $E(A_$J("",15),1,15),": "
"RTN","IBCSC102",96,0)
 .. I '$P($G(IB("PRV",IBZ,1)),U,3),$P($G(IB("PRV",IBZ,1)),U)="" W IBU Q
"RTN","IBCSC102",97,0)
 .. I $P($G(IB("PRV",IBZ,1)),U)'="" W:'$G(IB("PRV",IBZ)) $E($P(IB("PRV",IBZ,1),U)_$J("",20),1,20) W:$G(IB("PRV",IBZ)) "(OLD PROV DATA) "_$P(IB("PRV",IBZ,1),U)
"RTN","IBCSC102",98,0)
 .. I $P($G(IB("PRV",IBZ,1)),U)="",$P($G(IB("PRV",IBZ)),U)'="" W $E($P(IB("PRV",IBZ),U)_$J("",20),1,20)
"RTN","IBCSC102",99,0)
 .. W "    Taxonomy: ",$S($P(IBTAX,U,IBZ)'="":$P(IBTAX,U,IBZ),1:IBU),$S($P(IBSPEC,U,IBZ)'="":" ("_$P(IBSPEC,U,IBZ)_")",1:"")
"RTN","IBCSC102",100,0)
 .. F A=1:1:3 I $G(IBARR(IBZ,A))'="" S IBQ=IBQ_"["_$E("PST",A)_"]"_IBARR(IBZ,A)_" "
"RTN","IBCSC102",101,0)
 .. I $L(IBQ) W !,?30,$E(IBQ,1,49)
"RTN","IBCSC102",102,0)
 K IB("PRV")
"RTN","IBCSC102",103,0)
 ;
"RTN","IBCSC102",104,0)
 ; Section 4
"RTN","IBCSC102",105,0)
 S Z=4,IBW=1 X IBWW
"RTN","IBCSC102",106,0)
 W " Other Facility (VA/non): " S IBZ=$$EXPAND^IBTRE(399,232,+$P(IB("U2"),U,10))
"RTN","IBCSC102",107,0)
 W $S(IBZ'="":$E(IBZ,1,23),$$PSRV^IBCEU(IBIFN):IBU,1:IBUN)
"RTN","IBCSC102",108,0)
 I IBZ'="" D
"RTN","IBCSC102",109,0)
 . ; PRXM/KJH - Add Taxonomy code to display for patch 343.
"RTN","IBCSC102",110,0)
 . W ?53,"Taxonomy: "
"RTN","IBCSC102",111,0)
 . S IBZ=$$GET1^DIQ(8932.1,+$P(IB("U3"),U,3),"X12 CODE") W $S(IBZ'="":IBZ,1:IBU)
"RTN","IBCSC102",112,0)
 . S IBZ=$$GET1^DIQ(8932.1,+$P(IB("U3"),U,3),"SPECIALTY CODE") W $S(IBZ'="":" ("_IBZ_")",1:"")
"RTN","IBCSC102",113,0)
 . Q
"RTN","IBCSC102",114,0)
 ;
"RTN","IBCSC102",115,0)
 ; Section 5
"RTN","IBCSC102",116,0)
 S Z=5,IBW=1 X IBWW
"RTN","IBCSC102",117,0)
 W " Billing Provider  : "
"RTN","IBCSC102",118,0)
 K IBZ
"RTN","IBCSC102",119,0)
 S BPZ=+$$B^IBCEF79(IBIFN)
"RTN","IBCSC102",120,0)
 D GETBP^IBCEF79(IBIFN,"",BPZ,"UB SCREEN 8",.IBZ)
"RTN","IBCSC102",121,0)
 S TXMT=$$TXMT^IBCEF4(IBIFN)    ; transmittable?  variable also used in next section
"RTN","IBCSC102",122,0)
 I TXMT S IBZ=$G(IBZ("UB SCREEN 8","NAME"))     ; this is the BP name used in the PRV segment
"RTN","IBCSC102",123,0)
 I 'TXMT S IBZ=$$GETFAC^IBCEP8(BPZ,0,0)         ; this is the BP name printed in FL-1
"RTN","IBCSC102",124,0)
 W $S(IBZ'="":IBZ,1:IBU)                        ; billing provider name
"RTN","IBCSC102",125,0)
 W !?3," Taxonomy Code     : "
"RTN","IBCSC102",126,0)
 S IBZ=$$GET1^DIQ(8932.1,+$P(IB("U3"),U,11),"X12 CODE") W $S(IBZ'="":IBZ,1:IBU)
"RTN","IBCSC102",127,0)
 S IBZ=$$GET1^DIQ(8932.1,+$P(IB("U3"),U,11),"SPECIALTY CODE") W $S(IBZ'="":" ("_IBZ_")",1:"")
"RTN","IBCSC102",128,0)
 ;
"RTN","IBCSC102",129,0)
 ; Section 6
"RTN","IBCSC102",130,0)
 S IBREQ=+$$REQMRA^IBEFUNC(IBIFN) S:IBREQ IBREQ=1
"RTN","IBCSC102",131,0)
 S IBMRASEC=$$MRASEC^IBCEF4(IBIFN)
"RTN","IBCSC102",132,0)
 S Z=6,IBW=1 X IBWW W " ",$S('IBREQ:"Force To Print?   : ",1:"Force MRA Sec Prt?: ")
"RTN","IBCSC102",133,0)
 S IBZ=$$EXTERNAL^DILFD(399,27+IBREQ,,+$P(IB("TX"),U,8+IBREQ))
"RTN","IBCSC102",134,0)
 I IBMRASEC,'$P(IB("TX"),U,8),$P(IB("TX"),U,9) S IBZ="FORCED TO PRINT BY MRA PRIMARY",$P(IB("TX"),U,8)=0
"RTN","IBCSC102",135,0)
 W $S(IBZ'=""&($P(IB("TX"),U,8+IBREQ)'=""):IBZ,'TXMT:"[NOT APPLICABLE - NOT TRANSMITTABLE]",IBREQ:"NO FORCED PRINT",1:IBZ)
"RTN","IBCSC102",136,0)
 ;
"RTN","IBCSC102",137,0)
 ; Section 7
"RTN","IBCSC102",138,0)
 S Z=7,IBW=1 X IBWW
"RTN","IBCSC102",139,0)
 W " Provider ID Maint : (Edit Provider ID information)"
"RTN","IBCSC102",140,0)
 ;
"RTN","IBCSC102",141,0)
 G ^IBCSCP
"RTN","IBCSC102",142,0)
Q Q
"RTN","IBCSC102",143,0)
 ;IBCSC102
"RTN","IBCSC10A")
0^34^B7774728^n/a
"RTN","IBCSC10A",1,0)
IBCSC10A ;BP/YMG - ADD/ENTER CHIROPRACTIC DATA ;06/08/2007
"RTN","IBCSC10A",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCSC10A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC10A",4,0)
 ;
"RTN","IBCSC10A",5,0)
 ; DEM;432 - Moved IBCSC8* billing screen routines to IBCSC10* billing screen
"RTN","IBCSC10A",6,0)
 ;           routines and created a new billing screen 8 routine IBCSC8.
"RTN","IBCSC10A",7,0)
 ;
"RTN","IBCSC10A",8,0)
EN ;
"RTN","IBCSC10A",9,0)
 N DAM,DIT,EC,LXD,OK,PCC,PCCI,UO,UR
"RTN","IBCSC10A",10,0)
 S UO="UNSPECIFIED [OPTIONAL]",UR="UNSPECIFIED [REQUIRED]"
"RTN","IBCSC10A",11,0)
 S EC="000"
"RTN","IBCSC10A",12,0)
EN1 ;
"RTN","IBCSC10A",13,0)
 S OK=1
"RTN","IBCSC10A",14,0)
 S DIT=$$GET1^DIQ(399,IBIFN,246) S:DIT="" DIT=UR
"RTN","IBCSC10A",15,0)
 S PCCI=$P($G(^DGCR(399,IBIFN,"U3")),U,7)
"RTN","IBCSC10A",16,0)
 S PCC=$S(PCCI'="":PCCI_" ("_$$EXTERNAL^DILFD(399,248,"",PCCI)_")",1:UR)
"RTN","IBCSC10A",17,0)
 S DAM=$$GET1^DIQ(399,IBIFN,247) S:DAM="" DAM=$S("AM"'[PCCI!(PCCI=""):UO,1:UR)
"RTN","IBCSC10A",18,0)
 S LXD=$$GET1^DIQ(399,IBIFN,245) S:LXD="" LXD=UO
"RTN","IBCSC10A",19,0)
 D DISP,EDIT G:'OK EN1
"RTN","IBCSC10A",20,0)
 D CLEAN^DILF
"RTN","IBCSC10A",21,0)
 Q
"RTN","IBCSC10A",22,0)
 ;
"RTN","IBCSC10A",23,0)
DISP ; display existing values
"RTN","IBCSC10A",24,0)
 W @IOF,!,"============================= CHIROPRACTIC DATA ==============================",!
"RTN","IBCSC10A",25,0)
 D:+EC DSPERR
"RTN","IBCSC10A",26,0)
 W !!,?3,"----------------------  Current values for Bill  -----------------------",!
"RTN","IBCSC10A",27,0)
 W !,?3,"Date of initial treatment   : ",DIT
"RTN","IBCSC10A",28,0)
 W !,?3,"Patient condition code      : ",PCC
"RTN","IBCSC10A",29,0)
 W !,?3,"Date of acute manifestation : ",DAM
"RTN","IBCSC10A",30,0)
 W !,?3,"Last x-ray date             : ",LXD,!
"RTN","IBCSC10A",31,0)
 Q
"RTN","IBCSC10A",32,0)
 ;
"RTN","IBCSC10A",33,0)
EDIT ; edit data
"RTN","IBCSC10A",34,0)
 N DEL,TOUT,UOUT
"RTN","IBCSC10A",35,0)
 S DIE="^DGCR(399,",DR="246;248;247;245",DA=IBIFN D ^DIE S TOUT=$D(DTOUT),UOUT=$D(Y) K DIE,DR,DA D CHK
"RTN","IBCSC10A",36,0)
 ; if all data is valid, we are done here
"RTN","IBCSC10A",37,0)
 Q:'+EC
"RTN","IBCSC10A",38,0)
 ; we get here if:
"RTN","IBCSC10A",39,0)
 ; - all prompts have been answered, but data is invalid, or
"RTN","IBCSC10A",40,0)
 ; - editing was interrupted by user ("^" exit), or
"RTN","IBCSC10A",41,0)
 ; - editing timed out
"RTN","IBCSC10A",42,0)
 ;
"RTN","IBCSC10A",43,0)
 ;if "^"-exit and user doesn't want to discard data, or all prompts answered, go back to the same screen
"RTN","IBCSC10A",44,0)
 I 'TOUT S DEL=1 D  I DEL=0!('UOUT) S OK=0 Q
"RTN","IBCSC10A",45,0)
 .; if "^"-exit, ask if data should be discarded
"RTN","IBCSC10A",46,0)
 .I UOUT S DIR(0)="Y",DIR("A")="Delete Chiropractic Data",DIR("B")="YES" D ^DIR S DEL=$G(Y) K DIR
"RTN","IBCSC10A",47,0)
 .Q
"RTN","IBCSC10A",48,0)
 ; if user requested to delete data or entry prompt timed out, clear out chiro fields
"RTN","IBCSC10A",49,0)
 S DIE="^DGCR(399,",DR="246///@;248///@;247///@;245///@",DA=IBIFN D ^DIE K DIE,DR,DA
"RTN","IBCSC10A",50,0)
 Q
"RTN","IBCSC10A",51,0)
 ;
"RTN","IBCSC10A",52,0)
CHK ; check data integrity
"RTN","IBCSC10A",53,0)
 ; sets 3 char error code in EC, each position containing 0 means no error
"RTN","IBCSC10A",54,0)
 ; positions containing 1 trigger the following errors:
"RTN","IBCSC10A",55,0)
 ; position 1 - Date of Initial Treatment is missing
"RTN","IBCSC10A",56,0)
 ; position 2 - Patient Condition Code is missing
"RTN","IBCSC10A",57,0)
 ; position 3 - Date of Acute manifestation is missing (for Patient Condition Code = A or M)
"RTN","IBCSC10A",58,0)
 N IBX,PCC
"RTN","IBCSC10A",59,0)
 S IBX=$P($G(^DGCR(399,IBIFN,"U3")),U,4,7),EC="000"
"RTN","IBCSC10A",60,0)
 ; chiropractic claim if any of the fields are populated
"RTN","IBCSC10A",61,0)
 S:$TR(IBX,U)'="" PCC=$P(IBX,U,4),$E(EC,1)=($P(IBX,U,2)=""),$E(EC,2)=(PCC=""),$E(EC,3)=($P(IBX,U,3)=""&(PCC]"")&("AM"[PCC))
"RTN","IBCSC10A",62,0)
 Q
"RTN","IBCSC10A",63,0)
DSPERR ; display errors
"RTN","IBCSC10A",64,0)
 W !,?3,"Errors detected:"
"RTN","IBCSC10A",65,0)
 W:+$E(EC,1) !,?5,"Date of Initial Treatment is required"
"RTN","IBCSC10A",66,0)
 W:+$E(EC,2) !,?5,"Patient Condition Code is required"
"RTN","IBCSC10A",67,0)
 W:+$E(EC,3) !,?5,"Condition code A or M requires Date of Acute Manifestation"
"RTN","IBCSC10A",68,0)
 Q
"RTN","IBCSC10B")
0^35^B42359591^n/a
"RTN","IBCSC10B",1,0)
IBCSC10B ;BP/YMG - ADD/ENTER PATIENT REASON FOR VISIT DATA ;10/15/2008
"RTN","IBCSC10B",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCSC10B",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC10B",4,0)
 ;
"RTN","IBCSC10B",5,0)
 ; DEM;432 - Moved IBCSC8* billing screen routines to IBCSC10* billing screen
"RTN","IBCSC10B",6,0)
 ;           routines and created a new billing screen 8 routine IBCSC8.
"RTN","IBCSC10B",7,0)
 ;
"RTN","IBCSC10B",8,0)
EN ; entry point
"RTN","IBCSC10B",9,0)
 N DATE,DATE1,DFN,I,IBDX,IBLIST,LOC,PRV0,PRVIEN,PRVS,SCREEN,TCNT,TMP,VCNT,VISITS
"RTN","IBCSC10B",10,0)
 D:$$CHKPRV<3 DELALL(IBIFN)
"RTN","IBCSC10B",11,0)
 ; only try to fetch PRVs if Quadramed file (19640.11) exists
"RTN","IBCSC10B",12,0)
 I $D(^DSIPPRV) D
"RTN","IBCSC10B",13,0)
 .S DFN=$P(^DGCR(399,IBIFN,0),U,2)
"RTN","IBCSC10B",14,0)
 .; try to get all visits for OP Visit dates on the claim
"RTN","IBCSC10B",15,0)
 .;
"RTN","IBCSC10B",16,0)
 .; use only the date portion of date&time field in VISIT file for screening
"RTN","IBCSC10B",17,0)
 .; if OP Visit field contains only a month, only compare month and year
"RTN","IBCSC10B",18,0)
 .S SCREEN="N Z S Z=$P($P(^(0),U),""."") S:'+$E(DATE,6,7) Z=$E(Z,1,5) I Z=DATE"
"RTN","IBCSC10B",19,0)
 .S DATE=0,VCNT=1 F  S DATE=$O(^DGCR(399,IBIFN,"OP",DATE)) Q:'DATE  D
"RTN","IBCSC10B",20,0)
 ..D FIND^DIC(9000010,,"@;.01I","QPX",DFN,,"C",SCREEN,,"TMP") Q:'$P(TMP("DILIST",0),U)
"RTN","IBCSC10B",21,0)
 ..S TCNT=0 F  S TCNT=$O(TMP("DILIST",TCNT)) Q:'TCNT  S VISITS(VCNT)=$P(TMP("DILIST",TCNT,0),U),VCNT=VCNT+1
"RTN","IBCSC10B",22,0)
 ..Q
"RTN","IBCSC10B",23,0)
 .I '$D(VISITS) D
"RTN","IBCSC10B",24,0)
 ..; couldn't find anything for OP Visit dates (or there are no OP Visit dates on the claim)
"RTN","IBCSC10B",25,0)
 ..; try to use Statement Covers From and Statement Covers To fields instead
"RTN","IBCSC10B",26,0)
 ..S DATE=$P($G(^DGCR(399,IBIFN,"U")),U) Q:'DATE  ;
"RTN","IBCSC10B",27,0)
 ..S DATE1=$P($G(^DGCR(399,IBIFN,"U")),U,2) Q:'DATE1  ;
"RTN","IBCSC10B",28,0)
 ..S SCREEN="N Z S Z=$P($P(^(0),U),""."") I Z>=DATE&(Z<=DATE1)"
"RTN","IBCSC10B",29,0)
 ..D FIND^DIC(9000010,,"@;.01I","QPX",DFN,,"C",SCREEN,,"TMP") Q:'$P(TMP("DILIST",0),U)
"RTN","IBCSC10B",30,0)
 ..S TCNT=0,VCNT=1 F  S TCNT=$O(TMP("DILIST",TCNT)) Q:'TCNT  S VISITS(VCNT)=$P(TMP("DILIST",TCNT,0),U),VCNT=VCNT+1
"RTN","IBCSC10B",31,0)
 ..Q
"RTN","IBCSC10B",32,0)
 .I $D(VISITS) D
"RTN","IBCSC10B",33,0)
 ..; we have found some visits, try to fetch corresponding PRVs from file 19640.11 into PRVS array
"RTN","IBCSC10B",34,0)
 ..; PRVS node structure: PRV dx ien ^ hospital location ^ visit date&time
"RTN","IBCSC10B",35,0)
 ..S TCNT=1,VCNT=0 F  S VCNT=$O(VISITS(VCNT)) Q:'VCNT  D
"RTN","IBCSC10B",36,0)
 ...S PRVIEN=$O(^DSIPPRV("B",VISITS(VCNT),"")) Q:'PRVIEN
"RTN","IBCSC10B",37,0)
 ...S PRV0=$G(^DSIPPRV(PRVIEN,0))
"RTN","IBCSC10B",38,0)
 ...S LOC=$$GET1^DIQ(9000010,VISITS(VCNT),.22)
"RTN","IBCSC10B",39,0)
 ...S DATE=$$GET1^DIQ(9000010,VISITS(VCNT),.01)
"RTN","IBCSC10B",40,0)
 ...F I=2:1:4 I $P(PRV0,U,I)'="" S PRVS(TCNT)=$P(PRV0,U,I)_U_LOC_U_DATE,TCNT=TCNT+1
"RTN","IBCSC10B",41,0)
 ...Q
"RTN","IBCSC10B",42,0)
 ..Q
"RTN","IBCSC10B",43,0)
 .Q
"RTN","IBCSC10B",44,0)
 D DISP D:+$G(TCNT)>0 NEWDX(TCNT-1) I $D(IBLIST) D ADDNEW
"RTN","IBCSC10B",45,0)
 D DISPEX(IBIFN)
"RTN","IBCSC10B",46,0)
 D CLEAN^DILF
"RTN","IBCSC10B",47,0)
EN1 ;
"RTN","IBCSC10B",48,0)
 S IBDX=$$ASKDX I +IBDX>0 D ADD($P(IBDX,U)),EDIT(+IBDX) G EN1
"RTN","IBCSC10B",49,0)
 Q
"RTN","IBCSC10B",50,0)
 ;
"RTN","IBCSC10B",51,0)
DISP ; display PRV diagnoses
"RTN","IBCSC10B",52,0)
 N CNT,DXCODE,I,IBDX,PRV
"RTN","IBCSC10B",53,0)
 W @IOF,!,"===================Pt. Reason for Visit Diagnosis Screen ====================",!
"RTN","IBCSC10B",54,0)
 I '$D(PRVS) W !,?13,"No available Pt. Reason for Visit Diagnoses found." Q
"RTN","IBCSC10B",55,0)
 S CNT=0 F  S CNT=$O(PRVS(CNT)) Q:'CNT  D
"RTN","IBCSC10B",56,0)
 .S IBDX=$$ICD9^IBACSV($P(PRVS(CNT),U),$$BDATE^IBACSV(IBIFN)),DXCODE=$P(IBDX,U)
"RTN","IBCSC10B",57,0)
 .F I=8:1:10 S PRV=$P($G(^DGCR(399,IBIFN,"U3")),U,I) I PRV=+PRVS(CNT) S DXCODE="*"_DXCODE Q
"RTN","IBCSC10B",58,0)
 .W !,$J(CNT,2),")",?4,DXCODE,?13,$E($P(IBDX,U,3),1,24),?37,$E($P(PRVS(CNT),U,2),1,24),?62,$P(PRVS(CNT),U,3)
"RTN","IBCSC10B",59,0)
 .Q
"RTN","IBCSC10B",60,0)
 Q
"RTN","IBCSC10B",61,0)
 ;
"RTN","IBCSC10B",62,0)
DISPEX(IBIFN) ; display existing PRV diagnoses for a bill
"RTN","IBCSC10B",63,0)
 N I,IBDX,IBDXDT
"RTN","IBCSC10B",64,0)
 W !!,?5,"------  Existing Pt. Reason for Visit Diagnoses for Bill  -------",!
"RTN","IBCSC10B",65,0)
 F I=8:1:10 S IBDX=$P($G(^DGCR(399,IBIFN,"U3")),U,I) I IBDX'="" D
"RTN","IBCSC10B",66,0)
 .S IBDXDT=$$ICD9^IBACSV(IBDX,$$BDATE^IBACSV(IBIFN))
"RTN","IBCSC10B",67,0)
 .W !,?12,$P(IBDXDT,U),?26,$P(IBDXDT,U,3)
"RTN","IBCSC10B",68,0)
 .Q
"RTN","IBCSC10B",69,0)
 W:'$G(IBDXDT) !,?13,"No existing Pt. Reason for Visit Diagnoses found."
"RTN","IBCSC10B",70,0)
 W !
"RTN","IBCSC10B",71,0)
 Q
"RTN","IBCSC10B",72,0)
 ;
"RTN","IBCSC10B",73,0)
CHKPRV() ; check how many PRVs are not populated (out of 3)
"RTN","IBCSC10B",74,0)
 N CNT,I
"RTN","IBCSC10B",75,0)
 S CNT=3 F I=8:1:10 I $P($G(^DGCR(399,IBIFN,"U3")),U,I)'="" S CNT=CNT-1
"RTN","IBCSC10B",76,0)
 Q CNT
"RTN","IBCSC10B",77,0)
 ;
"RTN","IBCSC10B",78,0)
PRVFLD(DXIEN) ; returns the field number that contains DXIEN
"RTN","IBCSC10B",79,0)
 ; if DXIEN="", returns the first empty PRV field number
"RTN","IBCSC10B",80,0)
 ; if no match found (or no empty fields), returns 0
"RTN","IBCSC10B",81,0)
 N I,FLD
"RTN","IBCSC10B",82,0)
 S FLD=0 F I=8:1:10 I $P($G(^DGCR(399,IBIFN,"U3")),U,I)=DXIEN S FLD=I+241 Q
"RTN","IBCSC10B",83,0)
 Q FLD
"RTN","IBCSC10B",84,0)
 ;
"RTN","IBCSC10B",85,0)
ERR ; display error message
"RTN","IBCSC10B",86,0)
 W !,?6,"You may add a maximum of 3 PRV diagnoses to a claim."
"RTN","IBCSC10B",87,0)
 Q
"RTN","IBCSC10B",88,0)
 ;
"RTN","IBCSC10B",89,0)
NEWDX(IBX) ; select PRV diagnosis to add to bill
"RTN","IBCSC10B",90,0)
 ; IBX - max. number of PRV diagnoses available
"RTN","IBCSC10B",91,0)
 N X,Y,DIR,DIRUT
"RTN","IBCSC10B",92,0)
 Q:'IBX!('$$CHKPRV)  ;
"RTN","IBCSC10B",93,0)
 W !
"RTN","IBCSC10B",94,0)
NEWDX1 S DIR("?",1)="Enter the number preceding the PRV diagnosis you want added to the bill.",DIR("?")="Multiple entries may be added separated by commas or ranges separated by a dash."
"RTN","IBCSC10B",95,0)
 S DIR("A")="Select Pt. Reason for Visit Diagnosis to add to bill"
"RTN","IBCSC10B",96,0)
 S DIR(0)="LO^1:"_+IBX D ^DIR K DIR G:'Y!$D(DIRUT) NEWDXE
"RTN","IBCSC10B",97,0)
 S IBLIST=Y
"RTN","IBCSC10B",98,0)
 S DIR("A")="You have selected "_IBLIST_" to be added to the bill. Is this correct",DIR("B")="YES"
"RTN","IBCSC10B",99,0)
 S DIR(0)="YO" D ^DIR K DIR I $D(DIRUT) K IBLIST G NEWDXE
"RTN","IBCSC10B",100,0)
 I 'Y G NEWDX1
"RTN","IBCSC10B",101,0)
 I $L(IBLIST,",")-1>$$CHKPRV D ERR G NEWDX1
"RTN","IBCSC10B",102,0)
NEWDXE Q
"RTN","IBCSC10B",103,0)
 ;
"RTN","IBCSC10B",104,0)
ADD(DXIEN) ; add single PRV diagnosis with file 80 ien DXIEN to the bill
"RTN","IBCSC10B",105,0)
 Q:'DXIEN!$$PRVFLD(DXIEN)  ; quit if no dx ien of if such PRV already exists
"RTN","IBCSC10B",106,0)
 N FLD
"RTN","IBCSC10B",107,0)
 ; if there are already 3 PRVs on the claim, complain and bail out
"RTN","IBCSC10B",108,0)
 I '$$CHKPRV D ERR Q
"RTN","IBCSC10B",109,0)
 S FLD=$$PRVFLD("") I FLD S DIE="^DGCR(399,",DA=IBIFN,DR=FLD_"////"_DXIEN D ^DIE K DA,DIE
"RTN","IBCSC10B",110,0)
 Q
"RTN","IBCSC10B",111,0)
 ;
"RTN","IBCSC10B",112,0)
ADDNEW ; add selected PRV diagnoses to the bill
"RTN","IBCSC10B",113,0)
 Q:'$D(PRVS)
"RTN","IBCSC10B",114,0)
 N I,IBX
"RTN","IBCSC10B",115,0)
 F I=1:1 S IBX=$P(IBLIST,",",I) Q:'IBX  I $D(PRVS(IBX)) D ADD(+PRVS(IBX))
"RTN","IBCSC10B",116,0)
 Q
"RTN","IBCSC10B",117,0)
 ;
"RTN","IBCSC10B",118,0)
ASKDX() ; enter extra PRV diagnosis
"RTN","IBCSC10B",119,0)
 ; returns dx ien in file 80 ^ dx code
"RTN","IBCSC10B",120,0)
 N X,Y,IBDATE,IBDTTX
"RTN","IBCSC10B",121,0)
 S IBDATE=$$BDATE^IBACSV(IBIFN)
"RTN","IBCSC10B",122,0)
 S IBDTTX=$$DAT1^IBOUTL(IBDATE)
"RTN","IBCSC10B",123,0)
AD ;
"RTN","IBCSC10B",124,0)
 S DIR("?")="Enter a diagnosis for this bill. Only diagnosis codes active on "_IBDTTX_" are allowed."
"RTN","IBCSC10B",125,0)
 S DIR(0)="PO^80:EAMQ",DIR("A")="Enter Pt. Reason for Visit Diagnosis"
"RTN","IBCSC10B",126,0)
 D ^DIR K DIR
"RTN","IBCSC10B",127,0)
 I Y>0,'$$PRVFLD(+Y),'$$ICD9ACT^IBACSV(+Y,IBDATE) D  G AD
"RTN","IBCSC10B",128,0)
 . W !!,*7,"The Diagnosis code is inactive for the date of service ("_IBDTTX_").",!
"RTN","IBCSC10B",129,0)
 Q Y
"RTN","IBCSC10B",130,0)
 ;
"RTN","IBCSC10B",131,0)
EDIT(DXIEN) ; edit/delete PRV diagnosis
"RTN","IBCSC10B",132,0)
 N IBU3,FLD,PRV2,PRV3
"RTN","IBCSC10B",133,0)
 Q:'DXIEN  S FLD=$$PRVFLD(DXIEN) I FLD S DIE="^DGCR(399,",DA=IBIFN,DR=FLD D ^DIE K DIE,DR,DA
"RTN","IBCSC10B",134,0)
 ; if PRV was deleted, rearrange PRVs to maintain their order of entry
"RTN","IBCSC10B",135,0)
 S IBU3=$G(^DGCR(399,IBIFN,"U3")) I $P(IBU3,U,FLD-241)="" D
"RTN","IBCSC10B",136,0)
 .; PRV(1) was deleted, PRV(2) is not empty
"RTN","IBCSC10B",137,0)
 .I FLD=249 S PRV2=$P(IBU3,U,9) S:PRV2'="" PRV3=$P(IBU3,U,10),DR="249////"_PRV2_";"_$S(PRV3'="":"250////"_PRV3_";251///@",1:"250///@")
"RTN","IBCSC10B",138,0)
 .; PRV(2) was deleted, PRV(3) is not empty
"RTN","IBCSC10B",139,0)
 .I FLD=250 S PRV3=$P(IBU3,U,10) I PRV3'="" S DR="250////"_PRV3_";251///@"
"RTN","IBCSC10B",140,0)
 .; if PRV(3) is deleted, no rearrangements are necessary
"RTN","IBCSC10B",141,0)
 .Q
"RTN","IBCSC10B",142,0)
 I $G(DR)'="" S DIE="^DGCR(399,",DA=IBIFN D ^DIE K DIE,DR,DA
"RTN","IBCSC10B",143,0)
 Q
"RTN","IBCSC10B",144,0)
 ;
"RTN","IBCSC10B",145,0)
DELALL(IBIFN) ; ask/delete all PRV diagnoses on the bill
"RTN","IBCSC10B",146,0)
 N DIE,DA,DR,DIR,DIRUT,DUOUT,DTOUT,X,Y W !
"RTN","IBCSC10B",147,0)
 S DIR("?")="Enter Yes to delete all PRV diagnoses currently defined for a bill.",DIR("??")="^D DISPEX^IBCSC10B("_IBIFN_")"
"RTN","IBCSC10B",148,0)
 S DIR("A")="Delete all Patient Reason for Visit diagnoses on bill"
"RTN","IBCSC10B",149,0)
 S DIR(0)="YO",DIR("B")="NO" D ^DIR K DIR Q:Y'=1
"RTN","IBCSC10B",150,0)
 ;
"RTN","IBCSC10B",151,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="249///@;250///@;251///@" D ^DIE
"RTN","IBCSC10B",152,0)
 W " .... deleted"
"RTN","IBCSC10B",153,0)
 Q
"RTN","IBCSC10H")
0^36^B48673264^n/a
"RTN","IBCSC10H",1,0)
IBCSC10H ;ALB/ARH - MCCR SCREEN 10 (BILL SPECIFIC INFO) CMS-1500 ;4/21/92
"RTN","IBCSC10H",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCSC10H",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC10H",4,0)
 ; CMS-1500 screen 10
"RTN","IBCSC10H",5,0)
 ;
"RTN","IBCSC10H",6,0)
 ; MAP TO DGCRSC8H
"RTN","IBCSC10H",7,0)
 ;
"RTN","IBCSC10H",8,0)
 ; DEM;432 - Moved IBCSC8* billing screen routines to IBCSC10* billing screen
"RTN","IBCSC10H",9,0)
 ;           routines and created a new billing screen 8 routine IBCSC8.
"RTN","IBCSC10H",10,0)
 ;
"RTN","IBCSC10H",11,0)
EN ;
"RTN","IBCSC10H",12,0)
 N I,IB,Y,Z
"RTN","IBCSC10H",13,0)
 D ^IBCSCU
"RTN","IBCSC10H",14,0)
 S IBSR=10,IBSR1="H",IBV1="000000000" S:IBV IBV1="111111111"
"RTN","IBCSC10H",15,0)
 F I="U","U1","UF2","UF3","UF32","U2","M","TX",0,"U3" S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBCSC10H",16,0)
 N IBZ,IBPRV,IBDATE,IBREQ,IBMRASEC,IBZ1,IBZCNT
"RTN","IBCSC10H",17,0)
 ;
"RTN","IBCSC10H",18,0)
 S IBDATE=$$BDATE^IBACSV(IBIFN) ; Date of service for the bill
"RTN","IBCSC10H",19,0)
 S IBPRV=""
"RTN","IBCSC10H",20,0)
 D GETPRV^IBCEU(IBIFN,"ALL",.IBPRV)
"RTN","IBCSC10H",21,0)
 K IB("PRV")
"RTN","IBCSC10H",22,0)
 S IBZ=0 F  S IBZ=$O(IBPRV(IBZ)) Q:'IBZ  I $O(IBPRV(IBZ,0))!$D(IBPRV(IBZ,"NOTOPT")) M IB("PRV",IBZ)=IBPRV(IBZ)
"RTN","IBCSC10H",23,0)
 ;
"RTN","IBCSC10H",24,0)
 D H^IBCSCU
"RTN","IBCSC10H",25,0)
 ;
"RTN","IBCSC10H",26,0)
 ; Section 1
"RTN","IBCSC10H",27,0)
 S Z=1,IBW=1 X IBWW W " Unable To Work From: " S Y=$P(IB("U"),U,16) X ^DD("DD") W $S(Y'="":Y,1:IBUN)
"RTN","IBCSC10H",28,0)
 W !?4,"Unable To Work To  : " S Y=$P(IB("U"),U,17) X ^DD("DD") W $S(Y'="":Y,1:IBUN)
"RTN","IBCSC10H",29,0)
 ;
"RTN","IBCSC10H",30,0)
 ; Section 2
"RTN","IBCSC10H",31,0)
 S Z=2,IBW=1 X IBWW I $$INPAT^IBCEF(IBIFN) W " Admitting Dx       : " S IBZ=$$ICD9^IBACSV(+IB("U2"),IBDATE) W $S(IBZ'="":$P(IBZ,U)_" - "_$P(IBZ,U,3),1:IBUN),!
"RTN","IBCSC10H",32,0)
 S IBZCNT=0,IBZ(IBZCNT)=""
"RTN","IBCSC10H",33,0)
 I $P(IB("UF3"),U,4)]"" S IBZ(IBZCNT)="P: "_$P(IB("UF3"),U,4),IBZCNT=IBZCNT+1
"RTN","IBCSC10H",34,0)
 I $P(IB("UF3"),U,5)]"" S IBZ(IBZCNT)="S: "_$P(IB("UF3"),U,5),IBZCNT=IBZCNT+1
"RTN","IBCSC10H",35,0)
 I $P(IB("UF3"),U,6)]"" S IBZ(IBZCNT)="T: "_$P(IB("UF3"),U,6)
"RTN","IBCSC10H",36,0)
 S:IBZ(0)="" IBZ(0)=IBUN
"RTN","IBCSC10H",37,0)
 W ?4,"ICN/DCN(s)         : ",IBZ(0)
"RTN","IBCSC10H",38,0)
 F IBZCNT=1:1 Q:'$D(IBZ(IBZCNT))  W !?25,IBZ(IBZCNT)
"RTN","IBCSC10H",39,0)
 K IBZ
"RTN","IBCSC10H",40,0)
 S IBZ=$$CKPROV^IBCEU(IBIFN,3)
"RTN","IBCSC10H",41,0)
 S IBZCNT=0,IBZ(IBZCNT)=""
"RTN","IBCSC10H",42,0)
 I $P(IB("U"),U,13)]"" S IBZ(IBZCNT)="P: "_$P(IB("U"),U,13),IBZCNT=IBZCNT+1
"RTN","IBCSC10H",43,0)
 I $P(IB("U2"),U,8)'="" S IBZ(IBZCNT)="S: "_$P(IB("U2"),U,8),IBZCNT=IBZCNT+1
"RTN","IBCSC10H",44,0)
 I $P(IB("U2"),U,9)'="" S IBZ(IBZCNT)="T: "_$P(IB("U2"),U,9),IBZCNT=IBZCNT+1
"RTN","IBCSC10H",45,0)
 I $P(IB("UF32"),U,1)'="" S IBZ(IBZCNT)="P: "_$P(IB("UF32"),U,1),IBZCNT=IBZCNT+1
"RTN","IBCSC10H",46,0)
 I $P(IB("UF32"),U,2)'="" S IBZ(IBZCNT)="S: "_$P(IB("UF32"),U,2),IBZCNT=IBZCNT+1
"RTN","IBCSC10H",47,0)
 I $P(IB("UF32"),U,3)'="" S IBZ(IBZCNT)="T: "_$P(IB("UF32"),U,3)
"RTN","IBCSC10H",48,0)
 S:IBZ(0)="" IBZ(0)=IBUN
"RTN","IBCSC10H",49,0)
 W !,?3," Auth/Referral      : ",IBZ(0)
"RTN","IBCSC10H",50,0)
 F IBZCNT=1:1 Q:'$D(IBZ(IBZCNT))  W !?25,IBZ(IBZCNT)
"RTN","IBCSC10H",51,0)
 K IBZ S IBZ=""
"RTN","IBCSC10H",52,0)
 ;
"RTN","IBCSC10H",53,0)
 ; Section 3
"RTN","IBCSC10H",54,0)
 S Z=3,IBW=1 X IBWW
"RTN","IBCSC10H",55,0)
 W " Providers          : ",$S('$O(IB("PRV",0)):IBU,1:"")
"RTN","IBCSC10H",56,0)
 I $D(IB("PRV")) D  ; at least 1 provider found
"RTN","IBCSC10H",57,0)
 . N IBQ,A,A1,IBARR,IBTAX,IBNOTAX,IBSPEC,IBNOSPEC
"RTN","IBCSC10H",58,0)
 . S IBZ=0
"RTN","IBCSC10H",59,0)
 . D DEFSEC^IBCEF74(IBIFN,.IBARR)
"RTN","IBCSC10H",60,0)
 . ; PRXM/KJH - Add Taxonomy code to display for patch 343. Moved secondary IDs slightly (below).
"RTN","IBCSC10H",61,0)
 . S IBTAX=$$PROVTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCSC10H",62,0)
 . S IBSPEC=$$SPECTAX^IBCEF73A(IBIFN,.IBNOSPEC)
"RTN","IBCSC10H",63,0)
 . F  S IBZ=$O(IB("PRV",IBZ)) Q:'IBZ  D
"RTN","IBCSC10H",64,0)
 .. S IBQ=""
"RTN","IBCSC10H",65,0)
 .. W !,?5,"- "
"RTN","IBCSC10H",66,0)
 .. S A=$$EXPAND^IBTRE(399.0222,.01,IBZ)
"RTN","IBCSC10H",67,0)
 .. I $P($G(IB("PRV",IBZ,1)),U,4)'="" S A1=" ("_$E($P(IB("PRV",IBZ,1),U,4),1,3)_")",A=$E(A,1,16-$L(A1))_A1
"RTN","IBCSC10H",68,0)
 .. W $E(A_$J("",16),1,16),": "
"RTN","IBCSC10H",69,0)
 .. I '$P($G(IB("PRV",IBZ,1)),U,3),$P($G(IB("PRV",IBZ,1)),U)="" W IBU Q
"RTN","IBCSC10H",70,0)
 .. I $P($G(IB("PRV",IBZ,1)),U)'="" W:'$G(IB("PRV",IBZ)) $E($P(IB("PRV",IBZ,1),U)_$J("",16),1,16) W:$G(IB("PRV",IBZ)) "(OLD BOX 31 DATA) "_$P(IB("PRV",IBZ,1),U)
"RTN","IBCSC10H",71,0)
 .. I $P($G(IB("PRV",IBZ,1)),U)="",$P($G(IB("PRV",IBZ)),U)'="" W $E($P(IB("PRV",IBZ),U)_$J("",16),1,16)
"RTN","IBCSC10H",72,0)
 .. W "    Taxonomy: ",$S($P(IBTAX,U,IBZ)'="":$P(IBTAX,U,IBZ),1:IBU),$S($P(IBSPEC,U,IBZ)'="":" ("_$P(IBSPEC,U,IBZ)_")",1:"")
"RTN","IBCSC10H",73,0)
 .. F A=1:1:3 I $G(IBARR(IBZ,A))'="" S IBQ=IBQ_"["_$E("PST",A)_"]"_IBARR(IBZ,A)_" "
"RTN","IBCSC10H",74,0)
 .. I $L(IBQ) W !,?30,$E(IBQ,1,49)
"RTN","IBCSC10H",75,0)
 ;
"RTN","IBCSC10H",76,0)
 K IB("PRV")
"RTN","IBCSC10H",77,0)
 ;
"RTN","IBCSC10H",78,0)
 ; Section 4
"RTN","IBCSC10H",79,0)
 S Z=4,IBW=1 X IBWW
"RTN","IBCSC10H",80,0)
 W " Other Facility (VA/non): " S IBZ=$$EXPAND^IBTRE(399,232,+$P(IB("U2"),U,10))
"RTN","IBCSC10H",81,0)
 W $S(IBZ'="":$E(IBZ,1,23),$$PSRV^IBCEU(IBIFN):IBU,1:IBUN)
"RTN","IBCSC10H",82,0)
 I IBZ'="" D
"RTN","IBCSC10H",83,0)
 . ; PRXM/KJH - Add Taxonomy code to display for patch 343.
"RTN","IBCSC10H",84,0)
 . W ?53,"Taxonomy: "
"RTN","IBCSC10H",85,0)
 . S IBZ=$$GET1^DIQ(8932.1,+$P(IB("U3"),U,3),"X12 CODE") W $S(IBZ'="":IBZ,1:IBU)
"RTN","IBCSC10H",86,0)
 . S IBZ=$$GET1^DIQ(8932.1,+$P(IB("U3"),U,3),"SPECIALTY CODE") W $S(IBZ'="":" ("_IBZ_")",1:"")
"RTN","IBCSC10H",87,0)
 . Q
"RTN","IBCSC10H",88,0)
 ;
"RTN","IBCSC10H",89,0)
 ; clia# display - IB patch 320
"RTN","IBCSC10H",90,0)
 S (IBZ,IBZ1)=$P(IB("U2"),U,13)     ; retrieve CLIA# from database
"RTN","IBCSC10H",91,0)
 ;
"RTN","IBCSC10H",92,0)
 I IBZ="" D
"RTN","IBCSC10H",93,0)
 . NEW CLIAREQ,DEFCLIA,DIE,DA,DR
"RTN","IBCSC10H",94,0)
 . S CLIAREQ=$$CLIAREQ^IBCEP8A(IBIFN)
"RTN","IBCSC10H",95,0)
 . I 'CLIAREQ S IBZ1=IBUN Q          ; clia# not needed
"RTN","IBCSC10H",96,0)
 . S DEFCLIA=$$CLIA^IBCEP8A(IBIFN)   ; default clia# for claim
"RTN","IBCSC10H",97,0)
 . I DEFCLIA="" S IBZ1=IBU Q         ; no default found
"RTN","IBCSC10H",98,0)
 . I $G(IBMDOTCN) K IBMDOTCN S IBZ1=IBU Q     ; user @-deleted clia#
"RTN","IBCSC10H",99,0)
 . S IBZ1=DEFCLIA                    ; display and stuff default clia#
"RTN","IBCSC10H",100,0)
 . S DIE=399,DA=IBIFN,DR="235///"_DEFCLIA D ^DIE    ; stuff in default
"RTN","IBCSC10H",101,0)
 . Q
"RTN","IBCSC10H",102,0)
 ;
"RTN","IBCSC10H",103,0)
 W !,?4,"Lab CLIA #         : ",IBZ1
"RTN","IBCSC10H",104,0)
 ;
"RTN","IBCSC10H",105,0)
 ; Mammo# display IB patch 320
"RTN","IBCSC10H",106,0)
 S (IBZ,IBZ1)=$P(IB("U3"),U,1)    ; retrieve mammo# from database
"RTN","IBCSC10H",107,0)
 ;
"RTN","IBCSC10H",108,0)
 ; If mammo# is there, but should not be, then blank it out
"RTN","IBCSC10H",109,0)
 I IBZ'="",'$$XRAY^IBCEP8A(IBIFN) D
"RTN","IBCSC10H",110,0)
 . NEW DIE,DA,DR
"RTN","IBCSC10H",111,0)
 . S IBZ1=IBUN        ; mammo# not needed
"RTN","IBCSC10H",112,0)
 . S DIE=399,DA=IBIFN,DR="242////@" D ^DIE
"RTN","IBCSC10H",113,0)
 . Q
"RTN","IBCSC10H",114,0)
 ;
"RTN","IBCSC10H",115,0)
 I IBZ="" S IBZ1=IBUN
"RTN","IBCSC10H",116,0)
 W !?4,"Mammography Cert # : ",IBZ1
"RTN","IBCSC10H",117,0)
 ;
"RTN","IBCSC10H",118,0)
 ; Section 5
"RTN","IBCSC10H",119,0)
 S Z=5,IBW=1 X IBWW
"RTN","IBCSC10H",120,0)
 W " Chiropractic Data  : " S Y=$P(IB("U3"),U,5) X ^DD("DD") W $S(Y'="":"INITIAL TREATMENT ON "_Y,1:IBUN)
"RTN","IBCSC10H",121,0)
 ;
"RTN","IBCSC10H",122,0)
 ; Section 6
"RTN","IBCSC10H",123,0)
 S Z=6,IBW=1 X IBWW
"RTN","IBCSC10H",124,0)
 W " Form Locator 19    : " S IBZ=$P($G(^DGCR(399,IBIFN,"UF31")),U,3) W $S(IBZ'="":IBZ,1:IBUN)
"RTN","IBCSC10H",125,0)
 I $P(IB("U2"),U,14)'="" W !,?4,"Homebound          : ",$$EXPAND^IBTRE(399,236,$P(IB("U2"),U,14))
"RTN","IBCSC10H",126,0)
 I $P(IB("U2"),U,15)'="" W !,?4,"Date Last Seen     : ",$$EXPAND^IBTRE(399,237,$P(IB("U2"),U,15))
"RTN","IBCSC10H",127,0)
 I $P(IB("U2"),U,16)'="" W !,?4,"Spec Prog Indicator: " S IBZ=$$EXPAND^IBTRE(399,238,$P(IB("U2"),U,16)) W $S(IBZ'="":IBZ,$$WNRBILL^IBEFUNC(IBIFN):"31",1:"")
"RTN","IBCSC10H",128,0)
 ;
"RTN","IBCSC10H",129,0)
 ; Section 7
"RTN","IBCSC10H",130,0)
 S Z=7,IBW=1 X IBWW
"RTN","IBCSC10H",131,0)
 W " Billing Provider   : "
"RTN","IBCSC10H",132,0)
 K IBZ
"RTN","IBCSC10H",133,0)
 D GETBP^IBCEF79(IBIFN,"",+$$B^IBCEF79(IBIFN),"CMS-1500 SCREEN 8",.IBZ)
"RTN","IBCSC10H",134,0)
 S IBZ=$G(IBZ("CMS-1500 SCREEN 8","NAME"))
"RTN","IBCSC10H",135,0)
 W $S(IBZ'="":IBZ,1:IBU)    ; billing provider name
"RTN","IBCSC10H",136,0)
 W !?3," Taxonomy Code      : "
"RTN","IBCSC10H",137,0)
 S IBZ=$$GET1^DIQ(8932.1,+$P(IB("U3"),U,11),"X12 CODE") W $S(IBZ'="":IBZ,1:IBU)
"RTN","IBCSC10H",138,0)
 S IBZ=$$GET1^DIQ(8932.1,+$P(IB("U3"),U,11),"SPECIALTY CODE") W $S(IBZ'="":" ("_IBZ_")",1:"")
"RTN","IBCSC10H",139,0)
 ;
"RTN","IBCSC10H",140,0)
 ; Section 8
"RTN","IBCSC10H",141,0)
 S Z=8,IBW=1 X IBWW
"RTN","IBCSC10H",142,0)
 S IBREQ=+$$REQMRA^IBEFUNC(IBIFN) S:IBREQ IBREQ=1
"RTN","IBCSC10H",143,0)
 S IBMRASEC=$$MRASEC^IBCEF4(IBIFN)
"RTN","IBCSC10H",144,0)
 W " ",$S('IBREQ:"Force To Print?    : ",1:"Force MRA Sec Prt? : ")
"RTN","IBCSC10H",145,0)
 S IBZ=$$EXTERNAL^DILFD(399,27+IBREQ,,+$P(IB("TX"),U,8+IBREQ))
"RTN","IBCSC10H",146,0)
 I IBMRASEC,'$P(IB("TX"),U,8),$P(IB("TX"),U,9) S IBZ="FORCED TO PRINT BY MRA PRIMARY",$P(IB("TX"),U,8)=0
"RTN","IBCSC10H",147,0)
 W $S(IBZ'=""&($P(IB("TX"),U,8+IBREQ)'=""):IBZ,'$$TXMT^IBCEF4(IBIFN):"[NOT APPLICABLE - NOT TRANSMITTABLE]",IBREQ:"NO FORCED PRINT",1:IBZ)
"RTN","IBCSC10H",148,0)
 ;
"RTN","IBCSC10H",149,0)
 ; Section 9
"RTN","IBCSC10H",150,0)
 S Z=9,IBW=1 X IBWW
"RTN","IBCSC10H",151,0)
 W " Provider ID Maint  : (Edit Provider ID information)",!
"RTN","IBCSC10H",152,0)
 G ^IBCSCP
"RTN","IBCSC10H",153,0)
Q Q
"RTN","IBCSC10H",154,0)
 ;
"RTN","IBCSC10H",155,0)
WRT1(IBCRED) ; Write credentials mismatch
"RTN","IBCSC10H",156,0)
 W !,*7,"  **Warning** Credentials differ from those found in NEW PERSON or IB NON VA",!,$J("",14),"BILLING PROVIDER file (",$S(IBCRED="":"none",1:IBCRED),")"
"RTN","IBCSC10H",157,0)
 W !,$J("",14),"Changes will print local, but only credentials on file transmit"
"RTN","IBCSC10H",158,0)
 Q
"RTN","IBCSC10H",159,0)
 ;
"RTN","IBCSC10H",160,0)
NSAME(DA) ; Returns 1 if div on bill is not the default billing facility
"RTN","IBCSC10H",161,0)
 Q ($P($G(^IBE(350.9,1,0)),U,2)'=$P($G(^DG(40.8,+$P(^DGCR(399,DA,0),U,22),0)),U,7))
"RTN","IBCSC10H",162,0)
 ;
"RTN","IBCSC10H",163,0)
 ;IBCSC10H
"RTN","IBCSC5A")
0^3^B46960679^B42695734
"RTN","IBCSC5A",1,0)
IBCSC5A ;ALB/ARH - ADD/ENTER PRESCRIPTION FILLS ;12/27/93
"RTN","IBCSC5A",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,106,51,160,137,245,309,347,405,432**;21-MAR-94;Build 192
"RTN","IBCSC5A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC5A",4,0)
 ;
"RTN","IBCSC5A",5,0)
EN ;add/edit prescription fills for a bill, IBIFN required
"RTN","IBCSC5A",6,0)
 S IBX=$$BILL(IBIFN) Q:'IBIFN  S DFN=+IBX,IBDT1=$P(IBX,U,2),IBDT2=$P(IBX,U,3),IBRXALL=$P(IBX,U,4)
"RTN","IBCSC5A",7,0)
 D SET(IBIFN,.IBRXA,"")
"RTN","IBCSC5A",8,0)
 D RXDISP^IBCSC5C(DFN,IBDT1,IBDT2,.IBPR,.IBPRO,.IBRXA,IBRXALL) I +$P($G(IBPRO),U,2) D NEWRX^IBCSC5C(+IBPRO) I +$G(IBLIST) D ADDNEW^IBCSC5C(IBIFN,IBLIST,.IBPR,.IBPRO) S DGRVRCAL=1
"RTN","IBCSC5A",9,0)
 S IBRXAP=+$G(IBPRO) D SET(IBIFN,.IBRXA,.IBRXAP),DISP(.IBRXA,.IBRXAP)
"RTN","IBCSC5A",10,0)
E1 S IBPIFN=0,IBRX=$$ASKRX(.IBRXAP,.IBPRO) G:IBRX="" EXIT S IBDT=$P(IBRX,U,2),IBRX=$P(IBRX,U,1),DGRVRCAL=1
"RTN","IBCSC5A",11,0)
 I 'IBDT S IBDT=$O(IBRXA(IBRX,0)) S:'IBDT IBDT=$O(IBPR(IBRX,0)) S IBDT=$$ASKDT(IBDT1,IBDT2,IBDT) G:'IBDT E1
"RTN","IBCSC5A",12,0)
 I +$$RXDUP^IBCU3(IBRX,IBDT,IBIFN,1),'$D(IBRXA(IBRX,IBDT)) G E1
"RTN","IBCSC5A",13,0)
 I '$D(IBPR(IBRX,IBDT)) W !,"This rx fill does not exist in Pharmacy for this patient!",!
"RTN","IBCSC5A",14,0)
 S IBPIFN=$G(IBRXA(IBRX,IBDT)),IBDRG=$P(IBPIFN,U,2)
"RTN","IBCSC5A",15,0)
 I 'IBPIFN S IBX=$G(IBPR(IBRX,IBDT)),IBPIFN=$$ADD(IBRX,IBIFN,IBDT,$P(IBX,U,3),$P(IBX,U,1),$P(IBX,U,4,6),$P(IBX,U,2)) D  G:'IBPIFN E1
"RTN","IBCSC5A",16,0)
 . I 'IBPIFN W " ??" Q
"RTN","IBCSC5A",17,0)
 . W "  ... ADDED"
"RTN","IBCSC5A",18,0)
 D EDIT(+IBPIFN,$P(IBPIFN,U,7)) S IBRXAP=+$G(IBPRO) D SET(IBIFN,.IBRXA,.IBRXAP) G E1
"RTN","IBCSC5A",19,0)
 ;
"RTN","IBCSC5A",20,0)
EXIT ;
"RTN","IBCSC5A",21,0)
 K IBPIFN,IBRX,IBDRG,IBX,IBDT1,IBDT2,IBRXA,IBPR,IBDT,IBLIST,IBPRO,IBRXAP,IBRXALL
"RTN","IBCSC5A",22,0)
 Q
"RTN","IBCSC5A",23,0)
 ;
"RTN","IBCSC5A",24,0)
ASKRX(IBRXAP,IBPRO) ;
"RTN","IBCSC5A",25,0)
 N X,Y,IBY,IBX W ! S IBX=""
"RTN","IBCSC5A",26,0)
 I +$G(IBIFN) S DIR("?")="The prescription number for the fill.  "_$$HTEXT^IBCSC5C,DIR("??")="^D HELP^IBCSC5A("_IBIFN_")"
"RTN","IBCSC5A",27,0)
 S DIR("A")="Select RX FILL",DIR(0)="FO^1:11^K:X'?.UN X" D ^DIR I $D(DIRUT)!(Y'?.AN) S Y="" K DIR,DIRUT G ARX1E
"RTN","IBCSC5A",28,0)
 S IBX=Y I $D(IBRXAP)<10,$D(IBPRO)<10 G ARX1E
"RTN","IBCSC5A",29,0)
 ;
"RTN","IBCSC5A",30,0)
 S IBY=$G(IBRXAP(IBX)) S:IBY="" IBY=$G(IBPRO(IBX)) I IBY="" G ARX1E
"RTN","IBCSC5A",31,0)
 W ! S DIR(0)="YO",DIR("A")="ADD/EDIT RX FILL "_$P(IBY,U,1)_" FOR "_$$FMTE^XLFDT($P(IBY,U,2))_" CORRECT",DIR("B")="YES"
"RTN","IBCSC5A",32,0)
 D ^DIR K DIR I Y=1,'$D(DIRUT) S IBX=IBY
"RTN","IBCSC5A",33,0)
ARX1E Q IBX
"RTN","IBCSC5A",34,0)
 ;
"RTN","IBCSC5A",35,0)
ASKDT(IBDT1,IBDT2,IBDT) ;
"RTN","IBCSC5A",36,0)
 S DIR("A")="Select RX FILL DATE",DIR(0)="DO^"_IBDT1_":"_IBDT2_":EX",DIR("B")=$$FMTE^XLFDT(IBDT) D ^DIR K DIR,DTOUT,DIRUT
"RTN","IBCSC5A",37,0)
 Q $S(Y?7N:Y,1:0)
"RTN","IBCSC5A",38,0)
 ;
"RTN","IBCSC5A",39,0)
ADD(RX,IFN,IBDT,DRUG,PIFN,OTHER,IBRF) ;
"RTN","IBCSC5A",40,0)
 N IBX,X,Y,DD,DO,DA,DIC,DLAYGO
"RTN","IBCSC5A",41,0)
 S IBX=0 S DRUG=$$DRUG($G(DRUG)) G:'DRUG ADDE
"RTN","IBCSC5A",42,0)
 S DIC="^IBA(362.4,",DIC(0)="AQL",X=RX,DLAYGO=362.4 D FILE^DICN
"RTN","IBCSC5A",43,0)
 I Y>0 D
"RTN","IBCSC5A",44,0)
 . ; IB *2.0*432 Stuff ISSUE DATE from file 52 when adding new RX to 362.4
"RTN","IBCSC5A",45,0)
 . D ORDT($P(OTHER,U,4),+Y)
"RTN","IBCSC5A",46,0)
 . S DIE=DIC,(IBX,DA)=+Y,DR=".02////"_IFN_";.03////"_IBDT_";.04////"_DRUG_";.05////"_+PIFN_";.06////"_$P(OTHER,U,1)_";.07////"_$P(OTHER,U,2)_";.08////"_$P(OTHER,U,3) S:$L($G(IBRF)) DR=DR_";.1////"_IBRF D ^DIE K DIE,DIC,DA,DR
"RTN","IBCSC5A",47,0)
 . S DGRVRCAL=1
"RTN","IBCSC5A",48,0)
ADDE Q IBX
"RTN","IBCSC5A",49,0)
 ;
"RTN","IBCSC5A",50,0)
EDIT(PIFN,REVIEN) ;
"RTN","IBCSC5A",51,0)
 N IBCHG,DIE,DR,DA,DIC,DIDEL,IBORDT
"RTN","IBCSC5A",52,0)
 ; IB*2.0*432 - display RX Order date to user, if available
"RTN","IBCSC5A",53,0)
 S IBORDT=$P($G(^IBA(362.4,PIFN,0)),U,11)
"RTN","IBCSC5A",54,0)
 W:IBORDT'="" !,"Date RX Ordered:  ",$$FMTE^XLFDT(IBORDT)
"RTN","IBCSC5A",55,0)
 S DIDEL=362.4,DIE="^IBA(362.4,"
"RTN","IBCSC5A",56,0)
 S DR=".01;.03;.04;.06;.07;.08;.09;.1"
"RTN","IBCSC5A",57,0)
 S DA=PIFN D ^DIE
"RTN","IBCSC5A",58,0)
 I '$D(^IBA(362.4,PIFN,0)),$G(REVIEN) D  ; Deleted RX - delete related rev code/CPT code
"RTN","IBCSC5A",59,0)
 . I $P($G(^DGCR(399,IBIFN,"RC",REVIEN,0)),U,15) S DA(1)=IBIFN,DA=$P(^(0),U,15),DIK="^DGCR(399,"_DA(1)_",""CP""," D ^DIK
"RTN","IBCSC5A",60,0)
 . S DA=REVIEN,DA(1)=IBIFN,DIK="^DGCR(399,"_DA(1)_",""RC""," D ^DIK
"RTN","IBCSC5A",61,0)
 . S DGRVRCAL=1
"RTN","IBCSC5A",62,0)
 Q
"RTN","IBCSC5A",63,0)
 ;
"RTN","IBCSC5A",64,0)
SET(IFN,RXARR,RXARRP) ;setup array of all rx fills for bill, array name should be passed by reference
"RTN","IBCSC5A",65,0)
 ;returns: RXARR(RX #, FILL DT)=RX IFN (362.4) ^ DRUG ^ DAYS SUPPLY ^ QTY ^ NDC # ^ Charge if known ^ ien of associated rev code multiple, if known ^ NDC FORMAT INDICATOR (1-4)^ORDER DATE
"RTN","IBCSC5A",66,0)
 ;         RXARR=BILL IFN ^ RX count
"RTN","IBCSC5A",67,0)
 N CNT,IBX,IBY,IBZ,PIFN,IBC,IBCNT,IBRC S IBCNT=+$G(RXARRP),IBC="AIFN"_$G(IFN) K RXARR,RXARRP
"RTN","IBCSC5A",68,0)
 ;
"RTN","IBCSC5A",69,0)
 D RCITEM(IFN,"IBRC",3)
"RTN","IBCSC5A",70,0)
 S (CNT,IBX)=0 F  S IBX=$O(^IBA(362.4,IBC,IBX)) Q:IBX=""  S PIFN=0 F  S PIFN=$O(^IBA(362.4,IBC,IBX,PIFN)) Q:'PIFN  D
"RTN","IBCSC5A",71,0)
 .S IBY=$G(^IBA(362.4,PIFN,0)) Q:IBY=""  S CNT=CNT+1,RXARR($P(IBY,U,1),+$P(IBY,U,3))=PIFN_U_$P(IBY,U,4)_U_$P(IBY,U,6,8),$P(RXARR($P(IBY,U),+$P(IBY,U,3)),U,6)=$$CHG^IBCF4(PIFN,3,.IBRC)
"RTN","IBCSC5A",72,0)
 . I $G(IFN) S $P(RXARR($P(IBY,U),+$P(IBY,U,3)),U,7)=$$FINDREV(IFN,3,PIFN)
"RTN","IBCSC5A",73,0)
 . S $P(RXARR($P(IBY,U),+$P(IBY,U,3)),U,8)=$P(IBY,U,9)
"RTN","IBCSC5A",74,0)
 . ; IB *2.0*432 include ORDER DATE from file 362.4 in output formatter
"RTN","IBCSC5A",75,0)
 . S $P(RXARR($P(IBY,U),+$P(IBY,U,3)),U,9)=$P(IBY,U,11)
"RTN","IBCSC5A",76,0)
 ;
"RTN","IBCSC5A",77,0)
 S RXARR=$G(IFN)_"^"_CNT
"RTN","IBCSC5A",78,0)
 S IBX=0 F  S IBX=$O(RXARR(IBX)) Q:IBX=""  S IBY=0 F  S IBY=$O(RXARR(IBX,IBY)) Q:'IBY  S IBCNT=IBCNT+1,RXARRP(IBCNT)=IBX_"^"_IBY_"^"_$P(RXARR(IBX,IBY),U,7)
"RTN","IBCSC5A",79,0)
 Q
"RTN","IBCSC5A",80,0)
 ;
"RTN","IBCSC5A",81,0)
DISP(RXARR,RXARRP) ;screen display of existing fills for a bill: input should be print order array returned by SET^IBCSC5A: RXARR(RX,DT)=RX IFN (362.4) ^ DRUG, passed by reference
"RTN","IBCSC5A",82,0)
 N IBX,IBY,IBZ,IBS,IBP,IBIFN
"RTN","IBCSC5A",83,0)
 W !!,?5,"-----------------  Existing Prescriptions on Bill  -----------------",!
"RTN","IBCSC5A",84,0)
 S IBIFN=+$G(RXARR)
"RTN","IBCSC5A",85,0)
 S IBI=0 F  S IBI=$O(RXARRP(IBI)) Q:IBI=""  S IBX=$P(RXARRP(IBI),U,1),IBY=$P(RXARRP(IBI),U,2) I $D(RXARR(IBX,IBY)) D
"RTN","IBCSC5A",86,0)
 . S IBS=$$RXSTAT^IBCU1(+$P(RXARR(IBX,IBY),U,2),+$P($G(^IBA(362.4,+RXARR(IBX,IBY),0)),U,5),IBY)
"RTN","IBCSC5A",87,0)
 . D ZERO^IBRXUTL(+$P(RXARR(IBX,IBY),U,2))
"RTN","IBCSC5A",88,0)
 . S IBZ=$G(^TMP($J,"IBDRUG",+$P(RXARR(IBX,IBY),U,2),.01)),IBP=$$PRVNM(+RXARR(IBX,IBY))
"RTN","IBCSC5A",89,0)
 . K ^TMP($J,"IBDRUG")
"RTN","IBCSC5A",90,0)
 . W !,$J(IBI,2),")",?5,IBX,?19,$E(IBZ,1,25),?46,$$DATE^IBCSC5C(IBY),?56,$P(IBS,U,1),?61,$P(IBS,U,2),?69,$P(IBS,U,3)
"RTN","IBCSC5A",91,0)
 . S IBZ=$$RXDUP^IBCU3(IBX,IBY,IBIFN) I +IBZ W ?73,$P($G(^DGCR(399,+IBZ,0)),U,1)
"RTN","IBCSC5A",92,0)
 . S IBZ=$G(^DGCR(399,IBIFN,"RC",+$P(RXARR(IBX,IBY),U,7),0))
"RTN","IBCSC5A",93,0)
 . W !,?5,$E(IBP,1,25),?35,"(Rx Procedure ",$S($P(IBZ,U,15):"#"_$P(IBZ,U,15)_" "_$$CPTNM^IBCRBH1(IBIFN,4,$P(IBZ,U,15)),1:"Missing"),"  Rev Code ",$S(IBZ:"#"_+$P(RXARR(IBX,IBY),U,7)_" "_$P($G(^DGCR(399.2,+IBZ,0)),U),1:"Missing"),")"
"RTN","IBCSC5A",94,0)
 W !
"RTN","IBCSC5A",95,0)
 Q
"RTN","IBCSC5A",96,0)
 ;
"RTN","IBCSC5A",97,0)
HELP(IFN) ;called for help from rx enter to display existing rx, displays rx' from 52 and 399
"RTN","IBCSC5A",98,0)
 I +$G(IFN) N IBX,IBRXA S IBX=$$BILL(IFN) I +IBX D SET(IFN,.IBRXA,""),RXDISP^IBCSC5C($P(IBX,U,1),$P(IBX,U,2),$P(IBX,U,3),.IBPR,.IBPRO,.IBRXA,$P(IBX,U,4)) S IBRXAP=+IBPRO D SET(IFN,.IBRXA,.IBRXAP),DISP(.IBRXA,.IBRXAP)
"RTN","IBCSC5A",99,0)
 Q
"RTN","IBCSC5A",100,0)
BILL(IBIFN) ; return data on a bill 'patient ifn ^ from dt ^ to dt ^ true if add original rx'
"RTN","IBCSC5A",101,0)
 N IBX,IBY
"RTN","IBCSC5A",102,0)
 S IBX=$G(^DGCR(399,+$G(IBIFN),0)),IBY=$P(IBX,U,2)
"RTN","IBCSC5A",103,0)
 I '$$PERDIEM^IBCRU3(+$P(IBX,U,7),+$P(IBX,U,5),+$P(IBX,U,3)) S $P(IBY,U,4)=1
"RTN","IBCSC5A",104,0)
 S IBX=$G(^DGCR(399,+IBIFN,"U")),$P(IBY,U,2)=+IBX,$P(IBY,U,3)=+$P(IBX,U,2)
"RTN","IBCSC5A",105,0)
 Q IBY
"RTN","IBCSC5A",106,0)
DRUG(IBD) ; get drug
"RTN","IBCSC5A",107,0)
 N X,Y S IBD=+$G(IBD) S DIC(0)="VQ",DIC="^PSDRUG(" D DIC^PSSDI(50,"PS",.DIC,IBD,) I +Y<0  S IBD=0,DIC="^PSDRUG(",DIC(0)="AEQ" D DIC^PSSDI(50,"PS",.DIC,,) K DIC I +Y>0 S IBD=+Y
"RTN","IBCSC5A",108,0)
 Q IBD
"RTN","IBCSC5A",109,0)
 ;
"RTN","IBCSC5A",110,0)
RCITEM(IBIFN,ARRAY,TYPE) ; Pull off all item charges from RC multiple 
"RTN","IBCSC5A",111,0)
 ;  for item TYPE on bill IBIFN, return array ARRAY
"RTN","IBCSC5A",112,0)
 ; If type = "ALL", pull off all types
"RTN","IBCSC5A",113,0)
 ;Set up @ARRAY@(type,item reference,ct)=# units^unit charge
"RTN","IBCSC5A",114,0)
 ; If no pointer to an item, this was a manually entered charge and
"RTN","IBCSC5A",115,0)
 ;  will only 'associate' with the items found in the appropriate
"RTN","IBCSC5A",116,0)
 ;  item source file that are not referenced by an item in the revenue
"RTN","IBCSC5A",117,0)
 ;  code multiple in a sequential fashion (first unassociated 'RC' will
"RTN","IBCSC5A",118,0)
 ;  correlate to the first unassociated entry found for the bill in source file)
"RTN","IBCSC5A",119,0)
 N Z,Z0,Z1
"RTN","IBCSC5A",120,0)
 S Z=0
"RTN","IBCSC5A",121,0)
 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) I $S(TYPE="ALL":1,1:$P(Z0,U,10)=TYPE) I $P(Z0,U,10)'="" S Z1=$S($P(Z0,U,11)="":0,1:$P(Z0,U,11)),@ARRAY@($P(Z0,U,10),Z1,Z)=$P(Z0,U,3)_U_$P(Z0,U,2)
"RTN","IBCSC5A",122,0)
 Q
"RTN","IBCSC5A",123,0)
 ;
"RTN","IBCSC5A",124,0)
FINDREV(IBIFN,TYP,PTR) ; Finds the first revenue code that matches the
"RTN","IBCSC5A",125,0)
 ; same item type and item pointer
"RTN","IBCSC5A",126,0)
 ;
"RTN","IBCSC5A",127,0)
 N REVIEN,Z,Z0
"RTN","IBCSC5A",128,0)
 S Z=0
"RTN","IBCSC5A",129,0)
 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) I $P(Z0,U,10)=TYP,$P(Z0,U,11)=PTR S REVIEN=Z Q
"RTN","IBCSC5A",130,0)
 Q $G(REVIEN)
"RTN","IBCSC5A",131,0)
 ;
"RTN","IBCSC5A",132,0)
NDCNUM(IBNDC) ; Returns the format of the NDC # IBNDC, if possible
"RTN","IBCSC5A",133,0)
 N Z
"RTN","IBCSC5A",134,0)
 S Z=$TR(IBNDC,"-")
"RTN","IBCSC5A",135,0)
 Q $S(IBNDC?4N1"-"4N1"-"2N:1,IBNDC?5N1"-"3N1"-"2N:2,IBNDC?5N1"-"4N1"-"1N:3,IBNDC?5N1"-"4N1"-"2N!($L(Z)=11):4,IBNDC'="":1,1:"")
"RTN","IBCSC5A",136,0)
 ;
"RTN","IBCSC5A",137,0)
PRVNM(PIFN) ; return provider name for an rx, if one defined or null
"RTN","IBCSC5A",138,0)
 N IBX,IBPRV,IBRXIFN S IBPRV=""
"RTN","IBCSC5A",139,0)
 S IBRXIFN=$P($G(^IBA(362.4,+$G(PIFN),0)),U,5) I +IBRXIFN S IBX=$$FILE^IBRXUTL(IBRXIFN,4) I +IBX S IBPRV=$P($G(^VA(200,+IBX,0)),U,1)
"RTN","IBCSC5A",140,0)
 Q IBPRV
"RTN","IBCSC5A",141,0)
ORDT(IBORDT,Y) ;get ISSUE DATE from file 52 and stuff into ORDER DATE of file 362.4
"RTN","IBCSC5A",142,0)
 Q:IBORDT=""
"RTN","IBCSC5A",143,0)
 N DIE,DA,DR
"RTN","IBCSC5A",144,0)
 S DIE=362.4,DA=+Y,DR=".11///"_IBORDT D ^DIE
"RTN","IBCSC5A",145,0)
 Q
"RTN","IBCSC5C")
0^4^B51873840^B44697978
"RTN","IBCSC5C",1,0)
IBCSC5C ;ALB/ARH - ADD/EDIT PRESCRIPTION FILLS (CONTINUED) ;3/4/94
"RTN","IBCSC5C",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,130,51,160,260,309,315,339,347,363,381,405,432**;21-MAR-94;Build 192
"RTN","IBCSC5C",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC5C",4,0)
 ;
"RTN","IBCSC5C",5,0)
 ;
"RTN","IBCSC5C",6,0)
DEFAULT(IFN,IBRX) ; add default DX and CPT to a prescription bill
"RTN","IBCSC5C",7,0)
 ; if one is not in PSO.  If there is, use it instead.
"RTN","IBCSC5C",8,0)
 ; IFN = ien of bill entry
"RTN","IBCSC5C",9,0)
 N IBX,IBPAR1,IBDX,IBCPT,IBDT,IBBIL,IBDXIFN,IBCPTIFN,IBY,IB52,IBC,PDFN,LIST,NODE
"RTN","IBCSC5C",10,0)
 S IBDXIFN=0
"RTN","IBCSC5C",11,0)
 S IBPAR1=$G(^IBE(350.9,1,1)),IBDX=$P(IBPAR1,U,29),IBCPT=$P(IBPAR1,U,30)
"RTN","IBCSC5C",12,0)
 S IBBIL=$G(^DGCR(399,+$G(IFN),0)) Q:IBBIL=""
"RTN","IBCSC5C",13,0)
 S IBX=$S($G(IBRX):$P($G(^DGCR(399,IFN,"RC",+IBRX,0)),U,11),1:$O(^IBA(362.4,"C",IFN,0))) Q:'IBX
"RTN","IBCSC5C",14,0)
 S IB52=+$P($G(^IBA(362.4,IBX,0)),"^",5),IBY=0 Q:IB52=0
"RTN","IBCSC5C",15,0)
 S PDFN=$$FILE^IBRXUTL(IB52,2)
"RTN","IBCSC5C",16,0)
 S LIST="IBCSC5CARR"
"RTN","IBCSC5C",17,0)
 S NODE="ICD"
"RTN","IBCSC5C",18,0)
 D RX^PSO52API(PDFN,LIST,IB52,,NODE,,)
"RTN","IBCSC5C",19,0)
 I ^TMP($J,LIST,PDFN,IB52,"ICD",0)>0 D
"RTN","IBCSC5C",20,0)
 .S IBY=0 F  S IBY=$O(^TMP($J,LIST,PDFN,IB52,"ICD",IBY)) Q:IBY'>0  D
"RTN","IBCSC5C",21,0)
 ..S IBDX(IBY)=$$ICD^IBRXUTL1(PDFN,IB52,IBY,LIST)
"RTN","IBCSC5C",22,0)
 ..I 'IBDX(IBY) K IBDX(IBY)
"RTN","IBCSC5C",23,0)
 K ^TMP($J,LIST)
"RTN","IBCSC5C",24,0)
 I 'IBDX,'IBCPT,$D(IBDX)<10 Q
"RTN","IBCSC5C",25,0)
 S IBDT=$P($G(^IBA(362.4,+IBX,0)),U,3) Q:'IBDT
"RTN","IBCSC5C",26,0)
 ; add dx associated with rx if they are there.
"RTN","IBCSC5C",27,0)
 I $D(IBDX)>9 S (IBC,IBDX,IBY)=0 F  S IBY=$O(IBDX(IBY)) Q:'IBY  D
"RTN","IBCSC5C",28,0)
 . I $D(^IBA(362.3,"AIFN"_IFN,+IBDX(IBY))) Q
"RTN","IBCSC5C",29,0)
 . S IBC=IBC+1
"RTN","IBCSC5C",30,0)
 . S DIC="^IBA(362.3,",DIC(0)="L",DIC("DR")=".02////"_IFN_";.03////"_IBC,X=+IBDX(IBY),DLAYGO=362.3
"RTN","IBCSC5C",31,0)
 . K DD,DO D FILE^DICN K DIC,DA,DR,DD,DO,DLAYGO
"RTN","IBCSC5C",32,0)
 . S IBDXIFN(IBC)=+Y
"RTN","IBCSC5C",33,0)
 ; add default dx if none found on actual rx.
"RTN","IBCSC5C",34,0)
 I +IBDX,'$D(^IBA(362.3,"AIFN"_IFN,+IBDX)) S DIC="^IBA(362.3,",DIC(0)="L",DIC("DR")=".02////"_IFN,X=IBDX,DLAYGO=362.3 K DD,DO D FILE^DICN K DIC,DA,DR,DD,DO,DLAYGO S IBDXIFN=+Y
"RTN","IBCSC5C",35,0)
 I +IBCPT D  ;Check if the procedure is already present for the Rx
"RTN","IBCSC5C",36,0)
 . N Z,Z0,DUP
"RTN","IBCSC5C",37,0)
 . S (DUP,Z)=0 F  S Z=$O(^DGCR(399,IFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) D  Q:DUP
"RTN","IBCSC5C",38,0)
 .. I $P(Z0,U,10)=3,$P(Z0,U,15),$P(Z0,U,11)=IBX S DUP=1
"RTN","IBCSC5C",39,0)
 . Q:DUP
"RTN","IBCSC5C",40,0)
 . I $P($G(^DGCR(399,IFN,0)),U,9)="" S DIE="^DGCR(399,",DA=IFN,DR=".09////5" D ^DIE K DIE,DIC,DA,DR
"RTN","IBCSC5C",41,0)
 . I '$D(^DGCR(399,IFN,"CP",0)) S DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCSC5C",42,0)
 . S DLAYGO=399,DIC("DR")="1////"_IBDT D
"RTN","IBCSC5C",43,0)
 . . I +IBDXIFN>0 S DIC("DR")=DIC("DR")_";10////"_IBDXIFN Q
"RTN","IBCSC5C",44,0)
 . . I $D(IBDXIFN)>9 F IBY=1:1:4 I $D(IBDXIFN(IBY)) S DIC("DR")=DIC("DR")_";"_(IBY+9)_"////"_IBDXIFN(IBY)
"RTN","IBCSC5C",45,0)
 . S DIC="^DGCR(399,"_IFN_",""CP"",",DIC(0)="L",DA(1)=IFN,X=IBCPT_";ICPT(" K DD,DO D FILE^DICN K DIC,DA,DD,DO,DR,DLAYGO
"RTN","IBCSC5C",46,0)
 . I +Y D
"RTN","IBCSC5C",47,0)
 .. N Z,IBZ
"RTN","IBCSC5C",48,0)
 .. S IBZ=+Y,Z=$S($G(IBREV):IBREV,1:$$FINDREV^IBCSC5A(IFN,3,+IBX))
"RTN","IBCSC5C",49,0)
 .. I Z S DR=".15////"_IBZ_";.06////"_IBCPT,DA=+Z,DA(1)=IFN,DIE="^DGCR(399,"_DA(1)_",""RC""," D ^DIE
"RTN","IBCSC5C",50,0)
 Q
"RTN","IBCSC5C",51,0)
 ;
"RTN","IBCSC5C",52,0)
RXDISP(DFN,DT1,DT2,ARRAY,POARR,RXARR,IBRXALL,NODISP) ; display all rx fills for a patient and date range
"RTN","IBCSC5C",53,0)
 ;RXARR (as defined by SET^IBCSC5A) passed by ref. only to check if rx-fill is on the bill, not necessary not changed
"RTN","IBCSC5C",54,0)
 ;returns: ARRAY(RX #, FILL DT) = RX IFN (52) ^ FILL IFN ^ DRUG ^ DAYS SUPPLY ^ QTY ^ NDC ^ ORDER DATE, pass by reference if desired
"RTN","IBCSC5C",55,0)
 ;         POARR(CNT)=RX # ^ FILL DT
"RTN","IBCSC5C",56,0)
 N PIFN,RIFN,IBX,IBY,DTE,DTR,RX,IBCNT,IBRX0,IBRX2,IBS,LIST,LIST2 K ARRAY,POARR S POARR=0,NODISP=+$G(NODISP)
"RTN","IBCSC5C",57,0)
 S IBCNT=0,DT1=$G(DT1)-.0001,DT2=$G(DT2) S:'DT2 DT2=9999999 Q:'$G(DFN)
"RTN","IBCSC5C",58,0)
 ;^PS(55,DFN,"P","A",EXPIRATION DATE, RX) is the best xref available for finding patient fills in a date range
"RTN","IBCSC5C",59,0)
 ;if RX expires/cancelled before start of bill then should not be applicable to bill
"RTN","IBCSC5C",60,0)
 S LIST="IBRXDISPARR"
"RTN","IBCSC5C",61,0)
 D PROF^PSO52API(DFN,LIST,DT1)
"RTN","IBCSC5C",62,0)
 S DTE=0 F  S DTE=$O(^TMP($J,LIST,"B",DTE)) Q:'DTE  D
"RTN","IBCSC5C",63,0)
 . S PIFN=0 F  S PIFN=$O(^TMP($J,LIST,"B",DTE,PIFN)) Q:'PIFN  D
"RTN","IBCSC5C",64,0)
 .. S IBRX0=$$RXZERO^IBRXUTL(DFN,PIFN),IBRX2=$$RXSEC^IBRXUTL(DFN,PIFN)
"RTN","IBCSC5C",65,0)
 .. ; original fill
"RTN","IBCSC5C",66,0)
 .. I +$G(IBRXALL) S DTR=$P(IBRX2,U,2) I DTR'<DT1,DTR'>DT2 D
"RTN","IBCSC5C",67,0)
 ... D DATA^IBRXUTL(+$P(IBRX0,U,6))
"RTN","IBCSC5C",68,0)
 ... ; add issue date to array so order date can be displayed
"RTN","IBCSC5C",69,0)
 ... ;S ARRAY($P(IBRX0,U,1),+DTR)=PIFN_U_0_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBRX0,U,7)_U_$$GETNDC^PSONDCUT(PIFN,0)
"RTN","IBCSC5C",70,0)
 ... S ARRAY($P(IBRX0,U,1),+DTR)=PIFN_U_0_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBRX0,U,7)_U_$$GETNDC^PSONDCUT(PIFN,0)_U_$P(IBRX0,U,13)
"RTN","IBCSC5C",71,0)
 ... K ^TMP($J,"IBDRUG")
"RTN","IBCSC5C",72,0)
 ... Q
"RTN","IBCSC5C",73,0)
 .. ; refills
"RTN","IBCSC5C",74,0)
 .. S LIST2="IBDISPSUB"
"RTN","IBCSC5C",75,0)
 .. S NODE="R"
"RTN","IBCSC5C",76,0)
 .. D RX^PSO52API(DFN,LIST2,PIFN,,NODE,,)
"RTN","IBCSC5C",77,0)
 .. S RIFN=0 F  S RIFN=$O(^TMP($J,LIST2,DFN,PIFN,"RF",RIFN)) Q:RIFN'>0  D
"RTN","IBCSC5C",78,0)
 ... S IBY=$$ZEROSUB^IBRXUTL(DFN,PIFN,RIFN) Q:IBY=""
"RTN","IBCSC5C",79,0)
 ... Q:+IBY<DT1!(+IBY>DT2)
"RTN","IBCSC5C",80,0)
 ... D DATA^IBRXUTL(+$P(IBRX0,U,6))
"RTN","IBCSC5C",81,0)
 ... ; add issue date to array so order date can be displayed
"RTN","IBCSC5C",82,0)
 ... ;S ARRAY($P(IBRX0,U,1),+IBY)=PIFN_U_RIFN_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBY,U,4)_U_$$GETNDC^PSONDCUT(PIFN,RIFN)
"RTN","IBCSC5C",83,0)
 ... S ARRAY($P(IBRX0,U,1),+IBY)=PIFN_U_RIFN_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBY,U,4)_U_$$GETNDC^PSONDCUT(PIFN,RIFN)_U_$P(IBRX0,U,13)
"RTN","IBCSC5C",84,0)
 ... K ^TMP($J,"IBDRUG")
"RTN","IBCSC5C",85,0)
 ... Q
"RTN","IBCSC5C",86,0)
 .. K ^TMP($J,LIST2)
"RTN","IBCSC5C",87,0)
 K ^TMP($J,LIST)
"RTN","IBCSC5C",88,0)
 ;
"RTN","IBCSC5C",89,0)
 S IBX="",IBS=0 F  S IBX=$O(ARRAY(IBX)) Q:IBX=""  S IBY=0 F  S IBY=$O(ARRAY(IBX,IBY)) Q:'IBY  D
"RTN","IBCSC5C",90,0)
 . S IBCNT=IBCNT+1,POARR(IBCNT)=$P(IBX,U,1)_"^"_+IBY,POARR=IBCNT I $D(RXARR(IBX,IBY)) S IBS=IBS+1
"RTN","IBCSC5C",91,0)
 S $P(POARR,U,2)=IBCNT-IBS
"RTN","IBCSC5C",92,0)
 ;
"RTN","IBCSC5C",93,0)
 Q:+NODISP
"RTN","IBCSC5C",94,0)
 W @IOF,?33,"PRESCRIPTIONS IN DATE RANGE",!,"===============================================================================",!
"RTN","IBCSC5C",95,0)
 S IBCNT=0 F  S IBCNT=$O(POARR(IBCNT)) Q:IBCNT=""  S RX=$P(POARR(IBCNT),U,1),DTR=$P(POARR(IBCNT),U,2) I RX'="",DTR'="" D
"RTN","IBCSC5C",96,0)
 . S IBS=$$RXSTAT^IBCU1($P(ARRAY(RX,DTR),U,3),$P(ARRAY(RX,DTR),U,1),DTR)
"RTN","IBCSC5C",97,0)
 . S IBY="" I $D(RXARR(RX,+DTR)) S IBY="*"
"RTN","IBCSC5C",98,0)
 . D ZERO^IBRXUTL(+$P(ARRAY(RX,DTR),U,3))
"RTN","IBCSC5C",99,0)
 . W !,$J(IBCNT,2),")",?5,IBY,?6,RX,?19,$E($G(^TMP($J,"IBDRUG",+$P(ARRAY(RX,DTR),U,3),.01)),1,25),?46,$$DATE(+DTR),?56,$P(IBS,U,1),?61,$P(IBS,U,2),?69,$P(IBS,U,3),?75,$$EXEMPT(+ARRAY(RX,DTR))
"RTN","IBCSC5C",100,0)
 . S IBY=$$RXDUP^IBCU3(RX,DTR,IBIFN) I +IBY W ?73,$P($G(^DGCR(399,+IBY,0)),U,1)
"RTN","IBCSC5C",101,0)
 . K ^TMP($J,"IBDRUG")
"RTN","IBCSC5C",102,0)
 Q
"RTN","IBCSC5C",103,0)
DATE(X) Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBCSC5C",104,0)
 ;
"RTN","IBCSC5C",105,0)
NEWRX(IBX) ;
"RTN","IBCSC5C",106,0)
 Q:'$G(IBX)  N X,Y K IBLIST W !
"RTN","IBCSC5C",107,0)
NEWRX1 S DIR("?")="Enter the number preceding the RX Fills you want added to the bill. "_$$HTEXT
"RTN","IBCSC5C",108,0)
 S DIR("A")="SELECT NEW RX FILLS TO ADD THE BILL"
"RTN","IBCSC5C",109,0)
 S DIR(0)="LO^1:"_+IBX D ^DIR K DIR G:'Y!$D(DIRUT) NEWRXE
"RTN","IBCSC5C",110,0)
 S IBLIST=Y
"RTN","IBCSC5C",111,0)
 ;
"RTN","IBCSC5C",112,0)
 S DIR("A")="YOU HAVE SELECTED "_IBLIST_" TO BE ADDED TO THE BILL IS THIS CORRECT",DIR("B")="YES"
"RTN","IBCSC5C",113,0)
 S DIR(0)="YO" D ^DIR K DIR I $D(DIRUT) K IBLIST G NEWRXE
"RTN","IBCSC5C",114,0)
 I 'Y K IBLIST G NEWRX1
"RTN","IBCSC5C",115,0)
NEWRXE Q
"RTN","IBCSC5C",116,0)
 ;
"RTN","IBCSC5C",117,0)
ADDNEW(IBIFN,LIST,IBPR,IBPRO) ;
"RTN","IBCSC5C",118,0)
 Q:'LIST  N IBI,IBX,IBRX,IBDT,IBQ,IBY,IBPIFN,IBZ
"RTN","IBCSC5C",119,0)
 F IBI=1:1 S IBX=$P(LIST,",",IBI) Q:'IBX  I $D(IBPRO(IBX)) D
"RTN","IBCSC5C",120,0)
 . S IBRX=$P(IBPRO(IBX),U,1),IBDT=$P(IBPRO(IBX),U,2) Q:IBRX=""
"RTN","IBCSC5C",121,0)
 . S IBQ=0,IBY=$G(IBPR(IBRX,+IBDT)) Q:'IBY
"RTN","IBCSC5C",122,0)
 . S IBPIFN=0 F  S IBPIFN=$O(^IBA(362.4,"AIFN"_IBIFN,IBRX,IBPIFN)) Q:'IBPIFN  I $P($G(^IBA(362.4,IBPIFN,0)),U,3)=IBDT S IBQ=1 Q
"RTN","IBCSC5C",123,0)
 . ;I 'IBQ S IBZ=$G(IBPR(IBRX,IBDT)) I $$ADD^IBCSC5A(IBRX,IBIFN,IBDT,$P(IBZ,U,3),$P(IBZ,U,1),$P(IBZ,U,4,6),$P(IBZ,U,2)) W "."
"RTN","IBCSC5C",124,0)
 . ; IB*2.0*432 - include issue date from file 52 to display to user when adding 
"RTN","IBCSC5C",125,0)
 . I 'IBQ S IBZ=$G(IBPR(IBRX,IBDT)) I $$ADD^IBCSC5A(IBRX,IBIFN,IBDT,$P(IBZ,U,3),$P(IBZ,U,1),$P(IBZ,U,4,7),$P(IBZ,U,2)) W "."
"RTN","IBCSC5C",126,0)
 Q
"RTN","IBCSC5C",127,0)
 ;
"RTN","IBCSC5C",128,0)
HTEXT() ;
"RTN","IBCSC5C",129,0)
 N X S X="If an Rx fill has been assigned to another bill it will be displayed in the last column. [ORG=Original Fill, NR=Not Released, RTS=Returned to Stock, OTC=Over-the-Counter, INV=Investigational, SUP=Supply Item]"
"RTN","IBCSC5C",130,0)
 Q X
"RTN","IBCSC5C",131,0)
 ;
"RTN","IBCSC5C",132,0)
RXLINK(IBIFN,CPIEN) ; Function returns the ien of the Rx rev code the proc
"RTN","IBCSC5C",133,0)
 ; code is linked to or 0 if no link found.
"RTN","IBCSC5C",134,0)
 Q +$O(^DGCR(399,IBIFN,"RC","ACP",+CPIEN,0))
"RTN","IBCSC5C",135,0)
 ;
"RTN","IBCSC5C",136,0)
EXEMPT(RX) ; Used to look up exemption if any on rx, the return value
"RTN","IBCSC5C",137,0)
 ; will be only the first exemption reason found.
"RTN","IBCSC5C",138,0)
 N IBX,IBZ,IBS,IBR,PDFN,LIST,NODE,ICDCT
"RTN","IBCSC5C",139,0)
 S PDFN=$$FILE^IBRXUTL(RX,2)
"RTN","IBCSC5C",140,0)
 S LIST="IBRXARREX"
"RTN","IBCSC5C",141,0)
 S NODE="ICD"
"RTN","IBCSC5C",142,0)
 D RX^PSO52API(PDFN,LIST,RX,,NODE,,)
"RTN","IBCSC5C",143,0)
 S ICDCT=$G(^TMP($J,LIST,PDFN,RX,"ICD",0))
"RTN","IBCSC5C",144,0)
 S IBR="",(IBS,IBX)=0
"RTN","IBCSC5C",145,0)
 I ICDCT>0 D
"RTN","IBCSC5C",146,0)
 .S IBX=0 F  S IBX=$O(^TMP($J,LIST,PDFN,RX,"ICD",IBX)) Q:IBX'>0!(IBS)  D
"RTN","IBCSC5C",147,0)
 ..S IBZ=$$ICD^IBRXUTL1(PDFN,RX,IBX,LIST) F IBP=2:1:8 Q:IBS  I $P(IBZ,"^",IBP) S IBR=$P($T(EREASON+(IBP-1)),";",3),IBS=1
"RTN","IBCSC5C",148,0)
 K ^TMP($J,LIST)
"RTN","IBCSC5C",149,0)
 Q IBR
"RTN","IBCSC5C",150,0)
EREASON ;
"RTN","IBCSC5C",151,0)
 ;;AO
"RTN","IBCSC5C",152,0)
 ;;IR
"RTN","IBCSC5C",153,0)
 ;;SC
"RTN","IBCSC5C",154,0)
 ;;SWA
"RTN","IBCSC5C",155,0)
 ;;MST
"RTN","IBCSC5C",156,0)
 ;;HNC
"RTN","IBCSC5C",157,0)
 ;;CV
"RTN","IBCSC5C",158,0)
 ;;SHAD
"RTN","IBCSC5C",159,0)
 ;
"RTN","IBCSC6")
0^44^B15100068^B16070928
"RTN","IBCSC6",1,0)
IBCSC6 ;ALB/MJB - MCCR SCREEN 6 (INPT. BILLING INFO) ;27 MAY 88 10:19
"RTN","IBCSC6",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,109,106,51,137,343,400,432**;21-MAR-94;Build 192
"RTN","IBCSC6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC6",4,0)
 ;
"RTN","IBCSC6",5,0)
 ;MAP TO DGCRSC6
"RTN","IBCSC6",6,0)
 ;
"RTN","IBCSC6",7,0)
EN I $P(^DGCR(399,IBIFN,0),"^",5)>2 G EN^IBCSC7
"RTN","IBCSC6",8,0)
 I $D(DGRVRCAL) D ^IBCU6 K DGRVRCAL
"RTN","IBCSC6",9,0)
 D ^IBCSCU S IBSR=6,IBSR1="",IBV1="0000000" S:IBV IBV1="1111111" F I="U","U1",0,"U2","U3" S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"")
"RTN","IBCSC6",10,0)
 D H^IBCSCU
"RTN","IBCSC6",11,0)
 S IBBT=$P(IB(0),U,24)_$P(IB(0),U,5)_$P(IB(0),U,26)
"RTN","IBCSC6",12,0)
 S IBBT1=$P(IB(0),U,24)_$P($G(^DGCR(399.1,+$P(IB(0),U,25),0)),U,2)_$P(IB(0),U,26)
"RTN","IBCSC6",13,0)
 D 4^IBCVA1,5^IBCVA1
"RTN","IBCSC6",14,0)
 ;
"RTN","IBCSC6",15,0)
1 S Z=1,IBW=1 X IBWW W " Bill Type   : ",$S('$D(IBBT1):IBU,IBBT1="":IBU,1:IBBT1)
"RTN","IBCSC6",16,0)
 W $J("",14),"Loc. of Care: ",$E($G(IBBTP1),1,30) K IBBTP1
"RTN","IBCSC6",17,0)
 ;W !?4,"Covered Days: ",$S(IB("U2")="":IBU,$P(IB("U2"),U,2)'="":$P(IB("U2"),U,2),1:IBU)
"RTN","IBCSC6",18,0)
 W !?4,"Charge Type : ",$S($P(IB(0),U,27)=1:"INSTITUTIONAL",$P(IB(0),U,27)=2:"PROFESSIONAL",1:IBU)
"RTN","IBCSC6",19,0)
 ; IB*2.0*432 - remove Covered, Non-covered and co-insurance days
"RTN","IBCSC6",20,0)
 ;W !?4,"Non-Cov Days: ",$S(IB("U2")="":IBU,$P(IB("U2"),U,3)'="":$P(IB("U2"),U,3),1:IBU)
"RTN","IBCSC6",21,0)
 W ?38,"Timeframe: ",$S($D(IBBTP3):$E(IBBTP3,1,30),1:"") K IBBTP3
"RTN","IBCSC6",22,0)
 W !?4,"Form Type   : ",$P($G(^IBE(353,+$P(IB(0),U,19),0)),U,1)
"RTN","IBCSC6",23,0)
 W ?39,"Division: ",$E($P($G(^DG(40.8,+$P(IB(0),U,22),0)),U,1),1,30)
"RTN","IBCSC6",24,0)
 W !,?4,"Bill Classif: ",$E($G(IBBTP2),1,30) K IBBTP2
"RTN","IBCSC6",25,0)
 ;W ?34,"Co-Insur Days: ",$S($P(IB("U2"),U,7)="":$S($$MCRONBIL^IBEFUNC(IBIFN):IBU,1:IBUN),1:$P(IB("U2"),U,7))
"RTN","IBCSC6",26,0)
 ;
"RTN","IBCSC6",27,0)
ROI S Z=2,IBW=1 X IBWW
"RTN","IBCSC6",28,0)
 W " Sensitive?  : ",$S(IB("U")="":IBU,$P(IB("U"),U,5)="":IBU,$P(IB("U"),U,5)=1:"YES",1:"NO")
"RTN","IBCSC6",29,0)
 W ?46,"Assignment: ",$S(IB("U")="":IBU,$P(IB("U"),U,6)="":IBU,$P(IB("U"),U,6)["n":"NO",$P(IB("U"),U,6)["N":"NO",$P(IB("U"),U,6)=0:"NO",1:"YES")
"RTN","IBCSC6",30,0)
 I $P(IB("U"),U,5)=1 W !?4,"R.O.I. Form : ",$S($P(IB("U"),U,7)=1:"COMPLETED",$P(IB("U"),U,7)=0:"NOT COMPLETED",1:"STATUS UNKNOWN")
"RTN","IBCSC6",31,0)
 S IBOA="01^02^03^04^05^06^" F I=1:1:5 Q:'$D(IBOCN(I))  I IBOA[IBOCN(I)_"^" S IBOX=1
"RTN","IBCSC6",32,0)
 W:$D(IBOX) !,?4,"Pow of Atty : ",$S($P(IB("U"),U,3)=1:"COMPLETED",$P(IB("U"),U,3)=0:"NOT COMPLETED",1:"STATUS UNKNOWN")
"RTN","IBCSC6",33,0)
 ;
"RTN","IBCSC6",34,0)
3 S Z=3,IBW=1 X IBWW D FROMTO
"RTN","IBCSC6",35,0)
 ;
"RTN","IBCSC6",36,0)
BED S Z=4,IBW=1 X IBWW
"RTN","IBCSC6",37,0)
 W " Bedsection  : ",$S(IB("U")="":IBU,$P(IB("U"),U,11)'="":$P(^DGCR(399.1,$P(IB("U"),U,11),0),U,1),1:IBU)
"RTN","IBCSC6",38,0)
 W !?4,"LOS         : ",IBLS
"RTN","IBCSC6",39,0)
 ;
"RTN","IBCSC6",40,0)
 I $P($G(^DPT(DFN,.3)),"^")="Y" D SC I IBSCM>0 W !?4,"PTF record indicates ",IBSCM," of ",IBM," movements are for Service Connected Care."
"RTN","IBCSC6",41,0)
 ;
"RTN","IBCSC6",42,0)
REV S Z=5,IBREVC=0,IBW=1 X IBWW W " Rev. Code   : " F I=1:1:8 Q:'$D(IBREVC(I))  D:$S(IBREVC<7:1,1:$P(IBREVC(I),U,9)="") REV^IBCSC61 S IBREVC=IBREVC+1 Q:IBREVC>7
"RTN","IBCSC6",43,0)
 I $G(IBREVC)>9 W !,?4,"Too many Revenue Codes to display, enter '5' to list"
"RTN","IBCSC6",44,0)
BILL D OFFSET^IBCSC61
"RTN","IBCSC6",45,0)
 I $G(IBUCH),$$FT^IBCEF(IBIFN)=3 S X=IBUCH,X2="2$" D COMMA^%DTC W !,?39,"Non-Cov: ",X
"RTN","IBCSC6",46,0)
 ;
"RTN","IBCSC6",47,0)
RS S Z=6,IBW=1 X IBWW W " Rate Sched  : (re-calculate charges)"
"RTN","IBCSC6",48,0)
 ;
"RTN","IBCSC6",49,0)
PRPAY S Z=7,IBW=1 X IBWW
"RTN","IBCSC6",50,0)
 S IB("M1")=$G(^DGCR(399,IBIFN,"M1")),X3=0,IBI="Prior Payments:" F X=0,1,2 D
"RTN","IBCSC6",51,0)
 . S X1=$P(IB("U2"),U,(X+4)),X2=$P(IB("M1"),U,(5+X)) I X1="",X2="" Q
"RTN","IBCSC6",52,0)
 . S IBI=IBI_$J("",(17-$L(IBI)))_$S(X=0:"Primary",X=1:"Secondary",X=2:"Tertiary",1:"")
"RTN","IBCSC6",53,0)
 . S IBI=IBI_$J("",(28-$L(IBI)))_$S(X1'="":$J(X1,11,2),1:IBU)
"RTN","IBCSC6",54,0)
 . S IBI=IBI_$J("",(50-$L(IBI)))_"Bill #: "_$S(+X2:$P($G(^DGCR(399,+X2,0)),U,1),1:IBU)
"RTN","IBCSC6",55,0)
 . W:'X3 " " W:X3 !,?4 W IBI S X3=1,IBI=""
"RTN","IBCSC6",56,0)
 I 'X3 W " Prior Claims: ",IBU
"RTN","IBCSC6",57,0)
 ;
"RTN","IBCSC6",58,0)
 G ^IBCSCP
"RTN","IBCSC6",59,0)
 Q
"RTN","IBCSC6",60,0)
 ;
"RTN","IBCSC6",61,0)
FROMTO ;  - Print From and To dates of bill
"RTN","IBCSC6",62,0)
 W " Bill From   : " S Y=$P(IB("U"),"^") D D^DIQ W $S($L(Y):Y,1:IBU)
"RTN","IBCSC6",63,0)
 W ?49,"Bill To: " S Y=$P(IB("U"),"^",2) D D^DIQ W $S($L(Y):Y,1:IBU)
"RTN","IBCSC6",64,0)
 Q
"RTN","IBCSC6",65,0)
 ;
"RTN","IBCSC6",66,0)
SC ;  -if patient is sc, are movements for sc care
"RTN","IBCSC6",67,0)
 S PTF=$P(IB(0),"^",8)
"RTN","IBCSC6",68,0)
 ;
"RTN","IBCSC6",69,0)
SC1 ;
"RTN","IBCSC6",70,0)
 ;  -input ptf
"RTN","IBCSC6",71,0)
 ;
"RTN","IBCSC6",72,0)
 ;  -output IBm   = number of movements
"RTN","IBCSC6",73,0)
 ;          IBscm = number of SC movements
"RTN","IBCSC6",74,0)
 S (IBM,IBSCM,M)=0
"RTN","IBCSC6",75,0)
 I $S('PTF:1,'$D(^DGPT(PTF,0)):1,1:0) Q
"RTN","IBCSC6",76,0)
 F  S M=$O(^DGPT(PTF,"M",M)) Q:'M  S IBM=IBM+1 I $P($G(^DGPT(PTF,"M",M,0)),"^",18)=1 S IBSCM=IBSCM+1
"RTN","IBCSC6",77,0)
 Q
"RTN","IBCSC6",78,0)
 ;IBCSC6
"RTN","IBCSC7")
0^37^B6990382^B7519963
"RTN","IBCSC7",1,0)
IBCSC7 ;ALB/MJB - MCCR SCREEN 7 (INPT. BILLING INFO)  ;27 MAY 88 10:19
"RTN","IBCSC7",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,109,106,343,400,432**;21-MAR-94;Build 192
"RTN","IBCSC7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC7",4,0)
 ;
"RTN","IBCSC7",5,0)
 ;MAP TO DGCRSC7
"RTN","IBCSC7",6,0)
 ;
"RTN","IBCSC7",7,0)
 I $P(^DGCR(399,IBIFN,0),"^",5)'>2 G ^IBCSC8
"RTN","IBCSC7",8,0)
 I $D(DGRVRCAL) D ^IBCU6 K DGRVRCAL
"RTN","IBCSC7",9,0)
EN D ^IBCSCU S IBSR=7,IBSR1="",IBV1="0000000" S:IBV IBV1="1111111" F I="U","U1",0,"U2","U3" S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"")
"RTN","IBCSC7",10,0)
 D H^IBCSCU
"RTN","IBCSC7",11,0)
 D 4^IBCVA1,5^IBCVA1
"RTN","IBCSC7",12,0)
 S IBBT=$P(IB(0),U,24)_$P($G(^DGCR(399.1,+$P(IB(0),U,25),0)),U,2)_$P(IB(0),U,26)
"RTN","IBCSC7",13,0)
 S Z=1,IBW=1 X IBWW W " Bill Type   : ",$S('$D(IBBT):IBU,IBBT="":IBU,1:IBBT)
"RTN","IBCSC7",14,0)
 W $J("",14),"Loc. of Care: ",$E($G(IBBTP1),1,30) K IBBTP1
"RTN","IBCSC7",15,0)
 ; IB*2.0*432 - remove Covered, Non-covered and co-insurance days
"RTN","IBCSC7",16,0)
 ;W !?4,"Covered Days: ",$S(IB("U2")="":IBU,$P(IB("U2"),U,2)'="":$P(IB("U2"),U,2),1:IBU)
"RTN","IBCSC7",17,0)
 W !?4,"Charge Type : ",$S($P(IB(0),U,27)=1:"INSTITUTIONAL",$P(IB(0),U,27)=2:"PROFESSIONAL",1:IBU)
"RTN","IBCSC7",18,0)
 W ?37,"Disch Stat: ",$E($$EXTERNAL^DILFD(399,162,"",$P(IB("U"),U,12)),1,30)
"RTN","IBCSC7",19,0)
 W !?4,"Form Type   : ",$P($G(^IBE(353,+$P(IB(0),U,19),0)),U,1)
"RTN","IBCSC7",20,0)
 W ?38,"Timeframe: ",$S($D(IBBTP3):$E(IBBTP3,1,30),1:"") K IBBTP3
"RTN","IBCSC7",21,0)
 W !,?4,"Bill Classif: ",$E($G(IBBTP2),1,30) K IBBTP2
"RTN","IBCSC7",22,0)
 ;W !?4,"Non-Cov Days: ",$S(IB("U2")="":IBU,$P(IB("U2"),U,3)'="":$P(IB("U2"),U,3),1:IBU)
"RTN","IBCSC7",23,0)
 W ?39,"Division: ",$E($P($G(^DG(40.8,+$P(IB(0),U,22),0)),U,1),1,30)
"RTN","IBCSC7",24,0)
 ;
"RTN","IBCSC7",25,0)
ROI S Z=2,IBW=1 X IBWW
"RTN","IBCSC7",26,0)
 W " Sensitive?  : ",$S(IB("U")="":IBU,$P(IB("U"),U,5)="":IBU,$P(IB("U"),U,5)=1:"YES",1:"NO")
"RTN","IBCSC7",27,0)
 W ?46,"Assignment: ",$S(IB("U")="":IBU,$P(IB("U"),U,6)="":IBU,$P(IB("U"),U,6)["n":"NO",$P(IB("U"),U,6)["N":"NO",$P(IB("U"),U,6)=0:"NO",1:"YES")
"RTN","IBCSC7",28,0)
 I $P(IB("U"),U,5)=1 W !?4,"R.O.I. Form : ",$S($P(IB("U"),U,7)=1:"COMPLETED",$P(IB("U"),U,7)=0:"NOT COMPLETED",1:"STATUS UNKNOWN")
"RTN","IBCSC7",29,0)
 S IBOA="01^02^03^04^05^06^" F I=1:1:5 Q:'$D(IBOCN(I))  I IBOA[IBOCN(I)_"^" S IBOX=1
"RTN","IBCSC7",30,0)
 W:$D(IBOX) !,?4,"Pow of Atty : ",$S($P(IB("U"),U,3)=1:"COMPLETED",$P(IB("U"),U,3)=0:"NOT COMPLETED",1:"STATUS UNKNOWN")
"RTN","IBCSC7",31,0)
 ;
"RTN","IBCSC7",32,0)
 S Z=3,IBW=1 X IBWW D FROMTO^IBCSC6
"RTN","IBCSC7",33,0)
 ;
"RTN","IBCSC7",34,0)
OP S Z=4,IBW=1 X IBWW W " OP Visits   : " F I=0:0 S I=$O(^DGCR(399,IBIFN,"OP",I)) Q:'I  S Y=I X ^DD("DD") W:$X>67 !?18 W Y_", "
"RTN","IBCSC7",35,0)
 I '$O(^DGCR(399,IBIFN,"OP",0)) W IBU
"RTN","IBCSC7",36,0)
 ;
"RTN","IBCSC7",37,0)
 G REV^IBCSC6
"RTN","IBCSC7",38,0)
 ;
"RTN","IBCSC7",39,0)
 ;IBCSC7
"RTN","IBCSC8")
0^23^B8784188^B3226944
"RTN","IBCSC8",1,0)
IBCSC8 ;ALB/MJB/AAS - MCCR SCREEN 8 (BILLING - CLAIM INFORMATION SCREEN) ;27 MAY 88 10:15
"RTN","IBCSC8",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCSC8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSC8",4,0)
 ;
"RTN","IBCSC8",5,0)
 ;
"RTN","IBCSC8",6,0)
EN D ^IBCSCU S IBSR=8,IBSR1="" S IB("U4")=$G(^DGCR(399,IBIFN,"U4")),IB("U5")=$G(^DGCR(399,IBIFN,"U5")),IB("U6")=$G(^DGCR(399,IBIFN,"U6")),IB("U8")=$G(^DGCR(399,IBIFN,"U8"))
"RTN","IBCSC8",7,0)
 D H^IBCSCU
"RTN","IBCSC8",8,0)
 ; DEM - IBV is set in EDI^IBCB => S IBAC=1,IBV=0 D EN G Q:'IBAC1,EDI
"RTN","IBCSC8",9,0)
 ;       IBV=0, or IBV=1 as a flag if field on screen is required
"RTN","IBCSC8",10,0)
 ;       or not. <Field #> indicates field is not required.
"RTN","IBCSC8",11,0)
 ;       [Field #]
"RTN","IBCSC8",12,0)
 ; Make some sections NOT available for UB04 form
"RTN","IBCSC8",13,0)
 S IBT=$P($G(^DGCR(399,IBIFN,0)),U,19)
"RTN","IBCSC8",14,0)
 S IBV1=$S(IBT=3:"0011011",IBV:"1111111",1:"0000000")
"RTN","IBCSC8",15,0)
 ;
"RTN","IBCSC8",16,0)
 S Z=1,IBW=1 X IBWW W " COB Non-Covered Charge Amt: " S X=$P(IB("U4"),U),X2="2$" I X'="" D COMMA^%DTC W X
"RTN","IBCSC8",17,0)
 S Z=2 X IBWW W " Property Casualty Information"
"RTN","IBCSC8",18,0)
 W !,?4,"Claim Number:  ",$P(IB("U4"),U,2),?41,"Contact Name:  ",$P(IB("U4"),U,9)
"RTN","IBCSC8",19,0)
 W !,?4,"Date of 1st Contact:  ",$$FMTE^XLFDT($P(IB("U4"),U,3)),?41,"Contact Phone:  ",$P(IB("U4"),U,10),"  ",$P(IB("U4"),U,11)
"RTN","IBCSC8",20,0)
 S Z=3 X IBWW W " Ambulance Information"
"RTN","IBCSC8",21,0)
 W !,?41,"D/O Location: ",$P(IB("U6"),U)
"RTN","IBCSC8",22,0)
 W !,?4,"P/U Address1:  ",$P(IB("U5"),U,2),?41,"D/O Address1:  ",$P(IB("U6"),U,2)
"RTN","IBCSC8",23,0)
 W !,?4,"P/U Address2:  ",$P(IB("U5"),U,3),?41,"D/O Address2:  ",$P(IB("U6"),U,3)
"RTN","IBCSC8",24,0)
 W !,?4,"P/U City:  ",$P(IB("U5"),U,4),?41,"D/O City:  ",$P(IB("U6"),U,4)
"RTN","IBCSC8",25,0)
 W !,?4,"P/U State/Zip:  " W:$P(IB("U5"),U,5)'="" $P($G(^DIC(5,$P(IB("U5"),U,5),0)),U,2)
"RTN","IBCSC8",26,0)
 W:$P(IB("U5"),U,6)]"" "/"_$P(IB("U5"),U,6)
"RTN","IBCSC8",27,0)
 W ?41,"D/O State/Zip:  " W:$P(IB("U6"),U,5)'="" $P($G(^DIC(5,$P(IB("U6"),U,5),0)),U,2)
"RTN","IBCSC8",28,0)
 W:$P(IB("U6"),U,6)]"" "/"_$P(IB("U6"),U,6)
"RTN","IBCSC8",29,0)
 ;W !,?4,"P/U Country/SubDiv:  ",$P(IB("U5"),U),?41,"D/O Country/SubDiv:  "
"RTN","IBCSC8",30,0)
 S Z=4 X IBWW W " Surgical Codes for Anesthesia Claims"
"RTN","IBCSC8",31,0)
 W !,?4,"Primary Code:  " W:$P(IB("U4"),U,7)'="" $P($G(^ICPT($P(IB("U4"),U,7),0)),U)
"RTN","IBCSC8",32,0)
 W ?41,"Secondary Code:  " W:$P(IB("U4"),U,8)'="" $P($G(^ICPT($P(IB("U4"),U,8),0)),U)
"RTN","IBCSC8",33,0)
 S Z=5 X IBWW W " Paperwork Attachment Information"
"RTN","IBCSC8",34,0)
 W !,?4,"Report Type:  " W:$P(IB("U8"),U,2)'="" $P($G(^IBE(353.3,$P(IB("U8"),U,2),0)),U)
"RTN","IBCSC8",35,0)
 W ?41,"Transmission Method:  ",$P(IB("U8"),U,3)
"RTN","IBCSC8",36,0)
 W !,?4,"Attachment Control #:  ",$P(IB("U8"),U)
"RTN","IBCSC8",37,0)
 S Z=6 X IBWW W " Disability Start Date:  ",$$FMTE^XLFDT($P(IB("U4"),U,4)),?41,"Disability End Date:  ",$$FMTE^XLFDT($P(IB("U4"),U,5))
"RTN","IBCSC8",38,0)
 S Z=7 X IBWW W " Assumed Care Date:  ",$$FMTE^XLFDT($P(IB("U4"),U,13)),?41,"Relinquished Care Date:  ",$$FMTE^XLFDT($P(IB("U4"),U,14))
"RTN","IBCSC8",39,0)
 W !
"RTN","IBCSC8",40,0)
REV G ^IBCSCP
"RTN","IBCSC8",41,0)
 ;IBCSC8
"RTN","IBCSC82")
1^28^^B34330595
"RTN","IBCSC8A")
1^29^^B7456472
"RTN","IBCSC8B")
1^30^^B41247603
"RTN","IBCSC8H")
1^31^^B42537068
"RTN","IBCSCE")
0^39^B9117892^B9045133
"RTN","IBCSCE",1,0)
IBCSCE ;ALB/MRL,MJB - MCCR SCREEN EDITS ;07 JUN 88 14:35
"RTN","IBCSCE",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,91,106,51,137,236,245,287,349,371,400,432**;21-MAR-94;Build 192
"RTN","IBCSCE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSCE",4,0)
 ;
"RTN","IBCSCE",5,0)
 ;MAP TO DGCRSCE
"RTN","IBCSCE",6,0)
 ; always do procedures last because they are edited upon return to screen routine
"RTN","IBCSCE",7,0)
 I IBDR20["54," S IBDR20=$P(IBDR20,"54,",1)_$P(IBDR20,"54,",2)_"54,"
"RTN","IBCSCE",8,0)
 I IBDR20["44," S IBDR20=$P(IBDR20,"44,",1)_$P(IBDR20,"44,",2)_"44,"
"RTN","IBCSCE",9,0)
LOOP N IBDRLP,IBDRL S IBDRLP=IBDR20 F IBDRL=1:1 S IBDR20=$P(IBDRLP,",",IBDRL) Q:IBDR20=""  D EDIT
"RTN","IBCSCE",10,0)
 Q
"RTN","IBCSCE",11,0)
EDIT N IBQUERY
"RTN","IBCSCE",12,0)
 I (IBDR20["31") D MCCR^IBCNSP2 G ENQ
"RTN","IBCSCE",13,0)
 I (IBDR20["43")!(IBDR20["52") D ^IBCSC4D G ENQ
"RTN","IBCSCE",14,0)
 I (IBDR20["74")!(IBDR20["53") K DR N I D ^IBCOPV S (DA,Y)=IBIFN G TMPL
"RTN","IBCSCE",15,0)
 I (IBDR20["54"),$P($G(^IBE(350.9,1,1)),"^",17) K DR N I D EN1^IBCCPT(.IBQUERY) D CLOSE^IBSDU(.IBQUERY) G TMPL ;
"RTN","IBCSCE",16,0)
 I (IBDR20["55") D ^IBCSC5A G ENQ
"RTN","IBCSCE",17,0)
 I (IBDR20["45")!(IBDR20["56") D ^IBCSC5B G ENQ
"RTN","IBCSCE",18,0)
 I (IBDR20["66")!(IBDR20["76") D EDIT^IBCRBE(IBIFN) D ASKCMB^IBCU65(IBIFN) G ENQ
"RTN","IBCSCE",19,0)
 I IBDR20["102",$$FT^IBCEF(IBIFN)=3 D EN^IBCSC10B G ENQ   ; UB-04 patient reason for visit (screen 10, section 2)
"RTN","IBCSCE",20,0)
 I IBDR20["105",$$FT^IBCEF(IBIFN)=2 D ^IBCSC10A G ENQ     ; cms-1500 chiropractic data (screen 10, section 5)
"RTN","IBCSCE",21,0)
 I IBDR20["107",$$FT^IBCEF(IBIFN)=3 D EN1^IBCEP6 G ENQ   ; UB-04 provider ID maintenance (screen 10, section 7)
"RTN","IBCSCE",22,0)
 I IBDR20["109",$$FT^IBCEF(IBIFN)=2 D EN1^IBCEP6 G ENQ   ; cms-1500 provider ID maintenance (screen 10, section 9)
"RTN","IBCSCE",23,0)
 ;
"RTN","IBCSCE",24,0)
 F Q=1:1:9 I IBDR20[("9"_Q) D EDIT^IBCSC9 G ENQ
"RTN","IBCSCE",25,0)
TMPL N IBFLIAE S IBFLIAE=1 ;to invoke EN^DGREGAED from [IB SCREEN1]
"RTN","IBCSCE",26,0)
 S DR="[IB SCREEN"_IBSR_IBSR1_"]",(DA,Y)=IBIFN,DIE="^DGCR(399,"
"RTN","IBCSCE",27,0)
 D ^DIE K DIE,DR,DLAYGO
"RTN","IBCSCE",28,0)
 I (IBDR20["61")!(IBDR20["71") I +$G(DGRVRCAL) D PROC^IBCU7A(IBIFN,1)
"RTN","IBCSCE",29,0)
 ;
"RTN","IBCSCE",30,0)
ENQ ;
"RTN","IBCSCE",31,0)
 K DIE,DR,IBDR1,IBDR20,DGDRD,DGDRS,DGDRS1,DA
"RTN","IBCSCE",32,0)
 Q
"RTN","IBCSCE",33,0)
 ;
"RTN","IBCSCE",34,0)
 ;called by screen 3 (input template)
"RTN","IBCSCE",35,0)
UPDT F IBDD=0:0 S IBDD=$O(^DPT(DFN,.312,IBDD)) Q:IBDD'>0  S IBI1=^DPT(DFN,.312,IBDD,0) I $D(^DIC(36,+IBI1,0)),$P(^(0),"^",2)'="N" S IBDD(+IBI1)=IBI1
"RTN","IBCSCE",36,0)
 F IBAIC=0:0 S IBAIC=$O(^DGCR(399,IBIFN,"AIC",IBAIC)) Q:IBAIC'>0  I $D(IBDD(IBAIC)) F IBI1="I1","I2","I3" I $D(^DGCR(399,IBIFN,IBI1)),+^(IBI1)=IBAIC,^(IBI1)'=IBDD(IBAIC) S ^DGCR(399,IBIFN,IBI1)=IBDD(IBAIC)
"RTN","IBCSCE",37,0)
 K IBAIC,IBDD,IBI1 Q
"RTN","IBCSCE",38,0)
 ;
"RTN","IBCSCE",39,0)
 ;Edit patient's address using DGREGAED API
"RTN","IBCSCE",40,0)
EDADDR(IBDFN) ;
"RTN","IBCSCE",41,0)
 I $G(IBFLIAE)'=1!(IBDFN=0) Q 0
"RTN","IBCSCE",42,0)
 N IBFL S IBFL(1)=1
"RTN","IBCSCE",43,0)
 N X,Y,DIE,DA,DR,DIDEL,DIW,DIEDA,DG,DICR
"RTN","IBCSCE",44,0)
 D EN^DGREGAED(IBDFN,.IBFL)
"RTN","IBCSCE",45,0)
 Q 1
"RTN","IBCSCE",46,0)
 ;IBCSCE
"RTN","IBCSCH")
0^24^B47256662^B46654544
"RTN","IBCSCH",1,0)
IBCSCH ;ALB/MJB - MCCR HELP ROUTINE ;03 JUN 88 15:25
"RTN","IBCSCH",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,106,124,138,51,148,137,161,245,232,287,348,349,374,371,395,400,432**;21-MAR-94;Build 192
"RTN","IBCSCH",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSCH",4,0)
 ;
"RTN","IBCSCH",5,0)
 ;MAP TO DGCRSCH
"RTN","IBCSCH",6,0)
 ;
"RTN","IBCSCH",7,0)
 N I,C,IBSCNNZ,IBQ,IBPRNT,Z S IBSCNNZ=$$UP^XLFSTR($G(IBSCNN)),IBQ=0
"RTN","IBCSCH",8,0)
 I '$D(IBPAR) D  Q:IBQ
"RTN","IBCSCH",9,0)
 . I $F(".?1500.?HCFA.","."_$G(IBSCNNZ)_"."),$$FT^IBCEF(IBIFN)=2 S IBQ=1,IBPRNT=2 D BL24(IBIFN,0) Q
"RTN","IBCSCH",10,0)
 . I $G(IBSCNNZ)="?SC" S IBQ=1 D DISPSC(IBIFN) Q
"RTN","IBCSCH",11,0)
 . I $G(IBSCNNZ)="?INS" S IBQ=1 D INSDSPL(IBIFN) Q
"RTN","IBCSCH",12,0)
 . I $G(IBSCNNZ)="?INX" S IBQ=1 D INSDSPLX(IBIFN) Q
"RTN","IBCSCH",13,0)
 . I $G(IBSCNNZ)="?PRV" S IBQ=1 D DISPROPT(IBIFN) Q
"RTN","IBCSCH",14,0)
 . I $G(IBSCNNZ)="?CHG" S IBQ=1 D DISPCHG^IBCRBH1(IBIFN) Q
"RTN","IBCSCH",15,0)
 . I $G(IBSCNNZ)="?PRC" S IBQ=1 D DISPPRC^IBCSCH1(IBIFN) Q
"RTN","IBCSCH",16,0)
 . I $G(IBSCNNZ)="?CPT" S IBQ=1 D BCPTCHG^IBCRBH2(IBIFN) Q
"RTN","IBCSCH",17,0)
 . I $G(IBSCNNZ)="?INC" S IBQ=1 D EDIT^IBCBB(IBIFN) Q
"RTN","IBCSCH",18,0)
 . I $G(IBSCNNZ)="?CLA",$$CK0^IBCIUT1() S IBQ=1 D CLA^IBCISC(IBIFN) Q
"RTN","IBCSCH",19,0)
 . I $G(IBSCNNZ)="?MRA",$$MCRONBIL^IBEFUNC(IBIFN),$T(SCR^IBCEMVU)'="" S IBQ=1 D SCR^IBCEMVU(IBIFN) Q
"RTN","IBCSCH",20,0)
 . I $G(IBSCNNZ)="?ID" S IBQ=1 D DISPID^IBCEF74(IBIFN) Q
"RTN","IBCSCH",21,0)
 . I $G(IBSCNNZ)="?RX" S IBQ=1 D DISPRX^IBCSCH1(IBIFN) Q
"RTN","IBCSCH",22,0)
 . Q
"RTN","IBCSCH",23,0)
 ;
"RTN","IBCSCH",24,0)
 S IBH("HELP")="" D ^IBCSCU,H^IBCSCU K IBH("HELP") W !,"Enter '^' to stop the display ",$S(IBV:"",1:"and edit "),"of data,"
"RTN","IBCSCH",25,0)
 W:'$D(IBPAR) " '^N' to jump to screen #N (see",!,"listing below), <RET> to continue on to the next available screen" I IBV W "." G M
"RTN","IBCSCH",26,0)
 W " or enter",!,"the field group number(s) you wish to edit using commas and dashes as",!,"delimiters.  Those groups enclosed in brackets ""[]"" are editable while those"
"RTN","IBCSCH",27,0)
 W !,"enclosed in arrows ""<>"" are not."
"RTN","IBCSCH",28,0)
 G:$D(IBPAR) M1
"RTN","IBCSCH",29,0)
M W "  Special help screens:"
"RTN","IBCSCH",30,0)
 W !,?5,"Enter '?SC' to view SC Status and Rated Disabilities."
"RTN","IBCSCH",31,0)
 W !,?5,"Enter '?INS' to view the patients insurance policies."
"RTN","IBCSCH",32,0)
 W !,?5,"Enter '?INX' to view the patients insurance policies with comments."
"RTN","IBCSCH",33,0)
 W !,?5,"Enter '?PRV' to view provider specific information."
"RTN","IBCSCH",34,0)
 W !,?5,"Enter '?PRC' to view all procedures on the bill and related data."
"RTN","IBCSCH",35,0)
 W !,?5,"Enter '?CHG' to view all items on the bill with potential charges."
"RTN","IBCSCH",36,0)
 W !,?5,"Enter '?CPT' to view all charges for selected CPT codes and bill type."
"RTN","IBCSCH",37,0)
 I $$FT^IBCEF(IBIFN)=2 W !,?5,"Enter '?1500' to view how block 24 will print on a CMS-1500."
"RTN","IBCSCH",38,0)
 W !,?5,"Enter '?INC' to execute the edits & view the bill inconsistencies."
"RTN","IBCSCH",39,0)
 I $$CK0^IBCIUT1() W !?5,"Enter '?CLA' to view the ClaimsManager options."
"RTN","IBCSCH",40,0)
 I $$MCRONBIL^IBEFUNC(IBIFN) W !?5,"Enter '?MRA' to view Medicare Remittance Advice EOB's on file."
"RTN","IBCSCH",41,0)
 W !,?5,"Enter '?ID' to view all IDs to be electronically transmitted on this claim."
"RTN","IBCSCH",42,0)
 W !,?5,"Enter '?RX' to view all prescriptions on this claim."
"RTN","IBCSCH",43,0)
 ;
"RTN","IBCSCH",44,0)
 D S W ! F I=$Y:1:20 W !
"RTN","IBCSCH",45,0)
 S Z="PRESS <RETURN> KEY" X IBWW W " to RETURN to SCREEN ",+IBSR
"RTN","IBCSCH",46,0)
 R X:DTIME
"RTN","IBCSCH",47,0)
 Q
"RTN","IBCSCH",48,0)
 ;
"RTN","IBCSCH",49,0)
M1 N I,Z S Z="DATA GROUPS ON PARAMETER SCREEN" W !! X IBWW D @(IBSR1_IBSR) D W W ! F I=$Y:1:20 W !
"RTN","IBCSCH",50,0)
 S Z="PRESS <RETURN> KEY" X IBWW W " to RETURN to PARAMETER SCREEN"
"RTN","IBCSCH",51,0)
 R X:DTIME
"RTN","IBCSCH",52,0)
 Q
"RTN","IBCSCH",53,0)
 ;
"RTN","IBCSCH",54,0)
 ;
"RTN","IBCSCH",55,0)
PAR S X="Fed Tax #, BC/BS #, MAS Svc Pointer^Bill Signer, Billing Supervisor^Security Parameters, Outpatient CPT parameters ^Remarks, Mailgroups^Agent Cashier Address/Phone" Q
"RTN","IBCSCH",56,0)
 ;
"RTN","IBCSCH",57,0)
S ; display the available screen data
"RTN","IBCSCH",58,0)
 N C,I,Z,J W ! S Z="AVAILABLE SCREENS" X IBWW
"RTN","IBCSCH",59,0)
 S X="Demographic^Employment^Payer^Inpatient Event^Outpatient Event^Inpatient Billing - General^Outpatient Billing - General^Billing - Claim Information^Locally Defined^Billing - Specific"
"RTN","IBCSCH",60,0)
 S C=0 F I=1:1 S J=$P(X,"^",I) Q:J=""  I '$E(IBVV,I) S C=C+1,Z="^"_I,IBW=(C#2) W:'(C#2) ?41 X IBWW S Z=$S(I?1N:" ",1:" ")_J_" Data" W Z
"RTN","IBCSCH",61,0)
 Q
"RTN","IBCSCH",62,0)
 ;
"RTN","IBCSCH",63,0)
W ;
"RTN","IBCSCH",64,0)
 N I,J,Z
"RTN","IBCSCH",65,0)
 F I=1:1 S J=$P(X,"^",I) Q:J=""  S Z=I,IBW=(I#2) W:'(I#2) ?42 X IBWW W " "_J
"RTN","IBCSCH",66,0)
 W:'(I-1)#2 ! Q
"RTN","IBCSCH",67,0)
 Q
"RTN","IBCSCH",68,0)
 ;IBCSCH
"RTN","IBCSCH",69,0)
 ;
"RTN","IBCSCH",70,0)
 ;
"RTN","IBCSCH",71,0)
BL24(IBIFN,IBNOSHOW) ; display block 24 of CMS-1500
"RTN","IBCSCH",72,0)
 ; IBNOSHOW = 1 for not to show error/warning text line
"RTN","IBCSCH",73,0)
 N X,Y,DIR,IBPG,IBLN,IBCOL,IBX,IBQ,IBLC,IBLIN,IBPFORM,IBD,IBC1,Z,Z0,IBXDATA,IBXSAVE,IBNXPG
"RTN","IBCSCH",74,0)
 K ^TMP("IBXSAVE",$J)
"RTN","IBCSCH",75,0)
 S IBQ=0,IBLC=9 Q:'$G(IBIFN)  K ^TMP("IBXDISP",$J)
"RTN","IBCSCH",76,0)
 ;
"RTN","IBCSCH",77,0)
 S IBLIN=$$BOX24D^IBCEF11()
"RTN","IBCSCH",78,0)
 S IBPFORM=$S($P($G(^IBE(353,2,2)),U,8):$P(^(2),U,8),1:2)
"RTN","IBCSCH",79,0)
 S IBX=$$BILLN^IBCEFG0(0,"1^99",IBLIN,+IBIFN,IBPFORM)
"RTN","IBCSCH",80,0)
 ;
"RTN","IBCSCH",81,0)
 W @IOF,!,"Example of diagnoses, procedures and charges printing on the CMS-1500"
"RTN","IBCSCH",82,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",83,0)
 ;
"RTN","IBCSCH",84,0)
 ; box 19 - lines 36-37
"RTN","IBCSCH",85,0)
 F Z=+IBLIN,IBLIN+1 I $D(^TMP("IBXDISP",$J,1,Z)) S Z0=$G(^TMP("IBXDISP",$J,1,Z,+$O(^TMP("IBXDISP",$J,1,Z,20),-1))) I Z0'="" S:Z=+IBLIN Z0="BOX 19 DATA: "_Z0 W !,Z0
"RTN","IBCSCH",86,0)
 ;
"RTN","IBCSCH",87,0)
 ; box 21 - lines 39-41
"RTN","IBCSCH",88,0)
 W !,"21. diagnosis"
"RTN","IBCSCH",89,0)
 I $D(^TMP("IBXDISP",$J,2,IBLIN+3)) W ?16,"(1st 4 only)"
"RTN","IBCSCH",90,0)
 W !,?5,"1. ",$G(^TMP("IBXDISP",$J,1,IBLIN+3,3)),?25,"3. ",$G(^TMP("IBXDISP",$J,1,IBLIN+3,30))
"RTN","IBCSCH",91,0)
 W !,?5,"2. ",$G(^TMP("IBXDISP",$J,1,IBLIN+5,3)),?25,"4. ",$G(^TMP("IBXDISP",$J,1,IBLIN+5,30))
"RTN","IBCSCH",92,0)
 ;
"RTN","IBCSCH",93,0)
 ; box 24 - lines 44-55
"RTN","IBCSCH",94,0)
 D PG
"RTN","IBCSCH",95,0)
 S IBPG=0 F  S IBPG=$O(^TMP("IBXDISP",$J,IBPG)) Q:'IBPG  D  Q:IBQ
"RTN","IBCSCH",96,0)
 . I '$D(^TMP("IBXDISP",$J,IBPG,IBLIN+9)) Q   ; no line's on this page
"RTN","IBCSCH",97,0)
 . F IBLN=IBLIN+8:1:+$P(IBLIN,U,2) S IBCOL=$O(^TMP("IBXDISP",$J,IBPG,IBLN,0)) Q:'IBCOL&'$O(^TMP("IBXDISP",$J,IBPG,IBLN))  S IBLC=IBLC+1 I IBCOL D  Q:IBQ
"RTN","IBCSCH",98,0)
 .. S IBCOL=0,IBC1=1 F  S IBCOL=$O(^TMP("IBXDISP",$J,IBPG,IBLN,IBCOL)) Q:'IBCOL  I $TR($G(^(IBCOL))," ")'="" D
"RTN","IBCSCH",99,0)
 ... W:IBC1 ! S IBC1=0 W ?(IBCOL-1),$G(^TMP("IBXDISP",$J,IBPG,IBLN,IBCOL))
"RTN","IBCSCH",100,0)
 . S IBNXPG=$O(^TMP("IBXDISP",$J,IBPG))   ; next page
"RTN","IBCSCH",101,0)
 . I 'IBQ,IBNXPG,$D(^TMP("IBXDISP",$J,IBNXPG,IBLIN+9)) S IBLIN=$$BOX24D^IBCEF11(),IBQ=$$PAUSE^IBCSCH1(IBLC) Q:IBQ  S IBLC=9 W @IOF D PG
"RTN","IBCSCH",102,0)
 . Q
"RTN","IBCSCH",103,0)
 ;
"RTN","IBCSCH",104,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",105,0)
 I 'IBPG,'IBQ S IBQ=$$PAUSE^IBCSCH1(IBLC)
"RTN","IBCSCH",106,0)
 K ^TMP("IBXDISP",$J),^TMP("IBXSAVE",$J)
"RTN","IBCSCH",107,0)
 Q
"RTN","IBCSCH",108,0)
 ;
"RTN","IBCSCH",109,0)
PG ; Display box 24 letters at top of charge list
"RTN","IBCSCH",110,0)
 W !,"24. A             B  C    D                 E         F     G H I    J"
"RTN","IBCSCH",111,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",112,0)
 Q
"RTN","IBCSCH",113,0)
 ;
"RTN","IBCSCH",114,0)
INSDSPL(IBIFN) ; Display patient's policies
"RTN","IBCSCH",115,0)
 N DIR,X,Y,IBX,DFN,IBDTIN,IBCOVEXT W @IOF
"RTN","IBCSCH",116,0)
 S IBX=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IBX,U,2),IBDTIN=$P(IBX,U,3),IBCOVEXT=1
"RTN","IBCSCH",117,0)
 I +DFN D DISPDT^IBCNS W ! S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR
"RTN","IBCSCH",118,0)
 Q
"RTN","IBCSCH",119,0)
 ;
"RTN","IBCSCH",120,0)
INSDSPLX(IBIFN) ; Display patient's policies extended (?INX)
"RTN","IBCSCH",121,0)
 N IBX,DFN,IBDATE S IBX=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IBX,U,2),IBDATE=$P(IBX,U,3) D DISP^IBCNS3(DFN,IBDATE,123)
"RTN","IBCSCH",122,0)
 Q
"RTN","IBCSCH",123,0)
 ;
"RTN","IBCSCH",124,0)
DISPSC(IBIFN) ; display patients SC Status and Rated Disabilities
"RTN","IBCSCH",125,0)
 N IB0,DFN,IBSC,IBX,VAEL,VAERR
"RTN","IBCSCH",126,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IB0,U,2),IBSC=$P(IB0,U,18)
"RTN","IBCSCH",127,0)
 W !,@IOF,!,"SC Status and Rated Disabilities for ",$P($G(^DPT(+$G(DFN),0)),U,1)
"RTN","IBCSCH",128,0)
 W !,"--------------------------------------------------------------------------------",!
"RTN","IBCSCH",129,0)
 I +$G(IBIFN) W !," SC At Time Of Care: ",$S(IBSC=1:"Yes",IBSC=0:"No",1:"")
"RTN","IBCSCH",130,0)
 I +$G(DFN) D ELIG^VADPT D DIS^DGRPDB
"RTN","IBCSCH",131,0)
 W !!,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",132,0)
 S IBX=$$PAUSE^IBCSCH1(19)
"RTN","IBCSCH",133,0)
 Q
"RTN","IBCSCH",134,0)
 ;
"RTN","IBCSCH",135,0)
DISPROPT(IBIFN) ; prompt for VA or Non-VA provider.
"RTN","IBCSCH",136,0)
 N X,Y,DIR
"RTN","IBCSCH",137,0)
 S DIR(0)="SAO^V:VA PROVIDER;N:NON-VA PROVIDER",DIR("A")="(V)A or (N)on-VA Provider: ",DIR("B")="V"
"RTN","IBCSCH",138,0)
 D ^DIR
"RTN","IBCSCH",139,0)
 I Y="V" D DISPPRV^IBCSCH2(IBIFN) Q
"RTN","IBCSCH",140,0)
 I Y="N" D DISPNVA^IBCSCH2(IBIFN)
"RTN","IBCSCH",141,0)
 Q
"RTN","IBCSCH",142,0)
 ;
"RTN","IBCSCP")
0^38^B10801833^B10607644
"RTN","IBCSCP",1,0)
IBCSCP ;ALB/MRL - BILLING SCREEN PROCESSOR ;01 JUN 88 12:00
"RTN","IBCSCP",2,0)
 ;;2.0;INTEGRATED BILLING;**52,51,161,266,432**;21-MAR-94;Build 192
"RTN","IBCSCP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSCP",4,0)
 ;
"RTN","IBCSCP",5,0)
 ;MAP TO DGCRSCP
"RTN","IBCSCP",6,0)
 ;
"RTN","IBCSCP",7,0)
 D Q1 W !
"RTN","IBCSCP",8,0)
 S IBCSCPP=$S($L(IBV1)>1:"1-"_$L(IBV1),1:1)
"RTN","IBCSCP",9,0)
 F I=$Y:1:20 W !
"RTN","IBCSCP",10,0)
 S IBPOPOUT=0
"RTN","IBCSCP",11,0)
 S (ICDVDT,ICPTVDT)=$$BDATE^IBACSV(IBIFN) ;ICD/CPT version date
"RTN","IBCSCP",12,0)
 W "<RET> to ",$S(+IBSR<10:"CONTINUE",1:"QUIT") W:$S(+IBSR=9&(IBV1'["0"):0,1:'IBV) ", ",IBCSCPP," to EDIT," W " '^N' for screen N, or '^' to QUIT: " R IBSCNN:DTIME S IBCITOUT='$T G Q:'$T I IBSCNN="" S X1=2 G NOMO
"RTN","IBCSCP",13,0)
 G AN:IBSCNN?1"^"1N.N
"RTN","IBCSCP",14,0)
 I IBSCNN?1"^".E S IBPOPOUT=1 G Q
"RTN","IBCSCP",15,0)
 I IBSCNN'?1N.E D ^IBCSCH S X=IBSR,X1=2 G NOMO2
"RTN","IBCSCP",16,0)
 I IBSCNN?1N1"-"1N S IBDR20=IBSCNN,IBSCNN="" F I=+IBDR20:1:$P(IBDR20,"-",2) S IBSCNN=IBSCNN_I_","
"RTN","IBCSCP",17,0)
 S IBDR20="" F J=1:1 S I=$P(IBSCNN,",",J) Q:I=""!($L(I)>3)  I I<10 S:I'["-"&(IBDR20'[I_",") IBDR20=IBDR20_I_"," I I["-" S I1=$P(I,"-",1),I2=$P(I,"-",2) F I3=I1:1:I2 S IBDR20=IBDR20_I3_"," I I3>10 Q
"RTN","IBCSCP",18,0)
 S DGDR1="" F J=1:1 S I=$P(IBDR20,",",J) Q:I=""  I '$E(IBV1,I) S DGDR1=DGDR1_(I+(IBSR*10))_","
"RTN","IBCSCP",19,0)
 I DGDR1']"" D ^IBCSCH S X=IBSR,X1=2 G NOMO2
"RTN","IBCSCP",20,0)
 S IBDR20=DGDR1 D ^IBCSCE S X=IBSR,X1=2 G NOMO2
"RTN","IBCSCP",21,0)
Q K IBSR,IBVV,VADM,IBVI,IBVO,ICDVDT,ICPTVDT
"RTN","IBCSCP",22,0)
 ;
"RTN","IBCSCP",23,0)
 ; If Ingenix ClaimsManager found some errors and the user is trying
"RTN","IBCSCP",24,0)
 ; to exit from these screens, then capture the user's comments.
"RTN","IBCSCP",25,0)
 ; Exit by time-out or by "^" pop out.
"RTN","IBCSCP",26,0)
 ; Here, it's important to preserve the value of $T since it is
"RTN","IBCSCP",27,0)
 ; being looked at by IBCB.
"RTN","IBCSCP",28,0)
 ;
"RTN","IBCSCP",29,0)
 S IBCIT("SAVE THE VALUE OF $T")=$T       ; save $T
"RTN","IBCSCP",30,0)
 I $$CM^IBCIUT1(IBIFN),$P($G(^IBA(351.9,IBIFN,0)),U,2)=4,($G(IBPOPOUT)!$G(IBCITOUT)) D COMMENT^IBCIUT7(IBIFN,1)
"RTN","IBCSCP",31,0)
 I IBCIT("SAVE THE VALUE OF $T")          ; restore $T
"RTN","IBCSCP",32,0)
 ;
"RTN","IBCSCP",33,0)
Q1 K %DT,C,DGA,DGA1,DGA2,DGAD,DGCC,IBSCNN,IBCSCPP,IBDR20,DGDR1,DGST,DGAAC,DGRCD,IBCPTX,IBCITOUT,IBCIT
"RTN","IBCSCP",34,0)
 K IBA,IBCPT,IBREVC,IBYN,IBZZ,IBABRT,IB,IBDD,IBIDS,IBIR,IBIRN,IBISEX,IBIUTL,IBU,IBUN,IBW,IBWW,DGPT,IBICD,IBHC,IBCC,IBDI,IBDIN,IBDPT,IBUCH
"RTN","IBCSCP",35,0)
 K DIC,DIWF,DIWL,I,I1,I2,I3,J,X,X1,X2,X3,Y,Z,Z1,Z2
"RTN","IBCSCP",36,0)
 Q
"RTN","IBCSCP",37,0)
NOMO S I=IBSR,J=1 I +IBSR=10 S X=IBSR G NOMO2
"RTN","IBCSCP",38,0)
NOMO1 S I=I+1,J=+$E(IBVV,I),X=I S:J&(+X=10) IBSR=X G NOMO2:+X=10 I J G NOMO1
"RTN","IBCSCP",39,0)
NOMO2 I +IBSR=10&(IBSCNN="") S X1=3,IBSR1=""
"RTN","IBCSCP",40,0)
 S:(+IBSR=10)&(IBSCNN="") IBSR1="" S X=$P($T(@(IBSR1_X)),";;",X1) G @X
"RTN","IBCSCP",41,0)
 Q
"RTN","IBCSCP",42,0)
 ;
"RTN","IBCSCP",43,0)
AN S X=+$E(IBSCNN,2,99),X1=$P($T(@X),";;",2) I X1]"",'$E(IBVV,X) S IBSR1="",X1=2 G NOMO2
"RTN","IBCSCP",44,0)
 S Z="INVALID SCREEN NUMBER...VALID SCREENS ARE " F I=1:1:10 I '$E(IBVV,I) S Z=Z_I_$S(I<10:",",1:".")
"RTN","IBCSCP",45,0)
 W !,*7 D W H 1 S X=IBSR,X1=2 G NOMO2
"RTN","IBCSCP",46,0)
W ;I IOST="C-QUME",$L(IBVI)'=2 W Z
"RTN","IBCSCP",47,0)
 W IBVI,Z,IBVO
"RTN","IBCSCP",48,0)
 Q
"RTN","IBCSCP",49,0)
1 ;;^IBCSC1;;^IBCSC2
"RTN","IBCSCP",50,0)
2 ;;^IBCSC2;;^IBCSC3
"RTN","IBCSCP",51,0)
3 ;;^IBCSC3;;^IBCSC4
"RTN","IBCSCP",52,0)
4 ;;^IBCSC4;;^IBCSC5
"RTN","IBCSCP",53,0)
5 ;;^IBCSC5;;^IBCSC6
"RTN","IBCSCP",54,0)
6 ;;^IBCSC6;;^IBCSC7
"RTN","IBCSCP",55,0)
7 ;;^IBCSC7;;^IBCSC8
"RTN","IBCSCP",56,0)
8 ;;^IBCSC8;;^IBCSC9
"RTN","IBCSCP",57,0)
9 ;;^IBCSC9;;^IBCSC10
"RTN","IBCSCP",58,0)
10 ;;^IBCSC10;;Q^IBCSCP
"RTN","IBCSCP",59,0)
210 ;;^IBCSC102;;Q^IBCSCP
"RTN","IBCSCP",60,0)
H10 ;;^IBCSC10H;;Q^IBCSCP
"RTN","IBCSCP",61,0)
PAR ;;^IBCPAR;;^IBCPAR
"RTN","IBCSCP",62,0)
 ;IBCSCP
"RTN","IBCSCU")
0^25^B12080989^B11830990
"RTN","IBCSCU",1,0)
IBCSCU ;ALB/MJB - MCCR SCREEN UTILITY ROUTINE ;27 MAY 88 11:09
"RTN","IBCSCU",2,0)
 ;;2.0;INTEGRATED BILLING;**52,51,348,432**;21-MAR-94;Build 192
"RTN","IBCSCU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCSCU",4,0)
 ;
"RTN","IBCSCU",5,0)
 ;MAP TO DGCRSCU
"RTN","IBCSCU",6,0)
 ;
"RTN","IBCSCU",7,0)
 S IBW=1,IBU="UNSPECIFIED",IBUN=IBU_" [NOT REQUIRED]",IBV=$S($D(IBV):IBV,1:1) D HOME^%ZIS
"RTN","IBCSCU",8,0)
 ;S IBWW1="X ""F Z2=1:1:(Z1-$L(Z)) S Z=Z_"""" """""" W Z Q"
"RTN","IBCSCU",9,0)
 S (IBVO,IBVI)="" I $S('$D(IOST(0)):1,'$D(^DG(43,1,0)):1,'$P(^DG(43,1,0),"^",36):1,$D(^DG(43,1,"TERM",IOST(0))):1,1:0) G M
"RTN","IBCSCU",10,0)
 ;
"RTN","IBCSCU",11,0)
 I $D(IOST(0)) S X="IOINHI;IOINLOW;IOINORM" D ENDR^%ZISS
"RTN","IBCSCU",12,0)
 I $L(IOINHI),$L(IOINLOW) S IBVI=IOINHI,IBVO=$S(IOINORM]"":IOINORM,1:IBINLOW)
"RTN","IBCSCU",13,0)
 D KILL^%ZISS
"RTN","IBCSCU",14,0)
 ;I $D(^%ZIS(2,IOST(0),7)) S I=^(7) I $L($P(I,"^",1)),$L($P(I,"^",2)) S IBVI=$P(I,"^",1),IBVO=$S($P(I,"^",3)]"":$P(I,"^",3),1:$P(I,"^",2))
"RTN","IBCSCU",15,0)
 ;
"RTN","IBCSCU",16,0)
M ;I $L(IBVI_IBVO)>4 S X=80 X ^%ZOSF("RM")
"RTN","IBCSCU",17,0)
 S IBWW="W:IBW ! S Z=$S(IBV:""<""_Z_"">"",$E(IBV1,Z):""<""_Z_"">"",1:""[""_Z_""]"") W:$E(Z)=""["" IBVI,Z,IBVO W:$E(Z)'=""["" Z Q"
"RTN","IBCSCU",18,0)
 ;S IBWW="W:IBW ! S Z=$S(IOST=""C-QUME""&($L(IBVI)'=2):Z,IBV:""<""_Z_"">"",$E(IBV1,Z):""<""_Z_"">"",1:""[""_Z_""]"") W:$E(Z)=""["" @IBVI,Z,@IBVO W:$E(Z)'=""["" Z Q"
"RTN","IBCSCU",19,0)
 I $D(IBPAR) S IBV=0,IBVV="00000" Q
"RTN","IBCSCU",20,0)
 S IBBNO=$P(^DGCR(399,IBIFN,0),"^",1)
"RTN","IBCSCU",21,0)
 S IBVV=$S('$$INPAT^IBCEF(IBIFN):"0001010010",1:"0000101010"),X="63266556"
"RTN","IBCSCU",22,0)
 I $P($G(^IBE(353,+$P($G(^DGCR(399,IBIFN,0)),U,19),2)),U,9)'="",$S($D(^DGCR(399,IBIFN,"I1")):1,1:$P($G(^DGCR(399,IBIFN,"M")),U,11)) S $E(IBVV,9)="0"
"RTN","IBCSCU",23,0)
 Q
"RTN","IBCSCU",24,0)
 ;
"RTN","IBCSCU",25,0)
H ;Screen Header
"RTN","IBCSCU",26,0)
 S L="",$P(L,"=",81)=""
"RTN","IBCSCU",27,0)
 I $D(IBH("HELP")) S X="HELP SCREEN" W @IOF,!?(40-($L(X)\2)),IBVI,X,IBVO,!,L G HQ
"RTN","IBCSCU",28,0)
 S X=$P("DEMOGRAPHIC^EMPLOYMENT^PAYER^EVENT - INPATIENT^EVENT - OUTPATIENT^BILLING - GENERAL^BILLING - GENERAL^BILLING - CLAIM^LOCALLY DEFINED^BILLING - SPECIFIC","^",IBSR)_" INFORMATION",X1="SCREEN <"_+IBSR_">"
"RTN","IBCSCU",29,0)
 N IB0,IBT S IB0=$G(^DGCR(399,IBIFN,0)),IBT=$P(IB0,U,19),DGINPT=$S($$INPAT^IBCEF(IBIFN):"Inpat",1:"Outpat")
"RTN","IBCSCU",30,0)
 ;
"RTN","IBCSCU",31,0)
 W @IOF                                          ; clear screen
"RTN","IBCSCU",32,0)
 W !,VADM(1)                                     ; name
"RTN","IBCSCU",33,0)
 W "   ",$P(VADM(2),"^",2)                       ; ssn
"RTN","IBCSCU",34,0)
 W "   BILL#: ",IBBNO_" - "_DGINPT,"/"           ; claim# - type
"RTN","IBCSCU",35,0)
 I IBT=2 W "1500"                                ; form type 2
"RTN","IBCSCU",36,0)
 I IBT=3 W $TR($P($G(^IBE(353,3,0)),U,1),"-")    ; form type 3
"RTN","IBCSCU",37,0)
 W ?(80-$L(X1)),X1                               ; screen#
"RTN","IBCSCU",38,0)
 W !,L                                           ; separator line
"RTN","IBCSCU",39,0)
 W !?(40-($L(X)\2)),IBVI,X,IBVO                  ; screen description
"RTN","IBCSCU",40,0)
HQ ;
"RTN","IBCSCU",41,0)
 K L,DGINPT
"RTN","IBCSCU",42,0)
 Q
"RTN","IBCSCU",43,0)
 ;
"RTN","IBCSCU",44,0)
A ;Format Address(es)
"RTN","IBCSCU",45,0)
 N Y F I=IBA1:1:IBA1+2 I $P(IB(IBAD),U,I)]"" S IBA(IBA2)=$P(IB(IBAD),U,I),IBA2=IBA2+2
"RTN","IBCSCU",46,0)
 I IBA2=1 S IBA(1)="STREET ADDRESS UNKNOWN",IBA2=IBA2+2
"RTN","IBCSCU",47,0)
 S J=$S($D(^DIC(5,+$P(IB(IBAD),U,IBA1+4),0)):$P(^(0),U,2),1:""),J(1)=$P(IB(IBAD),U,IBA1+3),J(2)=$P(IB(IBAD),U,IBA1+11),IBA(IBA2)=$S(J(1)]""&(J]""):J(1)_", "_J,J(1)]"":J(1),J]"":J,1:"CITY/STATE UNKNOWN")
"RTN","IBCSCU",48,0)
 S Y=$S(IBAD=.11!(IBAD=.121):$P(IB(IBAD),U,IBA1+11),IBAD=.25:$P($G(^DPT(+$G(DFN),.22)),U,6),IBAD=.311:$P($G(^DPT(+$G(DFN),.22)),U,5),1:"") D ZIPOUT^VAFADDR
"RTN","IBCSCU",49,0)
 S IBA(IBA2)=IBA(IBA2)_" "_Y F I=0:0 S I=$O(IBA(I)) Q:I=""  S IBA(I)=$E(IBA(I),1,25)
"RTN","IBCSCU",50,0)
 K IBA1,I,J Q
"RTN","IBCU")
0^14^B52974983^B57580772
"RTN","IBCU",1,0)
IBCU ;ALB/MRL - BILLING UTILITY ROUTINE ;01 JUN 88 12:00
"RTN","IBCU",2,0)
 ;;2.0;INTEGRATED BILLING;**52,106,51,191,232,323,320,384,432**;21-MAR-94;Build 192
"RTN","IBCU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCU",4,0)
 ;
"RTN","IBCU",5,0)
 ;MAP TO DGCRU
"RTN","IBCU",6,0)
 ;
"RTN","IBCU",7,0)
ARSTAT ;find status of bill in file 430.3 (ar) return status number
"RTN","IBCU",8,0)
 S IBARST=$$STA^PRCAFN(IBIFN)
"RTN","IBCU",9,0)
 Q
"RTN","IBCU",10,0)
 ;
"RTN","IBCU",11,0)
ARCAT ;Trigger logic to set who's responsible in 399.3 from AR Category
"RTN","IBCU",12,0)
 S X=$P($$CATN^PRCAFN($P(^DGCR(399.3,DA,0),"^",6)),"^",3)
"RTN","IBCU",13,0)
 S:X'="" X=$S("PC"[X:"p",X="N":"o",X="T":"i",1:"")
"RTN","IBCU",14,0)
 Q
"RTN","IBCU",15,0)
 ;
"RTN","IBCU",16,0)
PTF ;Screen for appropriate PTF records
"RTN","IBCU",17,0)
 K IBDD1 S DFN=+$P(^DGCR(399,+DA,0),"^",2) Q:'$D(^DPT(+DFN,0))  S IB05=$P(^(0),"^",1),IB03=$P(^DGCR(399,+DA,0),"^",3)
"RTN","IBCU",18,0)
 S IB01="",IB02=0 F IB02=0:0 S IB01=$O(^DD(45,0,"ID",IB01)) Q:'IB01  S IB02=IB02+1,IBDD(IB02)=^(IB01)
"RTN","IBCU",19,0)
 F IB01=0:0 S IB01=$O(^DGPT("B",+DFN,IB01)) Q:'IB01  I $D(^DGPT(+IB01,0)) S IB04=$P(^(0),"^",2),Y=+IB01 I $P(IB03,".",1)=$P(IB04,".",1) S IBDD1(+Y)="" I $S('$D(X):0,X["?":1,1:0) D PTFW
"RTN","IBCU",20,0)
 G PTFQ:X'["?" I '$O(IBDD1(0)) W !,"Patient has no ACTIVE PTF RECORDS for this event date.",!,"A 'PTF NUMBER' is required for inpatient billing records."
"RTN","IBCU",21,0)
 E  W !!,"Select the appropriate billing record from the above listing by number."
"RTN","IBCU",22,0)
PTFQ W ! K IB01,IB02,IB03,IB04,IB05,IBDD Q
"RTN","IBCU",23,0)
PTFW W !,Y,?15,IB05 F IB02=0:0 S IB02=$O(IBDD(IB02)) Q:'IB02  X IBDD(IB02)
"RTN","IBCU",24,0)
 Q
"RTN","IBCU",25,0)
 ;
"RTN","IBCU",26,0)
AGE ;Input Transform for Condition Code 17
"RTN","IBCU",27,0)
 I X=18 G SEX
"RTN","IBCU",28,0)
 I X=17 S IBC=X,DFN=$P(^DGCR(399,D0,0),"^",2) D DEM^VADPT I VADM(4)<100 W !!,"This patient is only ",VADM(4)," years old!!",!! K IBC Q
"RTN","IBCU",29,0)
 I $D(IBC) S X=IBC
"RTN","IBCU",30,0)
 Q
"RTN","IBCU",31,0)
 ;
"RTN","IBCU",32,0)
SEX ;Input Transform for Condition Code 18
"RTN","IBCU",33,0)
 I X=18 S IBC=X,DFN=$P(^DGCR(399,D0,0),"^",2) D DEM^VADPT I $E(VADM(5))="M" W !!,"This patient is a MALE!! Condition code 18 applies only to FEMALES!!",!! K IBC,X
"RTN","IBCU",34,0)
 I $D(IBC) S X=IBC
"RTN","IBCU",35,0)
 Q
"RTN","IBCU",36,0)
 ;
"RTN","IBCU",37,0)
REV ;Input Transform for Revenue Code
"RTN","IBCU",38,0)
 I X=-1 W !!,"Choose only ACTIVE Revenue Codes!!",!! S D="AC" ;S X="" S X=$O(^DGCR(399.2,"AC",X)) Q:X=""  W !,$P(^DGCR(399.2,X,0),"^",1),?30,$P(^(0),"^",2) K X Q
"RTN","IBCU",39,0)
 I '$D(IBC) I $D(^DGCR(399.2,X,0)) I '$P(^DGCR(399.2,X,0),"^",3) W !!,"Only ACTIVE Revenue Codes may be selected!!",!! K X Q
"RTN","IBCU",40,0)
 Q
"RTN","IBCU",41,0)
 ;
"RTN","IBCU",42,0)
YN S X=$E(X),X=$S(X=1:X,X=0:X,X="Y":1,X="y":1,X="n":0,X="N":0,1:2) I X'=2 D EN^DDIOL("  ("_$S(X:"YES",1:"NO")_")","","?0") Q
"RTN","IBCU",43,0)
 D EN^DDIOL("NOT A VALID CHOICE!","","!?4") K X Q
"RTN","IBCU",44,0)
 Q
"RTN","IBCU",45,0)
 ;
"RTN","IBCU",46,0)
NOPTF ; Input transform for file 399, field 159.5 (NON-VA ADMIT TIME)
"RTN","IBCU",47,0)
 N %DT
"RTN","IBCU",48,0)
 I X>24 K:X'=99 X Q
"RTN","IBCU",49,0)
 I $P($G(^DGCR(399,DA,0)),U,8) K X Q  ; PTF pointer exists 
"RTN","IBCU",50,0)
 S X=$TR(X,"M ") S:X=0 X="12A" S:X<12 X=$TR(X,"A")
"RTN","IBCU",51,0)
 S:X?1N.N&($L(X)<3) Y="."_$E("0",$L(X))_X S:X'?1.2N %DT="TPR",X=DT_"@"_X D:$L(X)>2 ^%DT S X=$E($P(Y,".",2)_"00",1,2)#24 K:Y=-1 X
"RTN","IBCU",52,0)
 Q
"RTN","IBCU",53,0)
 ;
"RTN","IBCU",54,0)
DIS ;Determine Billing Discharge status from PTF
"RTN","IBCU",55,0)
 ;Called from triggers on fields .08 and 161
"RTN","IBCU",56,0)
 N A
"RTN","IBCU",57,0)
 I '$D(^DGCR(399,DA,0)) S X="" G DISQ
"RTN","IBCU",58,0)
 S X=$P(^DGCR(399,DA,0),"^",6) I X=2!(X=3) S X=$O(^DGCR(399.1,"B","STILL PATIENT",0)) G DISQ
"RTN","IBCU",59,0)
 S X=$P(^DGCR(399,DA,0),"^",8) I $S(X="":1,'$D(^DGPT(X)):1,1:0) S X="" G DISQ
"RTN","IBCU",60,0)
 I '+$G(^DGPT(X,70)) S X=$O(^DGCR(399.1,"B","STILL PATIENT",0)) G DISQ
"RTN","IBCU",61,0)
 S A=$P($G(^DGCR(399,DA,"U")),"^",2) I A,(A+.24)<+$G(^DGPT(X,70)) S X=$O(^DGCR(399.1,"B","STILL PATIENT",0)) G DISQ
"RTN","IBCU",62,0)
 S X=+$P($G(^DGPT(X,70)),"^",3)
"RTN","IBCU",63,0)
 I X=1 S X=$O(^DGCR(399.1,"B",$E("DISCHARGED TO HOME OR SELF CARE",1,30),0)) G DISQ
"RTN","IBCU",64,0)
 I X=4 S X=$O(^DGCR(399.1,"B",$E("LEFT AGAINST MEDICAL ADVICE",1,30),0)) G DISQ
"RTN","IBCU",65,0)
 I X=6!(X=7) S X=$O(^DGCR(399.1,"B","EXPIRED",0)) G DISQ
"RTN","IBCU",66,0)
 I X=5!(X=2) S X=$O(^DGCR(399.1,"B",$E("DISCHARGED TO ANOTHER SHORT-TERM GENERAL HOSPITAL",1,30),0)) G DISQ
"RTN","IBCU",67,0)
 S X=""
"RTN","IBCU",68,0)
DISQ Q
"RTN","IBCU",69,0)
 ;
"RTN","IBCU",70,0)
INST ;Ask Institutution address info
"RTN","IBCU",71,0)
 S DIC("DR")="1.01;1.02;1.03;.02;1.04" I $D(^XUSEC("IB SUPERVISOR",DUZ)) S DLAYGO=4
"RTN","IBCU",72,0)
 Q
"RTN","IBCU",73,0)
 ;
"RTN","IBCU",74,0)
PTADD(DFN,MAXL) ; outputs patient address for the trigger on Patient Short Address (399,110)
"RTN","IBCU",75,0)
 N IBX,IBY,IBI,IBDPT S (IBX,IBDPT)="" I $G(MAXL)="PSA" S MAXL=47
"RTN","IBCU",76,0)
 I +$G(DFN) S IBDPT=$G(^DPT(DFN,.11)) F IBI=1:1:4 S IBY=$P(IBDPT,U,IBI) I IBY'="" S IBX=IBX_IBY_","
"RTN","IBCU",77,0)
 I +$P(IBDPT,U,5) S IBY=$P($G(^DIC(5,+$P(IBDPT,U,5),0)),U,2),IBX=IBX_IBY
"RTN","IBCU",78,0)
 I $P(IBDPT,U,12)'="" S IBX=IBX_" "_$P(IBDPT,U,12)
"RTN","IBCU",79,0)
 I +$G(MAXL),$L(IBX)>+MAXL S IBX=""
"RTN","IBCU",80,0)
 Q IBX
"RTN","IBCU",81,0)
 ;
"RTN","IBCU",82,0)
SM ;Flag for printing medicare statment on UB-82
"RTN","IBCU",83,0)
 ;DGSM=0 means figure out which statement, DGSM=1 means no statements
"RTN","IBCU",84,0)
 S DGSM=0 Q
"RTN","IBCU",85,0)
 ;IBCU
"RTN","IBCU",86,0)
 ;
"RTN","IBCU",87,0)
CHGTYP(IBIFN,ARR) ; sets up array of all charge types defined on a bill:  ARR(TYPE, COMPONENT)=""
"RTN","IBCU",88,0)
 N IBI,IBX,IBT K ARR
"RTN","IBCU",89,0)
 I +$O(^DGCR(399,+$G(IBIFN),"RC",0)) S IBI=0 F  S IBI=$O(^DGCR(399,+IBIFN,"RC",IBI))  Q:'IBI  D
"RTN","IBCU",90,0)
 . S IBX=$G(^DGCR(399,+IBIFN,"RC",IBI,0)),IBT=$P(IBX,U,10) I +IBT S ARR(IBT,+$P(IBX,U,12))=""
"RTN","IBCU",91,0)
 Q
"RTN","IBCU",92,0)
 ;
"RTN","IBCU",93,0)
CHGTYPE(IBIFN) ; returns list of charge types on a bill: TYPE ^ TYPE ^ ... ; EXTERNAL TYPE , EXTERNAL TYPE , ...
"RTN","IBCU",94,0)
 N IBAR,IBY,IBS,IBI,IBC,IBJ,IBX
"RTN","IBCU",95,0)
 D CHGTYP($G(IBIFN),.IBAR)
"RTN","IBCU",96,0)
 S (IBX,IBY,IBS)="",IBI=0 F  S IBI=$O(IBAR(IBI)) Q:'IBI  D
"RTN","IBCU",97,0)
 . S IBX=IBX_IBI_U
"RTN","IBCU",98,0)
 . S IBC="INPT" I IBI=1 S IBJ=$O(IBAR(IBI,0)),IBC=$S(IBJ=1:"INST",IBJ=2:"PF",1:"INPT") I +$O(IBAR(IBI,IBJ)) S IBC="INPT"
"RTN","IBCU",99,0)
 . S IBY=IBY_IBS_$S(IBI=1:IBC,IBI=2:"VST",IBI=3:"RX",IBI=4:"CPT",IBI=5:"PI",IBI=6:"DRG",IBI=9:"UN",1:""),IBS=","
"RTN","IBCU",100,0)
 S IBY=IBX_";"_IBY
"RTN","IBCU",101,0)
 Q IBY
"RTN","IBCU",102,0)
 ;
"RTN","IBCU",103,0)
BCHGTYPE(IBIFN) ; returns type of bill and charges: (CLASS (.05): TYPE, TYPE, ...)
"RTN","IBCU",104,0)
 N IBCLASS,IBTYPE,IBY S IBY=""
"RTN","IBCU",105,0)
 S IBCLASS=$P($G(^DGCR(399,+$G(IBIFN),0)),U,5)
"RTN","IBCU",106,0)
 S IBTYPE=$P($$CHGTYPE(+$G(IBIFN)),";",2) I IBTYPE="INPT" S IBTYPE=""
"RTN","IBCU",107,0)
 I +IBCLASS S IBY=$S(IBCLASS<3:"Inpt",1:"Opt") I IBTYPE'="" S IBY=IBY_" ("_IBTYPE_")"
"RTN","IBCU",108,0)
 Q IBY
"RTN","IBCU",109,0)
 ;
"RTN","IBCU",110,0)
CLNSCRN(IBDT,CLIFN) ; screen for a Procedures Associated Clinic  (399, 304, 6), returns true if clinic can be used
"RTN","IBCU",111,0)
 ; clinic must be defined as a 'Clinic' and it must be active on date of procedure
"RTN","IBCU",112,0)
 ;
"RTN","IBCU",113,0)
 N IBCL0,IBCLI,IBX S IBX=0
"RTN","IBCU",114,0)
 S IBCL0=$G(^SC(+$G(CLIFN),0)),IBCLI=$G(^SC(+$G(CLIFN),"I"))
"RTN","IBCU",115,0)
 S IBX=$S($P(IBCL0,U,3)'="C":0,'$G(IBDT):0,'IBCLI:1,+IBCLI>+IBDT:1,'$P(IBCLI,U,2):0,1:$P(IBCLI,U,2)'>IBDT)
"RTN","IBCU",116,0)
 Q IBX
"RTN","IBCU",117,0)
 ;
"RTN","IBCU",118,0)
PRVNUM(IBIFN,IBINS,COB) ; Trigger code (399:122,123,124)
"RTN","IBCU",119,0)
 ; on Primary Secondary/Tertiary Carrier (399:101,102,103)
"RTN","IBCU",120,0)
 ; returns the Provider Number for the Insurance Company
"RTN","IBCU",121,0)
 ;         Hospital Provider Number for prov id in file 355.92
"RTN","IBCU",122,0)
 ;         or Medicare A provider Number (psych/non-psych) if Medicare A
"RTN","IBCU",123,0)
 ;
"RTN","IBCU",124,0)
 ; Input   IBIFN - bill ifn
"RTN","IBCU",125,0)
 ;         IBINS - insurance company ifn (opt)
"RTN","IBCU",126,0)
 ;         COB   - 1 for primary, 2 for secondary, 3 for tertiary
"RTN","IBCU",127,0)
 ;
"RTN","IBCU",128,0)
 N IBX,IBB0,IBBF,IBFT,Z,Z0
"RTN","IBCU",129,0)
 S:'$G(COB) COB=1
"RTN","IBCU",130,0)
 S IBX=$P($G(^DGCR(399,+$G(IBIFN),"M1")),U,COB+1),IBB0=$G(^DGCR(399,+$G(IBIFN),0))
"RTN","IBCU",131,0)
 I $G(IBINS)="" S IBINS=+$G(^DGCR(399,+$G(IBIFN),"I"_COB))
"RTN","IBCU",132,0)
 G:'IBINS PRVNQ
"RTN","IBCU",133,0)
 ;
"RTN","IBCU",134,0)
 ; OEC - 12/21/05 - If an MRA is being processed into an MRA secondary
"RTN","IBCU",135,0)
 ; claim and the billing provider # already exists, then leave it
"RTN","IBCU",136,0)
 I $G(IBPRCOB),IBX'="" G PRVNQ
"RTN","IBCU",137,0)
 ;
"RTN","IBCU",138,0)
 ;patch 432 enh5:  The IB system shall no longer add the following default Billing Provider Secondary ID to all Medicare Part A (Institutional) general/psychiatric claims:  674499 Psychiatric, 670899 General
"RTN","IBCU",139,0)
 ;I +$G(IBIFN),COB N DA S DA=IBIFN I $$MCRACK^IBCBB3(+IBIFN,$P($G(^DGCR(399,+IBIFN,"TX")),U,5),+COB) S IBX=$$MCRANUM^IBCBB3(+IBIFN) G PRVNQ
"RTN","IBCU",140,0)
 ;
"RTN","IBCU",141,0)
 ; WCJ - 1/17/06 - Some Insurances require certain electronic plan types to have no secondary ID
"RTN","IBCU",142,0)
 ; Check if this plan type requires a blank sec id to go out for this insurance
"RTN","IBCU",143,0)
 N NOSEC S NOSEC=0
"RTN","IBCU",144,0)
 I $D(^DIC(36,IBINS,13)),$G(IBIFN) D
"RTN","IBCU",145,0)
 . N PLAN,PLANTYPE
"RTN","IBCU",146,0)
 . S PLAN=$P($G(^DGCR(399,IBIFN,"I"_COB)),U,18) Q:'PLAN
"RTN","IBCU",147,0)
 . S PLANTYPE=$P($G(^IBA(355.3,PLAN,0)),U,15) Q:'PLANTYPE
"RTN","IBCU",148,0)
 . Q:'$D(^DIC(36,IBINS,13,"B",PLANTYPE))
"RTN","IBCU",149,0)
 . S NOSEC=1,IBX=""
"RTN","IBCU",150,0)
 I NOSEC G PRVNQ
"RTN","IBCU",151,0)
 ;
"RTN","IBCU",152,0)
 ; If using attending/rendering secondary ID, don't do anything
"RTN","IBCU",153,0)
 I $$FT^IBCEF(IBIFN)=2,$$GET1^DIQ(36,IBINS,4.06,"I") G PRVNQ
"RTN","IBCU",154,0)
 I $$FT^IBCEF(IBIFN)=3,$$GET1^DIQ(36,IBINS,4.08,"I") G PRVNQ
"RTN","IBCU",155,0)
 ;
"RTN","IBCU",156,0)
 S IBX=$$FACNUM^IBCEP2B(IBIFN,COB)
"RTN","IBCU",157,0)
 ;
"RTN","IBCU",158,0)
 ; PATCH 432 ENH5:  The IB system shall no longer add a default Billing Provider Secondary ID to a claim.
"RTN","IBCU",159,0)
 ;I IBX="" S IBX=$$GET1^DIQ(350.9,1,1.05)
"RTN","IBCU",160,0)
 ;
"RTN","IBCU",161,0)
PRVNQ Q IBX
"RTN","IBCU",162,0)
 ;
"RTN","IBCU",163,0)
BF() ; Returns ien of billing fac primary id type
"RTN","IBCU",164,0)
 N Z,IBX
"RTN","IBCU",165,0)
 S IBX="",Z=0 F  S Z=$O(^IBE(355.97,Z)) Q:'Z  I $P($G(^(Z,1)),U,9) S IBX=Z Q
"RTN","IBCU",166,0)
 Q IBX
"RTN","IBCU",167,0)
 ;
"RTN","IBCU",168,0)
BILLPNS(IBIFN) ; Trigger Code that sets all Bill P/S/T Prov# and QUAL (399: .122,123,124,128,129,130)
"RTN","IBCU",169,0)
 ; on Bill Form Type (399:.19)
"RTN","IBCU",170,0)
 N IBDR
"RTN","IBCU",171,0)
 ;
"RTN","IBCU",172,0)
 I +$G(^DGCR(399,+$G(IBIFN),"I1")) S IBDR(399,IBIFN_",",122)=$$PRVNUM(IBIFN,"",1),IBDR(399,IBIFN_",",128)=$$PRVQUAL(IBIFN,"",1)
"RTN","IBCU",173,0)
 I +$G(^DGCR(399,+$G(IBIFN),"I2")) S IBDR(399,IBIFN_",",123)=$$PRVNUM(IBIFN,"",2),IBDR(399,IBIFN_",",129)=$$PRVQUAL(IBIFN,"",2)
"RTN","IBCU",174,0)
 I +$G(^DGCR(399,+$G(IBIFN),"I3")) S IBDR(399,IBIFN_",",124)=$$PRVNUM(IBIFN,"",3),IBDR(399,IBIFN_",",130)=$$PRVQUAL(IBIFN,"",3)
"RTN","IBCU",175,0)
 ;
"RTN","IBCU",176,0)
 I $O(IBDR(0)) D FILE^DIE("","IBDR")
"RTN","IBCU",177,0)
 Q
"RTN","IBCU",178,0)
 ;
"RTN","IBCU",179,0)
PRVQUAL(IBIFN,IBINS,COB) ; Trigger code for Bill P/S/T Prov QUAL (399:128,129,130)
"RTN","IBCU",180,0)
 ; on P/S/T Carrier (399: 101,102,103)
"RTN","IBCU",181,0)
 ; returns the Provider ID QUALIFIER
"RTN","IBCU",182,0)
 ;
"RTN","IBCU",183,0)
 ; Input   IBIFN - bill ifn
"RTN","IBCU",184,0)
 ;         IBINS - insurance company ifn (opt)
"RTN","IBCU",185,0)
 ;         COB   - 1 for primary, 2 for secondary, 3 for tertiary
"RTN","IBCU",186,0)
 ;
"RTN","IBCU",187,0)
 N IBX,IBB0,IBBF,IBFT,Z,Z0
"RTN","IBCU",188,0)
 S:'$G(COB) COB=1
"RTN","IBCU",189,0)
 S IBX=$P($G(^DGCR(399,+$G(IBIFN),"M1")),U,COB+9),IBB0=$G(^DGCR(399,+$G(IBIFN),0))
"RTN","IBCU",190,0)
 I $G(IBINS)="" S IBINS=+$G(^DGCR(399,+$G(IBIFN),"I"_COB))
"RTN","IBCU",191,0)
 G:'IBINS PRVQUALQ
"RTN","IBCU",192,0)
 ;
"RTN","IBCU",193,0)
 ; If an MRA is being processed into an MRA secondary claim and the
"RTN","IBCU",194,0)
 ; billing provider qualifier already exists, then leave it alone
"RTN","IBCU",195,0)
 I $G(IBPRCOB),IBX'="" G PRVQUALQ
"RTN","IBCU",196,0)
 ;
"RTN","IBCU",197,0)
 ; PATCH 432 ENH5:  The IB system shall no longer add a default Billing Provider Secondary ID to a claim.
"RTN","IBCU",198,0)
 ;I +$G(IBIFN),COB N DA S DA=IBIFN I $$MCRACK^IBCBB3(+IBIFN,$P($G(^DGCR(399,+IBIFN,"TX")),U,5),+COB) S IBX=$$FIND1^DIC(355.97,,"MX","MEDICARE PART A") G PRVQUALQ
"RTN","IBCU",199,0)
 ;
"RTN","IBCU",200,0)
 ; Some Insurances require certain electronic plan types to have no secondary ID
"RTN","IBCU",201,0)
 ; If this is the case, there is no qualifier
"RTN","IBCU",202,0)
 N NOSEC S NOSEC=0
"RTN","IBCU",203,0)
 I $D(^DIC(36,IBINS,13)),$G(IBIFN) D
"RTN","IBCU",204,0)
 . N PLAN,PLANTYPE
"RTN","IBCU",205,0)
 . S PLAN=$P($G(^DGCR(399,IBIFN,"I"_COB)),U,18) Q:'PLAN
"RTN","IBCU",206,0)
 . S PLANTYPE=$P($G(^IBA(355.3,PLAN,0)),U,15) Q:'PLANTYPE
"RTN","IBCU",207,0)
 . Q:'$D(^DIC(36,IBINS,13,"B",PLANTYPE))
"RTN","IBCU",208,0)
 . S NOSEC=1,IBX=""
"RTN","IBCU",209,0)
 I NOSEC G PRVQUALQ
"RTN","IBCU",210,0)
 ;
"RTN","IBCU",211,0)
 ; Leave qualifer blank if sending REND/ATT ID
"RTN","IBCU",212,0)
 I $$FT^IBCEF(IBIFN)=2,$$GET1^DIQ(36,IBINS,4.06,"I") G PRVQUALQ
"RTN","IBCU",213,0)
 I $$FT^IBCEF(IBIFN)=3,$$GET1^DIQ(36,IBINS,4.08,"I") G PRVQUALQ
"RTN","IBCU",214,0)
 ;
"RTN","IBCU",215,0)
 S IBX=$$FACNUM^IBCEP2B(IBIFN,COB,1)
"RTN","IBCU",216,0)
 ;
"RTN","IBCU",217,0)
 I IBX="",$$GET1^DIQ(350.9,1,1.05)=$P($G(^DGCR(399,IBIFN,"M1")),U,COB+1) S IBX=$$FIND1^DIC(355.97,,"MX","1J")
"RTN","IBCU",218,0)
 ;
"RTN","IBCU",219,0)
PRVQUALQ Q IBX
"RTN","IBCU2")
0^93^B8155508^B7719494
"RTN","IBCU2",1,0)
IBCU2 ;ALB/MRL - BILLING UTILITY ROUTINE (CONTINUED) ;01 JUN 88 12:00
"RTN","IBCU2",2,0)
 ;;2.0;INTEGRATED BILLING;**137,287,432**;21-MAR-94;Build 192
"RTN","IBCU2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCU2",4,0)
 ;
"RTN","IBCU2",5,0)
 ;MAP TO DGCRU2
"RTN","IBCU2",6,0)
 ;
"RTN","IBCU2",7,0)
TC D TCL
"RTN","IBCU2",8,0)
 N DA,X,Y
"RTN","IBCU2",9,0)
 F DGJ=0:0 S DGJ=$O(^DD(399,201,1,DGJ)) Q:'DGJ  I $D(^DD(399,201,1,DGJ,DGXRF)) S DA=DGI(1),X=DGTCX1 X ^(DGXRF)
"RTN","IBCU2",10,0)
 K DGI,DGJ,DGXRF,DGTCX,DGTCX1,DGTCX2
"RTN","IBCU2",11,0)
 Q
"RTN","IBCU2",12,0)
 ;
"RTN","IBCU2",13,0)
TCL S (DGTCX,DGTCX2)=0 F DGTCX1=0:0 S DGTCX1=$O(^DGCR(399,DA(1),"RC",DGTCX1)) Q:'DGTCX1  I $D(^DGCR(399,DA(1),"RC",DGTCX1,0)),DGTCX1'=DA S DGTCX=DGTCX+$P(^(0),"^",4)
"RTN","IBCU2",14,0)
 I DGXRF=1 S DGTCX1=DGTCX+X
"RTN","IBCU2",15,0)
 E  S DGTCX1=DGTCX
"RTN","IBCU2",16,0)
 S $P(^DGCR(399,DA(1),"U1"),"^",1)=DGTCX1,DGI=DA,DGI(1)=DA(1),DGTCX=X
"RTN","IBCU2",17,0)
 Q
"RTN","IBCU2",18,0)
 ;
"RTN","IBCU2",19,0)
TC1 F DGJ1=0:0 S DGJ1=$O(^DD(399.042,.04,1,DGJ1)) Q:'DGJ1  I $D(^DD(399.042,.04,1,DGJ1,DGXRF1)) S X=DGTCX11 X ^(DGXRF1)
"RTN","IBCU2",20,0)
 S X=DGTCX11 K DGJ1,DGXRF11,DGTCX11
"RTN","IBCU2",21,0)
 Q
"RTN","IBCU2",22,0)
 ;
"RTN","IBCU2",23,0)
FY ;S DGTCX1=$S($D(^DGCR(399,DA,"U1")):^("U1"),1:0) I +X>+DGTCX1 W !?4,*7,"Exceeds 'Total Charges' for this bill." K X Q
"RTN","IBCU2",24,0)
 ;W !?4,"Edit revenue codes/from-to dates if appropriate." K X Q
"RTN","IBCU2",25,0)
 Q
"RTN","IBCU2",26,0)
 ;
"RTN","IBCU2",27,0)
21 ;set logic for CHARGES subfield x-ref (399.042;.02)
"RTN","IBCU2",28,0)
 I $P(^DGCR(399,DA(1),"RC",DA,0),"^",3)="" S $P(^DGCR(399,DA(1),"RC",DA,0),"^",3)=$S($P(^DGCR(399,DA(1),0),"^",5)<3:$P(^("U"),"^",15),$D(^DGCR(399,DA(1),"OP",0)):$P(^(0),"^",4),1:1)
"RTN","IBCU2",29,0)
 ; DEM;432 - Changed Z*Z1 to $FN(Z*Z1,"",2) for inclusion of decimal point.
"RTN","IBCU2",30,0)
 S Z=X,Z1=$P(^DGCR(399,DA(1),"RC",DA,0),"^",3) S DGTCX11=$FN(Z*Z1,"",2),$P(^(0),"^",4)=DGTCX11,DGXRF1=1 D TC1
"RTN","IBCU2",31,0)
 Q
"RTN","IBCU2",32,0)
 ;
"RTN","IBCU2",33,0)
22 ;kill logic for CHARGES subfield x-ref (399.042;.02)
"RTN","IBCU2",34,0)
 ; DEM;432 - Changed Z*Z1 to $FN(Z*Z1,"",2) for inclusion of decimal point.
"RTN","IBCU2",35,0)
 S Z=X,Z1=$P(^DGCR(399,DA(1),"RC",DA,0),"^",3) S DGTCX11=$FN(Z*Z1,"",2),$P(^(0),"^",4)=DGTCX11,DGXRF1=2 D TC1
"RTN","IBCU2",36,0)
 Q
"RTN","IBCU2",37,0)
 ;
"RTN","IBCU2",38,0)
31 ;set logic for UNITS OF SERVICE subfield x-ref (399.042;.03)
"RTN","IBCU2",39,0)
 ; DEM;432 - Changed Z*Z1 to $FN(Z*Z1,"",2) for inclusion of decimal point.
"RTN","IBCU2",40,0)
 S Z=X,Z1=$P(^DGCR(399,DA(1),"RC",DA,0),"^",2) S DGTCX11=$FN(Z*Z1,"",2),$P(^(0),"^",4)=DGTCX11,DGXRF1=1 D TC1
"RTN","IBCU2",41,0)
 Q
"RTN","IBCU2",42,0)
 ;
"RTN","IBCU2",43,0)
32 ;kill logic for UNITS OF SERVICE subfield x-ref (399.042;.03)
"RTN","IBCU2",44,0)
 ; DEM;432 - Changed Z*Z1 to $FN(Z*Z1,"",2) for inclusion of decimal point.
"RTN","IBCU2",45,0)
 S Z=X,Z1=$P(^DGCR(399,DA(1),"RC",DA,0),"^",2) S DGTCX11=$FN(Z*Z1,"",2),$P(^(0),"^",4)=DGTCX11,DGXRF1=2 D TC1
"RTN","IBCU2",46,0)
 Q
"RTN","IBCU2",47,0)
 ;
"RTN","IBCU2",48,0)
FMDATES(PROMPT) ; ask for date range
"RTN","IBCU2",49,0)
 N %DT,X,Y,DT1,DT2,IB1,IB2  S DT1="",IB1="START WITH DATE ENTERED: ",IB2="GO TO DATE ENTERED: "
"RTN","IBCU2",50,0)
 I $G(PROMPT)'="" S IB1="START WITH "_PROMPT_": ",IB2="GO TO "_PROMPT_": "
"RTN","IBCU2",51,0)
 S %DT="AEX",%DT("A")=IB1 D ^%DT K %DT I Y<0!($P(Y,".",1)'?7N) G FMDQ
"RTN","IBCU2",52,0)
 S (%DT(0),DT2)=$P(Y,".",1) I DT2'>DT S %DT("B")="TODAY"
"RTN","IBCU2",53,0)
 S %DT="AEX",%DT("A")=IB2 D ^%DT K %DT I Y<0!($P(Y,".",1)'?7N) G FMDQ
"RTN","IBCU2",54,0)
 S DT1=DT2_"^"_$P(Y,".",1)
"RTN","IBCU2",55,0)
FMDQ Q DT1
"RTN","IBCU2",56,0)
 ;
"RTN","IBCU7")
0^57^B78100882^B54198894
"RTN","IBCU7",1,0)
IBCU7 ;ALB/AAS - INTERCEPT SCREEN INPUT OF PROCEDURE CODES ;29-OCT-91
"RTN","IBCU7",2,0)
 ;;2.0;INTEGRATED BILLING;**62,52,106,125,51,137,210,245,228,260,348,371,432**;21-MAR-94;Build 192
"RTN","IBCU7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCU7",4,0)
 ;
"RTN","IBCU7",5,0)
 ;MAP TO DGCRU7
"RTN","IBCU7",6,0)
 ;
"RTN","IBCU7",7,0)
CHKX ;  -interception of input x from Additional Procedure input
"RTN","IBCU7",8,0)
 G:X=" " CHKXQ
"RTN","IBCU7",9,0)
 I $$INPAT^IBCEF(DA(1)),'$P($G(^IBE(350.9,1,1)),"^",15),X'?1A1N D  G CHKXQ
"RTN","IBCU7",10,0)
 . K X
"RTN","IBCU7",11,0)
 . D EN^DDIOL("Site param does not allow entry of non-PTF procedures") ;Fileman error here will be: The previous error occurred when performing an action specified in a Pre-lookup transform (7.5 node).
"RTN","IBCU7",12,0)
 G:'$D(^UTILITY($J,"IB")) CHKXQ
"RTN","IBCU7",13,0)
 S M=($A($E(X,1))-64),S=+$E(X,2) Q:'$G(^UTILITY($J,"IB",M,S))  S X="`"_+^(S)
"RTN","IBCU7",14,0)
 I $D(DGPROCDT),DGPROCDT'=$P($G(^UTILITY($J,"IB",M,1)),"^",2) S DGPROCDT=$P(^(1),"^",2) W !!,"Procedure Date: " S Y=DGPROCDT X ^DD("DD") W Y,!
"RTN","IBCU7",15,0)
CHKXQ Q
"RTN","IBCU7",16,0)
 ;
"RTN","IBCU7",17,0)
CODMUL ;Date oriented entry of procedure
"RTN","IBCU7",18,0)
DELASK I $D(IBZ20),IBZ20,IBZ20'=$P(^DGCR(399,IBIFN,0),U,9) S %=2 W !,"SINCE THE PROCEDURE CODING METHOD HAS BEEN CHANGED, DO YOU WANT TO DELETE ALL",!,"PROCEDURE CODES IN THIS BILL"
"RTN","IBCU7",19,0)
 I  D YN^DICN Q:%=-1  D:%=1 DELADD I %Y?1."?" W !!,"If you answer 'Yes', all procedure codes will be DELETED from this bill.",! G DELASK
"RTN","IBCU7",20,0)
 K %,%Y,DA,IBZ20,DIK ;W !,"Procedure Entry:"
"RTN","IBCU7",21,0)
 ;
"RTN","IBCU7",22,0)
CODDT I $D(IBIFN),$D(^DGCR(399,IBIFN,0)),$P(^(0),U,9) S DIC("V")=$S($P(^(0),U,9)=9:"I +Y(0)=80.1",$P(^(0),U,9)=4!($P(^(0),U,9)=5):"I +Y(0)=81",1:"")
"RTN","IBCU7",23,0)
 I $P($G(^DGCR(399,IBIFN,0)),"^",5)<3 S IBZTYPE=1 I $P($G(^UTILITY($J,"IB",1,1)),"^",2) S DGPROCDT=$P(^(1),"^",2) D ASKCOD
"RTN","IBCU7",24,0)
 S X=$$PRCDIV^IBCU71(IBIFN) I +X W !!,$P(X,U,2),!
"RTN","IBCU7",25,0)
 N Z,Z0 S Z=$G(^DGCR(399,IBIFN,"U")),Z0=$$FMTE^XLFDT($P(Z,U),"2D")_"-"_$$FMTE^XLFDT($P(Z,U,2),"2D")
"RTN","IBCU7",26,0)
 W !,"Select PROCEDURE DATE"_$S($TR(Z0,"-")'="":" ("_Z0_")",1:"")_": " R X:DTIME G:'$T!("^"[X) CODQ D:X["?" CODHLP
"RTN","IBCU7",27,0)
 S IBEX=0 D  ; Get procedure date
"RTN","IBCU7",28,0)
 . I X=" ",$D(DGPROCDT),DGPROCDT?7N S Y=DGPROCDT D D^DIQ W "   (",Y,")" Q
"RTN","IBCU7",29,0)
 . I X=" ",+$P($G(^DGCR(399,IBIFN,"OP",0)),"^",4) S (DGPROCDT,Y)=$O(^DGCR(399,IBIFN,"OP",0)) D D^DIQ W "   (",Y,")" Q
"RTN","IBCU7",30,0)
 . S %DT="EXP",%DT(0)=-DT D ^%DT K %DT I Y<1 S IBEX=1 Q
"RTN","IBCU7",31,0)
 . I '$$OPV2^IBCU41(Y,IBIFN,1) S IBEX=1 Q
"RTN","IBCU7",32,0)
 . S:'$G(IBZTYPE) X=$$OPV^IBCU41(Y,IBIFN) S DGPROCDT=Y
"RTN","IBCU7",33,0)
 I 'IBEX D ASKCOD,ADDCPT^IBCU71:$D(DGCPT)
"RTN","IBCU7",34,0)
 K IBEX
"RTN","IBCU7",35,0)
 G CODDT
"RTN","IBCU7",36,0)
 ;
"RTN","IBCU7",37,0)
ASKCOD N Z,Z0,DA,IBACT,IBQUIT,IBLNPRV  ;WCJ;2.0*432
"RTN","IBCU7",38,0)
 K DGCPT
"RTN","IBCU7",39,0)
 S DGCPT=0,DGCPTUP=$P($G(^IBE(350.9,1,1)),"^",19),DGADDVST=0,IBFT=$P($G(^DGCR(399,IBIFN,0)),"^",19)
"RTN","IBCU7",40,0)
 I '$D(^DGCR(399,IBIFN,"CP",0)) S ^DGCR(399,IBIFN,"CP",0)=U_$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCU7",41,0)
 ;
"RTN","IBCU7",42,0)
 F  S IBQUIT=0 D  Q:IBQUIT
"RTN","IBCU7",43,0)
 . S DIC("A")="   Select PROCEDURE: "
"RTN","IBCU7",44,0)
 . S DIC="^DGCR(399,"_IBIFN_",""CP"","
"RTN","IBCU7",45,0)
 . S DIC(0)="AEQMNL"
"RTN","IBCU7",46,0)
 . S DIC("S")="I '$D(DIV(""S""))&($P(^(0),U,2)=DGPROCDT)"
"RTN","IBCU7",47,0)
 . S DIC("DR")="1///^S X=DGPROCDT"
"RTN","IBCU7",48,0)
 . S DA(1)=IBIFN,DLAYGO=399
"RTN","IBCU7",49,0)
 . W ! D ^DIC I Y<1 S IBQUIT=1 Q
"RTN","IBCU7",50,0)
 . S IBPROCP=+Y
"RTN","IBCU7",51,0)
 . ; If we just added inactive code - it must be deleted.
"RTN","IBCU7",52,0)
 . S IBACT=0 ; Active flag
"RTN","IBCU7",53,0)
 . I Y["ICD0" S IBACT=$$ICD0ACT^IBACSV(+$P(Y,U,2),DGPROCDT)
"RTN","IBCU7",54,0)
 . I Y["ICPT" S IBACT=$$CPTACT^IBACSV(+$P(Y,U,2),DGPROCDT)
"RTN","IBCU7",55,0)
 . S DGCPTNEW=$P(Y,"^",3) ;Was the procedure just added?
"RTN","IBCU7",56,0)
 . I DGCPTNEW,'IBACT D DELPROC Q
"RTN","IBCU7",57,0)
 . I 'IBACT W !,*7,"Warning:  Procedure code is inactive on this date",!
"RTN","IBCU7",58,0)
 . I DGCPTNEW,$D(^UTILITY($J,"IB")),$$INPAT^IBCEF(IBIFN),Y["ICPT(" D DATA^IBCU74(Y,.IBLNPRV)
"RTN","IBCU7",59,0)
 . S DGADDVST=$S(DGCPTNEW:1,$D(DGADDVST):DGADDVST,1:0)
"RTN","IBCU7",60,0)
 . N IBPRV,IBPRVO,IBPRVN
"RTN","IBCU7",61,0)
 . ;
"RTN","IBCU7",62,0)
 . ; Line level provider function by form type.
"RTN","IBCU7",63,0)
 . ;     CMS-1500 (FORM TYPE=2)
"RTN","IBCU7",64,0)
 . ;              RENDERING PROVIDER, REFERRING PROVIDER,
"RTN","IBCU7",65,0)
 . ;              and SUPERVISING PROVIDER.
"RTN","IBCU7",66,0)
 . ;     UB-04 (FORM TYPE=3)
"RTN","IBCU7",67,0)
 . ;              RENDERING PROVIDER, REFERRING PROVIDER,
"RTN","IBCU7",68,0)
 . ;              OPERATING PROVIDER, and OTHER OPERATING
"RTN","IBCU7",69,0)
 . ;              PROVIDER.
"RTN","IBCU7",70,0)
 . ;
"RTN","IBCU7",71,0)
 . ; Removed: Call to $$MAINPRV^IBCEU(IBIFN) is for claim
"RTN","IBCU7",72,0)
 . ;          level provider defaults.
"RTN","IBCU7",73,0)
 . ;     1. For new line level providers we don't need
"RTN","IBCU7",74,0)
 . ;        or want default claim level provider
"RTN","IBCU7",75,0)
 . ;        (requirement).
"RTN","IBCU7",76,0)
 . ;     2. We don't want to default claim level to
"RTN","IBCU7",77,0)
 . ;        line level provider (requirement).
"RTN","IBCU7",78,0)
 . ;
"RTN","IBCU7",79,0)
 . K DIC("V")  ; DEM;432 - KILL DIC("V") because this was for previous variable pointer use.
"RTN","IBCU7",80,0)
 . ;
"RTN","IBCU7",81,0)
 . N IBPROCSV  ; DEM;432 - Variable IBPROCSV is variable to preserve value of 'Y', which is procedure code info returned by call to ^DIC.
"RTN","IBCU7",82,0)
 . S IBPROCSV=Y  ; DEM;432 - Preserve value of Y for after calls to FileMan (Y = procedure code info returned by call to ^DIC).
"RTN","IBCU7",83,0)
 . K DR   ;WCJ;IB*2.0*432
"RTN","IBCU7",84,0)
 . I Y["ICPT" S DR=".01;16",DIE=DIC,(IBPROCP,DA)=+Y D ^DIE Q:'$D(DA)!($E($G(Y))=U)  K DR ;
"RTN","IBCU7",85,0)
 . S DR=""
"RTN","IBCU7",86,0)
 . D EN^IBCU7B ; DEM;432 - Call to line level provider user input.
"RTN","IBCU7",87,0)
 . S Y=IBPROCSV  ; DEM;432 - Restore value of Y after calls to FileMan
"RTN","IBCU7",88,0)
 . K IBPROCSV
"RTN","IBCU7",89,0)
 . K DR   ;WCJ;IB*2.0*432
"RTN","IBCU7",90,0)
 . S DR="" I Y["ICPT" S DR="6;5//"_$$DEFDIV(IBIFN)_";"
"RTN","IBCU7",91,0)
 . S DR=DR_$S(IBFT=2:"8;9;17//NO;",1:"")_3,DIE=DIC,(IBPROCP,DA)=+Y D ^DIE Q:'$D(DA)!($E($G(Y))=U)
"RTN","IBCU7",92,0)
 . K DR   ;WCJ;IB*2.0*432
"RTN","IBCU7",93,0)
 . I IBFT=3 D:'$$INPAT^IBCEF(IBIFN) ATTACH  ; DEM;432 - Prompt for Attachment Control Number.
"RTN","IBCU7",94,0)
 . ; DEM;432 - Add Additional OB Minutes to DR string for call to DIE.
"RTN","IBCU7",95,0)
 . S DR=$$SPCUNIT(IBIFN,IBPROCP) S:DR["15;" DR=DR_"74Additional OB Minutes" D ^DIE ; miles/minutes/hours
"RTN","IBCU7",96,0)
 . ;
"RTN","IBCU7",97,0)
 . I IBFT=2 D
"RTN","IBCU7",98,0)
 .. D DX^IBCU72(IBIFN,IBPROCP)
"RTN","IBCU7",99,0)
 .. S X=$$ADDTNL(IBIFN,.DA)
"RTN","IBCU7",100,0)
 . Q:$$INPAT^IBCEF(IBIFN)  ;only outpatient bills
"RTN","IBCU7",101,0)
 . ;add procedures to array for download to PCE: dgcpt(assoc clinic,cpt,'provider^first dx^modifiers',cnt)=""
"RTN","IBCU7",102,0)
 . S DGPROC=$G(^DGCR(399,IBIFN,"CP",+DA,0))
"RTN","IBCU7",103,0)
 . S X=$P(DGPROC,U,18)_U_+$G(^IBA(362.3,+$P(DGPROC,U,11),0))_U_$P(DGPROC,U,15)
"RTN","IBCU7",104,0)
 . I 'DGCPTNEW,$P(DGPROC,"^",7)="" S DGCPTNEW=2
"RTN","IBCU7",105,0)
 . I DGCPTUP,DGCPTNEW S DGCPT=DGCPT+1 I $P(DGPROC,"^",7) S DGCPT($P(DGPROC,"^",7),+DGPROC,X,DGCPT)=""
"RTN","IBCU7",106,0)
 . ; add visit date to bill
"RTN","IBCU7",107,0)
 . I DGADDVST S (X,DINUM)=DGPROCDT D VFILE1^IBCOPV1 K DINUM,X,DGNOADD,DGADDVST
"RTN","IBCU7",108,0)
 ; Delete modifers with only a sequence #, no code
"RTN","IBCU7",109,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  S Z0=0 F  S Z0=$O(^DGCR(399,IBIFN,"CP",Z,"MOD",Z0)) Q:'Z0  I $P($G(^(Z0,0)),U,2)="" S DA(2)=IBIFN,DA(1)=Z,DA=Z0,DIK="^DGCR(399,"_DA(2)_",""CP"","_DA(1)_",""MOD""," D ^DIK
"RTN","IBCU7",110,0)
 Q
"RTN","IBCU7",111,0)
CODQ K %DT,DGPROC,DIC,DIE,DR,DGPROCDT,IBPROCP,DLAYGO
"RTN","IBCU7",112,0)
 K IBFT,DGNOADD,DGADDVST,DGCPT,DGCPTUP,IBZTYPE,DGCPTNEW
"RTN","IBCU7",113,0)
 Q
"RTN","IBCU7",114,0)
 ;
"RTN","IBCU7",115,0)
DELPROC ; Remove the selected procedure, because of inactive status (cancel selection)
"RTN","IBCU7",116,0)
 W !!,*7,"The Procedure code is inactive on ",$$DAT1^IBOUTL(DGPROCDT),"."
"RTN","IBCU7",117,0)
 W !,"Please select another Procedure."
"RTN","IBCU7",118,0)
 S DA(1)=IBIFN,DA=+Y,DIK="^DGCR(399,"_IBIFN_",""CP"","
"RTN","IBCU7",119,0)
 D ^DIK
"RTN","IBCU7",120,0)
 Q
"RTN","IBCU7",121,0)
 ;
"RTN","IBCU7",122,0)
DELADD N Z,Z0,DA,DIK,X,Y
"RTN","IBCU7",123,0)
 S DA(1)=IBIFN
"RTN","IBCU7",124,0)
 ;Delete references to proc on rev codes
"RTN","IBCU7",125,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) I Z0'="",$P(Z0,U,15)!$S($P(Z0,U,10)=3:$P(Z0,U,11),1:0) S DIE="^DGCR(399,"_DA(1)_",""RC"",",DA=Z,DR=".11///@;.15///@"_$S($P(Z0,U,8):"",1:";.08////1") D ^DIE
"RTN","IBCU7",126,0)
 S DIK="^DGCR(399,"_DA(1)_",""CP""," F DA=0:0 S DA=$O(^DGCR(399,DA(1),"CP",DA)) Q:'DA  D ^DIK
"RTN","IBCU7",127,0)
 S DGRVRCAL=1
"RTN","IBCU7",128,0)
 Q
"RTN","IBCU7",129,0)
 ;
"RTN","IBCU7",130,0)
DTMES ;Message if procedure date not in date range
"RTN","IBCU7",131,0)
 Q:'$D(IBIFN)  Q:'$D(^DGCR(399,IBIFN,"U"))  S DGNODUU=^("U")
"RTN","IBCU7",132,0)
 G:X'<$P(DGNODUU,"^")&(X'>$P(DGNODUU,"^",2)) DTMESQ
"RTN","IBCU7",133,0)
 W *7,!!?3,"Date must be within STATEMENT COVERS FROM and STATEMENT COVERS TO period."
"RTN","IBCU7",134,0)
 S Y=$P(DGNODUU,"^") X ^DD("DD")
"RTN","IBCU7",135,0)
 W !?3,"Enter a date between ",Y," and " S Y=$P(DGNODUU,"^",2) X ^DD("DD") W Y,!
"RTN","IBCU7",136,0)
 K X,Y
"RTN","IBCU7",137,0)
DTMESQ K DGNODUU Q
"RTN","IBCU7",138,0)
 ;
"RTN","IBCU7",139,0)
CODHLP ;Display Additional Procedure codes
"RTN","IBCU7",140,0)
 N I,J,Y,IBMOD
"RTN","IBCU7",141,0)
 I '$O(^DGCR(399,IBIFN,"CP",0)) W !!?5,"No Codes Entered!",! Q
"RTN","IBCU7",142,0)
 F I=0:0 S I=$O(^DGCR(399,IBIFN,"CP",I)) Q:'I  S Y=$G(^(I,0)) S Z=$$PRCNM^IBCSCH1($P(Y,"^",1),$P(Y,"^",2)) W !?5,$E($P(Z,"^",2),1,28),?35,"- ",$P(Z,"^") D
"RTN","IBCU7",143,0)
 . N IBY
"RTN","IBCU7",144,0)
 . S IBY=$P(Y,U,2)
"RTN","IBCU7",145,0)
 . S IBMOD=$$GETMOD^IBEFUNC(IBIFN,I,1)
"RTN","IBCU7",146,0)
 . I IBMOD'="" S IBMOD="/"_IBMOD W IBMOD
"RTN","IBCU7",147,0)
 . W ?60,"Date: " S Y=IBY D DT^DIQ
"RTN","IBCU7",148,0)
 ;
"RTN","IBCU7",149,0)
 K Z Q
"RTN","IBCU7",150,0)
 ;
"RTN","IBCU7",151,0)
DICV I $D(IBIFN),$D(^DGCR(399,IBIFN,0)),$P(^(0),U,9) S DIC("V")=$S($P(^(0),U,9)=9:"I +Y(0)=80.1",$P(^(0),U,9)=4!($P(^(0),U,9)=5):"I +Y(0)=81",1:"")
"RTN","IBCU7",152,0)
 Q
"RTN","IBCU7",153,0)
 ;
"RTN","IBCU7",154,0)
DEFDIV(IBIFN) ; Find default division for bill IBIFN
"RTN","IBCU7",155,0)
 Q $P($G(^DG(40.8,+$P($G(^DGCR(399,IBIFN,0)),U,22),0)),U)
"RTN","IBCU7",156,0)
 ;
"RTN","IBCU7",157,0)
ADDTNL(IBIFN,DA) ;
"RTN","IBCU7",158,0)
 N DR,IBOK,X,Y,DIR
"RTN","IBCU7",159,0)
 S IBOK=1
"RTN","IBCU7",160,0)
 S DR="19;50.09;50.08" D ^DIE
"RTN","IBCU7",161,0)
 ;I '($$FT^IBCEF(IBIFN)'=3&($$INPAT^IBCEF(IBIFN))) D ATTACH  ; DEM;432 - Prompt for Attachment Control Number.
"RTN","IBCU7",162,0)
 I '($$FT^IBCEF(IBIFN)=3&($$INPAT^IBCEF(IBIFN))) D ATTACH  ; DEM;432 - Prompt for Attachment Control Number.
"RTN","IBCU7",163,0)
 I $D(Y) S IBOK=0 G ADDTNLQ
"RTN","IBCU7",164,0)
 S DIR("B")="NO",DIR("A")="EDIT CMS-1500 SPECIAL PROGRAM FIELDS and BOX 19?: ",DIR("A",1)=" ",DIR(0)="YA"
"RTN","IBCU7",165,0)
 S DIR("?",1)="Respond YES only if you need to add/edit data for chiropractic visits,"
"RTN","IBCU7",166,0)
 S DIR("?")="EPSDT care, or if billing for HOSPICE and attending is not a hospice employee."
"RTN","IBCU7",167,0)
 D ^DIR K DIR
"RTN","IBCU7",168,0)
 I Y'=1 S IBOK=0 G ADDTNLQ
"RTN","IBCU7",169,0)
 S DR="W !,""  <<EPSDT>>"";50.07;W !!,""  <<HOSPICE>>"";50.03"
"RTN","IBCU7",170,0)
 D ^DIE
"RTN","IBCU7",171,0)
 W !
"RTN","IBCU7",172,0)
ADDTNLQ Q IBOK
"RTN","IBCU7",173,0)
 ;
"RTN","IBCU7",174,0)
XTRA1(Y) ;
"RTN","IBCU7",175,0)
 K Y
"RTN","IBCU7",176,0)
 Q
"RTN","IBCU7",177,0)
 ;
"RTN","IBCU7",178,0)
SPCUNIT(IBIFN,DA) ; return fields for special units if applicable, in DR form
"RTN","IBCU7",179,0)
 N IB0,IBCPT,IBDR,IBCT,IBFT,DFN S IBDR=""
"RTN","IBCU7",180,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)),IBCT=$P(IB0,U,27),IBFT=$P(IB0,U,19),DFN=$P(IB0,U,2)
"RTN","IBCU7",181,0)
 S IBCPT=$G(^DGCR(399,+$G(IBIFN),"CP",+$G(DA),0)) I IBCPT'["ICPT" G SPCUNTQ
"RTN","IBCU7",182,0)
 I +$$ITMUNIT^IBCRU4(+IBCPT,5,IBCT) S IBDR="15;" D SROMIN^IBCU74(IBIFN,DA) G SPCUNTQ ; minutes
"RTN","IBCU7",183,0)
 I +$$ITMUNIT^IBCRU4(+IBCPT,4,IBCT) S IBDR="21;" G SPCUNTQ ; miles
"RTN","IBCU7",184,0)
 I +$$ITMUNIT^IBCRU4(+IBCPT,6,IBCT) S IBDR="22//"_$$OBSHOUR^IBCU74(DFN,$P(IBCPT,U,2))_";" G SPCUNTQ ; hours
"RTN","IBCU7",185,0)
 I +IBFT=2,$P($G(^IBE(353.2,+$P(IBCPT,U,10),0)),U,2)="ANESTHESIA" S IBDR="15;" ; minutes
"RTN","IBCU7",186,0)
SPCUNTQ Q IBDR
"RTN","IBCU7",187,0)
 ;
"RTN","IBCU7",188,0)
ATTACH ; DEM;432 - Attachment control number.
"RTN","IBCU7",189,0)
 ; Ask if user wants to enter Attachment Control Number.
"RTN","IBCU7",190,0)
 N DIR,X,Y,DA,DIE,DR
"RTN","IBCU7",191,0)
 S DIR("A")="Enter Attachment Control Number"
"RTN","IBCU7",192,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","IBCU7",193,0)
 D ^DIR
"RTN","IBCU7",194,0)
 Q:'Y
"RTN","IBCU7",195,0)
 ; User chose to enter Attachment Control Number.
"RTN","IBCU7",196,0)
 ; User enters Attachment Control fields.
"RTN","IBCU7",197,0)
 S DA(1)=IBIFN,DA=IBPROCP
"RTN","IBCU7",198,0)
 S DIE="^DGCR(399,"_DA(1)_",""CP"","
"RTN","IBCU7",199,0)
 S DR="71Report Type;72Report Transmission Method;70Attachment Control Number"
"RTN","IBCU7",200,0)
 D ^DIE
"RTN","IBCU7",201,0)
 Q
"RTN","IBCU71")
0^6^B25142768^B21952006
"RTN","IBCU71",1,0)
IBCU71 ;ALB/AAS - INTERCEPT SCREEN INPUT OF PROCEDURE CODES ;29-OCT-91
"RTN","IBCU71",2,0)
 ;;2.0;INTEGRATED BILLING;**41,60,91,106,125,138,210,245,349,432**;21-MAR-94;Build 192
"RTN","IBCU71",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCU71",4,0)
 ;
"RTN","IBCU71",5,0)
 ;MAP TO DGCRU71
"RTN","IBCU71",6,0)
 ;
"RTN","IBCU71",7,0)
ADDCPT ;  - store cpt codes in visits file
"RTN","IBCU71",8,0)
 Q:$D(DGCPT)'>9
"RTN","IBCU71",9,0)
 N DA,DIC,DR,DIE,DIRUT,DUOUT,DTOUT,DIROUT,VADM
"RTN","IBCU71",10,0)
 S DIR(0)="Y",DIR("A")="OK to add CPT codes to Visits file",DIR("B")="Y" D ^DIR K DIR Q:'Y!$D(DIRUT)
"RTN","IBCU71",11,0)
 N IBPKG,IBCLIN,IBVDATE,IBPROC,IBK,IBCOUNT,IBRESULT,IBOTH
"RTN","IBCU71",12,0)
 S IBPKG=$O(^DIC(9.4,"C","IB",0)) Q:'IBPKG
"RTN","IBCU71",13,0)
 W !!,"Adding Procedures to PCE..."
"RTN","IBCU71",14,0)
 S IBCLIN=0 F  S IBCLIN=$O(DGCPT(IBCLIN)) Q:'IBCLIN  D
"RTN","IBCU71",15,0)
 .;
"RTN","IBCU71",16,0)
 .K ^TMP("IBPXAPI",$J)
"RTN","IBCU71",17,0)
 .;
"RTN","IBCU71",18,0)
 .; - set up encounter data
"RTN","IBCU71",19,0)
 .S IBVDATE=DGPROCDT D VISDT
"RTN","IBCU71",20,0)
 .S ^TMP("IBPXAPI",$J,"ENCOUNTER",1,"ENC D/T")=IBVDATE,^("PATIENT")=DFN,^("HOS LOC")=IBCLIN,^("SERVICE CATEGORY")="X",^("ENCOUNTER TYPE")="A"
"RTN","IBCU71",21,0)
 .;
"RTN","IBCU71",22,0)
 .; - set up procedure and diagnosis data
"RTN","IBCU71",23,0)
 .S IBK=0,IBPROC=0 F  S IBPROC=$O(DGCPT(IBCLIN,IBPROC)) Q:'IBPROC  D
"RTN","IBCU71",24,0)
 ..S IBOTH="" F  S IBOTH=$O(DGCPT(IBCLIN,IBPROC,IBOTH)) Q:IBOTH=""  D
"RTN","IBCU71",25,0)
 ...S IBK=IBK+1
"RTN","IBCU71",26,0)
 ...;
"RTN","IBCU71",27,0)
 ...; - load first procedure diagnosis as visit diagnosis
"RTN","IBCU71",28,0)
 ...I +$P(IBOTH,U,2) S ^TMP("IBPXAPI",$J,"DX/PL",IBK,"DIAGNOSIS")=+$P(IBOTH,U,2)
"RTN","IBCU71",29,0)
 ...;
"RTN","IBCU71",30,0)
 ...; - count number of times procedure performed
"RTN","IBCU71",31,0)
 ...S (X,IBCOUNT)=0 F  S X=$O(DGCPT(IBCLIN,IBPROC,IBOTH,X)) Q:'X  S IBCOUNT=IBCOUNT+1
"RTN","IBCU71",32,0)
 ...;
"RTN","IBCU71",33,0)
 ...; - load procedure information
"RTN","IBCU71",34,0)
 ...S ^TMP("IBPXAPI",$J,"PROCEDURE",IBK,"PROCEDURE")=IBPROC,^("QTY")=IBCOUNT,^("EVENT D/T")=IBVDATE
"RTN","IBCU71",35,0)
 ...I +$P(IBOTH,U,1) S ^TMP("IBPXAPI",$J,"PROCEDURE",IBK,"ENC PROVIDER")=+$P(IBOTH,U,1)
"RTN","IBCU71",36,0)
 ...I +$P(IBOTH,U,3) S ^TMP("IBPXAPI",$J,"PROCEDURE",IBK,"MODIFIERS",$P($$MOD^ICPTMOD(+$P(IBOTH,U,3),"I"),U,2))=""
"RTN","IBCU71",37,0)
 .;
"RTN","IBCU71",38,0)
 .; - call the PCE interface
"RTN","IBCU71",39,0)
 .Q:'$D(^TMP("IBPXAPI",$J,"PROCEDURE"))
"RTN","IBCU71",40,0)
 .;
"RTN","IBCU71",41,0)
 .S IBRESULT=$$DATA2PCE^PXAPI("^TMP(""IBPXAPI"",$J)",IBPKG,"IB DATA",,DUZ,0)
"RTN","IBCU71",42,0)
 .W !,"  Procedures in ",$P(^SC(IBCLIN,0),"^")," "
"RTN","IBCU71",43,0)
 .I IBRESULT>0 W "were added okay." Q
"RTN","IBCU71",44,0)
 .W "were not added - error code is ",IBRESULT
"RTN","IBCU71",45,0)
 ;
"RTN","IBCU71",46,0)
 K ^TMP("IBPXAPI",$J)
"RTN","IBCU71",47,0)
 Q
"RTN","IBCU71",48,0)
 ;
"RTN","IBCU71",49,0)
 ;
"RTN","IBCU71",50,0)
DISPDX ;  - display diagnosis codes available for associated dx (CMS-1500)  NO LONGER USED?
"RTN","IBCU71",51,0)
 N I,J,X,IBDX,IBDXL,IBDATE
"RTN","IBCU71",52,0)
 S IBDATE=$$BDATE^IBACSV(IBIFN)
"RTN","IBCU71",53,0)
 F I=1:1:4 S IBDX=$P($G(^DGCR(399,IBIFN,"C")),"^",(I+13)),X=$$ICD9^IBACSV(+IBDX,IBDATE) I X'="" S IBDXL(I)=IBDX_"^"_X
"RTN","IBCU71",54,0)
 I '$D(IBDXL) W !!,"Bill has no ICD DIAGNOSIS." Q
"RTN","IBCU71",55,0)
 W !!,?24,"<<<ASSOCIATED ICD-9 DIAGNOSIS>>>",!!
"RTN","IBCU71",56,0)
 F I=1,2 W ! S X=0 F J=0,2 I $D(IBDXL(I+J)) S IBDX=IBDXL(I+J) D  S X=40
"RTN","IBCU71",57,0)
 . W ?X,"    ",$P(IBDX,"^",2),?(X+13),$E($P(IBDX,"^",4),1,28)
"RTN","IBCU71",58,0)
 W !
"RTN","IBCU71",59,0)
 Q
"RTN","IBCU71",60,0)
 ;
"RTN","IBCU71",61,0)
SCREEN(X,Y) ; -- screen logic for active procs or surgeries - OBSOLETE
"RTN","IBCU71",62,0)
 ; -- input x = date to check,  y = procedure
"RTN","IBCU71",63,0)
 ; -- output 0 if not active for billing or amb proc on date,  1 if either active
"RTN","IBCU71",64,0)
 ;
"RTN","IBCU71",65,0)
 Q 0
"RTN","IBCU71",66,0)
 ;
"RTN","IBCU71",67,0)
VISDT ; Find the actual encounter for the visit; update visit date/time
"RTN","IBCU71",68,0)
 ; input DGPROCDT, DFN, IBCLIN
"RTN","IBCU71",69,0)
 N IBD,IBF,IBOEN,IBEVT,IBVAL,IBCBK,IBFILTER
"RTN","IBCU71",70,0)
 S IBF=0,IBD=DGPROCDT-.1
"RTN","IBCU71",71,0)
 S IBVAL("DFN")=DFN,IBVAL("BDT")=DGPROCDT-.1,IBVAL("EDT")=DGPROCDT\1_".99"
"RTN","IBCU71",72,0)
 S IBFILTER=""
"RTN","IBCU71",73,0)
 S IBCBK="I IBCLIN=$P(Y0,U,4) S IBVDATE=+Y0,SDSTOP=1"
"RTN","IBCU71",74,0)
 D SCAN^IBSDU("PATIENT/DATE",.IBVAL,IBFILTER,IBCBK,1)
"RTN","IBCU71",75,0)
 Q
"RTN","IBCU71",76,0)
 ;
"RTN","IBCU71",77,0)
PRCDT(IBIFN,ARR) ; return array of bill's procedures in date then code order
"RTN","IBCU71",78,0)
 ; returns    ARR(DATE, NAME, CPIFN) = 399.0304 node
"RTN","IBCU71",79,0)
 N IBI,IBX,IBNAME K ARR
"RTN","IBCU71",80,0)
 S IBI=0 F  S IBI=$O(^DGCR(399,+$G(IBIFN),"CP",IBI)) Q:'IBI  D
"RTN","IBCU71",81,0)
 . S IBX=$G(^DGCR(399,IBIFN,"CP",IBI,0))
"RTN","IBCU71",82,0)
 . S IBNAME=$P($$PRCNM^IBCSCH1($P(IBX,U,1)),U,1)_" "
"RTN","IBCU71",83,0)
 . S ARR($P(IBX,U,2),IBNAME,IBI)=IBX
"RTN","IBCU71",84,0)
 Q
"RTN","IBCU71",85,0)
 ;
"RTN","IBCU71",86,0)
PRCDIV(IBIFN) ; change Bills Default Division (399,.22) to reflect care provided
"RTN","IBCU71",87,0)
 ; - set Bill Division to the first Procedures Division (399,304,5), if defined
"RTN","IBCU71",88,0)
 ; - or else if bill is an inpatient bill then get the Division of the Ward the patient was Admitted to
"RTN","IBCU71",89,0)
 ; return null if no change or 'new division ifn^message'
"RTN","IBCU71",90,0)
 ;
"RTN","IBCU71",91,0)
 N IB0,IBCPT,IBPDIV,IBWRD,IBX,DIC,DIE,DA,DR,X,Y,IBCPT0 S IBX="",IBPDIV=0
"RTN","IBCU71",92,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0))
"RTN","IBCU71",93,0)
 ; if OP, Institutional claim and any CP entry has the Main Division, set default = to main
"RTN","IBCU71",94,0)
 I +$G(IBIFN),'$$INPAT^IBCEF(IBIFN),$$INSPRF^IBCEF(IBIFN) S IBCPT="" F  S IBCPT=$O(^DGCR(399,IBIFN,"CP",IBCPT)) Q:'IBCPT!(IBPDIV>0)  D
"RTN","IBCU71",95,0)
 .S IBCPT0=$G(^DGCR(399,IBIFN,"CP",IBCPT,0))
"RTN","IBCU71",96,0)
 .;check to see if Procedure division was Main division on procedure date
"RTN","IBCU71",97,0)
 .I $P(IBCPT0,U,6)=$$PRIM^VASITE($P(IBCPT0,U,2)) S IBPDIV=$P(IBCPT0,U,6)
"RTN","IBCU71",98,0)
 ;
"RTN","IBCU71",99,0)
 ;I +$G(IBIFN) S IBCPT=$O(^DGCR(399,IBIFN,"CP",0)) I +IBCPT D  ; if CPT division defined, use it
"RTN","IBCU71",100,0)
 ; if CPT division defined and Proc Div not already set from above, use it
"RTN","IBCU71",101,0)
 I +$G(IBIFN),'IBPDIV S IBCPT=$O(^DGCR(399,IBIFN,"CP",0)) I +IBCPT D
"RTN","IBCU71",102,0)
 . S IBCPT=$G(^DGCR(399,IBIFN,"CP",IBCPT,0)) S IBPDIV=+$P(IBCPT,U,6)
"RTN","IBCU71",103,0)
 ;
"RTN","IBCU71",104,0)
 I 'IBPDIV,+$P(IB0,U,8) D  ; for inpatient, get Ward Division
"RTN","IBCU71",105,0)
 . S IBWRD=$G(^DGPT(+$P(IB0,U,8),535,1,0)) S IBPDIV=+$P($G(^DIC(42,+$P(IBWRD,U,6),0)),U,11)
"RTN","IBCU71",106,0)
 ;
"RTN","IBCU71",107,0)
 I +IBPDIV,+$P(IB0,U,22)'=+IBPDIV D
"RTN","IBCU71",108,0)
 . S DIE="^DGCR(399,",DA=IBIFN,DR=".22////"_+IBPDIV D ^DIE K DIE,DR,DA,X,Y
"RTN","IBCU71",109,0)
 . S IBX=+IBPDIV_"^Bill Division Changed to "_$P($G(^DG(40.8,+IBPDIV,0)),U,1)
"RTN","IBCU71",110,0)
 Q IBX
"RTN","IBCU71",111,0)
 ;
"RTN","IBCU71",112,0)
DVTYP(IBIFN) ; reset Bill Charge Type (399, .27) based on Bill Division (399, .22)
"RTN","IBCU71",113,0)
 ; if bill division is type 3 - Freestanding then reset Charge Type to 2 - Professional
"RTN","IBCU71",114,0)
 ; with RC 2.0+ Type 3 sites have only professional charges, start date of bill must be on/after beginning of RC 2.0
"RTN","IBCU71",115,0)
 N IB0,IBDV,IBCHGTYP,IBDVTYP,DIC,DIE,DA,DR,X,Y
"RTN","IBCU71",116,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)),IBDV=$P(IB0,U,22),IBCHGTYP=$P(IB0,U,27)
"RTN","IBCU71",117,0)
 I +$G(^DGCR(399,+$G(IBIFN),"U"))<$$VERSDT^IBCRU8(2) G DVTYPQ
"RTN","IBCU71",118,0)
 I +IBDV,+IBCHGTYP S IBDVTYP=$$RCDV^IBCRU8(+IBDV) I +$P(IBDVTYP,U,3)=3,IBCHGTYP'=2 D
"RTN","IBCU71",119,0)
 . S DIE="^DGCR(399,",DA=IBIFN,DR=".27////"_2 D ^DIE K DIE,DR,DA,X,Y
"RTN","IBCU71",120,0)
 . S IBCHGTYP="2^Bill Charge Type Changed to Professional"
"RTN","IBCU71",121,0)
DVTYPQ Q IBCHGTYP
"RTN","IBCU74")
0^105^B35879024^B34341645
"RTN","IBCU74",1,0)
IBCU74 ;OAK/ELZ - INTERCEPT SCREEN INPUT OF PROCEDURE CODES (CONT) ;6-JAN-04
"RTN","IBCU74",2,0)
 ;;2.0;INTEGRATED BILLING;**228,260,339,432**;21-MAR-94;Build 192
"RTN","IBCU74",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCU74",4,0)
 ;
"RTN","IBCU74",5,0)
 ;
"RTN","IBCU74",6,0)
DATA(IBP,IBLNPRV) ; this is used to add data when new procedures are added for
"RTN","IBCU74",7,0)
 ; inpatient cases
"RTN","IBCU74",8,0)
 ; Return IBRPROV - renderring providers ;ib*2.0*432
"RTN","IBCU74",9,0)
 N IBX,IBY,IB1,IB2,IBC,DO,X,DIC,DIE,DA,DR,IB9,Y,IBQ,IBDR,IBZ,IBS
"RTN","IBCU74",10,0)
 S DR="" I '$P(IBP,"^",2)!('DGPROCDT) Q
"RTN","IBCU74",11,0)
 S IB1=0 F  S IB1=$O(^UTILITY($J,"IB",IB1)) Q:IB1<1!(DR)  I $P($G(^UTILITY($J,"IB",IB1,1)),"^",2)=DGPROCDT D
"RTN","IBCU74",12,0)
 . S IB2=0 F  S IB2=$O(^UTILITY($J,"IB",IB1,IB2)) Q:IB2<1!(DR)  S IBY=$G(^UTILITY($J,"IB",IB1,IB2)) I +IBY=+$P(IBP,"^",2) D  Q
"RTN","IBCU74",13,0)
 .. F IBX=6:1:9 I $P(IBY,"^",IBX) D
"RTN","IBCU74",14,0)
 ... F IBC=1:1:4 Q:'$D(^IBA(362.3,"AO",IBIFN,IBC))
"RTN","IBCU74",15,0)
 ... I $D(^IBA(362.3,"AO",IBIFN,IBC)) Q
"RTN","IBCU74",16,0)
 ... S IB9=$$ICD9^IBACSV($P(IBY,"^",IBX),DGPROCDT)
"RTN","IBCU74",17,0)
 ... W !?10,"Adding associated dx: ",$P(IB9,"^"),"  ",$P(IB9,"^",3)
"RTN","IBCU74",18,0)
 ... ; first check to see if dx on bill already
"RTN","IBCU74",19,0)
 ... S Y=$O(^IBA(362.3,"AIFN"_IBIFN,$P(IBY,"^",IBX),0))
"RTN","IBCU74",20,0)
 ... I 'Y S DIC="^IBA(362.3,",DIC(0)="",X=$P(IBY,"^",IBX),DIC("DR")=".02////^S X=IBIFN;.03////^S X=IBC" D FILE^DICN Q:Y<1
"RTN","IBCU74",21,0)
 ... ;need to find what field is not occupied starting with 10
"RTN","IBCU74",22,0)
 ... S IBZ=10 F IBS=1:1 Q:$P(DR,";",IBS)=""  I $P(DR,";",IBS)[IBZ_"////" S IBZ=IBZ+1
"RTN","IBCU74",23,0)
 ... S DR=DR_IBZ_"////"_(+Y)_";"
"RTN","IBCU74",24,0)
 .. I $P(IBY,"^",13) W !!?10,"Associating Provider: ",$P($G(^VA(200,$P(IBY,"^",13),0)),"^") D  S DR=DR_"18////"_$P(IBY,"^",13)_";",IBLNPRV("IBCCPT")="`"_$P(IBY,U,13)  ;WCJ;IB*2.0*432;Save off renderring to return
"RTN","IBCU74",25,0)
 ... ;
"RTN","IBCU74",26,0)
 ... ; as requested by users, need to update the last look up value for
"RTN","IBCU74",27,0)
 ... ; the provider
"RTN","IBCU74",28,0)
 ... N DIC,X,DR,Y S DIC="^VA(200,",DIC(0)="INOS",X="`"_$P(IBY,"^",13)
"RTN","IBCU74",29,0)
 ... D ^DIC
"RTN","IBCU74",30,0)
 ... ;
"RTN","IBCU74",31,0)
 .. I $P(IBY,"^",14) W !?10,"Assigning Location: ",$P($G(^SC($P(IBY,"^",14),0)),"^") S DR=DR_"6////"_$P(IBY,"^",14)_";"_$S($P($G(^SC($P(IBY,"^",14),0)),"^",15):"5////"_$P(^(0),"^",15)_";",1:"")
"RTN","IBCU74",32,0)
 .. I $L(DR) S DIE="^DGCR(399,"_IBIFN_",""CP"",",DA(1)=IBIFN,DA=+IBP,IBDR=DR D ^DIE
"RTN","IBCU74",33,0)
 .. S IBC=0 F IBX=11,12 I $P(IBY,"^",IBX) S IB9=$$MOD^ICPTMOD($P(IBY,"^",IBX),"I") W !?10,"Adding Modifier: ",$P(IB9,"^",2)," - ",$P(IB9,"^",3) D
"RTN","IBCU74",34,0)
 ... S IBC=IBC+1,DIC="^DGCR(399,"_IBIFN_",""CP"","_(+IBP)_",""MOD"",",DA(1)=+IBP,DA(2)=IBIFN,X=IBC,DIC("DR")=".02////"_$P(IBY,"^",IBX),DIC(0)="" D FILE^DICN
"RTN","IBCU74",35,0)
 .. ;
"RTN","IBCU74",36,0)
 .. ; need to check for quantity >1 then duplicate entry
"RTN","IBCU74",37,0)
 .. I $P(IBY,"^",10)>1 W !!?10,"Duplicating Procedure for Quantity of ",$P(IBY,"^",10) F IBQ=1:1:$P(IBY,"^",10)-1 D
"RTN","IBCU74",38,0)
 ... K DO S DIC="^DGCR(399,"_IBIFN_",""CP"",",DIC(0)="",X=(+IBY)_";ICPT(",DA(1)=IBIFN,DIC("DR")="1////"_DGPROCDT_";"_$G(IBDR) D FILE^DICN S IBCP=+Y
"RTN","IBCU74",39,0)
 ... S IBC=0 F IBX=11,12 I $P(IBY,"^",IBX) S IB9=$$MOD^ICPTMOD($P(IBY,"^",IBX),"I"),IBC=IBC+1,DIC="^DGCR(399,"_IBIFN_",""CP"","_IBCP_",""MOD"",",DA(1)=IBCP,DA(2)=IBIFN,X=IBC,DIC("DR")=".02////"_$P(IBY,"^",IBX),DIC(0)="" D FILE^DICN
"RTN","IBCU74",40,0)
 .. K IBDR
"RTN","IBCU74",41,0)
 Q
"RTN","IBCU74",42,0)
 ;
"RTN","IBCU74",43,0)
SROMIN(IBIFN,IBPROCP) ; will ask as user to select anesthesia to populate into
"RTN","IBCU74",44,0)
 ; the minutes of a bill
"RTN","IBCU74",45,0)
 N IBSR,DFN,IBFDT,IBTDT,IBSRC,IBSRSDT,IBSREDT,IBC,IBSRDAT,IBSRMIN,DR,DA
"RTN","IBCU74",46,0)
 N DIE,X,Y,IBP,DIR
"RTN","IBCU74",47,0)
 K ^TMP("SRANES",$J),^TMP("IBSRDAT",$J)
"RTN","IBCU74",48,0)
 ;
"RTN","IBCU74",49,0)
 S DFN=$P($G(^DGCR(399,+$G(IBIFN),0)),"^",2)
"RTN","IBCU74",50,0)
 S IBFDT=+$G(^DGCR(399,IBIFN,"U")),IBTDT=$P($G(^("U")),"^",2)
"RTN","IBCU74",51,0)
 I 'DFN!('IBFDT)!('IBTDT) G SROMINQ
"RTN","IBCU74",52,0)
 ;
"RTN","IBCU74",53,0)
 S IBSR=$$ANESTIME^SROANEST(DFN,IBFDT,IBTDT) I IBSR<1 G SROMINQ
"RTN","IBCU74",54,0)
 ;
"RTN","IBCU74",55,0)
 W !!,"The following surgical/anesthesia times were found:",!
"RTN","IBCU74",56,0)
 S (IBC,IBSRC)=0 F  S IBSRC=$O(^TMP("SRANES",$J,IBSRC)) Q:IBSRC<1  S IBSRSDT=0 F  S IBSRSDT=$O(^TMP("SRANES",$J,IBSRC,IBSRSDT)) Q:'IBSRSDT  S IBSREDT=0 F  S IBSREDT=$O(^TMP("SRANES",$J,IBSRC,IBSRSDT,IBSREDT)) Q:'IBSREDT  D
"RTN","IBCU74",57,0)
 . ;
"RTN","IBCU74",58,0)
 . S IBC=IBC+1
"RTN","IBCU74",59,0)
 . S IBSRDAT=^TMP("SRANES",$J,IBSRC,IBSRSDT,IBSREDT)
"RTN","IBCU74",60,0)
 . S ^TMP("IBSRDAT",$J,IBC)=IBSRDAT
"RTN","IBCU74",61,0)
 . W !,$J(IBC,4)," Case #",IBSRC,?20,$$FMTE^XLFDT(IBSRSDT,2),?35,$$FMTE^XLFDT(IBSREDT,2),?50,$P(IBSRDAT,"^",2),?60
"RTN","IBCU74",62,0)
 . F IBP=4:1:11 I $P(IBSRDAT,"^",IBP) W:$X>61 "," W $P($T(EXEMPT+(IBP-3)),";",3)
"RTN","IBCU74",63,0)
 ;
"RTN","IBCU74",64,0)
 S DIR(0)="LO^1:"_IBC_":0" D ^DIR G:'Y SROMINQ
"RTN","IBCU74",65,0)
 ;
"RTN","IBCU74",66,0)
 S IBSRMIN=0 F IBP=1:1 Q:'$P(Y,",",IBP)  S IBSRMIN=IBSRMIN+$P(^TMP("IBSRDAT",$J,$P(Y,",",IBP)),"^",2)
"RTN","IBCU74",67,0)
 S DIE="^DGCR(399,"_IBIFN_",""CP"",",DR="15///"_IBSRMIN,DA=IBPROCP,DA(1)=IBIFN D ^DIE
"RTN","IBCU74",68,0)
 ;
"RTN","IBCU74",69,0)
SROMINQ K ^TMP("SRANES",$J),^TMP("IBSRDAT",$J)
"RTN","IBCU74",70,0)
 Q
"RTN","IBCU74",71,0)
 ;
"RTN","IBCU74",72,0)
 ;
"RTN","IBCU74",73,0)
OBSHOUR(DFN,EVNTDT) ; Get Observation Hours (for Procedures whose charge requires Hours)
"RTN","IBCU74",74,0)
 ; display Observation Discharges 72 hours before date (procedure date)
"RTN","IBCU74",75,0)
 ; allow user to input exact observation date times, using the last observation admission/discharge as default
"RTN","IBCU74",76,0)
 ; based on the date/times entered by the user calculate the total hours
"RTN","IBCU74",77,0)
 ; Input:  DFN = Patient ifn,   EVNTDT = Procedure Date
"RTN","IBCU74",78,0)
 ; Output: returns total hours with 1 decimal digit selected/input or ""
"RTN","IBCU74",79,0)
 ;
"RTN","IBCU74",80,0)
 N IBBEG,IBEND,IBDATE,IBPTF,IBPTF0,IBPTF70,IBDSPLT,IBADMDT,IBDSCDT,IBDSH,DIR,X,Y,DIRUT,DTOUT,DUOUT,IBHOURS
"RTN","IBCU74",81,0)
 S (IBDSH,IBHOURS,IBADMDT,IBDSCDT)="" I '$G(DFN) G OBSHOURQ
"RTN","IBCU74",82,0)
 S EVNTDT=$S(+$G(EVNTDT):EVNTDT,1:DT)\1,IBBEG=$$FMADD^XLFDT(EVNTDT,-3)+.0001,IBEND=EVNTDT+.2359
"RTN","IBCU74",83,0)
 ;
"RTN","IBCU74",84,0)
 W !!,?6,"Inpatient Observation Discharges 72 hours before "_$$FMTE^XLFDT(EVNTDT,2),":"
"RTN","IBCU74",85,0)
 S IBDATE=IBBEG F  S IBDATE=$O(^DGPT("ADS",IBDATE)) Q:'IBDATE  Q:IBDATE>IBEND  D
"RTN","IBCU74",86,0)
 . S IBPTF=0 F  S IBPTF=$O(^DGPT("ADS",IBDATE,IBPTF)) Q:'IBPTF  D
"RTN","IBCU74",87,0)
 .. S IBPTF0=$G(^DGPT(IBPTF,0)) Q:+IBPTF0'=DFN  S IBPTF70=$G(^DGPT(IBPTF,70))
"RTN","IBCU74",88,0)
 .. ;
"RTN","IBCU74",89,0)
 .. S IBDSPLT=+$P(IBPTF70,U,2) I ",18,23,24,36,41,65,94,"'[(","_IBDSPLT_",") Q
"RTN","IBCU74",90,0)
 .. ;
"RTN","IBCU74",91,0)
 .. S IBDSPLT=$G(^DIC(42.4,IBDSPLT,0)),IBADMDT=$E(+$P(IBPTF0,U,2),1,12),IBDSCDT=$E(+IBPTF70,1,12)
"RTN","IBCU74",92,0)
 .. ;
"RTN","IBCU74",93,0)
 .. S IBDSH=$$FMDIFF^XLFDT(IBDSCDT,IBADMDT,2)/60/60
"RTN","IBCU74",94,0)
 .. ;
"RTN","IBCU74",95,0)
 .. W !,?6,$P(IBDSPLT,U,1),?39,$$FMTE^XLFDT(IBADMDT,2),?55,$$FMTE^XLFDT(IBDSCDT,2),?72,"(",$J(IBDSH,"",1),")"
"RTN","IBCU74",96,0)
 I 'IBDSH W " None found"
"RTN","IBCU74",97,0)
 ;
"RTN","IBCU74",98,0)
 W !!,?6,"Observation Start/Stop Times are optional, used only to calculate Hours:"
"RTN","IBCU74",99,0)
 S DIR("A")="      Enter Observation Start Date/Time: " I +IBADMDT S DIR("B")=$$FMTE^XLFDT(IBADMDT,2)
"RTN","IBCU74",100,0)
 S DIR(0)="DAO^::XR" D ^DIR S IBADMDT=+Y I ('Y)!($D(DIRUT)) G OBSHOURQ
"RTN","IBCU74",101,0)
 ;
"RTN","IBCU74",102,0)
 S DIR("A")="      Enter Observation Stop Date/Time: " I IBDSCDT>IBADMDT S DIR("B")=$$FMTE^XLFDT(IBDSCDT,2)
"RTN","IBCU74",103,0)
 S DIR(0)="DAO^"_IBADMDT_"::XR" D ^DIR S IBDSCDT=+Y I ('Y)!($D(DIRUT)) G OBSHOURQ
"RTN","IBCU74",104,0)
 ;
"RTN","IBCU74",105,0)
 S IBHOURS=$J($$FMDIFF^XLFDT(IBDSCDT,IBADMDT,2)/60/60,"",1) W "     (",IBHOURS,")",!
"RTN","IBCU74",106,0)
 ;
"RTN","IBCU74",107,0)
OBSHOURQ Q IBHOURS
"RTN","IBCU74",108,0)
 ;
"RTN","IBCU74",109,0)
 ;
"RTN","IBCU74",110,0)
EXEMPT ; exemption reasons to display
"RTN","IBCU74",111,0)
 ;;SC
"RTN","IBCU74",112,0)
 ;;CV
"RTN","IBCU74",113,0)
 ;;AO
"RTN","IBCU74",114,0)
 ;;IR
"RTN","IBCU74",115,0)
 ;;SWA
"RTN","IBCU74",116,0)
 ;;MST
"RTN","IBCU74",117,0)
 ;;HNC
"RTN","IBCU74",118,0)
 ;;SHAD
"RTN","IBCU7B")
0^55^B52236174^n/a
"RTN","IBCU7B",1,0)
IBCU7B ;ALB/DEM - LINE LEVEL PROVIDER USER INPUT ;27-SEP-2010
"RTN","IBCU7B",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBCU7B",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCU7B",4,0)
 Q
"RTN","IBCU7B",5,0)
 ;
"RTN","IBCU7B",6,0)
EN ;
"RTN","IBCU7B",7,0)
 ;
"RTN","IBCU7B",8,0)
 N X,DIC,DIE,DR,DA,DLAYGO,PRVFUN,DIPA,Y,DO,DD,I,IBPOPOUT
"RTN","IBCU7B",9,0)
 I '$D(IBLNPRV("IBCCPT")) N IBLNPRV  ; DEM;432 - Coming from routine IBCCPT.
"RTN","IBCU7B",10,0)
 S:'$G(IBFT) IBFT=$$FT^IBCEF(IBIFN)  ;DEM;432 - Form Type for claim.
"RTN","IBCU7B",11,0)
 I IBFT=3,$$INPAT^IBCEF(IBIFN) Q   ;WCJ*2.0*432 Don't ask line level providers if INPAT UB
"RTN","IBCU7B",12,0)
 Q:(IBFT'=2)&(IBFT'=3)  ;DEM;432 - Must be CMS-1500 (2) or UB-04 (3) Form Type.
"RTN","IBCU7B",13,0)
 S:IBFT=2 PRVFUN(2)="Rendering,Referring,Supervising"  ;DEM;432 - Allowable provider functions for CMS-1500.
"RTN","IBCU7B",14,0)
 S:IBFT=3 PRVFUN(3)="Rendering,Referring,Operating,Other Operating"  ;DEM;432 - Allowable provider functions for UB-04.
"RTN","IBCU7B",15,0)
 F PRVFUN("CNT")=1:1:$L(PRVFUN(IBFT),",") S PRVFUN=$P(PRVFUN(IBFT),",",PRVFUN("CNT")) D  I $G(IBPOPOUT) K IBPOPOUT Q
"RTN","IBCU7B",16,0)
 . S X=$S(PRVFUN="Rendering":3,PRVFUN="Referring":1,PRVFUN="Supervising":5,PRVFUN="Operating":2,1:9)  ;DEM;432 - X=Provider Function Code Number.
"RTN","IBCU7B",17,0)
 . ;I $D(IBLNPRV("IBCCPT")),X'=3 Q  ; DEM;432 - Coming from routine IBCCPT, only interested in RENDERING PROVIDER.
"RTN","IBCU7B",18,0)
 . K DA,DO,DD
"RTN","IBCU7B",19,0)
 . S DA(2)=IBIFN,DA(1)=IBPROCP  ;DEM;432 - Set up DA array for call to FILE^DICN.
"RTN","IBCU7B",20,0)
 . S DIC="^DGCR(399,"_DA(2)_",""CP"","_DA(1)_",""LNPRV"","  ;DEM;432 - Global root of Line Provider multiple.
"RTN","IBCU7B",21,0)
 . S DIC(0)="L"
"RTN","IBCU7B",22,0)
 . S DIC("DR")=".01////"_X  ;DEM;432 - Stuff X (provider function) into new entry.
"RTN","IBCU7B",23,0)
 . I '$D(^DGCR(399,DA(2),"CP",DA(1),"LNPRV","B",X)) D FILE^DICN  ; DEM;432 - Add new entry.
"RTN","IBCU7B",24,0)
 . S DA=+$O(^DGCR(399,DA(2),"CP",DA(1),"LNPRV","B",X,0))  ;DEM;432 - Get DA of line provider entry.
"RTN","IBCU7B",25,0)
 . S DIPA("RF")=X  ;DEM;432 - Save provider function in DIPA("RF") for later use in call to DIE.
"RTN","IBCU7B",26,0)
 . S DIE=DIC
"RTN","IBCU7B",27,0)
 . K DIC,DO,DD,DR,X,Y
"RTN","IBCU7B",28,0)
 . D DRARRY  ;DEM;432 - Set up DR array for call to DIE.
"RTN","IBCU7B",29,0)
 . ;
"RTN","IBCU7B",30,0)
 . ; DEM;432 - Variable IBLNPRV is a flag for called code
"RTN","IBCU7B",31,0)
 . ;           that we are coming from line level provider
"RTN","IBCU7B",32,0)
 . ;           user input (example, EXTCR^IBCEU5).
"RTN","IBCU7B",33,0)
 . ;
"RTN","IBCU7B",34,0)
 . S IBLNPRV=1
"RTN","IBCU7B",35,0)
 . S IBLNPRV("LNPRVIEN")=DA  ;DEM;432 - DA of line provider entry to edit.
"RTN","IBCU7B",36,0)
 . S IBLNPRV("PROCIEN")=DA(1)  ;DEM;432 - DA(1) is procedure code multiple IEN.
"RTN","IBCU7B",37,0)
 . S DLAYGO=399  ;DEM;432 - Set DLAYGO.
"RTN","IBCU7B",38,0)
 . D ^DIE
"RTN","IBCU7B",39,0)
 . I ($G(Y)="^")!($G(Y)=-1) S IBPOPOUT=1 Q  ; User entered caret ("^"), so exit line provider entry.
"RTN","IBCU7B",40,0)
 . ; DEM;432 - If line provider zero node exist, and no provider, then delete entry.
"RTN","IBCU7B",41,0)
 . I $D(^DGCR(399,IBIFN,"CP",IBLNPRV("PROCIEN"),"LNPRV",IBLNPRV("LNPRVIEN"),0))#10,'$P(^DGCR(399,IBIFN,"CP",IBLNPRV("PROCIEN"),"LNPRV",IBLNPRV("LNPRVIEN"),0),U,2) S DR=".01///@" D ^DIE
"RTN","IBCU7B",42,0)
 . K DIC,DIE,DR,DA,X,Y,DO,DD,DLAYGO,DIPA  ;DEM;432 - Clean up.
"RTN","IBCU7B",43,0)
 . Q
"RTN","IBCU7B",44,0)
 ;
"RTN","IBCU7B",45,0)
 K IBLNPRV,PRVFUN
"RTN","IBCU7B",46,0)
 ;
"RTN","IBCU7B",47,0)
END ;
"RTN","IBCU7B",48,0)
 Q
"RTN","IBCU7B",49,0)
 ;
"RTN","IBCU7B",50,0)
DRARRY ; Set of DR array for user input.
"RTN","IBCU7B",51,0)
 ;
"RTN","IBCU7B",52,0)
 ; DEM;432 - DIE uses DR to execute individual DR array elements, so
"RTN","IBCU7B",53,0)
 ;           need to leave DR(1,399.0404) undefined for DIE to move
"RTN","IBCU7B",54,0)
 ;           DR string into DR(1,399.0404).
"RTN","IBCU7B",55,0)
 ;
"RTN","IBCU7B",56,0)
 ; Note: 'B' line tags represent DR string branching.
"RTN","IBCU7B",57,0)
 ;
"RTN","IBCU7B",58,0)
 ; 399.0404,.01 LINE FUNCTION.
"RTN","IBCU7B",59,0)
 ; Stuff value from FILE^DICN add above (DIPA("RF")) into .01 field.
"RTN","IBCU7B",60,0)
 ; Also, need to set up DIPA("I#") array from claim level for later reference in DR array.
"RTN","IBCU7B",61,0)
 S DR=".01///^S X=DIPA(""RF"");K DIPA S DIPA(""RF"")=X,DIPA(""I1"")=$D(^DGCR(399,DA(2),""I1"")),DIPA(""I2"")=$D(^(""I2"")),DIPA(""I3"")=$D(^(""I3""))"
"RTN","IBCU7B",62,0)
 ;
"RTN","IBCU7B",63,0)
 ; 399.0404,.02 LINE PERFORMED BY.
"RTN","IBCU7B",64,0)
 ; If no provider entered by user, then delete entry (accomplished by
"RTN","IBCU7B",65,0)
 ; deleting .01 field, LINE FUNCTION field).
"RTN","IBCU7B",66,0)
 ; Branch to end (@499) if no provider entered.
"RTN","IBCU7B",67,0)
 ;S:'$D(IBLNPRV("IBCCPT")) DR(1,399.0404,1)=".02"_PRVFUN_$S(PRVFUN'["Operating":" Provider",1:" Physician")_";S:X DIPA(""PRF"")=X,Y=""@4"";.01///@;S Y=""@499"""
"RTN","IBCU7B",68,0)
 ;S:$D(IBLNPRV("IBCCPT")) DR(1,399.0404,1)=".02///"_IBLNPRV("IBCCPT")_";.02Rendering;S:X DIPA(""PRF"")=X,Y=""@4"";.01///@;S Y=""@499"""
"RTN","IBCU7B",69,0)
 S DR(1,399.0404,1)=""
"RTN","IBCU7B",70,0)
 S:$D(IBLNPRV("IBCCPT"))&(PRVFUN["Rendering") DR(1,399.0404,1)=".02///"_IBLNPRV("IBCCPT")_";"
"RTN","IBCU7B",71,0)
 S DR(1,399.0404,1)=DR(1,399.0404,1)_".02"_PRVFUN_$S(PRVFUN'["Operating":" Provider",1:" Physician")_";S:X DIPA(""PRF"")=X,Y=""@4"";.01///@;S Y=""@499"""
"RTN","IBCU7B",72,0)
 ; Branch to @48 if VA PROVIDER.
"RTN","IBCU7B",73,0)
 ; IF Non-VA PROVIDER, then file changes to IB NON/OTHER VA BILLING PROVIDER File (#355.93) for user input.
"RTN","IBCU7B",74,0)
 ; DR string syntax ";^355.93^IBA(355.93," accomplishes variable pointer file change.
"RTN","IBCU7B",75,0)
 ; See DR array DR(2,355.93) and DR(2,355.93,SEQ #) below for details.
"RTN","IBCU7B",76,0)
 ;
"RTN","IBCU7B",77,0)
 S DR(1,399.0404,2)="@4;N Z1 S Z1=$P($G(^DGCR(399,DA(2),""CP"",DA(1),""LNPRV"",DA,0)),U,2) S DIPA(""NVA_PRV"")=$S(Z1[""IBA(355.93"":+Z1,1:0) S X=+X I DIPA(""NVA_PRV"")=0 S Y=""@48"""
"RTN","IBCU7B",78,0)
 S DR(1,399.0404,3)="S:$D(^XUSEC(""IB PROVIDER EDIT"",DUZ)) DLAYGO=355.93;^355.93^IBA(355.93,"
"RTN","IBCU7B",79,0)
 ;
"RTN","IBCU7B",80,0)
NVAPRV ; Start of user input into IB NON/OTHER VA BILLING PROVIDER File (#355.93).
"RTN","IBCU7B",81,0)
 ;
"RTN","IBCU7B",82,0)
 S DR(2,355.93)="S DIPA(""NVA_PRV-0"")=$G(^IBA(355.93,DIPA(""NVA_PRV""),0))"
"RTN","IBCU7B",83,0)
 ;
"RTN","IBCU7B",84,0)
 ; Branch to @42 if PROVIDER TYPE equals '1' FOR FACILITY/GROUP.
"RTN","IBCU7B",85,0)
 ; Branch to @41 if CREDENTIALS are not NULL.
"RTN","IBCU7B",86,0)
 S DR(2,355.93,1)="S:$P(DIPA(""NVA_PRV-0""),U,2)=1 Y=""@42"";S:$P(DIPA(""NVA_PRV-0""),U,3)'="""" Y=""@41"""
"RTN","IBCU7B",87,0)
 ;
"RTN","IBCU7B",88,0)
 ; 355.93,.03 CREDENTIALS.
"RTN","IBCU7B",89,0)
 S DR(2,355.93)="S DIPA(""NVA_PRV-0"")=$G(^IBA(355.93,DIPA(""NVA_PRV""),0))"
"RTN","IBCU7B",90,0)
 ;
"RTN","IBCU7B",91,0)
 ; Branch to @42 if PROVIDER TYPE equals '1' FOR FACILITY/GROUP.
"RTN","IBCU7B",92,0)
 ; Branch to @41 if CREDENTIALS are not NULL.
"RTN","IBCU7B",93,0)
 S DR(2,355.93,1)="S:$P(DIPA(""NVA_PRV-0""),U,2)=1 Y=""@42"";S:$P(DIPA(""NVA_PRV-0""),U,3)'="""" Y=""@41"""
"RTN","IBCU7B",94,0)
 ;
"RTN","IBCU7B",95,0)
 ; 355.93,.03 CREDENTIALS.
"RTN","IBCU7B",96,0)
 S DR(2,355.93,2)=".03"
"RTN","IBCU7B",97,0)
B41 ;
"RTN","IBCU7B",98,0)
 ; 355.93,.04 SPECIALTY.
"RTN","IBCU7B",99,0)
 ; Branch to @45 if CREDENTIALS are not NULL.
"RTN","IBCU7B",100,0)
 S DR(2,355.93,3)="@41;S:$P(DIPA(""NVA_PRV-0""),U,3)'="""" Y=""@45"";.04;S Y=""@45"""
"RTN","IBCU7B",101,0)
B42 ;
"RTN","IBCU7B",102,0)
 ; 355.93,.05 STREET ADDRESS.
"RTN","IBCU7B",103,0)
 ; 355.93,.06 CITY.
"RTN","IBCU7B",104,0)
 ; 355.93,.07 STATE.
"RTN","IBCU7B",105,0)
 ; Branch to @43 if there is an STREET ADDRESS, CITY, and STATE.
"RTN","IBCU7B",106,0)
 S DR(2,355.93,4)="@42;S:$P(DIPA(""NVA_PRV-0""),U,5)'=""""&($P(DIPA(""NVA_PRV-0""),U,6)'="""")&($P(DIPA(""NVA_PRV-0""),U,7)'="""") Y=""@43"""
"RTN","IBCU7B",107,0)
 ; 355.93,.05 STREET ADDRESS.
"RTN","IBCU7B",108,0)
 ; 355.93,.1 STREET ADDRESS LINE 2.
"RTN","IBCU7B",109,0)
 ; 355.93,.06 CITY.
"RTN","IBCU7B",110,0)
 ; 355.93,.07 STATE.
"RTN","IBCU7B",111,0)
 ; 355.93,.08 ZIP CODE.
"RTN","IBCU7B",112,0)
 S DR(2,355.93,5)=".05;.1;.06;.07;.08"
"RTN","IBCU7B",113,0)
B43 ;
"RTN","IBCU7B",114,0)
 ; 355.93,.09 FACILITY DEFAULT ID NUMBER.
"RTN","IBCU7B",115,0)
 ; Branch to @44 if there is a FACILITY DEFAULT ID NUMBER.
"RTN","IBCU7B",116,0)
 S DR(2,355.93,6)="@43;S:$P(DIPA(""NVA_PRV-0""),U,9)'="""" Y=""@44"";.09LAB OR FACILITY PRIMARY ID"
"RTN","IBCU7B",117,0)
B44 ;
"RTN","IBCU7B",118,0)
 ; 355.93,.11 X12 TYPE OF FACILITY.
"RTN","IBCU7B",119,0)
 ; Branch to @45 if there is a X12 TYPE OF FACILITY.
"RTN","IBCU7B",120,0)
 S DR(2,355.93,7)="@44;S:$P(DIPA(""NVA_PRV-0""),U,11)'="""" Y=""@45"";.11"
"RTN","IBCU7B",121,0)
B45 ;
"RTN","IBCU7B",122,0)
 ; 355.93,41.01 NPI.
"RTN","IBCU7B",123,0)
 ; Branch to @46 if there is an NPI.
"RTN","IBCU7B",124,0)
 S DR(2,355.93,8)="@45;S:$P(DIPA(""NVA_PRV-0""),U,14)'="""" Y=""@46"";D EN2^IBCEP82(DIPA(""NVA_PRV""),4)"
"RTN","IBCU7B",125,0)
B46 ;
"RTN","IBCU7B",126,0)
 ; 355.93,42 TAXONOMY CODE.
"RTN","IBCU7B",127,0)
 ; Branch to @47 if there is TAXONOMY data.
"RTN","IBCU7B",128,0)
 ; 355.93,42 TAXONOMY CODE is a multiple (Sub-File 355.9342). We want 'ALL'
"RTN","IBCU7B",129,0)
 ; fields from TAXONOMY CODE Sub-File 355.9342. Thus,
"RTN","IBCU7B",130,0)
 ; DR string S DR(4,355.9342)=".01:.03" below.
"RTN","IBCU7B",131,0)
 S DR(2,355.93,9)="@46;S:$D(^IBA(355.93,DIPA(""NVA_PRV""),""TAXONOMY""))>0 Y=""@47"";42"
"RTN","IBCU7B",132,0)
 S DR(3,355.9342)=".01:.03"
"RTN","IBCU7B",133,0)
B47 ;
"RTN","IBCU7B",134,0)
 ; End of data entry for IB NON/OTHER VA BILLING PROVIDER File (#399.53).
"RTN","IBCU7B",135,0)
 S DR(2,355.93,10)="@47"
"RTN","IBCU7B",136,0)
 ;
"RTN","IBCU7B",137,0)
B48 ;
"RTN","IBCU7B",138,0)
 ;
"RTN","IBCU7B",139,0)
LNPRV ; User input into LINE PROVIDER Sub-File 399.0404.
"RTN","IBCU7B",140,0)
 ;
"RTN","IBCU7B",141,0)
 S DR(1,399.0404,4)="@48"
"RTN","IBCU7B",142,0)
 S DR(1,399.0404,5)="S DIK=""^DGCR(399,""_DA(2)_"",""""CP"""",""_DA(1)_"",""""LNPRV"""","",DIK(1)="".02"" D EN1^DIK K DIK"
"RTN","IBCU7B",143,0)
 ; 399.0404,.15 LINE TAXONOMY.
"RTN","IBCU7B",144,0)
 S DR(1,399.0404,6)=".15Line Level Taxonomy"
"RTN","IBCU7B",145,0)
 S DR(1,399.0404,7)="D DISPTAX^IBCEP81($P($G(^DGCR(399,DA(2),""CP"",DA(1),""LNPRV"",DA,0)),U,15),"""")"
"RTN","IBCU7B",146,0)
 S DR(1,399.0404,8)="N Z S Z=$$EXPAND^IBTRE(399.0404,.08,$P($G(^DGCR(399,DA(2),""CP"",DA(1),""LNPRV"",DA,0)),U,8)) S DIPA(""SPC"")=$S(Z'="""":Z,1:""UNSPECIFIED"")"
"RTN","IBCU7B",147,0)
 S DR(1,399.0404,9)="W !,""    Prov Specialty On File:  "",DIPA(""SPC"")"
"RTN","IBCU7B",148,0)
 S DR(1,399.0404,10)="S DIPA(""CRD"")=$$CRED^IBCEU($P($G(^DGCR(399,DA(2),""CP"",DA(1),""LNPRV"",DA,0)),U,2))"
"RTN","IBCU7B",149,0)
 ; 399.0404,.03 LINE CREDENTIALS
"RTN","IBCU7B",150,0)
 S DR(1,399.0404,11)=".03;K DIPA(""W1"") S:$G(DIPA(""CRD""))'=$P($G(^DGCR(399,DA(2),""CP"",DA(1),""LNPRV"",DA,0)),U,3) DIPA(""W1"")=1"
"RTN","IBCU7B",151,0)
 S DR(1,399.0404,12)="I $G(DIPA(""W1"")) D WRT1^IBCSC10H($G(DIPA(""CRD"")))"
"RTN","IBCU7B",152,0)
 ; Branch to @405 if File #399 PRIMARY NODE is non numeric.
"RTN","IBCU7B",153,0)
 S DR(1,399.0404,13)="K DIPA(""W1"") I '$G(DIPA(""I1"")) S Y=""@405"""
"RTN","IBCU7B",154,0)
 ; Branching based on DIPA("EDIT") - DIPA("EDIT") set in PROVID^IBCEP2B call
"RTN","IBCU7B",155,0)
 S DR(1,399.0404,14)="D PROVID^IBCEP2B(DA(2),DA,1,.DIPA) S Y=$S(DIPA(""EDIT"")<0:""@482"",DIPA(""EDIT"")=1:""@491"",DIPA(""EDIT"")=2:""@471"",1:"""")"
"RTN","IBCU7B",156,0)
B482 ;
"RTN","IBCU7B",157,0)
 ; Branch to @405 if File #399 SECORDARY NODE is non numeric.
"RTN","IBCU7B",158,0)
 S DR(1,399.0404,15)="@482;I '$G(DIPA(""I2"")) S Y=""@405"""
"RTN","IBCU7B",159,0)
 S DR(1,399.0404,16)="D PROVID^IBCEP2B(DA(2),DA,2,.DIPA)"
"RTN","IBCU7B",160,0)
 ; Branching based on DIPA("EDIT") - DIPA("EDIT") set in PROVID^IBCEP2B call.
"RTN","IBCU7B",161,0)
 S DR(1,399.0404,17)="S Y=$S(DIPA(""EDIT"")<0:""@483"",DIPA(""EDIT"")=1:""@492"",DIPA(""EDIT"")=2:""@472"",1:"""")"
"RTN","IBCU7B",162,0)
B483 ;
"RTN","IBCU7B",163,0)
 ; Branch to @405 if File #399 TERTIARY NODE is non numeric.
"RTN","IBCU7B",164,0)
 S DR(1,399.0404,18)="@483;I '$G(DIPA(""I3"")) S Y=""@405"""
"RTN","IBCU7B",165,0)
 S DR(1,399.0404,19)="D PROVID^IBCEP2B(DA(2),DA,3,.DIPA)"
"RTN","IBCU7B",166,0)
 ; Branching based on DIPA("EDIT") - DIPA("EDIT") set in PROVID^IBCEP2B call.
"RTN","IBCU7B",167,0)
 S DR(1,399.0404,20)="S Y=$S(DIPA(""EDIT"")<0:""@405"",DIPA(""EDIT"")=1:""@493"",DIPA(""EDIT"")=2:""@473"",1:"""");S Y=""@405"""
"RTN","IBCU7B",168,0)
B491 ;
"RTN","IBCU7B",169,0)
 ; 399.0404,.12 LINE PRIM INS PROVIDER ID TYPE.
"RTN","IBCU7B",170,0)
 ; 399.0404,.05 LINE PRIMARY INS CO ID NUMBER.
"RTN","IBCU7B",171,0)
 ; Branch to @482.
"RTN","IBCU7B",172,0)
 S DR(1,399.0404,21)="@491;.12R~T;.05T;S Y=""@482"""
"RTN","IBCU7B",173,0)
B492 ;
"RTN","IBCU7B",174,0)
 ; 399.0404,.13 LINE SEC INS PROVIDER ID TYPE.
"RTN","IBCU7B",175,0)
 ; 399.0404,.06 LINE SECONDARY INS CO ID NUMBER.
"RTN","IBCU7B",176,0)
 ; Branch to @483.
"RTN","IBCU7B",177,0)
 S DR(1,399.0404,22)="@492;.13R~T;.06T;S Y=""@483"""
"RTN","IBCU7B",178,0)
B493 ;
"RTN","IBCU7B",179,0)
 ; 399.0404,.14 LINE TERT INS PROVIDER ID TYPE.
"RTN","IBCU7B",180,0)
 ; 399.0404,.07 LINE TERTIARY INS CO ID NUMBER.
"RTN","IBCU7B",181,0)
 ; Branch to @405.
"RTN","IBCU7B",182,0)
 S DR(1,399.0404,23)="@493;.14R~T;.07T;S Y=""@405"""
"RTN","IBCU7B",183,0)
B471 ;
"RTN","IBCU7B",184,0)
 ; 399.0404,.12 LINE PRIM INS PROVIDER ID TYPE.
"RTN","IBCU7B",185,0)
 ; 399.0404,.05 LINE PRIMARY INS CO ID NUMBER.
"RTN","IBCU7B",186,0)
 ; Branch to @482.
"RTN","IBCU7B",187,0)
 S DR(1,399.0404,24)="@471;.12////^S X=DIPA(""PRIDT"");.05////^S X=DIPA(""PRID"");S Y=""@482"""
"RTN","IBCU7B",188,0)
B472 ;
"RTN","IBCU7B",189,0)
 ; 399.0404,.13 LINE SEC INS PROVIDER ID TYPE.
"RTN","IBCU7B",190,0)
 ; 399.0404,.06 LINE SECONDARY INS CO ID NUMBER.
"RTN","IBCU7B",191,0)
 ; Branch to @483.
"RTN","IBCU7B",192,0)
 S DR(1,399.0404,25)="@472;.13////^S X=DIPA(""PRIDT"");.06////^S X=DIPA(""PRID"");S Y=""@483"""
"RTN","IBCU7B",193,0)
B473 ;
"RTN","IBCU7B",194,0)
 ; 399.0404,.14 LINE TERT INS PROVIDER ID TYPE.
"RTN","IBCU7B",195,0)
 ; 399.0404,.07 LINE TERTIARY INS CO ID NUMBER.
"RTN","IBCU7B",196,0)
 ; Branch to @405.
"RTN","IBCU7B",197,0)
 S DR(1,399.0404,26)="@473;.14////^S X=DIPA(""PRIDT"");.07////^S X=DIPA(""PRID"");S Y=""@405"""
"RTN","IBCU7B",198,0)
B405 ;
"RTN","IBCU7B",199,0)
 S DR(1,399.0404,27)="@405"
"RTN","IBCU7B",200,0)
 ;
"RTN","IBCU7B",201,0)
B499 ;
"RTN","IBCU7B",202,0)
 ; End of user input @499 and W @IOF.
"RTN","IBCU7B",203,0)
 S DR(1,399.0404,28)="@499;W @IOF"
"RTN","IBCU7B",204,0)
 Q
"RTN","IBCU82")
0^7^B22371343^B21673527
"RTN","IBCU82",1,0)
IBCU82 ;ALB/ARH - THIRD PARTY BILLING UTILITIES (AUTOMATED BILLER) ;02 JUL 93
"RTN","IBCU82",2,0)
 ;;2.0;INTEGRATED BILLING;**43,55,91,124,160,304,347,432**;21-MAR-94;Build 192
"RTN","IBCU82",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCU82",4,0)
 ;
"RTN","IBCU82",5,0)
 ;
"RTN","IBCU82",6,0)
EVNTCHK(IBTRN) ;special checks to determine if event should be auto billed
"RTN","IBCU82",7,0)
 ;checks for INS, non-veteran patient, possible workers comp and tort feasor, admitted for sc cond., outp dental stop, optv while inpt, category covered by ins, non-billable stop or clinic
"RTN","IBCU82",8,0)
 ;(assumes that Claims Tracking does the SC check for Outpatients)
"RTN","IBCU82",9,0)
 ;input: IBTRN - claims tracking event
"RTN","IBCU82",10,0)
 ;       DISP - if true then any error message will be displayed on exit.
"RTN","IBCU82",11,0)
 ;output: returns "1^error message" if one of the checks failed, 0 otherwise
"RTN","IBCU82",12,0)
 ;
"RTN","IBCU82",13,0)
 N X,IBX,IBY,IBZ,IBTRND,IBCAT,IBCOV,DFN,IBEVDT,VAEL,VADMVT,VAINDT S X=0,IBTRND=$G(^IBT(356,+$G(IBTRN),0)) G:IBTRND="" EVNTCQ
"RTN","IBCU82",14,0)
 I +$P(IBTRND,U,18)=1,'+$P(IBTRND,U,5) S X="1^Claims Tracking event does not have an associated Inpatient Admission." G EVNTCQ
"RTN","IBCU82",15,0)
 I +$P(IBTRND,U,18)=2,'+$P(IBTRND,U,4) S X="1^Claims Tracking event does not have an associated Outpatient Visit." G EVNTCQ
"RTN","IBCU82",16,0)
 I +$P(IBTRND,U,18)=4,'+$P(IBTRND,U,8) S X="1^Claims Tracking event does not have an associated prescription in Pharmacy." G EVNTCQ
"RTN","IBCU82",17,0)
 I +$P(IBTRND,U,18)=4,$P(IBTRND,U,10)="" S X="1^Claims Tracking event does not have an associated prescription refill in Pharmacy." G EVNTCQ
"RTN","IBCU82",18,0)
 ;
"RTN","IBCU82",19,0)
 S DFN=+$P(IBTRND,U,2),IBEVDT=$P(IBTRND,U,6) I '$$INSURED^IBCNS1(DFN,IBEVDT) S X="1^Patient not insured for event date." G EVNTCQ
"RTN","IBCU82",20,0)
 ; Check filing timeframe
"RTN","IBCU82",21,0)
 I '$$PTFTF^IBCNSU31(DFN,IBEVDT) S X="1^Filing timeframe not met" G EVNTCQ
"RTN","IBCU82",22,0)
 S IBCAT=$S($P(IBTRND,U,18)=1!($P(IBTRND,U,18)=5):"INPATIENT",$P(IBTRND,U,18)=2:"OUTPATIENT",$P(IBTRND,U,18)=4:"PHARMACY",1:"")
"RTN","IBCU82",23,0)
 I IBCAT'="",'$$PTCOV^IBCNSU3(DFN,IBEVDT,IBCAT) S X="1^Patient insurance does not cover "_IBCAT_"." G EVNTCQ
"RTN","IBCU82",24,0)
 D ELIG^VADPT S X=0 I 'VAEL(4) S X="1^Patient is not a veteran." G EVNTCQ
"RTN","IBCU82",25,0)
 ;
"RTN","IBCU82",26,0)
 ;check the last disposition before the episode to see if maybe workers comp or tort feasor
"RTN","IBCU82",27,0)
 S IBX=9999999-(IBEVDT\1+1),IBX=$O(^DPT(+DFN,"DIS",IBX)) I +IBX S IBY=$$DT(IBX),IBX=$G(^DPT(DFN,"DIS",IBX,2)) D  G:+X EVNTCQ
"RTN","IBCU82",28,0)
 . I $P(IBX,U,1)="Y" S X="1^Need may be related to occupation, check "_IBY_" disposition." Q
"RTN","IBCU82",29,0)
 . I $P(IBX,U,4)="Y" S X="1^Need may be related to an accident, check "_IBY_" disposition." Q
"RTN","IBCU82",30,0)
 ;
"RTN","IBCU82",31,0)
 I +$P(IBTRND,U,5) S IBX=$G(^DGPM(+$P(IBTRND,U,5),0)) D  G EVNTCQ ; inpatient specific
"RTN","IBCU82",32,0)
 . I IBX="" S X="1^Inpatient admission movement not found." Q
"RTN","IBCU82",33,0)
 . I +$P(IBX,U,11) S X="1^Admitted for an SC condition." Q
"RTN","IBCU82",34,0)
 ;
"RTN","IBCU82",35,0)
 I +$P(IBTRND,U,4) S IBX=$$SCE^IBSDU(+$P(IBTRND,U,4)) D  G EVNTCQ ; outpatient specific
"RTN","IBCU82",36,0)
 . I IBX="" S X="1^Outpatient Encounter not found." Q
"RTN","IBCU82",37,0)
 . S IBY=$$NBOE^IBCU81(+$P(IBTRND,U,4),IBX) I +IBY D  Q:+X
"RTN","IBCU82",38,0)
 .. ;I +IBY=1 S X="1^Service Connected visit." Q
"RTN","IBCU82",39,0)
 .. I +IBY=2 S X="1^Non-billable Stop Code." Q
"RTN","IBCU82",40,0)
 .. I +IBY=3 S X="1^Non-billable Clinic." Q
"RTN","IBCU82",41,0)
 .. I +IBY=4 S X="1^Non-billable Status: "_$P(IBY,U,2) Q
"RTN","IBCU82",42,0)
 . ; dental is generally billed differently
"RTN","IBCU82",43,0)
 . I $P($G(^DIC(40.7,+$P(IBX,U,3),0)),U,1)["DENTAL" S X="1^Outpatient visit contains a dental stop code." Q
"RTN","IBCU82",44,0)
 . ;outpatient visit was a disposition:  application without exam is not billable
"RTN","IBCU82",45,0)
 . I $P(IBX,U,8)=3 D  Q:X
"RTN","IBCU82",46,0)
 .. S IBY=$$DISND^IBSDU(+$P(IBTRND,U,4),IBX) ; 0-node of "DIS"
"RTN","IBCU82",47,0)
 .. I $P(IBY,U,2)=2 S X="1^Disposition was Application Without Exam." Q
"RTN","IBCU82",48,0)
 .. I $P($G(^DIC(37,+$P(IBY,U,7),0)),U,1)="CANCEL WITHOUT EXAM" S X="1^Disposition was Cancel Without Exam." Q
"RTN","IBCU82",49,0)
 . ;can not bill twice for same day so ignore outpatient visits if patient was an inpatient at end of day (this means that outpatient visits on the date of discharge will be billed)
"RTN","IBCU82",50,0)
 . I $$ADM^IBCU64(DFN,IBEVDT) S X="1^Not Billable: Patient was an inpatient on this visit date."
"RTN","IBCU82",51,0)
 ;
"RTN","IBCU82",52,0)
 I +$P(IBTRND,U,8) S IBX=$$RXZERO^IBRXUTL(+$P(IBTRND,U,2),+$P(IBTRND,U,8)) D  G EVNTCQ ; rx refills
"RTN","IBCU82",53,0)
 . I IBX="" S X="1^Prescription not found in Pharmacy." Q
"RTN","IBCU82",54,0)
 . I +$P(IBTRND,U,10)>0 S IBY=$$ZEROSUB^IBRXUTL(+$P(IBTRND,U,2),+$P(IBTRND,U,8),+$P(IBTRND,U,10)) I IBY="" S X="1^Prescription refill not found in Pharmacy." Q
"RTN","IBCU82",55,0)
 . S IBZ=$$DBLCHK^IBTRKR31(IBTRN) I 'IBZ S X="1^Can not auto bill this refill, check Claims Tracking." Q
"RTN","IBCU82",56,0)
EVNTCQ Q X
"RTN","IBCU82",57,0)
 ;
"RTN","IBCU82",58,0)
DT(X) ;convert disposition type date/time to external format (9999999-date)
"RTN","IBCU82",59,0)
 N Y S Y=0 I +X S Y=9999999-X X ^DD("DD")
"RTN","IBCU82",60,0)
 Q Y
"RTN","IBCVC")
0^102^B12760924^B8498241
"RTN","IBCVC",1,0)
IBCVC ;ALB/WCJ - VALUE CODE FUNCTIONALITY ;25-JUN-07
"RTN","IBCVC",2,0)
 ;;2.0;INTEGRATED BILLING;**371,400,432**;21-MAR-94;Build 192
"RTN","IBCVC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCVC",4,0)
 G AWAY
"RTN","IBCVC",5,0)
AWAY Q
"RTN","IBCVC",6,0)
 ;
"RTN","IBCVC",7,0)
ALLOWVC(IBIFN,Y)   ; see if the value code is obsolete.
"RTN","IBCVC",8,0)
 ; returns 0 = Not Allowed/Obsolete
"RTN","IBCVC",9,0)
 ; returns 1 = Allowed
"RTN","IBCVC",10,0)
 ;
"RTN","IBCVC",11,0)
 N OBSDT,SCF
"RTN","IBCVC",12,0)
 S OBSDT=$$GET1^DIQ(399.1,Y,.26,"I")
"RTN","IBCVC",13,0)
 D CLEAN^DILF
"RTN","IBCVC",14,0)
 Q:'+OBSDT 1  ; If there is no obsolete date, were cool
"RTN","IBCVC",15,0)
 ;
"RTN","IBCVC",16,0)
 S SCF=$$GET1^DIQ(399,IBIFN,151,"I")  ; get the statement covers from date to compare with
"RTN","IBCVC",17,0)
 D CLEAN^DILF
"RTN","IBCVC",18,0)
 I 'SCF Q 0  ; if there is none, not sure where to go with this.  It's required so I say fail.
"RTN","IBCVC",19,0)
 ;
"RTN","IBCVC",20,0)
 I SCF>OBSDT Q 0
"RTN","IBCVC",21,0)
 ;
"RTN","IBCVC",22,0)
 Q 1
"RTN","IBCVC",23,0)
 ;
"RTN","IBCVC",24,0)
HELP ;
"RTN","IBCVC",25,0)
 Q:'$G(DA)
"RTN","IBCVC",26,0)
 Q:'$G(DA(1))
"RTN","IBCVC",27,0)
 Q:'$D(^DGCR(399,DA(1),"CV",DA,0))
"RTN","IBCVC",28,0)
 N VCPTR
"RTN","IBCVC",29,0)
 S VCPTR=$P($G(^DGCR(399,DA(1),"CV",DA,0)),U)
"RTN","IBCVC",30,0)
 Q:VCPTR=""
"RTN","IBCVC",31,0)
 Q:'$D(^DGCR(399.1,VCPTR,1))
"RTN","IBCVC",32,0)
 N LOOP
"RTN","IBCVC",33,0)
 S LOOP=0 F  S LOOP=$O(^DGCR(399.1,VCPTR,1,LOOP)) Q:'+LOOP  D
"RTN","IBCVC",34,0)
 . W !,$G(^(LOOP,0))
"RTN","IBCVC",35,0)
 Q
"RTN","IBCVC",36,0)
 ;
"RTN","IBCVC",37,0)
FORMCHK(X,DA) ; Check to make sure that the VALUE is in the correct format base on the VALUE CODE.
"RTN","IBCVC",38,0)
 ; This tag is the input transform for the VALUE field (Sub-File 399.047, field .02).
"RTN","IBCVC",39,0)
 ; 
"RTN","IBCVC",40,0)
 ; X = data being verified
"RTN","IBCVC",41,0)
 ; DA = subfile entry
"RTN","IBCVC",42,0)
 ; DA(1) = IEN to 399
"RTN","IBCVC",43,0)
 ; 
"RTN","IBCVC",44,0)
 ; returns
"RTN","IBCVC",45,0)
 ; 0 = invalid format
"RTN","IBCVC",46,0)
 ; 1 = valid format
"RTN","IBCVC",47,0)
 ; 
"RTN","IBCVC",48,0)
 Q:'$G(DA) 0
"RTN","IBCVC",49,0)
 Q:'$G(DA(1)) 0
"RTN","IBCVC",50,0)
 Q:'$D(^DGCR(399,DA(1),"CV",DA,0)) 0
"RTN","IBCVC",51,0)
 ;
"RTN","IBCVC",52,0)
 N VCPTR
"RTN","IBCVC",53,0)
 S VCPTR=$P($G(^DGCR(399,DA(1),"CV",DA,0)),U)
"RTN","IBCVC",54,0)
 Q:VCPTR="" 0
"RTN","IBCVC",55,0)
 ; 
"RTN","IBCVC",56,0)
 Q $$CHK(VCPTR,X)
"RTN","IBCVC",57,0)
 ;
"RTN","IBCVC",58,0)
CHK(VCPTR,X) ; This tag is called from the input transform above and also from the IB edit check routines (IBCBB*) 
"RTN","IBCVC",59,0)
 ; This function is passed in:
"RTN","IBCVC",60,0)
 ; VCPTR - pointer into file #399.1
"RTN","IBCVC",61,0)
 ; X - the VALUE being checked
"RTN","IBCVC",62,0)
 ; Returns:
"RTN","IBCVC",63,0)
 ; 0 or false - Invalid format or can't figure it out.
"RTN","IBCVC",64,0)
 ; 1 or true  - valid format (or in the case of 24, defined at the state level)
"RTN","IBCVC",65,0)
 ; 
"RTN","IBCVC",66,0)
 N CODE,OK
"RTN","IBCVC",67,0)
 S CODE=$$GET1^DIQ(399.1,VCPTR_",",.02,"I")
"RTN","IBCVC",68,0)
 D CLEAN^DILF
"RTN","IBCVC",69,0)
 Q:CODE="" 0
"RTN","IBCVC",70,0)
 ;
"RTN","IBCVC",71,0)
 N AMTFLG
"RTN","IBCVC",72,0)
 ;
"RTN","IBCVC",73,0)
 ; Check to see if it goes out as a monetary amount.
"RTN","IBCVC",74,0)
 S AMTFLG=$$GET1^DIQ(399.1,VCPTR_",",.19,"I")
"RTN","IBCVC",75,0)
 D CLEAN^DILF
"RTN","IBCVC",76,0)
 I AMTFLG Q X?1(1.7N,.7N1"."1.2N)
"RTN","IBCVC",77,0)
 ;
"RTN","IBCVC",78,0)
 ; Medicaid Rate Code (This is defined at the state level)
"RTN","IBCVC",79,0)
 Q:CODE=24 1
"RTN","IBCVC",80,0)
 ;
"RTN","IBCVC",81,0)
 ; Accident Hour
"RTN","IBCVC",82,0)
 I CODE=45 Q ".00.01.02.03.04.05.06.07.08.09.10.11.12.13.14.15.16.17.18.19.20.21.22.23.99."[("."_X_".")
"RTN","IBCVC",83,0)
 ;
"RTN","IBCVC",84,0)
 ; Whole Numbers
"RTN","IBCVC",85,0)
 I ".37.38.39.46.50.51.52.53.56.57.58.59.67.68.80.81.82."[("."_CODE_".") Q X?1.7N
"RTN","IBCVC",86,0)
 ;
"RTN","IBCVC",87,0)
 ; Zip
"RTN","IBCVC",88,0)
 I CODE="A0" Q X?5N
"RTN","IBCVC",89,0)
 ;
"RTN","IBCVC",90,0)
 I ".48.49."[("."_CODE_".") S OK=1 D  Q OK
"RTN","IBCVC",91,0)
 . I $P(X,".")'?.2N S OK=0 Q
"RTN","IBCVC",92,0)
 . I $P(X,".",2,999)'?.1N S OK=0 Q
"RTN","IBCVC",93,0)
 . I $E(X,$L(X))="." S OK=0 Q
"RTN","IBCVC",94,0)
 ;
"RTN","IBCVC",95,0)
 ; Alpha Numeric, no punctuation
"RTN","IBCVC",96,0)
 I ".60.61."[("."_CODE_".") Q X?1.7AN
"RTN","IBCVC",97,0)
 Q 1
"RTN","IBCVC",98,0)
 ;
"RTN","IBCVC",99,0)
REMOVE(DA) ; Remove the VALUE field since it's in the wrong format.
"RTN","IBCVC",100,0)
 ; This is called from a NEW STYLE X-REF "AC" in file 399.047 field .01
"RTN","IBCVC",101,0)
 N IENS,FDA
"RTN","IBCVC",102,0)
 Q:'$G(DA)!'$G(DA(1))
"RTN","IBCVC",103,0)
 S IENS=DA_","_DA(1)_","
"RTN","IBCVC",104,0)
 S FDA(399.047,IENS,.02)="@"
"RTN","IBCVC",105,0)
 D FILE^DIE(,"FDA")
"RTN","IBCVC",106,0)
 D CLEAN^DILF
"RTN","IBCVC",107,0)
 Q
"RTN","IBCVC",108,0)
 ;
"RTN","IBCVC",109,0)
COND(DA,OLDVC,NEWVC) ; Check if the VALUE is in a valid format for the new VALUE CODE.
"RTN","IBCVC",110,0)
 ; This is called from a NEW STYLE X-REF "AC" in file 399.047 field .01
"RTN","IBCVC",111,0)
 ; This function will return:
"RTN","IBCVC",112,0)
 ; 1 - Means that this VALUE should be deleted (It's in the wrong format)
"RTN","IBCVC",113,0)
 ; 0 - Means that this VALUE should NOT be deleted
"RTN","IBCVC",114,0)
 Q:'$G(OLDVC) 0
"RTN","IBCVC",115,0)
 Q:'$G(DA)!'$G(DA(1)) 0
"RTN","IBCVC",116,0)
 N OLDVALUE
"RTN","IBCVC",117,0)
 S OLDVALUE=$P($G(^DGCR(399,DA(1),"CV",DA,0)),U,2)
"RTN","IBCVC",118,0)
 Q:OLDVALUE="" 0
"RTN","IBCVC",119,0)
 Q '$$CHK(NEWVC,OLDVALUE)
"RTN","IBCVC",120,0)
 ;
"RTN","IBCVC",121,0)
 ;IB*2.0*432 - TAZ - VC1 added
"RTN","IBCVC",122,0)
VC1(IBXIEN,IBFL) ;Code for the VC1 record of the IB 837 Transmission
"RTN","IBCVC",123,0)
 ;INPUT:
"RTN","IBCVC",124,0)
 ;IBXIEN - IEN of bill/claim file
"RTN","IBCVC",125,0)
 ;IBFL - output array passed by reference
"RTN","IBCVC",126,0)
 ;
"RTN","IBCVC",127,0)
 ;OUTPUT:
"RTN","IBCVC",128,0)
 ;IBFL - array contains the list of value codes to be included in the transmission
"RTN","IBCVC",129,0)
 ;
"RTN","IBCVC",130,0)
 N IBI,IBX,Z,Z0,INST
"RTN","IBCVC",131,0)
 S INST=$$FT^IBCEF(IBXIEN)=3
"RTN","IBCVC",132,0)
 S (IBI,IBX)=0 F  S IBX=$O(^DGCR(399,IBXIEN,"CV",IBX)) Q:'IBX  D
"RTN","IBCVC",133,0)
 . S Z=$G(^(IBX,0)),Z0=$G(^DGCR(399.1,+Z,0))
"RTN","IBCVC",134,0)
 . I Z0="" Q
"RTN","IBCVC",135,0)
 . I ",A3,B3,C3,"[(","_$P(Z0,U,2)_","),INST Q
"RTN","IBCVC",136,0)
 . S IBI=IBI+1,IBFL(39,IBI)=$P(Z0,U,2)_U_$P(Z,U,2)_U_$P(Z0,U,12)_U_+Z
"RTN","IBCVC",137,0)
 I INST D
"RTN","IBCVC",138,0)
 . S CODE=$P("A3^B3^C3",U,$$COBN^IBCEF(IBXIEN))
"RTN","IBCVC",139,0)
 . S Z=$G(^DGCR(399,IBXIEN,"U1")),Z0=Z-$P(Z,U,2)
"RTN","IBCVC",140,0)
 . S IBI=IBI+1,IBFL(39,IBI)=CODE_U_Z0_U_1
"RTN","IBCVC",141,0)
 Q
"RTN","IBJPS")
0^19^B3750253^B3592314
"RTN","IBJPS",1,0)
IBJPS ;ALB/MAF,ARH - IBSP IB SITE PARAMETER SCREEN ;22-DEC-1995
"RTN","IBJPS",2,0)
 ;;2.0;INTEGRATED BILLING;**39,52,70,115,143,51,137,161,155,320,348,349,377,384,400,432**;21-MAR-94;Build 192
"RTN","IBJPS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJPS",4,0)
 ;
"RTN","IBJPS",5,0)
EN ; -- main entry point for IBJP IB SITE PARAMETERS, display IB site parameters
"RTN","IBJPS",6,0)
 D EN^VALM("IBJP IB SITE PARAMETERS")
"RTN","IBJPS",7,0)
 Q
"RTN","IBJPS",8,0)
 ;
"RTN","IBJPS",9,0)
HDR ; -- header code
"RTN","IBJPS",10,0)
 S VALMHDR(1)="Only authorized persons may edit this data."
"RTN","IBJPS",11,0)
 Q
"RTN","IBJPS",12,0)
 ;
"RTN","IBJPS",13,0)
INIT ; -- init variables and list array
"RTN","IBJPS",14,0)
 K ^TMP("IBJPS",$J),^TMP("IBJPSAX",$J)
"RTN","IBJPS",15,0)
 D BLD^IBJPS1
"RTN","IBJPS",16,0)
 Q
"RTN","IBJPS",17,0)
 ;
"RTN","IBJPS",18,0)
HELP ; -- help code
"RTN","IBJPS",19,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBJPS",20,0)
 Q
"RTN","IBJPS",21,0)
 ;
"RTN","IBJPS",22,0)
EXIT ; -- exit code
"RTN","IBJPS",23,0)
 K ^TMP("IBJPS",$J),^TMP("IBJPSAX",$J)
"RTN","IBJPS",24,0)
 D CLEAR^VALM1
"RTN","IBJPS",25,0)
 Q
"RTN","IBJPS",26,0)
 ;
"RTN","IBJPS",27,0)
NXEDIT ; -- IBJP IB SITE PARAMETER EDIT ACTION (EP): Select data set to edit, do edit
"RTN","IBJPS",28,0)
 N VALMY,IBSELN,IBSET
"RTN","IBJPS",29,0)
 D EN^VALM2($G(XQORNOD(0)))
"RTN","IBJPS",30,0)
 I $D(VALMY) S IBSELN=0 F  S IBSELN=$O(VALMY(IBSELN)) Q:'IBSELN  D
"RTN","IBJPS",31,0)
 . S IBSET=$P($G(^TMP("IBJPSAX",$J,IBSELN)),U,1) Q:'IBSET
"RTN","IBJPS",32,0)
 . D EDIT(IBSET)
"RTN","IBJPS",33,0)
 S VALMBCK="R"
"RTN","IBJPS",34,0)
 Q
"RTN","IBJPS",35,0)
 ;
"RTN","IBJPS",36,0)
EDIT(IBSET) ; edit IB Site Parameters
"RTN","IBJPS",37,0)
 D FULL^VALM1
"RTN","IBJPS",38,0)
 I IBSET'="" D:IBSET=10 EN^IBJPS3 S:IBSET'=10 DR=$P($T(@IBSET),";;",2,999)
"RTN","IBJPS",39,0)
 I $G(DR)'="" S DIE="^IBE(350.9,",DA=1 D ^DIE K DA,DR,DIE,DIC,X,Y
"RTN","IBJPS",40,0)
 D INIT^IBJPS S VALMBCK="R"
"RTN","IBJPS",41,0)
 Q
"RTN","IBJPS",42,0)
 ;
"RTN","IBJPS",43,0)
1 ;;.09;.13;.14
"RTN","IBJPS",44,0)
2 ;;1.2;.15;.11;.12;7.04
"RTN","IBJPS",45,0)
3 ;;1.09;1.07;2.07
"RTN","IBJPS",46,0)
4 ;;4.04;6.25;6.24
"RTN","IBJPS",47,0)
5 ;;.02;1.14;1.25;1.08
"RTN","IBJPS",48,0)
6 ;;1.23;1.16;1.22;1.19;1.15;1.17
"RTN","IBJPS",49,0)
7 ;;1.33;1.32;1.31;1.27;8.14T;8.15T;8.16T;8.19T
"RTN","IBJPS",50,0)
8 ;;1.29;1.3;1.18;1.28
"RTN","IBJPS",51,0)
9 ;;1.01;1.02;1.05
"RTN","IBJPS",52,0)
11 ;;2.08;2.09
"RTN","IBJPS",53,0)
12 ;;11.01;11.02;12
"RTN","IBJPS",54,0)
13 ;;10.02;10.03;10.04;10.05;D INIT^IBATFILE
"RTN","IBJPS",55,0)
14 ;;2.11;8.01;8.09;8.03;8.06;8.04;8.07;8.02;8.12T;8.11T;8.17T
"RTN","IBJPS",56,0)
15 ;;50.01;50.02;50.05;50.06;50.03;50.04;50.07
"RTN","IBJPS",57,0)
 ;
"RTN","IBJPS2")
0^20^B43690193^B39779249
"RTN","IBJPS2",1,0)
IBJPS2 ;ALB/MAF,ARH - IBSP IB SITE PARAMETER BUILD (cont) ;22-DEC-1995
"RTN","IBJPS2",2,0)
 ;;2.0;INTEGRATED BILLING;**39,52,115,143,51,137,161,155,320,348,349,377,384,400,432**;21-MAR-94;Build 192
"RTN","IBJPS2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJPS2",4,0)
 ;
"RTN","IBJPS2",5,0)
BLD2 ; - continue build screen array for IB parameters
"RTN","IBJPS2",6,0)
 ;
"RTN","IBJPS2",7,0)
 N Z,Z0,PTPSTR,BPZZ
"RTN","IBJPS2",8,0)
 D RIGHT(1,1,1) ; - facility/med center  (new line for each)
"RTN","IBJPS2",9,0)
 S IBLN=$$SET("Medical Center",$$EXSET^IBJU1($P(IBPD0,U,2),350.9,.02),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",10,0)
 S IBLN=$$SET("MAS Service",$$EXSET^IBJU1($P(IBPD1,U,14),350.9,1.14),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",11,0)
 ;
"RTN","IBJPS2",12,0)
 D LEFT(2)
"RTN","IBJPS2",13,0)
 S IBLN=$$SET("Default Division",$$EXSET^IBJU1($P(IBPD1,U,25),350.9,1.25),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",14,0)
 S IBLN=$$SET("Billing Supervisor",$$EXSET^IBJU1($P(IBPD1,U,8),350.9,1.08),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",15,0)
 ;
"RTN","IBJPS2",16,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",17,0)
 S IBLN=$$SET("Initiator Authorize",$$YN(+$P(IBPD1,U,23)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",18,0)
 S IBLN=$$SET("Ask HINQ in MCCR",$$YN(+$P(IBPD1,U,16)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",19,0)
 S IBLN=$$SET("Multiple Form Types",$$YN(+$P(IBPD1,U,22)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",20,0)
 ;
"RTN","IBJPS2",21,0)
 D LEFT(2)
"RTN","IBJPS2",22,0)
 S IBLN=$$SET("Xfer Proc to Sched",$$YN(+$P(IBPD1,U,19)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",23,0)
 S IBLN=$$SET("Use Non-PTF Codes",$$YN(+$P(IBPD1,U,15)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",24,0)
 S IBLN=$$SET("Use OP CPT screen",$$YN(+$P(IBPD1,U,17)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",25,0)
 ;
"RTN","IBJPS2",26,0)
 ; IB patch 349 for UB-04 claim form and parameters
"RTN","IBJPS2",27,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",28,0)
 S IBLN=$$SET("UB-04 Print IDs",$$EXSET^IBJU1($P(IBPD1,U,33),350.9,1.33),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",29,0)
 S IBLN=$$SET("CMS-1500 Print IDs",$$EXSET^IBJU1($P(IBPD1,U,32),350.9,1.32),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",30,0)
 S IBLN=$$SET("CMS-1500 Auto Prter",$$EXSET^IBJU1($P(IBPD8,U,14),350.9,8.14),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",31,0)
 S IBLN=$$SET("EOB Auto Prter",$$EXSET^IBJU1($P(IBPD8,U,16),350.9,8.16),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",32,0)
 ;
"RTN","IBJPS2",33,0)
 D LEFT(2)
"RTN","IBJPS2",34,0)
 S IBLN=$$SET("UB-04 Address Col",$P(IBPD1,U,31),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",35,0)
 S IBLN=$$SET("CMS-1500 Addr Col",$P(IBPD1,U,27),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",36,0)
 S IBLN=$$SET("UB-04 Auto Prter",$$EXSET^IBJU1($P(IBPD8,U,15),350.9,8.15),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",37,0)
 S IBLN=$$SET("MRA Auto Prter",$$EXSET^IBJU1($P(IBPD8,U,19),350.9,8.19),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",38,0)
 ;
"RTN","IBJPS2",39,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",40,0)
 S IBLN=$$SET("Default RX DX Cd",$$EXSET^IBJU1($P(IBPD1,U,29),350.9,1.29),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",41,0)
 S IBLN=$$SET("Default RX CPT Cd",$$EXSET^IBJU1($P(IBPD1,U,30),350.9,1.30),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",42,0)
 ;
"RTN","IBJPS2",43,0)
 D LEFT(2)
"RTN","IBJPS2",44,0)
 S IBLN=$$SET("Default ASC Rev Cd",$$EXSET^IBJU1($P(IBPD1,U,18),350.9,1.18),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",45,0)
 S IBLN=$$SET("Default RX Rev Cd",$$EXSET^IBJU1($P(IBPD1,U,28),350.9,1.28),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",46,0)
 ;
"RTN","IBJPS2",47,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",48,0)
 S IBLN=$$SET("Bill Signer Name","<No longer used>",IBLN,IBLR,IBSEL)
"RTN","IBJPS2",49,0)
 S IBLN=$$SET("Bill Signer Title","<No longer used>",IBLN,IBLR,IBSEL)
"RTN","IBJPS2",50,0)
 ;
"RTN","IBJPS2",51,0)
 D LEFT(2)
"RTN","IBJPS2",52,0)
 S IBLN=$$SET("Federal Tax #",$P(IBPD1,U,5),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",53,0)
 ;
"RTN","IBJPS2",54,0)
 D RIGHT(3,1,1) ; - Pay-To Providers - section 10
"RTN","IBJPS2",55,0)
 S (Z,Z0)=0 F  S Z=$O(^IBE(350.9,1,19,Z)) Q:'Z  S:$P($G(^IBE(350.9,1,19,Z,0)),U,5)="" Z0=Z0+1
"RTN","IBJPS2",56,0)
 S Z=+$P($G(^IBE(350.9,1,11)),U,3),PTPSTR=Z0_" defined"_$S(Z>0:", default - "_$P($$PTG^IBJPS3(Z),U),1:"")
"RTN","IBJPS2",57,0)
 S IBLN=$$SET("Pay-To Providers",PTPSTR,IBLN,IBLR,IBSEL)
"RTN","IBJPS2",58,0)
 ;
"RTN","IBJPS2",59,0)
 D RIGHT(3,1,1)
"RTN","IBJPS2",60,0)
 S IBLN=$$SET("Inpt Health Summary",$$EXSET^IBJU1($P(IBPD2,U,8),350.9,2.08),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",61,0)
 S IBLN=$$SET("Opt Health Summary",$$EXSET^IBJU1($P(IBPD2,U,9),350.9,2.09),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",62,0)
 ;
"RTN","IBJPS2",63,0)
 ; ePharmacy parameters
"RTN","IBJPS2",64,0)
 D RIGHT(7,1,1)
"RTN","IBJPS2",65,0)
 S IBLN=$$SET("HIPPA NCPDP Active Flag",$S($P(IBPD11,U)=1:"Active",1:"Not Active"),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",66,0)
 S IBLN=$$SET("Drug Non Covered Recheck Period",$P(IBPD11,U,2)_" days(s)",IBLN,IBLR,IBSEL)
"RTN","IBJPS2",67,0)
 S IBLN=$$SET("Non Covered Reject Codes","",IBLN,IBLR,IBSEL,1)
"RTN","IBJPS2",68,0)
 S BPZZ=0 F  S BPZZ=$O(IBPD12(BPZZ)) Q:+BPZZ=0  D
"RTN","IBJPS2",69,0)
 . S IBLN=$$SET(" ",$$GET1^DIQ(9002313.93,+$G(IBPD12(BPZZ)),.01,"E")_" "_$$GET1^DIQ(9002313.93,+$G(IBPD12(BPZZ)),.02,"E"),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",70,0)
 ;
"RTN","IBJPS2",71,0)
 ; transfer pricing
"RTN","IBJPS2",72,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",73,0)
 S IBLN=$$SET("Inpatient TP Active ",$$YN(+$P(IBPD10,U,2)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",74,0)
 S IBLN=$$SET("Outpatient TP Active",$$YN(+$P(IBPD10,U,3)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",75,0)
 S IBLN=$$SET("Pharmacy TP Active  ",$$YN(+$P(IBPD10,U,4)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",76,0)
 S IBLN=$$SET("Prosthetic TP Active",$$YN(+$P(IBPD10,U,5)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",77,0)
 ;
"RTN","IBJPS2",78,0)
 ; EDI/MRA parameters
"RTN","IBJPS2",79,0)
 D RIGHT(7,1,1)
"RTN","IBJPS2",80,0)
 N IBZ S IBZ=$P(IBPD8,U,3)
"RTN","IBJPS2",81,0)
 S IBLN=$$SET(" EDI/MRA Activated",$$EXSET^IBJU1(+$P(IBPD8,U,10),350.9,8.1),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",82,0)
 S IBLN=$$SET(" EDI Contact Phone",$P(IBPD2,U,11),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",83,0)
 S IBLN=$$SET(" EDI 837 Live Transmit Queue",$P(IBPD8,U),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",84,0)
 S IBLN=$$SET(" EDI 837 Test Transmit Queue",$P(IBPD8,U,9),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",85,0)
 S IBLN=$$SET(" Auto-Txmt Bill Frequency",$S(IBZ:"Every"_$S(IBZ>1:" "_$P(IBPD8,U,3),1:""),1:"")_$S(IBZ:" Day"_$S(IBZ=1:"",1:"s"),1:"Never Run"),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",86,0)
 S IBLN=$$SET(" Hours To Auto-Transmit",$P(IBPD8,U,6),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",87,0)
 S IBLN=$$SET(" Max # Bills Per Batch",$P(IBPD8,U,4),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",88,0)
 S IBLN=$$SET(" Only Allow 1 Ins Co/Claim Batch?",$$EXPAND^IBTRE(350.9,8.07,+$P(IBPD8,U,7)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",89,0)
 S IBLN=$$SET(" Last Auto-Txmt Run Date",$$DATE^IBJU1($P(IBPD8,U,5)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",90,0)
 S IBLN=$$SET(" Days To Wait To Purge Msgs",$P(IBPD8,U,2),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",91,0)
 S IBLN=$$SET(" Allow MRA Processing?",$$YN(+$P(IBPD8,U,12)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",92,0)
 S IBLN=$$SET(" Enable Automatic MRA Processing?",$$YN(+$P(IBPD8,U,11)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",93,0)
 S IBLN=$$SET(" Enable Auto Reg EOB Processing?",$$YN(+$P(IBPD8,U,17)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",94,0)
 ;
"RTN","IBJPS2",95,0)
 ; Ingenix ClaimsManager Information
"RTN","IBJPS2",96,0)
 D RIGHT(9,1,1)
"RTN","IBJPS2",97,0)
 S IBLN=$$SET("Are we using ClaimsManager?",$$YN(+$P(IBPD50,U,1)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",98,0)
 S IBLN=$$SET("Is ClaimsManager working OK?",$$YN(+$P(IBPD50,U,2)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",99,0)
 S IBLN=$$SET("ClaimsManager TCP/IP Address",$P(IBPD50,U,5),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",100,0)
 S IBCISOCK=$O(^IBE(350.9,1,50.06,"B",""))
"RTN","IBJPS2",101,0)
 S IBLN=$$SET("ClaimsManager TCP/IP Ports",IBCISOCK,IBLN,IBLR,IBSEL)
"RTN","IBJPS2",102,0)
 F  S IBCISOCK=$O(^IBE(350.9,1,50.06,"B",IBCISOCK)) Q:IBCISOCK=""  D
"RTN","IBJPS2",103,0)
 . S IBLN=$$SET("",IBCISOCK,IBLN,IBLR,IBSEL)
"RTN","IBJPS2",104,0)
 . Q
"RTN","IBJPS2",105,0)
 S IBLN=$$SET("General Error MailGroup",$$EXSET^IBJU1($P(IBPD50,U,3),350.9,50.03),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",106,0)
 S IBLN=$$SET("Communication Error MailGroup",$$EXSET^IBJU1($P(IBPD50,U,4),350.9,50.04),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",107,0)
 S IBCIMFLG=$$EXTERNAL^DILFD(350.9,50.07,"",$P(IBPD50,U,7))
"RTN","IBJPS2",108,0)
 I IBCIMFLG="" S IBCIMFLG="PRIORITY"
"RTN","IBJPS2",109,0)
 S IBLN=$$SET("MailMan Messages",IBCIMFLG,IBLN,IBLR,IBSEL)
"RTN","IBJPS2",110,0)
 ;
"RTN","IBJPS2",111,0)
 Q
"RTN","IBJPS2",112,0)
 ;
"RTN","IBJPS2",113,0)
SET(TTL,DATA,LN,LR,SEL,HDR) ;
"RTN","IBJPS2",114,0)
 N IBY,IBX,IBC S IBC=": " I TTL="" S IBC="  "
"RTN","IBJPS2",115,0)
 S IBY=TTL_$J("",(IBTW(LR)-$L(TTL)-2))_$S('$G(HDR):IBC_DATA,1:""),IBX=$G(^TMP("IBJPS",$J,LN,0))
"RTN","IBJPS2",116,0)
 S IBX=$$SETSTR^VALM1(IBY,IBX,IBTC(LR),(IBTW(LR)+IBSW(LR)))
"RTN","IBJPS2",117,0)
 D SET1(IBX,LN,SEL)
"RTN","IBJPS2",118,0)
 S LN=LN+1
"RTN","IBJPS2",119,0)
 Q LN
"RTN","IBJPS2",120,0)
 ;
"RTN","IBJPS2",121,0)
SET1(STR,LN,SEL,HI) ; set up TMP array with screen data
"RTN","IBJPS2",122,0)
 S ^TMP("IBJPS",$J,LN,0)=STR
"RTN","IBJPS2",123,0)
 S ^TMP("IBJPS",$J,"IDX",LN,SEL)=""
"RTN","IBJPS2",124,0)
 S ^TMP("IBJPSAX",$J,SEL)=SEL
"RTN","IBJPS2",125,0)
 I $G(HI)'="" D CNTRL^VALM10(LN,1,4,IOINHI,IOINORM)
"RTN","IBJPS2",126,0)
 ;I $G(RV) D CNTRL^VALM10(LN,6,19,IOUON,IOUOFF)
"RTN","IBJPS2",127,0)
 Q
"RTN","IBJPS2",128,0)
 ;
"RTN","IBJPS2",129,0)
YN(X) Q $S(+X:"YES",1:"NO")
"RTN","IBJPS2",130,0)
 ;
"RTN","IBJPS2",131,0)
RIGHT(LR,SEL,BL) ; - reset control variables for right side of screen
"RTN","IBJPS2",132,0)
 S IBLN=$S(IBLN>IBGRPE:IBLN,1:IBGRPE) I $G(BL) S IBLN=$$SET("","",IBLN,IBLR,IBSEL)
"RTN","IBJPS2",133,0)
 S IBLR=$G(LR),IBGRPB=IBLN I +$G(SEL) S IBSEL=IBSEL+1 D SET1("["_IBSEL_"]",IBLN,IBSEL,1)
"RTN","IBJPS2",134,0)
 Q
"RTN","IBJPS2",135,0)
 ;
"RTN","IBJPS2",136,0)
LEFT(LR) ; - reset control variables for left side of screen
"RTN","IBJPS2",137,0)
 S IBLR=$G(LR),IBGRPE=IBLN,IBLN=IBGRPB
"RTN","IBJPS2",138,0)
 Q
"RTN","IBJPS3")
0^16^B89166752^B89833158
"RTN","IBJPS3",1,0)
IBJPS3 ;BP/YMG - IB Site Parameters, Pay-To Provider ;20-Oct-2008
"RTN","IBJPS3",2,0)
 ;;2.0;INTEGRATED BILLING;**400,432**;21-MAR-94;Build 192
"RTN","IBJPS3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJPS3",4,0)
 ;
"RTN","IBJPS3",5,0)
EN ; -- main entry point for IBJP IB PAY-TO PROVIDERS
"RTN","IBJPS3",6,0)
 D EN^VALM("IBJP IB PAY-TO PROVIDERS")
"RTN","IBJPS3",7,0)
 Q
"RTN","IBJPS3",8,0)
 ;
"RTN","IBJPS3",9,0)
HDR ; -- header code
"RTN","IBJPS3",10,0)
 ; Not setting VALMHDR causes this tag to be called upon return from every action, 
"RTN","IBJPS3",11,0)
 ; this is done to keep VALMSG displayed at all times, instead of the default message on the lower bar.
"RTN","IBJPS3",12,0)
 S VALMSG="* = Default Pay-to provider"
"RTN","IBJPS3",13,0)
 Q
"RTN","IBJPS3",14,0)
 ;
"RTN","IBJPS3",15,0)
INIT ; -- init variables and list array
"RTN","IBJPS3",16,0)
 N IBCNT,IBLN,IBSTR,PIEN,PDATA
"RTN","IBJPS3",17,0)
 S (VALMCNT,IBCNT,IBLN)=0
"RTN","IBJPS3",18,0)
 S PIEN=0 F  S PIEN=$O(^IBE(350.9,1,19,PIEN)) Q:'PIEN  D
"RTN","IBJPS3",19,0)
 .I $P($G(^IBE(350.9,1,19,PIEN,0)),U,5)'="" Q
"RTN","IBJPS3",20,0)
 .S PDATA=$$PTG(PIEN),IBCNT=IBCNT+1
"RTN","IBJPS3",21,0)
 .S IBSTR=$$SETSTR^VALM1(IBCNT_".","",2,4)
"RTN","IBJPS3",22,0)
 .I $$ISDFLT(PIEN) S IBSTR=$$SETSTR^VALM1("*",IBSTR,7,1)
"RTN","IBJPS3",23,0)
 .S IBSTR=$$SETSTR^VALM1("Name     : "_$P(PDATA,U),IBSTR,8,45)
"RTN","IBJPS3",24,0)
 .S IBSTR=$$SETSTR^VALM1("State   : "_$P(PDATA,U,8),IBSTR,54,25)
"RTN","IBJPS3",25,0)
 .S IBLN=$$SET(IBLN,IBSTR)
"RTN","IBJPS3",26,0)
 .S IBSTR=$$SETSTR^VALM1("Address 1: "_$P(PDATA,U,5),"",8,45)
"RTN","IBJPS3",27,0)
 .S IBSTR=$$SETSTR^VALM1("Zip Code: "_$P(PDATA,U,9),IBSTR,54,25)
"RTN","IBJPS3",28,0)
 .S IBLN=$$SET(IBLN,IBSTR)
"RTN","IBJPS3",29,0)
 .S IBSTR=$$SETSTR^VALM1("Address 2: "_$P(PDATA,U,6),"",8,45)
"RTN","IBJPS3",30,0)
 .S IBSTR=$$SETSTR^VALM1("Phone   : "_$P(PDATA,U,4),IBSTR,54,25)
"RTN","IBJPS3",31,0)
 .S IBLN=$$SET(IBLN,IBSTR)
"RTN","IBJPS3",32,0)
 .S IBSTR=$$SETSTR^VALM1("City     : "_$P(PDATA,U,7),"",8,45)
"RTN","IBJPS3",33,0)
 .S IBSTR=$$SETSTR^VALM1("Tax ID  : "_$P(PDATA,U,3),IBSTR,54,25)
"RTN","IBJPS3",34,0)
 .S IBLN=$$SET(IBLN,IBSTR),IBLN=$$SET(IBLN,"")
"RTN","IBJPS3",35,0)
 .S @VALMAR@("ZIDX",IBCNT,PIEN)=""
"RTN","IBJPS3",36,0)
 .Q
"RTN","IBJPS3",37,0)
 I 'IBLN S IBLN=$$SET(IBLN,$$SETSTR^VALM1("No Pay-To Providers defined.","",13,30))
"RTN","IBJPS3",38,0)
 S VALMCNT=IBLN,VALMBG=1
"RTN","IBJPS3",39,0)
 Q
"RTN","IBJPS3",40,0)
 ;
"RTN","IBJPS3",41,0)
HELP ; -- help code
"RTN","IBJPS3",42,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBJPS3",43,0)
 Q
"RTN","IBJPS3",44,0)
 ;
"RTN","IBJPS3",45,0)
EXIT ; -- exit code
"RTN","IBJPS3",46,0)
 D CLEAR^VALM1,CLEAN^VALM10
"RTN","IBJPS3",47,0)
 Q
"RTN","IBJPS3",48,0)
 ;
"RTN","IBJPS3",49,0)
PRVADD ; add new pay-to provider
"RTN","IBJPS3",50,0)
 N X,Y,DIC,DA,DLAYGO,DIE,DR,DIR,DIRUT,DUOUT,DTOUT,IEN
"RTN","IBJPS3",51,0)
 D FULL^VALM1
"RTN","IBJPS3",52,0)
 S VALMBCK="R"
"RTN","IBJPS3",53,0)
 S DIC="^IBE(350.9,1,19,",DIC(0)="AELMQ",DA(1)=1,DIC("A")="Enter Pay-to Provider: ",DLAYGO=350.9 D ^DIC S IEN=+Y
"RTN","IBJPS3",54,0)
 I IEN'>0 Q
"RTN","IBJPS3",55,0)
 D PRVEDIT1
"RTN","IBJPS3",56,0)
 I $P($G(^IBE(350.9,1,19,IEN,0)),U,2)="" D PRVDEL1
"RTN","IBJPS3",57,0)
 Q
"RTN","IBJPS3",58,0)
 ;
"RTN","IBJPS3",59,0)
PRVDEL ; delete a pay-to provider
"RTN","IBJPS3",60,0)
 N DA,DR,DIE,X,Y,DIR,DIRUT,DUOUT,DTOUT,I,IEN,DIVS,DFLT
"RTN","IBJPS3",61,0)
 S VALMBCK="R"
"RTN","IBJPS3",62,0)
 D FULL^VALM1
"RTN","IBJPS3",63,0)
 S IEN=$$SEL Q:'IEN
"RTN","IBJPS3",64,0)
 S DFLT=$$ISDFLT(IEN)
"RTN","IBJPS3",65,0)
 I DFLT W !!,"WARNING: This is the default Pay-To Provider."
"RTN","IBJPS3",66,0)
 D GETDIVS^IBJPS4(IEN,.DIVS)
"RTN","IBJPS3",67,0)
 I 'DFLT D
"RTN","IBJPS3",68,0)
 .W !!,"The following divisions are currently associated with this Pay-To Provider: "
"RTN","IBJPS3",69,0)
 .S I="" F  S I=$O(DIVS(I)) Q:I=""  W !,?5,DIVS(I)
"RTN","IBJPS3",70,0)
 .W:'$D(DIVS) "None",! W !
"RTN","IBJPS3",71,0)
 .Q
"RTN","IBJPS3",72,0)
 S DIR("?")="Enter Yes to delete this Pay-To Provider."
"RTN","IBJPS3",73,0)
 S DIR("A")="Delete Pay-To Provider "_$P($G(^IBE(350.9,1,19,IEN,0)),U,2)
"RTN","IBJPS3",74,0)
 S DIR(0)="YO",DIR("B")="NO" D ^DIR Q:'Y
"RTN","IBJPS3",75,0)
 I DFLT S DIE="^IBE(350.9,",DA=1,DR="11.03////@" D ^DIE
"RTN","IBJPS3",76,0)
 I $D(DIVS) K DIK S DIK="^IBE(350.9,1,19,",DA(1)=1,I="" F  S I=$O(DIVS(I)) Q:I=""  S DA=I D ^DIK
"RTN","IBJPS3",77,0)
 K DIK
"RTN","IBJPS3",78,0)
PRVDEL1 ;
"RTN","IBJPS3",79,0)
 N DIK
"RTN","IBJPS3",80,0)
 K DA S DIK="^IBE(350.9,1,19,",DA(1)=1,DA=IEN D ^DIK
"RTN","IBJPS3",81,0)
 D CLEAN^VALM10,INIT
"RTN","IBJPS3",82,0)
 Q
"RTN","IBJPS3",83,0)
 ;
"RTN","IBJPS3",84,0)
PRVEDIT ; edit existing pay-to provider
"RTN","IBJPS3",85,0)
 N IEN
"RTN","IBJPS3",86,0)
 S VALMBCK="R"
"RTN","IBJPS3",87,0)
 D FULL^VALM1
"RTN","IBJPS3",88,0)
 S IEN=$$SEL Q:'IEN
"RTN","IBJPS3",89,0)
PRVEDIT1 ;
"RTN","IBJPS3",90,0)
 N DIE,DA,DR,DIR,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBJPS3",91,0)
 S DIE="^IBE(350.9,1,19,",DA=IEN,DA(1)=1
"RTN","IBJPS3",92,0)
 S DR=".02T;1.01T;1.02T;1.03T;1.04T;1.05T;.04T;.03T;.05///@"
"RTN","IBJPS3",93,0)
 D ^DIE
"RTN","IBJPS3",94,0)
 S DIR("?")="Enter Yes to make this entry the default Pay-to Provider."
"RTN","IBJPS3",95,0)
 S DIR("A")="Is this the default Pay-To Provider",DIR(0)="YO"
"RTN","IBJPS3",96,0)
 S DIR("B")="YES" I $$GETDFLT,'$$ISDFLT(IEN) S DIR("B")="NO"
"RTN","IBJPS3",97,0)
 D ^DIR I Y K DA S DIE="^IBE(350.9,",DA=1,DR="11.03////"_IEN D ^DIE
"RTN","IBJPS3",98,0)
 D CLEAN^VALM10,INIT
"RTN","IBJPS3",99,0)
 Q
"RTN","IBJPS3",100,0)
 ;
"RTN","IBJPS3",101,0)
SET(IBLN,IBSTR) ; add a line to display list
"RTN","IBJPS3",102,0)
 ; returns line number added
"RTN","IBJPS3",103,0)
 S IBLN=IBLN+1 D SET^VALM10(IBLN,IBSTR)
"RTN","IBJPS3",104,0)
 Q IBLN
"RTN","IBJPS3",105,0)
 ;
"RTN","IBJPS3",106,0)
ISDFLT(PIEN) ; returns 1 if provider with ien PIEN is the default pay-to provider, 0 otherwise
"RTN","IBJPS3",107,0)
 Q:PIEN="" 0
"RTN","IBJPS3",108,0)
 Q $$GETDFLT=PIEN
"RTN","IBJPS3",109,0)
 ;
"RTN","IBJPS3",110,0)
GETDFLT() ; returns ien of default pay-to provider
"RTN","IBJPS3",111,0)
 Q $P($G(^IBE(350.9,1,11)),U,3)
"RTN","IBJPS3",112,0)
 ;
"RTN","IBJPS3",113,0)
SEL() ; select pay-to provider
"RTN","IBJPS3",114,0)
 ; returns ien of selected pay-to provider, or 0 if nothing is selected
"RTN","IBJPS3",115,0)
 N DIR,IEN,MAX,X,Y
"RTN","IBJPS3",116,0)
 S IEN=0
"RTN","IBJPS3",117,0)
 I VALMLST>4 D
"RTN","IBJPS3",118,0)
 .; there is at least one entry
"RTN","IBJPS3",119,0)
 .S MAX=$O(@VALMAR@("ZIDX",""),-1) S:MAX=1 Y=1
"RTN","IBJPS3",120,0)
 .I MAX>1 S DIR("A")="Select Pay-To Provider (1-"_MAX_"): ",DIR(0)="NA^"_1_":"_MAX_":0" D ^DIR
"RTN","IBJPS3",121,0)
 .S:+Y>0 IEN=$O(@VALMAR@("ZIDX",Y,""))
"RTN","IBJPS3",122,0)
 .Q
"RTN","IBJPS3",123,0)
 Q +IEN
"RTN","IBJPS3",124,0)
 ;
"RTN","IBJPS3",125,0)
PRVDATA(IBIFN) ; Return a string of Pay-To provider information in the following format
"RTN","IBJPS3",126,0)
 ;  [1] name
"RTN","IBJPS3",127,0)
 ;  [2] npi
"RTN","IBJPS3",128,0)
 ;  [3] tax id#
"RTN","IBJPS3",129,0)
 ;  [4] phone#
"RTN","IBJPS3",130,0)
 ;  [5] street 1
"RTN","IBJPS3",131,0)
 ;  [6] street 2
"RTN","IBJPS3",132,0)
 ;  [7] city
"RTN","IBJPS3",133,0)
 ;  [8] state abbreviation
"RTN","IBJPS3",134,0)
 ;  [9] zip
"RTN","IBJPS3",135,0)
 ; [10] list of IB error messages if any of this data is missing in IBXX1;IBXX2;IBXX3;IBXX4; format
"RTN","IBJPS3",136,0)
 ; [11] Institution (File 4) ien
"RTN","IBJPS3",137,0)
 ;
"RTN","IBJPS3",138,0)
 ; **NOTE:  pieces 12,13,14 are added to this string in output formatter data element #1624 for PRV1-1.5 for PRV1
"RTN","IBJPS3",139,0)
 ; pieces 2,3,5.  If pieces are added here to this string, then adjust the code in PRV1-1.5,2,3,5 accordingly.
"RTN","IBJPS3",140,0)
 ;
"RTN","IBJPS3",141,0)
 N DATA,IB0,EVDT,IBDIV,INST,PIEN,IBER
"RTN","IBJPS3",142,0)
 S DATA="",IBER=""
"RTN","IBJPS3",143,0)
 ;
"RTN","IBJPS3",144,0)
 S IB0=$G(^DGCR(399,IBIFN,0))
"RTN","IBJPS3",145,0)
 S EVDT=$P(IB0,U,3)                             ; event date on claim
"RTN","IBJPS3",146,0)
 I 'EVDT S EVDT=DT
"RTN","IBJPS3",147,0)
 S IBDIV=+$P(IB0,U,22)                          ; division on claim
"RTN","IBJPS3",148,0)
 I 'IBDIV S IBDIV=$$PRIM^VASITE(EVDT)
"RTN","IBJPS3",149,0)
 I IBDIV'>0 S IBDIV=$$PRIM^VASITE()
"RTN","IBJPS3",150,0)
 I IBDIV'>0 G PRVDATX                           ; get out if no division
"RTN","IBJPS3",151,0)
 S INST=+$$SITE^VASITE(EVDT,IBDIV)              ; inst file 4 pointer
"RTN","IBJPS3",152,0)
 I INST'>0 S INST=+$$SITE^VASITE(DT,IBDIV)
"RTN","IBJPS3",153,0)
 I INST'>0 S INST=+$$SITE^VASITE()
"RTN","IBJPS3",154,0)
 I INST'>0 G PRVDATX                            ; get out if no institution
"RTN","IBJPS3",155,0)
 ;
"RTN","IBJPS3",156,0)
 ; check to see if this institution exists as a separate Pay-To Provider subfile entry
"RTN","IBJPS3",157,0)
 S PIEN=+$O(^IBE(350.9,1,19,"B",INST,""))
"RTN","IBJPS3",158,0)
 ;
"RTN","IBJPS3",159,0)
 I 'PIEN D  G PRVDATX      ; this institution does not exist in 350.9004
"RTN","IBJPS3",160,0)
 . ; check to see if the default Pay-To provider information is defined (350.9;11.03)
"RTN","IBJPS3",161,0)
 . S PIEN=+$P($G(^IBE(350.9,1,11)),U,3) Q:'PIEN
"RTN","IBJPS3",162,0)
 . S DATA=$$PTG(PIEN)
"RTN","IBJPS3",163,0)
 . Q
"RTN","IBJPS3",164,0)
 ;
"RTN","IBJPS3",165,0)
 ; here PIEN exists and the institution pointer was found in the 350.9004 subfile
"RTN","IBJPS3",166,0)
 ; find parent pay-to provider
"RTN","IBJPS3",167,0)
 S PIEN=$$GETPROV^IBJPS4(PIEN) S:PIEN DATA=$$PTG(PIEN)
"RTN","IBJPS3",168,0)
 ;
"RTN","IBJPS3",169,0)
PRVDATX ;
"RTN","IBJPS3",170,0)
 I DATA="" S IBER=IBER_"IB177;",$P(DATA,U,10)=IBER
"RTN","IBJPS3",171,0)
 Q DATA
"RTN","IBJPS3",172,0)
 ;
"RTN","IBJPS3",173,0)
PTG(PIEN) ; gather pay-to provider info
"RTN","IBJPS3",174,0)
 N N0,N1,IBORG,NPI,STIEN,STATE,Z,IBER
"RTN","IBJPS3",175,0)
 S Z="",IBER="",PIEN=+$G(PIEN)
"RTN","IBJPS3",176,0)
 ;
"RTN","IBJPS3",177,0)
 I '$D(^IBE(350.9,1,19,PIEN)) S IBER=IBER_"IB177;",$P(Z,U,10)=IBER G PTGX
"RTN","IBJPS3",178,0)
 S N0=$G(^IBE(350.9,1,19,PIEN,0))
"RTN","IBJPS3",179,0)
 S N1=$G(^IBE(350.9,1,19,PIEN,1))
"RTN","IBJPS3",180,0)
 ;
"RTN","IBJPS3",181,0)
 ; get the NPI# from the Institution file
"RTN","IBJPS3",182,0)
 S IBORG=+$P(N0,U,1),NPI=""
"RTN","IBJPS3",183,0)
 I IBORG S NPI=$P($$NPI^XUSNPI("Organization_ID",IBORG),U,1)
"RTN","IBJPS3",184,0)
 ;
"RTN","IBJPS3",185,0)
 ; get the state abbreviation
"RTN","IBJPS3",186,0)
 S STIEN=+$P(N1,U,4),STATE=""
"RTN","IBJPS3",187,0)
 I STIEN S STATE=$$GET1^DIQ(5,STIEN_",",1)
"RTN","IBJPS3",188,0)
 ;
"RTN","IBJPS3",189,0)
 ; check for missing data
"RTN","IBJPS3",190,0)
 I '$L($P(N0,U,2)) S IBER=IBER_"IB178;"     ; missing name
"RTN","IBJPS3",191,0)
 I NPI'>0 S IBER=IBER_"IB179;"              ; missing npi
"RTN","IBJPS3",192,0)
 ; Patch 432 enh5:  The IB system shall no longer prevent users from authorizing (fatal error message) a claim because the system can not find the human providers SSN or EIN
"RTN","IBJPS3",193,0)
 ;I '$L($P(N0,U,3)) S IBER=IBER_"IB180;"     ; missing tax ID
"RTN","IBJPS3",194,0)
 I '$L($P(N1,U,1))!'$L($P(N1,U,3))!'$L(STATE)!'$L($P(N1,U,5)) S IBER=IBER_"IB181;"     ; missing address part(s)
"RTN","IBJPS3",195,0)
 ;
"RTN","IBJPS3",196,0)
 S Z=$P(N0,U,2)_U_NPI_U_$P(N0,U,3)_U_$P(N0,U,4)_U_$P(N1,U,1)_U_$P(N1,U,2)_U_$P(N1,U,3)_U_STATE_U_$P(N1,U,5)_U_IBER_U_IBORG
"RTN","IBJPS3",197,0)
PTGX ;
"RTN","IBJPS3",198,0)
 Q Z
"RTN","IBJPS3",199,0)
 ;
"RTN","IBJPS3",200,0)
PRVPHONE(IBIFN) ; Return Pay-to provider phone# for a given claim
"RTN","IBJPS3",201,0)
 ; IBIFN - internal claim# (optional parameter)
"RTN","IBJPS3",202,0)
 ; If IBIFN is not passed in, then the phone# from the default pay-to provider entry will be returned.
"RTN","IBJPS3",203,0)
 ; For example, AR option 'EDI Lockbox 3rd Party Exceptions' needs the phone# for the process of transfering an
"RTN","IBJPS3",204,0)
 ; EEOB to another site, but the claim# is not available to this process.
"RTN","IBJPS3",205,0)
 N PTPP,PIEN
"RTN","IBJPS3",206,0)
 S PTPP=""
"RTN","IBJPS3",207,0)
 I +$G(IBIFN) S PTPP=$P($$PRVDATA(IBIFN),U,4) G PRVPHNX
"RTN","IBJPS3",208,0)
 ;
"RTN","IBJPS3",209,0)
 S PIEN=+$P($G(^IBE(350.9,1,11)),U,3) I 'PIEN G PRVPHNX     ; no claim#, default pay-to provider
"RTN","IBJPS3",210,0)
 S PTPP=$P($$PTG(PIEN),U,4)                                 ; phone#
"RTN","IBJPS3",211,0)
 ;
"RTN","IBJPS3",212,0)
PRVPHNX ;
"RTN","IBJPS3",213,0)
 Q PTPP
"RTN","IBJPS3",214,0)
 ;
"RTN","IBJPS3",215,0)
DEF(INST,DA) ; procedure called by new style x-ref in order to default name and address fields
"RTN","IBJPS3",216,0)
 ; INST - new VA institution ien to file 4 as the .01 field to this sub-file
"RTN","IBJPS3",217,0)
 ; DA - DA array as passed in from FileMan.  DA(1) should equal 1 since this is the IB site params
"RTN","IBJPS3",218,0)
 ;      and there is only 1 entry.  DA should equal the IEN to the pay-to provider multiple entry
"RTN","IBJPS3",219,0)
 ; This procedure is only called if a new institution is being added as the .01 field or if the value of
"RTN","IBJPS3",220,0)
 ; field is being changed from one institution to another.
"RTN","IBJPS3",221,0)
 ;
"RTN","IBJPS3",222,0)
 NEW NAD,IENS,ST,STIEN,IBTAXID
"RTN","IBJPS3",223,0)
 ;
"RTN","IBJPS3",224,0)
 I '$G(INST) G DEFX
"RTN","IBJPS3",225,0)
 ;
"RTN","IBJPS3",226,0)
 S ST=$$WHAT^XUAF4(INST,.02)             ; full state name
"RTN","IBJPS3",227,0)
 S STIEN=$$FIND1^DIC(5,,"BX",ST,"B")     ; state ien
"RTN","IBJPS3",228,0)
 ;
"RTN","IBJPS3",229,0)
 ; if the selected pay-to provider institution is the same as the main
"RTN","IBJPS3",230,0)
 ; facility name field from the IB site parameters, then also default
"RTN","IBJPS3",231,0)
 ; the federal tax ID# from the IB site parameters into the pay-to
"RTN","IBJPS3",232,0)
 ; provider tax ID# field.
"RTN","IBJPS3",233,0)
 S IBTAXID=""
"RTN","IBJPS3",234,0)
 I INST=$P($G(^IBE(350.9,1,0)),U,2) S IBTAXID=$P($G(^IBE(350.9,1,1)),U,5)
"RTN","IBJPS3",235,0)
 ;
"RTN","IBJPS3",236,0)
 S IENS=DA_",1,"
"RTN","IBJPS3",237,0)
 S NAD(350.9004,IENS,.02)=$$WHAT^XUAF4(INST,100)     ; official VA name
"RTN","IBJPS3",238,0)
 S NAD(350.9004,IENS,.03)=IBTAXID                    ; tax#
"RTN","IBJPS3",239,0)
 S NAD(350.9004,IENS,.04)=""                         ; phone# - blank it out
"RTN","IBJPS3",240,0)
 S NAD(350.9004,IENS,.05)=""                         ; parent - blank it out
"RTN","IBJPS3",241,0)
 S NAD(350.9004,IENS,1.01)=$$WHAT^XUAF4(INST,1.01)   ; address line 1
"RTN","IBJPS3",242,0)
 S NAD(350.9004,IENS,1.02)=$$WHAT^XUAF4(INST,1.02)   ; address line 2
"RTN","IBJPS3",243,0)
 S NAD(350.9004,IENS,1.03)=$$WHAT^XUAF4(INST,1.03)   ; city
"RTN","IBJPS3",244,0)
 I STIEN S NAD(350.9004,IENS,1.04)=STIEN             ; state
"RTN","IBJPS3",245,0)
 S NAD(350.9004,IENS,1.05)=$$WHAT^XUAF4(INST,1.04)   ; zip
"RTN","IBJPS3",246,0)
 D FILE^DIE(,"NAD")
"RTN","IBJPS3",247,0)
DEFX ;
"RTN","IBJPS3",248,0)
 Q
"RTN","IBJPS3",249,0)
 ;
"RTN","IBJPS3",250,0)
DIFF(IBIFN,EDI) ; This function will determine if there are any differences between
"RTN","IBJPS3",251,0)
 ; the Billing Provider name and address and the Pay-to Provider name and address.
"RTN","IBJPS3",252,0)
 ; When these two are the same, then the Pay-to Provider information is
"RTN","IBJPS3",253,0)
 ; suppressed and is not printed or transmitted.
"RTN","IBJPS3",254,0)
 ; This function returns a 1 if differences are found, and 0 if they are the same.
"RTN","IBJPS3",255,0)
 ;
"RTN","IBJPS3",256,0)
 ; EDI=1 if this is being called for the electronic claim transmission
"RTN","IBJPS3",257,0)
 ; EDI=0 if this is being called for the printed UB-04 claim form
"RTN","IBJPS3",258,0)
 ;
"RTN","IBJPS3",259,0)
 N BPZ,PTP,DIFF,BPNAME,BPAD1,BPAD2,BPCITY,BPST,BPZIP,IBZ
"RTN","IBJPS3",260,0)
 S DIFF=0,EDI=+$G(EDI)
"RTN","IBJPS3",261,0)
 S BPZ=+$$B^IBCEF79(IBIFN)            ; billing provider ien to file 4
"RTN","IBJPS3",262,0)
 S PTP=$$UP^XLFSTR($$PRVDATA(IBIFN))  ; pay-to provider information
"RTN","IBJPS3",263,0)
 ;
"RTN","IBJPS3",264,0)
 ; for EDI claims, use the GETBP utility to get the billing provider data
"RTN","IBJPS3",265,0)
 I EDI D
"RTN","IBJPS3",266,0)
 . D GETBP^IBCEF79(IBIFN,"",BPZ,"DIFF",.IBZ)
"RTN","IBJPS3",267,0)
 . S BPNAME=$$UP^XLFSTR($G(IBZ("DIFF","NAME")))
"RTN","IBJPS3",268,0)
 . S BPAD1=$$UP^XLFSTR($G(IBZ("DIFF","ADDR1")))
"RTN","IBJPS3",269,0)
 . S BPAD2=$$UP^XLFSTR($G(IBZ("DIFF","ADDR2")))
"RTN","IBJPS3",270,0)
 . S BPCITY=$$UP^XLFSTR($G(IBZ("DIFF","CITY")))
"RTN","IBJPS3",271,0)
 . S BPST=$$UP^XLFSTR($G(IBZ("DIFF","ST")))
"RTN","IBJPS3",272,0)
 . S BPZIP=$$NOPUNCT^IBCEF($$UP^XLFSTR($G(IBZ("DIFF","ZIP"))))
"RTN","IBJPS3",273,0)
 . Q
"RTN","IBJPS3",274,0)
 ;
"RTN","IBJPS3",275,0)
 ; for printed UB claims, use the Institution file for FL-1 data
"RTN","IBJPS3",276,0)
 I 'EDI D
"RTN","IBJPS3",277,0)
 . S BPNAME=$$UP^XLFSTR($$GETFAC^IBCEP8(BPZ,0,0))
"RTN","IBJPS3",278,0)
 . S BPAD1=$$UP^XLFSTR($$GETFAC^IBCEP8(BPZ,0,1))
"RTN","IBJPS3",279,0)
 . S BPAD2=$$UP^XLFSTR($$GETFAC^IBCEP8(BPZ,0,2))
"RTN","IBJPS3",280,0)
 . S BPCITY=$$UP^XLFSTR($$GETFAC^IBCEP8(BPZ,0,"3C"))
"RTN","IBJPS3",281,0)
 . S BPST=$$UP^XLFSTR($$GETFAC^IBCEP8(BPZ,0,"3S"))
"RTN","IBJPS3",282,0)
 . S BPZIP=$$NOPUNCT^IBCEF($$UP^XLFSTR($$GETFAC^IBCEP8(BPZ,0,"3Z")))
"RTN","IBJPS3",283,0)
 . Q
"RTN","IBJPS3",284,0)
 ;
"RTN","IBJPS3",285,0)
 I BPNAME'=$P(PTP,U,1) S DIFF=1 G DIFFX
"RTN","IBJPS3",286,0)
 I BPAD1'=$P(PTP,U,5) S DIFF=1 G DIFFX
"RTN","IBJPS3",287,0)
 I BPAD2'=$P(PTP,U,6) S DIFF=1 G DIFFX
"RTN","IBJPS3",288,0)
 I BPCITY'=$P(PTP,U,7) S DIFF=1 G DIFFX
"RTN","IBJPS3",289,0)
 I BPST'=$P(PTP,U,8) S DIFF=1 G DIFFX
"RTN","IBJPS3",290,0)
 I BPZIP'=$$NOPUNCT^IBCEF($P(PTP,U,9)) S DIFF=1 G DIFFX
"RTN","IBJPS3",291,0)
DIFFX ;
"RTN","IBJPS3",292,0)
 Q DIFF
"RTN","IBJPS3",293,0)
 ;
"RTN","IBJPS3",294,0)
MAINPRV() ; Return Pay-To provider information for main VAMC
"RTN","IBJPS3",295,0)
 N DATA,IBER,IEN4,PIEN
"RTN","IBJPS3",296,0)
 S (DATA,IBER)="",IEN4=+$$SITE^VASITE I 'IEN4 G MAINPRVX
"RTN","IBJPS3",297,0)
 S PIEN=$O(^IBE(350.9,1,19,"B",IEN4,"")) I 'PIEN G MAINPRVX
"RTN","IBJPS3",298,0)
 I $P($G(^IBE(350.9,1,19,PIEN,0)),U,5)'="" G MAINPRVX   ; if this sub-entry is not a pay-to provider, then get out
"RTN","IBJPS3",299,0)
 S DATA=$$PTG(PIEN)
"RTN","IBJPS3",300,0)
MAINPRVX ;
"RTN","IBJPS3",301,0)
 I DATA="" S IBER=IBER_"IB177;",$P(DATA,U,10)=IBER
"RTN","IBJPS3",302,0)
 Q DATA
"RTN","IBJPS3",303,0)
 ;
"RTN","IBJTCA1")
0^107^B52064339^B47734103
"RTN","IBJTCA1",1,0)
IBJTCA1 ;ALB/ARH - TPI CLAIMS INFO BUILD ;10/31/07  14:17
"RTN","IBJTCA1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,106,137,223,276,363,384,432**;21-MAR-94;Build 192
"RTN","IBJTCA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTCA1",4,0)
 ;
"RTN","IBJTCA1",5,0)
BLD ; build array for Third Party Joint Inquiry Claims Info screen, IBIFN must be defined
"RTN","IBJTCA1",6,0)
 ;
"RTN","IBJTCA1",7,0)
 N X,IBY,IBZ,IBZ0,IBI,IBT,IBD,IBLN,IBLR,IBD0,IBDI1,IBDM,IBDM1,IBDU,IBDS,IBDU2,IBID0,IBID13,IBNC,IBTC,IBTW,IBSW,IBGRPB,IBGRPE,IBWNR,IBDTX,IBBX19,IBPRVO,IBNABP,IBLVL,IBCNT,IBPRVTYP
"RTN","IBJTCA1",8,0)
 S VALMCNT=0,X="",IBD0=$G(^DGCR(399,+$G(IBIFN),0)) I IBD0="" S VALMQUIT="" G BLDQ
"RTN","IBJTCA1",9,0)
 F IBI="M","M1","U","S","U2","TX" S @("IBD"_IBI)=$G(^DGCR(399,+IBIFN,IBI))
"RTN","IBJTCA1",10,0)
 S IBDI1=$P(IBD0,U,21),IBDI1=$S(IBDI1="S":"I2",IBDI1="T":"I3",1:"I1") S IBDI1=$G(^DGCR(399,+IBIFN,IBDI1))
"RTN","IBJTCA1",11,0)
 S IBID0=$G(^DIC(36,+IBDI1,0)),IBID13=$G(^DIC(36,+IBDI1,.13))
"RTN","IBJTCA1",12,0)
 ;
"RTN","IBJTCA1",13,0)
 ;
"RTN","IBJTCA1",14,0)
 S (IBLN,VALMCNT)=1
"RTN","IBJTCA1",15,0)
 ;IB*2.0*432/TAZ - Added IBTW(6) and IBSW(6)
"RTN","IBJTCA1",16,0)
 S (IBNC(1),IBTC(1),IBTC(4),IBTC(6))=2,IBTC(5)=78,(IBNC(2),IBTC(2))=42,IBNC(3)=35,IBTW(1)=15,IBTW(2)=16,IBTW(4)=12,IBTW(5)=1,IBTW(6)=20,IBSW(1)=23,IBSW(2)=21,IBSW(4)=60,IBSW(5)=1,IBSW(6)=49
"RTN","IBJTCA1",17,0)
 ;
"RTN","IBJTCA1",18,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",19,0)
 ;
"RTN","IBJTCA1",20,0)
 S IBT="Insurance Demographics" S IBLN=$$SETN(IBT,IBLN,IBLR,1)
"RTN","IBJTCA1",21,0)
 S IBWNR=$$WNRBILL^IBEFUNC(IBIFN)
"RTN","IBJTCA1",22,0)
 S IBNABP=$$NABP^IBNCPDPU(IBIFN)
"RTN","IBJTCA1",23,0)
 S IBT=$S(IBWNR:" *",1:"  ")_"Bill Payer: ",IBD=$P(IBID0,U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",24,0)
 S IBT="Claim Address: " D  S IBD=$P(IBDM,U,5) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",25,0)
 . I $P(IBID0,U,1)'=$P(IBDM,U,4) S IBD=$P(IBDM,U,4) S IBLN=$$SET(IBT,IBD,IBLN,IBLR) S IBT=""
"RTN","IBJTCA1",26,0)
 I $P(IBDM,U,6)'="" S IBT="",IBD=$P(IBDM,U,6) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",27,0)
 I $P(IBDM1,U,1)'="" S IBT="",IBD=$P(IBDM1,U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",28,0)
 S IBT="",IBD=$P(IBDM,U,7),IBD=IBD_$S(IBD'="":", ",1:"")_$P($G(^DIC(5,+$P(IBDM,U,8),0)),U,2)_" "_$P(IBDM,U,9),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",29,0)
 S IBT="Claim Phone: ",IBD=$P($$BADD^IBJTU3(+IBIFN),U,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",30,0)
 ;
"RTN","IBJTCA1",31,0)
 S IBGRPE=IBLN,IBLN=IBGRPB,IBLR=2
"RTN","IBJTCA1",32,0)
 ;
"RTN","IBJTCA1",33,0)
 S IBT="Subscriber Demographics" S IBLN=$$SETN(IBT,IBLN,IBLR,1)
"RTN","IBJTCA1",34,0)
 S IBT="Group Number: ",IBD=$P(IBDI1,U,3) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",35,0)
 S IBT="Group Name: ",IBD=$P(IBDI1,U,15) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",36,0)
 S IBT="Subscriber ID: ",IBD=$P(IBDI1,U,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",37,0)
 S IBT="Employer: ",IBD=$$EMPL(+DFN) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",38,0)
 S IBT="Insured's Name: ",IBD=$P(IBDI1,U,17) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",39,0)
 S IBT="Relationship: ",IBD=$$EXSET^IBJU1($P(IBDI1,U,16),2.312,16) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",40,0)
 ;
"RTN","IBJTCA1",41,0)
 S (IBLN,VALMCNT)=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)
"RTN","IBJTCA1",42,0)
 S (IBNC(1),IBTC(1))=2,(IBNC(2),IBTC(2))=42,IBNC(3)=29,IBTW(1)=12,IBTW(2)=16,IBSW(1)=26,IBSW(2)=22
"RTN","IBJTCA1",43,0)
 S (IBT,IBD)="" S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",44,0)
 ;
"RTN","IBJTCA1",45,0)
 I $$FT^IBCEF(IBIFN)=2 D
"RTN","IBJTCA1",46,0)
 . N IBXDATA,IBXSAVE K ^TMP("IBXSAVE",$J)
"RTN","IBJTCA1",47,0)
 . D F^IBCEF("N-HCFA 1500 BOX 19",,,IBIFN)
"RTN","IBJTCA1",48,0)
 . I IBXDATA'="" S IBBX19(1)=$E(IBXDATA,1,40) S:$E(IBXDATA,41,$L(IBXDATA))'="" IBBX19(2)=$E(IBXDATA,41,$L(IBXDATA))
"RTN","IBJTCA1",49,0)
 ;
"RTN","IBJTCA1",50,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",51,0)
 S IBT="Claim Information" S IBLN=$$SETN(IBT,IBLN,3,1)
"RTN","IBJTCA1",52,0)
 S IBT="Bill Type: ",IBD=$$EXSET^IBJU1($P(IBD0,U,5),399,.05) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",53,0)
 S IBT="Time Frame: ",IBD=$$EXSET^IBJU1($P(IBD0,U,6),399,.06) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",54,0)
 S IBT="Rate Type: ",IBD=$P($G(^DGCR(399.3,+$P(IBD0,U,7),0)),U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",55,0)
 S IBT="AR Status: ",IBD=$P($$ARSTATA^IBJTU4(IBIFN),U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",56,0)
 S IBT=" Sequence: ",IBD=$P($$EXSET^IBJU1($P(IBD0,U,21),399,.21)," ",1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",57,0)
 S IBT="Purch Svc: ",IBD=$S($P(IBDU2,U,11)="":"NO",1:$$EXPAND^IBTRE(399,233,$P(IBDU2,U,11))),IBLN=$$SET(IBT,IBD,IBLN,4)
"RTN","IBJTCA1",58,0)
 I $P(IBDM1,"^",8) S IBT="  ECME No: ",IBD=$P($P(IBDM1,"^",8),";",1),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",59,0)
 I $L($P(IBDM1,"^",9)) S IBT="ECME Ap No: ",IBD=$P(IBDM1,"^",9),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",60,0)
 I IBNABP'="" S IBT=$S(($L($TR(IBNABP," ",""))=7):"  NCPDP No: ",1:"       NPI: "),IBD=IBNABP,IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",61,0)
 I IBWNR S IBT="MRA Status: ",IBD=$S($P(IBDTX,U,5):$P(IBDTX,U,5),1:"NOT RECEIVED"),IBLN=$$SET(IBT,$S(IBD:$$EXPAND^IBTRE(399,24,IBD),1:IBD),IBLN,IBLR)
"RTN","IBJTCA1",62,0)
 I $G(IBBX19(1))'="" D
"RTN","IBJTCA1",63,0)
 . S IBT="   Box 19: ",IBD=IBBX19(1),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",64,0)
 . I $G(IBBX19(2))'="" S IBT=$J("",11),IBD=IBBX19(2),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",65,0)
 ;
"RTN","IBJTCA1",66,0)
 S IBLR=6,IBPRVO=""
"RTN","IBJTCA1",67,0)
 S IBT="Providers: ",IBD="NONE"
"RTN","IBJTCA1",68,0)
 ;IB*2.0*432/TAZ - Changed how providers are displayed to take line-level providers into account.
"RTN","IBJTCA1",69,0)
 ;D F^IBCEF("N-ALL PROVIDERS","IBZ",,IBIFN)
"RTN","IBJTCA1",70,0)
 D F^IBCEF("N-ALL PROVIDERS 1","IBZ",,IBIFN)
"RTN","IBJTCA1",71,0)
 S IBZ0=0
"RTN","IBJTCA1",72,0)
 S IBLVL=0
"RTN","IBJTCA1",73,0)
 ;F  S Z=$O(IBZ(Z)) Q:'Z  D
"RTN","IBJTCA1",74,0)
 ;. I $G(IBZ(Z)),$G(IBZ(Z,1))'="" S IBLN=$$SET(IBT,"(OLD PROV DATA) "_IBZ(Z,1),IBLN,IBLR),IBZ0=1 Q
"RTN","IBJTCA1",75,0)
 ;. I $P($G(IBZ(Z,1)),U)'="" S IBD=$E($$EXPAND^IBTRE(399.0222,.01,Z)_":"_$J("",15),1,15)_$P(IBZ(Z,1),U)_$S($P(IBZ(Z,1),U,4)'="":" ("_$P(IBZ(Z,1),U,4)_")",1:"") S IBLN=$$SET(IBT,IBD,IBLN,IBLR) S IBT=$J("",11),IBZ0=1
"RTN","IBJTCA1",76,0)
 ;I 'IBZ0 S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",77,0)
 S IBLVL=0
"RTN","IBJTCA1",78,0)
 F  S IBLVL=$O(IBZ(IBLVL)) Q:'IBLVL  D
"RTN","IBJTCA1",79,0)
 . S IBT=IBT_$S(IBLVL=1:"Claim: ",1:"Line: ")
"RTN","IBJTCA1",80,0)
 . S IBPRVTYP="",IBCNT=0
"RTN","IBJTCA1",81,0)
 . F  S IBCNT=$O(IBZ(IBLVL,IBCNT)) Q:'IBCNT  D
"RTN","IBJTCA1",82,0)
 .. I IBLVL=1 S IBD=$J("",5)
"RTN","IBJTCA1",83,0)
 .. I IBLVL=2 S IBD=$E("("_IBCNT_")"_$J("",5),1,5)
"RTN","IBJTCA1",84,0)
 .. F  S IBPRVTYP=$O(IBZ(IBLVL,IBCNT,IBPRVTYP)) Q:'IBPRVTYP  D
"RTN","IBJTCA1",85,0)
 ... S IBD=IBD_$E($$EXPAND^IBTRE(399.0222,.01,IBPRVTYP)_":"_$J("",15),1,15)
"RTN","IBJTCA1",86,0)
 ... S IBD=IBD_$P(IBZ(IBLVL,IBCNT,IBPRVTYP),U)
"RTN","IBJTCA1",87,0)
 ... I $L($P(IBZ(IBLVL,IBCNT,IBPRVTYP),U,4)) S IBD=IBD_" ("_$P(IBZ(IBLVL,IBCNT,IBPRVTYP),U,4)_")"
"RTN","IBJTCA1",88,0)
 ... S IBLN=$$SET(IBT,IBD,IBLN,IBLR),IBT="",IBD=$J("",5)
"RTN","IBJTCA1",89,0)
 ;
"RTN","IBJTCA1",90,0)
 S IBGRPE=IBLN,IBLN=IBGRPB+1,IBLR=2
"RTN","IBJTCA1",91,0)
 ;
"RTN","IBJTCA1",92,0)
 S IBT="Charge Type: ",IBD=$$EXSET^IBJU1($P(IBD0,U,27),399,.27) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",93,0)
 S IBT="Service Dates: ",IBD=$$DATE^IBJU1($P(IBDU,U,1))_" - "_$$DATE^IBJU1($P(IBDU,U,2)) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",94,0)
 S IBT="Orig Claim: ",IBD=$$BILL^RCJIBFN2(+IBIFN) S IBLN=$$SET(IBT,$J($P(IBD,U,1),9,2),IBLN,IBLR)
"RTN","IBJTCA1",95,0)
 S IBT="Balance Due: ",IBD=$J($P(IBD,U,3),9,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",96,0)
 I +$P(IBDM,U,2) S IBX=$S($P(IBD0,U,21)="P":2,1:1) D  S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",97,0)
 . S IBT=$S(IBX=2:"Secondary",1:"Primary")_": ",IBD=$P($G(^DIC(36,+$P(IBDM,U,IBX),0)),U,1)
"RTN","IBJTCA1",98,0)
 . S IBX=$P(IBDU2,U,(IBX+3)) I +IBX S IBX="("_$J(IBX,0,2)_")" S IBD=$E(IBD,1,(IBSW(IBLR)-$L(IBX)-2))_"  "_IBX
"RTN","IBJTCA1",99,0)
 I +$P(IBDM,U,3) S IBX=$S($P(IBD0,U,21)="T":2,1:3) D  S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",100,0)
 . S IBT=$S(IBX=2:"Secondary",1:"Tertiary")_": ",IBD=$P($G(^DIC(36,+$P(IBDM,U,IBX),0)),U,1)
"RTN","IBJTCA1",101,0)
 . S IBX=$P(IBDU2,U,(IBX+3)) I +IBX S IBX="("_$J(IBX,0,2)_")" S IBD=$E(IBD,1,(IBSW(IBLR)-$L(IBX)-2))_"  "_IBX
"RTN","IBJTCA1",102,0)
 S IBLN=$$SET("","",IBLN,5)
"RTN","IBJTCA1",103,0)
 I IBWNR S IBT="MRA Rec Date: " D  S IBLN=$$SET(IBT,IBD,IBLN,2)
"RTN","IBJTCA1",104,0)
 . N Z
"RTN","IBJTCA1",105,0)
 . ; find last MRA for receipt date
"RTN","IBJTCA1",106,0)
 . S (IBD,Z)="" F  S Z=$O(^IBM(361.1,"B",IBIFN,Z),-1) Q:'Z  I $P($G(^IBM(361.1,Z,0)),U,4)=1 S IBD=$$DATE^IBJU1($P($P(^IBM(361.1,Z,0),U,6),".")) Q
"RTN","IBJTCA1",107,0)
 F Z=IBLN:1:IBGRPE S IBLN=$$SET("","",IBLN,5)
"RTN","IBJTCA1",108,0)
 ;
"RTN","IBJTCA1",109,0)
 S (IBLN,VALMCNT)=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)
"RTN","IBJTCA1",110,0)
 ;
"RTN","IBJTCA1",111,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",112,0)
 D CONT^IBJTCA2
"RTN","IBJTCA1",113,0)
 ;
"RTN","IBJTCA1",114,0)
COPAY I $O(^IBA(362.4,"C",IBIFN,0)) D
"RTN","IBJTCA1",115,0)
 . S IBT="Related Prescription Copay Information" S IBLN=IBLN+1,IBLN=$$SETN(IBT,IBLN,1,1)
"RTN","IBJTCA1",116,0)
 . N IBZ,IBX,IBC,IBCAP
"RTN","IBJTCA1",117,0)
 . S IBZ=0 F  S IBZ=$O(^IBA(362.4,"C",IBIFN,IBZ)) Q:'IBZ  D
"RTN","IBJTCA1",118,0)
 .. K ^TMP("IBTPJI",$J)
"RTN","IBJTCA1",119,0)
 .. S IBC=$G(^IBA(362.4,IBZ,0))
"RTN","IBJTCA1",120,0)
 .. D:$P(IBC,"^",5) RX^PSO52API($P(IBD0,"^",2),"IBTPJI",$P(IBC,"^",5),"","I^")
"RTN","IBJTCA1",121,0)
 .. ; original fill
"RTN","IBJTCA1",122,0)
 .. I $P(IBC,"^",10)=0 D
"RTN","IBJTCA1",123,0)
 ... S IBX=+$G(^TMP($J,"IBTPJI",$P(IBD0,"^",2),+$P(IBC,"^",5),106)),IBCAP=+$G(^(106.6))
"RTN","IBJTCA1",124,0)
 .. ; refills
"RTN","IBJTCA1",125,0)
 .. E  D
"RTN","IBJTCA1",126,0)
 ... S IBX=+$G(^TMP($J,"IBTPJI",$P(IBD0,"^",2),+$P(IBC,"^",5),"IB",+$P(IBC,"^",10),9)),IBCAP=+$G(^(9.1))
"RTN","IBJTCA1",127,0)
 .. I '$G(IBX),$G(IBCAP) S IBT="  <copay exceeded cap>",IBLN=$$SET(IBT,"",IBLN,4) Q
"RTN","IBJTCA1",128,0)
 .. I '$G(IBX) S IBT="  <none found>",IBLN=$$SET(IBT,"",IBLN,4) Q
"RTN","IBJTCA1",129,0)
 .. S IBX=$G(^IB(IBX,0))
"RTN","IBJTCA1",130,0)
 .. S IBT="Rx: "_$P(IBC,"^")_"  Chg: $"_$FN($P(IBX,"^",7),",",2)_"   Status: "_$$TITLE^XLFSTR($$EXTERNAL^DILFD(350,.05,"",$P(IBX,"^",5)))_"   Bill: "_$P(IBX,"^",11)
"RTN","IBJTCA1",131,0)
 .. S IBLN=$$SET(IBT,"",IBLN,4)
"RTN","IBJTCA1",132,0)
 K ^TMP("IBTPJI",$J)
"RTN","IBJTCA1",133,0)
 ;
"RTN","IBJTCA1",134,0)
 S (IBLN,VALMCNT)=IBLN-1
"RTN","IBJTCA1",135,0)
 ;
"RTN","IBJTCA1",136,0)
BLDQ Q
"RTN","IBJTCA1",137,0)
 ;
"RTN","IBJTCA1",138,0)
EMPL(DFN) ; returns employer name
"RTN","IBJTCA1",139,0)
 Q $P($G(^DPT(+DFN,.311)),U,1)
"RTN","IBJTCA1",140,0)
 ;
"RTN","IBJTCA1",141,0)
SET(TTL,DATA,LN,LR) ;
"RTN","IBJTCA1",142,0)
 N IBY
"RTN","IBJTCA1",143,0)
 S IBY=$J(TTL,IBTW(LR))_DATA D SET1(IBY,LN,IBTC(LR),(IBTW(LR)+IBSW(LR)))
"RTN","IBJTCA1",144,0)
 S LN=LN+1
"RTN","IBJTCA1",145,0)
 Q LN
"RTN","IBJTCA1",146,0)
 ;
"RTN","IBJTCA1",147,0)
SETN(TTL,LN,LR,RV) ;
"RTN","IBJTCA1",148,0)
 N IBY
"RTN","IBJTCA1",149,0)
 S IBY=" "_TTL_" " D SET1(IBY,LN,IBNC(LR),$L(IBY),$G(RV))
"RTN","IBJTCA1",150,0)
 S LN=LN+1
"RTN","IBJTCA1",151,0)
 Q LN
"RTN","IBJTCA1",152,0)
 ;
"RTN","IBJTCA1",153,0)
SET1(STR,LN,COL,WD,RV) ; set up TMP array with screen data
"RTN","IBJTCA1",154,0)
 N IBX S IBX=$G(^TMP("IBJTCA",$J,LN,0))
"RTN","IBJTCA1",155,0)
 S IBX=$$SETSTR^VALM1(STR,IBX,COL,WD)
"RTN","IBJTCA1",156,0)
 D SET^VALM10(LN,IBX) I $G(RV)'="" D CNTRL^VALM10(LN,COL,WD,IORVON,IORVOFF)
"RTN","IBJTCA1",157,0)
 Q
"RTN","IBJTTC")
0^43^B68420577^B51819511
"RTN","IBJTTC",1,0)
IBJTTC ;ALB/ARH/PJH - TPI AR COMMENT HISTORY ; 3/18/11 2:15pm
"RTN","IBJTTC",2,0)
 ;;2.0;INTEGRATED BILLING;**39,377,431,432**;21-MAR-94;Build 192
"RTN","IBJTTC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTTC",4,0)
 ;
"RTN","IBJTTC",5,0)
 ; AR Profile of Comments:  This screen prints the following Comments:
"RTN","IBJTTC",6,0)
 ;    Bill Comments (430,98)  - entered during auditing
"RTN","IBJTTC",7,0)
 ;    For each COMMENT Transaction:
"RTN","IBJTTC",8,0)
 ;           Brief Comment (433,5.02)
"RTN","IBJTTC",9,0)
 ;           Transaction Comment (433,86)
"RTN","IBJTTC",10,0)
 ;           Comment (433,41)
"RTN","IBJTTC",11,0)
 ;
"RTN","IBJTTC",12,0)
EN ; -- main entry point for IBJT AR COMMENT HISTORY
"RTN","IBJTTC",13,0)
 D EN^VALM("IBJT AR COMMENT HISTORY")
"RTN","IBJTTC",14,0)
 Q
"RTN","IBJTTC",15,0)
 ;
"RTN","IBJTTC",16,0)
HDR ; -- header code
"RTN","IBJTTC",17,0)
 D HDR^IBJTU1(+IBIFN,+DFN,13)
"RTN","IBJTTC",18,0)
 Q
"RTN","IBJTTC",19,0)
 ;
"RTN","IBJTTC",20,0)
INIT ; -- init variables and list array
"RTN","IBJTTC",21,0)
 K ^TMP("IBJTTC",$J)
"RTN","IBJTTC",22,0)
 I '$G(DFN)!'$G(IBIFN) S VALMQUIT="" G INITQ
"RTN","IBJTTC",23,0)
 D BLD
"RTN","IBJTTC",24,0)
INITQ Q
"RTN","IBJTTC",25,0)
 ;
"RTN","IBJTTC",26,0)
HELP ; -- help code
"RTN","IBJTTC",27,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBJTTC",28,0)
 Q
"RTN","IBJTTC",29,0)
 ;
"RTN","IBJTTC",30,0)
EXIT ; -- exit code
"RTN","IBJTTC",31,0)
 K ^TMP("IBJTTC",$J)
"RTN","IBJTTC",32,0)
 D CLEAR^VALM1
"RTN","IBJTTC",33,0)
 Q
"RTN","IBJTTC",34,0)
 ;
"RTN","IBJTTC",35,0)
BLD ;
"RTN","IBJTTC",36,0)
 N CMLN,CMSTR,X,IBCNT,IBZ,IB0,IBI,IBX,IBD,IBDATE,IBDUZ,IBRCT5,IBLN,IBSTR,IBK,IBJ,DIWL,DIWR,DIWF,COM
"RTN","IBJTTC",37,0)
 ; HIPAA 5010
"RTN","IBJTTC",38,0)
 N IB3611,FOUND
"RTN","IBJTTC",39,0)
 ;
"RTN","IBJTTC",40,0)
 S VALMCNT=0,IBLN=0
"RTN","IBJTTC",41,0)
 ;
"RTN","IBJTTC",42,0)
 ; Bill Comments (430,98)
"RTN","IBJTTC",43,0)
 K COM,^UTILITY($J,"W") D BCOM^RCJIBFN2(IBIFN) I $D(COM)>10 D
"RTN","IBJTTC",44,0)
 . S IBSTR="",IBD="AR BILL COMMENTS:" S IBSTR=$$SETLN(IBD,IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBJTTC",45,0)
 . S IBSTR="",IBSTR=$$SETLN("--------------------------",IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBJTTC",46,0)
 . ;
"RTN","IBJTTC",47,0)
 . S IBJ="" F  S IBJ=$O(COM(IBJ)) Q:'IBJ  S X=$G(COM(IBJ)) I X'="" S DIWL=1,DIWR=54,DIWF=""  D ^DIWP
"RTN","IBJTTC",48,0)
 . ;
"RTN","IBJTTC",49,0)
 . I $D(^UTILITY($J,"W")) S (IBK,IBCNT)=0 F  S IBK=$O(^UTILITY($J,"W",1,IBK)) Q:'IBK  D
"RTN","IBJTTC",50,0)
 .. S IBD=$G(^UTILITY($J,"W",1,IBK,0)) S IBSTR=$$SETLN(IBD,IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",51,0)
 . K ^UTILITY($J,"W")
"RTN","IBJTTC",52,0)
 ; AR profile of comment transactions  (433: 5.02, 41, 86)
"RTN","IBJTTC",53,0)
 K ^TMP("RCJIB",$J),^UTILITY($J,"W") D TRN^RCJIBFN2(IBIFN)
"RTN","IBJTTC",54,0)
 ;
"RTN","IBJTTC",55,0)
 ;HIPAA 5010 - check if contact data has been added as a comment 
"RTN","IBJTTC",56,0)
 I '$$CONTACT D
"RTN","IBJTTC",57,0)
 .;Check for payer contact data in all entries associated with the bill # (IBIFN)
"RTN","IBJTTC",58,0)
 .S (FOUND,IB3611)=0 F  S IB3611=$O(^IBM(361.1,"B",IBIFN,IB3611)) Q:'IB3611  Q:FOUND  S FOUND=$$EN^RCDPAYER(IB3611)
"RTN","IBJTTC",59,0)
 .Q:'FOUND  ; payer contact data does not exist in any of the EOB entries related to claim
"RTN","IBJTTC",60,0)
 .;Add canned text as a brief comment in file #433 which will serve as a notice that contact data came from 835 ERA
"RTN","IBJTTC",61,0)
 .D ADD^RCDPAYER(IBIFN) ;IA 5549
"RTN","IBJTTC",62,0)
 .;Rebuild AR profile of comment transactions
"RTN","IBJTTC",63,0)
 .K ^TMP("RCJIB",$J),^UTILITY($J,"W") D TRN^RCJIBFN2(IBIFN)
"RTN","IBJTTC",64,0)
 ;
"RTN","IBJTTC",65,0)
 I $D(^TMP("RCJIB",$J)) S IBI="" F  S IBI=$O(^TMP("RCJIB",$J,IBI)) Q:'IBI  D
"RTN","IBJTTC",66,0)
 . S IBX=$G(^TMP("RCJIB",$J,IBI)) I $$STNO^RCJIBFN2(+$P(IBX,U,3))'["COMMENT" Q
"RTN","IBJTTC",67,0)
 . S IBRCT5=$$N5^RCJIBFN1(IBI)
"RTN","IBJTTC",68,0)
 . S IBSTR="",IBLN=$$SET(IBSTR,IBLN)
"RTN","IBJTTC",69,0)
 . S IBD=$P(IBX,U,1) S IBSTR=$$SETLN(IBD,IBSTR,2,8)
"RTN","IBJTTC",70,0)
 . S IBD=$$DATE(+$P(IBX,U,2)) S IBSTR=$$SETLN(IBD,IBSTR,14,8)
"RTN","IBJTTC",71,0)
 . S IBD=$P(IBRCT5,U,1) S IBSTR=$$SETLN(IBD,IBSTR,25,30)
"RTN","IBJTTC",72,0)
 . S IBD="FOLLOW-UP DT: "_$$DATE(+$P(IBRCT5,U,2)) S IBSTR=$$SETLN(IBD,IBSTR,57,22)
"RTN","IBJTTC",73,0)
 . S IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",74,0)
 .;HIPAA 5010 - check if this comment is contact data
"RTN","IBJTTC",75,0)
 .I $P(IBRCT5,U)["ERA Payer Contact Information" D
"RTN","IBJTTC",76,0)
 ..N CONTACT,PHONE,FAX,EMAIL,WEB,NAME,EXT,PAYER,HAVPAYER
"RTN","IBJTTC",77,0)
 ..;Display contact data IA 5549
"RTN","IBJTTC",78,0)
 ..; primary, secondary, and tertiary contact data need to be displayed.  Display of contact data
"RTN","IBJTTC",79,0)
 ..; should only occur for each unique payer at BILL (B) x-ref of IBM(361.1,"B",IBIFN). 
"RTN","IBJTTC",80,0)
 ..; evaluation starts with the most recent entry.
"RTN","IBJTTC",81,0)
 ..; Contact data belonging to more than one payer can be distinguished by payer name
"RTN","IBJTTC",82,0)
 ..S (HAVPAYER,IB3611)=""
"RTN","IBJTTC",83,0)
 ..F  S IB3611=$O(^IBM(361.1,"B",IBIFN,IB3611),-1) Q:'IB3611  S CONTACT=$$EN^RCDPAYER(IB3611) D
"RTN","IBJTTC",84,0)
 ...Q:'CONTACT
"RTN","IBJTTC",85,0)
 ...S PAYER=$P($G(^IBM(361.1,IB3611,0)),U,2),PAYER=$$EXTERNAL^DILFD(361.1,.02,,PAYER) ;IA 4051
"RTN","IBJTTC",86,0)
 ...Q:PAYER=HAVPAYER  ; payer contact data has already been displayed
"RTN","IBJTTC",87,0)
 ...S HAVPAYER=PAYER
"RTN","IBJTTC",88,0)
 ...S FAX=$P(CONTACT,U,5),EMAIL=$P(CONTACT,U,6),WEB=$P(CONTACT,U,3)
"RTN","IBJTTC",89,0)
 ...S PHONE=$P(CONTACT,U,4),EXT=$P(CONTACT,U,7),NAME=$P(CONTACT,U,2)
"RTN","IBJTTC",90,0)
 ...S IBD="Payer Name: "_PAYER
"RTN","IBJTTC",91,0)
 ...S IBSTR=$$SETLN(IBD,IBSTR,25,78)
"RTN","IBJTTC",92,0)
 ...S IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",93,0)
 ...I NAME]"" D
"RTN","IBJTTC",94,0)
 ....S IBD="Contact Name: "_NAME
"RTN","IBJTTC",95,0)
 ....S IBSTR=$$SETLN(IBD,IBSTR,25,78)
"RTN","IBJTTC",96,0)
 ....S IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",97,0)
 ...I PHONE]"" D
"RTN","IBJTTC",98,0)
 ....S IBD="Phone Number: "_PHONE S:EXT]"" IBD=IBD_" Ext: "_EXT
"RTN","IBJTTC",99,0)
 ....S IBSTR=$$SETLN(IBD,IBSTR,25,78)
"RTN","IBJTTC",100,0)
 ....S IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",101,0)
 ...I FAX]"" D
"RTN","IBJTTC",102,0)
 ....S IBD="Facsimile Number: "_FAX
"RTN","IBJTTC",103,0)
 ....S IBSTR=$$SETLN(IBD,IBSTR,25,78)
"RTN","IBJTTC",104,0)
 ....S IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",105,0)
 ...I EMAIL]"" D
"RTN","IBJTTC",106,0)
 ....S IBD="Email Address: "_EMAIL
"RTN","IBJTTC",107,0)
 ....S IBSTR=$$SETLN(IBD,IBSTR,25,78)
"RTN","IBJTTC",108,0)
 ....S IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",109,0)
 ...I WEB]"" D
"RTN","IBJTTC",110,0)
 ....S IBD="Website Address:"_$E(WEB,1,40)
"RTN","IBJTTC",111,0)
 ....S IBSTR=$$SETLN(IBD,IBSTR,25,78)
"RTN","IBJTTC",112,0)
 ....S IBLN=$$SET(IBSTR,IBLN),IBSTR="" Q:$L(WEB)<41
"RTN","IBJTTC",113,0)
 ....S IBSTR=$$SETLN($E(WEB,41,96),IBSTR,25,78)
"RTN","IBJTTC",114,0)
 ....S IBLN=$$SET(IBSTR,IBLN),IBSTR="" Q:$L(WEB)<97
"RTN","IBJTTC",115,0)
 ....S IBSTR=$$SETLN($E(WEB,97,115),IBSTR,25,78)
"RTN","IBJTTC",116,0)
 ....S IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",117,0)
 ...S IBLN=$$SET(IBSTR,IBLN)
"RTN","IBJTTC",118,0)
 . ;
"RTN","IBJTTC",119,0)
 . ;   -- transaction comments (86)
"RTN","IBJTTC",120,0)
 . S X=$P($G(^TMP("RCJIB",$J,IBI)),U,6) I X'="" S DIWL=1,DIWR=54,DIWF=""  D ^DIWP
"RTN","IBJTTC",121,0)
 . ;
"RTN","IBJTTC",122,0)
 . ;   -- comments  (86 & 41)
"RTN","IBJTTC",123,0)
 . K COM D N7^RCJIBFN1(IBI) I $D(COM)>2 D
"RTN","IBJTTC",124,0)
 .. S IBJ="" F  S IBJ=$O(COM(IBJ)) Q:'IBJ  S X=$G(COM(IBJ)) I X'="" S DIWL=1,DIWR=54,DIWF=""  D ^DIWP
"RTN","IBJTTC",125,0)
 . ;
"RTN","IBJTTC",126,0)
 . I $D(^UTILITY($J,"W")) S (IBK,IBCNT)=0 F  S IBK=$O(^UTILITY($J,"W",1,IBK)) Q:'IBK  D
"RTN","IBJTTC",127,0)
 .. S IBD=$G(^UTILITY($J,"W",1,IBK,0)) S IBSTR=$$SETLN(IBD,IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",128,0)
 . K ^UTILITY($J,"W")
"RTN","IBJTTC",129,0)
 K ^TMP("RCJIB",$J),^UTILITY($J,"W")
"RTN","IBJTTC",130,0)
 ; MRA comments
"RTN","IBJTTC",131,0)
 ; check if we have any comments to display
"RTN","IBJTTC",132,0)
 I $D(^DGCR(399,IBIFN,"TXC","B")) D
"RTN","IBJTTC",133,0)
 .S IBLN=$$SET("",IBLN)
"RTN","IBJTTC",134,0)
 .S IBSTR="",IBSTR=$$SETLN("MRA REQUEST CLAIM COMMENTS",IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBJTTC",135,0)
 .S IBSTR="",IBSTR=$$SETLN("--------------------------",IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBJTTC",136,0)
 .; loop through all available comments
"RTN","IBJTTC",137,0)
 .S IBDATE="" F  S IBDATE=$O(^DGCR(399,IBIFN,"TXC","B",IBDATE),-1) Q:IBDATE=""  D
"RTN","IBJTTC",138,0)
 ..S IBZ=$O(^DGCR(399,IBIFN,"TXC","B",IBDATE,"")),IB0=^DGCR(399,IBIFN,"TXC",IBZ,0),IBDUZ=$P(IB0,U,2)
"RTN","IBJTTC",139,0)
 ..;S IBLN=$$SET("",IBLN)
"RTN","IBJTTC",140,0)
 ..S IBSTR=""
"RTN","IBJTTC",141,0)
 ..S IBSTR=$$SETLN($$FMTE^XLFDT(IBDATE,"2Z"),IBSTR,14,8)
"RTN","IBJTTC",142,0)
 ..S IBSTR=$$SETLN($J("Entered by "_$$GET1^DIQ(200,IBDUZ,.01),54),IBSTR,25,54)
"RTN","IBJTTC",143,0)
 ..S IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",144,0)
 ..; loop through comment lines
"RTN","IBJTTC",145,0)
 ..S CMLN=0 F  S CMLN=$O(^DGCR(399,IBIFN,"TXC",IBZ,1,CMLN)) Q:CMLN=""  D
"RTN","IBJTTC",146,0)
 ...S X=^DGCR(399,IBIFN,"TXC",IBZ,1,CMLN,0) I X'="" S DIWL=1,DIWR=54,DIWF=""  D ^DIWP
"RTN","IBJTTC",147,0)
 ...Q
"RTN","IBJTTC",148,0)
 ..I $D(^UTILITY($J,"W")) S IBK=0 F  S IBK=$O(^UTILITY($J,"W",1,IBK)) Q:'IBK  D
"RTN","IBJTTC",149,0)
 ...S CMSTR=$G(^UTILITY($J,"W",1,IBK,0)) S IBSTR=$$SETLN(CMSTR,IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",150,0)
 ...Q
"RTN","IBJTTC",151,0)
 ..K ^UTILITY($J,"W")
"RTN","IBJTTC",152,0)
 ..Q
"RTN","IBJTTC",153,0)
 .;D CLEAN^DILF
"RTN","IBJTTC",154,0)
 .Q
"RTN","IBJTTC",155,0)
 D EOBC ; IB*2.0*432
"RTN","IBJTTC",156,0)
 D CLEAN^DILF
"RTN","IBJTTC",157,0)
 ;
"RTN","IBJTTC",158,0)
 I IBLN=0 S IBLN=$$SET("",IBLN),IBLN=$$SET("No Comment Transactions Exist For This Account.",IBLN)
"RTN","IBJTTC",159,0)
 S VALMCNT=IBLN
"RTN","IBJTTC",160,0)
 Q
"RTN","IBJTTC",161,0)
 ;
"RTN","IBJTTC",162,0)
EOBC ; check for new EOB comments IB*2.0*432
"RTN","IBJTTC",163,0)
 I $D(^DGCR(399,IBIFN,"TXC2","B")) D
"RTN","IBJTTC",164,0)
 .S IBLN=$$SET("",IBLN)
"RTN","IBJTTC",165,0)
 .S IBSTR="",IBSTR=$$SETLN("COB MANAGMENT CLAIM COMMENTS",IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBJTTC",166,0)
 .S IBSTR="",IBSTR=$$SETLN("----------------------------",IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN)
"RTN","IBJTTC",167,0)
 .; loop through all available comments
"RTN","IBJTTC",168,0)
 .S IBDATE="" F  S IBDATE=$O(^DGCR(399,IBIFN,"TXC2","B",IBDATE),-1) Q:IBDATE=""  D
"RTN","IBJTTC",169,0)
 ..S IBZ=$O(^DGCR(399,IBIFN,"TXC2","B",IBDATE,"")),IB0=^DGCR(399,IBIFN,"TXC2",IBZ,0),IBDUZ=$P(IB0,U,2)
"RTN","IBJTTC",170,0)
 ..;S IBLN=$$SET("",IBLN)
"RTN","IBJTTC",171,0)
 ..S IBSTR=""
"RTN","IBJTTC",172,0)
 ..S IBSTR=$$SETLN($$FMTE^XLFDT(IBDATE,"2Z"),IBSTR,14,8)
"RTN","IBJTTC",173,0)
 ..S IBSTR=$$SETLN($J("Entered by "_$$GET1^DIQ(200,IBDUZ,.01),54),IBSTR,25,54)
"RTN","IBJTTC",174,0)
 ..S IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",175,0)
 ..; loop through comment lines
"RTN","IBJTTC",176,0)
 ..S CMLN=0 F  S CMLN=$O(^DGCR(399,IBIFN,"TXC2",IBZ,1,CMLN)) Q:CMLN=""  D
"RTN","IBJTTC",177,0)
 ...S X=^DGCR(399,IBIFN,"TXC2",IBZ,1,CMLN,0) I X'="" S DIWL=1,DIWR=54,DIWF=""  D ^DIWP
"RTN","IBJTTC",178,0)
 ...Q
"RTN","IBJTTC",179,0)
 ..I $D(^UTILITY($J,"W")) S IBK=0 F  S IBK=$O(^UTILITY($J,"W",1,IBK)) Q:'IBK  D
"RTN","IBJTTC",180,0)
 ...S CMSTR=$G(^UTILITY($J,"W",1,IBK,0)) S IBSTR=$$SETLN(CMSTR,IBSTR,25,54),IBLN=$$SET(IBSTR,IBLN),IBSTR=""
"RTN","IBJTTC",181,0)
 ...Q
"RTN","IBJTTC",182,0)
 ..K ^UTILITY($J,"W")
"RTN","IBJTTC",183,0)
 ..Q
"RTN","IBJTTC",184,0)
 .Q
"RTN","IBJTTC",185,0)
 Q
"RTN","IBJTTC",186,0)
 ;
"RTN","IBJTTC",187,0)
CONTACT() ;HIPAA 5010 check for contact data in comments
"RTN","IBJTTC",188,0)
 N FOUND,IBI
"RTN","IBJTTC",189,0)
 S FOUND=0,IBI=""
"RTN","IBJTTC",190,0)
 F  S IBI=$O(^TMP("RCJIB",$J,IBI)) Q:'IBI  D  Q:FOUND
"RTN","IBJTTC",191,0)
 .S IBX=$G(^TMP("RCJIB",$J,IBI)) Q:$$STNO^RCJIBFN2(+$P(IBX,U,3))'["COMMENT"
"RTN","IBJTTC",192,0)
 .S:$P($$N5^RCJIBFN1(IBI),U)["ERA Payer Contact Information" FOUND=1
"RTN","IBJTTC",193,0)
 Q FOUND
"RTN","IBJTTC",194,0)
 ;
"RTN","IBJTTC",195,0)
DATE(X) ; date in external format
"RTN","IBJTTC",196,0)
 N Y S Y="" I +X S Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBJTTC",197,0)
 Q Y
"RTN","IBJTTC",198,0)
 ;
"RTN","IBJTTC",199,0)
SETLN(STR,IBX,COL,WD) ;
"RTN","IBJTTC",200,0)
 S IBX=$$SETSTR^VALM1(STR,IBX,COL,WD)
"RTN","IBJTTC",201,0)
 Q IBX
"RTN","IBJTTC",202,0)
 ;
"RTN","IBJTTC",203,0)
SET(STR,LN) ; set up TMP array with screen data
"RTN","IBJTTC",204,0)
 S LN=LN+1 D SET^VALM10(LN,STR)
"RTN","IBJTTC",205,0)
SETQ Q LN
"RTN","IBY432PO")
0^66^B24652883^n/a
"RTN","IBY432PO",1,0)
IBY432PO ;ALB/GEF - Post-Installation for IB patch 432 ;3-Oct-2010
"RTN","IBY432PO",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBY432PO",3,0)
 ;
"RTN","IBY432PO",4,0)
 ; check the names in file 355.1 to get ready for IB*2.0*447
"RTN","IBY432PO",5,0)
 D NMCK
"RTN","IBY432PO",6,0)
 ; do post-init from Patch 418 which was merged into our patch
"RTN","IBY432PO",7,0)
 D PO418
"RTN","IBY432PO",8,0)
 D RIT
"RTN","IBY432PO",9,0)
 D ADDUSR
"RTN","IBY432PO",10,0)
 D VC
"RTN","IBY432PO",11,0)
 D TURNITON
"RTN","IBY432PO",12,0)
 D INSFLAG
"RTN","IBY432PO",13,0)
 D KILLPEB
"RTN","IBY432PO",14,0)
 Q
"RTN","IBY432PO",15,0)
 ;
"RTN","IBY432PO",16,0)
RIT ; recompile billing screen templates
"RTN","IBY432PO",17,0)
 N X,Y,DMAX,IBN
"RTN","IBY432PO",18,0)
 D MES^XPDUTL("Recompiling Input Templates for Billing Screens ...")
"RTN","IBY432PO",19,0)
 F IBN=1:1:5,"10","102","10H" D
"RTN","IBY432PO",20,0)
 .S X="IBXS"_$S(IBN=10:"A",IBN="102":"A2",IBN="10H":"AH",1:IBN)
"RTN","IBY432PO",21,0)
 .S Y=$$FIND1^DIC(.402,,"X","IB SCREEN"_IBN,"B")
"RTN","IBY432PO",22,0)
 .S DMAX=$$ROUSIZE^DILF
"RTN","IBY432PO",23,0)
 .I Y D EN^DIEZ
"RTN","IBY432PO",24,0)
 D MES^XPDUTL(" Done.")
"RTN","IBY432PO",25,0)
 Q
"RTN","IBY432PO",26,0)
 ;
"RTN","IBY432PO",27,0)
ADDUSR ;IA#4677;This will add user if it's not there
"RTN","IBY432PO",28,0)
 N IEN200
"RTN","IBY432PO",29,0)
 S IEN200=$$CREATE^XUSAP("AUTHORIZER,IB REG","")
"RTN","IBY432PO",30,0)
 Q:+IEN200=0  ; already exists
"RTN","IBY432PO",31,0)
 Q:+IEN200>0   ; added the user successfully
"RTN","IBY432PO",32,0)
 I IEN200<0 Q  ; problem adding the new user.  May want to let someone know.
"RTN","IBY432PO",33,0)
 Q
"RTN","IBY432PO",34,0)
 ;
"RTN","IBY432PO",35,0)
PO418 ; post-init for Patch 418
"RTN","IBY432PO",36,0)
 Q:$$INSTALDT^XPDUTL("IB*2.0*432")>1   ;DBIA#10141
"RTN","IBY432PO",37,0)
 N U S U="^"
"RTN","IBY432PO",38,0)
 D TAXADD
"RTN","IBY432PO",39,0)
 Q
"RTN","IBY432PO",40,0)
 ;
"RTN","IBY432PO",41,0)
TAXADD ;Taxonomy code IEN in subfile 399.0222 (field .15/piece 15) if no exist
"RTN","IBY432PO",42,0)
 ;IBSTUS - the bill status=1 (entered/not reviewed)
"RTN","IBY432PO",43,0)
 ;IBEVDT - the outpatient event date or (inpatient admission date)
"RTN","IBY432PO",44,0)
 ;IBPRV - IEN in new person file 200
"RTN","IBY432PO",45,0)
 ;
"RTN","IBY432PO",46,0)
 N DA,DA2,NUM,REC,REC2,IBSTUS,IBILL,IBTAX,IBEVDT,IBPRV
"RTN","IBY432PO",47,0)
 S DA=0,NUM=0
"RTN","IBY432PO",48,0)
 D MES^XPDUTL("Adding Taxonomy code IEN to file (#399)....")
"RTN","IBY432PO",49,0)
 F  S DA=$O(^DGCR(399,DA)) Q:'DA  D
"RTN","IBY432PO",50,0)
 . S REC=$G(^DGCR(399,DA,0)),IBSTUS=$P(REC,U,13)
"RTN","IBY432PO",51,0)
 . Q:IBSTUS'=1
"RTN","IBY432PO",52,0)
 . S DA2=0,IBILL=$P(REC,U),IBEVDT=$P(REC,U,3)
"RTN","IBY432PO",53,0)
 . F  S DA2=$O(^DGCR(399,DA,"PRV",DA2)) Q:'DA2  D
"RTN","IBY432PO",54,0)
 .. S REC2=$G(^DGCR(399,DA,"PRV",DA2,0))
"RTN","IBY432PO",55,0)
 .. S IBPRV=$P(REC2,U,2),IBTAX=$P(REC2,U,15)
"RTN","IBY432PO",56,0)
 .. Q:IBTAX'=""!($P(IBPRV,";",2)'="VA(200,")
"RTN","IBY432PO",57,0)
 .. S IBTAX=$P($$GET^XUA4A72(+IBPRV,IBEVDT),U,1)
"RTN","IBY432PO",58,0)
 .. Q:IBTAX'>0
"RTN","IBY432PO",59,0)
 .. S $P(^DGCR(399,DA,"PRV",DA2,0),U,15)=IBTAX
"RTN","IBY432PO",60,0)
 .. S IBPRV=$P($G(^VA(200,+IBPRV,0)),U)
"RTN","IBY432PO",61,0)
 .. D MES^XPDUTL(" Taxonomy code IEN "_IBTAX_" for provider "_IBPRV_" added to bill# "_IBILL)
"RTN","IBY432PO",62,0)
 .. S NUM=NUM+1
"RTN","IBY432PO",63,0)
 D MES^XPDUTL("Total "_NUM_$S(NUM=1:" bill has",1:" bills have")_" been updated")
"RTN","IBY432PO",64,0)
 D MES^XPDUTL("")
"RTN","IBY432PO",65,0)
 Q
"RTN","IBY432PO",66,0)
 ;
"RTN","IBY432PO",67,0)
VC ;Mark Value Codes A3, B3, and C3 obsolete so that the user will not be able to enter them on the billing screens
"RTN","IBY432PO",68,0)
 D BMES^XPDUTL("Marking Value Codes A3, B3, and C3 obsolete... ")
"RTN","IBY432PO",69,0)
 N DA,DIE,DR,TODAY,X,Y,VC
"RTN","IBY432PO",70,0)
 S TODAY=$G(DT) I TODAY="" D NOW^%DTC S TODAY=X
"RTN","IBY432PO",71,0)
 S DR=".26////"_TODAY
"RTN","IBY432PO",72,0)
 S DIE=399.1
"RTN","IBY432PO",73,0)
 F VC="A3","B3","C3" D
"RTN","IBY432PO",74,0)
 . S DA=""
"RTN","IBY432PO",75,0)
 . F  S DA=$O(^DGCR(399.1,"C",VC,DA)) Q:'DA  D
"RTN","IBY432PO",76,0)
 .. I '$$GET1^DIQ(399.1,DA,.18,"I") Q  ;Not a value code
"RTN","IBY432PO",77,0)
 .. I $$GET1^DIQ(399.1,DA,.26,"I") Q   ;Already marked Obsolete
"RTN","IBY432PO",78,0)
 .. D MES^XPDUTL(" IEN - "_DA)
"RTN","IBY432PO",79,0)
 .. D ^DIE
"RTN","IBY432PO",80,0)
 D MES^XPDUTL(" Done.")
"RTN","IBY432PO",81,0)
 D MES^XPDUTL("")
"RTN","IBY432PO",82,0)
 Q
"RTN","IBY432PO",83,0)
 ;
"RTN","IBY432PO",84,0)
TURNITON ;
"RTN","IBY432PO",85,0)
 N DIE,DA,DR,DIC,D0
"RTN","IBY432PO",86,0)
 S DIE=350.9,DA=1,DR="8.17///YES" D ^DIE
"RTN","IBY432PO",87,0)
 Q
"RTN","IBY432PO",88,0)
 ;
"RTN","IBY432PO",89,0)
INSFLAG ; Set new field to YES
"RTN","IBY432PO",90,0)
 N INSCO
"RTN","IBY432PO",91,0)
 S INSCO=0 F  S INSCO=$O(^DIC(36,INSCO)) Q:'+INSCO  D
"RTN","IBY432PO",92,0)
 . Q:($$GET1^DIQ(36,INSCO,6.1))]""    ; don't set if a value is already there
"RTN","IBY432PO",93,0)
 . N X,Y,DA,DIE,DR
"RTN","IBY432PO",94,0)
 . S DA=INSCO
"RTN","IBY432PO",95,0)
 . S DIE=36
"RTN","IBY432PO",96,0)
 . S DR="6.1///YES"
"RTN","IBY432PO",97,0)
 . D ^DIE
"RTN","IBY432PO",98,0)
 Q 
"RTN","IBY432PO",99,0)
 ;
"RTN","IBY432PO",100,0)
NMCK ; Check to make sure that names in file 355.1 have not been edited at site.
"RTN","IBY432PO",101,0)
 ; this is in preparation for IB*2.0*447 (TCR15) which will be updating some entries in that file.
"RTN","IBY432PO",102,0)
 Q:$$INSTALDT^XPDUTL("IB*2.0*432")>1   ;DBIA#10141
"RTN","IBY432PO",103,0)
 N DATA,IEN,ERR,LN
"RTN","IBY432PO",104,0)
 F LN=2:1:12 D
"RTN","IBY432PO",105,0)
 .S DATA=$P($T(NM3551+LN),";;",2) Q:DATA=""
"RTN","IBY432PO",106,0)
 .S IEN=$O(^IBE(355.1,"B",$P(DATA,U,2),""))
"RTN","IBY432PO",107,0)
 .S:IEN="" ERR(LN)="     "_$P(DATA,U,2)
"RTN","IBY432PO",108,0)
 D:$D(ERR) BULL(.ERR)
"RTN","IBY432PO",109,0)
 Q
"RTN","IBY432PO",110,0)
 ;
"RTN","IBY432PO",111,0)
BULL(ERR) ; send mail bulletin if there was a problem with file 355.1
"RTN","IBY432PO",112,0)
 ;
"RTN","IBY432PO",113,0)
 N DIFROM,XMDUZ,XMTEXT,XMY,XMSUB,L,SITE,IBTXT,I
"RTN","IBY432PO",114,0)
 S SITE=$P($$SITE^VASITE,U,2)
"RTN","IBY432PO",115,0)
 S XMSUB="Problem w/ TYPE OF PLAN (file #355.1) at "_SITE
"RTN","IBY432PO",116,0)
 S XMDUZ=.5,XMTEXT="IBTXT("
"RTN","IBY432PO",117,0)
 K XMY S XMY("GRACE.FIAMENGO@VA.GOV")=""
"RTN","IBY432PO",118,0)
 S IBTXT(1)="During the pre-install check for IB*2.0*447 there was a problem with one or"
"RTN","IBY432PO",119,0)
 S IBTXT(2)="more names in the TYPE OF PLAN file (#355.1) at:  "_SITE
"RTN","IBY432PO",120,0)
 S IBTXT(3)=""
"RTN","IBY432PO",121,0)
 S IBTXT(4)="The Name Check in IBY432PO did not find an exact match for the following:  "
"RTN","IBY432PO",122,0)
 S L=5 F I=2:1:12 I $D(ERR(I)) S L=L+1,IBTXT(L)=ERR(I)
"RTN","IBY432PO",123,0)
 D ^XMD
"RTN","IBY432PO",124,0)
 Q
"RTN","IBY432PO",125,0)
 ;
"RTN","IBY432PO",126,0)
NM3551   ; entries in file 355.1 to be checked
"RTN","IBY432PO",127,0)
 ;
"RTN","IBY432PO",128,0)
 ;;^CARVE-OUT^
"RTN","IBY432PO",129,0)
 ;;^COMPREHENSIVE MAJOR MEDICAL^
"RTN","IBY432PO",130,0)
 ;;^MEDICAL EXPENSE (OPT/PROF)^
"RTN","IBY432PO",131,0)
 ;;^MEDICARE SECONDARY^
"RTN","IBY432PO",132,0)
 ;;^MEDIGAP (SUPPLEMENTAL)^
"RTN","IBY432PO",133,0)
 ;;^MEDIGAP (SUPPL - COINS, DED, PART B EXC)^
"RTN","IBY432PO",134,0)
 ;;^MENTAL HEALTH^
"RTN","IBY432PO",135,0)
 ;;^POINT OF SERVICE^
"RTN","IBY432PO",136,0)
 ;;^PREFERRED PROVIDER ORGANIZATION (PPO)^
"RTN","IBY432PO",137,0)
 ;;^RETIREE^
"RTN","IBY432PO",138,0)
 ;;^SURGICAL EXPENSE INSURANCE^
"RTN","IBY432PO",139,0)
 ;
"RTN","IBY432PO",140,0)
 Q
"RTN","IBY432PO",141,0)
 ;
"RTN","IBY432PO",142,0)
KILLPEB ; Designed to remove the "Print EOB" option from the "IBCE 837 EDI REPORTS" menu.
"RTN","IBY432PO",143,0)
 N MENUIEN,ITEMIEN,DIK,DA
"RTN","IBY432PO",144,0)
 S MENUIEN=$O(^DIC(19,"B","IBCE 837 EDI REPORTS",0)) Q:MENUIEN=""
"RTN","IBY432PO",145,0)
 S ITEMIEN=$O(^DIC(19,MENUIEN,10,"C","PEB",0)) Q:ITEMIEN=""
"RTN","IBY432PO",146,0)
 S DIK="^DIC(19,"_MENUIEN_",10,"
"RTN","IBY432PO",147,0)
 S DA=ITEMIEN,DA(1)=MENUIEN
"RTN","IBY432PO",148,0)
 D ^DIK
"RTN","IBY432PO",149,0)
 Q
"RTN","IBY432PR")
0^40^B209623389^n/a
"RTN","IBY432PR",1,0)
IBY432PR ;ALB/WCJ - Pre-Installation for IB patch 432 ;3-Oct-2010
"RTN","IBY432PR",2,0)
 ;;2.0;INTEGRATED BILLING;**432**;21-MAR-94;Build 192
"RTN","IBY432PR",3,0)
 ;
"RTN","IBY432PR",4,0)
 ; delete all output formatter (O.F.) data elements included in build
"RTN","IBY432PR",5,0)
 D DELOF,DELFLD,RIT
"RTN","IBY432PR",6,0)
 Q
"RTN","IBY432PR",7,0)
DELFLD  ; removed fields marked for deletion May 2007 #'s 450,451,452,& 456
"RTN","IBY432PR",8,0)
 N DA,DIK
"RTN","IBY432PR",9,0)
 S DIK="^DD(399,",DA(1)=399 F DA=450,451,452,456 D ^DIK
"RTN","IBY432PR",10,0)
 Q
"RTN","IBY432PR",11,0)
RIT ; recompile billing screen templates
"RTN","IBY432PR",12,0)
 N X,Y,DMAX,IBN
"RTN","IBY432PR",13,0)
 D MES^XPDUTL("Recompiling Input Templates for Billing Screens ...")
"RTN","IBY432PR",14,0)
 F IBN=1:1:8,"10","102","10H" D
"RTN","IBY432PR",15,0)
 .S X="IBXS"_$S(IBN=10:"A",IBN="102":"A2",IBN="10H":"AH",1:IBN),Y=$$FIND1^DIC(.402,,"X","IB SCREEN"_IBN,"B"),DMAX=$$ROUSIZE^DILF
"RTN","IBY432PR",16,0)
 .I Y D EN^DIEZ
"RTN","IBY432PR",17,0)
 D MES^XPDUTL(" Done.")
"RTN","IBY432PR",18,0)
 Q
"RTN","IBY432PR",19,0)
INCLUDE(FILE,Y) ; function to determine if O.F. entry should be included in the build
"RTN","IBY432PR",20,0)
 ; FILE=5,6,7 indicating file 364.x
"RTN","IBY432PR",21,0)
 ; Y=ien to file
"RTN","IBY432PR",22,0)
 NEW OK,LN,TAG,DATA
"RTN","IBY432PR",23,0)
 S OK=0
"RTN","IBY432PR",24,0)
 F LN=2:1 S TAG="ENT"_FILE_"+"_LN,DATA=$P($T(@TAG),";;",2) Q:DATA=""  I $F(DATA,U_Y_U) S OK=1 Q
"RTN","IBY432PR",25,0)
 Q OK
"RTN","IBY432PR",26,0)
DELOF   ; Delete included OF entries
"RTN","IBY432PR",27,0)
 NEW FILE,DIK,LN,TAG,DATA,PCE,DA,Y
"RTN","IBY432PR",28,0)
 F FILE=5,6,7 S DIK="^IBA(364."_FILE_"," F LN=2:1 S TAG="ENT"_FILE_"+"_LN,DATA=$P($T(@TAG),";;",2) Q:DATA=""  D
"RTN","IBY432PR",29,0)
 .F PCE=2:1 S DA=$P(DATA,U,PCE) Q:'DA  I $D(^IBA("364."_FILE,DA,0)) D ^DIK
"RTN","IBY432PR",30,0)
 .Q
"RTN","IBY432PR",31,0)
 ; Also delete entries which are not going to be re-added later.  These are non-functioning entries in file 364.6.
"RTN","IBY432PR",32,0)
 S DIK="^IBA(364.6,"
"RTN","IBY432PR",33,0)
 F LN=2:1 S TAG="DEL6"_"+"_LN,DATA=$P($T(@TAG),";;",2) Q:DATA=""  D
"RTN","IBY432PR",34,0)
 .F PCE=2:1 S DA=$P(DATA,U,PCE) Q:'DA  I $D(^IBA("364.6",DA,0)) D ^DIK
"RTN","IBY432PR",35,0)
 ; Also delete entries not to be re-added later.  non-functioning entries in file 364.7.
"RTN","IBY432PR",36,0)
 S DIK="^IBA(364.7,"
"RTN","IBY432PR",37,0)
 F LN=2:1 S TAG="DEL7"_"+"_LN,DATA=$P($T(@TAG),";;",2) Q:DATA=""  D
"RTN","IBY432PR",38,0)
 .F PCE=2:1 S DA=$P(DATA,U,PCE) Q:'DA  I $D(^IBA("364.7",DA,0)) D ^DIK
"RTN","IBY432PR",39,0)
 Q
"RTN","IBY432PR",40,0)
INC3508(Y) ; function to determine if entry in IB ERROR file (350.8) should be included in the build
"RTN","IBY432PR",41,0)
 ; Y - ien to file
"RTN","IBY432PR",42,0)
 N DATA,ENTRY,LN,OK,TAG
"RTN","IBY432PR",43,0)
 S OK=0,ENTRY=U_$P($G(^IBE(350.8,Y,0)),U,3)_U
"RTN","IBY432PR",44,0)
 F LN=2:1 S TAG="ENT3508+"_LN,DATA=$P($T(@TAG),";;",2) Q:DATA=""  I $F(DATA,ENTRY) S OK=1 Q
"RTN","IBY432PR",45,0)
 Q OK
"RTN","IBY432PR",46,0)
 ;-----------------------------------------------------------------------
"RTN","IBY432PR",47,0)
 ; 364.5 entries modified:
"RTN","IBY432PR",48,0)
ENT5 ; OF entries in file 364.5 to be included
"RTN","IBY432PR",49,0)
 ;
"RTN","IBY432PR",50,0)
 ;;^195^254^259^269^324^325^
"RTN","IBY432PR",51,0)
 ;;^326^327^328^329^330^331^332^333^334^335^336^337^338^339^340^341^342^
"RTN","IBY432PR",52,0)
 ;;^343^344^345^346^347^348^349^350^351^352^353^354^357^358^359^360^361^362^
"RTN","IBY432PR",53,0)
 ;;^363^364^365^366^367^368^369^370^371^372^373^374^375^
"RTN","IBY432PR",54,0)
 ;
"RTN","IBY432PR",55,0)
 ;-----------------------------------------------------------------------
"RTN","IBY432PR",56,0)
 ; 364.6 entries modified:
"RTN","IBY432PR",57,0)
 ;55   CL1-15
"RTN","IBY432PR",58,0)
 ;57   CL1-17
"RTN","IBY432PR",59,0)
 ;87   PC1-4
"RTN","IBY432PR",60,0)
 ;88   VC1-2
"RTN","IBY432PR",61,0)
 ;93   DC1-3
"RTN","IBY432PR",62,0)
 ;114  PRF-5
"RTN","IBY432PR",63,0)
 ;130  INS-9
"RTN","IBY432PR",64,0)
 ;195  OI1-12
"RTN","IBY432PR",65,0)
 ;804  OI1-13
"RTN","IBY432PR",66,0)
 ;806  OI1-15
"RTN","IBY432PR",67,0)
 ;891  COB1-10
"RTN","IBY432PR",68,0)
 ;935  OPR-16
"RTN","IBY432PR",69,0)
 ;941  OPR-2
"RTN","IBY432PR",70,0)
 ;942  OPR-3
"RTN","IBY432PR",71,0)
 ;943  OPR-4
"RTN","IBY432PR",72,0)
 ;944  OPR-5
"RTN","IBY432PR",73,0)
 ;951  OPR-17
"RTN","IBY432PR",74,0)
 ;957  CI3-9
"RTN","IBY432PR",75,0)
 ;962  COB1-12
"RTN","IBY432PR",76,0)
 ;973  OPR1-4
"RTN","IBY432PR",77,0)
 ;974  PRF-21
"RTN","IBY432PR",78,0)
 ;985  OPR1-2
"RTN","IBY432PR",79,0)
 ;986  OPR1-3
"RTN","IBY432PR",80,0)
 ;990  OPR1-7
"RTN","IBY432PR",81,0)
 ;991  OPR1-5
"RTN","IBY432PR",82,0)
 ;992  OPR1-6
"RTN","IBY432PR",83,0)
 ;993  OPR1-8
"RTN","IBY432PR",84,0)
 ;999  CI3-11
"RTN","IBY432PR",85,0)
 ;1000 CI3-10
"RTN","IBY432PR",86,0)
 ;1007 OPR1-10
"RTN","IBY432PR",87,0)
 ;1047 OPR1-11
"RTN","IBY432PR",88,0)
 ;1181 OP9-3
"RTN","IBY432PR",89,0)
 ;1182 OP9-4
"RTN","IBY432PR",90,0)
 ;1183 OP9-5
"RTN","IBY432PR",91,0)
 ;1184 OP9-6
"RTN","IBY432PR",92,0)
 ;1185 OP9-7
"RTN","IBY432PR",93,0)
 ;1186 OP9-8
"RTN","IBY432PR",94,0)
 ;1187 OP9-9
"RTN","IBY432PR",95,0)
 ;1188 OP9-10
"RTN","IBY432PR",96,0)
 ;1224 OPR2-2
"RTN","IBY432PR",97,0)
 ;1225 OPR2-3
"RTN","IBY432PR",98,0)
 ;1226 OPR2-4
"RTN","IBY432PR",99,0)
 ;1227 OPR2-5
"RTN","IBY432PR",100,0)
 ;1228 OPR2-6
"RTN","IBY432PR",101,0)
 ;1229 OPR2-7
"RTN","IBY432PR",102,0)
 ;1230 OPR2-8
"RTN","IBY432PR",103,0)
 ;1231 OPR2-9
"RTN","IBY432PR",104,0)
 ;1232 OPR2-10
"RTN","IBY432PR",105,0)
 ;1233 OPR2-11
"RTN","IBY432PR",106,0)
 ;1487 CMS-1500 BOX24F
"RTN","IBY432PR",107,0)
 ;1917 CL1A-17
"RTN","IBY432PR",108,0)
 ;1919 CL1A-19
"RTN","IBY432PR",109,0)
 ;1921 CL1A-21
"RTN","IBY432PR",110,0)
 ;1935 CL1A-15
"RTN","IBY432PR",111,0)
 ;1937 AMB-1 (SEQ 104.8)
"RTN","IBY432PR",112,0)
 ;1938 AMB-2 (SEQ 104.8)
"RTN","IBY432PR",113,0)
 ;1939 AMB-1 (SEQ 104.9)
"RTN","IBY432PR",114,0)
 ;1940 AMB-3 (SEQ 104.8)
"RTN","IBY432PR",115,0)
 ;1941 AMB-4 (SEQ 104.8)
"RTN","IBY432PR",116,0)
 ;1942 AMB-5 (SEQ 104.8)
"RTN","IBY432PR",117,0)
 ;1943 AMB-6 (SEQ 104.8)
"RTN","IBY432PR",118,0)
 ;1944 AMB-7 (SEQ 104.8)
"RTN","IBY432PR",119,0)
 ;1945 AMB-2 (SEQ 104.9)
"RTN","IBY432PR",120,0)
 ;1946 AMB-3 (SEQ 104.9)
"RTN","IBY432PR",121,0)
 ;1947 AMB-4 (SEQ 104.9)
"RTN","IBY432PR",122,0)
 ;1948 AMB-5 (SEQ 104.9)
"RTN","IBY432PR",123,0)
 ;1949 AMB-6 (SEQ 104.9)
"RTN","IBY432PR",124,0)
 ;1950 AMB-7 (SEQ 104.9)
"RTN","IBY432PR",125,0)
 ;1951 AMB-8 (SEQ 104.9)
"RTN","IBY432PR",126,0)
 ;1952 PRV-9
"RTN","IBY432PR",127,0)
 ;1953 PRV-12
"RTN","IBY432PR",128,0)
 ;1954 CL1A-29
"RTN","IBY432PR",129,0)
 ;1955 CL1A-30
"RTN","IBY432PR",130,0)
 ;1956 CL1A-23
"RTN","IBY432PR",131,0)
 ;1957 CL1A-22.8
"RTN","IBY432PR",132,0)
 ;1958 CL1A-22.9
"RTN","IBY432PR",133,0)
 ;1959 CL1A-24
"RTN","IBY432PR",134,0)
 ;1960 CL1A-25
"RTN","IBY432PR",135,0)
 ;1961 CL1A-26
"RTN","IBY432PR",136,0)
 ;1962 CL1A-27
"RTN","IBY432PR",137,0)
 ;1963 CL1A-28
"RTN","IBY432PR",138,0)
 ;1964 PRV-13
"RTN","IBY432PR",139,0)
 ;1965 PRV-14
"RTN","IBY432PR",140,0)
 ;1966 CI3-13
"RTN","IBY432PR",141,0)
 ;1967 CI3-14
"RTN","IBY432PR",142,0)
 ;1968 CI3-15
"RTN","IBY432PR",143,0)
 ;1969 CL1B-1
"RTN","IBY432PR",144,0)
 ;1970 CL1B-2
"RTN","IBY432PR",145,0)
 ;1971 CL1B-3
"RTN","IBY432PR",146,0)
 ;1972 CL1B-4
"RTN","IBY432PR",147,0)
 ;1973 CL1B-5
"RTN","IBY432PR",148,0)
 ;1974 PT2-5
"RTN","IBY432PR",149,0)
 ;1975 PT2-6
"RTN","IBY432PR",150,0)
 ;1976 PT2-7
"RTN","IBY432PR",151,0)
 ;1977 PT2-8
"RTN","IBY432PR",152,0)
 ;1978 PT2-9
"RTN","IBY432PR",153,0)
 ;1979 PT2-10
"RTN","IBY432PR",154,0)
 ;1980 PT2-11
"RTN","IBY432PR",155,0)
 ;1981 PT2-12
"RTN","IBY432PR",156,0)
 ;1982 SPC-1
"RTN","IBY432PR",157,0)
 ;1983 SPC-2
"RTN","IBY432PR",158,0)
 ;1984 SPC-3
"RTN","IBY432PR",159,0)
 ;1985 SPC-4
"RTN","IBY432PR",160,0)
 ;1986 SPC-5
"RTN","IBY432PR",161,0)
 ;1988 SUB2-5
"RTN","IBY432PR",162,0)
 ;1991 OPR9-1
"RTN","IBY432PR",163,0)
 ;1992 OPR9-1.5
"RTN","IBY432PR",164,0)
 ;1993 OPR9-2
"RTN","IBY432PR",165,0)
 ;1994 OPR9-3
"RTN","IBY432PR",166,0)
 ;1995 OPR9-4
"RTN","IBY432PR",167,0)
 ;1996 OPR9-5
"RTN","IBY432PR",168,0)
 ;1997 OPR9-6
"RTN","IBY432PR",169,0)
 ;1998 OPR9-7
"RTN","IBY432PR",170,0)
 ;1999 OPR9-8
"RTN","IBY432PR",171,0)
 ;2000 OPR9-9
"RTN","IBY432PR",172,0)
 ;2001 OPR9-10
"RTN","IBY432PR",173,0)
 ;2002 OPR9-11
"RTN","IBY432PR",174,0)
 ;2003 OPRA-1
"RTN","IBY432PR",175,0)
 ;2004 OPRA-2
"RTN","IBY432PR",176,0)
 ;2005 OPRA-3
"RTN","IBY432PR",177,0)
 ;2006 OPRA-4
"RTN","IBY432PR",178,0)
 ;2007 OPRA-5
"RTN","IBY432PR",179,0)
 ;2008 OPRA-6
"RTN","IBY432PR",180,0)
 ;2009 OPRA-7
"RTN","IBY432PR",181,0)
 ;2010 OPRA-8
"RTN","IBY432PR",182,0)
 ;2011 OPRA-9
"RTN","IBY432PR",183,0)
 ;2012 OP1A-1
"RTN","IBY432PR",184,0)
 ;2013 OP1A-2
"RTN","IBY432PR",185,0)
 ;2014 OP1A-3
"RTN","IBY432PR",186,0)
 ;2015 OP1A-4
"RTN","IBY432PR",187,0)
 ;2016 OP1A-5
"RTN","IBY432PR",188,0)
 ;2017 OP1A-6
"RTN","IBY432PR",189,0)
 ;2018 OP1A-7
"RTN","IBY432PR",190,0)
 ;2019 OP1A-8
"RTN","IBY432PR",191,0)
 ;2020 OP1A-9
"RTN","IBY432PR",192,0)
 ;2021 OP1A-10
"RTN","IBY432PR",193,0)
 ;2022 RX1-11
"RTN","IBY432PR",194,0)
 ;2023 RX1-12
"RTN","IBY432PR",195,0)
 ;2024 OI4-11
"RTN","IBY432PR",196,0)
 ;2025 OI4-12
"RTN","IBY432PR",197,0)
 ;2026 OI4-8
"RTN","IBY432PR",198,0)
 ;2027 OI4-9
"RTN","IBY432PR",199,0)
 ;2028 OI4-10
"RTN","IBY432PR",200,0)
 ;2029 SUB2-17
"RTN","IBY432PR",201,0)
 ;2030 SUB2-18
"RTN","IBY432PR",202,0)
 ;2031 SUB2-19
"RTN","IBY432PR",203,0)
 ;2032 SUB2-20
"RTN","IBY432PR",204,0)
 ;2033 SUB2-21
"RTN","IBY432PR",205,0)
 ;2034 SUB2-22
"RTN","IBY432PR",206,0)
 ;2050 LDAT-1
"RTN","IBY432PR",207,0)
 ;2051 LDAT-2
"RTN","IBY432PR",208,0)
 ;2052 LDAT-1.9
"RTN","IBY432PR",209,0)
 ;2053 LDAT-3
"RTN","IBY432PR",210,0)
 ;2054 LDAT-4
"RTN","IBY432PR",211,0)
 ;2055 LDAT-5
"RTN","IBY432PR",212,0)
 ;2056 LDAT-6
"RTN","IBY432PR",213,0)
 ;2057 LDAT-7
"RTN","IBY432PR",214,0)
 ;2058 LDAT-8
"RTN","IBY432PR",215,0)
 ;2059 LDAT-9
"RTN","IBY432PR",216,0)
 ;2060 LDAT-10
"RTN","IBY432PR",217,0)
 ;2061 LDAT-11
"RTN","IBY432PR",218,0)
 ;2062 LDAT-12
"RTN","IBY432PR",219,0)
 ;2063 LDAT-13
"RTN","IBY432PR",220,0)
 ;2064 LDAT-14
"RTN","IBY432PR",221,0)
 ;2065 LDAT-99.9
"RTN","IBY432PR",222,0)
 ;2066 LOPE-1
"RTN","IBY432PR",223,0)
 ;2067 LOPE-1.9
"RTN","IBY432PR",224,0)
 ;2068 LOPE-2
"RTN","IBY432PR",225,0)
 ;2069 LOPE-3
"RTN","IBY432PR",226,0)
 ;2070 LOPE-4
"RTN","IBY432PR",227,0)
 ;2071 LOPE-5
"RTN","IBY432PR",228,0)
 ;2072 LOPE-6
"RTN","IBY432PR",229,0)
 ;2073 LOPE-7
"RTN","IBY432PR",230,0)
 ;2074 LOPE-8
"RTN","IBY432PR",231,0)
 ;2075 LOPE-9
"RTN","IBY432PR",232,0)
 ;2076 LOPE-10
"RTN","IBY432PR",233,0)
 ;2077 LOPE-11
"RTN","IBY432PR",234,0)
 ;2078 LOPE-12
"RTN","IBY432PR",235,0)
 ;2079 LOPE-13
"RTN","IBY432PR",236,0)
 ;2080 LOPE-14
"RTN","IBY432PR",237,0)
 ;2081 LOPE-15
"RTN","IBY432PR",238,0)
 ;2084 LOPE-99.9
"RTN","IBY432PR",239,0)
 ;2085 LOP1-1
"RTN","IBY432PR",240,0)
 ;2086 LOP1-2
"RTN","IBY432PR",241,0)
 ;2087 LOP1-1.9
"RTN","IBY432PR",242,0)
 ;2088 LOP1-3
"RTN","IBY432PR",243,0)
 ;2089 LOP1-4
"RTN","IBY432PR",244,0)
 ;2090 LOP1-5
"RTN","IBY432PR",245,0)
 ;2091 LOP1-6
"RTN","IBY432PR",246,0)
 ;2092 LOP1-7
"RTN","IBY432PR",247,0)
 ;2093 LOP1-8
"RTN","IBY432PR",248,0)
 ;2094 LOP1-9
"RTN","IBY432PR",249,0)
 ;2095 LOP1-10
"RTN","IBY432PR",250,0)
 ;2096 LOP1-11
"RTN","IBY432PR",251,0)
 ;2097 LOP1-12
"RTN","IBY432PR",252,0)
 ;2098 LOP1-13
"RTN","IBY432PR",253,0)
 ;2099 LOP1-14
"RTN","IBY432PR",254,0)
 ;2100 LOP1-15
"RTN","IBY432PR",255,0)
 ;2103 LOP1-99.9
"RTN","IBY432PR",256,0)
 ;2104 LREN-1
"RTN","IBY432PR",257,0)
 ;2105 LREN-1.9
"RTN","IBY432PR",258,0)
 ;2106 LREN-2
"RTN","IBY432PR",259,0)
 ;2107 LREN-3
"RTN","IBY432PR",260,0)
 ;2108 LREN-4
"RTN","IBY432PR",261,0)
 ;2109 LREN-5
"RTN","IBY432PR",262,0)
 ;2110 LREN-6
"RTN","IBY432PR",263,0)
 ;2111 LREN-7
"RTN","IBY432PR",264,0)
 ;2112 LREN-8
"RTN","IBY432PR",265,0)
 ;2113 LREN-9
"RTN","IBY432PR",266,0)
 ;2114 LREN-10
"RTN","IBY432PR",267,0)
 ;2115 LREN-11
"RTN","IBY432PR",268,0)
 ;2116 LREN-12
"RTN","IBY432PR",269,0)
 ;2117 LREN-13
"RTN","IBY432PR",270,0)
 ;2118 LREN-14
"RTN","IBY432PR",271,0)
 ;2119 LREN-15
"RTN","IBY432PR",272,0)
 ;2122 LREN-99.9
"RTN","IBY432PR",273,0)
 ;2123 LREN-17
"RTN","IBY432PR",274,0)
 ;2124 LREN-18
"RTN","IBY432PR",275,0)
 ;2125 LPUR-1
"RTN","IBY432PR",276,0)
 ;2126 LPUR-1.9
"RTN","IBY432PR",277,0)
 ;2127 LPUR-2
"RTN","IBY432PR",278,0)
 ;2128 LPUR-3
"RTN","IBY432PR",279,0)
 ;2129 LPUR-4
"RTN","IBY432PR",280,0)
 ;2130 LPUR-5
"RTN","IBY432PR",281,0)
 ;2131 LPUR-6
"RTN","IBY432PR",282,0)
 ;2132 LPUR-7
"RTN","IBY432PR",283,0)
 ;2133 LPUR-99.9
"RTN","IBY432PR",284,0)
 ;2134 LSUP-1
"RTN","IBY432PR",285,0)
 ;2135 LSUP-1.9
"RTN","IBY432PR",286,0)
 ;2136 LSUP-2
"RTN","IBY432PR",287,0)
 ;2137 LSUP-3
"RTN","IBY432PR",288,0)
 ;2138 LSUP-4
"RTN","IBY432PR",289,0)
 ;2139 LSUP-5
"RTN","IBY432PR",290,0)
 ;2140 LSUP-6
"RTN","IBY432PR",291,0)
 ;2141 LSUP-7
"RTN","IBY432PR",292,0)
 ;2142 LSUP-8
"RTN","IBY432PR",293,0)
 ;2143 LSUP-9
"RTN","IBY432PR",294,0)
 ;2144 LSUP-10
"RTN","IBY432PR",295,0)
 ;2145 LSUP-11
"RTN","IBY432PR",296,0)
 ;2146 LSUP-12
"RTN","IBY432PR",297,0)
 ;2147 LSUP-13
"RTN","IBY432PR",298,0)
 ;2148 LSUP-14
"RTN","IBY432PR",299,0)
 ;2149 LSUP-15
"RTN","IBY432PR",300,0)
 ;2152 LSUP-99.9
"RTN","IBY432PR",301,0)
 ;2153 LREF-1
"RTN","IBY432PR",302,0)
 ;2154 LREF-1.9
"RTN","IBY432PR",303,0)
 ;2155 LREF-2
"RTN","IBY432PR",304,0)
 ;2156 LREF-3
"RTN","IBY432PR",305,0)
 ;2157 LREF-4
"RTN","IBY432PR",306,0)
 ;2158 LREF-5
"RTN","IBY432PR",307,0)
 ;2159 LREF-6
"RTN","IBY432PR",308,0)
 ;2160 LREF-7
"RTN","IBY432PR",309,0)
 ;2161 LREF-8
"RTN","IBY432PR",310,0)
 ;2162 LREF-9
"RTN","IBY432PR",311,0)
 ;2163 LREF-10
"RTN","IBY432PR",312,0)
 ;2164 LREF-11
"RTN","IBY432PR",313,0)
 ;2165 LREF-12
"RTN","IBY432PR",314,0)
 ;2166 LREF-13
"RTN","IBY432PR",315,0)
 ;2167 LREF-14
"RTN","IBY432PR",316,0)
 ;2168 LREF-15
"RTN","IBY432PR",317,0)
 ;2169 LREF-99.9
"RTN","IBY432PR",318,0)
 ;2170 SUB2-99
"RTN","IBY432PR",319,0)
 ;2171 CI1A-1.5
"RTN","IBY432PR",320,0)
 ;2172 CI1A-99
"RTN","IBY432PR",321,0)
 ;2173 OPR-1.5
"RTN","IBY432PR",322,0)
 ;2174 OPR-99.5
"RTN","IBY432PR",323,0)
 ;2175 OPR1-1.5
"RTN","IBY432PR",324,0)
 ;2176 OPR1-99.5
"RTN","IBY432PR",325,0)
 ;2177 OPR2-1.5
"RTN","IBY432PR",326,0)
 ;2178 OPR2-99.5
"RTN","IBY432PR",327,0)
 ;2179 OPR3-1.5
"RTN","IBY432PR",328,0)
 ;2180 OPR3-99.5
"RTN","IBY432PR",329,0)
 ;2181 OPR4-1.5
"RTN","IBY432PR",330,0)
 ;2182 OPR4-99.5
"RTN","IBY432PR",331,0)
 ;2183 OPR5-1.5
"RTN","IBY432PR",332,0)
 ;2184 OPR5-99.5
"RTN","IBY432PR",333,0)
 ;2185 OPR7-99.5
"RTN","IBY432PR",334,0)
 ;2186 OPR8-1.5
"RTN","IBY432PR",335,0)
 ;2187 OPR8-99.5
"RTN","IBY432PR",336,0)
 ;2188 OPR9-99.5
"RTN","IBY432PR",337,0)
 ;2189 OPRA-1.5
"RTN","IBY432PR",338,0)
 ;2190 OPRA-99.5
"RTN","IBY432PR",339,0)
 ;2191 OP1-1.5
"RTN","IBY432PR",340,0)
 ;2192 OP1-99.5
"RTN","IBY432PR",341,0)
 ;2193 OP1A-1.5
"RTN","IBY432PR",342,0)
 ;2194 OP1A-99.5
"RTN","IBY432PR",343,0)
 ;2195 OP2-1.5
"RTN","IBY432PR",344,0)
 ;2196 OP2-99.5
"RTN","IBY432PR",345,0)
 ;2197 OP4-1.5
"RTN","IBY432PR",346,0)
 ;2198 OP4-99.5
"RTN","IBY432PR",347,0)
 ;2199 OP8-1.5
"RTN","IBY432PR",348,0)
 ;2200 OP9-1.5
"RTN","IBY432PR",349,0)
 ;2201 OP9-99.5
"RTN","IBY432PR",350,0)
 ;2202 OI6-99.9
"RTN","IBY432PR",351,0)
 ;2203 OI4-7.9
"RTN","IBY432PR",352,0)
 ;2204 OI1-19
"RTN","IBY432PR",353,0)
 ;2205 OI1-20
"RTN","IBY432PR",354,0)
 ;2206 LCOB-18
"RTN","IBY432PR",355,0)
 ;2207 LCAS-22
"RTN","IBY432PR",356,0)
 ;2208 PRV1-12
"RTN","IBY432PR",357,0)
 ;
"RTN","IBY432PR",358,0)
ENT6 ; O.F. entries in file 364.6 to be included
"RTN","IBY432PR",359,0)
 ;
"RTN","IBY432PR",360,0)
 ;;^55^57^87^88^93^114^130^195^804^806^891^935^941^942^943^944^951^957^962^973^974^985^986^990^
"RTN","IBY432PR",361,0)
 ;;^991^992^993^999^1000^1007^1045^1047^1181^1182^1183^1184^1185^1186^1187^
"RTN","IBY432PR",362,0)
 ;;^1188^1224^1225^1226^1227^1228^1229^1230^1231^1232^1233^1487^1917^1919^1921^
"RTN","IBY432PR",363,0)
 ;;^1935^1937^1938^1939^1940^1941^1942^1943^1944^1945^1946^1947^1948^1949^
"RTN","IBY432PR",364,0)
 ;;^1950^1951^1952^1953^1954^1955^1956^1957^1958^1959^1960^1961^1962^1963^
"RTN","IBY432PR",365,0)
 ;;^1964^1965^1966^1967^1968^1969^1970^1971^1972^1973^1974^1975^1976^1977^
"RTN","IBY432PR",366,0)
 ;;^1978^1979^1980^1981^1982^1983^1984^1985^1986^1988^1991^1992^1993^1994^
"RTN","IBY432PR",367,0)
 ;;^1995^1996^1997^1998^1999^2000^2001^2002^2003^2004^2005^2006^2007^2008^
"RTN","IBY432PR",368,0)
 ;;^2009^2010^2011^2012^2013^2014^2015^2016^2017^2018^2019^2020^2021^2022^
"RTN","IBY432PR",369,0)
 ;;^2023^2024^2025^2026^2027^2028^2029^2030^2031^2032^2033^2034^2050^2051^
"RTN","IBY432PR",370,0)
 ;;^2052^2053^2054^2055^2056^2057^2058^2059^2060^2061^2062^2063^2064^2065^
"RTN","IBY432PR",371,0)
 ;;^2066^2067^2068^2069^2070^2071^2072^2073^2074^2075^2076^2077^2078^2079^
"RTN","IBY432PR",372,0)
 ;;^2080^2081^2084^2085^2086^2087^2088^2089^2090^2091^2092^2093^
"RTN","IBY432PR",373,0)
 ;;^2094^2095^2096^2097^2098^2099^2100^2103^2104^2105^2106^2107^
"RTN","IBY432PR",374,0)
 ;;^2108^2109^2110^2111^2112^2113^2114^2115^2116^2117^2118^2119^
"RTN","IBY432PR",375,0)
 ;;^2122^2123^2124^2125^2126^2127^2128^2129^2130^2131^2132^2133^2134^2135^
"RTN","IBY432PR",376,0)
 ;;^2136^2137^2138^2139^2140^2141^2142^2143^2144^2145^2146^2147^2148^2149^
"RTN","IBY432PR",377,0)
 ;;^2152^2153^2154^2155^2156^2157^2158^2159^2160^2161^2162^2163^
"RTN","IBY432PR",378,0)
 ;;^2164^2165^2166^2167^2168^2169^2170^2171^2172^2173^2174^2175^2176^2177^
"RTN","IBY432PR",379,0)
 ;;^2178^2179^2180^2181^2182^2183^2184^2185^2186^2187^2188^2189^2190^2191^
"RTN","IBY432PR",380,0)
 ;;^2192^2193^2194^2195^2196^2197^2198^2199^2200^2201^2202^2203^2204^2205^
"RTN","IBY432PR",381,0)
 ;;^2206^2207^2208^
"RTN","IBY432PR",382,0)
 ;
"RTN","IBY432PR",383,0)
 ;-----------------------------------------------------------------------
"RTN","IBY432PR",384,0)
 ; 364.7 entries modified:
"RTN","IBY432PR",385,0)
 ;12   CI1A-6
"RTN","IBY432PR",386,0)
 ;40   PC1-4
"RTN","IBY432PR",387,0)
 ;53   OPR-6
"RTN","IBY432PR",388,0)
 ;68   CL1-7
"RTN","IBY432PR",389,0)
 ;103  CL1-23
"RTN","IBY432PR",390,0)
 ;106  VC1-1.9
"RTN","IBY432PR",391,0)
 ;131  UB-2
"RTN","IBY432PR",392,0)
 ;188  OI1-12
"RTN","IBY432PR",393,0)
 ;209  SUB2-4.5
"RTN","IBY432PR",394,0)
 ;212  OPR1-11
"RTN","IBY432PR",395,0)
 ;213  OPR1-12
"RTN","IBY432PR",396,0)
 ;226  CI1A-2
"RTN","IBY432PR",397,0)
 ;246  OPR7-6
"RTN","IBY432PR",398,0)
 ;247  OPR7-7
"RTN","IBY432PR",399,0)
 ;375  CI1A-7
"RTN","IBY432PR",400,0)
 ;376  CI1A-8
"RTN","IBY432PR",401,0)
 ;377  CI1A-9
"RTN","IBY432PR",402,0)
 ;385  CI1A-17
"RTN","IBY432PR",403,0)
 ;388  CI1A-5
"RTN","IBY432PR",404,0)
 ;389  CI1A-4
"RTN","IBY432PR",405,0)
 ;413  SUB2-16
"RTN","IBY432PR",406,0)
 ;420  OPR2-2
"RTN","IBY432PR",407,0)
 ;421  OPR2-3
"RTN","IBY432PR",408,0)
 ;422  OPR2-4
"RTN","IBY432PR",409,0)
 ;423  OPR2-5
"RTN","IBY432PR",410,0)
 ;424  OPR2-6
"RTN","IBY432PR",411,0)
 ;425  OPR2-7
"RTN","IBY432PR",412,0)
 ;426  OPR2-8
"RTN","IBY432PR",413,0)
 ;427  OPR2-9
"RTN","IBY432PR",414,0)
 ;428  OPR2-10
"RTN","IBY432PR",415,0)
 ;429  OPR2-11
"RTN","IBY432PR",416,0)
 ;430  OPR3-2
"RTN","IBY432PR",417,0)
 ;431  OPR3-3
"RTN","IBY432PR",418,0)
 ;432  OPR3-4
"RTN","IBY432PR",419,0)
 ;433  OPR3-5
"RTN","IBY432PR",420,0)
 ;434  OPR3-6
"RTN","IBY432PR",421,0)
 ;435  OPR3-7
"RTN","IBY432PR",422,0)
 ;436  OPR3-8
"RTN","IBY432PR",423,0)
 ;437  OPR3-9
"RTN","IBY432PR",424,0)
 ;438  OPR3-10
"RTN","IBY432PR",425,0)
 ;439  OPR3-11
"RTN","IBY432PR",426,0)
 ;440  OPR4-3
"RTN","IBY432PR",427,0)
 ;535  OP9-4
"RTN","IBY432PR",428,0)
 ;537  OP1-3
"RTN","IBY432PR",429,0)
 ;538  OP1-8
"RTN","IBY432PR",430,0)
 ;540  OP1-10
"RTN","IBY432PR",431,0)
 ;541  OP1-4
"RTN","IBY432PR",432,0)
 ;542  OP1-6
"RTN","IBY432PR",433,0)
 ;543  OP1-5
"RTN","IBY432PR",434,0)
 ;544  OP1-7
"RTN","IBY432PR",435,0)
 ;545  OP2-4
"RTN","IBY432PR",436,0)
 ;546  OP2-5
"RTN","IBY432PR",437,0)
 ;547  OP2-7
"RTN","IBY432PR",438,0)
 ;548  OP2-9
"RTN","IBY432PR",439,0)
 ;549  OP2-6
"RTN","IBY432PR",440,0)
 ;550  OP2-10
"RTN","IBY432PR",441,0)
 ;551  OP2-3
"RTN","IBY432PR",442,0)
 ;558  OP3-10
"RTN","IBY432PR",443,0)
 ;560  OP4-4
"RTN","IBY432PR",444,0)
 ;561  OP4-3
"RTN","IBY432PR",445,0)
 ;562  OP4-5
"RTN","IBY432PR",446,0)
 ;563  OP4-7
"RTN","IBY432PR",447,0)
 ;564  OP4-9
"RTN","IBY432PR",448,0)
 ;565  OP4-6
"RTN","IBY432PR",449,0)
 ;566  OP4-8
"RTN","IBY432PR",450,0)
 ;567  OP4-10
"RTN","IBY432PR",451,0)
 ;589  OP7-10
"RTN","IBY432PR",452,0)
 ;600  OP9-5
"RTN","IBY432PR",453,0)
 ;601  OP9-7
"RTN","IBY432PR",454,0)
 ;602  OP9-9
"RTN","IBY432PR",455,0)
 ;603  OP9-6
"RTN","IBY432PR",456,0)
 ;604  OP9-8
"RTN","IBY432PR",457,0)
 ;605  OP9-10
"RTN","IBY432PR",458,0)
 ;640  OP9-3
"RTN","IBY432PR",459,0)
 ;644  OPR5-2
"RTN","IBY432PR",460,0)
 ;645  OPR5-3
"RTN","IBY432PR",461,0)
 ;646  OPR5-4
"RTN","IBY432PR",462,0)
 ;647  OPR5-5
"RTN","IBY432PR",463,0)
 ;648  OPR5-6
"RTN","IBY432PR",464,0)
 ;649  OPR5-7
"RTN","IBY432PR",465,0)
 ;650  OPR5-8
"RTN","IBY432PR",466,0)
 ;651  OPR5-9
"RTN","IBY432PR",467,0)
 ;652  OPR5-10
"RTN","IBY432PR",468,0)
 ;653  OPR5-11
"RTN","IBY432PR",469,0)
 ;654  OPR4-5
"RTN","IBY432PR",470,0)
 ;655  OPR4-7
"RTN","IBY432PR",471,0)
 ;656  OPR4-9
"RTN","IBY432PR",472,0)
 ;657  OPR4-11
"RTN","IBY432PR",473,0)
 ;658  OPR4-2
"RTN","IBY432PR",474,0)
 ;659  OPR4-4
"RTN","IBY432PR",475,0)
 ;660  OPR4-6
"RTN","IBY432PR",476,0)
 ;661  OPR4-8
"RTN","IBY432PR",477,0)
 ;662  OPR4-19
"RTN","IBY432PR",478,0)
 ;663  OP1-9
"RTN","IBY432PR",479,0)
 ;664  OP2-8
"RTN","IBY432PR",480,0)
 ;798  OPR-4
"RTN","IBY432PR",481,0)
 ;804  COB1-2
"RTN","IBY432PR",482,0)
 ;814  MOA1-2
"RTN","IBY432PR",483,0)
 ;815  MIA1-2
"RTN","IBY432PR",484,0)
 ;816  MIA2-2
"RTN","IBY432PR",485,0)
 ;817  CCAS-2
"RTN","IBY432PR",486,0)
 ;893  OPR-15
"RTN","IBY432PR",487,0)
 ;894  OPR-13
"RTN","IBY432PR",488,0)
 ;896  OPR-9
"RTN","IBY432PR",489,0)
 ;897  OPR-11
"RTN","IBY432PR",490,0)
 ;900  OI1-13
"RTN","IBY432PR",491,0)
 ;902  OI1-15
"RTN","IBY432PR",492,0)
 ;914  OPR-2
"RTN","IBY432PR",493,0)
 ;915  OPR-3
"RTN","IBY432PR",494,0)
 ;916  OPR-7
"RTN","IBY432PR",495,0)
 ;917  OPR-10
"RTN","IBY432PR",496,0)
 ;918  OPR-14
"RTN","IBY432PR",497,0)
 ;919  OPR-8
"RTN","IBY432PR",498,0)
 ;921  OPR-5
"RTN","IBY432PR",499,0)
 ;922  OPR-16
"RTN","IBY432PR",500,0)
 ;923  OPR-17
"RTN","IBY432PR",501,0)
 ;951  COB1-10
"RTN","IBY432PR",502,0)
 ;952  PRF-21
"RTN","IBY432PR",503,0)
 ;983  COB1-12
"RTN","IBY432PR",504,0)
 ;985  LCOB-1.9
"RTN","IBY432PR",505,0)
 ;987  OPR1-2
"RTN","IBY432PR",506,0)
 ;988  OPR1-3
"RTN","IBY432PR",507,0)
 ;992  OPR1-8
"RTN","IBY432PR",508,0)
 ;993  OPR1-5
"RTN","IBY432PR",509,0)
 ;994  OPR1-6
"RTN","IBY432PR",510,0)
 ;995  OPR1-9
"RTN","IBY432PR",511,0)
 ;1001 CI3-10
"RTN","IBY432PR",512,0)
 ;1008 OPR1=10
"RTN","IBY432PR",513,0)
 ;1015 GEN-7
"RTN","IBY432PR",514,0)
 ;1018 OP8-2
"RTN","IBY432PR",515,0)
 ;1019 OP1-2
"RTN","IBY432PR",516,0)
 ;1021 OP4-2
"RTN","IBY432PR",517,0)
 ;1024 OP9-2
"RTN","IBY432PR",518,0)
 ;1025 OP2-2
"RTN","IBY432PR",519,0)
 ;1034 OPR1-4
"RTN","IBY432PR",520,0)
 ;1035 OPR1-14
"RTN","IBY432PR",521,0)
 ;1036 OPR1-15
"RTN","IBY432PR",522,0)
 ;1037 OPR1-7
"RTN","IBY432PR",523,0)
 ;1039 CI4-14
"RTN","IBY432PR",524,0)
 ;1162 REF PROV OTH ID QUAL (17A/1)
"RTN","IBY432PR",525,0)
 ;1163 REF PROV OTH ID# (BX 17A/2)
"RTN","IBY432PR",526,0)
 ;1164 REFERRING PROV NAME (BX 17)
"RTN","IBY432PR",527,0)
 ;1165 REFERRING PROV NPI# (BX 17B)
"RTN","IBY432PR",528,0)
 ;1190 ID QUALIFER (BX-24I)
"RTN","IBY432PR",529,0)
 ;1191 RENDERING PROVIDER ID (BX-24J)
"RTN","IBY432PR",530,0)
 ;1203 BLOCK 31 CHR 1-21 (BX-31/LN1)
"RTN","IBY432PR",531,0)
 ;1205 IBXSAVE CLEAN-UP BX 33
"RTN","IBY432PR",532,0)
 ;1208 BLOCK 31 CHR 22-42 (BX-31/LN2)
"RTN","IBY432PR",533,0)
 ;1430 ATTENDING NAME (FL-76/2/1)
"RTN","IBY432PR",534,0)
 ;1431 ATTENDING NAME (FL-76/2/2)
"RTN","IBY432PR",535,0)
 ;1432 OPERATING NAME (FL-77/2/1)
"RTN","IBY432PR",536,0)
 ;1433 OPERATING NAME (FL-77/2/2)
"RTN","IBY432PR",537,0)
 ;1436 OTHER NAME (FL-78/2/1)
"RTN","IBY432PR",538,0)
 ;1437 OTHER NAME (FL-78/2/2)
"RTN","IBY432PR",539,0)
 ;1439 OTHER NAME (FL-79/2/2)
"RTN","IBY432PR",540,0)
 ;1525 CI5-7
"RTN","IBY432PR",541,0)
 ;1526 CI5-8
"RTN","IBY432PR",542,0)
 ;1527 CI5-9
"RTN","IBY432PR",543,0)
 ;1539 OI6-9
"RTN","IBY432PR",544,0)
 ;1540 OI6-10
"RTN","IBY432PR",545,0)
 ;1611 PRV-99
"RTN","IBY432PR",546,0)
 ;1617 CL1A-17
"RTN","IBY432PR",547,0)
 ;1618 CL1A-18
"RTN","IBY432PR",548,0)
 ;1619 CL1A-19
"RTN","IBY432PR",549,0)
 ;1621 CL1A-21
"RTN","IBY432PR",550,0)
 ;1628 PRV1-5
"RTN","IBY432PR",551,0)
 ;1629 PRV1-6
"RTN","IBY432PR",552,0)
 ;1634 PRV-11
"RTN","IBY432PR",553,0)
 ;1637 AMB-1 (SEQ 104.8)
"RTN","IBY432PR",554,0)
 ;1638 AMB-2 (SEQ 104.8)
"RTN","IBY432PR",555,0)
 ;1639 AMB-1 (SEQ 104.9)
"RTN","IBY432PR",556,0)
 ;1640 AMB-3 (SEQ 104.8)
"RTN","IBY432PR",557,0)
 ;1641 AMB-4 (SEQ 104.8)
"RTN","IBY432PR",558,0)
 ;1642 AMB-5 (SEQ 104.8)
"RTN","IBY432PR",559,0)
 ;1643 AMB-6 (SEQ 104.8)
"RTN","IBY432PR",560,0)
 ;1644 AMB-7 (SEQ 104.8)
"RTN","IBY432PR",561,0)
 ;1645 AMB-2 (SEQ 104.9)
"RTN","IBY432PR",562,0)
 ;1646 AMB-3 (SEQ 104.9)
"RTN","IBY432PR",563,0)
 ;1647 AMB-4 (SEQ 104.9)
"RTN","IBY432PR",564,0)
 ;1648 AMB-5 (SEQ 104.9)
"RTN","IBY432PR",565,0)
 ;1649 AMB-6 (SEQ 104.9)
"RTN","IBY432PR",566,0)
 ;1650 AMB-7 (SEQ 104.9)
"RTN","IBY432PR",567,0)
 ;1651 AMB-8 (SEQ 104.9)
"RTN","IBY432PR",568,0)
 ;1652 PRV-9
"RTN","IBY432PR",569,0)
 ;1653 PRV-12
"RTN","IBY432PR",570,0)
 ;1654 CL1A-29
"RTN","IBY432PR",571,0)
 ;1655 CL1A-30
"RTN","IBY432PR",572,0)
 ;1656 CL1A-23
"RTN","IBY432PR",573,0)
 ;1657 CL1A-22.8
"RTN","IBY432PR",574,0)
 ;1658 CL1A-22.9
"RTN","IBY432PR",575,0)
 ;1659 CL1A-24
"RTN","IBY432PR",576,0)
 ;1660 CL1A-25
"RTN","IBY432PR",577,0)
 ;1661 CL1A-26
"RTN","IBY432PR",578,0)
 ;1662 CL1A-27
"RTN","IBY432PR",579,0)
 ;1663 CL1A-28
"RTN","IBY432PR",580,0)
 ;1664 PRV-13
"RTN","IBY432PR",581,0)
 ;1665 PRV-14
"RTN","IBY432PR",582,0)
 ;1666 CI3-13
"RTN","IBY432PR",583,0)
 ;1667 CI3-14
"RTN","IBY432PR",584,0)
 ;1668 CI3-15
"RTN","IBY432PR",585,0)
 ;1669 CL1B-1
"RTN","IBY432PR",586,0)
 ;1670 CL1B-2
"RTN","IBY432PR",587,0)
 ;1671 CL1B-3
"RTN","IBY432PR",588,0)
 ;1672 CL1B-4
"RTN","IBY432PR",589,0)
 ;1673 CLIB-5
"RTN","IBY432PR",590,0)
 ;1674 PT2-5
"RTN","IBY432PR",591,0)
 ;1675 PT2-6
"RTN","IBY432PR",592,0)
 ;1676 PT2-7
"RTN","IBY432PR",593,0)
 ;1677 PT2-8
"RTN","IBY432PR",594,0)
 ;1678 PT2-9
"RTN","IBY432PR",595,0)
 ;1679 PT2-10
"RTN","IBY432PR",596,0)
 ;1680 PT2-11
"RTN","IBY432PR",597,0)
 ;1681 PT2-12
"RTN","IBY432PR",598,0)
 ;1682 SPC-1
"RTN","IBY432PR",599,0)
 ;1683 SPC-2
"RTN","IBY432PR",600,0)
 ;1684 SPC-3
"RTN","IBY432PR",601,0)
 ;1685 SPC-4
"RTN","IBY432PR",602,0)
 ;1686 SPC-5
"RTN","IBY432PR",603,0)
 ;1687 SUB2-5
"RTN","IBY432PR",604,0)
 ;1690 OPR9-1
"RTN","IBY432PR",605,0)
 ;1691 OPR9-1.5
"RTN","IBY432PR",606,0)
 ;1692 OPR9-2
"RTN","IBY432PR",607,0)
 ;1693 OPR9-3
"RTN","IBY432PR",608,0)
 ;1694 OPR9-4
"RTN","IBY432PR",609,0)
 ;1695 OPR9-5
"RTN","IBY432PR",610,0)
 ;1696 OPR9-6
"RTN","IBY432PR",611,0)
 ;1697 OPR9-7
"RTN","IBY432PR",612,0)
 ;1698 OPR9-8
"RTN","IBY432PR",613,0)
 ;1699 OPR9-9
"RTN","IBY432PR",614,0)
 ;1700 OPR9-10
"RTN","IBY432PR",615,0)
 ;1701 OPR9-11
"RTN","IBY432PR",616,0)
 ;1702 OPRA-1
"RTN","IBY432PR",617,0)
 ;1703 OPRA-2
"RTN","IBY432PR",618,0)
 ;1704 OPRA-3
"RTN","IBY432PR",619,0)
 ;1705 OPRA-4
"RTN","IBY432PR",620,0)
 ;1706 OPRA-5
"RTN","IBY432PR",621,0)
 ;1707 OPRA-6
"RTN","IBY432PR",622,0)
 ;1708 OPRA-7
"RTN","IBY432PR",623,0)
 ;1709 OPRA-8
"RTN","IBY432PR",624,0)
 ;1710 OPRA-9
"RTN","IBY432PR",625,0)
 ;1711 OP1A-1
"RTN","IBY432PR",626,0)
 ;1712 OP1A-2
"RTN","IBY432PR",627,0)
 ;1713 OP1A-3
"RTN","IBY432PR",628,0)
 ;1714 OP1A-4
"RTN","IBY432PR",629,0)
 ;1715 OP1A-5
"RTN","IBY432PR",630,0)
 ;1716 OP1A-6
"RTN","IBY432PR",631,0)
 ;1717 OP1A-7
"RTN","IBY432PR",632,0)
 ;1718 OP1A-8
"RTN","IBY432PR",633,0)
 ;1719 OP1A-9
"RTN","IBY432PR",634,0)
 ;1720 OP1A-10
"RTN","IBY432PR",635,0)
 ;1721 RX1-11
"RTN","IBY432PR",636,0)
 ;1722 RX1-12
"RTN","IBY432PR",637,0)
 ;1723 OI4-11
"RTN","IBY432PR",638,0)
 ;1724 OI4-12
"RTN","IBY432PR",639,0)
 ;1725 OI4-8
"RTN","IBY432PR",640,0)
 ;1726 OI4-9
"RTN","IBY432PR",641,0)
 ;1727 OI4-10
"RTN","IBY432PR",642,0)
 ;1728 SUB2-17
"RTN","IBY432PR",643,0)
 ;1729 SUB2-18
"RTN","IBY432PR",644,0)
 ;1730 SUB2-19
"RTN","IBY432PR",645,0)
 ;1731 SUB2-20
"RTN","IBY432PR",646,0)
 ;1732 SUB2-21
"RTN","IBY432PR",647,0)
 ;1733 SUB2-22
"RTN","IBY432PR",648,0)
 ;1750 LDAT-1
"RTN","IBY432PR",649,0)
 ;1751 LDAT-2
"RTN","IBY432PR",650,0)
 ;1752 LDAT-1.9
"RTN","IBY432PR",651,0)
 ;1753 LDAT-3
"RTN","IBY432PR",652,0)
 ;1754 LDAT-4
"RTN","IBY432PR",653,0)
 ;1755 LDAT-5
"RTN","IBY432PR",654,0)
 ;1756 LDAT-6
"RTN","IBY432PR",655,0)
 ;1757 LDAT-7
"RTN","IBY432PR",656,0)
 ;1758 LDAT-8
"RTN","IBY432PR",657,0)
 ;1759 LDAT-9
"RTN","IBY432PR",658,0)
 ;1760 LDAT-10
"RTN","IBY432PR",659,0)
 ;1761 LDAT-11
"RTN","IBY432PR",660,0)
 ;1762 LDAT-12
"RTN","IBY432PR",661,0)
 ;1763 LDAT-13
"RTN","IBY432PR",662,0)
 ;1764 LDAT-14
"RTN","IBY432PR",663,0)
 ;1765 LDAT-99.9
"RTN","IBY432PR",664,0)
 ;1766 LOPE-1
"RTN","IBY432PR",665,0)
 ;1767 LOPE-1.9
"RTN","IBY432PR",666,0)
 ;1768 LOPE-2
"RTN","IBY432PR",667,0)
 ;1769 LOPE-3
"RTN","IBY432PR",668,0)
 ;1770 LOPE-4
"RTN","IBY432PR",669,0)
 ;1771 LOPE-5
"RTN","IBY432PR",670,0)
 ;1772 LOPE-6
"RTN","IBY432PR",671,0)
 ;1773 LOPE-7
"RTN","IBY432PR",672,0)
 ;1774 LOPE-8
"RTN","IBY432PR",673,0)
 ;1775 LOPE-9
"RTN","IBY432PR",674,0)
 ;1776 LOPE-10
"RTN","IBY432PR",675,0)
 ;1777 LOPE-11
"RTN","IBY432PR",676,0)
 ;1778 LOPE-12
"RTN","IBY432PR",677,0)
 ;1779 LOPE-13
"RTN","IBY432PR",678,0)
 ;1780 LOPE-14
"RTN","IBY432PR",679,0)
 ;1781 LOPE-15
"RTN","IBY432PR",680,0)
 ;1784 LOPE-99.9
"RTN","IBY432PR",681,0)
 ;1785 LOP1-1
"RTN","IBY432PR",682,0)
 ;1786 LOP1-2
"RTN","IBY432PR",683,0)
 ;1787 LOP1-1.9
"RTN","IBY432PR",684,0)
 ;1788 LOP1-3
"RTN","IBY432PR",685,0)
 ;1789 LOP1-4
"RTN","IBY432PR",686,0)
 ;1790 LOP1-5
"RTN","IBY432PR",687,0)
 ;1791 LOP1-6
"RTN","IBY432PR",688,0)
 ;1792 LOP1-7
"RTN","IBY432PR",689,0)
 ;1793 LOP1-8
"RTN","IBY432PR",690,0)
 ;1794 LOP1-9
"RTN","IBY432PR",691,0)
 ;1795 LOP1-10
"RTN","IBY432PR",692,0)
 ;1796 LOP1-11
"RTN","IBY432PR",693,0)
 ;1797 LOP1-12
"RTN","IBY432PR",694,0)
 ;1798 LOP1-13
"RTN","IBY432PR",695,0)
 ;1799 LOP1-14
"RTN","IBY432PR",696,0)
 ;1800 LOP1-15
"RTN","IBY432PR",697,0)
 ;1803 LOP1-99.9
"RTN","IBY432PR",698,0)
 ;1804 LREN-1
"RTN","IBY432PR",699,0)
 ;1805 LREN-1.9
"RTN","IBY432PR",700,0)
 ;1806 LREN-2
"RTN","IBY432PR",701,0)
 ;1807 LREN-3
"RTN","IBY432PR",702,0)
 ;1808 LREN-4
"RTN","IBY432PR",703,0)
 ;1809 LREN-5
"RTN","IBY432PR",704,0)
 ;1810 LREN-6
"RTN","IBY432PR",705,0)
 ;1811 LREN-7
"RTN","IBY432PR",706,0)
 ;1812 LREN-8
"RTN","IBY432PR",707,0)
 ;1813 LREN-9
"RTN","IBY432PR",708,0)
 ;1814 LREN-10
"RTN","IBY432PR",709,0)
 ;1815 LREN-11
"RTN","IBY432PR",710,0)
 ;1816 LREN-12
"RTN","IBY432PR",711,0)
 ;1817 LREN-13
"RTN","IBY432PR",712,0)
 ;1818 LREN-14
"RTN","IBY432PR",713,0)
 ;1819 LREN-15
"RTN","IBY432PR",714,0)
 ;1822 LREN-99.9
"RTN","IBY432PR",715,0)
 ;1823 LREN-16
"RTN","IBY432PR",716,0)
 ;1824 LREN-17
"RTN","IBY432PR",717,0)
 ;1825 LPUR-1
"RTN","IBY432PR",718,0)
 ;1826 LPUR-1.9
"RTN","IBY432PR",719,0)
 ;1827 LPUR-2
"RTN","IBY432PR",720,0)
 ;1828 LPUR-3
"RTN","IBY432PR",721,0)
 ;1829 LPUR-4
"RTN","IBY432PR",722,0)
 ;1830 LPUR-5
"RTN","IBY432PR",723,0)
 ;1831 LPUR-6
"RTN","IBY432PR",724,0)
 ;1832 LPUR-7
"RTN","IBY432PR",725,0)
 ;1833 LPUR-99.9
"RTN","IBY432PR",726,0)
 ;1834 LSUP-1
"RTN","IBY432PR",727,0)
 ;1835 LSUP-1.9
"RTN","IBY432PR",728,0)
 ;1836 LSUP-2
"RTN","IBY432PR",729,0)
 ;1837 LSUP-3
"RTN","IBY432PR",730,0)
 ;1838 LSUP-4
"RTN","IBY432PR",731,0)
 ;1839 LSUP-5
"RTN","IBY432PR",732,0)
 ;1840 LSUP-6
"RTN","IBY432PR",733,0)
 ;1841 LSUP-7
"RTN","IBY432PR",734,0)
 ;1842 LSUP-8
"RTN","IBY432PR",735,0)
 ;1843 LSUP-9
"RTN","IBY432PR",736,0)
 ;1844 LSUP-10
"RTN","IBY432PR",737,0)
 ;1845 LSUP-11
"RTN","IBY432PR",738,0)
 ;1846 LSUP-12
"RTN","IBY432PR",739,0)
 ;1847 LSUP-13
"RTN","IBY432PR",740,0)
 ;1848 LSUP-14
"RTN","IBY432PR",741,0)
 ;1849 LSUP-15
"RTN","IBY432PR",742,0)
 ;1852 LSUP-99.9
"RTN","IBY432PR",743,0)
 ;1853 LREF-1
"RTN","IBY432PR",744,0)
 ;1854 LREF-1.9
"RTN","IBY432PR",745,0)
 ;1855 LREF-2
"RTN","IBY432PR",746,0)
 ;1856 LREF-3
"RTN","IBY432PR",747,0)
 ;1857 LREF-4
"RTN","IBY432PR",748,0)
 ;1858 LREF-5
"RTN","IBY432PR",749,0)
 ;1859 LREF-6
"RTN","IBY432PR",750,0)
 ;1860 LREF-7
"RTN","IBY432PR",751,0)
 ;1861 LREF-8
"RTN","IBY432PR",752,0)
 ;1862 LREF-9
"RTN","IBY432PR",753,0)
 ;1863 LREF-10
"RTN","IBY432PR",754,0)
 ;1864 LREF-11
"RTN","IBY432PR",755,0)
 ;1865 LREF-12
"RTN","IBY432PR",756,0)
 ;1866 LREF-13
"RTN","IBY432PR",757,0)
 ;1867 LREF-14
"RTN","IBY432PR",758,0)
 ;1868 LREF-15
"RTN","IBY432PR",759,0)
 ;1869 LREF-99.9
"RTN","IBY432PR",760,0)
 ;1870 SUB2-99
"RTN","IBY432PR",761,0)
 ;1871 CI1A-1.5
"RTN","IBY432PR",762,0)
 ;1872 CI1A-99
"RTN","IBY432PR",763,0)
 ;1873 OPR-1.5
"RTN","IBY432PR",764,0)
 ;1874 OPR-99.5
"RTN","IBY432PR",765,0)
 ;1875 OPR1-1.5
"RTN","IBY432PR",766,0)
 ;1876 OPR1-99.5
"RTN","IBY432PR",767,0)
 ;1877 OPR2-1.5
"RTN","IBY432PR",768,0)
 ;1878 OPR2-99.5
"RTN","IBY432PR",769,0)
 ;1879 OPR3-1.5
"RTN","IBY432PR",770,0)
 ;1880 OPR3-99.5
"RTN","IBY432PR",771,0)
 ;1881 OPR4-1.5
"RTN","IBY432PR",772,0)
 ;1882 OPR4-99.5
"RTN","IBY432PR",773,0)
 ;1883 OPR5-1.5
"RTN","IBY432PR",774,0)
 ;1884 OPR5-99.5
"RTN","IBY432PR",775,0)
 ;1885 OPR7-99.5
"RTN","IBY432PR",776,0)
 ;1886 OPR8-1.5
"RTN","IBY432PR",777,0)
 ;1887 OPR8-99.5
"RTN","IBY432PR",778,0)
 ;1888 OPR9-99.5
"RTN","IBY432PR",779,0)
 ;1889 OPRA-1.5
"RTN","IBY432PR",780,0)
 ;1890 OPRA-99.5
"RTN","IBY432PR",781,0)
 ;1891 OP1-1.5
"RTN","IBY432PR",782,0)
 ;1892 OP1-99.5
"RTN","IBY432PR",783,0)
 ;1893 OP1A-1.5
"RTN","IBY432PR",784,0)
 ;1894 OP1A-99.5
"RTN","IBY432PR",785,0)
 ;1895 OP2-1.5
"RTN","IBY432PR",786,0)
 ;1896 OP2-99.5
"RTN","IBY432PR",787,0)
 ;1897 OP4-1.5
"RTN","IBY432PR",788,0)
 ;1898 OP4-99.5
"RTN","IBY432PR",789,0)
 ;1899 OP8-1.5
"RTN","IBY432PR",790,0)
 ;1900 OP9-1.5
"RTN","IBY432PR",791,0)
 ;1901 OP9-99.5
"RTN","IBY432PR",792,0)
 ;1902 OI6-99.9
"RTN","IBY432PR",793,0)
 ;1903 OI4-7.9
"RTN","IBY432PR",794,0)
 ;1904 OI1-19
"RTN","IBY432PR",795,0)
 ;1905 OI1-20
"RTN","IBY432PR",796,0)
 ;1906 LCOB-18
"RTN","IBY432PR",797,0)
 ;1907 LCAS-22
"RTN","IBY432PR",798,0)
 ;1908 PRV1-12
"RTN","IBY432PR",799,0)
 ;
"RTN","IBY432PR",800,0)
ENT7 ; O.F. entries in file 364.7 to be included
"RTN","IBY432PR",801,0)
 ;
"RTN","IBY432PR",802,0)
 ;;^12^40^53^68^103^106^131^188^205^209^212^213^226^229^230^232^244^245^246^247^375^376^377^
"RTN","IBY432PR",803,0)
 ;;^385^388^389^413^420^421^422^423^424^425^426^427^428^429^430^431^432^433^434^435^
"RTN","IBY432PR",804,0)
 ;;^436^437^438^439^440^443^444^445^446^447^448^449^450^451^452^535^537^538^540^541^
"RTN","IBY432PR",805,0)
 ;;^542^543^544^545^546^547^548^549^550^551^558^560^561^562^563^564^565^566^567^588^589^
"RTN","IBY432PR",806,0)
 ;;^600^601^602^603^604^605^640^644^645^646^647^648^649^650^651^652^653^654^655^656^
"RTN","IBY432PR",807,0)
 ;;^657^658^659^660^661^662^663^664^798^804^814^815^816^817^893^894^896^897^900^902^
"RTN","IBY432PR",808,0)
 ;;^914^915^916^917^918^919^921^922^923^951^952^962^983^985^987^988^992^993^994^995^
"RTN","IBY432PR",809,0)
 ;;^1001^1008^1015^1018^1019^1021^1024^1034^1035^1036^1037^1039^1162^1163^1164^1165^
"RTN","IBY432PR",810,0)
 ;;^1179^1190^1191^1203^1205^1208^1366^1430^1431^1432^1433^1436^1437^1438^1439^1440^
"RTN","IBY432PR",811,0)
 ;;^1441^1442^1443^1444^1445^1446^1447^1448^1451^1452^1453^1525^1526^1527^1539^1540^
"RTN","IBY432PR",812,0)
 ;;^1611^1617^1618^1619^1621^1628^1629^1634^1637^1638^1639^1640^1641^1642^1643^1644^1645^1646^
"RTN","IBY432PR",813,0)
 ;;^1647^1648^1649^1650^1651^1652^1653^1654^1655^1656^1657^1658^1659^1660^1661^1662^
"RTN","IBY432PR",814,0)
 ;;^1663^1664^1665^1666^1667^1668^1669^1670^1671^1672^1673^1674^1675^1676^1677^1678^
"RTN","IBY432PR",815,0)
 ;;^1679^1680^1681^1682^1683^1684^1685^1686^1687^1690^1691^1692^1693^1694^1695^1696^
"RTN","IBY432PR",816,0)
 ;;^1697^1698^1699^1700^1701^1702^1703^1704^1705^1706^1707^1708^1709^1710^1711^1712^
"RTN","IBY432PR",817,0)
 ;;^1713^1714^1715^1716^1717^1718^1719^1720^1721^1722^1723^1724^1725^1726^1727^1728^
"RTN","IBY432PR",818,0)
 ;;^1729^1730^1731^1732^1733^1750^1751^1752^1753^1754^1755^1756^1757^1758^1759^1760^
"RTN","IBY432PR",819,0)
 ;;^1761^1762^1763^1764^1765^1766^1767^1768^1769^1770^1771^1772^1773^1774^1775^1776^
"RTN","IBY432PR",820,0)
 ;;^1777^1778^1779^1780^1781^1784^1785^1786^1787^1788^1789^1790^1791^1792^1793^1794^
"RTN","IBY432PR",821,0)
 ;;^1795^1796^1797^1798^1799^1800^1803^1804^1805^1806^1807^1808^1809^1810^1811^1812^
"RTN","IBY432PR",822,0)
 ;;^1813^1814^1815^1816^1817^1818^1819^1822^1823^1824^1825^1826^1827^1828^1829^1830^
"RTN","IBY432PR",823,0)
 ;;^1831^1832^1833^1834^1835^1836^1837^1838^1839^1840^1841^1842^1843^1844^1845^1846^
"RTN","IBY432PR",824,0)
 ;;^1847^1848^1849^1852^1853^1854^1855^1856^1857^1858^1859^1860^1861^1862^1863^1864^
"RTN","IBY432PR",825,0)
 ;;^1865^1866^1867^1868^1869^1870^1871^1872^1873^1874^1875^1876^1877^1878^1879^1880^
"RTN","IBY432PR",826,0)
 ;;^1881^1882^1883^1884^1885^1886^1887^1888^1889^1890^1891^1892^1893^1894^1895^1896^
"RTN","IBY432PR",827,0)
 ;;^1897^1898^1899^1900^1901^1902^1903^1904^1905^1906^1907^1908^
"RTN","IBY432PR",828,0)
 ;;
"RTN","IBY432PR",829,0)
 ;-----------------------------------------------------------------------
"RTN","IBY432PR",830,0)
DEL6    ; remove O.F. entries in file 364.6 (not re-added)
"RTN","IBY432PR",831,0)
 ;
"RTN","IBY432PR",832,0)
 ;;^182^1040^1153^1154^1155^1156^1157^1158^1159^1160^1161^1197^1198^1199^
"RTN","IBY432PR",833,0)
 ;;^1200^1201^1202^1203^1204^1205^1206^1308^1323^1324^1325^1326^1327^1328^
"RTN","IBY432PR",834,0)
 ;;^1329^1330^1331^1332^1333^1334^1335^1336^1337^1338^1339^1914^1989^1990^
"RTN","IBY432PR",835,0)
 ;;^2082^2083^2101^2102^2120^2121^2150^2151^
"RTN","IBY432PR",836,0)
 ;;
"RTN","IBY432PR",837,0)
 ;-----------------------------------------------------------------------
"RTN","IBY432PR",838,0)
DEL7    ; remove O.F. entries in file 364.7 (not re-added)
"RTN","IBY432PR",839,0)
 ;
"RTN","IBY432PR",840,0)
 ;;^150^204^394^395^396^397^398^399^400^401^402^403^470^576^577^578^579^580^
"RTN","IBY432PR",841,0)
 ;;^581^582^1022^1041^1042^1043^1044^1045^1046^1047^1048^1049^1050^1051^
"RTN","IBY432PR",842,0)
 ;;^1052^1053^1054^1055^1056^1057^1614^1688^1689^1782^1783^1801^1802^1820^1821^
"RTN","IBY432PR",843,0)
 ;;^1850^1851^
"RTN","IBY432PR",844,0)
 ;;
"RTN","IBY432PR",845,0)
 Q
"RTN","IBY432PR",846,0)
ENT3508 ; entries in file 350.8 to be included
"RTN","IBY432PR",847,0)
 ;
"RTN","IBY432PR",848,0)
 ;;^IB090^IB105^IB122^IB141^IB142^IB143^IB144^IB145^IB149^IB161^IB162^IB163^
"RTN","IBY432PR",849,0)
 ;;^IB312^IB329^IB330^IB331^IB332^IB333^IB334^IB337^IB338^IB339^IB340^IB341^IB342^IB343^
"RTN","IBY432PR",850,0)
 ;;^IB800^IB801^IB802^IB803^IB804^IB805^IB806^IB807^IB808^IB809^IB810^IB811^IB812^IB813^IB814^
"RTN","IBY432PR",851,0)
 ;;
"RTN","IBY432PR",852,0)
 Q
"SEC","^DIC",353.3,353.3,0,"AUDIT")
@
"SEC","^DIC",353.3,353.3,0,"DD")
@
"SEC","^DIC",353.3,353.3,0,"DEL")
@
"SEC","^DIC",353.3,353.3,0,"LAYGO")
@
"SEC","^DIC",353.3,353.3,0,"RD")
@
"SEC","^DIC",353.3,353.3,0,"WR")
@
"UP",399,399.0222,-1)
399^PRV
"UP",399,399.0222,0)
399.0222
"UP",399,399.0304,-1)
399^CP
"UP",399,399.0304,0)
399.0304
"UP",399,399.0404,-2)
399^CP
"UP",399,399.0404,-1)
399.0304^LNPRV
"UP",399,399.0404,0)
399.0404
"UP",399,399.042,-1)
399^RC
"UP",399,399.042,0)
399.042
"UP",399,399.078,-1)
399^TXC2
"UP",399,399.078,0)
399.078
"UP",399,399.0781,-2)
399^TXC2
"UP",399,399.0781,-1)
399.078^1
"UP",399,399.0781,0)
399.0781
"VER")
8.0^22.0
"^DD",36,36,6.09,0)
PRINT SEC/TERT AUTO CLAIMS?^S^0:NO;1:YES;^6;9^Q
"^DD",36,36,6.09,3)
Enter YES if automatically-processed secondary or tertiary claims to this payer must be printed locally.
"^DD",36,36,6.09,21,0)
^.001^2^2^3101012^^^
"^DD",36,36,6.09,21,1,0)
YES means that automatically-processed secondary or tertiary claims to 
"^DD",36,36,6.09,21,2,0)
this payer must be printed locally.
"^DD",36,36,6.09,"DT")
3100811
"^DD",36,36,6.1,0)
PRINT SEC MED CLAIMS W/O MRA?^S^0:NO;1:YES;^6;10^Q
"^DD",36,36,6.1,3)
Enter YES if secondary Medicare claims to this payer which have not been transmitted to Medicare and for which no MRA has been received, must be  printed locally.
"^DD",36,36,6.1,21,0)
^.001^3^3^3101105^^^^
"^DD",36,36,6.1,21,1,0)
YES means that secondary Medicare claims to this payer which have not 
"^DD",36,36,6.1,21,2,0)
been transmitted to Medicare and for which no MRA has been received,
"^DD",36,36,6.1,21,3,0)
must be printed locally.
"^DD",36,36,6.1,"DT")
3101012
"^DD",350.8,350.8,0)
FIELD^^10^7
"^DD",350.8,350.8,0,"DDA")
N
"^DD",350.8,350.8,0,"DT")
2930322
"^DD",350.8,350.8,0,"ID",.03)
W "   ",$P(^(0),U,3)
"^DD",350.8,350.8,0,"IX","AC",350.8,.03)

"^DD",350.8,350.8,0,"IX","B",350.8,.01)

"^DD",350.8,350.8,0,"IX","C",350.8,.03)

"^DD",350.8,350.8,0,"NM","IB ERROR")
 
"^DD",350.8,350.8,0,"PT",399,36)

"^DD",350.8,350.8,0,"VRPK")
IB
"^DD",350.8,350.8,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",350.8,350.8,.01,1,0)
^.1
"^DD",350.8,350.8,.01,1,1,0)
350.8^B
"^DD",350.8,350.8,.01,1,1,1)
S ^IBE(350.8,"B",$E(X,1,30),DA)=""
"^DD",350.8,350.8,.01,1,1,2)
K ^IBE(350.8,"B",$E(X,1,30),DA)
"^DD",350.8,350.8,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",350.8,350.8,.01,21,0)
^^2^2^2910305^^
"^DD",350.8,350.8,.01,21,1,0)
This is a free text name of the entry.  It should be namespaced with
"^DD",350.8,350.8,.01,21,2,0)
the namespace of the package reporting the error.
"^DD",350.8,350.8,.02,0)
ERROR MESSAGE^F^^0;2^K:$L(X)>80!($L(X)<3) X
"^DD",350.8,350.8,.02,3)
Answer must be 3-80 characters in length.
"^DD",350.8,350.8,.02,21,0)
^^3^3^2940209^^^^
"^DD",350.8,350.8,.02,21,1,0)
This is the text of the message as it will be displayed to a user or
"^DD",350.8,350.8,.02,21,2,0)
posted in a bulletin.  It should be as meaningful as possible to the
"^DD",350.8,350.8,.02,21,3,0)
person seeing the message.
"^DD",350.8,350.8,.03,0)
ERROR CODE^F^^0;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>9!($L(X)<1) X
"^DD",350.8,350.8,.03,1,0)
^.1
"^DD",350.8,350.8,.03,1,1,0)
350.8^AC
"^DD",350.8,350.8,.03,1,1,1)
S ^IBE(350.8,"AC",$E(X,1,30),DA)=""
"^DD",350.8,350.8,.03,1,1,2)
K ^IBE(350.8,"AC",$E(X,1,30),DA)
"^DD",350.8,350.8,.03,1,2,0)
350.8^C
"^DD",350.8,350.8,.03,1,2,1)
S ^IBE(350.8,"C",$E(X,1,30),DA)=""
"^DD",350.8,350.8,.03,1,2,2)
K ^IBE(350.8,"C",$E(X,1,30),DA)
"^DD",350.8,350.8,.03,3)
Answer must be 1-9 characters in length.
"^DD",350.8,350.8,.03,21,0)
^^9^9^2920219^^^^
"^DD",350.8,350.8,.03,21,1,0)
This is the error code that will be passed to or determined by
"^DD",350.8,350.8,.03,21,2,0)
Integrated Billing.  The format for the Error Code should be
"^DD",350.8,350.8,.03,21,3,0)
nnxxx, where nn is the reporting package namespace and xxx are numeric
"^DD",350.8,350.8,.03,21,4,0)
values.
"^DD",350.8,350.8,.03,21,5,0)
 
"^DD",350.8,350.8,.03,21,6,0)
This is the error code that will be passed as the second piece of
"^DD",350.8,350.8,.03,21,7,0)
the variable Y to IB when +Y=-1.  More than one error code can be
"^DD",350.8,350.8,.03,21,8,0)
placed in the second ^ piece of Y delimited by semi-colons.  Applications
"^DD",350.8,350.8,.03,21,9,0)
may call ^IBAERR to display the error message(s).
"^DD",350.8,350.8,.03,"DT")
2920219
"^DD",350.8,350.8,.04,0)
PACKAGE REPORTING ERROR^S^1:INTEGRATED BILLING;2:ACCOUNTS RECEIVABLE;3:PHARMACY;^0;4^Q
"^DD",350.8,350.8,.04,21,0)
^^2^2^2920415^^^
"^DD",350.8,350.8,.04,21,1,0)
This is the package that requested this entry in this file and will
"^DD",350.8,350.8,.04,21,2,0)
report it to IB as an error if the conditions are detected.
"^DD",350.8,350.8,.05,0)
ERROR ACTION^S^1:DISPLAY MESSAGE;2:SEND BULLETIN;3:EDIT FILE;^0;5^Q
"^DD",350.8,350.8,.05,21,0)
^^6^6^2910227^
"^DD",350.8,350.8,.05,21,1,0)
This is the type of action that should be taken when this error is
"^DD",350.8,350.8,.05,21,2,0)
reported to IB.  If action other than displaying a message is indicated
"^DD",350.8,350.8,.05,21,3,0)
then the MUMPS code in the ERROR ACTION field will be executed.
"^DD",350.8,350.8,.05,21,4,0)
 
"^DD",350.8,350.8,.05,21,5,0)
Currently only display actions are implemented.  Please contact the 
"^DD",350.8,350.8,.05,21,6,0)
developing ISC if other action types are desired.
"^DD",350.8,350.8,.06,0)
CORRESPONDING ALERT^P354.5'^IBE(354.5,^0;6^Q
"^DD",350.8,350.8,.06,21,0)
^^1^1^2940209^
"^DD",350.8,350.8,.06,21,1,0)
This is the type of alert that should be sent when this error occurs.
"^DD",350.8,350.8,.06,"DT")
2930322
"^DD",350.8,350.8,10,0)
EXECUTABLE LOGIC^K^^10;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",350.8,350.8,10,3)
This is Standard MUMPS code.
"^DD",350.8,350.8,10,21,0)
^^2^2^2910227^
"^DD",350.8,350.8,10,21,1,0)
This is the MUMPS code that will be executed if an error is reported
"^DD",350.8,350.8,10,21,2,0)
with an ERROR ACTION of other than to display a message.
"^DD",350.9,350.9,8.14,0)
CMS-1500 AUTO PRINTER^P3.5'^%ZIS(1,^8;14^Q
"^DD",350.9,350.9,8.14,.1)
CMS-1500 Auto Printer
"^DD",350.9,350.9,8.14,3)
Enter the name of the printer that will print automatically-processed secondary/tertiary CMS 1500 claims.
"^DD",350.9,350.9,8.14,21,0)
^^3^3^3101012^
"^DD",350.9,350.9,8.14,21,1,0)
This is the printer that will be used to automatically print CMS-1500s 
"^DD",350.9,350.9,8.14,21,2,0)
when an electronic non-Medicare EOB is received and the subsequent
"^DD",350.9,350.9,8.14,21,3,0)
insurance company requires printed claims.
"^DD",350.9,350.9,8.14,"DT")
3101012
"^DD",350.9,350.9,8.15,0)
UB-04 AUTO PRINTER^P3.5'^%ZIS(1,^8;15^Q
"^DD",350.9,350.9,8.15,.1)
UB-04 Auto Printer
"^DD",350.9,350.9,8.15,3)
Enter the name of the printer that will print automatically-processed secondary/tertiary UB04 claims.
"^DD",350.9,350.9,8.15,21,0)
^^3^3^3101012^
"^DD",350.9,350.9,8.15,21,1,0)
This is the printer that will be used to automatically print UB-04s when
"^DD",350.9,350.9,8.15,21,2,0)
an electronic non-Medicare EOB is received and the subsequent insurance
"^DD",350.9,350.9,8.15,21,3,0)
company requires printed claims.
"^DD",350.9,350.9,8.15,"DT")
3101012
"^DD",350.9,350.9,8.16,0)
EOB AUTO PRINTER^P3.5'^%ZIS(1,^8;16^Q
"^DD",350.9,350.9,8.16,.1)
EOB Auto Printer
"^DD",350.9,350.9,8.16,3)
Enter the name of the printer that will print EOBs for automatically-processed secondary/tertiary claims.
"^DD",350.9,350.9,8.16,21,0)
^^3^3^3101012^
"^DD",350.9,350.9,8.16,21,1,0)
This is the printer that will be used for automatically printing EOBs of
"^DD",350.9,350.9,8.16,21,2,0)
automatically-processed claims when the subsequent insurance company
"^DD",350.9,350.9,8.16,21,3,0)
requires printed secondary or tertiary claims.
"^DD",350.9,350.9,8.16,"DT")
3101012
"^DD",350.9,350.9,8.17,0)
AUTOMATIC REG EOB PROCESS?^S^0:NO;1:YES;^8;17^Q
"^DD",350.9,350.9,8.17,.1)
Enable Auto Reg EOB Processing?
"^DD",350.9,350.9,8.17,3)
Should Regular EOBs be automatically processed?
"^DD",350.9,350.9,8.17,21,0)
^.001^8^8^3101222^^^^
"^DD",350.9,350.9,8.17,21,1,0)
This field controls whether or not incoming Regular (Non-Medicare) EOBs
"^DD",350.9,350.9,8.17,21,2,0)
can be automatically processed so that the subsequent bill is
"^DD",350.9,350.9,8.17,21,3,0)
automatically generated and automatically authorized and sent to the next
"^DD",350.9,350.9,8.17,21,4,0)
payer.
"^DD",350.9,350.9,8.17,21,5,0)
 
"^DD",350.9,350.9,8.17,21,6,0)
If this field is NO, then all incoming Regular (Non-Medicare) EOBs will
"^DD",350.9,350.9,8.17,21,7,0)
remain on the COB management worklist and manual processing of the EOBs
"^DD",350.9,350.9,8.17,21,8,0)
will be necessary.
"^DD",350.9,350.9,8.17,"DT")
3101222
"^DD",350.9,350.9,8.19,0)
MRA AUTO PRINTER^P3.5'^%ZIS(1,^8;19^Q
"^DD",350.9,350.9,8.19,.1)
MRA Auto Printer
"^DD",350.9,350.9,8.19,3)
Enter the name of the printer that will print MRAs for automatically-processed secondary/tertiary claims.
"^DD",350.9,350.9,8.19,21,0)
^^4^4^3101230^
"^DD",350.9,350.9,8.19,21,1,0)
This is the printer that will be used for automatically printing MRAs of
"^DD",350.9,350.9,8.19,21,2,0)
automatically-processed claims when the subsequent insurance company
"^DD",350.9,350.9,8.19,21,3,0)
requires printed secondary or tertiary claims.  MRAs need to have a 
"^DD",350.9,350.9,8.19,21,4,0)
device set up for 132 character printing.
"^DD",350.9,350.9,8.19,"DT")
3101230
"^DD",353.3,353.3,0)
FIELD^^1^2
"^DD",353.3,353.3,0,"DDA")
N
"^DD",353.3,353.3,0,"DT")
3100816
"^DD",353.3,353.3,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",353.3,353.3,0,"IX","B",353.3,.01)

"^DD",353.3,353.3,0,"NM","IB ATTACHMENT REPORT TYPE")

"^DD",353.3,353.3,0,"PT",399,285)

"^DD",353.3,353.3,0,"PT",399.0304,71)

"^DD",353.3,353.3,.01,0)
ATTACHMENT REPORT TYPE CODE^RF^^0;1^K:$L(X)>2!($L(X)<2) X
"^DD",353.3,353.3,.01,1,0)
^.1
"^DD",353.3,353.3,.01,1,1,0)
353.3^B
"^DD",353.3,353.3,.01,1,1,1)
S ^IBE(353.3,"B",$E(X,1,30),DA)=""
"^DD",353.3,353.3,.01,1,1,2)
K ^IBE(353.3,"B",$E(X,1,30),DA)
"^DD",353.3,353.3,.01,3)
Answer must be 2 characters in length.
"^DD",353.3,353.3,.01,21,0)
^^3^3^3101025^
"^DD",353.3,353.3,.01,21,1,0)
The Report Type Code describes the type of documentation that will provide
"^DD",353.3,353.3,.01,21,2,0)
additional information for this claim. Attachment Report Type Code is at
"^DD",353.3,353.3,.01,21,3,0)
both the claim level and line level.
"^DD",353.3,353.3,.01,"DT")
3101025
"^DD",353.3,353.3,1,0)
ATTACHMENT REPORT TYPE NAME^F^^0;2^K:$L(X)>80!($L(X)<2) X
"^DD",353.3,353.3,1,3)
Answer must be 2-80 characters in length.
"^DD",353.3,353.3,1,21,0)
^^3^3^3101025^
"^DD",353.3,353.3,1,21,1,0)
This is the descriptive name of the Report Type Code to describe the type
"^DD",353.3,353.3,1,21,2,0)
of documentation that will provide additional information for this claim.
"^DD",353.3,353.3,1,21,3,0)
Attachment Report Type is at both the claim level and line level.
"^DD",353.3,353.3,1,"DT")
3101025
"^DD",355.3,355.3,.15,0)
ELECTRONIC PLAN TYPE^S^16:HMO MEDICARE;MX:MEDICARE A or B;TV:TITLE V;MC:MEDICAID;BL:BC/BS;CH:TRICARE;15:INDEMNITY;CI:COMMERCIAL;HM:HMO;DS:DISABILITY;12:PPO;13:POS;ZZ:OTHER;FI:FEP;17:DENTAL;^0;15^Q
"^DD",355.3,355.3,.15,3)
Enter the appropriate type of plan to be used for electronic billing.
"^DD",355.3,355.3,.15,21,0)
^.001^1^1^3101013^^^^
"^DD",355.3,355.3,.15,21,1,0)
This field contains the X12 data needed to identify the source of pay type.
"^DD",355.3,355.3,.15,23,0)
^.001^2^2^3101013^^^^
"^DD",355.3,355.3,.15,23,1,0)
This field must be consistent with the ELECTRONIC TYPE OF INSURANCE
"^DD",355.3,355.3,.15,23,2,0)
(#3.09) field in the INSURANCE COMPANY (#36) file.
"^DD",355.3,355.3,.15,"DT")
3100818
"^DD",355.93,355.93,1.01,0)
CONTACT NAME^F^^1;1^K:$L(X)>30!($L(X)<3) X
"^DD",355.93,355.93,1.01,.1)
Contact Name
"^DD",355.93,355.93,1.01,3)
Enter the Contact Person (3-30 characters) at this Lab/Facility (Last Name,First Name).
"^DD",355.93,355.93,1.01,21,0)
^.001^2^2^3101012^^^^
"^DD",355.93,355.93,1.01,21,1,0)
This is the name of the contact person at this Lab/Facility 
"^DD",355.93,355.93,1.01,21,2,0)
(Last Name, First Name).
"^DD",355.93,355.93,1.01,"DT")
3100915
"^DD",355.93,355.93,1.02,0)
CONTACT PHONE NUMBER^F^^1;2^K:$L(X)>15!($L(X)<3) X
"^DD",355.93,355.93,1.02,.1)
Contact Phone Number
"^DD",355.93,355.93,1.02,1,0)
^.1
"^DD",355.93,355.93,1.02,1,1,0)
^^TRIGGER^355.93^1.03
"^DD",355.93,355.93,1.02,1,1,1)
Q
"^DD",355.93,355.93,1.02,1,1,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^IBA(355.93,D0,1)):^(1),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X="" S DIH=$G(^IBA(355.93,DIV(0),1)),DIV=X S $P(^(1),U,3)=DIV,DIH=355.93,DIG=1.03 D ^DICR
"^DD",355.93,355.93,1.02,1,1,"%D",0)
^.101^1^1^3100915^^^^
"^DD",355.93,355.93,1.02,1,1,"%D",1,0)
If Contact Phone is deleted, extension will be deleted also.
"^DD",355.93,355.93,1.02,1,1,"CREATE VALUE")
NO EFFECT
"^DD",355.93,355.93,1.02,1,1,"DELETE VALUE")
S X=""
"^DD",355.93,355.93,1.02,1,1,"DT")
3100810
"^DD",355.93,355.93,1.02,1,1,"FIELD")
CONTACT PHONE EXTENSION
"^DD",355.93,355.93,1.02,3)
Enter the area code and phone number (3-15 characters) for the contact person at this Lab/Facility (nnnnnnnnnn or nnn-nnn-nnnn).  Required if Contact Name is present.
"^DD",355.93,355.93,1.02,21,0)
^.001^2^2^3101013^^^^
"^DD",355.93,355.93,1.02,21,1,0)
This is the area code and phone number of the contact person at
"^DD",355.93,355.93,1.02,21,2,0)
 this facility.
"^DD",355.93,355.93,1.02,"AUDIT")
n
"^DD",355.93,355.93,1.02,"DT")
3100915
"^DD",355.93,355.93,1.03,0)
CONTACT PHONE EXTENSION^NJ10,0^^1;3^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",355.93,355.93,1.03,.1)
Contact Phone Extension
"^DD",355.93,355.93,1.03,3)
Type a number between 0 and 9999999999, 0 decimal digits.
"^DD",355.93,355.93,1.03,5,1,0)
355.93^1.02^1
"^DD",355.93,355.93,1.03,21,0)
^.001^2^2^3110215^^^^
"^DD",355.93,355.93,1.03,21,1,0)
This is the phone extension of the contact person at this facility,
"^DD",355.93,355.93,1.03,21,2,0)
if known.
"^DD",355.93,355.93,1.03,"AUDIT")
n
"^DD",355.93,355.93,1.03,"DT")
3110215
"^DD",362.4,362.4,.11,0)
ORDER DATE^D^^0;11^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",362.4,362.4,.11,3)
Enter the date the Rx was ordered.
"^DD",362.4,362.4,.11,21,0)
^.001^3^3^3101013^^^^
"^DD",362.4,362.4,.11,21,1,0)
This field will be stuffed with the ISSUE DATE (#1) field of the Rx from 
"^DD",362.4,362.4,.11,21,2,0)
the PRESCRIPTION (#52) file, if a corresponding entry exists in that file.
"^DD",362.4,362.4,.11,21,3,0)
Otherwise, it will be blank.
"^DD",362.4,362.4,.11,"DT")
3100802
"^DD",364.5,364.5,0)
FIELD^^3^11
"^DD",364.5,364.5,0,"DDA")
N
"^DD",364.5,364.5,0,"DT")
2960311
"^DD",364.5,364.5,0,"ID",.05)
S %I=Y,Y=$S('$D(^(0)):"",$D(^DIC(+$P(^(0),U,5),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",364.5,364.5,0,"IX","B",364.5,.01)

"^DD",364.5,364.5,0,"NM","IB DATA ELEMENT DEFINITION")

"^DD",364.5,364.5,0,"PT",364.7,.03)

"^DD",364.5,364.5,0,"VRPK")
IB
"^DD",364.5,364.5,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",364.5,364.5,.01,1,0)
^.1
"^DD",364.5,364.5,.01,1,1,0)
364.5^B
"^DD",364.5,364.5,.01,1,1,1)
S ^IBA(364.5,"B",$E(X,1,30),DA)=""
"^DD",364.5,364.5,.01,1,1,2)
K ^IBA(364.5,"B",$E(X,1,30),DA)
"^DD",364.5,364.5,.01,3)
Answer must be 3-30 characters in length.
"^DD",364.5,364.5,.01,21,0)
^^1^1^2951205^
"^DD",364.5,364.5,.01,21,1,0)
The name to be used to uniquely identify this data element.
"^DD",364.5,364.5,.01,"DT")
2951219
"^DD",364.5,364.5,.02,0)
SECURITY LEVEL^RS^N:NATIONAL,NO EDIT;L:LOCAL;^0;2^Q
"^DD",364.5,364.5,.02,21,0)
^^2^2^2960215^^^^
"^DD",364.5,364.5,.02,21,1,0)
If this field is set to N (NATIONAL,NO EDIT), this is a secured data
"^DD",364.5,364.5,.02,21,2,0)
element and will not be allowed to be edited or deleted.
"^DD",364.5,364.5,.02,"DT")
2960215
"^DD",364.5,364.5,.03,0)
TYPE OF ELEMENT^RS^F:NON-MULTIPLE FILEMAN FIELD;E:EXTRACTED VIA CODE;C:CONSTANT VALUE;^0;3^Q
"^DD",364.5,364.5,.03,1,0)
^.1
"^DD",364.5,364.5,.03,1,1,0)
^^TRIGGER^364.5^.04
"^DD",364.5,364.5,.03,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X="FC",Y(1)=X S X=Y(0),X=X S Y=X,X=Y(1),X=X S X=X[Y I X S X=DIV S Y(1)=$S($D(^IBA(364.5,D0,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X=DIV S X="I" X ^DD(364.5,.03,1,1,1.4)
"^DD",364.5,364.5,.03,1,1,1.4)
S DIH=$S($D(^IBA(364.5,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,4)=DIV,DIH=364.5,DIG=.04 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.5,364.5,.03,1,1,2)
Q
"^DD",364.5,364.5,.03,1,1,3)
DO NOT DELETE
"^DD",364.5,364.5,.03,1,1,"%D",0)
^^1^1^2960215^
"^DD",364.5,364.5,.03,1,1,"%D",1,0)
If TYPE OF ELEMENT is 'F' or 'C' then ELEMENT CATEGORY must be 'I'. 
"^DD",364.5,364.5,.03,1,1,"CREATE CONDITION")
"FC"[INTERNAL(TYPE OF ELEMENT)
"^DD",364.5,364.5,.03,1,1,"CREATE VALUE")
S X="I"
"^DD",364.5,364.5,.03,1,1,"DELETE VALUE")
NO EFFECT
"^DD",364.5,364.5,.03,1,1,"DT")
2960215
"^DD",364.5,364.5,.03,1,1,"FIELD")
ELEMENT CATEGORY
"^DD",364.5,364.5,.03,1,2,0)
^^TRIGGER^364.5^.06
"^DD",364.5,364.5,.03,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=Y(0),X=X S X=X'="F" I X S X=DIV S Y(1)=$S($D(^IBA(364.5,D0,0)):^(0),1:"") S X=$P(Y(1),U,6),X=X S DIU=X K Y S X="" X ^DD(364.5,.03,1,2,1.4)
"^DD",364.5,364.5,.03,1,2,1.4)
S DIH=$S($D(^IBA(364.5,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,6)=DIV,DIH=364.5,DIG=.06 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.5,364.5,.03,1,2,2)
Q
"^DD",364.5,364.5,.03,1,2,3)
DO NOT DELETE
"^DD",364.5,364.5,.03,1,2,"%D",0)
^^2^2^2960215^
"^DD",364.5,364.5,.03,1,2,"%D",1,0)
This triggers the FILEMAN FIELD REFERENCE field to null if the element type
"^DD",364.5,364.5,.03,1,2,"%D",2,0)
is not FILEMAN field type of element.
"^DD",364.5,364.5,.03,1,2,"CREATE CONDITION")
INTERNAL(TYPE OF ELEMENT)'="F"
"^DD",364.5,364.5,.03,1,2,"CREATE VALUE")
@
"^DD",364.5,364.5,.03,1,2,"DELETE VALUE")
NO EFFECT
"^DD",364.5,364.5,.03,1,2,"DT")
2960215
"^DD",364.5,364.5,.03,1,2,"FIELD")
FILEMAN FIELD REFERENCE
"^DD",364.5,364.5,.03,1,3,0)
^^TRIGGER^364.5^.08
"^DD",364.5,364.5,.03,1,3,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=Y(0),X=X S X=X'="C" I X S X=DIV S Y(1)=$S($D(^IBA(364.5,D0,0)):^(0),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X="" X ^DD(364.5,.03,1,3,1.4)
"^DD",364.5,364.5,.03,1,3,1.4)
S DIH=$S($D(^IBA(364.5,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,8)=DIV,DIH=364.5,DIG=.08 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.5,364.5,.03,1,3,2)
Q
"^DD",364.5,364.5,.03,1,3,3)
DO NOT DELETE
"^DD",364.5,364.5,.03,1,3,"%D",0)
^^2^2^2960215^
"^DD",364.5,364.5,.03,1,3,"%D",1,0)
This triggers the CONSTANT VALUE field to null if the element type is not
"^DD",364.5,364.5,.03,1,3,"%D",2,0)
CONSTANT type of element.
"^DD",364.5,364.5,.03,1,3,"CREATE CONDITION")
INTERNAL(TYPE OF ELEMENT)'="C"
"^DD",364.5,364.5,.03,1,3,"CREATE VALUE")
@
"^DD",364.5,364.5,.03,1,3,"DELETE VALUE")
NO EFFECT
"^DD",364.5,364.5,.03,1,3,"DT")
2960215
"^DD",364.5,364.5,.03,1,3,"FIELD")
CONSTANT VALUE
"^DD",364.5,364.5,.03,1,4,0)
^^TRIGGER^364.5^1
"^DD",364.5,364.5,.03,1,4,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=Y(0),X=X S X=X'="E" I X S X=DIV S Y(1)=$S($D(^IBA(364.5,D0,1)):^(1),1:"") S X=$E(Y(1),1,245),X=X S DIU=X K Y S X="" X ^DD(364.5,.03,1,4,1.4)
"^DD",364.5,364.5,.03,1,4,1.4)
S DIH=$S($D(^IBA(364.5,DIV(0),1)):^(1),1:""),DIV=X S DE=0-$L(DIH),DIU=$E(DIH,1,245),Y=$E(DIH,246,999),^(1)=$J("",$S(DE>0:DE,1:0))_DIV_$S(Y?." ":"",1:$J("",245-$L(DIV))_Y),DIH=364.5,DIG=1 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.5,364.5,.03,1,4,2)
Q
"^DD",364.5,364.5,.03,1,4,3)
DO NOT DELETE
"^DD",364.5,364.5,.03,1,4,"%D",0)
^^2^2^2960215^
"^DD",364.5,364.5,.03,1,4,"%D",1,0)
This triggers the EXTRACT CODE field to null if the element type is not an
"^DD",364.5,364.5,.03,1,4,"%D",2,0)
EXTRACTED VIA CODE type of element.
"^DD",364.5,364.5,.03,1,4,"CREATE CONDITION")
INTERNAL(TYPE OF ELEMENT)'="E"
"^DD",364.5,364.5,.03,1,4,"CREATE VALUE")
@
"^DD",364.5,364.5,.03,1,4,"DELETE VALUE")
NO EFFECT
"^DD",364.5,364.5,.03,1,4,"DT")
2960215
"^DD",364.5,364.5,.03,1,4,"FIELD")
EXTRACT CODE
"^DD",364.5,364.5,.03,21,0)
^^3^3^2951207^^
"^DD",364.5,364.5,.03,21,1,0)
The type of data element being defined as needed by one or more forms.  This
"^DD",364.5,364.5,.03,21,2,0)
field determines the type of retrieval needed to get the actual data element's
"^DD",364.5,364.5,.03,21,3,0)
value for a given bill.
"^DD",364.5,364.5,.03,"DT")
2960215
"^DD",364.5,364.5,.04,0)
ELEMENT CATEGORY^RSX^I:INDIVIDUAL ELEMENT;G:GROUP ELEMENT;^0;4^I $P($G(^IBA(364.5,DA,0)),U,3)="F",$G(X)="G" K X
"^DD",364.5,364.5,.04,1,0)
^.1
"^DD",364.5,364.5,.04,1,1,0)
^^TRIGGER^364.5^.06
"^DD",364.5,364.5,.04,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=Y(0),X=X S X=X="G" I X S X=DIV S Y(1)=$S($D(^IBA(364.5,D0,0)):^(0),1:"") S X=$P(Y(1),U,6),X=X S DIU=X K Y S X="" X ^DD(364.5,.04,1,1,1.4)
"^DD",364.5,364.5,.04,1,1,1.4)
S DIH=$S($D(^IBA(364.5,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,6)=DIV,DIH=364.5,DIG=.06 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.5,364.5,.04,1,1,2)
Q
"^DD",364.5,364.5,.04,1,1,"CREATE CONDITION")
INTERNAL(ELEMENT CATEGORY)="G"
"^DD",364.5,364.5,.04,1,1,"CREATE VALUE")
""
"^DD",364.5,364.5,.04,1,1,"DELETE VALUE")
NO EFFECT
"^DD",364.5,364.5,.04,1,1,"FIELD")
FILEMAN FIELD REFERENCE
"^DD",364.5,364.5,.04,3)
This indicates an INDIVIDUAL or GROUP of elements will be returned.  Group is not valid for Fileman type elements.
"^DD",364.5,364.5,.04,5,1,0)
364.5^.03^1
"^DD",364.5,364.5,.04,21,0)
^^3^3^2951205^
"^DD",364.5,364.5,.04,21,1,0)
This defines whether the data element to be extracted is a single piece of data
"^DD",364.5,364.5,.04,21,2,0)
or is a string of related data.  Fileman field references must be designated as
"^DD",364.5,364.5,.04,21,3,0)
individual elements.
"^DD",364.5,364.5,.04,"DT")
2960215
"^DD",364.5,364.5,.05,0)
BASE FILE^P1'^DIC(^0;5^Q
"^DD",364.5,364.5,.05,3)
Enter the Fileman file to be used as a 'base' to extract the data from.
"^DD",364.5,364.5,.05,21,0)
^^2^2^2960311^
"^DD",364.5,364.5,.05,21,1,0)
This is the number of the Fileman file to be used as a 'base' to extract
"^DD",364.5,364.5,.05,21,2,0)
data for this field.
"^DD",364.5,364.5,.05,"DT")
2960311
"^DD",364.5,364.5,.06,0)
FILEMAN FIELD REFERENCE^FX^^0;6^K:$L(X)>65!($L(X)<1) X I $D(X),$P($G(^IBA(364.5,DA,0)),U,4)="G" K X
"^DD",364.5,364.5,.06,1,0)
^.1
"^DD",364.5,364.5,.06,1,1,0)
^^TRIGGER^364.5^.07
"^DD",364.5,364.5,.06,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=Y(0)="" I X S X=DIV S Y(1)=$S($D(^IBA(364.5,D0,0)):^(0),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X="" X ^DD(364.5,.06,1,1,1.4)
"^DD",364.5,364.5,.06,1,1,1.4)
S DIH=$S($D(^IBA(364.5,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,7)=DIV,DIH=364.5,DIG=.07 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.5,364.5,.06,1,1,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^IBA(364.5,D0,0)):^(0),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X="" X ^DD(364.5,.06,1,1,2.4)
"^DD",364.5,364.5,.06,1,1,2.4)
S DIH=$S($D(^IBA(364.5,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,7)=DIV,DIH=364.5,DIG=.07 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.5,364.5,.06,1,1,"CREATE CONDITION")
FILEMAN FIELD REFERENCE=""
"^DD",364.5,364.5,.06,1,1,"CREATE VALUE")
@
"^DD",364.5,364.5,.06,1,1,"DELETE VALUE")
@
"^DD",364.5,364.5,.06,1,1,"FIELD")
#.07
"^DD",364.5,364.5,.06,3)
Must be a valid Fileman reference and ELEMENT CATEGORY must not be GROUP.
"^DD",364.5,364.5,.06,5,1,0)
364.5^.03^2
"^DD",364.5,364.5,.06,5,2,0)
364.5^.04^1
"^DD",364.5,364.5,.06,21,0)
^^6^6^2951221^^^
"^DD",364.5,364.5,.06,21,1,0)
The valid Fileman field reference or simple Fileman navigation to be used
"^DD",364.5,364.5,.06,21,2,0)
to extract using the $$GET^DIQ utility. Note this will not return true
"^DD",364.5,364.5,.06,21,3,0)
multiple entries.  Word-processing type fields are able to be retrieved,
"^DD",364.5,364.5,.06,21,4,0)
however.  No syntax check is made on this field so the user must be careful
"^DD",364.5,364.5,.06,21,5,0)
to type a valid Fileman expression.  This must be designated as an
"^DD",364.5,364.5,.06,21,6,0)
INDIVIDUAL element, not a group element.
"^DD",364.5,364.5,.06,"DT")
2951221
"^DD",364.5,364.5,.07,0)
FILEMAN RETURN FORMAT^S^I:INTERNAL;E:EXTERNAL;^0;7^Q
"^DD",364.5,364.5,.07,5,1,0)
364.5^.06^1
"^DD",364.5,364.5,.07,21,0)
^^5^5^2951205^
"^DD",364.5,364.5,.07,21,1,0)
This is the format for the retrieved data for Fileman-type data elements.  It
"^DD",364.5,364.5,.07,21,2,0)
is recommended to use Internal format whenever possible to keep the data
"^DD",364.5,364.5,.07,21,3,0)
element definitions in this file as generic as possible to avoid duplication.  
"^DD",364.5,364.5,.07,21,4,0)
The format capabilities of the forms generator should be used to interpret and
"^DD",364.5,364.5,.07,21,5,0)
reformat the data element when needed.
"^DD",364.5,364.5,.07,"DT")
2951205
"^DD",364.5,364.5,.08,0)
CONSTANT VALUE^F^^0;8^K:$L(X)>80!($L(X)<1) X
"^DD",364.5,364.5,.08,3)
Answer must be 1-80 characters in length.
"^DD",364.5,364.5,.08,5,1,0)
364.5^.03^3
"^DD",364.5,364.5,.08,21,0)
^^1^1^2951205^
"^DD",364.5,364.5,.08,21,1,0)
The specific value that this data element should return for this data element.
"^DD",364.5,364.5,.08,"DT")
2951205
"^DD",364.5,364.5,1,0)
EXTRACT CODE^K^^1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",364.5,364.5,1,3)
This is Standard MUMPS code.
"^DD",364.5,364.5,1,5,1,0)
364.5^.03^4
"^DD",364.5,364.5,1,9)
@
"^DD",364.5,364.5,1,21,0)
^^7^7^2951207^^^
"^DD",364.5,364.5,1,21,1,0)
The code to be executed by the forms generator to return the value(s) of the
"^DD",364.5,364.5,1,21,2,0)
data element.  If no ARRAY ROOT field is completed for this data element, the
"^DD",364.5,364.5,1,21,3,0)
code should set the variable IBXDATA or the array IBXDATA(1) through IBXDATA(n)
"^DD",364.5,364.5,1,21,4,0)
where n=the total # of iterations of the data element retrieved.  If the ARRAY 
"^DD",364.5,364.5,1,21,5,0)
ROOT field has been completed for this data element, this code should set the
"^DD",364.5,364.5,1,21,6,0)
variable referenced there.  IBXIEN is assumed to be the internal entry number
"^DD",364.5,364.5,1,21,7,0)
of the  file (referenced by the variable IBXFILE) entry.
"^DD",364.5,364.5,1,"DT")
2951205
"^DD",364.5,364.5,2,0)
ARRAY ROOT^F^^2;E1,50^K:$L(X)>50!($L(X)<1) X
"^DD",364.5,364.5,2,3)
Answer must be a valid array root name.
"^DD",364.5,364.5,2,21,0)
^^3^3^2960117^^
"^DD",364.5,364.5,2,21,1,0)
 The local or global base root where multiple-valued output or word processing
"^DD",364.5,364.5,2,21,2,0)
data is to be stored for this data element.  IBXDATA is the default if there
"^DD",364.5,364.5,2,21,3,0)
is no data in this field.  Example of a global array: ^TMP($J)
"^DD",364.5,364.5,2,"DT")
2960117
"^DD",364.5,364.5,3,0)
DESCRIPTION^364.53^^3;0
"^DD",364.5,364.53,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",364.5,364.53,0,"DT")
2951205
"^DD",364.5,364.53,0,"NM","DESCRIPTION")

"^DD",364.5,364.53,0,"UP")
364.5
"^DD",364.5,364.53,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",364.5,364.53,.01,3)
Enter a description of the data element being defined.
"^DD",364.5,364.53,.01,21,0)
^^1^1^2951205^
"^DD",364.5,364.53,.01,21,1,0)
This is a free text description of the data that this data element represents.
"^DD",364.5,364.53,.01,"DT")
2951205
"^DD",364.6,364.6,0)
FIELD^^.13^13
"^DD",364.6,364.6,0,"DDA")
N
"^DD",364.6,364.6,0,"DT")
3071126
"^DD",364.6,364.6,0,"ID",.04)
W "   ",$P(^(0),U,4)
"^DD",364.6,364.6,0,"ID",.05)
W "   ",$P(^(0),U,5)
"^DD",364.6,364.6,0,"ID",.08)
W "   ",$P(^(0),U,8)
"^DD",364.6,364.6,0,"ID",.1)
W "   ",$P(^(0),U,10)
"^DD",364.6,364.6,0,"IX","APAR",364.6,.01)

"^DD",364.6,364.6,0,"IX","APAR1",364.6,.03)

"^DD",364.6,364.6,0,"IX","ASEQ",364.6,.01)

"^DD",364.6,364.6,0,"IX","ASEQ1",364.6,.04)

"^DD",364.6,364.6,0,"IX","ASEQ2",364.6,.05)

"^DD",364.6,364.6,0,"IX","ASEQ3",364.6,.08)

"^DD",364.6,364.6,0,"IX","B",364.6,.01)

"^DD",364.6,364.6,0,"NM","IB FORM SKELETON DEFINITION")
 
"^DD",364.6,364.6,0,"PT",364.6,.03)

"^DD",364.6,364.6,0,"PT",364.7,.01)

"^DD",364.6,364.6,0,"VRPK")
IB
"^DD",364.6,364.6,.01,0)
BILL FORM^RP353'X^IBE(353,^0;1^I $$DUP^IBCEFG0($G(DA),X,1) K X
"^DD",364.6,364.6,.01,1,0)
^.1
"^DD",364.6,364.6,.01,1,1,0)
364.6^B
"^DD",364.6,364.6,.01,1,1,1)
S ^IBA(364.6,"B",$E(X,1,30),DA)=""
"^DD",364.6,364.6,.01,1,1,2)
K ^IBA(364.6,"B",$E(X,1,30),DA)
"^DD",364.6,364.6,.01,1,2,0)
364.6^ASEQ^MUMPS
"^DD",364.6,364.6,.01,1,2,1)
N Z0,Z1,Z2,Z3 S Z0=$G(^IBA(364.6,DA,0)),Z1=$P(Z0,U,4),Z2=$P(Z0,U,5),Z3=$P(Z0,U,8) I Z1,Z2,Z3 S ^IBA(364.6,"ASEQ",+X,Z1,Z2,Z3,DA)=""
"^DD",364.6,364.6,.01,1,2,2)
N Z0,Z1,Z2,Z3 S Z0=$G(^IBA(364.6,DA,0)),Z1=$P(Z0,U,4),Z2=$P(Z0,U,5),Z3=$P(Z0,U,8) I Z1,Z2,Z3 K ^IBA(364.6,"ASEQ",+X,Z1,Z2,Z3,DA)
"^DD",364.6,364.6,.01,1,2,3)
DO NOT DELETE
"^DD",364.6,364.6,.01,1,2,"%D",0)
^^1^1^2960117^^
"^DD",364.6,364.6,.01,1,2,"%D",1,0)
This xref contains the sequence to use to extract or print the form fields.
"^DD",364.6,364.6,.01,1,2,"DT")
2960116
"^DD",364.6,364.6,.01,1,3,0)
364.6^APAR^MUMPS
"^DD",364.6,364.6,.01,1,3,1)
N Z0 S Z0=$P($G(^IBA(364.6,DA,0)),U,3) I Z0,Z0'=X S ^IBA(364.6,"APAR",$E(X,1,30),Z0,DA)=""
"^DD",364.6,364.6,.01,1,3,2)
N Z0 S Z0=$P($G(^IBA(364.6,DA,0)),U,3) I Z0,Z0'=X K ^IBA(364.6,"APAR",$E(X,1,30),Z0,DA)
"^DD",364.6,364.6,.01,1,3,3)
DO NOT DELETE
"^DD",364.6,364.6,.01,1,3,"%D",0)
^^1^1^2960117^
"^DD",364.6,364.6,.01,1,3,"%D",1,0)
Xref by bill form and associated form field definition.
"^DD",364.6,364.6,.01,1,3,"DT")
2960117
"^DD",364.6,364.6,.01,1,4,0)
^^TRIGGER^364.6^.03
"^DD",364.6,364.6,.01,1,4,1)
X ^DD(364.6,.01,1,4,1.3) I X S X=DIV S Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S X=$S('$D(D0):"",D0<0:"",1:D0) X ^DD(364.6,.01,1,4,1.4)
"^DD",364.6,364.6,.01,1,4,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(364.6,.01,1,4,69.2) S X=$P($P(Y(102),$C(59)_$P(Y(101),U,2)_":",2),$C(59),1)="BILLING SCREEN" S D0=I(0,0)
"^DD",364.6,364.6,.01,1,4,1.4)
S DIH=$G(^IBA(364.6,DIV(0),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=364.6,DIG=.03 D ^DICR
"^DD",364.6,364.6,.01,1,4,2)
X ^DD(364.6,.01,1,4,2.3) I X S X=DIV S Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X="" S DIH=$G(^IBA(364.6,DIV(0),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=364.6,DIG=.03 D ^DICR
"^DD",364.6,364.6,.01,1,4,2.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(364.6,.01,1,4,79.2) S Y(101)=$S($D(^IBE(353,D0,2)):^(2),1:"") S X=$P($P(Y(102),$C(59)_$P(Y(101),U,2)_":",2),$C(59),1)="BILLING SCREEN" S D0=I(0,0)
"^DD",364.6,364.6,.01,1,4,3)
DO NOT DELETE
"^DD",364.6,364.6,.01,1,4,69.2)
S I(0,0)=$G(D0),D0=Y(0) S:'D0!'$D(^IBE(353,+D0,0)) D0=-1 S Y(102)=$C(59)_$P($G(^DD(353,2.02,0)),U,3),Y(101)=$S($D(^IBE(353,D0,2)):^(2),1:"")
"^DD",364.6,364.6,.01,1,4,79.2)
S I(0,0)=$G(D0),Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:""),D0=$P(Y(1),U,1) S:'D0!'$D(^IBE(353,+D0,0)) D0=-1 S Y(102)=$C(59)_$P($G(^DD(353,2.02,0)),U,3)
"^DD",364.6,364.6,.01,1,4,"%D",0)
^^1^1^3000613^
"^DD",364.6,364.6,.01,1,4,"%D",1,0)
This trigger is needed for the local screen 9 logic to work correctly.
"^DD",364.6,364.6,.01,1,4,"CREATE CONDITION")
BILL FORM:FORMAT TYPE="BILLING SCREEN"
"^DD",364.6,364.6,.01,1,4,"CREATE VALUE")
NUMBER
"^DD",364.6,364.6,.01,1,4,"DELETE CONDITION")
BILL FORM:FORMAT TYPE="BILLING SCREEN"
"^DD",364.6,364.6,.01,1,4,"DELETE VALUE")
@
"^DD",364.6,364.6,.01,1,4,"DT")
3000613
"^DD",364.6,364.6,.01,1,4,"FIELD")
ASSOCIATED FORM DEFINITION
"^DD",364.6,364.6,.01,3)
Enter a BILLING FORM that the data element will appear on.
"^DD",364.6,364.6,.01,21,0)
^^2^2^2960318^^^^
"^DD",364.6,364.6,.01,21,1,0)
Identifies a billing 'form' or 'screen' where the data element is used.
"^DD",364.6,364.6,.01,21,2,0)
The combination of form/page/line/column must be unique.
"^DD",364.6,364.6,.01,"DT")
3000613
"^DD",364.6,364.6,.02,0)
SECURITY LEVEL^SX^N:NATIONAL,NO EDIT;L:LOCAL;^0;2^I X="N",$P($G(^IBA(364.6,DA,0)),U,3) K X
"^DD",364.6,364.6,.02,3)
Enter an N if no editing is allowed, L if editing is OK because this entry is associated with a locally defined form.
"^DD",364.6,364.6,.02,5,1,0)
364.6^.03^7
"^DD",364.6,364.6,.02,21,0)
^.001^4^4^3001030^^
"^DD",364.6,364.6,.02,21,1,0)
This field determines whether or not editing of the entry is allowed.  If
"^DD",364.6,364.6,.02,21,2,0)
the security level of the entry is NATIONAL (N), no local editing is
"^DD",364.6,364.6,.02,21,3,0)
allowed.  If the security level of the entry is LOCAL (L), it may be
"^DD",364.6,364.6,.02,21,4,0)
edited.
"^DD",364.6,364.6,.02,"DT")
2960117
"^DD",364.6,364.6,.03,0)
ASSOCIATED FORM DEFINITION^P364.6'^IBA(364.6,^0;3^Q
"^DD",364.6,364.6,.03,1,0)
^.1
"^DD",364.6,364.6,.03,1,1,0)
364.6^APAR1^MUMPS
"^DD",364.6,364.6,.03,1,1,1)
N Z0 S Z0=+$G(^IBA(364.6,DA,0)) I Z0,Z0'=X S ^IBA(364.6,"APAR",Z0,$E(X,1,30),DA)=""
"^DD",364.6,364.6,.03,1,1,2)
N Z0 S Z0=+$G(^IBA(364.6,DA,0)) I Z0,Z0'=X K ^IBA(364.6,"APAR",Z0,$E(X,1,30),DA)
"^DD",364.6,364.6,.03,1,1,3)
DO NOT DELETE
"^DD",364.6,364.6,.03,1,1,"%D",0)
^^1^1^2960117^^
"^DD",364.6,364.6,.03,1,1,"%D",1,0)
Xref by bill form and associated form field definition.
"^DD",364.6,364.6,.03,1,1,"DT")
2960117
"^DD",364.6,364.6,.03,1,2,0)
^^TRIGGER^364.6^.04
"^DD",364.6,364.6,.03,1,2,1)
X ^DD(364.6,.03,1,2,1.3) I X S X=DIV S Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X="" X ^DD(364.6,.03,1,2,1.4)
"^DD",364.6,364.6,.03,1,2,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(364.6,.03,1,2,69.2) S Y(101)=$S($D(^IBE(353,D0,2)):^(2),1:"") S X=$P($P(Y(102),$C(59)_$P(Y(101),U,2)_":",2),$C(59),1)'="BILLING SCREEN" S D0=I(0,0)
"^DD",364.6,364.6,.03,1,2,1.4)
S DIH=$S($D(^IBA(364.6,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,4)=DIV,DIH=364.6,DIG=.04 D ^DICR
"^DD",364.6,364.6,.03,1,2,2)
Q
"^DD",364.6,364.6,.03,1,2,3)
DO NOT DELETE
"^DD",364.6,364.6,.03,1,2,69.2)
S I(0,0)=$S($D(D0):D0,1:""),Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:""),D0=$P(Y(1),U,1) S:'$D(^IBE(353,+D0,0)) D0=-1 S Y(102)=$C(59)_$S($D(^DD(353,2.02,0)):$P(^(0),U,3),1:"")
"^DD",364.6,364.6,.03,1,2,"%D",0)
^.101^2^2^3000424^^
"^DD",364.6,364.6,.03,1,2,"%D",1,0)
If an associated form that is not a screen form, page is taken from the
"^DD",364.6,364.6,.03,1,2,"%D",2,0)
associated with field definition.
"^DD",364.6,364.6,.03,1,2,"CREATE CONDITION")
BILL FORM:FORMAT TYPE'="BILLING SCREEN"
"^DD",364.6,364.6,.03,1,2,"CREATE VALUE")
@
"^DD",364.6,364.6,.03,1,2,"DELETE VALUE")
NO EFFECT
"^DD",364.6,364.6,.03,1,2,"DT")
3000405
"^DD",364.6,364.6,.03,1,2,"FIELD")
PAGE OR SEQUENCE
"^DD",364.6,364.6,.03,1,3,0)
^^TRIGGER^364.6^.05
"^DD",364.6,364.6,.03,1,3,1)
X ^DD(364.6,.03,1,3,1.3) I X S X=DIV S Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X="" X ^DD(364.6,.03,1,3,1.4)
"^DD",364.6,364.6,.03,1,3,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(364.6,.03,1,3,69.2) S Y(101)=$S($D(^IBE(353,D0,2)):^(2),1:"") S X=$P($P(Y(102),$C(59)_$P(Y(101),U,2)_":",2),$C(59),1)'="BILLING SCREEN" S D0=I(0,0)
"^DD",364.6,364.6,.03,1,3,1.4)
S DIH=$S($D(^IBA(364.6,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,5)=DIV,DIH=364.6,DIG=.05 D ^DICR
"^DD",364.6,364.6,.03,1,3,2)
Q
"^DD",364.6,364.6,.03,1,3,3)
DO NOT DELETE
"^DD",364.6,364.6,.03,1,3,69.2)
S I(0,0)=$S($D(D0):D0,1:""),Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:""),D0=$P(Y(1),U,1) S:'$D(^IBE(353,+D0,0)) D0=-1 S Y(102)=$C(59)_$S($D(^DD(353,2.02,0)):$P(^(0),U,3),1:"")
"^DD",364.6,364.6,.03,1,3,"%D",0)
^^2^2^3000405^
"^DD",364.6,364.6,.03,1,3,"%D",1,0)
If an associated form that is not a screen form, line is taken from the
"^DD",364.6,364.6,.03,1,3,"%D",2,0)
associated with field definition.
"^DD",364.6,364.6,.03,1,3,"CREATE CONDITION")
BILL FORM:FORMAT TYPE'="BILLING SCREEN"
"^DD",364.6,364.6,.03,1,3,"CREATE VALUE")
@
"^DD",364.6,364.6,.03,1,3,"DELETE VALUE")
NO EFFECT
"^DD",364.6,364.6,.03,1,3,"DT")
3000405
"^DD",364.6,364.6,.03,1,3,"FIELD")
FIRST LINE NUMBER
"^DD",364.6,364.6,.03,1,4,0)
^^TRIGGER^364.6^.08
"^DD",364.6,364.6,.03,1,4,1)
X ^DD(364.6,.03,1,4,1.3) I X S X=DIV S Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X="" X ^DD(364.6,.03,1,4,1.4)
"^DD",364.6,364.6,.03,1,4,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(364.6,.03,1,4,69.2) S Y(101)=$S($D(^IBE(353,D0,2)):^(2),1:"") S X=$P($P(Y(102),$C(59)_$P(Y(101),U,2)_":",2),$C(59),1)'="BILLING SCREEN" S D0=I(0,0)
"^DD",364.6,364.6,.03,1,4,1.4)
S DIH=$S($D(^IBA(364.6,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,8)=DIV,DIH=364.6,DIG=.08 D ^DICR
"^DD",364.6,364.6,.03,1,4,2)
Q
"^DD",364.6,364.6,.03,1,4,3)
DO NOT DELETE
"^DD",364.6,364.6,.03,1,4,69.2)
S I(0,0)=$S($D(D0):D0,1:""),Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:""),D0=$P(Y(1),U,1) S:'$D(^IBE(353,+D0,0)) D0=-1 S Y(102)=$C(59)_$S($D(^DD(353,2.02,0)):$P(^(0),U,3),1:"")
"^DD",364.6,364.6,.03,1,4,"%D",0)
^^2^2^3000405^
"^DD",364.6,364.6,.03,1,4,"%D",1,0)
If an associated form that is not a screen form, column is taken from the
"^DD",364.6,364.6,.03,1,4,"%D",2,0)
associated with field definition.
"^DD",364.6,364.6,.03,1,4,"CREATE CONDITION")
BILL FORM:FORMAT TYPE'="BILLING SCREEN"
"^DD",364.6,364.6,.03,1,4,"CREATE VALUE")
@
"^DD",364.6,364.6,.03,1,4,"DELETE VALUE")
NO EFFECT
"^DD",364.6,364.6,.03,1,4,"DT")
3000405
"^DD",364.6,364.6,.03,1,4,"FIELD")
STARTING COLUMN
"^DD",364.6,364.6,.03,1,5,0)
^^TRIGGER^364.6^.09
"^DD",364.6,364.6,.03,1,5,1)
X ^DD(364.6,.03,1,5,1.3) I X S X=DIV S Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,9),X=X S DIU=X K Y S X="" X ^DD(364.6,.03,1,5,1.4)
"^DD",364.6,364.6,.03,1,5,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(364.6,.03,1,5,69.2) S Y(101)=$S($D(^IBE(353,D0,2)):^(2),1:"") S X=$P($P(Y(102),$C(59)_$P(Y(101),U,2)_":",2),$C(59),1)'="BILLING SCREEN" S D0=I(0,0)
"^DD",364.6,364.6,.03,1,5,1.4)
S DIH=$S($D(^IBA(364.6,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,9)=DIV,DIH=364.6,DIG=.09 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.6,364.6,.03,1,5,2)
Q
"^DD",364.6,364.6,.03,1,5,3)
DO NOT DELETE
"^DD",364.6,364.6,.03,1,5,69.2)
S I(0,0)=$S($D(D0):D0,1:""),Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:""),D0=$P(Y(1),U,1) S:'$D(^IBE(353,+D0,0)) D0=-1 S Y(102)=$C(59)_$S($D(^DD(353,2.02,0)):$P(^(0),U,3),1:"")
"^DD",364.6,364.6,.03,1,5,"%D",0)
^^2^2^3000405^
"^DD",364.6,364.6,.03,1,5,"%D",1,0)
If an associated form that is not a screen form, length is taken from the
"^DD",364.6,364.6,.03,1,5,"%D",2,0)
associated with field definition.
"^DD",364.6,364.6,.03,1,5,"CREATE CONDITION")
BILL FORM:FORMAT TYPE'="BILLING SCREEN"
"^DD",364.6,364.6,.03,1,5,"CREATE VALUE")
@
"^DD",364.6,364.6,.03,1,5,"DELETE VALUE")
NO EFFECT
"^DD",364.6,364.6,.03,1,5,"DT")
3000405
"^DD",364.6,364.6,.03,1,5,"FIELD")
LENGTH
"^DD",364.6,364.6,.03,1,6,0)
^^TRIGGER^364.6^.06
"^DD",364.6,364.6,.03,1,6,1)
X ^DD(364.6,.03,1,6,1.3) I X S X=DIV S Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,6),X=X S DIU=X K Y S X="" X ^DD(364.6,.03,1,6,1.4)
"^DD",364.6,364.6,.03,1,6,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(364.6,.03,1,6,69.2) S Y(101)=$S($D(^IBE(353,D0,2)):^(2),1:"") S X=$P($P(Y(102),$C(59)_$P(Y(101),U,2)_":",2),$C(59),1)'="BILLING SCREEN" S D0=I(0,0)
"^DD",364.6,364.6,.03,1,6,1.4)
S DIH=$S($D(^IBA(364.6,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,6)=DIV,DIH=364.6,DIG=.06 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.6,364.6,.03,1,6,2)
Q
"^DD",364.6,364.6,.03,1,6,3)
DO NOT DELETE
"^DD",364.6,364.6,.03,1,6,69.2)
S I(0,0)=$S($D(D0):D0,1:""),Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:""),D0=$P(Y(1),U,1) S:'$D(^IBE(353,+D0,0)) D0=-1 S Y(102)=$C(59)_$S($D(^DD(353,2.02,0)):$P(^(0),U,3),1:"")
"^DD",364.6,364.6,.03,1,6,"%D",0)
^^2^2^3000405^
"^DD",364.6,364.6,.03,1,6,"%D",1,0)
If associated form that is not a screen form, the max number lines is taken
"^DD",364.6,364.6,.03,1,6,"%D",2,0)
from the associated with field definition.
"^DD",364.6,364.6,.03,1,6,"CREATE CONDITION")
BILL FORM:FORMAT TYPE'="BILLING SCREEN"
"^DD",364.6,364.6,.03,1,6,"CREATE VALUE")
@
"^DD",364.6,364.6,.03,1,6,"DELETE VALUE")
NO EFFECT
"^DD",364.6,364.6,.03,1,6,"DT")
3000405
"^DD",364.6,364.6,.03,1,6,"FIELD")
MAX NUMBER LINES
"^DD",364.6,364.6,.03,1,7,0)
^^TRIGGER^364.6^.02
"^DD",364.6,364.6,.03,1,7,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X=DIV S X="L" X ^DD(364.6,.03,1,7,1.4)
"^DD",364.6,364.6,.03,1,7,1.4)
S DIH=$S($D(^IBA(364.6,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,2)=DIV,DIH=364.6,DIG=.02 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.6,364.6,.03,1,7,2)
Q
"^DD",364.6,364.6,.03,1,7,3)
DO NOT DELETE
"^DD",364.6,364.6,.03,1,7,"%D",0)
^^1^1^2960117^
"^DD",364.6,364.6,.03,1,7,"%D",1,0)
Only local entries can be associated.
"^DD",364.6,364.6,.03,1,7,"CREATE VALUE")
"L"
"^DD",364.6,364.6,.03,1,7,"DELETE VALUE")
NO EFFECT
"^DD",364.6,364.6,.03,1,7,"DT")
2960117
"^DD",364.6,364.6,.03,1,7,"FIELD")
SECURITY LEVEL
"^DD",364.6,364.6,.03,3)
Enter the form definition record this definition will override.
"^DD",364.6,364.6,.03,5,1,0)
364.6^.01^4
"^DD",364.6,364.6,.03,21,0)
^^1^1^2960117^^
"^DD",364.6,364.6,.03,21,1,0)
The form definition record this definition will override.
"^DD",364.6,364.6,.03,"DT")
3000414
"^DD",364.6,364.6,.04,0)
PAGE OR SEQUENCE^FX^^0;4^K:$L(X)>20!($L(X)<1) X I $D(X),$S($P($G(^IBE(353,+$G(^IBA(364.6,+DA,0)),2)),U,2)="S":0,1:$P($G(^IBA(364.6,DA,0)),U,3))!$$DUP^IBCEFG0(DA,X,2) K X
"^DD",364.6,364.6,.04,1,0)
^.1^^-1
"^DD",364.6,364.6,.04,1,1,0)
364.6^ASEQ1^MUMPS
"^DD",364.6,364.6,.04,1,1,1)
N Z0,Z1,Z2,Z3 S Z0=$G(^IBA(364.6,DA,0)),Z1=+Z0,Z2=$P(Z0,U,5),Z3=$P(Z0,U,8) I Z1,Z2,Z3 S ^IBA(364.6,"ASEQ",Z1,$E(X,1,30),Z2,Z3,DA)=""
"^DD",364.6,364.6,.04,1,1,2)
N Z0,Z1,Z2,Z3 S Z0=$G(^IBA(364.6,DA,0)),Z1=+Z0,Z2=$P(Z0,U,5),Z3=$P(Z0,U,8) I Z1,Z2,Z3 K ^IBA(364.6,"ASEQ",Z1,$E(X,1,30),Z2,Z3,DA)
"^DD",364.6,364.6,.04,1,1,3)
DO NOT DELETE
"^DD",364.6,364.6,.04,1,1,"%D",0)
^^1^1^2960117^
"^DD",364.6,364.6,.04,1,1,"%D",1,0)
This xref contains the sequence to use to extract or print the form fields.
"^DD",364.6,364.6,.04,1,1,"DT")
2960117
"^DD",364.6,364.6,.04,3)
This data must be 1-20 char long, can't be an assoc form, and must be a unique form/page/line/column.
"^DD",364.6,364.6,.04,5,1,0)
364.6^.03^2
"^DD",364.6,364.6,.04,21,0)
^^4^4^2960318^^^^
"^DD",364.6,364.6,.04,21,1,0)
This field is used to specify the page, section, transaction segment, etc.
"^DD",364.6,364.6,.04,21,2,0)
that the data element is to be associated with.  This field will be used as
"^DD",364.6,364.6,.04,21,3,0)
the second-level sort field when extracting data fields for this form.
"^DD",364.6,364.6,.04,21,4,0)
The combination of form/page/line/column must be unique.
"^DD",364.6,364.6,.04,"DT")
3000428
"^DD",364.6,364.6,.05,0)
FIRST LINE NUMBER^NJ4,0X^^0;5^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X I $D(X),$S($P($G(^IBE(353,+$G(^IBA(364.6,+DA,0)),2)),U,2)="S":0,1:$P($G(^IBA(364.6,DA,0)),U,3))!$$DUP^IBCEFG0(DA,X,3) K X
"^DD",364.6,364.6,.05,.1)
LINE
"^DD",364.6,364.6,.05,1,0)
^.1
"^DD",364.6,364.6,.05,1,1,0)
364.6^ASEQ2^MUMPS
"^DD",364.6,364.6,.05,1,1,1)
N Z0,Z1,Z2,Z3 S Z0=$G(^IBA(364.6,DA,0)),Z1=+Z0,Z2=$P(Z0,U,4),Z3=$P(Z0,U,8) I Z1,Z2'="",Z3 S ^IBA(364.6,"ASEQ",Z1,Z2,$E(X,1,30),Z3,DA)=""
"^DD",364.6,364.6,.05,1,1,2)
N Z0,Z1,Z2,Z3 S Z0=$G(^IBA(364.6,DA,0)),Z1=+Z0,Z2=$P(Z0,U,4),Z3=$P(Z0,U,8) I Z1,Z2'="",Z3 K ^IBA(364.6,"ASEQ",Z1,Z2,$E(X,1,30),Z3,DA)
"^DD",364.6,364.6,.05,1,1,3)
DO NOT DELETE
"^DD",364.6,364.6,.05,1,1,"%D",0)
^^1^1^2960117^^^^
"^DD",364.6,364.6,.05,1,1,"%D",1,0)
This xref contains the sequence to use to extract or print the form fields.
"^DD",364.6,364.6,.05,1,1,"DT")
2960117
"^DD",364.6,364.6,.05,3)
Type a # 0-9999, 0 Decimals, can't be assoc form, need unique form/pg/line/col.
"^DD",364.6,364.6,.05,5,1,0)
364.6^.03^3
"^DD",364.6,364.6,.05,21,0)
^^5^5^2960318^^^
"^DD",364.6,364.6,.05,21,1,0)
If this is a printed form, this is the first line number that this data
"^DD",364.6,364.6,.05,21,2,0)
element will appear on.  For transmitted forms, this is assumed to always
"^DD",364.6,364.6,.05,21,3,0)
be a 1.  This will be used as the third-level sort field when extracting
"^DD",364.6,364.6,.05,21,4,0)
data fields for this form.  The combination of form/page/line/column must
"^DD",364.6,364.6,.05,21,5,0)
be unique.
"^DD",364.6,364.6,.05,"DT")
3000428
"^DD",364.6,364.6,.06,0)
MAX NUMBER LINES^NJ3,0X^^0;6^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X I $D(X),$P($G(^IBA(364.6,DA,0)),U,3) K X
"^DD",364.6,364.6,.06,3)
Type a Number between 0 and 999, 0 Decimal Digits (can't be an associated form).
"^DD",364.6,364.6,.06,5,1,0)
364.6^.03^6
"^DD",364.6,364.6,.06,21,0)
^^2^2^2951205^
"^DD",364.6,364.6,.06,21,1,0)
If a printed form, this is the highest numbered line number that this data
"^DD",364.6,364.6,.06,21,2,0)
element is allowed to print on.
"^DD",364.6,364.6,.06,"DT")
2960117
"^DD",364.6,364.6,.07,0)
LOCAL OVERRIDE ALLOWED^S^0:NO;1:YES;^0;7^Q
"^DD",364.6,364.6,.07,3)
Enter 0 (NO) to prevent local override, 1 to allow local override.
"^DD",364.6,364.6,.07,21,0)
^.001^2^2^3020822^^
"^DD",364.6,364.6,.07,21,1,0)
This controls whether or not the output forms generator will allow for a
"^DD",364.6,364.6,.07,21,2,0)
redefinition of this record via a local override.
"^DD",364.6,364.6,.07,"DT")
2960311
"^DD",364.6,364.6,.08,0)
STARTING COLUMN OR PIECE^NJ3,1X^^0;8^K:+X'=X!(X>999)!(X<0)!($S(X[".":X'?.E1"."1.2N,1:0)) X I $D(X),$S($P($G(^IBE(353,+$G(^IBA(364.6,+DA,0)),2)),U,2)="S":0,1:$P($G(^IBA(364.6,DA,0)),U,3))!$$DUP^IBCEFG0(DA,X,4) K X
"^DD",364.6,364.6,.08,.1)
COLUMN
"^DD",364.6,364.6,.08,1,0)
^.1
"^DD",364.6,364.6,.08,1,1,0)
364.6^ASEQ3^MUMPS
"^DD",364.6,364.6,.08,1,1,1)
N Z0,Z1,Z2,Z3 S Z0=$G(^IBA(364.6,DA,0)),Z1=+Z0,Z2=$P(Z0,U,4),Z3=$P(Z0,U,5) I Z1,Z2'="",Z3 S ^IBA(364.6,"ASEQ",Z1,Z2,Z3,$E(X,1,30),DA)=""
"^DD",364.6,364.6,.08,1,1,2)
N Z0,Z1,Z2,Z3 S Z0=$G(^IBA(364.6,DA,0)),Z1=+Z0,Z2=$P(Z0,U,4),Z3=$P(Z0,U,5) I Z1,Z2'="",Z3 K ^IBA(364.6,"ASEQ",Z1,Z2,Z3,$E(X,1,30),DA)
"^DD",364.6,364.6,.08,1,1,3)
DO NOT DELETE
"^DD",364.6,364.6,.08,1,1,"%D",0)
^^1^1^2960117^
"^DD",364.6,364.6,.08,1,1,"%D",1,0)
This xref contains the sequence to use to extract or print the form fields.
"^DD",364.6,364.6,.08,1,1,"DT")
2960117
"^DD",364.6,364.6,.08,1,2,0)
^^TRIGGER^364.6^.11
"^DD",364.6,364.6,.08,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=Y(0)["." I X S X=DIV S Y(1)=$S($D(^IBA(364.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,11),X=X S DIU=X K Y S X=DIV S X=1 X ^DD(364.6,.08,1,2,1.4)
"^DD",364.6,364.6,.08,1,2,1.4)
S DIH=$S($D(^IBA(364.6,DIV(0),0)):^(0),1:""),DIV=X S $P(^(0),U,11)=DIV,DIH=364.6,DIG=.11 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",364.6,364.6,.08,1,2,2)
Q
"^DD",364.6,364.6,.08,1,2,3)
DO NOT DELETE
"^DD",364.6,364.6,.08,1,2,"%D",0)
^^2^2^2960126^^^
"^DD",364.6,364.6,.08,1,2,"%D",1,0)
If the starting column or piece is not a whole number, this must be a
"^DD",364.6,364.6,.08,1,2,"%D",2,0)
calculate only field - no output.
"^DD",364.6,364.6,.08,1,2,"CREATE CONDITION")
STARTING COLUMN OR PIECE["."
"^DD",364.6,364.6,.08,1,2,"CREATE VALUE")
S X=1
"^DD",364.6,364.6,.08,1,2,"DELETE VALUE")
NO EFFECT
"^DD",364.6,364.6,.08,1,2,"DT")
2960126
"^DD",364.6,364.6,.08,1,2,"FIELD")
#.11
"^DD",364.6,364.6,.08,3)
Type a # 0-9999, 1-2 Decimals, can't be assoc form, need unique form/pg/line/col.
"^DD",364.6,364.6,.08,5,1,0)
364.6^.03^4
"^DD",364.6,364.6,.08,21,0)
^^5^5^2960318^^^^
"^DD",364.6,364.6,.08,21,1,0)
This is the column on the form, position in the data string (for non-printed
"^DD",364.6,364.6,.08,21,2,0)
forms) -  starting at position 1, or delimited piece that this data element
"^DD",364.6,364.6,.08,21,3,0)
is to be printed or stored in.  This will be used as the fourth-level sort
"^DD",364.6,364.6,.08,21,4,0)
field when extracting data fields for this form.  The combination of
"^DD",364.6,364.6,.08,21,5,0)
form/page/line/column must be unique.
"^DD",364.6,364.6,.08,"DT")
3000428
"^DD",364.6,364.6,.09,0)
LENGTH^NJ3,0X^^0;9^K:+X'=X!(X>250)!(X<1)!(X?.E1"."1N.N) X I $D(X),$P($G(^IBA(364.6,DA,0)),U,3),$P($G(^IBE(353,+^IBA(364.6,DA,0),2)),U,2)'="S" K X
"^DD",364.6,364.6,.09,3)
Type a Number between 1 and 250, 0 Decimal Digits (can't be an associated form).
"^DD",364.6,364.6,.09,5,1,0)
364.6^.03^5
"^DD",364.6,364.6,.09,21,0)
^^3^3^2951205^
"^DD",364.6,364.6,.09,21,1,0)
The length desired for the data element.  If present, this field will be used
"^DD",364.6,364.6,.09,21,2,0)
to truncate or pad the data element to this length after the element has been
"^DD",364.6,364.6,.09,21,3,0)
passed through the routine identified in the FORMAT ROUTINE field.
"^DD",364.6,364.6,.09,"DT")
3000111
"^DD",364.6,364.6,.1,0)
SHORT DESCRIPTION^F^^0;10^K:$L(X)>40!($L(X)<1) X
"^DD",364.6,364.6,.1,1,0)
^.1^^0
"^DD",364.6,364.6,.1,3)
Answer must be 1-40 characters in length
"^DD",364.6,364.6,.1,21,0)
^^2^2^3071126^
"^DD",364.6,364.6,.1,21,1,0)
This is a short description of the field that is used as an identifier to
"^DD",364.6,364.6,.1,21,2,0)
make lookups on this file meaningful.
"^DD",364.6,364.6,.1,"DT")
3080310
"^DD",364.6,364.6,.11,0)
CALCULATE ONLY OR OUTPUT^S^1:CALCULATE ONLY;0:OUTPUT;^0;11^Q
"^DD",364.6,364.6,.11,3)
Enter 1 if this field is used for calculation purposes and is not meant to be output
"^DD",364.6,364.6,.11,5,1,0)
364.6^.08^2
"^DD",364.6,364.6,.11,21,0)
^^4^4^2960715^^^^
"^DD",364.6,364.6,.11,21,1,0)
This field is set to 1 if there is a need to do a special extract or
"^DD",364.6,364.6,.11,21,2,0)
calculation at some point in the processing, but no output is desired
"^DD",364.6,364.6,.11,21,3,0)
from the field's code execution.  Used to set up arrays for group elements
"^DD",364.6,364.6,.11,21,4,0)
then the individual elements are output separately.
"^DD",364.6,364.6,.11,"DT")
2960715
"^DD",364.6,364.6,.12,0)
TRANSMIT IGNORES IF NULL^S^0:FALSE;1:TRUE;^0;12^Q
"^DD",364.6,364.6,.12,3)
Enter 1 (TRUE) if there should be no entry made in the output global if the data value of the element is null.
"^DD",364.6,364.6,.12,21,0)
^.001^5^5^3001030^^^
"^DD",364.6,364.6,.12,21,1,0)
This field can be used to suppress output of a field if its value is null.
"^DD",364.6,364.6,.12,21,2,0)
If not suppressed, an entry is made in the output global used by the
"^DD",364.6,364.6,.12,21,3,0)
formatter, regardless of the contents of the data for this field.
"^DD",364.6,364.6,.12,21,4,0)
Supressing the value results in no output to the formatter's output
"^DD",364.6,364.6,.12,21,5,0)
global if the value of the data for this field is determined to be null.
"^DD",364.6,364.6,.12,"DT")
2991006
"^DD",364.6,364.6,.13,0)
DATA REQUIRED FOR FIELD^S^1:YES;0:NO;^0;13^Q
"^DD",364.6,364.6,.13,3)
Enter yes if there should always be data in this field.
"^DD",364.6,364.6,.13,21,0)
^^2^2^3000216^
"^DD",364.6,364.6,.13,21,1,0)
This field is a flag that will stop the output of a record if this field
"^DD",364.6,364.6,.13,21,2,0)
indicates data is required and the data extracted is null.
"^DD",364.6,364.6,.13,"DT")
3000216
"^DD",364.7,364.7,0)
FIELD^^3^12
"^DD",364.7,364.7,0,"DDA")
N
"^DD",364.7,364.7,0,"DT")
2960710
"^DD",364.7,364.7,0,"ID",.03)
S %I=Y,Y=$S('$D(^(0)):"",$D(^IBA(364.5,+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(364.5,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",364.7,364.7,0,"IX","AINS",364.7,.01)

"^DD",364.7,364.7,0,"IX","AINS1",364.7,.05)

"^DD",364.7,364.7,0,"IX","AINTYP",364.7,.01)

"^DD",364.7,364.7,0,"IX","AINTYP1",364.7,.05)

"^DD",364.7,364.7,0,"IX","AINTYP2",364.7,.06)

"^DD",364.7,364.7,0,"IX","ATYPE",364.7,.01)

"^DD",364.7,364.7,0,"IX","ATYPE1",364.7,.06)

"^DD",364.7,364.7,0,"IX","B",364.7,.01)

"^DD",364.7,364.7,0,"IX","C",364.7,.03)

"^DD",364.7,364.7,0,"NM","IB FORM FIELD CONTENT")
 
"^DD",364.7,364.7,0,"VRPK")
IB
"^DD",364.7,364.7,.01,0)
FORM FIELD REFERENCE^RP364.6'^IBA(364.6,^0;1^Q
"^DD",364.7,364.7,.01,1,0)
^.1
"^DD",364.7,364.7,.01,1,1,0)
364.7^B
"^DD",364.7,364.7,.01,1,1,1)
S ^IBA(364.7,"B",$E(X,1,30),DA)=""
"^DD",364.7,364.7,.01,1,1,2)
K ^IBA(364.7,"B",$E(X,1,30),DA)
"^DD",364.7,364.7,.01,1,2,0)
364.7^ATYPE^MUMPS
"^DD",364.7,364.7,.01,1,2,1)
N Z1,Z0 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,6) I Z1'="",$P($G(^IBA(364.6,+X,0)),U,3),'$P(Z0,U,5) S ^IBA(364.7,"ATYPE",$P(^IBA(364.6,+X,0),U,3),Z1,DA)=""
"^DD",364.7,364.7,.01,1,2,2)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,6) I Z1'="",$P($G(^IBA(364.6,+X,0)),U,3) K ^IBA(364.7,"ATYPE",$P(^IBA(364.6,+X,0),U,3),Z1,DA)
"^DD",364.7,364.7,.01,1,2,3)
DO NOT DELETE
"^DD",364.7,364.7,.01,1,2,"%D",0)
^^1^1^2980104^^^^
"^DD",364.7,364.7,.01,1,2,"%D",1,0)
Xref by form and bill type
"^DD",364.7,364.7,.01,1,2,"DT")
2960117
"^DD",364.7,364.7,.01,1,3,0)
364.7^AINTYP^MUMPS
"^DD",364.7,364.7,.01,1,3,1)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,5),Z2=$P(Z0,U,6) I Z1,Z2'="",$P($G(^IBA(364.6,+X,0)),U,3) S ^IBA(364.7,"AINTYP",$P(^IBA(364.6,+X,0),U,3),Z1,Z2,DA)=""
"^DD",364.7,364.7,.01,1,3,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,5),Z2=$P(Z0,U,6) I Z1,Z2'="",$P($G(^IBA(364.6,+X,0)),U,3) K ^IBA(364.7,"AINTYP",$P(^IBA(364.6,+X,0),U,3),Z1,Z2,DA)
"^DD",364.7,364.7,.01,1,3,3)
DO NOT DELETE
"^DD",364.7,364.7,.01,1,3,"%D",0)
^^1^1^2971231^^^
"^DD",364.7,364.7,.01,1,3,"%D",1,0)
Xref by form, insurance company and bill type
"^DD",364.7,364.7,.01,1,3,"DT")
2960117
"^DD",364.7,364.7,.01,1,4,0)
364.7^AINS^MUMPS
"^DD",364.7,364.7,.01,1,4,1)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,5) I Z1,$P($G(^IBA(364.6,+X,0)),U,3),$P(Z0,U,6)="" S ^IBA(364.7,"AINS",$P(^IBA(364.6,+X,0),U,3),Z1,DA)=""
"^DD",364.7,364.7,.01,1,4,2)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P(Z0,U,5) I Z1,$P($G(^IBA(364.6,+X,0)),U,3) K ^IBA(364.7,"AINS",$P(^IBA(364.6,+X,0),U,3),Z1,DA)
"^DD",364.7,364.7,.01,1,4,3)
DO NOT DELETE
"^DD",364.7,364.7,.01,1,4,"%D",0)
^^1^1^2971231^^
"^DD",364.7,364.7,.01,1,4,"%D",1,0)
Xref by form field and insurance company
"^DD",364.7,364.7,.01,1,4,"DT")
2960118
"^DD",364.7,364.7,.01,3)
Enter the billing form that this field is associated with
"^DD",364.7,364.7,.01,21,0)
^^2^2^2951207^^^^
"^DD",364.7,364.7,.01,21,1,0)
This is a pointer to the billing form field that this field is associated
"^DD",364.7,364.7,.01,21,2,0)
with.
"^DD",364.7,364.7,.01,"DT")
3000428
"^DD",364.7,364.7,.02,0)
SECURITY LEVEL^S^N:NATIONAL,NO EDIT;L:LOCAL;^0;2^Q
"^DD",364.7,364.7,.02,3)
Enter N for nationally released fields (no edit) or L for locally added fields.
"^DD",364.7,364.7,.02,21,0)
^^3^3^2951219^^^
"^DD",364.7,364.7,.02,21,1,0)
This field determines whether or not editing of the entry is allowed.  For
"^DD",364.7,364.7,.02,21,2,0)
NATIONAL (N) field, no local editing is allowed.  If LOCAL (L) field is
"^DD",364.7,364.7,.02,21,3,0)
created, editing is allowed.
"^DD",364.7,364.7,.02,"DT")
3000428
"^DD",364.7,364.7,.03,0)
DATA ELEMENT^P364.5'^IBA(364.5,^0;3^Q
"^DD",364.7,364.7,.03,1,0)
^.1
"^DD",364.7,364.7,.03,1,1,0)
364.7^C
"^DD",364.7,364.7,.03,1,1,1)
S ^IBA(364.7,"C",$E(X,1,30),DA)=""
"^DD",364.7,364.7,.03,1,1,2)
K ^IBA(364.7,"C",$E(X,1,30),DA)
"^DD",364.7,364.7,.03,1,1,3)
DO NOT DELETE
"^DD",364.7,364.7,.03,1,1,"%D",0)
^^1^1^2960702^
"^DD",364.7,364.7,.03,1,1,"%D",1,0)
Xref by DATA ELEMENT NAME
"^DD",364.7,364.7,.03,1,1,"DT")
2960702
"^DD",364.7,364.7,.03,3)
Enter the data element that will define this form field.  If used on a screen, it must be a fileman type.
"^DD",364.7,364.7,.03,21,0)
^^1^1^2960627^^^^
"^DD",364.7,364.7,.03,21,1,0)
This identifies the data element that be extracted for this entry.
"^DD",364.7,364.7,.03,23,0)
^^4^4^2960627^^^^
"^DD",364.7,364.7,.03,23,1,0)
This is the data element that will be allowed to be displayed/edited on a
"^DD",364.7,364.7,.03,23,2,0)
screen, extracted for a transmit, or printed on a printed form.  If used on
"^DD",364.7,364.7,.03,23,3,0)
a screen, the data element must be a fileman type and a local field (>10000
"^DD",364.7,364.7,.03,23,4,0)
for ifn and on a node >10000) to be editable.
"^DD",364.7,364.7,.03,"DT")
2960702
"^DD",364.7,364.7,.04,0)
SCREEN PROMPT^FX^^0;4^K:$L(X)>70!($L(X)<1) X I $D(X),$P($G(^IBE(353,+$G(^IBA(364.6,+$G(^IBA(364.7,DA,0)),0)),2)),U,2)'="S" K X
"^DD",364.7,364.7,.04,.1)
 
"^DD",364.7,364.7,.04,1,0)
^.1^^0
"^DD",364.7,364.7,.04,3)
Answer must be 1-70 characters in length.
"^DD",364.7,364.7,.04,21,0)
3^^2^2^2960321^^^^
"^DD",364.7,364.7,.04,21,1,0)
This is used only by screen-type forms to place a prompt on the screen
"^DD",364.7,364.7,.04,21,2,0)
for a particular field.
"^DD",364.7,364.7,.04,23,0)
^^3^3^2960321^^^^
"^DD",364.7,364.7,.04,23,1,0)
This is the prompt that will preceed the data element defined for this
"^DD",364.7,364.7,.04,23,2,0)
entry.  If no data element, this prompt will display.  This field is only
"^DD",364.7,364.7,.04,23,3,0)
used for screen-type forms.
"^DD",364.7,364.7,.04,"DT")
2960321
"^DD",364.7,364.7,.05,0)
INSURANCE COMPANY^P36'^DIC(36,^0;5^Q
"^DD",364.7,364.7,.05,1,0)
^.1
"^DD",364.7,364.7,.05,1,1,0)
364.7^AINS1^MUMPS
"^DD",364.7,364.7,.05,1,1,1)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P($G(^IBA(364.6,+Z0,0)),U,3) I Z1,$P(Z0,U,6)="" S ^IBA(364.7,"AINS",Z1,$E(X,1,30),DA)=""
"^DD",364.7,364.7,.05,1,1,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,6) K ^IBA(364.7,"AINS",Z1,$E(X,1,30),DA) I Z2'="",$D(^IBA(364.7,"AINTYP",Z1,X,Z2,DA)) S ^IBA(364.7,"ATYPE",Z1,Z2,DA)=""
"^DD",364.7,364.7,.05,1,1,3)
DO NOT DELETE
"^DD",364.7,364.7,.05,1,1,"%D",0)
^^1^1^2960118^
"^DD",364.7,364.7,.05,1,1,"%D",1,0)
Xref by form field and insurance company.
"^DD",364.7,364.7,.05,1,1,"DT")
2960118
"^DD",364.7,364.7,.05,1,2,0)
364.7^AINTYP1^MUMPS
"^DD",364.7,364.7,.05,1,2,1)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=+$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,6) I Z1,Z2'="" S ^IBA(364.7,"AINTYP",Z1,$E(X,1,30),Z2,DA)="" K ^IBA(364.7,"ATYPE",Z1,Z2,DA),^IBA(364.7,"AINS",Z1,X,DA)
"^DD",364.7,364.7,.05,1,2,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=+$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,6) K:Z1&(Z2'="") ^IBA(364.7,"AINTYP",Z1,$E(X,1,30),Z2,DA)
"^DD",364.7,364.7,.05,1,2,3)
DO NOT DELETE
"^DD",364.7,364.7,.05,1,2,"%D",0)
^^1^1^2960117^^^^
"^DD",364.7,364.7,.05,1,2,"%D",1,0)
Xref by insurance company and bill type
"^DD",364.7,364.7,.05,1,2,"DT")
2960117
"^DD",364.7,364.7,.05,3)
Enter the name of the insurance company that this field is associated with.
"^DD",364.7,364.7,.05,21,0)
^^2^2^2951207^
"^DD",364.7,364.7,.05,21,1,0)
This is the insurance company who has a need for other than the standard
"^DD",364.7,364.7,.05,21,2,0)
data in this field.
"^DD",364.7,364.7,.05,"DT")
3000428
"^DD",364.7,364.7,.06,0)
BILL TYPE^S^I:INPATIENT;O:OUTPATIENT;^0;6^Q
"^DD",364.7,364.7,.06,1,0)
^.1
"^DD",364.7,364.7,.06,1,1,0)
364.7^ATYPE1^MUMPS
"^DD",364.7,364.7,.06,1,1,1)
N Z0,Z1 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P($G(^IBA(364.6,+Z0,0)),U,3) I Z1,'$P(Z0,U,5) S ^IBA(364.7,"ATYPE",Z1,$E(X,1,30),DA)=""
"^DD",364.7,364.7,.06,1,1,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,5) I Z1 K ^IBA(364.7,"ATYPE",Z1,$E(X,1,30),DA) I Z2,$D(^IBA(364.7,"AINTYP",Z1,Z2,X,DA)) S ^IBA(364.7,"AINS",Z1,Z2,DA)=""
"^DD",364.7,364.7,.06,1,1,3)
DO NOT DELETE
"^DD",364.7,364.7,.06,1,1,"%D",0)
^^1^1^2960117^^
"^DD",364.7,364.7,.06,1,1,"%D",1,0)
Xref by form and bill type.
"^DD",364.7,364.7,.06,1,1,"DT")
2960117
"^DD",364.7,364.7,.06,1,2,0)
364.7^AINTYP2^MUMPS
"^DD",364.7,364.7,.06,1,2,1)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=+$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,5) I Z1,Z2 K:'$D(^IBA(364.7,"AINTYP",Z1,Z2,X,DA)) ^IBA(364.7,"AINS",Z1,Z2,DA) S ^IBA(364.7,"AINTYP",Z1,Z2,$E(X,1,30),DA)=""
"^DD",364.7,364.7,.06,1,2,2)
N Z0,Z1,Z2 S Z0=$G(^IBA(364.7,DA,0)),Z1=+$P($G(^IBA(364.6,+Z0,0)),U,3),Z2=$P(Z0,U,5) K:Z1&Z2 ^IBA(364.7,"AINTYP",Z1,Z2,$E(X,1,30),DA)
"^DD",364.7,364.7,.06,1,2,3)
DO NOT DELETE
"^DD",364.7,364.7,.06,1,2,"%D",0)
^^1^1^2960117^^^^
"^DD",364.7,364.7,.06,1,2,"%D",1,0)
Xref by form, insurance company and bill type
"^DD",364.7,364.7,.06,1,2,"DT")
2960117
"^DD",364.7,364.7,.06,3)
Enter the type of the bill.
"^DD",364.7,364.7,.06,21,0)
^^1^1^2960117^^
"^DD",364.7,364.7,.06,21,1,0)
This is the type of bill that requires this field.
"^DD",364.7,364.7,.06,"DT")
3000428
"^DD",364.7,364.7,.07,0)
PAD CHARACTER^S^ZL:ZERO PAD ON LEFT;ZR:ZERO PAD ON RIGHT;SL:SPACE PAD ON LEFT;SR:SPACE PAD ON RIGHT;N:NO PAD REQUIRED;^0;7^Q
"^DD",364.7,364.7,.07,3)
Enter the code that corresponds to the format and pad character to use for the data output in this field.
"^DD",364.7,364.7,.07,21,0)
^^3^3^2960126^^
"^DD",364.7,364.7,.07,21,1,0)
If present, this defines the character to be used to pad the DATA
"^DD",364.7,364.7,.07,21,2,0)
ELEMENT to its desired length and the orientation of the padding characters
"^DD",364.7,364.7,.07,21,3,0)
to the left or right of the data.  The default is space pad to the right.
"^DD",364.7,364.7,.07,"DT")
2960126
"^DD",364.7,364.7,.08,0)
REQUIRED^S^0:NO;1:YES;^0;8^Q
"^DD",364.7,364.7,.08,3)
Enter 1 (YES) if this data element is on a local screen 9 form and the data is required for the bill to be authorized.
"^DD",364.7,364.7,.08,21,0)
^.001^4^4^3001030^^
"^DD",364.7,364.7,.08,21,1,0)
This field controls the required/not required status of a data element
"^DD",364.7,364.7,.08,21,2,0)
on a local screen 9 form.  If this field is 1 (YES), this data element
"^DD",364.7,364.7,.08,21,3,0)
is always required to have data (not null) in order for a bill to be
"^DD",364.7,364.7,.08,21,4,0)
authorized.
"^DD",364.7,364.7,.08,"DT")
2951207
"^DD",364.7,364.7,.09,0)
EDIT STATUS^S^E:EDITABLE;D:DISPLAY ONLY;^0;9^Q
"^DD",364.7,364.7,.09,3)
Enter 'E' to enable editing for this field, 'D' for a display only field.
"^DD",364.7,364.7,.09,21,0)
^^2^2^2960320^
"^DD",364.7,364.7,.09,21,1,0)
This field is used to control whether or not a data element on a screen is
"^DD",364.7,364.7,.09,21,2,0)
editable or for display-only purposes.
"^DD",364.7,364.7,.09,"DT")
2960320
"^DD",364.7,364.7,.1,0)
EDIT GROUP NUMBER^NJ2,0^^0;10^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",364.7,364.7,.1,3)
 Enter the edit group # that this field will be included in.  Valid #'s are 1-99.
"^DD",364.7,364.7,.1,21,0)
^^6^6^2960321^^
"^DD",364.7,364.7,.1,21,1,0)
This field contains the # of the edit group that the screen data element
"^DD",364.7,364.7,.1,21,2,0)
will be included with.  When this group # is selected on an edit screen,
"^DD",364.7,364.7,.1,21,3,0)
all data elements assigned to this group # on this screen will be presented
"^DD",364.7,364.7,.1,21,4,0)
for editing.  If no # is entered here, this field will not be available for
"^DD",364.7,364.7,.1,21,5,0)
editing.  This field will only apply to screen-type forms' editable data
"^DD",364.7,364.7,.1,21,6,0)
element descriptions.
"^DD",364.7,364.7,.1,"DT")
2960321
"^DD",364.7,364.7,1,0)
FORMAT CODE^K^^1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",364.7,364.7,1,3)
This is Standard MUMPS code.
"^DD",364.7,364.7,1,9)
@
"^DD",364.7,364.7,1,21,0)
^^8^8^2951207^
"^DD",364.7,364.7,1,21,1,0)
This is the code that will be xecuted to format the 'raw' data element
"^DD",364.7,364.7,1,21,2,0)
value that is returned from the execution of the DATA ELEMENT's definition.
"^DD",364.7,364.7,1,21,3,0)
This code can assume the variable/array IBXDATA is available as input and
"^DD",364.7,364.7,1,21,4,0)
should set this variable/array as its output.  Standard calls for data
"^DD",364.7,364.7,1,21,5,0)
formatting have been provided.  The variables IBXPG, IBXLN, IBXCOL are the
"^DD",364.7,364.7,1,21,6,0)
only IBX* variables that should be changed in this routine.  These represent
"^DD",364.7,364.7,1,21,7,0)
the page, line, column as the first 3 levels of subscript for the output
"^DD",364.7,364.7,1,21,8,0)
array.
"^DD",364.7,364.7,1,"DT")
2951207
"^DD",364.7,364.7,3,0)
FORMAT CODE DESCRIPTION^364.73^^3;0
"^DD",364.7,364.7,3,21,0)
^.001^1^1^3010102^^
"^DD",364.7,364.7,3,21,1,0)
This field describes the function of the format code entered.
"^DD",364.7,364.7,3,"DT")
2960710
"^DD",364.7,364.73,0)
FORMAT CODE DESCRIPTION SUB-FIELD^^.01^1
"^DD",364.7,364.73,0,"DT")
2960710
"^DD",364.7,364.73,0,"NM","FORMAT CODE DESCRIPTION")
 
"^DD",364.7,364.73,0,"UP")
364.7
"^DD",364.7,364.73,.01,0)
FORMAT CODE DESCRIPTION^W^^0;1^Q
"^DD",364.7,364.73,.01,3)
Enter a description of the processing logic of the format code.
"^DD",364.7,364.73,.01,21,0)
^.001^1^1^3010102^^^^
"^DD",364.7,364.73,.01,21,1,0)
This is a description of the processing logic of the format code.
"^DD",364.7,364.73,.01,"DT")
2960710
"^DD",399,399,.19,0)
FORM TYPE^R*P353'^IBE(353,^0;19^S DIC("S")="N Z S Z=$G(^IBE(353,Y,2)) I $P(Z,U,2)=""P"",$P(Z,U,4)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",399,399,.19,1,0)
^.1^^-1
"^DD",399,399,.19,1,1,0)
^^TRIGGER^399^.09
"^DD",399,399,.19,1,1,1)
X ^DD(399,.19,1,1,1.3) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,0)):^(0),1:"") S X=$P(Y(1),U,9),X=X S DIU=X K Y S X=DIV S X=5 S DIH=$G(^DGCR(399,DIV(0),0)),DIV=X S $P(^(0),U,9)=DIV,DIH=399,DIG=.09 D ^DICR
"^DD",399,399,.19,1,1,1.3)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(399,.19,1,1,69.2) S X=$P($P(Y(3),$C(59)_$P(Y(2),U,9)_":",2),$C(59))="",Y=X,X=Y(1),X=X&Y
"^DD",399,399,.19,1,1,2)
Q
"^DD",399,399,.19,1,1,69.2)
S Y(3)=$C(59)_$P($G(^DD(399,.09,0)),U,3),Y(2)=$S($D(^DGCR(399,D0,0)):^(0),1:"") S X=$P($G(^IBE(353,+Y(0),0)),U)="CMS-1500",Y(1)=$G(X)
"^DD",399,399,.19,1,1,"%D",0)
^.101^2^2^3101115^^
"^DD",399,399,.19,1,1,"%D",1,0)
If the CMS-1500 claim form is used and no coding method defined, then set
"^DD",399,399,.19,1,1,"%D",2,0)
coding method to HCPCS
"^DD",399,399,.19,1,1,"CREATE CONDITION")
FORM TYPE="CMS-1500"&(PROCEDURE CODING METHOD="")
"^DD",399,399,.19,1,1,"CREATE VALUE")
S X=5
"^DD",399,399,.19,1,1,"DELETE VALUE")
NO EFFECT
"^DD",399,399,.19,1,1,"DT")
3060928
"^DD",399,399,.19,1,1,"FIELD")
PROCEDURE CODING METHOD
"^DD",399,399,.19,1,2,0)
399^AREV7^MUMPS
"^DD",399,399,.19,1,2,1)
S DGRVRCAL=1
"^DD",399,399,.19,1,2,2)
S DGRVRCAL=2
"^DD",399,399,.19,1,2,3)
DO NOT DELETE
"^DD",399,399,.19,1,2,"%D",0)
^^2^2^2940214^
"^DD",399,399,.19,1,2,"%D",1,0)
Variable causes revenue codes and chrges to be re-calculated on return
"^DD",399,399,.19,1,2,"%D",2,0)
to the enter/edit billing screens.
"^DD",399,399,.19,1,2,"DT")
2920428
"^DD",399,399,.19,1,3,0)
399^AH^MUMPS
"^DD",399,399,.19,1,3,1)
D ALLID^IBCEP3(DA,.19,1)
"^DD",399,399,.19,1,3,2)
D ALLID^IBCEP3(DA,.19,2)
"^DD",399,399,.19,1,3,3)
Do not delete
"^DD",399,399,.19,1,3,"%D",0)
^.101^3^3^3101005^^^^
"^DD",399,399,.19,1,3,"%D",1,0)
This cross reference determines if the change of form type requires the
"^DD",399,399,.19,1,3,"%D",2,0)
provider id's to be updated or deleted.  If it does, the update/deletion
"^DD",399,399,.19,1,3,"%D",3,0)
is performed for the claim.
"^DD",399,399,.19,1,3,"DT")
3000926
"^DD",399,399,.19,1,5,0)
399^AJ^MUMPS
"^DD",399,399,.19,1,5,1)
D ATTREND^IBCU1(DA,"","")
"^DD",399,399,.19,1,5,2)
D ATTREND^IBCU1(DA,"","")
"^DD",399,399,.19,1,5,3)
Do Not Delete
"^DD",399,399,.19,1,5,"%D",0)
^.101^14^14^3100621^^^
"^DD",399,399,.19,1,5,"%D",1,0)
This Mumps cross reference is used to potentially trigger 6 other fields 
"^DD",399,399,.19,1,5,"%D",2,0)
in file 399.  The fields are triggered when the insurance companies in the
"^DD",399,399,.19,1,5,"%D",3,0)
claim have flags set to use the attending or rendering physicians as the 
"^DD",399,399,.19,1,5,"%D",4,0)
billing provider secondary IDs.  The flags in file 36 are field #4.06 
"^DD",399,399,.19,1,5,"%D",5,0)
(ATT/REND ID BILL SEC ID PROF) and field 4.08 (ATT/REND ID BILL SEC ID 
"^DD",399,399,.19,1,5,"%D",6,0)
INST).
"^DD",399,399,.19,1,5,"%D",7,0)
 
"^DD",399,399,.19,1,5,"%D",8,0)
The following fields are the ones being "triggered":
"^DD",399,399,.19,1,5,"%D",9,0)
#122 PRIMARY PROVIDER #
"^DD",399,399,.19,1,5,"%D",10,0)
#123 SECONDARY PROVIDER #
"^DD",399,399,.19,1,5,"%D",11,0)
#124 TERTIARY PROVIDER #
"^DD",399,399,.19,1,5,"%D",12,0)
#128 PRIMARY ID QUALIFER
"^DD",399,399,.19,1,5,"%D",13,0)
#129 SECONDARY ID QUALIFIER
"^DD",399,399,.19,1,5,"%D",14,0)
#130 TERTIARY ID QUALIFIER 
"^DD",399,399,.19,1,5,"DT")
3060508
"^DD",399,399,.19,3)
Enter the type of claim form to be used.
"^DD",399,399,.19,5,1,0)
399^.01^7
"^DD",399,399,.19,5,2,0)
399^.27^1
"^DD",399,399,.19,12)
Must be a printable national form type.
"^DD",399,399,.19,12.1)
S DIC("S")="N Z S Z=$G(^IBE(353,Y,2)) I $P(Z,U,2)=""P"",$P(Z,U,4)"
"^DD",399,399,.19,21,0)
^.001^1^1^3100621^^^
"^DD",399,399,.19,21,1,0)
Select the form type on which to print the bill.
"^DD",399,399,.19,23,0)
^.001^1^1^3100621^^^^
"^DD",399,399,.19,23,1,0)
Critical that this field either be a 2 or a 3.
"^DD",399,399,.19,"DT")
3110228
"^DD",399,399,.21,0)
CURRENT BILL PAYER SEQUENCE^*S^P:PRIMARY INSURANCE;S:SECONDARY INSURANCE;T:TERTIARY INSURANCE;A:PATIENT;^0;21^Q
"^DD",399,399,.21,1,0)
^.1
"^DD",399,399,.21,1,1,0)
^^TRIGGER^399^136
"^DD",399,399,.21,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DGCR(399,D0,"MP")):^("MP"),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X=DIV S X=$$BPP^IBCNS2(DA) X ^DD(399,.21,1,1,1.4)
"^DD",399,399,.21,1,1,1.4)
S DIH=$S($D(^DGCR(399,DIV(0),"MP")):^("MP"),1:""),DIV=X S $P(^("MP"),U,2)=DIV,DIH=399,DIG=136 D ^DICR
"^DD",399,399,.21,1,1,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DGCR(399,D0,"MP")):^("MP"),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X="" X ^DD(399,.21,1,1,2.4)
"^DD",399,399,.21,1,1,2.4)
S DIH=$S($D(^DGCR(399,DIV(0),"MP")):^("MP"),1:""),DIV=X S $P(^("MP"),U,2)=DIV,DIH=399,DIG=136 D ^DICR
"^DD",399,399,.21,1,1,"%D",0)
^^2^2^2970821^
"^DD",399,399,.21,1,1,"%D",1,0)
Set the Bill Payer Policy to the Payer Policy corresponding to the Payer
"^DD",399,399,.21,1,1,"%D",2,0)
Sequence.
"^DD",399,399,.21,1,1,"CREATE VALUE")
S X=$$BPP^IBCNS2(DA)
"^DD",399,399,.21,1,1,"DELETE VALUE")
@
"^DD",399,399,.21,1,1,"DT")
2970821
"^DD",399,399,.21,1,1,"FIELD")
BILL PAYER POLICY
"^DD",399,399,.21,1,2,0)
^^TRIGGER^399^24
"^DD",399,399,.21,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=('$$REQMRA^IBEFUNC(DA)&$$NEEDMRA^IBEFUNC(DA)) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X=DIV S X=0 X ^DD(399,.21,1,2,1.4)
"^DD",399,399,.21,1,2,1.4)
S DIH=$G(^DGCR(399,DIV(0),"TX")),DIV=X S $P(^("TX"),U,5)=DIV,DIH=399,DIG=24 D ^DICR
"^DD",399,399,.21,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=('$$REQMRA^IBEFUNC(DA)&$$NEEDMRA^IBEFUNC(DA)) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X="" X ^DD(399,.21,1,2,2.4)
"^DD",399,399,.21,1,2,2.4)
S DIH=$G(^DGCR(399,DIV(0),"TX")),DIV=X S $P(^("TX"),U,5)=DIV,DIH=399,DIG=24 D ^DICR
"^DD",399,399,.21,1,2,"%D",0)
^^4^4^3041108^
"^DD",399,399,.21,1,2,"%D",1,0)
When the payer sequence changes, this trigger will detect if an MRA is no
"^DD",399,399,.21,1,2,"%D",2,0)
longer needed, but the CLAIM MRA STATUS field still indicates than an MRA
"^DD",399,399,.21,1,2,"%D",3,0)
is still needed.  In this case, the CLAIM MRA STATUS is updated to be 0 -
"^DD",399,399,.21,1,2,"%D",4,0)
NO MRA NEEDED.
"^DD",399,399,.21,1,2,"CREATE CONDITION")
('$$REQMRA^IBEFUNC(DA)&$$NEEDMRA^IBEFUNC(DA))
"^DD",399,399,.21,1,2,"CREATE VALUE")
S X=0
"^DD",399,399,.21,1,2,"DELETE CONDITION")
('$$REQMRA^IBEFUNC(DA)&$$NEEDMRA^IBEFUNC(DA))
"^DD",399,399,.21,1,2,"DELETE VALUE")
@
"^DD",399,399,.21,1,2,"DT")
3041108
"^DD",399,399,.21,1,2,"FIELD")
CLAIM MRA STATUS
"^DD",399,399,.21,1,3,0)
^^TRIGGER^399^27
"^DD",399,399,.21,1,3,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=$S($$WNRBILL^IBEFUNC(DA,X):1,1:0) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X="" X ^DD(399,.21,1,3,1.4)
"^DD",399,399,.21,1,3,1.4)
S DIH=$G(^DGCR(399,DIV(0),"TX")),DIV=X S $P(^("TX"),U,8)=DIV,DIH=399,DIG=27 D ^DICR
"^DD",399,399,.21,1,3,2)
Q
"^DD",399,399,.21,1,3,3)
Do not delete
"^DD",399,399,.21,1,3,"%D",0)
^.101^3^3^3101115^^
"^DD",399,399,.21,1,3,"%D",1,0)
If the insurance for the payer sequence is MEDICARE WNR, the
"^DD",399,399,.21,1,3,"%D",2,0)
data in field FORCE CLAIM TO PRINT must be deleted as it is not valid
"^DD",399,399,.21,1,3,"%D",3,0)
to print an MRA request.
"^DD",399,399,.21,1,3,"CREATE CONDITION")
S X=$S($$WNRBILL^IBEFUNC(DA,X):1,1:0)
"^DD",399,399,.21,1,3,"CREATE VALUE")
@
"^DD",399,399,.21,1,3,"DELETE VALUE")
NO EFFECT
"^DD",399,399,.21,1,3,"DT")
3041119
"^DD",399,399,.21,1,3,"FIELD")
FORCE CLAIM TO PRINT
"^DD",399,399,.21,1,4,0)
^^TRIGGER^399^27
"^DD",399,399,.21,1,4,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=$$CREATE^IBCEF84(DA) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X=DIV S X=1 X ^DD(399,.21,1,4,1.4)
"^DD",399,399,.21,1,4,1.4)
S DIH=$G(^DGCR(399,DIV(0),"TX")),DIV=X S $P(^("TX"),U,8)=DIV,DIH=399,DIG=27 D ^DICR
"^DD",399,399,.21,1,4,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=$$DELETE^IBCEF84(DA) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X="" X ^DD(399,.21,1,4,2.4)
"^DD",399,399,.21,1,4,2.4)
S DIH=$G(^DGCR(399,DIV(0),"TX")),DIV=X S $P(^("TX"),U,8)=DIV,DIH=399,DIG=27 D ^DICR
"^DD",399,399,.21,1,4,"%D",0)
^^6^6^3101129^
"^DD",399,399,.21,1,4,"%D",1,0)
This trigger is designed to set the FORCE CLAIM TO PRINT field 27 equal 
"^DD",399,399,.21,1,4,"%D",2,0)
to 1 for SECONDARY MEDICARE WNR claims if the carrier field PRINT SEC MED 
"^DD",399,399,.21,1,4,"%D",3,0)
CLAIMS W/O MRA, 6.1 is set.
"^DD",399,399,.21,1,4,"%D",4,0)
If the current value of field 27, FORCE CLAIM TO PRINT is equal to 1, and 
"^DD",399,399,.21,1,4,"%D",5,0)
field .21, CURRENT BILL PAYER SEQUENCE is changed to something other than 
"^DD",399,399,.21,1,4,"%D",6,0)
"S", then the value in field 27, FORCE CLAIM TO PRINT, is deleted.
"^DD",399,399,.21,1,4,"CREATE CONDITION")
S X=$$CREATE^IBCEF84(DA)
"^DD",399,399,.21,1,4,"CREATE VALUE")
S X=1
"^DD",399,399,.21,1,4,"DELETE CONDITION")
S X=$$DELETE^IBCEF84(DA)
"^DD",399,399,.21,1,4,"DELETE VALUE")
@
"^DD",399,399,.21,1,4,"DT")
3101128
"^DD",399,399,.21,1,4,"FIELD")
FORCE CLAIM TO PRINT
"^DD",399,399,.21,3)
Enter the entity currently responsible for paying this bill.
"^DD",399,399,.21,5,1,0)
399^.11^4
"^DD",399,399,.21,12)
Primary/Secondary/Tertiary must have corresponding insurance co on bill.
"^DD",399,399,.21,12.1)
S DIC("S")="I $S(X=""P"":$D(^DGCR(399,DA,""I1"")),X=""S"":$D(^DGCR(399,DA,""I2"")),X=""T"":$D(^DGCR(399,DA,""I3"")),1:1)"
"^DD",399,399,.21,21,0)
^^1^1^2960129^^^
"^DD",399,399,.21,21,1,0)
This field determines the entity currently responsible for paying this bill.
"^DD",399,399,.21,"DT")
3101128
"^DD",399,399,28.1,0)
MRA REVIEW STATUS^S^0:NOT BEING REVIEWED;1:REVIEW IN PROCESS;^TX;10^Q
"^DD",399,399,28.1,3)
Enter code indicating whether this MRA claim is being reviewed.
"^DD",399,399,28.1,21,0)
^^1^1^3100820^
"^DD",399,399,28.1,21,1,0)
Select code that indicates whether this claim is under review.
"^DD",399,399,28.1,"DT")
3100820
"^DD",399,399,34,0)
AUTO PROCESSED FROM CLAIM^P399'^DGCR(399,^S1;6^Q
"^DD",399,399,34,3)
Select the claim which was used to auto-process the current claim.
"^DD",399,399,34,21,0)
^^3^3^3101014^
"^DD",399,399,34,21,1,0)
This claim was used to create the current claim by the commercial
"^DD",399,399,34,21,2,0)
insurance auto-processing routines. It is system generated and uneditable
"^DD",399,399,34,21,3,0)
by the users.
"^DD",399,399,34,"DT")
3101014
"^DD",399,399,35,0)
AUTO PROCESS^S^1:WORKLIST;2:AUTO LOCAL PRINT;3:AUTO EDI;4:NO LONGER ON WORKLIST;^S1;7^Q
"^DD",399,399,35,1,0)
^.1
"^DD",399,399,35,1,1,0)
399^CAP
"^DD",399,399,35,1,1,1)
S ^DGCR(399,"CAP",$E(X,1,30),DA)=""
"^DD",399,399,35,1,1,2)
K ^DGCR(399,"CAP",$E(X,1,30),DA)
"^DD",399,399,35,1,1,"%D",0)
^^1^1^3101014^
"^DD",399,399,35,1,1,"%D",1,0)
This is the cross reference used to build the COB Management worklist.
"^DD",399,399,35,1,1,"DT")
3101004
"^DD",399,399,35,3)
What is the result of the auto-processing of this claim?
"^DD",399,399,35,21,0)
^^11^11^3101014^
"^DD",399,399,35,21,1,0)
The result of the commercial claim auto-processing.  There are three
"^DD",399,399,35,21,2,0)
possible outcomes of the auto-processing.  The claim can automatically be
"^DD",399,399,35,21,3,0)
sent electronically.  The claim can automatically be printed locally.  
"^DD",399,399,35,21,4,0)
Finally, the claim can be added to the worklist.
"^DD",399,399,35,21,5,0)
 
"^DD",399,399,35,21,6,0)
This claim will be changed to NO LONGER ON WORKLIST when this claim is 
"^DD",399,399,35,21,7,0)
'worked' off either by removing, cloning, or processing the claim.  This 
"^DD",399,399,35,21,8,0)
removes the claim from the active worklist but serves as an audit trail 
"^DD",399,399,35,21,9,0)
to show the result of the commercial claim auto-processing.
"^DD",399,399,35,21,10,0)
 
"^DD",399,399,35,21,11,0)
This field is set by the system and should not be edited through Fileman.
"^DD",399,399,35,"DT")
3101014
"^DD",399,399,36,0)
AUTO PROCESS REASON^P350.8'^IBE(350.8,^S1;8^Q
"^DD",399,399,36,3)
Why was this claim not auto-processed?
"^DD",399,399,36,21,0)
^^2^2^3101108^
"^DD",399,399,36,21,1,0)
This is the reason that the claim failed auto-processing and was put on
"^DD",399,399,36,21,2,0)
the worklist. This is system generated.  Do not edit through Fileman.
"^DD",399,399,36,"DT")
3101108
"^DD",399,399,37,0)
REMOVED FROM WORKLIST BY^P200'^VA(200,^S1;9^Q
"^DD",399,399,37,3)
Select the user who removed the claim from the COB worklist.
"^DD",399,399,37,21,0)
^^2^2^3101014^
"^DD",399,399,37,21,1,0)
This is the user who removed the Claim from the COB worklist. Set by the system
"^DD",399,399,37,21,2,0)
automatically.  Don't edit through Fileman.
"^DD",399,399,37,"DT")
3101014
"^DD",399,399,38,0)
REMOVED FROM WORKLIST HOW^S^RM:REMOVE ACTION;PC:PROCESS COB ACTION;CL:CLONE ACTION;CA:CANCELLED ACTION;CR:CORRECTED ACTION;^UF32;4^Q
"^DD",399,399,38,3)
How was the claim removed from the COB worklist?
"^DD",399,399,38,21,0)
^.001^2^2^3110318^^
"^DD",399,399,38,21,1,0)
This is the action which removed this claim from the COB worklist. Set by the
"^DD",399,399,38,21,2,0)
system automatically.  Don't edit through Fileman.
"^DD",399,399,38,"DT")
3110318
"^DD",399,399,39,0)
REMOVED FROM WORKLIST DATE^D^^UF32;5^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",399,399,39,3)
Enter the date that this claim was removed from COB management worklist.
"^DD",399,399,39,21,0)
^^2^2^3101015^
"^DD",399,399,39,21,1,0)
This is the date/time the claim was removed from the COB management 
"^DD",399,399,39,21,2,0)
worklist worklist. Set automatically.  Don't edit through Fileman.
"^DD",399,399,39,"DT")
3101015
"^DD",399,399,78,0)
EOB CLAIM COMMENTS^399.078DA^^TXC2;0
"^DD",399,399,78,21,0)
^^5^5^3100830^
"^DD",399,399,78,21,1,0)
This multiple structure is available only for those claims on the COB 
"^DD",399,399,78,21,2,0)
Management Worklist.  This will allow the users to view comments either
"^DD",399,399,78,21,3,0)
in TPJI or in the COB worklist.
"^DD",399,399,78,21,4,0)
 
"^DD",399,399,78,21,5,0)
Once entered, comments may not be edited or deleted by the users.
"^DD",399,399,101,0)
PRIMARY INSURANCE CARRIER^R*P36'X^DIC(36,^M;1^D DD^IBCNS S DIC("S")="I $D(IBDD(+Y)),'$D(^DGCR(399,DA,""AIC"",+Y))" D ^DIC K DIC,IBDD S DIC=DIE,X=+Y K:Y<0 X
"^DD",399,399,101,1,0)
^.1
"^DD",399,399,101,1,1,0)
^^TRIGGER^399^122
"^DD",399,399,101,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DGCR(399,D0,"M1")):^("M1"),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X=DIV S X=$$PRVNUM^IBCU(DA,X,1) X ^DD(399,101,1,1,1.4)
"^DD",399,399,101,1,1,1.4)
S DIH=$G(^DGCR(399,DIV(0),"M1")),DIV=X S $P(^("M1"),U,2)=DIV,DIH=399,DIG=122 D ^DICR
"^DD",399,399,101,1,1,2)
Q
"^DD",399,399,101,1,1,3)
Do Not Delete
"^DD",399,399,101,1,1,"%D",0)
^.101^3^3^3020819^^
"^DD",399,399,101,1,1,"%D",1,0)
This trigger sets the Bill Primary Provider # based on the Form Type,  
"^DD",399,399,101,1,1,"%D",2,0)
using the Primary Insurance Companies Hospital or Professional Provider 
"^DD",399,399,101,1,1,"%D",3,0)
Number.  Special case for Medicare Part A.
"^DD",399,399,101,1,1,"CREATE VALUE")
S X=$$PRVNUM^IBCU(DA,X,1)
"^DD",399,399,101,1,1,"DELETE VALUE")
NO EFFECT
"^DD",399,399,101,1,1,"DT")
3020819
"^DD",399,399,101,1,1,"FIELD")
PRIMARY PROVIDER #
"^DD",399,399,101,1,2,0)
^^TRIGGER^399^24
"^DD",399,399,101,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X I $$COBN^IBCEF(DA)=1 I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y X ^DD(399,101,1,2,1.1) X ^DD(399,101,1,2,1.4)
"^DD",399,399,101,1,2,1.1)
S X=DIV S X=$S($$REQMRA^IBEFUNC(DA):"1N",1:"")
"^DD",399,399,101,1,2,1.4)
S DIH=$S($D(^DGCR(399,DIV(0),"TX")):^("TX"),1:""),DIV=X S $P(^("TX"),U,5)=DIV,DIH=399,DIG=24 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",399,399,101,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X I $$COBN^IBCEF(DA)=1 I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X="" X ^DD(399,101,1,2,2.4)
"^DD",399,399,101,1,2,2.4)
S DIH=$S($D(^DGCR(399,DIV(0),"TX")):^("TX"),1:""),DIV=X S $P(^("TX"),U,5)=DIV,DIH=399,DIG=24 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",399,399,101,1,2,3)
DO NOT DELETE
"^DD",399,399,101,1,2,"%D",0)
^^2^2^2990628^
"^DD",399,399,101,1,2,"%D",1,0)
This triggers the CLAIM MRA STATUS to 'MRA NEEDED' (1N) if the primary
"^DD",399,399,101,1,2,"%D",2,0)
insurance is the current insurance and the current insurance = MEDICARE WNR.
"^DD",399,399,101,1,2,"CREATE CONDITION")
I $$COBN^IBCEF(DA)=1
"^DD",399,399,101,1,2,"CREATE VALUE")
S X=$S($$REQMRA^IBEFUNC(DA):"1N",1:"")
"^DD",399,399,101,1,2,"DELETE CONDITION")
I $$COBN^IBCEF(DA)=1
"^DD",399,399,101,1,2,"DELETE VALUE")
@
"^DD",399,399,101,1,2,"DT")
2990628
"^DD",399,399,101,1,2,"FIELD")
CLAIM MRA STATUS
"^DD",399,399,101,1,3,0)
^^TRIGGER^399^27
"^DD",399,399,101,1,3,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=$S($$MCRWNR^IBEFUNC(X):$$COBN^IBCEF(DA)=1,1:0) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X="" X ^DD(399,101,1,3,1.4)
"^DD",399,399,101,1,3,1.4)
S DIH=$G(^DGCR(399,DIV(0),"TX")),DIV=X S $P(^("TX"),U,8)=DIV,DIH=399,DIG=27 D ^DICR
"^DD",399,399,101,1,3,2)
Q
"^DD",399,399,101,1,3,3)
Do not delete
"^DD",399,399,101,1,3,"%D",0)
^^3^3^3041119^
"^DD",399,399,101,1,3,"%D",1,0)
When the current insurance is the primary insurance and the primary
"^DD",399,399,101,1,3,"%D",2,0)
insurance is MEDICARE WNR, delete the FORCE CLAIM TO PRINT field as it
"^DD",399,399,101,1,3,"%D",3,0)
is not valid to print an MRA request.
"^DD",399,399,101,1,3,"CREATE CONDITION")
S X=$S($$MCRWNR^IBEFUNC(X):$$COBN^IBCEF(DA)=1,1:0)
"^DD",399,399,101,1,3,"CREATE VALUE")
@
"^DD",399,399,101,1,3,"DELETE VALUE")
NO EFFECT
"^DD",399,399,101,1,3,"DT")
3041119
"^DD",399,399,101,1,3,"FIELD")
FORCE CLAIM TO PRINT
"^DD",399,399,101,1,4,0)
^^TRIGGER^399^128
"^DD",399,399,101,1,4,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DGCR(399,D0,"M1")):^("M1"),1:"") S X=$P(Y(1),U,10),X=X S DIU=X K Y S X=DIV S X=$$PRVQUAL^IBCU(DA,X,1) X ^DD(399,101,1,4,1.4)
"^DD",399,399,101,1,4,1.4)
S DIH=$G(^DGCR(399,DIV(0),"M1")),DIV=X S $P(^("M1"),U,10)=DIV,DIH=399,DIG=128 D ^DICR
"^DD",399,399,101,1,4,2)
Q
"^DD",399,399,101,1,4,"CREATE VALUE")
S X=$$PRVQUAL^IBCU(DA,X,1)
"^DD",399,399,101,1,4,"DELETE VALUE")
NO EFFECT
"^DD",399,399,101,1,4,"DT")
3060219
"^DD",399,399,101,1,4,"FIELD")
PRIMARY ID QUALIFIER
"^DD",399,399,101,1,5,0)
^^TRIGGER^399^27
"^DD",399,399,101,1,5,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=$$CREATE^IBCEF84(DA) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X=DIV S X=1 X ^DD(399,101,1,5,1.4)
"^DD",399,399,101,1,5,1.4)
S DIH=$G(^DGCR(399,DIV(0),"TX")),DIV=X S $P(^("TX"),U,8)=DIV,DIH=399,DIG=27 D ^DICR
"^DD",399,399,101,1,5,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X S X=$$DELETE^IBCEF84(DA) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"TX")):^("TX"),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X="" X ^DD(399,101,1,5,2.4)
"^DD",399,399,101,1,5,2.4)
S DIH=$G(^DGCR(399,DIV(0),"TX")),DIV=X S $P(^("TX"),U,8)=DIV,DIH=399,DIG=27 D ^DICR
"^DD",399,399,101,1,5,"%D",0)
^^7^7^3101129^
"^DD",399,399,101,1,5,"%D",1,0)
This trigger is designed to set the FORCE CLAIM TO PRINT field 27 equal 
"^DD",399,399,101,1,5,"%D",2,0)
to 1 for SECONDARY MEDICARE WNR claims if the carrier field PRINT SEC MED 
"^DD",399,399,101,1,5,"%D",3,0)
CLAIMS W/O MRA, 6.1 is set.
"^DD",399,399,101,1,5,"%D",4,0)
If the current value of field 27, FORCE CLAIM TO PRINT is equal to 1, and 
"^DD",399,399,101,1,5,"%D",5,0)
field 101, PRIMARY INSURANCE CARRIER is changed to a carrier where field 
"^DD",399,399,101,1,5,"%D",6,0)
6.1, PRINT SEC MED CLAIMS W/O MRA is not set, then the value in field 27, 
"^DD",399,399,101,1,5,"%D",7,0)
FORCE CLAIM TO PRINT, is deleted.
"^DD",399,399,101,1,5,"CREATE CONDITION")
S X=$$CREATE^IBCEF84(DA)
"^DD",399,399,101,1,5,"CREATE VALUE")
S X=1
"^DD",399,399,101,1,5,"DELETE CONDITION")
S X=$$DELETE^IBCEF84(DA)
"^DD",399,399,101,1,5,"DELETE VALUE")
@
"^DD",399,399,101,1,5,"DT")
3101128
"^DD",399,399,101,1,5,"FIELD")
FORCE CLAIM TO PRINT
"^DD",399,399,101,3)
Enter name of insurance carrier to which this bill is to be sent.
"^DD",399,399,101,5,1,0)
399^112^1
"^DD",399,399,101,12)
Only valid insurance companies for this date of care.
"^DD",399,399,101,12.1)
S DIC("S")="I $D(IBDD(+Y)),'$D(^DGCR(399,DA,""AIC"",+Y))"
"^DD",399,399,101,21,0)
^^2^2^2990503^^^^
"^DD",399,399,101,21,1,0)
This is the name of the insurance carrier to which this bill is to be sent.
"^DD",399,399,101,21,2,0)
This is from the entries in this patient's file of insurance companies. 
"^DD",399,399,101,23,0)
^^3^3^2990503^^^
"^DD",399,399,101,23,1,0)
Only valid/active insurance companies for this patient can be choosen,
"^DD",399,399,101,23,2,0)
as defined by DD^IBCNS.  Company must not already be defined as a carrier 
"^DD",399,399,101,23,3,0)
(399,102-103) for this bill.
"^DD",399,399,101,"DT")
3101128
"^DD",399,399,222,0)
PROVIDER^399.0222ISA^^PRV;0
"^DD",399,399,222,12)
Rendering is for prof only.  Operating/Attending are for inst only.
"^DD",399,399,222,12.1)
S DIC("S")="I $$PRVOK^IBCEU(+Y,$S($D(D0):D0,1:$G(DA)))"
"^DD",399,399,222,"DT")
3010426
"^DD",399,399,238,0)
SPECIAL PROGRAM INDICATOR^S^01:EPSDT/CHAP;02:Phys Handicapped Children Program;03:Special Fed Funding;05:Disability;07:Induced Abortion - Danger to Life;08:Induced Abortion - Rape or Incest;09:2nd Opinion/Surgery;^U2;16^Q
"^DD",399,399,238,3)
Enter the code indicating the Special Program under which the patient services were rendered.
"^DD",399,399,238,21,0)
^.001^3^3^3100922^^^^
"^DD",399,399,238,21,1,0)
This is an indicator to tell the CMS-1500 to print the statement 
"^DD",399,399,238,21,2,0)
associated with the special program in box 19.  Refer to the
"^DD",399,399,238,21,3,0)
MEDICARE regulations on when to fill in this field.
"^DD",399,399,238,"DT")
3101026
"^DD",399,399,253,0)
PRIMARY REFERRAL NUMBER^F^^UF32;1^K:$L(X)>50!($L(X)<3) X
"^DD",399,399,253,3)
Answer with (3-50 chars) Primary Referral Number.
"^DD",399,399,253,21,0)
^^1^1^3101025^
"^DD",399,399,253,21,1,0)
This is the primary referral number assigned to the insurance.
"^DD",399,399,253,"DT")
3101025
"^DD",399,399,254,0)
SECONDARY REFERRAL NUMBER^F^^UF32;2^K:$L(X)>50!($L(X)<3) X
"^DD",399,399,254,3)
Answer with (3-50 chars) Secondary Referral Number.
"^DD",399,399,254,21,0)
^^1^1^3101025^
"^DD",399,399,254,21,1,0)
This is the secondary referral number assigned to the insurance.
"^DD",399,399,254,"DT")
3101025
"^DD",399,399,255,0)
TERTIARY REFERRAL NUMBER^F^^UF32;3^K:$L(X)>50!($L(X)<3) X
"^DD",399,399,255,3)
Answer with (3-50 chars) Tertiary Referral Number.
"^DD",399,399,255,21,0)
^^1^1^3101025^
"^DD",399,399,255,21,1,0)
This is the tertiary referral number assigned to the insurance.
"^DD",399,399,255,"DT")
3101025
"^DD",399,399,260,0)
COB TOTAL NON-COVERED AMOUNT^NJ18,2^^U4;1^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999999999999)!(X<0) X
"^DD",399,399,260,3)
Type a dollar amount between 0 and 999999999999999, 2 decimal digits.
"^DD",399,399,260,21,0)
^.001^4^4^3101019^^^^
"^DD",399,399,260,21,1,0)
This is a dollar amount that must equal the Total Claim Charge Amount.
"^DD",399,399,260,21,2,0)
Required when the current payer allows  providers to bypass claim 
"^DD",399,399,260,21,3,0)
submission to the otherwise prior payer (example: Medicare secondary 
"^DD",399,399,260,21,4,0)
with no MRA). 
"^DD",399,399,260,"DT")
3101019
"^DD",399,399,261,0)
PROPERTY/CASUALTY CLAIM NUMBER^F^^U4;2^K:$L(X)>30!($L(X)<1) X
"^DD",399,399,261,3)
Answer must be 1-30 characters in length.
"^DD",399,399,261,21,0)
^.001^1^1^3101019^^
"^DD",399,399,261,21,1,0)
This is a payer-assigned claim number for a property and casualty claim. 
"^DD",399,399,261,"DT")
3100810
"^DD",399,399,262,0)
PROP/CAS DATE OF 1ST CONTACT^D^^U4;3^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",399,399,262,3)
Enter the date of first contact, if applicable.
"^DD",399,399,262,21,0)
^.001^3^3^3101019^^^^
"^DD",399,399,262,21,1,0)
This is the date the patient first consulted the service provider for 
"^DD",399,399,262,21,2,0)
this property and casualty related condition.  Required when state 
"^DD",399,399,262,21,3,0)
mandated.
"^DD",399,399,262,"DT")
3101019
"^DD",399,399,263,0)
DISABILITY START DATE^DX^^U4;4^S %DT="E" D ^%DT S X=Y K:DT<X X I $D(X),$P($G(^DGCR(399,DA,"U4")),U,5)'="",X>$P($G(^DGCR(399,DA,"U4")),U,5) K X
"^DD",399,399,263,3)
Enter the Disability start date.  Cannot be a future date or after Disability end date.
"^DD",399,399,263,21,0)
^.001^2^2^3101019^^^^
"^DD",399,399,263,21,1,0)
This is the Disability start date.
"^DD",399,399,263,21,2,0)
Cannot be a future date, and cannot be after Disability end date.
"^DD",399,399,263,"DT")
3101019
"^DD",399,399,264,0)
DISABILITY END DATE^DX^^U4;5^S %DT="E" D ^%DT S X=Y K:DT<X X I $D(X),X<$P($G(^DGCR(399,DA,"U4")),U,4) K X
"^DD",399,399,264,3)
Enter the Disability End Date.  Cannot be before disability start date.
"^DD",399,399,264,21,0)
^.001^2^2^3101019^^^^
"^DD",399,399,264,21,1,0)
This is the Disability stop date.
"^DD",399,399,264,21,2,0)
Future dates are not allowed and stop date cannot be before start date.
"^DD",399,399,264,"DT")
3101019
"^DD",399,399,266,0)
PRIMARY SURGICAL PROC CODE^P81'^ICPT(^U4;7^Q
"^DD",399,399,266,3)
Select a primary HCPCS surgical code, if applicable.
"^DD",399,399,266,21,0)
^.001^3^3^3101019^^^
"^DD",399,399,266,21,1,0)
This is a primary HCPCS surgical code when anesthesiology services
"^DD",399,399,266,21,2,0)
are being billed and the payment of the claim is dependent on
"^DD",399,399,266,21,3,0)
provision of surgical codes.
"^DD",399,399,266,"DT")
3100811
"^DD",399,399,267,0)
SECONDARY SURGICAL PROC CODE^P81'^ICPT(^U4;8^Q
"^DD",399,399,267,3)
Select a secondary HCPCS surgical code, if applicable.
"^DD",399,399,267,21,0)
^.001^3^3^3101019^^
"^DD",399,399,267,21,1,0)
This is a secondary HCPCS surgical code when anesthesiology services
"^DD",399,399,267,21,2,0)
are being billed and the payment of the claim is dependent on 
"^DD",399,399,267,21,3,0)
provision of surgical codes.
"^DD",399,399,267,"DT")
3100811
"^DD",399,399,268,0)
PROPERTY/CASUALTY CONTACT NAME^F^^U4;9^K:$L(X)>60!($L(X)<1) X
"^DD",399,399,268,3)
Answer must be 1-60 characters in length.
"^DD",399,399,268,21,0)
^.001^2^2^3101019^^
"^DD",399,399,268,21,1,0)
This is the name of the person to be contacted regarding this Property
"^DD",399,399,268,21,2,0)
and Casualty claim if different from the Patient/Subscriber.
"^DD",399,399,268,"DT")
3100812
"^DD",399,399,269,0)
PROP/CAS COMMUNICATION NUMBER^NJ10,0^^U4;10^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",399,399,269,3)
Type a number between 0 and 9999999999, 0 decimal digits.
"^DD",399,399,269,21,0)
^^2^2^3100827^
"^DD",399,399,269,21,1,0)
Enter the area code and phone number for the person to be contacted
"^DD",399,399,269,21,2,0)
regarding this Property and Casualty claim.
"^DD",399,399,269,"DT")
3100827
"^DD",399,399,269.1,0)
PROP/CAS EXTENSION NUMBER^NJ10,0^^U4;11^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1.N) X
"^DD",399,399,269.1,3)
Type a number between 1 and 9999999999, 0 decimal digits.
"^DD",399,399,269.1,21,0)
^^2^2^3110210^
"^DD",399,399,269.1,21,1,0)
This is the extension number for the person to be contacted regarding 
"^DD",399,399,269.1,21,2,0)
this Property and Casualty claim.
"^DD",399,399,269.1,"DT")
3110210
"^DD",399,399,271,0)
AMBULANCE P/U ADDRESS 1^F^^U5;2^K:$L(X)>40!($L(X)<1) X
"^DD",399,399,271,3)
Answer must be 1-40 characters in length.
"^DD",399,399,271,21,0)
^.001^2^2^3101019^^
"^DD",399,399,271,21,1,0)
This is line one of the street address where the patient was picked up.
"^DD",399,399,271,21,2,0)
Required for ambulance transportation.
"^DD",399,399,271,"DT")
3100725
"^DD",399,399,272,0)
AMBULANCE P/U ADDRESS 2^F^^U5;3^K:$L(X)>30!($L(X)<1) X
"^DD",399,399,272,3)
Answer must be 1-30 characters in length.
"^DD",399,399,272,21,0)
^.001^1^1^3101019^^
"^DD",399,399,272,21,1,0)
This is line two of the address where the patient was picked up.
"^DD",399,399,272,"DT")
3100725
"^DD",399,399,273,0)
AMBULANCE P/U CITY^F^^U5;4^K:$L(X)>30!($L(X)<1) X
"^DD",399,399,273,3)
Answer must be 1-30 characters in length.
"^DD",399,399,273,21,0)
^.001^2^2^3101019^^
"^DD",399,399,273,21,1,0)
This is the City where the patient was picked up.
"^DD",399,399,273,21,2,0)
Required for ambulance transportation.
"^DD",399,399,273,"DT")
3100725
"^DD",399,399,274,0)
AMBULANCE P/U STATE^P5'^DIC(5,^U5;5^Q
"^DD",399,399,274,3)
Enter the Ambulance P/U State.
"^DD",399,399,274,21,0)
^.001^2^2^3101019^^
"^DD",399,399,274,21,1,0)
This is the State where the patient was
"^DD",399,399,274,21,2,0)
picked up.  Required for ambulance transportation.
"^DD",399,399,274,"DT")
3100725
"^DD",399,399,275,0)
AMBULANCE P/U ZIP^F^^U5;6^K:$L(X)>15!($L(X)<1) X
"^DD",399,399,275,3)
Answer must be 1-15 characters in length.
"^DD",399,399,275,21,0)
^.001^2^2^3101019^^
"^DD",399,399,275,21,1,0)
This is the Zip code of the location where the patient was picked
"^DD",399,399,275,21,2,0)
up. Required for ambulance transportation.
"^DD",399,399,275,"DT")
3100725
"^DD",399,399,276,0)
AMBULANCE D/O LOCATION^F^^U6;1^K:$L(X)>60!($L(X)<1) X
"^DD",399,399,276,3)
Answer must be 1-60 characters in length.
"^DD",399,399,276,21,0)
^.001^2^2^3101019^^
"^DD",399,399,276,21,1,0)
This is the name of the location where the patient was dropped off, if it 
"^DD",399,399,276,21,2,0)
is known.
"^DD",399,399,276,"DT")
3100805
"^DD",399,399,277,0)
AMBULANCE D/O ADDRESS 1^F^^U6;2^K:$L(X)>40!($L(X)<1) X
"^DD",399,399,277,3)
Answer must be 1-40 characters in length.
"^DD",399,399,277,21,0)
^.001^2^2^3101019^^
"^DD",399,399,277,21,1,0)
This is line one of the street address where the patient was 
"^DD",399,399,277,21,2,0)
dropped off.  Required for ambulance transportation.
"^DD",399,399,277,"DT")
3100805
"^DD",399,399,278,0)
AMBULANCE D/O ADDRESS 2^F^^U6;3^K:$L(X)>30!($L(X)<1) X
"^DD",399,399,278,3)
Answer must be 1-30 characters in length.
"^DD",399,399,278,21,0)
^.001^2^2^3101019^^
"^DD",399,399,278,21,1,0)
This is line two of the address where the patient was 
"^DD",399,399,278,21,2,0)
dropped off.
"^DD",399,399,278,"DT")
3100805
"^DD",399,399,279,0)
AMBULANCE D/O CITY^F^^U6;4^K:$L(X)>30!($L(X)<1) X
"^DD",399,399,279,3)
Answer must be 1-30 characters in length.
"^DD",399,399,279,21,0)
^.001^2^2^3101019^^
"^DD",399,399,279,21,1,0)
This is the City where the patient was
"^DD",399,399,279,21,2,0)
dropped off.  Required for ambulance transportation.
"^DD",399,399,279,"DT")
3100805
"^DD",399,399,280,0)
AMBULANCE D/O STATE^P5'^DIC(5,^U6;5^Q
"^DD",399,399,280,3)
Enter the Ambulance D/O State.
"^DD",399,399,280,21,0)
^.001^2^2^3101019^^
"^DD",399,399,280,21,1,0)
This is the State where the patient was
"^DD",399,399,280,21,2,0)
dropped off.  Required for ambulance transportation.
"^DD",399,399,280,"DT")
3100805
"^DD",399,399,281,0)
AMBULANCE D/O ZIP^F^^U6;6^K:$L(X)>15!($L(X)<1) X
"^DD",399,399,281,3)
Answer must be 1-15 characters in length.
"^DD",399,399,281,21,0)
^.001^2^2^3101019^^
"^DD",399,399,281,21,1,0)
This is the Zip code of the location where the patient was
"^DD",399,399,281,21,2,0)
dropped off. Required for ambulance transportation.
"^DD",399,399,281,"DT")
3100805
"^DD",399,399,282,0)
ASSUMED CARE DATE^DX^^U4;13^S %DT="E" D ^%DT S X=Y K:DT<X X I $D(X),$P($G(^DGCR(399,DA,"U4")),U,14)'="",X>$P($G(^DGCR(399,DA,"U4")),U,14) K X
"^DD",399,399,282,3)
Enter the date the provider assumed care.  Cannot be a future date or greater than the Relinquished Care Date.
"^DD",399,399,282,21,0)
^.001^3^3^3101019^^^^
"^DD",399,399,282,21,1,0)
This is the date on which the provider on this claim assumed
"^DD",399,399,282,21,2,0)
the post-operative care associated with this claim.
"^DD",399,399,282,21,3,0)
Cannot be a future date or greater than the relinquished care date.
"^DD",399,399,282,"DT")
3101019
"^DD",399,399,283,0)
RELINQUISHED CARE DATE^DX^^U4;14^S %DT="E" D ^%DT S X=Y K:DT<X X I $D(X),X<$P($G(^DGCR(399,DA,"U4")),U,13) K X
"^DD",399,399,283,3)
Enter the date the provider relinquished care.  Cannot be a future date or before the assumed care date.
"^DD",399,399,283,21,0)
^.001^3^3^3101019^^^^
"^DD",399,399,283,21,1,0)
This is the date on which the provider on this claim
"^DD",399,399,283,21,2,0)
relinquished the post-operative care associated with
"^DD",399,399,283,21,3,0)
this claim.
"^DD",399,399,283,"DT")
3101019
"^DD",399,399,284,0)
ATTACHMENT CONTROL NUMBER^F^^U8;1^K:$L(X)>30!($L(X)<1) X
"^DD",399,399,284,3)
Answer must be 1-30 characters in length.
"^DD",399,399,284,21,0)
^.001^4^4^3101019^^
"^DD",399,399,284,21,1,0)
This is an Attachment Control Number (alphanumeric) that can be
"^DD",399,399,284,21,2,0)
used to identify the documentation that will provide
"^DD",399,399,284,21,3,0)
additional information for this claim.  This applies to the
"^DD",399,399,284,21,4,0)
entire claim.
"^DD",399,399,284,"DT")
3100816
"^DD",399,399,285,0)
ATTACHMENT REPORT TYPE^P353.3'^IBE(353.3,^U8;2^Q
"^DD",399,399,285,3)
Select an Attachment Report Type.
"^DD",399,399,285,21,0)
^.001^3^3^3101019^^^
"^DD",399,399,285,21,1,0)
This is a Report Type to describe the type of documentation that
"^DD",399,399,285,21,2,0)
will provide additional information for this claim.  This
"^DD",399,399,285,21,3,0)
applies to the entire claim.
"^DD",399,399,285,"DT")
3100816
"^DD",399,399,286,0)
ATTACHMENT REPORT TRANS CODE^S^AA:Available on Request at Provider Site;BM:By Mail;EL:Electronically Only;EM:E-Mail;FT:File Transfer;FX:By Fax;^U8;3^Q
"^DD",399,399,286,3)
Choose a code for the Attachment Transmission Method.
"^DD",399,399,286,21,0)
^.001^2^2^3101019^^
"^DD",399,399,286,21,1,0)
This is the code for the Attachment Transmission Method. This
"^DD",399,399,286,21,2,0)
applies to the entire claim.
"^DD",399,399,286,"DT")
3100816
"^DD",399,399,453,0)
FORM LOCATOR 64A^F^^UF3;4^K:$L(X)>50!($L(X)<3) X
"^DD",399,399,453,.1)
PRIMARY INSURANCE ICN/DCN
"^DD",399,399,453,3)
Answer must be 3-50 characters in length.
"^DD",399,399,453,21,0)
^.001^4^4^3100923^^^
"^DD",399,399,453,21,1,0)
Form Locator 64A on the UB-04.  This field is nationally reserved on
"^DD",399,399,453,21,2,0)
adjustment/replacement type bills for the Internal Control Number
"^DD",399,399,453,21,3,0)
(ICN)/Document Control Number (DCN) assigned to the original bill
"^DD",399,399,453,21,4,0)
by the primary payer.
"^DD",399,399,453,"DT")
3100923
"^DD",399,399,454,0)
FORM LOCATOR 64B^F^^UF3;5^K:$L(X)>50!($L(X)<3) X
"^DD",399,399,454,.1)
SECONDARY INSURANCE ICN/DCN
"^DD",399,399,454,3)
Answer must be 3-50 characters in length.
"^DD",399,399,454,21,0)
^.001^4^4^3100923^^
"^DD",399,399,454,21,1,0)
Form Locator 64B on the UB-04.  This field is nationally reserved on
"^DD",399,399,454,21,2,0)
adjustment/replacement type bills for the Internal Control Number
"^DD",399,399,454,21,3,0)
(ICN)/Document Control Number (DCN) assigned to the original bill by the
"^DD",399,399,454,21,4,0)
secondary payer.
"^DD",399,399,454,"DT")
3100923
"^DD",399,399,455,0)
FORM LOCATOR 64C^F^^UF3;6^K:$L(X)>50!($L(X)<3) X
"^DD",399,399,455,.1)
TERTIARY INSURANCE ICN/DCN
"^DD",399,399,455,3)
Answer must be 3-50 characters in length.
"^DD",399,399,455,21,0)
^.001^4^4^3100923^^^
"^DD",399,399,455,21,1,0)
Form Locator 64C on the UB-04.  This field is nationally reserved on
"^DD",399,399,455,21,2,0)
adjustment/replacement type bills for the Internal Control Number
"^DD",399,399,455,21,3,0)
(ICN)/Document Control Number (DCN) assigned to the original bill by the
"^DD",399,399,455,21,4,0)
tertiary payer.
"^DD",399,399,455,"DT")
3100923
"^DD",399,399.0222,0)
PROVIDER SUB-FIELD^^1.03^18
"^DD",399,399.0222,0,"NM","PROVIDER")

"^DD",399,399.0222,.01,0)
FUNCTION^MRM*S^1:REFERRING;2:OPERATING;3:RENDERING;4:ATTENDING;5:SUPERVISING;9:OTHER OPERATING;^0;1^Q
"^DD",399,399.0222,.01,1,0)
^.1^^-1
"^DD",399,399.0222,.01,1,1,0)
399.0222^B
"^DD",399,399.0222,.01,1,1,1)
S ^DGCR(399,DA(1),"PRV","B",$E(X,1,30),DA)=""
"^DD",399,399.0222,.01,1,1,2)
K ^DGCR(399,DA(1),"PRV","B",$E(X,1,30),DA)
"^DD",399,399.0222,.01,1,1,"DT")
3000103
"^DD",399,399.0222,.01,1,2,0)
^^TRIGGER^399.0222^.04
"^DD",399,399.0222,.01,1,2,1)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S X=Y(0),X=X S X=X'=1 I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X="" X ^DD(399.0222,.01,1,2,1.4)
"^DD",399,399.0222,.01,1,2,1.4)
S DIH=$S($D(^DGCR(399,DIV(0),"PRV",DIV(1),0)):^(0),1:""),DIV=X S $P(^(0),U,4)=DIV,DIH=399.0222,DIG=.04 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",399,399.0222,.01,1,2,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X="" X ^DD(399.0222,.01,1,2,2.4)
"^DD",399,399.0222,.01,1,2,2.4)
S DIH=$S($D(^DGCR(399,DIV(0),"PRV",DIV(1),0)):^(0),1:""),DIV=X S $P(^(0),U,4)=DIV,DIH=399.0222,DIG=.04 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",399,399.0222,.01,1,2,3)
Do not delete
"^DD",399,399.0222,.01,1,2,"%D",0)
^.101^2^2^3100908^^^^
"^DD",399,399.0222,.01,1,2,"%D",1,0)
This xref is used to delete the state field if the provider is not a
"^DD",399,399.0222,.01,1,2,"%D",2,0)
referring provider function type.
"^DD",399,399.0222,.01,1,2,"CREATE CONDITION")
INTERNAL(PROVIDER FUNCTION)'=1
"^DD",399,399.0222,.01,1,2,"CREATE VALUE")
@
"^DD",399,399.0222,.01,1,2,"DELETE VALUE")
@
"^DD",399,399.0222,.01,1,2,"DT")
2990513
"^DD",399,399.0222,.01,1,2,"FIELD")
PROVIDER STATE
"^DD",399,399.0222,.01,1,3,0)
399.0222^C^MUMPS
"^DD",399,399.0222,.01,1,3,1)
S ^DGCR(399,DA(1),"PRV","C",$E($$EXTERNAL^DILFD(399.0222,.01,,X),1,30),DA)=""
"^DD",399,399.0222,.01,1,3,2)
K ^DGCR(399,DA(1),"PRV","C",$E($$EXTERNAL^DILFD(399.0222,.01,,X),1,30),DA)
"^DD",399,399.0222,.01,1,3,"DT")
2991221
"^DD",399,399.0222,.01,1,4,0)
399.0222^CA^MUMPS
"^DD",399,399.0222,.01,1,4,1)
S ^DGCR(399,DA(1),"PRV","C",$$LOW^XLFSTR($E($$EXTERNAL^DILFD(399.0222,.01,,X),1,30)),DA)=""
"^DD",399,399.0222,.01,1,4,2)
K ^DGCR(399,DA(1),"PRV","C",$$LOW^XLFSTR($E($$EXTERNAL^DILFD(399.0222,.01,,X),1,30)),DA)
"^DD",399,399.0222,.01,1,4,"DT")
3000329
"^DD",399,399.0222,.01,3)
Select the function performed by a provider for this bill.
"^DD",399,399.0222,.01,4)
D PRVHELP^IBCEU5
"^DD",399,399.0222,.01,12)
Function must match bill form type.  Use '??' to see the function definitions.
"^DD",399,399.0222,.01,12.1)
S DIC("S")="I $$PRVOK^IBCEU(+Y,$S($G(D0):D0,1:$G(DA)))"
"^DD",399,399.0222,.01,21,0)
^^8^8^3101006^
"^DD",399,399.0222,.01,21,1,0)
 
"^DD",399,399.0222,.01,21,2,0)
There are providers who performed specific functions for the
"^DD",399,399.0222,.01,21,3,0)
services on this bill.  These providers are needed to enable the V.A.
"^DD",399,399.0222,.01,21,4,0)
to collect reimbursement when more than one provider function is
"^DD",399,399.0222,.01,21,5,0)
involved in the billable episode (like an operating physician or
"^DD",399,399.0222,.01,21,6,0)
referring provider).  This data identifies the type of function that
"^DD",399,399.0222,.01,21,7,0)
was performed by a provider. There can only be 1 provider recorded
"^DD",399,399.0222,.01,21,8,0)
for each function on a claim.
"^DD",399,399.0222,.01,"DT")
3101216
"^DD",399,399.0222,.02,0)
PERFORMED BY^V^^0;2^Q
"^DD",399,399.0222,.02,1,0)
^.1
"^DD",399,399.0222,.02,1,1,0)
^^TRIGGER^399.0222^.05
"^DD",399,399.0222,.02,1,1,1)
X ^DD(399.0222,.02,1,1,1.3) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X="" X ^DD(399.0222,.02,1,1,1.4)
"^DD",399,399.0222,.02,1,1,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,5)="SLF000"
"^DD",399,399.0222,.02,1,1,1.4)
S DIH=$S($D(^DGCR(399,DIV(0),"PRV",DIV(1),0)):^(0),1:""),DIV=X S $P(^(0),U,5)=DIV,DIH=399.0222,DIG=.05 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",399,399.0222,.02,1,1,2)
Q
"^DD",399,399.0222,.02,1,1,3)
Do not delete
"^DD",399,399.0222,.02,1,1,"%D",0)
^.101^2^2^3040526^^
"^DD",399,399.0222,.02,1,1,"%D",1,0)
This cross reference deletes any SLF000 id in the primary insurance id if
"^DD",399,399.0222,.02,1,1,"%D",2,0)
a provider name is entered.
"^DD",399,399.0222,.02,1,1,"CREATE CONDITION")
PRIMARY INS CO ID NUMBER="SLF000"
"^DD",399,399.0222,.02,1,1,"CREATE VALUE")
@
"^DD",399,399.0222,.02,1,1,"DELETE VALUE")
NO EFFECT
"^DD",399,399.0222,.02,1,1,"DT")
3000330
"^DD",399,399.0222,.02,1,1,"FIELD")
PRIMARY INS CO ID NUMBER
"^DD",399,399.0222,.02,1,2,0)
^^TRIGGER^399.0222^.03
"^DD",399,399.0222,.02,1,2,1)
X ^DD(399.0222,.02,1,2,1.3) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S X=$$EXTCR^IBCEU5(X) X ^DD(399.0222,.02,1,2,1.4)
"^DD",399,399.0222,.02,1,2,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(2)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:""),Y=Y(0) X:$D(^DD(399.0222,.02,2)) ^(2) S X=Y'["*",Y(1)=X S X=$P(Y(2),U,3)="",Y=X,X=Y(1),X=X&Y
"^DD",399,399.0222,.02,1,2,1.4)
S DIH=$S($D(^DGCR(399,DIV(0),"PRV",DIV(1),0)):^(0),1:""),DIV=X S $P(^(0),U,3)=DIV,DIH=399.0222,DIG=.03 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",399,399.0222,.02,1,2,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X="" X ^DD(399.0222,.02,1,2,2.4)
"^DD",399,399.0222,.02,1,2,2.4)
S DIH=$S($D(^DGCR(399,DIV(0),"PRV",DIV(1),0)):^(0),1:""),DIV=X S $P(^(0),U,3)=DIV,DIH=399.0222,DIG=.03 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",399,399.0222,.02,1,2,3)
Do not delete
"^DD",399,399.0222,.02,1,2,"%D",0)
^.101^4^4^3000926^^
"^DD",399,399.0222,.02,1,2,"%D",1,0)
This trigger will force the CREDENTIALS field of the provider multiple to be
"^DD",399,399.0222,.02,1,2,"%D",2,0)
set to the first 3 characters of the provider's degree if the credentials
"^DD",399,399.0222,.02,1,2,"%D",3,0)
don't already exist.
"^DD",399,399.0222,.02,1,2,"CREATE CONDITION")
CREDENTIALS=""
"^DD",399,399.0222,.02,1,2,"CREATE VALUE")
S X=$$EXTCR^IBCEU5(X)
"^DD",399,399.0222,.02,1,2,"DELETE VALUE")
@
"^DD",399,399.0222,.02,1,2,"DT")
3000405
"^DD",399,399.0222,.02,1,2,"FIELD")
CREDENTIALS
"^DD",399,399.0222,.02,1,3,0)
^^TRIGGER^399.0222^.08
"^DD",399,399.0222,.02,1,3,1)
X ^DD(399.0222,.02,1,3,1.3) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X=DIV S X=$$SPEC^IBCEU(X,$P($G(^DGCR(399,D0,"U")),U)) X ^DD(399.0222,.02,1,3,1.4)
"^DD",399,399.0222,.02,1,3,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,8)=""
"^DD",399,399.0222,.02,1,3,1.4)
S DIH=$G(^DGCR(399,DIV(0),"PRV",DIV(1),0)),DIV=X S $P(^(0),U,8)=DIV,DIH=399.0222,DIG=.08 D ^DICR
"^DD",399,399.0222,.02,1,3,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X="" X ^DD(399.0222,.02,1,3,2.4)
"^DD",399,399.0222,.02,1,3,2.4)
S DIH=$G(^DGCR(399,DIV(0),"PRV",DIV(1),0)),DIV=X S $P(^(0),U,8)=DIV,DIH=399.0222,DIG=.08 D ^DICR
"^DD",399,399.0222,.02,1,3,3)
Do not delete
"^DD",399,399.0222,.02,1,3,"%D",0)
^^2^2^3070727^
"^DD",399,399.0222,.02,1,3,"%D",1,0)
This trigger will force the SPECIALTY field of the provider multiple to be
"^DD",399,399.0222,.02,1,3,"%D",2,0)
set to the current specialty of the provider.
"^DD",399,399.0222,.02,1,3,"CREATE CONDITION")
SPECIALTY=""
"^DD",399,399.0222,.02,1,3,"CREATE VALUE")
S X=$$SPEC^IBCEU(X,$P($G(^DGCR(399,D0,"U")),U))
"^DD",399,399.0222,.02,1,3,"DELETE VALUE")
@
"^DD",399,399.0222,.02,1,3,"DT")
3070727
"^DD",399,399.0222,.02,1,3,"FIELD")
SPECIALTY
"^DD",399,399.0222,.02,1,4,0)
^^TRIGGER^399.0222^.05
"^DD",399,399.0222,.02,1,4,1)
Q
"^DD",399,399.0222,.02,1,4,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X="" X ^DD(399.0222,.02,1,4,2.4)
"^DD",399,399.0222,.02,1,4,2.4)
S DIH=$G(^DGCR(399,DIV(0),"PRV",DIV(1),0)),DIV=X S $P(^(0),U,5)=DIV,DIH=399.0222,DIG=.05 D ^DICR
"^DD",399,399.0222,.02,1,4,3)
Do not delete
"^DD",399,399.0222,.02,1,4,"%D",0)
^^2^2^3040526^
"^DD",399,399.0222,.02,1,4,"%D",1,0)
This xref deletes the PRIMARY INS CO ID NUMBER when the provider is
"^DD",399,399.0222,.02,1,4,"%D",2,0)
changed.
"^DD",399,399.0222,.02,1,4,"CREATE VALUE")
NO EFFECT
"^DD",399,399.0222,.02,1,4,"DELETE VALUE")
@
"^DD",399,399.0222,.02,1,4,"DT")
3040526
"^DD",399,399.0222,.02,1,4,"FIELD")
PRIMARY INS CO ID NUMBER
"^DD",399,399.0222,.02,1,5,0)
^^TRIGGER^399.0222^.06
"^DD",399,399.0222,.02,1,5,1)
Q
"^DD",399,399.0222,.02,1,5,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,6),X=X S DIU=X K Y S X="" X ^DD(399.0222,.02,1,5,2.4)
"^DD",399,399.0222,.02,1,5,2.4)
S DIH=$G(^DGCR(399,DIV(0),"PRV",DIV(1),0)),DIV=X S $P(^(0),U,6)=DIV,DIH=399.0222,DIG=.06 D ^DICR
"^DD",399,399.0222,.02,1,5,3)
Do not delete
"^DD",399,399.0222,.02,1,5,"%D",0)
^^2^2^3040526^
"^DD",399,399.0222,.02,1,5,"%D",1,0)
This xref deletes the SECONDARY INS CO ID NUMBER when the provider is
"^DD",399,399.0222,.02,1,5,"%D",2,0)
changed.
"^DD",399,399.0222,.02,1,5,"CREATE VALUE")
NO EFFECT
"^DD",399,399.0222,.02,1,5,"DELETE VALUE")
@
"^DD",399,399.0222,.02,1,5,"DT")
3040526
"^DD",399,399.0222,.02,1,5,"FIELD")
SECONDARY INS CO ID NUMBER
"^DD",399,399.0222,.02,1,6,0)
^^TRIGGER^399.0222^.07
"^DD",399,399.0222,.02,1,6,1)
Q
"^DD",399,399.0222,.02,1,6,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X="" X ^DD(399.0222,.02,1,6,2.4)
"^DD",399,399.0222,.02,1,6,2.4)
S DIH=$G(^DGCR(399,DIV(0),"PRV",DIV(1),0)),DIV=X S $P(^(0),U,7)=DIV,DIH=399.0222,DIG=.07 D ^DICR
"^DD",399,399.0222,.02,1,6,3)
Do not delete
"^DD",399,399.0222,.02,1,6,"%D",0)
^^2^2^3040526^
"^DD",399,399.0222,.02,1,6,"%D",1,0)
This xref deletes the TERTIARY INS CO ID NUMBER when the provider is
"^DD",399,399.0222,.02,1,6,"%D",2,0)
changed.
"^DD",399,399.0222,.02,1,6,"CREATE VALUE")
NO EFFECT
"^DD",399,399.0222,.02,1,6,"DELETE VALUE")
@
"^DD",399,399.0222,.02,1,6,"DT")
3040526
"^DD",399,399.0222,.02,1,6,"FIELD")
TERTIARY INS CO ID NUMBER
"^DD",399,399.0222,.02,1,7,0)
^^TRIGGER^399.0222^.15
"^DD",399,399.0222,.02,1,7,1)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,15),X=X S DIU=X K Y X ^DD(399.0222,.02,1,7,1.1) X ^DD(399.0222,.02,1,7,1.4)
"^DD",399,399.0222,.02,1,7,1.1)
S X=DIV S X=$P($$GETTAX^IBCEF73A(X,$P(^DGCR(399,D0,0),U,3)),U,2)
"^DD",399,399.0222,.02,1,7,1.4)
S DIH=$G(^DGCR(399,DIV(0),"PRV",DIV(1),0)),DIV=X S $P(^(0),U,15)=DIV,DIH=399.0222,DIG=.15 D ^DICR
"^DD",399,399.0222,.02,1,7,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^DGCR(399,D0,"PRV",D1,0)):^(0),1:"") S X=$P(Y(1),U,15),X=X S DIU=X K Y S X="" X ^DD(399.0222,.02,1,7,2.4)
"^DD",399,399.0222,.02,1,7,2.4)
S DIH=$G(^DGCR(399,DIV(0),"PRV",DIV(1),0)),DIV=X S $P(^(0),U,15)=DIV,DIH=399.0222,DIG=.15 D ^DICR
"^DD",399,399.0222,.02,1,7,"%D",0)
^^3^3^3101228^
"^DD",399,399.0222,.02,1,7,"%D",1,0)
This trigger updates the TAXONOMY field with the provider's taxonomy code 
"^DD",399,399.0222,.02,1,7,"%D",2,0)
if the event date of the claim is covered, otherwise, it will set the 
"^DD",399,399.0222,.02,1,7,"%D",3,0)
TAXONOMY field to null.
"^DD",399,399.0222,.02,1,7,"CREATE VALUE")
S X=$P($$GETTAX^IBCEF73A(X,$P(^DGCR(399,D0,0),U,3)),U,2)
"^DD",399,399.0222,.02,1,7,"DELETE VALUE")
@
"^DD",399,399.0222,.02,1,7,"DT")
3101228
"^DD",399,399.0222,.02,1,7,"FIELD")
TAXONOMY
"^DD",399,399.0222,.02,3)
Enter the name of the provider who performed the indicated function
"^DD",399,399.0222,.02,4)
 
"^DD",399,399.0222,.02,21,0)
^.001^2^2^3101223^^^^
"^DD",399,399.0222,.02,21,1,0)
Providers may be VA providers found in the VistA NEW PERSON file or
"^DD",399,399.0222,.02,21,2,0)
NON-VA providers found in the IB NON VA BILLING PROVIDER file.
"^DD",399,399.0222,.02,"DT")
3101228
"^DD",399,399.0222,.02,"V",0)
^.12P^2^2
"^DD",399,399.0222,.02,"V",1,0)
200^VistA identified provider^1^VA^y^n
"^DD",399,399.0222,.02,"V",1,1)
S DIC("S")="I $O(^(""USC1"",0))"
"^DD",399,399.0222,.02,"V",1,2)
VistA provider must have a person class defined
"^DD",399,399.0222,.02,"V",2,0)
355.93^Non-VA provider^2^NVA^y^y
"^DD",399,399.0222,.02,"V",2,1)
S DIC("S")="I 1"
"^DD",399,399.0222,.02,"V",2,2)
Non VA providers can be individuals or facilities
"^DD",399,399.0304,19,0)
PURCHASED COST^NJ10,2^^0;19^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<0) X
"^DD",399,399.0304,19,3)
Type a dollar amount between 0 and 9999999.99, 2 decimal digits.
"^DD",399,399.0304,19,21,0)
^.001^2^2^3100924^^
"^DD",399,399.0304,19,21,1,0)
This is the actual amount the VA paid for a service provided
"^DD",399,399.0304,19,21,2,0)
to a VA patient at a NON-VA facility or provider.
"^DD",399,399.0304,19,"DT")
3100924
"^DD",399,399.0304,60,0)
LINE PROVIDER^399.0404IS^^LNPRV;0
"^DD",399,399.0304,60,21,0)
^^2^2^3101013^
"^DD",399,399.0304,60,21,1,0)
These are the providers who performed specific functions for the services
"^DD",399,399.0304,60,21,2,0)
on this claim line.
"^DD",399,399.0304,70,0)
ATTACHMENT CONTROL NUMBER^F^^1;1^K:$L(X)>30!($L(X)<1) X
"^DD",399,399.0304,70,3)
Enter an (1-30 chars) Attachment Control Number (alphanumeric).
"^DD",399,399.0304,70,21,0)
^^2^2^3101025^
"^DD",399,399.0304,70,21,1,0)
The Attachment Control Number (alphanumeric) identifies the documentation
"^DD",399,399.0304,70,21,2,0)
that will provide additional information for this claim line.
"^DD",399,399.0304,70,"DT")
3101025
"^DD",399,399.0304,71,0)
ATTACHMENT REPORT TYPE^P353.3'^IBE(353.3,^1;2^Q
"^DD",399,399.0304,71,3)
Enter a Report Type.
"^DD",399,399.0304,71,21,0)
^^2^2^3101025^
"^DD",399,399.0304,71,21,1,0)
The Report Type describes the type of documentation that will provide
"^DD",399,399.0304,71,21,2,0)
additional information for this claim line.
"^DD",399,399.0304,71,"DT")
3101025
"^DD",399,399.0304,72,0)
ATTACHMENT REPORT TRANS CODE^S^AA:Available on Request at Provider Site;BM:By Mail;EL:Electronically Only;EM:E-Mail;FT:File Transfer;FX:By Fax;^1;3^Q
"^DD",399,399.0304,72,3)
Select the Attachment Transmission Method.
"^DD",399,399.0304,72,21,0)
^^1^1^3101025^
"^DD",399,399.0304,72,21,1,0)
This is the method for transmitting the claim line.
"^DD",399,399.0304,72,"DT")
3101025
"^DD",399,399.0304,74,0)
ADDITIONAL OB MINUTES^NJ4,0^^1;5^K:+X'=X!(X>1440)!(X<1)!(X?.E1"."1.N) X
"^DD",399,399.0304,74,3)
Enter the number of additional minutes (1-1440) needed for anesthesia for obstetric services than those reported in the normal procedure base units.
"^DD",399,399.0304,74,21,0)
^^2^2^3101026^
"^DD",399,399.0304,74,21,1,0)
This is the number of additional minutes needed for anesthesia for
"^DD",399,399.0304,74,21,2,0)
obstetric services than those reported in the normal procedure base units.
"^DD",399,399.0304,74,"DT")
3101026
"^DD",399,399.0404,0)
LINE PROVIDER SUB-FIELD^^.14^12
"^DD",399,399.0404,0,"DIK")
IBXX
"^DD",399,399.0404,0,"DT")
3101025
"^DD",399,399.0404,0,"ID",.02)
S DIY=$S($D(@(DIC_(+Y)_",""0"")")):$P(^("0"),U,2),1:"") D NAME^DICM2 W "   ",DINAME,@("$E("_DIC_"Y,0),0)")
"^DD",399,399.0404,0,"IX","B",399.0404,.01)

"^DD",399,399.0404,0,"NM","LINE PROVIDER")

"^DD",399,399.0404,0,"UP")
399.0304
"^DD",399,399.0404,.01,0)
LINE FUNCTION^M*S^1:REFERRING;2:OPERATING;3:RENDERING;4:ATTENDING;5:SUPERVISING;9:OTHER OPERATING;^0;1^Q
"^DD",399,399.0404,.01,1,0)
^.1^^-1
"^DD",399,399.0404,.01,1,1,0)
399.0404^B
"^DD",399,399.0404,.01,1,1,1)
S ^DGCR(399,DA(2),"CP",DA(1),"LNPRV","B",$E(X,1,30),DA)=""
"^DD",399,399.0404,.01,1,1,2)
K ^DGCR(399,DA(2),"CP",DA(1),"LNPRV","B",$E(X,1,30),DA)
"^DD",399,399.0404,.01,1,2,0)
^^TRIGGER^399.0404^.04
"^DD",399,399.0404,.01,1,2,1)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(0)=X S X=Y(0),X=X S X=X'=1 I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X="" X ^DD(399.0404,.01,1,2,1.4)
"^DD",399,399.0404,.01,1,2,1.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=399.0404,DIG=.04 D ^DICR
"^DD",399,399.0404,.01,1,2,2)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X="" X ^DD(399.0404,.01,1,2,2.4)
"^DD",399,399.0404,.01,1,2,2.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=399.0404,DIG=.04 D ^DICR
"^DD",399,399.0404,.01,1,2,3)
Do Not Delete
"^DD",399,399.0404,.01,1,2,"%D",0)
^^2^2^3100914^
"^DD",399,399.0404,.01,1,2,"%D",1,0)
This xref is used to delete the state field if the provider is not a
"^DD",399,399.0404,.01,1,2,"%D",2,0)
referring provider function type.
"^DD",399,399.0404,.01,1,2,"CREATE CONDITION")
INTERNAL(LINE PROVIDER LINE FUNCTION)'=1
"^DD",399,399.0404,.01,1,2,"CREATE VALUE")
@
"^DD",399,399.0404,.01,1,2,"DELETE VALUE")
@
"^DD",399,399.0404,.01,1,2,"DT")
3100914
"^DD",399,399.0404,.01,1,2,"FIELD")
LINE PROVIDER STATE
"^DD",399,399.0404,.01,3)
Select the function performed by a provider for this claim line.
"^DD",399,399.0404,.01,4)
D LNPRVHLP^IBCEU7
"^DD",399,399.0404,.01,12)
Function must match bill form type. Use '??' to see the function definitions.
"^DD",399,399.0404,.01,12.1)
S DIC("S")="I $$LNPRVOK^IBCEU7(+Y,$G(DA(2)))"
"^DD",399,399.0404,.01,21,0)
^^6^6^3100908^
"^DD",399,399.0404,.01,21,1,0)
There are providers who performed specific functions for the services on
"^DD",399,399.0404,.01,21,2,0)
this claim line. These providers are needed to enable the V.A. to collect
"^DD",399,399.0404,.01,21,3,0)
reimbursement when more than one provider function is involved in the
"^DD",399,399.0404,.01,21,4,0)
billable episode (like an operating physician or referring provider). This
"^DD",399,399.0404,.01,21,5,0)
data identifies the type of function that was performed by a provider.  
"^DD",399,399.0404,.01,21,6,0)
There can only be 1 provider recorded for each function on a claim line.
"^DD",399,399.0404,.01,"DT")
3101025
"^DD",399,399.0404,.02,0)
LINE PERFORMED BY^V^^0;2^
"^DD",399,399.0404,.02,1,0)
^.1
"^DD",399,399.0404,.02,1,1,0)
^^TRIGGER^399.0404^.05
"^DD",399,399.0404,.02,1,1,1)
X ^DD(399.0404,.02,1,1,1.3) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X="" X ^DD(399.0404,.02,1,1,1.4)
"^DD",399,399.0404,.02,1,1,1.3)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(0)=X S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,5)="SLF000"
"^DD",399,399.0404,.02,1,1,1.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,5)=DIV,DIH=399.0404,DIG=.05 D ^DICR
"^DD",399,399.0404,.02,1,1,2)
Q
"^DD",399,399.0404,.02,1,1,3)
Do Not Delete
"^DD",399,399.0404,.02,1,1,"%D",0)
^^2^2^3100914^
"^DD",399,399.0404,.02,1,1,"%D",1,0)
This cross reference deletes any SLF000 id in the primary insurance id if
"^DD",399,399.0404,.02,1,1,"%D",2,0)
a provider name is entered.
"^DD",399,399.0404,.02,1,1,"CREATE CONDITION")
PRIMARY INS CO ID NUMBER="SLF000"
"^DD",399,399.0404,.02,1,1,"CREATE VALUE")
@
"^DD",399,399.0404,.02,1,1,"DELETE VALUE")
NO EFFECT
"^DD",399,399.0404,.02,1,1,"FIELD")
PRIMARY INS CO ID NUMBER
"^DD",399,399.0404,.02,1,2,0)
^^TRIGGER^399.0404^.03
"^DD",399,399.0404,.02,1,2,1)
X ^DD(399.0404,.02,1,2,1.3) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S X=$$EXTCR^IBCEU5(X) X ^DD(399.0404,.02,1,2,1.4)
"^DD",399,399.0404,.02,1,2,1.3)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(0)=X S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,3)=""
"^DD",399,399.0404,.02,1,2,1.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=399.0404,DIG=.03 D ^DICR
"^DD",399,399.0404,.02,1,2,2)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X="" X ^DD(399.0404,.02,1,2,2.4)
"^DD",399,399.0404,.02,1,2,2.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=399.0404,DIG=.03 D ^DICR
"^DD",399,399.0404,.02,1,2,3)
Do not delete
"^DD",399,399.0404,.02,1,2,"%D",0)
^.101^3^3^3100916^^
"^DD",399,399.0404,.02,1,2,"%D",1,0)
This trigger will force the CREDENTIALS field of the line provider
"^DD",399,399.0404,.02,1,2,"%D",2,0)
multiple to be set to the first 3 characters of the provider's degree if
"^DD",399,399.0404,.02,1,2,"%D",3,0)
the credentials don't already exist.
"^DD",399,399.0404,.02,1,2,"CREATE CONDITION")
CREDENTIALS=""
"^DD",399,399.0404,.02,1,2,"CREATE VALUE")
S X=$$EXTCR^IBCEU5(X)
"^DD",399,399.0404,.02,1,2,"DELETE VALUE")
@
"^DD",399,399.0404,.02,1,2,"DT")
3100914
"^DD",399,399.0404,.02,1,2,"FIELD")
CREDENTIALS
"^DD",399,399.0404,.02,1,3,0)
^^TRIGGER^399.0404^.08
"^DD",399,399.0404,.02,1,3,1)
X ^DD(399.0404,.02,1,3,1.3) I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y X ^DD(399.0404,.02,1,3,1.1) X ^DD(399.0404,.02,1,3,1.4)
"^DD",399,399.0404,.02,1,3,1.1)
S X=DIV S X=$$SPEC^IBCEU(X,$P($G(^DGCR(399,D0,"U")),U))
"^DD",399,399.0404,.02,1,3,1.3)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(0)=X S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,8)=""
"^DD",399,399.0404,.02,1,3,1.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,8)=DIV,DIH=399.0404,DIG=.08 D ^DICR
"^DD",399,399.0404,.02,1,3,2)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,8),X=X S DIU=X K Y S X="" X ^DD(399.0404,.02,1,3,2.4)
"^DD",399,399.0404,.02,1,3,2.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,8)=DIV,DIH=399.0404,DIG=.08 D ^DICR
"^DD",399,399.0404,.02,1,3,3)
Do not delete
"^DD",399,399.0404,.02,1,3,"%D",0)
^^2^2^3100914^
"^DD",399,399.0404,.02,1,3,"%D",1,0)
This trigger will force the SPECIALTY field of the line provider multiple
"^DD",399,399.0404,.02,1,3,"%D",2,0)
to be set to the current specialty of the provider.
"^DD",399,399.0404,.02,1,3,"CREATE CONDITION")
SPECIALTY=""
"^DD",399,399.0404,.02,1,3,"CREATE VALUE")
S X=$$SPEC^IBCEU(X,$P($G(^DGCR(399,D0,"U")),U))
"^DD",399,399.0404,.02,1,3,"DELETE VALUE")
@
"^DD",399,399.0404,.02,1,3,"DT")
3100914
"^DD",399,399.0404,.02,1,3,"FIELD")
SPECIALTY
"^DD",399,399.0404,.02,1,4,0)
^^TRIGGER^399.0404^.05
"^DD",399,399.0404,.02,1,4,1)
Q
"^DD",399,399.0404,.02,1,4,2)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X="" X ^DD(399.0404,.02,1,4,2.4)
"^DD",399,399.0404,.02,1,4,2.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,5)=DIV,DIH=399.0404,DIG=.05 D ^DICR
"^DD",399,399.0404,.02,1,4,3)
Do not delete
"^DD",399,399.0404,.02,1,4,"%D",0)
^^2^2^3100914^
"^DD",399,399.0404,.02,1,4,"%D",1,0)
This xref deletes the PRIMARY INS CO ID NUMBER when the provider is
"^DD",399,399.0404,.02,1,4,"%D",2,0)
changed.  
"^DD",399,399.0404,.02,1,4,"CREATE VALUE")
NO EFFECT
"^DD",399,399.0404,.02,1,4,"DELETE VALUE")
@
"^DD",399,399.0404,.02,1,4,"DT")
3100914
"^DD",399,399.0404,.02,1,4,"FIELD")
PRIMARY INS CO ID NUMBER
"^DD",399,399.0404,.02,1,5,0)
^^TRIGGER^399.0404^.06
"^DD",399,399.0404,.02,1,5,1)
Q
"^DD",399,399.0404,.02,1,5,2)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,6),X=X S DIU=X K Y S X="" X ^DD(399.0404,.02,1,5,2.4)
"^DD",399,399.0404,.02,1,5,2.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,6)=DIV,DIH=399.0404,DIG=.06 D ^DICR
"^DD",399,399.0404,.02,1,5,3)
Do not delete
"^DD",399,399.0404,.02,1,5,"%D",0)
^^2^2^3100914^
"^DD",399,399.0404,.02,1,5,"%D",1,0)
This xref deletes the SECONDARY INS CO ID NUMBER when the provider is
"^DD",399,399.0404,.02,1,5,"%D",2,0)
changed.
"^DD",399,399.0404,.02,1,5,"CREATE VALUE")
NO EFFECT
"^DD",399,399.0404,.02,1,5,"DELETE VALUE")
@
"^DD",399,399.0404,.02,1,5,"DT")
3100914
"^DD",399,399.0404,.02,1,5,"FIELD")
SECONDARY INS CO ID NUMBER
"^DD",399,399.0404,.02,1,6,0)
^^TRIGGER^399.0404^.07
"^DD",399,399.0404,.02,1,6,1)
Q
"^DD",399,399.0404,.02,1,6,2)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X="" X ^DD(399.0404,.02,1,6,2.4)
"^DD",399,399.0404,.02,1,6,2.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,7)=DIV,DIH=399.0404,DIG=.07 D ^DICR
"^DD",399,399.0404,.02,1,6,3)
Do not delete
"^DD",399,399.0404,.02,1,6,"%D",0)
^^2^2^3100914^
"^DD",399,399.0404,.02,1,6,"%D",1,0)
This xref deletes the TERTIARY INS CO ID NUMBER when the provider is
"^DD",399,399.0404,.02,1,6,"%D",2,0)
changed.
"^DD",399,399.0404,.02,1,6,"CREATE VALUE")
NO EFFECT
"^DD",399,399.0404,.02,1,6,"DELETE VALUE")
@
"^DD",399,399.0404,.02,1,6,"DT")
3100914
"^DD",399,399.0404,.02,1,6,"FIELD")
TERTIARY INS CO ID NUMBER
"^DD",399,399.0404,.02,1,7,0)
^^TRIGGER^399.0404^.15
"^DD",399,399.0404,.02,1,7,1)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,15),X=X S DIU=X K Y X ^DD(399.0404,.02,1,7,1.1) X ^DD(399.0404,.02,1,7,1.4)
"^DD",399,399.0404,.02,1,7,1.1)
S X=DIV S X=$P($$GETTAX^IBCEF73A(X,$P(^DGCR(399,D0,0),U,3)),U,2)
"^DD",399,399.0404,.02,1,7,1.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,15)=DIV,DIH=399.0404,DIG=.15 D ^DICR
"^DD",399,399.0404,.02,1,7,2)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,15),X=X S DIU=X K Y S X="" X ^DD(399.0404,.02,1,7,2.4)
"^DD",399,399.0404,.02,1,7,2.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,15)=DIV,DIH=399.0404,DIG=.15 D ^DICR
"^DD",399,399.0404,.02,1,7,3)
Do not delete
"^DD",399,399.0404,.02,1,7,"%D",0)
^^3^3^3101229^
"^DD",399,399.0404,.02,1,7,"%D",1,0)
This trigger updates the LINE TAXONOMY field with the provider's taxonomy
"^DD",399,399.0404,.02,1,7,"%D",2,0)
code if the event date of the claim is covered, otherwise, it will set the
"^DD",399,399.0404,.02,1,7,"%D",3,0)
LINE TAXONOMY field to null.
"^DD",399,399.0404,.02,1,7,"CREATE VALUE")
S X=$P($$GETTAX^IBCEF73A(X,$P(^DGCR(399,D0,0),U,3)),U,2)
"^DD",399,399.0404,.02,1,7,"DELETE VALUE")
@
"^DD",399,399.0404,.02,1,7,"DT")
3101228
"^DD",399,399.0404,.02,1,7,"FIELD")
LINE TAXONOMY
"^DD",399,399.0404,.02,3)
Select the provider who performed the indicated function.
"^DD",399,399.0404,.02,21,0)
^^2^2^3101025^
"^DD",399,399.0404,.02,21,1,0)
Providers may be VA providers found in the VistA NEW PERSON file or
"^DD",399,399.0404,.02,21,2,0)
NON-VA providers found in the IB NON VA BILLING PROVIDER file.
"^DD",399,399.0404,.02,"DT")
3101228
"^DD",399,399.0404,.02,"V",0)
^.12P^^2
"^DD",399,399.0404,.02,"V",1,0)
200^VistA identified provider^1^VA^y^n
"^DD",399,399.0404,.02,"V",1,1)
S DIC("S")="I $O(^(""USC1"",0))"
"^DD",399,399.0404,.02,"V",1,2)
VistA provider must have a person class defined in NEW PERSON File (200).
"^DD",399,399.0404,.02,"V",2,0)
355.93^Non-VA provider^2^NVA^n^y
"^DD",399,399.0404,.03,0)
CREDENTIALS^F^^0;3^K:$L(X)>3!($L(X)<1) X
"^DD",399,399.0404,.03,3)
Enter up to 3 digits to describe the provider's credentials.
"^DD",399,399.0404,.03,21,0)
^^2^2^3100914^
"^DD",399,399.0404,.03,21,1,0)
This field should contain the 1-3 digit code for the provider's
"^DD",399,399.0404,.03,21,2,0)
credentials as they apply to the services being billed for.
"^DD",399,399.0404,.03,"DT")
3101014
"^DD",399,399.0404,.04,0)
STATE^P5'^DIC(5,^0;4^Q
"^DD",399,399.0404,.04,3)
Enter the state for the Referring Provider.
"^DD",399,399.0404,.04,5,1,0)
399.0404^.01^2
"^DD",399,399.0404,.04,5,2,0)
399.0404^.01^3
"^DD",399,399.0404,.04,21,0)
^^2^2^3101014^
"^DD",399,399.0404,.04,21,1,0)
This is the state of the Referring Provider. This is only used for
"^DD",399,399.0404,.04,21,2,0)
referring provider types.
"^DD",399,399.0404,.04,"DT")
3101014
"^DD",399,399.0404,.05,0)
PRIMARY INS CO ID NUMBER^F^^0;5^K:$L(X)>15!($L(X)<1) X
"^DD",399,399.0404,.05,.1)
PRIM INS PERF PROV SECONDARY ID
"^DD",399,399.0404,.05,1,0)
^.1
"^DD",399,399.0404,.05,1,1,0)
^^TRIGGER^399.0404^.02
"^DD",399,399.0404,.05,1,1,1)
K DIV S DIV=X,D0=DA(2),DIV(0)=D0,D1=DA(1),DIV(1)=D1,D2=DA,DIV(2)=D2 S Y(0)=X S X=Y(0)="SLF000" I X S X=DIV S Y(1)=$S($D(^DGCR(399,D0,"CP",D1,"LNPRV",D2,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X="" X ^DD(399.0404,.05,1,1,1.4)
"^DD",399,399.0404,.05,1,1,1.4)
S DIH=$G(^DGCR(399,DIV(0),"CP",DIV(1),"LNPRV",DIV(2),0)),DIV=X S $P(^(0),U,2)=DIV,DIH=399.0404,DIG=.02 D ^DICR
"^DD",399,399.0404,.05,1,1,2)
Q
"^DD",399,399.0404,.05,1,1,3)
Do not delete
"^DD",399,399.0404,.05,1,1,"%D",0)
^^1^1^3100914^
"^DD",399,399.0404,.05,1,1,"%D",1,0)
This erases the provider name if the id is SLF000.
"^DD",399,399.0404,.05,1,1,"CREATE CONDITION")
PRIMARY INS CO ID NUMBER="SLF000"
"^DD",399,399.0404,.05,1,1,"CREATE VALUE")
@
"^DD",399,399.0404,.05,1,1,"DELETE VALUE")
NO EFFECT
"^DD",399,399.0404,.05,1,1,"FIELD")
LINE PERFORMED BY
"^DD",399,399.0404,.05,3)
Answer must be 1-15 characters in length.
"^DD",399,399.0404,.05,4)

"^DD",399,399.0404,.05,5,1,0)
399.0404^.02^1
"^DD",399,399.0404,.05,5,2,0)
399.0404^.02^4
"^DD",399,399.0404,.05,21,0)
^.001^1^1^3101002^^
"^DD",399,399.0404,.05,21,1,0)
This is the primary insurance co specific provider's secondary id number.
"^DD",399,399.0404,.05,"DT")
3101014
"^DD",399,399.0404,.06,0)
SECONDARY INS CO ID NUMBER^F^^0;6^K:$L(X)>15!($L(X)<1) X
"^DD",399,399.0404,.06,.1)
SECOND INS PERF PROV SECONDARY ID
"^DD",399,399.0404,.06,3)
Answer must be 1-15 characters in length.
"^DD",399,399.0404,.06,4)

"^DD",399,399.0404,.06,5,1,0)
399.0404^.02^5
"^DD",399,399.0404,.06,21,0)
^.001^1^1^3101002^^
"^DD",399,399.0404,.06,21,1,0)
This is the secondary ins company's specific secondary provider id number.
"^DD",399,399.0404,.06,"DT")
3101014
"^DD",399,399.0404,.07,0)
TERTIARY INS CO ID NUMBER^F^^0;7^K:$L(X)>15!($L(X)<1) X
"^DD",399,399.0404,.07,.1)
TERTIARY INS PERF PROV SECONDARY ID
"^DD",399,399.0404,.07,3)
Answer must be 1-15 characters in length.
"^DD",399,399.0404,.07,4)

"^DD",399,399.0404,.07,5,1,0)
399.0404^.02^6
"^DD",399,399.0404,.07,21,0)
^.001^1^1^3101002^^
"^DD",399,399.0404,.07,21,1,0)
This is the tertiary ins company's specific secondary provider id number.
"^DD",399,399.0404,.07,"DT")
3101014
"^DD",399,399.0404,.08,0)
SPECIALTY^F^^0;8^K:$L(X)>2!($L(X)<2) X
"^DD",399,399.0404,.08,3)
Enter the 2 digit specialty code designation.
"^DD",399,399.0404,.08,5,1,0)
399.0404^.02^3
"^DD",399,399.0404,.08,21,0)
^^2^2^3100914^
"^DD",399,399.0404,.08,21,1,0)
This field contains the specialty code for the provider if the provider is
"^DD",399,399.0404,.08,21,2,0)
not resident in VistA's NEW PERSON file.
"^DD",399,399.0404,.08,"DT")
3100914
"^DD",399,399.0404,.12,0)
PRIM INS PROVIDER ID TYPE^*P355.97'^IBE(355.97,^0;12^S DIC("S")="I $$RAINS^IBCEPU(Y)!($$RAOWN^IBCEPU(Y))" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",399,399.0404,.12,.1)
PRIM INS PERF PROV SECONDARY ID TYPE
"^DD",399,399.0404,.12,3)
Enter the type of id the primary payer requires as a secondary id.
"^DD",399,399.0404,.12,12)
Must be valid for transmission.
"^DD",399,399.0404,.12,12.1)
S DIC("S")="I $$RAINS^IBCEPU(Y)!($$RAOWN^IBCEPU(Y))"
"^DD",399,399.0404,.12,21,0)
^^1^1^3100914^
"^DD",399,399.0404,.12,21,1,0)
This is the type of id the primary payer uses as a secondary id.
"^DD",399,399.0404,.12,"DT")
3100914
"^DD",399,399.0404,.13,0)
SEC INS PROVIDER ID TYPE^*P355.97'^IBE(355.97,^0;13^S DIC("S")="I $$RAINS^IBCEPU(Y)!($$RAOWN^IBCEPU(Y))" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",399,399.0404,.13,.1)
SECOND INS PERF PROV SECONDARY ID TYPE
"^DD",399,399.0404,.13,3)
Enter the type of id the secondary payer requires as a secondary id.
"^DD",399,399.0404,.13,12)
Must be valid for transmission.
"^DD",399,399.0404,.13,12.1)
S DIC("S")="I $$RAINS^IBCEPU(Y)!($$RAOWN^IBCEPU(Y))"
"^DD",399,399.0404,.13,21,0)
^^1^1^3101014^
"^DD",399,399.0404,.13,21,1,0)
This is the type of id the secondary payer requires as a secondary id.
"^DD",399,399.0404,.13,"DT")
3101014
"^DD",399,399.0404,.14,0)
TERT INS PROVIDER ID TYPE^*P355.97'^IBE(355.97,^0;14^S DIC("S")="I $$RAINS^IBCEPU(Y)!($$RAOWN^IBCEPU(Y))" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",399,399.0404,.14,.1)
TERTIARY INS PERF PROV SECONDARY ID TYPE
"^DD",399,399.0404,.14,3)
Enter the type of id the tertiary payer requires as a secondary id.
"^DD",399,399.0404,.14,12)
Must be valid for transmission.
"^DD",399,399.0404,.14,12.1)
S DIC("S")="I $$RAINS^IBCEPU(Y)!($$RAOWN^IBCEPU(Y))"
"^DD",399,399.0404,.14,21,0)
^^1^1^3100914^
"^DD",399,399.0404,.14,21,1,0)
This is the type of id the tertiary payer uses as a secondary id.
"^DD",399,399.0404,.14,"DT")
3100914
"^DD",399,399.0404,.15,0)
LINE TAXONOMY^P8932.1'^USC(8932.1,^0;15^Q
"^DD",399,399.0404,.15,3)
Enter the Taxonomy Code associated with this entry.
"^DD",399,399.0404,.15,5,1,0)
399.0404^.02^7
"^DD",399,399.0404,.15,21,0)
^^1^1^3101014^^
"^DD",399,399.0404,.15,21,1,0)
This is the Taxonomy Code associated with this entry.
"^DD",399,399.0404,.15,"DT")
3101014
"^DD",399,399.042,.02,0)
CHARGES^RNJ10,2^^0;2^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<0) X
"^DD",399,399.042,.02,1,0)
^.1^^-1
"^DD",399,399.042,.02,1,1,0)
399.042^TC1^MUMPS
"^DD",399,399.042,.02,1,1,1)
D 21^IBCU2
"^DD",399,399.042,.02,1,1,2)
D 22^IBCU2
"^DD",399,399.042,.02,1,1,"%D",0)
^^1^1^2940214^
"^DD",399,399.042,.02,1,1,"%D",1,0)
Sets/deletes total charges.
"^DD",399,399.042,.02,1,1,"DT")
2920921
"^DD",399,399.042,.02,3)
Type a dollar amount between 0 and 9999999.99, 2 decimal digits.
"^DD",399,399.042,.02,21,0)
^.001^3^3^3100924^^^
"^DD",399,399.042,.02,21,1,0)
This is the unit charge for this revenue code.  It will be
"^DD",399,399.042,.02,21,2,0)
multiplied times the number of units to determine the total cost for
"^DD",399,399.042,.02,21,3,0)
this revenue code.
"^DD",399,399.042,.02,"DT")
3100924
"^DD",399,399.042,.04,0)
TOTAL^RNJ9,2XI^^0;4^K:X?1.10N.1".".2N X
"^DD",399,399.042,.04,1,0)
^.1^^-1
"^DD",399,399.042,.04,1,1,0)
399.042^ATC^MUMPS
"^DD",399,399.042,.04,1,1,1)
S DGXRF=1 D TC^IBCU2 K DGXRF
"^DD",399,399.042,.04,1,1,2)
S DGXRF=2 D TC^IBCU2 K DGXRF
"^DD",399,399.042,.04,1,1,"%D",0)
^.101^1^1^3010522^^^^
"^DD",399,399.042,.04,1,1,"%D",1,0)
Sets/deletes total charges
"^DD",399,399.042,.04,1,1,"DT")
2920921
"^DD",399,399.042,.04,3)
Type a Dollar Amount between 0 and 9999999.99, 2 Decimal Digits
"^DD",399,399.042,.04,21,0)
^.001^2^2^3100924^^^
"^DD",399,399.042,.04,21,1,0)
This is the total charges for this revenue code.  It is computed by the
"^DD",399,399.042,.04,21,2,0)
system.
"^DD",399,399.042,.04,"DT")
2920921
"^DD",399,399.042,.09,0)
NON-COVERED CHARGE^NJ10,2^^0;9^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<0) X
"^DD",399,399.042,.09,3)
Type a dollar amount between 0 and 9999999.99, 2 decimal digits.
"^DD",399,399.042,.09,21,0)
^.001^3^3^3100924^^^
"^DD",399,399.042,.09,21,1,0)
This is the amount of the charges that are not covered for this revenue
"^DD",399,399.042,.09,21,2,0)
code line item.  Use to record things such as pass days that need to be
"^DD",399,399.042,.09,21,3,0)
reported but are not chargeable.
"^DD",399,399.042,.09,"DT")
3100924
"^DD",399,399.078,0)
EOB CLAIM COMMENTS SUB-FIELD^^.03^3
"^DD",399,399.078,0,"DIK")
IBXX
"^DD",399,399.078,0,"DT")
3101008
"^DD",399,399.078,0,"IX","B",399.078,.01)

"^DD",399,399.078,0,"NM","EOB CLAIM COMMENTS")

"^DD",399,399.078,0,"UP")
399
"^DD",399,399.078,.01,0)
EOB CLAIM COMMENTS^D^^0;1^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",399,399.078,.01,1,0)
^.1
"^DD",399,399.078,.01,1,1,0)
399.078^B
"^DD",399,399.078,.01,1,1,1)
S ^DGCR(399,DA(1),"TXC2","B",$E(X,1,30),DA)=""
"^DD",399,399.078,.01,1,1,2)
K ^DGCR(399,DA(1),"TXC2","B",$E(X,1,30),DA)
"^DD",399,399.078,.01,1,2,0)
^^TRIGGER^399.078^.02
"^DD",399,399.078,.01,1,2,1)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^DGCR(399,D0,"TXC2",D1,0)):^(0),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X=DIV S X=DUZ X ^DD(399.078,.01,1,2,1.4)
"^DD",399,399.078,.01,1,2,1.4)
S DIH=$G(^DGCR(399,DIV(0),"TXC2",DIV(1),0)),DIV=X S $P(^(0),U,2)=DIV,DIH=399.078,DIG=.02 D ^DICR
"^DD",399,399.078,.01,1,2,2)
Q
"^DD",399,399.078,.01,1,2,"%D",0)
^^2^2^3101012^
"^DD",399,399.078,.01,1,2,"%D",1,0)
This trigger stores the user who added the comment in the COMMENT ENTERED
"^DD",399,399.078,.01,1,2,"%D",2,0)
BY (#.02) field of this subfile (#399.078).
"^DD",399,399.078,.01,1,2,"CREATE VALUE")
S X=DUZ
"^DD",399,399.078,.01,1,2,"DELETE VALUE")
NO EFFECT
"^DD",399,399.078,.01,1,2,"DT")
3100830
"^DD",399,399.078,.01,1,2,"FIELD")
#.02
"^DD",399,399.078,.01,3)
(No range limit on date)
"^DD",399,399.078,.01,21,0)
^^2^2^3100830^
"^DD",399,399.078,.01,21,1,0)
This is the date/time the comment was entered into the system.  Set
"^DD",399,399.078,.01,21,2,0)
automatically.  Don't edit through Fileman.
"^DD",399,399.078,.01,"DT")
3101008
"^DD",399,399.078,.02,0)
COMMENT ENTERED BY^P200'^VA(200,^0;2^Q
"^DD",399,399.078,.02,5,1,0)
399.078^.01^2
"^DD",399,399.078,.02,9)
^
"^DD",399,399.078,.02,21,0)
^^2^2^3100830^
"^DD",399,399.078,.02,21,1,0)
This is the user who entered the comment.  Set by the system
"^DD",399,399.078,.02,21,2,0)
automatically.  Don't edit through Fileman.
"^DD",399,399.078,.02,"DT")
3100830
"^DD",399,399.078,.03,0)
COMMENTS^399.0781^^1;0
"^DD",399,399.078,.03,21,0)
^^3^3^3101012^
"^DD",399,399.078,.03,21,1,0)
These are the comments entered from the COB Management worklist for 
"^DD",399,399.078,.03,21,2,0)
non-Medicare claims. They can be viewed from either TPJI or the COB 
"^DD",399,399.078,.03,21,3,0)
Management worklist.
"^DD",399,399.0781,0)
COMMENTS SUB-FIELD^^.01^1
"^DD",399,399.0781,0,"DT")
3100830
"^DD",399,399.0781,0,"NM","COMMENTS")

"^DD",399,399.0781,0,"UP")
399.078
"^DD",399,399.0781,.01,0)
COMMENTS^Wx^^0;1^Q
"^DD",399,399.0781,.01,"DT")
3100830
"^DIC",350.8,350.8,0)
IB ERROR
"^DIC",350.8,350.8,0,"GL")
^IBE(350.8,
"^DIC",350.8,350.8,"%D",0)
^^11^11^2940214^^^^
"^DIC",350.8,350.8,"%D",1,0)
This file contains errors for billing functions.  It may be used by
"^DIC",350.8,350.8,"%D",2,0)
applications, IB or AR.  The normal format for a routine to return
"^DIC",350.8,350.8,"%D",3,0)
an error is to return the variable:
"^DIC",350.8,350.8,"%D",4,0)
  Y=1^... a successful event occured
"^DIC",350.8,350.8,"%D",5,0)
  Y=-1^error code[;error code;error code...]^additional text
"^DIC",350.8,350.8,"%D",6,0)
The error messages can be displayed by calling routine ^IBAERR.  If
"^DIC",350.8,350.8,"%D",7,0)
the error occurs in a tasked job ($D(ZTQUEUED)'=0) the routine will
"^DIC",350.8,350.8,"%D",8,0)
put the error message in a bulletin and post it to the group defined
"^DIC",350.8,350.8,"%D",9,0)
in the IB SITE PARAMETER FILE.
"^DIC",350.8,350.8,"%D",10,0)
 
"^DIC",350.8,350.8,"%D",11,0)
Per VHA Directive 10-93-142, this file definition should not be modified.
"^DIC",350.8,"B","IB ERROR",350.8)

"^DIC",353.3,353.3,0)
IB ATTACHMENT REPORT TYPE^353.3
"^DIC",353.3,353.3,0,"GL")
^IBE(353.3,
"^DIC",353.3,353.3,"%D",0)
^^3^3^3100831^
"^DIC",353.3,353.3,"%D",1,0)
The IB Attachment Type file contains entries that describe the type of
"^DIC",353.3,353.3,"%D",2,0)
supplemental information available to support a claim for
"^DIC",353.3,353.3,"%D",3,0)
reimbursement for health care services.
"^DIC",353.3,"B","IB ATTACHMENT REPORT TYPE",353.3)

"^DIC",364.5,364.5,0)
IB DATA ELEMENT DEFINITION^364.5
"^DIC",364.5,364.5,0,"GL")
^IBA(364.5,
"^DIC",364.5,364.5,"%D",0)
^^8^8^2970606^^^^
"^DIC",364.5,364.5,"%D",1,0)
DO NOT delete entries or edit data in this file with VA File Manager.
"^DIC",364.5,364.5,"%D",2,0)
 
"^DIC",364.5,364.5,"%D",3,0)
This file contains the definition of all data elements that are needed for
"^DIC",364.5,364.5,"%D",4,0)
various forms throughout the MCCR DHCP system.  It contains the 'blueprint'
"^DIC",364.5,364.5,"%D",5,0)
for how to extract the data for each data element entry.
"^DIC",364.5,364.5,"%D",6,0)
 
"^DIC",364.5,364.5,"%D",7,0)
Entries in this file that are designated as having a SECURITY LEVEL of
"^DIC",364.5,364.5,"%D",8,0)
NATIONAL should not be deleted or edited.
"^DIC",364.5,"B","IB DATA ELEMENT DEFINITION",364.5)

"^DIC",364.6,364.6,0)
IB FORM SKELETON DEFINITION^364.6P
"^DIC",364.6,364.6,0,"GL")
^IBA(364.6,
"^DIC",364.6,364.6,"%D",0)
^^10^10^2970606^^^^
"^DIC",364.6,364.6,"%D",1,0)
DO NOT delete entries or edit data in this file with VA File Manager.
"^DIC",364.6,364.6,"%D",2,0)
 
"^DIC",364.6,364.6,"%D",3,0)
This file contains records that define the skeleton makeup of forms for
"^DIC",364.6,364.6,"%D",4,0)
the IB system.  This definition includes the absolute position of every
"^DIC",364.6,364.6,"%D",5,0)
field that can be output on the form, the length each field must be limited
"^DIC",364.6,364.6,"%D",6,0)
to, and some descriptive information.   This includes printed forms,
"^DIC",364.6,364.6,"%D",7,0)
transmittable output files, and special local billing screens.
"^DIC",364.6,364.6,"%D",8,0)
 
"^DIC",364.6,364.6,"%D",9,0)
Entries in this file that are designated as having a SECURITY LEVEL of
"^DIC",364.6,364.6,"%D",10,0)
NATIONAL should not be deleted or edited.
"^DIC",364.6,"B","IB FORM SKELETON DEFINITION",364.6)

"^DIC",364.7,364.7,0)
IB FORM FIELD CONTENT^364.7P
"^DIC",364.7,364.7,0,"GL")
^IBA(364.7,
"^DIC",364.7,364.7,"%D",0)
^1.001^9^9^3030331^^^^
"^DIC",364.7,364.7,"%D",1,0)
DO NOT delete entries or edit data in this file with VA File Manager.
"^DIC",364.7,364.7,"%D",2,0)
 
"^DIC",364.7,364.7,"%D",3,0)
This is the file that contains the specific fields to be used to produce
"^DIC",364.7,364.7,"%D",4,0)
the associated form or screen.  If there is no insurance company or bill
"^DIC",364.7,364.7,"%D",5,0)
type specified for an entry, this is assumed to be the default definition
"^DIC",364.7,364.7,"%D",6,0)
of the field.
"^DIC",364.7,364.7,"%D",7,0)
 
"^DIC",364.7,364.7,"%D",8,0)
Entries in this file that are designated as having a SECURITY LEVEL of
"^DIC",364.7,364.7,"%D",9,0)
NATIONAL should not be deleted or edited.
"^DIC",364.7,"B","IB FORM FIELD CONTENT",364.7)

"BLD",7627,6)
^421
**END**
**END**
