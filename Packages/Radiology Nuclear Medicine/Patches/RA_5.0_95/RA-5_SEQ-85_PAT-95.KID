Released RA*5*95 SEQ #85
Extracted from mail message
**KIDS**:RA*5.0*95^

**INSTALL NAME**
RA*5.0*95
"BLD",7066,0)
RA*5.0*95^RADIOLOGY/NUCLEAR MEDICINE^0^3090126^y
"BLD",7066,1,0)
^^2^2^3081010^^^^
"BLD",7066,1,1,0)
Please see the patch description in FORUM for details regarding this KIDS 
"BLD",7066,1,2,0)
build.
"BLD",7066,4,0)
^9.64PA^74^1
"BLD",7066,4,74,0)
74
"BLD",7066,4,74,2,0)
^9.641^74^1
"BLD",7066,4,74,2,74,0)
RAD/NUC MED REPORTS  (File-top level)
"BLD",7066,4,74,2,74,1,0)
^9.6411^5^1
"BLD",7066,4,74,2,74,1,5,0)
REPORT STATUS
"BLD",7066,4,74,222)
y^n^p^^^^n^^n
"BLD",7066,4,74,224)

"BLD",7066,4,"APDD",74,74)

"BLD",7066,4,"APDD",74,74,5)

"BLD",7066,4,"B",74,74)

"BLD",7066,6.3)
7
"BLD",7066,"INIT")
EN^RA95PST
"BLD",7066,"KRN",0)
^9.67PA^8989.52^19
"BLD",7066,"KRN",.4,0)
.4
"BLD",7066,"KRN",.401,0)
.401
"BLD",7066,"KRN",.402,0)
.402
"BLD",7066,"KRN",.403,0)
.403
"BLD",7066,"KRN",.5,0)
.5
"BLD",7066,"KRN",.84,0)
.84
"BLD",7066,"KRN",3.6,0)
3.6
"BLD",7066,"KRN",3.8,0)
3.8
"BLD",7066,"KRN",9.2,0)
9.2
"BLD",7066,"KRN",9.8,0)
9.8
"BLD",7066,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",7066,"KRN",9.8,"NM",1,0)
RAO7PC2^^0^B45083529
"BLD",7066,"KRN",9.8,"NM",2,0)
RAO7PC3^^0^B42089217
"BLD",7066,"KRN",9.8,"NM",3,0)
RARTE5^^0^B93390991
"BLD",7066,"KRN",9.8,"NM",4,0)
RARTE6^^0^B105675673
"BLD",7066,"KRN",9.8,"NM",5,0)
RARTE7^^0^B23668703
"BLD",7066,"KRN",9.8,"NM",6,0)
RARTVER^^0^B44145725
"BLD",7066,"KRN",9.8,"NM",7,0)
RARTRPV^^0^B30791192
"BLD",7066,"KRN",9.8,"NM",8,0)
RA95PST^^0^B2926756
"BLD",7066,"KRN",9.8,"NM",9,0)
RAHLRS^^0^B12807617
"BLD",7066,"KRN",9.8,"NM",10,0)
RAHLRS1^^0^B61692156
"BLD",7066,"KRN",9.8,"NM","B","RA95PST",8)

"BLD",7066,"KRN",9.8,"NM","B","RAHLRS",9)

"BLD",7066,"KRN",9.8,"NM","B","RAHLRS1",10)

"BLD",7066,"KRN",9.8,"NM","B","RAO7PC2",1)

"BLD",7066,"KRN",9.8,"NM","B","RAO7PC3",2)

"BLD",7066,"KRN",9.8,"NM","B","RARTE5",3)

"BLD",7066,"KRN",9.8,"NM","B","RARTE6",4)

"BLD",7066,"KRN",9.8,"NM","B","RARTE7",5)

"BLD",7066,"KRN",9.8,"NM","B","RARTRPV",7)

"BLD",7066,"KRN",9.8,"NM","B","RARTVER",6)

"BLD",7066,"KRN",19,0)
19
"BLD",7066,"KRN",19.1,0)
19.1
"BLD",7066,"KRN",101,0)
101
"BLD",7066,"KRN",409.61,0)
409.61
"BLD",7066,"KRN",771,0)
771
"BLD",7066,"KRN",870,0)
870
"BLD",7066,"KRN",8989.51,0)
8989.51
"BLD",7066,"KRN",8989.52,0)
8989.52
"BLD",7066,"KRN",8994,0)
8994
"BLD",7066,"KRN","B",.4,.4)

"BLD",7066,"KRN","B",.401,.401)

"BLD",7066,"KRN","B",.402,.402)

"BLD",7066,"KRN","B",.403,.403)

"BLD",7066,"KRN","B",.5,.5)

"BLD",7066,"KRN","B",.84,.84)

"BLD",7066,"KRN","B",3.6,3.6)

"BLD",7066,"KRN","B",3.8,3.8)

"BLD",7066,"KRN","B",9.2,9.2)

"BLD",7066,"KRN","B",9.8,9.8)

"BLD",7066,"KRN","B",19,19)

"BLD",7066,"KRN","B",19.1,19.1)

"BLD",7066,"KRN","B",101,101)

"BLD",7066,"KRN","B",409.61,409.61)

"BLD",7066,"KRN","B",771,771)

"BLD",7066,"KRN","B",870,870)

"BLD",7066,"KRN","B",8989.51,8989.51)

"BLD",7066,"KRN","B",8989.52,8989.52)

"BLD",7066,"KRN","B",8994,8994)

"BLD",7066,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",7066,"QUES",0)
^9.62^^
"BLD",7066,"REQB",0)
^9.611^3^3
"BLD",7066,"REQB",1,0)
RA*5.0*56^2
"BLD",7066,"REQB",2,0)
RA*5.0*71^2
"BLD",7066,"REQB",3,0)
RA*5.0*84^2
"BLD",7066,"REQB","B","RA*5.0*56",1)

"BLD",7066,"REQB","B","RA*5.0*71",2)

"BLD",7066,"REQB","B","RA*5.0*84",3)

"FIA",74)
RAD/NUC MED REPORTS
"FIA",74,0)
^RARPT(
"FIA",74,0,0)
74I
"FIA",74,0,1)
y^n^p^^^^n^^n
"FIA",74,0,10)

"FIA",74,0,11)

"FIA",74,0,"RLRO")

"FIA",74,0,"VR")
5.0^RA
"FIA",74,74)
1
"FIA",74,74,5)

"INIT")
EN^RA95PST
"MBREQ")
0
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
95^3090126
"PKG",18,22,1,"PAH",1,1,0)
^^2^2^3090126
"PKG",18,22,1,"PAH",1,1,1,0)
Please see the patch description in FORUM for details regarding this KIDS 
"PKG",18,22,1,"PAH",1,1,2,0)
build.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","RA95PST")
0^8^B2926756^n/a
"RTN","RA95PST",1,0)
RA95PST ;Hines OI/SWM - Post-init, patch 95 ;09/29/08 09:45
"RTN","RA95PST",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**95**;Mar 16, 1998;Build 7
"RTN","RA95PST",3,0)
 Q
"RTN","RA95PST",4,0)
EN ;Clean up "ASTF" and "ARES" from deleted reports that are caused
"RTN","RA95PST",5,0)
 ;by patch 56
"RTN","RA95PST",6,0)
 N A,I,I1,J,RA,RAPS,RAPR,RASS,RASR,X
"RTN","RA95PST",7,0)
 D EN^DDIOL("Searching deleted reports' left-over ""ASTF"" and ""ARES"" xrefs...",,"!,?6")
"RTN","RA95PST",8,0)
 D EN^DDIOL("",,"!")
"RTN","RA95PST",9,0)
 S (I,J)=0
"RTN","RA95PST",10,0)
 F  S I=$O(^RARPT("ASTAT","X",I)) Q:'I  D
"RTN","RA95PST",11,0)
 .Q:$P(^RARPT(I,0),"^",5)'="X"  ;quit if report status isn't "X"
"RTN","RA95PST",12,0)
 .S X=$O(^RARPT(I,"L",""),-1) Q:'X
"RTN","RA95PST",13,0)
 .S RA=^RARPT(I,"L",X,0) Q:RA=""
"RTN","RA95PST",14,0)
 .S RAPS=$P(RA,"^",7) ;Primary Staff
"RTN","RA95PST",15,0)
 .S RAPR=$P(RA,"^",9) ;Primary Resident
"RTN","RA95PST",16,0)
 .S A=$NA(^RARPT("ASTF",+RAPS,I)) D CHECK
"RTN","RA95PST",17,0)
 .S A=$NA(^RARPT("ARES",+RAPR,I)) D CHECK
"RTN","RA95PST",18,0)
 .I $O(^RARPT(I,"L",X,"DELSTF",0)) S I1=0 D  ;Secondary Staff
"RTN","RA95PST",19,0)
 ..F  S I1=$O(^RARPT(I,"L",X,"DELSTF","B",I1)) Q:'I1  D
"RTN","RA95PST",20,0)
 ...S A=$NA(^RARPT("ASTF",I1,I)) D CHECK
"RTN","RA95PST",21,0)
 ...Q
"RTN","RA95PST",22,0)
 ..Q
"RTN","RA95PST",23,0)
 .I $O(^RARPT(I,"L",X,"DELRES",0)) S I1=0 D  ;Secondary Residents
"RTN","RA95PST",24,0)
 ..F  S I1=$O(^RARPT(I,"L",X,"DELRES","B",I1)) Q:'I1  D
"RTN","RA95PST",25,0)
 ...S A=$NA(^RARPT("ARES",I1,I)) D CHECK
"RTN","RA95PST",26,0)
 ...Q
"RTN","RA95PST",27,0)
 ..Q
"RTN","RA95PST",28,0)
 .Q
"RTN","RA95PST",29,0)
 I 'J D EN^DDIOL("No left-over ""ASTF"" and ""ARES"" to delete",,"!!,?6")
"RTN","RA95PST",30,0)
 D EN^DDIOL("",,"!")
"RTN","RA95PST",31,0)
 Q
"RTN","RA95PST",32,0)
CHECK ; If xref exists, then kill it
"RTN","RA95PST",33,0)
 I $D(@A)#2 K @A D DISPLAY S J=J+1
"RTN","RA95PST",34,0)
 Q
"RTN","RA95PST",35,0)
DISPLAY ;
"RTN","RA95PST",36,0)
 D EN^DDIOL(A_" erased from database",,"!,?6")
"RTN","RA95PST",37,0)
 Q
"RTN","RAHLRS")
0^9^B12807617^B11498651
"RTN","RAHLRS",1,0)
RAHLRS ;HIRMFO/CRT/PDW - Resend HL7 messages for selected cases ;01/19/08 12:40
"RTN","RAHLRS",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**25,54,60,71,82,95**;Mar 16, 1998;Build 7
"RTN","RAHLRS",3,0)
 ;
"RTN","RAHLRS",4,0)
 ; Utility to RESEND HL7 messages
"RTN","RAHLRS",5,0)
 ;
"RTN","RAHLRS",6,0)
 ;;02/14/2006 BAY/KAM RA*5*71 Add ability to update exam data to V/R
"RTN","RAHLRS",7,0)
 N RACNI,RADFN,RADTI,RARPT,X
"RTN","RAHLRS",8,0)
 ;
"RTN","RAHLRS",9,0)
 D SETVARS Q:$G(RAIMGTY)=""
"RTN","RAHLRS",10,0)
 ;
"RTN","RAHLRS",11,0)
 F  S X=$$RACNLU(.RADFN,.RADTI,.RACNI) Q:+X'>0  D  Q:QUIT<0
"RTN","RAHLRS",12,0)
 .D RESEND(RADFN,RADTI,RACNI,.QUIT)
"RTN","RAHLRS",13,0)
 Q
"RTN","RAHLRS",14,0)
 ;
"RTN","RAHLRS",15,0)
RACNLU(RADFN,RADTI,RACNI) ; Select Case Number
"RTN","RAHLRS",16,0)
 ;
"RTN","RAHLRS",17,0)
 N RANOSCRN S RANOSCRN="" ; Don't limit cases to current Imaging Type
"RTN","RAHLRS",18,0)
 S (RADFN,RADTI,RADFN)=""
"RTN","RAHLRS",19,0)
 D ^RACNLU
"RTN","RAHLRS",20,0)
 Q X
"RTN","RAHLRS",21,0)
 ;
"RTN","RAHLRS",22,0)
RESEND(RADFN,RADTI,RACNI,QUIT) ; re-send exam message(s) to HL7 subscribers
"RTN","RAHLRS",23,0)
 ;
"RTN","RAHLRS",24,0)
 N RAED,RASSSX,RARPST ;added RASSSX,RARPST, RA*5*95
"RTN","RAHLRS",25,0)
 ;
"RTN","RAHLRS",26,0)
 S QUIT=0
"RTN","RAHLRS",27,0)
 I '$D(DT) D ^%DT S DT=Y
"RTN","RAHLRS",28,0)
 ;
"RTN","RAHLRS",29,0)
 S RAED=$$RAED(RADFN,RADTI,RACNI)
"RTN","RAHLRS",30,0)
 S QUIT=$$OK(RADFN,RADTI,RACNI)
"RTN","RAHLRS",31,0)
 I QUIT>0 D
"RTN","RAHLRS",32,0)
 .I RAED[",REG," D
"RTN","RAHLRS",33,0)
 ..D EN^DDIOL("Re-sending 'EXAM REGISTERD' HL7 message...",,"!!,?6")
"RTN","RAHLRS",34,0)
 ..D REG^RAHLRPC
"RTN","RAHLRS",35,0)
 .I RAED[",CANCEL," D
"RTN","RAHLRS",36,0)
 ..D EN^DDIOL("Re-sending 'EXAM CANCELLED' HL7 message...",,"!,?6")
"RTN","RAHLRS",37,0)
 ..D CANCEL^RAHLRPC
"RTN","RAHLRS",38,0)
 .I RAED[",EXAM," D
"RTN","RAHLRS",39,0)
 ..S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",30)="" ;Reset sent flag
"RTN","RAHLRS",40,0)
 ..D EN^DDIOL("Re-sending 'EXAMINED' HL7 message...",,"!,?6")
"RTN","RAHLRS",41,0)
 ..N RAEXMDUN D 1^RAHLRPC ;*60 Newed RAEXMDUN to prevent variable leak
"RTN","RAHLRS",42,0)
 .I RAED[",RPT," D
"RTN","RAHLRS",43,0)
 ..D EN^DDIOL("Re-sending 'REPORT VERIFIED' HL7 message...",,"!,?6")
"RTN","RAHLRS",44,0)
 ..;If EF report, set up RASSSX() to exclude VR subscribers, RA*5*95
"RTN","RAHLRS",45,0)
 ..I $G(RARPST)="EF" D HLXMSG^RARTE5
"RTN","RAHLRS",46,0)
 ..D RPT^RAHLRPC
"RTN","RAHLRS",47,0)
 Q
"RTN","RAHLRS",48,0)
 ;
"RTN","RAHLRS",49,0)
RAED(RADFN,RADTI,RACNI) ; identify correct ^RAHLRPC entry point(s)
"RTN","RAHLRS",50,0)
 ;
"RTN","RAHLRS",51,0)
 ; removed RARPTST from new, RA*5*95
"RTN","RAHLRS",52,0)
 N RASTAT,RAIMTYP,RAORD,RETURN
"RTN","RAHLRS",53,0)
 S (RARPST,RASTAT)=""
"RTN","RAHLRS",54,0)
 ;
"RTN","RAHLRS",55,0)
 S RETURN=",REG,"
"RTN","RAHLRS",56,0)
 ;
"RTN","RAHLRS",57,0)
 S RASTAT=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,3,"I")
"RTN","RAHLRS",58,0)
 ;
"RTN","RAHLRS",59,0)
 S RAIMTYP=$$GET1^DIQ(72,+RASTAT,7)
"RTN","RAHLRS",60,0)
 S RAORD=$$GET1^DIQ(72,+RASTAT,3)
"RTN","RAHLRS",61,0)
 ;
"RTN","RAHLRS",62,0)
 S:RAORD=0 RETURN=RETURN_"CANCEL,"
"RTN","RAHLRS",63,0)
 ;
"RTN","RAHLRS",64,0)
 I $$GET1^DIQ(72,+RASTAT,8)="YES" D  ; Generate Examined HL7 Message
"RTN","RAHLRS",65,0)
 .S RETURN=RETURN_"EXAM,"
"RTN","RAHLRS",66,0)
 ;
"RTN","RAHLRS",67,0)
 I RETURN'[",EXAM," D
"RTN","RAHLRS",68,0)
 .; also check previous statuses for 'Generate Examined HL7 Message'
"RTN","RAHLRS",69,0)
 .F  S RAORD=$O(^RA(72,"AA",RAIMTYP,RAORD),-1) Q:+RAORD<1  D  Q:RETURN[",EXAM,"
"RTN","RAHLRS",70,0)
 ..S RASTAT=$O(^RA(72,"AA",RAIMTYP,RAORD,0))
"RTN","RAHLRS",71,0)
 ..I $$GET1^DIQ(72,+RASTAT,8)="YES" S RETURN=RETURN_"EXAM,"
"RTN","RAHLRS",72,0)
 ;
"RTN","RAHLRS",73,0)
 I RARPT]"" D  ; Check if Verified or Elect. Filed report exists
"RTN","RAHLRS",74,0)
 .S RARPST=$$GET1^DIQ(74,RARPT,5,"I")
"RTN","RAHLRS",75,0)
 .I "^V^EF^"[("^"_RARPST_"^") S RETURN=RETURN_"RPT," ;RA*5*95
"RTN","RAHLRS",76,0)
 ;
"RTN","RAHLRS",77,0)
 Q RETURN
"RTN","RAHLRS",78,0)
 ;
"RTN","RAHLRS",79,0)
OK(RADFN,RADTI,RACNI) ; Get User to confirm continue
"RTN","RAHLRS",80,0)
 ;
"RTN","RAHLRS",81,0)
 N X,RAEXST
"RTN","RAHLRS",82,0)
 ;
"RTN","RAHLRS",83,0)
 S RAEXST=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,3)
"RTN","RAHLRS",84,0)
 ;
"RTN","RAHLRS",85,0)
 S X="",$P(X,"=",70)=""
"RTN","RAHLRS",86,0)
 D EN^DDIOL(X,"","!?5")
"RTN","RAHLRS",87,0)
 S DIR("A")="Re-send all HL7 messages for this '"_RAEXST_"' case?"
"RTN","RAHLRS",88,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR
"RTN","RAHLRS",89,0)
 I Y="^" Q -1
"RTN","RAHLRS",90,0)
 Q Y
"RTN","RAHLRS",91,0)
 ;
"RTN","RAHLRS",92,0)
SETVARS ; Setup key Rad/Nuc Med variables
"RTN","RAHLRS",93,0)
 ;
"RTN","RAHLRS",94,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RAHLRS",95,0)
 Q:'($D(RACCESS(DUZ))\10)  ; user does not have location access
"RTN","RAHLRS",96,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1) K:$G(RAIMGTY)="" XQUIT
"RTN","RAHLRS",97,0)
 Q
"RTN","RAHLRS1")
0^10^B61692156^B57554802
"RTN","RAHLRS1",1,0)
RAHLRS1 ;HIRMFO/ROB/PAVEL - Resend HL7 messages for selected Timeframe ; 10/27/08 11:01
"RTN","RAHLRS1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**80,84,95**;Mar 16, 1998;Build 7
"RTN","RAHLRS1",3,0)
 ; Utility to RESEND HL7 messages for selected Timeframe
"RTN","RAHLRS1",4,0)
 ;
"RTN","RAHLRS1",5,0)
 ;Integration Agreements
"RTN","RAHLRS1",6,0)
 ;----------------------
"RTN","RAHLRS1",7,0)
 ;^%DT(10003); C^%DTC(10000); H^%DTC(10000); ^%ZISC(10089); ^%ZTLOAD(10063); $$GET1^DIQ(2056)
"RTN","RAHLRS1",8,0)
 ;^DIR(10026); ^XMD(10070)
"RTN","RAHLRS1",9,0)
 ;all access to ^ORD(101 to maintain application specific protocols(872)
"RTN","RAHLRS1",10,0)
 ;read w/FileMan HL7 APPLICATION PARAMETER(10136)
"RTN","RAHLRS1",11,0)
 ;
"RTN","RAHLRS1",12,0)
 N RACNI,RADFN,RADTI,RARPT,X,RAED,RABD,RASHBD,RASHED,RASHTD,RASHTM,DIC,DA,XX,YY
"RTN","RAHLRS1",13,0)
 N RALOCK,RASSS,RASSSX,RASSSL,I,X S RALOCK=0
"RTN","RAHLRS1",14,0)
CHECK ;
"RTN","RAHLRS1",15,0)
 D SETVARS Q:$G(RAIMGTY)=""
"RTN","RAHLRS1",16,0)
 W !!,"This option re-sends HL7 messages for a date range and for designated Recipients.",!
"RTN","RAHLRS1",17,0)
 W !,"It is strongly recommended you task this to run off hours.",!!
"RTN","RAHLRS1",18,0)
 S:'$D(U) U="^" S:'$D(DTIME) DTIME=9999
"RTN","RAHLRS1",19,0)
1 W ! K %DT S %DT="AEX",%DT("A")="Beginning Date: " D ^%DT
"RTN","RAHLRS1",20,0)
 G:Y<0!($D(DTOUT))!($D(DUOUT)) STOP
"RTN","RAHLRS1",21,0)
 S RABD=Y
"RTN","RAHLRS1",22,0)
 X ^DD("DD") S RASHBD=Y
"RTN","RAHLRS1",23,0)
 S X1=RABD,X2=-1 D C^%DTC S RABD=X
"RTN","RAHLRS1",24,0)
 S RABD=RABD_"."_9999
"RTN","RAHLRS1",25,0)
 ;
"RTN","RAHLRS1",26,0)
 W ! K %DT S %DT="AEX",%DT("A")="Ending Date: ",%DT("B")="NOW" D ^%DT
"RTN","RAHLRS1",27,0)
 G:Y<0!($D(DTOUT))!($D(DUOUT)) STOP
"RTN","RAHLRS1",28,0)
 S RAED=Y
"RTN","RAHLRS1",29,0)
 X ^DD("DD") S RASHED=Y
"RTN","RAHLRS1",30,0)
 S RAED=RAED_"."_9999
"RTN","RAHLRS1",31,0)
 K XX G:'$$GETAP(.XX) STOP
"RTN","RAHLRS1",32,0)
 W !!,"*** Pick the application in which to send the radiology data ***",!!
"RTN","RAHLRS1",33,0)
 F I=1:1 Q:'$D(XX(I))  W !,"  #",I,"   ",$O(XX(I,""))
"RTN","RAHLRS1",34,0)
2 ;user selects the application
"RTN","RAHLRS1",35,0)
 S DIR(0)="N^1:"_(I-1)
"RTN","RAHLRS1",36,0)
 W ! S DIR("?")="Please select an available application from the list."
"RTN","RAHLRS1",37,0)
 D ^DIR Q:$D(DIRUT)
"RTN","RAHLRS1",38,0)
 W !!,"The: ",$O(XX(+X,"")),"   will be the recipient"
"RTN","RAHLRS1",39,0)
 W !!,"Reviewing exams for selected time period... (This may take a few minutes)... "
"RTN","RAHLRS1",40,0)
 S Y=$$GETSUM(RABD,RAED)
"RTN","RAHLRS1",41,0)
 I 'Y W !!,"No exams exist for selected period, change the time frame !!!" H 3 W ! G 1
"RTN","RAHLRS1",42,0)
 W !!,"During this period of time ",Y," Exams were performed and app Run time= ",Y\5000," Hours."
"RTN","RAHLRS1",43,0)
 S RAPICK=$O(XX(+X,"")) ;appl. recipient name, RA*5*95
"RTN","RAHLRS1",44,0)
 S RASSS(XX(X,$O(XX(+X,""))))="" D GETSUB(.RASSS,.RASSSX,.RASSSL)
"RTN","RAHLRS1",45,0)
 K ZTSAVE
"RTN","RAHLRS1",46,0)
 S ZTSAVE("RAPICK")="" ;include appl. recipient name in task, RA*5*95
"RTN","RAHLRS1",47,0)
 S ZTSAVE("RASSSX(")="",ZTSAVE("RASSSL(")="",ZTSAVE("RABD")="",ZTSAVE("RAED")="",ZTSAVE("RADFN")=""
"RTN","RAHLRS1",48,0)
 S ZTSAVE("RADTI")="",ZTSAVE("RACNI")="",ZTSAVE("RASHBD")="",ZTSAVE("RASHED")="",ZTIO=""
"RTN","RAHLRS1",49,0)
 S ZTDESC="Rad/Nuc Med Compiling HL7 Common Order",ZTRTN="TM^RAHLRS1"
"RTN","RAHLRS1",50,0)
 W ! K %DT S %DT="AEXT",%DT("A")="Scheduled time to run: ",%DT("B")="TODAY@23:59" D ^%DT
"RTN","RAHLRS1",51,0)
 G:Y<0!($D(DTOUT))!($D(DUOUT)) STOP
"RTN","RAHLRS1",52,0)
 S X=Y,YY=Y D H^%DTC S ZTDTH=$G(%H)_","_$G(%T)
"RTN","RAHLRS1",53,0)
 S Y=YY X ^DD("DD") S RASHTM=Y
"RTN","RAHLRS1",54,0)
 D ^%ZTLOAD
"RTN","RAHLRS1",55,0)
 W !,"Task ",$S('$D(ZTSK):" Has Not been Tasked !!!",1:"#:"_ZTSK_" Has been Tasked")
"RTN","RAHLRS1",56,0)
 D:$D(ZTSK)
"RTN","RAHLRS1",57,0)
 .N RAX,RAMPG,XMSUB,XMY,XMTEXT
"RTN","RAHLRS1",58,0)
 .S RAX(1)="Task #"_$G(ZTSK)_" is scheduled to run the option: "
"RTN","RAHLRS1",59,0)
 .S RAX(2)=">>Re-send HL7 messages for a date range and for designated Recipient.<<"
"RTN","RAHLRS1",60,0)
 .S RAX(3)=" Scheduled time to run: "_RASHTM
"RTN","RAHLRS1",61,0)
 .S RAX(4)="Date range from: "_$G(RASHBD)_" to: "_$G(RASHED)
"RTN","RAHLRS1",62,0)
 .S XMSUB="TASKMAN SCHEDULE NOTIFICATION/INFO"
"RTN","RAHLRS1",63,0)
 .S RAMPG="G.RAD HL7 MESSAGES"
"RTN","RAHLRS1",64,0)
 .S XMY(RAMPG)="",XMDUZ=.5
"RTN","RAHLRS1",65,0)
 .S XMTEXT="RAX("
"RTN","RAHLRS1",66,0)
 .D ^XMD
"RTN","RAHLRS1",67,0)
 Q
"RTN","RAHLRS1",68,0)
 ;
"RTN","RAHLRS1",69,0)
TM ;Taskman Entry...
"RTN","RAHLRS1",70,0)
 N RASTIME,RASUM7,RASUM7R,RASUM7E
"RTN","RAHLRS1",71,0)
 S RASTIME=$H,(RASUM7,RASUM7R,RASUM7E)=0
"RTN","RAHLRS1",72,0)
 F  S RABD=$O(^RADPT("AR",RABD)) Q:'RABD!(RABD>RAED)  D
"RTN","RAHLRS1",73,0)
 .S RADFN=0 F  S RADFN=$O(^RADPT("AR",RABD,RADFN)) Q:'RADFN  D
"RTN","RAHLRS1",74,0)
 ..S RADTI=0 F  S RADTI=$O(^RADPT("AR",RABD,RADFN,RADTI)) Q:'RADTI  D
"RTN","RAHLRS1",75,0)
 ...S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:'RACNI  D RESEND(RADFN,RADTI,RACNI)
"RTN","RAHLRS1",76,0)
 K RAX S RAX(1)="Task #"_$G(ZTSK)_" successfully completed the option: "
"RTN","RAHLRS1",77,0)
 S RAX(2)=">>Re-send HL7 messages for a date range and for designated Recipient.<<"
"RTN","RAHLRS1",78,0)
 S RAX(3)="Date range from: "_$G(RASHBD)_" to: "_$G(RASHED)
"RTN","RAHLRS1",79,0)
 S RAX(4)="# Of RAD Reports transferred: "_$G(RASUM7R)
"RTN","RAHLRS1",80,0)
 S RAX(5)="# Of Exams transferred:      "_$G(RASUM7)
"RTN","RAHLRS1",81,0)
 S:$G(RASUM7E) X(6)="# Of Exams not transferred because of ""BAD DATA"": "_$G(RASUM7E)
"RTN","RAHLRS1",82,0)
 S XMSUB="TASKMAN ""RESEND HL7 OPTION"" COMPLETED/INFO"
"RTN","RAHLRS1",83,0)
 S RAMPG="G.RAD HL7 MESSAGES"
"RTN","RAHLRS1",84,0)
 S XMY(RAMPG)="",XMDUZ=.5
"RTN","RAHLRS1",85,0)
 S XMTEXT="RAX("
"RTN","RAHLRS1",86,0)
 D ^XMD
"RTN","RAHLRS1",87,0)
 G STOP
"RTN","RAHLRS1",88,0)
 Q
"RTN","RAHLRS1",89,0)
 ;
"RTN","RAHLRS1",90,0)
RESEND(RADFN,RADTI,RACNI) ; re-send exam message(s) to HL7 subscribers
"RTN","RAHLRS1",91,0)
 ; for every 10 messages sent, make sure queue is not clogged... $$HANG
"RTN","RAHLRS1",92,0)
 N RAXAMP80 S RAXAMP80=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAHLRS1",93,0)
 I '(+$P(RAXAMP80,U))!'($P(RAXAMP80,U,2)) S RASUM7E=RASUM7E+1 Q
"RTN","RAHLRS1",94,0)
 N RABD,RAEDP80,QUIT,RARPST ;added RARPST, RA*5*95
"RTN","RAHLRS1",95,0)
 ;
"RTN","RAHLRS1",96,0)
 I '$D(DT) D ^%DT S DT=Y
"RTN","RAHLRS1",97,0)
 ;
"RTN","RAHLRS1",98,0)
 S RAEDP80=$$RAED(RADFN,RADTI,RACNI)
"RTN","RAHLRS1",99,0)
 I '$L(RAEDP80) S RASUM7E=RASUM7E+1 Q
"RTN","RAHLRS1",100,0)
 D:RAEDP80[",REG,"
"RTN","RAHLRS1",101,0)
 .D CHSUM N RASUM7,RASUM7R,RASUM7E D REG^RAHLRPC
"RTN","RAHLRS1",102,0)
 D:RAEDP80[",CANCEL,"
"RTN","RAHLRS1",103,0)
 .D CHSUM N RASUM7,RASUM7R,RASUM7E D CANCEL^RAHLRPC
"RTN","RAHLRS1",104,0)
 D:RAEDP80[",EXAM,"
"RTN","RAHLRS1",105,0)
 .D CHSUM
"RTN","RAHLRS1",106,0)
 .S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",30)="" ;Reset sent flag
"RTN","RAHLRS1",107,0)
 .N RASUM7,RAEXMDUN,RASUM7R,RASUM7E D 1^RAHLRPC
"RTN","RAHLRS1",108,0)
 ;if EF report and recipient is VR, then don't re-send, RA*5*95
"RTN","RAHLRS1",109,0)
 I RARPST="EF",((RAPICK["RA-TALK")!(RAPICK["RA-PSCRIBE")!(RAPICK["RA-SCIMAGE")!(RAPICK["RA-RADWHERE")) Q
"RTN","RAHLRS1",110,0)
 D:RAEDP80[",RPT,"
"RTN","RAHLRS1",111,0)
 .D CHSUM N RASUM7,RANOSEND,RASUM7R,RASUM7E,RARPT D RPT^RAHLRPC
"RTN","RAHLRS1",112,0)
 Q
"RTN","RAHLRS1",113,0)
 ;
"RTN","RAHLRS1",114,0)
RAED(RADFN,RADTI,RACNI) ; identify correct ^RAHLRPC entry point(s)
"RTN","RAHLRS1",115,0)
 ;
"RTN","RAHLRS1",116,0)
 N RASTAT,RAIMTYP,RAORD,RETURN,RARPT
"RTN","RAHLRS1",117,0)
 S RASTAT=""
"RTN","RAHLRS1",118,0)
 ;
"RTN","RAHLRS1",119,0)
 S RETURN=",REG,"
"RTN","RAHLRS1",120,0)
 ;
"RTN","RAHLRS1",121,0)
 S RASTAT=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,3,"I")
"RTN","RAHLRS1",122,0)
 S RARPT=$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN,17,"I")
"RTN","RAHLRS1",123,0)
 ;
"RTN","RAHLRS1",124,0)
 S RAIMTYP=$$GET1^DIQ(72,+RASTAT,7) Q:'$L(RAIMTYP) ""
"RTN","RAHLRS1",125,0)
 S RAORD=$$GET1^DIQ(72,+RASTAT,3)
"RTN","RAHLRS1",126,0)
 ;
"RTN","RAHLRS1",127,0)
 S:RAORD=0 RETURN=RETURN_"CANCEL,"
"RTN","RAHLRS1",128,0)
 ;
"RTN","RAHLRS1",129,0)
 S:$$GET1^DIQ(72,+RASTAT,8)="YES" RETURN=RETURN_"EXAM," ; Generate Examined HL7 Message
"RTN","RAHLRS1",130,0)
 ;
"RTN","RAHLRS1",131,0)
 D:RETURN'[",EXAM,"
"RTN","RAHLRS1",132,0)
 .; also check previous statuses for 'Generate Examined HL7 Message'
"RTN","RAHLRS1",133,0)
 .F  S RAORD=$O(^RA(72,"AA",RAIMTYP,RAORD),-1) Q:+RAORD<1  D  Q:RETURN[",EXAM,"
"RTN","RAHLRS1",134,0)
 ..S RASTAT=$O(^RA(72,"AA",RAIMTYP,RAORD,0))
"RTN","RAHLRS1",135,0)
 ..S:$$GET1^DIQ(72,+RASTAT,8)="YES" RETURN=RETURN_"EXAM,"
"RTN","RAHLRS1",136,0)
 ;
"RTN","RAHLRS1",137,0)
 ; Check if Verified or Elec. Filed report exists ;RA*5*95
"RTN","RAHLRS1",138,0)
 S RARPST=$$GET1^DIQ(74,RARPT_",",5,"I")
"RTN","RAHLRS1",139,0)
 I RARPT]"",("^V^EF^"[("^"_RARPST_"^")) S RETURN=RETURN_"RPT,",RASUM7R=RASUM7R+1
"RTN","RAHLRS1",140,0)
 ;
"RTN","RAHLRS1",141,0)
 Q RETURN
"RTN","RAHLRS1",142,0)
 ;
"RTN","RAHLRS1",143,0)
SETVARS ; Setup key Rad/Nuc Med variables
"RTN","RAHLRS1",144,0)
 ;
"RTN","RAHLRS1",145,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RAHLRS1",146,0)
 Q:'($D(RACCESS(DUZ))\10)  ; user does not have location access
"RTN","RAHLRS1",147,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1) K:$G(RAIMGTY)="" XQUIT
"RTN","RAHLRS1",148,0)
 Q
"RTN","RAHLRS1",149,0)
STOP ;
"RTN","RAHLRS1",150,0)
 D ^%ZISC
"RTN","RAHLRS1",151,0)
 Q
"RTN","RAHLRS1",152,0)
 ;
"RTN","RAHLRS1",153,0)
GETAP(XX) ;
"RTN","RAHLRS1",154,0)
 ;Get list of Applications in XX
"RTN","RAHLRS1",155,0)
 N XXX,X11,X1,X2,X3,Z,Z1,J
"RTN","RAHLRS1",156,0)
 F X11="RA REG","RA EXAMINED","RA CANCEL","RA RPT" D
"RTN","RAHLRS1",157,0)
 .S X1=$E(X11,1,$L(X11)-1)_$C($A($E(X11,$L(X11)))-1)
"RTN","RAHLRS1",158,0)
 .F  S X1=$O(^ORD(101,"B",X1)) Q:X1'[X11  S X2=$O(^ORD(101,"B",X1,0)) Q:'X2  D
"RTN","RAHLRS1",159,0)
 ..K Z S X3=0 F  S X3=$O(^ORD(101,X2,775,X3)) Q:'X3  S Z(+^(X3,0))=""
"RTN","RAHLRS1",160,0)
 ..Q:'$D(Z)  K Z1 S X3=0 F  S X3=$O(Z(X3)) Q:'X3  D
"RTN","RAHLRS1",161,0)
 ...S Z1=$G(^ORD(101,X3,770)) S:+$P(Z1,U,2) XXX(+$P(Z1,U,2))=""
"RTN","RAHLRS1",162,0)
 S X1=0 F J=1:1 S X1=$O(XXX(X1)) Q:'X1  D
"RTN","RAHLRS1",163,0)
 .N DIERR,RAERR,Y
"RTN","RAHLRS1",164,0)
 .S Y=$$GET1^DIQ(771,X1,.01,"","","RAERR")
"RTN","RAHLRS1",165,0)
 .Q:Y=""!($D(RAERR)#2)  S XX(J,Y)=X1
"RTN","RAHLRS1",166,0)
 .Q
"RTN","RAHLRS1",167,0)
 Q $S($D(XXX):1,1:0)
"RTN","RAHLRS1",168,0)
 ;
"RTN","RAHLRS1",169,0)
GETSUB(APL,SUB,LINK) ;Get all subscribers (not associated with application)... To be excluded as recipients..
"RTN","RAHLRS1",170,0)
 ; Get all logical links to be in business, so we can control flow of messages
"RTN","RAHLRS1",171,0)
 ;Set up SUB() of 4 Radiology protocol IENS in file #101 that 
"RTN","RAHLRS1",172,0)
 ;are NOT associated with applications defined in APL()
"RTN","RAHLRS1",173,0)
 ;
"RTN","RAHLRS1",174,0)
 ;INPUT:
"RTN","RAHLRS1",175,0)
 ;APL(IEN) = Application #771 IENs
"RTN","RAHLRS1",176,0)
 ;
"RTN","RAHLRS1",177,0)
 ;OUTPUT:
"RTN","RAHLRS1",178,0)
 ;SUB(Event Driver #101 IEN,Subscriber #101 IEN)=.01 in file #101
"RTN","RAHLRS1",179,0)
 ;LINK(IEN of logical link #870)
"RTN","RAHLRS1",180,0)
 ;  
"RTN","RAHLRS1",181,0)
 N XX,X11,X1,X2,X3
"RTN","RAHLRS1",182,0)
 Q:'$O(APL(0))
"RTN","RAHLRS1",183,0)
 F X11="RA REG","RA EXAMINED","RA CANCEL","RA RPT" D
"RTN","RAHLRS1",184,0)
 .S X1=$E(X11,1,$L(X11)-1)_$C($A($E(X11,$L(X11)))-1)
"RTN","RAHLRS1",185,0)
 .F  S X1=$O(^ORD(101,"B",X1)) Q:X1'[X11  S X2=$O(^ORD(101,"B",X1,0)) Q:'X2  D
"RTN","RAHLRS1",186,0)
 ..S X3=0 F  S X3=$O(^ORD(101,X2,775,X3)) Q:'X3  S XX=+^(X3,0) D
"RTN","RAHLRS1",187,0)
 ...I '$D(APL(+$P($G(^ORD(101,XX,770)),U,2))) S SUB(X2,XX)=X1 Q
"RTN","RAHLRS1",188,0)
 ...S XX=+$P($G(^ORD(101,XX,770)),U,7) S:XX LINK(XX)=""
"RTN","RAHLRS1",189,0)
 Q
"RTN","RAHLRS1",190,0)
GETHLP(RAEID,HLP,ADR) ; Get excluded subcribers set into HLP array
"RTN","RAHLRS1",191,0)
 N I,J,XX,AA S J=$O(HLP("EXCLUDE SUBSCRIBER",99999999),-1)
"RTN","RAHLRS1",192,0)
 ;XX Set the list of already excluded subscribers, so be sure we don't set it second time
"RTN","RAHLRS1",193,0)
 S AA=ADR_"("_RAEID_",I)"
"RTN","RAHLRS1",194,0)
 S I=0 F I=$O(HLP("EXCLUDE SUBSCRIBER",I)) Q:'I  S XX(HLP("EXCLUDE SUBSCRIBER",I))=""
"RTN","RAHLRS1",195,0)
 S I=0 F  S I=$O(@AA) Q:'I  S:'$D(XX(I)) J=J+1,HLP("EXCLUDE SUBSCRIBER",J)=I
"RTN","RAHLRS1",196,0)
 Q
"RTN","RAHLRS1",197,0)
CHSUM ;CHECKSUM
"RTN","RAHLRS1",198,0)
 S RASUM7=RASUM7+1 I '(RASUM7#50) F  Q:'$$HANG  H 15
"RTN","RAHLRS1",199,0)
 Q
"RTN","RAHLRS1",200,0)
HANG() ; scan all logical links to see if queue is bigger than 100
"RTN","RAHLRS1",201,0)
 N I,S,L,QUIT
"RTN","RAHLRS1",202,0)
 S (QUIT,L)=0
"RTN","RAHLRS1",203,0)
 F  S L=$O(RASSSL(L)) Q:'L  S (S,I)=0 D  Q:QUIT
"RTN","RAHLRS1",204,0)
 .F  S I=$O(^HLMA("AC","O",L,I)) Q:'I  S S=S+1 I S>100 S QUIT=1 Q  ;Quit if more than 100 messages waiting in outgoing queue for link...
"RTN","RAHLRS1",205,0)
 Q QUIT
"RTN","RAHLRS1",206,0)
GETSUM(RABD,RAED) ; Get number of exams for period called from RAHLR RAHLR1 RAHLRPT RAHLRPT1
"RTN","RAHLRS1",207,0)
 N RADFN,RADTI,RACNI,RASUM7
"RTN","RAHLRS1",208,0)
 S RASUM7=0
"RTN","RAHLRS1",209,0)
 F  S RABD=$O(^RADPT("AR",RABD)) Q:'RABD!(RABD>RAED)  D
"RTN","RAHLRS1",210,0)
 .S RADFN=0 F  S RADFN=$O(^RADPT("AR",RABD,RADFN)) Q:'RADFN  D
"RTN","RAHLRS1",211,0)
 ..S RADTI=0 F  S RADTI=$O(^RADPT("AR",RABD,RADFN,RADTI)) Q:'RADTI  D
"RTN","RAHLRS1",212,0)
 ...S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:'RACNI  S:^(RACNI,0) RASUM7=RASUM7+1
"RTN","RAHLRS1",213,0)
 Q RASUM7
"RTN","RAHLRS1",214,0)
 Q
"RTN","RAO7PC2")
0^1^B45083529^B44753476
"RTN","RAO7PC2",1,0)
RAO7PC2 ;HISC/GJC-Part two for Return Narrative (EN3^RAO7PC1) ;8/18/08  09:47
"RTN","RAO7PC2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,11,14,16,22,27,45,75,56,95**;Mar 16, 1998;Build 7
"RTN","RAO7PC2",3,0)
 ;Supported IA #10104 UP^XLFSTR
"RTN","RAO7PC2",4,0)
 ;Supported IA #2055 EXTERNAL^DILFD
"RTN","RAO7PC2",5,0)
 ;Supported IA #10060 ^VA(200
"RTN","RAO7PC2",6,0)
CASE(Y) ; Retrieve exam data for specified inverse exam date range.
"RTN","RAO7PC2",7,0)
 ; 'Y'-> Exam node IEN
"RTN","RAO7PC2",8,0)
 N RABNOR,RACNT,RAEXAM,RAI,RAIMPRES,RAINCLUD,RAOPRC,RAORD,RAPDIAG
"RTN","RAO7PC2",9,0)
 N RAPIST,RAPIRE,RAPROC,RARDE,RADTI,RACNI,RADUPHX,RAREASDY
"RTN","RAO7PC2",10,0)
 N RARPT,RARPTST,RARPTXT,RASBN,RASDIAG,RAVER,RAERRFLG,Z,Z1,Z2
"RTN","RAO7PC2",11,0)
 S RACNT=1
"RTN","RAO7PC2",12,0)
 S RAEXAM(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,0)) Q:RAEXAM(0)']""
"RTN","RAO7PC2",13,0)
 S:$P(RAEXAM(0),"^",25)=2 RAPSET=1
"RTN","RAO7PC2",14,0)
 S:RAPSET=1 ^TMP($J,"RAE2",RADFN,"PRINT_SET")="" ; xam set with same rpt
"RTN","RAO7PC2",15,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RAEXAM(0),"^",2),0))
"RTN","RAO7PC2",16,0)
 S RAPROC=$S($P(RAPROC(0),"^")]"":$P(RAPROC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",17,0)
 S RAORD(0)=$G(^RAO(75.1,+$P(RAEXAM(0),"^",11),0))
"RTN","RAO7PC2",18,0)
 S RAORD(7)=$P(RAORD(0),"^",7) ; CPRS order ien
"RTN","RAO7PC2",19,0)
 S RAREASDY=$P($G(^RAO(75.1,+$P(RAEXAM(0),"^",11),.1)),"^") ;REASON FOR STUDY
"RTN","RAO7PC2",20,0)
 S RAOPRC(0)=$G(^RAMIS(71,+$P(RAORD(0),"^",2),0))
"RTN","RAO7PC2",21,0)
 S RAOPRC=$S($P(RAOPRC(0),"^")]"":$P(RAOPRC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",22,0)
 S RAPDIAG(0)=$G(^RA(78.3,+$P(RAEXAM(0),"^",13),0))
"RTN","RAO7PC2",23,0)
 S RAPDIAG=$P(RAPDIAG(0),"^"),RARPT=+$P(RAEXAM(0),"^",17)
"RTN","RAO7PC2",24,0)
 ; RARPTST="NO REPORT" if no ^RARPT(ien) OR no data for Report Status
"RTN","RAO7PC2",25,0)
 S RARPT(0)=$G(^RARPT(RARPT,0)),RARPTST=$$UL^RAO7PC1A($$RSTAT^RAO7PC1A())
"RTN","RAO7PC2",26,0)
 ; set the following flag variable: RAINCLUD
"RTN","RAO7PC2",27,0)
 ; RAINCLUD=1 includes V, R, EF <-- patch 95
"RTN","RAO7PC2",28,0)
 S RAINCLUD=$S("RVE"[$E(RARPTST):1,1:0)
"RTN","RAO7PC2",29,0)
 I $E(RARPTST)="V",(RAPSET'<0) D
"RTN","RAO7PC2",30,0)
 . S RAVER=$P(RARPT(0),"^",9),RASBN=$P($G(^VA(200,+RAVER,20)),"^",2)
"RTN","RAO7PC2",31,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"V")=RAVER_"^"_RASBN
"RTN","RAO7PC2",32,0)
 . Q
"RTN","RAO7PC2",33,0)
 S RABNOR=$$UP^XLFSTR($P(RAPDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",34,0)
 I RAPDIAG]"",(RAINCLUD),(RAPSET'<0) D  ; if diag & verif'd or released/unverif'd & first pass if part of xam set (many xams - one rpt)
"RTN","RAO7PC2",35,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RAPDIAG
"RTN","RAO7PC2",36,0)
 . Q
"RTN","RAO7PC2",37,0)
 S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"RFS")=RAREASDY ;REASON FOR STUDY
"RTN","RAO7PC2",38,0)
 ; 1st, get clnhist from file70. 2nd, get addl clnhist form file74
"RTN","RAO7PC2",39,0)
 ; 1st:
"RTN","RAO7PC2",40,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",0)) D
"RTN","RAO7PC2",41,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",42,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z)) Q:Z'>0  D
"RTN","RAO7PC2",43,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",44,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"H",RAI)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z,0))
"RTN","RAO7PC2",45,0)
 .. Q
"RTN","RAO7PC2",46,0)
 . Q
"RTN","RAO7PC2",47,0)
 ;2nd:
"RTN","RAO7PC2",48,0)
 S RADTI=RAINVXDT,RACNI=Y D CHKDUPHX^RART1 ;chk if file74 clnhist is dupl
"RTN","RAO7PC2",49,0)
 I 'RADUPHX,$O(^RARPT(RARPT,"H",0)) S Z="H" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",50,0)
 ;
"RTN","RAO7PC2",51,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",0)) D  ; save modifiers
"RTN","RAO7PC2",52,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",53,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z)) Q:Z'>0  D
"RTN","RAO7PC2",54,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",55,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"M",RAI)=$P($G(^RAMIS(71.2,+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z,0)),0)),"^")
"RTN","RAO7PC2",56,0)
 .. Q
"RTN","RAO7PC2",57,0)
 . Q
"RTN","RAO7PC2",58,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",0)),(RAPSET'<0) D
"RTN","RAO7PC2",59,0)
 . S Z=0 F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z)) Q:Z'>0  D
"RTN","RAO7PC2",60,0)
 .. S RASDIAG=+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z,0))
"RTN","RAO7PC2",61,0)
 .. S RASDIAG(0)=$G(^RA(78.3,RASDIAG,0)),RASDIAG(1)=$P(RASDIAG(0),"^")
"RTN","RAO7PC2",62,0)
 .. I RASDIAG(1)]"",(RAINCLUD) D
"RTN","RAO7PC2",63,0)
 ... S RACNT=RACNT+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RASDIAG(1)
"RTN","RAO7PC2",64,0)
 ... I RABNOR'="Y" D
"RTN","RAO7PC2",65,0)
 .... S RABNOR=$$UP^XLFSTR($P(RASDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",66,0)
 .... Q
"RTN","RAO7PC2",67,0)
 ... Q
"RTN","RAO7PC2",68,0)
 .. Q
"RTN","RAO7PC2",69,0)
 . Q
"RTN","RAO7PC2",70,0)
 I RAINCLUD,(RAPSET'<0) D
"RTN","RAO7PC2",71,0)
 . I +$O(^RARPT(RARPT,"I",0)) S Z="I" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",72,0)
 . I +$O(^RARPT(RARPT,"R",0)) S Z="R" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",73,0)
 . Q
"RTN","RAO7PC2",74,0)
 I $P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD")=RAOPRC
"RTN","RAO7PC2",75,0)
 I '$P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD",Y)=RAOPRC
"RTN","RAO7PC2",76,0)
 ;
"RTN","RAO7PC2",77,0)
 ; Check to see if amended report
"RTN","RAO7PC2",78,0)
 I RAPSET'<0,+$O(^RARPT(RARPT,"ERR",0)) S RAERRFLG="A"
"RTN","RAO7PC2",79,0)
 ;
"RTN","RAO7PC2",80,0)
 S:RAPSET'<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=RARPTST_"^"_$G(RABNOR)_"^"_$G(RAORD(7))_"^"_$G(RAERRFLG)
"RTN","RAO7PC2",81,0)
 S:RAPSET<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=""
"RTN","RAO7PC2",82,0)
 S:RAPSET=1 RAPSET=-1
"RTN","RAO7PC2",83,0)
 ;
"RTN","RAO7PC2",84,0)
 I RARPTST'="No Report" D
"RTN","RAO7PC2",85,0)
 .; Add Prim Int Staff, Prim Int Resident & Reported Date
"RTN","RAO7PC2",86,0)
 .S RAPIST=$P(RAEXAM(0),"^",15)
"RTN","RAO7PC2",87,0)
 .S RAPIRE=$P(RAEXAM(0),"^",12)
"RTN","RAO7PC2",88,0)
 .S RARDE=$P(RARPT(0),"^",8)
"RTN","RAO7PC2",89,0)
 .S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"P")=RAPIST_"^"_RAPIRE_"^"_RARDE
"RTN","RAO7PC2",90,0)
 ;If contrast media was involved in the exam pass that information.
"RTN","RAO7PC2",91,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",0)) S (RACNT,RAI)=0 D
"RTN","RAO7PC2",92,0)
 .F  S RAI=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI)) Q:'RAI  D
"RTN","RAO7PC2",93,0)
 ..S RACNT=RACNT+1
"RTN","RAO7PC2",94,0)
 ..S RAI(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI,0))
"RTN","RAO7PC2",95,0)
 ..S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"CM",RACNT)=$P(RAI(0),U)_"^"_$$EXTERNAL^DILFD(70.3225,.01,"",$P(RAI(0),U))
"RTN","RAO7PC2",96,0)
 ..Q
"RTN","RAO7PC2",97,0)
 Q
"RTN","RAO7PC2",98,0)
 ;
"RTN","RAO7PC2",99,0)
RPTXT(RARPT,Z) ; Retrieve report text & store in ^TMP
"RTN","RAO7PC2",100,0)
 ; 'RARPT' -> Report IEN
"RTN","RAO7PC2",101,0)
 ; 'Z'     -> "I":Impression Text <> "R":Report Text
"RTN","RAO7PC2",102,0)
 S (Z1,Z2)=0
"RTN","RAO7PC2",103,0)
 ;file 74's "H" nodes are now additional clinical history
"RTN","RAO7PC2",104,0)
 I Z="H" S Z2=$O(^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,""),-1) I $O(^RARPT(RARPT,Z,Z1)) S Z2=Z2+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)="Additional Clinical History:"
"RTN","RAO7PC2",105,0)
 F  S Z1=$O(^RARPT(RARPT,Z,Z1)) Q:Z1'>0  D
"RTN","RAO7PC2",106,0)
 . S Z1(0)=$G(^RARPT(RARPT,Z,Z1,0)),Z2=Z2+1
"RTN","RAO7PC2",107,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)=Z1(0)
"RTN","RAO7PC2",108,0)
 . Q
"RTN","RAO7PC2",109,0)
 Q
"RTN","RAO7PC2",110,0)
 ;
"RTN","RAO7PC2",111,0)
CLIN(DFN,PROCLIST) ;Radiology and Clinical Reminders API
"RTN","RAO7PC2",112,0)
 ;
"RTN","RAO7PC2",113,0)
 ; Created by Cameron Taylor March 1999
"RTN","RAO7PC2",114,0)
 ; 
"RTN","RAO7PC2",115,0)
 ; This API recieves a patient and a list of procedures. For each 
"RTN","RAO7PC2",116,0)
 ; Procedure, the details of the last 'complete' procedure and/or the
"RTN","RAO7PC2",117,0)
 ; last 'cancelled' & 'in progress' procedure details and returns them 
"RTN","RAO7PC2",118,0)
 ; in ^TMP($J,"RADPROC"
"RTN","RAO7PC2",119,0)
 N XX,PROC,DATE,STATUS,PROVIDER,EXAM,X,Y,EXAMIEN,RADPTIEN,ORDER,SUCCESS
"RTN","RAO7PC2",120,0)
 ; 
"RTN","RAO7PC2",121,0)
 S DFN=$G(DFN)  ; Patient Name
"RTN","RAO7PC2",122,0)
 S PROCLIST=$G(PROCLIST)  ; List of Procedures (separated by '^')
"RTN","RAO7PC2",123,0)
 K ^TMP($J,"RADPROC")
"RTN","RAO7PC2",124,0)
 ;
"RTN","RAO7PC2",125,0)
 S RADPTIEN=$O(^RADPT("B",DFN,""))
"RTN","RAO7PC2",126,0)
 I (RADPTIEN="")!(RADPTIEN=0) D  Q
"RTN","RAO7PC2",127,0)
 .S ^TMP($J,"RADPROC")="Invalid/Unknown Radiology Patient"
"RTN","RAO7PC2",128,0)
 ;
"RTN","RAO7PC2",129,0)
 F XX=1:1 S PROC=$P(PROCLIST,U,XX) Q:PROC=""  D
"RTN","RAO7PC2",130,0)
 .S SUCCESS=0  ; Quit searching if SUCCESS=3 (comp, canc & in prog)
"RTN","RAO7PC2",131,0)
 .S DATE=0 F  S DATE=$O(^RADPT(RADPTIEN,"DT",DATE)) Q:DATE'?7N1".".N!(SUCCESS=3)  D
"RTN","RAO7PC2",132,0)
 ..S EXAMIEN=0 F  S EXAMIEN=$O(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN)) Q:'EXAMIEN!(SUCCESS=3)  D
"RTN","RAO7PC2",133,0)
 ...S EXAM=$G(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN,0))
"RTN","RAO7PC2",134,0)
 ...Q:$P(EXAM,U,2)'=PROC
"RTN","RAO7PC2",135,0)
 ...;
"RTN","RAO7PC2",136,0)
 ...; Continue, get STATUS and ORDER 
"RTN","RAO7PC2",137,0)
 ...; (0 is cancelled, 1-8 in progress & 9 is COMPLETE)
"RTN","RAO7PC2",138,0)
 ...; (ignore if null)
"RTN","RAO7PC2",139,0)
 ...;
"RTN","RAO7PC2",140,0)
 ...S STATUS=$P(EXAM,U,3)
"RTN","RAO7PC2",141,0)
 ...I STATUS'="" D
"RTN","RAO7PC2",142,0)
 ....S ORDER=$P(^RA(72,STATUS,0),U,3)
"RTN","RAO7PC2",143,0)
 ....S STATUS=$P(^RA(72,STATUS,0),U) ; description
"RTN","RAO7PC2",144,0)
 ...; 
"RTN","RAO7PC2",145,0)
 ...; Only one of each type (ORDER)
"RTN","RAO7PC2",146,0)
 ...;
"RTN","RAO7PC2",147,0)
 ...Q:ORDER=""
"RTN","RAO7PC2",148,0)
 ...I ORDER=0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"CANCELLED"))  S ORDER="CANCELLED"
"RTN","RAO7PC2",149,0)
 ...I ORDER=9 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"COMPLETE"))  S ORDER="COMPLETE"
"RTN","RAO7PC2",150,0)
 ...I ORDER<9,ORDER>0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"IN PROGRESS"))  S ORDER="IN PROGRESS"
"RTN","RAO7PC2",151,0)
 ...;
"RTN","RAO7PC2",152,0)
 ...; Now for the PROVIDER. Check PRIMARY INTERPRETING STAFF 
"RTN","RAO7PC2",153,0)
 ...; if none, then default to PRIMARY INTERPRETING RESIDENT.
"RTN","RAO7PC2",154,0)
 ...;
"RTN","RAO7PC2",155,0)
 ...S PROVIDER=$P(EXAM,U,15)
"RTN","RAO7PC2",156,0)
 ...S:PROVIDER="" PROVIDER=$P(EXAM,U,12)
"RTN","RAO7PC2",157,0)
 ...S:PROVIDER'="" PROVIDER=$P($G(^VA(200,PROVIDER,0)),U,1) ; description
"RTN","RAO7PC2",158,0)
 ...;
"RTN","RAO7PC2",159,0)
 ...; Create return info. on ^TMP (1st manipulate DATE)
"RTN","RAO7PC2",160,0)
 ...;
"RTN","RAO7PC2",161,0)
 ...S Y=9999999.9999-DATE
"RTN","RAO7PC2",162,0)
 ...S ^TMP($J,"RADPROC",RADPTIEN,PROC,ORDER)=Y_U_STATUS_U_PROVIDER
"RTN","RAO7PC2",163,0)
 ...S SUCCESS=SUCCESS+1
"RTN","RAO7PC2",164,0)
 .;
"RTN","RAO7PC2",165,0)
 .; Finished searching Patient file. Any Procedures with no activity?
"RTN","RAO7PC2",166,0)
 .;
"RTN","RAO7PC2",167,0)
 .I '$D(^TMP($J,"RADPROC",RADPTIEN,PROC)) S ^TMP($J,"RADPROC",RADPTIEN,PROC,"NONE")=""
"RTN","RAO7PC2",168,0)
 Q
"RTN","RAO7PC2",169,0)
 ;
"RTN","RAO7PC3")
0^2^B42089217^B41860849
"RTN","RAO7PC3",1,0)
RAO7PC3 ;HISC/SWM&CRT-Procedure Call utilities. ;8/15/08  16:45
"RTN","RAO7PC3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**16,26,27,56,95**;Mar 16, 1998;Build 7
"RTN","RAO7PC3",3,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RAO7PC3",4,0)
 ;Supported IA 10104 UP^XLFSTR
"RTN","RAO7PC3",5,0)
 ;; api to return entire report (same as auto e-mail's)
"RTN","RAO7PC3",6,0)
EN3(X) ; Return narrative text for exam(s)
"RTN","RAO7PC3",7,0)
 ; Input:
"RTN","RAO7PC3",8,0)
 ; X-> Exam id in one of two forms:
"RTN","RAO7PC3",9,0)
 ;   1) Pat. DFN^inv. exam date^Case IEN
"RTN","RAO7PC3",10,0)
 ;      Retrieves a single report for a single exam
"RTN","RAO7PC3",11,0)
 ;   2) Pat. DFN^inv. exam date^
"RTN","RAO7PC3",12,0)
 ;      Retrieves all reports for a set of exams ordered on one order
"RTN","RAO7PC3",13,0)
 ;
"RTN","RAO7PC3",14,0)
 ; Note:  Input delimiter can be any of the following: ^~\&;-
"RTN","RAO7PC3",15,0)
 ;        a delimiter may be a single space i.e, " "
"RTN","RAO7PC3",16,0)
 ;
"RTN","RAO7PC3",17,0)
 ; Output:
"RTN","RAO7PC3",18,0)
 ; ^TMP($J,"RAE3",Patient IEN,case IEN,procedure name)=report status^
"RTN","RAO7PC3",19,0)
 ; abnormal alert^CPRS Order ien
"RTN","RAO7PC3",20,0)
 ; ^TMP($J,"RAE3",Patient IEN,case IEN,procedure name,n)=line n of rpt
"RTN","RAO7PC3",21,0)
 ; ^TMP($J,"RAE3",Patient IEN,"PRINT_SET")=null (IF this is a printset)
"RTN","RAO7PC3",22,0)
 ; ^TMP($J,"RAE3",Patient IEN,"ORD")=name of ordered procedure for
"RTN","RAO7PC3",23,0)
 ; examsets and printsets
"RTN","RAO7PC3",24,0)
 ; ^TMP($J,"RAE3",Patient IEN,"ORD",case IEN)=name of ordered procedure
"RTN","RAO7PC3",25,0)
 ; for that case; not part of an examset or printset
"RTN","RAO7PC3",26,0)
 ;
"RTN","RAO7PC3",27,0)
 ;
"RTN","RAO7PC3",28,0)
 K ^TMP($J,"RAE3"),^TMP($J,"RA AUTOE")
"RTN","RAO7PC3",29,0)
 K RAU S RAU=$$DEL^RAO7PC1(X) I RAU="" K RAU Q
"RTN","RAO7PC3",30,0)
 Q:'$P(X,RAU)!('$P(X,RAU,2))  ; Quit if no Pat. DFN -or- no inv. exam DT
"RTN","RAO7PC3",31,0)
 N RACIEN,RADFN,RAINVXDT,RAPSET,RAUTOE,Y S RAPSET=0
"RTN","RAO7PC3",32,0)
 S RADFN=$P(X,RAU),RAINVXDT=$P(X,RAU,2),RACIEN=+$P(X,RAU,3)
"RTN","RAO7PC3",33,0)
 K RAU Q:'($D(^RADPT(RADFN,"DT",RAINVXDT,0))#2)
"RTN","RAO7PC3",34,0)
 I RACIEN D CASE(RACIEN) Q
"RTN","RAO7PC3",35,0)
 S Y=0
"RTN","RAO7PC3",36,0)
 F  S Y=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y)) Q:Y'>0  D
"RTN","RAO7PC3",37,0)
 . D CASE(Y) S RAPSET=0
"RTN","RAO7PC3",38,0)
 . Q
"RTN","RAO7PC3",39,0)
 Q
"RTN","RAO7PC3",40,0)
EN30(RAOIFN) ; Return narrative text for exam(s).  
"RTN","RAO7PC3",41,0)
 ; To be used with the EN3 entry point above.
"RTN","RAO7PC3",42,0)
 ;
"RTN","RAO7PC3",43,0)
 ; Input: RAOIFN -> the ien of Rad/Nuc Med Order
"RTN","RAO7PC3",44,0)
 ;
"RTN","RAO7PC3",45,0)
 Q:'RAOIFN  ; order passed in as 0 or null
"RTN","RAO7PC3",46,0)
 Q:'$D(^RAO(75.1,RAOIFN,0))  ; no such order
"RTN","RAO7PC3",47,0)
 Q:'$D(^RADPT("AO",RAOIFN))  ; no exam associated with this order
"RTN","RAO7PC3",48,0)
 N RADFN,RADTI,RACNI,RAXSET
"RTN","RAO7PC3",49,0)
 S RADFN=+$O(^RADPT("AO",RAOIFN,0)) Q:'RADFN
"RTN","RAO7PC3",50,0)
 S RADTI=+$O(^RADPT("AO",RAOIFN,RADFN,0)) Q:'RADTI
"RTN","RAO7PC3",51,0)
 S RAXSET=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),"^",5) ; set if RAXSET=1
"RTN","RAO7PC3",52,0)
 I RAXSET D EN3(RADFN_"^"_RADTI_"^") Q  ; exam set, hit EN3 code
"RTN","RAO7PC3",53,0)
 ; the following code is executed for non-exam set examinations
"RTN","RAO7PC3",54,0)
 S RACNI=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI,0)) Q:'RACNI
"RTN","RAO7PC3",55,0)
 D EN3(RADFN_"^"_RADTI_"^"_RACNI)
"RTN","RAO7PC3",56,0)
 Q
"RTN","RAO7PC3",57,0)
CASE(Y) ;
"RTN","RAO7PC3",58,0)
 N N,RABNOR,RACASE,RACIEN,RADIAG,RAEXAM,RAINCLUD,RAOPRC,RAORD,BLANK
"RTN","RAO7PC3",59,0)
 N RAMSG,RAPDIAG,RAPROC,RARDE,RARPT,RARPTST,RASPACE,SKIP,X,ZZRADFN,X0,X1,X2,RASIGVES,RARPTST2
"RTN","RAO7PC3",60,0)
 ;
"RTN","RAO7PC3",61,0)
 S RACIEN=Y,$P(BLANK," ",80)=""
"RTN","RAO7PC3",62,0)
 S RAEXAM(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",RACIEN,0)) Q:RAEXAM(0)']""
"RTN","RAO7PC3",63,0)
 S RACASE=$P(RAEXAM(0),"^")
"RTN","RAO7PC3",64,0)
 S:$P(RAEXAM(0),"^",25)=2 RAPSET=1
"RTN","RAO7PC3",65,0)
 S:RAPSET=1 ^TMP($J,"RAE3",RADFN,"PRINT_SET")=""
"RTN","RAO7PC3",66,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RAEXAM(0),"^",2),0))
"RTN","RAO7PC3",67,0)
 S RAPROC=$S($P(RAPROC(0),"^")]"":$P(RAPROC(0),"^"),1:"Unknown")
"RTN","RAO7PC3",68,0)
 S RAORD(0)=$G(^RAO(75.1,+$P(RAEXAM(0),"^",11),0))
"RTN","RAO7PC3",69,0)
 S RAORD(7)=$P(RAORD(0),"^",7)
"RTN","RAO7PC3",70,0)
 S RAOPRC(0)=$G(^RAMIS(71,+$P(RAORD(0),"^",2),0))
"RTN","RAO7PC3",71,0)
 S RAOPRC=$S($P(RAOPRC(0),"^")]"":$P(RAOPRC(0),"^"),1:"Unknown")
"RTN","RAO7PC3",72,0)
 S RAPDIAG(0)=$G(^RA(78.3,+$P(RAEXAM(0),"^",13),0))
"RTN","RAO7PC3",73,0)
 S RARPT=+$P(RAEXAM(0),"^",17),RARPTST2=$$UL^RAO7PC1A($$RSTAT^RAO7PC1A())
"RTN","RAO7PC3",74,0)
 S RARPT(0)=$G(^RARPT(RARPT,0)),RARPTST=$P(RARPT(0),"^",5)
"RTN","RAO7PC3",75,0)
 S RASIGVES="" I RARPTST="V",$P(RARPT(0),U,10)]"",$P(RARPT(0),U,9)]"" S X2=RARPT,X1=$P(RARPT(0),U,9),X=$P(RARPT(0),U,10) D DE^XUSHSHP S:X]"" RASIGVES="/ES/"_X
"RTN","RAO7PC3",76,0)
 S RARDE=$$GET1^DIQ(74,RARPT_",",8,"E")
"RTN","RAO7PC3",77,0)
 ; View whole report if Rad User or status is R or V.
"RTN","RAO7PC3",78,0)
 D CHKUSR^RAUTL2 S RAINCLUD=RAMSG
"RTN","RAO7PC3",79,0)
 ;allow V, R, EF rpts to be seen by non-Radiology CPRS users - patch 95
"RTN","RAO7PC3",80,0)
 S RAINCLUD=$S(RAMSG:1,"^V^R^EF^"[("^"_RARPTST_"^"):1,1:0)
"RTN","RAO7PC3",81,0)
 S RABNOR=$$UP^XLFSTR($P(RAPDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC3",82,0)
 ;
"RTN","RAO7PC3",83,0)
 I $P(RAEXAM(0),"^",25) S ^TMP($J,"RAE3",RADFN,"ORD")=RAOPRC
"RTN","RAO7PC3",84,0)
 I '$P(RAEXAM(0),"^",25) S ^TMP($J,"RAE3",RADFN,"ORD",RACIEN)=RAOPRC
"RTN","RAO7PC3",85,0)
 ;
"RTN","RAO7PC3",86,0)
 I RAPSET'<0 D
"RTN","RAO7PC3",87,0)
 .S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC)="^"_RABNOR_"^"_RAORD(7)
"RTN","RAO7PC3",88,0)
 .S $P(^TMP($J,"RAE3",RADFN,RACIEN,RAPROC),"^")=RARPTST2
"RTN","RAO7PC3",89,0)
 S:RAPSET<0 ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC)=""
"RTN","RAO7PC3",90,0)
 S:RAPSET=1 RAPSET=-1
"RTN","RAO7PC3",91,0)
 ;
"RTN","RAO7PC3",92,0)
 ; Setup variables then call ^RARTR to create Rad Report on ^TMP nodes
"RTN","RAO7PC3",93,0)
 ; 2 stages: INIT^RARTR creates header info, PRT1^RARTR for the report
"RTN","RAO7PC3",94,0)
 ; (save RADFN as RARTR kills it at the end)
"RTN","RAO7PC3",95,0)
 ;
"RTN","RAO7PC3",96,0)
 S RAUTOE=1,ZZRADFN=RADFN,RAACNT=0
"RTN","RAO7PC3",97,0)
 S X="^"_RADFN_"^"_(9999999.9999-RAINVXDT)_"^"_RACASE_"^"_RARPTST
"RTN","RAO7PC3",98,0)
 ;
"RTN","RAO7PC3",99,0)
 D INIT^RARTR
"RTN","RAO7PC3",100,0)
 S (RAFFLF,RAORIOF)=$G(IOF)
"RTN","RAO7PC3",101,0)
 I RAY0<0!(RAY1<0)!(RAY2<0)!(RAY3<0) K RAFFLF Q
"RTN","RAO7PC3",102,0)
 ;
"RTN","RAO7PC3",103,0)
 S RAVERF=0
"RTN","RAO7PC3",104,0)
 I RARPTST2="No Report" D
"RTN","RAO7PC3",105,0)
 .S:'$D(RAMDIV) RAMDIV=+$P(^RADPT(RADFN,"DT",RAINVXDT,0),"^",3)
"RTN","RAO7PC3",106,0)
 .S:'$D(RAMDV) RAMDV=$S($D(^RA(79,RAMDIV,.1)):^(.1),1:""),RAMDV=$TR(RAMDV,"YNyn","1010")
"RTN","RAO7PC3",107,0)
 D PRT1^RARTR
"RTN","RAO7PC3",108,0)
 S RADFN=ZZRADFN
"RTN","RAO7PC3",109,0)
 Q:'$D(^TMP($J,"RA AUTOE"))
"RTN","RAO7PC3",110,0)
 ;
"RTN","RAO7PC3",111,0)
 ; Now manipulate ^TMP($J,"RA AUTOE" and save as ^TMP($J,"RAE3"
"RTN","RAO7PC3",112,0)
 ; Step 1: Change Case Number to Exam Date
"RTN","RAO7PC3",113,0)
 ; Step 2: Remove Impression, Report & Diagnostic Codes if not
"RTN","RAO7PC3",114,0)
 ;         Released or Verified or Electronically Filed
"RTN","RAO7PC3",115,0)
 ;         Also remove "Att Phys" and "Pri Phys"
"RTN","RAO7PC3",116,0)
 ; Step 3: Change Status to Report Status & add Reported Date
"RTN","RAO7PC3",117,0)
 ; Step 4: If No Report then get Clin History from file #70.
"RTN","RAO7PC3",118,0)
 ; ** WITH PATCH 27 - NO LONGER NEED TO DO STEP 4 **
"RTN","RAO7PC3",119,0)
 ;
"RTN","RAO7PC3",120,0)
STEP1 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,1)=$P(^TMP($J,"RA AUTOE",1),"Case: ")
"RTN","RAO7PC3",121,0)
 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,1.5)="Exm Date: "_$$GET1^DIQ(70.02,RAINVXDT_","_RADFN_",",.01,"E")
"RTN","RAO7PC3",122,0)
 ;
"RTN","RAO7PC3",123,0)
STEP2 K SKIP S N=1 F  S N=$O(^TMP($J,"RA AUTOE",N)) Q:N=""  D
"RTN","RAO7PC3",124,0)
 . S X0=^TMP($J,"RA AUTOE",N),X1=$E(X0,1,10)
"RTN","RAO7PC3",125,0)
 . I (X1="Att Phys: ")!(X1="Pri Phys: ") D
"RTN","RAO7PC3",126,0)
 .. S ^TMP($J,"RA AUTOE",N)=$E(BLANK,1,41)_$E(X0,42,$L(X0))
"RTN","RAO7PC3",127,0)
 .. Q
"RTN","RAO7PC3",128,0)
 .;I RARPTST2="No Report",($E(^TMP($J,"RA AUTOE",N),1,21)="    Clinical History:") D STEP4
"RTN","RAO7PC3",129,0)
 .I $E(^TMP($J,"RA AUTOE",N),1,12)="    Report: " D STEP3 Q:RARPTST2="No Report"
"RTN","RAO7PC3",130,0)
 .I 'RAINCLUD,$E(^TMP($J,"RA AUTOE",N),1,15)="    Impression:" D
"RTN","RAO7PC3",131,0)
 ..S SKIP=1,^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N+0.1)=""
"RTN","RAO7PC3",132,0)
 .I 'RAINCLUD,$E(^TMP($J,"RA AUTOE",N),1,28)="    Primary Diagnostic Code:" D
"RTN","RAO7PC3",133,0)
 ..S SKIP=1 S ^TMP($J,"RA AUTOE",N)=$E(^TMP($J,"RA AUTOE",N),1,28)
"RTN","RAO7PC3",134,0)
 .I 'RAINCLUD,$E(^TMP($J,"RA AUTOE",N),1,31)="    Secondary Diagnostic Codes:" D
"RTN","RAO7PC3",135,0)
 ..S SKIP=1,^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N+0.1)=""
"RTN","RAO7PC3",136,0)
 .I $E(^TMP($J,"RA AUTOE",N),1,27)="Primary Interpreting Staff:" K SKIP
"RTN","RAO7PC3",137,0)
 .I $D(SKIP) S SKIP=SKIP+1
"RTN","RAO7PC3",138,0)
 .I $G(SKIP)<3 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N)=^TMP($J,"RA AUTOE",N)
"RTN","RAO7PC3",139,0)
 .Q
"RTN","RAO7PC3",140,0)
 ;
"RTN","RAO7PC3",141,0)
XIT K ^TMP($J,"RA AUTOE")
"RTN","RAO7PC3",142,0)
 Q
"RTN","RAO7PC3",143,0)
 ;
"RTN","RAO7PC3",144,0)
STEP3 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.4)="    Report Status: "_RARPTST2
"RTN","RAO7PC3",145,0)
 I RARPTST2="No Report" S N="^" Q
"RTN","RAO7PC3",146,0)
 S $P(RASPACE," ",46)=""
"RTN","RAO7PC3",147,0)
 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.4)=^(N-0.4)_$E(RASPACE,1,46-$L(^(N-0.4)))_"Date Reported: "_RARDE
"RTN","RAO7PC3",148,0)
 I RARPTST="V" D
"RTN","RAO7PC3",149,0)
 . S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.3)=RASPACE_" Date Verified: "_$P($$GET1^DIQ(74,+$P(RAEXAM(0),"^",17),7),"@")
"RTN","RAO7PC3",150,0)
 . S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.2)="    Verifier E-Sig:"_RASIGVES
"RTN","RAO7PC3",151,0)
 . Q
"RTN","RAO7PC3",152,0)
 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.1)=""
"RTN","RAO7PC3",153,0)
 S ^TMP($J,"RA AUTOE",N)="    Report:"
"RTN","RAO7PC3",154,0)
 I 'RAINCLUD S SKIP=1,^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N+0.1)=""
"RTN","RAO7PC3",155,0)
 Q
"RTN","RAO7PC3",156,0)
 ;
"RTN","RAO7PC3",157,0)
STEP4 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",RACIEN,"H",0)) D
"RTN","RAO7PC3",158,0)
 .N RAI,RAIN,Z S (RAI,Z)=0,RAIN=N_".000"
"RTN","RAO7PC3",159,0)
 .F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",RACIEN,"H",Z)) Q:Z'>0  D
"RTN","RAO7PC3",160,0)
 ..S RAI=RAI+1
"RTN","RAO7PC3",161,0)
 ..S RAIN=$E(RAIN,1,$L(RAIN)-$L(RAI))_RAI
"RTN","RAO7PC3",162,0)
 ..S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,RAIN)="      "_$G(^RADPT(RADFN,"DT",RAINVXDT,"P",RACIEN,"H",Z,0))
"RTN","RAO7PC3",163,0)
 Q
"RTN","RARTE5")
0^3^B93390991^B66404814
"RTN","RARTE5",1,0)
RARTE5 ;HISC/SWM AISC/MJK,RMO-Enter/Edit Outside Reports ;1/26/09  11:36
"RTN","RARTE5",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56,95**;Mar 16, 1998;Build 7
"RTN","RARTE5",3,0)
 ;Private IA #4793 CREATE^WVRALINK
"RTN","RARTE5",4,0)
 ;Controlled IA #3544 ^VA(200
"RTN","RARTE5",5,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RARTE5",6,0)
 ;Supported IA #10013 IX1^DIK
"RTN","RARTE5",7,0)
 ;Supported IA #10141 MES^XPDUTL
"RTN","RARTE5",8,0)
 ; adapted from RARTE, RARTE1, RARTE4
"RTN","RARTE5",9,0)
 F I=1:1:10 W !?3,$P($T(INTRO+I),";;",2)
"RTN","RARTE5",10,0)
 W ! D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE5",11,0)
 N RAXIT,RASUBY0,RA18EX,RAPRTSET,RAMEMARR,RA1,RA7003
"RTN","RARTE5",12,0)
 S RAXIT=0
"RTN","RARTE5",13,0)
 K RASSS,RASSSX ;clear HL7 exclusion vars
"RTN","RARTE5",14,0)
 I $D(RANOSCRN) S X=$$DIVLOC^RAUTL7() I X D Q1 QUIT
"RTN","RARTE5",15,0)
 ;
"RTN","RARTE5",16,0)
 ; only require any Radiology Classification in New Person file
"RTN","RARTE5",17,0)
 S X=0 F I="C","R","S","T" S:$D(^VA(200,"ARC",I,DUZ)) X=1
"RTN","RARTE5",18,0)
 I 'X W !,"Your user account is missing a Radiology classification.",! D INCRPT Q
"RTN","RARTE5",19,0)
 ;
"RTN","RARTE5",20,0)
START S RAFIRST=0 ;=1 for 1st time rpt given "EF" rpt status
"RTN","RARTE5",21,0)
 K RAVER S RAVW="",RAREPORT=1 D ^RACNLU G Q1:"^"[X
"RTN","RARTE5",22,0)
 ; RACNLU defines RADFN, RADTI, RACNI, RARPT
"RTN","RARTE5",23,0)
 S RASUBY0=Y(0) ; save value of y(0)
"RTN","RARTE5",24,0)
 G:$P(^RA(72,+RAST,0),"^",3)>0 CONTIN
"RTN","RARTE5",25,0)
 I $D(^XUSEC("RA MGR",DUZ)) G CONTIN
"RTN","RARTE5",26,0)
 G:$P(RAMDV,"^",22)=1 CONTIN
"RTN","RARTE5",27,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!! D INCRPT G START
"RTN","RARTE5",28,0)
 ;
"RTN","RARTE5",29,0)
CONTIN ; continue
"RTN","RARTE5",30,0)
 S RAXIT=0 D DISPLAY^RARTE6
"RTN","RARTE5",31,0)
 I RA18EX=-1 D INCRPT G START
"RTN","RARTE5",32,0)
 ; raprtset is defined in display^rarte6
"RTN","RARTE5",33,0)
 S RAPNODE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE5",34,0)
 S RA7003=@(RAPNODE_RACNI_",0)")
"RTN","RARTE5",35,0)
 S RAXIT=$$LOCK^RARTE6(RAPNODE,RACNI) I RAXIT D INCRPT G START
"RTN","RARTE5",36,0)
 ;
"RTN","RARTE5",37,0)
 ; Real rpt must have fld 5="EF" & fld 18 w/ data.  Stub rpt allowed
"RTN","RARTE5",38,0)
 I $D(^RARPT(+RARPT,0)),(($P(^(0),"^",5)'="EF")!($P(^(0),"^",18)="")),'$$STUB^RAEDCN1(+RARPT) W !?3,$C(7),"Only Electronically Filed reports can be selected!",! D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT G START
"RTN","RARTE5",39,0)
 ;Create new rpt, or skip to IN to edit existing report
"RTN","RARTE5",40,0)
 G IN:$D(^RARPT(+RARPT,0))
"RTN","RARTE5",41,0)
 ;
"RTN","RARTE5",42,0)
 G:'RAPRTSET NEW G:$P(^RA(72,+RAST,0),"^",3)>0 NEW
"RTN","RARTE5",43,0)
 ; case is part of a print set, AND is cancelled
"RTN","RARTE5",44,0)
 N RA2 S (RA1,RA2)=""
"RTN","RARTE5",45,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S:$P(RAMEMARR(RA1),"^",3)]"" RA2=$P(RAMEMARR(RA1),"^",3)
"RTN","RARTE5",46,0)
 G:RA2="" NEW
"RTN","RARTE5",47,0)
 W !!,$C(7),"Other cases of this cancelled case ",RACN,"'s print set are entered in a report already",!!,"You may NOT create a new report for this cancelled case,",!,"but you may include this cancelled case in the existing report."
"RTN","RARTE5",48,0)
 W !!,"Do you want to include this cancelled case in the same report",!,"as the others in the print set ?"
"RTN","RARTE5",49,0)
 S %=2 D YN^DICN
"RTN","RARTE5",50,0)
 W:%>0 "...",$S(%=1:"Include",1:"Skip")," this case"
"RTN","RARTE5",51,0)
 I %=1 S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)=RA2,RARPT=RA2,RARPTN=$P(^RARPT(RARPT,0),"^"),RA1=RACN D INSERT^RARTE2
"RTN","RARTE5",52,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT G START
"RTN","RARTE5",53,0)
NEW G:'RAPRTSET NEW1
"RTN","RARTE5",54,0)
 L +^RADPT(RADFN,"DT",RADTI):DILOCKTM G:$T NEW1
"RTN","RARTE5",55,0)
 W !!?10,$C(7),"** This case belongs to a printset, and someone else is",?68,"**",!?10,"** editing another case from this printset, or entering",?68,"**"
"RTN","RARTE5",56,0)
 W !?10,"** a report for this printset, so you may not enter a",?68,"**",!?10,"** new report.",?68,"**"
"RTN","RARTE5",57,0)
 H 2 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT G START
"RTN","RARTE5",58,0)
 ;
"RTN","RARTE5",59,0)
NEW1 S RARPTN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN
"RTN","RARTE5",60,0)
 W !?3,"...report not entered for this exam...",!?10,"...will now initialize report entry..."
"RTN","RARTE5",61,0)
 S I=+$P(^RARPT(0),"^",3)
"RTN","RARTE5",62,0)
 ;
"RTN","RARTE5",63,0)
LOCK ;Try to lock next avail IEN, if locked - fail, if used - increment again
"RTN","RARTE5",64,0)
 S I=I+1 S RAXIT=$$LOCK^RARTE6("^RARPT(",I) I RAXIT D UNLOCK2^RARTE4 D INCRPT G START
"RTN","RARTE5",65,0)
 ;don't check ^RARPT("B",RARPTN) due cloaked deleted reports
"RTN","RARTE5",66,0)
 I $D(^RARPT(I)) D UNLOCK^RAUTL12("^RARPT(",I) G LOCK
"RTN","RARTE5",67,0)
 S ^RARPT(I,0)=RARPTN,RARPT=I,^(0)=$P(^RARPT(0),"^",1,2)_"^"_I_"^"_($P(^(0),"^",4)+1),^DISV($S($D(DUZ)#2:DUZ,1:0),"^RARPT(")=I S:'$D(^RARPT(RARPT,"T")) ^("T")=""
"RTN","RARTE5",68,0)
 S ^RARPT(RARPT,0)=RARPTN_"^"_RADFN_"^"_RADTE_"^"_RACN_"^EF",DIK="^RARPT(",DA=RARPT D IX1^DIK
"RTN","RARTE5",69,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RARTE5",70,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTE5",71,0)
 S DIE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE5",72,0)
 S DR="17////"_RARPT D ^DIE
"RTN","RARTE5",73,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,RAY1,X,Y
"RTN","RARTE5",74,0)
 ;if printset -- set pc 17 in subfile 70.03 and subrec in subfile 74.05
"RTN","RARTE5",75,0)
 I RAPRTSET D PTR^RARTE2
"RTN","RARTE5",76,0)
 I RAXIT D UNLOCK2^RARTE4,UNLOCK^RAUTL12("^RARPT(",RARPT) G Q1
"RTN","RARTE5",77,0)
 W !,RAI
"RTN","RARTE5",78,0)
 G IN0
"RTN","RARTE5",79,0)
IN ;edit existing rpt, so lock rpt fr the 1st time
"RTN","RARTE5",80,0)
 S RAXIT=$$LOCK^RARTE6("^RARPT(",RARPT) I RAXIT D UNLOCK2^RARTE4 G Q1
"RTN","RARTE5",81,0)
IN0 ;skip to here if rpt created in this session and already locked
"RTN","RARTE5",82,0)
 ; Flag first time EF report is made if piece 18 has no data  yet
"RTN","RARTE5",83,0)
 I $P(^RARPT(RARPT,0),U,18)="" S RAFIRST=1
"RTN","RARTE5",84,0)
 ; save DXs before edit
"RTN","RARTE5",85,0)
 S RANY1=$$ANYDX^RARTE7(.RAA1) ;1=has DXs, 0=no DXs, RAA1() stores DXs
"RTN","RARTE5",86,0)
 ; Ask if copy standard report
"RTN","RARTE5",87,0)
 I $P(RAMDV,"^",12) D STD^RARTE1 I X="^" S RAXIT=1 G UNCASE
"RTN","RARTE5",88,0)
 ;  Ask Report Date
"RTN","RARTE5",89,0)
 S DR="8",DA=RARPT,DIE="^RARPT(" D ^DIE K DE,DQ
"RTN","RARTE5",90,0)
 ; y is defined if user "^" out
"RTN","RARTE5",91,0)
 I $D(Y) K Y G UNCASE
"RTN","RARTE5",92,0)
 ;   Display Clinical History
"RTN","RARTE5",93,0)
 D CHPRINT^RAUTL9
"RTN","RARTE5",94,0)
 ; report status before editing
"RTN","RARTE5",95,0)
 S RACT=$P(^RARPT(RARPT,0),U,5)
"RTN","RARTE5",96,0)
 ; Edit Report Text and enter Diagnostic code(s)
"RTN","RARTE5",97,0)
 D ERPT
"RTN","RARTE5",98,0)
 ; Resident and Staff not asked and not copied to other cases of printset
"RTN","RARTE5",99,0)
 ; continue to check sufficient data even if RAXIT=1 at this point
"RTN","RARTE5",100,0)
UNCASE ; 
"RTN","RARTE5",101,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) ;unlock case
"RTN","RARTE5",102,0)
 ; copy diags to other cases of printset
"RTN","RARTE5",103,0)
 ; and unlock case "DT" level after copying is done
"RTN","RARTE5",104,0)
 I RAPRTSET S RADRS=1,RAXIT=0 D COPY^RARTE2 L -^RADPT(RADFN,"DT",RADTI)
"RTN","RARTE5",105,0)
 ; first time EF rpt made -- del rpt & xrefs if no rpt txt & impression
"RTN","RARTE5",106,0)
 I RAFIRST S RAXIT=$$CCAN(RARPT)
"RTN","RARTE5",107,0)
 D UNLOCK^RAUTL12("^RARPT(",RARPT) ;unlock report
"RTN","RARTE5",108,0)
 G:RAXIT PRT
"RTN","RARTE5",109,0)
 ;
"RTN","RARTE5",110,0)
 ;  "EF" was stuffed in LOCK+5 for new rpts but not stub rpt yet
"RTN","RARTE5",111,0)
 I $P(^RARPT(RARPT,0),U,5)'="EF" D SETFF^RARTE6(74,5,RARPT,"EF")
"RTN","RARTE5",112,0)
 W !,"Report status is stored as ""Electronically Filed""."
"RTN","RARTE5",113,0)
 ; Stuff in initial entry date only once
"RTN","RARTE5",114,0)
 I RAFIRST D SETFF^RARTE6(74,18,RARPT,"NOW","E")
"RTN","RARTE5",115,0)
 ;   Stuff in Activity Log subfile at all times
"RTN","RARTE5",116,0)
 D SETALOG^RARTE6("+1,"_RARPT_",","F","")
"RTN","RARTE5",117,0)
 ;
"RTN","RARTE5",118,0)
 ; transmit to women's health each time this point is reached
"RTN","RARTE5",119,0)
 ; COPY^WVRALINK will stop if the same case number is already in 790.1
"RTN","RARTE5",120,0)
 ;
"RTN","RARTE5",121,0)
 I $P(^RARPT(RARPT,0),U,5)="EF",$T(CREATE^WVRALINK)]"" D CREATE^WVRALINK(RADFN,RADTI,RACNI) ; women's health
"RTN","RARTE5",122,0)
 ;
"RTN","RARTE5",123,0)
PRT I RAXIT S RAXIT=0 D UNLOCK2^RARTE4 D INCRPT G START
"RTN","RARTE5",124,0)
 ;
"RTN","RARTE5",125,0)
 ; report status after editing
"RTN","RARTE5",126,0)
 S RACT=$P(^RARPT(RARPT,0),U,5)
"RTN","RARTE5",127,0)
 ; ---
"RTN","RARTE5",128,0)
 ; set RAHLTCPB to prevent broadcast ORM messages
"RTN","RARTE5",129,0)
 N RAHLTCPB S RAHLTCPB=1
"RTN","RARTE5",130,0)
 ;
"RTN","RARTE5",131,0)
 ; update case's exam status only if exam status isn't COMPLETE
"RTN","RARTE5",132,0)
 D:$$GET1^DIQ(72,+$P(RA7003,U,3)_",",3)'=9 UP1^RAUTL1
"RTN","RARTE5",133,0)
 S RANY2=$$ANYDX^RARTE7(.RAA2) ;RAA2() store DXs after edit
"RTN","RARTE5",134,0)
 ; check if new/changed diagnostic codes, send alert if nec.
"RTN","RARTE5",135,0)
 D ALERT^RARTE7
"RTN","RARTE5",136,0)
 K RAAB
"RTN","RARTE5",137,0)
 ; broadcast if EF rpt made first time, or any DX changed/added/del'd
"RTN","RARTE5",138,0)
 I $O(RAA2(0))!(RAFIRST) D
"RTN","RARTE5",139,0)
 .D HLXMSG ;find VR subscribers to exclude
"RTN","RARTE5",140,0)
 .D RPT^RAHLRPC
"RTN","RARTE5",141,0)
 .Q
"RTN","RARTE5",142,0)
PRT1 R !!,"Do you wish to print this report? No// ",X:DTIME S:'$T!(X["^") X="N" S:X="" X="N" ;030497
"RTN","RARTE5",143,0)
 I "Nn"[$E(X) D INCRPT G START
"RTN","RARTE5",144,0)
 I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to print this report, or 'NO' not to." G PRT1
"RTN","RARTE5",145,0)
 S ION=$P(RAMLC,"^",10),IOP=$S(ION]"":"Q;"_ION,1:"Q")
"RTN","RARTE5",146,0)
 S RAMES="W !!?3,""Report has been queued for printing on device "",ION,""."""
"RTN","RARTE5",147,0)
 D Q^RARTR D INCRPT G START ; queue rpt, cleanup, startover
"RTN","RARTE5",148,0)
 ;
"RTN","RARTE5",149,0)
Q1 K %,%DT,%W,%Y,%Y1,C,D0,D1,DA,DIC,DIE,DR,OREND,RABTCH,RABTCHN,RACN,RACNI,RACOPY,RACS,RACT,RADATE,RADFN,RADTE,RADTI,RADUZ,RAELESIG,RAFIN,RAHEAD,RAI,RAJ1
"RTN","RARTE5",150,0)
 K RALI,RALR,RANME,RANUM,RAOR,RAORDIFN,RAPNODE,RAPRC,RAPRIT,RAQUIT,RAREPORT,RARES,RARPDT,RARPT,RARPTN,RARPTZ,RARTPN,RASET,RASI,RASIG,RASN,RASSN,RAST,RAST1,RASTI,RASTFF,RAVW,XQUIT,W,X,Y
"RTN","RARTE5",151,0)
 K D,D2,DDER,DI,DIPGM,DLAYGO,J,RAEND,RAF5,RAFL,RAFST,RAIX,RAPOP,RAY1
"RTN","RARTE5",152,0)
 K ^TMP($J,"RAEX")
"RTN","RARTE5",153,0)
 K POP,DUOUT,RAFDA,RATEXT,RADIR0,RAXIT
"RTN","RARTE5",154,0)
 D INCRPT
"RTN","RARTE5",155,0)
 Q
"RTN","RARTE5",156,0)
INCRPT ; Kill extraneous variables to avoid collisions.
"RTN","RARTE5",157,0)
 ; Incomplete report information, select another case #.
"RTN","RARTE5",158,0)
 K DA,DIE,DR,RATXT
"RTN","RARTE5",159,0)
 K %,%DT,D,D0,D1,D2,DI,DIC,DIWT,DN,I,J,RAA1,RAA2,RACN,RACNI,RACT
"RTN","RARTE5",160,0)
 K RADATE,RADTE,RADTI,RAFIN,RAFIRST,RAI,RALI,RALR,RANME,RAPRC,RARPT
"RTN","RARTE5",161,0)
 K RARPTN,RASSN,RAST,RAVW,RASSS,RASSSX,X
"RTN","RARTE5",162,0)
 Q
"RTN","RARTE5",163,0)
CCAN(IEN74) ;Check canned report for Outside Reporting
"RTN","RARTE5",164,0)
 ; adapted from EN3^RAUTL15
"RTN","RARTE5",165,0)
 ; outputs:  0 if report is kept
"RTN","RARTE5",166,0)
 ;           1 if report is deleted due to no canned text entered
"RTN","RARTE5",167,0)
 ;
"RTN","RARTE5",168,0)
 N RAPRG74,RATXT
"RTN","RARTE5",169,0)
 ; keep report if it is linked to images
"RTN","RARTE5",170,0)
 I $O(^RARPT(IEN74,2005,0))>0 Q 0
"RTN","RARTE5",171,0)
 ;
"RTN","RARTE5",172,0)
 ;del canned report if missing both REPORT TEXT and IMPRESSION TEXT
"RTN","RARTE5",173,0)
 I '$O(^RARPT(IEN74,"I",0)),'$O(^RARPT(IEN74,"R",0)) D  Q 1
"RTN","RARTE5",174,0)
 .; un-link rpt from other cases of printset
"RTN","RARTE5",175,0)
 .D DEL17^RARTE2(IEN74)
"RTN","RARTE5",176,0)
 .; exec field's xrefs' KILL logic
"RTN","RARTE5",177,0)
 .S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTE5",178,0)
 .D ENKILL^RAXREF(70.03,17,IEN74,.DA)
"RTN","RARTE5",179,0)
 .;
"RTN","RARTE5",180,0)
 .;del piece 17 from case record
"RTN","RARTE5",181,0)
 .S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)="" K DA,X
"RTN","RARTE5",182,0)
 .;
"RTN","RARTE5",183,0)
 .; Del report ptr from batch and distribution files
"RTN","RARTE5",184,0)
 .D UPDTPNT^RAUTL9(IEN74)
"RTN","RARTE5",185,0)
 .;
"RTN","RARTE5",186,0)
 .; Del entry from Report file
"RTN","RARTE5",187,0)
 .S DA=IEN74,DIK="^RARPT(" D ^DIK
"RTN","RARTE5",188,0)
 .S RATXT(1)=" "
"RTN","RARTE5",189,0)
 .S RATXT(2)="   Outside canned report not complete.  Must Delete......deletion complete!"
"RTN","RARTE5",190,0)
 .S RATXT(3)=$C(7) D MES^XPDUTL(.RATXT)
"RTN","RARTE5",191,0)
 .; also delete any diagnostic codes from case record
"RTN","RARTE5",192,0)
 .I RAPRTSET D DELDXPRT ;del DXs from printset cases
"RTN","RARTE5",193,0)
 .I 'RAPRTSET D DELDX ;del DXs from standalone case
"RTN","RARTE5",194,0)
 .Q
"RTN","RARTE5",195,0)
 Q 0
"RTN","RARTE5",196,0)
ERPT ; Edit report text, impression, and enter/edit diagnostic codes
"RTN","RARTE5",197,0)
 ;remove lock case commands here since case is still locked
"RTN","RARTE5",198,0)
 S $P(RATXT,"+",52)=""
"RTN","RARTE5",199,0)
 W !!?5,RATXT,!?8,"Required:  REPORT TEXT and/or IMPRESSION TEXT",!?5,RATXT
"RTN","RARTE5",200,0)
 S RAXIT=0 ; here, =1 means user "^" out
"RTN","RARTE5",201,0)
 S DA=RARPT,DIE="^RARPT("
"RTN","RARTE5",202,0)
 S DR="200;I X=""^"" S Y=""@8"";300;I X'=""^"" S Y=""@9"";@8;S RAXIT=1;@9"
"RTN","RARTE5",203,0)
 D ^DIE
"RTN","RARTE5",204,0)
 ; subseq edit -- Report Text and Impression Text cannot both be empty
"RTN","RARTE5",205,0)
 I 'RAFIRST,'$O(^RARPT(RARPT,"I",0)),'$O(^RARPT(RARPT,"R",0)) G ERPT
"RTN","RARTE5",206,0)
 I RAXIT=1 Q
"RTN","RARTE5",207,0)
 ; Diagnostic codes
"RTN","RARTE5",208,0)
 ; (code taken from routine RARTE1)
"RTN","RARTE5",209,0)
 S RAIMGTYI=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U)
"RTN","RARTE5",210,0)
 S X=+$O(^RA(72,"AA",RAIMGTYJ,9,0)),DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P""," K RAIMGTYI,RAIMGTYJ
"RTN","RARTE5",211,0)
 ; ask Prim. Diag, required if site require diag, don't ck abnormal here
"RTN","RARTE5",212,0)
 S DR=13_$S('$D(^RA(72,X,.1)):"",$P(^(.1),"^",5)'="Y":"",1:"R")
"RTN","RARTE5",213,0)
 ; allow user to "^" exit
"RTN","RARTE5",214,0)
 D ^DIE K DA,DE,DQ,DIE,DR
"RTN","RARTE5",215,0)
 I ($P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13)="")!($D(Y)) S RAXIT=0 G PACS
"RTN","RARTE5",216,0)
 S DR="50///"_RACN
"RTN","RARTE5",217,0)
 S DR(2,70.03)=13.1
"RTN","RARTE5",218,0)
 S DR(3,70.14)=.01 ; don't ck abnormal here
"RTN","RARTE5",219,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT"","
"RTN","RARTE5",220,0)
 D ^DIE K DA,DE,DQ,DIE,DR
"RTN","RARTE5",221,0)
 I $D(Y) K Y S RAXIT=1 ;$D(Y) means user "^" out
"RTN","RARTE5",222,0)
PACS ; do not broadcast ORU message at this point
"RTN","RARTE5",223,0)
 ;
"RTN","RARTE5",224,0)
 ; move WV outside of this in case rpt is deleted due insufficient data
"RTN","RARTE5",225,0)
 Q
"RTN","RARTE5",226,0)
 ;
"RTN","RARTE5",227,0)
HLXMSG ; set up RASSSX() of VR subscribers to exclude from ORM msg broadcast
"RTN","RARTE5",228,0)
 N RA,XX
"RTN","RARTE5",229,0)
 ; q if there are no HL applications that use the 4 RA HL7 protocols
"RTN","RARTE5",230,0)
 Q:'$$GETAP^RAHLRS1(.XX)
"RTN","RARTE5",231,0)
 S RA=$NA(XX)
"RTN","RARTE5",232,0)
 F  S RA=$Q(@RA) Q:RA=""  I RA'["RA-TALK",(RA'["RA-PSCRIBE"),(RA'["RA-SCIMAGE"),(RA'["RA-RADWHERE") S RASSS(@RA)=""
"RTN","RARTE5",233,0)
 ; RASSS(ien #771)
"RTN","RARTE5",234,0)
 ; RASSSX(ien #101 driver, ien #101 subscriber)=".01 value of driver"
"RTN","RARTE5",235,0)
 D:$D(RASSS)>1 GETSUB^RAHLRS1(.RASSS,.RASSSX)
"RTN","RARTE5",236,0)
 Q
"RTN","RARTE5",237,0)
DELDX ; del any Prim. and Sec. DXs from standalone case
"RTN","RARTE5",238,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",13)="@" ;Prim DX
"RTN","RARTE5",239,0)
 D FILE^DIE("","RAFDA")
"RTN","RARTE5",240,0)
 K RAFDA
"RTN","RARTE5",241,0)
 D KILSEC^RARTE7(70.14,RACNI)
"RTN","RARTE5",242,0)
 Q
"RTN","RARTE5",243,0)
DELDXPRT ;del any Prim. and Sec. DXs from all cases in printset
"RTN","RARTE5",244,0)
 S RA1=0
"RTN","RARTE5",245,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE5",246,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",13)="@" ;Prim DX
"RTN","RARTE5",247,0)
 .D FILE^DIE("","RAFDA")
"RTN","RARTE5",248,0)
 .K RAFDA
"RTN","RARTE5",249,0)
 .D KILSEC^RARTE7(70.14,RA1)
"RTN","RARTE5",250,0)
 .Q
"RTN","RARTE5",251,0)
 Q
"RTN","RARTE5",252,0)
INTRO ;
"RTN","RARTE5",253,0)
 ;;+--------------------------------------------------------+
"RTN","RARTE5",254,0)
 ;;|                                                        |
"RTN","RARTE5",255,0)
 ;;|  This option is for entering canned text for           |
"RTN","RARTE5",256,0)
 ;;|  outside work:  interpreted report done outside,       |
"RTN","RARTE5",257,0)
 ;;|  and images made outside this facility.                |
"RTN","RARTE5",258,0)
 ;;|                                                        |
"RTN","RARTE5",259,0)
 ;;|  For a printset, the canned text must apply to all     |
"RTN","RARTE5",260,0)
 ;;|  cases within the printset.                            |
"RTN","RARTE5",261,0)
 ;;|                                                        |
"RTN","RARTE5",262,0)
 ;;+--------------------------------------------------------+
"RTN","RARTE6")
0^4^B105675673^B106132730
"RTN","RARTE6",1,0)
RARTE6 ;HISC/SM Restore deleted report ;10/27/08 10:48
"RTN","RARTE6",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56,95**;Mar 16, 1998;Build 7
"RTN","RARTE6",3,0)
 ;Supported IA #10060 ^VA(200
"RTN","RARTE6",4,0)
 ;Supported IA #2053 FILE^DIE, UPDATE^DIE
"RTN","RARTE6",5,0)
 ;Supported IA #2052 GET1^DID
"RTN","RARTE6",6,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RARTE6",7,0)
 ;Supported IA #10103 NOW^XLFDT
"RTN","RARTE6",8,0)
 ;Supported IA #2055 ROOT^DILFD
"RTN","RARTE6",9,0)
 ;Supported IA #10060 GETS^DIQ
"RTN","RARTE6",10,0)
 Q
"RTN","RARTE6",11,0)
RSTR ;restore deleted report
"RTN","RARTE6",12,0)
 F I=1:1:5 W !?4,$P($T(INTRO+I),";;",2)
"RTN","RARTE6",13,0)
 W !
"RTN","RARTE6",14,0)
 S RAXIT=0 ; =0 exit normally, =1 exit early
"RTN","RARTE6",15,0)
 I '$D(^XUSEC("RA MGR",DUZ)) W !!,"Supervisory key RA MGR is needed for this option." Q
"RTN","RARTE6",16,0)
 S DIC("S")="I $P(^(0),""^"",5)=""X""" ;only select deleted reports
"RTN","RARTE6",17,0)
 S DIC("A")="Select Deleted Report to restore: "
"RTN","RARTE6",18,0)
 S DIC="^RARPT(",DIC(0)="AEMQZ"
"RTN","RARTE6",19,0)
 D DICW^RARTST1,^DIC K DIC I Y<0 G FINISH
"RTN","RARTE6",20,0)
 S RARPT=+Y
"RTN","RARTE6",21,0)
 W !
"RTN","RARTE6",22,0)
 D CHECK G:RAXIT NOTDONE ;check if case has rpt & DX codes
"RTN","RARTE6",23,0)
 D ASK1 G:RAXIT NOTDONE ;ask if want restore deleted report
"RTN","RARTE6",24,0)
 D ASSOC G:RAXIT NOTDONE ;display associated case(s) & ask user again if want continue
"RTN","RARTE6",25,0)
 D RESTORE ;restore rpt status, link rpt to case(s)
"RTN","RARTE6",26,0)
 D FINISH
"RTN","RARTE6",27,0)
 Q
"RTN","RARTE6",28,0)
CHECK ; check if associated case(s) has rpt and DX codes
"RTN","RARTE6",29,0)
 S RA74=^RARPT(RARPT,0)
"RTN","RARTE6",30,0)
 S RADFN=+$P(RA74,U,2),RADTI=9999999.9999-$P(RA74,U,3),RACN=+$P($P(RA74,U,1),"-",2)
"RTN","RARTE6",31,0)
 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0))
"RTN","RARTE6",32,0)
 S RA70=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTE6",33,0)
 I 'RADFN!('RADTI)!('RACNI)!(RA70="") D ERR0 Q
"RTN","RARTE6",34,0)
 S RANME=$$GET1^DIQ(2,RADFN,.01),RAST=+$P(RA70,U,3)
"RTN","RARTE6",35,0)
 S RAPRC=$S($D(^RAMIS(71,+$P(RA70,U,2),0)):$P(^(0),U),1:"Unknown")
"RTN","RARTE6",36,0)
 S RASSN=$$SSN^RAUTL,RASUBY0=RA70
"RTN","RARTE6",37,0)
 S RANODE=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RARTE6",38,0)
 ; check if case(s) already have a report
"RTN","RARTE6",39,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RARTE6",40,0)
 I RAPRTSET D
"RTN","RARTE6",41,0)
 .S RA1=0
"RTN","RARTE6",42,0)
 .F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE6",43,0)
 ..I $P(^RADPT(RADFN,"DT",RADTI,"P",RA1,0),U,17)'="" D ERR3(+RAMEMARR(RA1))
"RTN","RARTE6",44,0)
 ..Q
"RTN","RARTE6",45,0)
 .Q
"RTN","RARTE6",46,0)
 E  I $P(RA70,U,17) D ERR3(RACN) Q
"RTN","RARTE6",47,0)
 ; check if case(s) already have DX codes, staff, resident
"RTN","RARTE6",48,0)
 ; don't use IF ELSE here due to outside calls
"RTN","RARTE6",49,0)
 ;
"RTN","RARTE6",50,0)
 ; Printset cases
"RTN","RARTE6",51,0)
 I RAPRTSET D  Q
"RTN","RARTE6",52,0)
 .S RA1=0
"RTN","RARTE6",53,0)
 .F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE6",54,0)
 ..; check primary
"RTN","RARTE6",55,0)
 ..F RA2=13,15,12 I $P(^RADPT(RADFN,"DT",RADTI,"P",RA1,0),U,RA2)'="" D ERR2(+RAMEMARR(RA1),70.03,RA2)
"RTN","RARTE6",56,0)
 ..; check secondary
"RTN","RARTE6",57,0)
 ..S RAIENS=1_","_RA1_","_RADTI_","_RADFN_","
"RTN","RARTE6",58,0)
 ..F RA2=70.14,70.11,70.09 S RAROOT=$$ROOT^DILFD(RA2,RAIENS) I $O(@(RAROOT_"0)")) D ERR2(+RAMEMARR(RA1),RA2,.01)
"RTN","RARTE6",59,0)
 ..Q
"RTN","RARTE6",60,0)
 .Q
"RTN","RARTE6",61,0)
 ; single case
"RTN","RARTE6",62,0)
 F RA2=13,15,12 I $P(RA70,U,RA2) D ERR2(RACN,70.03,RA2)
"RTN","RARTE6",63,0)
 S RAIENS=1_","_RACNI_","_RADTI_","_RADFN_","
"RTN","RARTE6",64,0)
 F RA2=70.14,70.11,70.09 S RAROOT=$$ROOT^DILFD(RA2,RAIENS) I $O(@(RAROOT_"0)")) D ERR2(RACN,RA2,.01)
"RTN","RARTE6",65,0)
 Q
"RTN","RARTE6",66,0)
ASK1 ; ask if want to restore report
"RTN","RARTE6",67,0)
 ; RAPRVIEN  last Activity Log rec in subfile 74.01
"RTN","RARTE6",68,0)
 ; RAPRVST   previous report status logged in latest activity log rec
"RTN","RARTE6",69,0)
 ; RALAST    last activity log record
"RTN","RARTE6",70,0)
 S RAPRVIEN=$O(^RARPT(RARPT,"L",""),-1)
"RTN","RARTE6",71,0)
 I 'RAPRVIEN D ERR1 Q
"RTN","RARTE6",72,0)
 S RALAST=$G(^RARPT(RARPT,"L",+RAPRVIEN,0))
"RTN","RARTE6",73,0)
 I RALAST="" D ERR1 Q
"RTN","RARTE6",74,0)
 S RAPRVST=$P(RALAST,U,4) ;previous rpt status
"RTN","RARTE6",75,0)
 K DIR
"RTN","RARTE6",76,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RARTE6",77,0)
 S DIR("A")="Do you want to restore this deleted report"
"RTN","RARTE6",78,0)
 S DIR("?")="Answer ""Y"" to assign the previous report status, "_$$GET1^DIQ(74.01,RAPRVIEN_","_RARPT_",",4)_", to this report."
"RTN","RARTE6",79,0)
 D ^DIR K DIR
"RTN","RARTE6",80,0)
 S:$D(DIRUT) RAXIT=1
"RTN","RARTE6",81,0)
 S:'Y RAXIT=1
"RTN","RARTE6",82,0)
 Q
"RTN","RARTE6",83,0)
ASSOC ;
"RTN","RARTE6",84,0)
 ; list case(s) for this report
"RTN","RARTE6",85,0)
 S (Y,RADTE)=+$P(RANODE,U)
"RTN","RARTE6",86,0)
 D D^RAUTL S RADATE=Y
"RTN","RARTE6",87,0)
 D DISPLAY
"RTN","RARTE6",88,0)
 W !
"RTN","RARTE6",89,0)
 K DIR
"RTN","RARTE6",90,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RARTE6",91,0)
 S DIR("A")="Are you sure you want to link this report back to the case"_$S(RAPRTSET:"s",1:"")
"RTN","RARTE6",92,0)
 S DIR("?")="Answer ""Y"" to link this report back to the case(s) shown above."
"RTN","RARTE6",93,0)
 D ^DIR K DIR
"RTN","RARTE6",94,0)
 S:$D(DIRUT) RAXIT=1
"RTN","RARTE6",95,0)
 S:'Y RAXIT=1
"RTN","RARTE6",96,0)
 Q
"RTN","RARTE6",97,0)
RESTORE ; set Report Status to "before delete" value, link to case(s)
"RTN","RARTE6",98,0)
 D SETFF(74,5,RARPT,RAPRVST)
"RTN","RARTE6",99,0)
 W !!?3,"... Restored ",$P(RA74,U,1),"'s report status to: ",$$GET1^DIQ(74,+RARPT,5),"."
"RTN","RARTE6",100,0)
 ;
"RTN","RARTE6",101,0)
 ; set activity log record
"RTN","RARTE6",102,0)
 S RAIENL="+1,"_RARPT_","
"RTN","RARTE6",103,0)
 D SETALOG(RAIENL,"R","")
"RTN","RARTE6",104,0)
 ;
"RTN","RARTE6",105,0)
 ; link report to single case or all cases of a printset
"RTN","RARTE6",106,0)
 I RAPRTSET D
"RTN","RARTE6",107,0)
 . S RA1=""
"RTN","RARTE6",108,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S $P(^RADPT(RADFN,"DT",RADTI,"P",RA1,0),U,17)=RARPT D MSG1(+RAMEMARR(RA1))
"RTN","RARTE6",109,0)
 .Q
"RTN","RARTE6",110,0)
 E  S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,17)=RARPT D MSG1(RACN)
"RTN","RARTE6",111,0)
 ;
"RTN","RARTE6",112,0)
 ;Restore Primary and Secondary DX codes, Staff and Residents
"RTN","RARTE6",113,0)
 F RAFLD=5,7,9 S RAPREV=$P(RALAST,U,RAFLD) D:RAPREV SET70(RAFLD)
"RTN","RARTE6",114,0)
 W !!!?3,"** You need to edit the case"_$S(RAPRTSET:"s",1:"")_" to update the exam status. **"
"RTN","RARTE6",115,0)
 Q
"RTN","RARTE6",116,0)
SET70(X) ; put back previous DX codes, Staff, Residents into case record
"RTN","RARTE6",117,0)
 ; assumes if no primary then no secondaries
"RTN","RARTE6",118,0)
 K RAFDA,RAA
"RTN","RARTE6",119,0)
 N RA1
"RTN","RARTE6",120,0)
 S RAIENS=1_","_RAPRVIEN_","_RARPT_","
"RTN","RARTE6",121,0)
 ;
"RTN","RARTE6",122,0)
 ; X is the field number from subfile 74.01:
"RTN","RARTE6",123,0)
 ; 5 = BEFORE DELETION PRIM. DX CODE
"RTN","RARTE6",124,0)
 ; 7 = BEFORE DELETION PRIM. STAFF
"RTN","RARTE6",125,0)
 ; 9 = BEFORE DELETION PRIM. RESIDENT
"RTN","RARTE6",126,0)
 ;
"RTN","RARTE6",127,0)
 ; RAF1 = subfile number from file 74's activity log
"RTN","RARTE6",128,0)
 ; RAF2 = subfile number from file 70's secondaries
"RTN","RARTE6",129,0)
 ; RAF3 = subfile number pointed to from file 70's secondaries
"RTN","RARTE6",130,0)
 ; RAPIECE = piece in 70.03's 0 node
"RTN","RARTE6",131,0)
 S RAF1=$S(X=5:74.16,X=7:74.18,X=9:74.19,1:"") Q:RAF1=""
"RTN","RARTE6",132,0)
 S RAF2=$S(X=5:70.14,X=7:70.11,X=9:70.09,1:"") Q:RAF2=""
"RTN","RARTE6",133,0)
 S RAF3=$$GET1^DID(RAF2,.01,"","POINTER")
"RTN","RARTE6",134,0)
 ; extract file number from RAF3
"RTN","RARTE6",135,0)
 S RAF3=$TR(RAF3,$TR(RAF3,"0123456789."))
"RTN","RARTE6",136,0)
 ;piece number for Primary DX/Staff/Resident in 70.03
"RTN","RARTE6",137,0)
 S RAPIECE=$S(X=5:13,X=7:15,X=9:12,1:"") Q:RAPIECE=""
"RTN","RARTE6",138,0)
 S RAROOT=$$ROOT^DILFD(RAF1,RAIENS,1) ;closed root under file 74's Activity Log
"RTN","RARTE6",139,0)
 ;copy secondaries into RAA()
"RTN","RARTE6",140,0)
 M RAA=@RAROOT
"RTN","RARTE6",141,0)
 ;
"RTN","RARTE6",142,0)
 G:RAPRTSET PSET
"RTN","RARTE6",143,0)
 ;
"RTN","RARTE6",144,0)
 ; single case
"RTN","RARTE6",145,0)
 ;
"RTN","RARTE6",146,0)
 ; copy Primary into single case
"RTN","RARTE6",147,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",RAPIECE)=RAPREV
"RTN","RARTE6",148,0)
 D FILE^DIE("","RAFDA","RAMSG")
"RTN","RARTE6",149,0)
 I $D(RAMSG("DIERR")) D ERR4(RACN,$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",150,0)
 E  D MSG2(RACN,$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",151,0)
 K RAFDA,RAMSG
"RTN","RARTE6",152,0)
 ;
"RTN","RARTE6",153,0)
 Q:$O(RAA(0))'>0  ; no secondaries
"RTN","RARTE6",154,0)
 ;
"RTN","RARTE6",155,0)
 ;copy secondary items into single case
"RTN","RARTE6",156,0)
 S RA1=0
"RTN","RARTE6",157,0)
 F  S RA1=$O(RAA(RA1)) Q:'RA1  S RAX=$G(RAA(RA1,0)) D:RAX
"RTN","RARTE6",158,0)
 .S RAFDA(RAF2,"+2,"_RACNI_","_RADTI_","_RADFN_",",.01)=RAX
"RTN","RARTE6",159,0)
 .D UPDATE^DIE(,"RAFDA",,"RAMSG")
"RTN","RARTE6",160,0)
 .I $D(RAMSG("DIERR")) D ERR4(RACN,$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",161,0)
 .E  D MSG2(RACN,$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",162,0)
 .K RAFDA,RAMSG
"RTN","RARTE6",163,0)
 .Q
"RTN","RARTE6",164,0)
 Q
"RTN","RARTE6",165,0)
 ;
"RTN","RARTE6",166,0)
 ; cases from printset
"RTN","RARTE6",167,0)
 ;
"RTN","RARTE6",168,0)
PSET ; copy Primary into cases of a printset
"RTN","RARTE6",169,0)
 S RA1=0
"RTN","RARTE6",170,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE6",171,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",RAPIECE)=RAPREV
"RTN","RARTE6",172,0)
 .D FILE^DIE("","RAFDA","RAMSG")
"RTN","RARTE6",173,0)
 .I $D(RAMSG("DIERR")) D ERR4(+RAMEMARR(RA1),$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",174,0)
 .E  D MSG2(+RAMEMARR(RA1),$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",175,0)
 .K RAFDA,RAMSG
"RTN","RARTE6",176,0)
 .Q:$O(RAA(0))'>0  ; no secondary DXs
"RTN","RARTE6",177,0)
 .; copy secondaries into cases of a printset
"RTN","RARTE6",178,0)
 .S RA2=0
"RTN","RARTE6",179,0)
 .F  S RA2=$O(RAA(RA2)) Q:'RA2  S RAX=$G(RAA(RA2,0)) D:RAX
"RTN","RARTE6",180,0)
 ..S RAFDA(RAF2,"+2,"_RA1_","_RADTI_","_RADFN_",",.01)=RAX
"RTN","RARTE6",181,0)
 ..D UPDATE^DIE(,"RAFDA",,"RAMSG")
"RTN","RARTE6",182,0)
 ..I $D(RAMSG("DIERR")) D ERR4(+RAMEMARR(RA1),$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",183,0)
 ..E  D MSG2(+RAMEMARR(RA1),$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",184,0)
 ..K RAFDA,RAMSG
"RTN","RARTE6",185,0)
 ..Q
"RTN","RARTE6",186,0)
 .Q
"RTN","RARTE6",187,0)
 Q
"RTN","RARTE6",188,0)
SETFF(RA1,RA2,RA3,RA4,RA5) ;reset file's field value
"RTN","RARTE6",189,0)
 ;RA1 file number
"RTN","RARTE6",190,0)
 ;RA2 field number
"RTN","RARTE6",191,0)
 ;RA3 IEN in file
"RTN","RARTE6",192,0)
 ;RA4 field value to set in record IEN
"RTN","RARTE6",193,0)
 ;RA5 (optional), set to "E" for external
"RTN","RARTE6",194,0)
 N RAFDA
"RTN","RARTE6",195,0)
 S RAFDA(RA1,RA3_",",RA2)=RA4
"RTN","RARTE6",196,0)
 I $G(RA5)="E" D FILE^DIE("E","RAFDA")
"RTN","RARTE6",197,0)
 E  D FILE^DIE("","RAFDA")
"RTN","RARTE6",198,0)
 Q
"RTN","RARTE6",199,0)
SETALOG(RA1,RA2,RA3) ;set new record in Activity log 74.01
"RTN","RARTE6",200,0)
 ;RA1  ien string, eg., "+1,"_RARPT_","
"RTN","RARTE6",201,0)
 ;RA2  type of action
"RTN","RARTE6",202,0)
 ;RA3  current report status code
"RTN","RARTE6",203,0)
 ;
"RTN","RARTE6",204,0)
 N RAFDA
"RTN","RARTE6",205,0)
 S RAFDA(74.01,RA1,.01)=+$E($$NOW^XLFDT(),1,12)
"RTN","RARTE6",206,0)
 S RAFDA(74.01,RA1,2)=RA2
"RTN","RARTE6",207,0)
 S RAFDA(74.01,RA1,3)=$G(DUZ)
"RTN","RARTE6",208,0)
 S:$G(RA3)]"" RAFDA(74.01,RA1,4)=RA3 ;only del rpt would have data here
"RTN","RARTE6",209,0)
 D UPDATE^DIE(,"RAFDA")
"RTN","RARTE6",210,0)
 Q
"RTN","RARTE6",211,0)
MSG1(X) ;
"RTN","RARTE6",212,0)
 W !?3,"... Linked restored report to case no. ",X
"RTN","RARTE6",213,0)
 Q
"RTN","RARTE6",214,0)
MSG2(X,Y,Z) ;
"RTN","RARTE6",215,0)
 W !?3,"... Restored case ",X,"'s ",Y," to: ",Z
"RTN","RARTE6",216,0)
 Q
"RTN","RARTE6",217,0)
ERR0 ;
"RTN","RARTE6",218,0)
 W !,"Unable to determine case previously associated with this report."
"RTN","RARTE6",219,0)
 S RAXIT=1
"RTN","RARTE6",220,0)
 Q
"RTN","RARTE6",221,0)
ERR1 W !!,"Cannot determine previous report status.",!
"RTN","RARTE6",222,0)
 S RAXIT=1
"RTN","RARTE6",223,0)
 Q
"RTN","RARTE6",224,0)
ERR2(X,Y,Z) ;X=External short case No, Y=File no., Z=Field no.
"RTN","RARTE6",225,0)
 W !,"Case #",X," already has ",$$GET1^DID(Y,Z,"","LABEL")
"RTN","RARTE6",226,0)
 S RAXIT=1
"RTN","RARTE6",227,0)
 Q
"RTN","RARTE6",228,0)
ERR3(X) ;
"RTN","RARTE6",229,0)
 W !,"Case #",X," is already associated with a report!"
"RTN","RARTE6",230,0)
 S RAXIT=1
"RTN","RARTE6",231,0)
 Q
"RTN","RARTE6",232,0)
ERR4(X,Y,Z) ;
"RTN","RARTE6",233,0)
 W !!?3,"Cannot restore case ",X,"'s ",Y," to: ",Z
"RTN","RARTE6",234,0)
 Q
"RTN","RARTE6",235,0)
NOTDONE ;
"RTN","RARTE6",236,0)
 W !!?3,"Restoration was not done."
"RTN","RARTE6",237,0)
 ; continue to clean up
"RTN","RARTE6",238,0)
FINISH ; clean up and exit
"RTN","RARTE6",239,0)
 R !!!,"Press RETURN to exit. ",X:DTIME
"RTN","RARTE6",240,0)
 K DIRUT,I
"RTN","RARTE6",241,0)
 K RA1,RA2,RA3,RA4,RA5,RA18EX,RA70,RA74,RAA,RACMDATA
"RTN","RARTE6",242,0)
 K RACN,RACNI,RADATE,RADFN,RADTE,RADTI,RADUZ,RAFDA,RAF1,RAF2,RAF3
"RTN","RARTE6",243,0)
 K RAI,RAIENL,RAIENS,RAIENSUB,RALAST,RALCKFLG,RAMEMARR,RANME,RANODE
"RTN","RARTE6",244,0)
 K RAOUT,RAPIECE,RAPRC,RAPRTSET,RAPRVIEN,RAPREV,RAPRVST,RAROOT,RARPT
"RTN","RARTE6",245,0)
 K RASSN,RAST,RASUB70,RASUBY0,RAX,RAXIT,X,XY,Y,Z
"RTN","RARTE6",246,0)
 Q
"RTN","RARTE6",247,0)
DISPLAY ; Display exam specific info, edit/enter the report
"RTN","RARTE6",248,0)
 ; adapted from routine RARTE
"RTN","RARTE6",249,0)
 S RA18EX=0 ;P18 for quit if uparrow inside PUTTCOM
"RTN","RARTE6",250,0)
 I '($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))#2) D  D Q1^RARTE5 QUIT
"RTN","RARTE6",251,0)
 . W !!?2,"Case #: ",RACN," for ",RANME S RAXIT=1
"RTN","RARTE6",252,0)
 . W !?2,"Procedure: '",$E(RAPRC,1,45),"' has been deleted"
"RTN","RARTE6",253,0)
 . W !?2,"by another user!",$C(7)
"RTN","RARTE6",254,0)
 . Q
"RTN","RARTE6",255,0)
 ;
"RTN","RARTE6",256,0)
 S RAI="",$P(RAI,"-",80)="" W !,RAI
"RTN","RARTE6",257,0)
 W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN
"RTN","RARTE6",258,0)
 W !?1,"Case No. : ",RACN,?18,"Exm. St: ",$E($P($G(^RA(72,+RAST,0)),"^"),1,12),?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RARTE6",259,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTE6",260,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTE6",261,0)
 D:$L(RACMDATA) CMEDIA^RARTE(RACMDATA)
"RTN","RARTE6",262,0)
 K RACMDATA
"RTN","RARTE6",263,0)
 S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,RACN," Tech.Comment: ",15,70,-1,0) ;P18
"RTN","RARTE6",264,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE6",265,0)
 ;
"RTN","RARTE6",266,0)
 K RAMEMARR D EN2^RAUTL20(.RAMEMARR) ;recalculate RAPRTSET
"RTN","RARTE6",267,0)
 ; if printset, display cases and continue on to display Exam Date
"RTN","RARTE6",268,0)
 I RAPRTSET D
"RTN","RARTE6",269,0)
 . S RA1=""
"RTN","RARTE6",270,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""!(RA18EX=-1)  I RA1'=RACNI D
"RTN","RARTE6",271,0)
 .. W !,?1,"Case No. : ",+RAMEMARR(RA1)
"RTN","RARTE6",272,0)
 .. W:$P(RAMEMARR(RA1),"^",4)]"" ?18,"Exm. St: ",$E($P($G(^RA(72,$P(RAMEMARR(RA1),"^",4),0)),"^"),1,12)
"RTN","RARTE6",273,0)
 .. W ?40,"Procedure   : ",$E($P($G(^RAMIS(71,+$P(RAMEMARR(RA1),"^",2),0)),"^"),1,26)
"RTN","RARTE6",274,0)
 ..;check printset for contrast media; display if CM data exists
"RTN","RARTE6",275,0)
 ..S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RA1)
"RTN","RARTE6",276,0)
 ..D:$L(RACMDATA) CMEDIA^RARTE(RACMDATA)
"RTN","RARTE6",277,0)
 ..K RACMDATA
"RTN","RARTE6",278,0)
 .. S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,+RAMEMARR(RA1)," Tech.Comment: ",15,70,-1,0) Q:RA18EX=-1  ;P18
"RTN","RARTE6",279,0)
 .. Q
"RTN","RARTE6",280,0)
 . Q
"RTN","RARTE6",281,0)
 ;continue display
"RTN","RARTE6",282,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE6",283,0)
 S Y(0)=RASUBY0
"RTN","RARTE6",284,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RARTE6",285,0)
 D GETS^DIQ(70.03,RAIENS,"14;175*","E","RAOUT")
"RTN","RARTE6",286,0)
 W !?1,"Exam Date: ",RADATE,?40,"Technologist: "
"RTN","RARTE6",287,0)
 S RAIENSUB=$O(RAOUT(70.12,0))
"RTN","RARTE6",288,0)
 W:RAIENSUB]"" $E($G(RAOUT(70.12,RAIENSUB,.01,"E")),1,25)
"RTN","RARTE6",289,0)
 W !?40,"Req Phys    : "
"RTN","RARTE6",290,0)
 W $E($G(RAOUT(70.03,RAIENS,14,"E")),1,25)
"RTN","RARTE6",291,0)
 W !,RAI
"RTN","RARTE6",292,0)
 Q
"RTN","RARTE6",293,0)
LOCK(X,Y) ; Lock the data global
"RTN","RARTE6",294,0)
 ; uses var DILOCKTM, code taken from rtn RAUTL12
"RTN","RARTE6",295,0)
 ; 'X' is the global root
"RTN","RARTE6",296,0)
 ; 'Y' is the record number
"RTN","RARTE6",297,0)
 N RALCKFLG,XY
"RTN","RARTE6",298,0)
 S RADUZ=+$G(DUZ),RALCKFLG=0,XY=X_Y
"RTN","RARTE6",299,0)
 L +@(XY_")"):DILOCKTM
"RTN","RARTE6",300,0)
 I '$T S RALCKFLG=1 D
"RTN","RARTE6",301,0)
 . W !?5,"This record is being edited by another user."
"RTN","RARTE6",302,0)
 . W !?5,"Try again later!",$C(7)
"RTN","RARTE6",303,0)
 . Q
"RTN","RARTE6",304,0)
 E  D
"RTN","RARTE6",305,0)
 . S ^TMP("RAD LOCKS",$J,RADUZ,X,Y)=""
"RTN","RARTE6",306,0)
 . Q
"RTN","RARTE6",307,0)
 Q RALCKFLG
"RTN","RARTE6",308,0)
INTRO ;
"RTN","RARTE6",309,0)
 ;; +--------------------------------------------------------+
"RTN","RARTE6",310,0)
 ;; |                                                        |
"RTN","RARTE6",311,0)
 ;; |    This option is for restoring a deleted report.      |
"RTN","RARTE6",312,0)
 ;; |                                                        |
"RTN","RARTE6",313,0)
 ;; +--------------------------------------------------------+
"RTN","RARTE7")
0^5^B23668703^B23239189
"RTN","RARTE7",1,0)
RARTE7 ;HISC/SM continuation - Delete a Report, Outside Rpt misc;10/10/08 16:05
"RTN","RARTE7",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56,95**;Mar 16, 1998;Build 7
"RTN","RARTE7",3,0)
 ;Supported IA #2053 NOW^XLFDT, FILE^DIE, UPDATE^DIE
"RTN","RARTE7",4,0)
 ;Supported IA #2052 GET1^DID
"RTN","RARTE7",5,0)
 ;Supported IA #2055 ROOT^DILFD
"RTN","RARTE7",6,0)
 Q
"RTN","RARTE7",7,0)
MARKDEL ; set field 5 to "X" to mark rpt as deleted
"RTN","RARTE7",8,0)
 ; also update activity log, send report deletion bulletin, store then delete
"RTN","RARTE7",9,0)
 ; associated DX, Staff, Resident data
"RTN","RARTE7",10,0)
 N DA,DIK,RA1,RA2,RAA,RAFDA,RAIEN2,RAIENDX,RAIENL,RACLOAK
"RTN","RARTE7",11,0)
 N RAMEMARR,RAMSG,RAOUT,RAPRTSET,RASAVE,RAX,RA7003
"RTN","RARTE7",12,0)
 N RAF1,RAF2,RAF3,RAIENS
"RTN","RARTE7",13,0)
 ;
"RTN","RARTE7",14,0)
 ;PART 1 - mark report as deleted
"RTN","RARTE7",15,0)
 ;
"RTN","RARTE7",16,0)
 S RASAVE=$P(^RARPT(RAIEN,0),U,5) ;save current rpt status
"RTN","RARTE7",17,0)
 S RAFDA(74,RAIEN_",",5)="X" ;change rpt status
"RTN","RARTE7",18,0)
 D FILE^DIE("","RAFDA")
"RTN","RARTE7",19,0)
 K RAFDA
"RTN","RARTE7",20,0)
 ;
"RTN","RARTE7",21,0)
 ;PART 2 - add new entry to ACTIVITY LOG and store primary data
"RTN","RARTE7",22,0)
 ;
"RTN","RARTE7",23,0)
 S RA7003=^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)
"RTN","RARTE7",24,0)
 S RAIENL="+1,"_RAIEN_","
"RTN","RARTE7",25,0)
 S RAFDA(74.01,RAIENL,.01)=+$E($$NOW^XLFDT(),1,12)
"RTN","RARTE7",26,0)
 S RAFDA(74.01,RAIENL,2)="X"
"RTN","RARTE7",27,0)
 S RAFDA(74.01,RAIENL,3)=$G(DUZ)
"RTN","RARTE7",28,0)
 S RAFDA(74.01,RAIENL,4)=RASAVE ;store before-delete rpt status
"RTN","RARTE7",29,0)
 S RAFDA(74.01,RAIENL,5)=$P(RA7003,U,13) ; store Prim DX code
"RTN","RARTE7",30,0)
 S RAFDA(74.01,RAIENL,7)=$P(RA7003,U,15) ; store Prim Staff
"RTN","RARTE7",31,0)
 S RAFDA(74.01,RAIENL,9)=$P(RA7003,U,12) ; store Prim Resident
"RTN","RARTE7",32,0)
 D UPDATE^DIE(,"RAFDA","RAOUT","RAMSG")
"RTN","RARTE7",33,0)
 W:$D(RAMSG("DIERR")) !!,"Could not update deleted Report's Activity Log."
"RTN","RARTE7",34,0)
 K RAFDA
"RTN","RARTE7",35,0)
 ;
"RTN","RARTE7",36,0)
 ; store Secondary DXs/Staff/Residents under this ACTIVITY LOG
"RTN","RARTE7",37,0)
 ; if printset, no need to store each case's sec DX, they should be same
"RTN","RARTE7",38,0)
 Q:'RAOUT(1)  ;no record set in 74.01
"RTN","RARTE7",39,0)
 S RAIEN2=RAOUT(1)
"RTN","RARTE7",40,0)
 ;
"RTN","RARTE7",41,0)
 ;PART 3 - send report deletion bulletin
"RTN","RARTE7",42,0)
 ;
"RTN","RARTE7",43,0)
 D CLOAK^RABUL3 ; requires RAIEN and RAIEN2
"RTN","RARTE7",44,0)
 ;
"RTN","RARTE7",45,0)
 ;PART 4 - store secondary DX, Staff, Resident data
"RTN","RARTE7",46,0)
 ;
"RTN","RARTE7",47,0)
 ;don't need separate logic for printset for storing identical data
"RTN","RARTE7",48,0)
 F RAFLD=5,7,9 D SET7401(RAFLD)
"RTN","RARTE7",49,0)
 ;
"RTN","RARTE7",50,0)
 ;PART 5 - remove Prim. and Sec.  DX, Staff, Resident from case record
"RTN","RARTE7",51,0)
 ;
"RTN","RARTE7",52,0)
 D EN2^RAUTL20(.RAMEMARR) ; is case part of a printset?
"RTN","RARTE7",53,0)
 G:RAPRTSET PSET
"RTN","RARTE7",54,0)
 ;
"RTN","RARTE7",55,0)
 ; single case
"RTN","RARTE7",56,0)
 ;
"RTN","RARTE7",57,0)
 ; delete primaries
"RTN","RARTE7",58,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",13)="@" ;Prim. DX
"RTN","RARTE7",59,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",15)="@" ;Prim. Staff
"RTN","RARTE7",60,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",12)="@" ;Prim. Resident
"RTN","RARTE7",61,0)
 D FILE^DIE("","RAFDA")
"RTN","RARTE7",62,0)
 K RAFDA
"RTN","RARTE7",63,0)
 ;
"RTN","RARTE7",64,0)
 ; delete secondaries
"RTN","RARTE7",65,0)
 F RASUB=70.14,70.11,70.09 D KILSEC(RASUB,RACNI)
"RTN","RARTE7",66,0)
 Q
"RTN","RARTE7",67,0)
 ;
"RTN","RARTE7",68,0)
 ; cases from printset
"RTN","RARTE7",69,0)
 ;
"RTN","RARTE7",70,0)
PSET ;delete primary and secondary data
"RTN","RARTE7",71,0)
 S RA1=0
"RTN","RARTE7",72,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE7",73,0)
 .; delete primary from 70.03
"RTN","RARTE7",74,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",13)="@" ;Prim. DX
"RTN","RARTE7",75,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",15)="@" ;Prim. Staff
"RTN","RARTE7",76,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",12)="@" ;Prim. Resident
"RTN","RARTE7",77,0)
 .D FILE^DIE("","RAFDA")
"RTN","RARTE7",78,0)
 .K RAFDA
"RTN","RARTE7",79,0)
 .F RASUB=70.14,70.11,70.09 D KILSEC(RASUB,RA1)
"RTN","RARTE7",80,0)
 Q
"RTN","RARTE7",81,0)
KILSEC(RAF2,RAC1) ;kill secondary data
"RTN","RARTE7",82,0)
 ;RAF2 subfile number from file 70's secondaries
"RTN","RARTE7",83,0)
 ;RAC1 ien for subfile 70.03
"RTN","RARTE7",84,0)
 N RAA,RAROOT
"RTN","RARTE7",85,0)
 K DA,DIK
"RTN","RARTE7",86,0)
 S RAIENS=1_","_RAC1_","_RADTI_","_RADFN_","
"RTN","RARTE7",87,0)
 S RAROOT=$$ROOT^DILFD(RAF2,RAIENS,1) ; closed root
"RTN","RARTE7",88,0)
 M RAA=@RAROOT
"RTN","RARTE7",89,0)
 Q:$O(RAA(0))'>0  ;no secondaries
"RTN","RARTE7",90,0)
 D DA^DILF(RAIENS,.DA) ;get the DA array
"RTN","RARTE7",91,0)
 S DIK=$$ROOT^DILFD(RAF2,RAIENS)
"RTN","RARTE7",92,0)
 S RA2=0
"RTN","RARTE7",93,0)
 F  S RA2=$O(RAA(RA2)) Q:'RA2  S DA=RA2 D ^DIK
"RTN","RARTE7",94,0)
 K DIK
"RTN","RARTE7",95,0)
 Q
"RTN","RARTE7",96,0)
SET7401(X) ; use this for DX, Staff, Resident secondaries 
"RTN","RARTE7",97,0)
 ; set activity log's subfiles to store any secondaries
"RTN","RARTE7",98,0)
 K RAFDA,RAMSG,RAA
"RTN","RARTE7",99,0)
 ; X is the Field number from subfile 74.01:
"RTN","RARTE7",100,0)
 ; 5 = BEFORE DELETION PRIM. DX CODE
"RTN","RARTE7",101,0)
 ; 7 = BEFORE DELETION PRIM. STAFF
"RTN","RARTE7",102,0)
 ; 9 = BEFORE DELETION PRIM. RESIDENT
"RTN","RARTE7",103,0)
 ;
"RTN","RARTE7",104,0)
 ; RAF1 = subfile number from file 74's activity log
"RTN","RARTE7",105,0)
 ; RAF2 = subfile number from file 70's secondaries
"RTN","RARTE7",106,0)
 ; RAF3 = subfile number pointed to from file 70's secondaries
"RTN","RARTE7",107,0)
 ;
"RTN","RARTE7",108,0)
 S RAF1=$S(X=5:74.16,X=7:74.18,X=9:74.19,1:"") Q:RAF1=""
"RTN","RARTE7",109,0)
 S RAF2=$S(X=5:70.14,X=7:70.11,X=9:70.09,1:"") Q:RAF2=""
"RTN","RARTE7",110,0)
 S RAIENS=1_","_RACNI_","_RADTI_","_RADFN_","
"RTN","RARTE7",111,0)
 S RAROOT=$$ROOT^DILFD(RAF2,RAIENS,1) ; closed root, file 70's secondaries
"RTN","RARTE7",112,0)
 M RAA=@RAROOT
"RTN","RARTE7",113,0)
 Q:$O(RAA(0))'>0  ; no secondaries
"RTN","RARTE7",114,0)
 ;
"RTN","RARTE7",115,0)
 S RAF3=$$GET1^DID(RAF2,.01,"","POINTER")
"RTN","RARTE7",116,0)
 ; extract file number from RAF3
"RTN","RARTE7",117,0)
 S RAF3=$TR(RAF3,$TR(RAF3,"0123456789."))
"RTN","RARTE7",118,0)
 ;
"RTN","RARTE7",119,0)
 ; store Secondary DXs
"RTN","RARTE7",120,0)
 S RA1=0
"RTN","RARTE7",121,0)
 S RAIENDX="+2,"_RAIEN2_","_RAIEN_","
"RTN","RARTE7",122,0)
 F  S RA1=$O(RAA(RA1)) Q:'RA1  S RAX=$G(RAA(RA1,0)) D:RAX
"RTN","RARTE7",123,0)
 .S RAFDA(RAF1,RAIENDX,.01)=RAX
"RTN","RARTE7",124,0)
 .D UPDATE^DIE(,"RAFDA",,"RAMSG")
"RTN","RARTE7",125,0)
 .W:$D(RAMSG("DIERR")) !!,"Could not store ",$$GET1^DID(RAF2,.01,"","LABEL"),"'s value: ",$$GET1^DIQ(RAF3,RAX,.01)
"RTN","RARTE7",126,0)
 .K RAFDA,RAMSG
"RTN","RARTE7",127,0)
 .Q
"RTN","RARTE7",128,0)
 Q
"RTN","RARTE7",129,0)
ANYDX(ARRAY) ; called from RARTE5
"RTN","RARTE7",130,0)
 ; input ARRAY name to store all DXs for this case
"RTN","RARTE7",131,0)
 ; output:
"RTN","RARTE7",132,0)
 ;  =1 if one or more diag codes
"RTN","RARTE7",133,0)
 ;  =0 if no diag code
"RTN","RARTE7",134,0)
 ;  ARRAY() stores diag codes as merged from case
"RTN","RARTE7",135,0)
 Q:'$D(RADFN)!('$D(RADTI))!('$D(RACNI))
"RTN","RARTE7",136,0)
 K ARRAY
"RTN","RARTE7",137,0)
 M ARRAY=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX") ;Sec Diags
"RTN","RARTE7",138,0)
 S ARRAY(9999,0)=$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13) ;Prim Diag
"RTN","RARTE7",139,0)
 I $O(ARRAY(0)) Q 1
"RTN","RARTE7",140,0)
 Q 0
"RTN","RARTE7",141,0)
 ;
"RTN","RARTE7",142,0)
ALERT ; for Outside Report, ck if new/changed diags require alert
"RTN","RARTE7",143,0)
 ; this is called from RARTE5 each time an outside report is edited
"RTN","RARTE7",144,0)
 Q:'$D(RADFN)!('$D(RADTI))!('$D(RACNI))
"RTN","RARTE7",145,0)
 N RASAVE,RAY3,X
"RTN","RARTE7",146,0)
 ; set RASAVE() for OENOTE^RAUTL00
"RTN","RARTE7",147,0)
 S RASAVE("RADFN")=RADFN,RASAVE("RADTI")=RADTI,RASAVE("RACNI")=RACNI
"RTN","RARTE7",148,0)
 ;
"RTN","RARTE7",149,0)
 N I
"RTN","RARTE7",150,0)
 Q:(RANY1=0)&(RANY2=0)  ;no diags before and after edit
"RTN","RARTE7",151,0)
 S I=0
"RTN","RARTE7",152,0)
 ; loop RAA2 
"RTN","RARTE7",153,0)
 F  S I=$O(RAA2(I)) Q:'I  K:RAA2(I,0)=$G(RAA1(I,0)) RAA2(I,0)
"RTN","RARTE7",154,0)
 Q:'$O(RAA2(0))
"RTN","RARTE7",155,0)
 S RAAB=0
"RTN","RARTE7",156,0)
 S I=0 F  S I=$O(RAA2(I)) Q:'I  D
"RTN","RARTE7",157,0)
 .I $D(^RA(78.3,+RAA2(I,0),0)),($P(^(0),U,4)="y") S RAAB=1
"RTN","RARTE7",158,0)
 .Q
"RTN","RARTE7",159,0)
 Q:'RAAB
"RTN","RARTE7",160,0)
 S RAY3=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTE7",161,0)
 S X=RAY3 ; X is input to OENOTE
"RTN","RARTE7",162,0)
 D OENOTE^RAUTL00
"RTN","RARTE7",163,0)
 Q
"RTN","RARTRPV")
0^7^B30791192^B30787953
"RTN","RARTRPV",1,0)
RARTRPV ;HISC/FPT-Resident Pre-Verify Report ;09/26/08  16:29
"RTN","RARTRPV",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**26,56,95**;Mar 16, 1998;Build 7
"RTN","RARTRPV",3,0)
 ;Supported IA #10104 REPEAT^XLFSTR
"RTN","RARTRPV",4,0)
 ;Supported IA #10035 ^DPT(
"RTN","RARTRPV",5,0)
 ;Supported IA #10060 and 2056 GET1^DIQ of file 200
"RTN","RARTRPV",6,0)
 ;Supported IA #10076 ^XUSEC
"RTN","RARTRPV",7,0)
 N DIERR
"RTN","RARTRPV",8,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTRPV",9,0)
 K RAVER S:$D(^VA(200,DUZ,0)) RAVER=$P(^(0),"^") I '$D(RAVER) W !!,$C(7),"Your name must be defined in the NEW PERSON File to continue." G Q
"RTN","RARTRPV",10,0)
 I '$D(^VA(200,"ARC","R",DUZ)) W !!,$C(7),"You are not classified as a Rad/Nuc Med Interpreting Resident." G Q
"RTN","RARTRPV",11,0)
 S RAINACT=$$GET1^DIQ(200,DUZ_",",53.4,"I") ; grab Inactive Date (if any)
"RTN","RARTRPV",12,0)
 I RAINACT,(RAINACT'>DT) W !!,$C(7),"You are not classified as an active Rad/Nuc Med Interpreting Resident." K RAINACT G Q
"RTN","RARTRPV",13,0)
 K RAINACT S RAONLINE="" W ! D ES^RASIGU G Q:'%
"RTN","RARTRPV",14,0)
 S RARAD=DUZ,RAD="ARES"
"RTN","RARTRPV",15,0)
 ;
"RTN","RARTRPV",16,0)
SRTRPT K RA,RARPTX,^TMP($J,"RA") S (RATOT,RARPT)=0
"RTN","RARTRPV",17,0)
 F  S RARPT=$O(^RARPT(RAD,RARAD,RARPT)) Q:'RARPT  I $D(^RARPT(RARPT,0)) S RARTDT=$S($P(^(0),"^",6)="":9999999.9999,1:$P(^(0),"^",6)) I $P(^RARPT(RARPT,0),U,12)="" D
"RTN","RARTRPV",18,0)
 .Q:$$STUB^RAEDCN1(RARPT)  ;skip stub report 031501
"RTN","RARTRPV",19,0)
 .Q:"^V^EF^X^"[("^"_$P($G(^RARPT(+RARPT,0)),"^",5)_"^")  ;skip if V,EF,X
"RTN","RARTRPV",20,0)
 .S ^TMP($J,"RA","DT",RARTDT,RARPT)=""
"RTN","RARTRPV",21,0)
 .S RATOT=RATOT+1
"RTN","RARTRPV",22,0)
 I 'RATOT W !!,"You have no Unverified Reports." G Q
"RTN","RARTRPV",23,0)
 ;
"RTN","RARTRPV",24,0)
SELRPT S RARD("A")="Do you wish to review "_$S(RATOT=1:"this one report",1:"all "_RATOT_" reports")_"?  ",RARD(1)="Yes^review all reports",RARD(2)="No^choose which reports to review",RARD("B")=1,RARD(0)="S"
"RTN","RARTRPV",25,0)
 D SET^RARD K RARD S X=$E(X) G Q:X["^"!(X="N"&(RATOT=1)),RPTLP:X="Y" D ^RARTVER1 G Q:$D(RAOUT)!('$D(RARPTX))
"RTN","RARTRPV",26,0)
 ;
"RTN","RARTRPV",27,0)
RPTLP S DIR(0)="S^P:PAGE AT A TIME;E:ENTIRE REPORT",DIR("B")="P",DIR("A")="How would you like to view the reports?"
"RTN","RARTRPV",28,0)
 S DIR("?",1)="If you would like to pause after each page of the report enter 'P'.",DIR("?")="Otherwise enter 'E' to view an entire report at one time."
"RTN","RARTRPV",29,0)
 D ^DIR K DIR G Q:$D(DIRUT) I Y="E" S RARTVERF=1
"RTN","RARTRPV",30,0)
 I $D(^TMP($J,"RA","DT")) S RARPT=0 F RARTDT=0:0 S RARTDT=$O(^TMP($J,"RA","DT",RARTDT)) Q:'RARTDT  S RARDX="" D GETRPT Q:RARDX="^"
"RTN","RARTRPV",31,0)
 I $D(^TMP($J,"RA","XREF")) S (RPTX,RARPT)=0 D GETRPT
"RTN","RARTRPV",32,0)
 ;
"RTN","RARTRPV",33,0)
Q K %,%DT,%W,%Y1,DA,DGO,DI,DIC,DIWF,DIWR,I,OREND,POP,RA,RACN,RACNI,RACS,RACT,RAD,RADATE,RADFN,RADIV,RADTE,RADTI,RADUP,RADUZ,RAERR,RAFLG,RAIMGTYJ,RAJ1,RAPRIT,RANM,RANME,RANUM,RAONLINE,RAOR,RAOUT,RAPRC,RARAD,RARDX,RARPDT,RARPT
"RTN","RARTRPV",34,0)
 K RARPTX,RARTDT,RARTVER,RARTVERF,RASET,RASIG,RASN,RASTI,RATOT,RAVER,RAVNB,RAXIT,RAXX,RPTX,X,Y,^TMP($J,"RA")
"RTN","RARTRPV",35,0)
 K %X,D,D0,D1,DDER,DDH,DLAYGO
"RTN","RARTRPV",36,0)
 K C,DIRUT,DUOUT,HLN,HLRESLT,HLSAN,J,RADFLDS,RAPRTSET,X1
"RTN","RARTRPV",37,0)
 Q
"RTN","RARTRPV",38,0)
 ;
"RTN","RARTRPV",39,0)
GETRPT I $G(RARPT) L -^RARPT(RARPT)
"RTN","RARTRPV",40,0)
 S:$D(^TMP($J,"RA","XREF")) RPTX=RPTX+1 S RARPT=$S($D(^TMP($J,"RA","DT")):$O(^TMP($J,"RA","DT",RARTDT,RARPT)),$D(^TMP($J,"RA","XREF")):+$G(RARPTX(RPTX)),1:0) Q:'RARPT  L +^RARPT(RARPT):2 G:'$T LOCK G:$P($G(^RARPT(RARPT,0)),U,5)="V" VER
"RTN","RARTRPV",41,0)
 D DISRPT
"RTN","RARTRPV",42,0)
 I RAIMGTYJ']"" D  Q
"RTN","RARTRPV",43,0)
 . I $G(RARPT) L -^RARPT(RARPT)
"RTN","RARTRPV",44,0)
 . Q
"RTN","RARTRPV",45,0)
ASK W !,$$REPEAT^XLFSTR("=",80)
"RTN","RARTRPV",46,0)
 S RARD(1)="Print^print this report for editing",RARD(2)="Edit^edit this report",RARD(3)="Top^display the report from the beginning",RARD(4)="Continue^continue normal processing"
"RTN","RARTRPV",47,0)
 S RARD(5)="Status & Print^edit Status, then print report",RARD("B")=4,RARD(0)="S"
"RTN","RARTRPV",48,0)
 D SET^RARD K RARD S RARDX=$E(X) I RARDX="^" L -^RARPT(RARPT) Q
"RTN","RARTRPV",49,0)
 I "PT"[RARDX D PRTRPT:RARDX="P",DISRPT:RARDX="T" G ASK
"RTN","RARTRPV",50,0)
 I RARDX="E" D EDTCHK I RARDX="E" D  G ASK
"RTN","RARTRPV",51,0)
 .W !!,"EDITING REPORT",!,"--------------",!
"RTN","RARTRPV",52,0)
 .D EDTRPT^RARTRPV1
"RTN","RARTRPV",53,0)
 .D:RACT'="V" UP1^RAUTL1
"RTN","RARTRPV",54,0)
 .I $D(DTOUT) K ^TMP($J,"RA")
"RTN","RARTRPV",55,0)
 .Q
"RTN","RARTRPV",56,0)
 G NOEDIT^RARTRPV1 ;pre-verify report, no report text edit
"RTN","RARTRPV",57,0)
 ;
"RTN","RARTRPV",58,0)
DISRPT S (RAIMGTYJ,RARTVER)="" D RASET Q:'Y!(RAIMGTYJ']"")  D DISP^RART1 K RARTVER
"RTN","RARTRPV",59,0)
 Q
"RTN","RARTRPV",60,0)
PRTRPT D SAVE^RARTVER2
"RTN","RARTRPV",61,0)
 S ION=$P(RAMLC,"^",10),IOP=$S(ION]"":"Q;"_ION,1:"Q")
"RTN","RARTRPV",62,0)
 S RAMES="W !!,""Report has been queued for printing on device "",ION,"".""" D Q^RARTR
"RTN","RARTRPV",63,0)
 D RESTORE^RARTVER2
"RTN","RARTRPV",64,0)
 Q
"RTN","RARTRPV",65,0)
 ;
"RTN","RARTRPV",66,0)
RASET S Y=RARPT D RASET^RAUTL2 Q:'Y
"RTN","RARTRPV",67,0)
 S Y(0)=Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RARTRPV",68,0)
 S RAPRC=$S($D(^RAMIS(71,+$P(Y(0),"^",2),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RARTRPV",69,0)
 S RAIMGTYJ=$$IMGTY^RAUTL12("e",RADFN,RADTI)
"RTN","RARTRPV",70,0)
 I RAIMGTYJ']"" D
"RTN","RARTRPV",71,0)
 . W !?5,"Imaging Type data appears to be missing for this exam.",$C(7)
"RTN","RARTRPV",72,0)
 . Q
"RTN","RARTRPV",73,0)
 Q
"RTN","RARTRPV",74,0)
LOCK S RACN=+$P(^RARPT(RARPT,0),"^",4)
"RTN","RARTRPV",75,0)
 W !!,$C(7),"Another user is editing this report",$S($G(RACN)]"":" (Case # "_RACN_")",1:""),".  Please try again later." H 4 K RACN G GETRPT
"RTN","RARTRPV",76,0)
 Q
"RTN","RARTRPV",77,0)
VER ; report was verified since tmp global was built
"RTN","RARTRPV",78,0)
 S RACN=$G(^RARPT(RARPT,0))
"RTN","RARTRPV",79,0)
 S RACN("CASE")=+$P(RACN,U,4)
"RTN","RARTRPV",80,0)
 S RACN("PAT")=+$P(RACN,U,2)
"RTN","RARTRPV",81,0)
 S RACN("VER")=+$P(RACN,U,9)
"RTN","RARTRPV",82,0)
 W !!,$C(7),$$GET1^DIQ(200,+RACN("VER")_",",.01)_" verified report for "_$P(^DPT(RACN("PAT"),0),U)
"RTN","RARTRPV",83,0)
 W !,"(Case # "_RACN("CASE")_") since you began this option."
"RTN","RARTRPV",84,0)
 H 4 K RACN G GETRPT
"RTN","RARTRPV",85,0)
 Q
"RTN","RARTRPV",86,0)
EDTCHK ; is user permitted to edit report
"RTN","RARTRPV",87,0)
 S RASTATUS=+$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",3)
"RTN","RARTRPV",88,0)
 I $P($G(^RA(72,RASTATUS,0)),"^",3)>0 K RASTATUS Q
"RTN","RARTRPV",89,0)
 K RASTATUS
"RTN","RARTRPV",90,0)
 I $D(^XUSEC("RA MGR",DUZ)) Q
"RTN","RARTRPV",91,0)
 I $P(RAMDV,"^",22)=1 Q
"RTN","RARTRPV",92,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!!
"RTN","RARTRPV",93,0)
 S RARDX="C" ;Reset RARDX so user can only verify.
"RTN","RARTRPV",94,0)
 Q
"RTN","RARTVER")
0^6^B44145725^B44139865
"RTN","RARTVER",1,0)
RARTVER ;HISC/FPT,CAH AISC/MJK,RMO-On-line Verify Reports ;09/24/08  10:27
"RTN","RARTVER",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,23,26,82,56,95**;Mar 16, 1998;Build 7
"RTN","RARTVER",3,0)
 ;Supported IA #10035 ^DPT(
"RTN","RARTVER",4,0)
 ;Supported IA #10060 ^VA(200
"RTN","RARTVER",5,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTVER",6,0)
 N RAVFIED,RAXIT S RAXIT=0
"RTN","RARTVER",7,0)
 K RAVER S:$D(^VA(200,DUZ,0)) RAVER=$P(^(0),"^") I '$D(RAVER) W !!,$C(7),"Your name must be defined in the NEW PERSON File to continue." G Q
"RTN","RARTVER",8,0)
 I '$D(^VA(200,"ARC","R",DUZ)),'$D(^VA(200,"ARC","S",DUZ)) W !!,$C(7),"This option is only available for Rad/Nuc Med Interpreting Physicians." G Q
"RTN","RARTVER",9,0)
 I '$$CHKUSR^RAO7UTL(DUZ) D ERR^RARTVER2(DUZ) D Q QUIT
"RTN","RARTVER",10,0)
 I $D(^VA(200,"ARC","S",DUZ)) S RASTAFF=1 G 1
"RTN","RARTVER",11,0)
 I $P(RAMDV,"^",18)'=1 W !!,$C(7),"Interpreting Residents are not allowed to verify reports.",!! G Q
"RTN","RARTVER",12,0)
1 S RAONLINE="" W ! D ES^RASIGU G Q:'%
"RTN","RARTVER",13,0)
 I $D(RASTAFF),$P($G(^VA(200,DUZ,"RA")),U,2)'="y" S RARAD=DUZ,RAD="ASTF",RARESFLG="" G SRTRPT ;selected USER does NOT have ALLOW VERIFYING OF OTHERS
"RTN","RARTVER",14,0)
 I '$D(^VA(200,"ARC","S",DUZ)),$S('$P(RAMDV,"^",18):1,'$D(^VA(200,"ARC","R",DUZ)):1,'$D(^VA(200,DUZ,"RA")):1,$P(^VA(200,DUZ,"RA"),"^",2)'="y":1,1:0) S RARAD=DUZ,RAD="ARES",RARESFLG="" G SRTRPT
"RTN","RARTVER",15,0)
ASKRAD W ! S DIC("B")=RAVER,DIC("S")="I $D(^VA(200,""ARC"",""R"",Y))!($D(^VA(200,""ARC"",""S"",Y)))",DIC("A")="Select Interpreting Physician: ",DIC="^VA(200,",DIC(0)="AEMQ" D ^DIC K DIC G Q:Y<0 S RARAD=+Y
"RTN","RARTVER",16,0)
 S RAD=$S($D(^VA(200,"ARC","R",RARAD)):"ARES",1:"ASTF")
"RTN","RARTVER",17,0)
 ;
"RTN","RARTVER",18,0)
SRTRPT K ^TMP($J,"RA"),RA,RARPTX
"RTN","RARTVER",19,0)
 S RARADHLD=RARAD,RATOT=0,RARPT=0
"RTN","RARTVER",20,0)
 ;tmp($j,"ra","dt",-,-) =
"RTN","RARTVER",21,0)
 ;^rpt status at start of selection^/long CN^Pat.ien^Proc.ien
"RTN","RARTVER",22,0)
 F  S RARPT=$O(^RARPT(RAD,RARAD,RARPT)) Q:'RARPT  I $D(^RARPT(RARPT,0)) S RARTDT=$S($P(^(0),"^",6)="":9999999.9999,1:$P(^(0),"^",6)) D
"RTN","RARTVER",23,0)
 .Q:$$STUB^RAEDCN1(RARPT)  ;skip stub report 081500
"RTN","RARTVER",24,0)
 .Q:"^V^EF^X^"[("^"_$P($G(^RARPT(+RARPT,0)),"^",5)_"^")  ;skip V,EF,X
"RTN","RARTVER",25,0)
 .S Y=RARPT D RASET^RAUTL2 ;returns Y=radpt(radfn,"dt",radti,"p",-,0)
"RTN","RARTVER",26,0)
 .Q:'Y  ;record must be corrupt no zero node for ADC x-ref!!
"RTN","RARTVER",27,0)
 .S ^TMP($J,"RA","DT",RARTDT,RARPT)="^"_$P($G(^RARPT(+RARPT,0)),"^",5)_"^/"_$P(^(0),"^",1,2)_"^"_+$P(Y,U,2)
"RTN","RARTVER",28,0)
 .S RATOT=RATOT+1
"RTN","RARTVER",29,0)
 .Q
"RTN","RARTVER",30,0)
 I 'RATOT S RANM=$S($D(^VA(200,RARAD,0)):$P(^(0),"^"),1:"UNKNOWN"),RANM=$S(RANM=RAVER:"You have",1:"Interpreting Physician "_RANM_" has") W !!,RANM," no Unverified Reports." G Q:$D(RARESFLG),ASKRAD
"RTN","RARTVER",31,0)
 N RATOTORI S RATOTORI=RATOT ; save original value of RATOT
"RTN","RARTVER",32,0)
 ;
"RTN","RARTVER",33,0)
SELRPT I RATOT=1 D ONERPT^RARTVER1 G:'$D(^TMP($J,"RA")) Q S RACHOICE=5,RACHOICE("1RPT")="" G RPTLP
"RTN","RARTVER",34,0)
 D TALLY^RARTVER1,SELRPT^RARTVER1 G Q:Y=0 S RACHOICE=+Y
"RTN","RARTVER",35,0)
 I Y=1 D PV^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",36,0)
 I Y=2 S RASTATUS="R" D DPDRNV^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",37,0)
 I Y=3 S RASTATUS="D" D DPDRNV^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",38,0)
 I Y=4 S RASTATUS="PD" D DPDRNV^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",39,0)
 I Y=5 G RPTLP
"RTN","RARTVER",40,0)
 I Y=7 D STAT^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",41,0)
 ; if none of the above, then defaults to Y=6 SELECTED 
"RTN","RARTVER",42,0)
 S RASTATFG="" D ^RARTVER1 K RASTATFG G Q:$D(RAOUT)!('$D(RARPTX))
"RTN","RARTVER",43,0)
 ;
"RTN","RARTVER",44,0)
RPTLP S DIR(0)="S^P:PAGE AT A TIME;E:ENTIRE REPORT",DIR("B")="P",DIR("A")="How would you like to view the reports?"
"RTN","RARTVER",45,0)
 S DIR("?",1)="If you would like to pause after each page of the report enter 'P'.",DIR("?")="Otherwise enter 'E' to view an entire report at one time."
"RTN","RARTVER",46,0)
 D ^DIR K DIR G Q:$D(DIRUT) I Y="E" S RARTVERF=1
"RTN","RARTVER",47,0)
 S RACHOICE("NAME")=$S(RACHOICE=6:"SELECTED",RACHOICE=5:"ALL",RACHOICE=4:"PROBLEM DRAFT",RACHOICE=3:"DRAFT",RACHOICE=2:"RELEASED/NOT VERIFIED",1:"PREVERIFIED")
"RTN","RARTVER",48,0)
RPTLP1 I $D(^TMP($J,"RA","DT")) S RARPT=0,RARTDT=0 F  S RARTDT=$O(^TMP($J,"RA","DT",RARTDT)) Q:'RARTDT  S RARDX="" D GETRPT Q:RARDX="^"  I $D(RARLTV),$G(RARLTV)=0 D ADDLRPT^RARTVER2 Q:RATOT=0  S RARLTV=RATOT G RPTLP1
"RTN","RARTVER",49,0)
 I $D(^TMP($J,"RA","XREF")) S (RPTX,RARPT)=0 D GETRPT
"RTN","RARTVER",50,0)
 ; RARESFLG  is used to flag that  VERIFYING OF OTHERS  is allowed
"RTN","RARTVER",51,0)
 ; Before looping back, RARESFLG is set, so that if there are no reports,
"RTN","RARTVER",52,0)
 ; the logic will goto Q instead of to ASKRAD
"RTN","RARTVER",53,0)
 I RATOTORI>1 S RARAD=RARADHLD,RARESFLG="" K RARLTV,RARTVERF G SRTRPT ; go another round
"RTN","RARTVER",54,0)
 ; also dis-allow re-asking another USER when all reports
"RTN","RARTVER",55,0)
 ; become verified by current USER
"RTN","RARTVER",56,0)
 ;
"RTN","RARTVER",57,0)
Q D CU^RARTVER2
"RTN","RARTVER",58,0)
 Q
"RTN","RARTVER",59,0)
 ;
"RTN","RARTVER",60,0)
GETRPT I $G(RARPT) L -^RARPT(RARPT)
"RTN","RARTVER",61,0)
 S:$D(^TMP($J,"RA","XREF")) RPTX=RPTX+1 S RARPT=$S($D(^TMP($J,"RA","DT")):$O(^TMP($J,"RA","DT",RARTDT,RARPT)),$D(^TMP($J,"RA","XREF")):+$G(RARPTX(RPTX)),1:0) Q:'RARPT
"RTN","RARTVER",62,0)
 I $D(^TMP($J,"RA","DT")) G:$P(^TMP($J,"RA","DT",RARTDT,RARPT),"^")="V" GETRPT S $P(^TMP($J,"RA","DT",RARTDT,RARPT),"^")="V" ;here, V = viewed already
"RTN","RARTVER",63,0)
 I '$D(^RARPT(RARPT)) D MSG1 G GETRPT ;rpt disappeared
"RTN","RARTVER",64,0)
 L +^RARPT(RARPT):2 I '$T G LOCK^RARTVER2
"RTN","RARTVER",65,0)
 S RAXIT=0 D DISRPT^RARTVER2 I $G(X)="^" S RARDX="^" Q  ;display whole report
"RTN","RARTVER",66,0)
 I +$G(RAVFIED) S RAVFIED=0 G GETRPT
"RTN","RARTVER",67,0)
 N RASTBEF S RASTBEF=$S($D(^TMP($J,"RA","DT",+$G(RARTDT),+$G(RARPT))):$P(^(RARPT),"^",2),$D(^TMP($J,"RA","XREF")):$P($G(RARPTX(RPTX)),U,2),1:"")
"RTN","RARTVER",68,0)
ASK Q:RAXIT  W ! S I="",$P(I,"=",80)="" W I K I
"RTN","RARTVER",69,0)
 I "12345"[$E(RACHOICE) D:'$D(RARLTVFL) RLTV^RARTVER1 D:$D(RARLTVFL) RLTV1^RARTVER1
"RTN","RARTVER",70,0)
 S RARD("A")="",RARD(1)="Print^print this report for editing",RARD(2)="Edit^edit this report",RARD(3)="Top^display the report from the beginning",RARD(4)="continue^continue normal processing"
"RTN","RARTVER",71,0)
 S RARD(5)="Status & Print^edit Status, then print report",RARD(0)="S",RARD("B")=4
"RTN","RARTVER",72,0)
 S:$G(RARLTV) RARLTV=RARLTV-1
"RTN","RARTVER",73,0)
 I $G(RARLTV)>0 S RARD("A")="("_$G(RARLTV)_" left to review) "
"RTN","RARTVER",74,0)
 I $G(RARLTV)=0 I '$D(RACHOICE("1RPT")) S RARD("A")="(No more "_RACHOICE("NAME")_") " S:RACHOICE=5 RARD("A")="(ALL gone) "
"RTN","RARTVER",75,0)
 S RARD("A")=RARD("A")_"Type '?' for action list, 'Enter' to " ;12/30/96
"RTN","RARTVER",76,0)
 I RASTBEF'=$P(^RARPT(RARPT,0),U,5) D MSG2
"RTN","RARTVER",77,0)
 D SET^RARD K RARD S RARDX=$E(X) I RARDX="^" L -^RARPT(RARPT) Q
"RTN","RARTVER",78,0)
 ; if user chose "T"op, the report will be displayed again from the top
"RTN","RARTVER",79,0)
 I "PT"[RARDX D PRTRPT^RARTVER2:RARDX="P",DISRPT^RARTVER2:RARDX="T" G ASK
"RTN","RARTVER",80,0)
 I RARDX="E" D EDTCHK^RARTVER2 I RARDX="E" W !!,"EDITING REPORT",!,"--------------",! D EDTRPT^RARTE1 D  K RAAB G ASK
"RTN","RARTVER",81,0)
 .; RAHLTCPB flag is inactive
"RTN","RARTVER",82,0)
 .N RAHLTCPB S RAHLTCPB=1 D:RACT="V" UPSTAT^RAUTL0 D:RACT'="V" UP1^RAUTL1
"RTN","RARTVER",83,0)
 S RAPGM="GETRPT^RARTVER" G 31^RART ;goto Verify Report Only template
"RTN","RARTVER",84,0)
 ;
"RTN","RARTVER",85,0)
MSG1 N I,J1,J2,J3 S I=$S($D(^TMP($J,"RA","DT",+$G(RARTDT),+$G(RARPT))):^(RARPT),$D(^TMP($J,"RA","XREF")):$G(RARPTX(RPTX)),1:"")
"RTN","RARTVER",86,0)
 S J1=$P(I,"/",2),J2=$P(J1,"^",2),J3=$P(J1,"^",3),J1=$P(J1,"^")
"RTN","RARTVER",87,0)
 W !!!?15,$C(7),"Since the time you selected this group of reports,",!?15,"another user has deleted this report for",!?15,$P($G(^DPT(J2,0)),"^"),"   case ",J1,!?15,"Procedure ",$P($G(^RAMIS(71,+J3,0)),U),".",!! G CONT Q
"RTN","RARTVER",88,0)
MSG2 N I,J S I=";"_$P(^RARPT(RARPT,0),"^",5)_":"
"RTN","RARTVER",89,0)
 S J=";"_$P(^DD(74,5,0),U,3)
"RTN","RARTVER",90,0)
 W !!!?15,$C(7),"Since the time you selected this group of reports,",!?15,"another user has changed this report's status to '",$P($P(J,I,2),";"),"'.",!! Q
"RTN","RARTVER",91,0)
CONT W !! S DIR(0)="FO",DIR("A")="Press return key to continue " D ^DIR
"RTN","RARTVER",92,0)
 Q
"VER")
8.0^22.0
"^DD",74,74,5,0)
REPORT STATUS^RSX^V:VERIFIED;R:RELEASED/NOT VERIFIED;PD:PROBLEM DRAFT;D:DRAFT;EF:ELECTRONICALLY FILED;X:DELETED;^0;5^D EN1^RAUTL4
"^DD",74,74,5,.1)
STATUS OF THIS REPORT
"^DD",74,74,5,1,0)
^.1
"^DD",74,74,5,1,1,0)
74^ABLTN1^MUMPS
"^DD",74,74,5,1,1,1)
Q
"^DD",74,74,5,1,1,2)
D ^RABUL2 Q
"^DD",74,74,5,1,1,3)
Do not delete.
"^DD",74,74,5,1,1,"%D",0)
^^2^2^2940204^
"^DD",74,74,5,1,1,"%D",1,0)
     Send a bulletin to the RADIOLOGY REPORT UNVERIFIED mail group if the
"^DD",74,74,5,1,1,"%D",2,0)
status of a report is changed from 'Verified'.
"^DD",74,74,5,1,1,"DT")
2940204
"^DD",74,74,5,1,2,0)
74^ARES^MUMPS
"^DD",74,74,5,1,2,1)
N RAXREF K RAKILL I X'="V"&(X'="X") S RAXREF="ARES",RARAD=12,RASET="" D XREF^RAUTL2 S RASECOND="SRR" D SECXREF^RADD1 K RARAD,RASET
"^DD",74,74,5,1,2,2)
N RAXREF K RASET S RAXREF="ARES",RARAD=12,RAKILL="" D XREF^RAUTL2 S RASECOND="SRR" D SECXREF^RADD1 K RAKILL,RARAD
"^DD",74,74,5,1,2,"%D",0)
^.101^3^3^3090109^^^^
"^DD",74,74,5,1,2,"%D",1,0)
Used to generate a list of unverified reports by resident responsible
"^DD",74,74,5,1,2,"%D",2,0)
for the reports.  Do not set this xref if the report is Verified (V) or 
"^DD",74,74,5,1,2,"%D",3,0)
marked Deleted (X).
"^DD",74,74,5,1,2,"DT")
3081010
"^DD",74,74,5,1,3,0)
74^ASTF^MUMPS
"^DD",74,74,5,1,3,1)
N RAXREF K RAKILL I X'="V"&(X'="X") S RAXREF="ASTF",RARAD=15,RASET="" D XREF^RAUTL2 S RASECOND="SSR" D SECXREF^RADD1 K RARAD,RASEC
"^DD",74,74,5,1,3,2)
N RAXREF K RASET S RAXREF="ASTF",RARAD=15,RAKILL="" D XREF^RAUTL2 S RASECOND="SSR" D SECXREF^RADD1 K RAKILL,RARAD
"^DD",74,74,5,1,3,"%D",0)
^.101^3^3^3090109^^
"^DD",74,74,5,1,3,"%D",1,0)
Used to generate a list of unverified reports by the interpreting staff
"^DD",74,74,5,1,3,"%D",2,0)
responsible for the reports. Do not set this xref if the report is 
"^DD",74,74,5,1,3,"%D",3,0)
Verified (V) or marked Deleted (X).
"^DD",74,74,5,1,3,"DT")
3081010
"^DD",74,74,5,1,4,0)
74^ASTAT^MUMPS
"^DD",74,74,5,1,4,1)
S:"Vv"'[$E(X) ^RARPT("ASTAT",$E(X,1,30),DA)=""
"^DD",74,74,5,1,4,2)
K ^RARPT("ASTAT",$E(X,1,30),DA)
"^DD",74,74,5,1,4,3)
Needed for the Unverified Report.
"^DD",74,74,5,1,4,"%D",0)
^^2^2^2941116^
"^DD",74,74,5,1,4,"%D",1,0)
This cross reference will be used to track the status of non-verified
"^DD",74,74,5,1,4,"%D",2,0)
reports for the Unverified Report.
"^DD",74,74,5,1,4,"DT")
2941116
"^DD",74,74,5,3)
Enter the status of this report.
"^DD",74,74,5,10)
SYSTEM GENERATED
"^DD",74,74,5,21,0)
^.001^29^29^3081010^^
"^DD",74,74,5,21,1,0)
This field contains a value to indicate the status of this report.  Valid
"^DD",74,74,5,21,2,0)
choices are: 'V' for Verified, 'R' for Released/Not Verified, 'PD' for
"^DD",74,74,5,21,3,0)
Problem Draft, 'D' for Draft, 'EF' for Electronically Filed and 'X' for
"^DD",74,74,5,21,4,0)
Deleted.
"^DD",74,74,5,21,5,0)
 
"^DD",74,74,5,21,6,0)
'V' (Verified) status refers to a report that is verified by the 
"^DD",74,74,5,21,7,0)
interpreting physician and is available for display outside the Rad/Nuc 
"^DD",74,74,5,21,8,0)
Med Department to appropriate users, such as ward clerks, nurses, and 
"^DD",74,74,5,21,9,0)
physicians.
"^DD",74,74,5,21,10,0)
 
"^DD",74,74,5,21,11,0)
'R' (Released/Not Verified) status refers to a report that is not 
"^DD",74,74,5,21,12,0)
verified by the interpreting physician and is available for display 
"^DD",74,74,5,21,13,0)
outside the Rad/Nuc Med Department.  The 'R' status is allowed only when 
"^DD",74,74,5,21,14,0)
the parameter that controls this feature, 'Allow Released/Unverified' of 
"^DD",74,74,5,21,15,0)
the 'RAD/NUC MED DIVISION' file (#79), is set to 'Yes'.  Use the 'Display 
"^DD",74,74,5,21,16,0)
Report' option to view reports with the 'R' status.
"^DD",74,74,5,21,17,0)
 
"^DD",74,74,5,21,18,0)
'D' (Draft) status or 'PD' (Problem Draft) status refers to a report that 
"^DD",74,74,5,21,19,0)
is available only for display in the Rad/Nuc Med Department.  A statement 
"^DD",74,74,5,21,20,0)
describing the problem to the interpreting physician is printed at the 
"^DD",74,74,5,21,21,0)
end of reports with the 'PD' status.
"^DD",74,74,5,21,22,0)
 
"^DD",74,74,5,21,23,0)
'EF' (Electronically Filed) status refers to a report that is interpreted 
"^DD",74,74,5,21,24,0)
outside the Rad/Nuc Med Department.  The content is not the actual 
"^DD",74,74,5,21,25,0)
interpreted report, but canned text referring to the outside interpreted 
"^DD",74,74,5,21,26,0)
report.
"^DD",74,74,5,21,27,0)
 
"^DD",74,74,5,21,28,0)
'X' (Deleted) status refers to a report that is deleted from a case, but 
"^DD",74,74,5,21,29,0)
remains in the database though not selectable from any Radiology options.
"^DD",74,74,5,23,0)
^.001^9^9^3081010^^
"^DD",74,74,5,23,1,0)
     The 'RAD/NUC MED REPORT UNVERIFIED' bulletin uses a variable called
"^DD",74,74,5,23,2,0)
RASTATX.  This variable is one character in length.  Some of the codes are
"^DD",74,74,5,23,3,0)
greater than one character in length, i.e, 'PD'.  In this case, the 
"^DD",74,74,5,23,4,0)
routine RAUTL9 must resolve variable RASTATX to its full internal
"^DD",74,74,5,23,5,0)
format.  If sets of codes are added to the data dictionary which are
"^DD",74,74,5,23,6,0)
longer than one character in length, then routine RAUTL9 should be
"^DD",74,74,5,23,7,0)
modified to reflect these changes if the new code is processed by this
"^DD",74,74,5,23,8,0)
routine.  The new 'EF' added by patch RA*5*56 is not used by routine
"^DD",74,74,5,23,9,0)
RAUTL9, so routine RAUTL9 does not have to be modified.
"^DD",74,74,5,"DT")
3081010
"BLD",7066,6)
^85
**END**
**END**
