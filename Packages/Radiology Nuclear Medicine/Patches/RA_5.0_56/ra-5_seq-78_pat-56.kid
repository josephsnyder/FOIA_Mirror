Released RA*5*56 SEQ #78
Extracted from mail message
**KIDS**:RA*5.0*56^

**INSTALL NAME**
RA*5.0*56
"BLD",6859,0)
RA*5.0*56^RADIOLOGY/NUCLEAR MEDICINE^0^3080611^y
"BLD",6859,1,0)
^^2^2^3080404^^^^
"BLD",6859,1,1,0)
Please see the description in FORUM's national patch module for this 
"BLD",6859,1,2,0)
patch.
"BLD",6859,4,0)
^9.64PA^74^1
"BLD",6859,4,74,0)
74
"BLD",6859,4,74,2,0)
^9.641^74.19^5
"BLD",6859,4,74,2,74,0)
RAD/NUC MED REPORTS  (File-top level)
"BLD",6859,4,74,2,74,1,0)
^9.6411^.01^3
"BLD",6859,4,74,2,74,1,.01,0)
DAY-CASE#
"BLD",6859,4,74,2,74,1,5,0)
REPORT STATUS
"BLD",6859,4,74,2,74,1,18,0)
DATE INITIAL OUTSIDE RPT ENTRY
"BLD",6859,4,74,2,74.01,0)
ACTIVITY LOG  (sub-file)
"BLD",6859,4,74,2,74.01,1,0)
^9.6411^.01^6
"BLD",6859,4,74,2,74.01,1,.01,0)
LOG DATE
"BLD",6859,4,74,2,74.01,1,2,0)
TYPE OF ACTION
"BLD",6859,4,74,2,74.01,1,4,0)
BEFORE DELETION REPORT STATUS
"BLD",6859,4,74,2,74.01,1,5,0)
BEFORE DELETION PRIM. DX CODE
"BLD",6859,4,74,2,74.01,1,7,0)
BEFORE DELETION PRIM. STAFF
"BLD",6859,4,74,2,74.01,1,9,0)
BEFORE DELETION PRIM. RESIDENT
"BLD",6859,4,74,2,74.16,0)
BEFORE DELETION SEC. DX CODE  (sub-file)
"BLD",6859,4,74,2,74.16,1,0)
^9.6411^^0
"BLD",6859,4,74,2,74.18,0)
BEFORE DELETION SEC. STAFF  (sub-file)
"BLD",6859,4,74,2,74.18,1,0)
^9.6411^^0
"BLD",6859,4,74,2,74.19,0)
BEFORE DELETION SEC. RESIDENT  (sub-file)
"BLD",6859,4,74,2,74.19,1,0)
^9.6411^^0
"BLD",6859,4,74,222)
y^n^p^^^^n^^n
"BLD",6859,4,74,224)

"BLD",6859,4,"APDD",74,74)

"BLD",6859,4,"APDD",74,74,.01)

"BLD",6859,4,"APDD",74,74,5)

"BLD",6859,4,"APDD",74,74,18)

"BLD",6859,4,"APDD",74,74.01)

"BLD",6859,4,"APDD",74,74.01,.01)

"BLD",6859,4,"APDD",74,74.01,2)

"BLD",6859,4,"APDD",74,74.01,4)

"BLD",6859,4,"APDD",74,74.01,5)

"BLD",6859,4,"APDD",74,74.01,7)

"BLD",6859,4,"APDD",74,74.01,9)

"BLD",6859,4,"APDD",74,74.16)

"BLD",6859,4,"APDD",74,74.18)

"BLD",6859,4,"APDD",74,74.19)

"BLD",6859,4,"B",74,74)

"BLD",6859,6.3)
3
"BLD",6859,"INIT")
EN1^RA56PST
"BLD",6859,"KRN",0)
^9.67PA^8989.52^19
"BLD",6859,"KRN",.4,0)
.4
"BLD",6859,"KRN",.401,0)
.401
"BLD",6859,"KRN",.402,0)
.402
"BLD",6859,"KRN",.403,0)
.403
"BLD",6859,"KRN",.5,0)
.5
"BLD",6859,"KRN",.84,0)
.84
"BLD",6859,"KRN",3.6,0)
3.6
"BLD",6859,"KRN",3.8,0)
3.8
"BLD",6859,"KRN",9.2,0)
9.2
"BLD",6859,"KRN",9.8,0)
9.8
"BLD",6859,"KRN",9.8,"NM",0)
^9.68A^25^24
"BLD",6859,"KRN",9.8,"NM",1,0)
RABUL3^^0^B7732532
"BLD",6859,"KRN",9.8,"NM",2,0)
RAO7PC1A^^0^B43220557
"BLD",6859,"KRN",9.8,"NM",3,0)
RAO7PC2^^0^B44753476
"BLD",6859,"KRN",9.8,"NM",4,0)
RAO7PC3^^0^B41860849
"BLD",6859,"KRN",9.8,"NM",5,0)
RAPCE^^0^B46739141
"BLD",6859,"KRN",9.8,"NM",6,0)
RAPROD^^0^B41179318
"BLD",6859,"KRN",9.8,"NM",7,0)
RAPTLU^^0^B29961881
"BLD",6859,"KRN",9.8,"NM",8,0)
RAPXRM^^0^B16075069
"BLD",6859,"KRN",9.8,"NM",10,0)
RART^^0^B23124716
"BLD",6859,"KRN",9.8,"NM",11,0)
RARTE^^0^B30875065
"BLD",6859,"KRN",9.8,"NM",12,0)
RARTE1^^0^B63911053
"BLD",6859,"KRN",9.8,"NM",13,0)
RARTE3^^0^B5429116
"BLD",6859,"KRN",9.8,"NM",14,0)
RARTE4^^0^B26359911
"BLD",6859,"KRN",9.8,"NM",15,0)
RARTE5^^0^B66404814
"BLD",6859,"KRN",9.8,"NM",16,0)
RARTE6^^0^B106132730
"BLD",6859,"KRN",9.8,"NM",17,0)
RARTE7^^0^B23239189
"BLD",6859,"KRN",9.8,"NM",18,0)
RARTR1^^0^B46270637
"BLD",6859,"KRN",9.8,"NM",19,0)
RARTRPV^^0^B30787953
"BLD",6859,"KRN",9.8,"NM",20,0)
RARTST1^^0^B27908673
"BLD",6859,"KRN",9.8,"NM",21,0)
RARTVER^^0^B44139865
"BLD",6859,"KRN",9.8,"NM",22,0)
RASTREQ^^0^B50319772
"BLD",6859,"KRN",9.8,"NM",23,0)
RARTUVR^^0^B31723105
"BLD",6859,"KRN",9.8,"NM",24,0)
RARTUVR1^^0^B26330363
"BLD",6859,"KRN",9.8,"NM",25,0)
RARTUVR3^^0^B30058032
"BLD",6859,"KRN",9.8,"NM","B","RABUL3",1)

"BLD",6859,"KRN",9.8,"NM","B","RAO7PC1A",2)

"BLD",6859,"KRN",9.8,"NM","B","RAO7PC2",3)

"BLD",6859,"KRN",9.8,"NM","B","RAO7PC3",4)

"BLD",6859,"KRN",9.8,"NM","B","RAPCE",5)

"BLD",6859,"KRN",9.8,"NM","B","RAPROD",6)

"BLD",6859,"KRN",9.8,"NM","B","RAPTLU",7)

"BLD",6859,"KRN",9.8,"NM","B","RAPXRM",8)

"BLD",6859,"KRN",9.8,"NM","B","RART",10)

"BLD",6859,"KRN",9.8,"NM","B","RARTE",11)

"BLD",6859,"KRN",9.8,"NM","B","RARTE1",12)

"BLD",6859,"KRN",9.8,"NM","B","RARTE3",13)

"BLD",6859,"KRN",9.8,"NM","B","RARTE4",14)

"BLD",6859,"KRN",9.8,"NM","B","RARTE5",15)

"BLD",6859,"KRN",9.8,"NM","B","RARTE6",16)

"BLD",6859,"KRN",9.8,"NM","B","RARTE7",17)

"BLD",6859,"KRN",9.8,"NM","B","RARTR1",18)

"BLD",6859,"KRN",9.8,"NM","B","RARTRPV",19)

"BLD",6859,"KRN",9.8,"NM","B","RARTST1",20)

"BLD",6859,"KRN",9.8,"NM","B","RARTUVR",23)

"BLD",6859,"KRN",9.8,"NM","B","RARTUVR1",24)

"BLD",6859,"KRN",9.8,"NM","B","RARTUVR3",25)

"BLD",6859,"KRN",9.8,"NM","B","RARTVER",21)

"BLD",6859,"KRN",9.8,"NM","B","RASTREQ",22)

"BLD",6859,"KRN",19,0)
19
"BLD",6859,"KRN",19,"NM",0)
^9.68A^7^6
"BLD",6859,"KRN",19,"NM",2,0)
RA SUPERVISOR^^2
"BLD",6859,"KRN",19,"NM",3,0)
RA UNVERIFY^^0
"BLD",6859,"KRN",19,"NM",4,0)
RA OUTSIDE RPTENTRY^^0
"BLD",6859,"KRN",19,"NM",5,0)
RA RPT^^2
"BLD",6859,"KRN",19,"NM",6,0)
RA RESTORE REPORT^^0
"BLD",6859,"KRN",19,"NM",7,0)
RA DELETERPT^^0
"BLD",6859,"KRN",19,"NM","B","RA DELETERPT",7)

"BLD",6859,"KRN",19,"NM","B","RA OUTSIDE RPTENTRY",4)

"BLD",6859,"KRN",19,"NM","B","RA RESTORE REPORT",6)

"BLD",6859,"KRN",19,"NM","B","RA RPT",5)

"BLD",6859,"KRN",19,"NM","B","RA SUPERVISOR",2)

"BLD",6859,"KRN",19,"NM","B","RA UNVERIFY",3)

"BLD",6859,"KRN",19.1,0)
19.1
"BLD",6859,"KRN",101,0)
101
"BLD",6859,"KRN",409.61,0)
409.61
"BLD",6859,"KRN",771,0)
771
"BLD",6859,"KRN",870,0)
870
"BLD",6859,"KRN",8989.51,0)
8989.51
"BLD",6859,"KRN",8989.52,0)
8989.52
"BLD",6859,"KRN",8994,0)
8994
"BLD",6859,"KRN","B",.4,.4)

"BLD",6859,"KRN","B",.401,.401)

"BLD",6859,"KRN","B",.402,.402)

"BLD",6859,"KRN","B",.403,.403)

"BLD",6859,"KRN","B",.5,.5)

"BLD",6859,"KRN","B",.84,.84)

"BLD",6859,"KRN","B",3.6,3.6)

"BLD",6859,"KRN","B",3.8,3.8)

"BLD",6859,"KRN","B",9.2,9.2)

"BLD",6859,"KRN","B",9.8,9.8)

"BLD",6859,"KRN","B",19,19)

"BLD",6859,"KRN","B",19.1,19.1)

"BLD",6859,"KRN","B",101,101)

"BLD",6859,"KRN","B",409.61,409.61)

"BLD",6859,"KRN","B",771,771)

"BLD",6859,"KRN","B",870,870)

"BLD",6859,"KRN","B",8989.51,8989.51)

"BLD",6859,"KRN","B",8989.52,8989.52)

"BLD",6859,"KRN","B",8994,8994)

"BLD",6859,"QUES",0)
^9.62^^
"BLD",6859,"REQB",0)
^9.611^8^7
"BLD",6859,"REQB",1,0)
RA*5.0*57^2
"BLD",6859,"REQB",3,0)
RA*5.0*68^2
"BLD",6859,"REQB",4,0)
RA*5.0*75^2
"BLD",6859,"REQB",5,0)
RA*5.0*82^2
"BLD",6859,"REQB",6,0)
RA*5.0*40^2
"BLD",6859,"REQB",7,0)
RA*5.0*33^2
"BLD",6859,"REQB",8,0)
RA*5.0*29^2
"BLD",6859,"REQB","B","RA*5.0*29",8)

"BLD",6859,"REQB","B","RA*5.0*33",7)

"BLD",6859,"REQB","B","RA*5.0*40",6)

"BLD",6859,"REQB","B","RA*5.0*57",1)

"BLD",6859,"REQB","B","RA*5.0*68",3)

"BLD",6859,"REQB","B","RA*5.0*75",4)

"BLD",6859,"REQB","B","RA*5.0*82",5)

"FIA",74)
RAD/NUC MED REPORTS
"FIA",74,0)
^RARPT(
"FIA",74,0,0)
74I
"FIA",74,0,1)
y^n^p^^^^n^^n
"FIA",74,0,10)

"FIA",74,0,11)

"FIA",74,0,"RLRO")

"FIA",74,0,"VR")
5.0^RA
"FIA",74,74)
1
"FIA",74,74,.01)

"FIA",74,74,5)

"FIA",74,74,18)

"FIA",74,74,100)

"FIA",74,74.01)
1
"FIA",74,74.01,.01)

"FIA",74,74.01,2)

"FIA",74,74.01,4)

"FIA",74,74.01,5)

"FIA",74,74.01,6)

"FIA",74,74.01,7)

"FIA",74,74.01,8)

"FIA",74,74.01,9)

"FIA",74,74.01,10)

"FIA",74,74.16)
0
"FIA",74,74.18)
0
"FIA",74,74.19)
0
"INIT")
EN1^RA56PST
"KRN",19,1644,-1)
2^5
"KRN",19,1644,0)
RA RPT^Films Reporting Menu^^M^50^^^^^^^
"KRN",19,1644,10,0)
^19.01IP^12^11
"KRN",19,1644,10,12,0)
12783
"KRN",19,1644,10,12,"^")
RA OUTSIDE RPTENTRY
"KRN",19,1644,"U")
FILMS REPORTING MENU
"KRN",19,1649,-1)
2^2
"KRN",19,1649,0)
RA SUPERVISOR^Supervisor Menu^^M^50^^^^^^^
"KRN",19,1649,10,0)
^19.01IP^26^19
"KRN",19,1649,10,13,0)
1765^
"KRN",19,1649,10,13,"^")
RA UNVERIFY
"KRN",19,1649,10,14,0)
1696^
"KRN",19,1649,10,14,"^")
RA DELETERPT
"KRN",19,1649,10,26,0)
12784
"KRN",19,1649,10,26,"^")
RA RESTORE REPORT
"KRN",19,1649,"U")
SUPERVISOR MENU
"KRN",19,1696,-1)
0^7
"KRN",19,1696,0)
RA DELETERPT^Delete a Report^^R^^RA MGR^^^^^^^^1^1
"KRN",19,1696,1,0)
^^7^7^3080211^
"KRN",19,1696,1,1,0)
This option allows the coordinator to delete a report.  This option 
"KRN",19,1696,1,2,0)
should only be used by the coordinator.  When a report is deleted, it
"KRN",19,1696,1,3,0)
causes a bulletin about the deleted report to be sent to the members of
"KRN",19,1696,1,4,0)
the appropriate mail group.
"KRN",19,1696,1,5,0)
 
"KRN",19,1696,1,6,0)
To view a list of deleted reports, use the 'Restore a Deleted Report' 
"KRN",19,1696,1,7,0)
option and enter "??" at the "Select Deleted Report to restore:" prompt.
"KRN",19,1696,15)
K RADELRPT
"KRN",19,1696,20)
S RADELRPT=""
"KRN",19,1696,25)
DEL^RARTE1
"KRN",19,1696,"U")
DELETE A REPORT
"KRN",19,1765,-1)
0^3
"KRN",19,1765,0)
RA UNVERIFY^Unverify a Report for Amendment^^R^^RA MGR^^^^^^
"KRN",19,1765,1,0)
^19.06^7^7^3080208^^
"KRN",19,1765,1,1,0)
This option allows the supervisor to unverify a report.  This option
"KRN",19,1765,1,2,0)
should not be given to other users.  As the report is unverified, a copy
"KRN",19,1765,1,3,0)
of it is saved for medical/legal purposes, and the report can be amended
"KRN",19,1765,1,4,0)
using any option that allows report edit.  After the amended report is
"KRN",19,1765,1,5,0)
re-verified, displays and printouts of the report will always have a
"KRN",19,1765,1,6,0)
notation at the top to call attention to the fact that it has been
"KRN",19,1765,1,7,0)
amended.
"KRN",19,1765,25)
UNVER^RARTE1(0)
"KRN",19,1765,"U")
UNVERIFY A REPORT FOR AMENDMEN
"KRN",19,12783,-1)
0^4
"KRN",19,12783,0)
RA OUTSIDE RPTENTRY^Outside Report Entry/Edit^^R^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE^^1^1
"KRN",19,12783,1,0)
^^3^3^3080208^
"KRN",19,12783,1,1,0)
This option allows the user to log an outside interpreted report, without 
"KRN",19,12783,1,2,0)
having to verify it.  The report entered from this option is automatically
"KRN",19,12783,1,3,0)
given the "Electronically Filed" report status.
"KRN",19,12783,15)
K RANOSCRN,^TMP($J,"RA D-TYPE"),^TMP($J,"RA I-TYPE")
"KRN",19,12783,20)
S RANOSCRN=""
"KRN",19,12783,25)
RARTE5
"KRN",19,12783,"U")
OUTSIDE REPORT ENTRY/EDIT
"KRN",19,12784,-1)
0^6
"KRN",19,12784,0)
RA RESTORE REPORT^Restore a Deleted Report^^R^^RA MGR^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,12784,1,0)
^^5^5^3080208^
"KRN",19,12784,1,1,0)
This option will restore a deleted report to its case, only if another 
"KRN",19,12784,1,2,0)
report was not linked to the case in the interim (time between the report 
"KRN",19,12784,1,3,0)
deletion and restoration.)  The restored report is re-assigned the report 
"KRN",19,12784,1,4,0)
status it had prior to the 'Deleted' report status.  However, the status 
"KRN",19,12784,1,5,0)
of the exam is not updated.
"KRN",19,12784,25)
RSTR^RARTE6
"KRN",19,12784,"U")
RESTORE A DELETED REPORT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
56^3080611
"PKG",18,22,1,"PAH",1,1,0)
^^2^2^3080611
"PKG",18,22,1,"PAH",1,1,1,0)
Please see the description in FORUM's national patch module for this 
"PKG",18,22,1,"PAH",1,1,2,0)
patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
25
"RTN","RA56PST")
0^^B3908511^n/a
"RTN","RA56PST",1,0)
RA56PST ;HISC/SM Post-init ; 11/23/07
"RTN","RA56PST",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56**;Mar 16, 1998;Build 3
"RTN","RA56PST",3,0)
 ;This is the post-install routine for patch RA*5.0*56
"RTN","RA56PST",4,0)
 ;Private IA #5155 Remove Rad/Nuc Med dd Screen from Subfield #70.03
"RTN","RA56PST",5,0)
 ;Private IA #5156 Remove Rad/Nuc Med dd Screen from File #79.1
"RTN","RA56PST",6,0)
 Q
"RTN","RA56PST",7,0)
EN1 ;reset file 78.7's field MUMPS CODE TO SET VARIABLE
"RTN","RA56PST",8,0)
 ;  for the PRINT FIELD: REPORT STATUS
"RTN","RA56PST",9,0)
 I '$D(XPDNM)#2 D EN^DDIOL("This entry point must be called from the KIDS installation -- Nothing Done.",,"!!,$C(7)") Q
"RTN","RA56PST",10,0)
 N RAIEN
"RTN","RA56PST",11,0)
 S RAIEN=$O(^RA(78.7,"B","REPORT STATUS",0))
"RTN","RA56PST",12,0)
 I 'RAIEN D ERR1 G CONT1
"RTN","RA56PST",13,0)
 I '$D(^RA(78.7,RAIEN,"E")) D ERR2 G CONT1
"RTN","RA56PST",14,0)
 ; must use hard set instead of silent FM due uneditable data
"RTN","RA56PST",15,0)
 S ^RA(78.7,RAIEN,"E")="S RARST=$$GET1^DIQ(74,+$P(RAY3,""^"",17)_"","",5)"
"RTN","RA56PST",16,0)
 D BMES^XPDUTL("File 78.7's REPORT STATUS record has been successfully updated.")
"RTN","RA56PST",17,0)
 ;
"RTN","RA56PST",18,0)
CONT1 ;kill stray 9.2 nodes for two CREDIT METHOD fields
"RTN","RA56PST",19,0)
 ;  in subfile 70.03 and file 79.1
"RTN","RA56PST",20,0)
 I $D(^DD(70.03,26,9.2)) D
"RTN","RA56PST",21,0)
 .K ^DD(70.03,26,9.2)
"RTN","RA56PST",22,0)
 .D BMES^XPDUTL("Cleaned up stray 9.2 node for the CREDIT METHOD field in subfile 70.03.")
"RTN","RA56PST",23,0)
 .Q
"RTN","RA56PST",24,0)
 I $D(^DD(79.1,21,9.2)) D
"RTN","RA56PST",25,0)
 .K ^DD(79.1,21,9.2)
"RTN","RA56PST",26,0)
 .D BMES^XPDUTL("Cleaned up stray 9.2 node for the CREDIT METHOD field in file 79.1.")
"RTN","RA56PST",27,0)
 .Q
"RTN","RA56PST",28,0)
 Q
"RTN","RA56PST",29,0)
ERR1 ;
"RTN","RA56PST",30,0)
 D BMES^XPDUTL("File 78.7 doesn't have the REPORT STATUS record, so REPORT STATUS record is not updated.")
"RTN","RA56PST",31,0)
 Q
"RTN","RA56PST",32,0)
ERR2 ;
"RTN","RA56PST",33,0)
 D BMES^XPDUTL("File 78.7 has no data for field 100, so REPORT STATUS record is not updated.")
"RTN","RA56PST",34,0)
 Q
"RTN","RABUL3")
0^1^B7732532^B6229455
"RTN","RABUL3",1,0)
RABUL3 ;HISC/FPT,GJC-'RAD/NUC MED REPORT DELETION' Bulletin ;3/21/95  13:56
"RTN","RABUL3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56**;Mar 16, 1998;Build 3
"RTN","RABUL3",3,0)
 ;Supported IA #10035 ^DPT(
"RTN","RABUL3",4,0)
 ; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
"RTN","RABUL3",5,0)
 ; The variables DA must be defined.  The value of DA must be greater
"RTN","RABUL3",6,0)
 ; than 0.  These conditions must exist for the RAD/NUC MED REPORT
"RTN","RABUL3",7,0)
 ; DELETION bulletin to execute.
"RTN","RABUL3",8,0)
 ; Called from: 
"RTN","RABUL3",9,0)
 ;   ^DD(74,.01,1,2,0-"DT") xref nodes if deletion via Fileman
"RTN","RABUL3",10,0)
 ;   routine RARTE7, if deletion via Rad pkg (RA*5*56)
"RTN","RABUL3",11,0)
 ; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
"RTN","RABUL3",12,0)
 ;                     ***** Variable List *****
"RTN","RABUL3",13,0)
 ; 'DIFQ'     -> Variable used to check if we are installing the
"RTN","RABUL3",14,0)
 ;               Radiology Package.  If we are, do not fire off
"RTN","RABUL3",15,0)
 ;               bulletins.
"RTN","RABUL3",16,0)
 ; 'RADFN'    -> IEN of the patient in the PATIENT file (2)
"RTN","RABUL3",17,0)
 ; 'RAEXAM'   -> IEN of a record in the Examinations multiple
"RTN","RABUL3",18,0)
 ;               of the Radiology/Nuclear Medicine Patient file. (70)
"RTN","RABUL3",19,0)
 ; 'RAEXAM(0)'-> Zero node of a record in the Examinations multiple
"RTN","RABUL3",20,0)
 ;               of the Radiology/Nuclear Medicine Patient file. (70)
"RTN","RABUL3",21,0)
 ; 'RARXAM(0)'-> Zero node of a record in the Registered Exam multiple
"RTN","RABUL3",22,0)
 ;               of the Radiology/Nuclear Medicine Patient file. (70)
"RTN","RABUL3",23,0)
 ; 'RAFN1'    -> internal format of a FM date/time data element
"RTN","RABUL3",24,0)
 ;               { internal format pointer value }
"RTN","RABUL3",25,0)
 ; 'RAFN2'    -> FM data definition for RAFN1, used in XTERNAL^RAUTL5
"RTN","RABUL3",26,0)
 ; 'A'        -> Zero node of the RADIOLOGY/NUCLEAR MEDICINE REPORTS
"RTN","RABUL3",27,0)
 ;               file (74) { node: ^RARPT(DA,0) }
"RTN","RABUL3",28,0)
 ;
"RTN","RABUL3",29,0)
 ; Format: Data to be fired;local var name;XMB array representation
"RTN","RABUL3",30,0)
 ; Patient ; RANAME ; XMB(1)     <---> Exam Date ; RAXDT ; XMB(4)
"RTN","RABUL3",31,0)
 ; Patient SSN ; RASSN ; XMB(2)  <---> Desired Date ; RADDT ; XMB(5)
"RTN","RABUL3",32,0)
 ; Case Number ; RACASE ; XMB(3) <---> Report Status ; RASTAT ; XMB(6)
"RTN","RABUL3",33,0)
 ; Imaging Loc ; RAILOC ; XMB(7)
"RTN","RABUL3",34,0)
 ;
"RTN","RABUL3",35,0)
EN1 Q:$D(DIFQ)!(+$G(DA)'>0)  ; Quit if installing software or invalid IEN
"RTN","RABUL3",36,0)
 N A,RACASE,RACN,RADDT,RADTI,RADFN,RAEXAM,RAFN1,RAFN2,RAILOC,RANAME
"RTN","RABUL3",37,0)
 N RARXAM,RASSN,RASTAT,RAXDT,X,Y
"RTN","RABUL3",38,0)
 S A=$G(^RARPT(DA,0))
"RTN","RABUL3",39,0)
 S Y=DA D RASET^RAUTL2 ; Derive case/exam data from file 70
"RTN","RABUL3",40,0)
 S RADFN(0)=RADFN
"RTN","RABUL3",41,0)
 S (RADFN,RANAME)=+$P(A,U,2)
"RTN","RABUL3",42,0)
 S RANAME=$S($D(^DPT(RANAME,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL3",43,0)
 S RASSN=$$SSN^RAUTL() S RADFN=RADFN(0)
"RTN","RABUL3",44,0)
 S RACASE=$S($P(A,U)]"":$P(A,U),1:"Unknown")
"RTN","RABUL3",45,0)
 S RAFN1=$P(A,U,3),RAFN2=$P($G(^DD(74,3,0)),U,2)
"RTN","RABUL3",46,0)
 S RAXDT=$$XTERNAL^RAUTL5(RAFN1,RAFN2)
"RTN","RABUL3",47,0)
 S RAXDT=$S(RAXDT]"":RAXDT,1:"Unknown")
"RTN","RABUL3",48,0)
 S RARXAM(0)=$G(^RADPT(+$G(RADFN),"DT",+$G(RADTI),0))
"RTN","RABUL3",49,0)
 S RAEXAM=$O(^RADPT(+$G(RADFN),"DT",+$G(RADTI),"P","B",+$G(RACN),0))
"RTN","RABUL3",50,0)
 S RAEXAM(0)=$G(^RADPT(+$G(RADFN),"DT",+$G(RADTI),"P",+$G(RAEXAM),0))
"RTN","RABUL3",51,0)
 S RAFN1=$P(RAEXAM(0),U,21),RAFN2=$P($G(^DD(70.03,21,0)),U,2)
"RTN","RABUL3",52,0)
 S RADDT=$$XTERNAL^RAUTL5(RAFN1,RAFN2)
"RTN","RABUL3",53,0)
 S RADDT=$S(RADDT]"":RADDT,1:"Unknown")
"RTN","RABUL3",54,0)
 S RAFN1=$S($D(RACLOAK)#2:RACLOAK,1:$P(A,U,5)),RAFN2=$P($G(^DD(74,5,0)),U,2)
"RTN","RABUL3",55,0)
 S RASTAT=$$XTERNAL^RAUTL5(RAFN1,RAFN2)
"RTN","RABUL3",56,0)
 S RASTAT=$S(RASTAT]"":RASTAT,1:"Unknown")
"RTN","RABUL3",57,0)
 S RAFN1=$P(RARXAM(0),U,4),RAFN2=$P($G(^DD(70.02,4,0)),U,2)
"RTN","RABUL3",58,0)
 S RAILOC=$$XTERNAL^RAUTL5(RAFN1,RAFN2)
"RTN","RABUL3",59,0)
 S RAILOC=$S(RAILOC]"":RAILOC,1:"Unknown")
"RTN","RABUL3",60,0)
 S XMB(1)=RANAME,XMB(2)=RASSN,XMB(3)=RACASE
"RTN","RABUL3",61,0)
 S XMB(4)=RAXDT,XMB(5)=RADDT,XMB(6)=RASTAT
"RTN","RABUL3",62,0)
 S XMB(7)=RAILOC,XMB="RAD/NUC MED REPORT DELETION"
"RTN","RABUL3",63,0)
 D ^XMB:$D(^XMB(3.6,"B",XMB))
"RTN","RABUL3",64,0)
 K XMB,XMB0,XMC0,XMDT,XMM,XMMG
"RTN","RABUL3",65,0)
 Q
"RTN","RABUL3",66,0)
CLOAK ;called from RARTE7 right after report is deleted but cloaked
"RTN","RABUL3",67,0)
 Q:'$D(RAIEN)#2  ;report ien
"RTN","RABUL3",68,0)
 Q:'$D(RAIEN2)#2  ;activity log sub ien
"RTN","RABUL3",69,0)
 S DA=RAIEN
"RTN","RABUL3",70,0)
 S RACLOAK=$P(^RARPT(DA,"L",RAIEN2,0),U,4) ;previous rpt status
"RTN","RABUL3",71,0)
 G EN1
"RTN","RAO7PC1A")
0^2^B43220557^B39556954
"RTN","RAO7PC1A",1,0)
RAO7PC1A ;HISC/GJC-Procedure Call utilities (cont) ;1/22/03  12:41
"RTN","RAO7PC1A",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,10,26,31,36,45,56**;Mar 16, 1998;Build 3
"RTN","RAO7PC1A",3,0)
 ;Supported IA #10040 ^SC(
"RTN","RAO7PC1A",4,0)
 ;Supported IA #10103 DT^XLFDT, FMADD^XLFDT
"RTN","RAO7PC1A",5,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RAO7PC1A",6,0)
 ;Supported IA #10104 LOW^XLFSTR, UP^XLFSTR
"RTN","RAO7PC1A",7,0)
SETDATA ; Called from within the EN1 subroutine of RAO7PC1
"RTN","RAO7PC1A",8,0)
 ; Sets the ^TMP($J,"RAE1",patient ien,Exam ID) node.
"RTN","RAO7PC1A",9,0)
 ; See EN1^RAO7PC1 for further explanation.
"RTN","RAO7PC1A",10,0)
 ;
"RTN","RAO7PC1A",11,0)
 ; Output (new) :
"RTN","RAO7PC1A",12,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CMOD",1)=cptmod^cptmodname
"RTN","RAO7PC1A",13,0)
 ;                                          ,2)=cptmod^cptmodname
"RTN","RAO7PC1A",14,0)
 N RA,RA1,RA2,RA3
"RTN","RAO7PC1A",15,0)
 S RANO=0,RAREX(0)=$G(^RADPT(RADFN,"DT",RAIBDT,0))
"RTN","RAO7PC1A",16,0)
 S RAITY=+$P(RAREX(0),"^",2),RAILOC=+$P(RAREX(0),"^",4)
"RTN","RAO7PC1A",17,0)
 S RAILOC=$P($G(^SC(+$P($G(^RA(79.1,RAILOC,0)),"^"),0)),"^")
"RTN","RAO7PC1A",18,0)
 S RAITY(0)=$G(^RA(79.2,RAITY,0))
"RTN","RAO7PC1A",19,0)
 F  S RANO=$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO)) Q:RANO'>0  D  Q:RAXIT
"RTN","RAO7PC1A",20,0)
 . S RAXAM(0)=$G(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,0))
"RTN","RAO7PC1A",21,0)
 . Q:RAXAM(0)=""
"RTN","RAO7PC1A",22,0)
 . S RAORDER=+$P(RAXAM(0),"^",11)
"RTN","RAO7PC1A",23,0)
 . ; quit if exam is WAITING and its order status isn't ACTIVE
"RTN","RAO7PC1A",24,0)
 . ; because this means exam hasn't finished being registered
"RTN","RAO7PC1A",25,0)
 . I $P($G(^RA(72,+$P(RAXAM(0),U,3),0)),U,3)=1,$P($G(^RAO(75.1,RAORDER,0)),U,5)'=6 Q
"RTN","RAO7PC1A",26,0)
 . S RAORDER(7)=$P($G(^RAO(75.1,RAORDER,0)),"^",7) ; CPRS order ien
"RTN","RAO7PC1A",27,0)
 . S RAXSTAT=+$P(RAXAM(0),"^",3),RAXSTAT(0)=$G(^RA(72,RAXSTAT,0))
"RTN","RAO7PC1A",28,0)
 . S RAXID=RAIBDT_"-"_RANO
"RTN","RAO7PC1A",29,0)
 . S RACSE=$S($P(RAXAM(0),U)]"":$P(RAXAM(0),U),1:"Unknown")
"RTN","RAO7PC1A",30,0)
 . S RAPRC=$G(^RAMIS(71,+$P(RAXAM(0),U,2),0))
"RTN","RAO7PC1A",31,0)
 . S RACPT=+$P(RAPRC,"^",9) ; pntr to 81
"RTN","RAO7PC1A",32,0)
 . S RACPT=$$NAMCODE^RACPTMSC(RACPT,DT)
"RTN","RAO7PC1A",33,0)
 . S RACPT=$S($P(RACPT,"^",2)]"":$P(RACPT,"^"),1:"")
"RTN","RAO7PC1A",34,0)
 . S RAPRC=$S($P(RAPRC,U)]"":$P(RAPRC,U),1:"Unknown")
"RTN","RAO7PC1A",35,0)
 . ; quit if cancelled exam, and cancelled exams not requested
"RTN","RAO7PC1A",36,0)
 . I ('$G(RACINC)),($P($G(^RA(72,+$P(RAXAM(0),"^",3),0)),"^",3)=0) Q
"RTN","RAO7PC1A",37,0)
 . S RADIAG=+$P(RAXAM(0),U,13),RARPT=+$P(RAXAM(0),U,17)
"RTN","RAO7PC1A",38,0)
 .; E3R 17541, 15507
"RTN","RAO7PC1A",39,0)
 .; if want cancel'd cases returned, and this case is cancelled, then
"RTN","RAO7PC1A",40,0)
 .; also require div param ALLOW RPTS ON CANCELLED CASES? = Y and
"RTN","RAO7PC1A",41,0)
 .; presence of report, else skip this case
"RTN","RAO7PC1A",42,0)
 . I $G(RACINC),($P($G(^RA(72,+$P(RAXAM(0),"^",3),0)),"^",3)=0) D  Q:RASHOCAN=0
"RTN","RAO7PC1A",43,0)
 .. S RASHOCAN=0
"RTN","RAO7PC1A",44,0)
 .. I $P($G(^RA(79,+$P(RAREX(0),"^",3),.1)),"^",22)="Y",RARPT S RASHOCAN=1
"RTN","RAO7PC1A",45,0)
 .. Q
"RTN","RAO7PC1A",46,0)
 . S RABNOR=$$UP^XLFSTR($P($G(^RA(78.3,RADIAG,0)),U,4))
"RTN","RAO7PC1A",47,0)
 . S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC1A",48,0)
 . S RABNORMR=$$UP^XLFSTR($P($G(^RA(78.3,RADIAG,0)),U,3))
"RTN","RAO7PC1A",49,0)
 . S:RABNORMR'="Y" RABNORMR=""
"RTN","RAO7PC1A",50,0)
 . S RARPTST=$$RSTAT(),RARPTST=$$UL(RARPTST)
"RTN","RAO7PC1A",51,0)
 . S ^TMP($J,"RAE1",RADFN,RAXID)=RAPRC_U_RACSE_U_RARPTST_U_RABNOR_U_$S(RARPT=0:"",1:RARPT)_U_$P(RAXSTAT(0),"^",3)_"~"_$P(RAXSTAT(0),"^")_U_RAILOC_U_$P(RAITY(0),"^",3)_"~"_$P(RAITY(0),"^")_U_RABNORMR_U_RACPT_U_$G(RAORDER(7))
"RTN","RAO7PC1A",52,0)
 . S ^TMP($J,"RAE1",RADFN,RAXID)=^TMP($J,"RAE1",RADFN,RAXID)_U_$S($O(^RARPT(RARPT,2005,0)):"Y",1:"N")
"RTN","RAO7PC1A",53,0)
 . D CPTMOD
"RTN","RAO7PC1A",54,0)
 . S RACNT=RACNT+1
"RTN","RAO7PC1A",55,0)
 .;
"RTN","RAO7PC1A",56,0)
 .; Condensed Radiology Display in CPRS GUI:
"RTN","RAO7PC1A",57,0)
 .; subtract from count if counting parent; count only 1 case from printset
"RTN","RAO7PC1A",58,0)
 .; and
"RTN","RAO7PC1A",59,0)
 .; store values of MEMBER OF SET and ordered parent procedure name
"RTN","RAO7PC1A",60,0)
 . I $D(RAEXNP),$E(RAEXNP,$L(RAEXNP))="P" D
"RTN","RAO7PC1A",61,0)
 .. I $P(RAXAM(0),U,25)="2",$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO),-1) S RACNT=RACNT-1
"RTN","RAO7PC1A",62,0)
 .. I $P(RAXAM(0),U,25) D
"RTN","RAO7PC1A",63,0)
 ... S RA3=$S('RAORDER:"",1:$P($G(^RAMIS(71,+$P($G(^RAO(75.1,+RAORDER,0)),U,2),0)),U))
"RTN","RAO7PC1A",64,0)
 ... S RA3=$S(RA3'="":RA3,1:"PARENT PROCEDURE")
"RTN","RAO7PC1A",65,0)
 ... S ^TMP($J,"RAE1",RADFN,RAXID,"CPRS")=$P(RAXAM(0),U,25)_U_RA3
"RTN","RAO7PC1A",66,0)
 ... Q
"RTN","RAO7PC1A",67,0)
 .. Q
"RTN","RAO7PC1A",68,0)
 . S:RACNT=RAEXN RAXIT=1
"RTN","RAO7PC1A",69,0)
 .; Condensed Radiology Display in CPRS GUI:
"RTN","RAO7PC1A",70,0)
 .; do not exit until all cases of printset have been stored
"RTN","RAO7PC1A",71,0)
 . I $D(RAEXNP),$E(RAEXNP,$L(RAEXNP))="P",$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO)) S RAXIT=0
"RTN","RAO7PC1A",72,0)
 . K RAXSTAT,RAORDER
"RTN","RAO7PC1A",73,0)
 . Q
"RTN","RAO7PC1A",74,0)
 K RAILOC,RAITY
"RTN","RAO7PC1A",75,0)
 Q
"RTN","RAO7PC1A",76,0)
CASE ; Return the case numbers and the total number of case numbers
"RTN","RAO7PC1A",77,0)
 ; associated with a particular order.  Called from CASE^RAO7PC1.
"RTN","RAO7PC1A",78,0)
 ; Sets RARRAY(case #)="" for all cases associated with an order.
"RTN","RAO7PC1A",79,0)
 ; Sets first piece of RATTL to the number of cases found for an
"RTN","RAO7PC1A",80,0)
 ; order, and the second piece is PRINTSET if the report covers
"RTN","RAO7PC1A",81,0)
 ; multiple cases.  See CASE^RAO7PC1 for more information.
"RTN","RAO7PC1A",82,0)
 I '$D(^RAO(75.1,RAOIFN,0))#2 S RATTL="-1^invalid order ien" Q
"RTN","RAO7PC1A",83,0)
 I '$D(^RADPT("AO",RAOIFN)) D  Q  ; case has yet to be registered
"RTN","RAO7PC1A",84,0)
 . S RATTL="-2^no case registered to date"
"RTN","RAO7PC1A",85,0)
 . Q
"RTN","RAO7PC1A",86,0)
 N RACNI,RADFN,RADTI,RAEXAM S RADFN=0
"RTN","RAO7PC1A",87,0)
 F  S RADFN=$O(^RADPT("AO",RAOIFN,RADFN)) Q:RADFN'>0  D
"RTN","RAO7PC1A",88,0)
 . S RADTI=0
"RTN","RAO7PC1A",89,0)
 . F  S RADTI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI)) Q:RADTI'>0  D
"RTN","RAO7PC1A",90,0)
 .. S RACNI=0
"RTN","RAO7PC1A",91,0)
 .. F  S RACNI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI,RACNI)) Q:RACNI'>0  D
"RTN","RAO7PC1A",92,0)
 ... S RAEXAM=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAO7PC1A",93,0)
 ... Q:$P($G(^RA(72,+$P(RAEXAM,"^",3),0)),"^",3)=0  ; xam cancelled
"RTN","RAO7PC1A",94,0)
 ... S RATTL=+$G(RATTL)+1,@(RARRAY_"("_+RAEXAM_")")=""
"RTN","RAO7PC1A",95,0)
 ... Q
"RTN","RAO7PC1A",96,0)
 .. Q
"RTN","RAO7PC1A",97,0)
 . Q
"RTN","RAO7PC1A",98,0)
 I 'RATTL S RATTL="-2^cases cancelled" Q
"RTN","RAO7PC1A",99,0)
 S:$P(RAEXAM,"^",25)=2 RATTL=RATTL_"^PRINTSET" ; combined reports
"RTN","RAO7PC1A",100,0)
 Q
"RTN","RAO7PC1A",101,0)
 ;
"RTN","RAO7PC1A",102,0)
EN2 ; IA: 2012, Return last 7 days of non-cancelled exams
"RTN","RAO7PC1A",103,0)
 ; Required: RADFN (valid patient ien) called from EN2^RAO7PC1
"RTN","RAO7PC1A",104,0)
 ; Output:
"RTN","RAO7PC1A",105,0)
 ; ^TMP($J,"RAE7",Patient IEN,Exam ID)=procedure name^case number^
"RTN","RAO7PC1A",106,0)
 ;       report status^imaging location IEN^imaging location name^
"RTN","RAO7PC1A",107,0)
 ;       contrast medium or media used
"RTN","RAO7PC1A",108,0)
 ;       Note: Single characters in parenthesis indicate contrast
"RTN","RAO7PC1A",109,0)
 ;       involvement: (I)=Iodinated ionic; (N)=Iodinated non-ionic;
"RTN","RAO7PC1A",110,0)
 ;        (L)=Gadolinium; (C)=Oral Cholecystographic; (G)=Gastrografin;
"RTN","RAO7PC1A",111,0)
 ;        (B)=Barium; (M)=unspecified contrast media
"RTN","RAO7PC1A",112,0)
 ;
"RTN","RAO7PC1A",113,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1A",114,0)
 ;
"RTN","RAO7PC1A",115,0)
 Q:'$D(RADFN)  Q:'RADFN  K ^TMP($J,"RAE7")
"RTN","RAO7PC1A",116,0)
 N I,RABDT,RACNST,RACSE,RADT,RAEDT,RAIBDT,RAIEDT,RALOC,RACMEDIA,RANO
"RTN","RAO7PC1A",117,0)
 N RAPRC,RAREX,RARPT,RARPTST,RAXAM,RAXID,RAXSTAT
"RTN","RAO7PC1A",118,0)
 S RADT=$S($D(DT)#2:DT,1:$$DT^XLFDT()),RACNST=9999999.9999
"RTN","RAO7PC1A",119,0)
 S RABDT=$$FMADD^XLFDT(RADT,-7,0,0,0),RAEDT=RADT
"RTN","RAO7PC1A",120,0)
 S RAIBDT=RACNST-(RAEDT+.9999),RAIEDT=RACNST-(RABDT-.0001)
"RTN","RAO7PC1A",121,0)
 F  S RAIBDT=$O(^RADPT(RADFN,"DT",RAIBDT)) Q:RAIBDT'>0!(RAIBDT>RAIEDT)  D
"RTN","RAO7PC1A",122,0)
 . S RANO=0,RAREX(0)=$G(^RADPT(RADFN,"DT",RAIBDT,0))
"RTN","RAO7PC1A",123,0)
 . S RALOC=+$P(RAREX(0),U,4),RALOC(0)=$G(^RA(79.1,RALOC,0))
"RTN","RAO7PC1A",124,0)
 . S RALOC=$P($G(^SC(+RALOC(0),0)),"^")
"RTN","RAO7PC1A",125,0)
 . F  S RANO=$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO)) Q:RANO'>0  D
"RTN","RAO7PC1A",126,0)
 .. S RAXAM(0)=$G(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,0))
"RTN","RAO7PC1A",127,0)
 .. S RAXID=RAIBDT_"-"_RANO
"RTN","RAO7PC1A",128,0)
 .. S RACSE=$S($P(RAXAM(0),U)]"":$P(RAXAM(0),U),1:"Unknown")
"RTN","RAO7PC1A",129,0)
 .. S RAPRC=$G(^RAMIS(71,+$P(RAXAM(0),U,2),0))
"RTN","RAO7PC1A",130,0)
 .. S RAPRC=$S($P(RAPRC,U)]"":$P(RAPRC,U),1:"Unknown")
"RTN","RAO7PC1A",131,0)
 .. Q:$P($G(^RA(72,+$P(RAXAM(0),"^",3),0)),"^",3)=0  ; cancelled xam
"RTN","RAO7PC1A",132,0)
 .. S I=0,RACMEDIA="" F  S I=$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,"CM",I)) Q:'I  S RACMEDIA=RACMEDIA_$P(^(I,0),U) ;RA*5*45
"RTN","RAO7PC1A",133,0)
 .. S RARPT=+$P(RAXAM(0),U,17)
"RTN","RAO7PC1A",134,0)
 .. S RARPTST=$$RSTAT(),RARPTST=$$UL(RARPTST)
"RTN","RAO7PC1A",135,0)
 .. S ^TMP($J,"RAE7",RADFN,RAXID)=RAPRC_U_RACSE_U_RARPTST_U_+RALOC(0)_U_RALOC_U_RACMEDIA
"RTN","RAO7PC1A",136,0)
 .. Q
"RTN","RAO7PC1A",137,0)
 . Q
"RTN","RAO7PC1A",138,0)
 Q
"RTN","RAO7PC1A",139,0)
CPTMOD ;extract cpt modifiers if any
"RTN","RAO7PC1A",140,0)
 ;RA loop var, RA1 counter, RA2 intermed vars
"RTN","RAO7PC1A",141,0)
 Q:'$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,"CMOD",0))
"RTN","RAO7PC1A",142,0)
 S RA=0,RA1=1
"RTN","RAO7PC1A",143,0)
 F  S RA=$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,"CMOD",RA)) Q:'RA  I $D(^(RA,0)) D
"RTN","RAO7PC1A",144,0)
 . S RA2=$P(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,"CMOD",RA,0),"^")
"RTN","RAO7PC1A",145,0)
 . S RA2=$$BASICMOD^RACPTMSC(RA2,+RAREX(0)) Q:+RA2<0
"RTN","RAO7PC1A",146,0)
 . S ^TMP($J,"RAE1",RADFN,RAXID,"CMOD",RA1)=$P(RA2,"^",2)_"^"_$P(RA2,"^",3),RA1=RA1+1
"RTN","RAO7PC1A",147,0)
 Q
"RTN","RAO7PC1A",148,0)
RSTAT() ; Get report status name from GET1^DIQ
"RTN","RAO7PC1A",149,0)
 ; RARPT is IEN of file 74
"RTN","RAO7PC1A",150,0)
 N R,DIERR
"RTN","RAO7PC1A",151,0)
 S R=$S($G(RARPT)>0:$$GET1^DIQ(74,+RARPT,5),1:"")
"RTN","RAO7PC1A",152,0)
 S:R="" R="NO REPORT"
"RTN","RAO7PC1A",153,0)
 Q R
"RTN","RAO7PC1A",154,0)
UL(R) ;Upper and Lower case
"RTN","RAO7PC1A",155,0)
 ;First convert all chars to lower case, then
"RTN","RAO7PC1A",156,0)
 ;capitalize 1st char AND (char after /  OR  char after blank)
"RTN","RAO7PC1A",157,0)
 N L,R2
"RTN","RAO7PC1A",158,0)
 S R2=$E(R,1)_$$LOW^XLFSTR($E(R,2,$L(R))) ; 1st char must be in caps
"RTN","RAO7PC1A",159,0)
 S L=$F(R2,"/") ; If str has /, cap char after / but not char after blank
"RTN","RAO7PC1A",160,0)
 I L S R2=$E(R2,1,L-1)_$$UP^XLFSTR($E(R2,L))_$E(R2,L+1,$L(R2)) G UPQ
"RTN","RAO7PC1A",161,0)
 S L=$F(R2," ") ; If str has one blank, then cap the char after the blank
"RTN","RAO7PC1A",162,0)
 I L S R2=$E(R2,1,L-1)_$$UP^XLFSTR($E(R2,L))_$E(R2,L+1,$L(R2))
"RTN","RAO7PC1A",163,0)
UPQ Q R2
"RTN","RAO7PC2")
0^3^B44753476^B44787869
"RTN","RAO7PC2",1,0)
RAO7PC2 ;HISC/GJC-Part two for Return Narrative (EN3^RAO7PC1);1/17/95 ;9/13/01  10:39
"RTN","RAO7PC2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,11,14,16,22,27,45,75,56**;Mar 16, 1998;Build 3
"RTN","RAO7PC2",3,0)
 ;Supported IA #10104 UP^XLFSTR
"RTN","RAO7PC2",4,0)
 ;Supported IA #2055 EXTERNAL^DILFD
"RTN","RAO7PC2",5,0)
 ;Supported IA #10060 ^VA(200
"RTN","RAO7PC2",6,0)
CASE(Y) ; Retrieve exam data for specified inverse exam date range.
"RTN","RAO7PC2",7,0)
 ; 'Y'-> Exam node IEN
"RTN","RAO7PC2",8,0)
 N RABNOR,RACNT,RAEXAM,RAI,RAIMPRES,RAINCLUD,RAOPRC,RAORD,RAPDIAG
"RTN","RAO7PC2",9,0)
 N RAPIST,RAPIRE,RAPROC,RARDE,RADTI,RACNI,RADUPHX,RAREASDY
"RTN","RAO7PC2",10,0)
 N RARPT,RARPTST,RARPTXT,RASBN,RASDIAG,RAVER,RAERRFLG,Z,Z1,Z2
"RTN","RAO7PC2",11,0)
 S RACNT=1
"RTN","RAO7PC2",12,0)
 S RAEXAM(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,0)) Q:RAEXAM(0)']""
"RTN","RAO7PC2",13,0)
 S:$P(RAEXAM(0),"^",25)=2 RAPSET=1
"RTN","RAO7PC2",14,0)
 S:RAPSET=1 ^TMP($J,"RAE2",RADFN,"PRINT_SET")="" ; xam set with same rpt
"RTN","RAO7PC2",15,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RAEXAM(0),"^",2),0))
"RTN","RAO7PC2",16,0)
 S RAPROC=$S($P(RAPROC(0),"^")]"":$P(RAPROC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",17,0)
 S RAORD(0)=$G(^RAO(75.1,+$P(RAEXAM(0),"^",11),0))
"RTN","RAO7PC2",18,0)
 S RAORD(7)=$P(RAORD(0),"^",7) ; CPRS order ien
"RTN","RAO7PC2",19,0)
 S RAREASDY=$P($G(^RAO(75.1,+$P(RAEXAM(0),"^",11),.1)),"^") ;REASON FOR STUDY
"RTN","RAO7PC2",20,0)
 S RAOPRC(0)=$G(^RAMIS(71,+$P(RAORD(0),"^",2),0))
"RTN","RAO7PC2",21,0)
 S RAOPRC=$S($P(RAOPRC(0),"^")]"":$P(RAOPRC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",22,0)
 S RAPDIAG(0)=$G(^RA(78.3,+$P(RAEXAM(0),"^",13),0))
"RTN","RAO7PC2",23,0)
 S RAPDIAG=$P(RAPDIAG(0),"^"),RARPT=+$P(RAEXAM(0),"^",17)
"RTN","RAO7PC2",24,0)
 S RARPT(0)=$G(^RARPT(RARPT,0)),RARPTST=$$UL^RAO7PC1A($$RSTAT^RAO7PC1A())
"RTN","RAO7PC2",25,0)
 ; set the following flag variable: RAINCLUD
"RTN","RAO7PC2",26,0)
 ; RAINCLUD=$S(RPT STATUS=verif'd or released/unverif'd:1,1:0)
"RTN","RAO7PC2",27,0)
 S RAINCLUD=$S("RV"[$E(RARPTST):1,1:0)
"RTN","RAO7PC2",28,0)
 I $E(RARPTST)="V",(RAPSET'<0) D
"RTN","RAO7PC2",29,0)
 . S RAVER=$P(RARPT(0),"^",9),RASBN=$P($G(^VA(200,+RAVER,20)),"^",2)
"RTN","RAO7PC2",30,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"V")=RAVER_"^"_RASBN
"RTN","RAO7PC2",31,0)
 . Q
"RTN","RAO7PC2",32,0)
 S RABNOR=$$UP^XLFSTR($P(RAPDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",33,0)
 I RAPDIAG]"",(RAINCLUD),(RAPSET'<0) D  ; if diag & verif'd or released/unverif'd & first pass if part of xam set (many xams - one rpt)
"RTN","RAO7PC2",34,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RAPDIAG
"RTN","RAO7PC2",35,0)
 . Q
"RTN","RAO7PC2",36,0)
 S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"RFS")=RAREASDY ;REASON FOR STUDY
"RTN","RAO7PC2",37,0)
 ; 1st, get clnhist from file70. 2nd, get addl clnhist form file74
"RTN","RAO7PC2",38,0)
 ; 1st:
"RTN","RAO7PC2",39,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",0)) D
"RTN","RAO7PC2",40,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",41,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z)) Q:Z'>0  D
"RTN","RAO7PC2",42,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",43,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"H",RAI)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z,0))
"RTN","RAO7PC2",44,0)
 .. Q
"RTN","RAO7PC2",45,0)
 . Q
"RTN","RAO7PC2",46,0)
 ;2nd:
"RTN","RAO7PC2",47,0)
 S RADTI=RAINVXDT,RACNI=Y D CHKDUPHX^RART1 ;chk if file74 clnhist is dupl
"RTN","RAO7PC2",48,0)
 I 'RADUPHX,$O(^RARPT(RARPT,"H",0)) S Z="H" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",49,0)
 ;
"RTN","RAO7PC2",50,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",0)) D  ; save modifiers
"RTN","RAO7PC2",51,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",52,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z)) Q:Z'>0  D
"RTN","RAO7PC2",53,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",54,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"M",RAI)=$P($G(^RAMIS(71.2,+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z,0)),0)),"^")
"RTN","RAO7PC2",55,0)
 .. Q
"RTN","RAO7PC2",56,0)
 . Q
"RTN","RAO7PC2",57,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",0)),(RAPSET'<0) D
"RTN","RAO7PC2",58,0)
 . S Z=0 F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z)) Q:Z'>0  D
"RTN","RAO7PC2",59,0)
 .. S RASDIAG=+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z,0))
"RTN","RAO7PC2",60,0)
 .. S RASDIAG(0)=$G(^RA(78.3,RASDIAG,0)),RASDIAG(1)=$P(RASDIAG(0),"^")
"RTN","RAO7PC2",61,0)
 .. I RASDIAG(1)]"",(RAINCLUD) D
"RTN","RAO7PC2",62,0)
 ... S RACNT=RACNT+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RASDIAG(1)
"RTN","RAO7PC2",63,0)
 ... I RABNOR'="Y" D
"RTN","RAO7PC2",64,0)
 .... S RABNOR=$$UP^XLFSTR($P(RASDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",65,0)
 .... Q
"RTN","RAO7PC2",66,0)
 ... Q
"RTN","RAO7PC2",67,0)
 .. Q
"RTN","RAO7PC2",68,0)
 . Q
"RTN","RAO7PC2",69,0)
 I RAINCLUD,(RAPSET'<0) D
"RTN","RAO7PC2",70,0)
 . I +$O(^RARPT(RARPT,"I",0)) S Z="I" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",71,0)
 . I +$O(^RARPT(RARPT,"R",0)) S Z="R" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",72,0)
 . Q
"RTN","RAO7PC2",73,0)
 I $P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD")=RAOPRC
"RTN","RAO7PC2",74,0)
 I '$P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD",Y)=RAOPRC
"RTN","RAO7PC2",75,0)
 ;
"RTN","RAO7PC2",76,0)
 ; Check to see if amended report
"RTN","RAO7PC2",77,0)
 I RAPSET'<0,+$O(^RARPT(RARPT,"ERR",0)) S RAERRFLG="A"
"RTN","RAO7PC2",78,0)
 ;
"RTN","RAO7PC2",79,0)
 S:RAPSET'<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=RARPTST_"^"_$G(RABNOR)_"^"_$G(RAORD(7))_"^"_$G(RAERRFLG)
"RTN","RAO7PC2",80,0)
 S:RAPSET<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=""
"RTN","RAO7PC2",81,0)
 S:RAPSET=1 RAPSET=-1
"RTN","RAO7PC2",82,0)
 ;
"RTN","RAO7PC2",83,0)
 I RARPTST'="No Report" D
"RTN","RAO7PC2",84,0)
 .; Add Prim Int Staff, Prim Int Resident & Reported Date
"RTN","RAO7PC2",85,0)
 .S RAPIST=$P(RAEXAM(0),"^",15)
"RTN","RAO7PC2",86,0)
 .S RAPIRE=$P(RAEXAM(0),"^",12)
"RTN","RAO7PC2",87,0)
 .S RARDE=$P(RARPT(0),"^",8)
"RTN","RAO7PC2",88,0)
 .S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"P")=RAPIST_"^"_RAPIRE_"^"_RARDE
"RTN","RAO7PC2",89,0)
 ;If contrast media was involved in the exam pass that information.
"RTN","RAO7PC2",90,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",0)) S (RACNT,RAI)=0 D
"RTN","RAO7PC2",91,0)
 .F  S RAI=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI)) Q:'RAI  D
"RTN","RAO7PC2",92,0)
 ..S RACNT=RACNT+1
"RTN","RAO7PC2",93,0)
 ..S RAI(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI,0))
"RTN","RAO7PC2",94,0)
 ..S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"CM",RACNT)=$P(RAI(0),U)_"^"_$$EXTERNAL^DILFD(70.3225,.01,"",$P(RAI(0),U))
"RTN","RAO7PC2",95,0)
 ..Q
"RTN","RAO7PC2",96,0)
 Q
"RTN","RAO7PC2",97,0)
 ;
"RTN","RAO7PC2",98,0)
RPTXT(RARPT,Z) ; Retrieve report text & store in ^TMP
"RTN","RAO7PC2",99,0)
 ; 'RARPT' -> Report IEN
"RTN","RAO7PC2",100,0)
 ; 'Z'     -> "I":Impression Text <> "R":Report Text
"RTN","RAO7PC2",101,0)
 S (Z1,Z2)=0
"RTN","RAO7PC2",102,0)
 ;file 74's "H" nodes are now additional clinical history
"RTN","RAO7PC2",103,0)
 I Z="H" S Z2=$O(^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,""),-1) I $O(^RARPT(RARPT,Z,Z1)) S Z2=Z2+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)="Additional Clinical History:"
"RTN","RAO7PC2",104,0)
 F  S Z1=$O(^RARPT(RARPT,Z,Z1)) Q:Z1'>0  D
"RTN","RAO7PC2",105,0)
 . S Z1(0)=$G(^RARPT(RARPT,Z,Z1,0)),Z2=Z2+1
"RTN","RAO7PC2",106,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)=Z1(0)
"RTN","RAO7PC2",107,0)
 . Q
"RTN","RAO7PC2",108,0)
 Q
"RTN","RAO7PC2",109,0)
 ;
"RTN","RAO7PC2",110,0)
CLIN(DFN,PROCLIST) ;Radiology and Clinical Reminders API
"RTN","RAO7PC2",111,0)
 ;
"RTN","RAO7PC2",112,0)
 ; Created by Cameron Taylor March 1999
"RTN","RAO7PC2",113,0)
 ; 
"RTN","RAO7PC2",114,0)
 ; This API recieves a patient and a list of procedures. For each 
"RTN","RAO7PC2",115,0)
 ; Procedure, the details of the last 'complete' procedure and/or the
"RTN","RAO7PC2",116,0)
 ; last 'cancelled' & 'in progress' procedure details and returns them 
"RTN","RAO7PC2",117,0)
 ; in ^TMP($J,"RADPROC"
"RTN","RAO7PC2",118,0)
 N XX,PROC,DATE,STATUS,PROVIDER,EXAM,X,Y,EXAMIEN,RADPTIEN,ORDER,SUCCESS
"RTN","RAO7PC2",119,0)
 ; 
"RTN","RAO7PC2",120,0)
 S DFN=$G(DFN)  ; Patient Name
"RTN","RAO7PC2",121,0)
 S PROCLIST=$G(PROCLIST)  ; List of Procedures (separated by '^')
"RTN","RAO7PC2",122,0)
 K ^TMP($J,"RADPROC")
"RTN","RAO7PC2",123,0)
 ;
"RTN","RAO7PC2",124,0)
 S RADPTIEN=$O(^RADPT("B",DFN,""))
"RTN","RAO7PC2",125,0)
 I (RADPTIEN="")!(RADPTIEN=0) D  Q
"RTN","RAO7PC2",126,0)
 .S ^TMP($J,"RADPROC")="Invalid/Unknown Radiology Patient"
"RTN","RAO7PC2",127,0)
 ;
"RTN","RAO7PC2",128,0)
 F XX=1:1 S PROC=$P(PROCLIST,U,XX) Q:PROC=""  D
"RTN","RAO7PC2",129,0)
 .S SUCCESS=0  ; Quit searching if SUCCESS=3 (comp, canc & in prog)
"RTN","RAO7PC2",130,0)
 .S DATE=0 F  S DATE=$O(^RADPT(RADPTIEN,"DT",DATE)) Q:DATE'?7N1".".N!(SUCCESS=3)  D
"RTN","RAO7PC2",131,0)
 ..S EXAMIEN=0 F  S EXAMIEN=$O(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN)) Q:'EXAMIEN!(SUCCESS=3)  D
"RTN","RAO7PC2",132,0)
 ...S EXAM=$G(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN,0))
"RTN","RAO7PC2",133,0)
 ...Q:$P(EXAM,U,2)'=PROC
"RTN","RAO7PC2",134,0)
 ...;
"RTN","RAO7PC2",135,0)
 ...; Continue, get STATUS and ORDER 
"RTN","RAO7PC2",136,0)
 ...; (0 is cancelled, 1-8 in progress & 9 is COMPLETE)
"RTN","RAO7PC2",137,0)
 ...; (ignore if null)
"RTN","RAO7PC2",138,0)
 ...;
"RTN","RAO7PC2",139,0)
 ...S STATUS=$P(EXAM,U,3)
"RTN","RAO7PC2",140,0)
 ...I STATUS'="" D
"RTN","RAO7PC2",141,0)
 ....S ORDER=$P(^RA(72,STATUS,0),U,3)
"RTN","RAO7PC2",142,0)
 ....S STATUS=$P(^RA(72,STATUS,0),U) ; description
"RTN","RAO7PC2",143,0)
 ...; 
"RTN","RAO7PC2",144,0)
 ...; Only one of each type (ORDER)
"RTN","RAO7PC2",145,0)
 ...;
"RTN","RAO7PC2",146,0)
 ...Q:ORDER=""
"RTN","RAO7PC2",147,0)
 ...I ORDER=0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"CANCELLED"))  S ORDER="CANCELLED"
"RTN","RAO7PC2",148,0)
 ...I ORDER=9 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"COMPLETE"))  S ORDER="COMPLETE"
"RTN","RAO7PC2",149,0)
 ...I ORDER<9,ORDER>0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"IN PROGRESS"))  S ORDER="IN PROGRESS"
"RTN","RAO7PC2",150,0)
 ...;
"RTN","RAO7PC2",151,0)
 ...; Now for the PROVIDER. Check PRIMARY INTERPRETING STAFF 
"RTN","RAO7PC2",152,0)
 ...; if none, then default to PRIMARY INTERPRETING RESIDENT.
"RTN","RAO7PC2",153,0)
 ...;
"RTN","RAO7PC2",154,0)
 ...S PROVIDER=$P(EXAM,U,15)
"RTN","RAO7PC2",155,0)
 ...S:PROVIDER="" PROVIDER=$P(EXAM,U,12)
"RTN","RAO7PC2",156,0)
 ...S:PROVIDER'="" PROVIDER=$P($G(^VA(200,PROVIDER,0)),U,1) ; description
"RTN","RAO7PC2",157,0)
 ...;
"RTN","RAO7PC2",158,0)
 ...; Create return info. on ^TMP (1st manipulate DATE)
"RTN","RAO7PC2",159,0)
 ...;
"RTN","RAO7PC2",160,0)
 ...S Y=9999999.9999-DATE
"RTN","RAO7PC2",161,0)
 ...S ^TMP($J,"RADPROC",RADPTIEN,PROC,ORDER)=Y_U_STATUS_U_PROVIDER
"RTN","RAO7PC2",162,0)
 ...S SUCCESS=SUCCESS+1
"RTN","RAO7PC2",163,0)
 .;
"RTN","RAO7PC2",164,0)
 .; Finished searching Patient file. Any Procedures with no activity?
"RTN","RAO7PC2",165,0)
 .;
"RTN","RAO7PC2",166,0)
 .I '$D(^TMP($J,"RADPROC",RADPTIEN,PROC)) S ^TMP($J,"RADPROC",RADPTIEN,PROC,"NONE")=""
"RTN","RAO7PC2",167,0)
 Q
"RTN","RAO7PC2",168,0)
 ;
"RTN","RAO7PC3")
0^4^B41860849^B42609919
"RTN","RAO7PC3",1,0)
RAO7PC3 ;HISC/SWM&CRT-Procedure Call utilities. ;7/30/01  10:28
"RTN","RAO7PC3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**16,26,27,56**;Mar 16, 1998;Build 3
"RTN","RAO7PC3",3,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RAO7PC3",4,0)
 ;Supported IA 10104 UP^XLFSTR
"RTN","RAO7PC3",5,0)
 ;; api to return entire report (same as auto e-mail's)
"RTN","RAO7PC3",6,0)
EN3(X) ; Return narrative text for exam(s)
"RTN","RAO7PC3",7,0)
 ; Input:
"RTN","RAO7PC3",8,0)
 ; X-> Exam id in one of two forms:
"RTN","RAO7PC3",9,0)
 ;   1) Pat. DFN^inv. exam date^Case IEN
"RTN","RAO7PC3",10,0)
 ;      Retrieves a single report for a single exam
"RTN","RAO7PC3",11,0)
 ;   2) Pat. DFN^inv. exam date^
"RTN","RAO7PC3",12,0)
 ;      Retrieves all reports for a set of exams ordered on one order
"RTN","RAO7PC3",13,0)
 ;
"RTN","RAO7PC3",14,0)
 ; Note:  Input delimiter can be any of the following: ^~\&;-
"RTN","RAO7PC3",15,0)
 ;        a delimiter may be a single space i.e, " "
"RTN","RAO7PC3",16,0)
 ;
"RTN","RAO7PC3",17,0)
 ; Output:
"RTN","RAO7PC3",18,0)
 ; ^TMP($J,"RAE3",Patient IEN,case IEN,procedure name)=report status^
"RTN","RAO7PC3",19,0)
 ; abnormal alert^CPRS Order ien
"RTN","RAO7PC3",20,0)
 ; ^TMP($J,"RAE3",Patient IEN,case IEN,procedure name,n)=line n of rpt
"RTN","RAO7PC3",21,0)
 ; ^TMP($J,"RAE3",Patient IEN,"PRINT_SET")=null (IF this is a printset)
"RTN","RAO7PC3",22,0)
 ; ^TMP($J,"RAE3",Patient IEN,"ORD")=name of ordered procedure for
"RTN","RAO7PC3",23,0)
 ; examsets and printsets
"RTN","RAO7PC3",24,0)
 ; ^TMP($J,"RAE3",Patient IEN,"ORD",case IEN)=name of ordered procedure
"RTN","RAO7PC3",25,0)
 ; for that case; not part of an examset or printset
"RTN","RAO7PC3",26,0)
 ;
"RTN","RAO7PC3",27,0)
 ;
"RTN","RAO7PC3",28,0)
 K ^TMP($J,"RAE3"),^TMP($J,"RA AUTOE")
"RTN","RAO7PC3",29,0)
 K RAU S RAU=$$DEL^RAO7PC1(X) I RAU="" K RAU Q
"RTN","RAO7PC3",30,0)
 Q:'$P(X,RAU)!('$P(X,RAU,2))  ; Quit if no Pat. DFN -or- no inv. exam DT
"RTN","RAO7PC3",31,0)
 N RACIEN,RADFN,RAINVXDT,RAPSET,RAUTOE,Y S RAPSET=0
"RTN","RAO7PC3",32,0)
 S RADFN=$P(X,RAU),RAINVXDT=$P(X,RAU,2),RACIEN=+$P(X,RAU,3)
"RTN","RAO7PC3",33,0)
 K RAU Q:'($D(^RADPT(RADFN,"DT",RAINVXDT,0))#2)
"RTN","RAO7PC3",34,0)
 I RACIEN D CASE(RACIEN) Q
"RTN","RAO7PC3",35,0)
 S Y=0
"RTN","RAO7PC3",36,0)
 F  S Y=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y)) Q:Y'>0  D
"RTN","RAO7PC3",37,0)
 . D CASE(Y) S RAPSET=0
"RTN","RAO7PC3",38,0)
 . Q
"RTN","RAO7PC3",39,0)
 Q
"RTN","RAO7PC3",40,0)
EN30(RAOIFN) ; Return narrative text for exam(s).  
"RTN","RAO7PC3",41,0)
 ; To be used with the EN3 entry point above.
"RTN","RAO7PC3",42,0)
 ;
"RTN","RAO7PC3",43,0)
 ; Input: RAOIFN -> the ien of Rad/Nuc Med Order
"RTN","RAO7PC3",44,0)
 ;
"RTN","RAO7PC3",45,0)
 Q:'RAOIFN  ; order passed in as 0 or null
"RTN","RAO7PC3",46,0)
 Q:'$D(^RAO(75.1,RAOIFN,0))  ; no such order
"RTN","RAO7PC3",47,0)
 Q:'$D(^RADPT("AO",RAOIFN))  ; no exam associated with this order
"RTN","RAO7PC3",48,0)
 N RADFN,RADTI,RACNI,RAXSET
"RTN","RAO7PC3",49,0)
 S RADFN=+$O(^RADPT("AO",RAOIFN,0)) Q:'RADFN
"RTN","RAO7PC3",50,0)
 S RADTI=+$O(^RADPT("AO",RAOIFN,RADFN,0)) Q:'RADTI
"RTN","RAO7PC3",51,0)
 S RAXSET=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),"^",5) ; set if RAXSET=1
"RTN","RAO7PC3",52,0)
 I RAXSET D EN3(RADFN_"^"_RADTI_"^") Q  ; exam set, hit EN3 code
"RTN","RAO7PC3",53,0)
 ; the following code is executed for non-exam set examinations
"RTN","RAO7PC3",54,0)
 S RACNI=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI,0)) Q:'RACNI
"RTN","RAO7PC3",55,0)
 D EN3(RADFN_"^"_RADTI_"^"_RACNI)
"RTN","RAO7PC3",56,0)
 Q
"RTN","RAO7PC3",57,0)
CASE(Y) ;
"RTN","RAO7PC3",58,0)
 N N,RABNOR,RACASE,RACIEN,RADIAG,RAEXAM,RAINCLUD,RAOPRC,RAORD,BLANK
"RTN","RAO7PC3",59,0)
 N RAMSG,RAPDIAG,RAPROC,RARDE,RARPT,RARPTST,RASPACE,SKIP,X,ZZRADFN,X0,X1,X2,RASIGVES,RARPTST2
"RTN","RAO7PC3",60,0)
 ;
"RTN","RAO7PC3",61,0)
 S RACIEN=Y,$P(BLANK," ",80)=""
"RTN","RAO7PC3",62,0)
 S RAEXAM(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",RACIEN,0)) Q:RAEXAM(0)']""
"RTN","RAO7PC3",63,0)
 S RACASE=$P(RAEXAM(0),"^")
"RTN","RAO7PC3",64,0)
 S:$P(RAEXAM(0),"^",25)=2 RAPSET=1
"RTN","RAO7PC3",65,0)
 S:RAPSET=1 ^TMP($J,"RAE3",RADFN,"PRINT_SET")=""
"RTN","RAO7PC3",66,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RAEXAM(0),"^",2),0))
"RTN","RAO7PC3",67,0)
 S RAPROC=$S($P(RAPROC(0),"^")]"":$P(RAPROC(0),"^"),1:"Unknown")
"RTN","RAO7PC3",68,0)
 S RAORD(0)=$G(^RAO(75.1,+$P(RAEXAM(0),"^",11),0))
"RTN","RAO7PC3",69,0)
 S RAORD(7)=$P(RAORD(0),"^",7)
"RTN","RAO7PC3",70,0)
 S RAOPRC(0)=$G(^RAMIS(71,+$P(RAORD(0),"^",2),0))
"RTN","RAO7PC3",71,0)
 S RAOPRC=$S($P(RAOPRC(0),"^")]"":$P(RAOPRC(0),"^"),1:"Unknown")
"RTN","RAO7PC3",72,0)
 S RAPDIAG(0)=$G(^RA(78.3,+$P(RAEXAM(0),"^",13),0))
"RTN","RAO7PC3",73,0)
 S RARPT=+$P(RAEXAM(0),"^",17),RARPTST2=$$UL^RAO7PC1A($$RSTAT^RAO7PC1A())
"RTN","RAO7PC3",74,0)
 S RARPT(0)=$G(^RARPT(RARPT,0)),RARPTST=$P(RARPT(0),"^",5)
"RTN","RAO7PC3",75,0)
 S RASIGVES="" I RARPTST="V",$P(RARPT(0),U,10)]"",$P(RARPT(0),U,9)]"" S X2=RARPT,X1=$P(RARPT(0),U,9),X=$P(RARPT(0),U,10) D DE^XUSHSHP S:X]"" RASIGVES="/ES/"_X
"RTN","RAO7PC3",76,0)
 S RARDE=$$GET1^DIQ(74,RARPT_",",8,"E")
"RTN","RAO7PC3",77,0)
 ; View whole report if Rad User or status is R or V.
"RTN","RAO7PC3",78,0)
 D CHKUSR^RAUTL2 S RAINCLUD=RAMSG
"RTN","RAO7PC3",79,0)
 S RAINCLUD=$S(RAMSG:1,RARPTST="V":1,RARPTST="R":1,1:0)
"RTN","RAO7PC3",80,0)
 S RABNOR=$$UP^XLFSTR($P(RAPDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC3",81,0)
 ;
"RTN","RAO7PC3",82,0)
 I $P(RAEXAM(0),"^",25) S ^TMP($J,"RAE3",RADFN,"ORD")=RAOPRC
"RTN","RAO7PC3",83,0)
 I '$P(RAEXAM(0),"^",25) S ^TMP($J,"RAE3",RADFN,"ORD",RACIEN)=RAOPRC
"RTN","RAO7PC3",84,0)
 ;
"RTN","RAO7PC3",85,0)
 I RAPSET'<0 D
"RTN","RAO7PC3",86,0)
 .S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC)="^"_RABNOR_"^"_RAORD(7)
"RTN","RAO7PC3",87,0)
 .S $P(^TMP($J,"RAE3",RADFN,RACIEN,RAPROC),"^")=RARPTST2
"RTN","RAO7PC3",88,0)
 S:RAPSET<0 ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC)=""
"RTN","RAO7PC3",89,0)
 S:RAPSET=1 RAPSET=-1
"RTN","RAO7PC3",90,0)
 ;
"RTN","RAO7PC3",91,0)
 ; Setup variables then call ^RARTR to create Rad Report on ^TMP nodes
"RTN","RAO7PC3",92,0)
 ; 2 stages: INIT^RARTR creates header info, PRT1^RARTR for the report
"RTN","RAO7PC3",93,0)
 ; (save RADFN as RARTR kills it at the end)
"RTN","RAO7PC3",94,0)
 ;
"RTN","RAO7PC3",95,0)
 S RAUTOE=1,ZZRADFN=RADFN,RAACNT=0
"RTN","RAO7PC3",96,0)
 S X="^"_RADFN_"^"_(9999999.9999-RAINVXDT)_"^"_RACASE_"^"_RARPTST
"RTN","RAO7PC3",97,0)
 ;
"RTN","RAO7PC3",98,0)
 D INIT^RARTR
"RTN","RAO7PC3",99,0)
 S (RAFFLF,RAORIOF)=$G(IOF)
"RTN","RAO7PC3",100,0)
 I RAY0<0!(RAY1<0)!(RAY2<0)!(RAY3<0) K RAFFLF Q
"RTN","RAO7PC3",101,0)
 ;
"RTN","RAO7PC3",102,0)
 S RAVERF=0
"RTN","RAO7PC3",103,0)
 I RARPTST2="No Report" D
"RTN","RAO7PC3",104,0)
 .S:'$D(RAMDIV) RAMDIV=+$P(^RADPT(RADFN,"DT",RAINVXDT,0),"^",3)
"RTN","RAO7PC3",105,0)
 .S:'$D(RAMDV) RAMDV=$S($D(^RA(79,RAMDIV,.1)):^(.1),1:""),RAMDV=$TR(RAMDV,"YNyn","1010")
"RTN","RAO7PC3",106,0)
 D PRT1^RARTR
"RTN","RAO7PC3",107,0)
 S RADFN=ZZRADFN
"RTN","RAO7PC3",108,0)
 Q:'$D(^TMP($J,"RA AUTOE"))
"RTN","RAO7PC3",109,0)
 ;
"RTN","RAO7PC3",110,0)
 ; Now manipulate ^TMP($J,"RA AUTOE" and save as ^TMP($J,"RAE3"
"RTN","RAO7PC3",111,0)
 ; Step 1: Change Case Number to Exam Date
"RTN","RAO7PC3",112,0)
 ; Step 2: Remove Impression, Report & Diagnostic Codes if not
"RTN","RAO7PC3",113,0)
 ;         Released or Verified
"RTN","RAO7PC3",114,0)
 ;         Also remove "Att Phys" and "Pri Phys"
"RTN","RAO7PC3",115,0)
 ; Step 3: Change Status to Report Status & add Reported Date
"RTN","RAO7PC3",116,0)
 ; Step 4: If No Report then get Clin History from file #70.
"RTN","RAO7PC3",117,0)
 ; ** WITH PATCH 27 - NO LONGER NEED TO DO STEP 4 **
"RTN","RAO7PC3",118,0)
 ;
"RTN","RAO7PC3",119,0)
STEP1 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,1)=$P(^TMP($J,"RA AUTOE",1),"Case: ")
"RTN","RAO7PC3",120,0)
 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,1.5)="Exm Date: "_$$GET1^DIQ(70.02,RAINVXDT_","_RADFN_",",.01,"E")
"RTN","RAO7PC3",121,0)
 ;
"RTN","RAO7PC3",122,0)
STEP2 K SKIP S N=1 F  S N=$O(^TMP($J,"RA AUTOE",N)) Q:N=""  D
"RTN","RAO7PC3",123,0)
 . S X0=^TMP($J,"RA AUTOE",N),X1=$E(X0,1,10)
"RTN","RAO7PC3",124,0)
 . I (X1="Att Phys: ")!(X1="Pri Phys: ") D
"RTN","RAO7PC3",125,0)
 .. S ^TMP($J,"RA AUTOE",N)=$E(BLANK,1,41)_$E(X0,42,$L(X0))
"RTN","RAO7PC3",126,0)
 .. Q
"RTN","RAO7PC3",127,0)
 .;I RARPTST2="No Report",($E(^TMP($J,"RA AUTOE",N),1,21)="    Clinical History:") D STEP4
"RTN","RAO7PC3",128,0)
 .I $E(^TMP($J,"RA AUTOE",N),1,12)="    Report: " D STEP3 Q:RARPTST2="No Report"
"RTN","RAO7PC3",129,0)
 .I 'RAINCLUD,$E(^TMP($J,"RA AUTOE",N),1,15)="    Impression:" D
"RTN","RAO7PC3",130,0)
 ..S SKIP=1,^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N+0.1)=""
"RTN","RAO7PC3",131,0)
 .I 'RAINCLUD,$E(^TMP($J,"RA AUTOE",N),1,28)="    Primary Diagnostic Code:" D
"RTN","RAO7PC3",132,0)
 ..S SKIP=1 S ^TMP($J,"RA AUTOE",N)=$E(^TMP($J,"RA AUTOE",N),1,28)
"RTN","RAO7PC3",133,0)
 .I 'RAINCLUD,$E(^TMP($J,"RA AUTOE",N),1,31)="    Secondary Diagnostic Codes:" D
"RTN","RAO7PC3",134,0)
 ..S SKIP=1,^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N+0.1)=""
"RTN","RAO7PC3",135,0)
 .I $E(^TMP($J,"RA AUTOE",N),1,27)="Primary Interpreting Staff:" K SKIP
"RTN","RAO7PC3",136,0)
 .I $D(SKIP) S SKIP=SKIP+1
"RTN","RAO7PC3",137,0)
 .I $G(SKIP)<3 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N)=^TMP($J,"RA AUTOE",N)
"RTN","RAO7PC3",138,0)
 .Q
"RTN","RAO7PC3",139,0)
 ;
"RTN","RAO7PC3",140,0)
XIT K ^TMP($J,"RA AUTOE")
"RTN","RAO7PC3",141,0)
 Q
"RTN","RAO7PC3",142,0)
 ;
"RTN","RAO7PC3",143,0)
STEP3 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.4)="    Report Status: "_RARPTST2
"RTN","RAO7PC3",144,0)
 I RARPTST2="No Report" S N="^" Q
"RTN","RAO7PC3",145,0)
 S $P(RASPACE," ",46)=""
"RTN","RAO7PC3",146,0)
 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.4)=^(N-0.4)_$E(RASPACE,1,46-$L(^(N-0.4)))_"Date Reported: "_RARDE
"RTN","RAO7PC3",147,0)
 I RARPTST="V" D
"RTN","RAO7PC3",148,0)
 . S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.3)=RASPACE_" Date Verified: "_$P($$GET1^DIQ(74,+$P(RAEXAM(0),"^",17),7),"@")
"RTN","RAO7PC3",149,0)
 . S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.2)="    Verifier E-Sig:"_RASIGVES
"RTN","RAO7PC3",150,0)
 . Q
"RTN","RAO7PC3",151,0)
 S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N-0.1)=""
"RTN","RAO7PC3",152,0)
 S ^TMP($J,"RA AUTOE",N)="    Report:"
"RTN","RAO7PC3",153,0)
 I 'RAINCLUD S SKIP=1,^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,N+0.1)=""
"RTN","RAO7PC3",154,0)
 Q
"RTN","RAO7PC3",155,0)
 ;
"RTN","RAO7PC3",156,0)
STEP4 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",RACIEN,"H",0)) D
"RTN","RAO7PC3",157,0)
 .N RAI,RAIN,Z S (RAI,Z)=0,RAIN=N_".000"
"RTN","RAO7PC3",158,0)
 .F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",RACIEN,"H",Z)) Q:Z'>0  D
"RTN","RAO7PC3",159,0)
 ..S RAI=RAI+1
"RTN","RAO7PC3",160,0)
 ..S RAIN=$E(RAIN,1,$L(RAIN)-$L(RAI))_RAI
"RTN","RAO7PC3",161,0)
 ..S ^TMP($J,"RAE3",RADFN,RACIEN,RAPROC,RAIN)="      "_$G(^RADPT(RADFN,"DT",RAINVXDT,"P",RACIEN,"H",Z,0))
"RTN","RAO7PC3",162,0)
 Q
"RTN","RAPCE")
0^5^B46739141^B45053281
"RTN","RAPCE",1,0)
RAPCE ;HIRMFO/GJC-Interface with PCE APIs for wrkload, visits ;9/7/04 12:36pm
"RTN","RAPCE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,17,21,26,41,57,56**;Mar 16, 1998;Build 3
"RTN","RAPCE",3,0)
 ;Supported IA #2053 FILE^DIE
"RTN","RAPCE",4,0)
 ;Supported IA #4663 SWSTAT^IBBAPI
"RTN","RAPCE",5,0)
 ;Controlled IA #1889 DATA2PCE^PXAPI
"RTN","RAPCE",6,0)
 Q
"RTN","RAPCE",7,0)
COMPLETE(RADFN,RADTI,RACNI) ; When an exam status changes to 'complete'
"RTN","RAPCE",8,0)
 ; Input: RADFN-> Patient DFN, RADTI-> Exam Timestamp, RACNI-> Case IEN
"RTN","RAPCE",9,0)
 ; NOTE:  RACNI input param is ignored for exam sets (all cases under
"RTN","RAPCE",10,0)
 ; an exam set are processed at once when order is complete)
"RTN","RAPCE",11,0)
 ; $$DATA2PCE^PXAPI returns: 1 if no errors, else error condition
"RTN","RAPCE",12,0)
 ;
"RTN","RAPCE",13,0)
 K ^TMP("DIERR",$J),^TMP("RAPXAPI",$J)
"RTN","RAPCE",14,0)
 N RA7002,RA7003,RA71,RA791,RACNT,RADTE,RAEARRY,RAPKG,RAVSIT,RABAD,RASTAT,RACPTM,RA,RA1,RARECMPL,RACNISAV
"RTN","RAPCE",15,0)
 N RADUPRC,RACOMIEN,RASENT,RALCKFAL
"RTN","RAPCE",16,0)
 S RALCKFAL=0 ; >0 if lock fails when :
"RTN","RAPCE",17,0)
 ; 1= complt'g exam that's unique to other cases same dt/tm, if any
"RTN","RAPCE",18,0)
 ; 2= complt'g exam that's a dupl of another cmplt'd exam (RESEND^RAPCE1)
"RTN","RAPCE",19,0)
 ; 3= UNcompleting exam before deleting credit+visit pointers same dt/tm
"RTN","RAPCE",20,0)
 S RAPKG=$O(^DIC(9.4,"B","RADIOLOGY/NUCLEAR MEDICINE",0))
"RTN","RAPCE",21,0)
 S RADTE=9999999.9999-RADTI,RACNT=0
"RTN","RAPCE",22,0)
 S RA7002=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAPCE",23,0)
 S RAXAMSET=+$P(RA7002,"^",5) ; is this part of an exam set? 1=YES
"RTN","RAPCE",24,0)
EN2 S RA791=$G(^RA(79.1,+$P(RA7002,"^",4),0))
"RTN","RAPCE",25,0)
 ; Initialize variables required for PFSS 1B project and check the switch status.
"RTN","RAPCE",26,0)
 N RAPFSW,RACCOUNT S RAPFSW=$$SWSTAT^IBBAPI ; Requirement 12
"RTN","RAPCE",27,0)
 Q:+$P(RA791,"^",21)=2  ; no credit, quit
"RTN","RAPCE",28,0)
 S RAEARRY="RAERROR" N @RAEARRY
"RTN","RAPCE",29,0)
LON ; lock at P level
"RTN","RAPCE",30,0)
 L +^RADPT(RADFN,"DT",RADTI,"P",RACNI):30 I '$T S RALCKFAL=1 D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ)) Q
"RTN","RAPCE",31,0)
 I 'RAXAMSET G NONSET
"RTN","RAPCE",32,0)
 ; exam set, grab all the completed records!
"RTN","RAPCE",33,0)
 S RACNISAV=RACNI
"RTN","RAPCE",34,0)
 S RACNI=0
"RTN","RAPCE",35,0)
 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0!($G(RABAD))  D
"RTN","RAPCE",36,0)
 . S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) I $P($G(^RA(72,+$P(RA7003,U,3),0)),U,3)'=9 Q  ;check code instead of name
"RTN","RAPCE",37,0)
 . S RACNT=RACNT+1 D SETUP I $G(RABAD) Q
"RTN","RAPCE",38,0)
 . D:'$D(^TMP("RAPXAPI",$J,"ENCOUNTER")) ENC(RACNT)
"RTN","RAPCE",39,0)
 . D DX^RABWPCE($P(RA7003,U,11)) ; Ordering ICD Dx and related data.
"RTN","RAPCE",40,0)
 . D PROC(RACNT)
"RTN","RAPCE",41,0)
 . Q
"RTN","RAPCE",42,0)
 S RACNI=RACNISAV ;restore value so unlock would work 012601
"RTN","RAPCE",43,0)
 I '$G(RABAD),$D(^TMP("RAPXAPI",$J)) D PCE(RADFN,RADTI,RACNI)
"RTN","RAPCE",44,0)
 ;Missing data, send failure bulletin for ea case in set, don't attempt to send data to PCE
"RTN","RAPCE",45,0)
 I $G(RABAD) W:'$D(ZTQUEUED)&('$D(RARECMPL)) !,"Unable to credit Exam set" D
"RTN","RAPCE",46,0)
 . S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0  D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ))
"RTN","RAPCE",47,0)
 G KOUT
"RTN","RAPCE",48,0)
NONSET ; non-exam sets
"RTN","RAPCE",49,0)
 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPCE",50,0)
 D CKDUP^RAPCE1 ; chk for duplicate procedure(s) non-examset
"RTN","RAPCE",51,0)
 I $G(RADUPRC) D RESEND^RAPCE1 G KOUT ; branch off to re-send rec(s) this dt/tm
"RTN","RAPCE",52,0)
 S RACNT=RACNT+1
"RTN","RAPCE",53,0)
 D SETUP
"RTN","RAPCE",54,0)
 D:'$G(RABAD) ENC(RACNT) D:'$G(RABAD) DX^RABWPCE($P(RA7003,U,11)) D:'$G(RABAD) PROC(RACNT) D:'$G(RABAD) PCE(RADFN,RADTI,RACNI)
"RTN","RAPCE",55,0)
 I $G(RABAD) W:'$D(ZTQUEUED)&('$D(RARECMPL)) !,"Unable to credit exam" D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ)) ;Missing data, send failure bulletin for single case, don't attempt to pass data to PCE
"RTN","RAPCE",56,0)
 ;
"RTN","RAPCE",57,0)
KOUT K ^TMP("RAPXAPI",$J)
"RTN","RAPCE",58,0)
 L -^RADPT(RADFN,"DT",RADTI,"P",RACNI)
"RTN","RAPCE",59,0)
 Q
"RTN","RAPCE",60,0)
ENC(X) ; Set up the '"RAPXAPI",$J,"ENCOUNTER"' nodes
"RTN","RAPCE",61,0)
 N RAIMGLOC,RA17,RARPTLOC
"RTN","RAPCE",62,0)
 S RA17=+$P(RA7003,U,17)
"RTN","RAPCE",63,0)
 S RARPTLOC=$P($G(^RARPT(RA17,"BA")),U,1)
"RTN","RAPCE",64,0)
 S RAIMGLOC=$P($G(^RA(79.1,+RARPTLOC,0)),"^")
"RTN","RAPCE",65,0)
 S:'RAIMGLOC RAIMGLOC=$P($G(^RA(79.1,+$P(RA7002,"^",4),0)),"^")
"RTN","RAPCE",66,0)
 I RAIMGLOC="" S RABAD=1 Q  ; needs imaging location
"RTN","RAPCE",67,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"PATIENT")=RADFN
"RTN","RAPCE",68,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"ENC D/T")=RADTE
"RTN","RAPCE",69,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"HOS LOC")=RAIMGLOC
"RTN","RAPCE",70,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"SERVICE CATEGORY")="X"
"RTN","RAPCE",71,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"ENCOUNTER TYPE")="A"
"RTN","RAPCE",72,0)
 Q
"RTN","RAPCE",73,0)
PCE(RADFN,RADTI,RACNI) ; Pass on the information to the PCE software
"RTN","RAPCE",74,0)
 N RASULT
"RTN","RAPCE",75,0)
 ; If the PFSS switch is not active then do not pass RACCOUNT parameter to DATA2PCE call.
"RTN","RAPCE",76,0)
 I 'RAPFSW S RASULT=$$DATA2PCE^PXAPI("^TMP(""RAPXAPI"",$J)",RAPKG,"RAD/NUC MED",.RAVSIT,"","","","",.@RAEARRY)
"RTN","RAPCE",77,0)
 ; If the PFSS switch is active then use RACCOUNT parameter in DATA2PCE call.
"RTN","RAPCE",78,0)
 I RAPFSW D
"RTN","RAPCE",79,0)
 . ; PFSS Requirement 6, 11
"RTN","RAPCE",80,0)
 . S RASULT=$$DATA2PCE^PXAPI("^TMP(""RAPXAPI"",$J)",RAPKG,"RAD/NUC MED",.RAVSIT,"","","","",.@RAEARRY,.RACCOUNT)
"RTN","RAPCE",81,0)
 . Q
"RTN","RAPCE",82,0)
 I (RASULT=1)!(RASULT=-1) D  ;Visit file pointer, set 'Credit recorded' to yes. 
"RTN","RAPCE",83,0)
 . W:'$D(ZTQUEUED)&('$D(RARECMPL)) !?5,"Visit credited.",!
"RTN","RAPCE",84,0)
 . D:'RAXAMSET VISIT(RADFN,RADTI,RACNI,RAVSIT)
"RTN","RAPCE",85,0)
 . D:'RAXAMSET RECDCS(RADFN,RADTI,RACNI) ; only one exam, not a set
"RTN","RAPCE",86,0)
 . D:RAXAMSET MULCS(RADFN,RADTI) ; set, update all exams!
"RTN","RAPCE",87,0)
 . S RASENT=1 ; sent to PCE was okay
"RTN","RAPCE",88,0)
 . Q
"RTN","RAPCE",89,0)
 E  D
"RTN","RAPCE",90,0)
 . N RAWHOERR S RAWHOERR=""
"RTN","RAPCE",91,0)
 . W:'$D(ZTQUEUED)&('$D(RARECMPL)) !?5,$C(7),"Unable to credit.",!
"RTN","RAPCE",92,0)
 . I '$G(RAXAMSET) D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ))
"RTN","RAPCE",93,0)
 . I $G(RAXAMSET) D
"RTN","RAPCE",94,0)
 .. S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0  D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ))
"RTN","RAPCE",95,0)
 .. Q
"RTN","RAPCE",96,0)
 . Q
"RTN","RAPCE",97,0)
 Q
"RTN","RAPCE",98,0)
MULCS(RADFN,RADTI) ; Update the 'Credit recorded' field and the Visit 
"RTN","RAPCE",99,0)
 ;pointer for each case that is complete
"RTN","RAPCE",100,0)
 N RACNI S RACNI=0
"RTN","RAPCE",101,0)
 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0  D
"RTN","RAPCE",102,0)
 . Q:$P($G(^RA(72,+$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U,3),0)),U,3)'=9
"RTN","RAPCE",103,0)
 . D RECDCS(RADFN,RADTI,RACNI)
"RTN","RAPCE",104,0)
 . D VISIT(RADFN,RADTI,RACNI,RAVSIT)
"RTN","RAPCE",105,0)
 . Q
"RTN","RAPCE",106,0)
 Q
"RTN","RAPCE",107,0)
PROC(X) ; Set up the other '"RAPXAPI",$J,"PROCEDURE"' nodes for this case
"RTN","RAPCE",108,0)
 ; If same procedure repeated in exam set, add to qty of existing 
"RTN","RAPCE",109,0)
 ; 'procedure' node.   Else, if different provider, create new 
"RTN","RAPCE",110,0)
 ; separate 'procedure' nodes
"RTN","RAPCE",111,0)
 N X1,X2,X3,RADUP F X1=1:1:X S X2=$G(^TMP("RAPXAPI",$J,"PROCEDURE",X1,"PROCEDURE")) I X2=$P(RA71,"^",9),^("ENC PROVIDER")=$S(RA7003(15)]"":RA7003(15),1:RA7003(12)) D  Q
"RTN","RAPCE",112,0)
 . S ^TMP("RAPXAPI",$J,"PROCEDURE",X1,"QTY")=^("QTY")+1
"RTN","RAPCE",113,0)
 . D CPTMOD(X1)
"RTN","RAPCE",114,0)
 . S RADUP=1
"RTN","RAPCE",115,0)
 . Q
"RTN","RAPCE",116,0)
 I $D(RADUP) Q
"RTN","RAPCE",117,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"QTY")=1
"RTN","RAPCE",118,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"PROCEDURE")=$P(RA71,"^",9)
"RTN","RAPCE",119,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"NARRATIVE")=$P(RA71,"^")
"RTN","RAPCE",120,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"ENC PROVIDER")=$S(RA7003(15)]"":RA7003(15),1:RA7003(12)) ; Pri. Int Staff if exists, else Pri Int Resident
"RTN","RAPCE",121,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"ORD PROVIDER")=RA7003(14) ; Requesting Physician.
"RTN","RAPCE",122,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"EVENT D/T")=RADTE
"RTN","RAPCE",123,0)
 ; if the PFSS switch is active Get both Dept. Code and Account Reference Number (RACCOUNT)
"RTN","RAPCE",124,0)
 I RAPFSW D GETDEPT^RABWIBB ; Requirement 9
"RTN","RAPCE",125,0)
 D CPTMOD(X)
"RTN","RAPCE",126,0)
 D PROCDX^RABWPCE(X) ; Add Ordering ICD Dx to each Procedure.
"RTN","RAPCE",127,0)
 Q
"RTN","RAPCE",128,0)
RECDCS(RADFN,RADTI,RACNI) ; Set 'Clinic Stop Recorded' to yes
"RTN","RAPCE",129,0)
 ; (70.03, fld 23)
"RTN","RAPCE",130,0)
 N RAFDA S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",23)="Y"
"RTN","RAPCE",131,0)
 D FILE^DIE("K","RAFDA")
"RTN","RAPCE",132,0)
 Q
"RTN","RAPCE",133,0)
SETUP ; Setup examination data node information
"RTN","RAPCE",134,0)
 ; If no provider, or inactive CPT, fail
"RTN","RAPCE",135,0)
 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPCE",136,0)
 S RA7003(12)=$P(RA7003,"^",12) ; Pri. Inter. Resident
"RTN","RAPCE",137,0)
 S RA7003(14)=$P(RA7003,"^",14) ; Requesting Physician.
"RTN","RAPCE",138,0)
 S RA7003(15)=$P(RA7003,"^",15) ; Pri. Inter. Staff
"RTN","RAPCE",139,0)
 ; OK to send if missing resident/staff ONLY if report Elec. Filed
"RTN","RAPCE",140,0)
 I (RA7003(12)="")&(RA7003(15)=""),$P($G(^RARPT(+$P(RA7003,U,17),0)),U,5)'="EF" S RABAD=1 Q
"RTN","RAPCE",141,0)
 S RA71=$G(^RAMIS(71,+$P(RA7003,"^",2),0))
"RTN","RAPCE",142,0)
 ; store CPT Modifiers' .01 value
"RTN","RAPCE",143,0)
 K RACPTM S RA=0 F  S RA=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CMOD",RA)) Q:'RA  S RA1=$$BASICMOD^RACPTMSC($P($G(^(RA,0)),"^"),+$P(RA7002,"^")) S:+RA1>0 RACPTM(RA)=$P(RA1,"^",2) ;only valid cpt mods
"RTN","RAPCE",144,0)
 ; find out if CPT code is active
"RTN","RAPCE",145,0)
 I '$$ACTCODE^RACPTMSC(+$P(RA71,"^",9),$P(RA7002,"^")) S RABAD=1
"RTN","RAPCE",146,0)
 Q
"RTN","RAPCE",147,0)
VISIT(RADFN,RADTI,RACNI,RAVSIT) ; Stuff the Visit file pointer passed back
"RTN","RAPCE",148,0)
 ; from $$DATA2PCE^PXAPI() into the Visit field (70.02, fld 6)
"RTN","RAPCE",149,0)
 N RAFDA S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",27)=RAVSIT
"RTN","RAPCE",150,0)
 D FILE^DIE("K","RAFDA")
"RTN","RAPCE",151,0)
 Q
"RTN","RAPCE",152,0)
CPTMOD(X3) ;CPT Modifiers
"RTN","RAPCE",153,0)
 ; CPT Mods for dupl. procedure+provider will be accounted for
"RTN","RAPCE",154,0)
 ; however, same CPT Mod will overwrite previous CPT Mod
"RTN","RAPCE",155,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X3,"MODIFIERS")="" ;prevent abend
"RTN","RAPCE",156,0)
 S RA=0
"RTN","RAPCE",157,0)
 F  S RA=$O(RACPTM(RA)) Q:'RA  S ^TMP("RAPXAPI",$J,"PROCEDURE",X3,"MODIFIERS",RACPTM(RA))=""
"RTN","RAPCE",158,0)
 Q
"RTN","RAPROD")
0^6^B41179318^B40468374
"RTN","RAPROD",1,0)
RAPROD ;HISC/FPT,GJC AISC/MJK-Detailed Exam View ;8/1/97  11:13
"RTN","RAPROD",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,35,45,56**;Mar 16, 1998;Build 3
"RTN","RAPROD",3,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RAPROD",4,0)
 ;Supported IA #2053 UPDATE^DIE
"RTN","RAPROD",5,0)
 ;Supported IA #10040 ^SC(
"RTN","RAPROD",6,0)
 ;Supported IA #10060 ^VA(200
"RTN","RAPROD",7,0)
START S RADI=^RADPT(RADFN,"DT",RADTI,0) S:$D(^("P",RACNI,"COMP")) RA("COMP")=^("COMP") S RA("REA")=$S($D(^("R")):^("R"),1:"")
"RTN","RAPROD",8,0)
 S RA("TECH")=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0)) I RA("TECH") S RA("TECH")=$S($D(^VA(200,+^(RA("TECH"),0),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD",9,0)
 S X=$P(Y(0),"^",4),RA("CAT")=$S(X="I":"INPATIENT",X="O":"OUTPATIENT",X="S":"SHARING",X="C":"CONTRACT",X="R":"RESEARCH",X="E":"EMPLOYEE",1:"UNKNOWN")
"RTN","RAPROD",10,0)
 S RA("RST")=$$RSTAT^RAO7PC1A
"RTN","RAPROD",11,0)
 F I=1:1:13 S Y=$T(LIST+I),@$P(Y,";",3)=$S($D(@($P(Y,";",4)_+$P(@$P(Y,";",5),"^",$P(Y,";",6))_",0)")):$P(^(0),"^"),1:"")
"RTN","RAPROD",12,0)
 ;
"RTN","RAPROD",13,0)
 N RAOPRC ; this will be the Requested Procedure defined only if it
"RTN","RAPROD",14,0)
 ; differs from the Registered Procedure
"RTN","RAPROD",15,0)
 I +$P(Y(0),U,11),($$DPROC^RAUTL15(RADFN,RADTI,RACNI,+$P(Y(0),U,11))]"") D
"RTN","RAPROD",16,0)
 . S RAOPRC=$$GET1^DIQ(75.1,+$P(Y(0),"^",11)_",",2)
"RTN","RAPROD",17,0)
 . Q
"RTN","RAPROD",18,0)
VIEW W @IOF S X="",$P(X,"=",80)="" W X K X
"RTN","RAPROD",19,0)
 W !?2,"Name        : ",RANME,"    ",RASSN
"RTN","RAPROD",20,0)
 W !?2,"Division    : ",$E(RA("DIV"),1,20),?40,"Category     : ",RA("CAT")
"RTN","RAPROD",21,0)
 W !?2,"Location    : ",$S($D(^SC(+RA("LOC"),0)):$P(^(0),"^"),1:"Unknown"),?40,"Ward         : ",$E(RA("WRD"),1,24)
"RTN","RAPROD",22,0)
 W !?2,"Exam Date   : ",RADATE,?40,"Service      : ",$E(RA("SERV"),1,24)
"RTN","RAPROD",23,0)
 W !?2,"Case No.    : ",RACN W ?40,"Bedsection   : ",$E(RA("BED"),1,24)
"RTN","RAPROD",24,0)
 W !?40,"Clinic       : ",$E(RA("CL"),1,24)
"RTN","RAPROD",25,0)
 S Y=$E(RA("CAT")) I "CSR"[Y W !?40,$E($S("C"=Y:"Contract     : "_RA("CONT"),"S"=Y:"Sharing      : "_RA("CONT"),"R"=Y:"Research     : "_RA("REA"),1:""),1,38)
"RTN","RAPROD",26,0)
 W:$X>1 ! S X="",$P(X,"-",80)="" W X K X
"RTN","RAPROD",27,0)
 W !?2,"Registered    : ",$E(RAPRC,1,60) D PRCCPT
"RTN","RAPROD",28,0)
 W:$G(RAOPRC)]"" !?2,"Requested     : ",$E(RAOPRC,1,60)
"RTN","RAPROD",29,0)
 W !?2,"Requesting Phy: ",$E(RA("PHY"),1,20),?40,"Exam Status  : ",$S($D(^RA(72,RAST,0)):$E($P(^(0),"^"),1,24),1:"")
"RTN","RAPROD",30,0)
 W !?2,"Int'g Resident: ",$E(RA("RES"),1,20),?40,"Report Status: ",$E(RA("RST"),1,21)
"RTN","RAPROD",31,0)
 S RAPREVER=+$P($G(^RARPT(RARPT,0)),"^",13)
"RTN","RAPROD",32,0)
 W !?2,"Pre-Verified  : ",$E($S($D(^VA(200,RAPREVER,0)):$P(^(0),"^",1),1:"NO"),1,20),?40,"Cam/Equip/Rm : ",$E(RA("RM"),1,20) K RAPREVER
"RTN","RAPROD",33,0)
 W !?2,"Int'g Staff   : ",$E(RA("STAFF"),1,20),?40,"Diagnosis    : ",$E(RA("DIA"),1,24)
"RTN","RAPROD",34,0)
 W !?2,"Technologist  : ",$E(RA("TECH"),1,20),?40,"Complication : ",$E(RA("CMP"),1,24)
"RTN","RAPROD",35,0)
 I $D(RA("COMP")) W !?2,"Comment       : " F I=1:60 Q:$E(RA("COMP"),I,I+59)']""  W ?18,$E(RA("COMP"),I,I+59),!
"RTN","RAPROD",36,0)
 W:$X>1 !
"RTN","RAPROD",37,0)
 K RAFL W ?40,"Films        :" F I=0:0 S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"F",I)) Q:I'>0  I $D(^(I,0)) S X=^(0) W ?55,$S($D(^RA(78.4,+$P(X,"^"),0)):$P(^(0),"^"),1:"Unknown")," - ",+$P(X,"^",2),!
"RTN","RAPROD",38,0)
 W:$X>1 ! S X="",$P(X,"-",34)="" W X
"RTN","RAPROD",39,0)
 W "Modifiers" W $E(X,1,32) K X
"RTN","RAPROD",40,0)
 W !?2,"Proc Modifiers:" D MODS^RAUTL2 F I=1:1 Q:$P(Y,", ",I)']""  W ?18,$P(Y,", ",I),!
"RTN","RAPROD",41,0)
 N J
"RTN","RAPROD",42,0)
 W !?2,"CPT Modifiers : " W:Y(1)="None" Y(1),!
"RTN","RAPROD",43,0)
 I Y(1)'="None" F I=1:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) W ?18,$P(J,"^",2)," ",$P(J,"^",3),! I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RAPROD",44,0)
 Q:+$G(RAXIT)
"RTN","RAPROD",45,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RAPROD",46,0)
 Q:+$G(RAXIT)
"RTN","RAPROD",47,0)
 ;
"RTN","RAPROD",48,0)
 ;check for Contrast Media data, print it if it exists.
"RTN","RAPROD",49,0)
 I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",0)) D
"RTN","RAPROD",50,0)
 .W !?2,"Contrast Media: " S RACM=1
"RTN","RAPROD",51,0)
 .N DIWF,DIWL,DIWR,DIWT,X,Z
"RTN","RAPROD",52,0)
 .S X=$$CM^RADEM1(RADFN,RADTI,RACNI),DIWL=20,DIWF="C50"
"RTN","RAPROD",53,0)
 .D ^DIWP S Z=0
"RTN","RAPROD",54,0)
 .F  S Z=$O(^UTILITY($J,"W",DIWL,Z)) Q:'Z  D
"RTN","RAPROD",55,0)
 ..W ?18,^UTILITY($J,"W",DIWL,Z,0)
"RTN","RAPROD",56,0)
 ..W:+$O(^UTILITY($J,"W",DIWL,Z)) !
"RTN","RAPROD",57,0)
 ..Q
"RTN","RAPROD",58,0)
 .K ^UTILITY($J,"W")
"RTN","RAPROD",59,0)
 .Q
"RTN","RAPROD",60,0)
 ;
"RTN","RAPROD",61,0)
 I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) D PHARM^RAPROD2(RACNI_","_RADTI_","_RADFN_",") W ! ; display pharmaceutical data
"RTN","RAPROD",62,0)
 I +$G(RAXIT) K RAXIT Q
"RTN","RAPROD",63,0)
 I +$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",28) D RDIO^RAPROD2(+$P(^(0),"^",28)) W ! ; display radiopharm data
"RTN","RAPROD",64,0)
 I +$G(RAXIT) K RAXIT Q
"RTN","RAPROD",65,0)
 W:$X>1 ! S X="",$P(X,"=",80)="" W X K X
"RTN","RAPROD",66,0)
 G ^RAPROD1
"RTN","RAPROD",67,0)
 ;
"RTN","RAPROD",68,0)
PRCCPT ; display Proc's abbrv, proc type, CPT
"RTN","RAPROD",69,0)
 Q:$G(RADTI)=""  Q:$G(RACNI)=""
"RTN","RAPROD",70,0)
 ;
"RTN","RAPROD",71,0)
 N RADISPLY
"RTN","RAPROD",72,0)
 S RADISPLY=$G(^RAMIS(71,+$P($G(^RADPT(+RADFN,"DT",+RADTI,"P",+RACNI,0)),U,2),0)) ; set $ZR to file 71 before calling prccpt^radd1
"RTN","RAPROD",73,0)
 S RADISPLY=$$PRCCPT^RADD1()
"RTN","RAPROD",74,0)
 W ?54,RADISPLY
"RTN","RAPROD",75,0)
 Q
"RTN","RAPROD",76,0)
SETL ;Set long display preference
"RTN","RAPROD",77,0)
 N RA1,RA2,DIR
"RTN","RAPROD",78,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPROD",79,0)
 S RA2=$O(^RA(79,RA1,"LDIS","B",DUZ,0))
"RTN","RAPROD",80,0)
 I RA2 D  Q
"RTN","RAPROD",81,0)
 . W !!,"Your preference for Long Display of Procedures has already been set."
"RTN","RAPROD",82,0)
 . S DIR(0)="Y",DIR("A")="Do you want to delete your preference ",DIR("B")="No"
"RTN","RAPROD",83,0)
 . S DIR("?",1)="If you answer 'Yes', then all Radiology reports requested by you will"
"RTN","RAPROD",84,0)
 . S DIR("?",2)="will default to the condensed display, which means that repeated procedures"
"RTN","RAPROD",85,0)
 . S DIR("?")="and associated modifiers will only be listed once."
"RTN","RAPROD",86,0)
 . D ^DIR
"RTN","RAPROD",87,0)
 . Q:'Y
"RTN","RAPROD",88,0)
 . D DEL150
"RTN","RAPROD",89,0)
 . Q
"RTN","RAPROD",90,0)
 W !
"RTN","RAPROD",91,0)
 S DIR(0)="Y",DIR("A",1)="Do you want to set your preference for Long Display of Procedures"
"RTN","RAPROD",92,0)
 S DIR("A")="in all Radiology reports ",DIR("B")="No"
"RTN","RAPROD",93,0)
 S DIR("?",1)="If you answer 'Yes', then all Radiology reports requested by you will"
"RTN","RAPROD",94,0)
 S DIR("?",2)="list all repeated procedures and associated modifiers instead of"
"RTN","RAPROD",95,0)
 S DIR("?")="listing repeated procedures only once, which is the condensed (default) format."
"RTN","RAPROD",96,0)
 D ^DIR
"RTN","RAPROD",97,0)
 Q:'Y
"RTN","RAPROD",98,0)
 D STUF150
"RTN","RAPROD",99,0)
 Q
"RTN","RAPROD",100,0)
DEL150 ;Delete user ien from 1st record in file 79's field 150
"RTN","RAPROD",101,0)
 ; note: DIK utility looks for DA(1) here
"RTN","RAPROD",102,0)
 Q:'$D(DUZ)#2
"RTN","RAPROD",103,0)
 S DA(1)=$O(^RA(79,0)) Q:'DA(1)
"RTN","RAPROD",104,0)
 S DIK="^RA(79,"_DA(1)_",""LDIS"","
"RTN","RAPROD",105,0)
 S DA=$O(^RA(79,DA(1),"LDIS","B",DUZ,0))
"RTN","RAPROD",106,0)
 Q:'DA
"RTN","RAPROD",107,0)
 D ^DIK
"RTN","RAPROD",108,0)
 K DIK,DA
"RTN","RAPROD",109,0)
 W !!,"Your preference for Long Display of Procedures has been removed.",!
"RTN","RAPROD",110,0)
 Q
"RTN","RAPROD",111,0)
STUF150 ;Stuff user ien into 1st record in file 79's field 150
"RTN","RAPROD",112,0)
 Q:'$D(DUZ)#2
"RTN","RAPROD",113,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPROD",114,0)
 K RAFDA,RAIEN,RAMSG
"RTN","RAPROD",115,0)
 S RAFDA(79.03,"?+2,"_RA1_",",.01)=DUZ
"RTN","RAPROD",116,0)
 D UPDATE^DIE("","RAFDA","RAIEN","RAMSG")
"RTN","RAPROD",117,0)
 W !!,"Your preference for Long Display of Procedures has been set.",!
"RTN","RAPROD",118,0)
 Q
"RTN","RAPROD",119,0)
CDIS ; set up RACDIS array to store 1st non-duplicate proc+pmod+cptmod
"RTN","RAPROD",120,0)
 N N1,N2,R1,RA71,Y
"RTN","RAPROD",121,0)
 K RACDIS
"RTN","RAPROD",122,0)
 D LDIS
"RTN","RAPROD",123,0)
 S N1=0
"RTN","RAPROD",124,0)
 F  S N1=$O(^RADPT(RADFN,"DT",RADTI,"P",N1)) Q:'N1  S R1=$G(^(N1,0)) D:R1]""
"RTN","RAPROD",125,0)
 . S RA71=$P(R1,U,2),RACNI=N1
"RTN","RAPROD",126,0)
 . D MODS^RAUTL2
"RTN","RAPROD",127,0)
 . S RACDIS("B",RA71,Y,Y(1),N1)=""
"RTN","RAPROD",128,0)
 . S N2=$O(RACDIS("B",RA71,Y,Y(1),0))
"RTN","RAPROD",129,0)
 . S RACDIS(N2)=$G(RACDIS(N2))+1 ;increment lowest ien of same proc+pmod+cptmod
"RTN","RAPROD",130,0)
 . S:RACDIS(N2)>1 RACDIS("RAFLDUP")=1 ;>1 same proc+pmod+cptmod
"RTN","RAPROD",131,0)
 . Q
"RTN","RAPROD",132,0)
 Q
"RTN","RAPROD",133,0)
LDIS ; See if user prefers Long Display of Procedures
"RTN","RAPROD",134,0)
 N RA1
"RTN","RAPROD",135,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPROD",136,0)
 S:$O(^RA(79,RA1,"LDIS","B",DUZ,0)) RALDIS=1
"RTN","RAPROD",137,0)
 Q
"RTN","RAPROD",138,0)
LIST ;
"RTN","RAPROD",139,0)
 ;;RA("DIV");^DIC(4,;RADI;3
"RTN","RAPROD",140,0)
 ;;RA("LOC");^RA(79.1,;RADI;4
"RTN","RAPROD",141,0)
 ;;RA("WRD");^DIC(42,;Y(0);6
"RTN","RAPROD",142,0)
 ;;RA("SERV");^DIC(49,;Y(0);7
"RTN","RAPROD",143,0)
 ;;RA("CL");^SC(;Y(0);8
"RTN","RAPROD",144,0)
 ;;RA("CONT");^DIC(34,;Y(0);9
"RTN","RAPROD",145,0)
 ;;RA("RES");^VA(200,;Y(0);12
"RTN","RAPROD",146,0)
 ;;RA("DIA");^RA(78.3,;Y(0);13
"RTN","RAPROD",147,0)
 ;;RA("PHY");^VA(200,;Y(0);14
"RTN","RAPROD",148,0)
 ;;RA("STAFF");^VA(200,;Y(0);15
"RTN","RAPROD",149,0)
 ;;RA("CMP");^RA(78.1,;Y(0);16
"RTN","RAPROD",150,0)
 ;;RA("RM");^RA(78.6,;Y(0);18
"RTN","RAPROD",151,0)
 ;;RA("BED");^DIC(42.4,;Y(0);19
"RTN","RAPTLU")
0^7^B29961881^B29327900
"RTN","RAPTLU",1,0)
RAPTLU ;HISC/CAH,FPT,GJC AISC/MJK,RMO-Patient's Exam Lookup ;11/13/00  09:13
"RTN","RAPTLU",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,8,15,23,56**;Mar 16, 1998;Build 3
"RTN","RAPTLU",3,0)
 ;Supported EA #10001 DT^DIO2
"RTN","RAPTLU",4,0)
 ;Supported IA #2378 ORCHK^GMRAOR
"RTN","RAPTLU",5,0)
 ;Supported IA #10035 ^DPT(
"RTN","RAPTLU",6,0)
 ;Supported IA #10040 ^SC(
"RTN","RAPTLU",7,0)
 ;Private IA #1123 RACHK^GMRARAD, RADD^GMRARAD
"RTN","RAPTLU",8,0)
 ;***********************************************************************
"RTN","RAPTLU",9,0)
 ;                         <<< NOTE >>>
"RTN","RAPTLU",10,0)
 ; 'RANOSCRN' is set in the entry actions of various options.
"RTN","RAPTLU",11,0)
 ; If the variable exists, the screen is ignored.  Code is in line
"RTN","RAPTLU",12,0)
 ; label PRT+0.
"RTN","RAPTLU",13,0)
 ;***********************************************************************
"RTN","RAPTLU",14,0)
CASE D SEL S:'RACNT X="^" G Q:X="^"!($D(RAF1)) F I=1:1:11 S @$P("RADFN^RADTI^RACNI^RANME^RASSN^RADATE^RADTE^RACN^RAPRC^RARPT^RAST","^",I)=$P(Y,"^",I)
"RTN","RAPTLU",15,0)
 S ^DISV($S($D(DUZ)#2:DUZ,1:0),"RA","CASE #")=RADFN_"^"_RADTI_"^"_RACNI,Y(0)=^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)
"RTN","RAPTLU",16,0)
Q K RTESC,RTFL,RACNT,RAERR,RASTP,RAELOC,RADTPRT,^TMP("MAG",$J,"COL"),^TMP("MAG",$J,"ROW") Q
"RTN","RAPTLU",17,0)
 ;
"RTN","RAPTLU",18,0)
SEL Q:'$D(^DPT(RADFN,0))  S RANME=^(0),RASSN=$$SSN^RAUTL,RANME=$P(RANME,"^") K ^TMP($J,"RAEX") D HOME^%ZIS D HD S X="",RACNT=0
"RTN","RAPTLU",19,0)
 ;I $$IMAGE^RARIC1 D MED^MAGSET3,ERASE^MAGSET3 ;don't call MAG 111300
"RTN","RAPTLU",20,0)
 S X=""
"RTN","RAPTLU",21,0)
 F RADTI=0:0 Q:X="^"!(X>0)  S RADTI=$O(^RADPT(RADFN,"DT",RADTI)) Q:RADTI'>0  I $D(^(RADTI,0)) S RANODE=^(0),RADTE=+^(0) D SEL2 ;swm080398
"RTN","RAPTLU",22,0)
 Q:X="^"!(X>0)  I 'RACNT W !?3,$C(7),"No matches found!" Q
"RTN","RAPTLU",23,0)
 ;**Next line commented out - was causing selection screen to disappear
"RTN","RAPTLU",24,0)
 ;  and automatically go on to detailed screen if there was only one
"RTN","RAPTLU",25,0)
 ;  case for the patient
"RTN","RAPTLU",26,0)
 D ASK^RAUTL4 S:X="" X="^"
"RTN","RAPTLU",27,0)
 Q
"RTN","RAPTLU",28,0)
SEL2 ; per RACNLU, check loc access, need split For Loop,swm080398
"RTN","RAPTLU",29,0)
 S RADIV=+$P(RANODE,"^",3),RAIMAGE=+$P(RANODE,"^",2)
"RTN","RAPTLU",30,0)
 S RADIV=+$G(^RA(79,RADIV,0)),RADIV=$P($G(^DIC(4,RADIV,0)),"^")
"RTN","RAPTLU",31,0)
 S:RADIV']"" RADIV="Unknown"
"RTN","RAPTLU",32,0)
 S RAIMAGE=$P($G(^RA(79.2,RAIMAGE,0)),"^")
"RTN","RAPTLU",33,0)
 S:RAIMAGE']"" RAIMAGE="Unknown"
"RTN","RAPTLU",34,0)
 I '$D(ORVP),($D(RANOSCRN)),('$D(RADUPSCN)) I $D(^TMP($J,"RA D-TYPE"))!($D(^TMP($J,"RA I-TYPE"))) Q:'$D(^TMP($J,"RA D-TYPE",RADIV))!('$D(^TMP($J,"RA I-TYPE",RAIMAGE)))  ;this stmt taken from RACNLU
"RTN","RAPTLU",35,0)
 ; continue, since user has loc access
"RTN","RAPTLU",36,0)
 F RACNI=0:0 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0  I $D(^(RACNI,0)) S RACN=^(0) D PRT Q:X="^"!(X>0)
"RTN","RAPTLU",37,0)
 Q
"RTN","RAPTLU",38,0)
PRT ; Screen only if entered through Rad/Nuc Med
"RTN","RAPTLU",39,0)
 I '$D(ORVP),'$D(RANOSCRN),'$D(RAOPT("DOSAGE TICKET")),'$D(RAOPT("UNCORRECTED REPORTS")) Q:$$IMGTY^RAUTL12("e",RADFN,RADTI)'=RAIMGTY
"RTN","RAPTLU",40,0)
 ; "Duplicate Dosage Ticket" option has its own screen
"RTN","RAPTLU",41,0)
 I $D(RAOPT("DOSAGE TICKET")) Q:$P($G(^RA(79.2,+$P(^RADPT(RADFN,"DT",RADTI,0),U,2),0)),U,5)'="Y"
"RTN","RAPTLU",42,0)
 S RARPT=+$P(RACN,"^",17)
"RTN","RAPTLU",43,0)
 Q:$D(RAOPT("UNCORRECTED REPORTS"))&('$O(^RARPT(RARPT,"ERR",0)))
"RTN","RAPTLU",44,0)
 S RAST=+$P(RACN,"^",3),RAPRC=$S($D(^RAMIS(71,+$P(RACN,"^",2),0)):$P(^(0),"^"),1:"Unknown"),RACN=+RACN S (RADTPRT,Y)=RADTE D D^RAUTL S RADATE=Y
"RTN","RAPTLU",45,0)
 S RAELOC=$P($G(^SC(+$P($G(^RA(79.1,+$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,4),0)),U),0)),U),RADTPRT=$E(RADTPRT,4,5)_"/"_$E(RADTPRT,6,7)_"/"_$E(RADTPRT,2,3)
"RTN","RAPTLU",46,0)
 S:RAELOC="" RAELOC="* MISSING *"
"RTN","RAPTLU",47,0)
 S RACNT=RACNT+1,^TMP($J,"RAEX",RACNT)=RADFN_"^"_RADTI_"^"_RACNI_"^"_RANME_"^"_RASSN_"^"_RADATE_"^"_RADTE_"^"_RACN_"^"_RAPRC_"^"_RARPT_"^"_RAST
"RTN","RAPTLU",48,0)
 I $D(RAREPORT) D
"RTN","RAPTLU",49,0)
 . S RAIMGTYI=$$IMGTY^RAUTL12("e",RADFN,RADTI)
"RTN","RAPTLU",50,0)
 . S RASTP=$E($$GET1^DIQ(74,+RARPT,5),1,16) ;get all possible Rpt Statuss
"RTN","RAPTLU",51,0)
 . I RASTP="",RAIMGTYI'="" S RASTP=RASTP_$S($D(^RA(72,"AA",RAIMGTYI,0,+RAST)):" (Exam Dc'd)",1:"")
"RTN","RAPTLU",52,0)
 . Q
"RTN","RAPTLU",53,0)
 I '$D(RAREPORT) S RASTP=$S($D(^RA(72,RAST,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAPTLU",54,0)
 ; D:$$IMAGE^RARIC1 DISPA^MAGRIC ;don't call MAG 111300
"RTN","RAPTLU",55,0)
 N RAPRTSET,RAMEMLOW D EN1^RAUTL20
"RTN","RAPTLU",56,0)
 W !,RACNT,?5,$S(RAMEMLOW:"+",RAPRTSET:".",1:" "),?6,RACN,?11,$$IMGDISP(RARPT),?13,$E(RAPRC,1,26),?41,RADTPRT,?52,$E(RASTP,1,16),?69,$E(RAELOC,1,11)
"RTN","RAPTLU",57,0)
 I (($Y+6)>IOSL),($O(^RADPT(RADFN,"DT",RADTI,"P",RACNI))!($O(^RADPT(RADFN,"DT",RADTI)))) D ASK^RAUTL4 W @IOF
"RTN","RAPTLU",58,0)
 Q
"RTN","RAPTLU",59,0)
 ;
"RTN","RAPTLU",60,0)
HD I '$D(RTFL) W @IOF,?25,RAHEAD,!!,"Patient's Name: ",$E(RANME,1,20),"  ",RASSN,?55,"Run Date: " S Y=DT D DT^DIO2
"RTN","RAPTLU",61,0)
 I $D(RTFL) D ESC^RTRD:($Y+6)>IOSL Q:$D(RTESC)  W !!,"============================ Exam Procedure Profile =========================="
"RTN","RAPTLU",62,0)
 W !!?3,"Case No.",?13,"Procedure",?41,"Exam Date",?52,"Status of " W $S($D(RAREPORT):"Report",1:"Exam"),?69,"Imaging Loc"
"RTN","RAPTLU",63,0)
 W !?3,"--------",?13,"-------------",?41,"---------",?52,"----------------",?69,"-----------" Q
"RTN","RAPTLU",64,0)
 ;
"RTN","RAPTLU",65,0)
PTUPD ;Update Patient Info
"RTN","RAPTLU",66,0)
 S DIC(0)="AEMQL" D ^RADPA K DIC,RAIC Q:Y<0  S DIE="^RADPT(",DA=+Y,DR=".04;1" D ^DIE
"RTN","RAPTLU",67,0)
PTUPD0 K DIR S DIR(0)="SOMA^Y:YES;N:NO;",DIR("A")="CONTRAST MEDIUM ALLERGY: "
"RTN","RAPTLU",68,0)
 S ALLERGY=$$ORCHK^GMRAOR(DA,"CM")
"RTN","RAPTLU",69,0)
 I ALLERGY]"" S DIR("B")=$S(ALLERGY=1:"YES",1:"NO")
"RTN","RAPTLU",70,0)
 S DIR("?")="^D PTUPDH1^RAPTLU",DIR("??")="^D PTUPDH2^RAPTLU"
"RTN","RAPTLU",71,0)
 D ^DIR K DIR I $D(DIRUT) G PTUPDX
"RTN","RAPTLU",72,0)
 I ALLERGY'=$TR(Y,"YN","10") S X=0 D  G:'X PTUPDX W " ??",$C(7) G PTUPD0
"RTN","RAPTLU",73,0)
 . I Y="N" S X=$$RACHK^GMRARAD(DA,Y)
"RTN","RAPTLU",74,0)
 . I Y="Y" S X=($$RADD^GMRARAD(DA,"p",Y)'>0)
"RTN","RAPTLU",75,0)
 . Q
"RTN","RAPTLU",76,0)
PTUPDX K %,%Y,ALLERGY,C,D,D0,DA,DE,DQ,DIE,DIR,DR,RAPTFL,DIC,X,Y
"RTN","RAPTLU",77,0)
 Q
"RTN","RAPTLU",78,0)
PTUPDH1 W !?5,"If this patient has had an allergic reaction to contrast medium, enter 'Y'"
"RTN","RAPTLU",79,0)
 W !?5,"for YES at this prompt.  If not, enter 'N' for NO."
"RTN","RAPTLU",80,0)
 D PTUPDH3
"RTN","RAPTLU",81,0)
 Q
"RTN","RAPTLU",82,0)
PTUPDH2 ;
"RTN","RAPTLU",83,0)
 W !?5,"The value in this field is used to indicate if this Radiology"
"RTN","RAPTLU",84,0)
 W !?5,"/Nuclear Medicine patient has had an allergic reaction to the contrast"
"RTN","RAPTLU",85,0)
 W !?5,"medium during a Radiology/Nuclear Medicine procedure.  It may contain a"
"RTN","RAPTLU",86,0)
 W !?5,"'Y' for YES, or 'N' for NO.  If YES, then a warning message is"
"RTN","RAPTLU",87,0)
 W !?5,"displayed to the receptionist whenever this patient is"
"RTN","RAPTLU",88,0)
 W !?5,"registered for a procedure that may involve contrast material."
"RTN","RAPTLU",89,0)
 D PTUPDH3
"RTN","RAPTLU",90,0)
 Q
"RTN","RAPTLU",91,0)
PTUPDH3 W !?5,"CHOOSE FROM:"
"RTN","RAPTLU",92,0)
 W !?5," Y        YES"
"RTN","RAPTLU",93,0)
 W !?5," N        NO"
"RTN","RAPTLU",94,0)
 Q
"RTN","RAPTLU",95,0)
IMGDISP(RARPT) ; Display "i" if an image is associated with the Rad/Nuc Med
"RTN","RAPTLU",96,0)
 ; Report.  Called from RAPROS - Exam Profile (Selected Sort)
"RTN","RAPTLU",97,0)
 ; Input : RARPT - ien of the report
"RTN","RAPTLU",98,0)
 ; Output: "i" if an image exists, else null ("")
"RTN","RAPTLU",99,0)
 Q $S(+$O(^RARPT(RARPT,2005,0)):"i",1:"")
"RTN","RAPXRM")
0^8^B16075069^B14691287
"RTN","RAPXRM",1,0)
RAPXRM ;HOIFO/SWM - API for Clinical Reminders ;10/1/03  09:33
"RTN","RAPXRM",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**33,56**;Mar 16, 1998;Build 3
"RTN","RAPXRM",3,0)
 ; IA #3731 documents entry point EN1
"RTN","RAPXRM",4,0)
 ; IA #4113 grants use of rtn PXRMSXRM
"RTN","RAPXRM",5,0)
 ; IA #4114 grants use of direct Set and Kill, use of ^PXRMINDX(70
"RTN","RAPXRM",6,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RAPXRM",7,0)
 ;Supported IA #2052 GET1^DID
"RTN","RAPXRM",8,0)
 ;Supported IA #10141 BMES^XPDUTL, MES^XPDUTL
"RTN","RAPXRM",9,0)
 ;Supported IA #10103 NOW^XLFDT
"RTN","RAPXRM",10,0)
EN1(RADAS,RARM) ;retrieve data from Clin. Rem.'s new style index "ACR"
"RTN","RAPXRM",11,0)
 ; Input:
"RTN","RAPXRM",12,0)
 ; RADAS = last subscript of (required), for example:
"RTN","RAPXRM",13,0)
 ;      ^PXRMINDX(70,"IP",43,1,2,2920720.1049,"2;DT;7079279.895;P;3;0")
"RTN","RAPXRM",14,0)
 ;      ^PXRMINDX(70,"PI",9,3,45,2921204.155,"9;DT;7078795.8449;P;1;0")
"RTN","RAPXRM",15,0)
 ; RARM = array name passed by reference (required)
"RTN","RAPXRM",16,0)
 ; Output:
"RTN","RAPXRM",17,0)
 ;     RARM("aaa") = external value, eg.:
"RTN","RAPXRM",18,0)
 ; RARM("EXAM D/T") = Exam Date and time in yyymmdd.hhmm format
"RTN","RAPXRM",19,0)
 ; RARM("EXAM STATUS") = Exam Status name
"RTN","RAPXRM",20,0)
 ; RARM("PROCEDURE") = Procedure name
"RTN","RAPXRM",21,0)
 ; RARM("INTERPRETING PHYSICIAN") = Primary Staff; else Primary Resident
"RTN","RAPXRM",22,0)
 ;     If exam node doesn't exist, then RARM is undefined
"RTN","RAPXRM",23,0)
 ; RARM("RPT STATUS") = Report status name
"RTN","RAPXRM",24,0)
 ;
"RTN","RAPXRM",25,0)
 K RARM ; clear output var
"RTN","RAPXRM",26,0)
 ; validate RADAS string
"RTN","RAPXRM",27,0)
 Q:$P(RADAS,";",2)'="DT"  Q:$P(RADAS,";",4)'="P"  Q:$P(RADAS,";",6)'="0"
"RTN","RAPXRM",28,0)
 N RA0,RADFN,RADTI,RACNI,X,I,J,RARPT
"RTN","RAPXRM",29,0)
 S RADFN=$P(RADAS,";"),RADTI=$P(RADAS,";",3),RACNI=$P(RADAS,";",5)
"RTN","RAPXRM",30,0)
 S RA0=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPXRM",31,0)
 Q:RA0=""
"RTN","RAPXRM",32,0)
 S RARM("EXAM D/T")=9999999.9999-RADTI
"RTN","RAPXRM",33,0)
 S RARM("EXAM STATUS")=$P($G(^RA(72,+$P(RA0,U,3),0)),U)
"RTN","RAPXRM",34,0)
 S RARM("PROCEDURE")=$P($G(^RAMIS(71,+$P(RA0,U,2),0)),U)
"RTN","RAPXRM",35,0)
 S X=$S($P(RA0,U,15):+$P(RA0,U,15),$P(RA0,U,12):+$P(RA0,U,12),1:"")
"RTN","RAPXRM",36,0)
 S:X'="" X=$$GET1^DIQ(200,X,.01)
"RTN","RAPXRM",37,0)
 S RARM("INTERPRETING PHYSICIAN")=X
"RTN","RAPXRM",38,0)
 ;
"RTN","RAPXRM",39,0)
 ; RARM("PDX")=Primary DX text
"RTN","RAPXRM",40,0)
 ;             this node won't exist if there's no data for Prim DX
"RTN","RAPXRM",41,0)
 ; RARM("SDX",n)=Secondary DX text at ^RADPT(-,"DT",-,"P",-,"DX",n,0)
"RTN","RAPXRM",42,0)
 ;             the n may have gaps if a Secondary DX was deleted
"RTN","RAPXRM",43,0)
 ;
"RTN","RAPXRM",44,0)
 S RARPT=$P(RA0,U,17) S RARM("RPT STATUS")=$$UL^RAO7PC1A($$RSTAT^RAO7PC1A())
"RTN","RAPXRM",45,0)
 S:$P(RA0,U,13)'="" RARM("PDX")=$P($G(^RA(78.3,+$P(RA0,U,13),0)),U)
"RTN","RAPXRM",46,0)
 S I=0
"RTN","RAPXRM",47,0)
 F  S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",I)) Q:'I  I $D(^(I,0)) S J=+$G(^(0)) I J S RARM("SDX",I)=$P($G(^RA(78.3,J,0)),U)
"RTN","RAPXRM",48,0)
 Q
"RTN","RAPXRM",49,0)
 ;===============================================================
"RTN","RAPXRM",50,0)
 ; RAD section copied from former location  RAD^PXRMSXRO
"RTN","RAPXRM",51,0)
RAD ;Build the index for RAD/NUC MED PATIENT.
"RTN","RAPXRM",52,0)
 N D0,D1,D2,DA,DAS,DFN,END,ENTRIES,GLOBAL,IND,NE,NERROR,PROC
"RTN","RAPXRM",53,0)
 N START,TEMP,TENP,TEXT
"RTN","RAPXRM",54,0)
 ;Don't leave any old stuff around.
"RTN","RAPXRM",55,0)
 K ^PXRMINDX(70)
"RTN","RAPXRM",56,0)
 S GLOBAL=$$GET1^DID(70,"","","GLOBAL NAME")
"RTN","RAPXRM",57,0)
 S ENTRIES=$P(^RADPT(0),U,4)
"RTN","RAPXRM",58,0)
 S TENP=ENTRIES/10
"RTN","RAPXRM",59,0)
 S TENP=+$P(TENP,".",1)
"RTN","RAPXRM",60,0)
 I TENP<1 S TENP=1
"RTN","RAPXRM",61,0)
 D BMES^XPDUTL("Building index for RAD DATA")
"RTN","RAPXRM",62,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","RAPXRM",63,0)
 D MES^XPDUTL(TEXT)
"RTN","RAPXRM",64,0)
 S START=$H
"RTN","RAPXRM",65,0)
 S (D0,IND,NE,NERROR)=0
"RTN","RAPXRM",66,0)
 F  S D0=+$O(^RADPT(D0)) Q:D0=0  D
"RTN","RAPXRM",67,0)
 . S IND=IND+1
"RTN","RAPXRM",68,0)
 . I IND#TENP=0 D
"RTN","RAPXRM",69,0)
 .. S TEXT="Processing entry "_IND
"RTN","RAPXRM",70,0)
 .. D MES^XPDUTL(TEXT)
"RTN","RAPXRM",71,0)
 . I IND#10000=0 W "."
"RTN","RAPXRM",72,0)
 . S DFN=$P($G(^RADPT(D0,0)),U,1)
"RTN","RAPXRM",73,0)
 . I DFN="" D  Q
"RTN","RAPXRM",74,0)
 .. S ETEXT=D0_" no patient"
"RTN","RAPXRM",75,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR) Q
"RTN","RAPXRM",76,0)
 . S D1=0
"RTN","RAPXRM",77,0)
 . F  S D1=+$O(^RADPT(D0,"DT",D1)) Q:D1=0  D
"RTN","RAPXRM",78,0)
 .. S DATE=$P($G(^RADPT(D0,"DT",D1,0)),U,1)
"RTN","RAPXRM",79,0)
 .. S DA=D0_";DT;"_D1
"RTN","RAPXRM",80,0)
 .. I DATE="" D  Q
"RTN","RAPXRM",81,0)
 ... S ETEXT=DA_" no date"
"RTN","RAPXRM",82,0)
 ... D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR) Q
"RTN","RAPXRM",83,0)
 .. S D2=0
"RTN","RAPXRM",84,0)
 .. F  S D2=+$O(^RADPT(D0,"DT",D1,"P",D2)) Q:D2=0  D
"RTN","RAPXRM",85,0)
 ... S TEMP=$G(^RADPT(D0,"DT",D1,"P",D2,0))
"RTN","RAPXRM",86,0)
 ... S DAS=DA_";P;"_D2_";0"
"RTN","RAPXRM",87,0)
 ... S PROC=$P(TEMP,U,2)
"RTN","RAPXRM",88,0)
 ... I PROC="" D  Q
"RTN","RAPXRM",89,0)
 .... S ETEXT=DAS_" no procedure"
"RTN","RAPXRM",90,0)
 .... D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR) Q
"RTN","RAPXRM",91,0)
 ... S ^PXRMINDX(70,"IP",PROC,DFN,DATE,DAS)=""
"RTN","RAPXRM",92,0)
 ... S ^PXRMINDX(70,"PI",DFN,PROC,DATE,DAS)=""
"RTN","RAPXRM",93,0)
 ... S NE=NE+1
"RTN","RAPXRM",94,0)
 S END=$H
"RTN","RAPXRM",95,0)
 S TEXT=NE_" RAD/NUC MED PATIENT results indexed."
"RTN","RAPXRM",96,0)
 D MES^XPDUTL(TEXT)
"RTN","RAPXRM",97,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","RAPXRM",98,0)
 ;If there were errors send a message.
"RTN","RAPXRM",99,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","RAPXRM",100,0)
 ;Send a MailMan message with the results.
"RTN","RAPXRM",101,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","RAPXRM",102,0)
 S ^PXRMINDX(70,"GLOBAL NAME")=$$GET1^DID(70,"","","GLOBAL NAME")
"RTN","RAPXRM",103,0)
 S ^PXRMINDX(70,"BUILT BY")=DUZ
"RTN","RAPXRM",104,0)
 S ^PXRMINDX(70,"DATE BUILT")=$$NOW^XLFDT
"RTN","RAPXRM",105,0)
 Q
"RTN","RAPXRM",106,0)
 ;
"RTN","RAPXRM",107,0)
 ;===============================================================
"RTN","RAPXRM",108,0)
KRAD(X,DA) ;Delete index for RAD/NUC MED PATIENT file.
"RTN","RAPXRM",109,0)
 N DAS,DATE
"RTN","RAPXRM",110,0)
 S DATE=9999999.9999-DA(1)
"RTN","RAPXRM",111,0)
 S DAS=DA(2)_";DT;"_DA(1)_";P;"_DA_";0"
"RTN","RAPXRM",112,0)
 K ^PXRMINDX(70,"IP",X(1),DA(2),DATE,DAS)
"RTN","RAPXRM",113,0)
 K ^PXRMINDX(70,"PI",DA(2),X(1),DATE,DAS)
"RTN","RAPXRM",114,0)
 Q
"RTN","RAPXRM",115,0)
 ;
"RTN","RAPXRM",116,0)
 ;===============================================================
"RTN","RAPXRM",117,0)
SRAD(X,DA) ;Set index for RAD/NUC MED PATIENT file.
"RTN","RAPXRM",118,0)
 ;DA(2)=DFN, DA(1)=EXAM DATE (inverse date), DA=Examinations Entry
"RTN","RAPXRM",119,0)
 ;X(1)=PROCEDURE
"RTN","RAPXRM",120,0)
 N DAS,DATE
"RTN","RAPXRM",121,0)
 S DATE=9999999.9999-DA(1)
"RTN","RAPXRM",122,0)
 S DAS=DA(2)_";DT;"_DA(1)_";P;"_DA_";0"
"RTN","RAPXRM",123,0)
 S ^PXRMINDX(70,"IP",X(1),DA(2),DATE,DAS)=""
"RTN","RAPXRM",124,0)
 S ^PXRMINDX(70,"PI",DA(2),X(1),DATE,DAS)=""
"RTN","RAPXRM",125,0)
 Q
"RTN","RAPXRM",126,0)
 ;
"RTN","RART")
0^10^B23124716^B21656995
"RTN","RART",1,0)
RART ;HISC/CAH,FPT,GJC AISC/MJK,TMP,RMO-Reporting Menu ;11/16/98  15:02
"RTN","RART",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,5,15,18,43,82,56**;Mar 16, 1998;Build 3
"RTN","RART",3,0)
 ;Private IA #4793 CREATE^WVRALINK
"RTN","RART",4,0)
 ;Supoprted IA #3544 ^VA(200,"ARC"
"RTN","RART",5,0)
 ;;last modification by SS for P18 June 15, 2000
"RTN","RART",6,0)
3 ;;Verify a Report
"RTN","RART",7,0)
 N I5
"RTN","RART",8,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RART",9,0)
 I $D(RANOSCRN) S X=$$DIVLOC^RAUTL7() I X D Q QUIT
"RTN","RART",10,0)
 G:$D(^VA(200,"ARC","S",DUZ))!($D(^XUSEC("RA VERIFY",DUZ))) 30
"RTN","RART",11,0)
 G:$P(RAMDV,"^",18)=1 30
"RTN","RART",12,0)
 G:'$D(^VA(200,"ARC","R",DUZ)) 30
"RTN","RART",13,0)
 I $P(RAMDV,"^",18)'=1 W !!,$C(7),"Interpreting Residents are not allowed to verify reports." G Q
"RTN","RART",14,0)
30 K RAUP S RAPGM=30,RAREPORT=1 D ^RACNLU G Q:X="^" I '$D(^RARPT(+RARPT,0)) W !!?2,$C(7),"No report available!" G 30
"RTN","RART",15,0)
 S I5=$P(^RARPT(+RARPT,0),"^",5) I "^V^EF^"[("^"_I5_"^") W !!?2,$C(7),"Report already ",$S(I5="V":"verified",1:"electronically filed") G 30
"RTN","RART",16,0)
SS1 Q:$$VERONLY^RAUTL11=-1  ;P18 case info 
"RTN","RART",17,0)
31 S DIE("NO^")="",DA=RARPT,DR="[RA VERIFY REPORT ONLY]",DIE="^RARPT("
"RTN","RART",18,0)
 S RAIMGTYI=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U)
"RTN","RART",19,0)
 I RAIMGTYJ']"" W !,"Error: Cannot determine imaging type of exam.",! K RAIMGTYI,RAIMGTYJ G @RAPGM
"RTN","RART",20,0)
 ; must lock both report AND case together, so to ensure 
"RTN","RART",21,0)
 ; that a verified report has the correct diagnostic codes
"RTN","RART",22,0)
 S RAXIT=$$LOCK^RAUTL12(DIE,DA) ; lock Report
"RTN","RART",23,0)
 I RAXIT K RAXIT G @RAPGM
"RTN","RART",24,0)
 S RASAVDIE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"",",RASAVDA(2)=RADFN,RASAVDA(1)=RADTI,RASAVDA=RACNI
"RTN","RART",25,0)
 ; rpt exists & locked, thus no need to lock at "DT" level because users
"RTN","RART",26,0)
 ; can only use 'report entry/edit' option to enter dx's for printsets
"RTN","RART",27,0)
 S RAXIT=$$LOCK^RAUTL12(RASAVDIE,.RASAVDA) ; lock case before asking REPORT STATUS
"RTN","RART",28,0)
 I RAXIT K RAXIT G @RAPGM
"RTN","RART",29,0)
 D ^DIE K DE,DQ,DR D UNLOCK^RAUTL12(DIE,DA) ; unlock Report
"RTN","RART",30,0)
 K DIE,RAXIT
"RTN","RART",31,0)
 S X=+$O(^RA(72,"AA",RAIMGTYJ,9,0)),DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"","
"RTN","RART",32,0)
 S DR=13_$S(RACT'="V":"",'$D(^RA(72,X,.1)):"",$P(^(.1),"^",5)'="Y":"",1:"R")_";I $D(^RA(78.3,+X,0)),$P(^(0),""^"",4)=""y"" S RAAB=1 "
"RTN","RART",33,0)
 I RACT="V",($P($G(^RA(72,+X,.1)),"^",5)="Y") S DIE("NO^")="BACK"
"RTN","RART",34,0)
 D ^DIE
"RTN","RART",35,0)
 K DA,DE,DQ,DIE,DR
"RTN","RART",36,0)
 I $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13)="" G UNL31
"RTN","RART",37,0)
 S DR="50///"_RACN
"RTN","RART",38,0)
 S DR(2,70.03)=13.1
"RTN","RART",39,0)
 S DR(3,70.14)=.01_";I $D(^RA(78.3,+X,0)),$P(^(0),""^"",4)=""y"" S RAAB=1"
"RTN","RART",40,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT"","
"RTN","RART",41,0)
 D ^DIE
"RTN","RART",42,0)
UNL31 ; copy then unlock
"RTN","RART",43,0)
 N:'$D(RAPRTSET) RAPRTSET N:'$D(RAMEMARR) RAMEMARR
"RTN","RART",44,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RART",45,0)
 I RAPRTSET S RADRS=1,RAXIT=0 D COPY^RARTE2 ; copy diagnoses
"RTN","RART",46,0)
 D UNLOCK^RAUTL12(RASAVDIE,.RASAVDA) ; use params from PrimDiag's lock
"RTN","RART",47,0)
 K RASAVDIE,RASAVDA
"RTN","RART",48,0)
 K DA,DE,DQ,DIE,DR
"RTN","RART",49,0)
32 K RAXIT
"RTN","RART",50,0)
 I $G(RAPGM)="GETRPT^RARTVER" I $E(RACT'="V"),($P(^RARPT(RARPT,0),U,14)]"") D RETURN^RARTVER2
"RTN","RART",51,0)
PACS I (RACT="V")!(RACT="R") D TASK^RAHLO4
"RTN","RART",52,0)
 I "^V^EF^"[("^"_RACT_"^"),$T(CREATE^WVRALINK)]"" D CREATE^WVRALINK(RADFN,RADTI,RACNI) ;women's health
"RTN","RART",53,0)
 ;
"RTN","RART",54,0)
 I RAPGM="NXT^RABTCH1" G @RAPGM
"RTN","RART",55,0)
TIME D:RACT="V"
"RTN","RART",56,0)
 .N RAHLTCPB S RAHLTCPB=1 D UPSTAT^RAUTL0 K RAAB
"RTN","RART",57,0)
 I $G(RARDX)="S" D
"RTN","RART",58,0)
 . D SAVE^RARTVER2
"RTN","RART",59,0)
 . I $G(RAPGM)="GETRPT^RARTVER" D
"RTN","RART",60,0)
 .. ; for 'On-line Verifying of Reports' default device selection is the
"RTN","RART",61,0)
 .. ; "REPORT PRINTER NAME"
"RTN","RART",62,0)
 .. S %ZIS("B")=$P($G(RAMLC),"^",10) K:%ZIS("B")']"" %ZIS("B")
"RTN","RART",63,0)
 .. Q
"RTN","RART",64,0)
 . D Q^RARTR,RESTORE^RARTVER2
"RTN","RART",65,0)
 . K:$D(%ZIS("B")) %ZIS("B")
"RTN","RART",66,0)
 . Q
"RTN","RART",67,0)
 G @RAPGM
"RTN","RART",68,0)
Q K %,%DT,%X,C,D,D0,D1,DA,DIC,RACN,RACNI,RACT,RADATE,RADFN,RADTE,RADTI,RADUZ,RAHEAD,RAI,RAIMGTYI,RAIMGTYJ,RANME,RANUM,RAOR,RAPGM,RAPRC,RAQUIT,RAREPORT,RARPT,RASET,RASN,RASSN,RAST,RASTI,RAUP,RAVER,X,Y,^TMP($J,"RAEX")
"RTN","RART",69,0)
 K %W,%Y,%Y1,DDER,DI,DIROUT,DIRUT,DLAYGO,DTOUT,DUOUT,RACI,ZTSK,POP,DDH
"RTN","RART",70,0)
 Q
"RTN","RART",71,0)
OERR1 ; Jump to 'OERR1^RART1' This is necessary to support the reference to
"RTN","RART",72,0)
 ; this line label in the OE/RR Notifications file.
"RTN","RART",73,0)
 G OERR1^RART1 Q
"RTN","RART",74,0)
 ;
"RTN","RART",75,0)
PRTDX ; print dx codes on report display (called from RART1)
"RTN","RART",76,0)
 K RAFLG D WAIT^RART1:($Y+6)>IOSL&('$D(RARTVERF))
"RTN","RART",77,0)
 Q:X="^"!(X="T")!(X="P")
"RTN","RART",78,0)
 S RADXCODE=$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13)
"RTN","RART",79,0)
 W !?3,"Primary Diagnostic Code: ",!?2,$S($D(^RA(78.3,+RADXCODE,0)):$P(^(0),U,1),1:"") K RAFLG
"RTN","RART",80,0)
 D WAIT^RART1:($Y+6)>IOSL&('$D(RARTVERF)) Q:X="^"!(X="T")!(X="P")
"RTN","RART",81,0)
 I '$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",0)) W ! Q
"RTN","RART",82,0)
 W !!?3,"Secondary Diagnostic Codes: "
"RTN","RART",83,0)
 S RADXCODE=0
"RTN","RART",84,0)
 F  S RADXCODE=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX","B",RADXCODE)) Q:RADXCODE'>0!('$D(^RA(78.3,+RADXCODE,0)))!($D(RAOOUT))  K RAFLG D WAIT^RART1:($Y+6)>IOSL&('$D(RARTVERF)) Q:X="^"!(X="T")!(X="P")  W !?2,$P(^RA(78.3,RADXCODE,0),U,1)
"RTN","RART",85,0)
 W !
"RTN","RART",86,0)
 Q
"RTN","RART",87,0)
EXIT ; Kill variables created when user prints 'Abnormal Rad/Nuc Med Report
"RTN","RART",88,0)
 ; Alert'.  Variables are created when 'PRT^RARTR' is called.
"RTN","RART",89,0)
 K %X,%XX,%Y,%YY,A,DDER,DFN,DI,DIR,DIW,DIWI,DIWT,DIWTC,DIWX,DLAYGO
"RTN","RART",90,0)
 K DN,RACI,RACN0,RACPT,RACPTNDE,RADTE0,RADTV,RAN,RAOBR4,RAPRCNDE
"RTN","RART",91,0)
 K RAPROC,RAPROCIT,RAPRV,RARPT0,VA,VADM,VAERR,X2,ZTSK
"RTN","RART",92,0)
 Q
"RTN","RARTE")
0^11^B30875065^B27555135
"RTN","RARTE",1,0)
RARTE ;HISC/FPT,GJC AISC/MJK,RMO-Edit/Delete Reports ;8/4/97  09:09
"RTN","RARTE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,34,45,56**;Mar 16, 1998;Build 3
"RTN","RARTE",3,0)
 ;Supported IA #3544 ^VA(200,"ARC"
"RTN","RARTE",4,0)
 ;Supported IA #10076 ^XUSEC(
"RTN","RARTE",5,0)
 ;Supported IA #2056 ^GET1^DIQ
"RTN","RARTE",6,0)
 ;Supported IA #10009 YN^DICN
"RTN","RARTE",7,0)
 ; last modification by SS for P18 June 14,2000
"RTN","RARTE",8,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE",9,0)
 W !!?3,"Note: To enter receipt of OUTSIDE INTERPRETED REPORTS,",!?3,"please use the 'Outside Report/Entry Edit' option.",!
"RTN","RARTE",10,0)
 N RAXIT,RADRS,RASUBY0 S RAXIT=0 ;RADRS=copy (1=diag, 2=resid,staff)
"RTN","RARTE",11,0)
 I $D(RANOSCRN) S X=$$DIVLOC^RAUTL7() I X D Q^RARTE4 QUIT
"RTN","RARTE",12,0)
 ;
"RTN","RARTE",13,0)
 ;1. DO NOT KILL the RASIG variable; the RASIG() array is needed in
"RTN","RARTE",14,0)
 ;   the edit template [RA REPORT EDIT] later
"RTN","RARTE",15,0)
 ;2. The RAELESIG canNOT store file 74's ien, as no rpt has been picked
"RTN","RARTE",16,0)
 ;   from this call to ES^RASIGU
"RTN","RARTE",17,0)
 ;
"RTN","RARTE",18,0)
 I $D(^XUSEC("RA VERIFY",DUZ)),($$GET1^DIQ(200,DUZ_",",20.4)]""),($D(^VA(200,"ARC","R",DUZ))!($D(^VA(200,"ARC","S",DUZ)))) D  Q:'$D(RAELESIG)
"RTN","RARTE",19,0)
 . W ! D ES^RASIGU S:%=1 RAELESIG=""
"RTN","RARTE",20,0)
 . K:'$D(RAELESIG) %,%W,%Y,%Y1,C,X,X1,X2
"RTN","RARTE",21,0)
 . Q
"RTN","RARTE",22,0)
 K RABTCH I $P(RAMDV,"^",13) D ASKBTCH^RARTE1 G Q1^RARTE4:X["^" D 1^RABTCH:"Yy"[$E(X) I '$D(RABTCH) W " ...no batch selected",!
"RTN","RARTE",23,0)
START K RAVER S RAVW="",RAREPORT=1 D ^RACNLU G Q^RARTE4:"^"[X
"RTN","RARTE",24,0)
 S RASUBY0=Y(0) ; save value of y(0)
"RTN","RARTE",25,0)
 G:$P(^RA(72,+RAST,0),"^",3)>0 DISPLAY
"RTN","RARTE",26,0)
 I $D(^XUSEC("RA MGR",DUZ)) G DISPLAY
"RTN","RARTE",27,0)
 G:$P(RAMDV,"^",22)=1 DISPLAY
"RTN","RARTE",28,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!! D INCRPT^RARTE4 G START
"RTN","RARTE",29,0)
 ;
"RTN","RARTE",30,0)
DISPLAY ; Display exam specific info, edit/enter the report
"RTN","RARTE",31,0)
 N RA18EX S RA18EX=0 ;P18 for quit if uparrow inside PUTTCOM
"RTN","RARTE",32,0)
 I '($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))#2) D  D Q^RARTE4 QUIT
"RTN","RARTE",33,0)
 . W !!?2,"Case #: ",RACN," for ",RANME S RAXIT=1
"RTN","RARTE",34,0)
 . W !?2,"Procedure: '",$E(RAPRC,1,45),"' has been deleted"
"RTN","RARTE",35,0)
 . W !?2,"by another user!",$C(7)
"RTN","RARTE",36,0)
 . Q
"RTN","RARTE",37,0)
 ;Lock case node so no one else can edit rpt pointer during this session
"RTN","RARTE",38,0)
 S RAPNODE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE",39,0)
 S RAXIT=$$LOCK^RAUTL12(RAPNODE,RACNI) I RAXIT D INCRPT^RARTE4 G START
"RTN","RARTE",40,0)
 S RAI="",$P(RAI,"-",80)="" W !,RAI
"RTN","RARTE",41,0)
 W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN
"RTN","RARTE",42,0)
 W !?1,"Case No. : ",RACN,?18,"Exm. St: ",$E($P($G(^RA(72,+RAST,0)),"^"),1,12),?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RARTE",43,0)
        ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTE",44,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTE",45,0)
 D:$L(RACMDATA) CMEDIA(RACMDATA)
"RTN","RARTE",46,0)
 K RACMDATA
"RTN","RARTE",47,0)
 S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,RACN," Tech.Comment: ",15,70,-1,0) ;P18
"RTN","RARTE",48,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE",49,0)
 N RAPRTSET,RAMEMARR,RA1
"RTN","RARTE",50,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RARTE",51,0)
 I RAPRTSET D
"RTN","RARTE",52,0)
 . S RA1=""
"RTN","RARTE",53,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""!(RA18EX=-1)  I RA1'=RACNI D
"RTN","RARTE",54,0)
 .. W !,?1,"Case No. : ",+RAMEMARR(RA1)
"RTN","RARTE",55,0)
 .. W:$P(RAMEMARR(RA1),"^",4)]"" ?18,"Exm. St: ",$E($P($G(^RA(72,$P(RAMEMARR(RA1),"^",4),0)),"^"),1,12)
"RTN","RARTE",56,0)
 .. W ?40,"Procedure   : ",$E($P($G(^RAMIS(71,+$P(RAMEMARR(RA1),"^",2),0)),"^"),1,26)
"RTN","RARTE",57,0)
 ..;check printset for contrast media; display if CM data exists
"RTN","RARTE",58,0)
 ..S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RA1)
"RTN","RARTE",59,0)
 ..D:$L(RACMDATA) CMEDIA(RACMDATA)
"RTN","RARTE",60,0)
 ..K RACMDATA
"RTN","RARTE",61,0)
 .. S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,+RAMEMARR(RA1)," Tech.Comment: ",15,70,-1,0) Q:RA18EX=-1  ;P18
"RTN","RARTE",62,0)
 .. Q
"RTN","RARTE",63,0)
 . Q
"RTN","RARTE",64,0)
SS1 I RA18EX=-1 Q  ;P18
"RTN","RARTE",65,0)
 S Y(0)=RASUBY0
"RTN","RARTE",66,0)
 W !?1,"Exam Date: ",RADATE,?40,"Technologist: " I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0))>0,$D(^VA(200,+^($O(^(0)),0),0)) W $E($P(^(0),"^"),1,25)
"RTN","RARTE",67,0)
 W !?40,"Req Phys    : ",$E($S($D(^VA(200,+$P(Y(0),"^",14),0)):$P(^(0),"^"),1:""),1,25),!,RAI
"RTN","RARTE",68,0)
 I $D(^RARPT(+RARPT,0)) S RA1=$P(^(0),"^",5) I "^V^EF^"[("^"_RA1_"^") W !?3,$C(7),"Report has already been ",$S(RA1="V":"verified",1:"electronically filed"),! D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",69,0)
 ;Create new rpt, or skip to IN to edit existing report
"RTN","RARTE",70,0)
 G IN^RARTE4:$D(^RARPT(+RARPT,0))
"RTN","RARTE",71,0)
 G:'RAPRTSET NEW G:$P(^RA(72,+RAST,0),"^",3)>0 NEW
"RTN","RARTE",72,0)
 ; case is part of a print set, AND is cancelled
"RTN","RARTE",73,0)
 N RA2 S (RA1,RA2)=""
"RTN","RARTE",74,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S:$P(RAMEMARR(RA1),"^",3)]"" RA2=$P(RAMEMARR(RA1),"^",3)
"RTN","RARTE",75,0)
 G:RA2="" NEW
"RTN","RARTE",76,0)
 W !!,$C(7),"Other cases of this cancelled case ",RACN,"'s print set are entered in a report already",!!,"You may NOT create a new report for this cancelled case,",!,"but you may include this cancelled case in the existing report."
"RTN","RARTE",77,0)
 W !!,"Do you want to include this cancelled case in the same report",!,"as the others in the print set ?"
"RTN","RARTE",78,0)
 S %=2 D YN^DICN
"RTN","RARTE",79,0)
 W:%>0 "...",$S(%=1:"Include",1:"Skip")," this case"
"RTN","RARTE",80,0)
 I %=1 S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)=RA2,RARPT=RA2,RARPTN=$P(^RARPT(RARPT,0),"^"),RA1=RACN D INSERT^RARTE2
"RTN","RARTE",81,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",82,0)
NEW G:'RAPRTSET NEW1
"RTN","RARTE",83,0)
 L +^RADPT(RADFN,"DT",RADTI):0 G:$T NEW1
"RTN","RARTE",84,0)
 W !!?10,$C(7),"** This case belongs to a printset,",?68,"**",!?10,"** and someone else is currently doing REPORT ENTRY/EDIT",?68,"**"
"RTN","RARTE",85,0)
 W !?10,"** on another case for this same printset,",?68,"**",!?10,"** so you may not enter a new report.",?68,"**"
"RTN","RARTE",86,0)
 H 2 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",87,0)
NEW1 S RARPTN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN
"RTN","RARTE",88,0)
 W !?3,"...report not entered for this exam...",!?10,"...will now initialize report entry..."
"RTN","RARTE",89,0)
 S I=+$P(^RARPT(0),"^",3)
"RTN","RARTE",90,0)
 G LOCK^RARTE4
"RTN","RARTE",91,0)
 Q
"RTN","RARTE",92,0)
 ;
"RTN","RARTE",93,0)
CMEDIA(X) ;check if contrast media is associated with the report (exam)
"RTN","RARTE",94,0)
 ;variables assumed to exist X: the string of contrast media used
"RTN","RARTE",95,0)
 ;delimited by the comma.
"RTN","RARTE",96,0)
 N Y W !," Contrast :"
"RTN","RARTE",97,0)
 F Y=1:1 Q:$P(X,", ",Y)=""  W ?12,$P(X,", ",Y) W:$P(X,", ",Y+1)'="" !
"RTN","RARTE",98,0)
 Q
"RTN","RARTE1")
0^12^B63911053^B60110939
"RTN","RARTE1",1,0)
RARTE1 ;HISC/CAH,FPT,GJC AISC/MJK,RMO-Edit/Delete a Report ;6/10/98  16:08
"RTN","RARTE1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,15,17,23,31,68,56**;Mar 16, 1998;Build 3
"RTN","RARTE1",3,0)
 ;Private IA #4793 DELETE^WVRALINK, CREATE^WVRALINK 
"RTN","RARTE1",4,0)
 ;Supported IA #10035
"RTN","RARTE1",5,0)
 ;Supported IA #10007
"RTN","RARTE1",6,0)
 ;11/07/2005 KAM/BAY 110020 - Correct DUZ ID from Talk Technology
"RTN","RARTE1",7,0)
 ;                            During the Unverify process
"RTN","RARTE1",8,0)
DEL D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE1",9,0)
 S (RAPRG74,RAXIT)=0
"RTN","RARTE1",10,0)
 S DIC("A")="Select Report Day-Case#: "
"RTN","RARTE1",11,0)
 S DIC("W")="S RA0=^(0) W ""   "",$S($D(^DPT(+$P(RA0,""^"",2),0)):$P(^(0),""^""),1:""Unknown"") K RA0 W ""   "",$$FLD^RARTFLDS(+Y,""PROC"")"
"RTN","RARTE1",12,0)
 S DIC("S")="I $P(^(0),U,5)'=""X""" ;select only non-deleted reports
"RTN","RARTE1",13,0)
 S DIC="^RARPT(",DIC(0)="AEMQZ" D ^DIC K DIC G END:Y<0
"RTN","RARTE1",14,0)
 S RA0=Y(0),(DA,RAIEN)=+Y
"RTN","RARTE1",15,0)
 I $O(^RARPT(RAIEN,2005,0)) D  D END Q
"RTN","RARTE1",16,0)
 . W !!?5,"Cannot delete a report that is associated with an image."
"RTN","RARTE1",17,0)
 . W !?5,"Contact your Imaging Coordinator for further assistance.",!
"RTN","RARTE1",18,0)
 . S DIR(0)="E",DIR("A")="Press RETURN to continue"
"RTN","RARTE1",19,0)
 . D ^DIR K DIR,DIRUT,DUOUT
"RTN","RARTE1",20,0)
 . Q  ;08/23/00
"RTN","RARTE1",21,0)
 D CHK17^RARTE3 ;see this subroutine for values of RAOK
"RTN","RARTE1",22,0)
 G:RAOK=1 END ;can't del rpt w/o RACN or RACNI so avoid err at UP1^RAUTL1
"RTN","RARTE1",23,0)
 S RAXIT=$$LOCK^RAUTL12("^RARPT(",RAIEN)
"RTN","RARTE1",24,0)
 I RAXIT K RAXIT D END Q  ; record locked by another
"RTN","RARTE1",25,0)
ASKDEL ; ask if deletion is appropriate
"RTN","RARTE1",26,0)
 R !!,"Do you wish to delete this report? NO// ",X:DTIME
"RTN","RARTE1",27,0)
 S:'$T!(X="")!(X["^") X="N"
"RTN","RARTE1",28,0)
 I "Nn"[$E(X) D UNLOCK^RAUTL12("^RARPT(",RAIEN) G DEL
"RTN","RARTE1",29,0)
 I "Yy"'[$E(X) D  G ASKDEL
"RTN","RARTE1",30,0)
 . W:X'["?" $C(7)
"RTN","RARTE1",31,0)
 . W !!?3,"Enter 'YES' to delete this report, or 'NO' not to."
"RTN","RARTE1",32,0)
 . Q
"RTN","RARTE1",33,0)
 ; comment out next line, these 3 vars are already set by CHK17^RARTE3
"RTN","RARTE1",34,0)
 ;S RADFN=+$P(RA0,"^",2),RADTI=9999999.9999-$P(RA0,"^",3),RACN=$P(RA0,"^",4)
"RTN","RARTE1",35,0)
 G:RAOK=2 AD2 ;don't remove piece 17 if rpt doesn't match exm's rpt ptr
"RTN","RARTE1",36,0)
 ; del other member's REPORT TEXT xrefs, and set pointer to #74 as null
"RTN","RARTE1",37,0)
 D DEL17^RARTE2(RAIEN) ;del ptrs to file 74 excluding lead case of prtset
"RTN","RARTE1",38,0)
 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0))
"RTN","RARTE1",39,0)
 G:'$D(^RADPT(RADFN,"DT",RADTI,"P",+RACNI,0))#2 AD2
"RTN","RARTE1",40,0)
 ; kill any xrefs for file #70's REPORT TEXT
"RTN","RARTE1",41,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI D ENKILL^RAXREF(70.03,17,RAIEN,.DA)
"RTN","RARTE1",42,0)
 ; set REPORT TEXT to null
"RTN","RARTE1",43,0)
 S $P(^RADPT(RADFN,"DT",RADTI,"P",+RACNI,0),"^",17)=""
"RTN","RARTE1",44,0)
AD2 K RAXIT S RAPRG74=1 ;RAPRG74 used in kill logic file 74 fld .01
"RTN","RARTE1",45,0)
 D MARKDEL^RARTE7 ; mark report deleted, save DXs, remov DXs fm case(s)
"RTN","RARTE1",46,0)
 W !?10,"...report deletion complete."
"RTN","RARTE1",47,0)
 D:RAOK'=2 UP1^RAUTL1 ;skip update status if report doesn't belong to exm
"RTN","RARTE1",48,0)
 D UPDTPNT^RAUTL9(RAIEN) ; Update pointers in 74.2, and 74.4!
"RTN","RARTE1",49,0)
 D UNLOCK^RAUTL12("^RARPT(",RAIEN) ; unlock report
"RTN","RARTE1",50,0)
 I RAOK'=2,$T(DELETE^WVRALINK)]"" D DELETE^WVRALINK(RADFN,RADTI,RACNI) ; women's health, skip if report doesn't belong to exm
"RTN","RARTE1",51,0)
END K %,%Y,D0,DA,DIC,DIE,RAJ1,DIK,RADFN,RADTI,RACN,RACNI,RA0,RAIEN,RAOR
"RTN","RARTE1",52,0)
 K RADUZ,RAORDIFN,RAPRG74,RASN,RASTI,Y
"RTN","RARTE1",53,0)
 K RADATE,RADTE,X
"RTN","RARTE1",54,0)
 K RA791,RACANC,RACN0,RACPT,RACPTNDE,RAI,RAN,RAOBR4,RAPKG,RAPRCNDE,RAPROC,RAPROCIT,RAPRV,RASULT,RAXIT
"RTN","RARTE1",55,0)
 K C,D,D1,DDER,DDH,DFN,DI,DISYS,DIWF,DIWL,DIWR,DQ,DR,GMRAL,HLN,HLRESLT,HLSAN,I,VA,VADM,VAERR,X0
"RTN","RARTE1",56,0)
 Q
"RTN","RARTE1",57,0)
 ;
"RTN","RARTE1",58,0)
UNVER(RAXRPT) ; unverify a report
"RTN","RARTE1",59,0)
 ; Input: if RAXRPT>0 then we know the report we wish to delete
"RTN","RARTE1",60,0)
 ;                    this requires no user interaction.
"RTN","RARTE1",61,0)
 ;           RAXRPT=0 user is prompted for the report they wish to
"RTN","RARTE1",62,0)
 ;                    delete (interactive)
"RTN","RARTE1",63,0)
 ;
"RTN","RARTE1",64,0)
 I 'RAXRPT D SET^RAPSET1 G Q:$D(XQUIT)
"RTN","RARTE1",65,0)
 I RAXRPT N X S X=RAXRPT
"RTN","RARTE1",66,0)
 S RAXIT=0,DIC="^RARPT(",DIC("S")="I $P(^(0),U,5)=""V"""
"RTN","RARTE1",67,0)
 S DIC(0)=$S('RAXRPT:"AEMQZ",1:"NZ")
"RTN","RARTE1",68,0)
 D DICW,^DIC K DIC I Y<0 D Q Q
"RTN","RARTE1",69,0)
 S RA74B4=$G(Y(0))
"RTN","RARTE1",70,0)
 S (RARPT,DA)=+Y,RADFN=$P(Y(0),U,2)
"RTN","RARTE1",71,0)
 S RADTI=9999999.9999-$P(Y(0),"^",3),RACN=$P(Y(0),"^",4)
"RTN","RARTE1",72,0)
 I 'RAXRPT S DR="D EN1^RAUTL9 I $D(DIRUT) S Y=""@99"";S:RASTATX'=""PD"" Y=""@10"";25;@10;5////^S X=RASTATX;S:X=""V"" Y=""@99"";9///@;17///@;100///NOW;@99"
"RTN","RARTE1",73,0)
 S:RAXRPT DR="5////^S X=""D"";9///@;17///@;100///NOW"
"RTN","RARTE1",74,0)
 ;11/07/2005 KAM/BAY 110020 Modified next line to look for voice recognition
"RTN","RARTE1",75,0)
 S DIE="^RARPT(",DR(2,74.01)="2////U;3////"_$S(($D(RAQUIET)#2)&($D(RASUB)#2):$G(^TMP("RARPT-REC",$J,RASUB,"RAVERF")),1:DUZ)
"RTN","RARTE1",76,0)
 S RAXIT=$$LOCK^RAUTL12("^RARPT(",RARPT)
"RTN","RARTE1",77,0)
 I RAXIT D Q QUIT
"RTN","RARTE1",78,0)
 D ^DIE K DE,DQ,DIE,DR D UNLOCK^RAUTL12("^RARPT(",RARPT)
"RTN","RARTE1",79,0)
 N RA1,RA2,RA3,RA4 S RA1=RADFN,RA2=RADTI,RA3=RACN,RA4=RARPT
"RTN","RARTE1",80,0)
 S RA(0)=$G(^RARPT(RARPT,0)),RA(5)=$P(^RARPT(RARPT,0),"^",5)
"RTN","RARTE1",81,0)
 S RA(7)=$P(^RARPT(RARPT,0),"^",7),RA(10)=$P(^RARPT(RARPT,0),"^",10)
"RTN","RARTE1",82,0)
 I RA(5)'="V" D
"RTN","RARTE1",83,0)
 . I RA(7)]"" D ENKILL^RAXREF(74,7,RA(7),RARPT) S $P(^RARPT(RARPT,0),"^",7)=""
"RTN","RARTE1",84,0)
 . I RA(10)]"" D ENKILL^RAXREF(74,10,RA(10),RARPT) S $P(^RARPT(RARPT,0),"^",10)=""
"RTN","RARTE1",85,0)
 . N RADDEN,RAUTOE S (RADDEN,RAUTOE)="" D ^RARTR,EN1^RARTE3(RA4)
"RTN","RARTE1",86,0)
 . Q
"RTN","RARTE1",87,0)
 S RADFN=RA1,RADTI=RA2,RACN=RA3,RARPT=RA4
"RTN","RARTE1",88,0)
 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0)) I $D(^RADPT(RADFN,"DT",RADTI,"P",+RACNI,0)) D UP1^RAUTL1 I $D(^RABTCH(74.4,"B",RARPT)) D
"RTN","RARTE1",89,0)
 .S DA=0 F  S DA=$O(^RABTCH(74.4,"B",RARPT,DA)) Q:'DA  D
"RTN","RARTE1",90,0)
 ..S DIK="^RABTCH(74.4," D ^DIK
"RTN","RARTE1",91,0)
 ..Q
"RTN","RARTE1",92,0)
 .Q
"RTN","RARTE1",93,0)
 I "^V^EF^"'[("^"_$P($G(^RARPT(RARPT,0)),"^",5)_"^"),$T(DELETE^WVRALINK)]"" D DELETE^WVRALINK(RADFN,RADTI,RACNI) ; women's health
"RTN","RARTE1",94,0)
 ;
"RTN","RARTE1",95,0)
Q ; Kill and quit
"RTN","RARTE1",96,0)
 K DFN,DI,DIW,DIWF,DIWI,DIWL,DIWT,DIWTC,DIWX,RAACNT,RANUM,RAST,RAWHOVER
"RTN","RARTE1",97,0)
 K %,%DT,%W,%Y,%Y1,C,D,D0,D1,DA,DIC,DIE,DIK,DR,RA,RACN,RACNI,RADATE
"RTN","RARTE1",98,0)
 K RADFN,RADIV,RADTE,RADTI,RAJ,RAOR,RAORDIFN,RARPT,RASET,RASN,RASTATX
"RTN","RARTE1",99,0)
 K RASTI,RAXIT,X,XQUIT,Y,RA74B4,DDH,DIPGM,DISYS,I,RADUZ
"RTN","RARTE1",100,0)
 Q
"RTN","RARTE1",101,0)
 ;
"RTN","RARTE1",102,0)
STD S (RALR,RALI)=1
"RTN","RARTE1",103,0)
STD1 S DIC="^RA(74.1,",DIC("A")="Select 'Standard' Report to Copy: ",DIC(0)="AEMQ" D ^DIC K DIC("A") Q:Y<0
"RTN","RARTE1",104,0)
ASKSEL W:$$IMPRPT(RARPT) !!,"Report already exists.  This will over-write it."
"RTN","RARTE1",105,0)
 W !,"Are you sure you want the '",$P(Y,"^",2),"' standard report? No// " R X:DTIME G STD1:'$T!(X="")!(X["^")!("Nn"[$E(X))
"RTN","RARTE1",106,0)
 I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to select the '",$P(Y,"^",2),"' standard report, or 'NO' not to." G ASKSEL
"RTN","RARTE1",107,0)
 I RALR=1,RALI=1 K ^RARPT(RARPT,"R"),^("I")
"RTN","RARTE1",108,0)
 F I=1:1 Q:'$D(^RA(74.1,+Y,"R",I,0))  S ^RARPT(RARPT,"R",RALR,0)=^(0),RALR=RALR+1
"RTN","RARTE1",109,0)
 F I=1:1 Q:'$D(^RA(74.1,+Y,"I",I,0))  S ^RARPT(RARPT,"I",RALI,0)=^(0),RALI=RALI+1
"RTN","RARTE1",110,0)
ASKADD R !!,"Do you want to add another standard to this report? No// ",X:DTIME Q:'$T!(X="")!(X["^")!("Nn"[$E(X))  I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to add another standard to this report, or 'NO' not to." G ASKADD
"RTN","RARTE1",111,0)
 S (^RARPT(RARPT,"R",RALR,0),^RARPT(RARPT,"I",RALI,0))="",RALR=RALR+1,RALI=RALI+1 W ! G STD1
"RTN","RARTE1",112,0)
 ;
"RTN","RARTE1",113,0)
EDTRPT ; Called from 'RARTE4' and 'RARTVER'.
"RTN","RARTE1",114,0)
 S RACT=$S('+$G(^RARPT(RARPT,"T")):"I",1:"E")
"RTN","RARTE1",115,0)
 S:'$D(^RARPT(RARPT,"T")) ^("T")=""
"RTN","RARTE1",116,0)
 S DA=RARPT,DR="[RA REPORT EDIT]",DIE="^RARPT(" D ^DIE K DE,DQ ;,RAFLAGK
"RTN","RARTE1",117,0)
 I $D(Y),RACT="V",'$P(^RARPT(RARPT,0),"^",9) W !,$C(7),"You must enter a verifying Interpreting Physician to 'VERIFY' a report.",!?3,"...report status will now be changed to 'DRAFT'." S DA=RARPT,DR="5///D" D ^DIE K DE,DQ ;Q
"RTN","RARTE1",118,0)
 Q:$D(RAONLINE)&($G(RARDX)="E")
"RTN","RARTE1",119,0)
 ; move PACS line to its own subroutine
"RTN","RARTE1",120,0)
 ;I $D(RAFLAGK) K RAFLAGK Q
"RTN","RARTE1",121,0)
 G:$D(Y) PACS
"RTN","RARTE1",122,0)
 ;Since report editing is not necessarily screened by sign-on imaging
"RTN","RARTE1",123,0)
 ;type, use the imaging type on the exam record   ;ch
"RTN","RARTE1",124,0)
 S RAIMGTYI=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U)
"RTN","RARTE1",125,0)
 S X=+$O(^RA(72,"AA",RAIMGTYJ,9,0)),DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P""," K RAIMGTYI,RAIMGTYJ
"RTN","RARTE1",126,0)
 S DR=13_$S(RACT'="V":"",'$D(^RA(72,X,.1)):"",$P(^(.1),"^",5)'="Y":"",1:"R")_";I $D(^RA(78.3,+X,0)),$P(^(0),""^"",4)=""y"" S RAAB=1"
"RTN","RARTE1",127,0)
 S RAXIT=$$LOCK^RAUTL12(DIE,.DA)
"RTN","RARTE1",128,0)
 I RACT="V",$P($G(^RA(72,X,.1)),"^",5)="Y" S DIE("NO^")="BACK"
"RTN","RARTE1",129,0)
 I 'RAXIT D ^DIE D UNLOCK^RAUTL12(DIE,.DA) K DA,DE,DQ,DIE,DR
"RTN","RARTE1",130,0)
 I RAXIT!($P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13)="")!($D(Y)) K RAXIT G PACS
"RTN","RARTE1",131,0)
 S DR="50///"_RACN
"RTN","RARTE1",132,0)
 S DR(2,70.03)=13.1
"RTN","RARTE1",133,0)
 S DR(3,70.14)=.01_";I $D(^RA(78.3,+X,0)),$P(^(0),""^"",4)=""y"" S RAAB=1"
"RTN","RARTE1",134,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT"","
"RTN","RARTE1",135,0)
 S RAXIT=$$LOCK^RAUTL12("^RADPT("_RADFN_",""DT"","_RADTI_",""P"",",.RACNI) ;lock at P level
"RTN","RARTE1",136,0)
 I 'RAXIT D ^DIE D UNLOCK^RAUTL12("^RADPT("_RADFN_",""DT"","_RADTI_",""P"",",.RACNI) K DA,DE,DQ,DIE,DR ;unlock at P level
"RTN","RARTE1",137,0)
 K RAXIT
"RTN","RARTE1",138,0)
PACS I ($P(^RARPT(RARPT,0),U,5)="V")!($P(^(0),U,5)="R") D RPT^RAHLRPC
"RTN","RARTE1",139,0)
 I "^V^EF"[("^"_$P(^RARPT(RARPT,0),U,5)_"^"),$T(CREATE^WVRALINK)]"" D CREATE^WVRALINK(RADFN,RADTI,RACNI) ; women's health
"RTN","RARTE1",140,0)
 Q
"RTN","RARTE1",141,0)
 ;
"RTN","RARTE1",142,0)
ASKBTCH R !!,"Do you want to batch print reports? Yes// ",X:DTIME S:'$T X="^" S:X="" X="Y" Q:X["^"  I "Nn"'[$E(X),"Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to batch print reports, or 'NO' not to." G ASKBTCH
"RTN","RARTE1",143,0)
 Q
"RTN","RARTE1",144,0)
 ;
"RTN","RARTE1",145,0)
ASKPRT R !!,"Do you want to print batch now? No// ",X:DTIME S:'$T!(X="")!(X["^") X="N" I "Nn"'[$E(X),"Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to print this batch, or 'NO' not to." G ASKPRT
"RTN","RARTE1",146,0)
 Q
"RTN","RARTE1",147,0)
DICW ; Build DIC("W") string
"RTN","RARTE1",148,0)
 N DO D DO^DIC1
"RTN","RARTE1",149,0)
 S DIC("W")=$S($G(DIC("W"))]"":DIC("W")_" ",1:"")_"W ""   "",$$FLD^RARTFLDS(+Y,""PROC"")"
"RTN","RARTE1",150,0)
 Q
"RTN","RARTE1",151,0)
IMPRPT(Y) ; Does the report we are currently editing have either Report
"RTN","RARTE1",152,0)
 ; or Impression Text?
"RTN","RARTE1",153,0)
 ; Input : 'Y' - the ien of the report being edited
"RTN","RARTE1",154,0)
 ; Output: '1' - either impression or report text exists, '0' - neither
"RTN","RARTE1",155,0)
 ;               report or impression text exists.
"RTN","RARTE1",156,0)
 Q $S(+$O(^RARPT(Y,"I",0)):1,+$O(^RARPT(Y,"R",0)):1,1:0)
"RTN","RARTE3")
0^13^B5429116^B5422561
"RTN","RARTE3",1,0)
RARTE3 ;HISC/GJC-Create a skeletal report, store in Error Reports multiple ;2/4/97  09:39
"RTN","RARTE3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**31,56**;Mar 16, 1998;Build 3
"RTN","RARTE3",3,0)
 ;Supported IA #10103 NOW^XLFDT
"RTN","RARTE3",4,0)
 ;Supported IA #2053 UPDATE^DIE
"RTN","RARTE3",5,0)
 ; This routine will be accessed when the user unverifies a report.
"RTN","RARTE3",6,0)
 ; At this time, a skeletal copy of the report will be stored off
"RTN","RARTE3",7,0)
 ; in the 'Error Reports' multiple.  This will keep track of report
"RTN","RARTE3",8,0)
 ; addendums.
"RTN","RARTE3",9,0)
EN1(RADA) ; Create the 'Error Reports' sub-record.
"RTN","RARTE3",10,0)
 ; Input: 'RADA': IEN of the report in file 74.
"RTN","RARTE3",11,0)
 ; Create the record, enter when the report was unverified.
"RTN","RARTE3",12,0)
 Q:'($D(^TMP($J,"RA AUTOE"))\10)
"RTN","RARTE3",13,0)
 N RACNT,RAIEN,RANEW,RANOW,X S RANOW=$$NOW^XLFDT()
"RTN","RARTE3",14,0)
 S RANEW(74.06,"+1,"_RADA_",",.01)=RANOW
"RTN","RARTE3",15,0)
 D UPDATE^DIE("","RANEW","RAIEN","")
"RTN","RARTE3",16,0)
 ; Error Report date/time field created, now the skeletal report text
"RTN","RARTE3",17,0)
 S RADA(1)=RADA,RADA=+$G(RAIEN(1)) Q:'RADA  ; sub-file ien not created
"RTN","RARTE3",18,0)
 S RACNT=+$O(^TMP($J,"RA AUTOE",999999999999),-1)
"RTN","RARTE3",19,0)
 D ZERO K ^TMP($J,"RA AUTOE")
"RTN","RARTE3",20,0)
 Q
"RTN","RARTE3",21,0)
ZERO ; setup the ^TMP($J,"RA AUTOE" global with a zero node
"RTN","RARTE3",22,0)
 S ^RARPT(RADA(1),"ERR",RADA,"RPT",0)="^^"_RACNT_"^"_RACNT_"^"_(RANOW\1)_"^"
"RTN","RARTE3",23,0)
 N I S I=0
"RTN","RARTE3",24,0)
 F  S I=$O(^TMP($J,"RA AUTOE",I)) Q:I'>0  D
"RTN","RARTE3",25,0)
 . S ^RARPT(RADA(1),"ERR",RADA,"RPT",I,0)=$G(^TMP($J,"RA AUTOE",I))
"RTN","RARTE3",26,0)
 . Q
"RTN","RARTE3",27,0)
 Q
"RTN","RARTE3",28,0)
CHK17 ; called from routine RARTE1
"RTN","RARTE3",29,0)
 ; check 17th piece of exam with same pat/dttm/longcn
"RTN","RARTE3",30,0)
 ; values of RAOK:
"RTN","RARTE3",31,0)
 ; 1 = unknown case no. or unknown case ien, CAN'T DELETE REPORT
"RTN","RARTE3",32,0)
 ; 2 = exm doesn't point to this rpt, CAN DELETE BUT NOT UPGRADE EXM STAT
"RTN","RARTE3",33,0)
 ; 3 = all okay
"RTN","RARTE3",34,0)
 S RAOK=3
"RTN","RARTE3",35,0)
 S RADFN=+$P(RA0,"^",2),RADTI=9999999.9999-$P(RA0,"^",3)
"RTN","RARTE3",36,0)
 S RACN=$P($P(RA0,"^"),"-",2) ;get from longcase no.'s 2nd part
"RTN","RARTE3",37,0)
 I RACN="" D WARN1,PRESS Q
"RTN","RARTE3",38,0)
 S RACNI=+$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0))
"RTN","RARTE3",39,0)
 I 'RACNI D WARN1,PRESS Q
"RTN","RARTE3",40,0)
 I $P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",17)'=RAIEN D WARN2,PRESS
"RTN","RARTE3",41,0)
 Q
"RTN","RARTE3",42,0)
WARN1 W !!?3,"** Cannot determine internal or external case number. **"
"RTN","RARTE3",43,0)
 W !!?3,"** You may NOT delete this report. **"
"RTN","RARTE3",44,0)
 S RAOK=1
"RTN","RARTE3",45,0)
 Q
"RTN","RARTE3",46,0)
WARN2 W !!?3,"** This report refers to an exam that isn't pointing back to this report. **"
"RTN","RARTE3",47,0)
 S RAOK=2
"RTN","RARTE3",48,0)
WARNQ W !!?3,"** You may delete this report if it is indeed the report you don't want. **"
"RTN","RARTE3",49,0)
 W !?3,"** Or call IRM for help. **"
"RTN","RARTE3",50,0)
 Q
"RTN","RARTE3",51,0)
PRESS R !!?5,"Press RETURN to continue. ",X:DTIME
"RTN","RARTE3",52,0)
 Q
"RTN","RARTE4")
0^14^B26359911^B25247672
"RTN","RARTE4",1,0)
RARTE4 ;HISC/GJC - Edit/Delete Reports (cont) ;11/4/97  08:02
"RTN","RARTE4",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**15,27,41,82,56**;Mar 16, 1998;Build 3
"RTN","RARTE4",3,0)
 ;Supported IA #10060 ^VA(200
"RTN","RARTE4",4,0)
 ;Supported IA #10007 DO^DIC1
"RTN","RARTE4",5,0)
LOCK ;Try to lock next avail IEN, if locked - fail, if used - increment again
"RTN","RARTE4",6,0)
 S I=I+1 S RAXIT=$$LOCK^RAUTL12("^RARPT(",I) I RAXIT D UNLOCK2 D INCRPT G START^RARTE
"RTN","RARTE4",7,0)
 I $D(^RARPT(I))!($D(^RARPT("B",I))) D UNLOCK^RAUTL12("^RARPT(",I) G LOCK
"RTN","RARTE4",8,0)
 S ^RARPT(I,0)=RARPTN,RARPT=I,^(0)=$P(^RARPT(0),"^",1,2)_"^"_I_"^"_($P(^(0),"^",4)+1),^DISV($S($D(DUZ)#2:DUZ,1:0),"^RARPT(")=I S:'$D(^RARPT(RARPT,"T")) ^("T")=""
"RTN","RARTE4",9,0)
 S ^RARPT(RARPT,0)=RARPTN_"^"_RADFN_"^"_RADTE_"^"_RACN_"^D",DIK="^RARPT(",DA=RARPT D IX1^DIK
"RTN","RARTE4",10,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RARTE4",11,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTE4",12,0)
 S DIE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE4",13,0)
 S DR="17////"_RARPT D ^DIE
"RTN","RARTE4",14,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,RAY1,X,Y
"RTN","RARTE4",15,0)
 I RAPRTSET D PTR^RARTE2
"RTN","RARTE4",16,0)
 I RAXIT D UNLOCK2,UNLOCK^RAUTL12("^RARPT(",RARPT) Q
"RTN","RARTE4",17,0)
 G IN0
"RTN","RARTE4",18,0)
IN ;lock rpt for the 1st time if editing existing rpt
"RTN","RARTE4",19,0)
 S RAXIT=$$LOCK^RAUTL12("^RARPT(",RARPT) I RAXIT D UNLOCK2,Q Q
"RTN","RARTE4",20,0)
IN0 ;skip to here if rpt created in this session and already locked
"RTN","RARTE4",21,0)
 G IN1:'$P(RAMDV,"^",14) K RACOPY
"RTN","RARTE4",22,0)
 S DIC("S")="I RARPT'=+Y,$P(^(0),U,5)'=""X""" ;omit same & deleted rpt
"RTN","RARTE4",23,0)
 ; Remedy ticket #245679, remove multi-index lookup
"RTN","RARTE4",24,0)
 S DIC("A")="Select Report to Copy: ",DIC(0)="AEQ",DIC="^RARPT("
"RTN","RARTE4",25,0)
 D DICW,^DIC K DIC("S"),DIC("A") S RAY1=Y
"RTN","RARTE4",26,0)
 I X="^" D UNLOCK^RAUTL12("^RARPT(",RARPT),UNLOCK2 S RAXIT=$$EN3^RAUTL15(RARPT) D INCRPT G START^RARTE
"RTN","RARTE4",27,0)
 G IN1:RAY1<0
"RTN","RARTE4",28,0)
 F J="H","R","I" K ^RARPT(RARPT,J)
"RTN","RARTE4",29,0)
 F J="R","I" F I=1:1 Q:'$D(^RARPT(+Y,J,I,0))  S ^RARPT(RARPT,J,I,0)=^(0)
"RTN","RARTE4",30,0)
 ;F I=1:1 Q:'$D(^RADPT(RADFN,"DT",RADTI,"P",1,"H",I,0))  S ^RARPT(RARPT,"H",I,0)=^RADPT(RADFN,"DT",RADTI,"P",1,"H",I,0)
"RTN","RARTE4",31,0)
 S RACOPY=""
"RTN","RARTE4",32,0)
IN1 ;skip to here if div param disallows rpt copying
"RTN","RARTE4",33,0)
 I $P(RAMDV,"^",14) W !,RAI
"RTN","RARTE4",34,0)
 K RAFIN
"RTN","RARTE4",35,0)
 S DR="50///"_RACN
"RTN","RARTE4",36,0)
 S DR(2,70.03)="12//^S X=$S($D(RARES)&($D(RABTCH)):RARES,1:"""");S:$D(^VA(200,+X,0)) RARES=$P(^(0),U);I X'>0 S Y=""@15"";70;@15;15"
"RTN","RARTE4",37,0)
 I $P(RAMDV,"^",28) S DR(2,70.03)=DR(2,70.03)_"R" ; req'd for DIVISION
"RTN","RARTE4",38,0)
 S DR(2,70.03)=DR(2,70.03)_"//^S X=$S($D(RASTFF)&($D(RABTCH)):RASTFF,1:"""");S:$D(^VA(200,+X,0)) RASTFF=$P(^(0),U);I X'>0 S Y=""@1"";60;@1;S RAFIN="""""
"RTN","RARTE4",39,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT""," D ^DIE K DE,DQ
"RTN","RARTE4",40,0)
 D ELOC^RABWRTE ; Billing Aware -- ask Inter. Img Loc
"RTN","RARTE4",41,0)
 I RAPRTSET S RADRS=2 D COPY^RARTE2 ; copy resid and staff
"RTN","RARTE4",42,0)
 G PRT:'$D(RAFIN) W !,RAI
"RTN","RARTE4",43,0)
 ;
"RTN","RARTE4",44,0)
 ; **BNT - Commented out to stop copying history from file 70 to 74
"RTN","RARTE4",45,0)
 ; in patch RA*5*27.  The history is now referenced directly from file 70.
"RTN","RARTE4",46,0)
 ; I $D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H")),'$D(^RARPT(RARPT,"H")) F I=1:1 Q:'$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",I,0))  S ^RARPT(RARPT,"H",I,0)=^(0)
"RTN","RARTE4",47,0)
 ; **
"RTN","RARTE4",48,0)
 I '$D(RACOPY),$P(RAMDV,"^",12) D STD^RARTE1 I X="^" G PRT
"RTN","RARTE4",49,0)
 W !,RAI D EDTRPT^RARTE1
"RTN","RARTE4",50,0)
PRT D UNLOCK^RAUTL12(RAPNODE,RACNI)
"RTN","RARTE4",51,0)
 ; --- copy diags to other cases of print set
"RTN","RARTE4",52,0)
 I RAPRTSET S RADRS=1,RAXIT=0 D COPY^RARTE2 L -^RADPT(RADFN,"DT",RADTI) ;unlock dt level only after copying is done
"RTN","RARTE4",53,0)
 ; wait til report has been checked for completeness before unlocking it
"RTN","RARTE4",54,0)
 S RAXIT=$$EN3^RAUTL15(RARPT) D UNLOCK^RAUTL12("^RARPT(",RARPT)
"RTN","RARTE4",55,0)
 I RAXIT S RAXIT=0 D UNLOCK2 D INCRPT G START^RARTE
"RTN","RARTE4",56,0)
 ; ---
"RTN","RARTE4",57,0)
 D  K RAAB G PRT1:'$D(RABTCH),PRT1:'$D(^RABTCH(74.2,+RABTCH,0))
"RTN","RARTE4",58,0)
 .; RAHLTCPB flag is inactive
"RTN","RARTE4",59,0)
 .N RAHLTCPB S RAHLTCPB=1 D:$S('$D(RACT):0,RACT="V":1,1:0) UPSTAT^RAUTL0
"RTN","RARTE4",60,0)
 .D:$S('$D(RACT):1,RACT'="V":1,1:0) UP1^RAUTL1
"RTN","RARTE4",61,0)
ASKREP W !!,"Do you want to place this report in the batch ",RABTCHN,"? Yes// " R X:DTIME S:'$T!(X["^") X="N" S:X="" X="Y" G PRT1:"Nn"[$E(X)
"RTN","RARTE4",62,0)
 I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to place this report in the batch, or 'NO' not to." G ASKREP
"RTN","RARTE4",63,0)
 I $D(^RABTCH(74.2,"D",RARPT,RABTCH)) W !?5,"...report is already part of the '",RABTCHN,"' batch" D INCRPT G START^RARTE
"RTN","RARTE4",64,0)
 W !?5,"...will now place report in the '",RABTCHN,"' batch" S DIE="^RABTCH(74.2,",DA=RABTCH,DR="25///"_$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN,DR(2,74.21)="2////N" D ^DIE K DQ,DE D INCRPT G START^RARTE
"RTN","RARTE4",65,0)
PRT1 R !!,"Do you wish to print this report? No// ",X:DTIME S:'$T!(X["^") X="N" S:X="" X="N" ;030497
"RTN","RARTE4",66,0)
 I "Nn"[$E(X) D INCRPT G START^RARTE
"RTN","RARTE4",67,0)
 I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to print this report, or 'NO' not to." G PRT1
"RTN","RARTE4",68,0)
 S ION=$P(RAMLC,"^",10),IOP=$S(ION]"":"Q;"_ION,1:"Q")
"RTN","RARTE4",69,0)
 S RAMES="W !!?3,""Report has been queued for printing on device "",ION,""."""
"RTN","RARTE4",70,0)
 D Q^RARTR D INCRPT G START^RARTE
"RTN","RARTE4",71,0)
 ;
"RTN","RARTE4",72,0)
Q I $D(RABTCH),$D(^RABTCH(74.2,+RABTCH,"R",0)) D ASKPRT^RARTE1,BTCH^RABTCH:"Yy"[$E(X)
"RTN","RARTE4",73,0)
Q1 K %,%DT,%W,%Y,%Y1,C,D0,D1,DA,DIC,DIE,DR,OREND,RABTCH,RABTCHN,RACN,RACNI,RACOPY,RACS,RACT,RADATE,RADFN,RADTE,RADTI,RADUZ,RAELESIG,RAFIN,RAHEAD,RAI,RAJ1
"RTN","RARTE4",74,0)
 K RALI,RALR,RANME,RANUM,RAOR,RAORDIFN,RAPNODE,RAPRC,RAPRIT,RAQUIT,RAREPORT,RARES,RARPDT,RARPT,RARPTN,RARPTZ,RARTPN,RASET,RASI,RASIG,RASN,RASSN,RAST,RAST1,RASTI,RASTFF,RAVW,XQUIT,W,X,Y
"RTN","RARTE4",75,0)
 K D,D2,DDER,DI,DIPGM,DLAYGO,J,RAEND,RAF5,RAFL,RAFST,RAIX,RAPOP,RAY1
"RTN","RARTE4",76,0)
 K ^TMP($J,"RAEX")
"RTN","RARTE4",77,0)
 K POP,DUOUT
"RTN","RARTE4",78,0)
 Q
"RTN","RARTE4",79,0)
DICW ; Build DIC("W") string
"RTN","RARTE4",80,0)
 N DO D DO^DIC1
"RTN","RARTE4",81,0)
 S DIC("W")=$S($G(DIC("W"))]"":DIC("W")_" ",1:"")_"W ""   "",$$FLD^RARTFLDS(+Y,""PROC"")"
"RTN","RARTE4",82,0)
 Q
"RTN","RARTE4",83,0)
INCRPT ; Kill extraneous variables to avoid collisions.
"RTN","RARTE4",84,0)
 ; Incomplete report information, select another case #.
"RTN","RARTE4",85,0)
 K %,%DT,D,D0,D1,D2,DI,DIC,DIWT,DN,I,J,RACN,RACNI,RACT,RADATE,RADTE
"RTN","RARTE4",86,0)
 K RADTI,RAFIN,RAI,RALI,RALR,RANME,RAPRC,RARPT,RARPTN,RASSN,RAST,RAVW,X
"RTN","RARTE4",87,0)
 Q
"RTN","RARTE4",88,0)
UNLOCK2 D UNLOCK^RAUTL12(RAPNODE,RACNI) L -^RADPT(RADFN,"DT",RADTI)
"RTN","RARTE4",89,0)
 Q
"RTN","RARTE5")
0^15^B66404814^n/a
"RTN","RARTE5",1,0)
RARTE5 ;HISC/SWM AISC/MJK,RMO-Enter/Edit Outside Reports ;10/24/07  12:58
"RTN","RARTE5",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56**;Mar 16, 1998;Build 3
"RTN","RARTE5",3,0)
 ;Private IA #4793 CREATE^WVRALINK
"RTN","RARTE5",4,0)
 ;Controlled IA #3544 ^VA(200
"RTN","RARTE5",5,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RARTE5",6,0)
 ;Supported IA #10013 IX1^DIK
"RTN","RARTE5",7,0)
 ;Supported IA #10141 MES^XPDUTL
"RTN","RARTE5",8,0)
 ; adapted from RARTE, RARTE1, RARTE4
"RTN","RARTE5",9,0)
 F I=1:1:7 W !?3,$P($T(INTRO+I),";;",2)
"RTN","RARTE5",10,0)
 W ! D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE5",11,0)
 N RAXIT,RASUBY0,RA18EX,RAPRTSET,RAMEMARR,RA1,RA7003
"RTN","RARTE5",12,0)
 S RAXIT=0
"RTN","RARTE5",13,0)
 I $D(RANOSCRN) S X=$$DIVLOC^RAUTL7() I X D Q1 QUIT
"RTN","RARTE5",14,0)
 ;
"RTN","RARTE5",15,0)
 ; only require any Radiology Classification in New Person file
"RTN","RARTE5",16,0)
 S X=0 F I="C","R","S","T" S:$D(^VA(200,"ARC",I,DUZ)) X=1
"RTN","RARTE5",17,0)
 I 'X W !,"Your user account is missing a Radiology classification.",! D INCRPT Q
"RTN","RARTE5",18,0)
 ;
"RTN","RARTE5",19,0)
START K RAVER S RAVW="",RAREPORT=1 D ^RACNLU G Q1:"^"[X
"RTN","RARTE5",20,0)
 ; RACNLU defines RADFN, RADTI, RACNI, RARPT
"RTN","RARTE5",21,0)
 S RASUBY0=Y(0) ; save value of y(0)
"RTN","RARTE5",22,0)
 S RANUENTR=0 ;=0 subsequent edit of report, =1 initial making of report
"RTN","RARTE5",23,0)
 G:$P(^RA(72,+RAST,0),"^",3)>0 CONTIN
"RTN","RARTE5",24,0)
 I $D(^XUSEC("RA MGR",DUZ)) G CONTIN
"RTN","RARTE5",25,0)
 G:$P(RAMDV,"^",22)=1 CONTIN
"RTN","RARTE5",26,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!! D INCRPT G START
"RTN","RARTE5",27,0)
 ;
"RTN","RARTE5",28,0)
CONTIN ; continue
"RTN","RARTE5",29,0)
 S RAXIT=0 D DISPLAY^RARTE6
"RTN","RARTE5",30,0)
 I RA18EX=-1 D INCRPT G START
"RTN","RARTE5",31,0)
 ; raprtset is defined in display^rarte6
"RTN","RARTE5",32,0)
 I RAPRTSET W !,"OUTSIDE report cannot be linked to a printset." D INCRPT G START
"RTN","RARTE5",33,0)
 S RAPNODE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE5",34,0)
 S RA7003=@(RAPNODE_RACNI_",0)")
"RTN","RARTE5",35,0)
 S RAXIT=$$LOCK^RARTE6(RAPNODE,RACNI) I RAXIT D INCRPT G START
"RTN","RARTE5",36,0)
 ;
"RTN","RARTE5",37,0)
 ; Existing rpt must have field 5 = "EF" and field 18 with data
"RTN","RARTE5",38,0)
 I $D(^RARPT(+RARPT,0)),(($P(^(0),"^",5)'="EF")!($P(^(0),"^",18)="")) W !?3,$C(7),"Only Electronicaly Filed reports can be selected!",! D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT G START
"RTN","RARTE5",39,0)
 ;Create new rpt, or skip to IN to edit existing report
"RTN","RARTE5",40,0)
 G IN:$D(^RARPT(+RARPT,0))
"RTN","RARTE5",41,0)
 ; check Credit Method
"RTN","RARTE5",42,0)
 S X=$P(@(RAPNODE_RACNI_",0)"),U,26)
"RTN","RARTE5",43,0)
 I X'=2 W !!?3,"This option is for Outside work (imaged and read), so the case should ",!?3,"be 'No Credit', but this case has a credit method of '",$$GET1^DIQ(70.03,RACNI_","_RADTI_","_RADFN_",",26),"'"
"RTN","RARTE5",44,0)
 K DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","RARTE5",45,0)
 S DIR("A")="Do you want to continue"
"RTN","RARTE5",46,0)
 S DIR("?")="Enter YES to continue with this option"
"RTN","RARTE5",47,0)
 W ! D ^DIR K DIR
"RTN","RARTE5",48,0)
 I Y'=1 D INCRPT G START
"RTN","RARTE5",49,0)
 ;
"RTN","RARTE5",50,0)
 S RANUENTR=1 ; new report being made
"RTN","RARTE5",51,0)
NEW1 S RARPTN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN
"RTN","RARTE5",52,0)
 W !?3,"...report not entered for this exam...",!?10,"...will now initialize report entry..."
"RTN","RARTE5",53,0)
 S I=+$P(^RARPT(0),"^",3)
"RTN","RARTE5",54,0)
 ;
"RTN","RARTE5",55,0)
LOCK ;Try to lock next avail IEN, if locked - fail, if used - increment again
"RTN","RARTE5",56,0)
 S I=I+1 S RAXIT=$$LOCK^RARTE6("^RARPT(",I) I RAXIT D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT G START
"RTN","RARTE5",57,0)
 ;don't check ^RARPT("B",RARPTN) due cloaked deleted reports
"RTN","RARTE5",58,0)
 I $D(^RARPT(I)) D UNLOCK^RAUTL12("^RARPT(",I) G LOCK
"RTN","RARTE5",59,0)
 S ^RARPT(I,0)=RARPTN,RARPT=I,^(0)=$P(^RARPT(0),"^",1,2)_"^"_I_"^"_($P(^(0),"^",4)+1),^DISV($S($D(DUZ)#2:DUZ,1:0),"^RARPT(")=I S:'$D(^RARPT(RARPT,"T")) ^("T")=""
"RTN","RARTE5",60,0)
 S ^RARPT(RARPT,0)=RARPTN_"^"_RADFN_"^"_RADTE_"^"_RACN_"^EF",DIK="^RARPT(",DA=RARPT D IX1^DIK
"RTN","RARTE5",61,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RARTE5",62,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTE5",63,0)
 S DIE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE5",64,0)
 S DR="17////"_RARPT D ^DIE
"RTN","RARTE5",65,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,RAY1,X,Y
"RTN","RARTE5",66,0)
 W !,RAI
"RTN","RARTE5",67,0)
 G IN0
"RTN","RARTE5",68,0)
IN ;edit existing rpt, so lock rpt fr the 1st time
"RTN","RARTE5",69,0)
 S RAXIT=$$LOCK^RARTE6("^RARPT(",RARPT) I RAXIT D UNLOCK^RAUTL12(RAPNODE,RACNI) G Q1
"RTN","RARTE5",70,0)
IN0 ;skip to here if rpt created in this session and already locked
"RTN","RARTE5",71,0)
 ; save DXs before edit
"RTN","RARTE5",72,0)
 S RANY1=$$ANYDX^RARTE7(.RAA1) ;1=has DXs, 0=no DXs, RAA1() stores DXs
"RTN","RARTE5",73,0)
 ; Ask if copy standard report
"RTN","RARTE5",74,0)
 I $P(RAMDV,"^",12) D STD^RARTE1 I X="^" S RAXIT=1 G UNCASE
"RTN","RARTE5",75,0)
 ;  Ask Report Date
"RTN","RARTE5",76,0)
 S DR="8",DA=RARPT,DIE="^RARPT(" D ^DIE K DE,DQ
"RTN","RARTE5",77,0)
 ; y is defined if user "^" out
"RTN","RARTE5",78,0)
 I $D(Y) K Y G UNCASE
"RTN","RARTE5",79,0)
 ;   Display Clinical History
"RTN","RARTE5",80,0)
 D CHPRINT^RAUTL9
"RTN","RARTE5",81,0)
 ; report status before editing
"RTN","RARTE5",82,0)
 S RACT=$P(^RARPT(RARPT,0),U,5)
"RTN","RARTE5",83,0)
 ; Edit Report Text and enter Diagnostic code(s)
"RTN","RARTE5",84,0)
 D ERPT
"RTN","RARTE5",85,0)
 ; continue to check sufficient data even if RAXIT=1 at this point
"RTN","RARTE5",86,0)
UNCASE ; 
"RTN","RARTE5",87,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) ;unlock case
"RTN","RARTE5",88,0)
 ; check if sufficient data; del rpt & xrefs if no rpt txt & impression
"RTN","RARTE5",89,0)
 S RAXIT=$$CCAN(RARPT)
"RTN","RARTE5",90,0)
 D UNLOCK^RAUTL12("^RARPT(",RARPT) ;unlock report
"RTN","RARTE5",91,0)
 G:RAXIT PRT
"RTN","RARTE5",92,0)
 ;
"RTN","RARTE5",93,0)
 ;  "EF" was stuffed in LOCK+5 for new reports
"RTN","RARTE5",94,0)
 I $P(^RARPT(RARPT,0),U,5)'="EF" D SETFF^RARTE6(74,5,RARPT,"EF")
"RTN","RARTE5",95,0)
 W !,"Report status is stored as ""Electronically Filed""."
"RTN","RARTE5",96,0)
 ;   Stuff in initial entry date only once
"RTN","RARTE5",97,0)
 I $P(^RARPT(RARPT,0),U,18)="" D SETFF^RARTE6(74,18,RARPT,"NOW","E")
"RTN","RARTE5",98,0)
 ;   Stuff in Activity Log subfile at all times
"RTN","RARTE5",99,0)
 D SETALOG^RARTE6("+1,"_RARPT_",","F","")
"RTN","RARTE5",100,0)
 ;
"RTN","RARTE5",101,0)
 ; transmit to women's health each time this point is reached
"RTN","RARTE5",102,0)
 ; COPY^WVRALINK will stop if the same case number is already in 790.1
"RTN","RARTE5",103,0)
 ;
"RTN","RARTE5",104,0)
 I $P(^RARPT(RARPT,0),U,5)="EF",$T(CREATE^WVRALINK)]"" D CREATE^WVRALINK(RADFN,RADTI,RACNI) ; women's health
"RTN","RARTE5",105,0)
 ;
"RTN","RARTE5",106,0)
PRT I RAXIT S RAXIT=0 D INCRPT G START
"RTN","RARTE5",107,0)
 ;
"RTN","RARTE5",108,0)
 ; report status after editing
"RTN","RARTE5",109,0)
 S RACT=$P(^RARPT(RARPT,0),U,5)
"RTN","RARTE5",110,0)
 ; ---
"RTN","RARTE5",111,0)
 ; set RAHLTCPB to prevent broadcast ORM messages
"RTN","RARTE5",112,0)
 N RAHLTCPB S RAHLTCPB=1
"RTN","RARTE5",113,0)
 ; update case's exam status only if exam status isn't COMPLETE
"RTN","RARTE5",114,0)
 D:$$GET1^DIQ(72,+$P(RA7003,U,3)_",",3)'=9 UP1^RAUTL1
"RTN","RARTE5",115,0)
 S RANY2=$$ANYDX^RARTE7(.RAA2) ;RAA2() store DXs after edit
"RTN","RARTE5",116,0)
 ; always check alert if new/changed diagnostic codes, send alert if nec.
"RTN","RARTE5",117,0)
 D ALERT^RARTE7
"RTN","RARTE5",118,0)
 K RAAB
"RTN","RARTE5",119,0)
PRT1 R !!,"Do you wish to print this report? No// ",X:DTIME S:'$T!(X["^") X="N" S:X="" X="N" ;030497
"RTN","RARTE5",120,0)
 I "Nn"[$E(X) D INCRPT G START
"RTN","RARTE5",121,0)
 I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to print this report, or 'NO' not to." G PRT1
"RTN","RARTE5",122,0)
 S ION=$P(RAMLC,"^",10),IOP=$S(ION]"":"Q;"_ION,1:"Q")
"RTN","RARTE5",123,0)
 S RAMES="W !!?3,""Report has been queued for printing on device "",ION,""."""
"RTN","RARTE5",124,0)
 D Q^RARTR D INCRPT G START ; queue rpt, cleanup, startover
"RTN","RARTE5",125,0)
 ;
"RTN","RARTE5",126,0)
Q1 K %,%DT,%W,%Y,%Y1,C,D0,D1,DA,DIC,DIE,DR,OREND,RABTCH,RABTCHN,RACN,RACNI,RACOPY,RACS,RACT,RADATE,RADFN,RADTE,RADTI,RADUZ,RAELESIG,RAFIN,RAHEAD,RAI,RAJ1
"RTN","RARTE5",127,0)
 K RALI,RALR,RANME,RANUM,RAOR,RAORDIFN,RAPNODE,RAPRC,RAPRIT,RAQUIT,RAREPORT,RARES,RARPDT,RARPT,RARPTN,RARPTZ,RARTPN,RASET,RASI,RASIG,RASN,RASSN,RAST,RAST1,RASTI,RASTFF,RAVW,XQUIT,W,X,Y
"RTN","RARTE5",128,0)
 K D,D2,DDER,DI,DIPGM,DLAYGO,J,RAEND,RAF5,RAFL,RAFST,RAIX,RAPOP,RAY1
"RTN","RARTE5",129,0)
 K ^TMP($J,"RAEX")
"RTN","RARTE5",130,0)
 K POP,DUOUT,RAFDA,RATEXT,RADIR0,RAXIT
"RTN","RARTE5",131,0)
 D INCRPT
"RTN","RARTE5",132,0)
 Q
"RTN","RARTE5",133,0)
INCRPT ; Kill extraneous variables to avoid collisions.
"RTN","RARTE5",134,0)
 ; Incomplete report information, select another case #.
"RTN","RARTE5",135,0)
 K DA,DIE,DR,RATXT
"RTN","RARTE5",136,0)
 K %,%DT,D,D0,D1,D2,DI,DIC,DIWT,DN,I,J,RACN,RACNI,RACT,RADATE,RADTE
"RTN","RARTE5",137,0)
 K RADTI,RAFIN,RAI,RALI,RALR,RANME,RAPRC,RARPT,RARPTN,RASSN,RAST,RAVW,X
"RTN","RARTE5",138,0)
 K RANUENTR
"RTN","RARTE5",139,0)
 Q
"RTN","RARTE5",140,0)
CCAN(IEN74) ;Check canned report for Outside Reporting
"RTN","RARTE5",141,0)
 ; adapted from EN3^RAUTL15
"RTN","RARTE5",142,0)
 ; outputs:  0 if report is kept
"RTN","RARTE5",143,0)
 ;           1 if report is deleted due to no canned text entered
"RTN","RARTE5",144,0)
 ;
"RTN","RARTE5",145,0)
 ; keep report if it is linked to images
"RTN","RARTE5",146,0)
 I $O(^RARPT(IEN74,2005,0))>0 Q 0
"RTN","RARTE5",147,0)
 ;
"RTN","RARTE5",148,0)
 ;del canned report if missing both REPORT TEXT and IMPRESSION TEXT
"RTN","RARTE5",149,0)
 I '$O(^RARPT(IEN74,"I",0)),'$O(^RARPT(IEN74,"R",0)) D  Q 1
"RTN","RARTE5",150,0)
 .; no printsets in outside rpt'g, so no pointer to file 74 from 70.04
"RTN","RARTE5",151,0)
 .;
"RTN","RARTE5",152,0)
 .; exec field's xrefs' KILL logic
"RTN","RARTE5",153,0)
 .S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTE5",154,0)
 .D ENKILL^RAXREF(70.03,17,IEN74,.DA)
"RTN","RARTE5",155,0)
 .;
"RTN","RARTE5",156,0)
 .;del piece 17 from case record
"RTN","RARTE5",157,0)
 .S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)="" K DA,X
"RTN","RARTE5",158,0)
 .;
"RTN","RARTE5",159,0)
 .; Del report ptr from batch and distribution files
"RTN","RARTE5",160,0)
 .D UPDTPNT^RAUTL9(IEN74)
"RTN","RARTE5",161,0)
 .;
"RTN","RARTE5",162,0)
 .; Del entry from Report file
"RTN","RARTE5",163,0)
 .K RATXT
"RTN","RARTE5",164,0)
 .S DA=IEN74,DIK="^RARPT(" D ^DIK
"RTN","RARTE5",165,0)
 .S RATXT(1)=" "
"RTN","RARTE5",166,0)
 .S RATXT(2)="   Outside canned report not complete.  Must Delete......deletion complete!"
"RTN","RARTE5",167,0)
 .S RATXT(3)=$C(7) D MES^XPDUTL(.RATXT)
"RTN","RARTE5",168,0)
 .Q
"RTN","RARTE5",169,0)
 Q 0
"RTN","RARTE5",170,0)
ERPT ; Edit report text, impression, and enter/edit diagnostic codes
"RTN","RARTE5",171,0)
 S $P(RATXT,"+",52)=""
"RTN","RARTE5",172,0)
 W !!?5,RATXT,!?8,"Required:  REPORT TEXT and/or IMPRESSION TEXT",!?5,RATXT
"RTN","RARTE5",173,0)
 S RAXIT=0
"RTN","RARTE5",174,0)
 S DA=RARPT,DIE="^RARPT("
"RTN","RARTE5",175,0)
 S DR="200;I X=""^"" S Y=""@8"";300;I X'=""^"" S Y=""@9"";@8;S RAXIT=1;@9"
"RTN","RARTE5",176,0)
 D ^DIE
"RTN","RARTE5",177,0)
 ; Report Text and Impression Text cannot both be empty
"RTN","RARTE5",178,0)
 I '$O(^RARPT(RARPT,"I",0)),'$O(^RARPT(RARPT,"R",0)) G ERPT
"RTN","RARTE5",179,0)
 I RAXIT=1 Q
"RTN","RARTE5",180,0)
 ; Diagnostic codes
"RTN","RARTE5",181,0)
 ; (code taken from routine RARTE1)
"RTN","RARTE5",182,0)
 S RAIMGTYI=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U)
"RTN","RARTE5",183,0)
 S X=+$O(^RA(72,"AA",RAIMGTYJ,9,0)),DA(2)=RADFN,DA(1)=RADTI,DA=RACNI,DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P""," K RAIMGTYI,RAIMGTYJ
"RTN","RARTE5",184,0)
 ; ask Prim. Diag, required if site require diag, don't ck abnormal here
"RTN","RARTE5",185,0)
 S DR=13_$S('$D(^RA(72,X,.1)):"",$P(^(.1),"^",5)'="Y":"",1:"R")
"RTN","RARTE5",186,0)
 S RAXIT=$$LOCK^RARTE6(DIE,.DA)
"RTN","RARTE5",187,0)
 ; allow user to "^" exit
"RTN","RARTE5",188,0)
 I 'RAXIT D ^DIE D UNLOCK^RAUTL12(DIE,.DA) K DA,DE,DQ,DIE,DR
"RTN","RARTE5",189,0)
 I RAXIT!($P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13)="")!($D(Y)) S RAXIT=0 G PACS
"RTN","RARTE5",190,0)
 S DR="50///"_RACN
"RTN","RARTE5",191,0)
 S DR(2,70.03)=13.1
"RTN","RARTE5",192,0)
 S DR(3,70.14)=.01 ; don't ck abnormal here
"RTN","RARTE5",193,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT"","
"RTN","RARTE5",194,0)
 S RAXIT=$$LOCK^RARTE6("^RADPT("_RADFN_",""DT"","_RADTI_",""P"",",.RACNI) ;lock at P level
"RTN","RARTE5",195,0)
 I 'RAXIT D ^DIE D UNLOCK^RAUTL12("^RADPT("_RADFN_",""DT"","_RADTI_",""P"",",.RACNI) K DA,DE,DQ,DIE,DR ;unlock at P level
"RTN","RARTE5",196,0)
 I $D(Y) K Y S RAXIT=1 ;$D(Y) means user "^" out
"RTN","RARTE5",197,0)
PACS ; do not broadcast ORU message
"RTN","RARTE5",198,0)
 ;
"RTN","RARTE5",199,0)
 ; move WV outside of this in case rpt is deleted due insufficient data
"RTN","RARTE5",200,0)
 Q
"RTN","RARTE5",201,0)
 ;
"RTN","RARTE5",202,0)
INTRO ;
"RTN","RARTE5",203,0)
 ;;+--------------------------------------------------------+
"RTN","RARTE5",204,0)
 ;;|                                                        |
"RTN","RARTE5",205,0)
 ;;|  This option is for entering canned text for           |
"RTN","RARTE5",206,0)
 ;;|  outside work:  interpreted report done outside,       |
"RTN","RARTE5",207,0)
 ;;|  and images made outside this facility.                |
"RTN","RARTE5",208,0)
 ;;|                                                        |
"RTN","RARTE5",209,0)
 ;;+--------------------------------------------------------+
"RTN","RARTE6")
0^16^B106132730^n/a
"RTN","RARTE6",1,0)
RARTE6 ;HISC/SM Restore deleted report ;01/10/08 13:44
"RTN","RARTE6",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56**;Mar 16, 1998;Build 3
"RTN","RARTE6",3,0)
 ;Supported IA #10060 ^VA(200
"RTN","RARTE6",4,0)
 ;Supported IA #2053 FILE^DIE, UPDATE^DIE
"RTN","RARTE6",5,0)
 ;Supported IA #2052 GET1^DID
"RTN","RARTE6",6,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RARTE6",7,0)
 ;Supported IA #10103 NOW^XLFDT
"RTN","RARTE6",8,0)
 ;Supported IA #2055 ROOT^DILFD
"RTN","RARTE6",9,0)
 ;Supported IA #10060 GETS^DIQ
"RTN","RARTE6",10,0)
 Q
"RTN","RARTE6",11,0)
RSTR ;restore deleted report
"RTN","RARTE6",12,0)
 F I=1:1:5 W !?4,$P($T(INTRO+I),";;",2)
"RTN","RARTE6",13,0)
 W !
"RTN","RARTE6",14,0)
 S RAXIT=0 ; =0 exit normally, =1 exit early
"RTN","RARTE6",15,0)
 I '$D(^XUSEC("RA MGR",DUZ)) W !!,"Supervisory key RA MGR is needed for this option." Q
"RTN","RARTE6",16,0)
 S DIC("S")="I $P(^(0),""^"",5)=""X""" ;only select deleted reports
"RTN","RARTE6",17,0)
 S DIC("A")="Select Deleted Report to restore: "
"RTN","RARTE6",18,0)
 S DIC="^RARPT(",DIC(0)="AEMQZ"
"RTN","RARTE6",19,0)
 D DICW^RARTST1,^DIC K DIC I Y<0 G FINISH
"RTN","RARTE6",20,0)
 S RARPT=+Y
"RTN","RARTE6",21,0)
 W !
"RTN","RARTE6",22,0)
 D CHECK G:RAXIT NOTDONE ;check if case has rpt & DX codes
"RTN","RARTE6",23,0)
 D ASK1 G:RAXIT NOTDONE ;ask if want restore deleted report
"RTN","RARTE6",24,0)
 D ASSOC G:RAXIT NOTDONE ;display associated case(s) & ask user again if want continue
"RTN","RARTE6",25,0)
 D RESTORE ;restore rpt status, link rpt to case(s)
"RTN","RARTE6",26,0)
 D FINISH
"RTN","RARTE6",27,0)
 Q
"RTN","RARTE6",28,0)
CHECK ; check if associated case(s) has rpt and DX codes
"RTN","RARTE6",29,0)
 S RA74=^RARPT(RARPT,0)
"RTN","RARTE6",30,0)
 S RADFN=+$P(RA74,U,2),RADTI=9999999.9999-$P(RA74,U,3),RACN=+$P($P(RA74,U,1),"-",2)
"RTN","RARTE6",31,0)
 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0))
"RTN","RARTE6",32,0)
 S RA70=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTE6",33,0)
 I 'RADFN!('RADTI)!('RACNI)!(RA70="") D ERR0 Q
"RTN","RARTE6",34,0)
 S RANME=$$GET1^DIQ(2,RADFN,.01),RAST=+$P(RA70,U,3)
"RTN","RARTE6",35,0)
 S RAPRC=$S($D(^RAMIS(71,+$P(RA70,U,2),0)):$P(^(0),U),1:"Unknown")
"RTN","RARTE6",36,0)
 S RASSN=$$SSN^RAUTL,RASUBY0=RA70
"RTN","RARTE6",37,0)
 S RANODE=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RARTE6",38,0)
 ; check if case(s) already have a report
"RTN","RARTE6",39,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RARTE6",40,0)
 I RAPRTSET D
"RTN","RARTE6",41,0)
 .S RA1=0
"RTN","RARTE6",42,0)
 .F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE6",43,0)
 ..I $P(^RADPT(RADFN,"DT",RADTI,"P",RA1,0),U,17)'="" D ERR3(+RAMEMARR(RA1))
"RTN","RARTE6",44,0)
 ..Q
"RTN","RARTE6",45,0)
 .Q
"RTN","RARTE6",46,0)
 E  I $P(RA70,U,17) D ERR3(RACN) Q
"RTN","RARTE6",47,0)
 ; check if case(s) already have DX codes, staff, resident
"RTN","RARTE6",48,0)
 ; don't use IF ELSE here due to outside calls
"RTN","RARTE6",49,0)
 ;
"RTN","RARTE6",50,0)
 ; Printset cases
"RTN","RARTE6",51,0)
 I RAPRTSET D  Q
"RTN","RARTE6",52,0)
 .S RA1=0
"RTN","RARTE6",53,0)
 .F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE6",54,0)
 ..; check primary
"RTN","RARTE6",55,0)
 ..F RA2=13,15,12 I $P(^RADPT(RADFN,"DT",RADTI,"P",RA1,0),U,RA2)'="" D ERR2(+RAMEMARR(RA1),70.03,RA2)
"RTN","RARTE6",56,0)
 ..; check secondary
"RTN","RARTE6",57,0)
 ..S RAIENS=1_","_RA1_","_RADTI_","_RADFN_","
"RTN","RARTE6",58,0)
 ..F RA2=70.14,70.11,70.09 S RAROOT=$$ROOT^DILFD(RA2,RAIENS) I $O(@(RAROOT_"0)")) D ERR2(+RAMEMARR(RA1),RA2,.01)
"RTN","RARTE6",59,0)
 ..Q
"RTN","RARTE6",60,0)
 .Q
"RTN","RARTE6",61,0)
 ; single case
"RTN","RARTE6",62,0)
 F RA2=13,15,12 I $P(RA70,U,RA2) D ERR2(RACN,70.03,RA2)
"RTN","RARTE6",63,0)
 S RAIENS=1_","_RACNI_","_RADTI_","_RADFN_","
"RTN","RARTE6",64,0)
 F RA2=70.14,70.11,70.09 S RAROOT=$$ROOT^DILFD(RA2,RAIENS) I $O(@(RAROOT_"0)")) D ERR2(RACN,RA2,.01)
"RTN","RARTE6",65,0)
 Q
"RTN","RARTE6",66,0)
ASK1 ; ask if want to restore report
"RTN","RARTE6",67,0)
 ; RAPRVIEN  last Activity Log rec in subfile 74.01
"RTN","RARTE6",68,0)
 ; RAPRVST   previous report status logged in latest activity log rec
"RTN","RARTE6",69,0)
 ; RALAST    last activity log record
"RTN","RARTE6",70,0)
 S RAPRVIEN=$O(^RARPT(RARPT,"L",""),-1)
"RTN","RARTE6",71,0)
 I 'RAPRVIEN D ERR1 Q
"RTN","RARTE6",72,0)
 S RALAST=$G(^RARPT(RARPT,"L",+RAPRVIEN,0))
"RTN","RARTE6",73,0)
 I RALAST="" D ERR1 Q
"RTN","RARTE6",74,0)
 S RAPRVST=$P(RALAST,U,4) ;previous rpt status
"RTN","RARTE6",75,0)
 K DIR
"RTN","RARTE6",76,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RARTE6",77,0)
 S DIR("A")="Do you want to restore this deleted report"
"RTN","RARTE6",78,0)
 S DIR("?")="Answer ""Y"" to assign the previous report status, "_$$GET1^DIQ(74.01,RAPRVIEN_","_RARPT_",",4)_", to this report."
"RTN","RARTE6",79,0)
 D ^DIR K DIR
"RTN","RARTE6",80,0)
 S:$D(DIRUT) RAXIT=1
"RTN","RARTE6",81,0)
 S:'Y RAXIT=1
"RTN","RARTE6",82,0)
 Q
"RTN","RARTE6",83,0)
ASSOC ;
"RTN","RARTE6",84,0)
 ; list case(s) for this report
"RTN","RARTE6",85,0)
 S (Y,RADTE)=+$P(RANODE,U)
"RTN","RARTE6",86,0)
 D D^RAUTL S RADATE=Y
"RTN","RARTE6",87,0)
 D DISPLAY
"RTN","RARTE6",88,0)
 W !
"RTN","RARTE6",89,0)
 K DIR
"RTN","RARTE6",90,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RARTE6",91,0)
 S DIR("A")="Are you sure you want to link this report back to the case"_$S(RAPRTSET:"s",1:"")
"RTN","RARTE6",92,0)
 S DIR("?")="Answer ""Y"" to link this report back to the case(s) shown above."
"RTN","RARTE6",93,0)
 D ^DIR K DIR
"RTN","RARTE6",94,0)
 S:$D(DIRUT) RAXIT=1
"RTN","RARTE6",95,0)
 S:'Y RAXIT=1
"RTN","RARTE6",96,0)
 Q
"RTN","RARTE6",97,0)
RESTORE ; set Report Status to before delete value, link to case(s)
"RTN","RARTE6",98,0)
 D SETFF(74,5,RARPT,RAPRVST)
"RTN","RARTE6",99,0)
 W !!?3,"... Restored ",$P(RA74,U,1),"'s report status to: ",$$GET1^DIQ(74,+RARPT,5),"."
"RTN","RARTE6",100,0)
 ;
"RTN","RARTE6",101,0)
 ; set activity log record
"RTN","RARTE6",102,0)
 S RAIENL="+1,"_RARPT_","
"RTN","RARTE6",103,0)
 D SETALOG(RAIENL,"R",RAPRVST)
"RTN","RARTE6",104,0)
 ;
"RTN","RARTE6",105,0)
 ; link report to single case or all cases of a printset
"RTN","RARTE6",106,0)
 I RAPRTSET D
"RTN","RARTE6",107,0)
 . S RA1=""
"RTN","RARTE6",108,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S $P(^RADPT(RADFN,"DT",RADTI,"P",RA1,0),U,17)=RARPT D MSG1(+RAMEMARR(RA1))
"RTN","RARTE6",109,0)
 .Q
"RTN","RARTE6",110,0)
 E  S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,17)=RARPT D MSG1(RACN)
"RTN","RARTE6",111,0)
 ;
"RTN","RARTE6",112,0)
 ;Restore Primary and Secondary DX codes, Staff and Residents
"RTN","RARTE6",113,0)
 ;
"RTN","RARTE6",114,0)
 ;RAFLD is defined in SET70
"RTN","RARTE6",115,0)
 F RAFLD=5,7,9 S RAPREV=$P(RALAST,U,RAFLD) D:RAPREV SET70(RAFLD)
"RTN","RARTE6",116,0)
 ; restore report status
"RTN","RARTE6",117,0)
 W !!!?3,"** You need to edit the case"_$S(RAPRTSET:"s",1:"")_" to update the exam status. **"
"RTN","RARTE6",118,0)
 Q
"RTN","RARTE6",119,0)
SET70(X) ; put back previous DX codes, Staff, Residents into case record
"RTN","RARTE6",120,0)
 ; assumes if no primary then no secondaries
"RTN","RARTE6",121,0)
 K RAFDA,RAA
"RTN","RARTE6",122,0)
 N RA1
"RTN","RARTE6",123,0)
 S RAIENS=1_","_RAPRVIEN_","_RARPT_","
"RTN","RARTE6",124,0)
 ;
"RTN","RARTE6",125,0)
 ; X is the field number from subfile 74.01:
"RTN","RARTE6",126,0)
 ; 5 = BEFORE DELETION PRIM. DX CODE
"RTN","RARTE6",127,0)
 ; 7 = BEFORE DELETION PRIM. STAFF
"RTN","RARTE6",128,0)
 ; 9 = BEFORE DELETION PRIM. RESIDENT
"RTN","RARTE6",129,0)
 ;
"RTN","RARTE6",130,0)
 ; RAF1 = subfile number from file 74's activity log
"RTN","RARTE6",131,0)
 ; RAF2 = subfile number from file 70's secondaries
"RTN","RARTE6",132,0)
 ; RAF3 = subfile number pointed to from file 70's secondaries
"RTN","RARTE6",133,0)
 ; RAPIECE = piece in 70.03's 0 node
"RTN","RARTE6",134,0)
 S RAF1=$S(X=5:74.16,X=7:74.18,X=9:74.19,1:"") Q:RAF1=""
"RTN","RARTE6",135,0)
 S RAF2=$S(X=5:70.14,X=7:70.11,X=9:70.09,1:"") Q:RAF2=""
"RTN","RARTE6",136,0)
 S RAF3=$$GET1^DID(RAF2,.01,"","POINTER")
"RTN","RARTE6",137,0)
 ; extract file number from RAF3
"RTN","RARTE6",138,0)
 S RAF3=$TR(RAF3,$TR(RAF3,"0123456789."))
"RTN","RARTE6",139,0)
 ;piece number for Primary DX/Staff/Resident in 70.03
"RTN","RARTE6",140,0)
 S RAPIECE=$S(X=5:13,X=7:15,X=9:12,1:"") Q:RAPIECE=""
"RTN","RARTE6",141,0)
 S RAROOT=$$ROOT^DILFD(RAF1,RAIENS,1) ;closed root under file 74's Activity Log
"RTN","RARTE6",142,0)
 ;copy secondaries into RAA()
"RTN","RARTE6",143,0)
 M RAA=@RAROOT
"RTN","RARTE6",144,0)
 ;
"RTN","RARTE6",145,0)
 G:RAPRTSET PSET
"RTN","RARTE6",146,0)
 ;
"RTN","RARTE6",147,0)
 ; single case
"RTN","RARTE6",148,0)
 ;
"RTN","RARTE6",149,0)
 ; copy Primary into single case
"RTN","RARTE6",150,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",RAPIECE)=RAPREV
"RTN","RARTE6",151,0)
 D FILE^DIE("","RAFDA","RAMSG")
"RTN","RARTE6",152,0)
 I $D(RAMSG("DIERR")) D ERR4(RACN,$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",153,0)
 E  D MSG2(RACN,$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",154,0)
 K RAFDA,RAMSG
"RTN","RARTE6",155,0)
 ;
"RTN","RARTE6",156,0)
 Q:$O(RAA(0))'>0  ; no secondaries
"RTN","RARTE6",157,0)
 ;
"RTN","RARTE6",158,0)
 ;copy secondary items into single case
"RTN","RARTE6",159,0)
 S RA1=0
"RTN","RARTE6",160,0)
 F  S RA1=$O(RAA(RA1)) Q:'RA1  S RAX=$G(RAA(RA1,0)) D:RAX
"RTN","RARTE6",161,0)
 .S RAFDA(RAF2,"+2,"_RACNI_","_RADTI_","_RADFN_",",.01)=RAX
"RTN","RARTE6",162,0)
 .D UPDATE^DIE(,"RAFDA",,"RAMSG")
"RTN","RARTE6",163,0)
 .I $D(RAMSG("DIERR")) D ERR4(RACN,$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",164,0)
 .E  D MSG2(RACN,$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",165,0)
 .K RAFDA,RAMSG
"RTN","RARTE6",166,0)
 .Q
"RTN","RARTE6",167,0)
 Q
"RTN","RARTE6",168,0)
 ;
"RTN","RARTE6",169,0)
 ; cases from printset
"RTN","RARTE6",170,0)
 ;
"RTN","RARTE6",171,0)
PSET ; copy Primary into cases of a printset
"RTN","RARTE6",172,0)
 S RA1=0
"RTN","RARTE6",173,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE6",174,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",RAPIECE)=RAPREV
"RTN","RARTE6",175,0)
 .D FILE^DIE("","RAFDA","RAMSG")
"RTN","RARTE6",176,0)
 .I $D(RAMSG("DIERR")) D ERR4(+RAMEMARR(RA1),$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",177,0)
 .E  D MSG2(+RAMEMARR(RA1),$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",178,0)
 .K RAFDA,RAMSG
"RTN","RARTE6",179,0)
 .Q:$O(RAA(0))'>0  ; no secondary DXs
"RTN","RARTE6",180,0)
 .; copy secondaries into cases of a printset
"RTN","RARTE6",181,0)
 .S RA2=0
"RTN","RARTE6",182,0)
 .F  S RA2=$O(RAA(RA2)) Q:'RA2  S RAX=$G(RAA(RA2,0)) D:RAX
"RTN","RARTE6",183,0)
 ..S RAFDA(RAF2,"+2,"_RA1_","_RADTI_","_RADFN_",",.01)=RAX
"RTN","RARTE6",184,0)
 ..D UPDATE^DIE(,"RAFDA",,"RAMSG")
"RTN","RARTE6",185,0)
 ..I $D(RAMSG("DIERR")) D ERR4(+RAMEMARR(RA1),$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",186,0)
 ..E  D MSG2(+RAMEMARR(RA1),$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",187,0)
 ..K RAFDA,RAMSG
"RTN","RARTE6",188,0)
 ..Q
"RTN","RARTE6",189,0)
 .Q
"RTN","RARTE6",190,0)
 Q
"RTN","RARTE6",191,0)
SETFF(RA1,RA2,RA3,RA4,RA5) ;reset file's field value
"RTN","RARTE6",192,0)
 ;RA1 file number
"RTN","RARTE6",193,0)
 ;RA2 field number
"RTN","RARTE6",194,0)
 ;RA3 IEN in file
"RTN","RARTE6",195,0)
 ;RA4 field value to set in record IEN
"RTN","RARTE6",196,0)
 ;RA5 (optional), set to "E" for external
"RTN","RARTE6",197,0)
 N RAFDA
"RTN","RARTE6",198,0)
 S RAFDA(RA1,RA3_",",RA2)=RA4
"RTN","RARTE6",199,0)
 I $G(RA5)="E" D FILE^DIE("E","RAFDA")
"RTN","RARTE6",200,0)
 E  D FILE^DIE("","RAFDA")
"RTN","RARTE6",201,0)
 Q
"RTN","RARTE6",202,0)
SETALOG(RA1,RA2,RA3) ;set new record in Activity log 74.01
"RTN","RARTE6",203,0)
 ;RA1  ien string, eg., "+1,"_RARPT_","
"RTN","RARTE6",204,0)
 ;RA2  type of action
"RTN","RARTE6",205,0)
 ;RA3  current report status code
"RTN","RARTE6",206,0)
 ;
"RTN","RARTE6",207,0)
 N RAFDA
"RTN","RARTE6",208,0)
 S RAFDA(74.01,RA1,.01)=+$E($$NOW^XLFDT(),1,12)
"RTN","RARTE6",209,0)
 S RAFDA(74.01,RA1,2)=RA2
"RTN","RARTE6",210,0)
 S RAFDA(74.01,RA1,3)=$G(DUZ)
"RTN","RARTE6",211,0)
 S:RA3 RAFDA(74.01,RA1,4)=RA3 ;only del rpt would have data here
"RTN","RARTE6",212,0)
 D UPDATE^DIE(,"RAFDA")
"RTN","RARTE6",213,0)
 Q
"RTN","RARTE6",214,0)
MSG1(X) ;
"RTN","RARTE6",215,0)
 W !?3,"... Linked restored report to case no. ",X
"RTN","RARTE6",216,0)
 Q
"RTN","RARTE6",217,0)
MSG2(X,Y,Z) ;
"RTN","RARTE6",218,0)
 W !?3,"... Restored case ",X,"'s ",Y," to: ",Z
"RTN","RARTE6",219,0)
 Q
"RTN","RARTE6",220,0)
ERR0 ;
"RTN","RARTE6",221,0)
 W !,"Unable to determine case previously associated with this report."
"RTN","RARTE6",222,0)
 S RAXIT=1
"RTN","RARTE6",223,0)
 Q
"RTN","RARTE6",224,0)
ERR1 W !!,"Cannot determine previous report status.",!
"RTN","RARTE6",225,0)
 S RAXIT=1
"RTN","RARTE6",226,0)
 Q
"RTN","RARTE6",227,0)
ERR2(X,Y,Z) ;X=External short case No, Y=File no., Z=Field no.
"RTN","RARTE6",228,0)
 W !,"Case #",X," already has ",$$GET1^DID(Y,Z,"","LABEL")
"RTN","RARTE6",229,0)
 S RAXIT=1
"RTN","RARTE6",230,0)
 Q
"RTN","RARTE6",231,0)
ERR3(X) ;
"RTN","RARTE6",232,0)
 W !,"Case #",X," is already associated with a report!"
"RTN","RARTE6",233,0)
 S RAXIT=1
"RTN","RARTE6",234,0)
 Q
"RTN","RARTE6",235,0)
ERR4(X,Y,Z) ;
"RTN","RARTE6",236,0)
 W !!?3,"Cannot restore case ",X,"'s ",Y," to: ",Z
"RTN","RARTE6",237,0)
 Q
"RTN","RARTE6",238,0)
NOTDONE ;
"RTN","RARTE6",239,0)
 W !!?3,"Restoration was not done."
"RTN","RARTE6",240,0)
 ; continue to clean up
"RTN","RARTE6",241,0)
FINISH ; clean up and exit
"RTN","RARTE6",242,0)
 R !!!,"Press RETURN to exit. ",X:DTIME
"RTN","RARTE6",243,0)
 K DIRUT,I
"RTN","RARTE6",244,0)
 K RA1,RA2,RA3,RA4,RA5,RA18EX,RA70,RA74,RAA,RACMDATA
"RTN","RARTE6",245,0)
 K RACN,RACNI,RADATE,RADFN,RADTE,RADTI,RADUZ,RAFDA,RAF1,RAF2,RAF3
"RTN","RARTE6",246,0)
 K RAI,RAIENL,RAIENS,RAIENSUB,RALAST,RALCKFLG,RAMEMARR,RANME,RANODE
"RTN","RARTE6",247,0)
 K RAOUT,RAPIECE,RAPRC,RAPRTSET,RAPRVIEN,RAPREV,RAPRVST,RAROOT,RARPT
"RTN","RARTE6",248,0)
 K RASSN,RAST,RASUB70,RASUBY0,RAX,RAXIT,X,XY,Y,Z
"RTN","RARTE6",249,0)
 Q
"RTN","RARTE6",250,0)
DISPLAY ; Display exam specific info, edit/enter the report
"RTN","RARTE6",251,0)
 ; adapted from routine RARTE
"RTN","RARTE6",252,0)
 S RA18EX=0 ;P18 for quit if uparrow inside PUTTCOM
"RTN","RARTE6",253,0)
 I '($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))#2) D  D Q1^RARTE5 QUIT
"RTN","RARTE6",254,0)
 . W !!?2,"Case #: ",RACN," for ",RANME S RAXIT=1
"RTN","RARTE6",255,0)
 . W !?2,"Procedure: '",$E(RAPRC,1,45),"' has been deleted"
"RTN","RARTE6",256,0)
 . W !?2,"by another user!",$C(7)
"RTN","RARTE6",257,0)
 . Q
"RTN","RARTE6",258,0)
 ;
"RTN","RARTE6",259,0)
 S RAI="",$P(RAI,"-",80)="" W !,RAI
"RTN","RARTE6",260,0)
 W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN
"RTN","RARTE6",261,0)
 W !?1,"Case No. : ",RACN,?18,"Exm. St: ",$E($P($G(^RA(72,+RAST,0)),"^"),1,12),?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RARTE6",262,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTE6",263,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTE6",264,0)
 D:$L(RACMDATA) CMEDIA^RARTE(RACMDATA)
"RTN","RARTE6",265,0)
 K RACMDATA
"RTN","RARTE6",266,0)
 S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,RACN," Tech.Comment: ",15,70,-1,0) ;P18
"RTN","RARTE6",267,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE6",268,0)
 ;
"RTN","RARTE6",269,0)
 D:'$D(RAPRTSET) EN2^RAUTL20(.RAMEMARR)
"RTN","RARTE6",270,0)
 ; if printset, display cases and continue on to display Exam Date
"RTN","RARTE6",271,0)
 I RAPRTSET D
"RTN","RARTE6",272,0)
 . S RA1=""
"RTN","RARTE6",273,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""!(RA18EX=-1)  I RA1'=RACNI D
"RTN","RARTE6",274,0)
 .. W !,?1,"Case No. : ",+RAMEMARR(RA1)
"RTN","RARTE6",275,0)
 .. W:$P(RAMEMARR(RA1),"^",4)]"" ?18,"Exm. St: ",$E($P($G(^RA(72,$P(RAMEMARR(RA1),"^",4),0)),"^"),1,12)
"RTN","RARTE6",276,0)
 .. W ?40,"Procedure   : ",$E($P($G(^RAMIS(71,+$P(RAMEMARR(RA1),"^",2),0)),"^"),1,26)
"RTN","RARTE6",277,0)
 ..;check printset for contrast media; display if CM data exists
"RTN","RARTE6",278,0)
 ..S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RA1)
"RTN","RARTE6",279,0)
 ..D:$L(RACMDATA) CMEDIA^RARTE(RACMDATA)
"RTN","RARTE6",280,0)
 ..K RACMDATA
"RTN","RARTE6",281,0)
 .. S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,+RAMEMARR(RA1)," Tech.Comment: ",15,70,-1,0) Q:RA18EX=-1  ;P18
"RTN","RARTE6",282,0)
 .. Q
"RTN","RARTE6",283,0)
 . Q
"RTN","RARTE6",284,0)
 ;continue display
"RTN","RARTE6",285,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE6",286,0)
 S Y(0)=RASUBY0
"RTN","RARTE6",287,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RARTE6",288,0)
 D GETS^DIQ(70.03,RAIENS,"14;175*","E","RAOUT")
"RTN","RARTE6",289,0)
 W !?1,"Exam Date: ",RADATE,?40,"Technologist: "
"RTN","RARTE6",290,0)
 S RAIENSUB=$O(RAOUT(70.12,0))
"RTN","RARTE6",291,0)
 W:RAIENSUB]"" $E($G(RAOUT(70.12,RAIENSUB,.01,"E")),1,25)
"RTN","RARTE6",292,0)
 W !?40,"Req Phys    : "
"RTN","RARTE6",293,0)
 W $E($G(RAOUT(70.03,RAIENS,14,"E")),1,25)
"RTN","RARTE6",294,0)
 W !,RAI
"RTN","RARTE6",295,0)
 Q
"RTN","RARTE6",296,0)
LOCK(X,Y) ; Lock the data global
"RTN","RARTE6",297,0)
 ; uses var DILOCKTM, code taken from rtn RAUTL12
"RTN","RARTE6",298,0)
 ; 'X' is the global root
"RTN","RARTE6",299,0)
 ; 'Y' is the record number
"RTN","RARTE6",300,0)
 N RALCKFLG,XY
"RTN","RARTE6",301,0)
 S RADUZ=+$G(DUZ),RALCKFLG=0,XY=X_Y
"RTN","RARTE6",302,0)
 L +@(XY_")"):DILOCKTM
"RTN","RARTE6",303,0)
 I '$T S RALCKFLG=1 D
"RTN","RARTE6",304,0)
 . W !?5,"This record is being edited by another user."
"RTN","RARTE6",305,0)
 . W !?5,"Try again later!",$C(7)
"RTN","RARTE6",306,0)
 . Q
"RTN","RARTE6",307,0)
 E  D
"RTN","RARTE6",308,0)
 . S ^TMP("RAD LOCKS",$J,RADUZ,X,Y)=""
"RTN","RARTE6",309,0)
 . Q
"RTN","RARTE6",310,0)
 Q RALCKFLG
"RTN","RARTE6",311,0)
INTRO ;
"RTN","RARTE6",312,0)
 ;; +--------------------------------------------------------+
"RTN","RARTE6",313,0)
 ;; |                                                        |
"RTN","RARTE6",314,0)
 ;; |    This option is for restoring a deleted report.      |
"RTN","RARTE6",315,0)
 ;; |                                                        |
"RTN","RARTE6",316,0)
 ;; +--------------------------------------------------------+
"RTN","RARTE7")
0^17^B23239189^n/a
"RTN","RARTE7",1,0)
RARTE7 ;HISC/SM continuation - Delete a Report, Outside Rpt misc;1/31/08 10:44
"RTN","RARTE7",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56**;Mar 16, 1998;Build 3
"RTN","RARTE7",3,0)
 ;Supported IA #2053 NOW^XLFDT, FILE^DIE, UPDATE^DIE
"RTN","RARTE7",4,0)
 ;Supported IA #2052 GET1^DID
"RTN","RARTE7",5,0)
 ;Supported IA #2055 ROOT^DILFD
"RTN","RARTE7",6,0)
 Q
"RTN","RARTE7",7,0)
MARKDEL ; set field 5 to "X" to mark rpt as deleted
"RTN","RARTE7",8,0)
 ; also update activity log, send report deletion bulletin, store then delete
"RTN","RARTE7",9,0)
 ; associated DX, Staff, Resident data
"RTN","RARTE7",10,0)
 N DA,DIK,RA1,RA2,RAA,RAFDA,RAIEN2,RAIENDX,RAIENL,RACLOAK
"RTN","RARTE7",11,0)
 N RAMEMARR,RAMSG,RAOUT,RAPRTSET,RASAVE,RAX,RA7003
"RTN","RARTE7",12,0)
 ;
"RTN","RARTE7",13,0)
 ;PART 1 - mark report as deleted
"RTN","RARTE7",14,0)
 ;
"RTN","RARTE7",15,0)
 S RASAVE=$P(^RARPT(RAIEN,0),U,5) ;save current rpt status
"RTN","RARTE7",16,0)
 S RAFDA(74,RAIEN_",",5)="X" ;change rpt status
"RTN","RARTE7",17,0)
 D FILE^DIE("","RAFDA")
"RTN","RARTE7",18,0)
 K RAFDA
"RTN","RARTE7",19,0)
 ;
"RTN","RARTE7",20,0)
 ;PART 2 - add new entry to ACTIVITY LOG and store primary data
"RTN","RARTE7",21,0)
 ;
"RTN","RARTE7",22,0)
 S RA7003=^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)
"RTN","RARTE7",23,0)
 S RAIENL="+1,"_RAIEN_","
"RTN","RARTE7",24,0)
 S RAFDA(74.01,RAIENL,.01)=+$E($$NOW^XLFDT(),1,12)
"RTN","RARTE7",25,0)
 S RAFDA(74.01,RAIENL,2)="X"
"RTN","RARTE7",26,0)
 S RAFDA(74.01,RAIENL,3)=$G(DUZ)
"RTN","RARTE7",27,0)
 S RAFDA(74.01,RAIENL,4)=RASAVE ;store before-delete rpt status
"RTN","RARTE7",28,0)
 S RAFDA(74.01,RAIENL,5)=$P(RA7003,U,13) ; store Prim DX code
"RTN","RARTE7",29,0)
 S RAFDA(74.01,RAIENL,7)=$P(RA7003,U,15) ; store Prim Staff
"RTN","RARTE7",30,0)
 S RAFDA(74.01,RAIENL,9)=$P(RA7003,U,12) ; store Prim Resident
"RTN","RARTE7",31,0)
 D UPDATE^DIE(,"RAFDA","RAOUT","RAMSG")
"RTN","RARTE7",32,0)
 W:$D(RAMSG("DIERR")) !!,"Could not update deleted Report's Activity Log."
"RTN","RARTE7",33,0)
 K RAFDA
"RTN","RARTE7",34,0)
 ;
"RTN","RARTE7",35,0)
 ; store Secondary DXs/Staff/Residents under this ACTIVITY LOG
"RTN","RARTE7",36,0)
 ; if printset, no need to store each case's sec DX, they should be same
"RTN","RARTE7",37,0)
 Q:'RAOUT(1)  ;no record set in 74.01
"RTN","RARTE7",38,0)
 S RAIEN2=RAOUT(1)
"RTN","RARTE7",39,0)
 ;
"RTN","RARTE7",40,0)
 ;PART 3 - send report deletion bulletin
"RTN","RARTE7",41,0)
 ;
"RTN","RARTE7",42,0)
 D CLOAK^RABUL3 ; requires RAIEN and RAIEN2
"RTN","RARTE7",43,0)
 ;
"RTN","RARTE7",44,0)
 ;PART 4 - store secondary DX, Staff, Resident data
"RTN","RARTE7",45,0)
 ;
"RTN","RARTE7",46,0)
 ;don't need separate logic for printset for storing identical data
"RTN","RARTE7",47,0)
 F RAFLD=5,7,9 D SET7401(RAFLD)
"RTN","RARTE7",48,0)
 ;
"RTN","RARTE7",49,0)
 ;PART 5 - remove Prim. and Sec.  DX, Staff, Resident from case record
"RTN","RARTE7",50,0)
 ;
"RTN","RARTE7",51,0)
 D EN2^RAUTL20(.RAMEMARR) ; is case part of a printset?
"RTN","RARTE7",52,0)
 G:RAPRTSET PSET
"RTN","RARTE7",53,0)
 ;
"RTN","RARTE7",54,0)
 ; single case
"RTN","RARTE7",55,0)
 ;
"RTN","RARTE7",56,0)
 ; delete primaries
"RTN","RARTE7",57,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",13)="@" ;Prim. DX
"RTN","RARTE7",58,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",15)="@" ;Prim. Staff
"RTN","RARTE7",59,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",12)="@" ;Prim. Resident
"RTN","RARTE7",60,0)
 D FILE^DIE("","RAFDA")
"RTN","RARTE7",61,0)
 K RAFDA
"RTN","RARTE7",62,0)
 ;
"RTN","RARTE7",63,0)
 ; delete secondaries
"RTN","RARTE7",64,0)
 F RASUB=70.14,70.11,70.09 D KILSEC(RASUB,RACNI)
"RTN","RARTE7",65,0)
 Q
"RTN","RARTE7",66,0)
 ;
"RTN","RARTE7",67,0)
 ; cases from printset
"RTN","RARTE7",68,0)
 ;
"RTN","RARTE7",69,0)
PSET ;delete primary and secondary data
"RTN","RARTE7",70,0)
 S RA1=0
"RTN","RARTE7",71,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE7",72,0)
 .; delete primary from 70.03
"RTN","RARTE7",73,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",13)="@" ;Prim. DX
"RTN","RARTE7",74,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",15)="@" ;Prim. Staff
"RTN","RARTE7",75,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",12)="@" ;Prim. Resident
"RTN","RARTE7",76,0)
 .D FILE^DIE("","RAFDA")
"RTN","RARTE7",77,0)
 .K RAFDA
"RTN","RARTE7",78,0)
 .F RASUB=70.14,70.11,70.09 D KILSEC(RASUB,RA1)
"RTN","RARTE7",79,0)
 Q
"RTN","RARTE7",80,0)
KILSEC(RAF2,RAC1) ;kill secondary data
"RTN","RARTE7",81,0)
 ;RAF2 subfile number from file 70's secondaries
"RTN","RARTE7",82,0)
 ;RAC1 ien for subfile 70.03
"RTN","RARTE7",83,0)
 N RAA,RAROOT
"RTN","RARTE7",84,0)
 K DA,DIK
"RTN","RARTE7",85,0)
 S RAIENS=1_","_RAC1_","_RADTI_","_RADFN_","
"RTN","RARTE7",86,0)
 S RAROOT=$$ROOT^DILFD(RAF2,RAIENS,1) ; closed root
"RTN","RARTE7",87,0)
 M RAA=@RAROOT
"RTN","RARTE7",88,0)
 Q:$O(RAA(0))'>0  ;no secondaries
"RTN","RARTE7",89,0)
 D DA^DILF(RAIENS,.DA) ;get the DA array
"RTN","RARTE7",90,0)
 S DIK=$$ROOT^DILFD(RAF2,RAIENS)
"RTN","RARTE7",91,0)
 S RA2=0
"RTN","RARTE7",92,0)
 F  S RA2=$O(RAA(RA2)) Q:'RA2  S DA=RA2 D ^DIK
"RTN","RARTE7",93,0)
 K DIK
"RTN","RARTE7",94,0)
 Q
"RTN","RARTE7",95,0)
SET7401(X) ; use this for DX, Staff, Resident secondaries 
"RTN","RARTE7",96,0)
 ; set activity log's subfiles to store any secondaries
"RTN","RARTE7",97,0)
 K RAFDA,RAMSG,RAA
"RTN","RARTE7",98,0)
 ; X is the Field number from subfile 74.01:
"RTN","RARTE7",99,0)
 ; 5 = BEFORE DELETION PRIM. DX CODE
"RTN","RARTE7",100,0)
 ; 7 = BEFORE DELETION PRIM. STAFF
"RTN","RARTE7",101,0)
 ; 9 = BEFORE DELETION PRIM. RESIDENT
"RTN","RARTE7",102,0)
 ;
"RTN","RARTE7",103,0)
 ; RAF1 = subfile number from file 74's activity log
"RTN","RARTE7",104,0)
 ; RAF2 = subfile number from file 70's secondaries
"RTN","RARTE7",105,0)
 ; RAF3 = subfile number pointed to from file 70's secondaries
"RTN","RARTE7",106,0)
 ;
"RTN","RARTE7",107,0)
 S RAF2=$S(X=5:70.14,X=7:70.11,X=9:70.09,1:"") Q:RAF2=""
"RTN","RARTE7",108,0)
 S RAIENS=1_","_RACNI_","_RADTI_","_RADFN_","
"RTN","RARTE7",109,0)
 S RAROOT=$$ROOT^DILFD(RAF2,RAIENS,1) ; closed root, file 70's secondaries
"RTN","RARTE7",110,0)
 M RAA=@RAROOT
"RTN","RARTE7",111,0)
 Q:$O(RAA(0))'>0  ; no secondaries
"RTN","RARTE7",112,0)
 ;
"RTN","RARTE7",113,0)
 S RAF1=$S(X=5:74.16,X=7:74.18,X=9:74.19,1:"") Q:RAF1=""
"RTN","RARTE7",114,0)
 S RAF3=$$GET1^DID(RAF2,.01,"","POINTER")
"RTN","RARTE7",115,0)
 ; extract file number from RAF3
"RTN","RARTE7",116,0)
 S RAF3=$TR(RAF3,$TR(RAF3,"0123456789."))
"RTN","RARTE7",117,0)
 ;
"RTN","RARTE7",118,0)
 ; store Secondary DXs
"RTN","RARTE7",119,0)
 S RA1=0
"RTN","RARTE7",120,0)
 S RAIENDX="+2,"_RAIEN2_","_RAIEN_","
"RTN","RARTE7",121,0)
 F  S RA1=$O(RAA(RA1)) Q:'RA1  S RAX=$G(RAA(RA1,0)) D:RAX
"RTN","RARTE7",122,0)
 .S RAFDA(RAF1,RAIENDX,.01)=RAX
"RTN","RARTE7",123,0)
 .D UPDATE^DIE(,"RAFDA",,"RAMSG")
"RTN","RARTE7",124,0)
 .W:$D(RAMSG("DIERR")) !!,"Could not store ",$$GET1^DID(RAF2,.01,"","LABEL"),"'s value: ",$$GET1^DIQ(RAF3,RAX,.01)
"RTN","RARTE7",125,0)
 .K RAFDA,RAMSG
"RTN","RARTE7",126,0)
 .Q
"RTN","RARTE7",127,0)
 Q
"RTN","RARTE7",128,0)
ANYDX(ARRAY) ; called from RARTE5
"RTN","RARTE7",129,0)
 ; input ARRAY name to store all DXs for this case
"RTN","RARTE7",130,0)
 ; output:
"RTN","RARTE7",131,0)
 ;  =1 if one or more diag codes
"RTN","RARTE7",132,0)
 ;  =0 if no diag code
"RTN","RARTE7",133,0)
 ;  ARRAY() stores diag codes as merged from case
"RTN","RARTE7",134,0)
 Q:'$D(RADFN)!('$D(RADTI))!('$D(RACNI))
"RTN","RARTE7",135,0)
 K ARRAY
"RTN","RARTE7",136,0)
 M ARRAY=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX") ;Sec Diags
"RTN","RARTE7",137,0)
 S ARRAY(9999,0)=$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13) ;Prim Diag
"RTN","RARTE7",138,0)
 I $O(ARRAY(0)) Q 1
"RTN","RARTE7",139,0)
 Q 0
"RTN","RARTE7",140,0)
 ;
"RTN","RARTE7",141,0)
ALERT ; for Outside Report, ck if new/changed diags require alert
"RTN","RARTE7",142,0)
 ; this is called from RARTE5 each time an outside report is edited
"RTN","RARTE7",143,0)
 Q:'$D(RADFN)!('$D(RADTI))!('$D(RACNI))
"RTN","RARTE7",144,0)
 ; set RASAVE() for OENOTE^RAUTL00
"RTN","RARTE7",145,0)
 S RASAVE("RADFN")=RADFN,RASAVE("RADTI")=RADTI,RASAVE("RACNI")=RACNI
"RTN","RARTE7",146,0)
 ;
"RTN","RARTE7",147,0)
 N I
"RTN","RARTE7",148,0)
 Q:(RANY1=0)&(RANY2=0)  ;no diags before and after edit
"RTN","RARTE7",149,0)
 S I=0
"RTN","RARTE7",150,0)
 ; loop RAA2 
"RTN","RARTE7",151,0)
 F  S I=$O(RAA2(I)) Q:'I  K:RAA2(I,0)=$G(RAA1(I,0)) RAA2(I,0)
"RTN","RARTE7",152,0)
 Q:'$O(RAA2(0))
"RTN","RARTE7",153,0)
 S RAAB=0
"RTN","RARTE7",154,0)
 S I=0 F  S I=$O(RAA2(I)) Q:'I  D
"RTN","RARTE7",155,0)
 .I $D(^RA(78.3,+RAA2(I,0),0)),($P(^(0),U,4)="y") S RAAB=1
"RTN","RARTE7",156,0)
 .Q
"RTN","RARTE7",157,0)
 Q:'RAAB
"RTN","RARTE7",158,0)
 S RAY3=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTE7",159,0)
 S X=RAY3 ; X is input to OENOTE
"RTN","RARTE7",160,0)
 D OENOTE^RAUTL00
"RTN","RARTE7",161,0)
 Q
"RTN","RARTR1")
0^18^B46270637^B44691529
"RTN","RARTR1",1,0)
RARTR1 ;HISC/FPT,GJC-Queue/print Radiology Reports (cont.) ;1/8/97  08:08
"RTN","RARTR1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,18,56**;Mar 16, 1998;Build 3
"RTN","RARTR1",3,0)
 ;Supported IA #10104 REPEAT^XLFSTR
"RTN","RARTR1",4,0)
 ;Supported IA #10060 and #2056 $$GET1^DIQ for file 200
"RTN","RARTR1",5,0)
 ;last modification by SS for P18 JUNE 29,00
"RTN","RARTR1",6,0)
PRTDX ; print dx codes on report
"RTN","RARTR1",7,0)
 I '$D(RAUTOE) D HANG^RARTR2:($Y+RAFOOT+4)>IOSL Q:$D(RAOOUT)  D HD^RARTR:($Y+RAFOOT+4)>IOSL
"RTN","RARTR1",8,0)
 S RADXCODE=$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13)
"RTN","RARTR1",9,0)
 I '$D(RAUTOE) W !?RATAB,"Primary Diagnostic Code: ",!?RATAB+4,$S($D(^RA(78.3,+RADXCODE,0)):$P(^(0),U,1),1:"")
"RTN","RARTR1",10,0)
 I $D(RAUTOE) D
"RTN","RARTR1",11,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="    Primary Diagnostic Code: "_$S($D(^RA(78.3,+RADXCODE,0)):$P(^(0),U,1),1:"")
"RTN","RARTR1",12,0)
 . Q
"RTN","RARTR1",13,0)
 I '$D(RAUTOE) D HANG^RARTR2:($Y+RAFOOT+4)>IOSL Q:$D(RAOOUT)  D HD^RARTR:($Y+RAFOOT+4)>IOSL
"RTN","RARTR1",14,0)
 I '$D(RAUTOE),('$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",0))) W ! Q
"RTN","RARTR1",15,0)
 I '$D(RAUTOE),($O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",0))) D  Q
"RTN","RARTR1",16,0)
 . W !!?RATAB,"Secondary Diagnostic Codes: "
"RTN","RARTR1",17,0)
 . S RADXCODE=0
"RTN","RARTR1",18,0)
 . F  S RADXCODE=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX","B",RADXCODE)) Q:RADXCODE'>0!('$D(^RA(78.3,+RADXCODE,0)))!($D(RAOOUT))  D
"RTN","RARTR1",19,0)
 .. D HANG^RARTR2:($Y+RAFOOT+4)>IOSL Q:$D(RAOOUT)  D HD^RARTR:($Y+RAFOOT+4)>IOSL W !?RATAB+4,$P(^RA(78.3,RADXCODE,0),U,1)
"RTN","RARTR1",20,0)
 .. Q
"RTN","RARTR1",21,0)
 . K RADXCODE W !
"RTN","RARTR1",22,0)
 . Q
"RTN","RARTR1",23,0)
 I $D(RAUTOE),('$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",0))) D  Q
"RTN","RARTR1",24,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR1",25,0)
 . Q
"RTN","RARTR1",26,0)
 I $D(RAUTOE),($O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",0))) D
"RTN","RARTR1",27,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="    Secondary Diagnostic Codes: "
"RTN","RARTR1",28,0)
 . S RADXCODE=0
"RTN","RARTR1",29,0)
 . F  S RADXCODE=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX","B",RADXCODE)) Q:RADXCODE'>0  D
"RTN","RARTR1",30,0)
 .. Q:'$D(^RA(78.3,+$G(RADXCODE),0))#2
"RTN","RARTR1",31,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="      "_$P(^RA(78.3,+$G(RADXCODE),0),U)
"RTN","RARTR1",32,0)
 .. Q
"RTN","RARTR1",33,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR1",34,0)
 . Q
"RTN","RARTR1",35,0)
 Q
"RTN","RARTR1",36,0)
WARNING ; this printed report should not be used for charting
"RTN","RARTR1",37,0)
 S RARPTSTT=$$RSTAT^RAO7PC1A()
"RTN","RARTR1",38,0)
 S:RARPTSTT="NO REPORT" RARPTSTT="REPORT STATUS UNKNOWN"
"RTN","RARTR1",39,0)
 S:RAST="R" RARPTSTT="("_RARPTSTT_")"
"RTN","RARTR1",40,0)
 S RAPOSITN=(80-$L(RARPTSTT)\2)
"RTN","RARTR1",41,0)
 I '$D(RAUTOE) D  ;P18 modif
"RTN","RARTR1",42,0)
 . W !?RAPOSITN-1,$$REPEAT^XLFSTR("*",$L(RARPTSTT)+2)
"RTN","RARTR1",43,0)
 . W:RAST="R" !?(80-$L(RARPTSTT)\2)-1,"*  PRELIMINARY REPORT   *" ;P18
"RTN","RARTR1",44,0)
 . W !?(80-$L(RARPTSTT)\2)-1,"*"_RARPTSTT_"*",!?RAPOSITN-1,$$REPEAT^XLFSTR("*",$L(RARPTSTT)+2)
"RTN","RARTR1",45,0)
 . Q
"RTN","RARTR1",46,0)
 I $D(RAUTOE) D
"RTN","RARTR1",47,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$$REPEAT^XLFSTR("*",$L(RARPTSTT)+2)
"RTN","RARTR1",48,0)
 . I RAST="R" S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="*  PRELIMINARY REPORT   *" ;P18
"RTN","RARTR1",49,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="*"_RARPTSTT_"*" ;P18
"RTN","RARTR1",50,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$$REPEAT^XLFSTR("*",$L(RARPTSTT)+2)
"RTN","RARTR1",51,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR1",52,0)
 . Q
"RTN","RARTR1",53,0)
 K RAPOSITN,RARPTSTT
"RTN","RARTR1",54,0)
 Q
"RTN","RARTR1",55,0)
SECRES ; Print from the secondary resident multiple
"RTN","RARTR1",56,0)
 Q:'$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",0))  ; no data, quit
"RTN","RARTR1",57,0)
 N RASR,RASRSBN,RASRSBT,DIERR,RAZ
"RTN","RARTR1",58,0)
 I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 Q:$D(RAOOUT)  D HD^RARTR:($Y+RAFOOT+4)>IOSL
"RTN","RARTR1",59,0)
 W:'$D(RAUTOE) !,"Secondary Interpreting Resident:"
"RTN","RARTR1",60,0)
 S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="Secondary Interpreting Resident:"
"RTN","RARTR1",61,0)
 S RASR=0
"RTN","RARTR1",62,0)
 F  S RASR=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",RASR)) Q:RASR'>0  D
"RTN","RARTR1",63,0)
 . S RASR(0)=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",RASR,0))
"RTN","RARTR1",64,0)
 . S RAZ=$$GET1^DIQ(200,+RASR(0)_",",.01)
"RTN","RARTR1",65,0)
 . Q:RAZ=""
"RTN","RARTR1",66,0)
 . S RASRSBN=$E($$GET1^DIQ(200,+RASR(0)_",",20.2),1,25)
"RTN","RARTR1",67,0)
 . S:RASRSBN']"" RASRSBN=$E(RAZ,1,25)
"RTN","RARTR1",68,0)
 . S RASRSBT=$$GET1^DIQ(200,+RASR(0)_",",20.3) ; max:; 50 chars
"RTN","RARTR1",69,0)
 . I RASRSBT']"" S RASRSBT=$$TITLE^RARTR0(+RASR(0))
"RTN","RARTR1",70,0)
 . I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 Q:$D(RAOOUT)  D HD^RARTR:($Y+RAFOOT+4)>IOSL
"RTN","RARTR1",71,0)
 . W:'$D(RAUTOE) !?2,$S(RASRSBN]"":RASRSBN,1:"Unknown"),", ",$E(RASRSBT,1,((IOM-$X)-16))
"RTN","RARTR1",72,0)
 . ; The '-16' above is derived from $L("(Pre-Verifier)")+1 FORMATTING
"RTN","RARTR1",73,0)
 . I $D(RAUTOE) D
"RTN","RARTR1",74,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="  "_$S(RASRSBN]"":RASRSBN,1:"Unknown")
"RTN","RARTR1",75,0)
 .. N RALEN S RALEN=$L(^TMP($J,"RA AUTOE",RAACNT))
"RTN","RARTR1",76,0)
 .. S ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_", "_$E(RASRSBT,1,((80-RALEN)-16))
"RTN","RARTR1",77,0)
 .. Q
"RTN","RARTR1",78,0)
 . I '$D(RAVERFND),(RAVERF=+RASR(0)) D
"RTN","RARTR1",79,0)
 .. S RAVERFND=""
"RTN","RARTR1",80,0)
 .. I $G(RARPT(10))']"",('$D(RAUTOE)) D  Q
"RTN","RARTR1",81,0)
 ... W:RAWHOVER=+RASR(0) !?10,"(Verifier, no e-sig)"
"RTN","RARTR1",82,0)
 ... W:RAWHOVER'=+RASR(0) !?10,"Verified by transcriptionist for "_RASRSBN  ;Removed RA*5*8 _", M.D."
"RTN","RARTR1",83,0)
 ... Q
"RTN","RARTR1",84,0)
 .. I $G(RARPT(10))']"",($D(RAUTOE)) D  Q
"RTN","RARTR1",85,0)
 ... S:RAWHOVER=+RASR(0) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="          (Verifier, no e-sig)"
"RTN","RARTR1",86,0)
 ... S:RAWHOVER'=+RASR(0) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="          Verified by transcriptionist for "_RASRSBN  ;Removed RA*5*8 _", M.D."
"RTN","RARTR1",87,0)
 ... Q
"RTN","RARTR1",88,0)
 .. W:'$D(RAUTOE) " (Verifier)"
"RTN","RARTR1",89,0)
 .. S:$D(RAUTOE) ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_" (Verifier)"
"RTN","RARTR1",90,0)
 .. Q
"RTN","RARTR1",91,0)
 . I RAPVERF=+RASR(0) W:'$D(RAUTOE) " (Pre-Verifier)" S:$D(RAUTOE) ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_" (Pre-Verifier)"
"RTN","RARTR1",92,0)
 . Q
"RTN","RARTR1",93,0)
 Q
"RTN","RARTR1",94,0)
SECSTF ; Print from the secondary staff multiple
"RTN","RARTR1",95,0)
 Q:'$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",0))  ; no data, quit
"RTN","RARTR1",96,0)
 N RASS,RASSSBN,RASSSBT,DIERR,RAZ
"RTN","RARTR1",97,0)
 I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 Q:$D(RAOOUT)  D HD^RARTR:($Y+RAFOOT+4)>IOSL
"RTN","RARTR1",98,0)
 W:'$D(RAUTOE) !,"Secondary Interpreting Staff:"
"RTN","RARTR1",99,0)
 S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="Secondary Interpreting Staff:"
"RTN","RARTR1",100,0)
 S RASS=0
"RTN","RARTR1",101,0)
 F  S RASS=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",RASS)) Q:RASS'>0  D
"RTN","RARTR1",102,0)
 . S RASS(0)=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",RASS,0))
"RTN","RARTR1",103,0)
 . S RAZ=$$GET1^DIQ(200,+RASS(0)_",",.01)
"RTN","RARTR1",104,0)
 . Q:RAZ=""
"RTN","RARTR1",105,0)
 . S RASSSBN=$E($$GET1^DIQ(200,+RASS(0)_",",20.2),1,25)
"RTN","RARTR1",106,0)
 . S:RASSSBN="" RASSSBN=$E(RAZ,1,25)
"RTN","RARTR1",107,0)
 . S RASSSBT=$$GET1^DIQ(200,+RASS(0)_",",20.3) ; max: 50 chars
"RTN","RARTR1",108,0)
 . I RASSSBT']"" S RASSSBT=$$TITLE^RARTR0(+RASS(0))
"RTN","RARTR1",109,0)
 . I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 Q:$D(RAOOUT)  D HD^RARTR:($Y+RAFOOT+4)>IOSL
"RTN","RARTR1",110,0)
 . W:'$D(RAUTOE) !?2,$S(RASSSBN]"":RASSSBN,1:"Unknown"),", ",$E(RASSSBT,1,((IOM-$X)-16))
"RTN","RARTR1",111,0)
 . ; The '-16' above is derived from $L("(Pre-Verifier)")+1 FORMATTING
"RTN","RARTR1",112,0)
 . I $D(RAUTOE) D
"RTN","RARTR1",113,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="  "_$S(RASSSBN]"":RASSSBN,1:"Unknown")
"RTN","RARTR1",114,0)
 .. N RALEN S RALEN=$L(^TMP($J,"RA AUTOE",RAACNT))
"RTN","RARTR1",115,0)
 .. S ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_", "_$E(RASSSBT,1,((80-RALEN)-16))
"RTN","RARTR1",116,0)
 .. Q
"RTN","RARTR1",117,0)
 . I '$D(RAVERFND),(RAVERF=+RASS(0)) D
"RTN","RARTR1",118,0)
 .. S RAVERFND=""
"RTN","RARTR1",119,0)
 .. I $G(RARPT(10))']"",('$D(RAUTOE)) D  Q
"RTN","RARTR1",120,0)
 ... W:RAWHOVER=+RASS(0) !?10,"(Verifier, no e-sig)"
"RTN","RARTR1",121,0)
 ... W:RAWHOVER'=+RASS(0) !?10,"Verified by transcriptionist for "_RASSSBN  ;Removed RA*5*8 _", M.D."
"RTN","RARTR1",122,0)
 ... Q
"RTN","RARTR1",123,0)
 .. I $G(RARPT(10))']"",($D(RAUTOE)) D  Q
"RTN","RARTR1",124,0)
 ... S:RAWHOVER=+RASS(0) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="          (Verifier, no e-sig)"
"RTN","RARTR1",125,0)
 ... S:RAWHOVER'=+RASS(0) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="          Verified by transcriptionist for "_RASSSBN  ;Removed RA*5*8 _", M.D."
"RTN","RARTR1",126,0)
 ... Q
"RTN","RARTR1",127,0)
 .. W:'$D(RAUTOE) " (Verifier)"
"RTN","RARTR1",128,0)
 .. S:$D(RAUTOE) ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_" (Verifier)"
"RTN","RARTR1",129,0)
 .. Q
"RTN","RARTR1",130,0)
 . I RAPVERF=+RASS(0) W:'$D(RAUTOE) " (Pre-Verifier)" S:$D(RAUTOE) ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_" (Pre-Verifier)"
"RTN","RARTR1",131,0)
 . Q
"RTN","RARTR1",132,0)
 Q
"RTN","RARTRPV")
0^19^B30787953^B29054885
"RTN","RARTRPV",1,0)
RARTRPV ;HISC/FPT-Resident Pre-Verify Report ;10/3/97  15:54
"RTN","RARTRPV",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**26,56**;Mar 16, 1998;Build 3
"RTN","RARTRPV",3,0)
 ;Supported IA #10104 REPEAT^XLFSTR
"RTN","RARTRPV",4,0)
 ;Supported IA #10035 ^DPT(
"RTN","RARTRPV",5,0)
 ;Supported IA #10060 and 2056 GET1^DIQ of file 200
"RTN","RARTRPV",6,0)
 ;Supported IA #10076 ^XUSEC
"RTN","RARTRPV",7,0)
 N DIERR
"RTN","RARTRPV",8,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTRPV",9,0)
 K RAVER S:$D(^VA(200,DUZ,0)) RAVER=$P(^(0),"^") I '$D(RAVER) W !!,$C(7),"Your name must be defined in the NEW PERSON File to continue." G Q
"RTN","RARTRPV",10,0)
 I '$D(^VA(200,"ARC","R",DUZ)) W !!,$C(7),"You are not classified as a Rad/Nuc Med Interpreting Resident." G Q
"RTN","RARTRPV",11,0)
 S RAINACT=$$GET1^DIQ(200,DUZ_",",53.4,"I") ; grab Inactive Date (if any)
"RTN","RARTRPV",12,0)
 I RAINACT,(RAINACT'>DT) W !!,$C(7),"You are not classified as an active Rad/Nuc Med Interpreting Resident." K RAINACT G Q
"RTN","RARTRPV",13,0)
 K RAINACT S RAONLINE="" W ! D ES^RASIGU G Q:'%
"RTN","RARTRPV",14,0)
 S RARAD=DUZ,RAD="ARES"
"RTN","RARTRPV",15,0)
 ;
"RTN","RARTRPV",16,0)
SRTRPT K RA,RARPTX,^TMP($J,"RA") S (RATOT,RARPT)=0
"RTN","RARTRPV",17,0)
 F  S RARPT=$O(^RARPT(RAD,RARAD,RARPT)) Q:'RARPT  I $D(^RARPT(RARPT,0)) S RARTDT=$S($P(^(0),"^",6)="":9999999.9999,1:$P(^(0),"^",6)) I $P(^RARPT(RARPT,0),U,12)="" D
"RTN","RARTRPV",18,0)
 .Q:$$STUB^RAEDCN1(RARPT)  ;skip stub report 031501
"RTN","RARTRPV",19,0)
 .Q:"^V^EF^"[("^"_$P($G(^RARPT(+RARPT,0)),"^",5)_"^")  ;skip if V or EF
"RTN","RARTRPV",20,0)
 .S ^TMP($J,"RA","DT",RARTDT,RARPT)=""
"RTN","RARTRPV",21,0)
 .S RATOT=RATOT+1
"RTN","RARTRPV",22,0)
 I 'RATOT W !!,"You have no Unverified Reports." G Q
"RTN","RARTRPV",23,0)
 ;
"RTN","RARTRPV",24,0)
SELRPT S RARD("A")="Do you wish to review "_$S(RATOT=1:"this one report",1:"all "_RATOT_" reports")_"?  ",RARD(1)="Yes^review all reports",RARD(2)="No^choose which reports to review",RARD("B")=1,RARD(0)="S"
"RTN","RARTRPV",25,0)
 D SET^RARD K RARD S X=$E(X) G Q:X["^"!(X="N"&(RATOT=1)),RPTLP:X="Y" D ^RARTVER1 G Q:$D(RAOUT)!('$D(RARPTX))
"RTN","RARTRPV",26,0)
 ;
"RTN","RARTRPV",27,0)
RPTLP S DIR(0)="S^P:PAGE AT A TIME;E:ENTIRE REPORT",DIR("B")="P",DIR("A")="How would you like to view the reports?"
"RTN","RARTRPV",28,0)
 S DIR("?",1)="If you would like to pause after each page of the report enter 'P'.",DIR("?")="Otherwise enter 'E' to view an entire report at one time."
"RTN","RARTRPV",29,0)
 D ^DIR K DIR G Q:$D(DIRUT) I Y="E" S RARTVERF=1
"RTN","RARTRPV",30,0)
 I $D(^TMP($J,"RA","DT")) S RARPT=0 F RARTDT=0:0 S RARTDT=$O(^TMP($J,"RA","DT",RARTDT)) Q:'RARTDT  S RARDX="" D GETRPT Q:RARDX="^"
"RTN","RARTRPV",31,0)
 I $D(^TMP($J,"RA","XREF")) S (RPTX,RARPT)=0 D GETRPT
"RTN","RARTRPV",32,0)
 ;
"RTN","RARTRPV",33,0)
Q K %,%DT,%W,%Y1,DA,DGO,DI,DIC,DIWF,DIWR,I,OREND,POP,RA,RACN,RACNI,RACS,RACT,RAD,RADATE,RADFN,RADIV,RADTE,RADTI,RADUP,RADUZ,RAERR,RAFLG,RAIMGTYJ,RAJ1,RAPRIT,RANM,RANME,RANUM,RAONLINE,RAOR,RAOUT,RAPRC,RARAD,RARDX,RARPDT,RARPT
"RTN","RARTRPV",34,0)
 K RARPTX,RARTDT,RARTVER,RARTVERF,RASET,RASIG,RASN,RASTI,RATOT,RAVER,RAVNB,RAXIT,RAXX,RPTX,X,Y,^TMP($J,"RA")
"RTN","RARTRPV",35,0)
 K %X,D,D0,D1,DDER,DDH,DLAYGO
"RTN","RARTRPV",36,0)
 K C,DIRUT,DUOUT,HLN,HLRESLT,HLSAN,J,RADFLDS,RAPRTSET,X1
"RTN","RARTRPV",37,0)
 Q
"RTN","RARTRPV",38,0)
 ;
"RTN","RARTRPV",39,0)
GETRPT I $G(RARPT) L -^RARPT(RARPT)
"RTN","RARTRPV",40,0)
 S:$D(^TMP($J,"RA","XREF")) RPTX=RPTX+1 S RARPT=$S($D(^TMP($J,"RA","DT")):$O(^TMP($J,"RA","DT",RARTDT,RARPT)),$D(^TMP($J,"RA","XREF")):+$G(RARPTX(RPTX)),1:0) Q:'RARPT  L +^RARPT(RARPT):2 G:'$T LOCK G:$P($G(^RARPT(RARPT,0)),U,5)="V" VER
"RTN","RARTRPV",41,0)
 D DISRPT
"RTN","RARTRPV",42,0)
 I RAIMGTYJ']"" D  Q
"RTN","RARTRPV",43,0)
 . I $G(RARPT) L -^RARPT(RARPT)
"RTN","RARTRPV",44,0)
 . Q
"RTN","RARTRPV",45,0)
ASK W !,$$REPEAT^XLFSTR("=",80)
"RTN","RARTRPV",46,0)
 S RARD(1)="Print^print this report for editing",RARD(2)="Edit^edit this report",RARD(3)="Top^display the report from the beginning",RARD(4)="Continue^continue normal processing"
"RTN","RARTRPV",47,0)
 S RARD(5)="Status & Print^edit Status, then print report",RARD("B")=4,RARD(0)="S"
"RTN","RARTRPV",48,0)
 D SET^RARD K RARD S RARDX=$E(X) I RARDX="^" L -^RARPT(RARPT) Q
"RTN","RARTRPV",49,0)
 I "PT"[RARDX D PRTRPT:RARDX="P",DISRPT:RARDX="T" G ASK
"RTN","RARTRPV",50,0)
 I RARDX="E" D EDTCHK I RARDX="E" D  G ASK
"RTN","RARTRPV",51,0)
 .W !!,"EDITING REPORT",!,"--------------",!
"RTN","RARTRPV",52,0)
 .D EDTRPT^RARTRPV1
"RTN","RARTRPV",53,0)
 .D:RACT'="V" UP1^RAUTL1
"RTN","RARTRPV",54,0)
 .I $D(DTOUT) K ^TMP($J,"RA")
"RTN","RARTRPV",55,0)
 .Q
"RTN","RARTRPV",56,0)
 G NOEDIT^RARTRPV1 ;pre-verify report, no report text edit
"RTN","RARTRPV",57,0)
 ;
"RTN","RARTRPV",58,0)
DISRPT S (RAIMGTYJ,RARTVER)="" D RASET Q:'Y!(RAIMGTYJ']"")  D DISP^RART1 K RARTVER
"RTN","RARTRPV",59,0)
 Q
"RTN","RARTRPV",60,0)
PRTRPT D SAVE^RARTVER2
"RTN","RARTRPV",61,0)
 S ION=$P(RAMLC,"^",10),IOP=$S(ION]"":"Q;"_ION,1:"Q")
"RTN","RARTRPV",62,0)
 S RAMES="W !!,""Report has been queued for printing on device "",ION,"".""" D Q^RARTR
"RTN","RARTRPV",63,0)
 D RESTORE^RARTVER2
"RTN","RARTRPV",64,0)
 Q
"RTN","RARTRPV",65,0)
 ;
"RTN","RARTRPV",66,0)
RASET S Y=RARPT D RASET^RAUTL2 Q:'Y
"RTN","RARTRPV",67,0)
 S Y(0)=Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RARTRPV",68,0)
 S RAPRC=$S($D(^RAMIS(71,+$P(Y(0),"^",2),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RARTRPV",69,0)
 S RAIMGTYJ=$$IMGTY^RAUTL12("e",RADFN,RADTI)
"RTN","RARTRPV",70,0)
 I RAIMGTYJ']"" D
"RTN","RARTRPV",71,0)
 . W !?5,"Imaging Type data appears to be missing for this exam.",$C(7)
"RTN","RARTRPV",72,0)
 . Q
"RTN","RARTRPV",73,0)
 Q
"RTN","RARTRPV",74,0)
LOCK S RACN=+$P(^RARPT(RARPT,0),"^",4)
"RTN","RARTRPV",75,0)
 W !!,$C(7),"Another user is editing this report",$S($G(RACN)]"":" (Case # "_RACN_")",1:""),".  Please try again later." H 4 K RACN G GETRPT
"RTN","RARTRPV",76,0)
 Q
"RTN","RARTRPV",77,0)
VER ; report was verified since tmp global was built
"RTN","RARTRPV",78,0)
 S RACN=$G(^RARPT(RARPT,0))
"RTN","RARTRPV",79,0)
 S RACN("CASE")=+$P(RACN,U,4)
"RTN","RARTRPV",80,0)
 S RACN("PAT")=+$P(RACN,U,2)
"RTN","RARTRPV",81,0)
 S RACN("VER")=+$P(RACN,U,9)
"RTN","RARTRPV",82,0)
 W !!,$C(7),$$GET1^DIQ(200,+RACN("VER")_",",.01)_" verified report for "_$P(^DPT(RACN("PAT"),0),U)
"RTN","RARTRPV",83,0)
 W !,"(Case # "_RACN("CASE")_") since you began this option."
"RTN","RARTRPV",84,0)
 H 4 K RACN G GETRPT
"RTN","RARTRPV",85,0)
 Q
"RTN","RARTRPV",86,0)
EDTCHK ; is user permitted to edit report
"RTN","RARTRPV",87,0)
 S RASTATUS=+$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",3)
"RTN","RARTRPV",88,0)
 I $P($G(^RA(72,RASTATUS,0)),"^",3)>0 K RASTATUS Q
"RTN","RARTRPV",89,0)
 K RASTATUS
"RTN","RARTRPV",90,0)
 I $D(^XUSEC("RA MGR",DUZ)) Q
"RTN","RARTRPV",91,0)
 I $P(RAMDV,"^",22)=1 Q
"RTN","RARTRPV",92,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!!
"RTN","RARTRPV",93,0)
 S RARDX="C" ;Reset RARDX so user can only verify.
"RTN","RARTRPV",94,0)
 Q
"RTN","RARTST1")
0^20^B27908673^B26498564
"RTN","RARTST1",1,0)
RARTST1 ;HISC/CAH,FPT,GJC,DAD AISC/MJK,RMO-Reports Distribution ;7/23/97  12:44
"RTN","RARTST1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56**;Mar 16, 1998;Build 3
"RTN","RARTST1",3,0)
 ;Supported IA #10040 ^SC(
"RTN","RARTST1",4,0)
 ;Supported IA #10060 and #2056 GET1^DIQ of file 200
"RTN","RARTST1",5,0)
 ;Supported IA #10007 DO^DIC1
"RTN","RARTST1",6,0)
1 ;;Routing Queue
"RTN","RARTST1",7,0)
 N RAOMA S RAOMA="",DIC(0)="AEMQZ"
"RTN","RARTST1",8,0)
 S DIC("A")="Select Routing Queue: ",DIC("B")="WARD REPORTS"
"RTN","RARTST1",9,0)
 S DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0)"
"RTN","RARTST1",10,0)
 S DIC="^RABTCH(74.3," D ^DIC K DIC G:Y<1 Q
"RTN","RARTST1",11,0)
 S RAB=+Y,RARTST1=$S(Y(0,0)="REQUESTING PHYSICIAN":0,1:1)
"RTN","RARTST1",12,0)
 D DIV^RARTST2A G:'$D(RADIV)!('$D(RAIMAG))!('$D(RASRT))!('$D(RAPRT)) Q
"RTN","RARTST1",13,0)
 G DIP K RA4,RAF408
"RTN","RARTST1",14,0)
 ;
"RTN","RARTST1",15,0)
2 ;;Individual Ward Distribution
"RTN","RARTST1",16,0)
 N RAOMA S RAOMA=""
"RTN","RARTST1",17,0)
 S Y=$O(^RABTCH(74.3,"B","WARD REPORTS",0)) Q:'Y  S RAB=Y
"RTN","RARTST1",18,0)
 D DIV^RARTST2A G:'$D(RADIV)!('$D(RAIMAG))!('$D(RASRT))!('$D(RAPRT)) Q
"RTN","RARTST1",19,0)
 S RADIC(0)="AEMQ",RADIC="^DIC(42,",RADIC("A")="Select Ward: "
"RTN","RARTST1",20,0)
 S RADIC("S")="I $P(^(0),U,11)=RA4(RADIV)"
"RTN","RARTST1",21,0)
 D EN1^RASELCT(.RADIC,"WARD/CLIN") K RADIC I RAQUIT G Q
"RTN","RARTST1",22,0)
 K RA4,RAF408,RAQUIT S RANGE="^^6" G DIP
"RTN","RARTST1",23,0)
 ;
"RTN","RARTST1",24,0)
3 ;;Single Clinic Distribution
"RTN","RARTST1",25,0)
 N RAOMA S RAOMA=""
"RTN","RARTST1",26,0)
 S Y=$O(^RABTCH(74.3,"B","CLINIC REPORTS",0)) Q:'Y  S RAB=Y
"RTN","RARTST1",27,0)
 D DIV^RARTST2A G:'$D(RADIV)!('$D(RAIMAG))!('$D(RASRT))!('$D(RAPRT)) Q
"RTN","RARTST1",28,0)
 S RADIC(0)="AEMQ",RADIC="^SC(",RADIC("A")="Select Clinic: "
"RTN","RARTST1",29,0)
 S RADIC("S")="N RA44 S RA44=$G(^(0)) I $P(RA44,U,3)'=""W"",($P(RA44,U,15)=RA4(RADIV))"
"RTN","RARTST1",30,0)
 D EN1^RASELCT(.RADIC,"WARD/CLIN") K RADIC I RAQUIT G Q
"RTN","RARTST1",31,0)
 K RA4,RAF408,RAQUIT S RANGE="^^8" G DIP
"RTN","RARTST1",32,0)
 ;
"RTN","RARTST1",33,0)
4 ;;Distribution File Activity
"RTN","RARTST1",34,0)
 S DIC="^RABTCH(74.3,",DIC(0)="AEMQ",DIC("A")="Select Routing Queue: ",DIC("B")="WARD REPORTS" D ^DIC K DIC G:Y<0 Q41 S RAB=+Y,RABN=$P(Y,"^",2)
"RTN","RARTST1",35,0)
 S ZTRTN="S4^RARTST1",ZTSAVE("RAB")="",ZTSAVE("RABN")="" D ZIS^RAUTL G Q4:RAPOP
"RTN","RARTST1",36,0)
S4 U IO D HD4 F RADTI=0:0 S RADTI=$O(^RABTCH(74.3,RAB,"L",RADTI)) Q:'RADTI  I $D(^(RADTI,0)) S X=^(0),RADTE=$P(X,"^"),RACT=$P(X,"^",2),RADUZ=+$P(X,"^",3),RARTMES=$P(X,"^",4),RARTCNT=+$P(X,"^",5) D P4 Q:"^"[X
"RTN","RARTST1",37,0)
Q4 K DIC,RAPOP,RADTI,RAPAGE,RARTCNT,RABN,RAIOM,RAIOSL,RAB,RADTE,RADATE,RADUZ,RACT,RARTMES,X,Y D CLOSE^RAUTL
"RTN","RARTST1",38,0)
Q41 K POP,DUOUT,I,RAMES,ZTDESC,ZTRTN,ZTSAVE
"RTN","RARTST1",39,0)
 Q
"RTN","RARTST1",40,0)
P4 N DIERR
"RTN","RARTST1",41,0)
 S Y=RADTE D D^RAUTL S RADATE=Y,RACT=$S(RACT="P":"PRINT",RACT="R":"RE-PRINT",1:"UNKNOWN"),RADUZ=$$GET1^DIQ(200,RADUZ_",",.01) S:RADUZ="" RADUZ="UNKNOWN"
"RTN","RARTST1",42,0)
 D HD4:($Y+4)>IOSL Q:"^"[X  W !,RADATE,?20,RACT,?30,$E(RADUZ,1,15),?50,$E(RARTMES,1,20),?72,RARTCNT
"RTN","RARTST1",43,0)
 Q
"RTN","RARTST1",44,0)
HD4 S RAPAGE=$S($D(RAPAGE):RAPAGE+1,1:1)
"RTN","RARTST1",45,0)
 I RAPAGE>1 R !!,"Press RETURN to continue or '^' to stop",X:DTIME I X["^" S X="^" Q
"RTN","RARTST1",46,0)
 W @IOF,!,RABN_" Distribution Activity Log",?70,"Page: ",RAPAGE,!,"Run Date: " S X="NOW",%DT="TX" D ^%DT K %DT D D^RAUTL W Y
"RTN","RARTST1",47,0)
 W !!,"Log Date",?20,"Activity",?30,"User",?50,"Comment",?72,"Qty",!,"--------",?20,"--------",?30,"----",?50,"-------",?72,"---" Q
"RTN","RARTST1",48,0)
 ;
"RTN","RARTST1",49,0)
5 ;;Unprinted Reports List
"RTN","RARTST1",50,0)
 S DHD="Unprinted Reports List",FLDS="[RA ALL UNPRINTED REPORTS]",BY="[RA ALL UNPRINTED]",RARPTFLG=""
"RTN","RARTST1",51,0)
 S DIS(0)="S Y=$G(^RABTCH(74.4,D0,0)) I Y S RARPT=+Y,RAB=$P(Y,U,11),RARDIFN=D0,RAY3=$G(^RABTCH(74.4,RARDIFN,0)) I RAY3]"""" S RADFN=+$P($G(^RARPT(RARPT,0)),U,2) D UPDLOC^RAUTL10 I $D(RAPRTOK)" D DIP^RARTST3
"RTN","RARTST1",52,0)
 K DISH,F,O,RARPTFLG,W,I,POP
"RTN","RARTST1",53,0)
 Q
"RTN","RARTST1",54,0)
6 ;;Clinic Distribution List
"RTN","RARTST1",55,0)
 S DIC="^SC(",RAWC="Clinic",Y=$O(^RABTCH(74.3,"B","CLINIC REPORTS",0)) Q:'Y  S RAB=+Y G SELECT^RARTST3
"RTN","RARTST1",56,0)
 ;
"RTN","RARTST1",57,0)
7 ;;Ward Distribution List
"RTN","RARTST1",58,0)
 S RAWC="Ward",DIC="^DIC(42,",Y=$O(^RABTCH(74.3,"B","WARD REPORTS",0)) I 'Y K I,POP Q
"RTN","RARTST1",59,0)
 S RAB=+Y G SELECT^RARTST3
"RTN","RARTST1",60,0)
 ;
"RTN","RARTST1",61,0)
8 ;;Report's Print Status
"RTN","RARTST1",62,0)
 S DIC("A")="Select Report: ",DIC="^RARPT(",DIC(0)="AEMQZ"
"RTN","RARTST1",63,0)
 S DIC("S")="I $P(^(0),U,5)'=""X"""
"RTN","RARTST1",64,0)
 D DICW,^DIC K DIC I Y<0 D 81 Q
"RTN","RARTST1",65,0)
 I $P(Y(0),"^",5)'="V" W !!,$C(7),"Report has not been 'verified'." W ! D 81 G 8
"RTN","RARTST1",66,0)
 I '$D(^RABTCH(74.4,"B",+Y)) W !!,$C(7),"Report is not in any distribution queue." W ! D 81 G 8
"RTN","RARTST1",67,0)
 S RADFN=+$P(Y(0),U,2),(D0,RARPT)=+Y F RAD0=0:0 S RAD0=$O(^RABTCH(74.4,"B",D0,RAD0)) Q:RAD0'>0  S RAB=$S($D(^RABTCH(74.4,RAD0,0)):$P(^(0),"^",11),1:""),RARDIFN=RAD0,RAY3=$G(^RABTCH(74.4,RARDIFN,0)) I RAY3]"" D UPDLOC^RAUTL10
"RTN","RARTST1",68,0)
 K DXS D RPTST^RARTST2A(RARPT)
"RTN","RARTST1",69,0)
81 K %,C,D,D0,DDH,DILCT,DIPGM,DISTP,DN,DISYS,POP,RASSN,RAY3
"RTN","RARTST1",70,0)
 K %,DIXX,DXS,I,RAB,RABTY,RACN,RAD0,RADFN,RAPRTOK,RARDIFN,RARPT,X,X1,Y
"RTN","RARTST1",71,0)
 Q
"RTN","RARTST1",72,0)
DIP ;RANGE defined only if prt'g via 'Individual Ward' or 'Single Clinic'
"RTN","RARTST1",73,0)
 ;D DIV^RARTST2A G:'$D(RADIV)!('$D(RAIMAG))!('$D(RASRT))!('$D(RAPRT)) Q
"RTN","RARTST1",74,0)
 I $D(RANGE) S RANGE=$TR(RANGE,"^","~")
"RTN","RARTST1",75,0)
 ;**** NEXT LINE FOR TESTING ONLY ***
"RTN","RARTST1",76,0)
 ;D ^%ZIS D START^RARTST2
"RTN","RARTST1",77,0)
 W ! S ZTRTN="START^RARTST2",ZTSAVE("RADIV")="",ZTSAVE("RAIMAG(")="",ZTSAVE("RASRT")="",ZTSAVE("RAB")="",ZTSAVE("RALOCSRT")="",IOP="Q"
"RTN","RARTST1",78,0)
 S:$D(RABEG) ZTSAVE("RABEG")="",ZTSAVE("RAEND")=""
"RTN","RARTST1",79,0)
 S:$D(RA4) ZTSAVE("RA4(")="" S:$D(RAF408) ZTSAVE("RAF408(")=""
"RTN","RARTST1",80,0)
 I $D(RANGE) S ZTSAVE("RANGE")="",ZTSAVE("^TMP($J,""WARD/CLIN"",")=""
"RTN","RARTST1",81,0)
 D ZIS^RAUTL K IOP
"RTN","RARTST1",82,0)
Q K %,%DT,D,D0,D1,DA,DDH,DIC,DIE,DIR,DIRUT,DIXX,J,POP,RAB,RABEG,RACN,RADIV,RAEND,RAIMAG,RANGE,RAPOP,RAPRT,RAQUIT,RARD,RARTST1,RALOCSRT,RASRT,X,X1,Y,^TMP($J,"WARD/CLIN")
"RTN","RARTST1",83,0)
 D CLOSE^RAUTL K DISYS,DUOUT,I,POP,RA4,RAF408,RAMES,ZTDESC,ZTRTN,ZTSAVE
"RTN","RARTST1",84,0)
 Q
"RTN","RARTST1",85,0)
DICW ; Build DIC("W") string
"RTN","RARTST1",86,0)
 N DO D DO^DIC1
"RTN","RARTST1",87,0)
 S DIC("W")=$S($G(DIC("W"))]"":DIC("W")_" ",1:"")_"W ""   "",$$FLD^RARTFLDS(+Y,""PROC"")"
"RTN","RARTST1",88,0)
 Q
"RTN","RARTUVR")
0^23^B31723105^B29888413
"RTN","RARTUVR",1,0)
RARTUVR ;HISC/FPT,SWM AISC/RMO-Unverified Reports ;8/19/97  11:01
"RTN","RARTUVR",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**29,56**;Mar 16, 1998;Build 3
"RTN","RARTUVR",3,0)
 ;
"RTN","RARTUVR",4,0)
 ; This routine displays the total number of reports that have a status
"RTN","RARTUVR",5,0)
 ; other than V(erify) and the report is linked to a Resident, Staff or
"RTN","RARTUVR",6,0)
 ; unknown physician. It builds the report by using the 'ASTAT' cross
"RTN","RARTUVR",7,0)
 ; reference on File 74. It displays the report by division and imaging
"RTN","RARTUVR",8,0)
 ; type. Within division/imaging type, it displays the number of reports
"RTN","RARTUVR",9,0)
 ; by category (Resident and Staff). It displays the number of unverified
"RTN","RARTUVR",10,0)
 ; reports by Interpreting Physician within a category.
"RTN","RARTUVR",11,0)
 ; The routine checks the PRIMARY INTERPRETING RESIDENT and PRIMARY
"RTN","RARTUVR",12,0)
 ; INTERPRETING STAFF fields (File 70) associated with a report.
"RTN","RARTUVR",13,0)
 ; If a primary Resident is associated with the report, then the report
"RTN","RARTUVR",14,0)
 ; is counted towards that Resident.
"RTN","RARTUVR",15,0)
 ; If a primary Staff physician is associated with the report, then the
"RTN","RARTUVR",16,0)
 ; report is counted towards that Interpreting Staff.
"RTN","RARTUVR",17,0)
 ; If neither of the above are true the report is counted toward unknown.
"RTN","RARTUVR",18,0)
 ;
"RTN","RARTUVR",19,0)
EN ; unverified reports report
"RTN","RARTUVR",20,0)
 K ^TMP($J)
"RTN","RARTUVR",21,0)
 I '$D(^RARPT("ASTAT")) W !!,*7,?5,"There are no Unverified Reports." Q
"RTN","RARTUVR",22,0)
 ;
"RTN","RARTUVR",23,0)
 ; Select Imaging Type, if exists
"RTN","RARTUVR",24,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0) S RAPSTX=""
"RTN","RARTUVR",25,0)
 S RAXIT=$$SETUPDI^RAUTL7() I RAXIT K RAXIT Q
"RTN","RARTUVR",26,0)
 S X=$$DIVLOC^RAUTL7() I X D KILL Q
"RTN","RARTUVR",27,0)
 S RACNT=0,X="" F  S X=$O(RACCESS(DUZ,"DIV-IMG",X)) Q:X']""  D
"RTN","RARTUVR",28,0)
 . Q:'$D(^TMP($J,"RA D-TYPE",X))  S Y=""
"RTN","RARTUVR",29,0)
 . F  S Y=$O(RACCESS(DUZ,"DIV-IMG",X,Y)) Q:Y']""  D
"RTN","RARTUVR",30,0)
 .. S:$D(^TMP($J,"RA I-TYPE",Y)) ^TMP($J,"RAUVR",X,Y)=0,RACNT=RACNT+1
"RTN","RARTUVR",31,0)
 .. Q
"RTN","RARTUVR",32,0)
 . Q
"RTN","RARTUVR",33,0)
 W !
"RTN","RARTUVR",34,0)
ASKBD K DIR S DIR("B")="b"
"RTN","RARTUVR",35,0)
 S DIR("?",1)="Enter 'b' for a brief format, 'd' for a detailed format, "
"RTN","RARTUVR",36,0)
 S DIR("?",2)="'e' for a format sorted by exam date, 's' for a format"
"RTN","RARTUVR",37,0)
 S DIR("?",3)="sorted by Primary Interpreting Staff."
"RTN","RARTUVR",38,0)
 S DIR("?")="This is mandatory."
"RTN","RARTUVR",39,0)
 S DIR(0)="S^b:Brief;d:Detailed;e:Exam Date, Itemized List;s:Staff, Itemized List"
"RTN","RARTUVR",40,0)
 D ^DIR G:$D(DIRUT) KILL
"RTN","RARTUVR",41,0)
 S RABD=$$UP^XLFSTR(Y) K DIR,DIROUT,DIRUT,DUOUT,DTOUT
"RTN","RARTUVR",42,0)
 I RABD="S"!(RABD="E") D
"RTN","RARTUVR",43,0)
 . W ! D 132^RAMAINP S RAFILE="EXAM REGISTERED"
"RTN","RARTUVR",44,0)
 . Q
"RTN","RARTUVR",45,0)
 E  S RAFILE="REPORT ENTERED"
"RTN","RARTUVR",46,0)
 ;
"RTN","RARTUVR",47,0)
ASKTHRU S RASKTIME=1 W !!,"(The date range refers to DATE "_RAFILE_")"
"RTN","RARTUVR",48,0)
 D DATE^RAUTL K RAFILE,RASKTIME ;allow time of day input
"RTN","RARTUVR",49,0)
 G:X="^" KILL G:'$D(ENDDATE)!('$D(BEGDATE)) KILL
"RTN","RARTUVR",50,0)
 S:$L(ENDDATE)=7 ENDDATE=ENDDATE_".2359"
"RTN","RARTUVR",51,0)
 G:"^E^S^"[("^"_RABD_"^") DEVICE ; skip date/time cut-off
"RTN","RARTUVR",52,0)
 ;
"RTN","RARTUVR",53,0)
ASKCUT S RACUT(1)=24,RACUT(2)=48,RACUT(3)=96
"RTN","RARTUVR",54,0)
 W !!,"Default cut-off limits (in hours) for aging of reports are :"
"RTN","RARTUVR",55,0)
 W !!?35 F RA1=1:1:3 W RACUT(RA1),"   "
"RTN","RARTUVR",56,0)
 K DIR S DIR("A")="Do you want to enter different cut-off limits",DIR("B")="N",DIR("?")="Enter  Y  only if you want to change the above limits",DIR("??")="This is optional",DIR(0)="Y"
"RTN","RARTUVR",57,0)
 W ! D ^DIR K DIR G:X="^" KILL G:+Y<1 DEVICE
"RTN","RARTUVR",58,0)
 S DIR("?")="Enter number of hours as the cut-off limit"
"RTN","RARTUVR",59,0)
 F RA1=1:1:3 S DIR(0)="N^"_$S(RA1=1:0,1:RACUT(RA1-1))_":87660",DIR("A")="Enter the "_$S(RA1=1:"first",RA1=2:"second",1:"third")_" cutoff hours" D ^DIR Q:+Y<1  S RACUT(RA1)=Y
"RTN","RARTUVR",60,0)
 K DIR I +Y<1 W !!,"Try again " G ASKCUT
"RTN","RARTUVR",61,0)
 ;
"RTN","RARTUVR",62,0)
DEVICE ; select device
"RTN","RARTUVR",63,0)
 S ZTRTN="START^RARTUVR",ZTSAVE("^TMP($J,""RA D-TYPE"",")="",ZTSAVE("^TMP($J,""RA I-TYPE"",")="",ZTSAVE("^TMP($J,""RAUVR"",")="",ZTSAVE("RACNT")="",ZTSAVE("BEGDATE")="",ZTSAVE("ENDDATE")="",ZTSAVE("RACUT*")="",ZTSAVE("RABD")=""
"RTN","RARTUVR",64,0)
 W ! D ZIS^RAUTL I RAPOP D KILL Q
"RTN","RARTUVR",65,0)
START ; start processing
"RTN","RARTUVR",66,0)
 U IO S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RARTUVR",67,0)
 I "^E^S^"[("^"_RABD_"^") D EN1^RARTUVR3 D KILL Q
"RTN","RARTUVR",68,0)
 S RADIVNME=""
"RTN","RARTUVR",69,0)
 F  S RADIVNME=$O(^TMP($J,"RAUVR",RADIVNME)) Q:RADIVNME']""  S RAITNAME="" F  S RAITNAME=$O(^TMP($J,"RAUVR",RADIVNME,RAITNAME)) Q:RAITNAME']""  D
"RTN","RARTUVR",70,0)
 . S ^TMP($J,RADIVNME,RAITNAME,"RESCNT")=0
"RTN","RARTUVR",71,0)
 . S ^TMP($J,RADIVNME,RAITNAME,"STFCNT")=0
"RTN","RARTUVR",72,0)
 . S ^TMP($J,RADIVNME,RAITNAME,"UNKCNT")=0
"RTN","RARTUVR",73,0)
 . Q
"RTN","RARTUVR",74,0)
 ;
"RTN","RARTUVR",75,0)
 ;
"RTN","RARTUVR",76,0)
 S RASTATUS="",RAOUT=0
"RTN","RARTUVR",77,0)
 F  S RASTATUS=$O(^RARPT("ASTAT",RASTATUS)) Q:RASTATUS=""!(RAOUT)  D
"RTN","RARTUVR",78,0)
 . S RARPT=0,RAOUT=0
"RTN","RARTUVR",79,0)
 . F  S RARPT=$O(^RARPT("ASTAT",RASTATUS,RARPT)) Q:RARPT'>0!(RAOUT)  D
"RTN","RARTUVR",80,0)
 ..;use Report Status to exclude, as Verf'd rpt may have leftover "ASTAT"
"RTN","RARTUVR",81,0)
 ..;exclude Verified, Deleted, and Electronically Filed reports
"RTN","RARTUVR",82,0)
 .. Q:"^V^X^EF^"[("^"_$P($G(^RARPT(RARPT,0)),U,5)_"^")
"RTN","RARTUVR",83,0)
 .. S RARPTENT=$P($G(^RARPT(RARPT,0)),U,6)
"RTN","RARTUVR",84,0)
 .. Q:RARPTENT<BEGDATE!(RARPTENT>ENDDATE)
"RTN","RARTUVR",85,0)
 .. I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAOUT=1 Q:RAOUT=1
"RTN","RARTUVR",86,0)
 .. S Y=RARPT D RASET^RAUTL2 Q:'Y  S RAX=Y
"RTN","RARTUVR",87,0)
 .. S RAPRES=$P(RAX,"^",12),RAPSTF=$P(RAX,"^",15)
"RTN","RARTUVR",88,0)
 .. ; Check if Staff & Resident the same, if so, use Staff only
"RTN","RARTUVR",89,0)
 .. I (RAPSTF>0),(RAPRES=RAPSTF) S RAPRES=""
"RTN","RARTUVR",90,0)
 .. S RAIP=""
"RTN","RARTUVR",91,0)
 .. S:RAPRES>0 RAIP=RAIP_"R"
"RTN","RARTUVR",92,0)
 .. S:RAPSTF>0 RAIP=RAIP_"S"
"RTN","RARTUVR",93,0)
 .. S:RAIP="" RAIP="U"
"RTN","RARTUVR",94,0)
 .. D BTG^RARTUVR1
"RTN","RARTUVR",95,0)
 .. Q
"RTN","RARTUVR",96,0)
 . Q
"RTN","RARTUVR",97,0)
DIV ; walk through tmp global, start with 'division'
"RTN","RARTUVR",98,0)
 S (RACNT(0),RAOUT,RAPAGE)=0,RADIVNME=""
"RTN","RARTUVR",99,0)
 S X="NOW",%DT="T" D ^%DT K %DT D D^RAUTL S RARUNDAT=Y
"RTN","RARTUVR",100,0)
 S $P(RADASH,"-",IOM)="",$P(RAEQUAL,"=",IOM+1)=""
"RTN","RARTUVR",101,0)
 F  S RADIVNME=$O(^TMP($J,"RAUVR",RADIVNME)) Q:RADIVNME=""!(RAOUT)  D IT Q:RAOUT  D DIVSUM^RARTUVR1 Q:RAOUT
"RTN","RARTUVR",102,0)
KILL ; kill variables & close device
"RTN","RARTUVR",103,0)
 K ^TMP($J),POP,RAPOP,RACN,RACNI,RACNT,RAD,RADATE,RADFN,RADIVNME,RADIVNUM,RADTI,RADTE,RAFL,RAFLG,RAIP,RAIPNAME,RAITNAME,RAITNUM,RAOUT,RAPAGE,RAQUIT,RAPRES,RAPSTF,RARAD,RARE,RARPT,RARS,RASTATUS,RASTRING,RAX,RAXIT,X,Y,ZTQUEUED,ZTSTOP
"RTN","RARTUVR",104,0)
 K RA1,RA2,RA3,RA4,RABD,RACUT,RADASH,RAEQUAL,RAHOURS,RARPTENT,RARUNDAT,RASSN
"RTN","RARTUVR",105,0)
 K:$D(RAPSTX) RACCESS,RAPSTX
"RTN","RARTUVR",106,0)
 K BEGDATE,DIR,DIRUT,DUOUT,ENDDATE,I,RAMES,ZTDESC,ZTRTN,ZTSAVE
"RTN","RARTUVR",107,0)
 D CLOSE^RAUTL
"RTN","RARTUVR",108,0)
 Q
"RTN","RARTUVR",109,0)
IT ; imaging type
"RTN","RARTUVR",110,0)
 S RAITNAME=""
"RTN","RARTUVR",111,0)
 F  S RAITNAME=$O(^TMP($J,"RAUVR",RADIVNME,RAITNAME)) Q:RAITNAME=""!(RAOUT)  D PRINT^RARTUVR2 Q:RAOUT
"RTN","RARTUVR",112,0)
 Q
"RTN","RARTUVR",113,0)
 ;
"RTN","RARTUVR1")
0^24^B26330363^B25670683
"RTN","RARTUVR1",1,0)
RARTUVR1 ;HISC/FPT,SWM AISC/RMO-Unverified Reports ;8/19/97  11:16
"RTN","RARTUVR1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**29,56**;Mar 16, 1998;Build 3
"RTN","RARTUVR1",3,0)
 ;
"RTN","RARTUVR1",4,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RARTUVR1",5,0)
 ; RAHOURS=hours diffce btw DT and RARPTENT, also used in RACUT(rahours)
"RTN","RARTUVR1",6,0)
BTG ; build tmp global
"RTN","RARTUVR1",7,0)
 N RAQT
"RTN","RARTUVR1",8,0)
 S RARE(0)=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RARTUVR1",9,0)
 S RADIVNUM=+$P(RARE(0),U,3),RADIVNME=$P($G(^DIC(4,RADIVNUM,0)),U)
"RTN","RARTUVR1",10,0)
 I RADIVNME]"",('$D(^TMP($J,"RA D-TYPE",RADIVNME))) Q
"RTN","RARTUVR1",11,0)
 S RADIVNME=$S(RADIVNME]"":RADIVNME,1:"Unknown")
"RTN","RARTUVR1",12,0)
 S RAITNUM=+$P(RARE(0),U,2),RAITNAME=$P($G(^RA(79.2,RAITNUM,0)),U)
"RTN","RARTUVR1",13,0)
 I RAITNAME]"",('$D(^TMP($J,"RA I-TYPE",RAITNAME))) Q
"RTN","RARTUVR1",14,0)
 S RAITNAME=$S(RAITNAME]"":RAITNAME,1:"Unknown")
"RTN","RARTUVR1",15,0)
 K RARE(0)
"RTN","RARTUVR1",16,0)
 Q:'$D(^TMP($J,"RAUVR",RADIVNME,RAITNAME))
"RTN","RARTUVR1",17,0)
 S RAQT=0 ; RAQT set to 1 if this report has already been counted
"RTN","RARTUVR1",18,0)
 I RAIP["R" D INC("R") Q:RAQT
"RTN","RARTUVR1",19,0)
 I RAIP["S" D INC("S") Q:RAQT
"RTN","RARTUVR1",20,0)
 I RAIP="U" D INC("U") Q:RAQT
"RTN","RARTUVR1",21,0)
 S ^TMP($J,"RAUVR",RADIVNME,RAITNAME)=$G(^TMP($J,"RAUVR",RADIVNME,RAITNAME))+1
"RTN","RARTUVR1",22,0)
 Q
"RTN","RARTUVR1",23,0)
INC(RATYP) ; Increment count for Resident, Staff or Unknown
"RTN","RARTUVR1",24,0)
 ;
"RTN","RARTUVR1",25,0)
 N RA1
"RTN","RARTUVR1",26,0)
 S RATYP=$E($G(RATYP))
"RTN","RARTUVR1",27,0)
 S RAIPNAME=$S(RATYP="R":RAPRES,RATYP="S":RAPSTF,1:"")
"RTN","RARTUVR1",28,0)
 S:RAIPNAME'="" RAIPNAME=$$GET1^DIQ(200,RAIPNAME_",",.01)
"RTN","RARTUVR1",29,0)
 S:RAIPNAME="" RAIPNAME="UNKNOWN"
"RTN","RARTUVR1",30,0)
 ; If report on ASTAT x-ref for 2 report statuses, then it will be
"RTN","RARTUVR1",31,0)
 ; counted twice. Check if dealt with already. If so, QUIT
"RTN","RARTUVR1",32,0)
 I $D(^TMP($J,RADIVNME,RAITNAME,RATYP,RAIPNAME,RARPT)) S RAQT=1 Q
"RTN","RARTUVR1",33,0)
 S ^TMP($J,RADIVNME,RAITNAME,RATYP,RAIPNAME,RARPT)=$G(RADFN)_U_$G(RADTI)_U_$G(RACNI)
"RTN","RARTUVR1",34,0)
 S ^TMP($J,RADIVNME,RAITNAME,RATYP,RAIPNAME)=$G(^TMP($J,RADIVNME,RAITNAME,RATYP,RAIPNAME))+1
"RTN","RARTUVR1",35,0)
 S RA1=$S(RATYP="R":"RESCNT",RATYP="S":"STFCNT",1:"UNKCNT")
"RTN","RARTUVR1",36,0)
 S ^TMP($J,RADIVNME,RAITNAME,RA1)=$G(^TMP($J,RADIVNME,RAITNAME,RA1))+1
"RTN","RARTUVR1",37,0)
 Q:'$D(RARPTENT)
"RTN","RARTUVR1",38,0)
 S RAHOURS=$$FMDIFF^XLFDT(DT,RARPTENT,2)/3600
"RTN","RARTUVR1",39,0)
 S RAHOURS=$S(RAHOURS<RACUT(1):1,RAHOURS<RACUT(2):2,RAHOURS<RACUT(3):3,1:4)
"RTN","RARTUVR1",40,0)
 S ^TMP($J,RADIVNME,RAITNAME,RATYP,RAIPNAME,"H",RAHOURS)=$G(^TMP($J,RADIVNME,RAITNAME,RATYP,RAIPNAME,"H",RAHOURS))+1
"RTN","RARTUVR1",41,0)
 S ^TMP($J,RADIVNME,RAITNAME,"H",RAHOURS,RARPT)=$G(^TMP($J,RADIVNME,RAITNAME,"H",RAHOURS,RARPT))+1
"RTN","RARTUVR1",42,0)
 Q
"RTN","RARTUVR1",43,0)
 ;
"RTN","RARTUVR1",44,0)
PHYS ;print other staff and residents
"RTN","RARTUVR1",45,0)
 N RA2ND,R1,R2,RASTR
"RTN","RARTUVR1",46,0)
 S (R1,R2)=0 F  S R2=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",R2)) Q:'R2  S:+$G(^(R2,0)) R1=R1+1,RA2ND("SRR",R1)=+^(0),RA2ND("SRR",R1)=$E($$GET1^DIQ(200,RA2ND("SRR",R1)_",",.01),1,20)
"RTN","RARTUVR1",47,0)
 S (R1,R2)=0 F  S R2=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",R2)) Q:'R2  S:+$G(^(R2,0)) R1=R1+1,RA2ND("SSR",R1)=+^(0),RA2ND("SSR",R1)=$E($$GET1^DIQ(200,RA2ND("SSR",R1)_",",.01),1,20)
"RTN","RARTUVR1",48,0)
 S R1=$E($$GET1^DIQ(200,+$P(Y(0),"^",15)_",",.01),1,15) ; prim staff
"RTN","RARTUVR1",49,0)
 S RASTR="Other Att/Res: "
"RTN","RARTUVR1",50,0)
 S:RAIPNAME'[R1 RASTR=RASTR_R1
"RTN","RARTUVR1",51,0)
PHYS1 I '$O(RA2ND("SSR",0)) G PHYS2
"RTN","RARTUVR1",52,0)
 S R1=0
"RTN","RARTUVR1",53,0)
PHYS11 S R1=$O(RA2ND("SSR",R1)) G:R1="" PHYS2
"RTN","RARTUVR1",54,0)
 G:RAIPNAME[RA2ND("SSR",R1) PHYS11 ;omit if name matches current staff/resid/unkn
"RTN","RARTUVR1",55,0)
 I $L(RASTR)+$L(RA2ND("SSR",R1))>IOM W !,RASTR,"; " S RASTR="   "
"RTN","RARTUVR1",56,0)
 S:RASTR]"   " RASTR=RASTR_"; " S RASTR=RASTR_RA2ND("SSR",R1) G PHYS11
"RTN","RARTUVR1",57,0)
PHYS2 S R1=$E($$GET1^DIQ(200,+$P(Y(0),"^",12)_",",.01),1,15) ;prim resid
"RTN","RARTUVR1",58,0)
 I RAIPNAME[R1 G PHYS20 ;omit if name matches current staff/resid/unk
"RTN","RARTUVR1",59,0)
 I $L(RASTR)+$L(R1)>IOM W !,RASTR,"; " S RASTR="   "
"RTN","RARTUVR1",60,0)
 S:RASTR]"   " RASTR=RASTR_"; " S RASTR=RASTR_R1
"RTN","RARTUVR1",61,0)
PHYS20 I '$O(RA2ND("SRR",0)) W !,RASTR Q
"RTN","RARTUVR1",62,0)
 S R1=0
"RTN","RARTUVR1",63,0)
PHYS21 S R1=$O(RA2ND("SRR",R1)) G:R1="" PHYS29
"RTN","RARTUVR1",64,0)
 G:RAIPNAME[RA2ND("SRR",R1) PHYS21 ;omit if name matches current staff/resident/unkn
"RTN","RARTUVR1",65,0)
 I $L(RASTR)+$L(RA2ND("SRR",R1))>IOM W !,RASTR,"; " S RASTR="   "
"RTN","RARTUVR1",66,0)
 S:RASTR]"   " RASTR=RASTR_"; " S RASTR=RASTR_RA2ND("SRR",R1) G PHYS21
"RTN","RARTUVR1",67,0)
PHYS29 W:RASTR]"   " !,RASTR
"RTN","RARTUVR1",68,0)
 Q
"RTN","RARTUVR1",69,0)
DIVSUM ;division summary -- skip if only one imaging type chosen for this div
"RTN","RARTUVR1",70,0)
 Q:$O(^TMP($J,"RAUVR",RADIVNME,0))=$O(^TMP($J,"RAUVR",RADIVNME,""),-1)
"RTN","RARTUVR1",71,0)
 N RA2ND  ;reuse this local array
"RTN","RARTUVR1",72,0)
 I RACNT(0)'<RACNT S RAOUT=$$EOS^RAUTL5() Q:RAOUT  ;before last screen
"RTN","RARTUVR1",73,0)
 W:$Y>0 @IOF W !?$S(IOM<81:20,1:IOM-90),">>>>> Unverified Reports (",$S(RABD="B":"brief",1:"detailed"),") <<<<<" S RAPAGE=RAPAGE+1 W ?$S(IOM<81:70,1:IOM-10),"Page: ",RAPAGE
"RTN","RARTUVR1",74,0)
 W !,"Division: ",?10,RADIVNME,?$S(IOM<81:43,1:IOM-37),"Report Date Range:",?$S(IOM<81:62,1:IOM-18),$$FMTE^XLFDT(BEGDATE),!?$S(IOM<81:62,1:IOM-18),$$FMTE^XLFDT(ENDDATE)
"RTN","RARTUVR1",75,0)
 W !,"Imaging Type(s): "
"RTN","RARTUVR1",76,0)
 S RA1="" F  S RA1=$O(^TMP($J,"RAUVR",RADIVNME,RA1)) Q:RA1=""  W:($L(RA1)+3+$X)>IOM !?17 W RA1,"   "
"RTN","RARTUVR1",77,0)
 W !!,"Run Date: ",RARUNDAT
"RTN","RARTUVR1",78,0)
 W !!!?26,"Division Summary",!?26,$E(RADASH,1,16)
"RTN","RARTUVR1",79,0)
 D HOURAGE^RARTUVR2
"RTN","RARTUVR1",80,0)
 S RA1=0 F  S RA1=$O(^TMP($J,RADIVNME,RA1)) Q:RA1=""  D
"RTN","RARTUVR1",81,0)
 .S RA2="" F  S RA2=$O(^TMP($J,RADIVNME,RA1,"H",RA2)) Q:RA2=""  D
"RTN","RARTUVR1",82,0)
 ..S RA3="" F  S RA3=$O(^TMP($J,RADIVNME,RA1,"H",RA2,RA3)) Q:RA3=""  D
"RTN","RARTUVR1",83,0)
 ...S RA2ND(RA2)=$G(RA2ND(RA2))+1
"RTN","RARTUVR1",84,0)
 W !!,"Total Unverified Reports: "
"RTN","RARTUVR1",85,0)
 W ?29,$S($G(RA2ND(1)):$J(RA2ND(1),$L(RACUT(3))),1:$J(0,$L(RACUT(3)))),?39,$S($G(RA2ND(2)):$J(RA2ND(2),$L(RACUT(3))),1:$J(0,$L(RACUT(3))))
"RTN","RARTUVR1",86,0)
 W ?49,$S($G(RA2ND(3)):$J(RA2ND(3),$L(RACUT(3))),1:$J(0,$L(RACUT(3)))),?59,$S($G(RA2ND(4)):$J(RA2ND(4),$L(RACUT(3))+2),1:$J(0,$L(RACUT(3))+2))
"RTN","RARTUVR1",87,0)
 S RA1=0 F RA4=1:1:4 S RA1=RA1+$G(RA2ND(RA4))
"RTN","RARTUVR1",88,0)
 W !!,"Division Total: ",RA1,!!
"RTN","RARTUVR1",89,0)
 S RAOUT=$$EOS^RAUTL5()
"RTN","RARTUVR3")
0^25^B30058032^B29444708
"RTN","RARTUVR3",1,0)
RARTUVR3 ;HISC/GJC-Unverified Reports ;8/19/97  11:28
"RTN","RARTUVR3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56**;Mar 16, 1998;Build 3
"RTN","RARTUVR3",3,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RARTUVR3",4,0)
EN1 ; Entry point for unverified reports option when sort is on
"RTN","RARTUVR3",5,0)
 ; Exam Date or Pri. Inter. Staff
"RTN","RARTUVR3",6,0)
 ; Data Storage:
"RTN","RARTUVR3",7,0)
 ;  RABD="E":
"RTN","RARTUVR3",8,0)
 ;  ^TMP($J,"RAUVR",Division,Xam Date/Time,Patient,Case #)=print set? (1:yes, 0:no)_^_Pat ID_^_0 node of exam
"RTN","RARTUVR3",9,0)
 ;  RABD="S":
"RTN","RARTUVR3",10,0)
 ;  ^TMP($J,"RAUVR",Pri. Staff,Xam Date/Time,Patient,Case #)=print set? (1:yes, 0:no)_^_Pat ID_^_0 node of exam
"RTN","RARTUVR3",11,0)
 K ^TMP($J,"RAUVR") S (RAOUT,RAPAGE)=0,RASTATUS=""
"RTN","RARTUVR3",12,0)
 D:RABD="E" ZERO ; zero out totals for division data
"RTN","RARTUVR3",13,0)
 S RADTE=BEGDATE-.0001
"RTN","RARTUVR3",14,0)
 F  S RADTE=$O(^RADPT("AR",RADTE)) Q:RADTE'>0!(RADTE>ENDDATE)!(RAOUT)  D
"RTN","RARTUVR3",15,0)
 . S RADFN=0
"RTN","RARTUVR3",16,0)
 . F  S RADFN=$O(^RADPT("AR",RADTE,RADFN)) Q:RADFN'>0!(RAOUT)  D
"RTN","RARTUVR3",17,0)
 .. S RADTI=0
"RTN","RARTUVR3",18,0)
 .. F  S RADTI=$O(^RADPT("AR",RADTE,RADFN,RADTI)) Q:RADTI'>0!(RAOUT)  D
"RTN","RARTUVR3",19,0)
 ... S RACN=0
"RTN","RARTUVR3",20,0)
 ... F  S RACN=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN)) Q:RACN'>0!(RAOUT)  D
"RTN","RARTUVR3",21,0)
 .... S RACNI=+$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0)) Q:'RACNI
"RTN","RARTUVR3",22,0)
 .... S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTUVR3",23,0)
 .... Q:'+$P(RA7003,"^",17)  ; no report
"RTN","RARTUVR3",24,0)
 .... S RA74=$G(^RARPT(+$P(RA7003,"^",17),0))
"RTN","RARTUVR3",25,0)
 .... Q:$P(RA74,"^",5)=""  ; no status, skeletal rpt created by imaging
"RTN","RARTUVR3",26,0)
 .... Q:"^V^X^EF^"[("^"_$P(RA74,"^",5)_"^")  ;Skip Verified, Deleted, E-filed rpts
"RTN","RARTUVR3",27,0)
 .... I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAOUT=1 Q:RAOUT
"RTN","RARTUVR3",28,0)
 .... ; *****  check if user selected this division & imaging type  ****
"RTN","RARTUVR3",29,0)
 .... S RA7002=$G(^RADPT(RADFN,"DT",RADTI,0)) ; 0 node Reg. Exams sub-file
"RTN","RARTUVR3",30,0)
 .... S RADIVNME=$P($G(^DIC(4,+$P(RA7002,"^",3),0)),"^") ; dinum to file 4!
"RTN","RARTUVR3",31,0)
 .... S:RADIVNME="" RADIVNME="Unknown"
"RTN","RARTUVR3",32,0)
 .... Q:'$D(^TMP($J,"RA D-TYPE",RADIVNME))
"RTN","RARTUVR3",33,0)
 .... Q:'$D(^TMP($J,"RA I-TYPE",$P($G(^RA(79.2,+$P(RA7002,"^",2),0)),"^")))
"RTN","RARTUVR3",34,0)
 .... ;*****************************************************************
"RTN","RARTUVR3",35,0)
 .... S (RAMEMLOW,RAPRTSET,RAPSET)=0 D EN1^RAUTL20 ; mem of a printset?
"RTN","RARTUVR3",36,0)
 .... S:RAPRTSET RAPSET="1." S:RAMEMLOW RAPSET="1+"
"RTN","RARTUVR3",37,0)
 .... S RAPIS=$$GET1^DIQ(200,+$P(RA7003,"^",15)_",",.01)
"RTN","RARTUVR3",38,0)
 .... S:RAPIS="" RAPIS="Unknown"
"RTN","RARTUVR3",39,0)
 .... S RAPAT=$G(^DPT(RADFN,0))
"RTN","RARTUVR3",40,0)
 .... S RASSN=$$SSN^RAUTL() S:RASSN="" RASSN="Unknown"
"RTN","RARTUVR3",41,0)
 .... S RAPAT=$P(RAPAT,"^") S:RAPAT="" RAPAT="Unknown"
"RTN","RARTUVR3",42,0)
 .... ;*****************************************************************
"RTN","RARTUVR3",43,0)
 .... ; Store off the data into our TMP global.  First subscript is $J.
"RTN","RARTUVR3",44,0)
 .... ; Second subscript is: RABD="E", exam date.  I RABD="S", second
"RTN","RARTUVR3",45,0)
 .... ; subscript is Pri. Int'g Staff.  Other Subscripts: sub3-exam date,
"RTN","RARTUVR3",46,0)
 .... ; sub4-patient name, sub5-case number
"RTN","RARTUVR3",47,0)
 .... S:RABD="E" ^TMP($J,"RAUVR",RADIVNME,($P(RA7002,"^")\1),RAPAT,+$P(RA7003,"^"))=RAPSET_"^"_RASSN_"^"_RA7003
"RTN","RARTUVR3",48,0)
 .... S:RABD="S" ^TMP($J,"RAUVR",RAPIS,($P(RA7002,"^")\1),RAPAT,+$P(RA7003,"^"))=RAPSET_"^"_RASSN_"^"_RA7003
"RTN","RARTUVR3",49,0)
 .... S:RABD="E" ^TMP($J,"RAUVR",RADIVNME)=+$G(^TMP($J,"RAUVR",RADIVNME))+1
"RTN","RARTUVR3",50,0)
 .... ;*****************************************************************
"RTN","RARTUVR3",51,0)
 .... Q
"RTN","RARTUVR3",52,0)
 ... Q
"RTN","RARTUVR3",53,0)
 .. Q
"RTN","RARTUVR3",54,0)
 . Q
"RTN","RARTUVR3",55,0)
 S:RABD="S" RAHD="UNVERIFIED IMAGING REPORTS BY PRIMARY INTERPRETING STAFF"
"RTN","RARTUVR3",56,0)
 S:RABD="E" RAHD="UNVERIFIED IMAGING REPORTS BY DIVISION"
"RTN","RARTUVR3",57,0)
 S $P(RADASH,"-",(IOM+1))=""
"RTN","RARTUVR3",58,0)
 I '$D(^TMP($J,"RAUVR")) D  Q
"RTN","RARTUVR3",59,0)
 . N RA1,RANODATA S RANODATA="*** No Unverified Reports ***",RA1=""
"RTN","RARTUVR3",60,0)
 . I RABD="S" D HDR W !!?(IOM-$L(RANODATA)\2),RANODATA
"RTN","RARTUVR3",61,0)
 . I RABD="E" D
"RTN","RARTUVR3",62,0)
 .. N RA1
"RTN","RARTUVR3",63,0)
 .. S RA1="" F  S RA=$O(^TMP($J,"RA D-TYPE",RA1)) Q:RA1=""  D  Q:RAOUT
"RTN","RARTUVR3",64,0)
 ... D HDR
"RTN","RARTUVR3",65,0)
 ... S RANODATA="*** No Unverified Reports for division: "_RA1_" ***"
"RTN","RARTUVR3",66,0)
 ... W !!?(IOM-$L(RANODATA)\2),RANODATA
"RTN","RARTUVR3",67,0)
 ... S:$O(^TMP($J,"RA D-TYPE",RA1))]"" RAOUT=$$EOS^RAUTL5()
"RTN","RARTUVR3",68,0)
 ... Q
"RTN","RARTUVR3",69,0)
 .. Q
"RTN","RARTUVR3",70,0)
 . Q
"RTN","RARTUVR3",71,0)
 D GETDATA
"RTN","RARTUVR3",72,0)
KILL ; cleanup symbol table
"RTN","RARTUVR3",73,0)
 K RA7002,RA7003,RA74,RACSE,RAEXDT,RAHD,RAMEMLOW,RANODE,RAPAT,RAPIS
"RTN","RARTUVR3",74,0)
 K RAPRC,RAPRTSET,RAPSET,RAXSTAT
"RTN","RARTUVR3",75,0)
 Q
"RTN","RARTUVR3",76,0)
HDR ; header code
"RTN","RARTUVR3",77,0)
 W:$Y @IOF ; clear screen if not at top-of-page
"RTN","RARTUVR3",78,0)
 S RAPAGE=RAPAGE+1 W !?(IOM-$L(RAHD)\2),RAHD
"RTN","RARTUVR3",79,0)
 W !,$S(RABD="S":"Primary Interpreting Staff: ",1:"Division: "),RA1
"RTN","RARTUVR3",80,0)
 W ?94,$$FMTE^XLFDT(DT,"1P")_"   Page: "_RAPAGE
"RTN","RARTUVR3",81,0)
 W !,?87,"Exam",?96,"Report",!,"Patient",?21,"Patient ID",?38,"Exam Date",?48,"Case",?55,"Procedure",?87,"Status",?96,"Entered",?106,"Pri. Int'g Staff"
"RTN","RARTUVR3",82,0)
 W !,RADASH
"RTN","RARTUVR3",83,0)
 Q
"RTN","RARTUVR3",84,0)
GETDATA ; get to the data
"RTN","RARTUVR3",85,0)
 S RA1="",(RAPAGE,RAOUT)=0
"RTN","RARTUVR3",86,0)
 F  S RA1=$O(^TMP($J,"RAUVR",RA1)) Q:RA1=""  D  Q:RAOUT
"RTN","RARTUVR3",87,0)
 . D HDR S RAEXDT=0
"RTN","RARTUVR3",88,0)
 . I RABD="E",$G(^TMP($J,"RAUVR",RA1))=0 D  Q
"RTN","RARTUVR3",89,0)
 .. S X="*** No Unverified Reports for division ***"
"RTN","RARTUVR3",90,0)
 .. W !!?(IOM-$L(X)\2),X
"RTN","RARTUVR3",91,0)
 .. S:$O(^TMP($J,"RAUVR",RA1))]"" RAOUT=$$EOS^RAUTL5()
"RTN","RARTUVR3",92,0)
 .. Q
"RTN","RARTUVR3",93,0)
 . F  S RAEXDT=$O(^TMP($J,"RAUVR",RA1,RAEXDT)) Q:RAEXDT'>0  D  Q:RAOUT
"RTN","RARTUVR3",94,0)
 .. S RAPAT=""
"RTN","RARTUVR3",95,0)
 .. F  S RAPAT=$O(^TMP($J,"RAUVR",RA1,RAEXDT,RAPAT)) Q:RAPAT=""  D  Q:RAOUT
"RTN","RARTUVR3",96,0)
 ... S RACSE=0
"RTN","RARTUVR3",97,0)
 ... F  S RACSE=$O(^TMP($J,"RAUVR",RA1,RAEXDT,RAPAT,RACSE)) Q:RACSE'>0  D  Q:RAOUT
"RTN","RARTUVR3",98,0)
 .... I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAOUT=1 Q:RAOUT
"RTN","RARTUVR3",99,0)
 .... S RANODE=$G(^TMP($J,"RAUVR",RA1,RAEXDT,RAPAT,RACSE))
"RTN","RARTUVR3",100,0)
 .... D PRTDATA
"RTN","RARTUVR3",101,0)
 .... Q
"RTN","RARTUVR3",102,0)
 ... Q
"RTN","RARTUVR3",103,0)
 .. Q
"RTN","RARTUVR3",104,0)
 . S:$O(^TMP($J,"RAUVR",RA1))]"" RAOUT=$$EOS^RAUTL5()
"RTN","RARTUVR3",105,0)
 . Q
"RTN","RARTUVR3",106,0)
 Q
"RTN","RARTUVR3",107,0)
PRTDATA ; print the data
"RTN","RARTUVR3",108,0)
 S RAPRC=$E($S($P(^RAMIS(71,+$P(RANODE,"^",4),0),"^")]"":$P(^(0),"^"),1:"Unknown"),1,30)
"RTN","RARTUVR3",109,0)
 S:+$P(RANODE,"^") RAPRC=$TR($P(RANODE,"^"),"1","")_RAPRC
"RTN","RARTUVR3",110,0)
 S RAXSTAT=$E($S($P(^RA(72,+$P(RANODE,"^",5),0),"^")]"":$P(^(0),"^"),1:"Unknown"),1,7)
"RTN","RARTUVR3",111,0)
 S RARPTENT=$$FMTE^XLFDT(($P($G(^RARPT(+$P(RANODE,"^",19),0)),"^",6)\1),"2P")
"RTN","RARTUVR3",112,0)
 S:RABD="S" RAPIS=RA1
"RTN","RARTUVR3",113,0)
 S:RABD="E" RAPIS=$$GET1^DIQ(200,+$P(RANODE,"^",17)_",",.01)
"RTN","RARTUVR3",114,0)
 S:RAPIS="" RAPIS="Unknown"
"RTN","RARTUVR3",115,0)
 W !,$E(RAPAT,1,20),?21,$P(RANODE,"^",2),?38,$$FMTE^XLFDT(RAEXDT,"2P"),?48,RACSE,?55,RAPRC,?87,RAXSTAT,?96,RARPTENT,?106,$E(RAPIS,1,25)
"RTN","RARTUVR3",116,0)
 I $Y>(IOSL-4) S RAOUT=$$EOS^RAUTL5() D:'RAOUT HDR
"RTN","RARTUVR3",117,0)
 Q
"RTN","RARTUVR3",118,0)
ZERO ; set division totals to zero
"RTN","RARTUVR3",119,0)
 S X="" F  S X=$O(^TMP($J,"RA D-TYPE",X)) Q:X=""  S ^TMP($J,"RAUVR",X)=0
"RTN","RARTUVR3",120,0)
 Q
"RTN","RARTVER")
0^21^B44139865^B43178310
"RTN","RARTVER",1,0)
RARTVER ;HISC/FPT,CAH AISC/MJK,RMO-On-line Verify Reports ;11/19/97  13:52
"RTN","RARTVER",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,23,26,82,56**;Mar 16, 1998;Build 3
"RTN","RARTVER",3,0)
 ;Supported IA #10035 ^DPT(
"RTN","RARTVER",4,0)
 ;Supported IA #10060 ^VA(200
"RTN","RARTVER",5,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTVER",6,0)
 N RAVFIED,RAXIT S RAXIT=0
"RTN","RARTVER",7,0)
 K RAVER S:$D(^VA(200,DUZ,0)) RAVER=$P(^(0),"^") I '$D(RAVER) W !!,$C(7),"Your name must be defined in the NEW PERSON File to continue." G Q
"RTN","RARTVER",8,0)
 I '$D(^VA(200,"ARC","R",DUZ)),'$D(^VA(200,"ARC","S",DUZ)) W !!,$C(7),"This option is only available for Rad/Nuc Med Interpreting Physicians." G Q
"RTN","RARTVER",9,0)
 I '$$CHKUSR^RAO7UTL(DUZ) D ERR^RARTVER2(DUZ) D Q QUIT
"RTN","RARTVER",10,0)
 I $D(^VA(200,"ARC","S",DUZ)) S RASTAFF=1 G 1
"RTN","RARTVER",11,0)
 I $P(RAMDV,"^",18)'=1 W !!,$C(7),"Interpreting Residents are not allowed to verify reports.",!! G Q
"RTN","RARTVER",12,0)
1 S RAONLINE="" W ! D ES^RASIGU G Q:'%
"RTN","RARTVER",13,0)
 I $D(RASTAFF),$P($G(^VA(200,DUZ,"RA")),U,2)'="y" S RARAD=DUZ,RAD="ASTF",RARESFLG="" G SRTRPT ;selected USER does NOT have ALLOW VERIFYING OF OTHERS
"RTN","RARTVER",14,0)
 I '$D(^VA(200,"ARC","S",DUZ)),$S('$P(RAMDV,"^",18):1,'$D(^VA(200,"ARC","R",DUZ)):1,'$D(^VA(200,DUZ,"RA")):1,$P(^VA(200,DUZ,"RA"),"^",2)'="y":1,1:0) S RARAD=DUZ,RAD="ARES",RARESFLG="" G SRTRPT
"RTN","RARTVER",15,0)
ASKRAD W ! S DIC("B")=RAVER,DIC("S")="I $D(^VA(200,""ARC"",""R"",Y))!($D(^VA(200,""ARC"",""S"",Y)))",DIC("A")="Select Interpreting Physician: ",DIC="^VA(200,",DIC(0)="AEMQ" D ^DIC K DIC G Q:Y<0 S RARAD=+Y
"RTN","RARTVER",16,0)
 S RAD=$S($D(^VA(200,"ARC","R",RARAD)):"ARES",1:"ASTF")
"RTN","RARTVER",17,0)
 ;
"RTN","RARTVER",18,0)
SRTRPT K ^TMP($J,"RA"),RA,RARPTX
"RTN","RARTVER",19,0)
 S RARADHLD=RARAD,RATOT=0,RARPT=0
"RTN","RARTVER",20,0)
 ;tmp($j,"ra","dt",-,-) =
"RTN","RARTVER",21,0)
 ;^rpt status at start of selection^/long CN^Pat.ien^Proc.ien
"RTN","RARTVER",22,0)
 F  S RARPT=$O(^RARPT(RAD,RARAD,RARPT)) Q:'RARPT  I $D(^RARPT(RARPT,0)) S RARTDT=$S($P(^(0),"^",6)="":9999999.9999,1:$P(^(0),"^",6)) D
"RTN","RARTVER",23,0)
 .Q:$$STUB^RAEDCN1(RARPT)  ;skip stub report 081500
"RTN","RARTVER",24,0)
 .Q:"^V^EF^"[("^"_$P($G(^RARPT(+RARPT,0)),"^",5)_"^")  ;skip 'V' & "EF'
"RTN","RARTVER",25,0)
 .S Y=RARPT D RASET^RAUTL2 ;returns Y=radpt(radfn,"dt",radti,"p",-,0)
"RTN","RARTVER",26,0)
 .Q:'Y  ;record must be corrupt no zero node for ADC x-ref!!
"RTN","RARTVER",27,0)
 .S ^TMP($J,"RA","DT",RARTDT,RARPT)="^"_$P($G(^RARPT(+RARPT,0)),"^",5)_"^/"_$P(^(0),"^",1,2)_"^"_+$P(Y,U,2)
"RTN","RARTVER",28,0)
 .S RATOT=RATOT+1
"RTN","RARTVER",29,0)
 .Q
"RTN","RARTVER",30,0)
 I 'RATOT S RANM=$S($D(^VA(200,RARAD,0)):$P(^(0),"^"),1:"UNKNOWN"),RANM=$S(RANM=RAVER:"You have",1:"Interpreting Physician "_RANM_" has") W !!,RANM," no Unverified Reports." G Q:$D(RARESFLG),ASKRAD
"RTN","RARTVER",31,0)
 N RATOTORI S RATOTORI=RATOT ; save original value of RATOT
"RTN","RARTVER",32,0)
 ;
"RTN","RARTVER",33,0)
SELRPT I RATOT=1 D ONERPT^RARTVER1 G:'$D(^TMP($J,"RA")) Q S RACHOICE=5,RACHOICE("1RPT")="" G RPTLP
"RTN","RARTVER",34,0)
 D TALLY^RARTVER1,SELRPT^RARTVER1 G Q:Y=0 S RACHOICE=+Y
"RTN","RARTVER",35,0)
 I Y=1 D PV^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",36,0)
 I Y=2 S RASTATUS="R" D DPDRNV^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",37,0)
 I Y=3 S RASTATUS="D" D DPDRNV^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",38,0)
 I Y=4 S RASTATUS="PD" D DPDRNV^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",39,0)
 I Y=5 G RPTLP
"RTN","RARTVER",40,0)
 I Y=7 D STAT^RARTVER1 G:RATOT'>0 SRTRPT G RPTLP
"RTN","RARTVER",41,0)
 ; if none of the above, then defaults to Y=6 SELECTED 
"RTN","RARTVER",42,0)
 S RASTATFG="" D ^RARTVER1 K RASTATFG G Q:$D(RAOUT)!('$D(RARPTX))
"RTN","RARTVER",43,0)
 ;
"RTN","RARTVER",44,0)
RPTLP S DIR(0)="S^P:PAGE AT A TIME;E:ENTIRE REPORT",DIR("B")="P",DIR("A")="How would you like to view the reports?"
"RTN","RARTVER",45,0)
 S DIR("?",1)="If you would like to pause after each page of the report enter 'P'.",DIR("?")="Otherwise enter 'E' to view an entire report at one time."
"RTN","RARTVER",46,0)
 D ^DIR K DIR G Q:$D(DIRUT) I Y="E" S RARTVERF=1
"RTN","RARTVER",47,0)
 S RACHOICE("NAME")=$S(RACHOICE=6:"SELECTED",RACHOICE=5:"ALL",RACHOICE=4:"PROBLEM DRAFT",RACHOICE=3:"DRAFT",RACHOICE=2:"RELEASED/NOT VERIFIED",1:"PREVERIFIED")
"RTN","RARTVER",48,0)
RPTLP1 I $D(^TMP($J,"RA","DT")) S RARPT=0,RARTDT=0 F  S RARTDT=$O(^TMP($J,"RA","DT",RARTDT)) Q:'RARTDT  S RARDX="" D GETRPT Q:RARDX="^"  I $D(RARLTV),$G(RARLTV)=0 D ADDLRPT^RARTVER2 Q:RATOT=0  S RARLTV=RATOT G RPTLP1
"RTN","RARTVER",49,0)
 I $D(^TMP($J,"RA","XREF")) S (RPTX,RARPT)=0 D GETRPT
"RTN","RARTVER",50,0)
 ; RARESFLG  is used to flag that  VERIFYING OF OTHERS  is allowed
"RTN","RARTVER",51,0)
 ; Before looping back, RARESFLG is set, so that if there are no reports,
"RTN","RARTVER",52,0)
 ; the logic will goto Q instead of to ASKRAD
"RTN","RARTVER",53,0)
 I RATOTORI>1 S RARAD=RARADHLD,RARESFLG="" K RARLTV,RARTVERF G SRTRPT ; go another round
"RTN","RARTVER",54,0)
 ; also dis-allow re-asking another USER when all reports
"RTN","RARTVER",55,0)
 ; become verified by current USER
"RTN","RARTVER",56,0)
 ;
"RTN","RARTVER",57,0)
Q D CU^RARTVER2
"RTN","RARTVER",58,0)
 Q
"RTN","RARTVER",59,0)
 ;
"RTN","RARTVER",60,0)
GETRPT I $G(RARPT) L -^RARPT(RARPT)
"RTN","RARTVER",61,0)
 S:$D(^TMP($J,"RA","XREF")) RPTX=RPTX+1 S RARPT=$S($D(^TMP($J,"RA","DT")):$O(^TMP($J,"RA","DT",RARTDT,RARPT)),$D(^TMP($J,"RA","XREF")):+$G(RARPTX(RPTX)),1:0) Q:'RARPT
"RTN","RARTVER",62,0)
 I $D(^TMP($J,"RA","DT")) G:$P(^TMP($J,"RA","DT",RARTDT,RARPT),"^")="V" GETRPT S $P(^TMP($J,"RA","DT",RARTDT,RARPT),"^")="V" ;here, V = viewed already
"RTN","RARTVER",63,0)
 I '$D(^RARPT(RARPT)) D MSG1 G GETRPT ;rpt disappeared
"RTN","RARTVER",64,0)
 L +^RARPT(RARPT):2 I '$T G LOCK^RARTVER2
"RTN","RARTVER",65,0)
 S RAXIT=0 D DISRPT^RARTVER2 I $G(X)="^" S RARDX="^" Q  ;display whole report
"RTN","RARTVER",66,0)
 I +$G(RAVFIED) S RAVFIED=0 G GETRPT
"RTN","RARTVER",67,0)
 N RASTBEF S RASTBEF=$S($D(^TMP($J,"RA","DT",+$G(RARTDT),+$G(RARPT))):$P(^(RARPT),"^",2),$D(^TMP($J,"RA","XREF")):$P($G(RARPTX(RPTX)),U,2),1:"")
"RTN","RARTVER",68,0)
ASK Q:RAXIT  W ! S I="",$P(I,"=",80)="" W I K I
"RTN","RARTVER",69,0)
 I "12345"[$E(RACHOICE) D:'$D(RARLTVFL) RLTV^RARTVER1 D:$D(RARLTVFL) RLTV1^RARTVER1
"RTN","RARTVER",70,0)
 S RARD("A")="",RARD(1)="Print^print this report for editing",RARD(2)="Edit^edit this report",RARD(3)="Top^display the report from the beginning",RARD(4)="continue^continue normal processing"
"RTN","RARTVER",71,0)
 S RARD(5)="Status & Print^edit Status, then print report",RARD(0)="S",RARD("B")=4
"RTN","RARTVER",72,0)
 S:$G(RARLTV) RARLTV=RARLTV-1
"RTN","RARTVER",73,0)
 I $G(RARLTV)>0 S RARD("A")="("_$G(RARLTV)_" left to review) "
"RTN","RARTVER",74,0)
 I $G(RARLTV)=0 I '$D(RACHOICE("1RPT")) S RARD("A")="(No more "_RACHOICE("NAME")_") " S:RACHOICE=5 RARD("A")="(ALL gone) "
"RTN","RARTVER",75,0)
 S RARD("A")=RARD("A")_"Type '?' for action list, 'Enter' to " ;12/30/96
"RTN","RARTVER",76,0)
 I RASTBEF'=$P(^RARPT(RARPT,0),U,5) D MSG2
"RTN","RARTVER",77,0)
 D SET^RARD K RARD S RARDX=$E(X) I RARDX="^" L -^RARPT(RARPT) Q
"RTN","RARTVER",78,0)
 ; if user chose "T"op, the report will be displayed again from the top
"RTN","RARTVER",79,0)
 I "PT"[RARDX D PRTRPT^RARTVER2:RARDX="P",DISRPT^RARTVER2:RARDX="T" G ASK
"RTN","RARTVER",80,0)
 I RARDX="E" D EDTCHK^RARTVER2 I RARDX="E" W !!,"EDITING REPORT",!,"--------------",! D EDTRPT^RARTE1 D  K RAAB G ASK
"RTN","RARTVER",81,0)
 .; RAHLTCPB flag is inactive
"RTN","RARTVER",82,0)
 .N RAHLTCPB S RAHLTCPB=1 D:RACT="V" UPSTAT^RAUTL0 D:RACT'="V" UP1^RAUTL1
"RTN","RARTVER",83,0)
 S RAPGM="GETRPT^RARTVER" G 31^RART ;goto Verify Report Only template
"RTN","RARTVER",84,0)
 ;
"RTN","RARTVER",85,0)
MSG1 N I,J1,J2,J3 S I=$S($D(^TMP($J,"RA","DT",+$G(RARTDT),+$G(RARPT))):^(RARPT),$D(^TMP($J,"RA","XREF")):$G(RARPTX(RPTX)),1:"")
"RTN","RARTVER",86,0)
 S J1=$P(I,"/",2),J2=$P(J1,"^",2),J3=$P(J1,"^",3),J1=$P(J1,"^")
"RTN","RARTVER",87,0)
 W !!!?15,$C(7),"Since the time you selected this group of reports,",!?15,"another user has deleted this report for",!?15,$P($G(^DPT(J2,0)),"^"),"   case ",J1,!?15,"Procedure ",$P($G(^RAMIS(71,+J3,0)),U),".",!! G CONT Q
"RTN","RARTVER",88,0)
MSG2 N I,J S I=";"_$P(^RARPT(RARPT,0),"^",5)_":"
"RTN","RARTVER",89,0)
 S J=";"_$P(^DD(74,5,0),U,3)
"RTN","RARTVER",90,0)
 W !!!?15,$C(7),"Since the time you selected this group of reports,",!?15,"another user has changed this report's status to '",$P($P(J,I,2),";"),"'.",!! Q
"RTN","RARTVER",91,0)
CONT W !! S DIR(0)="FO",DIR("A")="Press return key to continue " D ^DIR
"RTN","RARTVER",92,0)
 Q
"RTN","RASTREQ")
0^22^B50319772^B45271295
"RTN","RASTREQ",1,0)
RASTREQ ;HISC/CAH,GJC AISC/MJK-Status Requirements Check Routine ;6/3/98  09:56
"RTN","RASTREQ",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,10,23,40,56**;Mar 16, 1998;Build 3
"RTN","RASTREQ",3,0)
 ;Supported IA #10104 UP^XLFSTR
"RTN","RASTREQ",4,0)
 ;Supported IA #1367 LKUP^XPDKEY
"RTN","RASTREQ",5,0)
 ;Supported IA #10060 ^VA(200
"RTN","RASTREQ",6,0)
 ;Supported IA #10076 ^XUSEC(
"RTN","RASTREQ",7,0)
 ; Called by 
"RTN","RASTREQ",8,0)
 ; (1) Stat Track's [RA STATUS CHANGE]'s fld EXAM STATUS' input transform
"RTN","RASTREQ",9,0)
 ; (2) ASK+22^RASTED, if user "^" out of stat trk editing
"RTN","RASTREQ",10,0)
 ; (3) Cancel an Exam's [RA CANCEL]'s fld EXAM STATUS' input transform
"RTN","RASTREQ",11,0)
 ; (4) Enter Last Past Visit Before DHCP's [RA LAST PAST VISIT]'s ""
"RTN","RASTREQ",12,0)
 ;
"RTN","RASTREQ",13,0)
 ; Instead of using RAIMGTY, recalculate
"RTN","RASTREQ",14,0)
 ; the imaging type using the imaging type on the exam node because
"RTN","RASTREQ",15,0)
 ; status updating through report entry/edit, batch verify, and several
"RTN","RASTREQ",16,0)
 ; other options is NOT screened by sign-on imaging type, so does not
"RTN","RASTREQ",17,0)
 ; stay the same through a user's session.
"RTN","RASTREQ",18,0)
 ;
"RTN","RASTREQ",19,0)
 ; 'RAMES1' is used to display which Exam Status required fields are
"RTN","RASTREQ",20,0)
 ; not populated.  This only applies to the 'Status Tracking Of Exams'
"RTN","RASTREQ",21,0)
 ; option.
"RTN","RASTREQ",22,0)
 ;
"RTN","RASTREQ",23,0)
 ; If tracking ^-out, this rtn would be called outside of edt tmpl,
"RTN","RASTREQ",24,0)
 ; and thus the DA vars would not be defined, so we need to set them here
"RTN","RASTREQ",25,0)
 ;
"RTN","RASTREQ",26,0)
 S:'$D(DA)#2 DA=RACNI S:'$D(DA(1))#2 DA(1)=RADTI S:'$D(DA(2))#2 DA(2)=RADFN
"RTN","RASTREQ",27,0)
 ; If Fileman enter/edit, we need to define RADFN, RADTI, RACNI so the
"RTN","RASTREQ",28,0)
 ; nuc med checks won't bomb
"RTN","RASTREQ",29,0)
 S:'$D(RACNI)#2 RACNI=DA S:'$D(RADTI)#2 RADTI=DA(1) S:'$D(RADFN)#2 RADFN=DA(2)
"RTN","RASTREQ",30,0)
 ;
"RTN","RASTREQ",31,0)
 S RAIMGTYI=+$P($G(^RADPT(DA(2),"DT",DA(1),0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U,1),RASAVTYJ=RAIMGTYJ
"RTN","RASTREQ",32,0)
 S RAMES1="W:$G(K)=$P($G(^RA(72,+$G(RANXT72),0)),U,3)&('$D(ZTQUEUED)#2) !?3,""No '"",RAZ,""'"",?35,"" entered for this exam.""" ; display if at the ranext exm stat level
"RTN","RASTREQ",33,0)
 S RAXX=+$G(X)
"RTN","RASTREQ",34,0)
 I '$D(^RA(72,RAXX,0))!(RAIMGTYJ']"") D  Q
"RTN","RASTREQ",35,0)
 . K X W:'$D(ZTQUEUED)#2 !?3,"Error: cannot determine Imaging Type of exam.  Contact IRM."
"RTN","RASTREQ",36,0)
 . K RAMES1,RAXX
"RTN","RASTREQ",37,0)
 . Q
"RTN","RASTREQ",38,0)
 N RA,RASN,RASTI,RADES,RAOKAY,RA3
"RTN","RASTREQ",39,0)
 ; RADES = order seq. desired, RAOKAY= actual order seq. okay'd
"RTN","RASTREQ",40,0)
 S X1=$G(^RA(72,RAXX,0)),RADES=$P(X1,U,3)
"RTN","RASTREQ",41,0)
 I $$LKUP^XPDKEY(+$P(X1,"^",4))]"",'$D(^XUSEC($$LKUP^XPDKEY(+$P(X1,"^",4)),DUZ)) K X W:'$D(ZTQUEUED)#2 !?3,"You do not have the proper access privileges to ",!?3,"change this exam to this status" Q
"RTN","RASTREQ",42,0)
 S RAJ=^RADPT(DA(2),"DT",DA(1),"P",DA,0),RAOR=-1
"RTN","RASTREQ",43,0)
 S RABEFORE=$P($G(^RA(72,+$P(RAJ,U,3),0)),U,3) ; current order seq
"RTN","RASTREQ",44,0)
 ; Don't need to set RAORDIFN,RACS,RAPRIT,RAF5
"RTN","RASTREQ",45,0)
 I '$D(^RA(72,"AA",RAIMGTYJ,0,RAXX)) D LOOP^RASTREQ1 S RAIMGTYJ=RASAVTYJ
"RTN","RASTREQ",46,0)
 I $D(^RA(72,"AA",RAIMGTYJ,0,RAXX)) D CANCEL^RASTREQ1
"RTN","RASTREQ",47,0)
 S RAIMGTYJ=RASAVTYJ
"RTN","RASTREQ",48,0)
 ; Can't use X to determine if status change to next was successful
"RTN","RASTREQ",49,0)
 ; due to looping thru all status levels for this img type
"RTN","RASTREQ",50,0)
 ; chk if calculated order is at NEXT or higher level
"RTN","RASTREQ",51,0)
 ; RAAFTER is set in rastreq1; it has 2 meanings :
"RTN","RASTREQ",52,0)
 ;   upon return from rastreq1, RAAFTER means highest seq order qualified
"RTN","RASTREQ",53,0)
 ;   upon exit from this rtn,   RAAFTER means actual seq order used
"RTN","RASTREQ",54,0)
 I RABEFORE<RAAFTER D  G MSG
"RTN","RASTREQ",55,0)
 . I RADES<RAAFTER S RAOKAY=RADES
"RTN","RASTREQ",56,0)
 . E  S RAOKAY=RAAFTER
"RTN","RASTREQ",57,0)
 . Q
"RTN","RASTREQ",58,0)
 I RAAFTER<RABEFORE D  G MSG
"RTN","RASTREQ",59,0)
 . I RADES<RAAFTER S RAOKAY=RADES
"RTN","RASTREQ",60,0)
 . E  S RAOKAY=RAAFTER
"RTN","RASTREQ",61,0)
 . Q
"RTN","RASTREQ",62,0)
 ; at this point RAAFTER=RABEFORE
"RTN","RASTREQ",63,0)
 I RADES<RAAFTER S RAOKAY=RADES
"RTN","RASTREQ",64,0)
 E  S RAOKAY=RABEFORE
"RTN","RASTREQ",65,0)
MSG I RAOKAY=RABEFORE K X W:'$D(ZTQUEUED)#2 !?5," ...exam status not changed" G KOUT2
"RTN","RASTREQ",66,0)
 S X=$O(^RA(72,"AA",RAIMGTYJ,RAOKAY,0))
"RTN","RASTREQ",67,0)
 S:$D(RANEXT) RANEXT=^RA(72,+X,0) ;set existing RANEXT to ok'd status
"RTN","RASTREQ",68,0)
 I RAOKAY<RABEFORE W:'$D(ZTQUEUED)#2 !?5," ...exam status backed down to '",$P($G(^RA(72,+X,0)),U),"'" G KOUT2
"RTN","RASTREQ",69,0)
 I RAOKAY<RADES W:'$D(ZTQUEUED)#2 !!?5," ...though upgraded, new status level (",$P($G(^RA(72,+$O(^RA(72,"AA",RAIMGTYJ,RAOKAY,0)),0)),U),")",!?5,"is not as high as the desired level (",$P($G(^RA(72,+$O(^RA(72,"AA",RAIMGTYJ,RADES,0)),0)),U),")",!
"RTN","RASTREQ",70,0)
KOUT1 ; check for higher qualifying status(es)
"RTN","RASTREQ",71,0)
 G:RAOKAY'<RAAFTER!(RAOKAY=9) KOUT2 S RA3=RAOKAY
"RTN","RASTREQ",72,0)
 W !!,"This case also qualifies for higher status(es) :",!
"RTN","RASTREQ",73,0)
 F  S RA3=$O(^RA(72,"AA",RAIMGTYJ,RA3)) Q:RA3=""  Q:RA3>RAAFTER  W:'$D(ZTQUEUED)#2 ?$X+4,$P($G(^RA(72,$O(^(RA3,0)),0)),U)
"RTN","RASTREQ",74,0)
 W:'$D(ZTQUEUED)#2 !!,"Since Status Tracking can only upgrade one status at a time,",!,"please edit this exam again.",!
"RTN","RASTREQ",75,0)
KOUT2 S RAAFTER=RAOKAY ;return as actual seq order used, not nec. highest
"RTN","RASTREQ",76,0)
 K RAIMGTYI,RAIMGTYJ,RAMES1,RAZ,RAXX,RAJ,RAS,RAK,RAE,X1,RASAVTYJ
"RTN","RASTREQ",77,0)
 Q
"RTN","RASTREQ",78,0)
 ;
"RTN","RASTREQ",79,0)
1 ;Technologist Check
"RTN","RASTREQ",80,0)
 N DIERR
"RTN","RASTREQ",81,0)
 S RA("TECH")="" I $O(^RADPT(DA(2),"DT",DA(1),"P",DA,"TC",0))>0 S RA("TECH")=+^($O(^(0)),0) S RA("TECH")=$$GET1^DIQ(200,RA("TECH")_",",.01)
"RTN","RASTREQ",82,0)
 I RA("TECH")']"" K X S RAZ="technologist" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",83,0)
 K RA("TECH") Q
"RTN","RASTREQ",84,0)
 ;
"RTN","RASTREQ",85,0)
2 ;Interpreting Physician Check
"RTN","RASTREQ",86,0)
 N DIERR
"RTN","RASTREQ",87,0)
 I $$GET1^DIQ(200,$P(RAJ,"^",12)_",",.01)="",$$GET1^DIQ(200,$P(RAJ,"^",15)_",",.01)="" K X S RAZ="interpreting staff or resident" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",88,0)
 Q
"RTN","RASTREQ",89,0)
 ;
"RTN","RASTREQ",90,0)
3 ;Detailed Procedure Check
"RTN","RASTREQ",91,0)
 S RAZ="detailed procedure" I '$D(^RAMIS(71,+$P(RAJ,"^",2),0)) K X X:$D(RAMES1) RAMES1 Q
"RTN","RASTREQ",92,0)
 S RAJ1=$G(^RAMIS(71,+$P(RAJ,"^",2),0)) I "DS"'[$P(RAJ1,"^",6) K X X:$D(RAMES1) RAMES1 Q
"RTN","RASTREQ",93,0)
 S RAZ="detailed procedure (no CPT code)" I $P(RAJ1,"^",9)']"" K X X:$D(RAMES1) RAMES1 Q
"RTN","RASTREQ",94,0)
 Q
"RTN","RASTREQ",95,0)
 ;
"RTN","RASTREQ",96,0)
4 ;Film Data Check
"RTN","RASTREQ",97,0)
 I '$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"F",0)) K X S RAZ="film data" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",98,0)
 Q
"RTN","RASTREQ",99,0)
 ;
"RTN","RASTREQ",100,0)
5 ;Diagnostic Code Check
"RTN","RASTREQ",101,0)
 I '$D(^RA(78.3,+$P(RAJ,"^",13),0)) K X S RAZ="diagnostic code" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",102,0)
 Q
"RTN","RASTREQ",103,0)
 ;
"RTN","RASTREQ",104,0)
6 ;Camera/Equipment/Room Check
"RTN","RASTREQ",105,0)
 S RAE=$S($D(RAMDV):$P(RAMDV,"^",9),1:1) I RAE,'$D(^RA(78.6,+$P(RAJ,"^",18),0)) K X S RAZ="camera/equip/room" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",106,0)
 Q
"RTN","RASTREQ",107,0)
 ;
"RTN","RASTREQ",108,0)
11 ;Report Entered and not just a stub rec for Img/PACS Check
"RTN","RASTREQ",109,0)
 I '$D(^RARPT(+$P(RAJ,"^",17),0)) G NORPT
"RTN","RASTREQ",110,0)
 ; since there's a rpt ptr, must check if the rpt is just a stub rpt
"RTN","RASTREQ",111,0)
 N RA17,RA0 ; use logic from RAREG
"RTN","RASTREQ",112,0)
 S RA17=+$P(RAJ,"^",17)
"RTN","RASTREQ",113,0)
 I $$STUB^RAEDCN1(RA17) G NORPT ; rpt is an image stub
"RTN","RASTREQ",114,0)
 Q
"RTN","RASTREQ",115,0)
NORPT ; either no report yet, or report is stub
"RTN","RASTREQ",116,0)
 K X S RAZ="report" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",117,0)
 Q
"RTN","RASTREQ",118,0)
 ;
"RTN","RASTREQ",119,0)
12 ;Report Verified Check
"RTN","RASTREQ",120,0)
 D 11:$P(RAS,"^",11)'="Y" I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)'="V" K X S RAZ="report verification" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",121,0)
 Q
"RTN","RASTREQ",122,0)
 ;
"RTN","RASTREQ",123,0)
16 ;Impression Entry Check
"RTN","RASTREQ",124,0)
 ; In Phase 1, for Elec. filed rpts, skip this even if div. param requires it
"RTN","RASTREQ",125,0)
 I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)="EF" Q
"RTN","RASTREQ",126,0)
 I $O(^RARPT(+$P(RAJ,"^",17),"I",0))'>0 K X S RAZ="impression" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",127,0)
 Q
"RTN","RASTREQ",128,0)
13 ;Procedure Modifers Check
"RTN","RASTREQ",129,0)
 I '$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"M",0)) K X S RAZ="procedure modifier" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",130,0)
 Q
"RTN","RASTREQ",131,0)
14 ;CPT Modifiers Check
"RTN","RASTREQ",132,0)
 I '$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CMOD",0)) K X S RAZ="CPT modifiers" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",133,0)
 Q
"RTN","RASTREQ",134,0)
 ;
"RTN","RASTREQ",135,0)
HELP ; Called from 'Help Text' node in DD(70.03,3,4).
"RTN","RASTREQ",136,0)
 N E,RA
"RTN","RASTREQ",137,0)
 S RAJ=$G(^RADPT(DA(2),"DT",DA(1),"P",DA,0))
"RTN","RASTREQ",138,0)
 S RAIMGTYI=+$P($G(^RADPT(DA(2),"DT",DA(1),0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U,1)
"RTN","RASTREQ",139,0)
 I RAIMGTYJ']"" W !,"ERROR:  Cannot determine imaging type of exam!" K FL,K,N,RAIMGTYI,RAIMGTYJ,RAS,RAJ Q
"RTN","RASTREQ",140,0)
 W !,"This exam meets the requirements for the following statuses:"
"RTN","RASTREQ",141,0)
 F K=0:0 S K=$O(^RA(72,"AA",RAIMGTYJ,K)) Q:K'>0  D
"RTN","RASTREQ",142,0)
 . S X="",E=+$O(^RA(72,"AA",RAIMGTYJ,K,0)) Q:E'>0
"RTN","RASTREQ",143,0)
 . I $D(^RA(72,E,0)) D
"RTN","RASTREQ",144,0)
 .. S RA(0)=$G(^RA(72,E,0)),N=$P(RA(0),U),RAS=$G(^RA(72,E,.1))
"RTN","RASTREQ",145,0)
 .. I $L(RAS) D HELP1 I $D(X) W !?10,N S FL="" ;removed D 3, done inside HELP1
"RTN","RASTREQ",146,0)
 .. Q
"RTN","RASTREQ",147,0)
 . Q
"RTN","RASTREQ",148,0)
 W:'$D(FL) !?10,"Does not meet the requirements of any status."
"RTN","RASTREQ",149,0)
 W ! K RAS,RAJ,N,K,FL,RAIMGTYI,RAIMGTYJ
"RTN","RASTREQ",150,0)
 Q
"RTN","RASTREQ",151,0)
HELP1 ; Called from 'HELP' above and 'STUFF^RASTREQ1'
"RTN","RASTREQ",152,0)
 ; 'RAJ' -> 0 node of the examination
"RTN","RASTREQ",153,0)
 ; 'E'   -> ien of the examination status
"RTN","RASTREQ",154,0)
 ; Both 'RAJ' & 'E' set in 'HELP' & 'STUFF^RASTREQ1'
"RTN","RASTREQ",155,0)
 N RADIO,RADIOUZD,RAS5 S RADIO=$S($G(^RA(72,E,.5))]"":$G(^(.5)),1:"N")
"RTN","RASTREQ",156,0)
 S:$P($G(^RA(79.2,+RAIMGTYI,0)),"^",5)="Y" RADIOUZD=""
"RTN","RASTREQ",157,0)
 ;
"RTN","RASTREQ",158,0)
 ; Phase 1 Outside Reporting 100% outside work, skip all except Diag. Code
"RTN","RASTREQ",159,0)
 I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)="EF" S RAS5=$P(RAS,U,5),RAS="",$P(RAS,U,5)=RAS5 K RADIOUZD
"RTN","RASTREQ",160,0)
 ;
"RTN","RASTREQ",161,0)
 F RAK=1:1 Q:$P(RAS,"^",RAK,99)']""  D:$P(RAS,"^",RAK)="Y" @RAK
"RTN","RASTREQ",162,0)
 I $D(X),$P(RAS,"^",3)'="Y",$D(^RA(72,"AA",RAIMGTYJ,9,E)) D 3
"RTN","RASTREQ",163,0)
 I $D(X),$P(RAS,"^",16)'="Y",$D(^RA(72,"AA",RAIMGTYJ,9,E)),$D(^RA(79,+$P(^RADPT(DA(2),"DT",DA(1),0),"^",3),.1)),$P(^(.1),"^",16)="Y" D 16
"RTN","RASTREQ",164,0)
 I $D(RADIOUZD) D  ;if Radiopharm Used, then check req'd NucMed flds
"RTN","RASTREQ",165,0)
 . D EN1^RASTREQN(RADIO,RAJ)
"RTN","RASTREQ",166,0)
 . I $D(X),($$UP^XLFSTR($P($G(^RA(72,E,.6)),"^",11)="Y")) D EN1^RADOSTIK(RADFN,RADTI,RACNI)
"RTN","RASTREQ",167,0)
 . Q
"RTN","RASTREQ",168,0)
 Q
"UP",74,74.01,-1)
74^L
"UP",74,74.01,0)
74.01
"UP",74,74.16,-2)
74^L
"UP",74,74.16,-1)
74.01^DELDX
"UP",74,74.16,0)
74.16
"UP",74,74.18,-2)
74^L
"UP",74,74.18,-1)
74.01^DELSTF
"UP",74,74.18,0)
74.18
"UP",74,74.19,-2)
74^L
"UP",74,74.19,-1)
74.01^DELRES
"UP",74,74.19,0)
74.19
"VER")
8.0^22.0
"^DD",74,74,.01,0)
DAY-CASE#^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>12!($L(X)<8)!'(X?6N1"-"1N.N) X
"^DD",74,74,.01,.1)
DATE AND CASE NUMBER OF EXAM
"^DD",74,74,.01,1,0)
^.1
"^DD",74,74,.01,1,1,0)
74^B
"^DD",74,74,.01,1,1,1)
S ^RARPT("B",$E(X,1,30),DA)=""
"^DD",74,74,.01,1,1,2)
K ^RARPT("B",$E(X,1,30),DA)
"^DD",74,74,.01,1,1,"%D",0)
^^1^1^2940518^
"^DD",74,74,.01,1,1,"%D",1,0)
     Regular 'B' cross reference assigned by FileMan.
"^DD",74,74,.01,1,2,0)
74^ABLTN^MUMPS
"^DD",74,74,.01,1,2,1)
Q
"^DD",74,74,.01,1,2,2)
D:+$G(RAPRG74) ^RABUL3 Q
"^DD",74,74,.01,1,2,3)
Do not delete.
"^DD",74,74,.01,1,2,"%D",0)
^^2^2^2941129^
"^DD",74,74,.01,1,2,"%D",1,0)
     This bulletin will be delivered to all the members of the RAD/NUC MED
"^DD",74,74,.01,1,2,"%D",2,0)
REPORT DELETION mail group when a report is deleted.
"^DD",74,74,.01,1,2,"DT")
2940204
"^DD",74,74,.01,3)
Answer must be 8-12 characters in length.  Format: 010196-354
"^DD",74,74,.01,10)
SYSTEM GENERATED
"^DD",74,74,.01,21,0)
^.001^4^4^3080208^^^^
"^DD",74,74,.01,21,1,0)
This field contains the date and case number of the imaging exam
"^DD",74,74,.01,21,2,0)
associated with this report.  The system fills in this field with
"^DD",74,74,.01,21,3,0)
information obtained from the 'RAD/NUC MED PATIENT' file (#70) according
"^DD",74,74,.01,21,4,0)
to the case number selected by the transcriptionist.
"^DD",74,74,.01,23,0)
^^4^4^3080208^
"^DD",74,74,.01,23,1,0)
Patch RA*5*56 replaces the actual deletion of a report with a change of 
"^DD",74,74,.01,23,2,0)
the report status to 'X'.  Thus the Radiology application does not 
"^DD",74,74,.01,23,3,0)
invoke routine RABUL3 via the kill logic, instead it invokes routine 
"^DD",74,74,.01,23,4,0)
RABUL3 via a new routine, RARTE7.
"^DD",74,74,.01,"DT")
2960828
"^DD",74,74,5,0)
REPORT STATUS^RSX^V:VERIFIED;R:RELEASED/NOT VERIFIED;PD:PROBLEM DRAFT;D:DRAFT;EF:ELECTRONICALLY FILED;X:DELETED;^0;5^D EN1^RAUTL4
"^DD",74,74,5,.1)
STATUS OF THIS REPORT
"^DD",74,74,5,1,0)
^.1
"^DD",74,74,5,1,1,0)
74^ABLTN1^MUMPS
"^DD",74,74,5,1,1,1)
Q
"^DD",74,74,5,1,1,2)
D ^RABUL2 Q
"^DD",74,74,5,1,1,3)
Do not delete.
"^DD",74,74,5,1,1,"%D",0)
^^2^2^2940204^
"^DD",74,74,5,1,1,"%D",1,0)
     Send a bulletin to the RADIOLOGY REPORT UNVERIFIED mail group if the
"^DD",74,74,5,1,1,"%D",2,0)
status of a report is changed from 'Verified'.
"^DD",74,74,5,1,1,"DT")
2940204
"^DD",74,74,5,1,2,0)
74^ARES^MUMPS
"^DD",74,74,5,1,2,1)
N RAXREF K RAKILL I X'="V" S RAXREF="ARES",RARAD=12,RASET="" D XREF^RAUTL2 S RASECOND="SRR" D SECXREF^RADD1 K RARAD,RASET
"^DD",74,74,5,1,2,2)
N RAXREF K RASET S RAXREF="ARES",RARAD=12,RAKILL="" D XREF^RAUTL2 S RASECOND="SRR" D SECXREF^RADD1 K RAKILL,RARAD
"^DD",74,74,5,1,2,"%D",0)
^^2^2^3080211^
"^DD",74,74,5,1,2,"%D",1,0)
Used to generate a list of unverified reports by resident responsible
"^DD",74,74,5,1,2,"%D",2,0)
for the reports.
"^DD",74,74,5,1,2,"DT")
2960321
"^DD",74,74,5,1,3,0)
74^ASTF^MUMPS
"^DD",74,74,5,1,3,1)
N RAXREF K RAKILL I X'="V" S RAXREF="ASTF",RARAD=15,RASET="" D XREF^RAUTL2 S RASECOND="SSR" D SECXREF^RADD1 K RARAD,RASEC
"^DD",74,74,5,1,3,2)
N RAXREF K RASET S RAXREF="ASTF",RARAD=15,RAKILL="" D XREF^RAUTL2 S RASECOND="SSR" D SECXREF^RADD1 K RAKILL,RARAD
"^DD",74,74,5,1,3,"%D",0)
^^2^2^3080211^
"^DD",74,74,5,1,3,"%D",1,0)
Used to generate a list of unverified reports by the interpreting staff
"^DD",74,74,5,1,3,"%D",2,0)
responsible for the reports.
"^DD",74,74,5,1,3,"DT")
2960321
"^DD",74,74,5,1,4,0)
74^ASTAT^MUMPS
"^DD",74,74,5,1,4,1)
S:"Vv"'[$E(X) ^RARPT("ASTAT",$E(X,1,30),DA)=""
"^DD",74,74,5,1,4,2)
K ^RARPT("ASTAT",$E(X,1,30),DA)
"^DD",74,74,5,1,4,3)
Needed for the Unverified Report.
"^DD",74,74,5,1,4,"%D",0)
^^2^2^2941116^
"^DD",74,74,5,1,4,"%D",1,0)
This cross reference will be used to track the status of non-verified
"^DD",74,74,5,1,4,"%D",2,0)
reports for the Unverified Report.
"^DD",74,74,5,1,4,"DT")
2941116
"^DD",74,74,5,3)
Enter the status of this report.
"^DD",74,74,5,10)
SYSTEM GENERATED
"^DD",74,74,5,21,0)
^^29^29^3080211^
"^DD",74,74,5,21,1,0)
This field contains a value to indicate the status of this report.  Valid
"^DD",74,74,5,21,2,0)
choices are: 'V' for Verified, 'R' for Released/Not Verified, 'PD' for
"^DD",74,74,5,21,3,0)
Problem Draft, 'D' for Draft, 'EF' for Electronically Filed and 'X' for
"^DD",74,74,5,21,4,0)
Deleted.
"^DD",74,74,5,21,5,0)
 
"^DD",74,74,5,21,6,0)
'V' (Verified) status refers to a report that is verified by the 
"^DD",74,74,5,21,7,0)
interpreting physician and is available for display outside the Rad/Nuc 
"^DD",74,74,5,21,8,0)
Med Department to appropriate users, such as ward clerks, nurses, and 
"^DD",74,74,5,21,9,0)
physicians.
"^DD",74,74,5,21,10,0)
 
"^DD",74,74,5,21,11,0)
'R' (Released/Not Verified) status refers to a report that is not 
"^DD",74,74,5,21,12,0)
verified by the interpreting physician and is available for display 
"^DD",74,74,5,21,13,0)
outside the Rad/Nuc Med Department.  The 'R' status is allowed only when 
"^DD",74,74,5,21,14,0)
the parameter that controls this feature, 'Allow Released/Unverified' of 
"^DD",74,74,5,21,15,0)
the 'RAD/NUC MED DIVISION' file (#79), is set to 'Yes'.  Use the 'Display 
"^DD",74,74,5,21,16,0)
Report' option to view reports with the 'R' status.
"^DD",74,74,5,21,17,0)
 
"^DD",74,74,5,21,18,0)
'D' (Draft) status or 'PD' (Problem Draft) status refers to a report that 
"^DD",74,74,5,21,19,0)
is available only for display in the Rad/Nuc Med Department.  A statement 
"^DD",74,74,5,21,20,0)
describing the problem to the interpreting physician is printed at the 
"^DD",74,74,5,21,21,0)
end of reports with the 'PD' status.
"^DD",74,74,5,21,22,0)
 
"^DD",74,74,5,21,23,0)
'EF' (Electronically Filed) status refers to a report that is interpreted 
"^DD",74,74,5,21,24,0)
outside the Rad/Nuc Med Department.  The content is not the actual 
"^DD",74,74,5,21,25,0)
interpreted report, but canned text referring to the outside interpreted 
"^DD",74,74,5,21,26,0)
report.
"^DD",74,74,5,21,27,0)
 
"^DD",74,74,5,21,28,0)
'X' (Deleted) status refers to a report that is deleted from a case, but 
"^DD",74,74,5,21,29,0)
remains in the database though not selectable from any Radiology options.
"^DD",74,74,5,23,0)
^^9^9^3080211^
"^DD",74,74,5,23,1,0)
     The 'RAD/NUC MED REPORT UNVERIFIED' bulletin uses a variable called
"^DD",74,74,5,23,2,0)
RASTATX.  This variable is one character in length.  Some of the codes are
"^DD",74,74,5,23,3,0)
greater than one character in length, i.e, 'PD'.  In this case, the 
"^DD",74,74,5,23,4,0)
routine RAUTL9 must resolve variable RASTATX to its full internal
"^DD",74,74,5,23,5,0)
format.  If sets of codes are added to the data dictionary which are
"^DD",74,74,5,23,6,0)
longer than one character in length, then routine RAUTL9 should be
"^DD",74,74,5,23,7,0)
modified to reflect these changes if the new code is processed by this
"^DD",74,74,5,23,8,0)
routine.  The new 'EF' added by patch RA*5*56 is not used by routine
"^DD",74,74,5,23,9,0)
RAUTL9, so routine RAUTL9 does not have to be modified.
"^DD",74,74,5,"DT")
2960321
"^DD",74,74,18,0)
DATE INITIAL OUTSIDE RPT ENTRY^D^^0;18^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",74,74,18,.1)
DATE AND TIME AN OUTSIDE REPORT WAS LOGGED INTO THE SYSTEM
"^DD",74,74,18,3)
The system stores the date and time when the outside report was logged via the 'Outside Report Entry/Edit' option.
"^DD",74,74,18,21,0)
^^2^2^3080208^
"^DD",74,74,18,21,1,0)
The system populates this value when the 'Outside Report Entry/Edit' 
"^DD",74,74,18,21,2,0)
option is used.
"^DD",74,74,18,"DT")
3071211
"^DD",74,74,100,0)
ACTIVITY LOG^74.01DA^^L;0
"^DD",74,74,100,.1)
ACTIVITY LOG SUB-FIELD
"^DD",74,74,100,3)

"^DD",74,74,100,21,0)
^.001^2^2^3080313^^^^
"^DD",74,74,100,21,1,0)
This is a multiple field containing a log of actions that have been taken
"^DD",74,74,100,21,2,0)
on this report record.
"^DD",74,74.01,0)
ACTIVITY LOG SUB-FIELD^NL^10^10
"^DD",74,74.01,0,"NM","ACTIVITY LOG")

"^DD",74,74.01,.01,0)
LOG DATE^RD^^0;1^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",74,74.01,.01,.1)
DATE OF ACTION ON THIS REPORT RECORD
"^DD",74,74.01,.01,3)
System generated date and time that action was taken on this report.
"^DD",74,74.01,.01,10)
SYSTEM GENERATED
"^DD",74,74.01,.01,21,0)
^^2^2^2940518^^^^
"^DD",74,74.01,.01,21,1,0)
This field contains the date and the time that the action was taken on this
"^DD",74,74.01,.01,21,2,0)
report record.
"^DD",74,74.01,2,0)
TYPE OF ACTION^RS^I:INITIAL REPORT TRANSCRIPTION;E:REPORT EDIT;V:VERIFIED;U:REPORT UNVERIFIED;C:IMAGES COLLECTED;P:PRE-VERIFIED;F:ELECTRONICALLY FILED;X:DELETED REPORT;R:RESTORED REPORT;^0;2^Q
"^DD",74,74.01,2,.1)
TYPE OF ACTION ON REPORT RECORD
"^DD",74,74.01,2,3)
This is the action type for this report.
"^DD",74,74.01,2,10)
SYSTEM GENERATED
"^DD",74,74.01,2,21,0)
^^5^5^3080208^
"^DD",74,74.01,2,21,1,0)
This field contains the type of action that was taken on this report
"^DD",74,74.01,2,21,2,0)
record.  Valid choices are:  'I' for Initial Report Transcription, 'E' for
"^DD",74,74.01,2,21,3,0)
Report Edit, 'V' for Verified, 'U' for Report Unverified, 'C' for
"^DD",74,74.01,2,21,4,0)
Digitized Images Collected, 'P' for Pre-Verified, 'F' for Electronically 
"^DD",74,74.01,2,21,5,0)
Filed, 'X' for Deleted Report, and 'R' for Restored Report.
"^DD",74,74.01,2,"DT")
3071203
"^DD",74,74.01,4,0)
BEFORE DELETION REPORT STATUS^S^V:VERIFIED;R:RELEASED/NOT VERIFIED;PD:PROBLEM DRAFT;D:DRAFT;EF:ELECTRONICALLY FILED;^0;4^Q
"^DD",74,74.01,4,3)
The system will store the current report status before deleting the report. 
"^DD",74,74.01,4,21,0)
^.001^2^2^3080313^^
"^DD",74,74.01,4,21,1,0)
The system populates this value when the report is deleted via the
"^DD",74,74.01,4,21,2,0)
Radiology application.
"^DD",74,74.01,4,"DT")
3080313
"^DD",74,74.01,5,0)
BEFORE DELETION PRIM. DX CODE^P78.3'^RA(78.3,^0;5^Q
"^DD",74,74.01,5,3)
This field will be populated by the system.
"^DD",74,74.01,5,21,0)
^^3^3^3080211^
"^DD",74,74.01,5,21,1,0)
When a report is marked for deletion, its associated Primary Diagnostic
"^DD",74,74.01,5,21,2,0)
Code from subfile 70.03 is copied into this field, prior to deletion from
"^DD",74,74.01,5,21,3,0)
file 70.03.
"^DD",74,74.01,5,"DT")
3080129
"^DD",74,74.01,6,0)
BEFORE DELETION SEC. DX CODE^74.16PA^^DELDX;0
"^DD",74,74.01,7,0)
BEFORE DELETION PRIM. STAFF^P200'^VA(200,^0;7^Q
"^DD",74,74.01,7,3)
This field will be populated by the system.
"^DD",74,74.01,7,21,0)
^^3^3^3080219^
"^DD",74,74.01,7,21,1,0)
When a report is marked for deletion, its associated Primary Interpreting 
"^DD",74,74.01,7,21,2,0)
Staff from subfile 70.03 is copied into this field, prior to deletion 
"^DD",74,74.01,7,21,3,0)
from file 70.03.
"^DD",74,74.01,7,"DT")
3080219
"^DD",74,74.01,8,0)
BEFORE DELETION SEC. STAFF^74.18PA^^DELSTF;0
"^DD",74,74.01,9,0)
BEFORE DELETION PRIM. RESIDENT^P200'^VA(200,^0;9^Q
"^DD",74,74.01,9,3)
This field will be populated by the system.
"^DD",74,74.01,9,21,0)
^^3^3^3080219^
"^DD",74,74.01,9,21,1,0)
When a report is marked for deletion, its associated Primary Interpreting 
"^DD",74,74.01,9,21,2,0)
Resident from subfile 70.03 is copied into this field, prior to deletion 
"^DD",74,74.01,9,21,3,0)
from file 70.03.
"^DD",74,74.01,9,"DT")
3080219
"^DD",74,74.01,10,0)
BEFORE DELETION SEC. RESIDENT^74.19PA^^DELRES;0
"^DD",74,74.16,0)
BEFORE DELETION SEC. DX CODE SUB-FIELD^^.01^1
"^DD",74,74.16,0,"DT")
3080129
"^DD",74,74.16,0,"IX","B",74.16,.01)

"^DD",74,74.16,0,"NM","BEFORE DELETION SEC. DX CODE")

"^DD",74,74.16,0,"UP")
74.01
"^DD",74,74.16,.01,0)
BEFORE DELETION SEC. DX CODE^P78.3'^RA(78.3,^0;1^Q
"^DD",74,74.16,.01,1,0)
^.1
"^DD",74,74.16,.01,1,1,0)
74.16^B
"^DD",74,74.16,.01,1,1,1)
S ^RARPT(DA(2),"L",DA(1),"DELDX","B",$E(X,1,30),DA)=""
"^DD",74,74.16,.01,1,1,2)
K ^RARPT(DA(2),"L",DA(1),"DELDX","B",$E(X,1,30),DA)
"^DD",74,74.16,.01,3)
This field will be populated by the system.
"^DD",74,74.16,.01,21,0)
^^3^3^3080211^
"^DD",74,74.16,.01,21,1,0)
When a report is marked for deletion, its associated Secondary Diagnostic
"^DD",74,74.16,.01,21,2,0)
Codes from subfile 70.14, if any, are copied into this multiple field, 
"^DD",74,74.16,.01,21,3,0)
prior to deletion from subfile 70.14.
"^DD",74,74.16,.01,"DT")
3080129
"^DD",74,74.18,0)
BEFORE DELETION SEC. STAFF SUB-FIELD^^.01^1
"^DD",74,74.18,0,"DT")
3080219
"^DD",74,74.18,0,"IX","B",74.18,.01)

"^DD",74,74.18,0,"NM","BEFORE DELETION SEC. STAFF")

"^DD",74,74.18,0,"UP")
74.01
"^DD",74,74.18,.01,0)
BEFORE DELETION SEC. STAFF^P200'^VA(200,^0;1^Q
"^DD",74,74.18,.01,1,0)
^.1
"^DD",74,74.18,.01,1,1,0)
74.18^B
"^DD",74,74.18,.01,1,1,1)
S ^RARPT(DA(2),"L",DA(1),"DELSTF","B",$E(X,1,30),DA)=""
"^DD",74,74.18,.01,1,1,2)
K ^RARPT(DA(2),"L",DA(1),"DELSTF","B",$E(X,1,30),DA)
"^DD",74,74.18,.01,3)
This field will be populated by the system.
"^DD",74,74.18,.01,21,0)
^.001^3^3^3080219^^
"^DD",74,74.18,.01,21,1,0)
When a report is marked for deletion, its associated Secondary
"^DD",74,74.18,.01,21,2,0)
Interpreting Staff from subfile 70.11, if any, are copied into this 
"^DD",74,74.18,.01,21,3,0)
multiple field, prior to deletion from subfile 70.11.
"^DD",74,74.18,.01,"DT")
3080219
"^DD",74,74.19,0)
BEFORE DELETION SEC. RESIDENT SUB-FIELD^^.01^1
"^DD",74,74.19,0,"DT")
3080219
"^DD",74,74.19,0,"IX","B",74.19,.01)

"^DD",74,74.19,0,"NM","BEFORE DELETION SEC. RESIDENT")

"^DD",74,74.19,0,"UP")
74.01
"^DD",74,74.19,.01,0)
BEFORE DELETION SEC. RESIDENT^P200'^VA(200,^0;1^Q
"^DD",74,74.19,.01,1,0)
^.1
"^DD",74,74.19,.01,1,1,0)
74.19^B
"^DD",74,74.19,.01,1,1,1)
S ^RARPT(DA(2),"L",DA(1),"DELRES","B",$E(X,1,30),DA)=""
"^DD",74,74.19,.01,1,1,2)
K ^RARPT(DA(2),"L",DA(1),"DELRES","B",$E(X,1,30),DA)
"^DD",74,74.19,.01,3)
This field will be populated by the system.
"^DD",74,74.19,.01,21,0)
^^3^3^3080219^
"^DD",74,74.19,.01,21,1,0)
When a report is marked for deletion, its associated Secondary 
"^DD",74,74.19,.01,21,2,0)
Interpreting Resident from subfile 70.09, if any, are copied into this 
"^DD",74,74.19,.01,21,3,0)
multiple field, prior to deletion from subfile 70.09.
"^DD",74,74.19,.01,"DT")
3080219
"BLD",6859,6)
^78
**END**
**END**
