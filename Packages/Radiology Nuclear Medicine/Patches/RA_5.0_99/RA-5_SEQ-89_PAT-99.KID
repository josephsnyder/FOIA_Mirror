Released RA*5*99 SEQ #89
Extracted from mail message
**KIDS**:RA*5.0*99^

**INSTALL NAME**
RA*5.0*99
"BLD",7383,0)
RA*5.0*99^RADIOLOGY/NUCLEAR MEDICINE^0^3091120^y
"BLD",7383,1,0)
^9.61A^3^3^3091104^^^^
"BLD",7383,1,1,0)
Patch ninety-nine for the Radiology/Nuclear Medicine 5.0 software.  
"BLD",7383,1,2,0)
Please review the Description and Installation Instructions for RA*5.0*99
"BLD",7383,1,3,0)
before installing this patch.
"BLD",7383,4,0)
^9.64PA^70^1
"BLD",7383,4,70,0)
70
"BLD",7383,4,70,2,0)
^9.641^70.03^1
"BLD",7383,4,70,2,70.03,0)
EXAMINATIONS  (sub-file)
"BLD",7383,4,70,2,70.03,1,0)
^9.6411^80^2
"BLD",7383,4,70,2,70.03,1,32,0)
PREGNANCY SCREEN
"BLD",7383,4,70,2,70.03,1,80,0)
PREGNANCY SCREEN COMMENT
"BLD",7383,4,70,222)
y^n^p^^^^n^^n
"BLD",7383,4,70,224)

"BLD",7383,4,"APDD",70,70.03)

"BLD",7383,4,"APDD",70,70.03,32)

"BLD",7383,4,"APDD",70,70.03,80)

"BLD",7383,4,"B",70,70)

"BLD",7383,6.3)
5
"BLD",7383,"ABNS",0)
^9.66A^^
"BLD",7383,"ABPKG")
n^n
"BLD",7383,"KRN",0)
^9.67PA^779.2^20
"BLD",7383,"KRN",.4,0)
.4
"BLD",7383,"KRN",.401,0)
.401
"BLD",7383,"KRN",.402,0)
.402
"BLD",7383,"KRN",.402,"NM",0)
^9.68A^4^4
"BLD",7383,"KRN",.402,"NM",1,0)
RA REGISTER    FILE #70^70^0
"BLD",7383,"KRN",.402,"NM",2,0)
RA EXAM EDIT    FILE #70^70^0
"BLD",7383,"KRN",.402,"NM",3,0)
RA ORDER EXAM    FILE #75.1^75.1^0
"BLD",7383,"KRN",.402,"NM",4,0)
RA QUICK EXAM ORDER    FILE #75.1^75.1^0
"BLD",7383,"KRN",.402,"NM","B","RA EXAM EDIT    FILE #70",2)

"BLD",7383,"KRN",.402,"NM","B","RA ORDER EXAM    FILE #75.1",3)

"BLD",7383,"KRN",.402,"NM","B","RA QUICK EXAM ORDER    FILE #75.1",4)

"BLD",7383,"KRN",.402,"NM","B","RA REGISTER    FILE #70",1)

"BLD",7383,"KRN",.403,0)
.403
"BLD",7383,"KRN",.5,0)
.5
"BLD",7383,"KRN",.84,0)
.84
"BLD",7383,"KRN",3.6,0)
3.6
"BLD",7383,"KRN",3.8,0)
3.8
"BLD",7383,"KRN",9.2,0)
9.2
"BLD",7383,"KRN",9.8,0)
9.8
"BLD",7383,"KRN",9.8,"NM",0)
^9.68A^28^23
"BLD",7383,"KRN",9.8,"NM",1,0)
RAPM^^0^B71205125
"BLD",7383,"KRN",9.8,"NM",4,0)
RAPM3^^0^B102916259
"BLD",7383,"KRN",9.8,"NM",5,0)
RAPROD^^0^B43504474
"BLD",7383,"KRN",9.8,"NM",6,0)
RACMP1^^0^B27836976
"BLD",7383,"KRN",9.8,"NM",7,0)
RAORD3^^0^B27635880
"BLD",7383,"KRN",9.8,"NM",8,0)
RAORD6^^0^B56757723
"BLD",7383,"KRN",9.8,"NM",9,0)
RAORD1A^^0^B11368000
"BLD",7383,"KRN",9.8,"NM",10,0)
RART1^^0^B63509883
"BLD",7383,"KRN",9.8,"NM",11,0)
RARTE^^0^B36165154
"BLD",7383,"KRN",9.8,"NM",12,0)
RARTE6^^0^B115912861
"BLD",7383,"KRN",9.8,"NM",15,0)
RASTED^^0^B54871068
"BLD",7383,"KRN",9.8,"NM",16,0)
RART3^^0^B24604076
"BLD",7383,"KRN",9.8,"NM",17,0)
RAUTL8^^0^B70605252
"BLD",7383,"KRN",9.8,"NM",18,0)
RAORDU1^^0^B33414666
"BLD",7383,"KRN",9.8,"NM",20,0)
RARTR^^0^B63595005
"BLD",7383,"KRN",9.8,"NM",21,0)
RARTR0^^0^B58931400
"BLD",7383,"KRN",9.8,"NM",22,0)
RAPM2^^0^B95462078
"BLD",7383,"KRN",9.8,"NM",23,0)
RAPMW^^0^B74438083
"BLD",7383,"KRN",9.8,"NM",24,0)
RAPMW1^^0^B101224993
"BLD",7383,"KRN",9.8,"NM",25,0)
RAPMW3^^0^B146308713
"BLD",7383,"KRN",9.8,"NM",26,0)
RAREG2^^0^B57844146
"BLD",7383,"KRN",9.8,"NM",27,0)
RASTREQ^^0^B55165659
"BLD",7383,"KRN",9.8,"NM",28,0)
RAPMW2^^0^B77528050
"BLD",7383,"KRN",9.8,"NM","B","RACMP1",6)

"BLD",7383,"KRN",9.8,"NM","B","RAORD1A",9)

"BLD",7383,"KRN",9.8,"NM","B","RAORD3",7)

"BLD",7383,"KRN",9.8,"NM","B","RAORD6",8)

"BLD",7383,"KRN",9.8,"NM","B","RAORDU1",18)

"BLD",7383,"KRN",9.8,"NM","B","RAPM",1)

"BLD",7383,"KRN",9.8,"NM","B","RAPM2",22)

"BLD",7383,"KRN",9.8,"NM","B","RAPM3",4)

"BLD",7383,"KRN",9.8,"NM","B","RAPMW",23)

"BLD",7383,"KRN",9.8,"NM","B","RAPMW1",24)

"BLD",7383,"KRN",9.8,"NM","B","RAPMW2",28)

"BLD",7383,"KRN",9.8,"NM","B","RAPMW3",25)

"BLD",7383,"KRN",9.8,"NM","B","RAPROD",5)

"BLD",7383,"KRN",9.8,"NM","B","RAREG2",26)

"BLD",7383,"KRN",9.8,"NM","B","RART1",10)

"BLD",7383,"KRN",9.8,"NM","B","RART3",16)

"BLD",7383,"KRN",9.8,"NM","B","RARTE",11)

"BLD",7383,"KRN",9.8,"NM","B","RARTE6",12)

"BLD",7383,"KRN",9.8,"NM","B","RARTR",20)

"BLD",7383,"KRN",9.8,"NM","B","RARTR0",21)

"BLD",7383,"KRN",9.8,"NM","B","RASTED",15)

"BLD",7383,"KRN",9.8,"NM","B","RASTREQ",27)

"BLD",7383,"KRN",9.8,"NM","B","RAUTL8",17)

"BLD",7383,"KRN",19,0)
19
"BLD",7383,"KRN",19,"NM",0)
^9.68A^10^8
"BLD",7383,"KRN",19,"NM",1,0)
RA TIMELINESS PERFORMANCE MENU^^0^
"BLD",7383,"KRN",19,"NM",3,0)
RA PERFORMIN TASKLM^^0
"BLD",7383,"KRN",19,"NM",4,0)
RA TIMELINESS MENU^^0
"BLD",7383,"KRN",19,"NM",5,0)
RA TIMELINESS VER MENU^^0
"BLD",7383,"KRN",19,"NM",6,0)
RA PERFORMIN RPTS^^0
"BLD",7383,"KRN",19,"NM",8,0)
RA PERFORMIN MAIL GROUP ENTRY^^0
"BLD",7383,"KRN",19,"NM",9,0)
RA TIMELINESS OUTPATIENT MENU^^0
"BLD",7383,"KRN",19,"NM",10,0)
RA TIMELINESS REPORT^^0
"BLD",7383,"KRN",19,"NM","B","RA PERFORMIN MAIL GROUP ENTRY",8)

"BLD",7383,"KRN",19,"NM","B","RA PERFORMIN RPTS",6)

"BLD",7383,"KRN",19,"NM","B","RA PERFORMIN TASKLM",3)

"BLD",7383,"KRN",19,"NM","B","RA TIMELINESS MENU",4)

"BLD",7383,"KRN",19,"NM","B","RA TIMELINESS OUTPATIENT MENU",9)

"BLD",7383,"KRN",19,"NM","B","RA TIMELINESS PERFORMANCE MENU",1)

"BLD",7383,"KRN",19,"NM","B","RA TIMELINESS REPORT",10)

"BLD",7383,"KRN",19,"NM","B","RA TIMELINESS VER MENU",5)

"BLD",7383,"KRN",19.1,0)
19.1
"BLD",7383,"KRN",101,0)
101
"BLD",7383,"KRN",409.61,0)
409.61
"BLD",7383,"KRN",771,0)
771
"BLD",7383,"KRN",779.2,0)
779.2
"BLD",7383,"KRN",870,0)
870
"BLD",7383,"KRN",8989.51,0)
8989.51
"BLD",7383,"KRN",8989.52,0)
8989.52
"BLD",7383,"KRN",8994,0)
8994
"BLD",7383,"KRN","B",.4,.4)

"BLD",7383,"KRN","B",.401,.401)

"BLD",7383,"KRN","B",.402,.402)

"BLD",7383,"KRN","B",.403,.403)

"BLD",7383,"KRN","B",.5,.5)

"BLD",7383,"KRN","B",.84,.84)

"BLD",7383,"KRN","B",3.6,3.6)

"BLD",7383,"KRN","B",3.8,3.8)

"BLD",7383,"KRN","B",9.2,9.2)

"BLD",7383,"KRN","B",9.8,9.8)

"BLD",7383,"KRN","B",19,19)

"BLD",7383,"KRN","B",19.1,19.1)

"BLD",7383,"KRN","B",101,101)

"BLD",7383,"KRN","B",409.61,409.61)

"BLD",7383,"KRN","B",771,771)

"BLD",7383,"KRN","B",779.2,779.2)

"BLD",7383,"KRN","B",870,870)

"BLD",7383,"KRN","B",8989.51,8989.51)

"BLD",7383,"KRN","B",8989.52,8989.52)

"BLD",7383,"KRN","B",8994,8994)

"BLD",7383,"QDEF")
^^^^NO^^^^YES^^YES
"BLD",7383,"QUES",0)
^9.62^^
"BLD",7383,"REQB",0)
^9.611^13^9
"BLD",7383,"REQB",4,0)
RA*5.0*72^2
"BLD",7383,"REQB",5,0)
RA*5.0*83^2
"BLD",7383,"REQB",6,0)
RA*5.0*84^2
"BLD",7383,"REQB",7,0)
RA*5.0*86^2
"BLD",7383,"REQB",8,0)
RA*5.0*93^2
"BLD",7383,"REQB",9,0)
RA*5.0*95^2
"BLD",7383,"REQB",10,0)
RA*5.0*92^2
"BLD",7383,"REQB",12,0)
RA*5.0*82^2
"BLD",7383,"REQB",13,0)
RA*5.0*85^2
"BLD",7383,"REQB","B","RA*5.0*72",4)

"BLD",7383,"REQB","B","RA*5.0*82",12)

"BLD",7383,"REQB","B","RA*5.0*83",5)

"BLD",7383,"REQB","B","RA*5.0*84",6)

"BLD",7383,"REQB","B","RA*5.0*85",13)

"BLD",7383,"REQB","B","RA*5.0*86",7)

"BLD",7383,"REQB","B","RA*5.0*92",10)

"BLD",7383,"REQB","B","RA*5.0*93",8)

"BLD",7383,"REQB","B","RA*5.0*95",9)

"FIA",70)
RAD/NUC MED PATIENT
"FIA",70,0)
^RADPT(
"FIA",70,0,0)
70IP
"FIA",70,0,1)
y^n^p^^^^n^^n
"FIA",70,0,10)

"FIA",70,0,11)

"FIA",70,0,"RLRO")

"FIA",70,0,"VR")
5.0^RA
"FIA",70,70)
1
"FIA",70,70.03)
1
"FIA",70,70.03,32)

"FIA",70,70.03,80)

"KRN",.402,227,-1)
0^1
"KRN",.402,227,0)
RA REGISTER^3091026.1346^^70^^^3091119
"KRN",.402,227,"AR",70.03,589)
1^RACTRG11
"KRN",.402,227,"DIAB",1,2,70.03,9)
19;REQ
"KRN",.402,227,"DIAB",1,3,70.1,0)
ALL
"KRN",.402,227,"DIAB",3,2,70.03,6)
9.5//^S X=$S($D(RARSH):RARSH,1:"");REQ
"KRN",.402,227,"DIAB",3,2,70.03,7)
8//^S X=$S($D(RACLNC):RACLNC,1:"");REQ
"KRN",.402,227,"DIAB",3,2,70.03,8)
6;REQ
"KRN",.402,227,"DIAB",4,2,70.03,16)
80;REQ
"KRN",.402,227,"DIAB",6,2,70.03,6)
9//^S X=$S($D(RASHA):RASHA,1:"");REQ
"KRN",.402,227,"DIAB",8,2,70.03,0)
2//^S X=$S($D(RAPRC):RAPRC,1:"");REQ
"KRN",.402,227,"DIAB",9,2,70.03,8)
7;REQ
"KRN",.402,227,"DR",1,70)
I '$D(RAMDV)!('$D(RAMLC))!('$D(RADTE))!('$D(RACAT))!('$D(RAOIFN))!('$D(RAIMGTY)) W !?3,$C(7),"Variables RAMDV,RAMLC,RADTE,RACAT,RAIMGTY and RAOIFN must be defined!",! S Y="@999";
"KRN",.402,227,"DR",1,70,1)
W !!?3,"...will now register ",RANME," with the next case number...";2///^S X=RADTE;@999;S REM="let calling rtn kill RAPOP,RAFM,RAFM1,RAI,RAMOD,RASTI,RACMTHOD,RANMFLG,RAIEN702";
"KRN",.402,227,"DR",2,70.02)
S RADTI=DA;2////^S X=$P(RAMLC,U,6);3////^S X=+RAMDIV;4////^S X=+RAMLC;Q;50///^S X=RACN;
"KRN",.402,227,"DR",3,70.03)
S RACN=X,RACNI=DA;S RACMTHOD=$P(^RA(79.1,+$P(RAMLC,"^"),0),"^",21);S RACMTHOD=$S(RACMTHOD]"":RACMTHOD,1:0);26////^S X=RACMTHOD;3////^S X=$O(^RA(72,"AA",RAIMGTY,1,0));S RASTI=X;@3;2R~//^S X=$S($D(RAPRC):RAPRC,1:"");S RAPRI=X;
"KRN",.402,227,"DR",3,70.03,1)
S RAPRI(0)=$G(^RAMIS(71,+RAPRI,0));I $P(RAMDV,U,7),($P(RAPRI(0),U,6)="B") S Y="@3000";S:$P($G(^RA(79,+$$DIVSION^RAUTL6(DT,+$P($G(^RAO(75.1,+RAOIFN,0)),"^",22)),.1)),"^",7)="N"!($P(RAPRI(0),"^",6)'="B") Y="@4";@3000;
"KRN",.402,227,"DR",3,70.03,2)
W !?3,$C(7),"A 'detailed' procedure or a 'series' of procedures is required!";2///@;S Y="@3";@4;S RAPX(RACNI)=RACN_"^"_^RAMIS(71,RAPRI,0);S REM="don't copy proc mods for Series and Broad, 9/24/1999";
"KRN",.402,227,"DR",3,70.03,3)
S:$P(RAPX(RACNI),U,7)="S" Y="@7";S:$P(RAPX(RACNI),U,7)="B" Y="@8";S RAI=0,Y=$S('$D(RAPRC):"@6",RAPRC'=$P(RAPX(RACNI),U,2):"@6",1:"@5");@5;S RAI=$O(^RAO(75.1,+RAOIFN,"M","B",RAI)) S:'RAI Y="@6";
"KRN",.402,227,"DR",3,70.03,4)
S RAMOD=$S($D(^RAMIS(71.2,RAI,0)):$P(^(0),U),1:-1) S:RAMOD<0 Y="@6";S:'$D(^RAMIS(71.2,"AB",+$$ITYPE^RASITE(+$G(RAPRI)),RAI)) Y="@5";125///^S X=RAMOD;S Y="@5";@6;125;^4.01;@7;D:$T(SETDEFS^RACPTMSC)]"" SETDEFS^RACPTMSC;
"KRN",.402,227,"DR",3,70.03,5)
S REM="don't ask cpt mods after stuffing";@8;11////^S X=RAOIFN;14////^S X=$S($D(RAPIFN):RAPIFN,1:"");18////^S X=$S($P(RAPX(RACNI),U,15)]"":$P(RAPX(RACNI),U,15),1:"");@20;4//^S X=RACAT;
"KRN",.402,227,"DR",3,70.03,6)
S RAX=$E(X),Y=$S(RAX="I":"@60",RAX="E":"@45",RAX="R":"@30","CS"[RAX:"@40",1:"@50") K RAX;@30;9.5R~//^S X=$S($D(RARSH):RARSH,1:"");S Y=$S($D(RAWARD):"@60",1:"@50");@40;9R~//^S X=$S($D(RASHA):RASHA,1:"");S Y="@100";@45;
"KRN",.402,227,"DR",3,70.03,7)
S:$D(RAWARD) Y="@60";@50;8R~//^S X=$S($D(RACLNC):RACLNC,1:"");S RACLNC=$P(^SC(X,0),U);S Y="@100";@60;S:'$D(RAWARD) RAWARD="Unknown" S:'$D(RASER) RASER="Unknown" S:'$D(RABED) RABED="Unknown";
"KRN",.402,227,"DR",3,70.03,8)
W !?5,"Ward: ",RAWARD,"   Service: ",RASER,"  Bedsection: ",RABED;I RAWARD'="Unknown" S Y="@66";6R~;S Y="@68";@66;6///^S X=RAWARD;@68;I RASER'="Unknown" S Y="@80";7R~;S Y="@85";@80;7///^S X=RASER;@85;I RABED'="Unknown" S Y="@95";
"KRN",.402,227,"DR",3,70.03,9)
19R~;S Y="@100";@95;19///^S X=RABED;@100;21////^S X=$S($D(RARDTE):RARDTE,1:"");22////^S X=$S($D(RALIFN):RALIFN,1:"");I '$D(^RAMIS(71,RAPRI,"F",0)) S Y="@300";S RAI=0;@200;
"KRN",.402,227,"DR",3,70.03,10)
S RAI=$O(^RAMIS(71,RAPRI,"F",RAI)) S:RAI'>0!('$D(^(+RAI,0))) Y="@300";
"KRN",.402,227,"DR",3,70.03,11)
S RAFM(1)=+^RAMIS(71,RAPRI,"F",RAI,0),RAFM1=+$P(^(0),U,2),RAFM=$S($D(^RA(78.4,RAFM(1),0)):$P(^(0),U),1:-1),RAFM=$S('$D(^("I")):RAFM,'^("I"):RAFM,1:-1) S:RAFM<0 Y="@200";50///^S X=RAFM;S Y="@200";@300;
"KRN",.402,227,"DR",3,70.03,12)
S RAPOP=0 D USER^RAUTL S:RAPOP Y="@999";S:'$P(RAMDV,U,10) Y="@350";75///^S X="""NOW""";@350;S RANMFLG=0;S:'$D(RAIMGTYI) RAIMGTYI=$O(^RA(79.2,"B",RAIMGTY,0));S:$P($G(^RA(79.2,+$G(RAIMGTYI),0)),"^",5)="Y" RANMFLG=1;
"KRN",.402,227,"DR",3,70.03,13)
S:'RANMFLG Y="@450";S:'$O(^RAMIS(71,RAPRI,"NUC",0)) Y="@450";S REM="is this proc's ASK RADIOPHARMACEUTICAL = NEVER ?";S:$P(^RAMIS(71,RAPRI,0),U,2)=1 Y="@450";S REM="en1^ranmpt1 will stuff default radiopharms during registration";
"KRN",.402,227,"DR",3,70.03,14)
S RAIEN702=$$EN1^RANMPT1(RADFN,RADTE,RACN);S:RAIEN702=-1 Y="@450";500////^S X=RAIEN702;@450;S:'$O(^RAMIS(71,RAPRI,"P",0)) Y="@700";S REM="en2^ranmpt1 will stuff default meds";D EN2^RANMPT1(RADFN,RADTI,RACNI);@700;
"KRN",.402,227,"DR",3,70.03,15)
100///^S X="""NOW""";S RACOM="ask pregnant question if appropriate otherwise branch to @8001" K RACOM;S Y=$$ASKPREG^RAUTL8();W !,"    PREGNANT AT TIME OF ORDER ENTRY: ",$$GET1^DIQ(75.1,$G(RAOIFN)_",",13);
"KRN",.402,227,"DR",3,70.03,16)
S:$D(RAOPT("ADDEXAM")) Y="@8001";32;S:($$PRSCR^RAUTL8(RADFN,RADTI,RACNI,"I")="n")!($$PRSCR^RAUTL8(RADFN,RADTI,RACNI,"I")="") Y="@8001";80R~;@8001;
"KRN",.402,227,"DR",4,70.04)
2///^S X=RAFM1;
"KRN",.402,227,"DR",4,70.05)
2////^S X=RASTI;3////^S X=RADUZ;
"KRN",.402,227,"DR",4,70.07)
2///^S X="E";3////^S X=RADUZ;S RATCXX=$$GETTCOM^RAUTL11(RADFN,RADTI,RACNI);4//^S X=RATCXX;S:RATCXX'=X Y="@18";4///@;K ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L",DA,"TCOM");@18;K RATCXX S RAFIN="";
"KRN",.402,227,"DR",4,70.1)
.01
"KRN",.402,227,"DR",4.01,70.1)
.01;
"KRN",.402,227,"ROU")
^RACTRG
"KRN",.402,227,"ROUOLD")
RACTRG
"KRN",.402,235,-1)
0^2
"KRN",.402,235,0)
RA EXAM EDIT^3090623.0906^^70^^^3091119
"KRN",.402,235,"%D",0)
^.4021^1^1^3090722^^^^
"KRN",.402,235,"%D",1,0)
This template is used to edit exams.
"KRN",.402,235,"DIAB",1,2,70.03,12)
NUCLEAR MED DATA:
"KRN",.402,235,"DIAB",1,3,70.1,0)
ALL
"KRN",.402,235,"DIAB",1,3,70.12,0)
ALL
"KRN",.402,235,"DIAB",1,3,70.3135,0)
ALL
"KRN",.402,235,"DIAB",1,3,70.3225,0)
ALL
"KRN",.402,235,"DIAB",1,4,70.21,5)
DOSE ADMINISTERED//^S X=RADRAWN;T
"KRN",.402,235,"DIAB",2,2,70.03,9)
32;REQ
"KRN",.402,235,"DIAB",2,4,70.21,3)
ACTIVITY DRAWN (in mCi);T
"KRN",.402,235,"DIAB",3,2,70.03,1)
2;REQ
"KRN",.402,235,"DIAB",3,2,70.03,8)
CONTRACT/SHARING SOURCE;REQ
"KRN",.402,235,"DIAB",4,2,70.03,9)
80;REQ
"KRN",.402,235,"DIAB",6,2,70.03,7)
WARD;REQ
"KRN",.402,235,"DIAB",6,2,70.03,8)
PRINCIPAL CLINIC;REQ
"KRN",.402,235,"DIAB",6,4,70.21,6)
PRESCRIBED DOSE BY MD OVERRIDE;T
"KRN",.402,235,"DIAB",7,2,70.03,7)
SERVICE;REQ
"KRN",.402,235,"DIAB",8,2,70.03,7)
BEDSECTION;REQ
"KRN",.402,235,"DIAB",11,2,70.03,7)
RESEARCH SOURCE;REQ
"KRN",.402,235,"DR",1,70)
I '$D(RADTE)!('$D(RACN))!('$D(RAQUICK))!('$D(RAMDV)) W !?3,$C(7),"You must have the variables for 'Case Number','Exam Date' and",!?3,"'Rad/Nuc Med Division' defined to continue!" S Y="@999";S RAPOP=0 D USER^RAUTL S:RAPOP Y="@999";
"KRN",.402,235,"DR",1,70,1)
2///^S X=RADTE;@999;K RAOIFN,RAY,RAR,RA0,RACAT,RAI,RAIEN702,RANUZD1;
"KRN",.402,235,"DR",2,70.02)
50///^S X=RACN;@800;
"KRN",.402,235,"DR",3,70.03)
S RAREM="RANUZD1 = case's Img typ's 'Radiopharm Used'";S:$P($G(^RA(79.2,+$P($G(^RADPT(DA(2),"DT",DA(1),0)),"^",2),0)),"^",5)="Y" RANUZD1="";S RAY=^RADPT(DA(2),"DT",DA(1),"P",DA,0) F RAI=1:1:18 S RA0(RAI)=$P(RAY,U,RAI);
"KRN",.402,235,"DR",3,70.03,1)
S RAR=$S($D(^RADPT(DA(2),"DT",DA(1),"P",DA,"R")):^("R"),1:"");@20;2R~;S RAPRI=+X;S RAREM="did user change the procedure ?";I RAPRI=RA0(2) S Y="@19";S RAREM="if procedures change, make sure CM associations are preserved...";
"KRN",.402,235,"DR",3,70.03,2)
D CHGPRC^RAUTL21(RA0(2),RAPRI,.DA);D WARNPRC^RAUTL;I RAWHICH=0 S Y="@19";I RAWHICH=2 S Y="@17";W !,"... Deleting radiopharms ...",!;500///@;@17;I RAWHICH=1 S Y="@19";W !,"... Deleting Medications ...",!;
"KRN",.402,235,"DR",3,70.03,3)
K ^RADPT(DA(2),"DT",DA(1),"P",DA,"RX");@19;I '$P(RAMDV,U,7)!($P(^RAMIS(71,+RAPRI,0),U,6)'="B") S Y="@21";W !?3,$C(7),"A 'detailed' procedure or a 'series' of procedures is required!";2///@;S Y="@20";@21;S:'$$FUTC^RACPTCSV Y="@20";
"KRN",.402,235,"DR",3,70.03,4)
S RAREM="determine if CM is used for this procedure";S RAZCM=$O(^RAMIS(71,RAPRI,"CM","B",""));10//^S X=$S(RAZCM'="":"YES",1:"NO");S RAZCM(0)=X;S:$E(RAZCM(0))="N" Y=$$PRGCM^RAMAINU(.DA);
"KRN",.402,235,"DR",3,70.03,5)
D:$E(RAZCM(0))="Y"&('+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))) STUFCM70^RAMAINU(.DA,RAPRI);S X=X;225;D:+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))=0 UPXCM^RAMAINU(.DA,"N");@225;125;@37;D:$T(DISCMOD^RACPTMSC)]"" DISCMOD^RACPTMSC;
"KRN",.402,235,"DR",3,70.03,6)
135;S:'$$FUTCMOD^RACPTCSV Y="@37";4;S RACAT=X;S:RA0(4)=RACAT Y="@4";S:RA0(8)']"" Y="@1";8///@;@1;S:RA0(9)']"" Y="@2";9///@;@2;S:RA0(6)']"" Y="@10";6///@;@10;S:RA0(7)']"" Y="@11";7///@;@11;S:$P(RAY,"^",19)']"" Y="@3";19///@;@3;
"KRN",.402,235,"DR",3,70.03,7)
S:RAR']"" Y="@4";9.5///@;@4;S Y=$S(RACAT="I":"@5",RACAT="E":"@12",RACAT="R":"@6","CS"[RACAT:"@7",1:"@8");@5;6R~;7R~;19R~;S Y="@100";@6;9.5R~;@12;I '$D(VADMVT) S DFN=DA(2),VAINDT=9999999.9999-DA(1) D ADM^VADPT2;
"KRN",.402,235,"DR",3,70.03,8)
S Y=$S(VADMVT:"@5",1:"@8");@7;9R~;S Y="@100";@8;8R~;@100;14;175;S RATCXX=$$TCPROMPT^RAO7XX;S Y=$$ASKPREG^RAUTL8();S RAOIFN=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U,11);
"KRN",.402,235,"DR",3,70.03,9)
W !,"    PREGNANT AT TIME OF ORDER ENTRY: ",$$GET1^DIQ(75.1,$G(RAOIFN)_",",13);32R~;S RAPRSCR=$$PRSCR^RAUTL8(RADFN,RADTI,RACNI,"I") K:RAPRSCR="n" ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PCOMM") S:RAPRSCR="n" Y="@8001" K RAPRSCR;80R~;
"KRN",.402,235,"DR",3,70.03,10)
@8001;16//^S X=$S($D(^RA(78.1,"B","NO COMPLICATION")):"NO COMPLICATION",1:"");S:'$D(^RA(78.1,+X,0)) Y="@130";S:$P(^RA(78.1,+X,0),U)="NO COMPLICATION" Y="@130";16.5;@130;S:'$P(RAMDV,U,9) Y="@140";18;@140;50;@99;
"KRN",.402,235,"DR",3,70.03,11)
S:'$D(RANUZD1) Y="@700";S RAREM="skip radio section if case' Img Typ's 'RADIO...USED' is NEVER";S:$P(^RAMIS(71,+RAPRI,0),U,2)=1 Y="@700";S RAIEN702=$$EN1^RANMPT1(RADFN,RADTE,RACN);S:RAIEN702=-1 Y="@700";500////^S X=RAIEN702;
"KRN",.402,235,"DR",3,70.03,12)
^70.2^RADPTN(^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^RADPT(D0,"DT",D1,"P",D2,0)):^(0),1:"") S X=$P(Y(1),U,28),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@700;S RA00=$O(^RADPTN("AA",RADFN,RADTE,RACN,0));S:'RA00 Y="@710";
"KRN",.402,235,"DR",3,70.03,13)
S:$O(^RADPTN(RA00,"NUC",0)) Y="@710";K RAIEN702;500///@;@710;S RACT=$S(RAQUICK:"C",1:"P");100///^S X="""NOW""";S RAREM="here, DIE is ^RADPT(-,'DT',-,'P',";S RA00=$O(@(DIE_DA_",""RX"","_"0)"));
"KRN",.402,235,"DR",3,70.03,14)
S RA00=$G(@(DIE_DA_",""RX"","_+RA00_",0)"));S:RA00]"" Y="@720";S RASKMEDS=$P(^RAMIS(71,+RAPRI,0),U,5) S:RASKMEDS=""!("Yy"'[RASKMEDS) Y="@790";@720;K RA65 S RA65="P";
"KRN",.402,235,"DR",3,70.03,15)
200///^S X=$$RXMEDIT^RAPSAPI3(.RA65,","_RACNI_","_RADTI_","_RADFN_",",70.03,200,RADTE);S:$G(RA65("RESULT"))'="" Y="MEDICATIONS";@790;K RA65;
"KRN",.402,235,"DR",4,70.04)
.01;2;
"KRN",.402,235,"DR",4,70.07)
2///^S X=RACT;3////^S X=RADUZ;4///^S X=RATCXX;S:RATCXX'="" Y="@18";4///@;K ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L",DA,"TCOM");@18;K RATCXX;
"KRN",.402,235,"DR",4,70.1)
.01
"KRN",.402,235,"DR",4,70.12)
.01
"KRN",.402,235,"DR",4,70.15)
S:$G(X)="" Y=0;.01///^S X=$$RXMEDIT^RAPSAPI3(.RA65,DA_","_RACNI_","_RADTI_","_RADFN_",");2;S:$P(RA00,U,3)="" Y="@740";3//^S X="NOW";@740;S:$P(RA00,U,4)="" Y="@750";4//^S X=$P($G(^VA(200,DUZ,0)),"^");@750;
"KRN",.402,235,"DR",4,70.2)
D DISDEF^RASTREQN(RAIEN702);K RA65 S RA65="R";100///^S X=$$RXMEDIT^RAPSAPI3(.RA65,","_DA_",",70.2,100,RADTE);S:$G(RA65("RESULT"))'="" Y="RADIOPHARMACEUTICALS";
"KRN",.402,235,"DR",4,70.3135)
.01
"KRN",.402,235,"DR",4,70.3225)
.01
"KRN",.402,235,"DR",5,70.21)
S:$G(X)="" Y=0;.01///^S X=$$RXMEDIT^RAPSAPI3(.RA65,DA_","_DA(1)_",");S RAPSDRUG=X;S:'$G(D0) Y="@500";S RAREM="NOTE: here, DIE is ^RADPTN(D0,'NUC',";S:DIE'[",""NUC""" Y="@500";S RA00=$G(@(DIE_DA_",0)"));S:RA00="" Y="@500";@210;
"KRN",.402,235,"DR",5,70.21,1)
S RADIOPH=$O(^RAMIS(71,$G(RAPRI),"NUC","B",+$G(RAPSDRUG),0)),(RALOW,RAHI,RADRAWN,RADOSE,RASKMEDS)="";S:'RADIOPH Y="@220";S RADIOPH=$G(^RAMIS(71,$G(RAPRI),"NUC",RADIOPH,0)),RALOW=$P(RADIOPH,U,6),RAHI=$P(RADIOPH,U,5);@220;
"KRN",.402,235,"DR",5,70.21,2)
S:$P(RA00,U,4)="" Y="@230";@225;W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !! W:RAHI]"" "High Dose :",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose :",RALOW_" mCi" W:$P(RADIOPH,U,2)]"" ?53,"Usual Dose :",$P(RADIOPH,U,2)_" mCi";
"KRN",.402,235,"DR",5,70.21,3)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !;4T~;S RADRAWN=X;S Y=$$VALDOS^RASTREQN(RALOW,RAHI,RADRAWN,"@225","@230","@999",0);@230;S:$P(RA00,U,5)="" Y="@240";5;@240;S:$P(RA00,U,6)="" Y="@250";6;@250;
"KRN",.402,235,"DR",5,70.21,4)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !! W:RAHI]"" "High Dose: ",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose: ",RALOW_" mCi" W:$P(RADIOPH,U,2)]"" ?53,"Usual Dose: ",$P(RADIOPH,U,2)," mCi";W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !;
"KRN",.402,235,"DR",5,70.21,5)
7T~//^S X=RADRAWN;S RADOSE=X;S:RALOW]""&(X<RALOW)&(X'="") Y="@255";S:RAHI]""&(X>RAHI) Y="@255";S Y="@258";@255;D WARN^RANMED1;R !!,"OK to continue (Y/N) ?: N//",RAASK;W !;S RAASK=$E(RAASK);S:"Yy"'[RAASK!(RAASK="") Y="@250";
"KRN",.402,235,"DR",5,70.21,6)
S RAREM="is fil 71's PROMPT FOR RADIOPHARM RX yes ?";@258;S RAASK=$P($G(^RAMIS(71,+RAPRI,0)),U,19) S:RAASK=""!("Yy"'[RAASK) Y="@270";@260;3;2T~;@270;8//^S X=$S($P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",5)]"":$P(^(0),"^",5),1:"NOW");
"KRN",.402,235,"DR",5,70.21,7)
9//^S X=$P(^VA(200,+$G(DUZ),0),U);@290;S:$P(RA00,U,6)="" Y="@310";6;@310;S RAREM="Note: 'RAASK' may not be defined, hit global for 'Prompt For Radiopharm RX'";S:$P($G(^RAMIS(71,RAPRI,0)),"^",19)'="y" Y="@320";10;@320;
"KRN",.402,235,"DR",5,70.21,8)
S:$P(RA00,U,11)="" Y="@330";11;@330;S:$P(RA00,U,12)="" Y="@335";12;@335;S:'$D(@(DIE_DA_",""SITX"")")) Y="@340";12.5;@340;S:$P(RA00,U,13)="" Y="@350";13;@350;S:$P(RA00,U,14)="" Y="@360";14;@360;S:$P(RA00,U,15)="" Y="@500";15;@500;
"KRN",.402,235,"ROUOLD")
RACTEX
"KRN",.402,244,-1)
0^3
"KRN",.402,244,0)
RA ORDER EXAM^3090917.083^^75.1^^^3091116
"KRN",.402,244,"%D",0)
^.4021^1^1^3070206^^^
"KRN",.402,244,"%D",1,0)
This template is used to request an imaging exam.
"KRN",.402,244,"DIAB",1,1,75.1125,0)
ALL
"KRN",.402,244,"DIAB",2,0,75.1,0)
2//^S X=$S($D(^RAMIS(71,RAPRI,0)):$P(^(0),U),1:"");REQ
"KRN",.402,244,"DIAB",2,0,75.1,9)
12//^S X="TODAY";T
"KRN",.402,244,"DIAB",2,0,75.1,15)
24//^S X="NO";T
"KRN",.402,244,"DIAB",3,0,75.1,2)
8;REQ
"KRN",.402,244,"DIAB",3,0,75.1,8)
9.5//^S X=$S($D(RARSH):RARSH,1:"");REQ
"KRN",.402,244,"DIAB",4,0,75.1,13)
21;REQ
"KRN",.402,244,"DIAB",5,0,75.1,16)
20;"SUBMIT REQUEST TO";REQ
"KRN",.402,244,"DIAB",6,0,75.1,8)
9//^S X=$S($D(RASHA):RASHA,1:"");REQ
"KRN",.402,244,"DIAB",7,0,75.1,13)
21//^S X=RAWHEN;REQ
"KRN",.402,244,"DIAB",11,0,75.1,13)
21///^S X=RAWHEN;REQ
"KRN",.402,244,"DR",1,75.1)
I '$D(RACAT)!('$D(RADFN))!('$D(RADIV))!('$D(RALIFN))!('$D(RAPIFN)) W !?3,$C(7),"Variables RACAT,RADFN,RADIV,RALIFN and RAPIFN must be defined!" S Y="@999";2R~//^S X=$S($D(^RAMIS(71,RAPRI,0)):$P(^(0),U),1:"");S RAPRI=X;
"KRN",.402,244,"DR",1,75.1,1)
S RAIMAG=$$ITYPE^RASITE(+RAPRI);S Y=$S('$D(^RA(79,+RADIV,.1)):"@2",$P(^(.1),"^",7)="Y"&($P(^RAMIS(71,RAPRI,0),"^",6)="B"):"@1",1:"@2");@1;W !?3,$C(7),"A 'detailed' procedure or a 'series' of procedures is required!" S Y="";@2;
"KRN",.402,244,"DR",1,75.1,2)
I $O(^RAMIS(71,RAPRI,3,0)) D EN2^RAPRI;I $P(^RAMIS(71,RAPRI,0),"^",11)'="y" S Y="@3";8R~;@3;I '$D(RAMOD) S Y="@7";S RAI="";@5;S RAI=$O(RAMOD(0)) I 'RAI S Y="@7";S RAMODPRO=+$O(^RAMIS(71.2,"B",$G(RAMOD(RAI)),0));
"KRN",.402,244,"DR",1,75.1,3)
S:'$D(^RAMIS(71.2,"AB",+$$ITYPE^RASITE(RAPRI),RAMODPRO)) Y="@8";125///^S X=RAMOD(RAI);@8;K RAMOD(RAI) S Y="@5";@7;125;^2.01;@9;3////^S X=$P(RAIMAG,U);S RACOMENT="reason for study (RAREAST) is required with patch 75" K RACOMENT;
"KRN",.402,244,"DR",1,75.1,4)
1.1//^S X=RAREAST;S RACOMENT="Clinical History is not longer required with patch 75." K RACOMENT;I $D(^RA(79,+RADIV,"HIS")) W !!?3,$C(7),^("HIS"),!;
"KRN",.402,244,"DR",1,75.1,5)
I $O(^TMP($J,"RAWP",0)) S ^RAO(75.1,DA,"H",0)=^(0) F RAI=1:1 Q:'$D(^TMP($J,"RAWP",RAI,0))  S ^RAO(75.1,DA,"H",RAI,0)=^(0);@10;400;I $D(DIRUT) S Y="@999";S:+$O(^RAO(75.1,DA,"H",0))=0 Y="@15";
"KRN",.402,244,"DR",1,75.1,6)
S RAWPFLAG=$$VALWP^RAUTL5("^RAO(75.1,"_DA_",""H"",");I 'RAWPFLAG W !!?3,$C(7),"Text must be at least two (2) alphanumeric characters in length.",! S Y="@10";
"KRN",.402,244,"DR",1,75.1,7)
I $P($G(^RAO(75.1,DA,"H",0)),U,3)>350 W ?3,$C(7),"Clinical History cannot exceed 350 lines!" S Y="@10";I $O(^RAO(75.1,DA,"H",0)) D UPDT^RAUTL3("^RAO(75.1,"_DA_",""H"",");@15;14////^S X=RAPIFN;4//^S X=RACAT;
"KRN",.402,244,"DR",1,75.1,8)
S Y=$E(X),Y=$S(Y="R":"@30",(Y'="")&("CS"[Y):"@40",1:"@50");@30;9.5R~//^S X=$S($D(RARSH):RARSH,1:"");S Y="@50";@40;9R~//^S X=$S($D(RASHA):RASHA,1:"");@50;22////^S X=RALIFN;@100;
"KRN",.402,244,"DR",1,75.1,9)
W !,"IS PATIENT SCHEDULED FOR PRE-OP" S %=2 D YN^DICN S:%<0 Y="@999" S:%=2 Y="@120" I '% W !!,"Enter 'YES' if patient is scheduled for pre-op, or 'NO' if not.",! S Y="@100";12T~//^S X="TODAY";S:$D(RAEXMUL) RAPREOP1=X;@120;
"KRN",.402,244,"DR",1,75.1,10)
S:RASEX="M" Y="@130";S RACOM="the following sets the value of Y based on SEX" K RACOM;S:RASEX'="F" Y=$$ASKSEX^RAUTL8();S RASEX="F";
"KRN",.402,244,"DR",1,75.1,11)
W:$D(RAOPT("ADDEXAM")) !,"PREGNANT AT TIME OF ORDER ENTRY: ",$S($G(RAPREG)="y":"YES",$G(RAPREG)="n":"NO",$G(RAPREG)="u":"UNKNOWN",1:"");S:$D(RAOPT("ADDEXAM")) Y="@1301";
"KRN",.402,244,"DR",1,75.1,12)
S:($$PTAGE^RAUTL8(RADFN,"")<12)!($$PTAGE^RAUTL8(RADFN,"")>55) Y="@130";S RAPAOE=$$PAOE^RAUTL8();S:'$G(RAPAOE) Y="@999";@1301;13////^S X=$G(RAPREG);@130;I '$D(RAVSTFLG)!('$D(RAVLEDTI)) S Y="@135";17///^S X=9999999.9999-RAVLEDTI;
"KRN",.402,244,"DR",1,75.1,13)
@135;S:($D(RAWHEN)#2)&($G(RADR1)) Y="@145";S:$D(RAWHEN)#2 Y="@140";21R~;S Y="@150";@140;21R~//^S X=RAWHEN;S Y="@150";@145;Q;21R~///^S X=RAWHEN;@150;S:$D(RAEXMUL)#2 RAWHEN=$$FMTE^XLFDT(X,1);
"KRN",.402,244,"DR",1,75.1,14)
5////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);18///^S X="NOW";S Y=$S('$D(^RA(79,+RADIV,.1)):"@160",$P(^(.1),"^",19)="y":"@155",1:"@160");@155;75///^S X="""NOW""";@160;19//^S X=$S($D(RAMT):$P(RAMT,"^",2),1:"AMBULATORY");
"KRN",.402,244,"DR",1,75.1,15)
S:$D(RAEXMUL) RAMT=X;24T~//^S X="NO";S:$D(RAEXMUL) RAIP=X;6//^S X="ROUTINE";S:$D(RAEXMUL) RARU=X;S:$$ORVR^RAORDU()<3 Y="@163";26//^S X="SERVICE CORRECTION";@163;W !;S RAREQLOC=$$ILOC^RAUTL18(RAPRI);I 'RAREQLOC S Y="@165";
"KRN",.402,244,"DR",1,75.1,16)
20////^S X=RAREQLOC;S Y="@170";@165;I '$D(RALOCFLG) S Y="@175";20R~SUBMIT REQUEST TO~;@170;S:$D(RAEXMUL) RAILOC=X;@175;S (RAFIN,RAFIN1)="";@999;K RAI,RAPRI,RAMOD,RAIMAG,RAWPFLAG,RAREQLOC,RAMODPRO;
"KRN",.402,244,"DR",2,75.1125)
.01
"KRN",.402,244,"DR",2,75.12)
2////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);3////^S X=DUZ;
"KRN",.402,244,"DR",2.01,75.1125)
.01;
"KRN",.402,244,"ROU")
^RACTOE
"KRN",.402,244,"ROUOLD")
RACTOE
"KRN",.402,1005,-1)
0^4
"KRN",.402,1005,0)
RA QUICK EXAM ORDER^3090917.0816^^75.1^^^3091119
"KRN",.402,1005,"%D",0)
^^2^2^2940607^
"KRN",.402,1005,"%D",1,0)
This template is used in conjunction with OE/RR for ordering imaging
"KRN",.402,1005,"%D",2,0)
exams.
"KRN",.402,1005,"DIAB",1,1,75.1125,0)
ALL
"KRN",.402,1005,"DIAB",2,0,75.1,5)
21;REQ
"KRN",.402,1005,"DIAB",3,0,75.1,1)
8;REQ
"KRN",.402,1005,"DIAB",5,0,75.1,5)
21//^S X=RAWHEN;REQ
"KRN",.402,1005,"DIAB",7,0,75.1,6)
20;"SUBMIT REQUEST TO";REQ
"KRN",.402,1005,"DIAB",8,0,75.1,5)
21///^S X=RAWHEN;REQ
"KRN",.402,1005,"DR",1,75.1)
I '$D(RAPRI) S Y="@10";2////^S X=RAPRI;S RAIMAG=$$ITYPE^RASITE(+RAPRI);S Y="@20";@10;D ^RAPRI;S:'$D(RAPRI) Y="@99";S:$E(RAPRI)="^"!('RAPRI) Y="@99";2////^S X=RAPRI;S RAIMAG=$$ITYPE^RASITE(+RAPRI);@20;
"KRN",.402,1005,"DR",1,75.1,1)
I $O(^RAMIS(71,RAPRI,3,0)) D EN2^RAPRI;I $S('$D(^RAMIS(71,RAPRI,0)):1,1:$P(^(0),"^",11)'="y") S Y="@23";8R~;@23;I '$D(RAMOD) S Y="@35";S RAI="";@25;S RAI=$O(RAMOD(0)) I 'RAI S Y="@35";
"KRN",.402,1005,"DR",1,75.1,2)
S RAMODPRO=+$O(^RAMIS(71.2,"B",$G(RAMOD(RAI)),0));S:'$D(^RAMIS(71.2,"AB",+$$ITYPE^RASITE(RAPRI),RAMODPRO)) Y="@30";125///^S X=RAMOD(RAI);@30;K RAMOD(RAI) S Y="@25";@35;4////^S X=$E(RACAT);I '$D(RAPREOP1) S Y="@40";
"KRN",.402,1005,"DR",1,75.1,3)
12///^S X=RAPREOP1;@40;I '$D(RAPREG) S Y="@50";13///^S X=RAPREG;@50;S RACOMENT="reason for study is required, clinical history is not with the release of 75" K RACOMENT;1.1////^S X=RAREAST;
"KRN",.402,1005,"DR",1,75.1,4)
I $O(^TMP($J,"RAWP",0)) S ^RAO(75.1,DA,"H",0)=^(0) F RAI=1:1 Q:'$D(^TMP($J,"RAWP",RAI,0))  S ^RAO(75.1,DA,"H",RAI,0)=^(0);I $O(^RAO(75.1,DA,"H",0)) D UPDT^RAUTL3("^RAO(75.1,"_DA_",""H"",");S:($D(RAWHEN)#2)&($G(RADR1)) Y="@550";
"KRN",.402,1005,"DR",1,75.1,5)
S:$D(RAWHEN)#2 Y="@545";21R~;S Y="@560";@545;21R~//^S X=RAWHEN;S Y="@560";@550;21R~///^S X=RAWHEN;@560;S:$D(RAEXMUL)#2 RAWHEN=$$FMTE^XLFDT(X,1);I $S('$D(RAILOC):1,'RAILOC:1,1:0) S Y="@60";20////^S X=RAILOC;S Y="@70";@60;
"KRN",.402,1005,"DR",1,75.1,6)
S RAREQLOC=$$ILOC^RAUTL18(RAPRI);I 'RAREQLOC S Y="@62";20////^S X=RAREQLOC;S Y="@67";@62;I '$D(RALOCFLG) S Y="@70";20R~SUBMIT REQUEST TO~;@67;S:$D(RAEXMUL) RAILOC=X;@70;3////^S X=$P(RAIMAG,U);14////^S X=RAPIFN;22////^S X=RALIFN;
"KRN",.402,1005,"DR",1,75.1,7)
5////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);18///^S X="NOW";75///^S X="""NOW""";I '$D(RAMT) S RAMT="a";19////^S X=$P(RAMT,"^");I '$D(RAIP) S RAIP="n";24////^S X=RAIP;I '$D(RARU) S RARU=9;6////^S X=RARU;
"KRN",.402,1005,"DR",1,75.1,8)
S:$$ORVR^RAORDU()<3 Y="@80";26////s;@80;S RAFIN=1;@99;K RAI,RAPRI,RAMOD,RAIMAG,RAREQLOC,RAMODPRO;
"KRN",.402,1005,"DR",2,75.1125)
.01
"KRN",.402,1005,"DR",2,75.12)
2////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);3////^S X=DUZ;
"KRN",.402,1005,"ROU")
^RACTQE
"KRN",.402,1005,"ROUOLD")
RACTQE
"KRN",19,11734,-1)
0^6
"KRN",19,11734,0)
RA PERFORMIN RPTS^Summary/Detail report^^R^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,11734,1,0)
^19.06^19^19^3030408^^^
"KRN",19,11734,1,1,0)
This option allows the supervisor to generate a report of performance 
"KRN",19,11734,1,2,0)
indicators for a user specified date range.  The indicators are hours from
"KRN",19,11734,1,3,0)
EXAM DATE to DATE REPORT ENTERED and hours from EXAM DATE to VERIFIED
"KRN",19,11734,1,4,0)
DATE.  The summary report will group the hours within the date range
"KRN",19,11734,1,5,0)
into 24 hour increments. The detail report will list each exam within the
"KRN",19,11734,1,6,0)
date range.
"KRN",19,11734,1,7,0)
 
"KRN",19,11734,1,8,0)
Here are all the prompts  for this option:
"KRN",19,11734,1,9,0)
   1.  Report Type: Summary, Detail, Both
"KRN",19,11734,1,10,0)
   2.  Start Date (earliest Exam Date to include)
"KRN",19,11734,1,11,0)
   3.  End Date (last Exam Date to include)
"KRN",19,11734,1,12,0)
         for Summary report, this must be 90 days or less from Start Date
"KRN",19,11734,1,13,0)
         for Detail report, this must be 30 days or lss from Start Date
"KRN",19,11734,1,14,0)
   4.  Division:
"KRN",19,11734,1,15,0)
   5.  Imaging Type:
"KRN",19,11734,1,16,0)
   6.  Sort by:
"KRN",19,11734,1,17,0)
         this is asked only if 'Detail' or 'Both' were selected
"KRN",19,11734,1,18,0)
   7.  Sent to Mail Group? :
"KRN",19,11734,1,19,0)
         this is asked only if 'Summary' was selected
"KRN",19,11734,25)
RAPM
"KRN",19,11734,"U")
SUMMARY/DETAIL REPORT
"KRN",19,11743,-1)
0^8
"KRN",19,11743,0)
RA PERFORMIN MAIL GROUP ENTRY^Enter/Edit OUTLOOK mail group^^R^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,11743,1,0)
^^4^4^3030408^
"KRN",19,11743,1,1,0)
This option must be used to enter, delete, or add OUTLOOK mail groups
"KRN",19,11743,1,2,0)
that will receive the Summary Report for Performance Indicator.  If no
"KRN",19,11743,1,3,0)
mail group is entered, then the Summary Report will not be sent to anyone
"KRN",19,11743,1,4,0)
in OUTLOOK.
"KRN",19,11743,25)
EN1^RAPM3
"KRN",19,11743,"U")
ENTER/EDIT OUTLOOK MAIL GROUP
"KRN",19,11947,-1)
0^3
"KRN",19,11947,0)
RA PERFORMIN TASKLM^Run Previous Quarter's Summary Report^^R^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,11947,1,0)
^^5^5^3090319^
"KRN",19,11947,1,1,0)
This option is used to run the 'Summary Performance Indicator Report' for
"KRN",19,11947,1,2,0)
the previous quarter as a background task.  It will send the output to
"KRN",19,11947,1,3,0)
Outlook mail groups defined in File 79's PERF INDC SMTP E-MAIL ADDRESS
"KRN",19,11947,1,4,0)
multiple field.  There is only one user prompt:
"KRN",19,11947,1,5,0)
    Requested Start Time: NOW//
"KRN",19,11947,25)
TASKLM^RAPM3
"KRN",19,11947,"U")
RUN PREVIOUS QUARTER'S SUMMARY
"KRN",19,12478,-1)
0^10
"KRN",19,12478,0)
RA TIMELINESS REPORT^Summary/Detail report^^R^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,12478,1,0)
^19.06^7^7^3090626^^
"KRN",19,12478,1,1,0)
This option allows the supervisor to generate a report of timeliness of 
"KRN",19,12478,1,2,0)
performing outpatient Radiology orders for a user specified date range, 
"KRN",19,12478,1,3,0)
where the beginning and ending date is the Exam Date.  The timeliness is
"KRN",19,12478,1,4,0)
measured in days, from the Desired Date of the order as entered by the
"KRN",19,12478,1,5,0)
clinician, to the Exam Date as entered by the technician.  The summary
"KRN",19,12478,1,6,0)
report will group the days within the date range into 30 day increments.  
"KRN",19,12478,1,7,0)
The detail report will list each exam within the date range.
"KRN",19,12478,25)
RAPMW
"KRN",19,12478,"U")
SUMMARY/DETAIL REPORT
"KRN",19,12479,-1)
0^9
"KRN",19,12479,0)
RA TIMELINESS OUTPATIENT MENU^Outpatient Procedure Wait Time^^M^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,12479,1,0)
^^1^1^3051228^
"KRN",19,12479,1,1,0)
This menu is used for the Outpatient Wait Times reports.
"KRN",19,12479,10,0)
^19.01IP^1^1
"KRN",19,12479,10,1,0)
12478
"KRN",19,12479,10,1,"^")
RA TIMELINESS REPORT
"KRN",19,12479,99)
61485,29749
"KRN",19,12479,"U")
OUTPATIENT PROCEDURE WAIT TIME
"KRN",19,12480,-1)
0^4
"KRN",19,12480,0)
RA TIMELINESS MENU^Timeliness Reports^^M^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,12480,1,0)
^19.06^4^4^3090713^^^
"KRN",19,12480,1,1,0)
This menu is for timeliness reporting.  It has 3 submenus:
"KRN",19,12480,1,2,0)
 'Verification Timeliness' (formerly called 'Performance Indicators'), 
"KRN",19,12480,1,3,0)
'Outpatient Procedure Wait Time' and 'RadiologyTimeliness Performance 
"KRN",19,12480,1,4,0)
Reports'.
"KRN",19,12480,10,0)
^19.01IP^4^3
"KRN",19,12480,10,2,0)
12479^^1
"KRN",19,12480,10,2,"^")
RA TIMELINESS OUTPATIENT MENU
"KRN",19,12480,10,3,0)
12481^^2
"KRN",19,12480,10,3,"^")
RA TIMELINESS VER MENU
"KRN",19,12480,10,4,0)
12955^^3
"KRN",19,12480,10,4,"^")
RA TIMELINESS PERFORMANCE MENU
"KRN",19,12480,99)
61538,37005
"KRN",19,12480,"U")
TIMELINESS REPORTS
"KRN",19,12481,-1)
0^5
"KRN",19,12481,0)
RA TIMELINESS VER MENU^Verification Timeliness^^M^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,12481,1,0)
^19.06^2^2^3090713^^^^
"KRN",19,12481,1,1,0)
This menu was previously called 'Performance Indicator'.  It includes the 
"KRN",19,12481,1,2,0)
same input and output options for Performance Indicators.
"KRN",19,12481,10,0)
^19.01IP^2^1
"KRN",19,12481,10,2,0)
11734
"KRN",19,12481,10,2,"^")
RA PERFORMIN RPTS
"KRN",19,12481,99)
61538,37222
"KRN",19,12481,"U")
VERIFICATION TIMELINESS
"KRN",19,12955,-1)
0^1
"KRN",19,12955,0)
RA TIMELINESS PERFORMANCE MENU^Radiology Timeliness Performance Reports^^M^^^^^^^^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,12955,1,0)
^19.06^2^2^3090722^^^
"KRN",19,12955,1,1,0)
This is the timeliness reporting menu.  It has 2 sub-menus: Enter/Edit 
"KRN",19,12955,1,2,0)
OUTLOOK mail group and Run Previous Quarter's Summary Report.
"KRN",19,12955,10,0)
^19.01IP^2^2
"KRN",19,12955,10,1,0)
11743
"KRN",19,12955,10,1,"^")
RA PERFORMIN MAIL GROUP ENTRY
"KRN",19,12955,10,2,0)
11947
"KRN",19,12955,10,2,"^")
RA PERFORMIN TASKLM
"KRN",19,12955,99)
61485,29749
"KRN",19,12955,"U")
RADIOLOGY TIMELINESS PERFORMAN
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
99^3091120
"PKG",18,22,1,"PAH",1,1,0)
^^3^3^3091120
"PKG",18,22,1,"PAH",1,1,1,0)
Patch ninety-nine for the Radiology/Nuclear Medicine 5.0 software.  
"PKG",18,22,1,"PAH",1,1,2,0)
Please review the Description and Installation Instructions for RA*5.0*99
"PKG",18,22,1,"PAH",1,1,3,0)
before installing this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
23
"RTN","RACMP1")
0^6^B27836976^B20423099
"RTN","RACMP1",1,0)
RACMP1 ;HISC/GJC,RVD-Complication Report (Part 2 of 3) ;05/13/09  11:08
"RTN","RACMP1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**99**;Mar 16, 1998;Build 5
"RTN","RACMP1",3,0)
 ;Supported IA #10103 reference to ^XLFDT
"RTN","RACMP1",4,0)
 ;Supported IA #2056 reference to ^DIQ
"RTN","RACMP1",5,0)
 ;Supported IA #10060 reference to ^VA(200
"RTN","RACMP1",6,0)
PRINT ; Output subroutine part one
"RTN","RACMP1",7,0)
 N I,J,RADATE,RAINVDT,RALBL,RALN1,RATECH
"RTN","RACMP1",8,0)
 S RA1="",RALBL="Description: ",RALN1=$TR(RALN,$E(RALN),"=")
"RTN","RACMP1",9,0)
 F  S RA1=$O(^TMP($J,"RACMP",RA1)) Q:RA1']""  D  Q:RAXIT
"RTN","RACMP1",10,0)
 . S RADIV=RA1,RADIV("X")=$P($G(^DIC(4,RADIV,0)),"^"),RA2=""
"RTN","RACMP1",11,0)
 . F  S RA2=$O(^TMP($J,"RACMP",RA1,RA2)) Q:RA2']""  D  Q:RAXIT
"RTN","RACMP1",12,0)
 .. S RAITYPE=RA2,RA3=""
"RTN","RACMP1",13,0)
 .. F  S RA3=$O(^TMP($J,"RACMP",RA1,RA2,RA3)) Q:RA3']""  D  Q:RAXIT
"RTN","RACMP1",14,0)
 ... S RA4=0
"RTN","RACMP1",15,0)
 ... F  S RA4=$O(^TMP($J,"RACMP",RA1,RA2,RA3,RA4)) Q:'RA4  D  Q:RAXIT
"RTN","RACMP1",16,0)
 .... S RA5=0
"RTN","RACMP1",17,0)
 .... F  S RA5=$O(^TMP($J,"RACMP",RA1,RA2,RA3,RA4,RA5)) Q:'RA5  D  Q:RAXIT
"RTN","RACMP1",18,0)
 ..... S RA0=$G(^TMP($J,"RACMP",RA1,RA2,RA3,RA4,RA5))
"RTN","RACMP1",19,0)
 ..... D:RA0]"" PRT1
"RTN","RACMP1",20,0)
 ..... Q
"RTN","RACMP1",21,0)
 .... Q
"RTN","RACMP1",22,0)
 ... Q
"RTN","RACMP1",23,0)
 .. D:'RAXIT IMGCHK
"RTN","RACMP1",24,0)
 .. Q
"RTN","RACMP1",25,0)
 . D:'RAXIT DIVCHK
"RTN","RACMP1",26,0)
 . Q
"RTN","RACMP1",27,0)
 Q
"RTN","RACMP1",28,0)
PRT1 ; Output subroutine two
"RTN","RACMP1",29,0)
 F I=1:1:9 D
"RTN","RACMP1",30,0)
 . S @$P("RAPRC^RATME^RAPHY^RARES^RASTF^RACMPTX^RACOMP^RASSN^RADFN","^",I)=$P(RA0,"^",I)
"RTN","RACMP1",31,0)
 . Q
"RTN","RACMP1",32,0)
 S RADATE=$$FMTE^XLFDT(RA4,"2D"),RAINVDT=9999999.9999-RA4
"RTN","RACMP1",33,0)
 I $Y>(IOSL-4) D  Q:RAXIT
"RTN","RACMP1",34,0)
 . S:$E(IOST,1,2)="C-" RAXIT=$$EOS^RAUTL5() D:'RAXIT HEADER^RACMP2
"RTN","RACMP1",35,0)
 . Q
"RTN","RACMP1",36,0)
 I IOM=132 D
"RTN","RACMP1",37,0)
 . W !,RA3,?RATAB(2),RASSN,?RATAB(3),RADATE,?RATAB(4),RAPRC
"RTN","RACMP1",38,0)
 . W ?RATAB(5),"Physician: ",RAPHY,!?RATAB(3),RATME,?RATAB(4),RACOMP
"RTN","RACMP1",39,0)
 . W ?RATAB(5),"Interpreting Res. : ",RARES
"RTN","RACMP1",40,0)
 . W !?RATAB(5),"Staff Imaging Phys. : ",RASTF
"RTN","RACMP1",41,0)
 . I +$O(^RADPT(RADFN,"DT",RAINVDT,"P",RA5,"TC",0)) S I=0 D  Q:RAXIT
"RTN","RACMP1",42,0)
 .. F  S I=$O(^RADPT(RADFN,"DT",RAINVDT,"P",RA5,"TC",I)) Q:'I  D  Q:RAXIT
"RTN","RACMP1",43,0)
 ... S J=$G(^RADPT(RADFN,"DT",RAINVDT,"P",RA5,"TC",I,0))
"RTN","RACMP1",44,0)
 ... S RATECH=$E($P($G(^VA(200,+J,0)),"^"),1,20)
"RTN","RACMP1",45,0)
 ... I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() D:'RAXIT HEADER^RACMP2
"RTN","RACMP1",46,0)
 ... W:'RAXIT !?RATAB(5),"Tech: ",RATECH
"RTN","RACMP1",47,0)
 ... Q
"RTN","RACMP1",48,0)
 .. Q
"RTN","RACMP1",49,0)
 . D PRSC
"RTN","RACMP1",50,0)
 . W:'RAXIT !,RALBL,RACMPTX,!,RALN1
"RTN","RACMP1",51,0)
 . Q
"RTN","RACMP1",52,0)
 E  D  ; Assume 80
"RTN","RACMP1",53,0)
 . W !,RA3,?RATAB(3),RADATE,?RATAB(4),RAPRC,!,RASSN,?RATAB(3),RATME
"RTN","RACMP1",54,0)
 . W ?RATAB(4),RACOMP
"RTN","RACMP1",55,0)
 . W !?RATAB(1),"Physician: ",RAPHY
"RTN","RACMP1",56,0)
 . W !?RATAB(1),"Interpreting Res. : ",RARES
"RTN","RACMP1",57,0)
 . W !?RATAB(1),"Staff Imaging Phys. : ",RASTF
"RTN","RACMP1",58,0)
 . I +$O(^RADPT(RADFN,"DT",RAINVDT,"P",RA5,"TC",0)) S I=0 D
"RTN","RACMP1",59,0)
 .. F  S I=$O(^RADPT(RADFN,"DT",RAINVDT,"P",RA5,"TC",I)) Q:'I  S J=^(I,0) D
"RTN","RACMP1",60,0)
 ... S RATECH=$E($P($G(^VA(200,+J,0)),"^"),1,20)
"RTN","RACMP1",61,0)
 ... W !?RATAB(1),"Tech: ",RATECH
"RTN","RACMP1",62,0)
 ... Q
"RTN","RACMP1",63,0)
 .. Q
"RTN","RACMP1",64,0)
 . D PRSC
"RTN","RACMP1",65,0)
 . W !,RALBL,$E(RACMPTX,1,65)
"RTN","RACMP1",66,0)
 . W:$E(RALBL,66,100)]"" !?$L(RALBL),$E(RALBL,66,100) W !,RALN1
"RTN","RACMP1",67,0)
 . Q
"RTN","RACMP1",68,0)
 Q
"RTN","RACMP1",69,0)
PRSC ;DISPLAY pregnancy screen and comment, patch 99
"RTN","RACMP1",70,0)
 I $$PTSEX^RAUTL8(RADFN)="F" D
"RTN","RACMP1",71,0)
 .N RAOR751 S RAOR751=$P($G(^RADPT(RADFN,"DT",$G(RAINVDT),"P",$G(RA5),0)),U,11)
"RTN","RACMP1",72,0)
 .W !,"Pregnant at time of order entry: ",$$GET1^DIQ(75.1,$G(RAOR751)_",",13)
"RTN","RACMP1",73,0)
 .N R3,RAPCOMM S R3=$G(^RADPT(RADFN,"DT",$G(RAINVDT),"P",$G(RA5),0))
"RTN","RACMP1",74,0)
 .S RAPCOMM=$G(^RADPT(RADFN,"DT",+$G(RAINVDT),"P",+$G(RA5),"PCOMM"))
"RTN","RACMP1",75,0)
 .W:$P(R3,U,32)'="" !,"Pregnancy Screen: ",$S($P(R3,"^",32)="y":"Patient answered yes",$P(R3,"^",32)="n":"Patient answered no",$P(R3,"^",32)="u":"Patient is unable to answer or is unsure",1:"")
"RTN","RACMP1",76,0)
 .W:$P(R3,U,32)'="n"&$L(RAPCOMM) !,"Pregnancy Screen Comment: ",RAPCOMM
"RTN","RACMP1",77,0)
 Q
"RTN","RACMP1",78,0)
 ;
"RTN","RACMP1",79,0)
DIVCHK ; Output statistics within division, check for EOS on division
"RTN","RACMP1",80,0)
 N RA6
"RTN","RACMP1",81,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() D:'RAXIT HEADER^RACMP2 Q:RAXIT
"RTN","RACMP1",82,0)
 W !!?5,"Division: "_RADIV("X")
"RTN","RACMP1",83,0)
 W !,"Complications: ",+$G(^TMP($J,"RACOMP",RADIV))
"RTN","RACMP1",84,0)
 W "   Exams: ",+$G(^TMP($J,"RAEXAM",RADIV)),"   % Complications: "
"RTN","RACMP1",85,0)
 I +$G(^TMP($J,"RAEXAM",RADIV))=0 W "0"
"RTN","RACMP1",86,0)
 E  W $J((+$G(^TMP($J,"RACOMP",RADIV))/+$G(^TMP($J,"RAEXAM",RADIV)))*100,6,2)
"RTN","RACMP1",87,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() D:'RAXIT HEADER^RACMP2 Q:RAXIT
"RTN","RACMP1",88,0)
 W !,"Contrast Media Complications: ",+$G(^TMP($J,"RACMRE",RADIV))
"RTN","RACMP1",89,0)
 W "   C.M. Exams: ",+$G(^TMP($J,"RACOMP",RADIV))
"RTN","RACMP1",90,0)
 W "   % C.M. Comp.: "
"RTN","RACMP1",91,0)
 I +$G(^TMP($J,"RACOMP",RADIV))=0 W "0"
"RTN","RACMP1",92,0)
 E  W $J((+$G(^TMP($J,"RACMRE",RADIV))/+$G(^TMP($J,"RACOMP",RADIV)))*100,6,2)
"RTN","RACMP1",93,0)
 S RA6=+$O(^TMP($J,"RACMP",RA1))
"RTN","RACMP1",94,0)
 I RA6 S RADIV=RA6,RADIV("X")=$P($G(^DIC(4,RADIV,0)),"^") D
"RTN","RACMP1",95,0)
 . N RA7 S RA7=$O(^TMP($J,"RACMP",RADIV,"")) S:RA7]"" RAITYPE=RA7
"RTN","RACMP1",96,0)
 . S:$E(IOST,1,2)="C-" RAXIT=$$EOS^RAUTL5() D:'RAXIT HEADER^RACMP2
"RTN","RACMP1",97,0)
 . Q
"RTN","RACMP1",98,0)
 Q
"RTN","RACMP1",99,0)
IMGCHK ; Check for EOS on I-Type
"RTN","RACMP1",100,0)
 N RA10
"RTN","RACMP1",101,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() D:'RAXIT HEADER^RACMP2 Q:RAXIT
"RTN","RACMP1",102,0)
 W !,"Complications: ",+$G(^TMP($J,"RACOMP",RADIV,RAITYPE))
"RTN","RACMP1",103,0)
 W "   Exams: ",+$G(^TMP($J,"RAEXAM",RADIV,RAITYPE))
"RTN","RACMP1",104,0)
 W "   % Complications: "
"RTN","RACMP1",105,0)
 I +$G(^TMP($J,"RAEXAM",RADIV,RAITYPE))=0 W "0"
"RTN","RACMP1",106,0)
 E  W $J((+$G(^TMP($J,"RACOMP",RADIV,RAITYPE))/+$G(^TMP($J,"RAEXAM",RADIV,RAITYPE)))*100,6,2)
"RTN","RACMP1",107,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() D:'RAXIT HEADER^RACMP2 Q:RAXIT
"RTN","RACMP1",108,0)
 W !,"Contrast Media Complications: ",+$G(^TMP($J,"RACMRE",RADIV,RAITYPE))
"RTN","RACMP1",109,0)
 W "   C.M. Exams: ",+$G(^TMP($J,"RACOMP",RADIV,RAITYPE))
"RTN","RACMP1",110,0)
 W "   % C.M. Comp.: "
"RTN","RACMP1",111,0)
 I +$G(^TMP($J,"RACOMP",RADIV,RAITYPE))=0 W "0"
"RTN","RACMP1",112,0)
 E  W $J((+$G(^TMP($J,"RACMRE",RADIV,RAITYPE))/+$G(^TMP($J,"RACOMP",RADIV,RAITYPE)))*100,6,2)
"RTN","RACMP1",113,0)
 S RA10=$O(^TMP($J,"RACMP",RA1,RA2))
"RTN","RACMP1",114,0)
 I RA10]"" S RAITYPE=RA10 D
"RTN","RACMP1",115,0)
 . S:$E(IOST,1,2)="C-" RAXIT=$$EOS^RAUTL5() D:'RAXIT HEADER^RACMP2
"RTN","RACMP1",116,0)
 . Q
"RTN","RACMP1",117,0)
 Q
"RTN","RAORD1A")
0^9^B11368000^B8492484
"RTN","RAORD1A",1,0)
RAORD1A ;HISC/FPT-Request an Exam ;05/05/09  07:45
"RTN","RAORD1A",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,86,99**;Mar 16, 1998;Build 5
"RTN","RAORD1A",3,0)
 ;
"RTN","RAORD1A",4,0)
 ;Call to WIN^DGPMDDCF (Supported IA #1246) from the SCREENW function
"RTN","RAORD1A",5,0)
 ;Supported IA #10039 reference to ^DIC(42
"RTN","RAORD1A",6,0)
 ;Supported IA #10040 reference to ^SC
"RTN","RAORD1A",7,0)
 ;Supported IA #10061 reference to ^VADPT
"RTN","RAORD1A",8,0)
 ;Supported IA #10103 reference to ^XLFDT
"RTN","RAORD1A",9,0)
 ;Supported IA #2056 reference to ^DIQ
"RTN","RAORD1A",10,0)
 ;
"RTN","RAORD1A",11,0)
SCREEN(RAINPAT,RACPRS27) ; screen for active clinics/wards
"RTN","RAORD1A",12,0)
 ; This code is also called from RAORD1 (screen for the Patient Location
"RTN","RAORD1A",13,0)
 ; prompt which is a pointer to the HOSPITAL LOCATION (#44) file.)
"RTN","RAORD1A",14,0)
 ; We want to EXCLUDE from our selection the following types of
"RTN","RAORD1A",15,0)
 ; hospital locations:
"RTN","RAORD1A",16,0)
 ;
"RTN","RAORD1A",17,0)
 ;  1) Occasion of Service (OOS) locations (fld: 50.01) 'OOS' node
"RTN","RAORD1A",18,0)
 ;  2) File Area ("F") or Imaging ("I") locations (fld: 2)
"RTN","RAORD1A",19,0)
 ;  3) Inactivate Date (fld: 2505) 'I' node
"RTN","RAORD1A",20,0)
 ;
"RTN","RAORD1A",21,0)
 ; input: RAINPAT=1 if the patient is an inpatient located on a ward, else 0.
"RTN","RAORD1A",22,0)
 ;        RACPRS27=1 if the environment is running CPRS GUI v27, else 0.
"RTN","RAORD1A",23,0)
 ;
"RTN","RAORD1A",24,0)
 Q:$D(^SC(+Y,"OOS"))#2 0 ; #1
"RTN","RAORD1A",25,0)
 N RA44 S RA44=$G(^SC(+Y,0)),RA44(42)=$P($G(^SC(+Y,42)),U)
"RTN","RAORD1A",26,0)
 Q:"^F^I^"[(U_$P(RA44,U,3)_U) 0 ; #2
"RTN","RAORD1A",27,0)
 ;
"RTN","RAORD1A",28,0)
 ; if the hospital location is defined as a ward set RAWARD to 1, else 0
"RTN","RAORD1A",29,0)
 N RAWARD S RAWARD=0
"RTN","RAORD1A",30,0)
 ;check the pointer to the WARD LOCATION file.
"RTN","RAORD1A",31,0)
 I RA44(42)>0 D  Q:RAWARD=-1 0
"RTN","RAORD1A",32,0)
 .;Error; the HOSPITAL LOCATION cannot be of TYPE 'Clinic' & point to a ward
"RTN","RAORD1A",33,0)
 .I $P(RA44,U,3)="C" S RAWARD=-1 Q
"RTN","RAORD1A",34,0)
 .;Error; bad pointers between files 42 & 44
"RTN","RAORD1A",35,0)
 .I $P($G(^DIC(42,RA44(42),44)),U)'=+Y S RAWARD=-1 Q
"RTN","RAORD1A",36,0)
 .;ok, set ward flag...
"RTN","RAORD1A",37,0)
 .S RAWARD=1
"RTN","RAORD1A",38,0)
 .Q
"RTN","RAORD1A",39,0)
 ;
"RTN","RAORD1A",40,0)
 ; 1) if the hospital location is a ward check if we should screen by ward
"RTN","RAORD1A",41,0)
 ; 2) the hosp location=ward, facility is running v26, and we have an
"RTN","RAORD1A",42,0)
 ;    outpatient quit zero (default of the $S)
"RTN","RAORD1A",43,0)
 I RAWARD  Q $S(RACPRS27!RAINPAT:$$SCREENW(+Y),1:0)
"RTN","RAORD1A",44,0)
 ;
"RTN","RAORD1A",45,0)
 ; if the hospital location is a clinic, we have an inpatient, and the
"RTN","RAORD1A",46,0)
 ; facility is not running CPRS v27 return 0
"RTN","RAORD1A",47,0)
 I 'RACPRS27,(RAINPAT) Q 0
"RTN","RAORD1A",48,0)
 ;
"RTN","RAORD1A",49,0)
 ; Check INACTIVATE DATE against REACTIVATE DATE
"RTN","RAORD1A",50,0)
 ; inactivate date = reactivate date (allow)
"RTN","RAORD1A",51,0)
 ; inactivate date > reactivate date (disallow)
"RTN","RAORD1A",52,0)
 ; inactivate date < reactivate date (allow)
"RTN","RAORD1A",53,0)
 ;
"RTN","RAORD1A",54,0)
 N RASCA,RASCI,RASCINDE S RASCINDE=$G(^SC(+Y,"I"))
"RTN","RAORD1A",55,0)
 S RASCI=+$P(RASCINDE,U),RASCA=+$P(RASCINDE,U,2)
"RTN","RAORD1A",56,0)
 ;
"RTN","RAORD1A",57,0)
 Q $S(RASCI'>0:1,RASCI>DT:1,1:RASCI'>RASCA)
"RTN","RAORD1A",58,0)
 ;
"RTN","RAORD1A",59,0)
SCREENW(Y) ; check the out-of-service field of the WARD LOCATION (#42) record.
"RTN","RAORD1A",60,0)
 ;input Y: ien of the HOSPITAL LOCATION record
"RTN","RAORD1A",61,0)
 ; RAWHEN: DATE DESIRED (Not guaranteed) (file: 75.1, fld: 21) optional
"RTN","RAORD1A",62,0)
 ;output : '0' if not valid, else '1' if valid 
"RTN","RAORD1A",63,0)
 N D0,DGPMOS,X
"RTN","RAORD1A",64,0)
 S D0=+$G(^SC(Y,42))
"RTN","RAORD1A",65,0)
 Q:'D0 0
"RTN","RAORD1A",66,0)
 Q:'($D(^DIC(42,D0,0))#2) 0
"RTN","RAORD1A",67,0)
 ;
"RTN","RAORD1A",68,0)
 ;WIN^DGPMDDCF (Supported IA #1246) Is the ward active?
"RTN","RAORD1A",69,0)
 ; Input
"RTN","RAORD1A",70,0)
 ;  D0 "Dee zero" (req): IEN of WARD LOCATION file.  
"RTN","RAORD1A",71,0)
 ;  DGPMOS (opt): defaults to DT. Is the ward in service on this date?  
"RTN","RAORD1A",72,0)
 ; Output
"RTN","RAORD1A",73,0)
 ;  X: 1 if out of service, 0 if in service, or -1 if input variables
"RTN","RAORD1A",74,0)
 ;     not defined properly. Be careful; note the difference in their
"RTN","RAORD1A",75,0)
 ;     boolean definition ('0'=success) and ours ('0'=failure)
"RTN","RAORD1A",76,0)
 ;
"RTN","RAORD1A",77,0)
 S:$D(RAWHEN)#2 DGPMOS=$P(RAWHEN,".",1)
"RTN","RAORD1A",78,0)
 D WIN^DGPMDDCF
"RTN","RAORD1A",79,0)
 Q 'X  ;alter 'X' (the WIN^DGPMDDCF output value) to meet our ($$SCREENW) output definition
"RTN","RAORD1A",80,0)
 ;
"RTN","RAORD1A",81,0)
PREG(RADFN,RADT) ; Subroutine will display the pregnancy prompt to the
"RTN","RAORD1A",82,0)
 ; user if the patient is between the ages of 12 - 55 inclusive.
"RTN","RAORD1A",83,0)
 ; Called from CREATE1^RAORD1.
"RTN","RAORD1A",84,0)
 ; Input : RADFN - Patient, RADT - Today's date
"RTN","RAORD1A",85,0)
 ; Output: Patient Pregnant? (yes, no, unknown or no default)
"RTN","RAORD1A",86,0)
 ;   Note: (may set RAOUT if the user times out or '^' out)
"RTN","RAORD1A",87,0)
 Q:RASEX'="F" "" ; not a female
"RTN","RAORD1A",88,0)
 S:RADT="" RADT=$$DT^XLFDT()
"RTN","RAORD1A",89,0)
 N RADAYS,VADM D DEM^VADPT ; $P(VADM(3),"^") DOB of patient, internal
"RTN","RAORD1A",90,0)
 S RADAYS=$$FMDIFF^XLFDT(RADT,$P(VADM(3),"^"),3)   ;P#99 correct/replace variable RAWHEN to RADT
"RTN","RAORD1A",91,0)
 Q:((RADAYS\365.25)<12) "" ; too young
"RTN","RAORD1A",92,0)
 Q:((RADAYS\365.25)>55) "" ; too old
"RTN","RAORD1A",93,0)
 ;if RA ADDEXAM option, display and copy pregnany status from previous active order
"RTN","RAORD1A",94,0)
 I $D(RAOPT("ADDEXAM")) W !,"PREGNANT AT TIME OF ORDER ENTRY: ",$$GET1^DIQ(75.1,$$PRACTO^RAUTL8(RADFN),13) Q $$GET1^DIQ(75.1,$$PRACTO^RAUTL8(RADFN),13,"I")
"RTN","RAORD1A",95,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT S DIR(0)="75.1,13",DIR("A")="PREGNANT AT TIME OF ORDER ENTRY" D ^DIR
"RTN","RAORD1A",96,0)
 S:$D(DIRUT) RAOUT="^" Q:$D(RAOUT) ""
"RTN","RAORD1A",97,0)
 Q $P(Y,"^")
"RTN","RAORD1A",98,0)
 ;
"RTN","RAORD1A",99,0)
INIMOD(Y) ; check if the user has selected the same
"RTN","RAORD1A",100,0)
 ; modifier more than once when the order is requested.
"RTN","RAORD1A",101,0)
 ; The 'Request an Exam' option.  Called from MODS^RAORD1
"RTN","RAORD1A",102,0)
 ; Input: 'Y' the name of the procedure modifier
"RTN","RAORD1A",103,0)
 ; Output: 'X' if the user has not entered this modifier in
"RTN","RAORD1A",104,0)
 ;             the past return one (1).  Else return zero (0).
"RTN","RAORD1A",105,0)
 Q:'$D(RAMOD) 1 ; must allow the selection of the first modifier
"RTN","RAORD1A",106,0)
 ; after this, it is assumed that the RAMOD array is defined.
"RTN","RAORD1A",107,0)
 N RACNT,X S X=1,RACNT=99999
"RTN","RAORD1A",108,0)
 F  S RACNT=$O(RAMOD(RACNT),-1) Q:RACNT=""!(X=0)  S:RAMOD(RACNT)=Y X=0
"RTN","RAORD1A",109,0)
 Q X
"RTN","RAORD1A",110,0)
 ;
"RTN","RAORD3")
0^7^B27635880^B24685743
"RTN","RAORD3",1,0)
RAORD3 ;HISC/CAH - AISC/RMO-Detailed Request Display Cont. ;05/05/09  10:31
"RTN","RAORD3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,15,21,27,45,41,75,99**;Mar 16, 1998;Build 5
"RTN","RAORD3",3,0)
 ;Supported IA #2056 reference to ^DIQ
"RTN","RAORD3",4,0)
 ;Supported IA #10103 reference to ^XLFDT
"RTN","RAORD3",5,0)
 I $$PTSEX^RAUTL8(RADFN)="F" D  ;display pregnancy status for females ptch 45, P#99 changed Pregnancy title.'Pregnancy Screen:' field. This field shall be a display-only field
"RTN","RAORD3",6,0)
 .W !,"Pregnant at time of order entry: ",?22,$S($P(RAORD0,"^",13)="y":"YES",$P(RAORD0,"^",13)="n":"NO",1:"UNKNOWN")
"RTN","RAORD3",7,0)
 .N RA700332,RA700380
"RTN","RAORD3",8,0)
 .S RA700332=$$GET1^DIQ(70.03,$G(RACNI)_","_$G(RADTI)_","_$G(RADFN),32)
"RTN","RAORD3",9,0)
 .S RA700380=$$GET1^DIQ(70.03,$G(RACNI)_","_$G(RADTI)_","_$G(RADFN),80)
"RTN","RAORD3",10,0)
 .I RA700332'="" W !,"Pregnancy Screen: ",RA700332
"RTN","RAORD3",11,0)
 .I RA700380'="" W !,"Pregnancy Screen Comment: ",RA700380
"RTN","RAORD3",12,0)
 W:$P(RAORD0,"^",24)="y" !?12,"*** Universal Isolation Precautions ***" W:$D(RA("VDT")) !?8,$C(7),"** Note:  Request Associated with Visit on ",RA("VDT")," **"
"RTN","RAORD3",13,0)
 W:$D(RA("RDT"))&($D(RAPKG)) !,"Desired Date:",?22,RA("RDT") W:$D(RA("PDT")) !,"Pre-op Scheduled:",?22,RA("PDT") S RAOSTS=$P(RAORD0,"^",5) I RAOSTS=8,$D(RA("SDT")) W !,"Exam Scheduled:",?22,RA("SDT")
"RTN","RAORD3",14,0)
 I RAOSTS=1 D USERCAN
"RTN","RAORD3",15,0)
 W !,"Transport:",?22,RA("TRAN")
"RTN","RAORD3",16,0)
 I $L(RA("STY_REA")) D DIWP^RAUTL5(1,68,"Reason for Study: "_RA("STY_REA")) ;P75
"RTN","RAORD3",17,0)
 D ODX^RABWUTL(RAOIFN) ;display Ordering DX and Clin Inds, Billing Aware
"RTN","RAORD3",18,0)
 I $O(^RAO(75.1,RAOIFN,"H",0)) D  Q:$G(OREND)=1!($G(RAX)="^")
"RTN","RAORD3",19,0)
 . D CHIST(RAOIFN)
"RTN","RAORD3",20,0)
 . Q
"RTN","RAORD3",21,0)
 I RAOSTS=1!(RAOSTS=3) W !,"Reason ",$S(RAOSTS=1:"Cancelled",1:"Held"),":",?22,$S($D(^RA(75.2,+$P(RAORD0,"^",10),0)):$E($P(^(0),"^"),1,50),$P(RAORD0,"^",27)]"":$E($P(RAORD0,"^",27),1,50),1:"UNKNOWN") D TEXT:RAOSTS=3
"RTN","RAORD3",22,0)
 W:$D(RA("ST")) !,"Exam Status:",?22,RA("ST") W:$D(RA("ILC")) !,"Request Submitted to: ",RA("ILC")
"RTN","RAORD3",23,0)
 G A:$P(RAORD0,"^",11)'="y",A:'$D(RADTI)!('$D(RACNI))
"RTN","RAORD3",24,0)
 W !!?7,$C(7),"** Note:  Request has been changed by the Imaging Service **"
"RTN","RAORD3",25,0)
A I $D(^RAO(75.1,RAOIFN,"T")) D ASK:$E(IOST,1,2)="C-" I $D(DIRUT) S RAX="^" K DIRUT
"RTN","RAORD3",26,0)
 Q:Y'=1  I $D(RAPKG),RAX'="^" R !!,"Press return to continue or ""^"" to escape ",X:DTIME S RAX=$E(X)
"RTN","RAORD3",27,0)
 Q
"RTN","RAORD3",28,0)
 ;
"RTN","RAORD3",29,0)
ASK W ! S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to display request status tracking log",DIR("?")="Enter 'YES' if status tracking log should be displayed, or 'NO' if not." D ^DIR K DIR S:$D(DIRUT) OREND=1 Q:$D(DIRUT)!(Y=0)
"RTN","RAORD3",30,0)
 W !!?20,"*** Request Status Tracking Log ***",!,"Date/Time",?18,"Status",?31,"User",?44,"Reason",!,"-----------------",?18,"------------",?31,"-----------",?44,"------------------------------------"
"RTN","RAORD3",31,0)
 F RALNB=0:0 S RALNB=$O(^RAO(75.1,RAOIFN,"T",RALNB)) Q:'RALNB  I $D(^(RALNB,0)) S RATORD0=^(0) D PRTLOG
"RTN","RAORD3",32,0)
Q K RALNB,RATORD0,RATODT,RATOST,RATREA,RATUSR Q
"RTN","RAORD3",33,0)
 ;
"RTN","RAORD3",34,0)
PRTLOG S (X,RATODT)=$P(RATORD0,"^") I X S RATODT=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) I $P(X,".",2) D TIME^RAUTL1 S RATODT=RATODT_" "_X
"RTN","RAORD3",35,0)
 S RATOST=$P($P(^DD(75.12,2,0),$P(RATORD0,"^",2)_":",2),";"),RATUSR=$S($D(^VA(200,+$P(RATORD0,"^",3),0)):$P(^(0),"^"),1:"")
"RTN","RAORD3",36,0)
 S RATREA=$S($D(^RA(75.2,+$P(RATORD0,"^",4),0)):$P(^(0),"^"),1:"")
"RTN","RAORD3",37,0)
 W !,RATODT,?18,$E(RATOST,1,12),?31,$E(RATUSR,1,11),?44,$E(RATREA,1,35) I $E(RATREA,36,70)'="" W !,?44,$E(RATREA,36,70)
"RTN","RAORD3",38,0)
 Q
"RTN","RAORD3",39,0)
TEXT ; display Hold Description text
"RTN","RAORD3",40,0)
 Q:'$O(^RAO(75.1,RAOIFN,1,0))
"RTN","RAORD3",41,0)
 W !,"Hold Description:",!
"RTN","RAORD3",42,0)
 K ^UTILITY($J,"W"),^(1) S DIWL=22,DIWR=75,DIWF="W"
"RTN","RAORD3",43,0)
 F RARR=0:0 S RARR=$O(^RAO(75.1,RAOIFN,1,RARR)) Q:RARR'>0  S X=^(RARR,0) D ^DIWP
"RTN","RAORD3",44,0)
 D ^DIWW
"RTN","RAORD3",45,0)
 Q
"RTN","RAORD3",46,0)
CHIST(RAY) ; display Clinical History (if applicable)
"RTN","RAORD3",47,0)
 Q:RAY'?1N.N  Q:'$O(^RAO(75.1,RAY,"H",0))
"RTN","RAORD3",48,0)
 N DIWF,DIWL,DIWR,RABAN,RARR,RAXIT
"RTN","RAORD3",49,0)
 K ^UTILITY($J,"W") S DIWL=22,DIWR=75,DIWF="",RARR=0
"RTN","RAORD3",50,0)
 F  S RARR=$O(^RAO(75.1,RAY,"H",RARR)) Q:RARR'>0  D
"RTN","RAORD3",51,0)
 . ; store into ^UTILITY($J,"W")
"RTN","RAORD3",52,0)
 . S X=$G(^RAO(75.1,RAY,"H",RARR,0)) D ^DIWP
"RTN","RAORD3",53,0)
 . Q
"RTN","RAORD3",54,0)
 S (RARR,RAXIT)=0,RABAN="Clinical History: "
"RTN","RAORD3",55,0)
 I $Y>(IOSL-4) D
"RTN","RAORD3",56,0)
 . S RAXIT=$$EOS()
"RTN","RAORD3",57,0)
 . I 'RAXIT,('$D(RAPKG)) W @IOF
"RTN","RAORD3",58,0)
 . I 'RAXIT,($D(RAPKG)) D HDR^RAORD2
"RTN","RAORD3",59,0)
 . Q
"RTN","RAORD3",60,0)
 I RAXIT S:$D(RAPKG) RAX="^" K ^UTILITY($J,"W") Q
"RTN","RAORD3",61,0)
 W !,RABAN
"RTN","RAORD3",62,0)
 F  S RARR=$O(^UTILITY($J,"W",DIWL,RARR)) Q:RARR'>0  D  Q:RAXIT
"RTN","RAORD3",63,0)
 . S X=$G(^UTILITY($J,"W",DIWL,RARR,0)) W ?22,X,!
"RTN","RAORD3",64,0)
 . I $Y>(IOSL-4) D
"RTN","RAORD3",65,0)
 .. S RAXIT=$$EOS()
"RTN","RAORD3",66,0)
 .. I 'RAXIT,('$D(RAPKG)) W @IOF
"RTN","RAORD3",67,0)
 .. I 'RAXIT,($D(RAPKG)) D HDR^RAORD2 W !
"RTN","RAORD3",68,0)
 .. Q
"RTN","RAORD3",69,0)
 . Q
"RTN","RAORD3",70,0)
 S:RAXIT&($D(RAPKG)) RAX="^" K ^UTILITY($J,"W") ; kill global
"RTN","RAORD3",71,0)
 Q
"RTN","RAORD3",72,0)
EOS() ; End of screen check for both OE/RR & Rad/Nuc Med
"RTN","RAORD3",73,0)
 ; Var List: $D(RAPKG) entry through Rad/Nuc Med, else through OE/RR
"RTN","RAORD3",74,0)
 ; Passes back 'Y', Y=1 do not continue, Y=0 continue
"RTN","RAORD3",75,0)
 ; NOTE: Sets OREND if code entered through OE/RR.  This code may be
"RTN","RAORD3",76,0)
 ;       hit when the user accesses the 'Act On Existing Orders' through
"RTN","RAORD3",77,0)
 ;       OE/RR.  'Detailed Order Display' (8^RAORR) hits ENDIS^RAORD2
"RTN","RAORD3",78,0)
 ;       which mimics (hits same code) the Rad/Nuc Med 'Detailed Request
"RTN","RAORD3",79,0)
 ;       Display' option.  The old PGBRK^ORUHDR code set OREND to 0
"RTN","RAORD3",80,0)
 ;       initially, (even though it is set to 0 upon entering this
"RTN","RAORD3",81,0)
 ;       sub-routine) and re-set it to 1 if the user enters an '^' at
"RTN","RAORD3",82,0)
 ;       the "Enter RETURN to continue or '^' to exit:" prompt.
"RTN","RAORD3",83,0)
 S Y=$$EOS^RAUTL5() S:'$D(RAPKG) OREND=Y
"RTN","RAORD3",84,0)
 Q Y
"RTN","RAORD3",85,0)
USERCAN ;user who cancelled this request
"RTN","RAORD3",86,0)
 Q:$P($G(^RAO(75.1,RAOIFN,0)),U,5)'=1  ;only look at 'discontinued'
"RTN","RAORD3",87,0)
 N RA8,RA9 S RA8=0
"RTN","RAORD3",88,0)
 F  S RA8=$O(^RAO(75.1,RAOIFN,"T",RA8)) Q:'RA8  I $G(^(RA8,0))]"",$P(^(0),U,2)=1 S RA9=RA8 ; find latest ien of 'discontinued'
"RTN","RAORD3",89,0)
 S RA("ODT")="",RA("USR")=""
"RTN","RAORD3",90,0)
 I $G(RA9) D USERCAN1
"RTN","RAORD3",91,0)
 E  D USERCAN2
"RTN","RAORD3",92,0)
 W !,"Cancelled:",?22,RA("ODT") W:RA("USR")]"" "  by ",RA("USR")
"RTN","RAORD3",93,0)
 K RA("ODT"),RA("USR")
"RTN","RAORD3",94,0)
 Q
"RTN","RAORD3",95,0)
USERCAN1 ;use request track times to get when and who cancelled
"RTN","RAORD3",96,0)
 S X=$P(^RAO(75.1,RAOIFN,"T",RA9,0),U) D:X TRDT
"RTN","RAORD3",97,0)
 S RA("USR")=$P($G(^VA(200,+$P(^RAO(75.1,RAOIFN,"T",RA9,0),U,3),0)),U)
"RTN","RAORD3",98,0)
 Q
"RTN","RAORD3",99,0)
USERCAN2 ;use vars DUZ and RAORD0 to get "who" and "when" cancelled
"RTN","RAORD3",100,0)
 S X=$P($G(RAORD0),U,18) D:X TRDT
"RTN","RAORD3",101,0)
 ; don't use  duz  if within any one of 3 rad request options
"RTN","RAORD3",102,0)
 Q:$D(RASCREEN)  Q:$D(RAOPT("ORDERPRINTS"))  Q:$D(RAOPT("ORDERPRINTPAT"))
"RTN","RAORD3",103,0)
 S RA("USR")=$P($G(^VA(200,$G(DUZ),0)),U)
"RTN","RAORD3",104,0)
 Q
"RTN","RAORD3",105,0)
TRDT S:$P(X,".",2) X=$P(X,".")_"."_$$NOSECNDS($P(X,".",2))
"RTN","RAORD3",106,0)
 S RA("ODT")=$$FMTE^XLFDT(X,"1P")
"RTN","RAORD3",107,0)
 Q
"RTN","RAORD3",108,0)
NOSECNDS(X) ; If a timestamp is associated with a date, strip off seconds.
"RTN","RAORD3",109,0)
 ; Input : X-timestamp (153048)
"RTN","RAORD3",110,0)
 ; Output: (1530)
"RTN","RAORD3",111,0)
 Q $E(X,1,4)
"RTN","RAORD6")
0^8^B56757723^B49049103
"RTN","RAORD6",1,0)
RAORD6 ;HISC/CAH - AISC/RMO-Print A Request Cont. ;05/20/09  07:28
"RTN","RAORD6",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,10,15,18,27,45,41,75,85,99**;Mar 16, 1998;Build 5
"RTN","RAORD6",3,0)
 ; 3-p75 10/12/2006 GJC RA*5*75 print Reason for Study
"RTN","RAORD6",4,0)
 ; 4-p75 10/12/2006 KAM RA*5*75 display the request print date in the header
"RTN","RAORD6",5,0)
 ; 5-p75 10/12/2006 KAM RA*5*75 update header "Age" to "Age at req"
"RTN","RAORD6",6,0)
 ; 6-p85 06/20/2007 KAM RA*5*85 Reason for Study/Bar Code print issue
"RTN","RAORD6",7,0)
 ;                              Remedy Call - 193859
"RTN","RAORD6",8,0)
 ;Supported IA #10104 reference to ^XLFSTR
"RTN","RAORD6",9,0)
 ;Supported IA #10060 reference to ^VA(200
"RTN","RAORD6",10,0)
 D HD Q:RAX["^"
"RTN","RAORD6",11,0)
 I $$PTSEX^RAUTL8(RADFN)="F" D  ;display pregnancy status for females ptch 45
"RTN","RAORD6",12,0)
 .W !,"Pregnant at time of order entry: ",?22,$S($P(RAORD0,"^",13)="y":"YES",$P(RAORD0,"^",13)="n":"NO",1:"UNKNOWN")
"RTN","RAORD6",13,0)
 .Q:'$D(RAOIFN)
"RTN","RAORD6",14,0)
 .Q:'$D(^RADPT("AO",$G(RAOIFN),RADFN))
"RTN","RAORD6",15,0)
 .N RAINVDT,RA5
"RTN","RAORD6",16,0)
 .S RAINVDT=$O(^RADPT("AO",RAOIFN,RADFN,0))
"RTN","RAORD6",17,0)
 .Q:'$G(RAINVDT)
"RTN","RAORD6",18,0)
 .S RA5=$O(^RADPT("AO",RAOIFN,RADFN,RAINVDT,0))
"RTN","RAORD6",19,0)
 .Q:'$G(RA5)
"RTN","RAORD6",20,0)
 .N R3,RAPCOMM S R3=$G(^RADPT(RADFN,"DT",$G(RAINVDT),"P",$G(RA5),0))
"RTN","RAORD6",21,0)
 .S RAPCOMM=$G(^RADPT(RADFN,"DT",+$G(RAINVDT),"P",+$G(RA5),"PCOMM"))
"RTN","RAORD6",22,0)
 .W:$P(R3,U,32)'="" !,"Pregnancy Screen: ",$S($P(R3,"^",32)="y":"Patient answered yes",$P(R3,"^",32)="n":"Patient answered no",$P(R3,"^",32)="u":"Patient is unable to answer or is unsure",1:"")
"RTN","RAORD6",23,0)
 .W:$P(R3,U,32)'="n"&$L(RAPCOMM) !,"Pregnancy Screen Comment: ",RAPCOMM
"RTN","RAORD6",24,0)
 .Q
"RTN","RAORD6",25,0)
 W:$P(RAORD0,"^",24)="y" !!?12,"*** Universal Isolation Precautions ***"
"RTN","RAORD6",26,0)
 W:$D(RA("VDT")) !!?8,"** Note Request Associated with Visit on ",RA("VDT")," **"
"RTN","RAORD6",27,0)
 W !!,"Requested:",?18,RA("PRC INFO")
"RTN","RAORD6",28,0)
 I $D(^TMP($J,"RA DIFF PRC")),('$D(RAFOERR)),('$D(RAOPT("REG"))),('$D(RAOPT("ORDEREXAM"))),('$D(RAOPT("ADDEXAM"))) D  Q:RAX["^"
"RTN","RAORD6",29,0)
 . ; don't print registered procedure info (CPT, Proc Type, Imaging
"RTN","RAORD6",30,0)
 . ; Type) if entering through 'Request An Exam', 'Register Patient
"RTN","RAORD6",31,0)
 . ; for Exams' or 'Add Exams To Last Visit'.  Don't print if ordered
"RTN","RAORD6",32,0)
 . ; through ANY version of OE/RR.  If ordered through OE/RR, RAFOERR
"RTN","RAORD6",33,0)
 . ; will be defined. (Set in RAORD1 & RAO7RO)
"RTN","RAORD6",34,0)
 . N RAT,RA18NLIN S RAT="",RA18NLIN=0 W !,"Registered:"
"RTN","RAORD6",35,0)
 . F  S RAT=$O(^TMP($J,"RA DIFF PRC",RAT)) Q:RAT=""  D  Q:RAX["^"
"RTN","RAORD6",36,0)
 .. D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",37,0)
 .. W:RA18NLIN ! W ?12,RAT
"RTN","RAORD6",38,0)
 .. S RA18NLIN=1
"RTN","RAORD6",39,0)
 .. Q
"RTN","RAORD6",40,0)
 . Q
"RTN","RAORD6",41,0)
 I $G(RACMFLG("O"))'="" W !?12,"** The requested procedure has contrast media assigned **"
"RTN","RAORD6",42,0)
 I $G(RACMFLG("R"))'="" W !?12,"** A registered procedure uses contrast media **"
"RTN","RAORD6",43,0)
 W:$D(RA("MOD")) !,"Procedure Modifiers:",?22,RA("MOD")
"RTN","RAORD6",44,0)
 I RA("PRC MSG") D  Q:RAX["^"
"RTN","RAORD6",45,0)
 . N A,B,C,X S (A,C)=0 W !,"Procedure Message: ",!
"RTN","RAORD6",46,0)
 . F  S A=$O(^RAMIS(71,+$P(RAORD0,"^",2),3,A)) Q:A'>0!(RAX["^")  D
"RTN","RAORD6",47,0)
 .. S B=+$G(^RAMIS(71,+$P(RAORD0,"^",2),3,A,0))
"RTN","RAORD6",48,0)
 .. S X=$G(^RAMIS(71.4,B,0))
"RTN","RAORD6",49,0)
 .. W:'C ?3,"-" W:C !?3,"-"
"RTN","RAORD6",50,0)
 .. D OUTTEXT^RAUTL9(X,"",5,80,4,"","!")
"RTN","RAORD6",51,0)
 .. D HD:($Y+6)>IOSL S C=C+1
"RTN","RAORD6",52,0)
 .. Q
"RTN","RAORD6",53,0)
 . Q
"RTN","RAORD6",54,0)
 W !,"Request Status:",?22,$E(RA("OST"),1,24)
"RTN","RAORD6",55,0)
 I $P(RAORD0,"^",5)=1!($P(RAORD0,"^",5)=3) D  Q:RAX["^"
"RTN","RAORD6",56,0)
 . W !,"Reason ",$S($P(RAORD0,"^",5)=1:"Cancelled",1:"Held"),":"
"RTN","RAORD6",57,0)
 . W ?22,$S($D(^RA(75.2,+$P(RAORD0,"^",10),0)):$E($P(^(0),"^"),1,50),$P(RAORD0,"^",27)]"":$E($P(RAORD0,"^",27),1,50),1:"UNKNOWN")
"RTN","RAORD6",58,0)
 . D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",59,0)
 . I $D(^RAO(75.1,RAOIFN,1)) D  Q:RAX["^"
"RTN","RAORD6",60,0)
 .. N X,I,RAXX
"RTN","RAORD6",61,0)
 .. K ^UTILITY($J,"W")
"RTN","RAORD6",62,0)
 .. W !,"Hold Description:",!
"RTN","RAORD6",63,0)
 .. S I=0 F  S I=$O(^RAO(75.1,RAOIFN,1,I)) Q:'I  S (RAXX,X)=^(I,0) D HD:($Y+6)>IOSL Q:RAX["^"  S X=RAXX D ^DIWP
"RTN","RAORD6",64,0)
 .. Q:RAX["^"
"RTN","RAORD6",65,0)
 .. D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",66,0)
 .. D ^DIWW:$D(RAXX)
"RTN","RAORD6",67,0)
 .. D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",68,0)
 . I $P(RAORD0,"^",5)=1 D
"RTN","RAORD6",69,0)
 .. W !!,?(IOM-(IOM/2+15)),"*********************",!,?(IOM-(IOM/2+15)),"* C A N C E L L E D *",!,?(IOM-(IOM/2+15)),"*********************"
"RTN","RAORD6",70,0)
 W:$P(RAORD0,"^",5)=6&($D(RA("ST"))) !,"Exam Status:",?22,RA("ST")
"RTN","RAORD6",71,0)
 W:$P(RAORD0,"^",5)=8&($D(RA("SDT"))) !,"Exam Scheduled:",?22,RA("SDT")
"RTN","RAORD6",72,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",73,0)
 W !!,"Requester:",?22,$E(RA("PHY"),1,20)
"RTN","RAORD6",74,0)
 W:RA("PHY")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("RPHOINFO"))
"RTN","RAORD6",75,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",76,0)
 W !,"Attend Phy Current:",?22,$E(RA("ATTEN"),1,20)
"RTN","RAORD6",77,0)
 W:RA("ATTEN")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("APHOINFO"))
"RTN","RAORD6",78,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",79,0)
 W !,"Prim Phy Current:",?22,$E(RA("PRIM"),1,20)
"RTN","RAORD6",80,0)
 W:RA("PRIM")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("PPHOINFO"))
"RTN","RAORD6",81,0)
 K RAPASS1,RAPASS2
"RTN","RAORD6",82,0)
 S RAPASS1=RA("ATTEN"),RAPASS2=RA("OATTEN")
"RTN","RAORD6",83,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",84,0)
 I $$ID^RAORD6(RAPASS1,RAPASS2) D
"RTN","RAORD6",85,0)
 . W !,"Attend Phy At Order:",?22,$E(RA("OATTEN"),1,20)
"RTN","RAORD6",86,0)
 . W:RA("OATTEN")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("OAPHOINFO"))
"RTN","RAORD6",87,0)
 . Q
"RTN","RAORD6",88,0)
 S RAPASS1=RA("PRIM"),RAPASS2=RA("OPRIM")
"RTN","RAORD6",89,0)
 I $$ID^RAORD6(RAPASS1,RAPASS2) D
"RTN","RAORD6",90,0)
 . W !,"Prim Phy At Order:",?22,$E(RA("OPRIM"),1,20)
"RTN","RAORD6",91,0)
 . W:RA("OPRIM")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("OPPHOINFO"))
"RTN","RAORD6",92,0)
 . Q
"RTN","RAORD6",93,0)
 K RAPASS1,RAPASS2
"RTN","RAORD6",94,0)
 I +$P(RAORD0,"^",8) D
"RTN","RAORD6",95,0)
 . N RAPPRAD S RAPPRAD=+$P(RAORD0,"^",8)
"RTN","RAORD6",96,0)
 . S:$P($G(^VA(200,RAPPRAD,20)),"^",2)]"" RAPPRAD=$P(^(20),"^",2)
"RTN","RAORD6",97,0)
 . S:RAPPRAD=+RAPPRAD RAPPRAD=$P(^VA(200,RAPPRAD,0),"^")
"RTN","RAORD6",98,0)
 . W !,"Approved by: ",?22,RAPPRAD
"RTN","RAORD6",99,0)
 . Q
"RTN","RAORD6",100,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",101,0)
 W !,"Date/Time Ordered:",?22,$S($D(RA("ODT")):RA("ODT"),1:""),"  by ",$E(RA("USR"),1,20)
"RTN","RAORD6",102,0)
 W:$D(RA("RDT")) !,"Date Desired:",?22,RA("RDT")
"RTN","RAORD6",103,0)
 D:$P(RAORD0,"^",5)=1 USERCAN^RAORD3
"RTN","RAORD6",104,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",105,0)
 W:$D(RA("PDT")) !,"Pre-op Date/Time:",?22,RA("PDT"),!!?26,"**** P R E - O P ****",!
"RTN","RAORD6",106,0)
BAR ;Print bar-coded SSN on request form if term type has bar code setup
"RTN","RAORD6",107,0)
 I $G(RASSN)'?3N1"-"2N1"-".E G CONT
"RTN","RAORD6",108,0)
 S X3=$E(RASSN,1,3)_$E(RASSN,5,6)_$E(RASSN,8,11)
"RTN","RAORD6",109,0)
 ; 06/20/2007 KAM/BAY RA*5*85 Added 2 line feeds
"RTN","RAORD6",110,0)
 D PSET^%ZISP I IOBARON]"",(IOBAROFF]"") W !!!?49,@IOBARON,X3,@IOBAROFF,!
"RTN","RAORD6",111,0)
 D PKILL^%ZISP
"RTN","RAORD6",112,0)
 ;
"RTN","RAORD6",113,0)
CONT D HD:($Y+6)>IOSL Q:RAX["^"  D ODX^RABWUTL(RAOIFN) ; * Billing Aware *
"RTN","RAORD6",114,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",115,0)
 ; 06/20/2007 KAM/BAY RA*5*85 Added line feed to the next line
"RTN","RAORD6",116,0)
 I $L(RA("STY_REA")) W ! D DIWP^RAUTL5(1,68,"Reason for Study: "_RA("STY_REA")) ;3-p75
"RTN","RAORD6",117,0)
 D HD:($Y+6)>IOSL Q:RAX["^"  K ^UTILITY($J,"W"),^(1) W !,"Clinical History:",! K RAXX F RAV=0:0 S RAV=$O(^RAO(75.1,RAOIFN,"H",RAV)) Q:'RAV  I $D(^(RAV,0)) S RAXX=^(0) D HD:($Y+6)>IOSL Q:RAX["^"  S X=RAXX D ^DIWP
"RTN","RAORD6",118,0)
 Q:RAX["^"  D HD:($Y+6)>IOSL Q:RAX["^"  D ^DIWW:$D(RAXX),HD:($Y+6)>IOSL Q:RAX["^"  D WORK ;always print bottom section of form 012601
"RTN","RAORD6",119,0)
 W ! S BOT=IOSL-($Y+4) S:($E(IOST,1,6)="P-BROW"&($D(DDBRZIS))) BOT=5 F BT=1:1:BOT W !
"RTN","RAORD6",120,0)
 K BOT,BT
"RTN","RAORD6",121,0)
 W !,"VA Form 519a-ADP"
"RTN","RAORD6",122,0)
 Q
"RTN","RAORD6",123,0)
 ;
"RTN","RAORD6",124,0)
WORK W !,RALNE,!,"Date Performed: ________________________",?46
"RTN","RAORD6",125,0)
 I $O(^RADPT("AO",RAOIFN,0))="" W "Case No.: ______________________"
"RTN","RAORD6",126,0)
 E  W "Case No.: ______see above_______"
"RTN","RAORD6",127,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",128,0)
 W !,"Technologist Initials: _________________"
"RTN","RAORD6",129,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",130,0)
 W !?46,"Number/Size Films: _____________",!,"Interpreting Phys. Initials: ___________",?65,"_____________",!?65,"_____________",!
"RTN","RAORD6",131,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",132,0)
 W !,"Comments:"
"RTN","RAORD6",133,0)
 ;
"RTN","RAORD6",134,0)
TC D EN30^RAO7PC1(RAOIFN),TC^RAORD61 Q:RAX["^"
"RTN","RAORD6",135,0)
 ;
"RTN","RAORD6",136,0)
DASHLN W ! F I=1:1:5 D HD:($Y+6)>IOSL Q:RAX["^"  W !,RALNE ;P18
"RTN","RAORD6",137,0)
 Q
"RTN","RAORD6",138,0)
 ;
"RTN","RAORD6",139,0)
HD S:'$D(RAPGE) RAPGE=0 D CRCHK Q:$G(RAX)["^"  S RATAB=$S($D(RA("ILC")):1,1:16)
"RTN","RAORD6",140,0)
 ;10/12/2006 KAM Remedy tk 162508 Changed next line added "Printed:"
"RTN","RAORD6",141,0)
 W:$Y @IOF W !?RATAB,">>"_$S($D(RACRHD):"Discontinued ",1:"")_"Rad/NM Consultation" W:$D(RA("ILC")) " for ",$E(RA("ILC"),1,17) W "<<Printed:" S X="NOW",%DT="T" D ^%DT K %DT D D^RAUTL W ?52,Y ;P18 4-P74
"RTN","RAORD6",142,0)
 S RAPGE=RAPGE+1 W ?71,"Page ",RAPGE ;P18
"RTN","RAORD6",143,0)
 W !,RALNE1,!,"Name         : ",RA("NME"),?46,"Urgency    : ",RA("OUG") W:$D(RA("PORTABLE")) "  *PORTABLE*"
"RTN","RAORD6",144,0)
 W !,"Pt ID Num    : ",RASSN,?46,"Transport  : ",RA("TRAN")
"RTN","RAORD6",145,0)
 S Y=RA("DOB") D D^RAUTL W !,"Date of Birth: ",Y,?46,"Patient Loc: ",$E(RA("HLC"),1,20)
"RTN","RAORD6",146,0)
 ;10/12/2006 KAM Remedy Ticket 162508 changed next line
"RTN","RAORD6",147,0)
 W !,"Age at req   : ",RA("AGE"),?46,"Phone Ext  : ",RA("HPH") ;5-P75
"RTN","RAORD6",148,0)
 W !,"Sex          : ",$S(RA("SEX")="M":"MALE",1:"FEMALE") W:$D(RA("ROOM-BED")) ?46,"Room-Bed   : ",RA("ROOM-BED") W !,RALNE1
"RTN","RAORD6",149,0)
 W:$P(RAORD0,U,5)=1 !,"***C A N C E L L E D***",?56,"***C A N C E L L E D***"
"RTN","RAORD6",150,0)
 Q
"RTN","RAORD6",151,0)
 ;
"RTN","RAORD6",152,0)
CRCHK I RAPGE,$E(IOST)="C" W !!,$C(7),"Press RETURN to continue or '^' to stop " R X:DTIME S RAX=X
"RTN","RAORD6",153,0)
 Q
"RTN","RAORD6",154,0)
ID(X,Y) ; Checks for the following condition:
"RTN","RAORD6",155,0)
 ; 1) Attending Phy. Current & Attending Phy. At Order are the same.
"RTN","RAORD6",156,0)
 ; 2) Primary Phy. Current & Primary Phy. At Order are the same.
"RTN","RAORD6",157,0)
 ; Input Variables:
"RTN","RAORD6",158,0)
 ; 'X'-> Attending/Primary Phy. Current
"RTN","RAORD6",159,0)
 ; 'Y'-> Attending/Primary Phy. At Order
"RTN","RAORD6",160,0)
 I X']""!(Y']"") Q 0
"RTN","RAORD6",161,0)
 I $$UP^XLFSTR(X)="UNKNOWN",($$UP^XLFSTR(Y)="UNKNOWN") Q 0
"RTN","RAORD6",162,0)
 N A,B,Z S A=+$O(^VA(200,"B",X,"")),B=+$O(^VA(200,"B",Y,""))
"RTN","RAORD6",163,0)
 I A>0,(B>0),(A=B) S Z=0
"RTN","RAORD6",164,0)
 E  S Z=1
"RTN","RAORD6",165,0)
 Q Z ; $S(Z=1:"different physician",Z=0:"same physician")
"RTN","RAORDU1")
0^18^B33414666^B32546485
"RTN","RAORDU1",1,0)
RAORDU1 ;HISC/CAH - AISC/SAW-Utility for Rad/NM Orders Module ;05/15/09  12:56
"RTN","RAORDU1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,41,75,99**;Mar 16, 1998;Build 5
"RTN","RAORDU1",3,0)
 ;P#99 - changed Pregnant title to Pregnant at time of order entry.
"RTN","RAORDU1",4,0)
CP ;Create protocols for Rad/Nuc Med in OE/RR Protocol file (#100)
"RTN","RAORDU1",5,0)
 ;based upon entries in the Rad/Nuc Med Common Procedure file (#71.3)
"RTN","RAORDU1",6,0)
 ;
"RTN","RAORDU1",7,0)
 I $$ORVR^RAORDU()>2.5 W !!,"In order to use this option, your site must be running version 2.5 of the",!,"Order Entry/Results Reporting package." G Q
"RTN","RAORDU1",8,0)
 ;
"RTN","RAORDU1",9,0)
 ;Check/set package and default protocol values
"RTN","RAORDU1",10,0)
 S ORPKG=$O(^DIC(9.4,"C","RA",0)) I 'ORPKG W !,$C(7),"There is no entry for the Radiology/Nuclear Medicine package in your Package",!,"file (#9.4), unable to proceed.  Contact your site manager." G Q
"RTN","RAORDU1",11,0)
 S ORDEF=$O(^ORD(101,"B","RA OERR DEFAULT PROTOCOL",0)) I 'ORDEF W !,$C(7),"You do not have a default Radiology/Nuclear Medicine protocol in your",!,"Protocol file (#101), unable to continue.  Contact your site manager." G Q
"RTN","RAORDU1",12,0)
 S (I,RACNT,RAF1,X)=0 K ^TMP($J,"RAEX") W !!?10,"Create an OE/RR Protocol from a Radiology/Nuclear Medicine",!?10,"Common Procedure",!
"RTN","RAORDU1",13,0)
 F  S I=$O(^RAMIS(71.3,I)) Q:I'>0  I $D(^(I,0)) S Y=I_"^"_^(0) I $P(Y,"^",6)']"",$D(^RAMIS(71,+$P(Y,"^",2),0)) S RACNT=RACNT+1,^TMP($J,"RAEX",RACNT)=Y W !,RACNT,?6,$P(^RAMIS(71,+$P(Y,"^",2),0),"^") D:'(RACNT#15) ASK^RAUTL4 Q:X="^"!(X>0)
"RTN","RAORDU1",14,0)
 G Q:X="^" I 'RACNT W !,$C(7),"The Common Procedures file does not have any entries from which to choose." G Q
"RTN","RAORDU1",15,0)
 I RACNT=1 S RADUP(1)="" W !!,"There is only one Common Procedure to choose from." S DIR(0)="YA",DIR("A")="Okay to continue? " D ^DIR G Q:Y'=1,CP1
"RTN","RAORDU1",16,0)
 I X'>0,RACNT#15 D ASK^RAUTL4 G Q:'$D(RADUP)
"RTN","RAORDU1",17,0)
CP1 S RAI=0 F  S RAI=$O(RADUP(RAI)) Q:RAI'>0  S Y=^TMP($J,"RAEX",RAI),DA=+Y,Y=$P(Y,"^",2,99) W !!,"Processing the ",$P(^RAMIS(71,+Y,0),"^")," procedure.",! D CP2
"RTN","RAORDU1",18,0)
Q K %1,D,D0,DA,DIC,DIE,DIR,DR,I,J,K,ORDEF,OREA,ORFL,ORPKG,ORTXT,RACNT,RADUP,RAERR,RAF1,RAI,RAILOC,RAPAR,RASEL,X,Y,Z,^TMP($J,"RAEX")
"RTN","RAORDU1",19,0)
 K DI,DIG,DIH,DIU,DIV,DQ
"RTN","RAORDU1",20,0)
 Q
"RTN","RAORDU1",21,0)
CP2 S RAERR=0 S RAILOC=$P(Y,"^",8) I 'RAILOC S RAILOC=$O(^RA(79.1,0)) I RAILOC,$O(^(RAILOC)) K RAILOC W !,$C(7),"You must enter an 'Imaging Location' before this procedure can be processed",!,"as an orderable item in OE/RR." S RAERR=1
"RTN","RAORDU1",22,0)
 S ORTXT=$P(Y,"^",13) I ORTXT']"" W !,$C(7),"You must enter a 'Name of Ordeable Item' before this procedure can be processed",!,"as an orderable item in OE/RR." S RAERR=1
"RTN","RAORDU1",23,0)
 I RAERR K RAILOC,ORTXT Q
"RTN","RAORDU1",24,0)
 S ORFL=+Y_";RAMIS(71,",OREA="S RADR1=1,RAPRI="_+Y_",RAILOC="_RAILOC_$S($P(Y,"^",11):",RARU="_$P(Y,"^",11),1:"")
"RTN","RAORDU1",25,0)
 S Z="^^^^^RACAT^RAREQDT^^RAMT^RAIP" F X=6,9,10 S OREA=OREA_$S($P(Y,"^",X)]"":","_$P(Z,"^",X)_"="_""""_$P(Y,"^",X)_"""",1:"")
"RTN","RAORDU1",26,0)
 I $O(^RAMIS(71.3,DA,"M",0)) S K=0 F J=1:1 S K=$O(^RAMIS(71.3,DA,"M",K)) Q:K'>0  S X=$G(^(K,0)) I $D(^RAMIS(71.2,+X,0)) S X=$P(^(0),"^") I X]"" S OREA=OREA_",RAMOD("_J_")="_""""_X_""""
"RTN","RAORDU1",27,0)
 S OREA=OREA_" D ^RAORR"
"RTN","RAORDU1",28,0)
 I $G(^DIC(9.4,ORPKG,0))]"" N RA1 S RA1=$P(^(0),"^",2)_+ORFL_" "_ORTXT S:$O(^ORD(101,"B",RA1,0)) ORDA=$O(^(0)) ; define ORDA if filelink record exists in file #101
"RTN","RAORDU1",29,0)
 ;D EN3^ORUPREF2 W:$D(Y) !,*7,"Unable to create an orderable item in OE/RR."
"RTN","RAORDU1",30,0)
 Q  ;dead code OE 2.5 from CP down to here
"RTN","RAORDU1",31,0)
 ;
"RTN","RAORDU1",32,0)
DISP ;Display request with defaults
"RTN","RAORDU1",33,0)
 S:'$D(RAMOD)#2 RAMOD=""
"RTN","RAORDU1",34,0)
 S J="",$P(J,"-",80)="" W !!,J
"RTN","RAORDU1",35,0)
 I $D(RAMOD)>9 S RAMOD="" F I=1:1 Q:'$D(RAMOD(I))  S RAMOD=RAMOD_$S(I'=1:", ",1:"")_RAMOD(I) S RAI=0 S RAI=+$O(^RAMIS(71.2,"B",RAMOD(I),RAI)) I $P($G(^RAMIS(71.2,RAI,0)),U,2)="p" S RAACI="p"
"RTN","RAORDU1",36,0)
 W !?10,"Patient: ",RANME I RASEX'="M" S:'$D(RAPREG) RAPREG="" W "   Pregnant at time of order entry: ",$S(RAPREG="y":"YES",RAPREG="u":"UNKNOWN",RAPREG="n":"NO",1:"")
"RTN","RAORDU1",37,0)
 W !?8,"Procedure: ",$S($D(^RAMIS(71,RAPRI,0)):$P(^(0),"^"),1:"UNKNOWN"),!?2,"Proc. Modifiers: ",RAMOD
"RTN","RAORDU1",38,0)
 S:'$D(RAMT) RAMT=$S($G(RAACI)="p":"p",$E(RACAT)="I":"w",1:"a") S RAMT=RAMT_"^"_$P($P(^DD(75.1,19,0),RAMT_":",2),";") W !?9,"Category: ",RACAT,?49,"Mode of Transport: ",$P(RAMT,"^",2)
"RTN","RAORDU1",39,0)
 S:'$D(RAIP) RAIP="n" W !,"     Desired Date: ",RAWHEN,?46,"Isolation Procedures: ",$S(RAIP="y":"YES",1:"NO")
"RTN","RAORDU1",40,0)
 S:'$D(RARU) RARU=9 W !,"  Request Urgency: ",$S($D(RARU):$P($P(^DD(75.1,6,0),RARU_":",2),";"),1:"ROUTINE"),?46,"Scheduled for Pre-op: ",$S($D(RAPREOP1):"YES",1:"NO")
"RTN","RAORDU1",41,0)
 I $D(RAILOC) W !,"Submit Request To: ",$S($D(^RA(79.1,+RAILOC,0)):$S($D(^SC(+$P(^(0),"^"),0)):$P(^(0),"^"),1:"Unknown"),1:"Unknown")
"RTN","RAORDU1",42,0)
 W !," Request Location: ",$S($P($G(^SC(+RALIFN,0)),U)]"":$E($P($G(^SC(+RALIFN,0)),U),1,26),1:"Unkown") I $$ORVR^RAORDU()'<3 W ?46,"Nature of order:  SVC CORRECTION"
"RTN","RAORDU1",43,0)
 D DISREA(RAREAST) ;display the reason for study
"RTN","RAORDU1",44,0)
 ;*Billing Aware Project:
"RTN","RAORDU1",45,0)
 ;   Display New ICD-9 Dx and their related SC/EI/MST/HNC responses.
"RTN","RAORDU1",46,0)
 ;
"RTN","RAORDU1",47,0)
BADISP D:$P($G(RABWDX(1)),U,1)>0 BADISP^RABWORD1(.RABWDX)
"RTN","RAORDU1",48,0)
 ;*
"RTN","RAORDU1",49,0)
 K ^UTILITY($J,"W"),^(1) S DIWF="WN",DIWL=1,DIWR=79,I=0 W !!,"Clinical History:",! F  S I=$O(^TMP($J,"RAWP",I)) Q:I'>0  S X=^(I,0) D ^DIWP
"RTN","RAORDU1",50,0)
 D ^DIWW W !,J
"RTN","RAORDU1",51,0)
 S DIR(0)="Y",DIR("A")="Do you want to change any of the above",DIR("B")="NO" D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) RAOUT=1 Q:$D(RAOUT)  S:Y=0 RADR1=1 S:Y'=0 RADR2=1,RASTOP=0
"RTN","RAORDU1",52,0)
 ; RASTOP is used to track whether the procedure messages have printed.
"RTN","RAORDU1",53,0)
 ; If you answer 'yes' to "Do you want to edit this request", you
"RTN","RAORDU1",54,0)
 ; will see the procedure messages again (if they exist and if you
"RTN","RAORDU1",55,0)
 ; viewed them before.  Value altered in ADDORD+1^RAORD1 & EN2+1^RAPRI)
"RTN","RAORDU1",56,0)
 Q
"RTN","RAORDU1",57,0)
 ;
"RTN","RAORDU1",58,0)
DISREA(X) ;this function formats and displays the reason for study for this
"RTN","RAORDU1",59,0)
 ;order.
"RTN","RAORDU1",60,0)
 ;input: X - the reason for study (a string between three & sixty four
"RTN","RAORDU1",61,0)
 ;characters in length)
"RTN","RAORDU1",62,0)
 N %,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,I,LINES,Z
"RTN","RAORDU1",63,0)
 ;accumulate & format data; column width of sixty (DIWF's C60) characters
"RTN","RAORDU1",64,0)
 S DIWF="C60",DIWL=1 D ^DIWP
"RTN","RAORDU1",65,0)
 W !," Reason for Study: " S I=0,LINES=^UTILITY($J,"W",DIWL)
"RTN","RAORDU1",66,0)
 ;LINES: # of formatted lines in ^UTILITY
"RTN","RAORDU1",67,0)
 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:'I  W ?19,$G(^(I,0)) W:I'=LINES !
"RTN","RAORDU1",68,0)
 K ^UTILITY($J,"W",DIWL)
"RTN","RAORDU1",69,0)
 Q
"RTN","RAORDU1",70,0)
 ;
"RTN","RAPM")
0^1^B71205125^B65396557
"RTN","RAPM",1,0)
RAPM ;HOIFO/TH-Radiology Performance Monitors/Indicator; ;5/12/04  10:03
"RTN","RAPM",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**37,44,48,67,99**;Mar 16, 1998;Build 5
"RTN","RAPM",3,0)
 ;RVD - 3/19/09 p99.
"RTN","RAPM",4,0)
 ;Supported IA #2056 reference to ^DIQ
"RTN","RAPM",5,0)
 ;Supported IA #10000 reference to C^%DTC
"RTN","RAPM",6,0)
 ;Supported IA #10090 reference to ^DIC(4
"RTN","RAPM",7,0)
 ; *** Application variables: ***
"RTN","RAPM",8,0)
 ;
"RTN","RAPM",9,0)
 ; Exam Date - RADTE (Regular Fileman format)
"RTN","RAPM",10,0)
 ;             RADTI (Inverse Fileman format)
"RTN","RAPM",11,0)
 ; Case Number - RACN               Exam Status - RAEXST
"RTN","RAPM",12,0)
 ; Category of Exam - RACAT         Primary Interpreting Staff - RAPRIM
"RTN","RAPM",13,0)
 ; Date Report Entered - RARPTDT    Verified Date - RAVERDT
"RTN","RAPM",14,0)
 ; Report Status - RARPTST          Page Number - RAPG
"RTN","RAPM",15,0)
 ; Type of Report - RARPT
"RTN","RAPM",16,0)
 ; Internal number of an entry in the Patient file (#2) - RADFN
"RTN","RAPM",17,0)
 ;
"RTN","RAPM",18,0)
INIT ; Check for the existence of RACESS. Pass in user's DUZ!
"RTN","RAPM",19,0)
 I $D(DUZ),($O(RACCESS(DUZ,""))']"") D CHECK^RADLQ3(DUZ)
"RTN","RAPM",20,0)
 ;
"RTN","RAPM",21,0)
 N DIR,DIRUT,RABDATE,RAEDATE,RARPT,DTDIFF,RABEGDT,RAENDDT,RA1
"RTN","RAPM",22,0)
 N RAM,RARAD,RAR,RAMSG,X,Y K RAP99
"RTN","RAPM",23,0)
 S (RABDATE,RAEDATE,RAANS,RAANS2,RANODIV,RASINCE,RARAD)="",RAN=0
"RTN","RAPM",24,0)
 ; RANODIV=1 if one or more exams are missing DIVISION
"RTN","RAPM",25,0)
PROMPT ; 
"RTN","RAPM",26,0)
 W @IOF
"RTN","RAPM",27,0)
 W !!,"Radiology Verification Timeliness Report",!!
"RTN","RAPM",28,0)
 ; Prompt for Report Type. Quit if no report type selected
"RTN","RAPM",29,0)
 D GETRPT K DIR Q:$D(DIRUT)
"RTN","RAPM",30,0)
 ; Prompt for Date Range - Quit if no dates selected
"RTN","RAPM",31,0)
 W !! D GETDATE K DIR Q:$D(DIRUT)
"RTN","RAPM",32,0)
 ; Prompt for Radiologist if Short or Both
"RTN","RAPM",33,0)
 D RADIOL^RAPM3
"RTN","RAPM",34,0)
 ; Prompt for Division and Imaging Types
"RTN","RAPM",35,0)
 S X=$$DIVLOC^RAUTL7() I X G EXIT
"RTN","RAPM",36,0)
 I $D(^TMP($J,"RA I-TYPE","VASCULAR LAB")) D
"RTN","RAPM",37,0)
 . K ^TMP($J,"RA I-TYPE","VASCULAR LAB")
"RTN","RAPM",38,0)
 . W !!?5,"*** Imaging type 'Vascular Lab' will not be included in this report ***"
"RTN","RAPM",39,0)
 ; Prompt for sort option if Detail
"RTN","RAPM",40,0)
 D:RARPT'="S" SORT K DIR Q:$D(DIRUT)
"RTN","RAPM",41,0)
 ; Prompt for mail delivery if Short or Both
"RTN","RAPM",42,0)
 I RARPT'="D" D EMAIL^RAPM2 K DIR Q:$D(DIRUT)
"RTN","RAPM",43,0)
 ; Warning for Detail or Both
"RTN","RAPM",44,0)
 I RARPT="D"!(RARPT="B") D
"RTN","RAPM",45,0)
 . S RATXT="*** The detail report requires a 132 column output device ***"
"RTN","RAPM",46,0)
 . S RALINE="",$P(RALINE,"*",$L(RATXT))=""
"RTN","RAPM",47,0)
 . W !!?(80-$L(RATXT)\2),RALINE,!?(80-$L(RATXT)\2),RATXT,!?(80-$L(RATXT)\2),RALINE,!
"RTN","RAPM",48,0)
 .Q
"RTN","RAPM",49,0)
 D DEV
"RTN","RAPM",50,0)
 I RAPOP D  G EXIT
"RTN","RAPM",51,0)
 . I RAANS!(RAANS2) W !?5,"** No mail will be sent **",$C(7)
"RTN","RAPM",52,0)
 . Q
"RTN","RAPM",53,0)
START ; Get data and print the report
"RTN","RAPM",54,0)
 S:$D(ZTQUEUED) ZTREQ="@" S RAIO=$S(IO="":0,1:1),RAN=0
"RTN","RAPM",55,0)
 ;added by patch #99
"RTN","RAPM",56,0)
 D GETDATA
"RTN","RAPM",57,0)
 I $G(RAP99) S RAS99=1 D PWT^RAPMW(RABDATE,RAEDATE)  ;process partial Wait and Time report
"RTN","RAPM",58,0)
 ;
"RTN","RAPM",59,0)
 ;D GETDATA
"RTN","RAPM",60,0)
 I RARPT="S"!(RARPT="B") S RAPG=0 D ^RAPM1
"RTN","RAPM",61,0)
 I RARPT="D"!(RARPT="B") S RAPG=0 D ^RAPM2
"RTN","RAPM",62,0)
 I $G(RAP99) K RAS99 S RAL99=1 D PWT^RAPMW(RABDATE,RAEDATE)    ;process all wait and time reports
"RTN","RAPM",63,0)
 ; see if need send email
"RTN","RAPM",64,0)
 D SEND^RAPM2
"RTN","RAPM",65,0)
 D EXIT
"RTN","RAPM",66,0)
 Q
"RTN","RAPM",67,0)
 ;
"RTN","RAPM",68,0)
GETRPT ; Prompt for Summary or Detail or Both reports; Default = Summary Report
"RTN","RAPM",69,0)
 W !,"Enter Report Type"
"RTN","RAPM",70,0)
 S DIR(0)="S^S:Summary;D:Detail;B:Both"
"RTN","RAPM",71,0)
 S DIR("A")="Select Report Type",DIR("B")="S"
"RTN","RAPM",72,0)
 S DIR("?")="Enter Summary report OR Detail report OR Both reports"
"RTN","RAPM",73,0)
 D ^DIR
"RTN","RAPM",74,0)
 Q:$D(DIRUT) 
"RTN","RAPM",75,0)
 S RARPT=Y
"RTN","RAPM",76,0)
 Q
"RTN","RAPM",77,0)
GETDATE ; Prompt for start and end dates
"RTN","RAPM",78,0)
 S DIR(0)="D^:"_DT_":AEX"
"RTN","RAPM",79,0)
 I RARPT'="D" D
"RTN","RAPM",80,0)
 . W !!?4,"The begin date for Summary and Both must be at least 10 days before today.",!
"RTN","RAPM",81,0)
 . S X1=DT,X2=-10 D C^%DTC S RA1=X
"RTN","RAPM",82,0)
 . S DIR(0)="D^:"_RA1_":AEX"
"RTN","RAPM",83,0)
 . Q
"RTN","RAPM",84,0)
 S DIR("A")="Enter starting date"
"RTN","RAPM",85,0)
 S DIR("?")="Enter date to begin searching from"
"RTN","RAPM",86,0)
 D ^DIR
"RTN","RAPM",87,0)
 Q:$D(DIRUT)
"RTN","RAPM",88,0)
 S RABDATE=Y
"RTN","RAPM",89,0)
 ;
"RTN","RAPM",90,0)
 S RADD=91,X1=RABDATE,X2=RADD D C^%DTC S RAMAXDT=X
"RTN","RAPM",91,0)
 ; put 10 day block for summary report or Both
"RTN","RAPM",92,0)
 I RARPT'="D" D
"RTN","RAPM",93,0)
 . W !!?4,"The ending date for Summary and Both must be at least 10 days before today.",!
"RTN","RAPM",94,0)
 . S X1=DT,X2=-10 D C^%DTC S:X<RAMAXDT RAMAXDT=X
"RTN","RAPM",95,0)
 S:RAMAXDT>DT RAMAXDT=DT
"RTN","RAPM",96,0)
 S DIR(0)="D^"_RABDATE_":"_RAMAXDT_":AE"
"RTN","RAPM",97,0)
 S DIR("A")="Enter ending date"
"RTN","RAPM",98,0)
 S DIR("?",1)="     +91 days max. for Summary and Detail."
"RTN","RAPM",99,0)
 S DIR("?",2)="     And the ending date for the Summary and Both"
"RTN","RAPM",100,0)
 S DIR("?")="     must be at least 10 days before today."
"RTN","RAPM",101,0)
 D ^DIR
"RTN","RAPM",102,0)
 Q:$D(DIRUT)
"RTN","RAPM",103,0)
 ;
"RTN","RAPM",104,0)
 ; Set end date to end of day
"RTN","RAPM",105,0)
 ; RABDATE and RAEDATE are original values
"RTN","RAPM",106,0)
 ; RABEGDT and RAENDDT are used in GETDATA 
"RTN","RAPM",107,0)
 S RAEDATE=Y,RAENDDT=RAEDATE_.9999
"RTN","RAPM",108,0)
 ; Set start date back to include current day
"RTN","RAPM",109,0)
 S RABEGDT=(RABDATE-1)_.9999
"RTN","RAPM",110,0)
 Q
"RTN","RAPM",111,0)
SORT ; Prompt for Sorted by
"RTN","RAPM",112,0)
 W !!,"Sort report by"
"RTN","RAPM",113,0)
 S DIR(0)="S^C:Case Number;E:Category of Exam;I:Imaging Type;P:Patient Name;R:Radiologist;T:Hrs to Transcrip.;V:Hrs to Verif."
"RTN","RAPM",114,0)
 S DIR("A")="Select Sorted by",DIR("B")="C"
"RTN","RAPM",115,0)
 D ^DIR
"RTN","RAPM",116,0)
 Q:$D(DIRUT)
"RTN","RAPM",117,0)
 S RASORT=Y
"RTN","RAPM",118,0)
 S DIR(0)="N^0:240"
"RTN","RAPM",119,0)
 S DIR("A")="Print PENDING and "_$S(RASORT="V":"Verif.",1:"Transrip.")_" hours greater than or equal to"
"RTN","RAPM",120,0)
 S DIR("B")="72"
"RTN","RAPM",121,0)
 S DIR("?")="Enter minimum number of hours elapsed since registration."
"RTN","RAPM",122,0)
 D ^DIR Q:$D(DIRUT)  S RASINCE=Y
"RTN","RAPM",123,0)
 Q
"RTN","RAPM",124,0)
DEV ; Device
"RTN","RAPM",125,0)
 I $D(DIRUT) D EXIT Q
"RTN","RAPM",126,0)
 W:RARPT="B" !!,"Specify device for both summary and detail reports."
"RTN","RAPM",127,0)
 D TASK
"RTN","RAPM",128,0)
 D ZIS^RAUTL
"RTN","RAPM",129,0)
 Q
"RTN","RAPM",130,0)
TASK ; set vars for taskman
"RTN","RAPM",131,0)
 S ZTRTN="START^RAPM"
"RTN","RAPM",132,0)
 S ZTSAVE("RA*")=""
"RTN","RAPM",133,0)
 S ZTSAVE("^TMP($J,")=""
"RTN","RAPM",134,0)
 ;S ZTSAVE("^TMP($J,""RA D-TYPE"",")=""
"RTN","RAPM",135,0)
 ;S ZTSAVE("^TMP($J,""RA I-TYPE"",")=""
"RTN","RAPM",136,0)
 S:$G(RAP99) ZTDESC="Radiology Timeliness Performance Reports"
"RTN","RAPM",137,0)
 S:'$G(RAP99) ZTDESC="Radiology Verification Timeliness Report"
"RTN","RAPM",138,0)
 Q
"RTN","RAPM",139,0)
 ;
"RTN","RAPM",140,0)
GETDATA ; Get all the data
"RTN","RAPM",141,0)
 ; Order thru Exam Date (RADTE)
"RTN","RAPM",142,0)
 S RADTE=RABEGDT F  S RADTE=$O(^RADPT("AR",RADTE)) Q:'RADTE  Q:(RADTE>RAENDDT)  D
"RTN","RAPM",143,0)
 . S RADFN="" F  S RADFN=$O(^RADPT("AR",RADTE,RADFN)) Q:'RADFN  D
"RTN","RAPM",144,0)
 . . ; Get patient name
"RTN","RAPM",145,0)
 . . S RAPATNM=$$GET1^DIQ(2,RADFN,.01) S:RAPATNM="" RAPATNM=" "
"RTN","RAPM",146,0)
 . . ; Order thru inverse Exam Date (RADTI)
"RTN","RAPM",147,0)
 . . S RADTI="" F  S RADTI=$O(^RADPT("AR",RADTE,RADFN,RADTI)) Q:'RADTI  D CHECK
"RTN","RAPM",148,0)
 . . Q
"RTN","RAPM",149,0)
 . Q
"RTN","RAPM",150,0)
 Q
"RTN","RAPM",151,0)
CHECK ; Check type of image
"RTN","RAPM",152,0)
 Q:'$D(^RADPT(RADFN,"DT",RADTI))  ;no exam data at all
"RTN","RAPM",153,0)
 S RAITYP=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2)
"RTN","RAPM",154,0)
 S RAIMGTYP=$P($G(^RA(79.2,+RAITYP,0)),U,1)
"RTN","RAPM",155,0)
 ; quit if img typ is known AND does not match selection
"RTN","RAPM",156,0)
 I RAIMGTYP'="",'$D(^TMP($J,"RA I-TYPE",RAIMGTYP)) Q
"RTN","RAPM",157,0)
 I RAIMGTYP="" S RAIMGTYP="(unknown)"
"RTN","RAPM",158,0)
 ;
"RTN","RAPM",159,0)
 ; Check division - Quit if no division selected
"RTN","RAPM",160,0)
 S RASELDIV=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,3)
"RTN","RAPM",161,0)
 S RACHKDIV=$P($G(^DIC(4,+RASELDIV,0)),U,1)
"RTN","RAPM",162,0)
 ; quit if div is known AND does not match selection 
"RTN","RAPM",163,0)
 I RACHKDIV'="",'$D(^TMP($J,"RA D-TYPE",RACHKDIV)) Q
"RTN","RAPM",164,0)
 S:RACHKDIV="" RANODIV=1
"RTN","RAPM",165,0)
 ;
"RTN","RAPM",166,0)
 ; Get exam related data
"RTN","RAPM",167,0)
 S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:'RACNI  D
"RTN","RAPM",168,0)
 . S (RACN0,RAEXST,RANUM,RACN,RAPRIM,RAPRIMNM,RACAT,RARPTTXT)=""
"RTN","RAPM",169,0)
 . S (RARPTDT,RAVERDT,RARPTST,RADHT,RADHV,RATDFHR,RAVDFHR)=""
"RTN","RAPM",170,0)
 . ; Get 0 node (RACN0) of ^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)
"RTN","RAPM",171,0)
 . S RACN0=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPM",172,0)
 . Q:RACN0=""  ; no exam data
"RTN","RAPM",173,0)
 . ; Get Case number: Exam Date - Case Number
"RTN","RAPM",174,0)
 . S RACN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_$P(RACN0,U,1)
"RTN","RAPM",175,0)
 . ; Get exam status
"RTN","RAPM",176,0)
 . S RAEXST=$P(RACN0,U,3)
"RTN","RAPM",177,0)
 . Q:RAEXST=""  ; no exam status
"RTN","RAPM",178,0)
 . ; Quit if exam's CREDIT METHOD is 2 = no credit
"RTN","RAPM",179,0)
 . Q:$P(RACN0,U,26)=2
"RTN","RAPM",180,0)
 . ; Quit if exam status is "Cancelled"
"RTN","RAPM",181,0)
 . I $P(^RA(72,RAEXST,0),U,3)=0 Q
"RTN","RAPM",182,0)
 . ; Get number of set - '1' separate; '2' for combined report.
"RTN","RAPM",183,0)
 . S RANUM=$P(RACN0,U,25)
"RTN","RAPM",184,0)
 . ; if member of set > 1 then set RACNI to 99999 to skip remaining cases
"RTN","RAPM",185,0)
 . I RANUM>1 S RACNI=99999
"RTN","RAPM",186,0)
 . ; Get Radiologist (Primary Interpreting Staff) internal # and name. 
"RTN","RAPM",187,0)
 . S RAPRIM=$P(RACN0,U,15)
"RTN","RAPM",188,0)
 . ; if specific radiologist requested, quit if not his/her case
"RTN","RAPM",189,0)
 . I RARAD,RAPRIM'=RARAD Q
"RTN","RAPM",190,0)
 . S RAPRIMNM=$$GET1^DIQ(200,RAPRIM,.01) S:RAPRIMNM="" RAPRIMNM=" "
"RTN","RAPM",191,0)
 . ; Get Category of Exam
"RTN","RAPM",192,0)
 . S RACAT=$P(RACN0,U,4)
"RTN","RAPM",193,0)
 . ; Get Procedure Name
"RTN","RAPM",194,0)
 . S RAPRCN=$P($G(^RAMIS(71,+$P(RACN0,U,2),0)),U)
"RTN","RAPM",195,0)
 . ; Get IEN of imaging report
"RTN","RAPM",196,0)
 . S RARPTTXT=$P(RACN0,U,17)
"RTN","RAPM",197,0)
 . ; Pending if no imaging report OR report doesn't exist in the Report
"RTN","RAPM",198,0)
 . ; file (#74) OR Stub report
"RTN","RAPM",199,0)
 . S RAHASR=0 ;=1 has real report
"RTN","RAPM",200,0)
 . I $D(^RARPT(+RARPTTXT,0)),'$$STUB^RAEDCN1(+RARPTTXT) S RAHASR=1
"RTN","RAPM",201,0)
 . I 'RAHASR D
"RTN","RAPM",202,0)
 . . S ^TMP($J,"RAPM","TR",0)=$G(^TMP($J,"RAPM","TR",0))+1
"RTN","RAPM",203,0)
 . . S ^TMP($J,"RAPM","VR",0)=$G(^TMP($J,"RAPM","VR",0))+1
"RTN","RAPM",204,0)
 . ; Get report info. if real report exists.
"RTN","RAPM",205,0)
 . I RAHASR D RPTINFO^RAPM1
"RTN","RAPM",206,0)
 . D STORE^RAPM2
"RTN","RAPM",207,0)
 . ; Calculate the total number of reports
"RTN","RAPM",208,0)
 . S ^TMP($J,"RAPM","TOTAL")=$G(^TMP($J,"RAPM","TOTAL"))+1
"RTN","RAPM",209,0)
 Q
"RTN","RAPM",210,0)
EXIT ; Exit
"RTN","RAPM",211,0)
 ; Close device
"RTN","RAPM",212,0)
 D CLOSE^RAUTL
"RTN","RAPM",213,0)
 K RACN0,RAEXST,RANUM,RACN,RAPRIM,RAPRIMNM,RACAT,RARPTTXT,RAANS,RATXT
"RTN","RAPM",214,0)
 K DIR,DIRUT,RABDATE,RAEDATE,RARPT,DTDIFF,RABEGDT,RAENDDT,RAITYP,RAIMGTYP,RATYP
"RTN","RAPM",215,0)
 K ZTRTN,ZTSAVE,ZTDESC,RAPG,RASELDIV,RACHKDIV,RACNO,RAVHRS
"RTN","RAPM",216,0)
 K RADIV,RAN,RAIMG,RAREC1,RATOTCNT,RACNI,RADFN,RADTE,RADTI,RAHD,RAPATNM
"RTN","RAPM",217,0)
 K RAPOP,RAPSTX,RAQUIT,RAREC,RARPTDT,RARPTST,RASORT,RASRT,RATDFHR,RAHASR
"RTN","RAPM",218,0)
 K RATDFSEC,RATHRS,RAVDFHR,RAVDFSEC,RAVERDT,RAMES,RALINE,RAMAXDT,RADD
"RTN","RAPM",219,0)
 K RAANS2,RAIOM,RAHDR,RANODIV,RASINCE,RADHT,RADHV,RAVAL,RAPRCN
"RTN","RAPM",220,0)
 K RAXIT,RAIO,RALDENT,RALMAX,RALUSED,RATAIL,RAS99,RAL99,RAP99,RAN
"RTN","RAPM",221,0)
 K ^TMP($J)
"RTN","RAPM",222,0)
 Q
"RTN","RAPM2")
0^22^B95462078^B88209551
"RTN","RAPM2",1,0)
RAPM2 ;HOIFO/TH-Radiology Performance Monitors/Indicator; ;3/20/04  12:41
"RTN","RAPM2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**37,44,48,63,67,99**;Mar 16, 1998;Build 5
"RTN","RAPM2",3,0)
 ; IA 10090 allows Read w/Fileman for entire file 4
"RTN","RAPM2",4,0)
 ; Supported IA #10103 reference to ^XLFDT
"RTN","RAPM2",5,0)
 ; Supported IA #2056 reference to ^DIQ
"RTN","RAPM2",6,0)
 ; Supported IA #2541 reference to KSP^XUPARAM
"RTN","RAPM2",7,0)
 ; RVD - 3/20/09 p99
"RTN","RAPM2",8,0)
 ; Print Detail report
"RTN","RAPM2",9,0)
DETAIL ; Print Detail report
"RTN","RAPM2",10,0)
 I ($Y+5)>IOSL!(RARPT="B") D
"RTN","RAPM2",11,0)
 . I IO=IO(0),($E(IOST,1,2)="C-") D
"RTN","RAPM2",12,0)
 . . R !,"Press RETURN to continue. ",X:DTIME
"RTN","RAPM2",13,0)
 D HDR("D")
"RTN","RAPM2",14,0)
 D PRTTOT
"RTN","RAPM2",15,0)
 D DHDR
"RTN","RAPM2",16,0)
 D DRPT Q:RAXIT
"RTN","RAPM2",17,0)
 D DFOOT
"RTN","RAPM2",18,0)
 Q
"RTN","RAPM2",19,0)
 ;
"RTN","RAPM2",20,0)
PRTTOT ; Print total number of reports
"RTN","RAPM2",21,0)
 S RATOTCNT=+$G(^TMP($J,"RAPM","TOTAL"))
"RTN","RAPM2",22,0)
 W !,"Total number of reports expected for procedures performed during specified date range: ",$J(RATOTCNT,$L(RATOTCNT))
"RTN","RAPM2",23,0)
 Q
"RTN","RAPM2",24,0)
 ;
"RTN","RAPM2",25,0)
DHDR ; Header
"RTN","RAPM2",26,0)
 I ($Y+5)>IOSL D
"RTN","RAPM2",27,0)
 . S RAPG=RAPG+1,RAHD(0)="Detail Verification Timeliness Report"
"RTN","RAPM2",28,0)
 . W @IOF,!?(RAIOM-$L(RAHD(0))\2),RAHD(0),?(RAIOM-10),"Page: ",$G(RAPG)
"RTN","RAPM2",29,0)
 W !!,?32,"Date/Time",?48,"Date/Time",?68,"Date/Time",?102,"Cat"
"RTN","RAPM2",30,0)
 W ?106,"Rpt",?110,"Img",?116,"Procedure"
"RTN","RAPM2",31,0)
 W !,"Patient Name",?18,"Case #",?32,"Registered",?48,"Transcribed",?62,"Hrs"
"RTN","RAPM2",32,0)
 W ?68,"Verified",?82,"Hrs",?87,"Radiologist",?102,"Exm",?106,"Sts"
"RTN","RAPM2",33,0)
 W ?110,"Typ",?119,"Name",!
"RTN","RAPM2",34,0)
 Q
"RTN","RAPM2",35,0)
 ;
"RTN","RAPM2",36,0)
DRPT ; Read records
"RTN","RAPM2",37,0)
 S RAXIT=0
"RTN","RAPM2",38,0)
 I '$D(^TMP($J,"RAPM2")) W !!?30,"No data to print...",!!!!! Q
"RTN","RAPM2",39,0)
 S D1="" F  S D1=$O(^TMP($J,"RAPM2",D1)) Q:D1=""  Q:RAXIT  D
"RTN","RAPM2",40,0)
 . S D2="" F  S D2=$O(^TMP($J,"RAPM2",D1,D2)) Q:D2=""  Q:RAXIT  D
"RTN","RAPM2",41,0)
 . . S D3="" F  S D3=$O(^TMP($J,"RAPM2",D1,D2,D3)) Q:D3=""  Q:RAXIT  D
"RTN","RAPM2",42,0)
 . . . D SRT
"RTN","RAPM2",43,0)
 Q
"RTN","RAPM2",44,0)
 ;
"RTN","RAPM2",45,0)
SRT ; Read records
"RTN","RAPM2",46,0)
 I RASORT="C"!(RASORT="P") S RAREC=$G(^TMP($J,"RAPM2",D1,D2,D3)) D DET Q
"RTN","RAPM2",47,0)
 S D4="" F  S D4=$O(^TMP($J,"RAPM2",D1,D2,D3,D4)) Q:D4=""  Q:RAXIT  D
"RTN","RAPM2",48,0)
 . S RAREC=$G(^TMP($J,"RAPM2",D1,D2,D3,D4)) D DET
"RTN","RAPM2",49,0)
 Q
"RTN","RAPM2",50,0)
 ;
"RTN","RAPM2",51,0)
DET ; Print detail records
"RTN","RAPM2",52,0)
 ; use Transcription elasped hr for all sorts, except if sort by Verif.
"RTN","RAPM2",53,0)
 S RAVAL=$S(RASORT="V":$P(RAREC,U,13),1:$P(RAREC,U,12))
"RTN","RAPM2",54,0)
 ; remove symbols before comparison
"RTN","RAPM2",55,0)
 S:$E(RAVAL)="<" RAVAL=.5 S:$E(RAVAL)=">" RAVAL=999
"RTN","RAPM2",56,0)
 ; include PENDING and those with hours > RASINCE
"RTN","RAPM2",57,0)
 I RAVAL'="",RAVAL<RASINCE Q
"RTN","RAPM2",58,0)
 I ($Y+5)>IOSL D
"RTN","RAPM2",59,0)
 . I IO=IO(0) D
"RTN","RAPM2",60,0)
 . . I $E(IOST,1,2)="C-" R !,"Press RETURN to continue or ""^"" to exit. ",X:DTIME S:X="^" RAXIT=1
"RTN","RAPM2",61,0)
 . Q:RAXIT
"RTN","RAPM2",62,0)
 . D DHDR
"RTN","RAPM2",63,0)
 Q:RAXIT
"RTN","RAPM2",64,0)
 W !,$E($P(RAREC,U,2),1,15)
"RTN","RAPM2",65,0)
 W ?17,$P(RAREC,U,1)
"RTN","RAPM2",66,0)
 W ?31,$P($$FMTE^XLFDT($P(RAREC,U,3),"2FS"),":",1,2)
"RTN","RAPM2",67,0)
 W ?46,$P($$FMTE^XLFDT($P(RAREC,U,4),"2FS"),":",1,2),?61,$J($P(RAREC,U,12),4)
"RTN","RAPM2",68,0)
 W ?66,$P($$FMTE^XLFDT($P(RAREC,U,5),"2FS"),":",1,2),?81,$J($P(RAREC,U,13),4)
"RTN","RAPM2",69,0)
 I $P(RAREC,U,6)'="" W ?86,$E($P(RAREC,U,6),1,16)
"RTN","RAPM2",70,0)
 W ?104,$P(RAREC,U,7),?107,$P(RAREC,U,8)
"RTN","RAPM2",71,0)
 W ?110,$E($P(RAREC,U,9),1,3),?114,$E($P(RAREC,U,14),1,15)
"RTN","RAPM2",72,0)
 W:$P(RAREC,U,11)="" ?130,"*D"
"RTN","RAPM2",73,0)
 Q
"RTN","RAPM2",74,0)
 ;
"RTN","RAPM2",75,0)
DFOOT ; Footer for Detail report
"RTN","RAPM2",76,0)
 I ($Y+5)>IOSL D
"RTN","RAPM2",77,0)
 . I IO=IO(0) D
"RTN","RAPM2",78,0)
 . . I $E(IOST,1,2)="C-" R !,"Press RETURN to continue. ",X:DTIME
"RTN","RAPM2",79,0)
 . D DHDR
"RTN","RAPM2",80,0)
 W !!,"Note: Category of Exam: 'I' for Inpatient; 'O' for Outpatient; "
"RTN","RAPM2",81,0)
 W "'C' for Contract; 'S' for Sharing; 'E' for Employee; 'R' for Research"
"RTN","RAPM2",82,0)
 W !,"      Report Status:    'V' for Verififed; 'R' for Released/Not "
"RTN","RAPM2",83,0)
 W "Verified; 'PD' for Problem Draft; 'D' for Draft"
"RTN","RAPM2",84,0)
 W:RANODIV !," *D = Division is missing"
"RTN","RAPM2",85,0)
 W !!?5,"* A printset, i.e., a set of multiple exams that share the same report, will be expected to have 1 report."
"RTN","RAPM2",86,0)
 W !!?5,"* Cancelled and ""No Credit"" cases are excluded from this report."
"RTN","RAPM2",87,0)
 Q
"RTN","RAPM2",88,0)
 ;
"RTN","RAPM2",89,0)
STORE ; Store detail information
"RTN","RAPM2",90,0)
 Q:RARPT="S"
"RTN","RAPM2",91,0)
 ; for storage subscript: if no rpt dt, set to neg
"RTN","RAPM2",92,0)
 S RADHT=$S(RARPTDT="":-1,1:RATDFHR)
"RTN","RAPM2",93,0)
 S RADHV=$S(RAVERDT="":-1,1:RAVDFHR)
"RTN","RAPM2",94,0)
 ; for display: truncate decimal portion of hours
"RTN","RAPM2",95,0)
 S:RATDFHR'="" RATDFHR=RATDFHR\1
"RTN","RAPM2",96,0)
 S:RAVDFHR'="" RAVDFHR=RAVDFHR\1
"RTN","RAPM2",97,0)
 S RATDFHR=$S(RATDFHR="":"",RATDFHR<1:"<1",RATDFHR>999:">999",1:RATDFHR)
"RTN","RAPM2",98,0)
 S RAVDFHR=$S(RAVDFHR="":"",RAVDFHR<1:"<1",RAVDFHR>999:">999",1:RAVDFHR)
"RTN","RAPM2",99,0)
 ;
"RTN","RAPM2",100,0)
 S RAREC1=RACN_U_RAPATNM_U_RADTE_U_RARPTDT_U
"RTN","RAPM2",101,0)
 S RAREC1=RAREC1_RAVERDT_U_RAPRIMNM_U_RACAT_U_RARPTST_U_RAIMGTYP_U
"RTN","RAPM2",102,0)
 S RAREC1=RAREC1_RADFN_U_RACHKDIV_U_RATDFHR_U_RAVDFHR_U_RAPRCN
"RTN","RAPM2",103,0)
 ;
"RTN","RAPM2",104,0)
 I RASORT="C" S ^TMP($J,"RAPM2",$P(RADTE,"."),RACN,RAPATNM)=RAREC1
"RTN","RAPM2",105,0)
 I RASORT="P" S ^TMP($J,"RAPM2",RAPATNM,$P(RADTE,"."),RACN)=RAREC1
"RTN","RAPM2",106,0)
 I RASORT="I" S ^TMP($J,"RAPM2",RAIMGTYP,$P(RADTE,"."),RACN,RAPATNM)=RAREC1
"RTN","RAPM2",107,0)
 I RASORT="E" S ^TMP($J,"RAPM2",RACAT,$P(RADTE,"."),RACN,RAPATNM)=RAREC1
"RTN","RAPM2",108,0)
 I RASORT="R" S ^TMP($J,"RAPM2",RAPRIMNM,$P(RADTE,"."),RACN,RAPATNM)=RAREC1
"RTN","RAPM2",109,0)
 I RASORT="T" S ^TMP($J,"RAPM2",RADHT,RADTE,RACN,RAPATNM)=RAREC1
"RTN","RAPM2",110,0)
 I RASORT="V" S ^TMP($J,"RAPM2",RADHV,RADTE,RACN,RAPATNM)=RAREC1
"RTN","RAPM2",111,0)
 Q
"RTN","RAPM2",112,0)
EMAIL ; Ask if ready to email the summary report
"RTN","RAPM2",113,0)
 N RA1
"RTN","RAPM2",114,0)
 W ! S DIR(0)="Y"
"RTN","RAPM2",115,0)
 S DIR("A")="Send summary report to local mail group ""G.RAD PERFORMANCE INDICATOR"""
"RTN","RAPM2",116,0)
 S DIR("B")="Yes"
"RTN","RAPM2",117,0)
 D ^DIR
"RTN","RAPM2",118,0)
 Q:$D(DIRUT)
"RTN","RAPM2",119,0)
 S RAANS=Y
"RTN","RAPM2",120,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPM2",121,0)
 I '$O(^RA(79,RA1,1,0)) D  Q
"RTN","RAPM2",122,0)
 . W !!,?5,"No OUTLOOK mail group(s) have been entered yet."
"RTN","RAPM2",123,0)
 . Q
"RTN","RAPM2",124,0)
 W ! S DIR(0)="Y"
"RTN","RAPM2",125,0)
 S DIR("A")="Send summary report to OUTLOOK mail group(s)"
"RTN","RAPM2",126,0)
 S DIR("B")="Yes"
"RTN","RAPM2",127,0)
 D ^DIR
"RTN","RAPM2",128,0)
 S RAANS2=Y
"RTN","RAPM2",129,0)
 I RAANS2 D CKMONTH^RAPM4
"RTN","RAPM2",130,0)
 Q
"RTN","RAPM2",131,0)
SEND ; Send summary report to mail group
"RTN","RAPM2",132,0)
 I RAANS=0,RAANS2=0 Q
"RTN","RAPM2",133,0)
 N RA1,RA2,RASVSUB,RASVTEXT,RASTR
"RTN","RAPM2",134,0)
 S:$G(RAP99) XMSUB="Radiology Timeliness Performance Reports"
"RTN","RAPM2",135,0)
 S:'$G(RAP99) XMSUB="Radiology Summary Verification Timeliness"
"RTN","RAPM2",136,0)
 S XMDUZ=DUZ
"RTN","RAPM2",137,0)
 S XMTEXT="^TMP($J,""RAPM"","
"RTN","RAPM2",138,0)
 S RASVSUB=XMSUB,RASVTEXT=XMTEXT
"RTN","RAPM2",139,0)
 I RAANS=1 D
"RTN","RAPM2",140,0)
 . S XMY("G.RAD PERFORMANCE INDICATOR")=""
"RTN","RAPM2",141,0)
 . D ^XMD
"RTN","RAPM2",142,0)
 . K XMY
"RTN","RAPM2",143,0)
 . Q
"RTN","RAPM2",144,0)
 I RAANS2=1 D
"RTN","RAPM2",145,0)
 . S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPM2",146,0)
 . S XMSUB=RASVSUB,XMTEXT=RASVTEXT
"RTN","RAPM2",147,0)
 . S RA2=0
"RTN","RAPM2",148,0)
 .; Outlook mailgroup flagged for HQ should always get automatic mid-
"RTN","RAPM2",149,0)
 .; mid-month rpt, but only get user-initiated rpt if user specifies so
"RTN","RAPM2",150,0)
 .;   
"RTN","RAPM2",151,0)
 .; All non-HQ outlook mailgroups get all reports, including autom rpt
"RTN","RAPM2",152,0)
 .;
"RTN","RAPM2",153,0)
 . F  S RA2=$O(^RA(79,RA1,1,RA2)) Q:'RA2  S RASTR=$G(^(RA2,0)) D
"RTN","RAPM2",154,0)
 .. I $P(RASTR,U,2)="Y",$G(RAUTOM) S XMY($P(RASTR,U))=""
"RTN","RAPM2",155,0)
 .. I $P(RASTR,U,2)'="Y" S XMY($P(RASTR,U))=""
"RTN","RAPM2",156,0)
 .. Q
"RTN","RAPM2",157,0)
 . Q:'$D(XMY)
"RTN","RAPM2",158,0)
 . D ^XMD
"RTN","RAPM2",159,0)
 . K XMY
"RTN","RAPM2",160,0)
 . Q
"RTN","RAPM2",161,0)
 K XMDUZ
"RTN","RAPM2",162,0)
 Q
"RTN","RAPM2",163,0)
HDR(RATYP) ; Print appropriate header and process wait and time
"RTN","RAPM2",164,0)
 U:RAIO IO S RAPG=$G(RAPG)+1
"RTN","RAPM2",165,0)
 I RAPG>1!($E(IOST,1,2)="C-") W:RAIO @IOF
"RTN","RAPM2",166,0)
 I $E(IOST,1,2)="P-",(RAPG>1) W:RAIO @IOF
"RTN","RAPM2",167,0)
 S RAHD(0)=$S(RATYP="S":"Summary",RATYP="D":"Detail",1:"")
"RTN","RAPM2",168,0)
 S RAHD(0)=RAHD(0)_" Verification Timeliness Report"
"RTN","RAPM2",169,0)
 S RAIOM=$S(RATYP="S":80,1:IOM)
"RTN","RAPM2",170,0)
 W:RAIO !?(RAIOM-$L(RAHD(0))\2),RAHD(0),?(RAIOM-10),"Page: ",$G(RAPG),!
"RTN","RAPM2",171,0)
 I RATYP="S" S RAN=RAN+1 D
"RTN","RAPM2",172,0)
 . S ^TMP($J,"RAPM",RAN)="                     Summary Verification Timeliness Report          Page: "_$G(RAPG) S RAN=RAN+1
"RTN","RAPM2",173,0)
 . S ^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM2",174,0)
 ;
"RTN","RAPM2",175,0)
 S:'$G(DUZ(2)) DUZ(2)=$$KSP^XUPARAM("INST")  ;added by p99
"RTN","RAPM2",176,0)
 D GETS^DIQ(4,DUZ(2),".01;14*;99","E","RAR","RAMSG")
"RTN","RAPM2",177,0)
 K X
"RTN","RAPM2",178,0)
 S X(1)=RAR(4,DUZ(2)_",",.01,"E") ; Name of facility
"RTN","RAPM2",179,0)
 S X(2)=RAR(4,DUZ(2)_",",99,"E") ;  Station Number
"RTN","RAPM2",180,0)
 I $D(RAR(4.014)) D
"RTN","RAPM2",181,0)
 . S X(3)=RAR(4.014,"1,"_DUZ(2)_",",.01,"E") ; Association
"RTN","RAPM2",182,0)
 . S X(4)=RAR(4.014,"1,"_DUZ(2)_",",1,"E") ; Parent of Association
"RTN","RAPM2",183,0)
 . S X(5)=$S(X(3)="VISN":X(4),1:"") ; should be VISN number
"RTN","RAPM2",184,0)
 E  S X(5)=""
"RTN","RAPM2",185,0)
 ;
"RTN","RAPM2",186,0)
 W:RAIO !,"Facility: ",X(1),?41,"Station: ",X(2),?60,"VISN: ",X(5)
"RTN","RAPM2",187,0)
 I RATYP="S" D
"RTN","RAPM2",188,0)
 . S $P(X(6)," ",79)=""
"RTN","RAPM2",189,0)
 . S $E(X(6),1,(10+$L(X(1))))="Facility: "_X(1)
"RTN","RAPM2",190,0)
 . S $E(X(6),41,(50+$L(X(2))))="Station: "_X(2)
"RTN","RAPM2",191,0)
 . S $E(X(6),60,(66+$L(X(5))))="VISN: "_X(5)
"RTN","RAPM2",192,0)
 . S ^TMP($J,"RAPM",RAN)=X(6)
"RTN","RAPM2",193,0)
 . S RAN=RAN+1
"RTN","RAPM2",194,0)
 . Q
"RTN","RAPM2",195,0)
 W !,"Division: "
"RTN","RAPM2",196,0)
 I RATYP="S" S ^TMP($J,"RAPM",RAN)="Division: "
"RTN","RAPM2",197,0)
 D DIV
"RTN","RAPM2",198,0)
 S:(RATYP="S") RAN=RAN+1
"RTN","RAPM2",199,0)
 ;
"RTN","RAPM2",200,0)
 W:RAIO !,"Exam Date Range: "
"RTN","RAPM2",201,0)
 W:RAIO $$FMTE^XLFDT(RABDATE,"2D")," - ",$$FMTE^XLFDT(RAEDATE,"2D")
"RTN","RAPM2",202,0)
 I RATYP="S" D
"RTN","RAPM2",203,0)
 .S:'$G(RAP99) ^TMP($J,"RAPM",RAN)=""
"RTN","RAPM2",204,0)
 .S RAN=RAN+1,^TMP($J,"RAPM",RAN)="Exam Date Range: "_$$FMTE^XLFDT(RABDATE,"2D")_" - "_$$FMTE^XLFDT(RAEDATE,"2D")_"       " S RAN=RAN+1
"RTN","RAPM2",205,0)
 ;
"RTN","RAPM2",206,0)
 W:RAIO !,"Imaging Type(s): "
"RTN","RAPM2",207,0)
 I RATYP="S",'$G(RAP99) S RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1,^TMP($J,"RAPM",RAN)="Imaging Type(s): "
"RTN","RAPM2",208,0)
 D IMG
"RTN","RAPM2",209,0)
 S:RATYP="S" RAN=RAN+1
"RTN","RAPM2",210,0)
 ;
"RTN","RAPM2",211,0)
 ; Run date and time
"RTN","RAPM2",212,0)
 S NOW=$$NOW^XLFDT,NOW=$P(NOW,".",1)_"."_$E($P(NOW,".",2),1,4)
"RTN","RAPM2",213,0)
 W:RAIO !,"Run Date/Time: ",$$FMTE^XLFDT(NOW,"2P"),!
"RTN","RAPM2",214,0)
 I RATYP="S" S RAN=RAN+1,^TMP($J,"RAPM",RAN)="Run Date/Time: "_$$FMTE^XLFDT(NOW,"2P"),RAN=RAN+1
"RTN","RAPM2",215,0)
 I RARAD D
"RTN","RAPM2",216,0)
 . W:RAIO !,"Primary Interpreting Staff Physician: ",$$GET1^DIQ(200,RARAD,.01),!
"RTN","RAPM2",217,0)
 . I RATYP="S" D
"RTN","RAPM2",218,0)
 .. S ^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM2",219,0)
 .. S ^TMP($J,"RAPM",RAN)="Primary Interpreting Staff Physician: "_$$GET1^DIQ(200,RARAD,.01),RAN=RAN+1
"RTN","RAPM2",220,0)
 .. Q
"RTN","RAPM2",221,0)
 . Q
"RTN","RAPM2",222,0)
 I (RARPT="D"!(RARPT="B")),(RATYP'="S") D
"RTN","RAPM2",223,0)
 . S RASRT=$S(RASORT="C":"Case Number",RASORT="E":"Category of Exam",RASORT="I":"Imaging Type",RASORT="P":"Patient Name",RASORT="R":"Radiologist",RASORT="T":"Hrs to Transcription",RASORT="V":"Hrs to Verification",1:"")
"RTN","RAPM2",224,0)
 . W:RAIO !,"Sorted by: ",RASRT,?45,"Min. hours elasped to "_$S(RASORT="V":"Verification",1:"Transcription")_": "_RASINCE
"RTN","RAPM2",225,0)
 Q
"RTN","RAPM2",226,0)
DIV ; List selected Division
"RTN","RAPM2",227,0)
 Q:'$D(^TMP($J,"RA D-TYPE"))
"RTN","RAPM2",228,0)
 S RADIV="" F I=1:1 S RADIV=$O(^TMP($J,"RA D-TYPE",RADIV)) Q:RADIV=""  D
"RTN","RAPM2",229,0)
 . I $X'>(RAIOM-$L("Division(s): ")) D
"RTN","RAPM2",230,0)
 . . W:RAIO RADIV_$S($O(^TMP($J,"RA D-TYPE",RADIV))]"":", ",1:"")
"RTN","RAPM2",231,0)
 . . I RATYP="S" S ^TMP($J,"RAPM",RAN)=^TMP($J,"RAPM",RAN)_RADIV_$S($O(^TMP($J,"RA D-TYPE",RADIV))]"":", ",1:"")
"RTN","RAPM2",232,0)
 . I $X>(RAIOM-$L("Division(s): ")) D
"RTN","RAPM2",233,0)
 . . W:RAIO !?($X+$L("Division(s): "))
"RTN","RAPM2",234,0)
 . . I RATYP="S" S:'$G(RAP99) RAN=RAN+1,^TMP($J,"RAPM",RAN)="         "
"RTN","RAPM2",235,0)
 Q
"RTN","RAPM2",236,0)
IMG ; List selected Imaging Type(s)
"RTN","RAPM2",237,0)
 Q:'$D(^TMP($J,"RA I-TYPE"))
"RTN","RAPM2",238,0)
 ;N RALMAX,RALUSED,RATAIL,RALDENT
"RTN","RAPM2",239,0)
 S RALDENT=$L("Imaging Type(s): ")
"RTN","RAPM2",240,0)
 S RALMAX=RAIOM-RALDENT
"RTN","RAPM2",241,0)
 S RALUSED=0
"RTN","RAPM2",242,0)
 S RAIMG="" F J=1:1 S RAIMG=$O(^TMP($J,"RA I-TYPE",RAIMG)) Q:RAIMG=""  D
"RTN","RAPM2",243,0)
 . S RATAIL=$S($O(^TMP($J,"RA I-TYPE",RAIMG))]"":", ",1:"")
"RTN","RAPM2",244,0)
 . I (RALUSED+$L(RAIMG)+$L(RATAIL))>RALMAX D
"RTN","RAPM2",245,0)
 .. W:RAIO !?RALDENT
"RTN","RAPM2",246,0)
 .. I RATYP="S",'$G(RAP99) S RAN=RAN+1,^TMP($J,"RAPM",RAN)="                 "
"RTN","RAPM2",247,0)
 .. S RALUSED=0
"RTN","RAPM2",248,0)
 .. Q
"RTN","RAPM2",249,0)
 . W:RAIO RAIMG_RATAIL
"RTN","RAPM2",250,0)
 . I RATYP="S",'$G(RAP99) S ^TMP($J,"RAPM",RAN)=^TMP($J,"RAPM",RAN)_RAIMG_RATAIL
"RTN","RAPM2",251,0)
 . S RALUSED=RALUSED+$L(RAIMG)+$L(RATAIL)
"RTN","RAPM2",252,0)
 Q
"RTN","RAPM3")
0^4^B102916259^B87160204
"RTN","RAPM3",1,0)
RAPM3 ;HOIFO/SM-Radiology Performance Monitors/Indicator ;3/20/09  11:11
"RTN","RAPM3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**37,44,63,67,99**;Mar 16, 1998;Build 5
"RTN","RAPM3",3,0)
 ; IA #11090 allows Fileman read of Entire file 4
"RTN","RAPM3",4,0)
 ; Supported IA #10103 reference to ^XLFDT
"RTN","RAPM3",5,0)
 ; Supported IA #10000 reference to C^%DTC
"RTN","RAPM3",6,0)
 ; Supported IA #2056 reference to ^DIQ
"RTN","RAPM3",7,0)
 ; Supported IA #10142 reference to EN^DDIOL
"RTN","RAPM3",8,0)
 ; RVD - 9/19/09 p99
"RTN","RAPM3",9,0)
 Q
"RTN","RAPM3",10,0)
EN1 ;entry/edit OUTLOOK mail groups
"RTN","RAPM3",11,0)
 N RA1,RA2
"RTN","RAPM3",12,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPM3",13,0)
 I $O(^RA(79,RA1,1,0)) D
"RTN","RAPM3",14,0)
 . W !?5,"OUTLOOK mail groups previously entered:",!?56,"OQP Perf. Mgmt?",!?56,"--------------"
"RTN","RAPM3",15,0)
 . S RA2=0
"RTN","RAPM3",16,0)
 . F  S RA2=$O(^RA(79,RA1,1,RA2)) Q:'RA2  W !?8,$P(^(RA2,0),U),?63,$P(^(0),U,2)
"RTN","RAPM3",17,0)
 . Q
"RTN","RAPM3",18,0)
 W !!?5,"You may add another mail group."
"RTN","RAPM3",19,0)
 W !,?5,"To edit or replace a mail group, you must delete the old one first.",!
"RTN","RAPM3",20,0)
 L +^RA(79,RA1,1):1 I '$T W !,$C(7),"Can't lock ^RA,",RA1,",1) now, try again later." Q
"RTN","RAPM3",21,0)
 S DIE="^RA(79,",DA=RA1,DR="175"
"RTN","RAPM3",22,0)
 D ^DIE
"RTN","RAPM3",23,0)
 L -^RA(79,RA1,1)
"RTN","RAPM3",24,0)
 Q
"RTN","RAPM3",25,0)
TASKLM ; task off last quarters's Perf. Indic. Summary Report [RA PERFORMIN TASKLM]
"RTN","RAPM3",26,0)
 ; define report type as summary
"RTN","RAPM3",27,0)
 N RA1,RA2,RA3,RABDATE,RAEDATE,RADAYS,RAENDDT,RABEGDT,RAUTOM,RALASTM,RAP99,RADAY,DIR
"RTN","RAPM3",28,0)
 N M1,M2,X1,X2,Y1,Y2
"RTN","RAPM3",29,0)
 ; RALASTM flags this option RA PERFORMIN TASKLM, queued or interactive
"RTN","RAPM3",30,0)
 S (RA3,RAP99,RALASTM)=1
"RTN","RAPM3",31,0)
 ; if tasked here, set RAUTOM to flag automatic queued mid-month report for the last quarter
"RTN","RAPM3",32,0)
 I $D(ZTQUEUED) S RAUTOM=1
"RTN","RAPM3",33,0)
 ; if interactive, display Outlook mail groups and ask if continue
"RTN","RAPM3",34,0)
 I '$D(ZTQUEUED) D  I 'RA3 W !!?5,"** Nothing Done **" Q
"RTN","RAPM3",35,0)
 . W !!?5,"The Summary Report of Last Quarter's data will be sent to the"
"RTN","RAPM3",36,0)
 . W !?5,"Outlook mail group(s) in File 79's PERF INDC SMTP E-MAIL ADDRESS",!
"RTN","RAPM3",37,0)
 . S RA1=$O(^RA(79,0))
"RTN","RAPM3",38,0)
 . I '$O(^RA(79,RA1,1,0)) S RA3=0 W !?5,"** There is no Outlook mail group defined in File 79's",!?8,"PERF INDC SMTP E-MAIL ADDRESS. **",! Q
"RTN","RAPM3",39,0)
 . S RA2=0
"RTN","RAPM3",40,0)
 . F  S RA2=$O(^RA(79,RA1,1,RA2)) Q:'RA2  W !?3,$P(^(RA2,0),U)
"RTN","RAPM3",41,0)
 . W !
"RTN","RAPM3",42,0)
 . ; ask Task Start Time
"RTN","RAPM3",43,0)
 . D RA2DT  ;get ending date for a task range, RA2 variable .
"RTN","RAPM3",44,0)
 . S DIR(0)="D^"_DT_":"_RA2_":AEX"
"RTN","RAPM3",45,0)
 . S DIR("A",1)="  Enter date to start this Task"
"RTN","RAPM3",46,0)
 . S DIR("A")="  (time will be the same hh:mm as now.)"
"RTN","RAPM3",47,0)
 . S DIR("?",1)="The Task date must be at least 11 days from the beginning of this quarter"
"RTN","RAPM3",48,0)
 . S DIR("?",2)="through 10 days after the end of this quarter, based upon calendar quarters:"
"RTN","RAPM3",49,0)
 . S DIR("?",3)=""
"RTN","RAPM3",50,0)
 . S DIR("?",4)="Report Data Qtr:                    Task Date Range:"
"RTN","RAPM3",51,0)
 . S DIR("?",5)="First Quarter                       Mar 11 - Jul 10"
"RTN","RAPM3",52,0)
 . S DIR("?",6)="Second Quarter                      Jul 11 - Oct 10"
"RTN","RAPM3",53,0)
 . S DIR("?",7)="Third Quarter                       Oct 11 - Jan 10"
"RTN","RAPM3",54,0)
 . S DIR("?")="Fourth Quarter                      Jan 11 - Apr 10"
"RTN","RAPM3",55,0)
 . D ^DIR
"RTN","RAPM3",56,0)
 . I $D(DIRUT) S RA3=0 Q
"RTN","RAPM3",57,0)
 . S ZTDTH=Y_"."_$P(($$NOW^XLFDT),".",2)
"RTN","RAPM3",58,0)
 . Q
"RTN","RAPM3",59,0)
 ;
"RTN","RAPM3",60,0)
 ; define LAST QUARTER'S begin and end dates
"RTN","RAPM3",61,0)
 S (Y1,Y2,RAQTRYR)=$E(DT,1,3),RAM1=$E(DT,4,5),RADAY=$E(DT,6,7) ; current yr, month, day
"RTN","RAPM3",62,0)
 ; if background job, only run on 1st, 4th, 7th and 10th after the 10th day,
"RTN","RAPM3",63,0)
 ; so that background job will not run multiple times per quarter. This process
"RTN","RAPM3",64,0)
 ; can still be initiated by a user anytime, automatically process the previous quarter
"RTN","RAPM3",65,0)
 ; and date range not more than 92 days.
"RTN","RAPM3",66,0)
 I $D(ZTQUEUED),('$S(RAM1="01":1,RAM1="04":1,RAM1="07":1,RAM1=10:1,1:0)!(RADAY<11)) Q
"RTN","RAPM3",67,0)
 K ^TMP($J)
"RTN","RAPM3",68,0)
 S RARAD="" ; all radiologists
"RTN","RAPM3",69,0)
 S RARPT="S",RAANS=0,RAANS2=1 ; summary, no local mail, send Outlook mail
"RTN","RAPM3",70,0)
 S RAPQTR=$S(RAM1>9:3,RAM1>6:2,RAM1>3:1,1:4)  ;get quarter to process report
"RTN","RAPM3",71,0)
 S M1=$S(RAM1>9:10,RAM1>6:"07",RAM1>3:"04",1:"01") ;get beg month of the next quarter
"RTN","RAPM3",72,0)
 S M2=$S(RAPQTR=4:10,RAPQTR=3:"07",RAPQTR=2:"04",1:"01")
"RTN","RAPM3",73,0)
 S:RAPQTR=4 Y2=Y1-1
"RTN","RAPM3",74,0)
 I (RAM1=10)&(RADAY<11)!(RAM1="07")&(RADAY<11)!(RAM1="04")&(RADAY<11)!(RAM1="01")&(RADAY<11) D
"RTN","RAPM3",75,0)
 .S M1=$S(RAM1=10:"07",RAM1="07":"04",RAM1="04":"01",1:10)
"RTN","RAPM3",76,0)
 .S M2=$S(RAPQTR=4:"07",RAPQTR=3:"04",RAPQTR=2:"01",1:10)
"RTN","RAPM3",77,0)
 .S Y2=$S(RAPQTR=1:Y1-1,1:Y1)
"RTN","RAPM3",78,0)
 S RA1=Y1_M1_"01" ; Current year and quarter's 1st day of month
"RTN","RAPM3",79,0)
 S RABDATE=Y2_M2_"01" ; Begin date for last quarter's first month
"RTN","RAPM3",80,0)
 S X1=RA1,X2=RABDATE D ^%DTC S RADAYS=X ; No. days in last month
"RTN","RAPM3",81,0)
 S X2=(RADAYS-1),X1=RABDATE D C^%DTC S RAEDATE=X ; End date last month
"RTN","RAPM3",82,0)
 S (RAEDTSV,RAENDDT)=RAEDATE_.9999 ; convert for search loop
"RTN","RAPM3",83,0)
 S (RABDTSV,RABEGDT)=(RABDATE-1)_.9999 ; convert for search loop
"RTN","RAPM3",84,0)
 ; define divisions that have at least 1 active img loc
"RTN","RAPM3",85,0)
 S RA1=0
"RTN","RAPM3",86,0)
 F  S RA1=$O(^RA(79,RA1)) Q:'RA1  D
"RTN","RAPM3",87,0)
 . S RA2=0
"RTN","RAPM3",88,0)
 . ;if div has at least 1 active img loc, then store div in ^tmp
"RTN","RAPM3",89,0)
 . F  S RA2=$O(^RA(79,RA1,"L",RA2)) Q:'RA2  I $D(^(RA2,0)),$P($G(^RA(79.1,+^(0),0)),U,19)="" S RA3=$$GET1^DIQ(4,RA1,.01),^TMP($J,"RA D-TYPE",RA3,RA1)="" Q
"RTN","RAPM3",90,0)
 ; define imaging types if not vascular lab but has file 79.1 BIMG xref
"RTN","RAPM3",91,0)
 S RA1=0
"RTN","RAPM3",92,0)
 F  S RA1=$O(^RA(79.2,RA1)) Q:'RA1  D
"RTN","RAPM3",93,0)
 . I $D(^RA(79.2,RA1,0)) S RA2=$P(^(0),U) I RA2'["VASCULAR LAB",$D(^RA(79.1,"BIMG",RA1)) S ^TMP($J,"RA I-TYPE",RA2,RA1)=""
"RTN","RAPM3",94,0)
 ; task job
"RTN","RAPM3",95,0)
 S ZTIO=""
"RTN","RAPM3",96,0)
 D TASK^RAPM
"RTN","RAPM3",97,0)
 S X1=ZTDESC,X2=ZTDTH ; save taskman vars
"RTN","RAPM3",98,0)
 D ^%ZTLOAD
"RTN","RAPM3",99,0)
 I +$G(ZTSK("D"))>0,$D(ZTSK) D
"RTN","RAPM3",100,0)
 . W !?5,$C(7),"Request queued: ",X1
"RTN","RAPM3",101,0)
 . W !?5,"to start on: ",$$FMTE^XLFDT(X2)
"RTN","RAPM3",102,0)
 . W !?5,"Task #: "_$G(ZTSK)
"RTN","RAPM3",103,0)
 K ^TMP($J)
"RTN","RAPM3",104,0)
 K RAANS,RAANS2,RABDTSV,RAEDTSV,RAM1,RAPQTR,RAQTRYR,RARAD,RARPT,RAP99 ;added in p99
"RTN","RAPM3",105,0)
 Q
"RTN","RAPM3",106,0)
RESCH ; reschedule option that is in file 19.2
"RTN","RAPM3",107,0)
 N RABY,RADT,RAERR,RAWHEN,RAFLAG
"RTN","RAPM3",108,0)
 N D1,M1,Y1,M2,Y2,X
"RTN","RAPM3",109,0)
 ; RAFLAG="" determines if allow LAYGO to file 19.2, if the option "RA 
"RTN","RAPM3",110,0)
 ; PERFORMIN TASKLM" was installed in file 19.2, RAFLAG = "",
"RTN","RAPM3",111,0)
 ; if not installed, then RAFLAG = "L"
"RTN","RAPM3",112,0)
 S RAFLAG=""
"RTN","RAPM3",113,0)
 ; get task status of option
"RTN","RAPM3",114,0)
 D OPTSTAT^XUTMOPT("RA PERFORMIN TASKLM",.RAR)
"RTN","RAPM3",115,0)
 I $P($G(RAR(1)),U) D EN^DDIOL("** Option RA PERFORMIN TASKLM is already scheduled, so nothing done. **",,"!!?5") D PRESS Q
"RTN","RAPM3",116,0)
 I '$D(RAR(1)) D
"RTN","RAPM3",117,0)
 . D EN^DDIOL("** Option RA PERFORMIN TASKLM has not been installed into file 19.2 **",,"!!?5")
"RTN","RAPM3",118,0)
 . D EN^DDIOL("** will install it into file 19.2 now. **",,"!!?5")
"RTN","RAPM3",119,0)
 . S RAFLAG="L"
"RTN","RAPM3",120,0)
 . Q
"RTN","RAPM3",121,0)
 ; task the option that seems to be lost from the task queue
"RTN","RAPM3",122,0)
 D SET15
"RTN","RAPM3",123,0)
 D EN^DDIOL("Now scheduling RA PERFORMIN TASKLM to run on: ",,"!!?5")
"RTN","RAPM3",124,0)
 D RESCH^XUTMOPT("RA PERFORMIN TASKLM",RAWHEN,,RABY,RAFLAG,.RAERR)
"RTN","RAPM3",125,0)
 D OPTSTAT^XUTMOPT("RA PERFORMIN TASKLM",.RAR)
"RTN","RAPM3",126,0)
 I $D(RAR(1))#2 D EN^DDIOL("Task number :   "_+RAR(1),,"!!?37")
"RTN","RAPM3",127,0)
 D PRESS
"RTN","RAPM3",128,0)
 Q
"RTN","RAPM3",129,0)
PRESS R !!?5,"Press RETURN to continue. ",X:DTIME
"RTN","RAPM3",130,0)
 Q
"RTN","RAPM3",131,0)
SET15 ; set some variables for scheduling task
"RTN","RAPM3",132,0)
 S Y1=$E(DT,1,3),M1=$E(DT,4,5),D1=$E(DT,6,7)
"RTN","RAPM3",133,0)
 S Y2=$S(M1="12":Y1+1,1:Y1),M2=$S(M1="12":"01",1:M1+1)
"RTN","RAPM3",134,0)
 S:$L(M2)=1 M2="0"_M2
"RTN","RAPM3",135,0)
 D:D1=15 TODAY D:D1<15 THISM D:D1>15 NEXTM
"RTN","RAPM3",136,0)
 S RAWHEN=$$FMADD^XLFDT(RADT,,,5) ; add 5 mins to scheduled date
"RTN","RAPM3",137,0)
 S RABY="1M(15)" ; every month on the 15th day
"RTN","RAPM3",138,0)
 Q
"RTN","RAPM3",139,0)
TODAY ; today is the 15th
"RTN","RAPM3",140,0)
 S RADT=$$NOW^XLFDT
"RTN","RAPM3",141,0)
 Q
"RTN","RAPM3",142,0)
THISM ; this month on the 15th
"RTN","RAPM3",143,0)
 S RADT=Y1_M1_"15."_$P(($$NOW^XLFDT),".",2)
"RTN","RAPM3",144,0)
 Q
"RTN","RAPM3",145,0)
NEXTM ; next month on the 15th
"RTN","RAPM3",146,0)
 S RADT=Y2_M2_"15."_$P(($$NOW^XLFDT),".",2)
"RTN","RAPM3",147,0)
 Q
"RTN","RAPM3",148,0)
SFOOT ; Footer for Summary Report
"RTN","RAPM3",149,0)
 G:'RAIO SFOOT2
"RTN","RAPM3",150,0)
 I ($Y+5)>IOSL,IO=IO(0) D
"RTN","RAPM3",151,0)
 . I $E(IOST,1,2)="C-" R !,"Press RETURN to continue.",X:DTIME
"RTN","RAPM3",152,0)
 . S RAPG=RAPG+1,RAHDR="Summary Verification Timeliness Report"
"RTN","RAPM3",153,0)
 . W @IOF,!?(RAIOM-$L(RAHDR)\2),RAHDR,?(RAIOM-10),"Page: ",$G(RAPG)
"RTN","RAPM3",154,0)
 W !!?5,"* Columns represent # of hours elapsed from exam date/time through",!?7,"date/time report entered or date/time report was verified."
"RTN","RAPM3",155,0)
 W !?7,"e.g. "">0-24 Hrs"" column represents those exams that had a report"
"RTN","RAPM3",156,0)
 W !?7,"transcribed and/or verified within 0-24 hours from the exam date/time."
"RTN","RAPM3",157,0)
 W !!?5,"* Columns following the initial elapsed time column "">0-24 Hrs"" begin"
"RTN","RAPM3",158,0)
 W !?7,"at .0001 after the starting hour (e.g. "">24-48 Hrs"" = starts at 24.001",!?7,"through the 48th hour.)",!
"RTN","RAPM3",159,0)
 W !?5,"* PENDING means there's no data for DATE REPORT ENTERED or VERIFIED DATE."
"RTN","RAPM3",160,0)
 W !?7,"So, if the expected report is missing one of these fields, or is missing"
"RTN","RAPM3",161,0)
 W !?7,"data for fields .01 through 17 from file #74, RAD/NUC MED REPORTS, or"
"RTN","RAPM3",162,0)
 W !?7,"is a Stub Report that was entered by the Imaging package when images"
"RTN","RAPM3",163,0)
 W !?7,"were captured before a report was entered, then the expected report"
"RTN","RAPM3",164,0)
 W !?7,"would be counted in the PENDING column."
"RTN","RAPM3",165,0)
 ;
"RTN","RAPM3",166,0)
SFOOT2 ; store in tmp
"RTN","RAPM3",167,0)
 S (^TMP($J,"RAPM",RAN),^TMP($J,"RAPM",RAN+1))="",RAN=RAN+1
"RTN","RAPM3",168,0)
 ;
"RTN","RAPM3",169,0)
 S ^TMP($J,"RAPM",RAN)="    * Columns represent # of hours elapsed from exam date/time through",RAN=RAN+1
"RTN","RAPM3",170,0)
 S ^TMP($J,"RAPM",RAN)="      date/time report entered or date/time report was verified.",RAN=RAN+1
"RTN","RAPM3",171,0)
 S ^TMP($J,"RAPM",RAN)="      e.g. "">0-24 Hrs"" column represents those exams that had a report",RAN=RAN+1
"RTN","RAPM3",172,0)
 S ^TMP($J,"RAPM",RAN)="      transcribed and/or verified within 0-24 hours from the exam date/time.",RAN=RAN+1
"RTN","RAPM3",173,0)
 S ^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM3",174,0)
 S ^TMP($J,"RAPM",RAN)="    * Columns following the initial elapsed time column (0-24 Hrs) begin",RAN=RAN+1
"RTN","RAPM3",175,0)
 S ^TMP($J,"RAPM",RAN)="      at .0001 after the starting hour (e.g. "">24-48 Hrs"" = starts at 24.001",RAN=RAN+1
"RTN","RAPM3",176,0)
 S ^TMP($J,"RAPM",RAN)="      through the 48th hour.)",RAN=RAN+1
"RTN","RAPM3",177,0)
 S ^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM3",178,0)
 S ^TMP($J,"RAPM",RAN)="    * PENDING means there's no data for DATE REPORT ENTERED or VERIFIED DATE.",RAN=RAN+1
"RTN","RAPM3",179,0)
 S ^TMP($J,"RAPM",RAN)="      So, if the expected report is missing one of these fields, or is missing",RAN=RAN+1
"RTN","RAPM3",180,0)
 S ^TMP($J,"RAPM",RAN)="      data for fields .01 through 17 from file #74, RAD/NUC MED REPORTS, or",RAN=RAN+1
"RTN","RAPM3",181,0)
 S ^TMP($J,"RAPM",RAN)="      is a Stub Report that was entered by the Imaging package when images",RAN=RAN+1
"RTN","RAPM3",182,0)
 S ^TMP($J,"RAPM",RAN)="      were captured before a report was entered, then the expected report",RAN=RAN+1
"RTN","RAPM3",183,0)
 S ^TMP($J,"RAPM",RAN)="      would be counted in the PENDING column."
"RTN","RAPM3",184,0)
 D BFOOT
"RTN","RAPM3",185,0)
 Q
"RTN","RAPM3",186,0)
BFOOT ;footer for both
"RTN","RAPM3",187,0)
 G:'RAIO BFOOT2
"RTN","RAPM3",188,0)
 W !!?5,"* A printset, i.e., a set of multiple exams that share the same report,",!?7,"will be expected to have 1 report."
"RTN","RAPM3",189,0)
 W !!?5,"* Cancelled and ""No Credit"" cases are excluded from this report."
"RTN","RAPM3",190,0)
BFOOT2 ; used in summary
"RTN","RAPM3",191,0)
 Q:'$G(RAN)
"RTN","RAPM3",192,0)
 S RAN=RAN+1
"RTN","RAPM3",193,0)
 S ^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM3",194,0)
 S ^TMP($J,"RAPM",RAN)="    * A printset, i.e., a set of multiple exams that share the same report,",RAN=RAN+1
"RTN","RAPM3",195,0)
 S ^TMP($J,"RAPM",RAN)="      will be expected to have 1 report.",RAN=RAN+1
"RTN","RAPM3",196,0)
 S ^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM3",197,0)
 S ^TMP($J,"RAPM",RAN)="    * Cancelled and ""No Credit"" cases are excluded from this report."
"RTN","RAPM3",198,0)
 Q
"RTN","RAPM3",199,0)
RADIOL ; select Radiologist for Summary Report
"RTN","RAPM3",200,0)
 W !
"RTN","RAPM3",201,0)
 S DIC("S")="I $D(^VA(200,""ARC"",""R"",Y))!($D(^VA(200,""ARC"",""S"",Y)))",DIC("A")="Select Primary Interpreting Staff Physician (Optional): ",DIC="^VA(200,",DIC(0)="AEMQ" D ^DIC K DIC Q:Y<0  S RARAD=+Y
"RTN","RAPM3",202,0)
 Q
"RTN","RAPM3",203,0)
RA2DT ;SET RA2 variable for task date range
"RTN","RAPM3",204,0)
 N RADTNW
"RTN","RAPM3",205,0)
 S Y1=$E(DT,1,3),M1=$E(DT,4,5),RADTNW=$E(DT,6,7)
"RTN","RAPM3",206,0)
 S Y2=$S((M1="11")!(M1="12"):Y1+1,1:Y1)
"RTN","RAPM3",207,0)
 S:(M1="10")&(RADTNW>10) Y2=Y1+1
"RTN","RAPM3",208,0)
 ;
"RTN","RAPM3",209,0)
 S:(M1="01")&(RADTNW<11) RA2=Y2_"01"_10
"RTN","RAPM3",210,0)
 S:(M1="01")&(RADTNW>10) RA2=Y2_"04"_10
"RTN","RAPM3",211,0)
 S:(M1="02")!(M1="03") RA2=Y2_"04"_10
"RTN","RAPM3",212,0)
 ;
"RTN","RAPM3",213,0)
 S:(M1="04")&(RADTNW<11) RA2=Y2_"04"_10
"RTN","RAPM3",214,0)
 S:(M1="04")&(RADTNW>10) RA2=Y2_"07"_10
"RTN","RAPM3",215,0)
 S:(M1="05")!(M1="06") RA2=Y2_"07"_10
"RTN","RAPM3",216,0)
 ;
"RTN","RAPM3",217,0)
 S:(M1="07")&(RADTNW<11) RA2=Y2_"07"_10
"RTN","RAPM3",218,0)
 S:(M1="07")&(RADTNW>10) RA2=Y2_10_10
"RTN","RAPM3",219,0)
 S:(M1="08")!(M1="09") RA2=Y2_10_10
"RTN","RAPM3",220,0)
 ;
"RTN","RAPM3",221,0)
 S:(M1="10")&(RADTNW<11) RA2=Y2_10_10
"RTN","RAPM3",222,0)
 S:(M1="10")&(RADTNW>10) RA2=Y2_"01"_10
"RTN","RAPM3",223,0)
 S:(M1=11)!(M1=12) RA2=Y2_"01"_10
"RTN","RAPM3",224,0)
 Q
"RTN","RAPMW")
0^23^B74438083^B68972130
"RTN","RAPMW",1,0)
RAPMW ;HOIFO/SWM-Radiology Wait Time reports ;03/19/05 12:45
"RTN","RAPMW",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**67,79,83,99**;Mar 16, 1998;Build 5
"RTN","RAPMW",3,0)
 ;RVD - 3/19/09 p99
"RTN","RAPMW",4,0)
 ;
"RTN","RAPMW",5,0)
 ; ___ set up RACESS array
"RTN","RAPMW",6,0)
 I $D(DUZ),($O(RACCESS(DUZ,""))']"") D CHECK^RADLQ3(DUZ)
"RTN","RAPMW",7,0)
 ; ___ new/set/kill other variables
"RTN","RAPMW",8,0)
 K ^TMP($J)
"RTN","RAPMW",9,0)
 ;**********************************************************
"RTN","RAPMW",10,0)
 ;*  On Dec. 14, 2006, Dr. Anderson requested that the
"RTN","RAPMW",11,0)
 ;*  RADIAION THERAPY procedure type be dropped from the
"RTN","RAPMW",12,0)
 ;*  Wait Times Report but it may be included in the future.
"RTN","RAPMW",13,0)
 ;*  
"RTN","RAPMW",14,0)
 ;*  If RADIATION THERAPY will be included again, the only
"RTN","RAPMW",15,0)
 ;*  coding that needs to be changed is the line below; it
"RTN","RAPMW",16,0)
 ;*  should be removed.  The rest of the coding that handles
"RTN","RAPMW",17,0)
 ;*  exclusion of Procedure Types don't have to be changed
"RTN","RAPMW",18,0)
 ;*  because it uses RAXCLUDE() to exclude procedure types.
"RTN","RAPMW",19,0)
 ;*
"RTN","RAPMW",20,0)
 S RAXCLUDE("RADIATION THERAPY")=""
"RTN","RAPMW",21,0)
 ;*
"RTN","RAPMW",22,0)
 ;***********************************************************
"RTN","RAPMW",23,0)
 D SETPTA
"RTN","RAPMW",24,0)
 S (RATOTAL,RAXIT)=0
"RTN","RAPMW",25,0)
 W @IOF
"RTN","RAPMW",26,0)
 W !,"Radiology Outpatient Procedure Wait Time Report"
"RTN","RAPMW",27,0)
 ; __ get report type
"RTN","RAPMW",28,0)
 D GETTYP I $D(DIRUT) G EXIT
"RTN","RAPMW",29,0)
 ; ___ get date range
"RTN","RAPMW",30,0)
 W !! D GETDATE I $D(DIRUT) G EXIT
"RTN","RAPMW",31,0)
 ; ___ get division
"RTN","RAPMW",32,0)
 S X=$$GETDIV() I X G EXIT
"RTN","RAPMW",33,0)
 ; ___ ask what to ask next, procedure or img typ
"RTN","RAPMW",34,0)
 D ASKIP I RANX="" G EXIT
"RTN","RAPMW",35,0)
 I RANX="P" D  W "."
"RTN","RAPMW",36,0)
 .W !!?5,"All PROCEDURE TYPES will be included"
"RTN","RAPMW",37,0)
 .I $O(RAXCLUDE(""))]"" D
"RTN","RAPMW",38,0)
 .W ", except "
"RTN","RAPMW",39,0)
 .S I="" F  S I=$O(RAXCLUDE(I)) Q:I=""  W I W:$O(RAXCLUDE(I))]"" ", "
"RTN","RAPMW",40,0)
 .Q
"RTN","RAPMW",41,0)
 I RANX="C" D  I RAQUIT G EXIT
"RTN","RAPMW",42,0)
 . ; ___ get procedure/CPT CODE(s)
"RTN","RAPMW",43,0)
 . D GETPROC
"RTN","RAPMW",44,0)
 . Q
"RTN","RAPMW",45,0)
 ; *79, skip ask spec imaing type
"RTN","RAPMW",46,0)
 I "B^D"[RATYP D  I $D(DIRUT) G EXIT
"RTN","RAPMW",47,0)
 . D ASKSORT I $D(DIRUT) Q
"RTN","RAPMW",48,0)
 . D ASKDAYS
"RTN","RAPMW",49,0)
 . Q
"RTN","RAPMW",50,0)
 I "B^D"[RATYP D
"RTN","RAPMW",51,0)
 .S RATXT="*** The detail report requires a 132 column output device ***"
"RTN","RAPMW",52,0)
 .S RALINE="",$P(RALINE,"*",$L(RATXT)+1)=""
"RTN","RAPMW",53,0)
 .W !!?(80-$L(RATXT)\2),RALINE,!?(80-$L(RATXT)\2),RATXT,!?(80-$L(RATXT)\2),RALINE,!
"RTN","RAPMW",54,0)
 .Q
"RTN","RAPMW",55,0)
 D GETDEV I RAPOP G EXIT
"RTN","RAPMW",56,0)
 D START
"RTN","RAPMW",57,0)
 Q
"RTN","RAPMW",58,0)
START ; taskman to del task after job, set Radiology IO
"RTN","RAPMW",59,0)
 S:$D(ZTQUEUED) ZTREQ="@" S RAIO=$S(IO="":0,1:1) ;RAIO true/false
"RTN","RAPMW",60,0)
 ; get data
"RTN","RAPMW",61,0)
 ;    remove: inpatient, cancelled
"RTN","RAPMW",62,0)
 ;    keep: specific proc/CPT, imag types if entered
"RTN","RAPMW",63,0)
 S RASAME=0 ; count # procedures cancelled and re-ordered same day
"RTN","RAPMW",64,0)
 S RANEG=0 ; count # negative Days Wait
"RTN","RAPMW",65,0)
 D GETDATA
"RTN","RAPMW",66,0)
 U:RAIO IO
"RTN","RAPMW",67,0)
 I "S^B"[RATYP D WRTSUM^RAPMW1 Q:$G(RAS99)!$G(RAL99)  ; summary report
"RTN","RAPMW",68,0)
 I RATYP="B",$E(IOST,1,2)'="C-" W @IOF
"RTN","RAPMW",69,0)
 I "D^B"[RATYP D WRTDET^RAPMW2 ; detail report
"RTN","RAPMW",70,0)
 D EXIT
"RTN","RAPMW",71,0)
 Q
"RTN","RAPMW",72,0)
GETTYP ;
"RTN","RAPMW",73,0)
 S DIR(0)="S^S:Summary;D:Detail;B:Both"
"RTN","RAPMW",74,0)
 S DIR("A")="Select Report Type",DIR("B")="S"
"RTN","RAPMW",75,0)
 S DIR("?")="Enter Summary report OR Detail report OR Both reports"
"RTN","RAPMW",76,0)
 W !!,"Enter Report Type"
"RTN","RAPMW",77,0)
 D ^DIR K DIR
"RTN","RAPMW",78,0)
 Q:$D(DIRUT)
"RTN","RAPMW",79,0)
 S RATYP=Y
"RTN","RAPMW",80,0)
 Q
"RTN","RAPMW",81,0)
GETDATE ; start and end dates
"RTN","RAPMW",82,0)
 S DIR(0)="D^:"_DT_":AEX"
"RTN","RAPMW",83,0)
 W !?4,"The starting and ending dates are based upon what was entered at",!?4,"the ""Imaging Exam Date/Time"" prompt during Registration.",!
"RTN","RAPMW",84,0)
 S DIR("A")="Enter starting date"
"RTN","RAPMW",85,0)
 S DIR("?")="Enter date to begin searching Exam date from"
"RTN","RAPMW",86,0)
 D ^DIR K DIR
"RTN","RAPMW",87,0)
 Q:$D(DIRUT)
"RTN","RAPMW",88,0)
 S RABDATE=Y
"RTN","RAPMW",89,0)
 ;
"RTN","RAPMW",90,0)
 S RADD=91,X1=RABDATE,X2=RADD D C^%DTC S RAMAXDT=X
"RTN","RAPMW",91,0)
 I RAMAXDT>DT S RAMAXDT=DT W !!?4,"** Ending Date cannot be later than today's date. **",!
"RTN","RAPMW",92,0)
 S DIR(0)="D^"_RABDATE_":"_RAMAXDT_":AEX"
"RTN","RAPMW",93,0)
 S DIR("A")="Enter ending date"
"RTN","RAPMW",94,0)
 S DIR("?",1)="+91 days max. for Summary and Detail."
"RTN","RAPMW",95,0)
 S DIR("?")="But the Ending Date cannot be later than today's date."
"RTN","RAPMW",96,0)
 D ^DIR K DIR
"RTN","RAPMW",97,0)
 Q:$D(DIRUT)
"RTN","RAPMW",98,0)
 ;
"RTN","RAPMW",99,0)
 ; RABDATE, RAEDATE original values
"RTN","RAPMW",100,0)
 ; RABEGDT, RAENDDT used in GETDATA
"RTN","RAPMW",101,0)
 ; Set to end of day
"RTN","RAPMW",102,0)
 S RAEDATE=Y,RAENDDT=RAEDATE_.9999
"RTN","RAPMW",103,0)
 ; Set to include current day
"RTN","RAPMW",104,0)
 S RABEGDT=(RABDATE-1)_.9999
"RTN","RAPMW",105,0)
 Q
"RTN","RAPMW",106,0)
GETDIV() ;
"RTN","RAPMW",107,0)
 N X S X=$$SETUPDI^RAUTL7() Q:X 1
"RTN","RAPMW",108,0)
 D SELDIV^RAUTL7
"RTN","RAPMW",109,0)
 I '$D(^TMP($J,"RA D-TYPE"))!(RAQUIT) D  Q 1
"RTN","RAPMW",110,0)
 .K RACCESS(DUZ,"DIV-IMG"),^TMP($J,"DIV-IMG")
"RTN","RAPMW",111,0)
 .Q
"RTN","RAPMW",112,0)
 Q 0
"RTN","RAPMW",113,0)
ASKIP ;
"RTN","RAPMW",114,0)
 S RANX=""
"RTN","RAPMW",115,0)
 S DIR(0)="S^C:CPT Code/Procedure Name;P:Procedure Type"
"RTN","RAPMW",116,0)
 S DIR("?")=" "
"RTN","RAPMW",117,0)
 S DIR("?",1)="   ""CPT Code/Procedure Name"" will include only the"
"RTN","RAPMW",118,0)
 S DIR("?",2)="   user selected CPT Codes and Procedure names in this"
"RTN","RAPMW",119,0)
 S DIR("?",3)="   date range, except for cases that are cancelled, have"
"RTN","RAPMW",120,0)
 S DIR("?",4)="   no credit, and are inpatient."
"RTN","RAPMW",121,0)
 S DIR("?",5)=" "
"RTN","RAPMW",122,0)
 S DIR("?",6)="   ""Procedure Type"" will include all cases in this"
"RTN","RAPMW",123,0)
 S DIR("?",7)="   date range, except for the 3 exclusions above and also"
"RTN","RAPMW",124,0)
 S DIR("?",8)="   except if the case is part of a printset and it is not"
"RTN","RAPMW",125,0)
 S DIR("?",9)="   the highest ranked modality in the printset."
"RTN","RAPMW",126,0)
 S DIR("A")="What do you want to choose next",DIR("B")="P"
"RTN","RAPMW",127,0)
 W !!,"Enter next item to select."
"RTN","RAPMW",128,0)
 D ^DIR K DIR
"RTN","RAPMW",129,0)
 Q:$D(DIRUT)
"RTN","RAPMW",130,0)
 S RANX=Y
"RTN","RAPMW",131,0)
 Q
"RTN","RAPMW",132,0)
 ; *79 removed GETIMG() section
"RTN","RAPMW",133,0)
GETPROC ;
"RTN","RAPMW",134,0)
 S RADIC="^RAMIS(71,",RADIC(0)="QEAMZ"
"RTN","RAPMW",135,0)
 S RADIC("A")="Select Procedure/CPT Code: "
"RTN","RAPMW",136,0)
 S RAUTIL="RA WAIT"
"RTN","RAPMW",137,0)
 D EN1^RASELCT(.RADIC,RAUTIL)
"RTN","RAPMW",138,0)
 Q:RAQUIT
"RTN","RAPMW",139,0)
 S RA1=""
"RTN","RAPMW",140,0)
 F  S RA1=$O(^TMP($J,"RA WAIT",RA1)) Q:RA1=""  S RA2=0 D
"RTN","RAPMW",141,0)
 .F  S RA2=$O(^TMP($J,"RA WAIT",RA1,RA2)) Q:'RA2  S ^TMP($J,"RA WAIT2",RA2)="",^TMP($J,"RA WAIT1",RA1)=$P($$NAMCODE^RACPTMSC($P($G(^RAMIS(71,RA2,0)),U,9),DT),U) D
"RTN","RAPMW",142,0)
 ..;if parent was selected, then save iens of its descendents for FILTER2
"RTN","RAPMW",143,0)
 ..I $P(^RAMIS(71,RA2,0),U,6)="P" D
"RTN","RAPMW",144,0)
 ...S RA3=0 F  S RA3=$O(^RAMIS(71,RA2,4,"B",RA3)) Q:'RA3  S ^TMP($J,"RA WAIT2",RA3)=""
"RTN","RAPMW",145,0)
 ...Q
"RTN","RAPMW",146,0)
 ..Q
"RTN","RAPMW",147,0)
 .Q
"RTN","RAPMW",148,0)
 Q
"RTN","RAPMW",149,0)
ASKSORT ;
"RTN","RAPMW",150,0)
 S DIR(0)="S^CN:Case Number;CPT:CPT Code;DD:Date Desired;D:Days Wait;DO:Date of Order;DR:Date of Registration;I:Imaging Type;PN:Patient Name;PT:PROCEDURE TYPE;PROC:Procedure Name"
"RTN","RAPMW",151,0)
 S DIR("?")="Select which item to use for sorting the Detail Report"
"RTN","RAPMW",152,0)
 S DIR("A")="Sorted by",DIR("B")="D"
"RTN","RAPMW",153,0)
 W !!,"Sort report by"
"RTN","RAPMW",154,0)
 D ^DIR
"RTN","RAPMW",155,0)
 I $D(DIRUT) K DIR Q
"RTN","RAPMW",156,0)
 S RASORT=Y
"RTN","RAPMW",157,0)
 S RASORTNM=Y(0)
"RTN","RAPMW",158,0)
 S:RASORTNM["Regis" RASORTNM="Dt. Register"
"RTN","RAPMW",159,0)
 K DIR
"RTN","RAPMW",160,0)
 Q
"RTN","RAPMW",161,0)
ASKDAYS ;
"RTN","RAPMW",162,0)
 S DIR(0)="N^0:120"
"RTN","RAPMW",163,0)
 S DIR("A")="Print wait days greater than or equal to"
"RTN","RAPMW",164,0)
 S DIR("B")="0"
"RTN","RAPMW",165,0)
 S DIR("?",1)="Enter the minimum number of Days Wait between Date Desired and Registered Date."
"RTN","RAPMW",166,0)
 S DIR("?",2)="Only cases with Days Wait greater than or equal to this value"
"RTN","RAPMW",167,0)
 S DIR("?")="will be listed in the detail report."
"RTN","RAPMW",168,0)
 D ^DIR K DIR Q:$D(DIRUT)  S RASINCE=Y
"RTN","RAPMW",169,0)
 Q
"RTN","RAPMW",170,0)
GETDEV ;
"RTN","RAPMW",171,0)
 W:RATYP="B" !!,"Specify device for both summary and detail reports."
"RTN","RAPMW",172,0)
 D TASK
"RTN","RAPMW",173,0)
 D ZIS^RAUTL
"RTN","RAPMW",174,0)
 Q
"RTN","RAPMW",175,0)
TASK ; set vars for taskman
"RTN","RAPMW",176,0)
 S ZTRTN="START^RAPMW"
"RTN","RAPMW",177,0)
 S ZTSAVE("RA*")=""
"RTN","RAPMW",178,0)
 S ZTSAVE("^TMP($J,")=""
"RTN","RAPMW",179,0)
 S ZTDESC="Radiology Outpatient Wait Time Report"
"RTN","RAPMW",180,0)
 Q
"RTN","RAPMW",181,0)
GETDATA ;
"RTN","RAPMW",182,0)
 S RABAD=0 ;=0 means nothing bad, so accept case; =1 means reject case
"RTN","RAPMW",183,0)
 ;loop thru exam date (RADTE)
"RTN","RAPMW",184,0)
 S RADTE=RABEGDT
"RTN","RAPMW",185,0)
 F  S RADTE=$O(^RADPT("AR",RADTE)) Q:'RADTE  Q:(RADTE>RAENDDT)  D
"RTN","RAPMW",186,0)
 .S RADFN="" F  S RADFN=$O(^RADPT("AR",RADTE,RADFN)) Q:'RADFN  S RABAD=0 D
"RTN","RAPMW",187,0)
 ..S RADTI="" F  S RADTI=$O(^RADPT("AR",RADTE,RADFN,RADTI)) Q:'RADTI  D FILTER1^RAPMW1 I 'RABAD D
"RTN","RAPMW",188,0)
 ...S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:'RACNI  D FILTER2^RAPMW1 I 'RABAD D CALC^RAPMW2
"RTN","RAPMW",189,0)
 ...Q
"RTN","RAPMW",190,0)
 ..Q
"RTN","RAPMW",191,0)
 .Q
"RTN","RAPMW",192,0)
 Q
"RTN","RAPMW",193,0)
EXIT ;
"RTN","RAPMW",194,0)
 S:$G(RAS99)!$G(RAL99) RAP99=1
"RTN","RAPMW",195,0)
 D:'$G(RAP99) CLOSE^RAUTL ;close dev. if it's not a mail wait and time
"RTN","RAPMW",196,0)
 K I,J,POP,RA0,RA1,RA16,RA2,RA3,RA71REC,RA72,X,X1,X2,Y
"RTN","RAPMW",197,0)
 K RABAD,RACHKDIV,RACN0,RACNI,RACNISAV,RACNL,RACOL,RACOL14
"RTN","RAPMW",198,0)
 K RACPT,RADASH,RADD,RADFN,RADIC,RADIV,RADSDT,RADTE,RADTI,RADTORD
"RTN","RAPMW",199,0)
 K RAH1,RAH3,RAH4,RAH5,RAH6,RAH7,RAH8,RAHD0,RAIMGTYP
"RTN","RAPMW",200,0)
 K RAIT,RAITYP,RAKEY,RALINE,RAMAX,RAMAXDT,RANEG,RANOW,RANX
"RTN","RAPMW",201,0)
 K RAOREC,RAORIEN,RAPATND,RAPATNM,RAPG,RAPOP,RAPROCNM,RAPSTX,RAQUIT
"RTN","RAPMW",202,0)
 K RAR,RAREC,RASAME,RASAME2,RASELDIV,RASINCE,RASORT,RASORTNM
"RTN","RAPMW",203,0)
 K RAAVG,RATOTAL,RATYP,RAUTIL,RAWAITD,RATXT,RAXDT,RAXIT,RAXMST
"RTN","RAPMW",204,0)
 K RACPTC,RACPTI,RAHI,RAHIER,RAPCT,RAPCT14,RAPRC,RAPTA,RARY,RAXCLUDE,RAMES
"RTN","RAPMW",205,0)
 K:'$G(RAP99) RAEDATE,RABDATE,RAENDDT,RABEGDT,^TMP($J),RAIO,RAIOM ;cln var if not mail
"RTN","RAPMW",206,0)
 ;
"RTN","RAPMW",207,0)
 ; ^TMP($J,"RA I-TYPE","CT SCAN",ienFile79.2)="" <--*79 not needed
"RTN","RAPMW",208,0)
 ; ^TMP($J,"RA D-TYPE","SUPPORT ISC",ienFile79)=""
"RTN","RAPMW",209,0)
 ; ^TMP($J,"RA WAIT",ProcNam,ienFile71)=""<--from EN1^RASELCT
"RTN","RAPMW",210,0)
 ; ^TMP($J,"RA WAIT1",ProcNam)=CPTcode<--hdr of rpt, SETHD^RAPMW1
"RTN","RAPMW",211,0)
 ; ^TMP($J,"RA WAIT2",ienFile71)=""<--screen cases, FILTER2^RAPMW1
"RTN","RAPMW",212,0)
 ;ex.   ^TMP($J,"RA WAIT","TEETH",31)=
"RTN","RAPMW",213,0)
 ;ex.   ^TMP($J,"RA WAIT1","TEETH")=70320
"RTN","RAPMW",214,0)
 ;ex.   ^TMP($J,"RA WAIT2",31)=
"RTN","RAPMW",215,0)
 ; ^TMP($J,"RA WAIT NO ORD",RADFN,RADTI,RACNI)=ienFile75.1
"RTN","RAPMW",216,0)
 ; ^TMP($J,"RA WAIT NO DSR DT",RADFN,RADTI,RACNI)=ienFile75.1
"RTN","RAPMW",217,0)
 ; ^TMP($J,"RA WAIT3",RASORT,RADTE,RAPATNM,RACNI)=""<--detail display
"RTN","RAPMW",218,0)
 Q
"RTN","RAPMW",219,0)
SETPTA ;Set up Proc Type Array, w Sherrill Snuggs' Xcel file
"RTN","RAPMW",220,0)
 ; also setup RATOTAL(), RACOL(,), RAHIER()
"RTN","RAPMW",221,0)
 N I,J
"RTN","RAPMW",222,0)
 S I=""
"RTN","RAPMW",223,0)
 ; RATOTAL(I) sub-total, each Proc Type
"RTN","RAPMW",224,0)
 ; RAWAITD(I) total wait days, each Proc Type
"RTN","RAPMW",225,0)
 ; RAAVG(I)   average wait days, each Proc Type
"RTN","RAPMW",226,0)
 ; RACOL14(I) <14 days column
"RTN","RAPMW",227,0)
 F  S I=$O(^RA(73.2,"AC",I)) Q:I=""  S RATOTAL(I)=0,RAWAITD(I)=0,RAAVG(I)=0,RACOL14(I,"FR")=0 F J=1:1:5 S RACOL(I,J)=0
"RTN","RAPMW",228,0)
 S I="unknown",RATOTAL(I)=0,RAWAITD(I)=0,RAAVG(I)=0,RACOL14(I,"FR")=0 F J=1:1:5 S RACOL(I,J)=0
"RTN","RAPMW",229,0)
 ; Rank Proc Types, needed to pick case from printset
"RTN","RAPMW",230,0)
 ; 1=Interventional  2=MR  3=CT  4=Card. Stress Test  5=NM
"RTN","RAPMW",231,0)
 ; 6=US  7=Mammo  8=Plain Film (Gen Rad)  9=Other
"RTN","RAPMW",232,0)
 S I=""
"RTN","RAPMW",233,0)
 F  S I=$O(RATOTAL(I)) Q:I=""  D
"RTN","RAPMW",234,0)
 .S J=$E(I,1,3)
"RTN","RAPMW",235,0)
 .S RAHIER(I)=$S(J="CAR":4,J="COM":3,J="GEN":8,J="INT":1,J="MAG":2,J="MAM":7,J="NUC":5,J="ULT":6,1:9)
"RTN","RAPMW",236,0)
 .Q
"RTN","RAPMW",237,0)
 Q
"RTN","RAPMW",238,0)
 ;added in p#99
"RTN","RAPMW",239,0)
PWT(RABDATE,RAEDATE) ;entry point of EMAIL performance and wait time as part of a task job
"RTN","RAPMW",240,0)
 S RAXCLUDE("RADIATION THERAPY")=""
"RTN","RAPMW",241,0)
 D SETPTA S (RATOTAL,RAXIT)=0
"RTN","RAPMW",242,0)
 K:$G(RAL99) RAS99
"RTN","RAPMW",243,0)
 S RANX="P",RATYP="S"
"RTN","RAPMW",244,0)
 D START
"RTN","RAPMW",245,0)
 D EXIT
"RTN","RAPMW",246,0)
 Q
"RTN","RAPMW1")
0^24^B101224993^B84474637
"RTN","RAPMW1",1,0)
RAPMW1 ;HOIFO/SWM-Radiology Wait Time reports ;3/20/09 13:40
"RTN","RAPMW1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**67,79,83,99**;Mar 16, 1998;Build 5
"RTN","RAPMW1",3,0)
 ; IA 10090 allows Read w/Fileman for entire file 4
"RTN","RAPMW1",4,0)
 ; IA #2541 = KSP^XUPARAM
"RTN","RAPMW1",5,0)
 ; Supported IA #10103 reference to ^XLFDT
"RTN","RAPMW1",6,0)
 ; Supported IA #2056 reference to ^DIQ
"RTN","RAPMW1",7,0)
 ; RVD - 3/20/99 p99
"RTN","RAPMW1",8,0)
 ; summary
"RTN","RAPMW1",9,0)
 Q
"RTN","RAPMW1",10,0)
FILTER1 ;
"RTN","RAPMW1",11,0)
 S RABAD=0
"RTN","RAPMW1",12,0)
 I '$D(^RADPT(RADFN,"DT",RADTI)) S RABAD=1 Q  ;no exam data
"RTN","RAPMW1",13,0)
 ;division
"RTN","RAPMW1",14,0)
 S RASELDIV=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,3)
"RTN","RAPMW1",15,0)
 S RACHKDIV=$P($G(^DIC(4,+RASELDIV,0)),U)
"RTN","RAPMW1",16,0)
 I RACHKDIV'="",'$D(^TMP($J,"RA D-TYPE",RACHKDIV)) S RABAD=1 Q
"RTN","RAPMW1",17,0)
 ;imaging type
"RTN","RAPMW1",18,0)
 S RAITYP=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2)
"RTN","RAPMW1",19,0)
 S RAIMGTYP=$P($G(^RA(79.2,+RAITYP,0)),U)
"RTN","RAPMW1",20,0)
 ; *79 removed check for imaging type
"RTN","RAPMW1",21,0)
 I RAIMGTYP="" S RAIMGTYP="(unk)"
"RTN","RAPMW1",22,0)
 Q
"RTN","RAPMW1",23,0)
FILTER2 ;
"RTN","RAPMW1",24,0)
 S RABAD=0
"RTN","RAPMW1",25,0)
 S RACN0=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPMW1",26,0)
 I RACN0="" S RABAD=1 Q  ;no case level data
"RTN","RAPMW1",27,0)
 I RANX="C",'$D(^TMP($J,"RA WAIT2",+$P(RACN0,U,2))) S RABAD=1 Q
"RTN","RAPMW1",28,0)
 S RACNISAV=RACNI ; save orig. before it's changed due printset
"RTN","RAPMW1",29,0)
 I RANX="P",$P(RACN0,U,25)>1 D  G EXCL
"RTN","RAPMW1",30,0)
 .; If selecting by Proc Type, and case is from printset --
"RTN","RAPMW1",31,0)
 .; pick case with highest ranked Procedure Type
"RTN","RAPMW1",32,0)
 .; then skip remaining cases by setting a high RACNI
"RTN","RAPMW1",33,0)
 .S I=0
"RTN","RAPMW1",34,0)
 .K RARY ;array of cases and rank number
"RTN","RAPMW1",35,0)
 .F  S I=$O(^RADPT(RADFN,"DT",RADTI,"P",I)) Q:'I  S RACN0=$G(^(I,0)) D:RACN0'=""
"RTN","RAPMW1",36,0)
 ..S RABAD=0 D CHECK3 Q:RABAD  ;skip case if it meets 1 of 3 exclusions
"RTN","RAPMW1",37,0)
 ..D PTA^RAPMW2
"RTN","RAPMW1",38,0)
 ..;eg. rary(6,racni)=racn0 for Ultrasound
"RTN","RAPMW1",39,0)
 ..S RARY(RAHIER(RAPTA),I)=RACN0
"RTN","RAPMW1",40,0)
 ..Q
"RTN","RAPMW1",41,0)
 .S RAHI=$O(RARY("")) ;highest rank number from prtset cases
"RTN","RAPMW1",42,0)
 .I RAHI="" D  Q  ; no case in prtset can be used
"RTN","RAPMW1",43,0)
 ..S RABAD=1,RACNI=99999
"RTN","RAPMW1",44,0)
 ..Q
"RTN","RAPMW1",45,0)
 .S RACNI=$O(RARY(RAHI,0))
"RTN","RAPMW1",46,0)
 .I RACNI="" D  Q  ;should not happen
"RTN","RAPMW1",47,0)
 ..S RABAD=1,RACNI=99999
"RTN","RAPMW1",48,0)
 ..Q
"RTN","RAPMW1",49,0)
 .S RACN0=RARY(RAHI,RACNI) ;reset racn0
"RTN","RAPMW1",50,0)
 .S RA72=^RA(72,+$P(RACN0,U,3),0) ;reset ra72
"RTN","RAPMW1",51,0)
 .S RACNISAV=RACNI ; save orig. before it's changed due printset
"RTN","RAPMW1",52,0)
 .S RACNI=99999 ;set to 99999 so GETDATA loop would skip rest of prtset
"RTN","RAPMW1",53,0)
 .Q
"RTN","RAPMW1",54,0)
 D CHECK3
"RTN","RAPMW1",55,0)
EXCL ; skip case if its proc isn't among user-selected procs
"RTN","RAPMW1",56,0)
 D PTA^RAPMW2 ; *79, Procedure Type via CPT Code & Sherrill's Xcel sheet
"RTN","RAPMW1",57,0)
 I $D(RAXCLUDE(RAPTA)) S RABAD=1 Q
"RTN","RAPMW1",58,0)
 Q
"RTN","RAPMW1",59,0)
CHECK3 ; check inpatient, no credit, cancelled exam
"RTN","RAPMW1",60,0)
 ; CATEGORY OF EXAM is inpatient
"RTN","RAPMW1",61,0)
 I $P(RACN0,U,4)="I" S RABAD=1 Q
"RTN","RAPMW1",62,0)
 ; exam's credit method is 2 (no credit)
"RTN","RAPMW1",63,0)
 I $P(RACN0,U,26)=2 S RABAD=1 Q
"RTN","RAPMW1",64,0)
 ; exam status is cancelled
"RTN","RAPMW1",65,0)
 I $P(RACN0,U,3)="" S RABAD=1 Q  ;no exam status
"RTN","RAPMW1",66,0)
 S RA72=^RA(72,+$P(RACN0,U,3),0) ;file 72 node 0
"RTN","RAPMW1",67,0)
 I $P(RA72,U,3)=0 S RABAD=1 Q  ;skip cancelled exam
"RTN","RAPMW1",68,0)
 Q
"RTN","RAPMW1",69,0)
STORSUM ;
"RTN","RAPMW1",70,0)
 S RACOL=$S(RAWAITD'>30:1,RAWAITD'>60:2,RAWAITD'>90:3,RAWAITD'>120:4,1:5)
"RTN","RAPMW1",71,0)
 S:RAWAITD<15 RACOL14(RAPTA,"FR")=RACOL14(RAPTA,"FR")+1
"RTN","RAPMW1",72,0)
 S RACOL(RAPTA,RACOL)=RACOL(RAPTA,RACOL)+1
"RTN","RAPMW1",73,0)
 S RATOTAL(RAPTA)=RATOTAL(RAPTA)+1,RATOTAL=RATOTAL+1
"RTN","RAPMW1",74,0)
 ; count negative Wait Days as 0
"RTN","RAPMW1",75,0)
 S RAWAITD(RAPTA)=RAWAITD(RAPTA)+$S(RAWAITD<0:0,1:RAWAITD)
"RTN","RAPMW1",76,0)
 Q
"RTN","RAPMW1",77,0)
WRTSUM ;
"RTN","RAPMW1",78,0)
 S RAHD0="Summary",RAPG=1
"RTN","RAPMW1",79,0)
 D SETHD
"RTN","RAPMW1",80,0)
 I $G(RAS99) D RAJOB^RAPMW3 Q   ;if this is an email wait and time performance report
"RTN","RAPMW1",81,0)
 I $G(RAL99) D RAJOB1^RAPMW3 Q  ;if email W&T performance report, process all.
"RTN","RAPMW1",82,0)
 D PRTS Q:RAXIT
"RTN","RAPMW1",83,0)
 D FOOTS
"RTN","RAPMW1",84,0)
 Q
"RTN","RAPMW1",85,0)
SETHD ; Set up header & dev vars for identical parts of summary and detail reports
"RTN","RAPMW1",86,0)
 S RAIOM=$S(RATYP="S":80,1:IOM),$P(RADASH,"-",46)=""
"RTN","RAPMW1",87,0)
 S RAH1=RAHD0_" Radiology Outpatient Procedure Wait Time Report"
"RTN","RAPMW1",88,0)
 ; Hdr Line 3 -- Facility, Station, VISN
"RTN","RAPMW1",89,0)
 S:'$G(DUZ(2)) DUZ(2)=$$KSP^XUPARAM("INST")  ;if NULL, use the default institution
"RTN","RAPMW1",90,0)
 ;
"RTN","RAPMW1",91,0)
 D GETS^DIQ(4,DUZ(2),".01;14*;99","E","RAR","RAMSG")
"RTN","RAPMW1",92,0)
 K X
"RTN","RAPMW1",93,0)
 S X(1)=RAR(4,DUZ(2)_",",.01,"E") ; Name of facility
"RTN","RAPMW1",94,0)
 S X(2)=RAR(4,DUZ(2)_",",99,"E") ;  Station Number
"RTN","RAPMW1",95,0)
 I $D(RAR(4.014)) D
"RTN","RAPMW1",96,0)
 . S X(3)=RAR(4.014,"1,"_DUZ(2)_",",.01,"E") ; Association
"RTN","RAPMW1",97,0)
 . S X(4)=RAR(4.014,"1,"_DUZ(2)_",",1,"E") ; Parent of Association
"RTN","RAPMW1",98,0)
 . S X(5)=$S(X(3)="VISN":X(4),1:"") ; should be VISN number
"RTN","RAPMW1",99,0)
 E  S X(5)=""
"RTN","RAPMW1",100,0)
 ;
"RTN","RAPMW1",101,0)
 S $P(X(6)," ",79)=""
"RTN","RAPMW1",102,0)
 S $E(X(6),1,(10+$L(X(1))))="Facility: "_X(1)
"RTN","RAPMW1",103,0)
 S $E(X(6),41,(50+$L(X(2))))="Station: "_X(2)
"RTN","RAPMW1",104,0)
 S $E(X(6),60,(66+$L(X(5))))="VISN: "_X(5)
"RTN","RAPMW1",105,0)
 S RAH3=X(6) ;Facility, Station, VISN
"RTN","RAPMW1",106,0)
 ; Hdr Line 4 -- Division(s)
"RTN","RAPMW1",107,0)
 K RAH4
"RTN","RAPMW1",108,0)
 I '$D(^TMP($J,"RA D-TYPE")) S RAH4(1)="No division selected"
"RTN","RAPMW1",109,0)
 E  D
"RTN","RAPMW1",110,0)
 .S RA1=1,RADIV="" S RAH4(1)="Division(s): "
"RTN","RAPMW1",111,0)
 .F  S RADIV=$O(^TMP($J,"RA D-TYPE",RADIV)) Q:RADIV=""  D
"RTN","RAPMW1",112,0)
 ..S:$L(RAH4(RA1))+$L(RADIV)>RAIOM RA1=RA1+1,$P(RAH4(RA1)," ",14)=""
"RTN","RAPMW1",113,0)
 ..S RAH4(RA1)=RAH4(RA1)_RADIV_$S($O(^TMP($J,"RA D-TYPE",RADIV))]"":", ",1:"")
"RTN","RAPMW1",114,0)
 ..Q
"RTN","RAPMW1",115,0)
 .Q
"RTN","RAPMW1",116,0)
 ; Hdr line 5 -- Exam Date Range
"RTN","RAPMW1",117,0)
 S RAH5="Exam Date Range: "_$$FMTE^XLFDT(RABDATE,"2D")_"-"_$$FMTE^XLFDT(RAEDATE,"2D")
"RTN","RAPMW1",118,0)
 ; Hdr line 6 -- Imaging Type(s) selected
"RTN","RAPMW1",119,0)
 K RAH6
"RTN","RAPMW1",120,0)
 I RANX="P" D
"RTN","RAPMW1",121,0)
 .S RAH6(1)="PROCEDURE TYPES: All" ;*79
"RTN","RAPMW1",122,0)
 .I $O(RAXCLUDE(""))]"" D
"RTN","RAPMW1",123,0)
 ..S RAH6(1)=RAH6(1)_", except "
"RTN","RAPMW1",124,0)
 ..S I="" F  S I=$O(RAXCLUDE(I)) Q:I=""  S RAH6(1)=RAH6(1)_I S:$O(RAXCLUDE(I))]"" RAH6(1)=RAH6(1)_", "
"RTN","RAPMW1",125,0)
 ..Q
"RTN","RAPMW1",126,0)
 .Q
"RTN","RAPMW1",127,0)
 ; Hdr line 7 -- CPT and Proc names
"RTN","RAPMW1",128,0)
 K RAH7 I RANX="C" D  ; *79
"RTN","RAPMW1",129,0)
 .S RAH7(0)="CPT CODES and PROCEDURES: "
"RTN","RAPMW1",130,0)
 .S RA1=1,RA2="",RAH7(1)=RAH7(0)
"RTN","RAPMW1",131,0)
 .F  S RA2=$O(^TMP($J,"RA WAIT1",RA2)) Q:RA2=""  D
"RTN","RAPMW1",132,0)
 ..S RA1=RA1+1
"RTN","RAPMW1",133,0)
 ..S RAH7(RA1)="     "_^TMP($J,"RA WAIT1",RA2)_"  "_RA2
"RTN","RAPMW1",134,0)
 ..Q
"RTN","RAPMW1",135,0)
 .Q
"RTN","RAPMW1",136,0)
 ;Hdr line 8 -- Run Date/Time
"RTN","RAPMW1",137,0)
 S RANOW=$$NOW^XLFDT,RANOW=$E(RANOW,1,12)
"RTN","RAPMW1",138,0)
 S RAH8="Run Date/Time: "_$$FMTE^XLFDT(RANOW,"2P")
"RTN","RAPMW1",139,0)
 Q
"RTN","RAPMW1",140,0)
HD ;
"RTN","RAPMW1",141,0)
 W:$E(IOST,1,2)="C-" @IOF W !?(RAIOM-$L(RAH1)\2),RAH1
"RTN","RAPMW1",142,0)
 W !,"Page: ",RAPG,!
"RTN","RAPMW1",143,0)
 W !,RAH3
"RTN","RAPMW1",144,0)
 S I=0 F  S I=$O(RAH4(I)) Q:'I  W !,RAH4(I)
"RTN","RAPMW1",145,0)
 W !,RAH5
"RTN","RAPMW1",146,0)
 S I=0 F  S I=$O(RAH6(I)) Q:'I  W !,RAH6(I)
"RTN","RAPMW1",147,0)
 S I=0 F  S I=$O(RAH7(I)) Q:'I  W !,RAH7(I) I ($Y+5)>IOSL D PRESS Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW1",148,0)
 Q:RAXIT
"RTN","RAPMW1",149,0)
 W !,RAH8
"RTN","RAPMW1",150,0)
 Q
"RTN","RAPMW1",151,0)
HDSUM ;
"RTN","RAPMW1",152,0)
 W !!,"Total number of procedures registered during specified exam date range: ",RATOTAL,!
"RTN","RAPMW1",153,0)
 Q
"RTN","RAPMW1",154,0)
DAY14 ;
"RTN","RAPMW1",155,0)
 W !!,"The ""<=14 Days"" column contains data that is also in the ""<=30 Days"" column."
"RTN","RAPMW1",156,0)
 W !,"The reason that performance is calculated for both <=14 days and <=30 days is"
"RTN","RAPMW1",157,0)
 W !,"so that facilities can track their performance to a 14 day performance standard"
"RTN","RAPMW1",158,0)
 W !,"rather than a 30 day standard if they choose to do so."
"RTN","RAPMW1",159,0)
 Q
"RTN","RAPMW1",160,0)
PRTS ;
"RTN","RAPMW1",161,0)
 I RAPG=1 D HD Q:RAXIT  D HDSUM S RAPG=RAPG+1
"RTN","RAPMW1",162,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW1",163,0)
 .F J=1:1:5 D
"RTN","RAPMW1",164,0)
 ..S RAPCT(I,J)=$S(RATOTAL(I)>0:$J(RACOL(I,J)/RATOTAL(I)*100,5,1),1:$J(0,5,1))
"RTN","RAPMW1",165,0)
 ..S RACOL(I,J)=$J(RACOL(I,J),7)
"RTN","RAPMW1",166,0)
 ..S RAPCT14(I,"FR")=$S(RATOTAL(I)>0:$J(RACOL14(I,"FR")/RATOTAL(I)*100,5,1),1:$J(0,5,1))
"RTN","RAPMW1",167,0)
 ..Q
"RTN","RAPMW1",168,0)
 .S RAAVG(I)=$S(RATOTAL(I)>0:$J(RAWAITD(I)/RATOTAL(I),7,0),1:"")
"RTN","RAPMW1",169,0)
 .I I="unknown",RATOTAL(I)=0 K RATOTAL(I),RACOL(I) Q  ;remove "unknown" row if 0s
"RTN","RAPMW1",170,0)
 .I RANX="C",RATOTAL(I)=0 K RATOTAL(I),RACOL(I) Q  ;remov 0 row if by CPT
"RTN","RAPMW1",171,0)
 .I $D(RAXCLUDE(I)) K RATOTAL(I),RACOL(I) Q  ;remove excluded Proc Type
"RTN","RAPMW1",172,0)
 .S RATOTAL(I)=$J(RATOTAL(I),8)
"RTN","RAPMW1",173,0)
 .Q
"RTN","RAPMW1",174,0)
 W !?30,"DAYS WAIT -- PERCENTAGES",! D COLHDS^RAPMW2(1)
"RTN","RAPMW1",175,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW1",176,0)
 .W !,$E($S(I="unknown":""""_I_"""",1:I),1,24),?28,RAPCT14(I,"FR"),?36,RAPCT(I,1),?45,RAPCT(I,2),?54,RAPCT(I,3),?64,RAPCT(I,4),?72,RAPCT(I,5)
"RTN","RAPMW1",177,0)
 .Q
"RTN","RAPMW1",178,0)
 D PRESS Q:RAXIT
"RTN","RAPMW1",179,0)
 W !!!!?30,"DAYS WAIT -- COUNTS",! D COLHDS^RAPMW2(2)
"RTN","RAPMW1",180,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW1",181,0)
 .W !,$E($S(I="unknown":""""_I_"""",1:I),1,15),?16,$J(RACOL14(I,"FR"),7),?24,RACOL(I,1),?32,RACOL(I,2),?40,RACOL(I,3),?48,RACOL(I,4),?56,RACOL(I,5),?63,RATOTAL(I),?72,$S(RAAVG(I)="":"      -",1:RAAVG(I))
"RTN","RAPMW1",182,0)
 .Q
"RTN","RAPMW1",183,0)
 D DAY14 W !!,"Number of procedures cancelled and re-ordered on the same day = ",RASAME
"RTN","RAPMW1",184,0)
 ; *79, deleted display of average wait days
"RTN","RAPMW1",185,0)
 Q
"RTN","RAPMW1",186,0)
FOOTS ;
"RTN","RAPMW1",187,0)
 I RANEG W !!?3,"(There ",$S(RANEG=1:"is",1:"are")," ",RANEG," case",$S(RANEG=1:"",1:"s")," with negative days wait included in the first column.)",!
"RTN","RAPMW1",188,0)
 D PRESS Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW1",189,0)
 S RAMAX=$S($D(RATOTAL("unknown")):33,1:28)
"RTN","RAPMW1",190,0)
 F I=1:1:RAMAX Q:RAXIT  W !?4,$P($T(FOOTS2+I),";;",2) I ($Y+5)>IOSL D PRESS Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW1",191,0)
 Q
"RTN","RAPMW1",192,0)
PRESS ;
"RTN","RAPMW1",193,0)
 Q:$D(ZTQUEUED)
"RTN","RAPMW1",194,0)
 I IO=IO(0) D
"RTN","RAPMW1",195,0)
 .I $E(IOST,1,2)="C-" R !,"Press RETURN to continue, ""^"" to exit:",RAKEY:DTIME
"RTN","RAPMW1",196,0)
 .S:$G(RAKEY)="^" RAXIT=1
"RTN","RAPMW1",197,0)
 .Q
"RTN","RAPMW1",198,0)
 Q
"RTN","RAPMW1",199,0)
FOOTS2 ;
"RTN","RAPMW1",200,0)
 ;;
"RTN","RAPMW1",201,0)
 ;;1. Cancelled, "No Credit", inpatient cases, and not the highest modality
"RTN","RAPMW1",202,0)
 ;;   of a printset are excluded from this report.  (See 3. below.)
"RTN","RAPMW1",203,0)
 ;;
"RTN","RAPMW1",204,0)
 ;;2. Columns represent # of days wait from the Registered date (the date/
"RTN","RAPMW1",205,0)
 ;;   time entered at the "Imaging Exam Date/Time:" prompt) backwards to the
"RTN","RAPMW1",206,0)
 ;;   Date Desired for the ordered procedure.  The calculation is based on
"RTN","RAPMW1",207,0)
 ;;   the number of different days and not rounded off by hours.  The "31-60"
"RTN","RAPMW1",208,0)
 ;;   column represents those orders that were registered 31 days or more but
"RTN","RAPMW1",209,0)
 ;;   less than 61 days after the Date Desired.
"RTN","RAPMW1",210,0)
 ;;
"RTN","RAPMW1",211,0)
 ;;3. If the user did not select a specific CPT Code or Procedure Name, 
"RTN","RAPMW1",212,0)
 ;;   then the cases from a printset (group of cases that share the same
"RTN","RAPMW1",213,0)
 ;;   report) will have only the case with the highest modality printed.  
"RTN","RAPMW1",214,0)
 ;;   The modalities have this hierarchical order, where (1) is the highest:
"RTN","RAPMW1",215,0)
 ;;   (1) Interventional, (2) MRI, (3) CT, (4) Cardiac Stress test, 
"RTN","RAPMW1",216,0)
 ;;   (5) Nuc Med, (6) US, (7) Mammo, (8) General Rad (9) Other
"RTN","RAPMW1",217,0)
 ;;
"RTN","RAPMW1",218,0)
 ;;4. "Procedure Types" are assigned by a national CPT code look-up table
"RTN","RAPMW1",219,0)
 ;;   and may differ from locally defined "Imaging Types."  Therefore the
"RTN","RAPMW1",220,0)
 ;;   number of procedures in each category may not be the same as other
"RTN","RAPMW1",221,0)
 ;;   radiology management reports.
"RTN","RAPMW1",222,0)
 ;;
"RTN","RAPMW1",223,0)
 ;;5. "Avg. Days" is the average days wait.  It is calculated from the sum
"RTN","RAPMW1",224,0)
 ;;   of the days wait for that Procedure Type, divided by the count of cases
"RTN","RAPMW1",225,0)
 ;;   included in this report for that Procedure Type.  Negative days wait
"RTN","RAPMW1",226,0)
 ;;   is counted as 0.  A "-" means an average cannot be calculated.
"RTN","RAPMW1",227,0)
 ;;
"RTN","RAPMW1",228,0)
 ;;6. Procedure Type of "unknown" refers to either cases that have no 
"RTN","RAPMW1",229,0)
 ;;   matching procedure type in the spreadsheet of CPT Codes provided
"RTN","RAPMW1",230,0)
 ;;   by the Office of Patient Care Services, or cases that are missing
"RTN","RAPMW1",231,0)
 ;;   data for the procedure.
"RTN","RAPMW1",232,0)
 ;;
"RTN","RAPMW2")
0^28^B77528050^B76504533
"RTN","RAPMW2",1,0)
RAPMW2 ;HOIFO/SWM-Radiology Wait Time reports ;12/05/05 13:41
"RTN","RAPMW2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**67,79,83,99**;Mar 16, 1998;Build 5
"RTN","RAPMW2",3,0)
 ; IA 10063 allows check for Task Stop Request
"RTN","RAPMW2",4,0)
 ; detail
"RTN","RAPMW2",5,0)
 Q
"RTN","RAPMW2",6,0)
STORDET ;
"RTN","RAPMW2",7,0)
 S RAREC=""
"RTN","RAPMW2",8,0)
 S RACNL=$E(RAXDT,4,5)_$E(RAXDT,6,7)_$E(RAXDT,2,3)_"-"_+RACN0 ;long CN
"RTN","RAPMW2",9,0)
 S RA71REC=$G(^RAMIS(71,+$P(RACN0,U,2),0))
"RTN","RAPMW2",10,0)
 S RAXMST=$P(RA72,U) ;exam status name
"RTN","RAPMW2",11,0)
 S RACPT=$P($$NAMCODE^RACPTMSC($P(RA71REC,U,9),RAXDT),U) ;CPT code
"RTN","RAPMW2",12,0)
 S RAPROCNM=$P(RA71REC,U) ;procedure name
"RTN","RAPMW2",13,0)
 S RAPATNM=$$GET1^DIQ(2,RADFN,.01) S:RAPATNM="" RAPATNM=" " ;pt.name
"RTN","RAPMW2",14,0)
 S RAPATNM=$E(RAPATNM,1,12) ;use 1st 12 chars of pat name
"RTN","RAPMW2",15,0)
 S RAPATND=RAPATNM_"-"_RADFN ;patname-DFN
"RTN","RAPMW2",16,0)
 S RADTORD=$P($P(RAOREC,U,16),".") ;date ordered
"RTN","RAPMW2",17,0)
 ; store items in this order -- piece no.;field descrp/
"RTN","RAPMW2",18,0)
 ; 1;pt.name/ 2;long case no./ 3;dt ordered/ 4;dt desired/ 5;exam dt/
"RTN","RAPMW2",19,0)
 ; 6;no. days wait/ 7;exm stat name/ 8;CPT code/ 9; proc name/
"RTN","RAPMW2",20,0)
 ; 10;img typ name/ 11;* if canc & re-ord same day/ 12;Proc Typ Name/
"RTN","RAPMW2",21,0)
 ; 13;"p" if case from print set (highest ranked proc type)
"RTN","RAPMW2",22,0)
 ;
"RTN","RAPMW2",23,0)
 S RAREC=RAPATNM_U_RACNL_U_$E(RADTORD,1,7)_U_$E(RADSDT,1,7)
"RTN","RAPMW2",24,0)
 S RAREC=RAREC_U_$E(RAXDT,1,7)_U_RAWAITD_U_$E(RAXMST,1,11)_U_RACPT
"RTN","RAPMW2",25,0)
 S RAREC=RAREC_U_$E(RAPROCNM,1,45)_U_$E(RAIMGTYP,1,3)_U_$S(RASAME2:"*",1:"")_U_RAPTA
"RTN","RAPMW2",26,0)
 S RAREC=RAREC_U_$S(RACNI=99999:"p",1:"") ;flag printset case picked
"RTN","RAPMW2",27,0)
 ; subscript 3 is the sort value
"RTN","RAPMW2",28,0)
 ; subscripts 4-6 combined should be unique to a case, prevent over-
"RTN","RAPMW2",29,0)
 ;    writing subscript 3 when >1 case has same sort value 
"RTN","RAPMW2",30,0)
 ; subscript 4 is the exam date in Fileman notation
"RTN","RAPMW2",31,0)
 ; subcript 5 is the patient name (1st 12 chars) and DFN
"RTN","RAPMW2",32,0)
 ; subscript 6 is the "P" level ien of file 70
"RTN","RAPMW2",33,0)
 I RASORT="CN" S ^TMP($J,"RA WAIT3",RACNL,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",34,0)
 I RASORT="CPT" S ^TMP($J,"RA WAIT3",RACPT,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",35,0)
 I RASORT="DD" S ^TMP($J,"RA WAIT3",RADSDT,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",36,0)
 I RASORT="D" S ^TMP($J,"RA WAIT3",RAWAITD,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",37,0)
 I RASORT="DO" S ^TMP($J,"RA WAIT3",RADTORD,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",38,0)
 I RASORT="DR" S ^TMP($J,"RA WAIT3",RAXDT,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",39,0)
 I RASORT="I" S ^TMP($J,"RA WAIT3",RAIMGTYP,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",40,0)
 I RASORT="PT" S ^TMP($J,"RA WAIT3",RAPTA,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",41,0)
 I RASORT="PN" S ^TMP($J,"RA WAIT3",RAPATNM,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",42,0)
 I RASORT="PROC" S ^TMP($J,"RA WAIT3",RAPROCNM,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",43,0)
 Q
"RTN","RAPMW2",44,0)
WRTDET ;
"RTN","RAPMW2",45,0)
 S RAHD0="Detail",RAPG=1
"RTN","RAPMW2",46,0)
 D SETHD^RAPMW1
"RTN","RAPMW2",47,0)
 D PRTD Q:RAXIT
"RTN","RAPMW2",48,0)
 D FOOTD
"RTN","RAPMW2",49,0)
 Q
"RTN","RAPMW2",50,0)
HDDET ;
"RTN","RAPMW2",51,0)
 W !!,"Sorted by: ",RASORTNM,?38,"Print only cases with minimum Days Wait of: ",RASINCE
"RTN","RAPMW2",52,0)
 W !,"Total number of procedures registered during specified exam date range: ",RATOTAL
"RTN","RAPMW2",53,0)
 Q
"RTN","RAPMW2",54,0)
COLHDD ;
"RTN","RAPMW2",55,0)
 I RAPG>1 W @IOF,!,"Page: ",RAPG
"RTN","RAPMW2",56,0)
 S RAPG=RAPG+1
"RTN","RAPMW2",57,0)
 W !!?27,"Date",?36,"Date",?45,"Date",?54,"Days",?59,"Exam",?71,"CPT",?122,"Img",?127,"PROC."
"RTN","RAPMW2",58,0)
 W !,"Patient Name",?14,"Case #",?27,"Ordered",?36,"Desired",?45,"Register",?54,"Wait",?59,"Status",?71,"Code",?77,"Name of Procedure",?122,"Type",?127,"TYPE"
"RTN","RAPMW2",59,0)
 W !,$E(RADASH,1,12),?14,$E(RADASH,1,12),?27,$E(RADASH,1,8),?36,$E(RADASH,1,8),?45,$E(RADASH,1,8),?54,$E(RADASH,1,4),?59,$E(RADASH,1,11),?71,$E(RADASH,1,5),?77,RADASH,?123,$E(RADASH,1,4),?127,$E(RADASH,1,5)
"RTN","RAPMW2",60,0)
 I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAXIT=1 ;user stopped task
"RTN","RAPMW2",61,0)
 Q
"RTN","RAPMW2",62,0)
PRTD ;
"RTN","RAPMW2",63,0)
 I RATYP="B" D PRESS^RAPMW1 Q:RAXIT
"RTN","RAPMW2",64,0)
 N X
"RTN","RAPMW2",65,0)
 D HD^RAPMW1 Q:RAXIT  D HDDET,COLHDD
"RTN","RAPMW2",66,0)
 S RA0="",RAXIT=0
"RTN","RAPMW2",67,0)
 F  S RA0=$O(^TMP($J,"RA WAIT3",RA0)) Q:RA0=""  Q:RAXIT  S RA1=0 D
"RTN","RAPMW2",68,0)
 .F  S RA1=$O(^TMP($J,"RA WAIT3",RA0,RA1)) Q:'RA1  Q:RAXIT  S RA2=0 D
"RTN","RAPMW2",69,0)
 ..F  S RA2=$O(^TMP($J,"RA WAIT3",RA0,RA1,RA2)) Q:RA2=""  Q:RAXIT  S RA3=0 D
"RTN","RAPMW2",70,0)
 ...F  S RA3=$O(^TMP($J,"RA WAIT3",RA0,RA1,RA2,RA3)) Q:'RA3  Q:RAXIT  S X=^(RA3) D
"RTN","RAPMW2",71,0)
 ....D CKLINE Q:RAXIT
"RTN","RAPMW2",72,0)
 ....W !,$P(X,U),?13,$P(X,U,13),?14,$P(X,U,2),?27,$$FMTE^XLFDT($P(X,U,3),2),?36,$$FMTE^XLFDT($P(X,U,4),2),?45,$$FMTE^XLFDT($P(X,U,5),2),$P(X,U,11),?54,$J($P(X,U,6),4),?59,$P(X,U,7)
"RTN","RAPMW2",73,0)
 ....W ?71,$P(X,U,8),?77,$P(X,U,9),?123,$P(X,U,10),?127,$E($P(X,U,12),1,5)
"RTN","RAPMW2",74,0)
 ....Q
"RTN","RAPMW2",75,0)
 ...Q
"RTN","RAPMW2",76,0)
 ..Q
"RTN","RAPMW2",77,0)
 .Q
"RTN","RAPMW2",78,0)
 Q
"RTN","RAPMW2",79,0)
CKLINE ;
"RTN","RAPMW2",80,0)
 I ($Y+5)>IOSL D
"RTN","RAPMW2",81,0)
 . S RAXIT=$$S^%ZTLOAD("This task was in routine RAPMW2 when it was stopped.") I RAXIT S ZTSTOP=1 Q  ;IA10063
"RTN","RAPMW2",82,0)
 .D PRESS^RAPMW1
"RTN","RAPMW2",83,0)
 .Q:RAXIT
"RTN","RAPMW2",84,0)
 .D COLHDD
"RTN","RAPMW2",85,0)
 .Q
"RTN","RAPMW2",86,0)
 Q
"RTN","RAPMW2",87,0)
FOOTD ;
"RTN","RAPMW2",88,0)
 D PRESS^RAPMW1 Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW2",89,0)
 I RANEG W !!?3,"(There ",$S(RANEG=1:"is",1:"are")," ",RANEG," case",$S(RANEG=1:"",1:"s")," with negative days wait included in the listing.)",!
"RTN","RAPMW2",90,0)
 F I=1:1:28 Q:RAXIT  W !?4,$P($T(FOOTD2+I),";;",2) I ($Y+5)>IOSL D PRESS^RAPMW1 Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW2",91,0)
 Q
"RTN","RAPMW2",92,0)
CALC ;
"RTN","RAPMW2",93,0)
 S RASAME2=0 ;=1 if exm's order was cancelled & reordered same day
"RTN","RAPMW2",94,0)
 S RAORIEN=$P(RACN0,U,11)
"RTN","RAPMW2",95,0)
 S RAOREC=$G(^RAO(75.1,+RAORIEN,0))
"RTN","RAPMW2",96,0)
 I RAOREC="" S ^TMP($J,"RA WAIT NO ORD",RADFN,RADTI,RACNI)=RAORIEN Q
"RTN","RAPMW2",97,0)
 S RAXDT=9999999.9999-RADTI ; exam date FM format
"RTN","RAPMW2",98,0)
 S RADSDT=$P(RAOREC,U,21) ; Date Desired
"RTN","RAPMW2",99,0)
 I RADSDT="" S ^TMP($J,"RA WAIT NO DSR DT",RADFN,RADTI,RACNI)=RAORIEN Q
"RTN","RAPMW2",100,0)
 S RAWAITD=$$FMDIFF^XLFDT(RAXDT,RADSDT) ;Wait days btw exm & desired dt
"RTN","RAPMW2",101,0)
 S:RAWAITD<0 RANEG=RANEG+1
"RTN","RAPMW2",102,0)
 D STORSUM^RAPMW1 ;store summary counts for Summary, Detail, Both
"RTN","RAPMW2",103,0)
 S RA16=$P(RAOREC,U,16) ; request entered dt/tm
"RTN","RAPMW2",104,0)
 ; count if same proc cancelled and reordered same day
"RTN","RAPMW2",105,0)
 S RA1=$E(RA16,1,7)
"RTN","RAPMW2",106,0)
 ; loop start w Last Activity same date as order's entry date
"RTN","RAPMW2",107,0)
 F  S RA1=$O(^RAO(75.1,"AO",RA1)) Q:'RA1  Q:RA1>RA16  D
"RTN","RAPMW2",108,0)
 .S RA2=0  F  S RA2=$O(^RAO(75.1,"AO",RA1,RA2)) Q:'RA2  Q:RA2=RAORIEN  D
"RTN","RAPMW2",109,0)
 ..S RA3=^RAO(75.1,RA2,0) ;skip exm's order
"RTN","RAPMW2",110,0)
 ..; other order is discontinued,same patient,same ordered procedure
"RTN","RAPMW2",111,0)
 ..I $P(RA3,U,5)=1,$P(RA3,U,1)=RADFN,$P(RA3,U,2)=$P(RAOREC,U,2) S RASAME=RASAME+1,RASAME2=1
"RTN","RAPMW2",112,0)
 ..Q
"RTN","RAPMW2",113,0)
 .Q
"RTN","RAPMW2",114,0)
 ; store detail rows for Detail,Both IF days wait at least = RASINCE
"RTN","RAPMW2",115,0)
 I "B^D"[RATYP,((RAWAITD<0)!(RAWAITD'<RASINCE)) D STORDET
"RTN","RAPMW2",116,0)
 Q
"RTN","RAPMW2",117,0)
PTA ; *79
"RTN","RAPMW2",118,0)
 S RAPRC=$P(RACN0,U,2)
"RTN","RAPMW2",119,0)
 I RAPRC="" S RAPTA="unknown" Q
"RTN","RAPMW2",120,0)
 S RACPTI=+$P($G(^RAMIS(71,+RAPRC,0)),U,9)
"RTN","RAPMW2",121,0)
 S RACPTC=$P($$NAMCODE^RACPTMSC(RACPTI,DT),U)
"RTN","RAPMW2",122,0)
 S RAPTA=$S(RACPTI:$O(^RA(73.2,"B",RACPTC,0)),1:"")
"RTN","RAPMW2",123,0)
 S RAPTA=$P($G(^RA(73.2,+RAPTA,0)),U,2)
"RTN","RAPMW2",124,0)
 S RAPTA=$S(RAPTA="":"unknown",'$D(RACOL(RAPTA)):"unknown",1:RAPTA)
"RTN","RAPMW2",125,0)
 ; RAPTA should match one of the RATOTAL(rapta)
"RTN","RAPMW2",126,0)
 Q
"RTN","RAPMW2",127,0)
COLHDS(X) ; moved from RAPMW1
"RTN","RAPMW2",128,0)
 ;input: X (header) 1 = DAYS WAIT -- PERCENTAGES; 2 = DAYS WAIT -- COUNTS
"RTN","RAPMW2",129,0)
 I X=1 D
"RTN","RAPMW2",130,0)
 .W !,"PROCEDURE",?29,"<=14",?37,"<=30",?45,"31-60",?54,"61-90",?63,"91-120",?73,">120"
"RTN","RAPMW2",131,0)
 .W !,"TYPE",?29,"Days",?37,"Days",?46,"Days",?55,"Days",?65,"Days",?73,"Days"
"RTN","RAPMW2",132,0)
 .W !,"------------------------",?27,"------",?35,"------",?44,"------",?53,"------",?63,"------",?71,"------"
"RTN","RAPMW2",133,0)
 .Q
"RTN","RAPMW2",134,0)
 I X=2 D
"RTN","RAPMW2",135,0)
 .W !,"PROCEDURE",?19,"<=14",?27,"<=30",?34,"31-60",?42,"61-90",?49,"91-120",?59,">120",?68,"ROW",?75,"Avg."
"RTN","RAPMW2",136,0)
 .W !,"TYPE",?19,"Days",?27,"Days",?35,"Days",?43,"Days",?51,"Days",?59,"Days",?66,"TOTAL",?75,"Days"
"RTN","RAPMW2",137,0)
 .W !,"---------------",?16,"-------",?24,"-------",?32,"-------",?40,"-------",?48,"-------",?56,"-------",?64,"-------",?72,"-------"
"RTN","RAPMW2",138,0)
 .Q
"RTN","RAPMW2",139,0)
 Q
"RTN","RAPMW2",140,0)
FOOTD2 ;
"RTN","RAPMW2",141,0)
 ;;
"RTN","RAPMW2",142,0)
 ;;1. Cancelled, "No Credit", inpatient cases, and not the highest modality of a printset are excluded from this report.
"RTN","RAPMW2",143,0)
 ;;   (See 3. below.)
"RTN","RAPMW2",144,0)
 ;;
"RTN","RAPMW2",145,0)
 ;;2. The "Days Wait" represent # of days from the Registered date (the date/time entered at the "Imaging Exam Date/Time:" prompt)
"RTN","RAPMW2",146,0)
 ;;   backwards to the Date Desired for the ordered procedure.  The calculation is based on the number of different days and 
"RTN","RAPMW2",147,0)
 ;;   not rounded off by hours.
"RTN","RAPMW2",148,0)
 ;;
"RTN","RAPMW2",149,0)
 ;;3. If the user did not select a specific CPT Code or Procedure Name, then the cases from a printset (group of cases that 
"RTN","RAPMW2",150,0)
 ;;   share the same report) will have only the case with the highest ranked modality printed.  Modalities are ranked 
"RTN","RAPMW2",151,0)
 ;;   in this order, (1) being the highest:
"RTN","RAPMW2",152,0)
 ;;   (1) Interventional, (2) MRI, (3) CT, (4) Cardiac Stress test, (5) Nuc Med, (6) US, (7) Mammo, (8) General Rad (9) Other
"RTN","RAPMW2",153,0)
 ;;   However, all the cases from an examset (group of cases that have separate reports) will all be listed.
"RTN","RAPMW2",154,0)
 ;;
"RTN","RAPMW2",155,0)
 ;;4. "Procedure Types" are assigned by a national CPT code look-up table and may differ from locally defined "Imaging Types."  
"RTN","RAPMW2",156,0)
 ;;   Therefore the number of procedures in each category may not be the same as other radiology management reports.
"RTN","RAPMW2",157,0)
 ;;
"RTN","RAPMW2",158,0)
 ;;5. Procedure Type of "unknown" refers to either cases that have no matching procedure type in the spreadsheet of CPT Codes
"RTN","RAPMW2",159,0)
 ;;   provided by the Office of Patient Care Services, or cases that are missing data for the procedure.
"RTN","RAPMW2",160,0)
 ;;
"RTN","RAPMW2",161,0)
 ;;6. CPT Code is not available for parent and broad procedures in the header section.  CPT Code of the parent order's highest
"RTN","RAPMW2",162,0)
 ;;   ranked modality case will be printed in the line by line section.  (See 3. above.)
"RTN","RAPMW2",163,0)
 ;;
"RTN","RAPMW2",164,0)
 ;;7. Date/Time Registered is the "Imaging Exam Date/Time" entered by the user during Registration.
"RTN","RAPMW2",165,0)
 ;;
"RTN","RAPMW2",166,0)
 ;;8. "*" under the "Date Register" column denotes the request was cancelled and re-ordered on the same day that it was cancelled.
"RTN","RAPMW2",167,0)
 ;;
"RTN","RAPMW2",168,0)
 ;;9. "p" under the "Case #" column, before the case number, denotes printset case with the highest ranked Procedure Type.
"RTN","RAPMW3")
0^25^B146308713^n/a
"RTN","RAPMW3",1,0)
RAPMW3 ;HOIFO/SWM-Radiology Wait Time reports ;3/20/09 14:10
"RTN","RAPMW3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**99**;Mar 16, 1998;Build 5
"RTN","RAPMW3",3,0)
 ;rvd - 3/20/09 p99
"RTN","RAPMW3",4,0)
 ; Supported IA #2320 reference to ^%ZISH
"RTN","RAPMW3",5,0)
 Q
"RTN","RAPMW3",6,0)
EN1 ;
"RTN","RAPMW3",7,0)
 W !,"*****************************************************************"
"RTN","RAPMW3",8,0)
 W !,"This routine requires a tab-delimited VMS text file for input."
"RTN","RAPMW3",9,0)
 W !,"This text file should come from Sherrill Snuggs' Xcel file."
"RTN","RAPMW3",10,0)
 W !,"ALL DATA FROM FILE 73.2 WILL BE DELETED BEFORE IMPORTING VMS FILE."
"RTN","RAPMW3",11,0)
 W !,"Only the 1st of duplicate CPT Codes would be imported."
"RTN","RAPMW3",12,0)
 W !,"*****************************************************************"
"RTN","RAPMW3",13,0)
 S RADIR="USER$:[TEMP]"
"RTN","RAPMW3",14,0)
 W !!,"Enter VMS directory :"_RADIR_"//" R X:DTIME
"RTN","RAPMW3",15,0)
 Q:X="^"  S:X'="" RADIR=X
"RTN","RAPMW3",16,0)
 R !!,"Enter VMS file name :",RAVMS:DTIME
"RTN","RAPMW3",17,0)
 Q:"^"[RAVMS
"RTN","RAPMW3",18,0)
 S RAFILE=RADIR_RAVMS
"RTN","RAPMW3",19,0)
 W !!,"Full name of input file is ",RAFILE,!
"RTN","RAPMW3",20,0)
 S DIR(0)="Y",DIR("A",1)="Import includes deletion of all existing data from file 73.2.",DIR("A",2)=" "
"RTN","RAPMW3",21,0)
 S DIR("A")="Do you want to import data from "_RAFILE
"RTN","RAPMW3",22,0)
 S DIR("B")="No"
"RTN","RAPMW3",23,0)
 D ^DIR K DIR I 'Y W !!?5,"Nothing Done." D CLEANUP Q
"RTN","RAPMW3",24,0)
 D OPEN^%ZISH("FILE",RADIR,RAVMS,"R")
"RTN","RAPMW3",25,0)
 I POP W !?3,"** This file cannot be opened. **" G ABEND
"RTN","RAPMW3",26,0)
 D DATDEL ;delete all current data, if any, from file
"RTN","RAPMW3",27,0)
 S RATAB=$C(9),RACOUNT=0,RAREAD=0
"RTN","RAPMW3",28,0)
 S RATXT="Loading data into FM file 73.2."
"RTN","RAPMW3",29,0)
 D DISP
"RTN","RAPMW3",30,0)
R1 U IO R X:DTIME I $$STATUS^%ZISH G EOF
"RTN","RAPMW3",31,0)
 K A S RAREAD=RAREAD+1
"RTN","RAPMW3",32,0)
 F I=1:1:8 S A(I)=$P(X,RATAB,I)
"RTN","RAPMW3",33,0)
 I A(1)'?5AN D  G R1 ; skip header record
"RTN","RAPMW3",34,0)
 . S RATXT="First field is "_A(1)_", record is not imported"
"RTN","RAPMW3",35,0)
 . D DISP
"RTN","RAPMW3",36,0)
 . Q
"RTN","RAPMW3",37,0)
 I A(1)="" D  G R1 ; skip null record
"RTN","RAPMW3",38,0)
 . S RATXT="First field is null, record is not imported"
"RTN","RAPMW3",39,0)
 . D DISP
"RTN","RAPMW3",40,0)
 . Q
"RTN","RAPMW3",41,0)
 I $O(^RA(73.2,"B",A(1),0)) D  G R1 ; skip duplicate CPT Code
"RTN","RAPMW3",42,0)
 . S RATXT="Duplicate CPT Code not imported = "_A(1)
"RTN","RAPMW3",43,0)
 . D DISP
"RTN","RAPMW3",44,0)
 . Q
"RTN","RAPMW3",45,0)
 S A(5)=$$PARSE(A(5))
"RTN","RAPMW3",46,0)
 S A(8)=$E(A(8),1) S:A(8)'="Y" A(8)="" ; Y or null only
"RTN","RAPMW3",47,0)
 D SETREC S RACOUNT=RACOUNT+1 I '(RACOUNT#10) U 0 W "."
"RTN","RAPMW3",48,0)
 G R1
"RTN","RAPMW3",49,0)
EOF D CLOSE^%ZISH("FILE")
"RTN","RAPMW3",50,0)
 S RATXT=RAREAD_" records read, "_RACOUNT_" records loaded." D DISP
"RTN","RAPMW3",51,0)
 D CLEANUP
"RTN","RAPMW3",52,0)
 Q
"RTN","RAPMW3",53,0)
PARSE(RA) ; parse Descriptor -- remove double quotes and trailing blanks if any
"RTN","RAPMW3",54,0)
 N I,B
"RTN","RAPMW3",55,0)
 Q:RA="" RA
"RTN","RAPMW3",56,0)
 S:$E(RA,1)="""" RA=$E(RA,2,$L(RA))
"RTN","RAPMW3",57,0)
 S:$E(RA,$L(RA))="""" RA=$E(RA,1,($L(RA)-1))
"RTN","RAPMW3",58,0)
 Q:$E(RA,$L(RA))'=" " RA ; Last char is non-blank
"RTN","RAPMW3",59,0)
 F I=$L(RA):-1:1 Q:$E(RA,I)'=" "  S B=$E(RA,1,I-1)
"RTN","RAPMW3",60,0)
 S RA=B
"RTN","RAPMW3",61,0)
 Q RA
"RTN","RAPMW3",62,0)
DATDEL ; Delete all data from file 73.2
"RTN","RAPMW3",63,0)
 S RATXT="File 73.2 hasn't been set up yet, so no data to delete."
"RTN","RAPMW3",64,0)
 I '$D(^RA(73.2,0))#2 D DISP Q
"RTN","RAPMW3",65,0)
 S RATXT="File 73.2 doesn't have any data, so nothing to delete."
"RTN","RAPMW3",66,0)
 I '$O(^RA(73.2,0)) D DISP Q
"RTN","RAPMW3",67,0)
 S RATXT="Deleting data from FM file #73.2..."
"RTN","RAPMW3",68,0)
 D DISP
"RTN","RAPMW3",69,0)
 S I=0 F  S I=$O(^RA(73.2,I)) Q:'I  K ^RA(73.2,I)
"RTN","RAPMW3",70,0)
 K ^RA(73.2,"B"),^RA(73.2,"AC")
"RTN","RAPMW3",71,0)
 S $P(^RA(73.2,0),"^",3,4)="^0"
"RTN","RAPMW3",72,0)
 Q
"RTN","RAPMW3",73,0)
SETREC ;
"RTN","RAPMW3",74,0)
 S RA=$P(^RA(73.2,0),"^",3)
"RTN","RAPMW3",75,0)
S2 S RA=RA+1 I $D(^RA(73.2,RA,0))#2 G S2 ;find next un-used ien
"RTN","RAPMW3",76,0)
 F I=1,2,3,4,6,7,8 S $P(^RA(73.2,RA,0),"^",I)=A(I)
"RTN","RAPMW3",77,0)
 S ^RA(73.2,RA,1)=A(5)
"RTN","RAPMW3",78,0)
 S ^RA(73.2,"B",A(1),RA)=""
"RTN","RAPMW3",79,0)
 S:A(2)]"" ^RA(73.2,"AC",A(2),RA)=""
"RTN","RAPMW3",80,0)
 S $P(^RA(73.2,0),"^",3)=RA
"RTN","RAPMW3",81,0)
 S $P(^RA(73.2,0),"^",4)=$P(^RA(73.2,0),"^",4)+1
"RTN","RAPMW3",82,0)
 Q
"RTN","RAPMW3",83,0)
ABEND U 0 W !,"Processing abended."
"RTN","RAPMW3",84,0)
 D CLEANUP
"RTN","RAPMW3",85,0)
 Q
"RTN","RAPMW3",86,0)
DISP ;display one-line text either interactively or within KIDS installation
"RTN","RAPMW3",87,0)
 I '$D(XPDNM)#2 U 0 W !!?5,RATXT
"RTN","RAPMW3",88,0)
 E  D BMES^XPDUTL(RATXT)
"RTN","RAPMW3",89,0)
 Q
"RTN","RAPMW3",90,0)
CLEANUP ;
"RTN","RAPMW3",91,0)
 K A,F,I,POP,RA,RACOUNT,RADIR,RAFILE,RAREAD,RATAB,RATXT,RAVMS,X,Y
"RTN","RAPMW3",92,0)
 Q
"RTN","RAPMW3",93,0)
 ;
"RTN","RAPMW3",94,0)
HD ;Header for email <=30 Days Performance Value Summary.
"RTN","RAPMW3",95,0)
 ;S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",96,0)
 ;S RAN=RAN+1,^TMP($J,"RAPM",RAN)=RAH1_"   Page: 1"
"RTN","RAPMW3",97,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPMW3",98,0)
 S ^TMP($J,"RAPM",RAN)=RAH3,RAN=RAN+1
"RTN","RAPMW3",99,0)
 S I=0 F  S I=$O(RAH4(I)) Q:'I  S ^TMP($J,"RAPM",RAN)=RAH4(I),RAN=RAN+1
"RTN","RAPMW3",100,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=RAH5_"         "
"RTN","RAPMW3",101,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=RAH8_"         "
"RTN","RAPMW3",102,0)
 Q
"RTN","RAPMW3",103,0)
HDSUM ;
"RTN","RAPMW3",104,0)
 S RATOTAL=0
"RTN","RAPMW3",105,0)
 S:$G(^TMP($J,"RAPM","TOTAL"))>0 RATOTAL=($G(^TMP($J,"RAPM","VR",1))+$G(^(2)))/$G(^TMP($J,"RAPM","TOTAL"))*100
"RTN","RAPMW3",106,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",107,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="PERFORMANCE VALUE SUMMARY"
"RTN","RAPMW3",108,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="-------------------------"
"RTN","RAPMW3",109,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",110,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=$J(RATOTAL,0,1)_"% - Report verification timeliness performance value"
"RTN","RAPMW3",111,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",112,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="Wait Time performance values:"
"RTN","RAPMW3",113,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",114,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=" %         %"
"RTN","RAPMW3",115,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=" <=14      <=30                      PROCEDURE"
"RTN","RAPMW3",116,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=" Days      Days                           TYPE"
"RTN","RAPMW3",117,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="----------------------------------------------"
"RTN","RAPMW3",118,0)
 Q
"RTN","RAPMW3",119,0)
 ;
"RTN","RAPMW3",120,0)
HD1 ;Header for email Wait and Time Performamce Report.
"RTN","RAPMW3",121,0)
 N I
"RTN","RAPMW3",122,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",123,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPMW3",124,0)
 S ^TMP($J,"RAPM",RAN)=RAH1_"    Page: 1"
"RTN","RAPMW3",125,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",126,0)
 S RAN=RAN+1
"RTN","RAPMW3",127,0)
 S ^TMP($J,"RAPM",RAN)=RAH3,RAN=RAN+1
"RTN","RAPMW3",128,0)
 S I=0 F  S I=$O(RAH4(I)) Q:'I  S ^TMP($J,"RAPM",RAN)=RAH4(I),RAN=RAN+1
"RTN","RAPMW3",129,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=RAH5_"       ",RAN=RAN+1
"RTN","RAPMW3",130,0)
 S I=0 F  S I=$O(RAH6(I)) Q:'I  S ^TMP($J,"RAPM",RAN)=RAH6(I),RAN=RAN+1
"RTN","RAPMW3",131,0)
 S RAN=RAN+1
"RTN","RAPMW3",132,0)
 S I=0 F  S I=$O(RAH7(I)) Q:'I  S ^TMP($J,"RAPM",RAN)=RAH7(I),RAN=RAN+1
"RTN","RAPMW3",133,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=RAH8_"        "
"RTN","RAPMW3",134,0)
 Q
"RTN","RAPMW3",135,0)
HDSUM1 ;
"RTN","RAPMW3",136,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPMW3",137,0)
 S ^TMP($J,"RAPM",RAN)="Total number of procedures registered during specified exam date range: "_RATOTAL
"RTN","RAPMW3",138,0)
 Q
"RTN","RAPMW3",139,0)
 ;
"RTN","RAPMW3",140,0)
RAJOB ;PARTIAL process email wait and time report
"RTN","RAPMW3",141,0)
 S RAN=1 N I,J
"RTN","RAPMW3",142,0)
 N RASP3,RASP4,RASP6,RASP8,RASP10,RASP15,RASP20,RASP25,RASP31
"RTN","RAPMW3",143,0)
 S $P(RASP3," ",3)="",$P(RASP4," ",4)="",$P(RASP6," ",6)="",$P(RASP8," ",8)="",$P(RASP10," ",10)=""
"RTN","RAPMW3",144,0)
 S $P(RASP15," ",15)="",$P(RASP20," ",20)="",$P(RASP25," ",25)="",$P(RASP31," ",31)=""
"RTN","RAPMW3",145,0)
 D HD D HDSUM S RAPG=RAPG+1
"RTN","RAPMW3",146,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW3",147,0)
 .S:$D(RACOL14(I,"FR")) RAPCT(I,"FR")=$S(RATOTAL(I)>0:$J(RACOL14(I,"FR")/RATOTAL(I)*100,5,1),1:$J(0,5,1))
"RTN","RAPMW3",148,0)
 .F J=1:1:5 S RAPCT(I,J)=$S(RATOTAL(I)>0:$J(RACOL(I,J)/RATOTAL(I)*100,5,1),1:$J(0,5,1)),RACOL(I,J)=$J(RACOL(I,J),7)
"RTN","RAPMW3",149,0)
 .S RAAVG(I)=$S(RATOTAL(I)>0:$J(RAWAITD(I)/RATOTAL(I),7,0),1:"")
"RTN","RAPMW3",150,0)
 .I I="unknown",RATOTAL(I)=0 K RATOTAL(I),RACOL(I) Q  ;remove "unknown" row if 0s
"RTN","RAPMW3",151,0)
 .I RANX="C",RATOTAL(I)=0 K RATOTAL(I),RACOL(I) Q  ;remov 0 row if by CPT
"RTN","RAPMW3",152,0)
 .I $D(RAXCLUDE(I)) K RATOTAL(I),RACOL(I) Q  ;remove excluded Proc Type
"RTN","RAPMW3",153,0)
 .S RATOTAL(I)=$J(RATOTAL(I),8)
"RTN","RAPMW3",154,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW3",155,0)
 .S RAN=RAN+1
"RTN","RAPMW3",156,0)
 .S ^TMP($J,"RAPM",RAN)=$E(RAPCT(I,"FR")_RASP10,1,10)_$E(RAPCT(I,1)_RASP10,1,10)_$J($S(I="unknown":""""_I_"""",1:I),26)
"RTN","RAPMW3",157,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",158,0)
 Q
"RTN","RAPMW3",159,0)
 ;
"RTN","RAPMW3",160,0)
COLHDS(X) ; moved from RAPMW1
"RTN","RAPMW3",161,0)
 I X=1 D
"RTN","RAPMW3",162,0)
 .S RAN=RAN+1 S ^TMP($J,"RAPM",RAN)="" S RAN=RAN+1
"RTN","RAPMW3",163,0)
 .S ^TMP($J,"RAPM",RAN)="PROCEDURE                   <=30"
"RTN","RAPMW3",164,0)
 .S RAN=RAN+1
"RTN","RAPMW3",165,0)
 .S ^TMP($J,"RAPM",RAN)="TYPE                        Days"
"RTN","RAPMW3",166,0)
 .S RAN=RAN+1
"RTN","RAPMW3",167,0)
 .S ^TMP($J,"RAPM",RAN)="------------------------- ------"
"RTN","RAPMW3",168,0)
 I X=2 D
"RTN","RAPMW3",169,0)
 .S RAN=RAN+1 S ^TMP($J,"RAPM",RAN)="" S RAN=RAN+1
"RTN","RAPMW3",170,0)
 .S ^TMP($J,"RAPM",RAN)="PROCEDURE                   <=30"
"RTN","RAPMW3",171,0)
 .S RAN=RAN+1
"RTN","RAPMW3",172,0)
 .S ^TMP($J,"RAPM",RAN)="TYPE                        Days"
"RTN","RAPMW3",173,0)
 .S RAN=RAN+1
"RTN","RAPMW3",174,0)
 .S ^TMP($J,"RAPM",RAN)="------------------------- ------"
"RTN","RAPMW3",175,0)
 Q
"RTN","RAPMW3",176,0)
 ;
"RTN","RAPMW3",177,0)
FOOTS ;
"RTN","RAPMW3",178,0)
 I RANEG D
"RTN","RAPMW3",179,0)
 .S RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPMW3",180,0)
 .S ^TMP($J,"RAPM",RAN)=RASP3_"(There "_$S(RANEG=1:"is",1:"are")_" "_RANEG_" case"_$S(RANEG=1:"",1:"s")_" with negative days wait included in the first column.)"
"RTN","RAPMW3",181,0)
 .;S RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPMW3",182,0)
 S RAMAX=$S($D(RATOTAL("unknown")):33,1:28)
"RTN","RAPMW3",183,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",184,0)
 F I=1:1:RAMAX Q:RAXIT  S ^TMP($J,"RAPM",RAN)=RASP4_$P($T(FOOTS2+I),";;",2),RAN=RAN+1
"RTN","RAPMW3",185,0)
 Q
"RTN","RAPMW3",186,0)
 ;
"RTN","RAPMW3",187,0)
RAJOB1 ;process mail wait and time report
"RTN","RAPMW3",188,0)
 N RASP3,RASP4,RASP6,RASP8,RASP25,I,J
"RTN","RAPMW3",189,0)
 S $P(RASP3," ",3)="",$P(RASP4," ",4)="",$P(RASP6," ",6)="",$P(RASP8," ",8)="",$P(RASP25," ",25)=""
"RTN","RAPMW3",190,0)
 D HD1 D HDSUM1 S RAPG=RAPG+1
"RTN","RAPMW3",191,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW3",192,0)
 .S:$D(RACOL14(I,"FR")) RAPCT(I,"FR")=$S(RATOTAL(I)>0:$J(RACOL14(I,"FR")/RATOTAL(I)*100,5,1),1:$J(0,5,1)),RACOL14(I,"FR")=$J(RACOL14(I,"FR"),7)
"RTN","RAPMW3",193,0)
 .F J=1:1:5 S RAPCT(I,J)=$S(RATOTAL(I)>0:$J(RACOL(I,J)/RATOTAL(I)*100,5,1),1:$J(0,5,1)),RACOL(I,J)=$J(RACOL(I,J),7)
"RTN","RAPMW3",194,0)
 .S RAAVG(I)=$S(RATOTAL(I)>0:$J(RAWAITD(I)/RATOTAL(I),7,0),1:"")
"RTN","RAPMW3",195,0)
 .I I="unknown",RATOTAL(I)=0 K RATOTAL(I),RACOL(I) Q  ;remove "unknown" row if 0s
"RTN","RAPMW3",196,0)
 .I RANX="C",RATOTAL(I)=0 K RATOTAL(I),RACOL(I) Q  ;remov 0 row if by CPT
"RTN","RAPMW3",197,0)
 .I $D(RAXCLUDE(I)) K RATOTAL(I),RACOL(I) Q  ;remove excluded Proc Type
"RTN","RAPMW3",198,0)
 .S RATOTAL(I)=$J(RATOTAL(I),8)
"RTN","RAPMW3",199,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPMW3",200,0)
 S ^TMP($J,"RAPM",RAN)="          DAYS WAIT -- PERCENTAGES"
"RTN","RAPMW3",201,0)
 ;S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",202,0)
 D COL1(1)
"RTN","RAPMW3",203,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW3",204,0)
 .S RAN=RAN+1
"RTN","RAPMW3",205,0)
 .S ^TMP($J,"RAPM",RAN)=$E($S(I="unknown":""""_I_"""",1:I)_RASP25,1,26)_"   "_RAPCT(I,"FR")_"  "_RAPCT(I,1)_"   "_RAPCT(I,2)_"   "_RAPCT(I,3)_"   "_RAPCT(I,4)_"   "_RAPCT(I,5)
"RTN","RAPMW3",206,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",207,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="          DAYS WAIT -- COUNTS"
"RTN","RAPMW3",208,0)
 ;S RAN=RAN+1,^TMP($J,"RAPM",RAN)=""
"RTN","RAPMW3",209,0)
 D COL1(2)
"RTN","RAPMW3",210,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW3",211,0)
 .S RAN=RAN+1
"RTN","RAPMW3",212,0)
 .S ^TMP($J,"RAPM",RAN)=$E($S(I="unknown":""""_I_"""",1:I)_RASP25,1,26)_""_RACOL14(I,"FR")_""_RACOL(I,1)_""_RACOL(I,2)_""_RACOL(I,3)_""_RACOL(I,4)_""_RACOL(I,5)_""_RATOTAL(I)_""_$S(RAAVG(I)="":"      -",1:RAAVG(I))
"RTN","RAPMW3",213,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)=" ",RAN=RAN+1
"RTN","RAPMW3",214,0)
 F I=1:1 S J=$P($T(DAY14+I),";;",2) Q:J=""  S ^TMP($J,"RAPM",RAN)=J,RAN=RAN+1
"RTN","RAPMW3",215,0)
 S ^TMP($J,"RAPM",RAN)=" ",RAN=RAN+1
"RTN","RAPMW3",216,0)
 S ^TMP($J,"RAPM",RAN)="Number of procedures cancelled and re-ordered on the same day = "_RASAME
"RTN","RAPMW3",217,0)
 D FOOTS
"RTN","RAPMW3",218,0)
 Q
"RTN","RAPMW3",219,0)
 ;
"RTN","RAPMW3",220,0)
COL1(X) ; moved from RAPMW1
"RTN","RAPMW3",221,0)
 I X=1 D
"RTN","RAPMW3",222,0)
 .S RAN=RAN+1 S ^TMP($J,"RAPM",RAN)="" S RAN=RAN+1
"RTN","RAPMW3",223,0)
 .S ^TMP($J,"RAPM",RAN)="PROCEDURE                    <=14   <=30   31-60   61-90   91-120   >120"
"RTN","RAPMW3",224,0)
 .S RAN=RAN+1
"RTN","RAPMW3",225,0)
 .S ^TMP($J,"RAPM",RAN)="TYPE                         Days   Days    Days    Days    Days    Days"
"RTN","RAPMW3",226,0)
 .S RAN=RAN+1
"RTN","RAPMW3",227,0)
 .S ^TMP($J,"RAPM",RAN)="--------------------------   -----  -----   -----   -----   -----   -----"
"RTN","RAPMW3",228,0)
 I X=2 D
"RTN","RAPMW3",229,0)
 .S RAN=RAN+1 S ^TMP($J,"RAPM",RAN)="" S RAN=RAN+1
"RTN","RAPMW3",230,0)
 .S ^TMP($J,"RAPM",RAN)="PROCEDURE                    <=14   <=30  31-60  61-90  91-120  >120    ROW    Avg."
"RTN","RAPMW3",231,0)
 .S RAN=RAN+1
"RTN","RAPMW3",232,0)
 .S ^TMP($J,"RAPM",RAN)="TYPE                         Days   Days   Days   Days   Days   Days   TOTAL   Days"
"RTN","RAPMW3",233,0)
 .S RAN=RAN+1
"RTN","RAPMW3",234,0)
 .S ^TMP($J,"RAPM",RAN)="---------------------------  -----  -----  -----  -----  -----  -----  -----   -----"
"RTN","RAPMW3",235,0)
 Q
"RTN","RAPMW3",236,0)
 ;
"RTN","RAPMW3",237,0)
FOOTS2 ;
"RTN","RAPMW3",238,0)
 ;;
"RTN","RAPMW3",239,0)
 ;;1. Cancelled, "No Credit", inpatient cases, and not the highest modality
"RTN","RAPMW3",240,0)
 ;;   of a printset are excluded from this report.  (See 3. below.)
"RTN","RAPMW3",241,0)
 ;;
"RTN","RAPMW3",242,0)
 ;;2. Columns represent # of days wait from the Registered date (the date/
"RTN","RAPMW3",243,0)
 ;;   time entered at the "Imaging Exam Date/Time:" prompt) backwards to the
"RTN","RAPMW3",244,0)
 ;;   Date Desired for the ordered procedure.  The calculation is based on
"RTN","RAPMW3",245,0)
 ;;   the number of different days and not rounded off by hours.  The "31-60"
"RTN","RAPMW3",246,0)
 ;;   column represents those orders that were registered 31 days or more but
"RTN","RAPMW3",247,0)
 ;;   less than 61 days after the Date Desired.
"RTN","RAPMW3",248,0)
 ;;
"RTN","RAPMW3",249,0)
 ;;3. If the user did not select a specific CPT Code or Procedure Name, 
"RTN","RAPMW3",250,0)
 ;;   then the cases from a printset (group of cases that share the same
"RTN","RAPMW3",251,0)
 ;;   report) will have only the case with the highest modality printed.  
"RTN","RAPMW3",252,0)
 ;;   The modalities have this hierarchical order, where (1) is the highest:
"RTN","RAPMW3",253,0)
 ;;   (1) Interventional, (2) MRI, (3) CT, (4) Cardiac Stress test, 
"RTN","RAPMW3",254,0)
 ;;   (5) Nuc Med, (6) US, (7) Mammo, (8) General Rad (9) Other
"RTN","RAPMW3",255,0)
 ;;
"RTN","RAPMW3",256,0)
 ;;4. "Procedure Types" are assigned by a national CPT code look-up table
"RTN","RAPMW3",257,0)
 ;;   and may differ from locally defined "Imaging Types."  Therefore the
"RTN","RAPMW3",258,0)
 ;;   number of procedures in each category may not be the same as other
"RTN","RAPMW3",259,0)
 ;;   radiology management reports.
"RTN","RAPMW3",260,0)
 ;;
"RTN","RAPMW3",261,0)
 ;;5. "Avg. Days" is the average days wait.  It is calculated from the sum
"RTN","RAPMW3",262,0)
 ;;   of the days wait for that Procedure Type, divided by the count of cases
"RTN","RAPMW3",263,0)
 ;;   included in this report for that Procedure Type.  Negative days wait
"RTN","RAPMW3",264,0)
 ;;   is counted as 0.  A "-" means an average cannot be calculated.
"RTN","RAPMW3",265,0)
 ;;
"RTN","RAPMW3",266,0)
 ;;6. Procedure Type of "unknown" refers to either cases that have no 
"RTN","RAPMW3",267,0)
 ;;   matching procedure type in the spreadsheet of CPT Codes provided
"RTN","RAPMW3",268,0)
 ;;   by the Office of Patient Care Services, or cases that are missing
"RTN","RAPMW3",269,0)
 ;;   data for the procedure.
"RTN","RAPMW3",270,0)
 ;;
"RTN","RAPMW3",271,0)
 ;
"RTN","RAPMW3",272,0)
DAY14 ;
"RTN","RAPMW3",273,0)
 ;;   The "<=14 Days" column contains data that is also in the "<=30
"RTN","RAPMW3",274,0)
 ;;   Days" column. The reason that performance is calculated for both
"RTN","RAPMW3",275,0)
 ;;   <=14 days and <=30 days is so that facilities can track their
"RTN","RAPMW3",276,0)
 ;;   performance to a 14 day performance standard rather than a 30
"RTN","RAPMW3",277,0)
 ;;   day standard if they choose to do so.
"RTN","RAPMW3",278,0)
 ;;
"RTN","RAPROD")
0^5^B43504474^B41179318
"RTN","RAPROD",1,0)
RAPROD ;HISC/FPT,GJC AISC/MJK-Detailed Exam View ;05/13/09  06:45
"RTN","RAPROD",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,35,45,56,99**;Mar 16, 1998;Build 5
"RTN","RAPROD",3,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RAPROD",4,0)
 ;Supported IA #2053 UPDATE^DIE
"RTN","RAPROD",5,0)
 ;Supported IA #10040 ^SC(
"RTN","RAPROD",6,0)
 ;Supported IA #10060 ^VA(200
"RTN","RAPROD",7,0)
START S RADI=^RADPT(RADFN,"DT",RADTI,0) S:$D(^("P",RACNI,"COMP")) RA("COMP")=^("COMP") S RA("REA")=$S($D(^("R")):^("R"),1:"")
"RTN","RAPROD",8,0)
 S RA("TECH")=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0)) I RA("TECH") S RA("TECH")=$S($D(^VA(200,+^(RA("TECH"),0),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD",9,0)
 S X=$P(Y(0),"^",4),RA("CAT")=$S(X="I":"INPATIENT",X="O":"OUTPATIENT",X="S":"SHARING",X="C":"CONTRACT",X="R":"RESEARCH",X="E":"EMPLOYEE",1:"UNKNOWN")
"RTN","RAPROD",10,0)
 S RA("RST")=$$RSTAT^RAO7PC1A
"RTN","RAPROD",11,0)
 F I=1:1:13 S Y=$T(LIST+I),@$P(Y,";",3)=$S($D(@($P(Y,";",4)_+$P(@$P(Y,";",5),"^",$P(Y,";",6))_",0)")):$P(^(0),"^"),1:"")
"RTN","RAPROD",12,0)
 ;
"RTN","RAPROD",13,0)
 N RAOPRC ; this will be the Requested Procedure defined only if it
"RTN","RAPROD",14,0)
 ; differs from the Registered Procedure
"RTN","RAPROD",15,0)
 I +$P(Y(0),U,11),($$DPROC^RAUTL15(RADFN,RADTI,RACNI,+$P(Y(0),U,11))]"") D
"RTN","RAPROD",16,0)
 . S RAOPRC=$$GET1^DIQ(75.1,+$P(Y(0),"^",11)_",",2)
"RTN","RAPROD",17,0)
 . Q
"RTN","RAPROD",18,0)
VIEW W @IOF S X="",$P(X,"=",80)="" W X K X
"RTN","RAPROD",19,0)
 W !?2,"Name        : ",RANME,"    ",RASSN
"RTN","RAPROD",20,0)
 W !?2,"Division    : ",$E(RA("DIV"),1,20),?40,"Category     : ",RA("CAT")
"RTN","RAPROD",21,0)
 W !?2,"Location    : ",$S($D(^SC(+RA("LOC"),0)):$P(^(0),"^"),1:"Unknown"),?40,"Ward         : ",$E(RA("WRD"),1,24)
"RTN","RAPROD",22,0)
 W !?2,"Exam Date   : ",RADATE,?40,"Service      : ",$E(RA("SERV"),1,24)
"RTN","RAPROD",23,0)
 W !?2,"Case No.    : ",RACN W ?40,"Bedsection   : ",$E(RA("BED"),1,24)
"RTN","RAPROD",24,0)
 W !?40,"Clinic       : ",$E(RA("CL"),1,24)
"RTN","RAPROD",25,0)
 S Y=$E(RA("CAT")) I "CSR"[Y W !?40,$E($S("C"=Y:"Contract     : "_RA("CONT"),"S"=Y:"Sharing      : "_RA("CONT"),"R"=Y:"Research     : "_RA("REA"),1:""),1,38)
"RTN","RAPROD",26,0)
 W:$X>1 ! S X="",$P(X,"-",80)="" W X K X
"RTN","RAPROD",27,0)
 W !?2,"Registered    : ",$E(RAPRC,1,60) D PRCCPT
"RTN","RAPROD",28,0)
 W:$G(RAOPRC)]"" !?2,"Requested     : ",$E(RAOPRC,1,60)
"RTN","RAPROD",29,0)
 W !?2,"Requesting Phy: ",$E(RA("PHY"),1,20),?40,"Exam Status  : ",$S($D(^RA(72,RAST,0)):$E($P(^(0),"^"),1,24),1:"")
"RTN","RAPROD",30,0)
 W !?2,"Int'g Resident: ",$E(RA("RES"),1,20),?40,"Report Status: ",$E(RA("RST"),1,21)
"RTN","RAPROD",31,0)
 S RAPREVER=+$P($G(^RARPT(RARPT,0)),"^",13)
"RTN","RAPROD",32,0)
 W !?2,"Pre-Verified  : ",$E($S($D(^VA(200,RAPREVER,0)):$P(^(0),"^",1),1:"NO"),1,20),?40,"Cam/Equip/Rm : ",$E(RA("RM"),1,20) K RAPREVER
"RTN","RAPROD",33,0)
 W !?2,"Int'g Staff   : ",$E(RA("STAFF"),1,20),?40,"Diagnosis    : ",$E(RA("DIA"),1,24)
"RTN","RAPROD",34,0)
 W !?2,"Technologist  : ",$E(RA("TECH"),1,20),?40,"Complication : ",$E(RA("CMP"),1,24)
"RTN","RAPROD",35,0)
 I $D(RA("COMP")) W !?2,"Comment       : " F I=1:60 Q:$E(RA("COMP"),I,I+59)']""  W ?18,$E(RA("COMP"),I,I+59)
"RTN","RAPROD",36,0)
 ;W:$X>1 !
"RTN","RAPROD",37,0)
 W !
"RTN","RAPROD",38,0)
 I $$PTSEX^RAUTL8(RADFN)="F" D  ;get pt sex and display pregnancy status for females, ptch #99
"RTN","RAPROD",39,0)
 .N RAOR751 S RAOR751=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U,11)
"RTN","RAPROD",40,0)
 .W ?2,"Pregnant at time of order entry: ",$$GET1^DIQ(75.1,$G(RAOR751)_",",13)
"RTN","RAPROD",41,0)
 K RAFL W ?47,"Films :" F I=0:0 S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"F",I)) Q:I'>0  I $D(^(I,0)) S X=^(0) W ?55,$S($D(^RA(78.4,+$P(X,"^"),0)):$P(^(0),"^"),1:"Unknown")," - ",+$P(X,"^",2),!
"RTN","RAPROD",42,0)
 W:$X>1 ! S X="",$P(X,"-",34)="" W X
"RTN","RAPROD",43,0)
 W "Modifiers" W $E(X,1,32) K X
"RTN","RAPROD",44,0)
 W !?2,"Proc Modifiers:" D MODS^RAUTL2 F I=1:1 Q:$P(Y,", ",I)']""  W ?18,$P(Y,", ",I),!
"RTN","RAPROD",45,0)
 N J
"RTN","RAPROD",46,0)
 W !?2,"CPT Modifiers : " W:Y(1)="None" Y(1),!
"RTN","RAPROD",47,0)
 I Y(1)'="None" F I=1:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) W ?18,$P(J,"^",2)," ",$P(J,"^",3),! I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RAPROD",48,0)
 Q:+$G(RAXIT)
"RTN","RAPROD",49,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RAPROD",50,0)
 Q:+$G(RAXIT)
"RTN","RAPROD",51,0)
 ;
"RTN","RAPROD",52,0)
 ;check for Contrast Media data, print it if it exists.
"RTN","RAPROD",53,0)
 I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",0)) D
"RTN","RAPROD",54,0)
 .W !?2,"Contrast Media: " S RACM=1
"RTN","RAPROD",55,0)
 .N DIWF,DIWL,DIWR,DIWT,X,Z
"RTN","RAPROD",56,0)
 .S X=$$CM^RADEM1(RADFN,RADTI,RACNI),DIWL=20,DIWF="C50"
"RTN","RAPROD",57,0)
 .D ^DIWP S Z=0
"RTN","RAPROD",58,0)
 .F  S Z=$O(^UTILITY($J,"W",DIWL,Z)) Q:'Z  D
"RTN","RAPROD",59,0)
 ..W ?18,^UTILITY($J,"W",DIWL,Z,0)
"RTN","RAPROD",60,0)
 ..W:+$O(^UTILITY($J,"W",DIWL,Z)) !
"RTN","RAPROD",61,0)
 ..Q
"RTN","RAPROD",62,0)
 .K ^UTILITY($J,"W")
"RTN","RAPROD",63,0)
 .Q
"RTN","RAPROD",64,0)
 ;
"RTN","RAPROD",65,0)
 I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) D PHARM^RAPROD2(RACNI_","_RADTI_","_RADFN_",") W ! ; display pharmaceutical data
"RTN","RAPROD",66,0)
 I +$G(RAXIT) K RAXIT Q
"RTN","RAPROD",67,0)
 I +$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",28) D RDIO^RAPROD2(+$P(^(0),"^",28)) W ! ; display radiopharm data
"RTN","RAPROD",68,0)
 I +$G(RAXIT) K RAXIT Q
"RTN","RAPROD",69,0)
 W:$X>1 ! S X="",$P(X,"=",80)="" W X K X
"RTN","RAPROD",70,0)
 G ^RAPROD1
"RTN","RAPROD",71,0)
 ;
"RTN","RAPROD",72,0)
PRCCPT ; display Proc's abbrv, proc type, CPT
"RTN","RAPROD",73,0)
 Q:$G(RADTI)=""  Q:$G(RACNI)=""
"RTN","RAPROD",74,0)
 ;
"RTN","RAPROD",75,0)
 N RADISPLY
"RTN","RAPROD",76,0)
 S RADISPLY=$G(^RAMIS(71,+$P($G(^RADPT(+RADFN,"DT",+RADTI,"P",+RACNI,0)),U,2),0)) ; set $ZR to file 71 before calling prccpt^radd1
"RTN","RAPROD",77,0)
 S RADISPLY=$$PRCCPT^RADD1()
"RTN","RAPROD",78,0)
 W ?54,RADISPLY
"RTN","RAPROD",79,0)
 Q
"RTN","RAPROD",80,0)
SETL ;Set long display preference
"RTN","RAPROD",81,0)
 N RA1,RA2,DIR
"RTN","RAPROD",82,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPROD",83,0)
 S RA2=$O(^RA(79,RA1,"LDIS","B",DUZ,0))
"RTN","RAPROD",84,0)
 I RA2 D  Q
"RTN","RAPROD",85,0)
 . W !!,"Your preference for Long Display of Procedures has already been set."
"RTN","RAPROD",86,0)
 . S DIR(0)="Y",DIR("A")="Do you want to delete your preference ",DIR("B")="No"
"RTN","RAPROD",87,0)
 . S DIR("?",1)="If you answer 'Yes', then all Radiology reports requested by you will"
"RTN","RAPROD",88,0)
 . S DIR("?",2)="will default to the condensed display, which means that repeated procedures"
"RTN","RAPROD",89,0)
 . S DIR("?")="and associated modifiers will only be listed once."
"RTN","RAPROD",90,0)
 . D ^DIR
"RTN","RAPROD",91,0)
 . Q:'Y
"RTN","RAPROD",92,0)
 . D DEL150
"RTN","RAPROD",93,0)
 . Q
"RTN","RAPROD",94,0)
 W !
"RTN","RAPROD",95,0)
 S DIR(0)="Y",DIR("A",1)="Do you want to set your preference for Long Display of Procedures"
"RTN","RAPROD",96,0)
 S DIR("A")="in all Radiology reports ",DIR("B")="No"
"RTN","RAPROD",97,0)
 S DIR("?",1)="If you answer 'Yes', then all Radiology reports requested by you will"
"RTN","RAPROD",98,0)
 S DIR("?",2)="list all repeated procedures and associated modifiers instead of"
"RTN","RAPROD",99,0)
 S DIR("?")="listing repeated procedures only once, which is the condensed (default) format."
"RTN","RAPROD",100,0)
 D ^DIR
"RTN","RAPROD",101,0)
 Q:'Y
"RTN","RAPROD",102,0)
 D STUF150
"RTN","RAPROD",103,0)
 Q
"RTN","RAPROD",104,0)
DEL150 ;Delete user ien from 1st record in file 79's field 150
"RTN","RAPROD",105,0)
 ; note: DIK utility looks for DA(1) here
"RTN","RAPROD",106,0)
 Q:'$D(DUZ)#2
"RTN","RAPROD",107,0)
 S DA(1)=$O(^RA(79,0)) Q:'DA(1)
"RTN","RAPROD",108,0)
 S DIK="^RA(79,"_DA(1)_",""LDIS"","
"RTN","RAPROD",109,0)
 S DA=$O(^RA(79,DA(1),"LDIS","B",DUZ,0))
"RTN","RAPROD",110,0)
 Q:'DA
"RTN","RAPROD",111,0)
 D ^DIK
"RTN","RAPROD",112,0)
 K DIK,DA
"RTN","RAPROD",113,0)
 W !!,"Your preference for Long Display of Procedures has been removed.",!
"RTN","RAPROD",114,0)
 Q
"RTN","RAPROD",115,0)
STUF150 ;Stuff user ien into 1st record in file 79's field 150
"RTN","RAPROD",116,0)
 Q:'$D(DUZ)#2
"RTN","RAPROD",117,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPROD",118,0)
 K RAFDA,RAIEN,RAMSG
"RTN","RAPROD",119,0)
 S RAFDA(79.03,"?+2,"_RA1_",",.01)=DUZ
"RTN","RAPROD",120,0)
 D UPDATE^DIE("","RAFDA","RAIEN","RAMSG")
"RTN","RAPROD",121,0)
 W !!,"Your preference for Long Display of Procedures has been set.",!
"RTN","RAPROD",122,0)
 Q
"RTN","RAPROD",123,0)
CDIS ; set up RACDIS array to store 1st non-duplicate proc+pmod+cptmod
"RTN","RAPROD",124,0)
 N N1,N2,R1,RA71,Y
"RTN","RAPROD",125,0)
 K RACDIS
"RTN","RAPROD",126,0)
 D LDIS
"RTN","RAPROD",127,0)
 S N1=0
"RTN","RAPROD",128,0)
 F  S N1=$O(^RADPT(RADFN,"DT",RADTI,"P",N1)) Q:'N1  S R1=$G(^(N1,0)) D:R1]""
"RTN","RAPROD",129,0)
 . S RA71=$P(R1,U,2),RACNI=N1
"RTN","RAPROD",130,0)
 . D MODS^RAUTL2
"RTN","RAPROD",131,0)
 . S RACDIS("B",RA71,Y,Y(1),N1)=""
"RTN","RAPROD",132,0)
 . S N2=$O(RACDIS("B",RA71,Y,Y(1),0))
"RTN","RAPROD",133,0)
 . S RACDIS(N2)=$G(RACDIS(N2))+1 ;increment lowest ien of same proc+pmod+cptmod
"RTN","RAPROD",134,0)
 . S:RACDIS(N2)>1 RACDIS("RAFLDUP")=1 ;>1 same proc+pmod+cptmod
"RTN","RAPROD",135,0)
 . Q
"RTN","RAPROD",136,0)
 Q
"RTN","RAPROD",137,0)
LDIS ; See if user prefers Long Display of Procedures
"RTN","RAPROD",138,0)
 N RA1
"RTN","RAPROD",139,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPROD",140,0)
 S:$O(^RA(79,RA1,"LDIS","B",DUZ,0)) RALDIS=1
"RTN","RAPROD",141,0)
 Q
"RTN","RAPROD",142,0)
LIST ;
"RTN","RAPROD",143,0)
 ;;RA("DIV");^DIC(4,;RADI;3
"RTN","RAPROD",144,0)
 ;;RA("LOC");^RA(79.1,;RADI;4
"RTN","RAPROD",145,0)
 ;;RA("WRD");^DIC(42,;Y(0);6
"RTN","RAPROD",146,0)
 ;;RA("SERV");^DIC(49,;Y(0);7
"RTN","RAPROD",147,0)
 ;;RA("CL");^SC(;Y(0);8
"RTN","RAPROD",148,0)
 ;;RA("CONT");^DIC(34,;Y(0);9
"RTN","RAPROD",149,0)
 ;;RA("RES");^VA(200,;Y(0);12
"RTN","RAPROD",150,0)
 ;;RA("DIA");^RA(78.3,;Y(0);13
"RTN","RAPROD",151,0)
 ;;RA("PHY");^VA(200,;Y(0);14
"RTN","RAPROD",152,0)
 ;;RA("STAFF");^VA(200,;Y(0);15
"RTN","RAPROD",153,0)
 ;;RA("CMP");^RA(78.1,;Y(0);16
"RTN","RAPROD",154,0)
 ;;RA("RM");^RA(78.6,;Y(0);18
"RTN","RAPROD",155,0)
 ;;RA("BED");^DIC(42.4,;Y(0);19
"RTN","RAREG2")
0^26^B57844146^B43905852
"RTN","RAREG2",1,0)
RAREG2 ;HISC/CAH,FPT,DAD,SS AISC/MJK,RMO-Register Patient ;06/04/09  09:55
"RTN","RAREG2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**13,18,93,99**;Mar 16, 1998;Build 5
"RTN","RAREG2",3,0)
 ;last modif. JULY 5,00 by SS 
"RTN","RAREG2",4,0)
 ; 07/15/2008 BAY/KAM rem call 249750 RA*5*93 Correct DIK Calls
"RTN","RAREG2",5,0)
 ; 06/04/09 rvd - display pregnancy screen and pregnancy screen comment only in Add Exams to Last visit option.
"RTN","RAREG2",6,0)
 ; Supported IA #2053 reference to ^DIE
"RTN","RAREG2",7,0)
 ; Supported IA #10013 reference to ^DIK
"RTN","RAREG2",8,0)
ORDER ; Get data from ordered procedure for registration
"RTN","RAREG2",9,0)
 K RACLNC,RALIFN,RALOC,RAPIFN,RAPRC,RARDTE,RARSH,RASHA
"RTN","RAREG2",10,0)
 S Y=^RAO(75.1,+RAOIFN,0),RAPRC=$S($D(^RAMIS(71,+$P(Y,"^",2),0)):$P(^(0),"^"),1:"") S:$D(RADPARFL) RAPRC=RADPARPR ;may not need to redefine raprc ?
"RTN","RAREG2",11,0)
 S RACAT=$S('$D(RAWARD):$P($P(^DD(75.1,4,0),$P(Y,"^",4)_":",2),";"),1:RACAT)
"RTN","RAREG2",12,0)
 D SL^RAREG3 Q:RAQUIT
"RTN","RAREG2",13,0)
 S:"CS"[$E(RACAT)&($D(^DIC(34,+$P(Y,"^",9),0))) RASHA=$P(^(0),"^") S:"R"[$E(RACAT)&($D(^RAO(75.1,+RAOIFN,"R"))) RARSH=^("R")
"RTN","RAREG2",14,0)
 S:$D(^VA(200,+$P(Y,"^",14),0)) RAPIFN=+$P(Y,"^",14) S:$P(Y,"^",21) RARDTE=$P(Y,"^",21) S:$D(^SC(+$P(Y,"^",22),0)) RALIFN=+$P(Y,"^",22)
"RTN","RAREG2",15,0)
 I '$D(RAWARD),$D(RALIFN),$P(^SC(RALIFN,0),"^",3)="C" S RALOC=$P(^(0),"^") S RACLNC=$S('$D(^("SL")):RALOC,$D(^SC(+$P(^("SL"),"^",5),0)):$P(^(0),"^"),1:RALOC)
"RTN","RAREG2",16,0)
 ;check nodes ahead 6/18/96
"RTN","RAREG2",17,0)
 N RAAHEAD
"RTN","RAREG2",18,0)
 S RAAHEAD=$O(^RADPT(RADFN,"DT","B",RADTE))
"RTN","RAREG2",19,0)
 I RAAHEAD[RADTE W $C(7),!!?5,"Someone else has already started editing a record for this",!?5,"patient at this time, please try a few minutes later." S RAQUIT=1 R !!,"Press RETURN to continue :",RAAHEAD:DTIME
"RTN","RAREG2",20,0)
 Q
"RTN","RAREG2",21,0)
EXAMLOOP ; register the exam
"RTN","RAREG2",22,0)
 N REM ;this is used by the edit template
"RTN","RAREG2",23,0)
 ;P99; keep previous pregnancy screen data before adding new exam
"RTN","RAREG2",24,0)
 I $D(RAOPT("ADDEXAM")),$$PTSEX^RAUTL8(RADFN)="F" S RA703DAT=$$PRCEXA^RAUTL8(RADFN)  ;ra703dat holds the previous entry
"RTN","RAREG2",25,0)
 S DA=RADFN,RACN="N",DIE("NO^")="OUTOK",DR="[RA REGISTER]",DIE="^RADPT(" D ^DIE K DIE("NO^"),DE,DQ
"RTN","RAREG2",26,0)
 K RAPOP,RAFM,RAFM1,RAI,RAMOD,RASTI,RACMTHOD,RANMFLG,RAIEN702 ;moved from edit template
"RTN","RAREG2",27,0)
 S RACNICNT=RACNICNT+1
"RTN","RAREG2",28,0)
 S ^TMP($J,"RAREG1",RACNICNT)=RADFN_U_RADTI_U_RACNI_U_RAOIFN
"RTN","RAREG2",29,0)
 I '$D(RAFIN) D  Q
"RTN","RAREG2",30,0)
 . W !?3,$C(7),"Exam entry not complete. Must delete..."
"RTN","RAREG2",31,0)
 . S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RAREG2",32,0)
 . ; Modified the next line for rem call 249750
"RTN","RAREG2",33,0)
 . S DIK="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P""," D ^DIK
"RTN","RAREG2",34,0)
 . K ^TMP($J,"RAREG1",RACNICNT)
"RTN","RAREG2",35,0)
 . K RAPX  ; added in RA*5*13 to stop labels & flash cards in RAREG1
"RTN","RAREG2",36,0)
 . Q
"RTN","RAREG2",37,0)
 ;start of p99, display and SET pregnancy screen and pregnancy screen comment
"RTN","RAREG2",38,0)
 ;value defaulted from previous case exam (regardless of case exam status)
"RTN","RAREG2",39,0)
 I $D(RAOPT("ADDEXAM")),$$PTSEX^RAUTL8(RADFN)="F" D
"RTN","RAREG2",40,0)
 .Q:'$D(RA703DAT)
"RTN","RAREG2",41,0)
 .N RA3,RADTIEN,RACNIEN,RAPCOMM
"RTN","RAREG2",42,0)
 .S RADTIEN=$P(RA703DAT,U),RACNIEN=$P(RA703DAT,U,2)
"RTN","RAREG2",43,0)
 .S RA3=$G(^RADPT(RADFN,"DT",RADTIEN,"P",RACNIEN,0))
"RTN","RAREG2",44,0)
 .S RAPCOMM=$G(^RADPT(RADFN,"DT",RADTIEN,"P",RACNIEN,"PCOMM"))
"RTN","RAREG2",45,0)
 .W:$P(RA3,U,32)'="" !,"    PREGNANCY SCREEN: ",$S($P(RA3,U,32)="y":"Patient answered yes",$P(RA3,U,32)="n":"Patient answered no",$P(RA3,U,32)="u":"Patient is unable to answer or is unsure",1:"")
"RTN","RAREG2",46,0)
 .W:$P(RA3,U,32)'="n"&$L(RAPCOMM) !,"    PREGNANCY SCREEN COMMENT: ",RAPCOMM
"RTN","RAREG2",47,0)
 .N RAPTAGE S RAPTAGE=$$PTAGE^RAUTL8(RADFN,"")
"RTN","RAREG2",48,0)
 .Q:RAPTAGE<12!(RAPTAGE>55)
"RTN","RAREG2",49,0)
 .I $P(RA3,U,32)'="" D
"RTN","RAREG2",50,0)
 ..N RAFDA
"RTN","RAREG2",51,0)
 ..S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",32)=$P(RA3,U,32)
"RTN","RAREG2",52,0)
 ..D FILE^DIE("","RAFDA")
"RTN","RAREG2",53,0)
 .I $D(^RADPT(RADFN,"DT",RADTIEN,"P",RACNIEN,"PCOMM")) D
"RTN","RAREG2",54,0)
 ..N RAFDA
"RTN","RAREG2",55,0)
 ..S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",80)=^RADPT(RADFN,"DT",RADTIEN,"P",RACNIEN,"PCOMM")
"RTN","RAREG2",56,0)
 ..D FILE^DIE("","RAFDA")
"RTN","RAREG2",57,0)
 ;end of p99
"RTN","RAREG2",58,0)
 S RAPARENT=$S($G(RAPARENT):RAPARENT,$P($G(^RAMIS(71,RAPROC,0)),U,6)="P":1,1:+$G(RAPARENT))
"RTN","RAREG2",59,0)
 I $D(^RAO(75.1,+RAOIFN,"H")) S:$D(^("H",0)) ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",0)=^(0) F I=1:1 Q:'$D(^RAO(75.1,+RAOIFN,"H",I,0))  S ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",I,0)=^(0)
"RTN","RAREG2",60,0)
 S ^DISV($S($D(DUZ)#2:DUZ,1:0),"RA","CASE #")=RADFN_"^"_RADTI_"^"_RACNI,RAREC=""
"RTN","RAREG2",61,0)
 S:$D(RADPARFL) ^TMP($J,"PRO-REG",RAPROCI,RAOIFN)=""
"RTN","RAREG2",62,0)
 K RAFIN,DR,RA703DAT
"RTN","RAREG2",63,0)
 K RACLNC,RALIFN,RALOC,RAOSTS,RAPHY,RAPRC,RARDTE,RARSH,RASHA
"RTN","RAREG2",64,0)
 Q
"RTN","RAREG2",65,0)
EXAMDEL ; Delete examset if incomplete
"RTN","RAREG2",66,0)
 W !!?3,$C(7),"Exam entry not complete. Must delete all descendent exams..."
"RTN","RAREG2",67,0)
 S RATMP=0
"RTN","RAREG2",68,0)
 F  S RATMP=$O(^TMP($J,"RAREG1",RATMP)) Q:RATMP'>0  D
"RTN","RAREG2",69,0)
 . S RA=^TMP($J,"RAREG1",RATMP)
"RTN","RAREG2",70,0)
 . S RAOIFN=$P(RA,U,4),(RADFN,DA(2))=$P(RA,U)
"RTN","RAREG2",71,0)
 . S (RADTI,DA(1))=$P(RA,U,2),(RACNI,DA)=$P(RA,U,3)
"RTN","RAREG2",72,0)
 . ; Modified the next line for rem call 249750
"RTN","RAREG2",73,0)
 . S DIK="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P""," D ^DIK
"RTN","RAREG2",74,0)
 . K ^TMP($J,"RAREG1",RATMP),RAPX(RATMP)
"RTN","RAREG2",75,0)
 . K DIE,DR S DIE="^RAO(75.1,",DA=RAOIFN,DR="5///5" D ^DIE K DIE,DR
"RTN","RAREG2",76,0)
 . Q
"RTN","RAREG2",77,0)
 W !?3,"Deletion complete!",!
"RTN","RAREG2",78,0)
 Q
"RTN","RAREG2",79,0)
XTRADESC ; Ask extra descendent procedures for a parent
"RTN","RAREG2",80,0)
 N RASKIPIT S RASKIPIT=0
"RTN","RAREG2",81,0)
 F  D  Q:RASKIPIT!RAEXIT!RAQUIT
"RTN","RAREG2",82,0)
 . N DIR S DIR(0)="Y"
"RTN","RAREG2",83,0)
 . S DIR("A")="Register another descendent exam for "_RANME_" (Y/N)"
"RTN","RAREG2",84,0)
 . W ! D ^DIR
"RTN","RAREG2",85,0)
 . S RAEXIT=$S($D(DTOUT)!$D(DUOUT):1,1:0),RASKIPIT='Y
"RTN","RAREG2",86,0)
 . I RASKIPIT!RAEXIT Q
"RTN","RAREG2",87,0)
 . D ORDER K RAPRC Q:RAQUIT
"RTN","RAREG2",88,0)
 . D EXAMLOOP,MEMSET(RADFN,RADTI,RACNI)
"RTN","RAREG2",89,0)
 . Q
"RTN","RAREG2",90,0)
 Q
"RTN","RAREG2",91,0)
EXAMSET ; Set the EXAM SET field if a parent is registered
"RTN","RAREG2",92,0)
 N DA,DIE,DR,Y
"RTN","RAREG2",93,0)
 S DIE="^RADPT("_RADFN_",""DT"","
"RTN","RAREG2",94,0)
 S DA(1)=RADFN,DA=RADTI
"RTN","RAREG2",95,0)
 S DR="5///^S X=$S($G(RAPARENT):''RAPARENT,1:""@"")"
"RTN","RAREG2",96,0)
 D ^DIE
"RTN","RAREG2",97,0)
 Q
"RTN","RAREG2",98,0)
MEMSET(RAX,RAY,RAZ) ; Set 'MEMBER OF SET' field on the exam node
"RTN","RAREG2",99,0)
 ; if the procedure is a descendant procedure.
"RTN","RAREG2",100,0)
 ; Var List:   RAX <-> RADFN : RAY <-> RADTI : RAZ <-> RACNI
"RTN","RAREG2",101,0)
 Q:$G(^RADPT(RAX,"DT",RAY,"P",RAZ,0))']""
"RTN","RAREG2",102,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RAREG2",103,0)
 S DIE="^RADPT("_RAX_",""DT"","_RAY_",""P"","
"RTN","RAREG2",104,0)
 S DA(2)=RAX,DA(1)=RAY,DA=RAZ,DR="25///"_$S($P($G(^RAMIS(71,+RAPROC,0)),"^",18)="Y":2,1:1) D ^DIE ;2=combined report, 1=separate reports
"RTN","RAREG2",105,0)
 Q
"RTN","RAREG2",106,0)
SET17(RAX,RAY,RAZ) ; Set piece 17 on exam node
"RTN","RAREG2",107,0)
 Q:$G(^RADPT(RAX,"DT",RAY,"P",RAZ,0))']""
"RTN","RAREG2",108,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RAREG2",109,0)
 S DIE="^RADPT("_RAX_",""DT"","_RAY_",""P"","
"RTN","RAREG2",110,0)
 S DA(2)=RAX,DA(1)=RAY,DA=RAZ,DR="17///"_RA17 D ^DIE
"RTN","RAREG2",111,0)
 Q
"RTN","RAREG2",112,0)
UOSM ; called from RAREG1
"RTN","RAREG2",113,0)
 ; update order status and send OE v3.0 message
"RTN","RAREG2",114,0)
 ; This code will $O through the ^TMP($J,"RAREG1" global and make
"RTN","RAREG2",115,0)
 ; just one call per order/request number to ^RAORDU to update the
"RTN","RAREG2",116,0)
 ; status in File 75.1. One call to ^RAORDU per order/request number
"RTN","RAREG2",117,0)
 ; means only one HL7 type message per order/request will be sent to 
"RTN","RAREG2",118,0)
 ; OE v3.0.
"RTN","RAREG2",119,0)
 ;
"RTN","RAREG2",120,0)
 Q:'$D(^TMP($J,"RAREG1"))
"RTN","RAREG2",121,0)
 N RACNT,RAORDNUM,RATMPNDE
"RTN","RAREG2",122,0)
 S RACNT=0
"RTN","RAREG2",123,0)
 F  S RACNT=$O(^TMP($J,"RAREG1",RACNT)) Q:RACNT'>0  D
"RTN","RAREG2",124,0)
 .S RATMPNDE=$G(^TMP($J,"RAREG1",RACNT))
"RTN","RAREG2",125,0)
 .S RAOIFN=$P(RATMPNDE,U,4) I RAOIFN D
"RTN","RAREG2",126,0)
 ..Q:$D(RAORDNUM(RAOIFN))
"RTN","RAREG2",127,0)
 ..S RAPROC=$P(^RAO(75.1,+RAOIFN,0),U,2)
"RTN","RAREG2",128,0)
 ..N RA18PCHG S RA18PCHG=$$EN1^RAO7XX(RAOIFN) ;P18 - if the proc changed, sends XX mess, sets RA18PCHG=1 for RAORDU
"RTN","RAREG2",129,0)
 ..S RAOSTS=6 D ^RAORDU
"RTN","RAREG2",130,0)
 ..S RAORDNUM(RAOIFN)=""
"RTN","RAREG2",131,0)
 ..Q
"RTN","RAREG2",132,0)
 .Q
"RTN","RAREG2",133,0)
 Q
"RTN","RAREG2",134,0)
CKDUPORD ; ck for dupl procedures in outstanding orders
"RTN","RAREG2",135,0)
 S RA6="",RA8=0
"RTN","RAREG2",136,0)
CKD1 S RA6=$O(^TMP($J,"PRO-REG",RA6)) Q:'RA6
"RTN","RAREG2",137,0)
 S RA7=$O(^TMP($J,"PRO-REG",RA6,0)) G:'RA7 CKD1
"RTN","RAREG2",138,0)
 K ^TMP($J,"PRO-ORD",RA6,RA7) ; kill hook for order of regist'd proc
"RTN","RAREG2",139,0)
 G:'$O(^TMP($J,"PRO-ORD",RA6,0)) CKD1
"RTN","RAREG2",140,0)
 W:'RA8 !!?5,"Of the procedures you just registered,",!?5,"the following procedure(s) are still in outstanding order(s) :",$C(7),!
"RTN","RAREG2",141,0)
 S RA8=1
"RTN","RAREG2",142,0)
 S RA7=""
"RTN","RAREG2",143,0)
 F  S RA7=$O(^TMP($J,"PRO-ORD",RA6,RA7)) Q:'RA7  W !?5,$P(^RAMIS(71,RA6,0),U) W:^TMP($J,"PRO-ORD",RA6,RA7)="DESC" ?35,"(parent=",$P(^RAMIS(71,$P($G(^RAO(75.1,RA7,0)),U,2),0),U),")"
"RTN","RAREG2",144,0)
 G CKD1
"RTN","RAREG2",145,0)
COPYFROM(RAZ) ;called by RAREG1 if add exam shd copy dx/staff/resident
"RTN","RAREG2",146,0)
 ;RAZ is "P"-node's ien of newly added case of set
"RTN","RAREG2",147,0)
 Q:'$D(RAFIRST)#2  ;RAFIRST is "P"-node's ien of first case of set
"RTN","RAREG2",148,0)
 Q:$G(^RADPT(RADFN,"DT",RADTI,"P",RAZ,0))']""
"RTN","RAREG2",149,0)
 Q:$G(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,0))']""
"RTN","RAREG2",150,0)
 N RA,RA2,RA3,RA5 S RA5=0
"RTN","RAREG2",151,0)
 ; RA is a dummy var
"RTN","RAREG2",152,0)
 ; RA2 is used by data server call in RARTE2
"RTN","RAREG2",153,0)
 ; RA3 is used by COPYn^RARTE2 as a dummy var
"RTN","RAREG2",154,0)
 ; RA5=1 if any data got copied over to the new case
"RTN","RAREG2",155,0)
 N RA1PR,RA1PS ; prim res/staff
"RTN","RAREG2",156,0)
 N RA1SR,RA1SS ; sec res/staff arrays
"RTN","RAREG2",157,0)
 N RA1PD,RA1SD ; prim diag, then sec diags arrays
"RTN","RAREG2",158,0)
 N RAFDA,RAIEN,RAMSG,RAXIT
"RTN","RAREG2",159,0)
 S RAXIT=0
"RTN","RAREG2",160,0)
 S RA2=RAZ_","_RADTI_","_RADFN
"RTN","RAREG2",161,0)
 ; get data from first case of set
"RTN","RAREG2",162,0)
 S RA1PR=$P(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,0),U,12),RA1PS=$P(^(0),U,15),RA1PD=$P(^(0),U,13)
"RTN","RAREG2",163,0)
 I $D(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,"SRR",0)) S RA=0 F  S RA=$O(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,"SRR",RA)) Q:+RA'=RA  S RA1SR(RA)=+(^(RA,0))
"RTN","RAREG2",164,0)
 I $D(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,"SSR",0)) S RA=0 F  S RA=$O(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,"SSR",RA)) Q:+RA'=RA  S RA1SS(RA)=+(^(RA,0))
"RTN","RAREG2",165,0)
 I $D(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,"DX",0)) S RA=0 F  S RA=$O(^RADPT(RADFN,"DT",RADTI,"P",RAFIRST,"DX",RA)) Q:+RA'=RA  S RA1SD(RA)=+(^(RA,0))
"RTN","RAREG2",166,0)
 ; copy data from first case of set to new case
"RTN","RAREG2",167,0)
 S:RA1PR $P(^RADPT(RADFN,"DT",RADTI,"P",RAZ,0),U,12)=RA1PR,RA5=1
"RTN","RAREG2",168,0)
 S:RA1PS $P(^RADPT(RADFN,"DT",RADTI,"P",RAZ,0),U,15)=RA1PS,RA5=1
"RTN","RAREG2",169,0)
 S:RA1PD $P(^RADPT(RADFN,"DT",RADTI,"P",RAZ,0),U,13)=RA1PD,RA5=1
"RTN","RAREG2",170,0)
 I $O(RA1SR("")) S RA3="" D COPY3^RARTE2 S RA5=1
"RTN","RAREG2",171,0)
 I $O(RA1SS("")) S RA3="" D COPY4^RARTE2 S RA5=1
"RTN","RAREG2",172,0)
 I $O(RA1SD("")) S RA3="" D COPY5^RARTE2 S RA5=1
"RTN","RAREG2",173,0)
 Q:'RA5
"RTN","RAREG2",174,0)
 ; set xref for this new case only
"RTN","RAREG2",175,0)
 S DIK="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RAREG2",176,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RAZ
"RTN","RAREG2",177,0)
 D IX1^DIK
"RTN","RAREG2",178,0)
 Q
"RTN","RART1")
0^10^B63509883^B58301617
"RTN","RART1",1,0)
RART1 ;HISC/GJC,SWM-Reporting Menu (Part 2) ;05/13/09  08:05
"RTN","RART1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,16,15,21,23,27,34,99**;Mar 16, 1998;Build 5
"RTN","RART1",3,0)
 ;Print Report By Patient has been moved to 4^RART2!
"RTN","RART1",4,0)
 ;these sections are moved to ^RART3 : QRPT, PHYS, MODSET, OUT1
"RTN","RART1",5,0)
 ;RVD P99, add pregnancy screen and commment if populated for female pt.
"RTN","RART1",6,0)
CHK I 'RARPT!('$D(^RARPT(+RARPT,0))) W !?3,$C(7),"No report filed for case number ",RACN,"." K RARPT Q
"RTN","RART1",7,0)
 I $D(RADFT),$P(^RARPT(+RARPT,0),"^",5)'["D" W !?3,$C(7),"Report for case number ",RACN," is not in a 'draft' status." K RARPT Q
"RTN","RART1",8,0)
 I '$D(RADFT),$P(^RARPT(+RARPT,0),"^",5)["D" W !?3,$C(7),"Report filed for case number ",RACN," but not available for printing." K RARPT Q
"RTN","RART1",9,0)
 Q
"RTN","RART1",10,0)
 ;
"RTN","RART1",11,0)
5 ;;Draft Report (Reprint)
"RTN","RART1",12,0)
 D SETVARS Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))  S RADFT="" G 4^RART2
"RTN","RART1",13,0)
 ;
"RTN","RART1",14,0)
6 ;;Display a Report By Patient
"RTN","RART1",15,0)
 W ! S DIC(0)="AEMQ" D ^RADPA G Q6:Y<0 S RADFN=+Y,RAHEAD="**** Patient's Exams ****",RAF1=1,RAREPORT=1 D ^RAPTLU G Q6:X="^" G 6:'$D(RADUP)
"RTN","RART1",16,0)
 I X=1 R X:3
"RTN","RART1",17,0)
OERR ;entry from RA OERR PROFILE protocol
"RTN","RART1",18,0)
 F RAI=0:0 S RAI=$O(RADUP(RAI)) Q:RAI'>0  S Y=^TMP($J,"RAEX",RAI) D 61,DISP Q:X="^"
"RTN","RART1",19,0)
 K RADUP,RAI,RAJ,X,^TMP($J,"RAEX") Q:$D(ORVP)  G 6
"RTN","RART1",20,0)
61 F RAJ=1:1:11 S @$P("RADFN^RADTI^RACNI^RANME^RASSN^RADATE^RADTE^RACN^RAPRC^RARPT^RAST","^",RAJ)=$P(Y,"^",RAJ)
"RTN","RART1",21,0)
 S Y(0)=^RADPT(RADFN,"DT",RADTI,"P",RACNI,0) Q
"RTN","RART1",22,0)
 ;
"RTN","RART1",23,0)
OERR1 ;Entry Point for Alert Follow-Up Action for OE/RR
"RTN","RART1",24,0)
 Q:'$D(XQADATA)!('$D(XQAID))  S (RARPT,Y)=XQADATA D RASET^RAUTL2
"RTN","RART1",25,0)
 S:Y Y(0)=Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"Unknown"),RAPRC=$S($D(^RAMIS(71,+$P(Y(0),"^",2),0)):$P(^(0),"^"),1:"Unknown")
"RTN","RART1",26,0)
 S RALERTS="" D DISP K:X="^" XQAID,XQAKILL
"RTN","RART1",27,0)
 I $D(XQAID) S DFN=$P(XQAID,",",2) D DELETE^XQALERT
"RTN","RART1",28,0)
 K RALERTS
"RTN","RART1",29,0)
 Q
"RTN","RART1",30,0)
 ;
"RTN","RART1",31,0)
DISP I RARPT,($D(RAPBRPT)),($P($G(^RARPT(+RARPT,0)),"^",5)="V") D  Q
"RTN","RART1",32,0)
 . ; This code will not allow a user to re-edit a verified report.
"RTN","RART1",33,0)
 . ; In this case, two or more possible users signed on to the same
"RTN","RART1",34,0)
 . ; Imaging location, asked to verify the reports of the same
"RTN","RART1",35,0)
 . ; Interpreting Radiology/Nuclear Medicine Physician.
"RTN","RART1",36,0)
 . ; For the 'On-line Verifying of Reports' option only!
"RTN","RART1",37,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT,Y
"RTN","RART1",38,0)
 . ; removed  X  from N  so rtn RARTVER would quit if caret entered
"RTN","RART1",39,0)
 . W !!?10,"Since the time you selected this group of reports,",!?10,$P($G(^VA(200,+$P(^RARPT(+RARPT,0),"^",9),0)),U)," has verified the report for "
"RTN","RART1",40,0)
 . W !?10,$P($G(^DPT(+$P(^RARPT(+RARPT,0),"^",2),0)),U),"  case #",$P(^RARPT(+RARPT,0),"^"),".",$C(7)
"RTN","RART1",41,0)
 . S Y=$S($D(^TMP($J,"RA","DT",+$G(RARTDT),+$G(RARPT))):$P($P(^(RARPT),"/",2),U,3),$D(RARPTX(+$G(RPTX))):$P($P(RARPTX(+$G(RPTX)),"/",2),U,3),1:"")
"RTN","RART1",42,0)
 . I $D(^RAMIS(71,+Y,0)) W !?10,"Procedure ",$P(^(0),U)
"RTN","RART1",43,0)
 . W ! K DIR S DIR(0)="E" D ^DIR S RAVFIED=1
"RTN","RART1",44,0)
 . Q
"RTN","RART1",45,0)
 D HOME^%ZIS S OREND=1
"RTN","RART1",46,0)
 I 'RARPT!('$D(^RARPT(+RARPT,0))) D  G Q6
"RTN","RART1",47,0)
 . W !?3,$C(7),"No report filed for case number",$S($D(RACN):" "_RACN,1:""),"."
"RTN","RART1",48,0)
 . R X:3 ; D:$$IMAGE^RARIC1 DISPF^MAGRIC ;don't call MAG 111300
"RTN","RART1",49,0)
 . Q
"RTN","RART1",50,0)
 S RAST=$P(^RARPT(+RARPT,0),"^",5)
"RTN","RART1",51,0)
 I '$D(RARTVER),(RAST=""!(RAST["D")) D  G Q6
"RTN","RART1",52,0)
 . W !?3,$C(7),"Report filed for case number ",RACN," but not available for display."
"RTN","RART1",53,0)
 . R X:3 ; D:$$IMAGE^RARIC1 DISPF^MAGRIC ;don't call MAG 111300
"RTN","RART1",54,0)
 . Q
"RTN","RART1",55,0)
DISP1 I $S('$D(ORACTION):1,ORACTION'=8:1,'$D(X):0,X="T":1,1:0) W @IOF
"RTN","RART1",56,0)
 W !,RANME," (",$$SSN^RAUTL,")",?41,"Case No. ",?57,": ",$P($G(^RARPT(RARPT,0)),"^")," @",$E(RADATE,$L(RADATE)-4,$L(RADATE))
"RTN","RART1",57,0)
 W !,$E(RAPRC,1,40) I +$G(^RARPT(RARPT,"T")) W ?41,"Transcriptionist",?57,": ",$E($P($G(^VA(200,+^RARPT(RARPT,"T"),0)),"^"),1,20)
"RTN","RART1",58,0)
 N R3 S R3=$G(^RADPT(+$G(RADFN),"DT",+$G(RADTI),"P",+$G(RACNI),0))
"RTN","RART1",59,0)
 W !,"Req. Phys : ",$E($P($G(^VA(200,+$P(R3,"^",14),0)),"^"),1,25)
"RTN","RART1",60,0)
 S RAPREVER=+$P($G(^RARPT(RARPT,0)),"^",13) W ?41,"Pre-verified",?57,": ",$S($D(^VA(200,RAPREVER,0)):$E($P($G(^VA(200,RAPREVER,0)),"^"),1,24),1:"NO") K RAPREVER
"RTN","RART1",61,0)
 D PHYS^RART3
"RTN","RART1",62,0)
 ;Display Pregnancy Screen and Comments if respective field is filled and pt is female, patch #99
"RTN","RART1",63,0)
 I $$PTSEX^RAUTL8(RADFN)="F" D
"RTN","RART1",64,0)
 .W:$P(R3,U,32)'="" !,"Pregnancy Screen: ",$S($P(R3,"^",32)="y":"Patient answered yes",$P(R3,"^",32)="n":"Patient answered no",$P(R3,"^",32)="u":"Patient is unable to answer or is unsure",1:"")
"RTN","RART1",65,0)
 .N RAPCOMM S RAPCOMM=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PCOMM"))
"RTN","RART1",66,0)
 .W:$P(R3,U,32)'=""&$L(RAPCOMM) !,"Pregnancy Screen Comment: ",RAPCOMM
"RTN","RART1",67,0)
 I $D(RAPBRPT),(RAST="PD") D
"RTN","RART1",68,0)
 . W !,"**Prob Text: "
"RTN","RART1",69,0)
 . I $G(^RARPT(+RARPT,"P"))]"" D
"RTN","RART1",70,0)
 .. S X=$G(^RARPT(+RARPT,"P"))
"RTN","RART1",71,0)
 .. D OUTTEXT^RAUTL9(X,"",10,70,13,"","!")
"RTN","RART1",72,0)
 .. Q
"RTN","RART1",73,0)
 . Q
"RTN","RART1",74,0)
 W !,$$REPEAT^XLFSTR("=",79)
"RTN","RART1",75,0)
 I $O(^RARPT(RARPT,1,0)) D MODSET^RART3
"RTN","RART1",76,0)
 I '$O(^RARPT(RARPT,1,0)) D
"RTN","RART1",77,0)
 . D MODS^RAUTL2,OUT1^RART3
"RTN","RART1",78,0)
 . I +$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",28) S X=$$RDIO1^RARTUTL1(+$P(^(0),"^",28))
"RTN","RART1",79,0)
 . Q:$L($G(X))  ; 'X' should be 'null' to continue
"RTN","RART1",80,0)
 . S:+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) X=$$PHARM1^RARTUTL(RACNI_","_RADTI_","_RADFN_",")
"RTN","RART1",81,0)
 . Q
"RTN","RART1",82,0)
 Q:$G(X)="P"  G DISP1:$G(X)="T",Q6:$G(X)="^"
"RTN","RART1",83,0)
 I +$O(^RARPT(RARPT,"ERR",0)) W !?10,$$AMENRPT^RARTR2(),!
"RTN","RART1",84,0)
 ;
"RTN","RART1",85,0)
 ; Print the clinical history from file 70
"RTN","RART1",86,0)
 I +$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",0)) D
"RTN","RART1",87,0)
 . K ^UTILITY($J,"W"),^(1) S X="",DIWL=3,DIWF="|WC75"
"RTN","RART1",88,0)
 . W !?3,"Clinical History:"
"RTN","RART1",89,0)
 . S RAP="H" D WRITEHX(RAP)
"RTN","RART1",90,0)
 . Q
"RTN","RART1",91,0)
 Q:$G(X)="P"  G DISP1:$G(X)="T",Q6:$G(X)="^"
"RTN","RART1",92,0)
 ;
"RTN","RART1",93,0)
 ; Print the additional report clinical history if defined and 
"RTN","RART1",94,0)
 ; different than the order clinical history.
"RTN","RART1",95,0)
 I +$O(^RARPT(RARPT,"H",0)) D
"RTN","RART1",96,0)
 . D CHKDUPHX Q:RADUPHX  ; Duplicate history
"RTN","RART1",97,0)
 . K ^UTILITY($J,"W"),^(1) S X="",DIWL=3,DIWF="|WC75"
"RTN","RART1",98,0)
 . W !?3,"Additional Clinical History:"
"RTN","RART1",99,0)
 . S RAP="AH" D WRITEHX(RAP)
"RTN","RART1",100,0)
 ;
"RTN","RART1",101,0)
 ; Print Report and Impression text
"RTN","RART1",102,0)
 F RAP="R","I" D  Q:X="^"!(X="P")!(X="T")
"RTN","RART1",103,0)
 . K ^UTILITY($J,"W"),^(1) S X="",DIWL=3,DIWF="|WC75"
"RTN","RART1",104,0)
 . W !?3,$S(RAP="R":"Report:",1:"Impression:") W:RAP="R" ?45,"Status: ",$$XTERNAL^RAUTL5(RAST,$P($G(^DD(74,5,0)),U,2))
"RTN","RART1",105,0)
 . W:RAP="R"&($E(RAST)="P") $C(7)
"RTN","RART1",106,0)
 . D WRITE
"RTN","RART1",107,0)
 . Q
"RTN","RART1",108,0)
 Q:X="P"  G DISP1:X="T",Q6:X="^"
"RTN","RART1",109,0)
 ; I $$IMAGE^RARIC1() D DISPF^MAGRIC ;don't call MAG 111300
"RTN","RART1",110,0)
 I $P($G(^RA(79.1,+$P(^RADPT(RADFN,"DT",RADTI,0),U,4),0)),U,18)="Y" D PRTDX^RART K RADXCODE
"RTN","RART1",111,0)
 Q:X="P"  G DISP1:X="T",Q6:X="^"
"RTN","RART1",112,0)
 ;
"RTN","RART1",113,0)
 I $D(ORVP) D
"RTN","RART1",114,0)
 .S RAVERF=+$P($G(^RARPT(+RARPT,0)),"^",9)
"RTN","RART1",115,0)
 .S RADFTSBN=$E($P($G(^VA(200,RAVERF,20)),"^",2),1,25)
"RTN","RART1",116,0)
 .S:RADFTSBN']"" RADFTSBN=$E($P($G(^VA(200,RAVERF,0)),"^"),1,25)
"RTN","RART1",117,0)
 .S RADFTSBT=$E($P($G(^VA(200,RAVERF,20)),"^",3),1,30)
"RTN","RART1",118,0)
 .S:RADFTSBT']"" RADFTSBT=$$TITLE^RARTR0(RAVERF)
"RTN","RART1",119,0)
 .W !!,"VERIFIED BY:",!?2,$S(RADFTSBN]"":RADFTSBN,1:"")
"RTN","RART1",120,0)
 .W:RADFTSBT]"" ", "_RADFTSBT
"RTN","RART1",121,0)
 Q:X="P"  G DISP1:X="T",Q6:X="^"
"RTN","RART1",122,0)
 ;
"RTN","RART1",123,0)
 K RAP I '$D(RARTVER) D WAIT Q:X="P"  G DISP1:X="T"
"RTN","RART1",124,0)
Q6 K %,DIC,DIWF,DIWL,DIWR,I,J,OREND,POP,RABTCH,RAF1,RAHEAD,RALOC,RANME,RAPAR,RAPRC,RAREPORT,RASEL,RASSN,RAST,RAV,RAXX,Y,X1,Z
"RTN","RART1",125,0)
 K RAVERF,RADFTSBN,RADFTSBT
"RTN","RART1",126,0)
 K DIW,DIWT,DN
"RTN","RART1",127,0)
 K C,DIPGM,DISYS,R1,RAIMGTYI,RAP
"RTN","RART1",128,0)
 K:'$D(RARTVER) RACN,RACNI,RADATE,RADFN,RADTE,RADTI,RARPT Q
"RTN","RART1",129,0)
 ;
"RTN","RART1",130,0)
WRITE K RAXX N Y
"RTN","RART1",131,0)
 F RAV=0:0 S RAV=$O(^RARPT(RARPT,RAP,RAV)) Q:RAV'>0  D  Q:X="^"!(X="P")!(X="T")
"RTN","RART1",132,0)
 . S RAXX=^RARPT(RARPT,RAP,RAV,0) S X=""
"RTN","RART1",133,0)
 . D WAIT:($Y+6)>IOSL&('$D(RARTVERF)) Q:X="^"!(X="P")!(X="T")
"RTN","RART1",134,0)
 . S X=RAXX D ^DIWP S X=""
"RTN","RART1",135,0)
 . Q
"RTN","RART1",136,0)
 Q:X="^"  D ^DIWW:$D(RAXX) Q
"RTN","RART1",137,0)
 ;
"RTN","RART1",138,0)
WRITEHX(RAP) ; Get and write the clinical history
"RTN","RART1",139,0)
 ;
"RTN","RART1",140,0)
 ;Input:   RAP        H = Clinical History from file 70
"RTN","RART1",141,0)
 ;                   AH = Additional Clinical History from file 74
"RTN","RART1",142,0)
 ;
"RTN","RART1",143,0)
 K RAXX N Y
"RTN","RART1",144,0)
 S RAV=0
"RTN","RART1",145,0)
 I RAP="H" D
"RTN","RART1",146,0)
 . F  S RAV=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",RAV)) Q:RAV'>0  D  Q:X="^"!(X="P")!(X="T")
"RTN","RART1",147,0)
 . . S RAXX=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",RAV,0),X=""
"RTN","RART1",148,0)
 . . D WAIT:($Y+6)>IOSL&('$D(RARTVERF)) Q:X="^"!(X="P")!(X="T")
"RTN","RART1",149,0)
 . . S X=RAXX D ^DIWP S X=""
"RTN","RART1",150,0)
 . . Q
"RTN","RART1",151,0)
 I RAP="AH" D
"RTN","RART1",152,0)
 . F  S RAV=$O(^RARPT(RARPT,"H",RAV)) Q:RAV'>0  D  Q:X="^"!(X="P")!(X="T")
"RTN","RART1",153,0)
 . . S RAXX=^RARPT(RARPT,"H",RAV,0),X=""
"RTN","RART1",154,0)
 . . D WAIT:($Y+6)>IOSL&('$D(RARTVERF)) Q:X="^"!(X="P")!(X="T")
"RTN","RART1",155,0)
 . . S X=RAXX D ^DIWP S X=""
"RTN","RART1",156,0)
 . . Q
"RTN","RART1",157,0)
 Q:X="^"  D ^DIWW:$D(RAXX) Q
"RTN","RART1",158,0)
 ;
"RTN","RART1",159,0)
CHKDUPHX ; Check Duplicate History in file 70 and 74.
"RTN","RART1",160,0)
 ; Returns RADUPHX  1 = Duplicate
"RTN","RART1",161,0)
 ;                  0 = Different
"RTN","RART1",162,0)
 N RAX,RA74,RA70,RAOK,RAX1
"RTN","RART1",163,0)
 ; Initialize to Different
"RTN","RART1",164,0)
 S RADUPHX=0
"RTN","RART1",165,0)
 ; Quit if H node does not exist.  Could have been purged.
"RTN","RART1",166,0)
 I '$D(^RARPT(RARPT,"H")) S RADUPHX=1 Q
"RTN","RART1",167,0)
 S RA74=$O(^RARPT(RARPT,"H",""),-1)
"RTN","RART1",168,0)
 S RA70=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",""),-1),RA701=$O(^(0))
"RTN","RART1",169,0)
 S RAX=RA74-RA70+1 Q:RAX'=1  ; begin comparison
"RTN","RART1",170,0)
 ; Check line by line of each file
"RTN","RART1",171,0)
 ; RAOK  1 = all lines match
"RTN","RART1",172,0)
 ;       0 = at least 1 difference
"RTN","RART1",173,0)
 S RAOK=1
"RTN","RART1",174,0)
 F RAX1=RA701:1:RA70 I ^RARPT(RARPT,"H",RAX1,0)'=^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",RAX1,0) S RAOK=0 Q  ;can exit loop on 1st difference
"RTN","RART1",175,0)
 I 'RAOK Q
"RTN","RART1",176,0)
 S RADUPHX=1
"RTN","RART1",177,0)
 Q
"RTN","RART1",178,0)
 ;
"RTN","RART1",179,0)
WAIT ; user input, goto top, print, or continue
"RTN","RART1",180,0)
 S RARD(1)="Continue^continue normal processing"
"RTN","RART1",181,0)
 S:$D(RALERTS) RARD(2)="Print^print the entire report"
"RTN","RART1",182,0)
 S RARD(3)="Top^display the report from the beginning"
"RTN","RART1",183,0)
 S (RARD("B"),RARD("DTOUT"))=1
"RTN","RART1",184,0)
 S:$D(RALERTS) RARD("A")="Enter 'Top', 'Print'  or 'Continue':   "
"RTN","RART1",185,0)
 S:'$D(RALERTS) RARD("A")="Enter 'Top' or 'Continue':   "
"RTN","RART1",186,0)
 S RARD(0)="S" D SET^RARD K RARD S X=$E(X)
"RTN","RART1",187,0)
 I $D(RALERTS),(X="P") D QRPT^RART3
"RTN","RART1",188,0)
 Q:X="^"!(X="P")  W:X="C"&($D(RAP)) @IOF
"RTN","RART1",189,0)
 Q
"RTN","RART1",190,0)
 ;
"RTN","RART1",191,0)
LOCK(X,Y) ; Lock an entry
"RTN","RART1",192,0)
 W !!,$C(7),"Another user is editing this ",$S(X="R":"report (Case # "_Y_")",1:"exam (diagnostic code)"),".  Please try again later." H 4 Q
"RTN","RART1",193,0)
 ;
"RTN","RART1",194,0)
SETVARS ; Setup Rad/Nuc Med required variables
"RTN","RART1",195,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RART1",196,0)
 Q:'($D(RACCESS(DUZ))\10)
"RTN","RART1",197,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1)
"RTN","RART1",198,0)
 Q
"RTN","RART3")
0^16^B24604076^B23818641
"RTN","RART3",1,0)
RART3 ;HISC/GJC,SWM-Reporting Menu (Part 2) ;05/22/09  09:20
"RTN","RART3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,10,18,27,35,45,75,99**;Mar 16, 1998;Build 5
"RTN","RART3",3,0)
 ; continue from RART1
"RTN","RART3",4,0)
 ; last modif by SS for P18
"RTN","RART3",5,0)
 ; p99 changed the Staff Phys title to Staff Imaging Phys
"RTN","RART3",6,0)
 ;Supported IA #10103 reference to ^XLFDT
"RTN","RART3",7,0)
 ;
"RTN","RART3",8,0)
QRPT ; Queue the report to run
"RTN","RART3",9,0)
 N X K IOP,%ZIS S %ZIS="Q",%ZIS("B")=""
"RTN","RART3",10,0)
 S %ZIS("S")="I $E($P($G(^%ZIS(2,+$P($G(^(""SUBTYPE"")),""^""),0)),""^""),1,2)=""P-"""
"RTN","RART3",11,0)
 W ! D ^%ZIS
"RTN","RART3",12,0)
 I POP D Q6^RART1 Q
"RTN","RART3",13,0)
 I $E(IOST,1,2)="P-",('$D(IO("Q"))) D
"RTN","RART3",14,0)
 . D PRT^RARTR
"RTN","RART3",15,0)
 . Q
"RTN","RART3",16,0)
 I $D(IO("Q")) D
"RTN","RART3",17,0)
 . K RANME,RAPRC,Y S U="^",DT=$S($G(DT)]"":DT,1:$$DT^XLFDT())
"RTN","RART3",18,0)
 . S ZTDESC="Rad/Nuc Med Abnormal Report Alert",ZTRTN="PRT^RARTR"
"RTN","RART3",19,0)
 . S:$D(RARTMES) ZTSAVE("RARTMES")=""
"RTN","RART3",20,0)
 . F I="DT","RARPT","U" S ZTSAVE(I)=""
"RTN","RART3",21,0)
 . D ^%ZTLOAD W:$D(ZTSK) "   Task # ",ZTSK
"RTN","RART3",22,0)
 . K IO("Q"),ZTDESC,ZTRTN,ZTSAVE
"RTN","RART3",23,0)
 . Q
"RTN","RART3",24,0)
 W ! D ^%ZISC,HOME^%ZIS
"RTN","RART3",25,0)
 D Q6^RART1,EXIT^RART
"RTN","RART3",26,0)
 Q
"RTN","RART3",27,0)
PHYS N RA2ND,R1,R2,RASTR
"RTN","RART3",28,0)
 S (R1,R2)=0 F  S R2=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",R2)) Q:'R2  S:+$G(^(R2,0)) R1=R1+1,RA2ND("SRR",R1)=+^(0),RA2ND("SRR",R1)=$E($P($G(^VA(200,RA2ND("SRR",R1),0)),"^"),1,20)
"RTN","RART3",29,0)
 S (R1,R2)=0 F  S R2=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",R2)) Q:'R2  S:+$G(^(R2,0)) R1=R1+1,RA2ND("SSR",R1)=+^(0),RA2ND("SSR",R1)=$E($P($G(^VA(200,RA2ND("SSR",R1),0)),"^"),1,20)
"RTN","RART3",30,0)
 S R1=$E($P($G(^VA(200,+$P(R3,"^",15),0)),"^"),1,15)
"RTN","RART3",31,0)
 S RASTR="Staff Imaging Phys: "_R1 S:R1]"" RASTR=RASTR_" (P)"
"RTN","RART3",32,0)
PHYS1 I '$O(RA2ND("SSR",0)) W !,RASTR G PHYS2
"RTN","RART3",33,0)
 S R1=0
"RTN","RART3",34,0)
PHYS11 S R1=$O(RA2ND("SSR",R1)) G:R1="" PHYS19
"RTN","RART3",35,0)
 I $L(RASTR)+$L(RA2ND("SSR",R1))>79 W !,RASTR,";" S RASTR="   "
"RTN","RART3",36,0)
 S:RASTR]"   " RASTR=RASTR_"; " S RASTR=RASTR_RA2ND("SSR",R1) G PHYS11
"RTN","RART3",37,0)
PHYS19 W:RASTR]"" !,RASTR
"RTN","RART3",38,0)
PHYS2 S R1=$E($P($G(^VA(200,+$P(R3,"^",12),0)),"^"),1,15)
"RTN","RART3",39,0)
 S RASTR="Residents : "_R1 S:R1]"" RASTR=RASTR_" (P)"
"RTN","RART3",40,0)
 I '$O(RA2ND("SRR",0)) W !,RASTR Q
"RTN","RART3",41,0)
 S R1=0
"RTN","RART3",42,0)
PHYS21 S R1=$O(RA2ND("SRR",R1)) G:R1="" PHYS29
"RTN","RART3",43,0)
 I $L(RASTR)+$L(RA2ND("SRR",R1))>79 W !,RASTR,";" S RASTR="   "
"RTN","RART3",44,0)
 S:RASTR]"   " RASTR=RASTR_"; " S RASTR=RASTR_RA2ND("SRR",R1) G PHYS21
"RTN","RART3",45,0)
PHYS29 W:RASTR]"" !,RASTR
"RTN","RART3",46,0)
 Q
"RTN","RART3",47,0)
MODSET ; print modifiers of all cases of print set
"RTN","RART3",48,0)
 N RACDIS,RALDIS,RACNISAV,RAMEMARR,R1
"RTN","RART3",49,0)
 D EN2^RAUTL20(.RAMEMARR) Q:'$O(RAMEMARR(0))
"RTN","RART3",50,0)
 S RACNISAV=RACNI,RACNI=0
"RTN","RART3",51,0)
 D CDIS^RAPROD S (RAREZON,RACNI)=0
"RTN","RART3",52,0)
 ;for printsets print the REASON FOR STUDY along with the lead procedure
"RTN","RART3",53,0)
 ;(avoid duplicate printing of the same data)
"RTN","RART3",54,0)
 F  S RACNI=$O(RAMEMARR(RACNI)) Q:'RACNI  D  Q:$L($G(X))  I $G(RAXIT) S X="^" Q
"RTN","RART3",55,0)
 . S R1=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RART3",56,0)
 . D MODS^RAUTL2
"RTN","RART3",57,0)
 . ; If printing page at a time we need to check the length - RA*5*8
"RTN","RART3",58,0)
 . I $Y>(IOSL-6),'$D(RARTVERF) S RAP="" D WAIT^RART1 I X="^"!(X="P")!(X="T") Q
"RTN","RART3",59,0)
 . K X
"RTN","RART3",60,0)
 . D OUT1 S RAREZON=1
"RTN","RART3",61,0)
 . S:+$P(R1,"^",28) X=$$RDIO1^RARTUTL1(+$P(R1,"^",28))  Q:$L($G(X))
"RTN","RART3",62,0)
 . S:+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) X=$$PHARM1^RARTUTL(RACNI_","_RADTI_","_RADFN_",")
"RTN","RART3",63,0)
 . W:$O(RAMEMARR(RACNI)) !
"RTN","RART3",64,0)
 . Q
"RTN","RART3",65,0)
 S RACNI=RACNISAV
"RTN","RART3",66,0)
 W ! K RAREZON
"RTN","RART3",67,0)
 Q
"RTN","RART3",68,0)
OUT1 ; print Procedure name, CPT code, Procedure modifier, and CPT Modifiers
"RTN","RART3",69,0)
 ; $O(RAMEMARR(0)) may be defined, if previously called MODSET^RART3
"RTN","RART3",70,0)
 ; RALDIS flags long display wanted, comes from certain output options
"RTN","RART3",71,0)
 ; RACDIS(n) exists if case n is to be displayed
"RTN","RART3",72,0)
 ; RACDIS(n) not set for dupl proc+pmod+cptmod so don't display
"RTN","RART3",73,0)
 ; If printset, skip if not long format or case not marked for cond.displ
"RTN","RART3",74,0)
 I $O(RAMEMARR(0)),'$G(RALDIS),'$D(RACDIS(RACNI)) Q
"RTN","RART3",75,0)
 N I,J,RACRF S RACRF=1
"RTN","RART3",76,0)
 N RA18RET S RA18RET=0 ;P18
"RTN","RART3",77,0)
 S R1=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RART3",78,0)
 S RASTUDY=$P($G(^RAO(75.1,+$P(R1,U,11),.1)),U) ;Convey 'Reason for Study' P75
"RTN","RART3",79,0)
 ; Check if cancelled and not part of this report
"RTN","RART3",80,0)
 I $P(^RA(72,+$P(R1,"^",3),0),"^",3)=0,($P(R1,"^",17)="") Q
"RTN","RART3",81,0)
 I $P(^RA(72,+$P(R1,"^",3),0),"^",3)=0 D
"RTN","RART3",82,0)
 .W !,$S($G(RALDIS):"",'$D(RACDIS):"",$G(RACDIS(RACNI))=1:"",1:RACDIS(RACNI)_"x"),?4,$E($P($G(^RAMIS(71,+$P(R1,"^",2),0)),"^"),1,42)_" (cancelled)"
"RTN","RART3",83,0)
 E  W !,$S($G(RALDIS):"",'$D(RACDIS):"",$G(RACDIS(RACNI))=1:"",1:RACDIS(RACNI)_"x"),?4,$P($G(^RAMIS(71,+$P(R1,"^",2),0)),"^")
"RTN","RART3",84,0)
 D PRCCPT^RAPROD ;disp proc. abbr, proc type, & CPT
"RTN","RART3",85,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RART3",86,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RART3",87,0)
 I $L(RACMDATA) D
"RTN","RART3",88,0)
 .W !?5,"Contrast Media :"
"RTN","RART3",89,0)
 .F RAIZ=1:1 Q:$P(RACMDATA,", ",RAIZ)=""  D
"RTN","RART3",90,0)
 ..W ?22,$P(RACMDATA,", ",RAIZ) W:$P(RACMDATA,", ",RAIZ+1)'="" !
"RTN","RART3",91,0)
 ..I '$D(RARTVERF),$Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() S:RAXIT RA18RET=-1 Q:RAXIT  W @IOF W !
"RTN","RART3",92,0)
 ..Q
"RTN","RART3",93,0)
 .K RAIZ
"RTN","RART3",94,0)
 .QUIT
"RTN","RART3",95,0)
 K RACMDATA Q:RA18RET=-1  ;P18
"RTN","RART3",96,0)
 W:Y'="None" !?5,"Proc Modifiers : ",Y
"RTN","RART3",97,0)
 W:Y(1)'="None" !?5,"CPT Modifiers  :"
"RTN","RART3",98,0)
 I Y(1)'="None" S RACRF=0 D
"RTN","RART3",99,0)
 .F I=1:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) W ?22,$P(J,"^",2)," ",$P(J,"^",3) W:$P(Y(2),", ",I+1)]"" ! I '$D(RARTVERF),$Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() S:RAXIT RA18RET=-1 Q:RAXIT  W @IOF W !
"RTN","RART3",100,0)
 Q:RA18RET=-1
"RTN","RART3",101,0)
 I $L(RASTUDY),$G(RAREZON,0)=0 W:RACRF ! S RACRF=0 D DIWP^RAUTL5(5,68,"Reason for Study: "_RASTUDY) ;P75
"RTN","RART3",102,0)
 K RASTUDY
"RTN","RART3",103,0)
 ;RATECHCO is defined in OPTION FILE's  ENTRY/EXIT ACTION
"RTN","RART3",104,0)
 I $D(RATECHCO) W:RACRF ! S RA18RET=$$PUTTCOM^RAUTL11(RADFN,RADTI,RACNI,"     Tech.Comment   : ",22,70,7,0,0,2,0) S:RA18RET=-1 RAXIT=1 Q:RA18RET=-1  ;P18
"RTN","RART3",105,0)
 Q
"RTN","RARTE")
0^11^B36165154^B30875065
"RTN","RARTE",1,0)
RARTE ;HISC/FPT,GJC AISC/MJK,RMO-Edit/Delete Reports ;05/22/09  10:20
"RTN","RARTE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,34,45,56,99**;Mar 16, 1998;Build 5
"RTN","RARTE",3,0)
 ;Supported IA #3544 ^VA(200,"ARC"
"RTN","RARTE",4,0)
 ;Supported IA #10076 ^XUSEC(
"RTN","RARTE",5,0)
 ;Supported IA #2056 ^GET1^DIQ
"RTN","RARTE",6,0)
 ;Supported IA #10009 YN^DICN
"RTN","RARTE",7,0)
 ; last modification by SS for P18 June 14,2000
"RTN","RARTE",8,0)
 ;
"RTN","RARTE",9,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE",10,0)
 W !!?3,"Note: To enter receipt of OUTSIDE INTERPRETED REPORTS,",!?3,"please use the 'Outside Report/Entry Edit' option.",!
"RTN","RARTE",11,0)
 N RAXIT,RADRS,RASUBY0 S RAXIT=0 ;RADRS=copy (1=diag, 2=resid,staff)
"RTN","RARTE",12,0)
 I $D(RANOSCRN) S X=$$DIVLOC^RAUTL7() I X D Q^RARTE4 QUIT
"RTN","RARTE",13,0)
 ;
"RTN","RARTE",14,0)
 ;1. DO NOT KILL the RASIG variable; the RASIG() array is needed in
"RTN","RARTE",15,0)
 ;   the edit template [RA REPORT EDIT] later
"RTN","RARTE",16,0)
 ;2. The RAELESIG canNOT store file 74's ien, as no rpt has been picked
"RTN","RARTE",17,0)
 ;   from this call to ES^RASIGU
"RTN","RARTE",18,0)
 ;
"RTN","RARTE",19,0)
 I $D(^XUSEC("RA VERIFY",DUZ)),($$GET1^DIQ(200,DUZ_",",20.4)]""),($D(^VA(200,"ARC","R",DUZ))!($D(^VA(200,"ARC","S",DUZ)))) D  Q:'$D(RAELESIG)
"RTN","RARTE",20,0)
 . W ! D ES^RASIGU S:%=1 RAELESIG=""
"RTN","RARTE",21,0)
 . K:'$D(RAELESIG) %,%W,%Y,%Y1,C,X,X1,X2
"RTN","RARTE",22,0)
 . Q
"RTN","RARTE",23,0)
 K RABTCH I $P(RAMDV,"^",13) D ASKBTCH^RARTE1 G Q1^RARTE4:X["^" D 1^RABTCH:"Yy"[$E(X) I '$D(RABTCH) W " ...no batch selected",!
"RTN","RARTE",24,0)
START K RAVER S RAVW="",RAREPORT=1 D ^RACNLU G Q^RARTE4:"^"[X
"RTN","RARTE",25,0)
 S RASUBY0=Y(0) ; save value of y(0)
"RTN","RARTE",26,0)
 G:$P(^RA(72,+RAST,0),"^",3)>0 DISPLAY
"RTN","RARTE",27,0)
 I $D(^XUSEC("RA MGR",DUZ)) G DISPLAY
"RTN","RARTE",28,0)
 G:$P(RAMDV,"^",22)=1 DISPLAY
"RTN","RARTE",29,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!! D INCRPT^RARTE4 G START
"RTN","RARTE",30,0)
 ;
"RTN","RARTE",31,0)
DISPLAY ; Display exam specific info, edit/enter the report
"RTN","RARTE",32,0)
 N RA18EX S RA18EX=0 ;P18 for quit if uparrow inside PUTTCOM
"RTN","RARTE",33,0)
 I '($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))#2) D  D Q^RARTE4 QUIT
"RTN","RARTE",34,0)
 . W !!?2,"Case #: ",RACN," for ",RANME S RAXIT=1
"RTN","RARTE",35,0)
 . W !?2,"Procedure: '",$E(RAPRC,1,45),"' has been deleted"
"RTN","RARTE",36,0)
 . W !?2,"by another user!",$C(7)
"RTN","RARTE",37,0)
 . Q
"RTN","RARTE",38,0)
 ;Lock case node so no one else can edit rpt pointer during this session
"RTN","RARTE",39,0)
 S RAPNODE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE",40,0)
 S RAXIT=$$LOCK^RAUTL12(RAPNODE,RACNI) I RAXIT D INCRPT^RARTE4 G START
"RTN","RARTE",41,0)
 S RAI="",$P(RAI,"-",80)="" W !,RAI
"RTN","RARTE",42,0)
 W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN
"RTN","RARTE",43,0)
 W !?1,"Case No. : ",RACN,?18,"Exm. St: ",$E($P($G(^RA(72,+RAST,0)),"^"),1,12),?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RARTE",44,0)
        ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTE",45,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTE",46,0)
 D:$L(RACMDATA) CMEDIA(RACMDATA)
"RTN","RARTE",47,0)
 K RACMDATA
"RTN","RARTE",48,0)
 S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,RACN," Tech.Comment: ",15,70,-1,0) ;P18
"RTN","RARTE",49,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE",50,0)
 N RAPRTSET,RAMEMARR,RA1
"RTN","RARTE",51,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RARTE",52,0)
 I RAPRTSET D
"RTN","RARTE",53,0)
 . S RA1=""
"RTN","RARTE",54,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""!(RA18EX=-1)  I RA1'=RACNI D
"RTN","RARTE",55,0)
 .. W !,?1,"Case No. : ",+RAMEMARR(RA1)
"RTN","RARTE",56,0)
 .. W:$P(RAMEMARR(RA1),"^",4)]"" ?18,"Exm. St: ",$E($P($G(^RA(72,$P(RAMEMARR(RA1),"^",4),0)),"^"),1,12)
"RTN","RARTE",57,0)
 .. W ?40,"Procedure   : ",$E($P($G(^RAMIS(71,+$P(RAMEMARR(RA1),"^",2),0)),"^"),1,26)
"RTN","RARTE",58,0)
 ..;check printset for contrast media; display if CM data exists
"RTN","RARTE",59,0)
 ..S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RA1)
"RTN","RARTE",60,0)
 ..D:$L(RACMDATA) CMEDIA(RACMDATA)
"RTN","RARTE",61,0)
 ..K RACMDATA
"RTN","RARTE",62,0)
 .. S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,+RAMEMARR(RA1)," Tech.Comment: ",15,70,-1,0) Q:RA18EX=-1  ;P18
"RTN","RARTE",63,0)
 .. Q
"RTN","RARTE",64,0)
 . Q
"RTN","RARTE",65,0)
SS1 I RA18EX=-1 Q  ;P18
"RTN","RARTE",66,0)
 W !?1,"Exam Date: ",RADATE,?40,"Technologist: " I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0))>0,$D(^VA(200,+^($O(^(0)),0),0)) W $E($P(^(0),"^"),1,25)
"RTN","RARTE",67,0)
 W !?1,"Req Phys    : ",$E($S($D(^VA(200,+$P(Y(0),"^",14),0)):$P(^(0),"^"),1:""),1,25)
"RTN","RARTE",68,0)
 ; p99: get pt sex and display pregnancy data
"RTN","RARTE",69,0)
 I $$PTSEX^RAUTL8(RADFN)="F" D
"RTN","RARTE",70,0)
 .N RA3,RAPCOMM S RA3=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTE",71,0)
 .S RAPCOMM=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PCOMM"))
"RTN","RARTE",72,0)
 .W:$P(RA3,U,32)'="" !?1,"Pregnancy Screen: ",$S($P(RA3,"^",32)="y":"Patient answered yes",$P(RA3,"^",32)="n":"Patient answered no",$P(RA3,"^",32)="u":"Patient is unable to answer or is unsure",1:"")
"RTN","RARTE",73,0)
 .W:$P(RA3,U,32)'="n"&$L(RAPCOMM) !?1,"Pregnancy Screen Comment: ",RAPCOMM
"RTN","RARTE",74,0)
 S Y(0)=RASUBY0
"RTN","RARTE",75,0)
 W !,RAI
"RTN","RARTE",76,0)
 ;end p99
"RTN","RARTE",77,0)
 I $D(^RARPT(+RARPT,0)) S RA1=$P(^(0),"^",5) I "^V^EF^"[("^"_RA1_"^") W !?3,$C(7),"Report has already been ",$S(RA1="V":"verified",1:"electronically filed"),! D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",78,0)
 ;Create new rpt, or skip to IN to edit existing report
"RTN","RARTE",79,0)
 G IN^RARTE4:$D(^RARPT(+RARPT,0))
"RTN","RARTE",80,0)
 G:'RAPRTSET NEW G:$P(^RA(72,+RAST,0),"^",3)>0 NEW
"RTN","RARTE",81,0)
 ; case is part of a print set, AND is cancelled
"RTN","RARTE",82,0)
 N RA2 S (RA1,RA2)=""
"RTN","RARTE",83,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S:$P(RAMEMARR(RA1),"^",3)]"" RA2=$P(RAMEMARR(RA1),"^",3)
"RTN","RARTE",84,0)
 G:RA2="" NEW
"RTN","RARTE",85,0)
 W !!,$C(7),"Other cases of this cancelled case ",RACN,"'s print set are entered in a report already",!!,"You may NOT create a new report for this cancelled case,",!,"but you may include this cancelled case in the existing report."
"RTN","RARTE",86,0)
 W !!,"Do you want to include this cancelled case in the same report",!,"as the others in the print set ?"
"RTN","RARTE",87,0)
 S %=2 D YN^DICN
"RTN","RARTE",88,0)
 W:%>0 "...",$S(%=1:"Include",1:"Skip")," this case"
"RTN","RARTE",89,0)
 I %=1 S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)=RA2,RARPT=RA2,RARPTN=$P(^RARPT(RARPT,0),"^"),RA1=RACN D INSERT^RARTE2
"RTN","RARTE",90,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",91,0)
NEW G:'RAPRTSET NEW1
"RTN","RARTE",92,0)
 L +^RADPT(RADFN,"DT",RADTI):0 G:$T NEW1
"RTN","RARTE",93,0)
 W !!?10,$C(7),"** This case belongs to a printset,",?68,"**",!?10,"** and someone else is currently doing REPORT ENTRY/EDIT",?68,"**"
"RTN","RARTE",94,0)
 W !?10,"** on another case for this same printset,",?68,"**",!?10,"** so you may not enter a new report.",?68,"**"
"RTN","RARTE",95,0)
 H 2 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",96,0)
NEW1 S RARPTN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN
"RTN","RARTE",97,0)
 W !?3,"...report not entered for this exam...",!?10,"...will now initialize report entry..."
"RTN","RARTE",98,0)
 S I=+$P(^RARPT(0),"^",3)
"RTN","RARTE",99,0)
 G LOCK^RARTE4
"RTN","RARTE",100,0)
 Q
"RTN","RARTE",101,0)
 ;
"RTN","RARTE",102,0)
CMEDIA(X) ;check if contrast media is associated with the report (exam)
"RTN","RARTE",103,0)
 ;variables assumed to exist X: the string of contrast media used
"RTN","RARTE",104,0)
 ;delimited by the comma.
"RTN","RARTE",105,0)
 N Y W !," Contrast :"
"RTN","RARTE",106,0)
 F Y=1:1 Q:$P(X,", ",Y)=""  W ?12,$P(X,", ",Y) W:$P(X,", ",Y+1)'="" !
"RTN","RARTE",107,0)
 Q
"RTN","RARTE6")
0^12^B115912861^B105675673
"RTN","RARTE6",1,0)
RARTE6 ;HISC/SM Restore deleted report ;06/23/09 14:08
"RTN","RARTE6",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**56,95,99**;Mar 16, 1998;Build 5
"RTN","RARTE6",3,0)
 ;Supported IA #10060 ^VA(200
"RTN","RARTE6",4,0)
 ;Supported IA #2053 FILE^DIE, UPDATE^DIE
"RTN","RARTE6",5,0)
 ;Supported IA #2052 GET1^DID
"RTN","RARTE6",6,0)
 ;Supported IA #2056 GET1^DIQ
"RTN","RARTE6",7,0)
 ;Supported IA #10103 NOW^XLFDT
"RTN","RARTE6",8,0)
 ;Supported IA #2055 ROOT^DILFD
"RTN","RARTE6",9,0)
 ;Supported IA #10060 GETS^DIQ
"RTN","RARTE6",10,0)
 ;P99, added pregnancy screen and pregnancy screen comment
"RTN","RARTE6",11,0)
 Q
"RTN","RARTE6",12,0)
RSTR ;restore deleted report
"RTN","RARTE6",13,0)
 F I=1:1:5 W !?4,$P($T(INTRO+I),";;",2)
"RTN","RARTE6",14,0)
 W !
"RTN","RARTE6",15,0)
 S RAXIT=0 ; =0 exit normally, =1 exit early
"RTN","RARTE6",16,0)
 I '$D(^XUSEC("RA MGR",DUZ)) W !!,"Supervisory key RA MGR is needed for this option." Q
"RTN","RARTE6",17,0)
 S DIC("S")="I $P(^(0),""^"",5)=""X""" ;only select deleted reports
"RTN","RARTE6",18,0)
 S DIC("A")="Select Deleted Report to restore: "
"RTN","RARTE6",19,0)
 S DIC="^RARPT(",DIC(0)="AEMQZ"
"RTN","RARTE6",20,0)
 D DICW^RARTST1,^DIC K DIC I Y<0 G FINISH
"RTN","RARTE6",21,0)
 S RARPT=+Y
"RTN","RARTE6",22,0)
 W !
"RTN","RARTE6",23,0)
 D CHECK G:RAXIT NOTDONE ;check if case has rpt & DX codes
"RTN","RARTE6",24,0)
 D ASK1 G:RAXIT NOTDONE ;ask if want restore deleted report
"RTN","RARTE6",25,0)
 D ASSOC G:RAXIT NOTDONE ;display associated case(s) & ask user again if want continue
"RTN","RARTE6",26,0)
 D RESTORE ;restore rpt status, link rpt to case(s)
"RTN","RARTE6",27,0)
 D FINISH
"RTN","RARTE6",28,0)
 Q
"RTN","RARTE6",29,0)
CHECK ; check if associated case(s) has rpt and DX codes
"RTN","RARTE6",30,0)
 S RA74=^RARPT(RARPT,0)
"RTN","RARTE6",31,0)
 S RADFN=+$P(RA74,U,2),RADTI=9999999.9999-$P(RA74,U,3),RACN=+$P($P(RA74,U,1),"-",2)
"RTN","RARTE6",32,0)
 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0))
"RTN","RARTE6",33,0)
 S RA70=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTE6",34,0)
 I 'RADFN!('RADTI)!('RACNI)!(RA70="") D ERR0 Q
"RTN","RARTE6",35,0)
 S RANME=$$GET1^DIQ(2,RADFN,.01),RAST=+$P(RA70,U,3)
"RTN","RARTE6",36,0)
 S RAPRC=$S($D(^RAMIS(71,+$P(RA70,U,2),0)):$P(^(0),U),1:"Unknown")
"RTN","RARTE6",37,0)
 S RASSN=$$SSN^RAUTL,RASUBY0=RA70
"RTN","RARTE6",38,0)
 S RANODE=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RARTE6",39,0)
 ; check if case(s) already have a report
"RTN","RARTE6",40,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RARTE6",41,0)
 I RAPRTSET D
"RTN","RARTE6",42,0)
 .S RA1=0
"RTN","RARTE6",43,0)
 .F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE6",44,0)
 ..I $P(^RADPT(RADFN,"DT",RADTI,"P",RA1,0),U,17)'="" D ERR3(+RAMEMARR(RA1))
"RTN","RARTE6",45,0)
 ..Q
"RTN","RARTE6",46,0)
 .Q
"RTN","RARTE6",47,0)
 E  I $P(RA70,U,17) D ERR3(RACN) Q
"RTN","RARTE6",48,0)
 ; check if case(s) already have DX codes, staff, resident
"RTN","RARTE6",49,0)
 ; don't use IF ELSE here due to outside calls
"RTN","RARTE6",50,0)
 ;
"RTN","RARTE6",51,0)
 ; Printset cases
"RTN","RARTE6",52,0)
 I RAPRTSET D  Q
"RTN","RARTE6",53,0)
 .S RA1=0
"RTN","RARTE6",54,0)
 .F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE6",55,0)
 ..; check primary
"RTN","RARTE6",56,0)
 ..F RA2=13,15,12 I $P(^RADPT(RADFN,"DT",RADTI,"P",RA1,0),U,RA2)'="" D ERR2(+RAMEMARR(RA1),70.03,RA2)
"RTN","RARTE6",57,0)
 ..; check secondary
"RTN","RARTE6",58,0)
 ..S RAIENS=1_","_RA1_","_RADTI_","_RADFN_","
"RTN","RARTE6",59,0)
 ..F RA2=70.14,70.11,70.09 S RAROOT=$$ROOT^DILFD(RA2,RAIENS) I $O(@(RAROOT_"0)")) D ERR2(+RAMEMARR(RA1),RA2,.01)
"RTN","RARTE6",60,0)
 ..Q
"RTN","RARTE6",61,0)
 .Q
"RTN","RARTE6",62,0)
 ; single case
"RTN","RARTE6",63,0)
 F RA2=13,15,12 I $P(RA70,U,RA2) D ERR2(RACN,70.03,RA2)
"RTN","RARTE6",64,0)
 S RAIENS=1_","_RACNI_","_RADTI_","_RADFN_","
"RTN","RARTE6",65,0)
 F RA2=70.14,70.11,70.09 S RAROOT=$$ROOT^DILFD(RA2,RAIENS) I $O(@(RAROOT_"0)")) D ERR2(RACN,RA2,.01)
"RTN","RARTE6",66,0)
 Q
"RTN","RARTE6",67,0)
ASK1 ; ask if want to restore report
"RTN","RARTE6",68,0)
 ; RAPRVIEN  last Activity Log rec in subfile 74.01
"RTN","RARTE6",69,0)
 ; RAPRVST   previous report status logged in latest activity log rec
"RTN","RARTE6",70,0)
 ; RALAST    last activity log record
"RTN","RARTE6",71,0)
 S RAPRVIEN=$O(^RARPT(RARPT,"L",""),-1)
"RTN","RARTE6",72,0)
 I 'RAPRVIEN D ERR1 Q
"RTN","RARTE6",73,0)
 S RALAST=$G(^RARPT(RARPT,"L",+RAPRVIEN,0))
"RTN","RARTE6",74,0)
 I RALAST="" D ERR1 Q
"RTN","RARTE6",75,0)
 S RAPRVST=$P(RALAST,U,4) ;previous rpt status
"RTN","RARTE6",76,0)
 K DIR
"RTN","RARTE6",77,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RARTE6",78,0)
 S DIR("A")="Do you want to restore this deleted report"
"RTN","RARTE6",79,0)
 S DIR("?")="Answer ""Y"" to assign the previous report status, "_$$GET1^DIQ(74.01,RAPRVIEN_","_RARPT_",",4)_", to this report."
"RTN","RARTE6",80,0)
 D ^DIR K DIR
"RTN","RARTE6",81,0)
 S:$D(DIRUT) RAXIT=1
"RTN","RARTE6",82,0)
 S:'Y RAXIT=1
"RTN","RARTE6",83,0)
 Q
"RTN","RARTE6",84,0)
ASSOC ;
"RTN","RARTE6",85,0)
 ; list case(s) for this report
"RTN","RARTE6",86,0)
 S (Y,RADTE)=+$P(RANODE,U)
"RTN","RARTE6",87,0)
 D D^RAUTL S RADATE=Y
"RTN","RARTE6",88,0)
 D DISPLAY
"RTN","RARTE6",89,0)
 W !
"RTN","RARTE6",90,0)
 K DIR
"RTN","RARTE6",91,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RARTE6",92,0)
 S DIR("A")="Are you sure you want to link this report back to the case"_$S(RAPRTSET:"s",1:"")
"RTN","RARTE6",93,0)
 S DIR("?")="Answer ""Y"" to link this report back to the case(s) shown above."
"RTN","RARTE6",94,0)
 D ^DIR K DIR
"RTN","RARTE6",95,0)
 S:$D(DIRUT) RAXIT=1
"RTN","RARTE6",96,0)
 S:'Y RAXIT=1
"RTN","RARTE6",97,0)
 Q
"RTN","RARTE6",98,0)
RESTORE ; set Report Status to "before delete" value, link to case(s)
"RTN","RARTE6",99,0)
 D SETFF(74,5,RARPT,RAPRVST)
"RTN","RARTE6",100,0)
 W !!?3,"... Restored ",$P(RA74,U,1),"'s report status to: ",$$GET1^DIQ(74,+RARPT,5),"."
"RTN","RARTE6",101,0)
 ;
"RTN","RARTE6",102,0)
 ; set activity log record
"RTN","RARTE6",103,0)
 S RAIENL="+1,"_RARPT_","
"RTN","RARTE6",104,0)
 D SETALOG(RAIENL,"R","")
"RTN","RARTE6",105,0)
 ;
"RTN","RARTE6",106,0)
 ; link report to single case or all cases of a printset
"RTN","RARTE6",107,0)
 I RAPRTSET D
"RTN","RARTE6",108,0)
 . S RA1=""
"RTN","RARTE6",109,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S $P(^RADPT(RADFN,"DT",RADTI,"P",RA1,0),U,17)=RARPT D MSG1(+RAMEMARR(RA1))
"RTN","RARTE6",110,0)
 .Q
"RTN","RARTE6",111,0)
 E  S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,17)=RARPT D MSG1(RACN)
"RTN","RARTE6",112,0)
 ;
"RTN","RARTE6",113,0)
 ;Restore Primary and Secondary DX codes, Staff and Residents
"RTN","RARTE6",114,0)
 F RAFLD=5,7,9 S RAPREV=$P(RALAST,U,RAFLD) D:RAPREV SET70(RAFLD)
"RTN","RARTE6",115,0)
 W !!!?3,"** You need to edit the case"_$S(RAPRTSET:"s",1:"")_" to update the exam status. **"
"RTN","RARTE6",116,0)
 Q
"RTN","RARTE6",117,0)
SET70(X) ; put back previous DX codes, Staff, Residents into case record
"RTN","RARTE6",118,0)
 ; assumes if no primary then no secondaries
"RTN","RARTE6",119,0)
 K RAFDA,RAA
"RTN","RARTE6",120,0)
 N RA1
"RTN","RARTE6",121,0)
 S RAIENS=1_","_RAPRVIEN_","_RARPT_","
"RTN","RARTE6",122,0)
 ;
"RTN","RARTE6",123,0)
 ; X is the field number from subfile 74.01:
"RTN","RARTE6",124,0)
 ; 5 = BEFORE DELETION PRIM. DX CODE
"RTN","RARTE6",125,0)
 ; 7 = BEFORE DELETION PRIM. STAFF
"RTN","RARTE6",126,0)
 ; 9 = BEFORE DELETION PRIM. RESIDENT
"RTN","RARTE6",127,0)
 ;
"RTN","RARTE6",128,0)
 ; RAF1 = subfile number from file 74's activity log
"RTN","RARTE6",129,0)
 ; RAF2 = subfile number from file 70's secondaries
"RTN","RARTE6",130,0)
 ; RAF3 = subfile number pointed to from file 70's secondaries
"RTN","RARTE6",131,0)
 ; RAPIECE = piece in 70.03's 0 node
"RTN","RARTE6",132,0)
 S RAF1=$S(X=5:74.16,X=7:74.18,X=9:74.19,1:"") Q:RAF1=""
"RTN","RARTE6",133,0)
 S RAF2=$S(X=5:70.14,X=7:70.11,X=9:70.09,1:"") Q:RAF2=""
"RTN","RARTE6",134,0)
 S RAF3=$$GET1^DID(RAF2,.01,"","POINTER")
"RTN","RARTE6",135,0)
 ; extract file number from RAF3
"RTN","RARTE6",136,0)
 S RAF3=$TR(RAF3,$TR(RAF3,"0123456789."))
"RTN","RARTE6",137,0)
 ;piece number for Primary DX/Staff/Resident in 70.03
"RTN","RARTE6",138,0)
 S RAPIECE=$S(X=5:13,X=7:15,X=9:12,1:"") Q:RAPIECE=""
"RTN","RARTE6",139,0)
 S RAROOT=$$ROOT^DILFD(RAF1,RAIENS,1) ;closed root under file 74's Activity Log
"RTN","RARTE6",140,0)
 ;copy secondaries into RAA()
"RTN","RARTE6",141,0)
 M RAA=@RAROOT
"RTN","RARTE6",142,0)
 ;
"RTN","RARTE6",143,0)
 G:RAPRTSET PSET
"RTN","RARTE6",144,0)
 ;
"RTN","RARTE6",145,0)
 ; single case
"RTN","RARTE6",146,0)
 ;
"RTN","RARTE6",147,0)
 ; copy Primary into single case
"RTN","RARTE6",148,0)
 S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",RAPIECE)=RAPREV
"RTN","RARTE6",149,0)
 D FILE^DIE("","RAFDA","RAMSG")
"RTN","RARTE6",150,0)
 I $D(RAMSG("DIERR")) D ERR4(RACN,$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",151,0)
 E  D MSG2(RACN,$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",152,0)
 K RAFDA,RAMSG
"RTN","RARTE6",153,0)
 ;
"RTN","RARTE6",154,0)
 Q:$O(RAA(0))'>0  ; no secondaries
"RTN","RARTE6",155,0)
 ;
"RTN","RARTE6",156,0)
 ;copy secondary items into single case
"RTN","RARTE6",157,0)
 S RA1=0
"RTN","RARTE6",158,0)
 F  S RA1=$O(RAA(RA1)) Q:'RA1  S RAX=$G(RAA(RA1,0)) D:RAX
"RTN","RARTE6",159,0)
 .S RAFDA(RAF2,"+2,"_RACNI_","_RADTI_","_RADFN_",",.01)=RAX
"RTN","RARTE6",160,0)
 .D UPDATE^DIE(,"RAFDA",,"RAMSG")
"RTN","RARTE6",161,0)
 .I $D(RAMSG("DIERR")) D ERR4(RACN,$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",162,0)
 .E  D MSG2(RACN,$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",163,0)
 .K RAFDA,RAMSG
"RTN","RARTE6",164,0)
 .Q
"RTN","RARTE6",165,0)
 Q
"RTN","RARTE6",166,0)
 ;
"RTN","RARTE6",167,0)
 ; cases from printset
"RTN","RARTE6",168,0)
 ;
"RTN","RARTE6",169,0)
PSET ; copy Primary into cases of a printset
"RTN","RARTE6",170,0)
 S RA1=0
"RTN","RARTE6",171,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  D
"RTN","RARTE6",172,0)
 .S RAFDA(70.03,RA1_","_RADTI_","_RADFN_",",RAPIECE)=RAPREV
"RTN","RARTE6",173,0)
 .D FILE^DIE("","RAFDA","RAMSG")
"RTN","RARTE6",174,0)
 .I $D(RAMSG("DIERR")) D ERR4(+RAMEMARR(RA1),$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",175,0)
 .E  D MSG2(+RAMEMARR(RA1),$$GET1^DID(70.03,RAPIECE,"","LABEL"),$$GET1^DIQ(RAF3,RAPREV,.01))
"RTN","RARTE6",176,0)
 .K RAFDA,RAMSG
"RTN","RARTE6",177,0)
 .Q:$O(RAA(0))'>0  ; no secondary DXs
"RTN","RARTE6",178,0)
 .; copy secondaries into cases of a printset
"RTN","RARTE6",179,0)
 .S RA2=0
"RTN","RARTE6",180,0)
 .F  S RA2=$O(RAA(RA2)) Q:'RA2  S RAX=$G(RAA(RA2,0)) D:RAX
"RTN","RARTE6",181,0)
 ..S RAFDA(RAF2,"+2,"_RA1_","_RADTI_","_RADFN_",",.01)=RAX
"RTN","RARTE6",182,0)
 ..D UPDATE^DIE(,"RAFDA",,"RAMSG")
"RTN","RARTE6",183,0)
 ..I $D(RAMSG("DIERR")) D ERR4(+RAMEMARR(RA1),$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",184,0)
 ..E  D MSG2(+RAMEMARR(RA1),$$GET1^DID(RAF2,.01,"","LABEL"),$$GET1^DIQ(RAF3,RAX,.01))
"RTN","RARTE6",185,0)
 ..K RAFDA,RAMSG
"RTN","RARTE6",186,0)
 ..Q
"RTN","RARTE6",187,0)
 .Q
"RTN","RARTE6",188,0)
 Q
"RTN","RARTE6",189,0)
SETFF(RA1,RA2,RA3,RA4,RA5) ;reset file's field value
"RTN","RARTE6",190,0)
 ;RA1 file number
"RTN","RARTE6",191,0)
 ;RA2 field number
"RTN","RARTE6",192,0)
 ;RA3 IEN in file
"RTN","RARTE6",193,0)
 ;RA4 field value to set in record IEN
"RTN","RARTE6",194,0)
 ;RA5 (optional), set to "E" for external
"RTN","RARTE6",195,0)
 N RAFDA
"RTN","RARTE6",196,0)
 S RAFDA(RA1,RA3_",",RA2)=RA4
"RTN","RARTE6",197,0)
 I $G(RA5)="E" D FILE^DIE("E","RAFDA")
"RTN","RARTE6",198,0)
 E  D FILE^DIE("","RAFDA")
"RTN","RARTE6",199,0)
 Q
"RTN","RARTE6",200,0)
SETALOG(RA1,RA2,RA3) ;set new record in Activity log 74.01
"RTN","RARTE6",201,0)
 ;RA1  ien string, eg., "+1,"_RARPT_","
"RTN","RARTE6",202,0)
 ;RA2  type of action
"RTN","RARTE6",203,0)
 ;RA3  current report status code
"RTN","RARTE6",204,0)
 ;
"RTN","RARTE6",205,0)
 N RAFDA
"RTN","RARTE6",206,0)
 S RAFDA(74.01,RA1,.01)=+$E($$NOW^XLFDT(),1,12)
"RTN","RARTE6",207,0)
 S RAFDA(74.01,RA1,2)=RA2
"RTN","RARTE6",208,0)
 S RAFDA(74.01,RA1,3)=$G(DUZ)
"RTN","RARTE6",209,0)
 S:$G(RA3)]"" RAFDA(74.01,RA1,4)=RA3 ;only del rpt would have data here
"RTN","RARTE6",210,0)
 D UPDATE^DIE(,"RAFDA")
"RTN","RARTE6",211,0)
 Q
"RTN","RARTE6",212,0)
MSG1(X) ;
"RTN","RARTE6",213,0)
 W !?3,"... Linked restored report to case no. ",X
"RTN","RARTE6",214,0)
 Q
"RTN","RARTE6",215,0)
MSG2(X,Y,Z) ;
"RTN","RARTE6",216,0)
 W !?3,"... Restored case ",X,"'s ",Y," to: ",Z
"RTN","RARTE6",217,0)
 Q
"RTN","RARTE6",218,0)
ERR0 ;
"RTN","RARTE6",219,0)
 W !,"Unable to determine case previously associated with this report."
"RTN","RARTE6",220,0)
 S RAXIT=1
"RTN","RARTE6",221,0)
 Q
"RTN","RARTE6",222,0)
ERR1 W !!,"Cannot determine previous report status.",!
"RTN","RARTE6",223,0)
 S RAXIT=1
"RTN","RARTE6",224,0)
 Q
"RTN","RARTE6",225,0)
ERR2(X,Y,Z) ;X=External short case No, Y=File no., Z=Field no.
"RTN","RARTE6",226,0)
 W !,"Case #",X," already has ",$$GET1^DID(Y,Z,"","LABEL")
"RTN","RARTE6",227,0)
 S RAXIT=1
"RTN","RARTE6",228,0)
 Q
"RTN","RARTE6",229,0)
ERR3(X) ;
"RTN","RARTE6",230,0)
 W !,"Case #",X," is already associated with a report!"
"RTN","RARTE6",231,0)
 S RAXIT=1
"RTN","RARTE6",232,0)
 Q
"RTN","RARTE6",233,0)
ERR4(X,Y,Z) ;
"RTN","RARTE6",234,0)
 W !!?3,"Cannot restore case ",X,"'s ",Y," to: ",Z
"RTN","RARTE6",235,0)
 Q
"RTN","RARTE6",236,0)
NOTDONE ;
"RTN","RARTE6",237,0)
 W !!?3,"Restoration was not done."
"RTN","RARTE6",238,0)
 ; continue to clean up
"RTN","RARTE6",239,0)
FINISH ; clean up and exit
"RTN","RARTE6",240,0)
 R !!!,"Press RETURN to exit. ",X:DTIME
"RTN","RARTE6",241,0)
 K DIRUT,I
"RTN","RARTE6",242,0)
 K RA1,RA2,RA3,RA4,RA5,RA18EX,RA70,RA74,RAA,RACMDATA
"RTN","RARTE6",243,0)
 K RACN,RACNI,RADATE,RADFN,RADTE,RADTI,RADUZ,RAFDA,RAF1,RAF2,RAF3
"RTN","RARTE6",244,0)
 K RAI,RAIENL,RAIENS,RAIENSUB,RALAST,RALCKFLG,RAMEMARR,RANME,RANODE
"RTN","RARTE6",245,0)
 K RAOUT,RAPIECE,RAPRC,RAPRTSET,RAPRVIEN,RAPREV,RAPRVST,RAROOT,RARPT
"RTN","RARTE6",246,0)
 K RASSN,RAST,RASUB70,RASUBY0,RAX,RAXIT,X,XY,Y,Z
"RTN","RARTE6",247,0)
 Q
"RTN","RARTE6",248,0)
DISPLAY ; Display exam specific info, edit/enter the report
"RTN","RARTE6",249,0)
 ; adapted from routine RARTE
"RTN","RARTE6",250,0)
 S RA18EX=0 ;P18 for quit if uparrow inside PUTTCOM
"RTN","RARTE6",251,0)
 I '($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))#2) D  D Q1^RARTE5 QUIT
"RTN","RARTE6",252,0)
 . W !!?2,"Case #: ",RACN," for ",RANME S RAXIT=1
"RTN","RARTE6",253,0)
 . W !?2,"Procedure: '",$E(RAPRC,1,45),"' has been deleted"
"RTN","RARTE6",254,0)
 . W !?2,"by another user!",$C(7)
"RTN","RARTE6",255,0)
 . Q
"RTN","RARTE6",256,0)
 ;
"RTN","RARTE6",257,0)
 S RAI="",$P(RAI,"-",80)="" W !,RAI
"RTN","RARTE6",258,0)
 W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN
"RTN","RARTE6",259,0)
 W !?1,"Case No. : ",RACN,?18,"Exm. St: ",$E($P($G(^RA(72,+RAST,0)),"^"),1,12),?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RARTE6",260,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTE6",261,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTE6",262,0)
 D:$L(RACMDATA) CMEDIA^RARTE(RACMDATA)
"RTN","RARTE6",263,0)
 K RACMDATA
"RTN","RARTE6",264,0)
 S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,RACN," Tech.Comment: ",15,70,-1,0) ;P18
"RTN","RARTE6",265,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE6",266,0)
 ;
"RTN","RARTE6",267,0)
 K RAMEMARR D EN2^RAUTL20(.RAMEMARR) ;recalculate RAPRTSET
"RTN","RARTE6",268,0)
 ; if printset, display cases and continue on to display Exam Date
"RTN","RARTE6",269,0)
 I RAPRTSET D
"RTN","RARTE6",270,0)
 . S RA1=""
"RTN","RARTE6",271,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""!(RA18EX=-1)  I RA1'=RACNI D
"RTN","RARTE6",272,0)
 .. W !,?1,"Case No. : ",+RAMEMARR(RA1)
"RTN","RARTE6",273,0)
 .. W:$P(RAMEMARR(RA1),"^",4)]"" ?18,"Exm. St: ",$E($P($G(^RA(72,$P(RAMEMARR(RA1),"^",4),0)),"^"),1,12)
"RTN","RARTE6",274,0)
 .. W ?40,"Procedure   : ",$E($P($G(^RAMIS(71,+$P(RAMEMARR(RA1),"^",2),0)),"^"),1,26)
"RTN","RARTE6",275,0)
 ..;check printset for contrast media; display if CM data exists
"RTN","RARTE6",276,0)
 ..S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RA1)
"RTN","RARTE6",277,0)
 ..D:$L(RACMDATA) CMEDIA^RARTE(RACMDATA)
"RTN","RARTE6",278,0)
 ..K RACMDATA
"RTN","RARTE6",279,0)
 .. S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,+RAMEMARR(RA1)," Tech.Comment: ",15,70,-1,0) Q:RA18EX=-1  ;P18
"RTN","RARTE6",280,0)
 .. Q
"RTN","RARTE6",281,0)
 . Q
"RTN","RARTE6",282,0)
 ;continue display
"RTN","RARTE6",283,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE6",284,0)
 S Y(0)=RASUBY0
"RTN","RARTE6",285,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RARTE6",286,0)
 D GETS^DIQ(70.03,RAIENS,"14;175*","E","RAOUT")
"RTN","RARTE6",287,0)
 W !?1,"Exam Date: ",RADATE,?40,"Technologist: "
"RTN","RARTE6",288,0)
 S RAIENSUB=$O(RAOUT(70.12,0))
"RTN","RARTE6",289,0)
 W:RAIENSUB]"" $E($G(RAOUT(70.12,RAIENSUB,.01,"E")),1,25)
"RTN","RARTE6",290,0)
 ;p99 begins
"RTN","RARTE6",291,0)
 W !?1,"Req Phys : ",$E($G(RAOUT(70.03,RAIENS,14,"E")),1,25)
"RTN","RARTE6",292,0)
 I $$PTSEX^RAUTL8(RADFN)="F" D
"RTN","RARTE6",293,0)
 .D GETS^DIQ(70.03,RAIENS,"32;80","I","RAOUT")
"RTN","RARTE6",294,0)
 .N RA3 S RA3=$G(RAOUT(70.03,RAIENS,32,"I"))
"RTN","RARTE6",295,0)
 .W:RA3'="" !?1,"Pregnancy Screen: ",$S(RA3="y":"Patient answered yes",RA3="n":"Patient answered no",RA3="u":"Patient is unable to answer or is unsure",1:"")
"RTN","RARTE6",296,0)
 .W:(RA3'="n")&($G(RAOUT(70.03,RAIENS,80,"I"))'="") !?1,"Pregnancy Screen Comment: ",$G(RAOUT(70.03,RAIENS,80,"I"))
"RTN","RARTE6",297,0)
 ;p99 ends
"RTN","RARTE6",298,0)
 W !,RAI
"RTN","RARTE6",299,0)
 Q
"RTN","RARTE6",300,0)
LOCK(X,Y) ; Lock the data global
"RTN","RARTE6",301,0)
 ; uses var DILOCKTM, code taken from rtn RAUTL12
"RTN","RARTE6",302,0)
 ; 'X' is the global root
"RTN","RARTE6",303,0)
 ; 'Y' is the record number
"RTN","RARTE6",304,0)
 N RALCKFLG,XY
"RTN","RARTE6",305,0)
 S RADUZ=+$G(DUZ),RALCKFLG=0,XY=X_Y
"RTN","RARTE6",306,0)
 L +@(XY_")"):DILOCKTM
"RTN","RARTE6",307,0)
 I '$T S RALCKFLG=1 D
"RTN","RARTE6",308,0)
 . W !?5,"This record is being edited by another user."
"RTN","RARTE6",309,0)
 . W !?5,"Try again later!",$C(7)
"RTN","RARTE6",310,0)
 . Q
"RTN","RARTE6",311,0)
 E  D
"RTN","RARTE6",312,0)
 . S ^TMP("RAD LOCKS",$J,RADUZ,X,Y)=""
"RTN","RARTE6",313,0)
 . Q
"RTN","RARTE6",314,0)
 Q RALCKFLG
"RTN","RARTE6",315,0)
INTRO ;
"RTN","RARTE6",316,0)
 ;; +--------------------------------------------------------+
"RTN","RARTE6",317,0)
 ;; |                                                        |
"RTN","RARTE6",318,0)
 ;; |    This option is for restoring a deleted report.      |
"RTN","RARTE6",319,0)
 ;; |                                                        |
"RTN","RARTE6",320,0)
 ;; +--------------------------------------------------------+
"RTN","RARTR")
0^20^B63595005^B57840042
"RTN","RARTR",1,0)
RARTR ;HISC/CAH COLUMBIA/REB AISC/MJK,RMO-Queue/print Reports ;06/10/09  06:30
"RTN","RARTR",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,13,16,27,43,55,75,92,99**;Mar 16, 1998;Build 5
"RTN","RARTR",3,0)
 ;Supported IA #2056 reference to GET1^DIQ
"RTN","RARTR",4,0)
PRT ; Begin print/build of e-mail message
"RTN","RARTR",5,0)
 ;
"RTN","RARTR",6,0)
 ; ** NOTE: If the layout of this output is changed  **
"RTN","RARTR",7,0)
 ; **       please check that routine RAO7PC3 is     **
"RTN","RARTR",8,0)
 ; **       not affected. It assumes fixed format of **
"RTN","RARTR",9,0)
 ; **       the following headings:                  **
"RTN","RARTR",10,0)
 ; **            Clinical History:                   **
"RTN","RARTR",11,0)
 ; **            Report:                             **
"RTN","RARTR",12,0)
 ; **            Impression:                         **
"RTN","RARTR",13,0)
 ; **            Primary Diagnostic Code:            **
"RTN","RARTR",14,0)
 ; **            Secondary Diagnostic Codes:         **
"RTN","RARTR",15,0)
 ; **            Primary Interpreting Staff:         **
"RTN","RARTR",16,0)
 ;
"RTN","RARTR",17,0)
 Q:'$D(^RARPT(+$G(RARPT),0))
"RTN","RARTR",18,0)
 ; Use and Set if running in the foreground and Writing to the device
"RTN","RARTR",19,0)
 I '$D(RAUTOE) D
"RTN","RARTR",20,0)
 . U IO
"RTN","RARTR",21,0)
 . S RAFFLF=IOF
"RTN","RARTR",22,0)
 . S RAORIOF=RAFFLF
"RTN","RARTR",23,0)
 ;
"RTN","RARTR",24,0)
 W:$Y>0&('$D(RAUTOE)) @RAFFLF   ; If RAUTOE defined build mail msg
"RTN","RARTR",25,0)
 S X=$G(^RARPT(+$G(RARPT),0))   ;  RAORIOF=RAFFLF
"RTN","RARTR",26,0)
 ;
"RTN","RARTR",27,0)
 ;S RAFFLF=$S('$D(ORACTION):RAFFLF,ORACTION'=8:RAFFLF,1:"!")
"RTN","RARTR",28,0)
 D INIT ; setup exam/report variables
"RTN","RARTR",29,0)
 ;start p99
"RTN","RARTR",30,0)
 I $$PTSEX^RAUTL8(RADFN)="F",'$D(RAUTOE) D
"RTN","RARTR",31,0)
 .N RA700332,RA700380 S RA700332=$$GET1^DIQ(70.03,$G(RACNI)_","_$G(RADTI)_","_$G(RADFN),32)
"RTN","RARTR",32,0)
 .W:RA700332'="" !,"Pregnancy Screen: ",RA700332
"RTN","RARTR",33,0)
 .S RA700380=$$GET1^DIQ(70.03,$G(RACNI)_","_$G(RADTI)_","_$G(RADFN),80)
"RTN","RARTR",34,0)
 .I (RA700332'="Patient answered no"),(RA700380'="") S RA700380="Pregnancy Screen Comment: "_RA700380 D OUTTEXT^RAUTL9(RA700380,"",1,75,"","!","")
"RTN","RARTR",35,0)
 .W !
"RTN","RARTR",36,0)
 ;end of p99
"RTN","RARTR",37,0)
 I RAY0<0!(RAY1<0)!(RAY2<0)!(RAY3<0) K RAFFLF Q  ; data nodes missing
"RTN","RARTR",38,0)
 ;
"RTN","RARTR",39,0)
PRT1 I $D(RAUTOE) D
"RTN","RARTR",40,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=" "
"RTN","RARTR",41,0)
 . I $D(RADDEN) D
"RTN","RARTR",42,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="Report Unverified by: "_$P($G(^VA(200,$S($G(RADUZ):RADUZ,1:DUZ),0)),"^")
"RTN","RARTR",43,0)
 .. Q
"RTN","RARTR",44,0)
 . Q
"RTN","RARTR",45,0)
 I +$O(^RARPT(RARPT,"ERR",0)) D
"RTN","RARTR",46,0)
 . S RAERRFLG="" ; set for future reference (display AMENRPT^RARTR text)
"RTN","RARTR",47,0)
 . W:'$D(RAUTOE) !!?10,$$AMENRPT^RARTR2(),!
"RTN","RARTR",48,0)
 . I $D(RAUTOE) D
"RTN","RARTR",49,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=" "
"RTN","RARTR",50,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="         "_$$AMENRPT^RARTR2()
"RTN","RARTR",51,0)
 .. Q
"RTN","RARTR",52,0)
 . Q
"RTN","RARTR",53,0)
 I $P(RAY3,"^",25)<2 D  G END:$D(RAOOUT)
"RTN","RARTR",54,0)
 . D MODS^RAUTL2,OUT1^RARTR3
"RTN","RARTR",55,0)
 . D:+$P(RAY3,"^",28) RDIO^RARTUTL(+$P(RAY3,"^",28))  Q:$D(RAOOUT)
"RTN","RARTR",56,0)
 . D:+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) PHARM^RARTUTL(RACNI_","_RADTI_","_RADFN_",")
"RTN","RARTR",57,0)
 . ;W:'$D(RAUTOE) !
"RTN","RARTR",58,0)
 . S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",59,0)
 . Q
"RTN","RARTR",60,0)
 I $P(RAY3,"^",25)>1 D
"RTN","RARTR",61,0)
 . D MEMS1^RARTR3
"RTN","RARTR",62,0)
 . W:'$D(RAUTOE) !
"RTN","RARTR",63,0)
 . S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",64,0)
 . Q
"RTN","RARTR",65,0)
 G END:$D(RAOOUT)
"RTN","RARTR",66,0)
 ; Check for duplicate history in file 70 and 74.
"RTN","RARTR",67,0)
 D CHKDUPHX^RART1  ; Sets RADUPHX to 1 for duplicate or 0 if different.
"RTN","RARTR",68,0)
 F RAP="H","AH","R","I" K ^UTILITY($J,"W"),^(1) D  G END:$D(RAOOUT)
"RTN","RARTR",69,0)
 . S RAP("P")=$S(RAP="H":"Clinical History:",RAP="AH":"Additional Clinical History:",RAP="R":"Report:",1:"Impression:")
"RTN","RARTR",70,0)
 . ; Don't continue if printing Additional Clinical History and it is a
"RTN","RARTR",71,0)
 . ; duplicate of Clinical History.
"RTN","RARTR",72,0)
 . Q:RAP="AH"&(RADUPHX>0)
"RTN","RARTR",73,0)
 . W:'$D(RAUTOE) !?RATAB,RAP("P")
"RTN","RARTR",74,0)
 . I $D(RAUTOE),($D(RADDEN)),(RAP="R") D
"RTN","RARTR",75,0)
 .. N RABAN1,RABAN2,RASPCE S $P(RASPCE," ",46)=""
"RTN","RARTR",76,0)
 .. S RABAN1="*** Uncorrected Version   ***"
"RTN","RARTR",77,0)
 .. S RABAN2="*** Refer to final report ***"
"RTN","RARTR",78,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",79,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RASPCE_RABAN1
"RTN","RARTR",80,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RASPCE_RABAN2
"RTN","RARTR",81,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",82,0)
 .. Q
"RTN","RARTR",83,0)
 . S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="    "_RAP("P")
"RTN","RARTR",84,0)
 . W:$D(RASTFL)&(RAP="R")&('$D(RAUTOE)) ?45,"Status: ",$$XTERNAL^RAUTL5(RAST,$P($G(^DD(74,5,0)),"^",2))
"RTN","RARTR",85,0)
 . I RAP="R",($D(RAUTOE)) D
"RTN","RARTR",86,0)
 .. S $P(RAP("S")," ",(46-$L(^TMP($J,"RA AUTOE",RAACNT))))=""
"RTN","RARTR",87,0)
 .. I '$D(RADDEN) S ^TMP($J,"RA AUTOE",RAACNT)=^(RAACNT)_RAP("S")_"Status: "_$$XTERNAL^RAUTL5(RAST,$P($G(^DD(74,5,0)),"^",2))
"RTN","RARTR",88,0)
 .. Q
"RTN","RARTR",89,0)
 . D:$D(RAUTOE) SET^RARTR2
"RTN","RARTR",90,0)
 . D:'$D(RAUTOE) WRITE^RARTR2 Q:$D(RAOOUT)
"RTN","RARTR",91,0)
 . K ^UTILITY($J,"W")
"RTN","RARTR",92,0)
 . Q
"RTN","RARTR",93,0)
 I $D(RADDEN),($G(^RARPT(RARPT,"PURGE"))) D
"RTN","RARTR",94,0)
 . ; when the report is unverified and purge data exists (rpt adden)
"RTN","RARTR",95,0)
 . N RAPRGE S RAPRGE=+$G(^RARPT(RARPT,"PURGE"))
"RTN","RARTR",96,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",97,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="Report Purged: "_$$FMTE^XLFDT(RAPRGE,"1P")
"RTN","RARTR",98,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",99,0)
 . Q
"RTN","RARTR",100,0)
 I $P($G(^RA(79.1,+$P(RAY2,U,4),0)),U,18)="Y" D PRTDX^RARTR1 G:$D(RAOOUT) END ;print dx codes
"RTN","RARTR",101,0)
 D EN1^RARTR0 G:$D(RAOOUT) END
"RTN","RARTR",102,0)
 I '$D(RAVERFND) D  G END:$D(RAOOUT)
"RTN","RARTR",103,0)
 . I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 Q:$D(RAOOUT)  D HD:($Y+RAFOOT+4)>IOSL
"RTN","RARTR",104,0)
 . N RADFTSBN,RADFTSBT S:$D(RADDEN) RAVERF=+$P(RA74B4,"^",9)
"RTN","RARTR",105,0)
 . S RADFTSBN=$E($P($G(^VA(200,RAVERF,20)),"^",2),1,25)
"RTN","RARTR",106,0)
 . S:RADFTSBN']"" RADFTSBN=$E($P($G(^VA(200,RAVERF,0)),"^"),1,25)
"RTN","RARTR",107,0)
 . S RADFTSBT=$E($P($G(^VA(200,RAVERF,20)),"^",3),1,30)
"RTN","RARTR",108,0)
 . I RADFTSBT']"" S RADFTSBT=$$TITLE^RARTR0(RAVERF)
"RTN","RARTR",109,0)
 . W:'$D(RAUTOE) !!,"VERIFIED BY:",!?2,$S(RADFTSBN]"":RADFTSBN,1:"")
"RTN","RARTR",110,0)
 . W:RADFTSBT]""&('$D(RAUTOE)) ", "_RADFTSBT
"RTN","RARTR",111,0)
 . I $D(RAUTOE) D
"RTN","RARTR",112,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="VERIFIED BY:"
"RTN","RARTR",113,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="  "_$S(RADFTSBN]"":RADFTSBN,1:"")_$S(RADFTSBT]"":", "_RADFTSBT,1:"")
"RTN","RARTR",114,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",115,0)
 .. Q
"RTN","RARTR",116,0)
 . Q
"RTN","RARTR",117,0)
 K RASBPN,RASBT,RASECIEN,RASECOND,RASECSS
"RTN","RARTR",118,0)
 I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 G END:$D(RAOOUT) D HD:($Y+RAFOOT+4)>IOSL
"RTN","RARTR",119,0)
 W:'$D(RAUTOE) !!,$S($D(^RABTCH(74.2,+RABTCH,0)):$P(^(0),"^"),1:""),"/" I +$G(^RARPT(RARPT,"T")),$D(^VA(200,+$P(^RARPT(RARPT,"T"),"^"),0)) W:'$D(RAUTOE) $P(^(0),"^",2)
"RTN","RARTR",120,0)
 S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$P($G(^RABTCH(74.2,+RABTCH,0)),"^")_"/"_$S(+$G(^RARPT(RARPT,"T"))&($D(^VA(200,+$P($G(^RARPT(RARPT,"T")),"^"),0))):$P(^(0),"^",2),1:"")
"RTN","RARTR",121,0)
 S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",122,0)
 D HANG^RARTR2 G END:$D(RAOOUT)
"RTN","RARTR",123,0)
 I RAST'="V" D:'$D(RAMDV) SETDIV^RARTR2 I $P(RAMDV,U,25) D WARNING^RARTR1
"RTN","RARTR",124,0)
 G PEND:RAST'="PD"
"RTN","RARTR",125,0)
 S $P(RASTRSK,"*",80)=""
"RTN","RARTR",126,0)
 I '$D(RAUTOE) D
"RTN","RARTR",127,0)
 . D HD:($Y+RAFOOT+9)>IOSL
"RTN","RARTR",128,0)
 . W !,$E(RASTRSK,1,22)," P R O B L E M   S T A T E M E N T ",$E(RASTRSK,1,22)
"RTN","RARTR",129,0)
 . W !!,$S($D(^RARPT(RARPT,"P")):^("P"),1:"None entered.") W !!,RASTRSK
"RTN","RARTR",130,0)
 . Q
"RTN","RARTR",131,0)
 E  D
"RTN","RARTR",132,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$E(RASTRSK,1,22)_" P R O B L E M   S T A T E M E N T "_$E(RASTRSK,1,22)
"RTN","RARTR",133,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$S($D(^RARPT(RARPT,"P")):^("P"),1:"None entered.")
"RTN","RARTR",134,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",135,0)
 . Q
"RTN","RARTR",136,0)
PEND D FOOT^RARTR2,HANG^RARTR2 D:'$D(RAMIE)&('$D(RAUTOE)) Q^RAFLH1
"RTN","RARTR",137,0)
END K:$D(RAOOUT) XQAID,XQAKILL
"RTN","RARTR",138,0)
 K %I,%W,%Y1,C,DN,I,RADXCODE,RARTMES,RAVERF,RAVERFND,RAPVERF
"RTN","RARTR",139,0)
 K RAVERS,RAFOOT,RAY0,RAY1,RAY2,RAY3,RALOC,RAFMT,RAMOD,RASTFL,RALB,RALBR
"RTN","RARTR",140,0)
 K RALBRT,RALBS,RALBST,RAV,RAP,RATAB,RAXX,VAL,VAR,RADFN,RADTI,RACN,RADTE
"RTN","RARTR",141,0)
 K RARPT,RAHDFM,RAFTFM,RAV,RAIOF,RABTCH,RAOOUT,RAPIR,RAPIS,VAERR,Z
"RTN","RARTR",142,0)
 ; K RASTRSK S RAFFLF=RAORIOF K RAORIOF,RAFFLF,RAERRFLG
"RTN","RARTR",143,0)
 ; 05/15/08 BAY/KAM Patch RA*5*92 Added Conditional Kill to next line
"RTN","RARTR",144,0)
 ; to support an AMIE interface (IA 708)
"RTN","RARTR",145,0)
 K RASTRSK,RAORIOF,RAFFLF,RAERRFLG K:'($D(RAMIE)#2) DFN
"RTN","RARTR",146,0)
 ;the next kill line corrects the CPRS V27 report display issue when repeated
"RTN","RARTR",147,0)
 ;on same patient P92
"RTN","RARTR",148,0)
 K %,DIW,DIWF,DIWI,DIWL,DIWT,DIWTC,DIWX,RAACNT,RADUPHX,RANUM,RAREZON,RAST
"RTN","RARTR",149,0)
 Q
"RTN","RARTR",150,0)
Q ; Queue the report
"RTN","RARTR",151,0)
 S ZTDTH=$H,ZTRTN="DQ^RARTR",ZTSAVE("RARPT")="" S:$D(RARTMES) ZTSAVE("RARTMES")=""
"RTN","RARTR",152,0)
 D ZIS^RAUTL Q:RAPOP
"RTN","RARTR",153,0)
 ;
"RTN","RARTR",154,0)
DQ S U="^",X="T",%DT="" D ^%DT K %DT S DT=Y G PRT
"RTN","RARTR",155,0)
 ;
"RTN","RARTR",156,0)
INIT ; initialize exam/report variables
"RTN","RARTR",157,0)
 ; main variables set:
"RTN","RARTR",158,0)
 ; RAY0: zero node data from the Patient File (2)
"RTN","RARTR",159,0)
 ; RAY1: zero node data from the Rad/Nuc Med Patient File (70)
"RTN","RARTR",160,0)
 ; RAY2: Registered Exams (70.02) zero node data
"RTN","RARTR",161,0)
 ; RAY3: Examinations     (70.03) zero node data
"RTN","RARTR",162,0)
 S (RAY0,RAY1,RAY2,RAY3)=-1 ; error condition, if no data nodes
"RTN","RARTR",163,0)
 S RADFN=+$P(X,"^",2),RADTE=+$P(X,"^",3),RADTI=(9999999.9999-RADTE)
"RTN","RARTR",164,0)
 S RACN=+$P(X,"^",4),RAST=$P(X,"^",5),RATAB=5
"RTN","RARTR",165,0)
 S:'$D(RABTCH) RABTCH=0 S (DIWL,DIWF)=0
"RTN","RARTR",166,0)
 Q:'$D(^RADPT(RADFN,0))  S RANUM=1,RAY1=^(0)
"RTN","RARTR",167,0)
 Q:'$D(^DPT(RADFN,0))  S RAY0=^(0)
"RTN","RARTR",168,0)
 Q:'$D(^RADPT(RADFN,"DT",RADTI,0))  S RAY2=^(0)
"RTN","RARTR",169,0)
 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0))
"RTN","RARTR",170,0)
 S (RAY3,RALB)=$S($D(^RADPT(RADFN,"DT",RADTI,"P",+RACNI,0)):^(0),1:-1)
"RTN","RARTR",171,0)
 Q:RAY3<0  ; examinations data missing
"RTN","RARTR",172,0)
 ;
"RTN","RARTR",173,0)
 S (RAHDFM,RAFTFM)=1 S:$D(^RA(79.1,+$P(RAY2,"^",4),0)) RAHDFM=^(0),RAFTFM=+$P(RAHDFM,"^",13),DIWL=$P(RAHDFM,"^",14),DIWF=$P(RAHDFM,"^",15),RAHDFM=+$P(RAHDFM,"^",12) S RAFOOT=$S($D(^RA(78.2,RAFTFM,0)):+$P(^(0),"^",2),1:0)
"RTN","RARTR",174,0)
 S:'DIWL DIWL=5 S:'DIWF DIWF=70 S DIWF="WC"_(DIWF-DIWL)
"RTN","RARTR",175,0)
 G @$S($D(RAUTOE):"HEAD^RARTR0",1:"HD1")
"RTN","RARTR",176,0)
 Q
"RTN","RARTR",177,0)
 ;
"RTN","RARTR",178,0)
HD D FOOT^RARTR2:$E(IOST,1,2)'="C-"
"RTN","RARTR",179,0)
HD1 S RAFMT=RAHDFM I $D(RARTMES) W:$Y>0 @RAFFLF W !,?((80-$L(RARTMES))/2),RARTMES,! S RAIOF=RAFFLF,RAFFLF="!"
"RTN","RARTR",180,0)
 I '$D(RARTMES) W:$Y>0 @RAFFLF
"RTN","RARTR",181,0)
 D PRT^RAFLH S:$D(RARTMES) RAFFLF=RAIOF
"RTN","RARTR",182,0)
 W:$D(RAERRFLG) !!?10,$$AMENRPT^RARTR2(),!!
"RTN","RARTR",183,0)
 Q
"RTN","RARTR0")
0^21^B58931400^B48053293
"RTN","RARTR0",1,0)
RARTR0 ;HISC/GJC-Queue/Print Radiology Rpts utility routine. ;05/20/09  09:30
"RTN","RARTR0",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,26,74,84,99**;Mar 16, 1998;Build 5
"RTN","RARTR0",3,0)
 ; 06/28/2006 BAY/KAM Remedy Call 146291 - Change Patient Age to DOB
"RTN","RARTR0",4,0)
 ;
"RTN","RARTR0",5,0)
 ;Integration Agreements
"RTN","RARTR0",6,0)
 ;----------------------
"RTN","RARTR0",7,0)
 ;DT^DILF(2054); GETS^DIQ(2056); $$FMTE^XLFDT(10103); $$UP^XLFSTR(10104); ^DIWP(10011)
"RTN","RARTR0",8,0)
 ;NEW PERSON file read w/FM (10060)
"RTN","RARTR0",9,0)
 ;
"RTN","RARTR0",10,0)
EN1 ; Called from RARTR ;P84 GETS^DIQ added... 
"RTN","RARTR0",11,0)
 S RARPT(0)=$G(^RARPT(+$G(RARPT),0)) Q:RARPT(0)']""
"RTN","RARTR0",12,0)
 S RARPT(10)=$P(RARPT(0),"^",10)
"RTN","RARTR0",13,0)
 S RAVERF=+$P(RARPT(0),U,9),RAPVERF=+$P(RARPT(0),U,13)
"RTN","RARTR0",14,0)
 K RAPIR,RAPIS S RAPIR=+$P(RALB,"^",12),RAPIS=+$P(RALB,"^",15)
"RTN","RARTR0",15,0)
 ;format of the RAPIR/RAPIS arrays: P84 logic
"RTN","RARTR0",16,0)
 ;RAPI*=IEN file 200
"RTN","RARTR0",17,0)
 ;RAPI*(200,RAPI*,.01)= NAME (required)
"RTN","RARTR0",18,0)
 ;RAPI*(200,RAPI*,20.2) = SIGNATURE BLOCK PRINTED NAME (if any)
"RTN","RARTR0",19,0)
 ;RAPI*(200,RAPI*,20.3) = SIGNATURE BLOCK TITLE (if any)
"RTN","RARTR0",20,0)
 I RAPIR D GETS^DIQ(200,RAPIR,".01;20.2;20.3","","RAPIR") S RAPIR("IENS")=RAPIR_","
"RTN","RARTR0",21,0)
 I RAPIS D GETS^DIQ(200,RAPIS,".01;20.2;20.3","","RAPIS") S RAPIS("IENS")=RAPIS_","
"RTN","RARTR0",22,0)
 S RAWHOVER=+$P(RARPT(0),"^",17)
"RTN","RARTR0",23,0)
 I RAVERF,((RAPIR=RAVERF)!(RAPIS=RAVERF)) D
"RTN","RARTR0",24,0)
 . S RAVERFND="" ; Set verifier found flag
"RTN","RARTR0",25,0)
 . Q
"RTN","RARTR0",26,0)
 I RAPIS D  Q:$D(RAOOUT)
"RTN","RARTR0",27,0)
 . ;get signature block name if defined
"RTN","RARTR0",28,0)
 . S RALBS=$E(RAPIS(200,RAPIS("IENS"),20.2),1,25)
"RTN","RARTR0",29,0)
 . S:RALBS="" RALBS=$E(RAPIS(200,RAPIS("IENS"),.01),1,25) ;default to NAME
"RTN","RARTR0",30,0)
 . ;
"RTN","RARTR0",31,0)
 . ;get signature block title if defined
"RTN","RARTR0",32,0)
 . S RALBST=$G(RAPIS(200,RAPIS("IENS"),20.3)) ; max: 50 chars
"RTN","RARTR0",33,0)
 . S:RALBST="" RALBST=$$TITLE^RARTR0(RAPIS)
"RTN","RARTR0",34,0)
 . ;
"RTN","RARTR0",35,0)
 . I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 Q:$D(RAOOUT)
"RTN","RARTR0",36,0)
 . I '$D(RAUTOE) D HD^RARTR:($Y+RAFOOT+4)>IOSL
"RTN","RARTR0",37,0)
 . I '$D(RAUTOE) D
"RTN","RARTR0",38,0)
 .. W !,"Primary Interpreting Staff:",!?2,$S(RALBS]"":RALBS,1:"Unknown")
"RTN","RARTR0",39,0)
 .. W:$L(RALBST) ", "_$E(RALBST,1,((IOM-$X)-16))
"RTN","RARTR0",40,0)
 .. ; The '-16' above is derived from $L("(Pre-Verifier)")+1 FORMATTING
"RTN","RARTR0",41,0)
 .. Q
"RTN","RARTR0",42,0)
 . E  D
"RTN","RARTR0",43,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="Primary Interpreting Staff:"
"RTN","RARTR0",44,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="  "_$S(RALBS]"":RALBS,1:"Unknown")
"RTN","RARTR0",45,0)
 .. Q:'$L(RALBST)  N RALEN S RALEN=$L(^TMP($J,"RA AUTOE",RAACNT))
"RTN","RARTR0",46,0)
 .. S ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_", "_$E(RALBST,1,((80-RALEN)-16))
"RTN","RARTR0",47,0)
 .. Q
"RTN","RARTR0",48,0)
 . I $D(RAVERFND)&(RAPIS=RAVERF),(RAPIS(200,RAPIS("IENS"),.01)'="RADIOLOGY,OUTSIDE SERVICE") D
"RTN","RARTR0",49,0)
 .. I $G(RARPT(10))']"",('$D(RAUTOE)) D  Q
"RTN","RARTR0",50,0)
 ... W:RAWHOVER=RAPIS !?10,"(Verifier, no e-sig)"
"RTN","RARTR0",51,0)
 ... W:RAWHOVER'=RAPIS !?10,"Verified by transcriptionist for "_RALBS  ;Removed RA*5*8 _", M.D."
"RTN","RARTR0",52,0)
 ... Q
"RTN","RARTR0",53,0)
 .. I $G(RARPT(10))']"",($D(RAUTOE)) D  Q
"RTN","RARTR0",54,0)
 ... S:RAWHOVER=RAPIS ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="          (Verifier, no e-sig)"
"RTN","RARTR0",55,0)
 ... S:RAWHOVER'=RAPIS ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="          Verified by transcriptionist for "_RALBS  ;Removed RA*5*8 _", M.D."
"RTN","RARTR0",56,0)
 ... Q
"RTN","RARTR0",57,0)
 .. W:'$D(RAUTOE) " (Verifier)"
"RTN","RARTR0",58,0)
 .. S:$D(RAUTOE) ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_" (Verifier)"
"RTN","RARTR0",59,0)
 .. Q
"RTN","RARTR0",60,0)
 . I RAPIS=RAPVERF,'$D(RAUTOE) W " (Pre-Verifier)"
"RTN","RARTR0",61,0)
 . I RAPIS=RAPVERF,$D(RAUTOE) S ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_" (Pre-Verifier)"
"RTN","RARTR0",62,0)
 . Q
"RTN","RARTR0",63,0)
 D SECSTF^RARTR1 Q:$D(RAOOUT)  ; Print secondary interp'ting staff now
"RTN","RARTR0",64,0)
 ;now for primary resident definitions...
"RTN","RARTR0",65,0)
 I RAPIR D  Q:$D(RAOOUT)
"RTN","RARTR0",66,0)
 . ;get signature block name if defined
"RTN","RARTR0",67,0)
 . S RALBR=$E(RAPIR(200,RAPIR("IENS"),20.2),1,25)
"RTN","RARTR0",68,0)
 . S:RALBR="" RALBR=$E(RAPIR(200,RAPIR("IENS"),.01),1,25) ;default to NAME
"RTN","RARTR0",69,0)
 . ;
"RTN","RARTR0",70,0)
 . ;get signature block title if defined
"RTN","RARTR0",71,0)
 . S RALBRT=$G(RAPIR(200,RAPIR("IENS"),20.3)) ; max: 50 chars
"RTN","RARTR0",72,0)
 . S:RALBRT="" RALBRT=$$TITLE^RARTR0(RAPIR)
"RTN","RARTR0",73,0)
 . ;
"RTN","RARTR0",74,0)
 . I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 Q:$D(RAOOUT)
"RTN","RARTR0",75,0)
 . I '$D(RAUTOE) D HD^RARTR:($Y+RAFOOT+4)>IOSL
"RTN","RARTR0",76,0)
 . I '$D(RAUTOE) D
"RTN","RARTR0",77,0)
 .. W !,"Primary Interpreting Resident:",!?2,$S(RALBR]"":RALBR,1:"Unknown")
"RTN","RARTR0",78,0)
 .. W:$L(RALBRT) ", "_$E(RALBRT,1,((IOM-$X)-16))
"RTN","RARTR0",79,0)
 .. Q
"RTN","RARTR0",80,0)
 . I $D(RAUTOE) D
"RTN","RARTR0",81,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="Primary Interpreting Resident:"
"RTN","RARTR0",82,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="  "_$S(RALBR]"":RALBR,1:"Unknown")
"RTN","RARTR0",83,0)
 .. Q:'$L(RALBRT)  N RALEN S RALEN=$L(^TMP($J,"RA AUTOE",RAACNT))
"RTN","RARTR0",84,0)
 .. S ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_", "_$E(RALBRT,1,((80-RALEN)-16))
"RTN","RARTR0",85,0)
 .. Q
"RTN","RARTR0",86,0)
 . I $D(RAVERFND)&(RAPIR=RAVERF) D
"RTN","RARTR0",87,0)
 .. I $G(RARPT(10))']"",('$D(RAUTOE)) D  Q
"RTN","RARTR0",88,0)
 ... W:RAWHOVER=RAPIR !?10,"(Verifier, no e-sig)"
"RTN","RARTR0",89,0)
 ... W:RAWHOVER'=RAPIR !?10,"Verified by transcriptionist for "_RALBR  ;Removed RA*5*8 _", M.D."
"RTN","RARTR0",90,0)
 ... Q
"RTN","RARTR0",91,0)
 .. I $G(RARPT(10))']"",($D(RAUTOE)) D  Q
"RTN","RARTR0",92,0)
 ... S:RAWHOVER=RAPIR ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="          (Verifier, no e-sig)"
"RTN","RARTR0",93,0)
 ... S:RAWHOVER'=RAPIR ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="          Verified by transcriptionist for "_RALBR  ;Removed RA*5*8 _", M.D."
"RTN","RARTR0",94,0)
 ... Q
"RTN","RARTR0",95,0)
 .. W:'$D(RAUTOE) " (Verifier)"
"RTN","RARTR0",96,0)
 .. S:$D(RAUTOE) ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_" (Verifier)"
"RTN","RARTR0",97,0)
 .. Q
"RTN","RARTR0",98,0)
 . I RAPIR=RAPVERF,('$D(RAUTOE)) W " (Pre-Verifier)"
"RTN","RARTR0",99,0)
 . I RAPIR=RAPVERF,($D(RAUTOE)) S ^TMP($J,"RA AUTOE",RAACNT)=^TMP($J,"RA AUTOE",RAACNT)_" (Pre-Verifier)"
"RTN","RARTR0",100,0)
 . Q
"RTN","RARTR0",101,0)
 D SECRES^RARTR1 ; Print out secondary interp'ting resident now
"RTN","RARTR0",102,0)
 K RAPIR,RAPIS ;P84 kills added
"RTN","RARTR0",103,0)
 Q
"RTN","RARTR0",104,0)
 ;
"RTN","RARTR0",105,0)
TITLE(X) ;Return the radiology classification in lieu of the signature block title
"RTN","RARTR0",106,0)
 ; 'X' is the IEN of the Primary Interpreting Resident i.e, ^DD(70.03,12
"RTN","RARTR0",107,0)
 ; -OR-
"RTN","RARTR0",108,0)
 ; 'X' is the IEN of the Primary Interpreting Staff i.e, ^DD(70.03,15
"RTN","RARTR0",109,0)
 Q $S($D(^VA(200,"ARC","R",X)):"Resident Physician",$D(^VA(200,"ARC","S",X)):"Staff Physician",1:"")
"RTN","RARTR0",110,0)
 ; 
"RTN","RARTR0",111,0)
HEAD ; Set up header info for e-mail message (called from INIT^RARTR)
"RTN","RARTR0",112,0)
 ; 06/28/2006 BAY/KAM Remedy Call 146291 Change Patient Age to DOB
"RTN","RARTR0",113,0)
 N RAGE,RATPHY,RACSE,RAILOC,RANME,RAPRIPHY,RAPTLOC,RAREQPHY,RASERV,RASEX,RADOB
"RTN","RARTR0",114,0)
 N RASPACE,RASSN,X1,X2 S:'$D(RAACNT) RAACNT=0
"RTN","RARTR0",115,0)
 ;Added next line for Remedy Call 146291
"RTN","RARTR0",116,0)
 D DT^DILF("E",$P(RAY0,"^",3),.RADOB) ;Get Date of Birth/External Fmt
"RTN","RARTR0",117,0)
 ;
"RTN","RARTR0",118,0)
 S RANME=$P(RAY0,"^"),RASSN=$P(RAY0,"^",9)
"RTN","RARTR0",119,0)
 S RASEX=$$UP^XLFSTR($P(RAY0,"^",2))
"RTN","RARTR0",120,0)
 S RACSE=$P($G(^RARPT(RARPT,0)),"^")_"@"_$P($$FMTE^XLFDT($P(RAY2,"^")),"@",2)
"RTN","RARTR0",121,0)
 ; Remedy Call 146291 Removed line calculating age
"RTN","RARTR0",122,0)
 S RAREQPHY=$$XTERNAL^RAUTL5($P(RAY3,"^",14),$P($G(^DD(70.03,14,0)),"^",2))
"RTN","RARTR0",123,0)
 S RAPTLOC=$$PTLOC^RAUTL12() S:RAREQPHY']"" RAREQPHY="Unknown"
"RTN","RARTR0",124,0)
 S RASERV=$$XTERNAL^RAUTL5($P(RAY3,"^",7),$P($G(^DD(70.03,7,0)),"^",2))
"RTN","RARTR0",125,0)
 S RATPHY=$$ATND^RAUTL5(RADFN,DT),RAPRIPHY=$$PRIM^RAUTL5(RADFN,DT)
"RTN","RARTR0",126,0)
 S RAILOC=$$XTERNAL^RAUTL5($P(RAY2,"^",4),$P($G(^DD(70.02,4,0)),"^",2))
"RTN","RARTR0",127,0)
 S:RAILOC']"" RAILOC="Unknown" S:RASERV']"" RASERV="Unknown"
"RTN","RARTR0",128,0)
 S RANME=$E(RANME,1,20)_"  "
"RTN","RARTR0",129,0)
 S RASSN=$E(RASSN,1,3)_"-"_$E(RASSN,4,5)_"-"_$E(RASSN,6,9)_"    "
"RTN","RARTR0",130,0)
 ; Remedy Call 146291 Changed next line to use RADOB(0)
"RTN","RARTR0",131,0)
 S RAGE="DOB-"_$G(RADOB(0))_" "_$S(RASEX="F":"F",RASEX="M":"M",1:"UNK")
"RTN","RARTR0",132,0)
 S $P(RASPACE," ",(22-$L(RAGE)))=""
"RTN","RARTR0",133,0)
 S RAGE=RAGE_RASPACE,RACSE="Case: "_RACSE
"RTN","RARTR0",134,0)
 S RAREQPHY="Req Phys: "_$E(RAREQPHY,1,28)
"RTN","RARTR0",135,0)
 S RASPACE="",$P(RASPACE," ",(42-$L(RAREQPHY)))=""
"RTN","RARTR0",136,0)
 S RAREQPHY=RAREQPHY_RASPACE
"RTN","RARTR0",137,0)
 S RAPTLOC="Pat Loc: "_$S(RAPTLOC]"":$E(RAPTLOC,1,30),1:"Unknown")
"RTN","RARTR0",138,0)
 S RATPHY="Att Phys: "_$E(RATPHY,1,28)
"RTN","RARTR0",139,0)
 S RASPACE="",$P(RASPACE," ",(42-$L(RATPHY)))=""
"RTN","RARTR0",140,0)
 S RATPHY=RATPHY_RASPACE
"RTN","RARTR0",141,0)
 S RAILOC="Img Loc: "_$E(RAILOC,1,30)
"RTN","RARTR0",142,0)
 S RAPRIPHY="Pri Phys: "_$E(RAPRIPHY,1,28)
"RTN","RARTR0",143,0)
 S RASPACE="",$P(RASPACE," ",(42-$L(RAPRIPHY)))=""
"RTN","RARTR0",144,0)
 S RAPRIPHY=RAPRIPHY_RASPACE
"RTN","RARTR0",145,0)
 S RASERV="Service: "_$E(RASERV,1,30)
"RTN","RARTR0",146,0)
 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RANME_RASSN_RAGE_RACSE
"RTN","RARTR0",147,0)
 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RAREQPHY_RAPTLOC
"RTN","RARTR0",148,0)
 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RATPHY_RAILOC
"RTN","RARTR0",149,0)
 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RAPRIPHY_RASERV
"RTN","RARTR0",150,0)
 ;p99: get pt sex, add pregnancy screen and pregnancy screen comment
"RTN","RARTR0",151,0)
 I $$PTSEX^RAUTL8(RADFN)="F",$D(RAY3) D
"RTN","RARTR0",152,0)
 .Q:RAY3<0
"RTN","RARTR0",153,0)
 .N RAPCOMM,RA32PSC,DIWF,DIWL,DIWR,X S RAPCOMM=$G(^RADPT(RADFN,"DT",+$G(RADTI),"P",+$G(RACNI),"PCOMM"))
"RTN","RARTR0",154,0)
 .S:$P(RAY3,U,32)'="" ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="Pregnancy Screen: "_$S($P(RAY3,"^",32)="y":"Patient answered yes",$P(RAY3,"^",32)="n":"Patient answered no",$P(RAY3,"^",32)="u":"Patient is unable to answer or is unsure",1:"")
"RTN","RARTR0",155,0)
 .I ($P(RAY3,U,32)'="n"),$L(RAPCOMM) D
"RTN","RARTR0",156,0)
 ..S DIWF="",DIWL=3,DIWR=75,X="Pregnancy Screen Comment: "_RAPCOMM K ^UTILITY($J,"W") D ^DIWP
"RTN","RARTR0",157,0)
 ..F RA32PSC=0:0 S RA32PSC=$O(^UTILITY($J,"W",3,RA32PSC)) Q:RA32PSC'>0  S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=^UTILITY($J,"W",3,RA32PSC,0)
"RTN","RARTR0",158,0)
 ..K ^UTILITY($J,"W")
"RTN","RARTR0",159,0)
 S:$D(RAERRFLG) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="         "_$$AMENRPT^RARTR2()
"RTN","RARTR0",160,0)
 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR0",161,0)
 Q
"RTN","RASTED")
0^15^B54871068^B47049414
"RTN","RASTED",1,0)
RASTED ;HISC/CAH,FPT,GJC,SS AISC/TMP,TAC,RMO-Edits for status tracking ;05/22/09  12:30
"RTN","RASTED",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,10,18,28,45,71,82,99**;Mar 16, 1998;Build 5
"RTN","RASTED",3,0)
 ;last modif by SS for P18 JUN 19,2000
"RTN","RASTED",4,0)
 ;02/10/2006 BAY/KAM RA*5*71 Add ability to update exam data to V/R
"RTN","RASTED",5,0)
 ; *** 'RASTED' is called from the routine; 'CASE^RASTEXT1'. ***
"RTN","RASTED",6,0)
 ;last modification by SS May 12,2000
"RTN","RASTED",7,0)
 ;
"RTN","RASTED",8,0)
 ;Supported IA #10040 reference to ^SC
"RTN","RASTED",9,0)
 ;Supported IA #1367 reference to LKUP^XPDKEY
"RTN","RASTED",10,0)
 ;Supported IA #2056 reference to GET1^DIQ
"RTN","RASTED",11,0)
 ;Supported IA #10060 reference to ^VA(200
"RTN","RASTED",12,0)
 S RAL=X F I2=1:1 S X=$P(RAL,",",I2) Q:X=""  S RAVW="" W !!,"Case # being tracked: ",X D SEL^RACNLU D:'RACNT KEY D START:RACNT&((X'="^")&(X'=""))
"RTN","RASTED",13,0)
 K RAL,RAI,RAPRI,I2,I3,RAVW,RAEND,RANME,RAPRC,RARPT,RADTE,RADT0,RANEXT,RANXT72,RASK,RACN,RACN0,RADFN,RADUZ,RAPOP,RAST,RAST0,RAFL,RAFST,RAIX,RASSN,RACOMP,X Q
"RTN","RASTED",14,0)
 ;RACOMP defined if [RA STATUS CHANGE] was processed completely
"RTN","RASTED",15,0)
START F I3=1:1:11 S @$P("RADFN^RADTI^RACNI^RANME^RASSN^RADATE^RADTE^RACN^RAPRC^RARPT^RAST","^",I3)=$P(Y,"^",I3)
"RTN","RASTED",16,0)
 I '$D(^RA(72,+RAST,0)) W $C(7),"Invalid status for case #: ",RACN R X:3 Q
"RTN","RASTED",17,0)
 S RAST0=^RA(72,+RAST,0) I $P(RAST0,"^",3)=9 W $C(7),!,"Exam is already complete!!" R X:3 Q
"RTN","RASTED",18,0)
 S X1=""
"RTN","RASTED",19,0)
 I $D(^RA(72,+$P(RAST0,"^",2),0)) S RANEXT=^(0),RASK=$S($D(^(.2)):^(.2),1:""),RANXT72=+$P(RAST0,"^",2)
"RTN","RASTED",20,0)
NEXT I '$D(RANEXT) S DIC("A")="Enter Next Status: ",DIC="^RA(72,",DIC(0)="AEFQZ",DIC("S")="I $P(^(0),U,3),$P(^(0),U,7)=$O(^RA(79.2,""B"",RAIMGTY,0))" D ^DIC K DIC Q:Y'>0  S RANEXT=Y(0),RASK=$S($D(^RA(72,+Y,.2)):^(.2),1:""),RANXT72=+Y
"RTN","RASTED",21,0)
 I $P(RANEXT,"^")=$P(RAST0,"^") W $C(7),!,"Status has already been set to ",$P(RANEXT,"^") R X:3 Q
"RTN","RASTED",22,0)
 I $$LKUP^XPDKEY(+$P(RANEXT,"^",4))]"",'$D(^XUSEC($$LKUP^XPDKEY(+$P(RANEXT,"^",4)),DUZ)) W $C(7),!,"You are not authorized to change to this status" R X:3 Q
"RTN","RASTED",23,0)
 ; check if next status has order field filled in
"RTN","RASTED",24,0)
 G:$P(RANEXT,U,3)]"" OK2
"RTN","RASTED",25,0)
 N RANXTIEN,RALINE S RANXTIEN=$P(RAST0,U,2),$P(RALINE,"_",50)=""
"RTN","RASTED",26,0)
 W !!?15,$C(7),RALINE
"RTN","RASTED",27,0)
 W !!?15,$C(7),"Default Next Status (",$P(RANEXT,U),") is *NOT* active.",!?15,$C(7),RALINE,!
"RTN","RASTED",28,0)
NXT S RANXTIEN=$P(^RA(72,RANXTIEN,0),U,2)
"RTN","RASTED",29,0)
 G:$P($G(^RA(72,+RANXTIEN,0)),U,3)=9 OK0 ;next default status is COMPLETE
"RTN","RASTED",30,0)
 G:RANXTIEN="" BAD ;no next default status pointer
"RTN","RASTED",31,0)
 G:'$D(^RA(72,RANXTIEN,0)) BAD ;no next default status record
"RTN","RASTED",32,0)
 G:$P($G(^RA(72,RANXTIEN,0)),U,3)="" NXT ;no order data, so loop back
"RTN","RASTED",33,0)
 G OK0
"RTN","RASTED",34,0)
BAD W !?15,$C(7),RALINE
"RTN","RASTED",35,0)
 W !!?18,$C(7),"There is no valid higher status to advance to.",!?15,$C(7),RALINE
"RTN","RASTED",36,0)
KEY W !! K DIR S DIR(0)="E",DIR("A")="Press Return key to continue " D ^DIR
"RTN","RASTED",37,0)
 K DIR,DIRUT,DUOUT Q
"RTN","RASTED",38,0)
OK0 S RANEXT=$G(^RA(72,RANXTIEN,0)),RANXT72=RANXTIEN
"RTN","RASTED",39,0)
OK1 W !?15,$C(7),RALINE,!!?18,"Next valid status is : ",$P(RANEXT,U),!?15,$C(7),RALINE
"RTN","RASTED",40,0)
OK2 S RADT0=^RADPT(RADFN,"DT",RADTI,0),RACN0=^("P",RACNI,0),RACS=$P(RACN0,"^",24),RAPRIT=$P(RACN0,"^",2)
"RTN","RASTED",41,0)
CHANGE W !!,"Name: ",RANME,?40,"Case #  : ",RACN,!,"Division : ",$S($D(^DIC(4,+$P(RADT0,"^",3),0)):$P(^(0),"^"),1:"")
"RTN","RASTED",42,0)
 W ?40,"Location: ",$S('$D(^RA(79.1,+$P(RADT0,"^",4),0)):"",$D(^SC(+^(0),0)):$P(^(0),"^"),1:"")
"RTN","RASTED",43,0)
 W !,"Procedure: ",RAPRC
"RTN","RASTED",44,0)
 D PRCCPT^RAPROD
"RTN","RASTED",45,0)
 ;p99: get sex and display pregnancy data if available for female pt.
"RTN","RASTED",46,0)
 I $$PTSEX^RAUTL8(RADFN)="F" D
"RTN","RASTED",47,0)
 .N RAORD0,RAPCOMM S RAORD0=$P(RACN0,U,11)
"RTN","RASTED",48,0)
 .S RAPCOMM=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"PCOMM"))
"RTN","RASTED",49,0)
 .W !,"PREGNANT AT TIME OF ORDER ENTRY: ",?22,$$GET1^DIQ(75.1,RAORD0_",",13)
"RTN","RASTED",50,0)
 .W:$P(RACN0,U,32)'="" !,"PREGNANCY SCREEN: ",$S($P(RACN0,"^",32)="y":"Patient answered yes",$P(RACN0,"^",32)="n":"Patient answered no",$P(RACN0,"^",32)="u":"Patient is unable to answer or is unsure",1:"")
"RTN","RASTED",51,0)
 .W:$P(RACN0,U,32)'="n"&$L(RAPCOMM) !,"PREGNANCY SCREEN COMMENT: ",RAPCOMM
"RTN","RASTED",52,0)
 ;end p99
"RTN","RASTED",53,0)
 W !,"   ***** Old Status: ",$P(RAST0,"^"),!,"   ***** New Status: ",$P(RANEXT,"^")
"RTN","RASTED",54,0)
 I RAPRC="Unknown" W !!?5,$C(7),"This record is corrupted -- the procedure is missing,",!?5,"please contact your ADPAC or IRM",! K DIR S DIR(0)="E",DIR("A")="Press RETURN to Continue" D ^DIR K DIR,DIROUT,DIRUT,DTOUT,DUOUT Q
"RTN","RASTED",55,0)
ASK R !,"Do you wish to continue? YES// ",X1:DTIME S:X1="" X1="Y" Q:'$T!(X1["^")!("nN"[X1)
"RTN","RASTED",56,0)
 I X1["?" W !!,"Answer 'Yes' or 'No'.",! G ASK
"RTN","RASTED",57,0)
 S RADUZ=DUZ I '$P(RAMDV,"^",6)!($P(RASK,"^",11)["Y") S RAPOP=0 D USER Q:RAPOP
"RTN","RASTED",58,0)
 N RAPRTSET,RAMEMARR D EN2^RAUTL20(.RAMEMARR) ;is this a print set ?
"RTN","RASTED",59,0)
 N RAWHICH,RAREM,RABEFORE,RAAFTER
"RTN","RASTED",60,0)
 S DIE("NO^")="BACKOUTOK",DR="[RA STATUS CHANGE]"
"RTN","RASTED",61,0)
 S DA=RADFN,RADADA=RADTI,DIE="^RADPT(",RADIE="^RADPT("_RADFN_",""DT"","
"RTN","RASTED",62,0)
 S RAXIT=$$LOCK^RAUTL12(RADIE,RADADA) Q:RAXIT
"RTN","RASTED",63,0)
 ;
"RTN","RASTED",64,0)
 ;save 'before' CM data value to compare against the possible 'after'
"RTN","RASTED",65,0)
 ;value
"RTN","RASTED",66,0)
 D TRK70CMB^RAMAINU(RADFN,RADTI,RACNI,.RATRKCMB) ;RA*5*45
"RTN","RASTED",67,0)
 ;
"RTN","RASTED",68,0)
 D SVBEFOR^RAO7XX(RADFN,RADTI,RACNI) ;P18 save before edit to compare later
"RTN","RASTED",69,0)
 K RACOMP D ^DIE
"RTN","RASTED",70,0)
 ;P18. $D(RABEFORE)=0 means that RASTREQ was not run - the user has interrupted input or timeout happened. So we must call it, then check result (is status changed) and if so - update 70.03 #3 and set RA70033=X
"RTN","RASTED",71,0)
 I '$D(RABEFORE) K DA S X=RANXT72 D:X ^RASTREQ  I $D(X)#2 S RA70033=X D U70033^RADD3(RADFN,RADTI,RACNI,X)
"RTN","RASTED",72,0)
 ;
"RTN","RASTED",73,0)
 ;1) check data consistency between 'CONTRAST MEDIA USED' & 'CONTRAST
"RTN","RASTED",74,0)
 ;MEDIA'
"RTN","RASTED",75,0)
 ;2) check 'before' CM data against 'after' CM data, file in audit log
"RTN","RASTED",76,0)
 ;if necessary. Remember, contrast media asked when in input template:
"RTN","RASTED",77,0)
 ;RA EXAM EDIT (RA*5*45)
"RTN","RASTED",78,0)
 S RACMDA=RACNI,RACMDA(1)=RADTI,RACMDA(2)=RADFN
"RTN","RASTED",79,0)
 D XCMINTEG^RAMAINU1(.RACMDA) ;1
"RTN","RASTED",80,0)
 D TRK70CMA^RAMAINU(RADFN,RADTI,RACNI,RATRKCMB) ;2
"RTN","RASTED",81,0)
 K RACMDA,RAOPRC
"RTN","RASTED",82,0)
 ;
"RTN","RASTED",83,0)
 K DIE("NO^"),DQ,DE,RATRKCMB,RAZCM
"RTN","RASTED",84,0)
 K RANM702,RADIOPH,RADOSE,RAIEN702,RAHI,RALOW,RAPRI,RAMIS,RAI,RAPSDRUG,RAR1
"RTN","RASTED",85,0)
 ;
"RTN","RASTED",86,0)
 ; if EXAM STATUS didn't process, still go thru status-change-logic
"RTN","RASTED",87,0)
 ; variables
"RTN","RASTED",88,0)
 ; ---------
"RTN","RASTED",89,0)
 ;   RA70033: is set in the RA STATUS CHANGE input template after the
"RTN","RASTED",90,0)
 ;             update to the EXAMINATION STATUS field (70.03;3)
"RTN","RASTED",91,0)
 ;    RATCXX: are technologist comments (if any) input by the user
"RTN","RASTED",92,0)
 ;     RAMDV: division parameters, piece 10; store the date/time
"RTN","RASTED",93,0)
 ;            of an exam status change (1 for yes, 0 for no)
"RTN","RASTED",94,0)
 ;
"RTN","RASTED",95,0)
 D:$D(RA70033)&($P(RAMDV,"^",10)) X7005^RADD3(RADFN,RADTI,RACNI,RAMDV,"",RA70033,$S($D(RADUZ):RADUZ,1:DUZ))
"RTN","RASTED",96,0)
 D A7007^RADD3(RADFN,RADTI,RACNI,$S($D(RADUZ):RADUZ,1:DUZ),$G(RATCXX))
"RTN","RASTED",97,0)
 D UNLOCK^RAUTL12(RADIE,RADADA) K RADADA,RADIE
"RTN","RASTED",98,0)
 K RA70033,RADUZ,RATCXX
"RTN","RASTED",99,0)
 N RACN0A ; updated version of the exam node after status updates
"RTN","RASTED",100,0)
 W !,"...Status ",$S($D(RAAFTER)&($G(RABEFORE)=$G(RAAFTER)):"unchanged",$G(RABEFORE)>$G(RAAFTER):"backed down",1:"successfully changed")," for case #: ",RACN
"RTN","RASTED",101,0)
 ;
"RTN","RASTED",102,0)
 ;02/10/2006 BAY/KAM RA*5*71 ,modified in RA*5*82...
"RTN","RASTED",103,0)
 I $D(RAAFTER),$G(RABEFORE)=$G(RAAFTER) R X:3 D  Q  ;exit if no change
"RTN","RASTED",104,0)
 .;Modified for RA*5*82
"RTN","RASTED",105,0)
 .N RAEXEDT S RAEXEDT=$$CMPAFTR^RAO7XX(1) ;;P18 compares if procedure was changed sends XX message
"RTN","RASTED",106,0)
 .D:RAEXEDT EXM^RAHLRPC ;P18 compares if procedure was changed sends XX message
"RTN","RASTED",107,0)
 ;
"RTN","RASTED",108,0)
 ; if status got backed down, RANEXT is re-defined inside rtn RASTREQ
"RTN","RASTED",109,0)
 ; when the above edit template gets to the EXAM STATUS field
"RTN","RASTED",110,0)
 ;
"RTN","RASTED",111,0)
 D ^RAORDC I +$P(RANEXT,"^",3)>1,RACS'="Y",$S($P(RACN0,"^",6)']"":1,$P(^DIC(42,+$P(RACN0,"^",6),0),U,3)="D":1,1:0) D EN^RAUTL0
"RTN","RASTED",112,0)
 S RACN0A=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) ; updated 0 node!
"RTN","RASTED",113,0)
 ; Do we need to 'Generate Exam Alert' based on the exam status?
"RTN","RASTED",114,0)
 I $D(^RA(72,+$P(RACN0A,"^",3),"ALERT")),($P(^("ALERT"),"^")="y") D
"RTN","RASTED",115,0)
 . ; fire off the 'Rad Patient Examined' alert.
"RTN","RASTED",116,0)
 . N RAPRIT,RAORDIFN
"RTN","RASTED",117,0)
 . S RAPRIT=+$P(RACN0A,"^",2) ; possible call to OERR3^RAORDU1
"RTN","RASTED",118,0)
 . S RAORDIFN=+$P(RACN0A,"^",11) ; possible call to OERR^RAORDU1
"RTN","RASTED",119,0)
 . D:$$ORVR^RAORDU()=2.5 OERR^RAUTL1
"RTN","RASTED",120,0)
 . D:$$ORVR^RAORDU()'<3 OERR3^RAUTL1
"RTN","RASTED",121,0)
 . Q
"RTN","RASTED",122,0)
 ;
"RTN","RASTED",123,0)
 R X:3 D
"RTN","RASTED",124,0)
 .N RAEXEDT S RAEXEDT=$$CMPAFTR^RAO7XX(1)
"RTN","RASTED",125,0)
 .D EXM^RAHLRPC
"RTN","RASTED",126,0)
 ;P18 compares -if procedure was changed - sends XX message
"RTN","RASTED",127,0)
 Q
"RTN","RASTED",128,0)
USER S %="A",%DUZ=DUZ W ! D ^XUVERIFY G USERQ:%=-1 I %'=1 W $C(7)," ??" G USER
"RTN","RASTED",129,0)
 Q
"RTN","RASTED",130,0)
USERQ K RADUZ S RAPOP=1 Q
"RTN","RASTED",131,0)
WHY1 ;explain why prim/sec resid/staff, diagnoses prompts are skipped
"RTN","RASTED",132,0)
 Q:$G(DA)<1!($G(DA(1))<1)!($G(DA(2))<1)
"RTN","RASTED",133,0)
 N RA0,RA1,RA2,RA5 N:'$D(RA3)#2 RA3 N:'$D(RA4)#2 RA4
"RTN","RASTED",134,0)
 S RA0=$G(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q:'RA0  S RA2=0
"RTN","RASTED",135,0)
 I $G(RA3)=13 D WHY11 G WHYMSG ;diagnoses
"RTN","RASTED",136,0)
 S RA3=12,RA4=70 D WHY11 ;residents
"RTN","RASTED",137,0)
 S RA3=15,RA4=60 D WHY11 ;staff
"RTN","RASTED",138,0)
WHYMSG W:'RA2 !!?12,"No data have been entered for ",$S(RA3'=13:"residents/staff",1:"diagnoses")," yet.",!
"RTN","RASTED",139,0)
WHYMSG2 W !?12,$C(7),"The selected case belongs to a print set,",!?12,"Please use the 'Report Enter/Edit' option",!?12,"to enter data for ",$S(RA3=99:"residents/staff/diagnoses",RA3'=13:"residents/staff",1:"diagnoses"),".",!!
"RTN","RASTED",140,0)
 Q
"RTN","RASTED",141,0)
WHY11 Q:'+$P(RA0,"^",RA3)
"RTN","RASTED",142,0)
 S RA2=1 W !!?2,$P(^DD(70.03,RA3,0),"^")," :",?35
"RTN","RASTED",143,0)
 W:RA3'=13 $P(^VA(200,+$P(RA0,"^",RA3),0),"^") W:RA3=13 $P(^RA(78.3,+$P(RA0,"^",RA3),0),"^") W !
"RTN","RASTED",144,0)
 S RA5=$P($P(^DD(70.03,RA4,0),"^",4),";") Q:'$O(^RADPT(DA(2),"DT",DA(1),"P",DA,RA5,0))
"RTN","RASTED",145,0)
 S RA1=0 W !?4,$P(^DD(70.03,RA4,0),"^")," :"
"RTN","RASTED",146,0)
 F  S RA1=$O(^RADPT(DA(2),"DT",DA(1),"P",DA,RA5,RA1)) Q:'RA1  I +^(RA1,0) W ?37 W:RA3'=13 $P($G(^VA(200,+^(0),0)),"^") W:RA3=13 $P($G(^RA(78.3,+^(0),0)),"^") W !
"RTN","RASTED",147,0)
 Q
"RTN","RASTED",148,0)
WHY2 ;explain why diags prompts are skipped
"RTN","RASTED",149,0)
 N RA3 S RA3=13,RA4=13.1 G WHY1
"RTN","RASTREQ")
0^27^B55165659^B50319772
"RTN","RASTREQ",1,0)
RASTREQ ;HISC/CAH,GJC AISC/MJK-Status Requirements Check Routine ;06/05/09  10:08
"RTN","RASTREQ",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,10,23,40,56,99**;Mar 16, 1998;Build 5
"RTN","RASTREQ",3,0)
 ;Supported IA #10104 UP^XLFSTR
"RTN","RASTREQ",4,0)
 ;Supported IA #1367 LKUP^XPDKEY
"RTN","RASTREQ",5,0)
 ;Supported IA #10060 ^VA(200
"RTN","RASTREQ",6,0)
 ;Supported IA #10076 ^XUSEC(
"RTN","RASTREQ",7,0)
 ;Supported IA #2056 GET1^DIQ and GETS^DIQ
"RTN","RASTREQ",8,0)
 ; Called by 
"RTN","RASTREQ",9,0)
 ; (1) Stat Track's [RA STATUS CHANGE]'s fld EXAM STATUS' input transform
"RTN","RASTREQ",10,0)
 ; (2) ASK+22^RASTED, if user "^" out of stat trk editing
"RTN","RASTREQ",11,0)
 ; (3) Cancel an Exam's [RA CANCEL]'s fld EXAM STATUS' input transform
"RTN","RASTREQ",12,0)
 ; (4) Enter Last Past Visit Before DHCP's [RA LAST PAST VISIT]'s ""
"RTN","RASTREQ",13,0)
 ;
"RTN","RASTREQ",14,0)
 ; Instead of using RAIMGTY, recalculate
"RTN","RASTREQ",15,0)
 ; the imaging type using the imaging type on the exam node because
"RTN","RASTREQ",16,0)
 ; status updating through report entry/edit, batch verify, and several
"RTN","RASTREQ",17,0)
 ; other options is NOT screened by sign-on imaging type, so does not
"RTN","RASTREQ",18,0)
 ; stay the same through a user's session.
"RTN","RASTREQ",19,0)
 ;
"RTN","RASTREQ",20,0)
 ; 'RAMES1' is used to display which Exam Status required fields are
"RTN","RASTREQ",21,0)
 ; not populated.  This only applies to the 'Status Tracking Of Exams'
"RTN","RASTREQ",22,0)
 ; option.
"RTN","RASTREQ",23,0)
 ;
"RTN","RASTREQ",24,0)
 ; If tracking ^-out, this rtn would be called outside of edt tmpl,
"RTN","RASTREQ",25,0)
 ; and thus the DA vars would not be defined, so we need to set them here
"RTN","RASTREQ",26,0)
 ;
"RTN","RASTREQ",27,0)
 S:'$D(DA)#2 DA=RACNI S:'$D(DA(1))#2 DA(1)=RADTI S:'$D(DA(2))#2 DA(2)=RADFN
"RTN","RASTREQ",28,0)
 ; If Fileman enter/edit, we need to define RADFN, RADTI, RACNI so the
"RTN","RASTREQ",29,0)
 ; nuc med checks won't bomb
"RTN","RASTREQ",30,0)
 S:'$D(RACNI)#2 RACNI=DA S:'$D(RADTI)#2 RADTI=DA(1) S:'$D(RADFN)#2 RADFN=DA(2)
"RTN","RASTREQ",31,0)
 ;
"RTN","RASTREQ",32,0)
 S RAIMGTYI=+$P($G(^RADPT(DA(2),"DT",DA(1),0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U,1),RASAVTYJ=RAIMGTYJ
"RTN","RASTREQ",33,0)
 S RAMES1="W:$G(K)=$P($G(^RA(72,+$G(RANXT72),0)),U,3)&('$D(ZTQUEUED)#2) !?3,""No '"",RAZ,""'"",?35,"" entered for this exam.""" ; display if at the ranext exm stat level
"RTN","RASTREQ",34,0)
 S RAXX=+$G(X)
"RTN","RASTREQ",35,0)
 I '$D(^RA(72,RAXX,0))!(RAIMGTYJ']"") D  Q
"RTN","RASTREQ",36,0)
 . K X W:'$D(ZTQUEUED)#2 !?3,"Error: cannot determine Imaging Type of exam.  Contact IRM."
"RTN","RASTREQ",37,0)
 . K RAMES1,RAXX
"RTN","RASTREQ",38,0)
 . Q
"RTN","RASTREQ",39,0)
 N RA,RASN,RASTI,RADES,RAOKAY,RA3
"RTN","RASTREQ",40,0)
 ; RADES = order seq. desired, RAOKAY= actual order seq. okay'd
"RTN","RASTREQ",41,0)
 S X1=$G(^RA(72,RAXX,0)),RADES=$P(X1,U,3)
"RTN","RASTREQ",42,0)
 I $$LKUP^XPDKEY(+$P(X1,"^",4))]"",'$D(^XUSEC($$LKUP^XPDKEY(+$P(X1,"^",4)),DUZ)) K X W:'$D(ZTQUEUED)#2 !?3,"You do not have the proper access privileges to ",!?3,"change this exam to this status" Q
"RTN","RASTREQ",43,0)
 S RAJ=^RADPT(DA(2),"DT",DA(1),"P",DA,0),RAOR=-1
"RTN","RASTREQ",44,0)
 S RABEFORE=$P($G(^RA(72,+$P(RAJ,U,3),0)),U,3) ; current order seq
"RTN","RASTREQ",45,0)
 ; Don't need to set RAORDIFN,RACS,RAPRIT,RAF5
"RTN","RASTREQ",46,0)
 I '$D(^RA(72,"AA",RAIMGTYJ,0,RAXX)) D LOOP^RASTREQ1 S RAIMGTYJ=RASAVTYJ
"RTN","RASTREQ",47,0)
 I $D(^RA(72,"AA",RAIMGTYJ,0,RAXX)) D CANCEL^RASTREQ1
"RTN","RASTREQ",48,0)
 S RAIMGTYJ=RASAVTYJ
"RTN","RASTREQ",49,0)
 ; Can't use X to determine if status change to next was successful
"RTN","RASTREQ",50,0)
 ; due to looping thru all status levels for this img type
"RTN","RASTREQ",51,0)
 ; chk if calculated order is at NEXT or higher level
"RTN","RASTREQ",52,0)
 ; RAAFTER is set in rastreq1; it has 2 meanings :
"RTN","RASTREQ",53,0)
 ;   upon return from rastreq1, RAAFTER means highest seq order qualified
"RTN","RASTREQ",54,0)
 ;   upon exit from this rtn,   RAAFTER means actual seq order used
"RTN","RASTREQ",55,0)
 I RABEFORE<RAAFTER D  G MSG
"RTN","RASTREQ",56,0)
 . I RADES<RAAFTER S RAOKAY=RADES
"RTN","RASTREQ",57,0)
 . E  S RAOKAY=RAAFTER
"RTN","RASTREQ",58,0)
 . Q
"RTN","RASTREQ",59,0)
 I RAAFTER<RABEFORE D  G MSG
"RTN","RASTREQ",60,0)
 . I RADES<RAAFTER S RAOKAY=RADES
"RTN","RASTREQ",61,0)
 . E  S RAOKAY=RAAFTER
"RTN","RASTREQ",62,0)
 . Q
"RTN","RASTREQ",63,0)
 ; at this point RAAFTER=RABEFORE
"RTN","RASTREQ",64,0)
 I RADES<RAAFTER S RAOKAY=RADES
"RTN","RASTREQ",65,0)
 E  S RAOKAY=RABEFORE
"RTN","RASTREQ",66,0)
MSG I RAOKAY=RABEFORE K X W:'$D(ZTQUEUED)#2 !?5," ...exam status not changed" G KOUT2
"RTN","RASTREQ",67,0)
 S X=$O(^RA(72,"AA",RAIMGTYJ,RAOKAY,0))
"RTN","RASTREQ",68,0)
 S:$D(RANEXT) RANEXT=^RA(72,+X,0) ;set existing RANEXT to ok'd status
"RTN","RASTREQ",69,0)
 I RAOKAY<RABEFORE W:'$D(ZTQUEUED)#2 !?5," ...exam status backed down to '",$P($G(^RA(72,+X,0)),U),"'" G KOUT2
"RTN","RASTREQ",70,0)
 I RAOKAY<RADES W:'$D(ZTQUEUED)#2 !!?5," ...though upgraded, new status level (",$P($G(^RA(72,+$O(^RA(72,"AA",RAIMGTYJ,RAOKAY,0)),0)),U),")",!?5,"is not as high as the desired level (",$P($G(^RA(72,+$O(^RA(72,"AA",RAIMGTYJ,RADES,0)),0)),U),")",!
"RTN","RASTREQ",71,0)
KOUT1 ; check for higher qualifying status(es)
"RTN","RASTREQ",72,0)
 G:RAOKAY'<RAAFTER!(RAOKAY=9) KOUT2 S RA3=RAOKAY
"RTN","RASTREQ",73,0)
 W !!,"This case also qualifies for higher status(es) :",!
"RTN","RASTREQ",74,0)
 F  S RA3=$O(^RA(72,"AA",RAIMGTYJ,RA3)) Q:RA3=""  Q:RA3>RAAFTER  W:'$D(ZTQUEUED)#2 ?$X+4,$P($G(^RA(72,$O(^(RA3,0)),0)),U)
"RTN","RASTREQ",75,0)
 W:'$D(ZTQUEUED)#2 !!,"Since Status Tracking can only upgrade one status at a time,",!,"please edit this exam again.",!
"RTN","RASTREQ",76,0)
KOUT2 S RAAFTER=RAOKAY ;return as actual seq order used, not nec. highest
"RTN","RASTREQ",77,0)
 K RAIMGTYI,RAIMGTYJ,RAMES1,RAZ,RAXX,RAJ,RAS,RAK,RAE,X1,RASAVTYJ
"RTN","RASTREQ",78,0)
 Q
"RTN","RASTREQ",79,0)
 ;
"RTN","RASTREQ",80,0)
1 ;Technologist Check
"RTN","RASTREQ",81,0)
 N DIERR
"RTN","RASTREQ",82,0)
 S RA("TECH")="" I $O(^RADPT(DA(2),"DT",DA(1),"P",DA,"TC",0))>0 S RA("TECH")=+^($O(^(0)),0) S RA("TECH")=$$GET1^DIQ(200,RA("TECH")_",",.01)
"RTN","RASTREQ",83,0)
 I RA("TECH")']"" K X S RAZ="technologist" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",84,0)
 K RA("TECH") Q
"RTN","RASTREQ",85,0)
 ;
"RTN","RASTREQ",86,0)
2 ;Interpreting Physician Check
"RTN","RASTREQ",87,0)
 N DIERR
"RTN","RASTREQ",88,0)
 I $$GET1^DIQ(200,$P(RAJ,"^",12)_",",.01)="",$$GET1^DIQ(200,$P(RAJ,"^",15)_",",.01)="" K X S RAZ="interpreting staff or resident" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",89,0)
 Q
"RTN","RASTREQ",90,0)
 ;
"RTN","RASTREQ",91,0)
3 ;Detailed Procedure Check
"RTN","RASTREQ",92,0)
 S RAZ="detailed procedure" I '$D(^RAMIS(71,+$P(RAJ,"^",2),0)) K X X:$D(RAMES1) RAMES1 Q
"RTN","RASTREQ",93,0)
 S RAJ1=$G(^RAMIS(71,+$P(RAJ,"^",2),0)) I "DS"'[$P(RAJ1,"^",6) K X X:$D(RAMES1) RAMES1 Q
"RTN","RASTREQ",94,0)
 S RAZ="detailed procedure (no CPT code)" I $P(RAJ1,"^",9)']"" K X X:$D(RAMES1) RAMES1 Q
"RTN","RASTREQ",95,0)
 Q
"RTN","RASTREQ",96,0)
 ;
"RTN","RASTREQ",97,0)
4 ;Film Data Check
"RTN","RASTREQ",98,0)
 I '$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"F",0)) K X S RAZ="film data" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",99,0)
 Q
"RTN","RASTREQ",100,0)
 ;
"RTN","RASTREQ",101,0)
5 ;Diagnostic Code Check
"RTN","RASTREQ",102,0)
 I '$D(^RA(78.3,+$P(RAJ,"^",13),0)) K X S RAZ="diagnostic code" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",103,0)
 Q
"RTN","RASTREQ",104,0)
 ;
"RTN","RASTREQ",105,0)
6 ;Camera/Equipment/Room Check
"RTN","RASTREQ",106,0)
 S RAE=$S($D(RAMDV):$P(RAMDV,"^",9),1:1) I RAE,'$D(^RA(78.6,+$P(RAJ,"^",18),0)) K X S RAZ="camera/equip/room" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",107,0)
 Q
"RTN","RASTREQ",108,0)
 ;
"RTN","RASTREQ",109,0)
11 ;Report Entered and not just a stub rec for Img/PACS Check
"RTN","RASTREQ",110,0)
 I '$D(^RARPT(+$P(RAJ,"^",17),0)) G NORPT
"RTN","RASTREQ",111,0)
 ; since there's a rpt ptr, must check if the rpt is just a stub rpt
"RTN","RASTREQ",112,0)
 N RA17,RA0 ; use logic from RAREG
"RTN","RASTREQ",113,0)
 S RA17=+$P(RAJ,"^",17)
"RTN","RASTREQ",114,0)
 I $$STUB^RAEDCN1(RA17) G NORPT ; rpt is an image stub
"RTN","RASTREQ",115,0)
 Q
"RTN","RASTREQ",116,0)
NORPT ; either no report yet, or report is stub
"RTN","RASTREQ",117,0)
 K X S RAZ="report" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",118,0)
 Q
"RTN","RASTREQ",119,0)
 ;
"RTN","RASTREQ",120,0)
12 ;Report Verified Check
"RTN","RASTREQ",121,0)
 D 11:$P(RAS,"^",11)'="Y" I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)'="V" K X S RAZ="report verification" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",122,0)
 Q
"RTN","RASTREQ",123,0)
 ;
"RTN","RASTREQ",124,0)
16 ;Impression Entry Check
"RTN","RASTREQ",125,0)
 ; In Phase 1, for Elec. filed rpts, skip this even if div. param requires it
"RTN","RASTREQ",126,0)
 I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)="EF" Q
"RTN","RASTREQ",127,0)
 I $O(^RARPT(+$P(RAJ,"^",17),"I",0))'>0 K X S RAZ="impression" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",128,0)
 Q
"RTN","RASTREQ",129,0)
13 ;Procedure Modifers Check
"RTN","RASTREQ",130,0)
 I '$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"M",0)) K X S RAZ="procedure modifier" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",131,0)
 Q
"RTN","RASTREQ",132,0)
14 ;CPT Modifiers Check
"RTN","RASTREQ",133,0)
 I '$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CMOD",0)) K X S RAZ="CPT modifiers" X:$D(RAMES1) RAMES1
"RTN","RASTREQ",134,0)
 Q
"RTN","RASTREQ",135,0)
 ;
"RTN","RASTREQ",136,0)
HELP ; Called from 'Help Text' node in DD(70.03,3,4).
"RTN","RASTREQ",137,0)
 N E,RA
"RTN","RASTREQ",138,0)
 S RAJ=$G(^RADPT(DA(2),"DT",DA(1),"P",DA,0))
"RTN","RASTREQ",139,0)
 S RAIMGTYI=+$P($G(^RADPT(DA(2),"DT",DA(1),0)),U,2),RAIMGTYJ=$P($G(^RA(79.2,+RAIMGTYI,0)),U,1)
"RTN","RASTREQ",140,0)
 I RAIMGTYJ']"" W !,"ERROR:  Cannot determine imaging type of exam!" K FL,K,N,RAIMGTYI,RAIMGTYJ,RAS,RAJ Q
"RTN","RASTREQ",141,0)
 W !,"This exam meets the requirements for the following statuses:"
"RTN","RASTREQ",142,0)
 F K=0:0 S K=$O(^RA(72,"AA",RAIMGTYJ,K)) Q:K'>0  D
"RTN","RASTREQ",143,0)
 . S X="",E=+$O(^RA(72,"AA",RAIMGTYJ,K,0)) Q:E'>0
"RTN","RASTREQ",144,0)
 . I $D(^RA(72,E,0)) D
"RTN","RASTREQ",145,0)
 .. S RA(0)=$G(^RA(72,E,0)),N=$P(RA(0),U),RAS=$G(^RA(72,E,.1))
"RTN","RASTREQ",146,0)
 .. I $L(RAS) D HELP1 I $D(X) W !?10,N S FL="" ;removed D 3, done inside HELP1
"RTN","RASTREQ",147,0)
 .. Q
"RTN","RASTREQ",148,0)
 . Q
"RTN","RASTREQ",149,0)
 W:'$D(FL) !?10,"Does not meet the requirements of any status."
"RTN","RASTREQ",150,0)
 W ! K RAS,RAJ,N,K,FL,RAIMGTYI,RAIMGTYJ
"RTN","RASTREQ",151,0)
 Q
"RTN","RASTREQ",152,0)
HELP1 ; Called from 'HELP' above and 'STUFF^RASTREQ1'
"RTN","RASTREQ",153,0)
 ; 'RAJ' -> 0 node of the examination
"RTN","RASTREQ",154,0)
 ; 'E'   -> ien of the examination status
"RTN","RASTREQ",155,0)
 ; Both 'RAJ' & 'E' set in 'HELP' & 'STUFF^RASTREQ1'
"RTN","RASTREQ",156,0)
 ;
"RTN","RASTREQ",157,0)
 ;start of p99, exam status UNCHANGED if pregnancy screen is not answered for female pt bet ages 12-55
"RTN","RASTREQ",158,0)
 N RAPTAGE,RASAVE
"RTN","RASTREQ",159,0)
 S RASAVE=X ;save the value of X, since it's being replaced in DIQ call.
"RTN","RASTREQ",160,0)
 S RAPTAGE=$$PTAGE^RAUTL8(DA(2),"")
"RTN","RASTREQ",161,0)
 I $$PTSEX^RAUTL8(DA(2))="F",((RAPTAGE>11)&(RAPTAGE<56)),$$GET1^DIQ(70.03,DA_","_DA(1)_","_DA(2),32)="" S E=$P(RAJ,U,3),(N,X)="" S:$G(E) (N,X)=$P($G(^RA(72,E,0)),U) Q
"RTN","RASTREQ",162,0)
 S X=RASAVE
"RTN","RASTREQ",163,0)
 ;end p99
"RTN","RASTREQ",164,0)
 N RADIO,RADIOUZD,RAS5 S RADIO=$S($G(^RA(72,E,.5))]"":$G(^(.5)),1:"N")
"RTN","RASTREQ",165,0)
 S:$P($G(^RA(79.2,+RAIMGTYI,0)),"^",5)="Y" RADIOUZD=""
"RTN","RASTREQ",166,0)
 ;
"RTN","RASTREQ",167,0)
 ; Phase 1 Outside Reporting 100% outside work, skip all except Diag. Code
"RTN","RASTREQ",168,0)
 I $D(^RARPT(+$P(RAJ,"^",17),0)),$P(^(0),"^",5)="EF" S RAS5=$P(RAS,U,5),RAS="",$P(RAS,U,5)=RAS5 K RADIOUZD
"RTN","RASTREQ",169,0)
 ;
"RTN","RASTREQ",170,0)
 F RAK=1:1 Q:$P(RAS,"^",RAK,99)']""  D:$P(RAS,"^",RAK)="Y" @RAK
"RTN","RASTREQ",171,0)
 I $D(X),$P(RAS,"^",3)'="Y",$D(^RA(72,"AA",RAIMGTYJ,9,E)) D 3
"RTN","RASTREQ",172,0)
 I $D(X),$P(RAS,"^",16)'="Y",$D(^RA(72,"AA",RAIMGTYJ,9,E)),$D(^RA(79,+$P(^RADPT(DA(2),"DT",DA(1),0),"^",3),.1)),$P(^(.1),"^",16)="Y" D 16
"RTN","RASTREQ",173,0)
 I $D(RADIOUZD) D  ;if Radiopharm Used, then check req'd NucMed flds
"RTN","RASTREQ",174,0)
 . D EN1^RASTREQN(RADIO,RAJ)
"RTN","RASTREQ",175,0)
 . I $D(X),($$UP^XLFSTR($P($G(^RA(72,E,.6)),"^",11)="Y")) D EN1^RADOSTIK(RADFN,RADTI,RACNI)
"RTN","RASTREQ",176,0)
 . Q
"RTN","RASTREQ",177,0)
 Q
"RTN","RAUTL8")
0^17^B70605252^B38825839
"RTN","RAUTL8",1,0)
RAUTL8 ;HISC/CAH-Utility routines ;05/19/09  12:02
"RTN","RAUTL8",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45,72,99**;Mar 16, 1998;Build 5
"RTN","RAUTL8",3,0)
 ;
"RTN","RAUTL8",4,0)
 ;Called by File 70, Exam subfile, Procedure Fld 2 Input transform
"RTN","RAUTL8",5,0)
 ;RA*5*45: modified -  logic in PRC1, ASK, ASK1, & MES1 subroutines
"RTN","RAUTL8",6,0)
 ;          removed -  MES subroutine
"RTN","RAUTL8",7,0)
 ;RA*5*72 03/23/2006 BAY/GJC/KAM Remedy Call 136200 Correct UNDEF issue
"RTN","RAUTL8",8,0)
 ;RA*5.0*99 added utility for pt age and pt sex
"RTN","RAUTL8",9,0)
 ;
"RTN","RAUTL8",10,0)
 ;Supported IA #10061 reference to ^VADPT
"RTN","RAUTL8",11,0)
 ;Supported IA #10103 reference to ^XLFDT
"RTN","RAUTL8",12,0)
 ;Supported IA #10142 reference to EN^DDIOL
"RTN","RAUTL8",13,0)
 ;Supported IA #2056 reference to GET1^DIQ and GETS^DIQ
"RTN","RAUTL8",14,0)
 ;Supported IA #10104 reference to UP^XLFSTR
"RTN","RAUTL8",15,0)
 ;Supported IA #10076 reference to ^XUSEC
"RTN","RAUTL8",16,0)
 ;Supported IA #2055 reference to EXTERNAL^DILFD
"RTN","RAUTL8",17,0)
 ;Supported IA #2378 reference to ORCHK^GMRAOR
"RTN","RAUTL8",18,0)
 ;
"RTN","RAUTL8",19,0)
PRC G PRC1:'$D(^RADPT(DA(2),"DT","AP",X)) ; check for C.M. reaction
"RTN","RAUTL8",20,0)
 N RADUP S RADUP=+$$DPDT^RAUTL8(X,.DA)
"RTN","RAUTL8",21,0)
 I RADUP D ASK Q:'$D(X)
"RTN","RAUTL8",22,0)
PRC1 ; Check for C.M. reaction on this patient
"RTN","RAUTL8",23,0)
 ; +X is the IEN of the Rad/Nuc Med Procedure in file 71
"RTN","RAUTL8",24,0)
 ; RA*5*72 - Changed next line to preserve variables
"RTN","RAUTL8",25,0)
 N RAGMRAOR S RAGMRAOR=$$GMRAOR(DA(2)) Q:RAGMRAOR'=1
"RTN","RAUTL8",26,0)
 D CONTRAST^RAUTL2(+X) ;displays contrast(s) associated with procedure
"RTN","RAUTL8",27,0)
 ;use RAPMSG for CONTRAST REACTION MESSAGE field 25, file 79
"RTN","RAUTL8",28,0)
 S RAPMSG=$G(^RA(79,+$P(^RADPT(DA(2),"DT",DA(1),0),"^",3),"CON"))
"RTN","RAUTL8",29,0)
 D:RAPMSG'="" EN^DDIOL("..."_RAPMSG_"...","","!?3")
"RTN","RAUTL8",30,0)
 D EN^DDIOL("","","!") ;line feed
"RTN","RAUTL8",31,0)
 K RAPMSG
"RTN","RAUTL8",32,0)
 D:$P($G(^RAMIS(71,+X,0)),U,20)="Y" MES1 ;message only if CM used
"RTN","RAUTL8",33,0)
 Q
"RTN","RAUTL8",34,0)
ASK ; Prompt user for yes/no response
"RTN","RAUTL8",35,0)
 N RAX D EN^DDIOL("Procedure is already entered for this date. Is it ok to continue? No// ","","!!?3")
"RTN","RAUTL8",36,0)
ASK1 R RAX:DTIME
"RTN","RAUTL8",37,0)
 S:'$T!(RAX="")!(RAX["^")!("Nn"[$E(RAX)) RAX="N"
"RTN","RAUTL8",38,0)
 K:RAX="N" X Q:'$D(X)
"RTN","RAUTL8",39,0)
 I "Yy"'[$E(RAX) S RAPMSG(1)="Enter 'YES' to register patient for this procedure, or 'NO' to edit the",RAPMSG(2)="above procedure. No// ",RAPMSG(1,"F")="!!?3",RAPMSG(2,"F")="!?3" D EN^DDIOL(.RAPMSG) K RAPMSG G ASK1
"RTN","RAUTL8",40,0)
 Q
"RTN","RAUTL8",41,0)
 ;
"RTN","RAUTL8",42,0)
MES1 ; display procedure acceptance message
"RTN","RAUTL8",43,0)
 R !?5,"...Type 'OK' to acknowledge or '^' to select another procedure   ==> ",RAX:DTIME
"RTN","RAUTL8",44,0)
 S RAX=$$UP^XLFSTR(RAX)
"RTN","RAUTL8",45,0)
 I '$T!(RAX["^")!(RAX="OK") K:RAX'="OK" X K RAX,RAI Q
"RTN","RAUTL8",46,0)
 G MES1
"RTN","RAUTL8",47,0)
 ;
"RTN","RAUTL8",48,0)
STATSEL ;Select one or more order statuses
"RTN","RAUTL8",49,0)
 ;INPUT VARIABLES:
"RTN","RAUTL8",50,0)
 ;   RANO() array contains status codes prohibited from selection
"RTN","RAUTL8",51,0)
 ;OUTPUT VARIABLES:
"RTN","RAUTL8",52,0)
 ;   RAST is a string of status codes selected (ex: 1^3^8)
"RTN","RAUTL8",53,0)
 ;   RAORST() is an array of selected status codes and status names
"RTN","RAUTL8",54,0)
 ;     (ex:   RAORST(1)="DISCONTINUED", RAORST(3)="HOLD", ... )
"RTN","RAUTL8",55,0)
 K RAST,RAORST W ! S RAORSTS=$P(^DD(75.1,5,0),U,3) F I=1:1 S X=$P(RAORSTS,";",I) Q:X=""  S X1=$P(X,":",1) I '$D(RANO(X1)) S X2=$P(X,":",2),RAORST(X1)=X2
"RTN","RAUTL8",56,0)
 W !!,"Select statuses to include on report.",! S X1="" F  S X1=$O(RAORST(X1)) Q:X1=""  W !?5,$J(X1,2,0)_"   "_RAORST(X1)
"RTN","RAUTL8",57,0)
STAT W ! K DIR S DIR(0)="L" D ^DIR Q:'$D(Y(0))
"RTN","RAUTL8",58,0)
 S RAST="" F I=1:1 S RASTX=$P(Y(0),",",I) Q:RASTX=""  I $D(RAORST(RASTX)) S RAST=RAST_"^"_RASTX
"RTN","RAUTL8",59,0)
 S RAST=$E(RAST,2,99) I RAST="" W !,"  ?? Sorry, invalid status selection.  Please try again.",! G STAT
"RTN","RAUTL8",60,0)
 S I="" F  S I=$O(RAORST(I)) Q:I=""  I RAST'[I K RAORST(I)
"RTN","RAUTL8",61,0)
 K RASTX,I,X,X1,X2 Q
"RTN","RAUTL8",62,0)
 ;
"RTN","RAUTL8",63,0)
 ;INPUT TRANSFORM FOR SECONDARY INTERPRETING RESIDENT
"RTN","RAUTL8",64,0)
S() ; do not enter primary OR SAME SEC in secondary interpreting resident
"RTN","RAUTL8",65,0)
 I '$D(X)!('$D(DA(3))) G S2
"RTN","RAUTL8",66,0)
 I '$D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0)) G S2
"RTN","RAUTL8",67,0)
 I $D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),"SRR","B",+Y)) Q 0 ;SAME SEC RES
"RTN","RAUTL8",68,0)
 I $P(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0),"^",12)=+Y Q 0
"RTN","RAUTL8",69,0)
 Q 1
"RTN","RAUTL8",70,0)
S2 I '$D(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q 0
"RTN","RAUTL8",71,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SRR","B",+Y)) Q 0 ;SAME SEC RES
"RTN","RAUTL8",72,0)
 I $P(^RADPT(DA(2),"DT",DA(1),"P",DA,0),"^",12)=+Y Q 0
"RTN","RAUTL8",73,0)
 Q 1
"RTN","RAUTL8",74,0)
 ;INPUT TRANSFORM FOR SECONDARY INTERPRETING STAFF
"RTN","RAUTL8",75,0)
SSR() ; do not enter primary OR SAME SEC in secondary interpreting staff
"RTN","RAUTL8",76,0)
 I '$D(X)!('$D(DA(3))) G SSR2
"RTN","RAUTL8",77,0)
 I '$D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0)) G SSR2
"RTN","RAUTL8",78,0)
 I $D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),"SSR","B",+Y)) Q 0 ;SAME SEC STF
"RTN","RAUTL8",79,0)
 I $P(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0),"^",15)=+Y Q 0
"RTN","RAUTL8",80,0)
 Q 1
"RTN","RAUTL8",81,0)
SSR2 I '$D(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q 0
"RTN","RAUTL8",82,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SSR","B",+Y)) Q 0 ;SAME SEC STF
"RTN","RAUTL8",83,0)
 I $P(^RADPT(DA(2),"DT",DA(1),"P",DA,0),"^",15)=+Y Q 0
"RTN","RAUTL8",84,0)
 Q 1
"RTN","RAUTL8",85,0)
 ;INPUT TRANSFORM FOR PRIMARY INTERPRETING RESIDENT
"RTN","RAUTL8",86,0)
 ; *** NOT USED - See EN ***
"RTN","RAUTL8",87,0)
PRRS() ; do not enter secondary into primary interpreting resident screen
"RTN","RAUTL8",88,0)
 ; called from input transform ^DD(70.03,12,0)
"RTN","RAUTL8",89,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SRR","B",+Y)) Q 0
"RTN","RAUTL8",90,0)
 Q 1
"RTN","RAUTL8",91,0)
 ;INPUT TRANSFORM FOR PRIMARY INTERPRETING STAFF
"RTN","RAUTL8",92,0)
 ; *** NOT USED - See EN ***
"RTN","RAUTL8",93,0)
PSRS() ; do not enter secondary into primary interpreting staff screen
"RTN","RAUTL8",94,0)
 ; called from input transform ^DD(70.03,15,0)
"RTN","RAUTL8",95,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SSR","B",+Y)) Q 0
"RTN","RAUTL8",96,0)
 Q 1
"RTN","RAUTL8",97,0)
EN(X,FLD,RA) ;Input transform screen for Primary Staff, Primary Res
"RTN","RAUTL8",98,0)
 ;Used by fields 70.03,12 & 70.03,15.  If 'Primary' is found in
"RTN","RAUTL8",99,0)
 ; the 'Secondary' multiple then delete the 'Secondary' entry.
"RTN","RAUTL8",100,0)
 ; X = 'Primary' IEN,  FLD = 'Secondary' mult. to check,  RA = DA array
"RTN","RAUTL8",101,0)
 N DA,DEL,HDR,IEN,NODE,SAVEX,SUBDD,XREF
"RTN","RAUTL8",102,0)
 S NODE=$S(FLD=60:"SSR",FLD=70:"SRR",1:""),SAVEX=X
"RTN","RAUTL8",103,0)
 S SUBDD=$S(FLD=60:70.11,FLD=70:70.09,1:""),(IEN,DEL)=0
"RTN","RAUTL8",104,0)
 I (NODE="")!(X'>0)!(FLD'>0)!(SUBDD'>0) Q
"RTN","RAUTL8",105,0)
 F  S IEN=$O(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,"B",X,IEN)) Q:IEN'>0  D
"RTN","RAUTL8",106,0)
 . S XREF=0
"RTN","RAUTL8",107,0)
 . F  S XREF=$O(^DD(SUBDD,.01,1,XREF)) Q:XREF'>0  D
"RTN","RAUTL8",108,0)
 .. S (D0,DA(3))=RA(2),(D1,DA(2))=RA(1),(D2,DA(1))=RA,(D3,DA)=IEN,X=SAVEX
"RTN","RAUTL8",109,0)
 .. I $G(^DD(SUBDD,.01,1,XREF,2))]"" X ^(2)
"RTN","RAUTL8",110,0)
 .. Q
"RTN","RAUTL8",111,0)
 . K ^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,IEN,0) S DEL=DEL+1
"RTN","RAUTL8",112,0)
 . Q
"RTN","RAUTL8",113,0)
 I DEL D
"RTN","RAUTL8",114,0)
 . S HDR=$G(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0)) Q:HDR=""
"RTN","RAUTL8",115,0)
 . S HDR(3)=+$O(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0))
"RTN","RAUTL8",116,0)
 . S HDR(4)=$P(HDR,U,4)-DEL
"RTN","RAUTL8",117,0)
 . S:HDR(3)'>0 HDR(3)="" S:HDR(4)'>0 HDR(4)=""
"RTN","RAUTL8",118,0)
 . S $P(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0),U,3,4)=HDR(3)_U_HDR(4)
"RTN","RAUTL8",119,0)
 . Q
"RTN","RAUTL8",120,0)
 S X=SAVEX
"RTN","RAUTL8",121,0)
 Q
"RTN","RAUTL8",122,0)
DPDT(RAPRC,RAY) ; Check for registration of duplicate procedures on the same
"RTN","RAUTL8",123,0)
 ; date/time.  Called from PRC above.
"RTN","RAUTL8",124,0)
 ; INPUT VARIABLES
"RTN","RAUTL8",125,0)
 ; 'RAPRC' --> IEN of the procedure (71)
"RTN","RAUTL8",126,0)
 ; 'RAY'   --> DA array i.e, DA, DA(1), & DA(2)
"RTN","RAUTL8",127,0)
 ; OUTPUT VARIABLES
"RTN","RAUTL8",128,0)
 ; 'RAFLG' --> RAFLG=1 procedure registered for this date/time
"RTN","RAUTL8",129,0)
 ;         --> RAFLG=0 initial registration for procedure@date/time
"RTN","RAUTL8",130,0)
 N RA72,RABDT,RACIEN,RAEDT,RAFLG,RAI S RAFLG=0
"RTN","RAUTL8",131,0)
 S RABDT=RAY(1)\1,RAEDT=RABDT_".9999",RAI=RABDT-.0000001
"RTN","RAUTL8",132,0)
 F  S RAI=$O(^RADPT(RAY(2),"DT","AP",RAPRC,RAI)) Q:RAI'>0!(RAI>RAEDT)  D  Q:RAFLG
"RTN","RAUTL8",133,0)
 . Q:RAI=RAY(1)  ; At this point our exam status is 'WAITING FOR EXAM'
"RTN","RAUTL8",134,0)
 . S RACIEN=$O(^RADPT(RAY(2),"DT","AP",RAPRC,RAI,0)) Q:'RACIEN
"RTN","RAUTL8",135,0)
 . S RA72=+$P($G(^RADPT(RAY(2),"DT",RAI,"P",RACIEN,0)),U,3) ;xam stat
"RTN","RAUTL8",136,0)
 . S RA72(3)=$P($G(^RA(72,RA72,0)),U,3)
"RTN","RAUTL8",137,0)
 . I RA72(3)'=0 S RAFLG=1 ; cancelled exams are not taken into account
"RTN","RAUTL8",138,0)
 . Q
"RTN","RAUTL8",139,0)
 Q RAFLG
"RTN","RAUTL8",140,0)
SCRN(RADA,RARS,Y,RALVL) ; check if the primary or secondary int'ng staff
"RTN","RAUTL8",141,0)
 ; or resident has access to a location or locations which have
"RTN","RAUTL8",142,0)
 ; an imaging type which match the imaging type of the examination.
"RTN","RAUTL8",143,0)
 ; This screen will also check the classification of the individual to 
"RTN","RAUTL8",144,0)
 ; ensure that they are active and valid for the field being edited.
"RTN","RAUTL8",145,0)
 ;
"RTN","RAUTL8",146,0)
 ; Called from DD's: ^DD(70.03,12 - ^DD(70.03,15  - ^DD(70.03,60
"RTN","RAUTL8",147,0)
 ;                   ^DD(70.03,70 - ^DD(70.09,.01 - ^DD(70.11,.01
"RTN","RAUTL8",148,0)
 ;
"RTN","RAUTL8",149,0)
 ; Input variables:  RADA-> DA array, maps to RADFN, RADTI & RACNI
"RTN","RAUTL8",150,0)
 ;                   RARS-> Classification: Resident("R") or Staff("S")
"RTN","RAUTL8",151,0)
 ;                      Y-> selected resident/staff
"RTN","RAUTL8",152,0)
 ;                   RALVL-> "PRI"=Primary physician, "SEC"=Secondary
"RTN","RAUTL8",153,0)
 ;
"RTN","RAUTL8",154,0)
 ; Output variable: $S(1:I-Types & classification match, resident/staff
"RTN","RAUTL8",155,0)
 ;                      ok,0:no match re-select resident/staff)
"RTN","RAUTL8",156,0)
 ;
"RTN","RAUTL8",157,0)
 I $S('$D(^VA(200,+Y,"RA")):1,'$P(^("RA"),U,3):1,DT'>$P(^("RA"),U,3):1,1:0),($D(^VA(200,"ARC",RARS,+Y)))
"RTN","RAUTL8",158,0)
 Q:'$T 0 ; failed the classification part of the screen
"RTN","RAUTL8",159,0)
 Q:$D(^XUSEC("RA ALLOC",+Y)) 1 ; Resident/Staff has access to all loc's!
"RTN","RAUTL8",160,0)
 N RA7002,RACCESS
"RTN","RAUTL8",161,0)
 ; adjust RADA() due Fileman's unpredictable retention of DA() levels
"RTN","RAUTL8",162,0)
 I RALVL="SEC" D
"RTN","RAUTL8",163,0)
 . I '$D(RADA(3)) S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",164,0)
 . I $D(RADA(3)),(RADA(2)'=RADA(3)) S RA7002=$G(^RADPT(RADA(3),"DT",RADA(2),0))
"RTN","RAUTL8",165,0)
 . I $D(RADA(3)),(RADA(2)=RADA(3)) S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",166,0)
 I RALVL="PRI" S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",167,0)
 D VARACC^RAUTL6(+Y) ; set-up access array for selected resident/staff
"RTN","RAUTL8",168,0)
 Q:'$D(RACCESS(+Y,"IMG",+$P(RA7002,"^",2))) 0 ; no i-type match
"RTN","RAUTL8",169,0)
 Q 1
"RTN","RAUTL8",170,0)
 ;
"RTN","RAUTL8",171,0)
CMEDIA(RADFN,RADTI,RACNI) ;return the CM used with an exam
"RTN","RAUTL8",172,0)
 ;input: RADFN=patient DFN, RADTI=inv. date/time of exam, RACNI=exam IEN
"RTN","RAUTL8",173,0)
 ;return: contrast media administered to the patient during an exam
"RTN","RAUTL8",174,0)
 N RAI,RAS S RAI=0,RAS=""
"RTN","RAUTL8",175,0)
 F  S RAI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",RAI)) Q:'RAI  D
"RTN","RAUTL8",176,0)
 .S RAI(0)=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",RAI,0)),U)
"RTN","RAUTL8",177,0)
 .S RAS=RAS_$$EXTERNAL^DILFD(70.3225,.01,"",RAI(0))_", "
"RTN","RAUTL8",178,0)
 Q $P(RAS,", ",1,($L(RAS,", ")-1))
"RTN","RAUTL8",179,0)
 ;
"RTN","RAUTL8",180,0)
GMRAOR(RADA2) ;look for a contrast media reaction
"RTN","RAUTL8",181,0)
 N D,D0,D1,D2,D3,DA,DC,DD,DFN,DG,DH,DI,DIC,DIE,DIEDA,DIEL,DIETMP,DIEXREF,DIFLD,DIIENS,DIOV,DIP,DK,DL,DLAYGO,DM,DN,DOV,DP,DQ,DR,X,Y
"RTN","RAUTL8",182,0)
 Q $$ORCHK^GMRAOR(RADA2,"CM")
"RTN","RAUTL8",183,0)
 ;
"RTN","RAUTL8",184,0)
PTAGE(DFN,RADTST) ;return pt age, added by p#99
"RTN","RAUTL8",185,0)
 ;input = DFN pt ien
"RTN","RAUTL8",186,0)
 ;      = RADTST date to process pt age from; if blank, use today's date
"RTN","RAUTL8",187,0)
 ;output = pt age
"RTN","RAUTL8",188,0)
 N RADAYS,VADM,VA,VAERR,%
"RTN","RAUTL8",189,0)
 S:RADTST="" RADTST=$$DT^XLFDT()
"RTN","RAUTL8",190,0)
 D DEM^VADPT   ; $P(VADM(3),"^") DOB of patient, internal
"RTN","RAUTL8",191,0)
 S RADAYS=$$FMDIFF^XLFDT(RADTST,$P(VADM(3),"^"),3)
"RTN","RAUTL8",192,0)
 Q RADAYS\365.25
"RTN","RAUTL8",193,0)
 ;
"RTN","RAUTL8",194,0)
PTSEX(DFN) ;return pt sex, added by p#99
"RTN","RAUTL8",195,0)
 ;input = pt dfn
"RTN","RAUTL8",196,0)
 ;output = pt sex (M=for MALE, F=for FEMALE)
"RTN","RAUTL8",197,0)
 N VADM,VA,VAERR,% D DEM^VADPT
"RTN","RAUTL8",198,0)
 Q $P(VADM(5),U)
"RTN","RAUTL8",199,0)
PRSCR(RADFN,RADTI,RACNI,RAFRMT) ;return pregnancy screen
"RTN","RAUTL8",200,0)
 ;input: radfn = pt dfn
"RTN","RAUTL8",201,0)
 ;       radti = inverse dt
"RTN","RAUTL8",202,0)
 ;       racni = ien of exam sub
"RTN","RAUTL8",203,0)
 ;       rafrmt = E for External format or I for Internal format
"RTN","RAUTL8",204,0)
 ;return = pregnancy screen
"RTN","RAUTL8",205,0)
 N RAIENS,RAOUT
"RTN","RAUTL8",206,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL8",207,0)
 D GETS^DIQ(70.03,RAIENS,"32",RAFRMT,"RAOUT")
"RTN","RAUTL8",208,0)
 Q $G(RAOUT(70.03,RAIENS,32,RAFRMT))
"RTN","RAUTL8",209,0)
PRSCOM(RADFN,RADTI,RACNI) ;return pregnancy screen comment
"RTN","RAUTL8",210,0)
 ;input: radfn = pt dfn
"RTN","RAUTL8",211,0)
 ;       radti = inverse dt
"RTN","RAUTL8",212,0)
 ;       racni = ien of exam sub
"RTN","RAUTL8",213,0)
 ;return = pregnancy screen comment
"RTN","RAUTL8",214,0)
 N RAIENS,RAOUT
"RTN","RAUTL8",215,0)
 S RAIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","RAUTL8",216,0)
 D GETS^DIQ(70.03,RAIENS,"80","E","RAOUT")
"RTN","RAUTL8",217,0)
 Q $G(RAOUT(70.03,RAIENS,80,"E"))
"RTN","RAUTL8",218,0)
PRCEXA(RADFN) ;return a previous case exam
"RTN","RAUTL8",219,0)
 ;input:  radfn = pt dfn
"RTN","RAUTL8",220,0)
 ;
"RTN","RAUTL8",221,0)
 ;output: racexa(0) =radti^racni, where radti=inverse date ien and racni=record ien
"RTN","RAUTL8",222,0)
 N RADTIEN,RACNIEN
"RTN","RAUTL8",223,0)
 S RADTIEN=$O(^RADPT(RADFN,"DT",0)),RACNIEN=9999,RACNIEN=$O(^RADPT(RADFN,"DT",RADTIEN,"P",RACNIEN),-1)
"RTN","RAUTL8",224,0)
 Q RADTIEN_U_RACNIEN
"RTN","RAUTL8",225,0)
PRACTO(RADFN) ;returns previous active order IEN of file #75.1 or null if no previous order
"RTN","RAUTL8",226,0)
 ;input  radfn = pt dfn
"RTN","RAUTL8",227,0)
 ;output  = ien of #75.1
"RTN","RAUTL8",228,0)
 N RA751IEN,RA751PR
"RTN","RAUTL8",229,0)
 S RA751PR=""
"RTN","RAUTL8",230,0)
 S RA751IEN=" " F  S RA751IEN=$O(^RAO(75.1,"B",RADFN,RA751IEN),-1) Q:RA751IEN'>0!$G(RA751PR)  D
"RTN","RAUTL8",231,0)
 .I $$GET1^DIQ(75.1,RA751IEN,5)="ACTIVE" S RA751PR=RA751IEN
"RTN","RAUTL8",232,0)
 Q RA751PR
"RTN","RAUTL8",233,0)
PAOE() ;Entry point to enter Pregnancy field of file 75.1.  This label is being called from
"RTN","RAUTL8",234,0)
 ;RA ORDER EXAM input template.
"RTN","RAUTL8",235,0)
 ;RETURN value:  0 if unsuccessful (up arrow, timeout or problem occured), 1 if successful.
"RTN","RAUTL8",236,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,Y,X S DIR(0)="75.1,13"
"RTN","RAUTL8",237,0)
 S DIR("B")=$S($G(RAPREG)="y":"YES",$G(RAPREG)="n":"NO",$G(RAPREG)="u":"UNKNOWN",1:"")
"RTN","RAUTL8",238,0)
 S DIR("A")="PREGNANT AT TIME OF ORDER ENTRY" D ^DIR
"RTN","RAUTL8",239,0)
 Q:$D(DIRUT)!$D(DUOUT)!$D(DTOUT)!$D(DIROUT) 0
"RTN","RAUTL8",240,0)
 S RAPREG=$P(Y,"^")
"RTN","RAUTL8",241,0)
 Q 1
"RTN","RAUTL8",242,0)
 ;
"RTN","RAUTL8",243,0)
ASKSEX() ;RA*5.0*99 - Determine the sex of the patient by asking the user.
"RTN","RAUTL8",244,0)
 ;Called from the RA ORDER EXAM compiled input template.
"RTN","RAUTL8",245,0)
 ;
"RTN","RAUTL8",246,0)
 ;Question: "THE SEX OF THIS PATIENT IS NOT AVAILABLE. IS PATIENT FEMALE"
"RTN","RAUTL8",247,0)
 ;If 'Yes' Y=1; if 'No' Y=0
"RTN","RAUTL8",248,0)
 ;The default presented to the user: 'No'
"RTN","RAUTL8",249,0)
 ;
"RTN","RAUTL8",250,0)
 ;Return: the place holder value ('Y' is reset in the RA ORDER EXAM input template)
"RTN","RAUTL8",251,0)
 ;necessary for branching within that template.
"RTN","RAUTL8",252,0)
 ;
"RTN","RAUTL8",253,0)
 N DIR,DTOUT,DUOUT,DIROUT,DIRUT,RAY,X S RAY=Y S DIR(0)="Y",DIR("B")="No"
"RTN","RAUTL8",254,0)
 S DIR("A")="THE SEX OF THIS PATIENT IS NOT AVAILABLE. IS PATIENT FEMALE"
"RTN","RAUTL8",255,0)
 S DIR("?")="Enter 'YES' if patient is female, or 'NO' if patient is male."
"RTN","RAUTL8",256,0)
 D ^DIR
"RTN","RAUTL8",257,0)
 Q $S($D(DIRUT):"@999",Y=0:"@130",1:RAY)
"RTN","RAUTL8",258,0)
 ;
"RTN","RAUTL8",259,0)
ASKPREG() ;RA*5.0*99 - Evaluate the conditions to present the PREGNANCY
"RTN","RAUTL8",260,0)
 ;SCREENING (70.03 ; 32) prompt to the user. Called from the RA EXAM EDIT
"RTN","RAUTL8",261,0)
 ;input template & the RA REGISTER compiled input template.
"RTN","RAUTL8",262,0)
 ;
"RTN","RAUTL8",263,0)
 ;Input: RA0(17) (global) The IEN of the report associated with this exam.
"RTN","RAUTL8",264,0)
 ;                Note: no IEN will exist when the case is being registered.
"RTN","RAUTL8",265,0)
 ;        RADFN  (global) the IEN of the patient
"RTN","RAUTL8",266,0)
 ;            Y  (global) the place holder for the RA EXAM EDIT input template. 
"RTN","RAUTL8",267,0)
 ;
"RTN","RAUTL8",268,0)
 ;Return: the place holder value (Y = $$ASKPREG^RAUTL8) necessary for
"RTN","RAUTL8",269,0)
 ;branching within these templates.
"RTN","RAUTL8",270,0)
 ;
"RTN","RAUTL8",271,0)
 N %,DIERR,RAERR,RAGE,RAST,VAERR,X,RAY S RAY=Y
"RTN","RAUTL8",272,0)
 S RAGE=$$PTAGE^RAUTL8(RADFN,""),Y=$G(RA0(17))_","
"RTN","RAUTL8",273,0)
 D:+Y GETS^DIQ(74,Y,5,"I","RAST","RAERR")
"RTN","RAUTL8",274,0)
 S RAST=$G(RAST(74,Y,5,"I"),"")
"RTN","RAUTL8",275,0)
 I $$PTSEX^RAUTL8(RADFN)'="F"!((RAGE>55)!(RAGE<12))!(RAST="V")!(RAST="EF") S RAY="@8001"
"RTN","RAUTL8",276,0)
 Q RAY
"RTN","RAUTL8",277,0)
 ;
"UP",70,70.03,-2)
70^DT
"UP",70,70.03,-1)
70.02^P
"UP",70,70.03,0)
70.03
"VER")
8.0^22.0
"^DD",70,70.03,32,0)
PREGNANCY SCREEN^S^y:Patient answered yes;n:Patient answered no;u:Patient is unable to answer or is unsure;^0;32^Q
"^DD",70,70.03,32,3)
Enter the patient's response to the question of if she is pregnant at the time of the exam.
"^DD",70,70.03,32,21,0)
^^2^2^3090414^
"^DD",70,70.03,32,21,1,0)
This field tracks the answer given by the patient when asked if she is 
"^DD",70,70.03,32,21,2,0)
pregnant at the time of the exam.
"^DD",70,70.03,32,23,0)
^.001^1^1^3090414^^^
"^DD",70,70.03,32,23,1,0)
This field was added by RA*5.0*99.
"^DD",70,70.03,32,"DT")
3090414
"^DD",70,70.03,80,0)
PREGNANCY SCREEN COMMENT^F^^PCOMM;E1,240^K:$L(X)>240!($L(X)<3) X
"^DD",70,70.03,80,3)
Please enter comments regarding the patient's answer to the Pregnancy Screen question.  It must be 3-240 characters in length.
"^DD",70,70.03,80,21,0)
^^2^2^3090414^
"^DD",70,70.03,80,21,1,0)
This field allows comments to be collected by the individual administering
"^DD",70,70.03,80,21,2,0)
the exam regarding the patient's answer to the Pregnancy Screen question.
"^DD",70,70.03,80,23,0)
^.001^1^1^3090414^^
"^DD",70,70.03,80,23,1,0)
This field was added by RA*5.0*99.
"^DD",70,70.03,80,"DT")
3090420
"BLD",7383,6)
^89
**END**
**END**
