$TXT Created by SMITH,ROBERT at VMPDEV20.FO-BAYPINES.MED.VA.GOV  (KIDS) on Friday, 12/04/09 at 13:47
=============================================================================
Run Date: JAN 28, 2010                     Designation: PSA*3*72
Package : PSA - DRUG ACCOUNTABILITY           Priority: Mandatory
Version : 3        SEQ #56                      Status: Released
                  Compliance Date: FEB 28, 2010
=============================================================================

Associated patches: (v)PSA*3*69    <<= must be installed BEFORE `PSA*3*72'

Subject: FIX DRUG HISTORY REPORT AND PATCH PSA*3*69 LINE 2 CORRECTIONS

Category: 
  - Routine

Description:
============

 This patch addresses the following 2 problems:
  
 1.  The Drug Transaction History [PSA DRUG DISPLAY] report is not
     correctly calculating the drug balance for dispensed drugs.  Currently
     the report is adding the dispensed quantity instead of deducting it.
  
 2.  When PSA*3*69 was released, there were five new routines introduced.
     The format of the second line of those routines does not meet the 
     Standards and Conventions guidelines.
  
  
 ASSOCIATED NSR(S):
 ===================
 N/A
  
   
 ASSOCIATED REMEDY TICKETS:
 ==========================
 1.  HD0000000342000 - Dispensed units not automatically subtracting from
                       inventory
     Duplicate:
     -----------
     HD0000000339593 - Dispensed drugs not subtracted but added to
                       daily inventory
  
 2.  HD0000000335328 - Routine patch list needs editing
  
  
  
 PARTICIPATING TEST SITES:
 ========================= 
 Ann Arbor VAMC
 Manila OPC
 Maryland HCS
 Spokane VAMC
  
  
 REMEDY OVERVIEW:
 ================ 
 1.  HD000000342000 - Dispensed units not automatically subtracting from
                      inventory
  
     PROBLEM
     =======
     The Drug Transaction History [PSA DRUG DISPLAY] report is not
     correctly calculating the drug balance for dispensed drugs.  Currently
     the report is adding the dispensed quantity instead of deducting it.  
     The logic used to calculate the balance has a typo in the syntax which
     is causing the program to add the dispensed amount.
  
     RESOLUTION
     ==========
     The typo in routine that creates the Drug Transaction History report
     will be corrected so it subtracts the dispensed units from the balance
     rather than adding it.
  
  
 2.  HD0000000335328 - Routine patch list needs editing
  
     PROBLEM
     ======= 
     When PSA*3*69 was released, there were five new routines introduced.
     The format of the second line of those routines does not meet the
     Standards and Conventions guidelines of 2 asterisks (**) before and
     after the patch number.  These 5 routines currently have only 1
     asterisk (*) before and after the patch number.
  
     RESOLUTION
     ==========
     The single leading and trailing asterisk (*) of the patch number in
     the second line of PSANDCUT, PSARDCBA, PSARDCBL, PSARDCU1 and PSARDCUT
     routines will be replaced with **.  This will bring these routines in
     alignment with the Standards and Conventions guidelines.  Because this
     is just an update to a comment section and no code has been changed,
     the post-install checksum values should match the pre-install checksum
     values.
  
     Note: During the Installation Compare if the user selects the
           "Second line of Routines only" compare option, they will 
           receive the following warning message,
           '*** WARNING, you are missing one or more Patches ***'.
           This is due to the previous version that used a single leading
           and trailing * for the patch version.  
  
  
 TECHNICAL
 =========
 1. HD0000000342000 - Dispensed units not automatically subtracting from
                      inventory
  
    PSAHIS1 routine will be modified at TRANS+11 to include opening and
    closing parenthesis within the $Select statement that sets the 
    PSABAL variable.
  
    Before:
    I $P(PSATR0,"^",2)'=24 S PSABAL=$S(",1,10,11,19,"[","_$P(PSATR0,"^",2)
    _",":PSABAL+$P(PSATR0,"^",6),1:PSABAL-$P(PSATR0,"^",6))
  
    After:
    I $P(PSATR0,"^",2)'=24 S PSABAL=$S(",1,10,11,19,"[(","_$P(PSATR0,"^",2)
    _","):PSABAL+$P(PSATR0,"^",6),1:PSABAL-$P(PSATR0,"^",6))
  
  
 2. HD0000000335328 - Routine patch list needs editing
  
    The patch number in line 2 of PSANDCUT, PSARDCBA, PSARDCBL, PSARDCU1
    and PSARDCUT routines will be modified to meet SAC guidelines of 2 
    asterisks (**) leading and trailing the patch number.
  
    PROGRAMMING STANDARDS AND CONVENTIONS (SAC) 
  
    2.2.2  The second line of a routine must be in the following format:
    LABEL-optional)<ls>;;version number; package name; **pm,...pn**;
    version date;Build n
  
    Before: 
    PSANDCUT ;BIRM/MFR - NDC Utility ;07/01/08
    ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;*69*;10/24/97;Build 9
    
    PSARDCBA ;BIRM/MFR - Return Drug Batch - ListMan ;07/01/08
    ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;*69*;10/24/97;Build 9
    
    PSARDCBL ;BIRM/MHA - Return Drug Batch Work List - ListMan ;07/01/08
    ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;*69*;10/24/97;Build 9
  
    PSARDCU1 ;BIRM/MFR - Return Drug - Utilities (Cont.) ;07/01/08
    ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;*69*;10/24/97;Build 9
  
    PSARDCUT ;BIRM/MFR - Return Drug - Utilities ;07/01/08
    ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;*69*;10/24/97;Build 9 
  
    After:
    PSANDCUT ;BIRM/MFR - NDC Utility ;07/01/08
  ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**69,72**;10/24/97;Build 1
  
    PSARDCBA ;BIRM/MFR - Return Drug Batch - ListMan ;07/01/08
  ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**69,72**;10/24/97;Build 1
  
    PSARDCBL ;BIRM/MHA - Return Drug Batch Work List - ListMan ;07/01/08
  ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**69,72**;10/24/97;Build 1
  
    PSARDCU1 ;BIRM/MFR - Return Drug - Utilities (Cont.) ;07/01/08
  ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**69,72**;10/24/97;Build 1
  
    PSARDCUT ;BIRM/MFR - Return Drug - Utilities ;07/01/08
  ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**69,72**;10/24/97;Build 1
  
  
 INSTALLATION INSTRUCTIONS
 =========================
 Suggested time to install: non-peak requirement hours. The patch should be
 installed when NO Drug Accountability users are on the system.
  
 Install Time - less than 5 minutes (unless otherwise indicated)
  
 1.  Start up the Kernel Installation and Distribution System Menu
     [XPD MAIN]: 
  
          Edits and Distribution ...  
          Utilities ...  
          Installation ...  
  
     Select Kernel Installation & Distribution System Option: Installation
                                                               ---
          1      Load a Distribution
          2      Verify Checksums in Transport Global
          3      Print Transport Global
          4      Compare Transport Global to Current System
          5      Backup a Transport Global
          6      Install Package(s)
                 Restart Install of Package(s)
                 Unload a Distribution
  
 2.  From this menu, you may elect to use the following options
     (When prompted for the INSTALL NAME, enter PSA*3.0*72):
  
     a.  Backup a Transport Global - This option will create a backup
         message of any routines exported with this patch. It will
         not backup any other changes such as DD's or templates.
     b.  Compare Transport Global to Current System - This option
         will allow you to view all changes that will be made when
         this patch is installed.  It compares all components of this
         patch (routines, DD's, templates, etc.).
     c.  Verify Checksums in Transport Global - This option will
         allow you to ensure the integrity of the routines that are
         in the transport global.
  
 3.  Use the Install Package(s) option and select the package PSA*3.0*72.
  
     a.  When prompted 'Want KIDS to INHIBIT LOGONs during the
         install? NO//', answer NO.
     b.  When prompted 'Want to DISABLE Scheduled Options and Menu 
         Options and Protocols? NO//', answer NO.

Routine Information:
====================
The second line of each of these routines now looks like:
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**[Patch List]**; 10/24/97;Build 2

The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: PSAHIS1
    Before: B40519187   After: B41022189  **3,69,72**
Routine Name: PSANDCUT
    Before:  B5415723   After:  B5415723  **69,72**
Routine Name: PSARDCBA
    Before:B209116804   After:B209116804  **69,72**
Routine Name: PSARDCBL
    Before: B49662167   After: B49662167  **69,72**
Routine Name: PSARDCU1
    Before: B95984942   After: B95984942  **69,72**
Routine Name: PSARDCUT
    Before: B94123614   After: B94123614  **69,72**
 
Routine list of preceding patches: 69

=============================================================================
User Information:
Entered By  : SMITH,ROBERT J                Date Entered  : AUG 12, 2009
Completed By: WERNER,GARY                   Date Completed: JAN 28, 2010
Released By : VECE,VIRGINIA                 Date Released : JAN 28, 2010
=============================================================================


Packman Mail Message:
=====================

$END TXT
