Released PRC*5.1*126 SEQ #109
Extracted from mail message
**KIDS**:PRC*5.1*126^

**INSTALL NAME**
PRC*5.1*126
"BLD",5798,0)
PRC*5.1*126^IFCAP^0^3081112^y
"BLD",5798,1,0)
^^5^5^3081024^^^^
"BLD",5798,1,1,0)
1. GIP Issue - Zero QTY on hand
"BLD",5798,1,2,0)
 
"BLD",5798,1,3,0)
2. FGH - Fiscal Pending Report incomplete
"BLD",5798,1,4,0)
 
"BLD",5798,1,5,0)
3. Issue with cancelling a Purchase Card Order that has been reconciled 
"BLD",5798,4,0)
^9.64PA^^
"BLD",5798,6.3)
2
"BLD",5798,"KRN",0)
^9.67PA^8989.52^19
"BLD",5798,"KRN",.4,0)
.4
"BLD",5798,"KRN",.401,0)
.401
"BLD",5798,"KRN",.402,0)
.402
"BLD",5798,"KRN",.403,0)
.403
"BLD",5798,"KRN",.5,0)
.5
"BLD",5798,"KRN",.84,0)
.84
"BLD",5798,"KRN",3.6,0)
3.6
"BLD",5798,"KRN",3.8,0)
3.8
"BLD",5798,"KRN",9.2,0)
9.2
"BLD",5798,"KRN",9.8,0)
9.8
"BLD",5798,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",5798,"KRN",9.8,"NM",1,0)
PRCB2A^^0^B11997995
"BLD",5798,"KRN",9.8,"NM",2,0)
PRCPUSA^^0^B7519511
"BLD",5798,"KRN",9.8,"NM",3,0)
PRCPUTRX^^0^B11827852
"BLD",5798,"KRN",9.8,"NM",4,0)
PRCPUUIP^^0^B12242911
"BLD",5798,"KRN",9.8,"NM",5,0)
PRCHINQ^^0^B9819590
"BLD",5798,"KRN",9.8,"NM","B","PRCB2A",1)

"BLD",5798,"KRN",9.8,"NM","B","PRCHINQ",5)

"BLD",5798,"KRN",9.8,"NM","B","PRCPUSA",2)

"BLD",5798,"KRN",9.8,"NM","B","PRCPUTRX",3)

"BLD",5798,"KRN",9.8,"NM","B","PRCPUUIP",4)

"BLD",5798,"KRN",19,0)
19
"BLD",5798,"KRN",19.1,0)
19.1
"BLD",5798,"KRN",101,0)
101
"BLD",5798,"KRN",409.61,0)
409.61
"BLD",5798,"KRN",771,0)
771
"BLD",5798,"KRN",870,0)
870
"BLD",5798,"KRN",8989.51,0)
8989.51
"BLD",5798,"KRN",8989.52,0)
8989.52
"BLD",5798,"KRN",8994,0)
8994
"BLD",5798,"KRN","B",.4,.4)

"BLD",5798,"KRN","B",.401,.401)

"BLD",5798,"KRN","B",.402,.402)

"BLD",5798,"KRN","B",.403,.403)

"BLD",5798,"KRN","B",.5,.5)

"BLD",5798,"KRN","B",.84,.84)

"BLD",5798,"KRN","B",3.6,3.6)

"BLD",5798,"KRN","B",3.8,3.8)

"BLD",5798,"KRN","B",9.2,9.2)

"BLD",5798,"KRN","B",9.8,9.8)

"BLD",5798,"KRN","B",19,19)

"BLD",5798,"KRN","B",19.1,19.1)

"BLD",5798,"KRN","B",101,101)

"BLD",5798,"KRN","B",409.61,409.61)

"BLD",5798,"KRN","B",771,771)

"BLD",5798,"KRN","B",870,870)

"BLD",5798,"KRN","B",8989.51,8989.51)

"BLD",5798,"KRN","B",8989.52,8989.52)

"BLD",5798,"KRN","B",8994,8994)

"BLD",5798,"QUES",0)
^9.62^^
"BLD",5798,"REQB",0)
^9.611^2^2
"BLD",5798,"REQB",1,0)
PRC*5.1*1^2
"BLD",5798,"REQB",2,0)
PRC*5.1*117^2
"BLD",5798,"REQB","B","PRC*5.1*1",1)

"BLD",5798,"REQB","B","PRC*5.1*117",2)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
126^3081112
"PKG",455,22,1,"PAH",1,1,0)
^^5^5^3081112
"PKG",455,22,1,"PAH",1,1,1,0)
1. GIP Issue - Zero QTY on hand
"PKG",455,22,1,"PAH",1,1,2,0)
 
"PKG",455,22,1,"PAH",1,1,3,0)
2. FGH - Fiscal Pending Report incomplete
"PKG",455,22,1,"PAH",1,1,4,0)
 
"PKG",455,22,1,"PAH",1,1,5,0)
3. Issue with cancelling a Purchase Card Order that has been reconciled 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PRCB2A")
0^1^B11997995^B11510226
"RTN","PRCB2A",1,0)
PRCB2A ;WISC/(SKR@LBVAMC),PLT,DGL-ROUTINE TO PRINT RECEIVING REPORT PENDING ACTION [7/20/98 2:18pm]
"RTN","PRCB2A",2,0)
V ;;5.1;IFCAP;**126**;Oct 20, 2000;Build 2
"RTN","PRCB2A",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCB2A",4,0)
 QUIT  ;invalid entry point
"RTN","PRCB2A",5,0)
 ;
"RTN","PRCB2A",6,0)
EN ;pending fiscal action rpt
"RTN","PRCB2A",7,0)
INIT S U="^",LINE="" K %ZIS,%IS,IOP,IOC,ZTIO S %IS="MQ" D ^%ZIS Q:POP
"RTN","PRCB2A",8,0)
 S (ZSTAT,IEN,PRCQ,A,C)=0,PAGE=1
"RTN","PRCB2A",9,0)
 S $P(LINE,"=",IOM)=""
"RTN","PRCB2A",10,0)
 U IO(0) S TRM=1 S:IO=IO(0) IOC=1
"RTN","PRCB2A",11,0)
 I $D(IO("Q")) S ZTRTN="START^PRCB2A",ZTDTH="OBLIGATIONS PENDING ACTION",ZTSAVE("IOC")=1,ZTSAVE("LINE")="",ZTSAVE("PRCQ")="",ZTSAVE("PAGE")=""
"RTN","PRCB2A",12,0)
 I $D(IO("Q")) K IO("Q") D ^%ZTLOAD W !,"REQUEST QUEUED" G EXIT
"RTN","PRCB2A",13,0)
START ;Loop picks up only specific entries
"RTN","PRCB2A",14,0)
 S A="",A0="",A1="",A2="",B=0,C=" - Purchase Orders",D=""
"RTN","PRCB2A",15,0)
 D HDR,HDR1
"RTN","PRCB2A",16,0)
 S PRCQ="" F ZSTAT=10,15,20 QUIT:PRCQ  S IEN="" F  S IEN=$O(^PRC(442,"AI",ZSTAT,IEN)) Q:IEN'>0  D PRINT QUIT:PRCQ
"RTN","PRCB2A",17,0)
 I PRCQ=1 G EXIT
"RTN","PRCB2A",18,0)
 ;Loop through 2237s & 1358s looking for GFP entries with status=10
"RTN","PRCB2A",19,0)
 S IEN=0,IEN1=0,IEN2=0,B=0,C=" - 2237s & 1358s"
"RTN","PRCB2A",20,0)
 D ASK G:PRCQ EXIT D HDR2
"RTN","PRCB2A",21,0)
 F  S IEN1=$O(^PRC(420,IEN1)),IEN2=0 Q:IEN1'>0  D  G:PRCQ EXIT
"RTN","PRCB2A",22,0)
  . F  S IEN2=$O(^PRC(420,IEN1,1,IEN2)),IEN=0 Q:IEN2'>0  S D=$P($G(^PRC(420,IEN1,1,IEN2,0)),U,1) D:$G(D)'=""  Q:PRCQ
"RTN","PRCB2A",23,0)
  . . F  S IEN=$O(^PRCS(410,"AN",D,IEN)) Q:IEN'>0  D  Q:PRCQ
"RTN","PRCB2A",24,0)
  . . . S A=$G(^PRCS(410,IEN,3)) Q:A=""
"RTN","PRCB2A",25,0)
  . . . S A=$G(^PRCS(410,IEN,1)) Q:A=""  S A=$P(A,U,1) Q:A=""
"RTN","PRCB2A",26,0)
  . . . S A0=$G(^PRCS(410,IEN,0)) Q:A0=""
"RTN","PRCB2A",27,0)
  . . . S A1=$G(^PRCS(410,IEN,10)) Q:A1=""
"RTN","PRCB2A",28,0)
  . . . I $P(A0,U,4)=1&($P(A1,U,4)=10) D PRINT2(1) Q  ; form type 1358
"RTN","PRCB2A",29,0)
  . . . S A2=$G(^PRC(443,IEN,0)) Q:A2=""
"RTN","PRCB2A",30,0)
  . . . I $P(A1,U,3)=""&($P(A2,U,7)=10) D PRINT2(0) Q  ; No PO#
"RTN","PRCB2A",31,0)
 I B=0 W !!,"NO 2237s or 1358s to print"
"RTN","PRCB2A",32,0)
 E  W !!,"(Note:  '*' indicates transaction is a 1358.  All others are 2237s.)",!
"RTN","PRCB2A",33,0)
 I PRCQ="" D EN^DDIOL("END OF REPORT")
"RTN","PRCB2A",34,0)
EXIT K ZSTAT,IEN,L1,POP,ZTDTH,ZTRTN,ZTSAVE,TRM,LINE,PAGE,PRCQ,A,A0,A1,A2,B,C,D
"RTN","PRCB2A",35,0)
 D ^%ZISC
"RTN","PRCB2A",36,0)
 Q
"RTN","PRCB2A",37,0)
HDR ; 
"RTN","PRCB2A",38,0)
 U IO W @IOF W !,?70,"Page ",PAGE S PAGE=PAGE+1
"RTN","PRCB2A",39,0)
 W !,"IFCAP OBLIGATIONS PENDING ACTION REPORT",C
"RTN","PRCB2A",40,0)
 W !,?47,"PRINTED ON " D ^%D W " AT " D ^%T
"RTN","PRCB2A",41,0)
 Q
"RTN","PRCB2A",42,0)
HDR1 ;Purchase orders
"RTN","PRCB2A",43,0)
 W !,LINE,!,"P.O. NUMBER",?12,"FCP ",?18,"AMOUNT",?32,"DATE",?42,"STATUS",!,LINE,!
"RTN","PRCB2A",44,0)
 Q
"RTN","PRCB2A",45,0)
HDR2 ;GPF 2237s
"RTN","PRCB2A",46,0)
 W !,LINE,!,"TRANSACTION NUMBER",?22,"FCP ",?32,"AMOUNT",?45,"DATE",?55,"STATUS",?77,"SCP",!,LINE,!
"RTN","PRCB2A",47,0)
 Q
"RTN","PRCB2A",48,0)
PRINT ;
"RTN","PRCB2A",49,0)
 Q:'$D(^PRC(442,IEN,0))
"RTN","PRCB2A",50,0)
 I $Y+8>IOSL D ASK Q:PRCQ  D HDR1
"RTN","PRCB2A",51,0)
 W !,$P(^PRC(442,+IEN,0),U,1),?12,$P($P(^(0),U,3)," "),?18,"$"_$J($P(^(0),U,15),9,2)
"RTN","PRCB2A",52,0)
 W:$D(^PRC(442,IEN,1)) ?32,$E($P(^(1),U,15),4,5)_"-"_$E($P(^(1),U,15),6,7)_"-"_$E($P(^(1),U,15),2,3),?42,$E($S($D(^PRCD(442.3,+$P(^PRC(442,+IEN,7),U,1),0)):$P(^(0),U,1),1:""),1,39)
"RTN","PRCB2A",53,0)
 Q
"RTN","PRCB2A",54,0)
PRINT2(X) ;
"RTN","PRCB2A",55,0)
 I $Y+8>IOSL D ASK Q:PRCQ  D HDR2
"RTN","PRCB2A",56,0)
 W !,$P(A0,U,1)
"RTN","PRCB2A",57,0)
 I X=1 W "*"
"RTN","PRCB2A",58,0)
 W ?22,$P($P(^PRCS(410,IEN,3),U,1)," "),?28
"RTN","PRCB2A",59,0)
 I $D(^PRCS(410,IEN,4))=0 W "Bad record"
"RTN","PRCB2A",60,0)
 E  W "$"_$J($P(^(4),U,8),9,2),?42,$E(A,4,5),"-",$E(A,6,7),"-",$E(A,2,3)
"RTN","PRCB2A",61,0)
 W ?52,$P(^PRCD(442.3,10,0),U,1),?77,$P("NON^GPF^SF^CON^CAN",U,($P(^PRC(420,IEN1,1,IEN2,0),U,12)+1))
"RTN","PRCB2A",62,0)
 S B=B+1
"RTN","PRCB2A",63,0)
 Q
"RTN","PRCB2A",64,0)
ASK ;
"RTN","PRCB2A",65,0)
 I B>0 W !!,"(Note:  '*' indicates transaction is a 1358.  All others are 2237s.)"
"RTN","PRCB2A",66,0)
 I $E(IOST,1,2)="C-" W !!,"Press <RET> to continue or '^' to quit.  " R X:DTIME I '$T!(X="^") S PRCQ=1 Q
"RTN","PRCB2A",67,0)
 D HDR Q
"RTN","PRCB2A",68,0)
INFO ;routine provides Fiscal Service with a listing of all Purchase orders
"RTN","PRCB2A",69,0)
 ;from file 442, that have a Supply Status of 10,15,20.  These numbers
"RTN","PRCB2A",70,0)
 ;reflect IEN from file 442.3
"RTN","PRCB2A",71,0)
 ;As of PRC*5*163, the routine also lists 2237s in General Post Funds
"RTN","PRCHINQ")
0^5^B9819590^B9645635
"RTN","PRCHINQ",1,0)
PRCHINQ ;WISC/AKS-Add/Edit Surrogate Users and inquire Card Info ;6/8/96  13:38
"RTN","PRCHINQ",2,0)
 ;;5.1;IFCAP;**18,117,126**;Oct 20, 2000;Build 2
"RTN","PRCHINQ",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHINQ",4,0)
 QUIT
"RTN","PRCHINQ",5,0)
 ;
"RTN","PRCHINQ",6,0)
INQ ;Display purchase card information and allow add/editting of users
"RTN","PRCHINQ",7,0)
 ;
"RTN","PRCHINQ",8,0)
 N PRCHDA
"RTN","PRCHINQ",9,0)
 S DIC="^PRC(440.5,",DIC(0)="AEQM"
"RTN","PRCHINQ",10,0)
 S DIC("S")="I $P(^PRC(440.5,+Y,0),U,8)=DUZ"
"RTN","PRCHINQ",11,0)
 D ^DIC W !
"RTN","PRCHINQ",12,0)
 S (PRCHDA,DA)=+Y,DR="0:49" D EN^DIQ,EN^DDIOL("REPLACEMENT CHARGE CARD NUMBER: "_$P($G(^PRC(440.5,DA,50)),"^")):$P($G(^PRC(440.5,DA,50)),"^")]"" G:Y=-1 EXIT
"RTN","PRCHINQ",13,0)
 S %A="Would you like to add/delete a surrogate",%B="",%=2
"RTN","PRCHINQ",14,0)
 D ^PRCFYN G:%<1!(%=2) EXIT
"RTN","PRCHINQ",15,0)
MORE S DA(1)=PRCHDA,DIC="^PRC(440.5,"_DA(1)_",1,",DIC(0)="AEQLM"
"RTN","PRCHINQ",16,0)
 S DIC("S")="I +Y'=DUZ"
"RTN","PRCHINQ",17,0)
 D ^DIC K DIC
"RTN","PRCHINQ",18,0)
 I $P(Y,U,3)'=1 D
"RTN","PRCHINQ",19,0)
 . S DA=+Y,DIK="^PRC(440.5,"_DA(1)_",1,"
"RTN","PRCHINQ",20,0)
 . D ^DIK K Y,DA,DIK
"RTN","PRCHINQ",21,0)
 S %A="Would you like to add/delete another surrogate",%B="",%=2
"RTN","PRCHINQ",22,0)
 D ^PRCFYN G:%<1!(%=2) EXIT G MORE
"RTN","PRCHINQ",23,0)
 QUIT
"RTN","PRCHINQ",24,0)
STAT ;Amendment/Adjustment statuses from the dd, called from field #50, sub-
"RTN","PRCHINQ",25,0)
 ;field #9 of file #443.6
"RTN","PRCHINQ",26,0)
 N MOPPC S MOPPC=0
"RTN","PRCHINQ",27,0)
 I $P($G(^PRC(443.6,PRCHPO,0)),U,2)=25 S MOPPC=1
"RTN","PRCHINQ",28,0)
 S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=21:1,Z1=23:1,Z1=26:1,Z1=29:1,Z1=31:1,Z1=34:1,Z1=41:1,Z1=44:1,Z1=47:1,Z1=49:1,1:0)"
"RTN","PRCHINQ",29,0)
 S:MOPPC DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=21:1,Z1=23:1,Z1=26:1,Z1=29:1,Z1=31:1,Z1=34:1,Z1=44:1,Z1=47:1,Z1=49:1,1:0)"
"RTN","PRCHINQ",30,0)
 ;I $G(PRCHAUTH)=1 S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=21:1,Z1=23:1,Z1=26:1,Z1=29:1,Z1=31:1,Z1=34:1,Z1=41:1,Z1=44:1,Z1=47:1,Z1=49:1,Z1=51:1,1:0)"
"RTN","PRCHINQ",31,0)
 I $G(PRCHAUTH)=1 D
"RTN","PRCHINQ",32,0)
 . S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=23:1,Z1=26:1,Z1=31:1,1:0)"
"RTN","PRCHINQ",33,0)
 . S PRCHOLD=$P($G(^PRC(443.6,PRCHPO,7)),U)
"RTN","PRCHINQ",34,0)
 . I $P($G(^PRCD(442.3,PRCHOLD,0)),"(")="Paid " D
"RTN","PRCHINQ",35,0)
 . . S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=29:1,Z1=34:1,Z1=38:1,1:0)"
"RTN","PRCHINQ",36,0)
 . I $P($G(^PRCD(442.3,PRCHOLD,0)),"(")="Partial Payment " D
"RTN","PRCHINQ",37,0)
 . . S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=44:1,Z1=47:1,Z1=49:1,1:0)"
"RTN","PRCHINQ",38,0)
 D ^DIC K DIC,PRCHOLD,MOPPC S DIC=DIE,X=+Y K:Y<0 X
"RTN","PRCHINQ",39,0)
 QUIT
"RTN","PRCHINQ",40,0)
EXIT ;Kill variables and quit
"RTN","PRCHINQ",41,0)
 K Y,%A,%B,%,DIC
"RTN","PRCHINQ",42,0)
 QUIT
"RTN","PRCHINQ",43,0)
STAT1 ;Called from field #50, subfield #9, file #443.6
"RTN","PRCHINQ",44,0)
 N MOPPC S MOPPC=0
"RTN","PRCHINQ",45,0)
 I $P($G(^PRC(443.6,PRCHPO,0)),U,2)=25 S MOPPC=1
"RTN","PRCHINQ",46,0)
 S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=21:1,Z1=23:1,Z1=26:1,Z1=29:1,Z1=31:1,Z1=34:1,Z1=41:1,Z1=44:1,Z1=47:1,Z1=49:1,1:0)"
"RTN","PRCHINQ",47,0)
 S:MOPPC DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=21:1,Z1=23:1,Z1=26:1,Z1=29:1,Z1=31:1,Z1=34:1,Z1=44:1,Z1=47:1,Z1=49:1,1:0)"
"RTN","PRCHINQ",48,0)
 ;I $G(PRCHAUTH)=1 S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=21:1,Z1=23:1,Z1=26:1,Z1=29:1,Z1=31:1,Z1=34:1,Z1=41:1,Z1=44:1,Z1=47:1,Z1=49:1,Z1=51:1,1:0)"
"RTN","PRCHINQ",49,0)
 I $G(PRCHAUTH)=1 D
"RTN","PRCHINQ",50,0)
 . S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=23:1,Z1=26:1,Z1=31:1,1:0)"
"RTN","PRCHINQ",51,0)
 . S PRCHOLD=$P($G(^PRC(443.6,PRCHPO,7)),U)
"RTN","PRCHINQ",52,0)
 . I $P($G(^PRCD(442.3,PRCHOLD,0)),"(")="Paid " D
"RTN","PRCHINQ",53,0)
 . . S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=29:1,Z1=34:1,Z1=38:1,1:0)"
"RTN","PRCHINQ",54,0)
 . I $P($G(^PRCD(442.3,PRCHOLD,0)),"(")="Partial Payment " D
"RTN","PRCHINQ",55,0)
 . . S DIC("S")="S Z1=$P(^(0),U,2) I $S(Z1=44:1,Z1=47:1,Z1=49:1,1:0)"
"RTN","PRCHINQ",56,0)
 K PRCHOLD,MOPPC
"RTN","PRCHINQ",57,0)
 QUIT
"RTN","PRCHINQ",58,0)
PAID ;To check if there is any payment made for this PO
"RTN","PRCHINQ",59,0)
 I $G(PRCHAUTH)=1!($P(^PRC(442,PRCHPO,0),U,2)=25) D
"RTN","PRCHINQ",60,0)
 . S PRCHOLD=$P($G(^PRC(443.6,PRCHPO,7)),U)
"RTN","PRCHINQ",61,0)
 . I $P($G(^PRCD(442.3,PRCHOLD,0)),"(")="Paid " S PAID=1
"RTN","PRCHINQ",62,0)
 . I $P($G(^PRCD(442.3,PRCHOLD,0)),"(")="Partial Payment " S PAID=1
"RTN","PRCHINQ",63,0)
 QUIT
"RTN","PRCPUSA")
0^2^B7519511^B7213871
"RTN","PRCPUSA",1,0)
PRCPUSA ;WISC/RFJ-utility program for updating inventory point     ;30 Sep 92
"RTN","PRCPUSA",2,0)
 ;;5.1;IFCAP;**126**;Oct 20, 2000;Build 2
"RTN","PRCPUSA",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPUSA",4,0)
 S X=$$UPDATE(.PRCP) I X'="" W !!,X Q
"RTN","PRCPUSA",5,0)
 K PRCP,X Q
"RTN","PRCPUSA",6,0)
 ;
"RTN","PRCPUSA",7,0)
 ;
"RTN","PRCPUSA",8,0)
UPDATE(PRCPZ) ;  start updating inventory point
"RTN","PRCPUSA",9,0)
 ;prcpz =
"RTN","PRCPUSA",10,0)
 ;  i)        = internal inventory point number
"RTN","PRCPUSA",11,0)
 ;  item)     = item number
"RTN","PRCPUSA",12,0)
 ;  typ)      = R or C for distribution
"RTN","PRCPUSA",13,0)
 ;                   = RC for receipts
"RTN","PRCPUSA",14,0)
 ;                   = U for usage
"RTN","PRCPUSA",15,0)
 ;                   = A for adjustment
"RTN","PRCPUSA",16,0)
 ;                   = P for physical counts
"RTN","PRCPUSA",17,0)
 ;  qty)      = quantity to  add to on-hand
"RTN","PRCPUSA",18,0)
 ;  com)      = transaction register comments
"RTN","PRCPUSA",19,0)
 ;  returns error message if unsuccessful or null if successful
"RTN","PRCPUSA",20,0)
 ;
"RTN","PRCPUSA",21,0)
 I '$D(^PRCP(445,+$G(PRCPZ("I")),0)) Q "Invalid inventory location"
"RTN","PRCPUSA",22,0)
 I '$D(^PRCP(445,PRCPZ("I"),4,+$G(DUZ),0)) Q "User does not have access to the inventory point"
"RTN","PRCPUSA",23,0)
 I '$D(^PRCP(445,PRCPZ("I"),1,+$G(PRCPZ("ITEM")),0)) Q "Item is not stored in inventory point"
"RTN","PRCPUSA",24,0)
 S:'$D(PRCPZ("TYP")) PRCPZ("TYP")="" I "RCAUP"'[PRCPZ("TYP") Q "Invalid transaction type '"_PRCPZ("TYP")_"'"
"RTN","PRCPUSA",25,0)
 S:'$D(PRCPZ("QTY")) PRCPZ("QTY")=0 I "AP"'[PRCPZ("TYP"),PRCPZ("QTY")=0 Q "Quantity cannot equal zero"
"RTN","PRCPUSA",26,0)
 I PRCPZ("TYP")="RC",PRCPZ("QTY")<0 Q "For receipts, quantity must be greater than zero"
"RTN","PRCPUSA",27,0)
 I (PRCPZ("TYP")="R"!(PRCPZ("TYP")="C"))&(PRCPZ("QTY")>0) Q "For distribution (Regular or Call-in), quantity must be less than zero"
"RTN","PRCPUSA",28,0)
 ;
"RTN","PRCPUSA",29,0)
 N ORDERNO,PRCPID,PRCPUSA,TOTCOST,VALUE,X,Y,Z
"RTN","PRCPUSA",30,0)
 S VALUE=$P(^PRCP(445,PRCPZ("I"),1,PRCPZ("ITEM"),0),"^",22)
"RTN","PRCPUSA",31,0)
 I VALUE=0,PRCPZ("TYP")="P" S VALUE=$P(^PRCP(445,PRCPZ("I"),1,PRCPZ("ITEM"),0),"^",15)
"RTN","PRCPUSA",32,0)
 S TOTCOST=$J(PRCPZ("QTY")*VALUE,0,2)
"RTN","PRCPUSA",33,0)
 ;
"RTN","PRCPUSA",34,0)
 I $P(^PRCP(445,PRCPZ("I"),0),"^",6)="Y" S ORDERNO=$$ORDERNO^PRCPUTRX(PRCPZ("I"))
"RTN","PRCPUSA",35,0)
 K PRCPUSA S PRCPUSA("QTY")=PRCPZ("QTY"),PRCPUSA("INVVAL")=TOTCOST,PRCPUSA("SELVAL")=TOTCOST,PRCPUSA("REASON")="0:"_$G(PRCPZ("COM")),PRCPUSA("NODUEIN")=1,PRCPUSA("NODUEOUT")=1,PRCPUSA("OTHERPT")=""
"RTN","PRCPUSA",36,0)
 D ITEM^PRCPUUIP(PRCPZ("I"),PRCPZ("ITEM"),PRCPZ("TYP"),+$G(ORDERNO),.PRCPUSA)
"RTN","PRCPUSA",37,0)
 Q ""
"RTN","PRCPUTRX")
0^3^B11827852^B11327636
"RTN","PRCPUTRX",1,0)
PRCPUTRX ;WISC/RFJ-transaction history file 445.2 sets              ;07 Jul 92
"RTN","PRCPUTRX",2,0)
V ;;5.1;IFCAP;**1,126**;Oct 20, 2000;Build 2
"RTN","PRCPUTRX",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPUTRX",4,0)
 Q
"RTN","PRCPUTRX",5,0)
 ;
"RTN","PRCPUTRX",6,0)
 ;
"RTN","PRCPUTRX",7,0)
ADDTRAN(INVPT,ITEMDA,TRANTYPE,ORDERNO,PRCPDATA) ;  add transaction entry
"RTN","PRCPUTRX",8,0)
 ;prcpdata nodes:
"RTN","PRCPUTRX",9,0)
 ;  date)        = date of transaction (posted or issued, etc)
"RTN","PRCPUTRX",10,0)
 ;                 (optional) if not set it uses current date
"RTN","PRCPUTRX",11,0)
 ;  qty)         = quantity of transaction
"RTN","PRCPUTRX",12,0)
 ;  invval)      = inventory value
"RTN","PRCPUTRX",13,0)
 ;  selval)      = sales value
"RTN","PRCPUTRX",14,0)
 ;  avgunit)     = average unit cost
"RTN","PRCPUTRX",15,0)
 ;  selunit)     = selling unit cost
"RTN","PRCPUTRX",16,0)
 ;  pkg)         = unit per issue / units
"RTN","PRCPUTRX",17,0)
 ;                 (optional) set to current if not passed
"RTN","PRCPUTRX",18,0)
 ;  ref)         = reference number
"RTN","PRCPUTRX",19,0)
 ;  2237po)      = 2237 or purchase order number
"RTN","PRCPUTRX",20,0)
 ;  issue)       = issue/nonissue
"RTN","PRCPUTRX",21,0)
 ;                 (optional) set to I for issuable, N for non
"RTN","PRCPUTRX",22,0)
 ;  otherpt)     = other inventory point
"RTN","PRCPUTRX",23,0)
 ;  reason)      = n:reason (if n=1 ask reason)
"RTN","PRCPUTRX",24,0)
 ;  reasoncode)  = reason code (for whse other adjustments)
"RTN","PRCPUTRX",25,0)
 ;  recipient    = who got the supply
"RTN","PRCPUTRX",26,0)
 ;  user         = person who took the supply from the cabinet
"RTN","PRCPUTRX",27,0)
 ;
"RTN","PRCPUTRX",28,0)
 ;  returns variable y = da of entry added
"RTN","PRCPUTRX",29,0)
 S Y=0
"RTN","PRCPUTRX",30,0)
 ;
"RTN","PRCPUTRX",31,0)
 ;  inventory point is not keeping a detailed transaction reg.
"RTN","PRCPUTRX",32,0)
 I $P($G(^PRCP(445,+INVPT,0)),"^",6)'="Y" Q
"RTN","PRCPUTRX",33,0)
 ;
"RTN","PRCPUTRX",34,0)
 N %,%DT,D,D0,DA,DD,DI,DIC,DIE,DLAYGO,DQ,DR,NOW,PRCPDR,PRCPPRIV,PRCPREAS,TRANDA,X
"RTN","PRCPUTRX",35,0)
 D NOW^%DTC S NOW=%
"RTN","PRCPUTRX",36,0)
 ;
"RTN","PRCPUTRX",37,0)
 ;  set up all variables not defined
"RTN","PRCPUTRX",38,0)
 I '$G(PRCPDATA("DATE")) S PRCPDATA("DATE")=$E(NOW,1,7)
"RTN","PRCPUTRX",39,0)
 I '$D(PRCPDATA("PKG")) S PRCPDATA("PKG")=$$UNIT^PRCPUX1(INVPT,ITEMDA,"/")
"RTN","PRCPUTRX",40,0)
 F %="QTY","INVVAL","SELVAL" I '$G(PRCPDATA(%)) S PRCPDATA(%)=0
"RTN","PRCPUTRX",41,0)
 S %=$G(^PRCP(445,INVPT,1,ITEMDA,0))
"RTN","PRCPUTRX",42,0)
 I '$G(PRCPDATA("AVGUNIT")) D
"RTN","PRCPUTRX",43,0)
 . S PRCPDATA("AVGUNIT")=+$P(%,"^",22)
"RTN","PRCPUTRX",44,0)
 . I TRANTYPE="P",PRCPDATA("AVGUNIT")=0 S PRCPDATA("AVGUNIT")=+$P(%,"^",15)
"RTN","PRCPUTRX",45,0)
 S:'$G(PRCPDATA("SELUNIT")) PRCPDATA("SELUNIT")=+$P(%,"^",15)
"RTN","PRCPUTRX",46,0)
 F %="REF","2237PO","ISSUE","OTHERPT","REASON","RECIPIENT","USER" I '$D(PRCPDATA(%)) S PRCPDATA(%)=""
"RTN","PRCPUTRX",47,0)
 ;
"RTN","PRCPUTRX",48,0)
 ;  add new transaction history entry
"RTN","PRCPUTRX",49,0)
 S DIC(0)="L",DLAYGO=445.2,DIC="^PRCP(445.2,",X=INVPT,PRCPPRIV=1
"RTN","PRCPUTRX",50,0)
 D FILE^DICN I Y<1 S Y=0 Q
"RTN","PRCPUTRX",51,0)
 S (TRANDA,DA)=+Y,DIE="^PRCP(445.2,"
"RTN","PRCPUTRX",52,0)
 S DR="1///"_TRANTYPE_ORDERNO_";2///"_PRCPDATA("DATE")_";2.5///"_NOW_";3///"_TRANTYPE_";4////"_ITEMDA_";5////"_PRCPDATA("PKG")_";6////"_PRCPDATA("QTY")_";7////"_(+PRCPDATA("AVGUNIT"))_";8////"_(+PRCPDATA("SELUNIT"))_";"
"RTN","PRCPUTRX",53,0)
 S DR=DR_"6.1////"_(+PRCPDATA("INVVAL"))_";6.2////"_(+PRCPDATA("SELVAL"))_";8.5////"_DUZ_";10////"_PRCPDATA("ISSUE")_";13////"_PRCPDATA("REF")_";14////"_PRCPDATA("OTHERPT")_";410////"_PRCPDATA("2237PO")_";"
"RTN","PRCPUTRX",54,0)
 S DR=DR_"23////"_PRCPDATA("RECIPIENT")_";"
"RTN","PRCPUTRX",55,0)
 S DR=DR_"22////"_PRCPDATA("USER")_";"
"RTN","PRCPUTRX",56,0)
 ;  additional reason text (for asking in second call to die)
"RTN","PRCPUTRX",57,0)
 S PRCPDR="" I $D(PRCPDATA("REASONCODE")) S PRCPDR="9////"_$E(PRCPDATA("REASONCODE"),1,3)_";"
"RTN","PRCPUTRX",58,0)
 S PRCPDR=PRCPDR_"9.5//"_$S($P(PRCPDATA("REASON"),":"):"",1:"/")_"^S X=PRCPREAS",PRCPREAS=$E($P(PRCPDATA("REASON"),":",2,99),1,80)
"RTN","PRCPUTRX",59,0)
 L +^PRCP(445.2,TRANDA)
"RTN","PRCPUTRX",60,0)
 D ^DIE
"RTN","PRCPUTRX",61,0)
 S DR=PRCPDR
"RTN","PRCPUTRX",62,0)
 D ^DIE
"RTN","PRCPUTRX",63,0)
 L -^PRCP(445.2,TRANDA)
"RTN","PRCPUTRX",64,0)
 S Y=DA
"RTN","PRCPUTRX",65,0)
 Q
"RTN","PRCPUTRX",66,0)
 ;
"RTN","PRCPUTRX",67,0)
 ;
"RTN","PRCPUTRX",68,0)
ORDERNO(INVPT) ;  get next order number for inventory point
"RTN","PRCPUTRX",69,0)
 ;  returns orderno
"RTN","PRCPUTRX",70,0)
 S Y=0
"RTN","PRCPUTRX",71,0)
 I $P($G(^PRCP(445,+INVPT,0)),"^",6)="Y" L +^PRCP(445.2,"ANXT",INVPT) S Y=$G(^PRCP(445.2,"ANXT",INVPT))+1 S:Y>9999999 Y=1 S ^(INVPT)=Y L -^PRCP(445.2,"ANXT",INVPT)
"RTN","PRCPUTRX",72,0)
 Q Y
"RTN","PRCPUUIP")
0^4^B12242911^B11759366
"RTN","PRCPUUIP",1,0)
PRCPUUIP ;WISC/RFJ-utility update item prim to secondary            ;08 Jul 92
"RTN","PRCPUUIP",2,0)
 ;;5.1;IFCAP;**126**;Oct 20, 2000;Build 2
"RTN","PRCPUUIP",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPUUIP",4,0)
 Q
"RTN","PRCPUUIP",5,0)
 ;
"RTN","PRCPUUIP",6,0)
 ;
"RTN","PRCPUUIP",7,0)
ITEM(INVPT,ITEMDA,TRANTYPE,ORDERNO,PRCPDATA) ;  update inventory point item
"RTN","PRCPUUIP",8,0)
 ;prcpdata =
"RTN","PRCPUUIP",9,0)
 ;  qty)       = quantity to add to on-hand
"RTN","PRCPUUIP",10,0)
 ;  invval)    = total inventory value
"RTN","PRCPUUIP",11,0)
 ;  selval)    = total sales value
"RTN","PRCPUUIP",12,0)
 ;  otherpt)   = other inventory point affected (for issues)
"RTN","PRCPUUIP",13,0)
 ;  reason)    = reason (for adjustments)
"RTN","PRCPUUIP",14,0)
 ;  date)      = date of transaction (optional)
"RTN","PRCPUUIP",15,0)
 ;  pkg)       = packaging units on transaction register
"RTN","PRCPUUIP",16,0)
 ;  noduein)   = do not decrement dueins if $data (optional)
"RTN","PRCPUUIP",17,0)
 ;  nodueout)  = do not decrement dueouts if $data (optional)
"RTN","PRCPUUIP",18,0)
 ;
"RTN","PRCPUUIP",19,0)
 ;returns
"RTN","PRCPUUIP",20,0)
 ;  prcpid = transaction 445.2 da number
"RTN","PRCPUUIP",21,0)
 ;
"RTN","PRCPUUIP",22,0)
 N %,COSTCNTR,DATE,ITEMDATA,PRCPUUIP,X,Y
"RTN","PRCPUUIP",23,0)
 D NOW^%DTC S DATE=%
"RTN","PRCPUUIP",24,0)
 I '$D(^PRCP(445.1,INVPT,1,ITEMDA,1,$E(DATE,1,5),0)) D BALANCE^PRCPUBAL(INVPT,ITEMDA,$E(DATE,1,5))
"RTN","PRCPUUIP",25,0)
 I $P($G(^PRCP(445,INVPT,0)),"^",6)="Y" D
"RTN","PRCPUUIP",26,0)
 .   K PRCPUUIP F %="DATE","QTY","INVVAL","SELVAL","PKG","REF","2237PO","ISSUE","OTHERPT","REASON" I $D(PRCPDATA(%)) S PRCPUUIP(%)=PRCPDATA(%)
"RTN","PRCPUUIP",27,0)
 .   K PRCPID D ADDTRAN^PRCPUTRX(INVPT,ITEMDA,TRANTYPE,ORDERNO,.PRCPUUIP) K PRCPUUIP S PRCPID=+$G(Y)
"RTN","PRCPUUIP",28,0)
 I '$D(^PRCP(445,INVPT,1,ITEMDA,0))&((TRANTYPE="R")!(TRANTYPE="C")) D  Q
"RTN","PRCPUUIP",29,0)
 .   ; update costcenter costs and quit
"RTN","PRCPUUIP",30,0)
 .   ; use costcenter for primary since second do not have costcneters
"RTN","PRCPUUIP",31,0)
 .   S COSTCNTR=$P($G(^PRCP(445,INVPT,0)),"^",7)
"RTN","PRCPUUIP",32,0)
 .   I COSTCNTR D COSTCNTR^PRCPUCC(PRCPDATA("OTHERPT"),INVPT,COSTCNTR,-PRCPDATA("SELVAL"))
"RTN","PRCPUUIP",33,0)
 I '$D(^PRCP(445,INVPT,1,ITEMDA,0)) Q
"RTN","PRCPUUIP",34,0)
 L +^PRCP(445,INVPT,1,ITEMDA)
"RTN","PRCPUUIP",35,0)
 S ITEMDATA=^PRCP(445,INVPT,1,ITEMDA,0)
"RTN","PRCPUUIP",36,0)
 ;
"RTN","PRCPUUIP",37,0)
 ;  RC=receipts
"RTN","PRCPUUIP",38,0)
 I TRANTYPE="RC" D
"RTN","PRCPUUIP",39,0)
 .   D RECEIPTS^PRCPUSAG(INVPT,ITEMDA,PRCPDATA("QTY"))
"RTN","PRCPUUIP",40,0)
 .   ; do not update dueins if "noduein" defined
"RTN","PRCPUUIP",41,0)
 .   I '$D(PRCPDATA("NODUEIN")) D SETIN^PRCPUDUE(INVPT,ITEMDA,-PRCPDATA("QTY"))
"RTN","PRCPUUIP",42,0)
 .   S $P(ITEMDATA,"^",15)=$J(PRCPDATA("INVVAL")/PRCPDATA("QTY"),0,3),$P(ITEMDATA,"^",3)=$E(DATE,1,7)
"RTN","PRCPUUIP",43,0)
 ;
"RTN","PRCPUUIP",44,0)
 ;  R or C=distribution
"RTN","PRCPUUIP",45,0)
 I TRANTYPE="R"!(TRANTYPE="C") D
"RTN","PRCPUUIP",46,0)
 .   D ADDUSAG^PRCPUSAG(INVPT,ITEMDA,-PRCPDATA("QTY"),-PRCPDATA("INVVAL"))
"RTN","PRCPUUIP",47,0)
 .   ;  use costcenter for primary since second do not have costcenters
"RTN","PRCPUUIP",48,0)
 .   S COSTCNTR=$P($G(^PRCP(445,INVPT,0)),"^",7)
"RTN","PRCPUUIP",49,0)
 .   I COSTCNTR D COSTCNTR^PRCPUCC(PRCPDATA("OTHERPT"),INVPT,COSTCNTR,-PRCPDATA("SELVAL"))
"RTN","PRCPUUIP",50,0)
 .   ; do not update dueouts if "nodueout" defined
"RTN","PRCPUUIP",51,0)
 .   I '$D(PRCPDATA("NODUEOUT")) D SETOUT^PRCPUDUE(INVPT,ITEMDA,PRCPDATA("QTY"))
"RTN","PRCPUUIP",52,0)
 ;
"RTN","PRCPUUIP",53,0)
 ;  U=usage
"RTN","PRCPUUIP",54,0)
 I TRANTYPE="U" D
"RTN","PRCPUUIP",55,0)
 .   D ADDUSAG^PRCPUSAG(INVPT,ITEMDA,-PRCPDATA("QTY"),-PRCPDATA("INVVAL"))
"RTN","PRCPUUIP",56,0)
 ;
"RTN","PRCPUUIP",57,0)
 ;  update inventory item
"RTN","PRCPUUIP",58,0)
 I '$P(ITEMDATA,"^",27) S $P(ITEMDATA,"^",27)=$J($P(ITEMDATA,"^",7)*$P(ITEMDATA,"^",22),0,2)
"RTN","PRCPUUIP",59,0)
 S $P(ITEMDATA,"^",7)=$P(ITEMDATA,"^",7)+PRCPDATA("QTY")
"RTN","PRCPUUIP",60,0)
 S $P(ITEMDATA,"^",27)=$P(ITEMDATA,"^",27)+PRCPDATA("INVVAL")
"RTN","PRCPUUIP",61,0)
 S $P(ITEMDATA,"^",22)=0,%=$P(ITEMDATA,"^",7)+$P(ITEMDATA,"^",19) I %>0 S $P(ITEMDATA,"^",22)=$J($P(ITEMDATA,"^",27)/%,0,3) I $P(ITEMDATA,"^",22)'>0 S $P(ITEMDATA,"^",22)=0
"RTN","PRCPUUIP",62,0)
 I TRANTYPE="P",$P(ITEMDATA,"^",22)=0 S $P(ITEMDATA,"^",22)=$P(ITEMDATA,"^",15)
"RTN","PRCPUUIP",63,0)
 S ^PRCP(445,INVPT,1,ITEMDA,0)=ITEMDATA
"RTN","PRCPUUIP",64,0)
 L -^PRCP(445,INVPT,1,ITEMDA)
"RTN","PRCPUUIP",65,0)
 Q
"VER")
8.0^22.0
"BLD",5798,6)
^109
**END**
**END**
