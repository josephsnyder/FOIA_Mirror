EMERGENCY Released PRC*5.1*125 SEQ #104
Extracted from mail message
**KIDS**:PRC*5.1*125^

**INSTALL NAME**
PRC*5.1*125
"BLD",5797,0)
PRC*5.1*125^IFCAP^0^3081112^y
"BLD",5797,1,0)
^^11^11^3081105^
"BLD",5797,1,1,0)
NEW CHARGE CARD VENDOR (US BANK)
"BLD",5797,1,2,0)
   - Modify Inactivate Expired Charge cards option task for card
"BLD",5797,1,3,0)
     4486 inactivation
"BLD",5797,1,4,0)
   - Create miscellaneous PC reports:
"BLD",5797,1,5,0)
       Citibank cards on file with no US Bank replacement card
"BLD",5797,1,6,0)
       All active Citibank cards with NO new US Bank replacement #
"BLD",5797,1,7,0)
       All inactive Citibank cards with new US Bank replacement #
"BLD",5797,1,8,0)
   - Modify Purchase Card Registration to allow entry of 
"BLD",5797,1,9,0)
     replacement card # if card replacing subsequent card.
"BLD",5797,1,10,0)
   - Increase field length for Field 4 (Bank's Vendor ID) in File 440.6
"BLD",5797,1,11,0)
     from 9 to 11. 
"BLD",5797,4,0)
^9.64PA^440.6^1
"BLD",5797,4,440.6,0)
440.6
"BLD",5797,4,440.6,2,0)
^9.641^440.6^1
"BLD",5797,4,440.6,2,440.6,0)
PURCHASE CARD ORDER RECONCILE  (File-top level)
"BLD",5797,4,440.6,2,440.6,1,0)
^9.6411^4^1
"BLD",5797,4,440.6,2,440.6,1,4,0)
BANK'S VENDOR ID
"BLD",5797,4,440.6,222)
y^n^p^^^^n^^n
"BLD",5797,4,440.6,224)

"BLD",5797,4,"APDD",440.6,440.6)

"BLD",5797,4,"APDD",440.6,440.6,4)

"BLD",5797,4,"B",440.6,440.6)

"BLD",5797,6.3)
15
"BLD",5797,"INID")
^n
"BLD",5797,"INIT")

"BLD",5797,"KRN",0)
^9.67PA^8989.52^19
"BLD",5797,"KRN",.4,0)
.4
"BLD",5797,"KRN",.401,0)
.401
"BLD",5797,"KRN",.402,0)
.402
"BLD",5797,"KRN",.403,0)
.403
"BLD",5797,"KRN",.5,0)
.5
"BLD",5797,"KRN",.84,0)
.84
"BLD",5797,"KRN",3.6,0)
3.6
"BLD",5797,"KRN",3.8,0)
3.8
"BLD",5797,"KRN",9.2,0)
9.2
"BLD",5797,"KRN",9.8,0)
9.8
"BLD",5797,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",5797,"KRN",9.8,"NM",1,0)
PRCH3A^^0^B4013336
"BLD",5797,"KRN",9.8,"NM",3,0)
PRCH4RPT^^0^B13578830
"BLD",5797,"KRN",9.8,"NM",4,0)
PRCH2A^^0^B19001803
"BLD",5797,"KRN",9.8,"NM",5,0)
PRCHUSER^^0^B15927920
"BLD",5797,"KRN",9.8,"NM","B","PRCH2A",4)

"BLD",5797,"KRN",9.8,"NM","B","PRCH3A",1)

"BLD",5797,"KRN",9.8,"NM","B","PRCH4RPT",3)

"BLD",5797,"KRN",9.8,"NM","B","PRCHUSER",5)

"BLD",5797,"KRN",19,0)
19
"BLD",5797,"KRN",19,"NM",0)
^9.68A^5^2
"BLD",5797,"KRN",19,"NM",1,0)
PRCH CARD COORDINATOR MENU^^3
"BLD",5797,"KRN",19,"NM",5,0)
PRCH PURCHASE CARD EXCEPTIONS^^0
"BLD",5797,"KRN",19,"NM","B","PRCH CARD COORDINATOR MENU",1)

"BLD",5797,"KRN",19,"NM","B","PRCH PURCHASE CARD EXCEPTIONS",5)

"BLD",5797,"KRN",19.1,0)
19.1
"BLD",5797,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5797,"KRN",101,0)
101
"BLD",5797,"KRN",409.61,0)
409.61
"BLD",5797,"KRN",771,0)
771
"BLD",5797,"KRN",870,0)
870
"BLD",5797,"KRN",8989.51,0)
8989.51
"BLD",5797,"KRN",8989.52,0)
8989.52
"BLD",5797,"KRN",8994,0)
8994
"BLD",5797,"KRN","B",.4,.4)

"BLD",5797,"KRN","B",.401,.401)

"BLD",5797,"KRN","B",.402,.402)

"BLD",5797,"KRN","B",.403,.403)

"BLD",5797,"KRN","B",.5,.5)

"BLD",5797,"KRN","B",.84,.84)

"BLD",5797,"KRN","B",3.6,3.6)

"BLD",5797,"KRN","B",3.8,3.8)

"BLD",5797,"KRN","B",9.2,9.2)

"BLD",5797,"KRN","B",9.8,9.8)

"BLD",5797,"KRN","B",19,19)

"BLD",5797,"KRN","B",19.1,19.1)

"BLD",5797,"KRN","B",101,101)

"BLD",5797,"KRN","B",409.61,409.61)

"BLD",5797,"KRN","B",771,771)

"BLD",5797,"KRN","B",870,870)

"BLD",5797,"KRN","B",8989.51,8989.51)

"BLD",5797,"KRN","B",8989.52,8989.52)

"BLD",5797,"KRN","B",8994,8994)

"BLD",5797,"QUES",0)
^9.62^^
"BLD",5797,"REQB",0)
^9.611^2^1
"BLD",5797,"REQB",2,0)
PRC*5.1*8^2
"BLD",5797,"REQB","B","PRC*5.1*8",2)

"FIA",440.6)
PURCHASE CARD ORDER RECONCILE
"FIA",440.6,0)
^PRCH(440.6,
"FIA",440.6,0,0)
440.6I
"FIA",440.6,0,1)
y^n^p^^^^n^^n
"FIA",440.6,0,10)

"FIA",440.6,0,11)

"FIA",440.6,0,"RLRO")

"FIA",440.6,0,"VR")
5.1^PRC
"FIA",440.6,440.6)
1
"FIA",440.6,440.6,4)

"KRN",19,10735,-1)
3^1
"KRN",19,10735,0)
PRCH CARD COORDINATOR MENU^Purchase Card Coordinator's Menu^^M^^^^^^^^IFCAP
"KRN",19,10735,1,0)
^19.06^1^1^3080916^^^^
"KRN",19,10735,1,1,0)
This menu option can only be used by a Purchase Card Coordinator.
"KRN",19,10735,10,0)
^19.01IP^29^26
"KRN",19,10735,10,26,0)
12679^CCEX
"KRN",19,10735,10,26,"^")
PRCH PURCHASE CARD EXCEPTIONS
"KRN",19,10735,99)
61265,28623
"KRN",19,10735,99.1)
61219,62461
"KRN",19,10735,"U")
PURCHASE CARD COORDINATOR'S ME
"KRN",19,12679,-1)
0^5
"KRN",19,12679,0)
PRCH PURCHASE CARD EXCEPTIONS^Purchase Card exceptions/replacements^^R^^^^^^^^IFCAP
"KRN",19,12679,1,0)
^19.06^5^5^3080914^^
"KRN",19,12679,1,1,0)
This option is used to report the following Purchase Card reports:
"KRN",19,12679,1,2,0)
 
"KRN",19,12679,1,3,0)
     1         Citibank cards w/o US Bank replacement card
"KRN",19,12679,1,4,0)
     2         All active Citi cards with NO new US Bank replacement cards
"KRN",19,12679,1,5,0)
     3         All inactive Citi cards WITH new US Bank replacement cards
"KRN",19,12679,25)
PRCH4RPT
"KRN",19,12679,"U")
PURCHASE CARD EXCEPTIONS/REPLA
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
125^3081112
"PKG",455,22,1,"PAH",1,1,0)
^^11^11^3081112
"PKG",455,22,1,"PAH",1,1,1,0)
NEW CHARGE CARD VENDOR (US BANK)
"PKG",455,22,1,"PAH",1,1,2,0)
   - Modify Inactivate Expired Charge cards option task for card
"PKG",455,22,1,"PAH",1,1,3,0)
     4486 inactivation
"PKG",455,22,1,"PAH",1,1,4,0)
   - Create miscellaneous PC reports:
"PKG",455,22,1,"PAH",1,1,5,0)
       Citibank cards on file with no US Bank replacement card
"PKG",455,22,1,"PAH",1,1,6,0)
       All active Citibank cards with NO new US Bank replacement #
"PKG",455,22,1,"PAH",1,1,7,0)
       All inactive Citibank cards with new US Bank replacement #
"PKG",455,22,1,"PAH",1,1,8,0)
   - Modify Purchase Card Registration to allow entry of 
"PKG",455,22,1,"PAH",1,1,9,0)
     replacement card # if card replacing subsequent card.
"PKG",455,22,1,"PAH",1,1,10,0)
   - Increase field length for Field 4 (Bank's Vendor ID) in File 440.6
"PKG",455,22,1,"PAH",1,1,11,0)
     from 9 to 11. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PRCH2A")
0^4^B19001803^B18523948
"RTN","PRCH2A",1,0)
PRCH2A ;WISC/PLT-DAILY PURCHASE CARD CHARGES STATEMENT ; 6/28/99 3:18pm
"RTN","PRCH2A",2,0)
V ;;5.1;IFCAP;**8,125**;Oct 20, 2000;Build 15
"RTN","PRCH2A",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCH2A",4,0)
 QUIT  ;invalid entry
"RTN","PRCH2A",5,0)
 ;
"RTN","PRCH2A",6,0)
EN ;print daily purchase card charges statement
"RTN","PRCH2A",7,0)
 N PRCA,PRCB,PRCDATE,PRCDATEF,PRCDATEE,PRCDUZ,PRCNAME
"RTN","PRCH2A",8,0)
 N A,B,C
"RTN","PRCH2A",9,0)
 S PRCDUZ=DUZ
"RTN","PRCH2A",10,0)
Q1 ;statement from date
"RTN","PRCH2A",11,0)
 S A=$$DATE^PRC0C($H-2,"H") D DT^PRC0A(.X,.Y,"For Credit Card Charge Statement Beginning Date: ","AO",$P(A,"^",4)_"/"_$P(A,"^",5)_"/"_$E($P(A,"^",3),3,4))
"RTN","PRCH2A",12,0)
 I X["^"!(X="") G EXIT
"RTN","PRCH2A",13,0)
 I $E(Y,6,7)<1 D EN^DDIOL("Date missing! Enter date format: MM/DD/YY") G Q1
"RTN","PRCH2A",14,0)
 S PRCDATEF=Y
"RTN","PRCH2A",15,0)
Q2 ;statement ending date
"RTN","PRCH2A",16,0)
 S A=$$DATE^PRC0C(PRCDATEF,"I") D DT^PRC0A(.X,.Y,"For Credit Card Charge Statement Ending Date: ","AO",$P(A,"^",4)_"/"_$P(A,"^",5)_"/"_$E($P(A,"^",3),3,4))
"RTN","PRCH2A",17,0)
 I X["^"!(X="") G Q1
"RTN","PRCH2A",18,0)
 I $E(Y,6,7)<1 D EN^DDIOL("Date missing! Enter date format: MM/DD/YY") G Q2
"RTN","PRCH2A",19,0)
 I Y<PRCDATEF D EN^DDIOL("The beginning and ending dates are not in order") G Q2
"RTN","PRCH2A",20,0)
 S PRCDATEE=Y
"RTN","PRCH2A",21,0)
 G:'$G(PRCOPT) START
"RTN","PRCH2A",22,0)
Q3 ;select card holder
"RTN","PRCH2A",23,0)
 S PRCDI="200;^VA(200,;"
"RTN","PRCH2A",24,0)
 S X("S")="I Y-DUZ,$D(^PRC(440.5,""MAAH"",DUZ,+Y))"
"RTN","PRCH2A",25,0)
 D LOOKUP^PRC0B(.X,.Y,PRCDI,"AEOQS","Select Purchase Card Holder: ")
"RTN","PRCH2A",26,0)
 I Y<0!(X="") G Q1
"RTN","PRCH2A",27,0)
 K X S PRCRI(200)=+Y,PRCDUZ=+Y
"RTN","PRCH2A",28,0)
 ;
"RTN","PRCH2A",29,0)
START N L,DIC,FLDS,BY,FR,TO,DHD
"RTN","PRCH2A",30,0)
 S DIC="^PRCH(440.6,",L=0,BY="#STATEMENT DATE;C1,@STATION NUMBER,@INTERNAL(CARD HOLDER),+""XXXXXXXXXXXX""_$E(CREDIT CARD NUMBER;C1;S1;""CHARGE DATA for CREDIT CARD #: "",13,16)"
"RTN","PRCH2A",31,0)
 S FR=PRCDATEF_",1,"_PRCDUZ_",0",TO=PRCDATEE_",9999,"_PRCDUZ_",~"
"RTN","PRCH2A",32,0)
 S PRCNAME=$P(^VA(200,PRCDUZ,0),"^"),PRCDATE=$$MDY(PRCDATEF)_" - "_$$MDY(PRCDATEE)
"RTN","PRCH2A",33,0)
 S DHD="E-Charge Statement for "_PRCNAME_"   Statement Date: "_PRCDATE
"RTN","PRCH2A",34,0)
 S FLDS=".01;C1;S1;""Charge Id"",8;""PO Date"",31;L30;""Vendor"",20;C5;""P.O. #"",9;""TXN Ref"",&13;C60;R15;""Charge $AMT"",41;""IFCAP P.O. #"";C5;L16,6;""TXN DATE"",15;C50"
"RTN","PRCH2A",35,0)
 D EN1^DIP G:$G(PRCOPT) Q3
"RTN","PRCH2A",36,0)
EXIT QUIT
"RTN","PRCH2A",37,0)
 ;
"RTN","PRCH2A",38,0)
MDY(A) ;EV = MM/DD/YY
"RTN","PRCH2A",39,0)
 QUIT $E(A,4,5)_"/"_$E(A,6,7)_"/"_$E(A,2,3)
"RTN","PRCH2A",40,0)
 ;
"RTN","PRCH2A",41,0)
EN1 ;from approving official menu
"RTN","PRCH2A",42,0)
 N PRCOPT
"RTN","PRCH2A",43,0)
 S PRCOPT=1
"RTN","PRCH2A",44,0)
 G EN
"RTN","PRCH2A",45,0)
 ;
"RTN","PRCH2A",46,0)
EN2 ;from print unregistered card charges option
"RTN","PRCH2A",47,0)
 S PRCOPT=2
"RTN","PRCH2A",48,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))  Q:$G(X)="^"
"RTN","PRCH2A",49,0)
 S DIC="^PRCH(440.6,",L=0
"RTN","PRCH2A",50,0)
 S FLDS="3;""Credit Card #"";C1;N;L16,8;""PO Date"",31;L30;""Vendor"",20;C5;""P.O. #"",9;""TXN Ref"",&13;C60;R15;""Charge $AMT"",.01;C5;""Charge Id"",6;""TXN DATE"",15;C50"
"RTN","PRCH2A",51,0)
 S DHD="Unregistered Credit Card Charges for Station #: "_PRC("SITE")
"RTN","PRCH2A",52,0)
 S BY(0)="^PRCH(440.6,""ST"",""N~"","
"RTN","PRCH2A",53,0)
 S L(0)=1
"RTN","PRCH2A",54,0)
 S BY="3",FR="0",TO="99999999999999999999999"
"RTN","PRCH2A",55,0)
 S DIS(0)="I $D(PRC(""SITE"")),$P(^PRCH(440.6,D0,0),""^"",8)=PRC(""SITE"")"
"RTN","PRCH2A",56,0)
 D EN1^DIP
"RTN","PRCH2A",57,0)
 QUIT
"RTN","PRCH2A",58,0)
 ;
"RTN","PRCH2A",59,0)
EN3 ;charge card reg exception option
"RTN","PRCH2A",60,0)
 N PRC
"RTN","PRCH2A",61,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))  Q:$G(X)="^"
"RTN","PRCH2A",62,0)
 S DIC="^PRC(440.5,",L=0
"RTN","PRCH2A",63,0)
 S FLDS="60;""Charge Card #"";C1;S1;N,59;""Exp. Date"";L15,51;""Replaced Card #"",52;C5;""Card Holder"";L30,7;C36;""IFCAP CARD HOLDER"";L25,63;L10;C62;""FCP #"",53;C5;""Station"";L8,61;C22;""S.P. Limit"";L15,62;""M.P. Limit"";L15"
"RTN","PRCH2A",64,0)
 S FLDS(1)="55;C5;""Fund Code"";L15,56;""ACC Code"";L15,57;""Cost Center"";L15,58;""BOC"";L15"
"RTN","PRCH2A",65,0)
 S DHD="Charge Card Reg. Exception List"
"RTN","PRCH2A",66,0)
 S BY(0)="^PRC(440.5,""ST"","
"RTN","PRCH2A",67,0)
 S L(0)=2
"RTN","PRCH2A",68,0)
 S BY="@70,@.01",FR="E",TO="E"
"RTN","PRCH2A",69,0)
 S DIOEND="I Y'[""^"" D EOR^PRCH2A"
"RTN","PRCH2A",70,0)
 S:$D(ZTIO) IOP=ZTIO
"RTN","PRCH2A",71,0)
 S DIS(0)="I $D(PRC(""SITE"")),($P($G(^PRC(440.5,D0,2)),""^"",3)=PRC(""SITE"")!($P($G(^PRC(440.5,D0,50)),""^"",3)=PRC(""SITE"")))"
"RTN","PRCH2A",72,0)
 D EN1^DIP
"RTN","PRCH2A",73,0)
 QUIT
"RTN","PRCH2A",74,0)
EOR W !!,"* - Invalid data, it must be corrected by the charge card company.",!,"# - New charge card data may not match the old one.",!!,"END OF REPORT"
"RTN","PRCH2A",75,0)
 I $E(IOST,1,2)="C-",'$D(ZTQUEUED) D EOP^PRC0A(.X,.Y,"Enter return to continue","","")
"RTN","PRCH2A",76,0)
 QUIT
"RTN","PRCH3A")
0^1^B4013336^B3509017
"RTN","PRCH3A",1,0)
PRCH3A ;WISC/PLT-IFCAP INACTIVATE OLD/EXPIRED PURCHASE CARDS - CITIBANK ;8/28/98  11:49
"RTN","PRCH3A",2,0)
V ;;5.1;IFCAP;**8,125**;Oct 20, 2000;Build 15
"RTN","PRCH3A",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCH3A",4,0)
 QUIT  ;invalid entry
"RTN","PRCH3A",5,0)
 ;
"RTN","PRCH3A",6,0)
 ;ZTQPARAM="REGULAR" if from schedule option, ="CITI" if from CITIBANK schedule
"RTN","PRCH3A",7,0)
EN ;inactivate charge cards
"RTN","PRCH3A",8,0)
 N PRCA,PRCB,PRCRI,PRCDI,PRC,PRCTD
"RTN","PRCH3A",9,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))  Q:$G(X)="^"
"RTN","PRCH3A",10,0)
 I $D(ZTQUEUED) G SCHED
"RTN","PRCH3A",11,0)
Q1 ;inactivate all CITI charge cards with expired date before t
"RTN","PRCH3A",12,0)
 S PRCTD=$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PRCH3A",13,0)
 D YN^PRC0A(.X,.Y,"Ready to inactivate old Citibank & expired US Bank charge cards before "_PRCTD,"O","NO")
"RTN","PRCH3A",14,0)
 I X["^"!(X="")!'Y G EXIT
"RTN","PRCH3A",15,0)
 D NOW^%DTC S ZTDTH=%
"RTN","PRCH3A",16,0)
 S %ZIS("B")="Q",ZTIO=""
"RTN","PRCH3A",17,0)
 S ZTRTN="SCHED^PRCH3A",ZTDESC="IFCAP INACTIVATION OF OLD CITIBANK/EXPIRED US BANK CHARGE CARDS",ZTSAVE("*")=""
"RTN","PRCH3A",18,0)
 D ^%ZTLOAD
"RTN","PRCH3A",19,0)
 W !! D EN^DDIOL("  IFCAP INACTIVATION OF OLD CITIBANK/EXPIRED US BANK CHARGE CARDS WAS SCHEDULED WITH TASK # "_ZTSK)
"RTN","PRCH3A",20,0)
 R X:4
"RTN","PRCH3A",21,0)
 D HOME^%ZIS
"RTN","PRCH3A",22,0)
EXIT QUIT
"RTN","PRCH3A",23,0)
 ;
"RTN","PRCH3A",24,0)
 ;
"RTN","PRCH3A",25,0)
 D EDIT^PRC0B(.X,PRCDI,"4;5;6")
"RTN","PRCH3A",26,0)
 ;
"RTN","PRCH3A",27,0)
SCHED ;inactivate old Citibank/expired US Bank charge card with date before run date
"RTN","PRCH3A",28,0)
 D NOW^%DTC I %<3081129.0500 Q
"RTN","PRCH3A",29,0)
 N PRCRI,PRCA,PRCB,PRCC S DT=X
"RTN","PRCH3A",30,0)
 S PRCRI=0,U="^"
"RTN","PRCH3A",31,0)
 F  S PRCRI=$O(^PRC(440.5,PRCRI)) QUIT:PRCRI'?1N.N!'PRCRI  S PRCA=$G(^(PRCRI,0)),PRCB=$G(^(2)) D:$P(PRCB,U,2)'="Y"
"RTN","PRCH3A",32,0)
 . I $D(PRC("SITE")) Q:$P($G(PRCB),"^",3)'=PRC("SITE")
"RTN","PRCH3A",33,0)
 . S PRCC=""
"RTN","PRCH3A",34,0)
 . I PRCA?1"4486".E S PRCC="Y"
"RTN","PRCH3A",35,0)
 . I PRCC="",$P(PRCB,U,4),$P(PRCB,U,4)<DT S PRCC="Y"
"RTN","PRCH3A",36,0)
 . I PRCC="Y" S X="" D EDIT^PRC0B(.X,"440.5;^PRC(440.5,;"_PRCRI,"14///^S X=""Y""")
"RTN","PRCH3A",37,0)
 . QUIT
"RTN","PRCH3A",38,0)
 QUIT
"RTN","PRCH4RPT")
0^3^B13578830^n/a
"RTN","PRCH4RPT",1,0)
PRCH4RPT ;RB/VM-Print Purchase Card exception reports ;09/15/08
"RTN","PRCH4RPT",2,0)
V ;;5.1;IFCAP;**125**;Oct 20, 2000;Build 15
"RTN","PRCH4RPT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCH4RPT",4,0)
 ;
"RTN","PRCH4RPT",5,0)
 N PRCA,PRCB
"RTN","PRCH4RPT",6,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))  Q:$G(X)="^"
"RTN","PRCH4RPT",7,0)
RPT ;select card exception/replacement report type
"RTN","PRCH4RPT",8,0)
 K DIR
"RTN","PRCH4RPT",9,0)
 S DIR(0)="S^1:ALL Citibank cards with No US Bank replacement #;2:Active Citibank cards with No US Bank replacement #;3:Inactive Citibank cards with US Bank replacement #"
"RTN","PRCH4RPT",10,0)
 S DIR("A")="Type of Report",DIR("B")="ALL Citibank cards with No US Bank replacement #" D ^DIR
"RTN","PRCH4RPT",11,0)
 Q:$D(DIRUT)!($D(DTOUT))
"RTN","PRCH4RPT",12,0)
 S PRCDET=Y
"RTN","PRCH4RPT",13,0)
DEV ;device
"RTN","PRCH4RPT",14,0)
 S %ZIS="Q" D ^%ZIS G:POP EXIT K IOP I '$D(IO("Q")) U IO G PRT
"RTN","PRCH4RPT",15,0)
 I $D(IO("Q")) S ZTIO=ION,ZTSAVE("*")=""
"RTN","PRCH4RPT",16,0)
 I  S ZTRTN="PRT^PRCH4RPT",ZTDESC="IFCAP Purchase Card exceptions/replacements" D ^%ZTLOAD D HOME^%ZIS Q
"RTN","PRCH4RPT",17,0)
PRT ;print
"RTN","PRCH4RPT",18,0)
 ;
"RTN","PRCH4RPT",19,0)
COMP ;compile reports
"RTN","PRCH4RPT",20,0)
 S IEN=0,U="^",PAGE=0,CTR=0 K ^TMP($J)
"RTN","PRCH4RPT",21,0)
COMP1 S IEN=$O(^PRC(440.5,IEN)) G LIST:IEN=""!(IEN]"@")
"RTN","PRCH4RPT",22,0)
 S PRCA=$G(^PRC(440.5,IEN,0)),PRCB=$G(^PRC(440.5,IEN,2)) G:PRCA="" COMP1
"RTN","PRCH4RPT",23,0)
 I $D(PRC("SITE")) G COMP1:$P(PRCB,U,3)'=PRC("SITE")
"RTN","PRCH4RPT",24,0)
 I PRCA'?1"4486".E G COMP1
"RTN","PRCH4RPT",25,0)
 I PRCDET=1 D  G COMP1
"RTN","PRCH4RPT",26,0)
 . I '$O(^PRC(440.5,"ARPC",$P(PRCA,U),0)) D SAVE
"RTN","PRCH4RPT",27,0)
 I PRCDET=2 D  G COMP1
"RTN","PRCH4RPT",28,0)
 . Q:$P(PRCB,U,2)="Y"
"RTN","PRCH4RPT",29,0)
 . I '$O(^PRC(440.5,"ARPC",$P(PRCA,U),0)) D SAVE
"RTN","PRCH4RPT",30,0)
 I PRCDET=3 D  G COMP1
"RTN","PRCH4RPT",31,0)
 . Q:$P(PRCB,U,2)'="Y"
"RTN","PRCH4RPT",32,0)
 . I $O(^PRC(440.5,"ARPC",$P(PRCA,U),0)) D SAVE
"RTN","PRCH4RPT",33,0)
 G COMP1
"RTN","PRCH4RPT",34,0)
SAVE S ^TMP($J,$P(PRCA,U),IEN,0)=PRCA,^TMP($J,$P(PRCA,U),IEN,2)=PRCB,CTR=CTR+1
"RTN","PRCH4RPT",35,0)
 I PRCDET=3 S ^TMP($J,$P(PRCA,U),IEN,3)=$O(^PRC(440.5,"ARPC",$P(PRCA,U),0))
"RTN","PRCH4RPT",36,0)
 Q
"RTN","PRCH4RPT",37,0)
LIST ;print report
"RTN","PRCH4RPT",38,0)
 S PCNO=0,IEN=0,END=0,PAGE=0
"RTN","PRCH4RPT",39,0)
 S HDRW="INACTIVATED CITI #       NEW US BANK #          CARD HOLDER"
"RTN","PRCH4RPT",40,0)
 I PRCDET<3 S HDRW="PURCHASE CARD NUMBER         CARD HOLDER"
"RTN","PRCH4RPT",41,0)
 D HDR
"RTN","PRCH4RPT",42,0)
L1 S PCNO=$O(^TMP($J,PCNO)),IEN=0 G:PCNO="" EXIT
"RTN","PRCH4RPT",43,0)
L2 S IEN=$O(^TMP($J,PCNO,IEN)) I IEN="" G L1
"RTN","PRCH4RPT",44,0)
 S PRCA=^TMP($J,PCNO,IEN,0),PRCB=^TMP($J,PCNO,IEN,2),PRCC=$G(^TMP($J,PCNO,IEN,3))
"RTN","PRCH4RPT",45,0)
 I $Y+1>(IOSL-2) D HDR G EXITZ:END
"RTN","PRCH4RPT",46,0)
 W !
"RTN","PRCH4RPT",47,0)
 I PRCDET<3 W $P(PRCA,U),?29,$P($G(^VA(200,+$P(PRCA,U,8),0)),U)
"RTN","PRCH4RPT",48,0)
 I PRCDET=3 W $P(PRCA,U),?25,$P($G(^PRC(440.5,PRCC,0)),U),?48,$P($G(^VA(200,+$P(PRCA,U,8),0)),U)
"RTN","PRCH4RPT",49,0)
 G L1
"RTN","PRCH4RPT",50,0)
HDR ;header
"RTN","PRCH4RPT",51,0)
 I PAGE>0,$E(IOST,1,2)="C-" S END=$$EOP^PRCH4RPT() Q:END
"RTN","PRCH4RPT",52,0)
 S PAGE=PAGE+1 W @IOF,!,"STATION: ",$G(PRC("SITE")),?25,"DEPARTMENT OF VETERANS AFFAIRS",?(IOM-10),"Page ",$J(PAGE,3)
"RTN","PRCH4RPT",53,0)
 S X=$$FMTE^XLFDT($$NOW^XLFDT())
"RTN","PRCH4RPT",54,0)
 W !,?30,$P($$UP^XLFSTR(X),":",1,2)
"RTN","PRCH4RPT",55,0)
 W !!,"** ",$P("ALL Citibank cards with No US Bank replacement #^Active Citibank cards with No US Bank replacement #^Inactive Citibank cards with US Bank replacement #",U,PRCDET)
"RTN","PRCH4RPT",56,0)
 W !!,HDRW,!!
"RTN","PRCH4RPT",57,0)
 Q
"RTN","PRCH4RPT",58,0)
EOP() ; end of page check - return 1 to quit, 0 to continue
"RTN","PRCH4RPT",59,0)
 ; 
"RTN","PRCH4RPT",60,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","PRCH4RPT",61,0)
 I $E(IOST,1,2)'="C-" Q 0  ; not to terminal
"RTN","PRCH4RPT",62,0)
 S DIR(0)="E"
"RTN","PRCH4RPT",63,0)
 D ^DIR
"RTN","PRCH4RPT",64,0)
 Q 'Y
"RTN","PRCH4RPT",65,0)
EXIT S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PRCH4RPT",66,0)
 I $G(CTR)=0 W !!?15,"** NO CARDS FOUND MEETING REPORT CRITERIA REQUESTED **"
"RTN","PRCH4RPT",67,0)
 W !!,"< END OF REPORT >" I $G(PAGE)>0,$E(IOST,1,2)="C-" S END=$$EOP^PRCH4RPT()
"RTN","PRCH4RPT",68,0)
EXITZ W:$E(IOST,1,2)'="C-" @IOF
"RTN","PRCH4RPT",69,0)
 D ^%ZISC
"RTN","PRCH4RPT",70,0)
 K PRCA,PRCB,PRCF,DIR,DIRUT,DTOUT,PRCDET,POP
"RTN","PRCH4RPT",71,0)
 K IEN,PAGE,CTR,PCNO,END,PAGE,HDRW,PRCC,X,Y
"RTN","PRCH4RPT",72,0)
 K ^TMP($J)
"RTN","PRCH4RPT",73,0)
 Q
"RTN","PRCHUSER")
0^5^B15927920^B5953549
"RTN","PRCHUSER",1,0)
PRCHUSER ;WISC/AKS-Add/Edit purchase card user ;9/12/00  22:52
"RTN","PRCHUSER",2,0)
 ;;5.1;IFCAP;**8,125**;Oct 20, 2000;Build 15
"RTN","PRCHUSER",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHUSER",4,0)
 N DIC,DA,Y,DIE,DR,PRCF,%,PRCHORIG,PRCRI
"RTN","PRCHUSER",5,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))  Q:$G(X)="^"
"RTN","PRCHUSER",6,0)
MORE S DIC="^PRC(440.5,",DIC(0)="AELQM",DLAYGO=440.5
"RTN","PRCHUSER",7,0)
 S DIC("S")="I $D(PRC(""SITE"")),$P($G(^PRC(440.5,+Y,2)),""^"",3)=PRC(""SITE"")"
"RTN","PRCHUSER",8,0)
 D ^DIC Q:Y'>0  S DA=+Y,PRCRI(440.5)=DA,PRCIEN=DA
"RTN","PRCHUSER",9,0)
 N SITECHK S SITECHK=$P($G(^PRC(440.5,DA,2)),U,3) I +SITECHK'=0,SITECHK'=PRC("SITE") W !!,"This card is not entered for this station." H 3 G MORE
"RTN","PRCHUSER",10,0)
 S DIE="^PRC(440.5,",DR="[PRCH PURCHASE CARD]" D ^DIE ;Q:$D(Y)
"RTN","PRCHUSER",11,0)
 D EDIT^PRC0B(.X,"440.5;^PRC(440.5,;"_PRCRI(440.5),"70////P;71////"_DT)
"RTN","PRCHUSER",12,0)
 K PRCHHLDR,PRCHAPP,PRCHALT,PRCHSING,PRCHMNTH
"RTN","PRCHUSER",13,0)
 I '$G(DA) G Q
"RTN","PRCHUSER",14,0)
 S DA(1)=DA S PRCHUSER=$P(^PRC(440.5,DA,0),U,8)
"RTN","PRCHUSER",15,0)
 I $G(PRCHUSER),$G(PRCHORIG),PRCHUSER'=PRCHORIG D
"RTN","PRCHUSER",16,0)
 . S DIK="^PRC(440.5,"_DA(1)_",1,",DA=PRCHORIG D ^DIK K Y,DIK
"RTN","PRCHUSER",17,0)
 I $G(PRCHUSER),'$D(^PRC(440.5,DA,1,PRCHUSER)) D
"RTN","PRCHUSER",18,0)
 . I '$G(^PRC(440.5,DA(1),1,0)) D
"RTN","PRCHUSER",19,0)
 . . S $P(^PRC(440.5,DA(1),1,0),U,2)=$P(^DD(440.5,12,0),U,2)
"RTN","PRCHUSER",20,0)
 . S DIE="^PRC(440.5,"_DA(1)_",1,",DA=PRCHUSER,DR=".01////^S X=PRCHUSER"
"RTN","PRCHUSER",21,0)
 . D ^DIE
"RTN","PRCHUSER",22,0)
 . S $P(^PRC(440.5,DA(1),1,0),U,3)=DA,$P(^(0),U,4)=$P(^(0),U,4)+1
"RTN","PRCHUSER",23,0)
 . K DIE,DR,PRCHUSER
"RTN","PRCHUSER",24,0)
MORES S:'$D(DA(1)) DA(1)=DA S DIC="^PRC(440.5,"_DA(1)_",1,",DIC(0)="AELQ"
"RTN","PRCHUSER",25,0)
 S DIC("S")="I +Y'=$P(^PRC(440.5,DA(1),0),U,8)" D ^DIC
"RTN","PRCHUSER",26,0)
 G:$D(DUOUT)!$D(DTOUT) Q G REPL:Y'>0  S DA=+Y
"RTN","PRCHUSER",27,0)
 I $P(Y,U,3)'=1 D
"RTN","PRCHUSER",28,0)
 . W !!?5,"Would you like to delete this surrogate user" S %=2 D YN^DICN
"RTN","PRCHUSER",29,0)
 . Q:%<1!(%=2)
"RTN","PRCHUSER",30,0)
 . S DA=+Y,DIK="^PRC(440.5,"_DA(1)_",1,"
"RTN","PRCHUSER",31,0)
 . D ^DIK K Y,DIK
"RTN","PRCHUSER",32,0)
 G MORES
"RTN","PRCHUSER",33,0)
REPL ;REPLACEMENT CARD ENTRY
"RTN","PRCHUSER",34,0)
 D NOW^%DTC S XNOW=X
"RTN","PRCHUSER",35,0)
 K DIR
"RTN","PRCHUSER",36,0)
 S PRCRPLO=$P($G(^PRC(440.5,PRCIEN,50)),U)
"RTN","PRCHUSER",37,0)
REPL1 S DIR("A")="REPLACED CARD: " S:PRCRPLO'="" DIR("B")=PRCRPLO S DIR("?")="Enter a valid card number for replaced card, 16 digits",DIR(0)="FAO^16:16"
"RTN","PRCHUSER",38,0)
 D ^DIR G Q:$D(DIRUT)!$D(DTOUT) S PRCRPLN=X K DIR
"RTN","PRCHUSER",39,0)
 I PRCRPLN'?1.N W "   Must be 16 digits!!" G REPL1
"RTN","PRCHUSER",40,0)
 I PRCRPLO=PRCRPLN!'PRCRPLN G Q
"RTN","PRCHUSER",41,0)
 S PRCRIENN=$O(^PRC(440.5,"B",PRCRPLN,0)) I 'PRCRIENN W "    Not a valid Purchase Card number" G REPL
"RTN","PRCHUSER",42,0)
 I $P(^PRC(440.5,PRCRIENN,2),U,2)'="Y" W "    Replaced Card Must be INACTIVE" G REPL
"RTN","PRCHUSER",43,0)
 S PRCIENP=$O(^PRC(440.5,"ARPC",PRCRPLN,0)) I PRCIENP W "    Replaced Card already listed under card: ",$P(^PRC(440.5,PRCIENP,0),U) G REPL
"RTN","PRCHUSER",44,0)
 S ERR="" D  I ERR'="" W !," >> Replaced card does not match this card for: ",ERR G REPL
"RTN","PRCHUSER",45,0)
 . S PRCUR0=^PRC(440.5,PRCIEN,0),PRCUR2=^PRC(440.5,PRCIEN,2),PRCRPL0=$G(^PRC(440.5,PRCRIENN,0)),PRCRPL2=$G(^PRC(440.5,PRCRIENN,2))
"RTN","PRCHUSER",46,0)
 . I $P(PRCUR0,U,8)'=$P(PRCRPL0,U,8) S ERR="CARD HOLDER"
"RTN","PRCHUSER",47,0)
 . I $P(PRCUR0,U,2)'=$P(PRCRPL0,U,2) S:ERR'="" ERR=ERR_"," S ERR=ERR_"FUND CONTROL POINT"
"RTN","PRCHUSER",48,0)
 . I $P(PRCUR0,U,3)'=$P(PRCRPL0,U,3) S:ERR'="" ERR=ERR_"," S ERR=ERR_"COST CENTER"
"RTN","PRCHUSER",49,0)
 . I $P(PRCUR0,U,4)'=$P(PRCRPL0,U,4) S:ERR'="" ERR=ERR_"," S ERR=ERR_"BUDGET OBJECT CODE"
"RTN","PRCHUSER",50,0)
 . I $P(PRCUR2,U,3)'=$P(PRCRPL2,U,3) S:ERR'="" ERR=ERR_"," S ERR=ERR_"STATION NUMBER"
"RTN","PRCHUSER",51,0)
 K DIE S DIE="^PRC(440.5,",DA=PRCIEN,DR="51///^S X=PRCRPLN" D ^DIE K DIE,DA,DR
"RTN","PRCHUSER",52,0)
Q W !!?5,"Would you like to register another purchase card" S %=2 D YN^DICN
"RTN","PRCHUSER",53,0)
 W ! G:%=1 MORE I %=0 W !!,"Please answer 'Yes' or 'No'"
"RTN","PRCHUSER",54,0)
 K DLAYGO,DA,PRCRPLO,DIR,PRCRPLN,PRCIEN,PRCRIENN,PRCIENP,ERR,PRCUR0,PRCUR2,PRCRPL0,PRCRPL2,XNOW,DIRUT,DTOUT,DIK,DUOUT,DIROUT
"RTN","PRCHUSER",55,0)
 QUIT
"RTN","PRCHUSER",56,0)
INPUT1 ;Input transform for File #440.5, Field #1
"RTN","PRCHUSER",57,0)
 S DIC="^PRC(420,PRC(""SITE""),1,",DIC(0)="QEMNZ" S DIC("S")="I $D(^PRC(420,""C"",PRCHHLDR,PRC(""SITE""),+Y))",D="B^C" D MIX^DIC1 K:Y<0 X K DIC,D
"RTN","PRCHUSER",58,0)
 Q:'$D(X)  S X=$P(Y(0),U)
"RTN","PRCHUSER",59,0)
 Q
"VER")
8.0^22.0
"^DD",440.6,440.6,4,0)
BANK'S VENDOR ID^FX^^0;5^K:$L(X)>11!($L(X)<1) X
"^DD",440.6,440.6,4,3)
Answer must be 1-11 characters in length.
"^DD",440.6,440.6,4,21,0)
^^1^1^2960528^
"^DD",440.6,440.6,4,21,1,0)
This is a vendor id of Rocky Mountain Bank.
"^DD",440.6,440.6,4,"DT")
3081105
"BLD",5797,6)
^104
**END**
**END**
