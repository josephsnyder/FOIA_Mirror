Released PRC*5.1*113 SEQ #97
Extracted from mail message
**KIDS**:PRC*5.1*113^

**INSTALL NAME**
PRC*5.1*113
"BLD",5340,0)
PRC*5.1*113^IFCAP^0^3080213^y
"BLD",5340,1,0)
^^17^17^3071105^
"BLD",5340,1,1,0)
1.  Issue involves the inability of the Approving Official or Alternate 
"BLD",5340,1,2,0)
    Approving Official to cancel incomplete PC orders.  Currently, only 
"BLD",5340,1,3,0)
    the individual who placed the order can cancel the order. If the user
"BLD",5340,1,4,0)
    who placed the order has left the VA there is no proper way to handle
"BLD",5340,1,5,0)
    the canceling of the order.  
"BLD",5340,1,6,0)
 
"BLD",5340,1,7,0)
2. A correction to edits of the Edit/Remove Reconciliation 
"BLD",5340,1,8,0)
   [RECONCILIATION  PRCH P.C.O. ED/REMO RECONCILE] option which was
"BLD",5340,1,9,0)
   affecting the Delinquent Approval Report.
"BLD",5340,1,10,0)
 
"BLD",5340,1,11,0)
3. Issue is with a Source Code Amendment to a purchase order. When the
"BLD",5340,1,12,0)
   Source Code is amended to Federal Contract there is no screen in 
"BLD",5340,1,13,0)
   place to make sure the item on the purchase order has a contract 
"BLD",5340,1,14,0)
   associated with it before approving the amendment.  
"BLD",5340,1,15,0)
 
"BLD",5340,1,16,0)
4. Issue involves the ability to select inactive Fund Control Point
"BLD",5340,1,17,0)
   (FCP) when creating Purchase Card Orders.
"BLD",5340,4,0)
^9.64PA^440.6^1
"BLD",5340,4,440.6,0)
440.6
"BLD",5340,4,440.6,2,0)
^9.641^440.6^1
"BLD",5340,4,440.6,2,440.6,0)
PURCHASE CARD ORDER RECONCILE  (File-top level)
"BLD",5340,4,440.6,2,440.6,1,0)
^9.6411^44^1
"BLD",5340,4,440.6,2,440.6,1,44,0)
FINAL CHARGE
"BLD",5340,4,440.6,222)
y^n^p^^^^n^^n
"BLD",5340,4,440.6,224)

"BLD",5340,4,"APDD",440.6,440.6)

"BLD",5340,4,"APDD",440.6,440.6,44)

"BLD",5340,4,"B",440.6,440.6)

"BLD",5340,6.3)
4
"BLD",5340,"ABPKG")
n
"BLD",5340,"INIT")
FINDREC^PRCOT07
"BLD",5340,"KRN",0)
^9.67PA^8989.52^19
"BLD",5340,"KRN",.4,0)
.4
"BLD",5340,"KRN",.401,0)
.401
"BLD",5340,"KRN",.402,0)
.402
"BLD",5340,"KRN",.403,0)
.403
"BLD",5340,"KRN",.5,0)
.5
"BLD",5340,"KRN",.84,0)
.84
"BLD",5340,"KRN",3.6,0)
3.6
"BLD",5340,"KRN",3.8,0)
3.8
"BLD",5340,"KRN",9.2,0)
9.2
"BLD",5340,"KRN",9.8,0)
9.8
"BLD",5340,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",5340,"KRN",9.8,"NM",1,0)
PRCHNPO5^^0^B37990669
"BLD",5340,"KRN",9.8,"NM",2,0)
PRCHNPO8^^0^B8355080
"BLD",5340,"KRN",9.8,"NM",3,0)
PRCHMA^^0^B76984326
"BLD",5340,"KRN",9.8,"NM",4,0)
PRCIREC^^0^B1330183
"BLD",5340,"KRN",9.8,"NM",5,0)
PRCOT07^^0^B1178396
"BLD",5340,"KRN",9.8,"NM",6,0)
PRCHPCAR^^0^B19373875
"BLD",5340,"KRN",9.8,"NM","B","PRCHMA",3)

"BLD",5340,"KRN",9.8,"NM","B","PRCHNPO5",1)

"BLD",5340,"KRN",9.8,"NM","B","PRCHNPO8",2)

"BLD",5340,"KRN",9.8,"NM","B","PRCHPCAR",6)

"BLD",5340,"KRN",9.8,"NM","B","PRCIREC",4)

"BLD",5340,"KRN",9.8,"NM","B","PRCOT07",5)

"BLD",5340,"KRN",19,0)
19
"BLD",5340,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",5340,"KRN",19,"NM",1,0)
PRCH AO CANCEL INCOM PC ORDER^^0
"BLD",5340,"KRN",19,"NM","B","PRCH AO CANCEL INCOM PC ORDER",1)

"BLD",5340,"KRN",19.1,0)
19.1
"BLD",5340,"KRN",101,0)
101
"BLD",5340,"KRN",409.61,0)
409.61
"BLD",5340,"KRN",771,0)
771
"BLD",5340,"KRN",870,0)
870
"BLD",5340,"KRN",8989.51,0)
8989.51
"BLD",5340,"KRN",8989.52,0)
8989.52
"BLD",5340,"KRN",8994,0)
8994
"BLD",5340,"KRN","B",.4,.4)

"BLD",5340,"KRN","B",.401,.401)

"BLD",5340,"KRN","B",.402,.402)

"BLD",5340,"KRN","B",.403,.403)

"BLD",5340,"KRN","B",.5,.5)

"BLD",5340,"KRN","B",.84,.84)

"BLD",5340,"KRN","B",3.6,3.6)

"BLD",5340,"KRN","B",3.8,3.8)

"BLD",5340,"KRN","B",9.2,9.2)

"BLD",5340,"KRN","B",9.8,9.8)

"BLD",5340,"KRN","B",19,19)

"BLD",5340,"KRN","B",19.1,19.1)

"BLD",5340,"KRN","B",101,101)

"BLD",5340,"KRN","B",409.61,409.61)

"BLD",5340,"KRN","B",771,771)

"BLD",5340,"KRN","B",870,870)

"BLD",5340,"KRN","B",8989.51,8989.51)

"BLD",5340,"KRN","B",8989.52,8989.52)

"BLD",5340,"KRN","B",8994,8994)

"BLD",5340,"QUES",0)
^9.62^^
"BLD",5340,"REQB",0)
^9.611^1^1
"BLD",5340,"REQB",1,0)
PRC*5.1*100^2
"BLD",5340,"REQB","B","PRC*5.1*100",1)

"FIA",440.6)
PURCHASE CARD ORDER RECONCILE
"FIA",440.6,0)
^PRCH(440.6,
"FIA",440.6,0,0)
440.6I
"FIA",440.6,0,1)
y^n^p^^^^n^^n
"FIA",440.6,0,10)

"FIA",440.6,0,11)

"FIA",440.6,0,"RLRO")

"FIA",440.6,0,"VR")
5.1^PRC
"FIA",440.6,440.6)
1
"FIA",440.6,440.6,44)

"INIT")
FINDREC^PRCOT07
"KRN",19,12210,-1)
0^1
"KRN",19,12210,0)
PRCH AO CANCEL INCOM PC ORDER^CANCEL INCOMPLETE PC ORDER - APPROVING OFFICIAL^^R^^PRCH AR^^^^^^IFCAP
"KRN",19,12210,25)
AOCANPC^PRCHPCAR
"KRN",19,12210,"U")
CANCEL INCOMPLETE PC ORDER - A
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
113^3080213
"PKG",455,22,1,"PAH",1,1,0)
^^17^17^3080213
"PKG",455,22,1,"PAH",1,1,1,0)
1.  Issue involves the inability of the Approving Official or Alternate 
"PKG",455,22,1,"PAH",1,1,2,0)
    Approving Official to cancel incomplete PC orders.  Currently, only 
"PKG",455,22,1,"PAH",1,1,3,0)
    the individual who placed the order can cancel the order. If the user
"PKG",455,22,1,"PAH",1,1,4,0)
    who placed the order has left the VA there is no proper way to handle
"PKG",455,22,1,"PAH",1,1,5,0)
    the canceling of the order.  
"PKG",455,22,1,"PAH",1,1,6,0)
 
"PKG",455,22,1,"PAH",1,1,7,0)
2. A correction to edits of the Edit/Remove Reconciliation 
"PKG",455,22,1,"PAH",1,1,8,0)
   [RECONCILIATION  PRCH P.C.O. ED/REMO RECONCILE] option which was
"PKG",455,22,1,"PAH",1,1,9,0)
   affecting the Delinquent Approval Report.
"PKG",455,22,1,"PAH",1,1,10,0)
 
"PKG",455,22,1,"PAH",1,1,11,0)
3. Issue is with a Source Code Amendment to a purchase order. When the
"PKG",455,22,1,"PAH",1,1,12,0)
   Source Code is amended to Federal Contract there is no screen in 
"PKG",455,22,1,"PAH",1,1,13,0)
   place to make sure the item on the purchase order has a contract 
"PKG",455,22,1,"PAH",1,1,14,0)
   associated with it before approving the amendment.  
"PKG",455,22,1,"PAH",1,1,15,0)
 
"PKG",455,22,1,"PAH",1,1,16,0)
4. Issue involves the ability to select inactive Fund Control Point
"PKG",455,22,1,"PAH",1,1,17,0)
   (FCP) when creating Purchase Card Orders.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PRCHMA")
0^3^B76984326^B77180458
"RTN","PRCHMA",1,0)
PRCHMA ;WISC/AKS-Amend to PO, req ;6/10/96  14:07
"RTN","PRCHMA",2,0)
 ;;5.1;IFCAP;**21,79,100,113**;Oct 20, 2000;Build 4
"RTN","PRCHMA",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHMA",4,0)
REQ N PRCHREQ
"RTN","PRCHMA",5,0)
 S PRCHREQ=1
"RTN","PRCHMA",6,0)
PO N PRCF,RETURN,PRCHAM,PRCHPO,PRCHNEW,OUT,CAN,PRCHAU,PRCHER,PRCHON,A,B,ER,FL,FIS,DELIVER,PRCHAMDA,PRCHAV,PRCHL1,PRCHLN,PRCHRET,LCNT
"RTN","PRCHMA",7,0)
 N PRCHL2,ROU,DIC,I,PRCHAMT,PRCHAREC,PRCHEDI,X,Y,PRCHN,PRCHO,SFUND,PRCHX,PRCHIMP,PRCHNRQ,PRCHP,REPO,PRCHNORE,%,%A,%B,D0,D1,J
"RTN","PRCHMA",8,0)
 N PRCFL,MSG
"RTN","PRCHMA",9,0)
LOOP D KILL^PRCHMA1 S PRCHNEW="",PRCHNORE=1,CAN=0
"RTN","PRCHMA",10,0)
 ; See routine PRCHAMXA for information on variable PRCHNORE and undefined DIK, var PRCHPO is the basic premise of locks applied to amendments
"RTN","PRCHMA",11,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))
"RTN","PRCHMA",12,0)
 ; Lock simultaneous entry of users in amend. module for the same record.  Var Y is saved in PRCHPO at the end of GETPO subrtn, when we start
"RTN","PRCHMA",13,0)
 ; the process(AMENDNO) of amending the record we must have var PRCHPO.
"RTN","PRCHMA",14,0)
 S PRCFL=0
"RTN","PRCHMA",15,0)
 W !! D GETPO^PRCHAMU
"RTN","PRCHMA",16,0)
 ; If no record is selected or time-out or up-arrow out then exit without unlocking a record.
"RTN","PRCHMA",17,0)
 I $D(DTOUT)!$D(DUOUT)!$G(OUT)=1 G EXIT1
"RTN","PRCHMA",18,0)
 I PRCFL=1 G LOOP
"RTN","PRCHMA",19,0)
 I '$G(PRCHPO)!$D(FIS) G EXIT
"RTN","PRCHMA",20,0)
 I '$$VERIFY^PRCHES5(PRCHPO) W !!,?5,"This purchase order has been tampered with.",!,?5,"Please notify IFCAP APPLICATION COORDINATOR.",! G EXIT
"RTN","PRCHMA",21,0)
 D AMENDNO^PRCHAMU G:'$G(PRCHAM) EXIT
"RTN","PRCHMA",22,0)
 S PRCHAMT=0,FL=0
"RTN","PRCHMA",23,0)
 D INFO^PRCHAMU G:$D(PRCHAV)!ER EXIT
"RTN","PRCHMA",24,0)
 S X=$P($G(^PRC(443.6,PRCHPO,0)),U,16) D EN2^PRCHAMXB
"RTN","PRCHMA",25,0)
 I PRCHNEW="" S DA(1)=PRCHPO,DA=PRCHAM,PRCHX=X,X=0,PRCHAMDA=34 D EN8^PRCHAMXB S X=PRCHX
"RTN","PRCHMA",26,0)
 I $P(^PRC(443.6,PRCHPO,6,PRCHAM,0),U,4)=5!($P(^(0),U,4)=15) S CAN=1
"RTN","PRCHMA",27,0)
 I PRCHNEW=111&($G(CAN)=0) D REV
"RTN","PRCHMA",28,0)
 I $G(CAN)>0 D ENC G:ER EXIT I $G(NOCAN)=0 S DA(1)=PRCHPO,DA=PRCHAM,PRCHAMDA=34,PRCHX=X,X=0 D EN8^PRCHAMXB S X=PRCHX G CAN1
"RTN","PRCHMA",29,0)
ASK K NOCAN,DTOUT,DUOUT,REPONUM D ASK^PRCHAMU
"RTN","PRCHMA",30,0)
 G:$D(REPONUM)=1 CAN1
"RTN","PRCHMA",31,0)
 I ER=0 D  G:'$D(REPO)&($G(CAN)=0) ASK
"RTN","PRCHMA",32,0)
 . D @ROU
"RTN","PRCHMA",33,0)
 . I $G(PRCHAMDA)=31 D MSG^PRCHAMU Q
"RTN","PRCHMA",34,0)
 . I $G(PRCHAMDA)=24,$G(X)=2 D MSG1^PRCHAMU S SCE=1 Q
"RTN","PRCHMA",35,0)
 I $P(^PRC(443.6,PRCHPO,6,PRCHAM,0),U,4)=5!($P(^(0),U,4)=15) S CAN=1
"RTN","PRCHMA",36,0)
 I $D(DTOUT)!($D(DUOUT)) G EXIT
"RTN","PRCHMA",37,0)
 I $G(NOCAN)=1 G ASK
"RTN","PRCHMA",38,0)
 G:$P($G(^PRC(443.6,PRCHPO,6,PRCHAM,3,0)),U,4)'>1 EXIT
"RTN","PRCHMA",39,0)
CAN1 S BFLAG=0
"RTN","PRCHMA",40,0)
 S:$P($G(^PRC(443.6,PRCHPO,1)),U,7)'=6 BFLAG=1
"RTN","PRCHMA",41,0)
 I $P($G(^PRC(443.6,PRCHPO,1)),U,7)=6  D
"RTN","PRCHMA",42,0)
 .S THISHLD=0
"RTN","PRCHMA",43,0)
 .F  S THISHLD=$O(^PRC(443.6,PRCHPO,2,THISHLD)) Q:'THISHLD!(BFLAG=1)  D
"RTN","PRCHMA",44,0)
 ..S:$P($G(^PRC(443.6,PRCHPO,2,THISHLD,2)),U,2)'="" BFLAG=1
"RTN","PRCHMA",45,0)
 .Q:BFLAG=1
"RTN","PRCHMA",46,0)
 .S THISHLD=0
"RTN","PRCHMA",47,0)
 .F  S THISHLD=$O(^PRC(442,PRCHPO,2,THISHLD)) Q:'THISHLD!(BFLAG=1)  D
"RTN","PRCHMA",48,0)
 ..S:$P($G(^PRC(442,PRCHPO,2,THISHLD,2)),U,2)'="" BFLAG=1
"RTN","PRCHMA",49,0)
 W:BFLAG=0 !,"This is now a contract order.  You must add a contract to this orders item(s)",!,"before approving the amendment.",!
"RTN","PRCHMA",50,0)
 G:BFLAG=0 EXIT
"RTN","PRCHMA",51,0)
 D:BFLAG=1 UPDATE^PRCHAMU G:$D(Y) EXIT
"RTN","PRCHMA",52,0)
CHK I '$$VERIFY^PRCHES5(PRCHPO) W !!,?5,"This purchase order has been tampered with.",!,?5,"Please notify IFCAP APPLICATION COORDINATOR." G EXIT
"RTN","PRCHMA",53,0)
 I $P($G(^PRC(443.6,PRCHPO,6,PRCHAM,1)),U,4)']"" W !!,?5,"There is no Amendment Status." D
"RTN","PRCHMA",54,0)
 .S POSTAT=+$G(^PRC(443.6,PRCHPO,7))
"RTN","PRCHMA",55,0)
 .S AMSTAT=$S(POSTAT=25:26,POSTAT=30:31,POSTAT=40:71,POSTAT=6:83,POSTAT=84:85,POSTAT=86:87,POSTAT=90:91,POSTAT=92:93,POSTAT=94:95,POSTAT=96:97,POSTAT=45:45,1:POSTAT)
"RTN","PRCHMA",56,0)
 .S AMSTAT=$P(^PRCD(442.3,AMSTAT,0),U)
"RTN","PRCHMA",57,0)
 .S DIE="^PRC(443.6,PRCHPO,6,",DA(1)=PRCHPO,DA=PRCHAM,DR="9//^S X=AMSTAT"
"RTN","PRCHMA",58,0)
 .D ^DIE K DIE,AMSTAT,POSTAT
"RTN","PRCHMA",59,0)
 K PRCHER S LCNT=1 I $P($G(^PRC(443.6,PRCHPO,6,PRCHAM,1)),U,4)']"" W !!,?5,"There is no Amendment Status.",! S PRCHER=""
"RTN","PRCHMA",60,0)
 I $P($G(^PRC(443.6,PRCHPO,2,0)),U,4)>0 D  G:$D(PRCHER) ERR
"RTN","PRCHMA",61,0)
 .N END S END=IOSL-3
"RTN","PRCHMA",62,0)
 .S PRCH=0 F  S PRCH=$O(^PRC(443.6,PRCHPO,2,PRCH)) Q:PRCH=""!(PRCH'>0)  D
"RTN","PRCHMA",63,0)
 ..S PRCHLN=$G(^PRC(443.6,PRCHPO,2,PRCH,0)) D  Q
"RTN","PRCHMA",64,0)
 ...I $P(PRCHLN,U,4)="" D:LCNT>END TOP W !!,?5,"Line item ",+$P(PRCHLN,U)," is missing BOC !",$C(7) S PRCHER="",LCNT=LCNT+2
"RTN","PRCHMA",65,0)
 ...I $G(PRCHAUTH)'=1,$G(PRCHREQ) I $P(PRCHLN,U,13)="" D:LCNT>END TOP W !!,?5,"Line item ",+$P(PRCHLN,U)," is missing NSN!",$C(7) S PRCHER="",LCNT=LCNT+2
"RTN","PRCHMA",66,0)
 ...S J=0 S J=$O(^PRC(443.6,PRCHPO,2,PRCH,1,J)) I J'>0 D:LCNT>END TOP W !!,?5,"Line item ",+$P(PRCHLN,U)," is missing its description!",$C(7) S PRCHER="",LCNT=LCNT+2
"RTN","PRCHMA",67,0)
 ...I $P($G(^PRC(442,PRCHPO,23)),U,11)="D",$P($G(^PRC(443.6,PRCHPO,2,PRCH,2)),U,2)="" D:LCNT>END TOP W !!,?5,"Line item ",+$P(PRCHLN,U)," is missing contract number.",$C(7) S PRCHER="",LCNT=LCNT+2
"RTN","PRCHMA",68,0)
 ...; PRC*5.1*79 - Check line items of PC orders with source code=6 to make sure that a contract number is entered
"RTN","PRCHMA",69,0)
 ...D PCD^PRCHMA1
"RTN","PRCHMA",70,0)
 ...Q
"RTN","PRCHMA",71,0)
 ..Q
"RTN","PRCHMA",72,0)
 .I $D(PRCHER) I LCNT>END N DIR S DIR(0)="E" D ^DIR S LCNT=1
"RTN","PRCHMA",73,0)
 .Q
"RTN","PRCHMA",74,0)
 D EN106^PRCHNPO7 I $G(ERROR)=1 G EXIT
"RTN","PRCHMA",75,0)
 I $P($G(^PRC(443.6,PRCHPO,0)),U,13)>0 I $P($G(^PRC(443.6,PRCHPO,23)),U)="" W !!,?5,"This amendment has Est. Shipping and/or Handling charges without any",!,?5,"Est. Shipping BOC." S PRCHER=""
"RTN","PRCHMA",76,0)
 I $P($G(^PRC(443.6,PRCHPO,6,PRCHAM,0)),U,4)=5!($P($G(^(0)),U,4)=15) S CAN=1
"RTN","PRCHMA",77,0)
 I $G(CAN)'=1 D CHECK^PRCHAMDF(PRCHPO,PRCHAM,.PRCHER)
"RTN","PRCHMA",78,0)
 I $G(PRCHAUTH)=1!($P($G(^PRC(443.6,PRCHPO,0)),U,2)=25) S FILE=443.6 D  I $G(ERROR) S PRCHER="" K ERROR,FILE
"RTN","PRCHMA",79,0)
 .D ^PRCHSF3
"RTN","PRCHMA",80,0)
 .D ADJ1^PRCHCD0
"RTN","PRCHMA",81,0)
 .D LIMIT^PRCHCD0
"RTN","PRCHMA",82,0)
 ;
"RTN","PRCHMA",83,0)
ERR I $D(PRCHER) W !!,?5,"This amendment needs to be re-edited before it can be signed.",!,"**REMINDER** Unsigned amendments are deleted from the system after 7 days." D:LCNT>20  G EXIT
"RTN","PRCHMA",84,0)
 .N DIR S DIR(0)="E" D ^DIR
"RTN","PRCHMA",85,0)
 .Q
"RTN","PRCHMA",86,0)
 D REV:'$G(PRCPROST),APP G:%'=1 EXIT
"RTN","PRCHMA",87,0)
 S PRCHRET=$$ASK^PRCHAM8(PRCHPO,PRCHAM) G:PRCHRET'=1 EXIT
"RTN","PRCHMA",88,0)
 S RETURN="" D COMMIT^PRCHAM8(PRCHPO,PRCHAM,.RETURN)
"RTN","PRCHMA",89,0)
 G:RETURN'=1 EXIT
"RTN","PRCHMA",90,0)
 S DIE="^PRC(443.6,"_PRCHPO_",6,",DA=PRCHAM,DR="15///TODAY+4" D ^DIE
"RTN","PRCHMA",91,0)
 D ^PRCHSF3
"RTN","PRCHMA",92,0)
 I $P(^PRC(443.6,PRCHPO,0),U,2)'=25 S PRCHQ="^PRCHPAM8",PRCHQ("DEST")="F",D0=PRCHPO,D1=PRCHAM D ^PRCHQUE
"RTN","PRCHMA",93,0)
 I '($P(^PRC(443.6,PRCHPO,0),U,2)=25!($P(^PRC(443.6,PRCHPO,0),U,19)=2)) D
"RTN","PRCHMA",94,0)
 . W !?3,"SEND TO SUPPLY " S PRCHQ="^PRCHPAM8",D0=PRCHPO,D1=PRCHAM D ^PRCHQUE
"RTN","PRCHMA",95,0)
 . S FILE=443.6 D:$D(PRCHPO) CHECK^PRCHSWCH
"RTN","PRCHMA",96,0)
 . I $G(PRCHOBL)=1 D SUPP^PRCFFM2M K FILE Q
"RTN","PRCHMA",97,0)
 . I $G(PRCHOBL)=2 S PRCOPODA=PRCHPO D ^PRCOEDI K FILE,PRCOPODA Q
"RTN","PRCHMA",98,0)
 I $P($G(^PRC(443.6,PRCHPO,0)),U,2)=25 D  S:$G(PRCPROST) PRCPROST=PRCPROST+0.9 G EXIT
"RTN","PRCHMA",99,0)
 .S MTOPDA=1
"RTN","PRCHMA",100,0)
 .D SUPP^PRCFFM2M ;I $P($G(^PRC(442,PRCHPO,23)),"^",11)="P" W !!,"...now generating the PHA transaction..." S PRCOPODA=PRCHPO D NEW^PRCOEDI K PRCOPODA W !!
"RTN","PRCHMA",101,0)
 .S PPTEMP=0,PP410=$P($G(^PRC(442,PRCHPO,0)),"^",12),PPAMT=$P($G(^PRC(442,PRCHPO,0)),"^",16) I PP410'="" S PPTEMP=$P($G(^PRCS(410,PP410,4)),"^",8),PPTEMP=-(PPAMT-PPTEMP)
"RTN","PRCHMA",102,0)
 .I $P($G(^PRC(442,PRCHPO,7)),"^",2)=45 S PPTEMP=PPAMT,PPAMT=0
"RTN","PRCHMA",103,0)
 .I PP410'="" S $P(^PRCS(410,PP410,4),"^",3)=0
"RTN","PRCHMA",104,0)
 .I PP410'="" S $P(^PRCS(410,PP410,4),"^",8)=PPAMT
"RTN","PRCHMA",105,0)
 .S A=$$DATE^PRC0C($P(PRCOAMT,"^",3),"I"),$P(PRCOAMT,"^",3,4)=$E(A,3,4)_"^"_$P(A,"^",2),$P(PRCOAMT,"^",5)=PPTEMP D EBAL^PRCSEZ(PRCOAMT,"O")
"RTN","PRCHMA",106,0)
 .I PP410'="",$P($G(^PRC(442,PRCHPO,7)),"^",2)=45 S $P(^PRCS(410,PP410,0),"^",2)="CA" D ERS410^PRC0G(PP410_"^C")
"RTN","PRCHMA",107,0)
 .D REMOVE^PRCSC2(PP410),ENCODE^PRCSC2(PP410,DUZ,.MESSAGE) K MESSAGE
"RTN","PRCHMA",108,0)
 .I '$G(PRCPROST) W !?3,"SEND TO SUPPLY " S PRCHQ="^PRCHPAM",D0=PRCHPO,D1=PRCHAM D ^PRCHQUE
"RTN","PRCHMA",109,0)
 .; Update file #440.5 after amendment has been approved. Consider orders created and amended in the same month and year and the user either
"RTN","PRCHMA",110,0)
 .; cancels the order or enters other type of amendment that changes the final amount of the order. No credit is given for orders from a
"RTN","PRCHMA",111,0)
 .; previous month and year. DT is the current date, system-supplied.
"RTN","PRCHMA",112,0)
 .S PRCHCD=$P($G(^PRC(442,PRCHPO,23)),U,8)
"RTN","PRCHMA",113,0)
 .S PRCNODE=$G(^PRC(442,PRCHPO,6,0)),PRCAMD=$P(PRCNODE,U,3)
"RTN","PRCHMA",114,0)
 .S PRCCHG=$P($G(^PRC(442,PRCHPO,6,PRCAMD,0)),U,3)
"RTN","PRCHMA",115,0)
 .S POSTAT=$P($G(^PRC(442,PRCHPO,7)),"^",2)
"RTN","PRCHMA",116,0)
 .I $E($P(^PRC(442,PRCHPO,1),U,15),1,5)=$E(DT,1,5),POSTAT'=45 D
"RTN","PRCHMA",117,0)
 ..I $G(PPAMT)<0 Q
"RTN","PRCHMA",118,0)
 ..S $P(^PRC(440.5,PRCHCD,2),U)=$P($G(^PRC(440.5,PRCHCD,2)),U)+$G(PRCCHG)
"RTN","PRCHMA",119,0)
 ..I $P($G(^PRC(440.5,PRCHCD,2)),U)<0 S $P(^PRC(440.5,PRCHCD,2),U)=0
"RTN","PRCHMA",120,0)
 .;
"RTN","PRCHMA",121,0)
 .I $E($P(^PRC(442,PRCHPO,1),U,15),1,5)=$E(DT,1,5),POSTAT=45 D
"RTN","PRCHMA",122,0)
 ..I $G(PPTEMP)<0 Q
"RTN","PRCHMA",123,0)
 ..S $P(^PRC(440.5,PRCHCD,2),U)=$P($G(^PRC(440.5,PRCHCD,2)),U)-$G(PPTEMP)
"RTN","PRCHMA",124,0)
 ..I $P($G(^PRC(440.5,PRCHCD,2)),U)<0 S $P(^PRC(440.5,PRCHCD,2),U)=0
"RTN","PRCHMA",125,0)
 .;
"RTN","PRCHMA",126,0)
 .; Update file #440.5 only if the amendment is for non-cancellation
"RTN","PRCHMA",127,0)
 .; of an order from a previous month regardless of the year.
"RTN","PRCHMA",128,0)
 .I $E($P(^PRC(442,PRCHPO,1),U,15),1,5)'=$E(DT,1,5),POSTAT'=45 D
"RTN","PRCHMA",129,0)
 ..I $G(PPAMT)<0 Q
"RTN","PRCHMA",130,0)
 ..S $P(^PRC(440.5,PRCHCD,2),U)=$P($G(^PRC(440.5,PRCHCD,2)),U)+$G(PPAMT)
"RTN","PRCHMA",131,0)
 .K DA,MTOPDA,PRCAMD,PRCHCD,PRCCHG,PRCNODE,POSTAT,PPTEMP,PPAMT,PP410
"RTN","PRCHMA",132,0)
 S SFUND="" I $P($G(^PRC(443.6,PRCHPO,0)),U,19)=2 D SUPP^PRCFFM2M S SFUND=1
"RTN","PRCHMA",133,0)
 I SFUND=1 W !?3,"SEND TO SUPPLY " S PRCHQ="^PRCHPAM",D0=PRCHPO,D1=PRCHAM D ^PRCHQUE
"RTN","PRCHMA",134,0)
 D SOURCE^PRCHAMU:$G(SCE)
"RTN","PRCHMA",135,0)
 G EXIT
"RTN","PRCHMA",136,0)
ENC S ER=0
"RTN","PRCHMA",137,0)
 D CAN^PRCHMA3
"RTN","PRCHMA",138,0)
 I $G(NOCAN)=1 W !?5,$S($D(PRCHREQ):"REQUISITION",1:"PURCHASE ORDER")_" HAS BEEN RECEIVED, CANNOT CANCEL !",$C(7) S ER=1 Q
"RTN","PRCHMA",139,0)
 I $G(PRCHAUTH)=1 D PAID^PRCHINQ I $G(PAID)=1 D  S ER=1 Q
"RTN","PRCHMA",140,0)
 . W !,?5,"THERE HAS BEEN PAYMENT MADE FOR THIS PURCHASE CARD ORDER, CANNOT CANCEL !",$C(7)
"RTN","PRCHMA",141,0)
 S %="",%A="     SURE YOU WANT TO CANCEL THIS ORDER ",%B="" D ^PRCFYN
"RTN","PRCHMA",142,0)
 I %'=1 W ?40,"    <NOTHING CANCELLED>" D  Q
"RTN","PRCHMA",143,0)
 .I $D(PRCHAU) D
"RTN","PRCHMA",144,0)
 ..S $P(^PRC(443.6,PRCHPO,6,PRCHAM,0),U,4)=PRCHAU
"RTN","PRCHMA",145,0)
 ..S $P(^PRC(443.6,PRCHPO,6,PRCHAM,1),U,4)=""
"RTN","PRCHMA",146,0)
 .S NOCAN=1
"RTN","PRCHMA",147,0)
 S DA(1)=PRCHPO,DIE="^PRC(443.6,"_DA(1)_",6,",DA=PRCHAM,DR="9////^S X=$O(^PRCD(442.3,""C"",45,0))"
"RTN","PRCHMA",148,0)
 D ^DIE K DIE,DA,DR S CAN=1
"RTN","PRCHMA",149,0)
 S PRCHAMT=-$P(^PRC(443.6,PRCHPO,0),U,15) W !
"RTN","PRCHMA",150,0)
 QUIT
"RTN","PRCHMA",151,0)
APP S %A="   Approve Amendment number "_PRCHAM_": ",%B="",%=$S($G(PRCPROST):1,1:2) D ^PRCFYN
"RTN","PRCHMA",152,0)
 Q
"RTN","PRCHMA",153,0)
REV N PRCH
"RTN","PRCHMA",154,0)
 S %=1,%B="",%A="   Review Amendment " D ^PRCHSF3 W ! D ^PRCFYN
"RTN","PRCHMA",155,0)
 I %=1 S D0=PRCHPO,D1=PRCHAM,PRCH="^PRC(443.6," D ^PRCHDAM
"RTN","PRCHMA",156,0)
 Q
"RTN","PRCHMA",157,0)
EXIT L -^PRC(442,PRCENTRY)
"RTN","PRCHMA",158,0)
EXIT1 K ERROR,FIS,REPO,DEL
"RTN","PRCHMA",159,0)
 QUIT:$G(PRCPROST)
"RTN","PRCHMA",160,0)
 I $G(OUT)'=1 G LOOP
"RTN","PRCHMA",161,0)
 QUIT
"RTN","PRCHMA",162,0)
FLAG I $G(FLAG)=1 K FLAG Q
"RTN","PRCHMA",163,0)
 Q
"RTN","PRCHMA",164,0)
NOSIGN S $P(^PRC(443.6,PRCHPO,6,PRCHAM,0),U,4)=PRCHAU
"RTN","PRCHMA",165,0)
NOSIGN1 S DA(1)=PRCHPO,DIE="^PRC(443.6,"_DA(1)_",6,",DA=PRCHAM,DR="9///@"
"RTN","PRCHMA",166,0)
 D ^DIE K DIE,DA,DR
"RTN","PRCHMA",167,0)
 Q
"RTN","PRCHMA",168,0)
TOP ;PAUSE AT BOTTOM OF SCREEN
"RTN","PRCHMA",169,0)
 N DIR S DIR(0)="E"
"RTN","PRCHMA",170,0)
 D ^DIR
"RTN","PRCHMA",171,0)
 S LCNT=1
"RTN","PRCHMA",172,0)
 Q
"RTN","PRCHNPO5")
0^1^B37990669^B37355038
"RTN","PRCHNPO5",1,0)
PRCHNPO5 ;WISC/RSD,RHD/DL-INPUT TRANSFORM FOR FILE 440,441,442 ;9/5/00  10:59
"RTN","PRCHNPO5",2,0)
V ;;5.1;IFCAP;**113**;Oct 20, 2000;Build 4
"RTN","PRCHNPO5",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHNPO5",4,0)
 ;
"RTN","PRCHNPO5",5,0)
EN1 ;FILE 442, FCP #1
"RTN","PRCHNPO5",6,0)
 I '$D(PRCHAMND),$D(^PRCS(410,+$P(^PRC(442,DA,0),U,12),0)),+$P(^(0),"-",4)'=+X W !,"Fund Control Point cannot be changed since 2237 has been selected." K X Q
"RTN","PRCHNPO5",7,0)
 S Z0=$E($P(^PRC(442,DA,0),"-",2),1,2),Z1=+X D EN4^PRCHNPO6 I '$T K X,Z0,Z1 Q
"RTN","PRCHNPO5",8,0)
 S DIC="^PRC(420,PRC(""SITE""),1,",DIC(0)="QEMNZ"
"RTN","PRCHNPO5",9,0)
 S:$D(PRCHPUSH) DIC("S")="I $P(^(0),U,12)=2"
"RTN","PRCHNPO5",10,0)
 I $G(PRCHPC)!$G(PRCHDELV) S DIC("S")="I $D(^PRC(420,""C"",DUZ,PRC(""SITE""),+Y))"
"RTN","PRCHNPO5",11,0)
 S D="B^C" D MIX^DIC1 K:Y<0!('$D(PRC("FY"))) X K DIC,PRCHCPO,Z0,Z1 Q:'$D(X)
"RTN","PRCHNPO5",12,0)
 N CCNODE S CCNODE=$G(^PRC(420,PRC("SITE"),1,+Y,2,0)) I $P(CCNODE,U,4)'>0!(CCNODE="") W !,"The Fund Control Point selected by you, does not have any",!,"Cost Centers listed under it.",!,$P(Y,U,2) K X Q
"RTN","PRCHNPO5",13,0)
 I $P(Y(0),U,12)'=2,$P(Y(0),U,18)="" W $C(7),!,"LOG Department Number is missing!!" K X Q
"RTN","PRCHNPO5",14,0)
 S Z0=$P(^PRC(442,DA,0),U,2),Z1=$P(Y(0),U,12) I Z1 I ((Z0=3)&(Z1=3)) S Z0=$P(^PRCD(442.5,Z0,0),U,1) W $C(7),!,"Fund Control Point not valid for a "_Z0_" order." K Z0,Z1,X Q
"RTN","PRCHNPO5",15,0)
 S Z0=$P(Y(0),U,1),PRC("FY")=$E(100+$E(PRC("FY"),2,3)+$E(PRC("FY"),4),2,3) S:$P(Y(0),U,10)]"" PRCHN("SVC")=$P($G(^DIC(49,+$P(Y(0),U,10),0)),U,1)
"RTN","PRCHNPO5",16,0)
 I $D(^PRC(420,PRC("SITE"),1,+Y,2,0)),$P(^(0),U,4)=1,$D(^($P(^(0),U,3),0)),$D(^PRCD(420.1,+^(0),0)) S PRCHN("CC")=$P(^(0)," ",1)
"RTN","PRCHNPO5",17,0)
 S PRC("APP")="",X=Z0,PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),+X) I PRC("BBFY")="" Q
"RTN","PRCHNPO5",18,0)
 S PRC("APP")=$P($$ACC^PRC0C(PRC("SITE"),+X_"^"_PRC("FY")_"^"_PRC("BBFY")),U,11) K Z0,Z1
"RTN","PRCHNPO5",19,0)
 I $P($G(^PRC(420,PRC("SITE"),1,+X,0)),U,19)=1 W !,"Sorry, this FCP is inactive!",! K X Q
"RTN","PRCHNPO5",20,0)
 Q
"RTN","PRCHNPO5",21,0)
 ;
"RTN","PRCHNPO5",22,0)
EN2 ;FILE 442, COST CENTER #2
"RTN","PRCHNPO5",23,0)
 S PRCFA("ALL")=1,DIC="^PRCD(420.1,",DIC(0)="QEMZ" D ^DIC K DIC,PRCFA("ALL") I Y'>0 W !,"The Cost Center entered by you is not in the COST CENTER FILE.",! K X,Y,Z0 Q
"RTN","PRCHNPO5",24,0)
 I $P(Y(0),U,2)=1 W !,"The Cost Center entered by you has been DEACTIVATED.",! K X,Y,Z0 Q
"RTN","PRCHNPO5",25,0)
 S X=+Y(0)
"RTN","PRCHNPO5",26,0)
 S Z1=$G(^PRC(420,PRC("SITE"),1,Z0,2,+Y(0),0)) I Z1'>0!(Z1="") W !,"This Cost Center isn't found in FCP "_$P(^PRC(420,PRC("SITE"),1,Z0,0),U,1)_".",! K X,Y,Z0,Z1 Q
"RTN","PRCHNPO5",27,0)
 N BOCNOD S BOCNOD=$G(^PRCD(420.1,+Y,1,0)) I $P(BOCNOD,U,4)'>0!(BOCNOD="") W !,"The Cost Center selected by you, does not have any BOCs listed",!,"under it.",! K X
"RTN","PRCHNPO5",28,0)
 K Y,Z0,Z1 Q
"RTN","PRCHNPO5",29,0)
 ;
"RTN","PRCHNPO5",30,0)
EN3 ;FILE 442, VENDOR #5
"RTN","PRCHNPO5",31,0)
 N REP,REP1
"RTN","PRCHNPO5",32,0)
 I DIE["PRC(442,",$D(DA),$D(^PRC(442,DA,2,"AE")) K X
"RTN","PRCHNPO5",33,0)
 Q:'$D(X)!$G(PRCHPC)
"RTN","PRCHNPO5",34,0)
 I '$G(PRCHDELV) D  Q:'$G(X)
"RTN","PRCHNPO5",35,0)
 . S DIC("S")="S Z0=+$P($G(^(2)),U,2) I "_$E("'",'$D(PRCHNRQ))_"Z0,'$D(^PRC(440,""AC"",""S"",Y))" I $D(PRCHPUSH) S DIC("S")=DIC("S")_",(Z0=1!(Z0=3))"
"RTN","PRCHNPO5",36,0)
 . D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X Q:'$D(X)  S PRCHNVF=Y
"RTN","PRCHNPO5",37,0)
 Q:'$D(^PRC(440,X,2))  S Z0=^(2) I $P(^PRC(442,DA,0),U,2)=4,$P(Z0,U,11)'="Y" W $C(7),!,"This Vendor is not set up as a GUARANTEED DELIVERY Vendor!." K X,Z0 Q
"RTN","PRCHNPO5",38,0)
 ;
"RTN","PRCHNPO5",39,0)
 ; SEE IF VENDOR IS INACTIVE.
"RTN","PRCHNPO5",40,0)
 ;
"RTN","PRCHNPO5",41,0)
 I $P($G(^PRC(440,X,10)),U,5)=1 K X Q
"RTN","PRCHNPO5",42,0)
 ;
"RTN","PRCHNPO5",43,0)
 ;
"RTN","PRCHNPO5",44,0)
 ;
"RTN","PRCHNPO5",45,0)
 K PRCHEDI I $P($G(^PRC(440,X,3)),U,2)="Y" S PRCHEDI="" ;CHECK FOR EDI VENDOR
"RTN","PRCHNPO5",46,0)
 I $D(^PRCD(420.8,+$P(Z0,U,2),0)) S PRCHN("SC")=$P(^(0),U,1)
"RTN","PRCHNPO5",47,0)
 K Z0
"RTN","PRCHNPO5",48,0)
 Q
"RTN","PRCHNPO5",49,0)
 ;
"RTN","PRCHNPO5",50,0)
EN4 ;FILE 442, EST. SHIPPING AND/OR HANDLING #13
"RTN","PRCHNPO5",51,0)
 S %A="   FOB is Destination, Are you sure you want Handling Charges ",%B="",%=1 D ^PRCFYN I %'=1 K X W !?3,"<DELETED>",$C(7)
"RTN","PRCHNPO5",52,0)
 Q
"RTN","PRCHNPO5",53,0)
 ;
"RTN","PRCHNPO5",54,0)
EN5 ;FILE 442, REPETITIVE (PR CARD) NO. #1.5
"RTN","PRCHNPO5",55,0)
 I $P(^PRC(442,DA(1),0),U,3)=""!($P(^(1),U,1)="") W !!,"Fund Control Point and Vendor must be entered before items !",$C(7) K X Q
"RTN","PRCHNPO5",56,0)
 S:'$D(PRC("SITE")) PRC("SITE")=+^PRC(442,DA(1),0) D LCK^PRCHCRD
"RTN","PRCHNPO5",57,0)
 Q
"RTN","PRCHNPO5",58,0)
 ;
"RTN","PRCHNPO5",59,0)
EN6 ;FILE 442, UNIT OF PURCHASE #3
"RTN","PRCHNPO5",60,0)
 D VEN Q:'$D(X)!($P(^PRC(442,DA(1),2,DA,0),U,5)="")
"RTN","PRCHNPO5",61,0)
 S:'$D(PRC("SITE")) PRC("SITE")=$P($P(^PRC(442,DA(1),0),U,1),"-",1) S PRCHCV=$P(^PRC(442,DA(1),1),U,1),PRCHCI=$P(^(2,DA,0),U,5),PRCHCPO=DA(1) D EN0^PRCHCRD
"RTN","PRCHNPO5",62,0)
 Q
"RTN","PRCHNPO5",63,0)
 ;
"RTN","PRCHNPO5",64,0)
EN8 ;FILE 442, CONTRACT FIELD #4
"RTN","PRCHNPO5",65,0)
 D VEN Q:'$D(X)  K DIC("S")
"RTN","PRCHNPO5",66,0)
 S Z0=$P(^PRC(442,DA(1),1),U,1),ZA=DA,ZA(1)=DA(1)
"RTN","PRCHNPO5",67,0)
 S DA(1)=Z0,DIC="^PRC(440,Z0,4,",DIC(0)="QELMZ",DLAYGO=440
"RTN","PRCHNPO5",68,0)
 I $G(PRCHPC)!$G(PRCHDELV) S DIC(0)="QEMZ"
"RTN","PRCHNPO5",69,0)
 D EN10,^DIC S X=$P(Y,U,2),DA=ZA,DA(1)=ZA(1) K ZA K:Y'>0 X
"RTN","PRCHNPO5",70,0)
 I $D(X),$D(DT),$P(Y(0),U,2)-DT<0 W !?10,"**CONTRACT HAS EXPIRED**",$C(7),$C(7) K X,DLAYGO Q
"RTN","PRCHNPO5",71,0)
 S:'$D(PRC("SITE")) PRC("SITE")=$P($P(^PRC(442,DA(1),0),U,1),"-",1) I $P(^PRC(442,DA(1),2,DA,0),U,5)]"" S PRCHCI=$P(^(0),U,5),PRCHCV=Z0,PRCHCPO=DA(1) D EN2^PRCHCRD
"RTN","PRCHNPO5",72,0)
 K DLAYGO
"RTN","PRCHNPO5",73,0)
 Q
"RTN","PRCHNPO5",74,0)
 ;
"RTN","PRCHNPO5",75,0)
EN9 ;FILE 442, ACTUAL UNIT COST #5
"RTN","PRCHNPO5",76,0)
 D VEN Q:'$D(X)!($P(^PRC(442,DA(1),2,DA,0),U,5)="")
"RTN","PRCHNPO5",77,0)
 S:'$D(PRC("SITE")) PRC("SITE")=$P($P(^PRC(442,DA(1),0),U,1),"-",1) S PRCHCV=$P(^PRC(442,DA(1),1),U,1),PRCHCI=$P(^(2,DA,0),U,5),PRCHCPO=DA(1) D EN1^PRCHCRD
"RTN","PRCHNPO5",78,0)
 Q
"RTN","PRCHNPO5",79,0)
 ;
"RTN","PRCHNPO5",80,0)
EN10 ;FILE 440 CONTRACT NUMBER
"RTN","PRCHNPO5",81,0)
 I $D(Z0) S:'$D(^PRC(440,Z0,4,0)) ^PRC(440,Z0,4,0)="^440.03I^^"
"RTN","PRCHNPO5",82,0)
 Q
"RTN","PRCHNPO5",83,0)
 ;
"RTN","PRCHNPO5",84,0)
EN11 ;FILE 441 CONTRACT
"RTN","PRCHNPO5",85,0)
 D EN10 S DIC="^PRC(440,Z0,4,",DIC(0)="QEMLZ",DLAYGO=440,ZD=DA(1),DA(1)=Z0 D ^DIC S X=+Y K:Y'>0 X S DA(1)=ZD K ZD,Z0,DIC
"RTN","PRCHNPO5",86,0)
 I $D(X),$D(DT),$P(Y(0),U,2)-DT<0 W !?10,"**CONTRACT HAS EXPIRED**",$C(7),$C(7) K X
"RTN","PRCHNPO5",87,0)
 K DLAYGO
"RTN","PRCHNPO5",88,0)
 Q
"RTN","PRCHNPO5",89,0)
 ;
"RTN","PRCHNPO5",90,0)
EN12 ;FILE 442, VENDOR STOCK NO.#9
"RTN","PRCHNPO5",91,0)
 D VEN Q:'$D(X)!($P(^PRC(442,DA(1),2,DA,0),U,5)="")
"RTN","PRCHNPO5",92,0)
 S:'$D(PRC("SITE")) PRC("SITE")=+^PRC(442,DA(1),0) S PRCHCV=+$P(^PRC(442,DA(1),1),U,1),PRCHCI=+$P(^(2,DA,0),U,5),PRCHCPO=DA(1) D EN6^PRCHCRD
"RTN","PRCHNPO5",93,0)
 Q
"RTN","PRCHNPO5",94,0)
 ;
"RTN","PRCHNPO5",95,0)
EN13 ;DIC("S") for a look-up in CONTRACT field (File 442.01,4)
"RTN","PRCHNPO5",96,0)
 S PRCHSCOD=$P($G(^PRC(442,D0,1)),U,7)
"RTN","PRCHNPO5",97,0)
 I $E(X)="?" S DIC("S")=$S(PRCHSCOD=2:"I $P(^PRC(440,Z0,4,+Y,0),U,6)'=""B""",1:"I 1")
"RTN","PRCHNPO5",98,0)
 Q
"RTN","PRCHNPO5",99,0)
 ;
"RTN","PRCHNPO5",100,0)
EN14 ;input transform of Contract Flag field 5, file 440
"RTN","PRCHNPO5",101,0)
 ;If PO exists, if source code=2 & contract flag is not 'C' set it 'C'
"RTN","PRCHNPO5",102,0)
 I $G(PRCHPO)>0 D
"RTN","PRCHNPO5",103,0)
 . S PRCHNOD1=$G(^PRC(442,PRCHPO,1))
"RTN","PRCHNPO5",104,0)
 . S PRCHSOCO=$P(PRCHNOD1,U,7)
"RTN","PRCHNPO5",105,0)
 . I PRCHSOCO=2 Q:X="C"  D  Q
"RTN","PRCHNPO5",106,0)
 . . S X="C"
"RTN","PRCHNPO5",107,0)
 . . S ARR(1)=""
"RTN","PRCHNPO5",108,0)
 . . S ARR(2)="     Note: "
"RTN","PRCHNPO5",109,0)
 . . S ARR(3)="     This PO's Source Code is Open Market, only Contract # is a valid entry."
"RTN","PRCHNPO5",110,0)
 . . S ARR(4)="     'C' has been entered for the Contract Flag prompt."
"RTN","PRCHNPO5",111,0)
 . . S ARR(5)="     'B' is not allowed, system allows only 'C'."
"RTN","PRCHNPO5",112,0)
 . . S ARR(6)=""
"RTN","PRCHNPO5",113,0)
 . . D EN^DDIOL(.ARR)
"RTN","PRCHNPO5",114,0)
 . . S XQH="PRCH CONTRACT FLAG HELP" D:$E(X)="??" EN^XQH
"RTN","PRCHNPO5",115,0)
 . . Q
"RTN","PRCHNPO5",116,0)
 . Q 
"RTN","PRCHNPO5",117,0)
 ; If Source code is not equal to 2, C or B is ok for contr. flag 
"RTN","PRCHNPO5",118,0)
 S MSG(1)=""
"RTN","PRCHNPO5",119,0)
 S MSG(2)="Enter 'C' if the Contract Number field is a Contract #."
"RTN","PRCHNPO5",120,0)
 S MSG(2,"F")="!,?5"
"RTN","PRCHNPO5",121,0)
 S MSG(3)="Otherwise enter 'B' if it is a Basic Ordering Agreement(BOA) #."
"RTN","PRCHNPO5",122,0)
 S MSG(3,"F")="!,?5"
"RTN","PRCHNPO5",123,0)
 S MSG(4)=""
"RTN","PRCHNPO5",124,0)
 ;I PRCHSOCO'=2 D EN^DDIOL(.MSG) H 2
"RTN","PRCHNPO5",125,0)
 ;any other route than via po
"RTN","PRCHNPO5",126,0)
 I X="B" D
"RTN","PRCHNPO5",127,0)
 . S Z=$P(^PRC(440,DA(1),4,DA,0),U)
"RTN","PRCHNPO5",128,0)
 . K:'(Z?.UN) X
"RTN","PRCHNPO5",129,0)
 . I '$D(X) S XQH="PRCH BOA" D EN^XQH
"RTN","PRCHNPO5",130,0)
 . K Z,XQH
"RTN","PRCHNPO5",131,0)
 . Q
"RTN","PRCHNPO5",132,0)
 Q
"RTN","PRCHNPO5",133,0)
 ;
"RTN","PRCHNPO5",134,0)
VEN I $S('$D(^PRC(442,DA(1),1)):1,$P(^(1),U,1)="":1,1:0) W !!,"Vendor must be entered before items ! ",$C(7) K X
"RTN","PRCHNPO5",135,0)
 Q
"RTN","PRCHNPO8")
0^2^B8355080^B7939245
"RTN","PRCHNPO8",1,0)
PRCHNPO8 ;WISC/RHD/DL-MISCELLANEOUS ROUTINES FROM P.O.ADD/EDIT 443.6 ;9/5/00  12:30
"RTN","PRCHNPO8",2,0)
V ;;5.1;IFCAP;**113**;Oct 20, 2000;Build 4
"RTN","PRCHNPO8",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHNPO8",4,0)
 ;
"RTN","PRCHNPO8",5,0)
EN1 ;FILE 443.6, FCP #1
"RTN","PRCHNPO8",6,0)
 N Y
"RTN","PRCHNPO8",7,0)
 S Z0=$E($P(^PRC(443.6,DA,0),"-",2),1,2),Z1=+X D EN4^PRCHNPO6 I '$T K X,Z0,Z1 Q
"RTN","PRCHNPO8",8,0)
 S DIC="^PRC(420,PRC(""SITE""),1,",DIC(0)="QEMNZ",D="B^C" D MIX^DIC1 K:Y<0!('$D(PRC("FY"))) X K DIC,Z0,Z1 Q:'$D(X)
"RTN","PRCHNPO8",9,0)
 N CCNODE S CCNODE=$G(^PRC(420,PRC("SITE"),1,+Y,2,0)) I $P(CCNODE,U,4)'>0!(CCNODE="") W !,"The Fund Control Point selected by you, does not have any",!,"Cost Centers listed under it.",! K X Q
"RTN","PRCHNPO8",10,0)
 I $P(Y(0),U,12)'=2,$P(Y(0),U,18)="" W $C(7),!,"LOG Department Number is missing!!" K X Q
"RTN","PRCHNPO8",11,0)
 S Z0=$P(^PRC(443.6,DA,0),U,2),Z1=$P(Y(0),U,12) I Z1 I Z0=4!((Z0=3)&(Z1=3)) S Z0=$P(^PRCD(442.5,Z0,0),U,1) W $C(7),!,"Fund Control Point not valid for a "_Z0_" order." K Z0,Z1,X Q
"RTN","PRCHNPO8",12,0)
 S Z0=$P(Y(0),U,1) S:$P(Y(0),U,10)]"" PRCHN("SVC")=$P($G(^DIC(49,+$P(Y(0),U,10),0)),U,1)
"RTN","PRCHNPO8",13,0)
 S PRC("FY")=$E(100+$E(PRC("FY"),2,3)+$E(PRC("FY"),4),2,3)
"RTN","PRCHNPO8",14,0)
 I $D(^PRC(420,PRC("SITE"),1,+Y,2,0)),$P(^(0),U,4)=1,$D(^($P(^(0),U,3),0)),$D(^PRCD(420.1,+^(0),0)) S PRCHN("CC")=$P(^(0)," ",1)
"RTN","PRCHNPO8",15,0)
 S PRC("APP")="",X=Z0,PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),+X) I PRC("BBFY")="" Q
"RTN","PRCHNPO8",16,0)
 S PRC("APP")=$P($$ACC^PRC0C(PRC("SITE"),+X_"^"_PRC("FY")_"^"_PRC("BBFY")),U,11) K Z0,Z1
"RTN","PRCHNPO8",17,0)
 I $P($G(^PRC(420,PRC("SITE"),1,+X,0)),U,19)=1 W !,"Sorry, this FCP is inactive!",! K X Q
"RTN","PRCHNPO8",18,0)
 Q
"RTN","PRCHNPO8",19,0)
 ;
"RTN","PRCHNPO8",20,0)
EN2 ;UPDATE BOC #3.5
"RTN","PRCHNPO8",21,0)
 D VEN^PRCHNPO7 Q:'$D(X)!($P(^PRC(442,DA(1),2,DA,0),U,5)="")
"RTN","PRCHNPO8",22,0)
 S:'$D(PRC("SITE")) PRC("SITE")=$P($P(^PRC(442,DA(1),0),U,1),"-",1)
"RTN","PRCHNPO8",23,0)
 S PRCHCV=$P(^PRC(442,DA(1),1),U),PRCHCI=$P(^(2,DA,0),U,5)
"RTN","PRCHNPO8",24,0)
 D EN13^PRCHCRD1
"RTN","PRCHNPO8",25,0)
 Q
"RTN","PRCHNPO8",26,0)
 ;
"RTN","PRCHNPO8",27,0)
BBFY(PO) ;BEGINING BUDGET FISCAL YEAR CHECK/UPDATE
"RTN","PRCHNPO8",28,0)
 ;  ENTERED:
"RTN","PRCHNPO8",29,0)
 ;  PO = FILE 442 INTERNAL RECORD NUMBER
"RTN","PRCHNPO8",30,0)
 ;
"RTN","PRCHNPO8",31,0)
 ;  RETURNED:
"RTN","PRCHNPO8",32,0)
 ;  PRC("BBFY") = FOUR DIGIT YEAR (1995)
"RTN","PRCHNPO8",33,0)
 ;
"RTN","PRCHNPO8",34,0)
 ;  PO IS UNCHANGED BY THIS CALL
"RTN","PRCHNPO8",35,0)
 ;
"RTN","PRCHNPO8",36,0)
 N BBFY,N0,N1,FY,P2237,SFCP,DIE,DA,DR,X,FLAG
"RTN","PRCHNPO8",37,0)
 S N0=$G(^PRC(442,PO,0)),N1=$G(^PRC(442,PO,1))
"RTN","PRCHNPO8",38,0)
 S FY=$P(N1,U,15),FY=$E(100+$E(FY,2,3)+$E(FY,4),2,3)
"RTN","PRCHNPO8",39,0)
 S FLAG="",P2237=$P(N0,U,12) I P2237>0 D  G:FLAG=1 T1
"RTN","PRCHNPO8",40,0)
 .S FY=$$NP^PRC0B("^PRCS(410,"_P2237_",",3,11)
"RTN","PRCHNPO8",41,0)
 .I FY?2N S FY=1700+$E(FY,1,3),PRC("BBFY")=FY,FLAG=1 Q
"RTN","PRCHNPO8",42,0)
 .S FY=$$NP^PRC0B("^PRCS(410,"_P2237_",",0,1)
"RTN","PRCHNPO8",43,0)
 .S FY=$P(FY,"-",2)
"RTN","PRCHNPO8",44,0)
 .Q
"RTN","PRCHNPO8",45,0)
 S FY=$$BBFY^PRCSUT(+N0,FY,+$P(N0,U,3),1)
"RTN","PRCHNPO8",46,0)
T1 S SFCP=$P(N0,U,19) I SFCP=1!(SFCP=2) S (PRC("BBFY"),FY)=1994
"RTN","PRCHNPO8",47,0)
 I FY?2N S DIE="^PRC(442,",DA=PO,DR="26///^S X=FY" D ^DIE
"RTN","PRCHNPO8",48,0)
 Q
"RTN","PRCHPCAR")
0^6^B19373875^B16407409
"RTN","PRCHPCAR",1,0)
PRCHPCAR ;WISC/AKS-Front End questions for Purchase Card processes ;6/9/96  21:40
"RTN","PRCHPCAR",2,0)
 ;;5.1;IFCAP;**113**;Oct 20, 2000;Build 4
"RTN","PRCHPCAR",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHPCAR",4,0)
ASKPO ;Ask If they are processing a purchase or a requisition
"RTN","PRCHPCAR",5,0)
 N DIR,Y,PRCHPR,PRCHNE
"RTN","PRCHPCAR",6,0)
 S DIR(0)="SO^P:PURCHASE ORDER;R:REQUISITION"
"RTN","PRCHPCAR",7,0)
 S DIR("A")="Select THE TYPE OF ORDER"
"RTN","PRCHPCAR",8,0)
 D ^DIR Q:Y']""!(Y["^")  S PRCHPR=Y
"RTN","PRCHPCAR",9,0)
ENTED ;Ask if they are entering or editting
"RTN","PRCHPCAR",10,0)
 S DIR(0)="SO^N:NEW;E:EDIT AN EXISTING ORDER"
"RTN","PRCHPCAR",11,0)
 S DIR("A")="Select TYPE OF PROCESSING"
"RTN","PRCHPCAR",12,0)
 D ^DIR G:Y']"" ASKPO Q:Y["^"  S PRCHNE=Y
"RTN","PRCHPCAR",13,0)
 I $G(PRCHPR)="P"&(PRCHNE="N") D EN5^PRCHE Q
"RTN","PRCHPCAR",14,0)
 I $G(PRCHPR)="P"&(PRCHNE="E") D EN6^PRCHE Q
"RTN","PRCHPCAR",15,0)
 I $G(PRCHPR)="R"&(PRCHNE="N") D EN3^PRCHEA Q
"RTN","PRCHPCAR",16,0)
 I $G(PRCHPR)="R"&(PRCHNE="E") D EN4^PRCHEA Q
"RTN","PRCHPCAR",17,0)
 I '$D(PRCHPR)&(PRCHNE="N") D EN5^PRCHE Q
"RTN","PRCHPCAR",18,0)
 I '$D(PRCHPR)&(PRCHNE="E") D EN6^PRCHE Q
"RTN","PRCHPCAR",19,0)
 QUIT
"RTN","PRCHPCAR",20,0)
AMPO ;ask if they are amending a po or a requisition
"RTN","PRCHPCAR",21,0)
 N DIR,Y
"RTN","PRCHPCAR",22,0)
 S DIR(0)="SO^P:AMEND A PURCHASE ORDER;R:AMEND A REQUISITION"
"RTN","PRCHPCAR",23,0)
 S DIR("A")="Select THE TYPE OF ORDER"
"RTN","PRCHPCAR",24,0)
 D ^DIR
"RTN","PRCHPCAR",25,0)
 I Y="P" D PO^PRCHMA Q
"RTN","PRCHPCAR",26,0)
 I Y="R" D REQ^PRCHMA Q
"RTN","PRCHPCAR",27,0)
 QUIT
"RTN","PRCHPCAR",28,0)
ADJPO ;ask if they are adjusting a po or requisition
"RTN","PRCHPCAR",29,0)
 N DIR,Y
"RTN","PRCHPCAR",30,0)
 S DIR(0)="SO^P:Adjustment Voucher to a PO;R:Adjustment Voucher to a Requisition"
"RTN","PRCHPCAR",31,0)
 S DIR("A")="Select THE TYPE OF ORDER"
"RTN","PRCHPCAR",32,0)
 D ^DIR
"RTN","PRCHPCAR",33,0)
 I Y="P" D EN14^PRCHE Q
"RTN","PRCHPCAR",34,0)
 I Y="R" D EN2^PRCHEB Q
"RTN","PRCHPCAR",35,0)
 QUIT
"RTN","PRCHPCAR",36,0)
DIRPO ;Ask type of amendments for purchase card and delivery orders
"RTN","PRCHPCAR",37,0)
 ;
"RTN","PRCHPCAR",38,0)
 N PRCHTYPE,DIR
"RTN","PRCHPCAR",39,0)
 S PRCHTYPE=$P($G(^PRC(442,PRCHPO,23)),U,11)
"RTN","PRCHPCAR",40,0)
 Q:PRCHTYPE=""
"RTN","PRCHPCAR",41,0)
 S:PRCHTYPE="S" DIR(0)="SO^1:F.C.P. Edit;2:Change VENDOR;3:AUTHORITY Edit;4:LINE ITEM Edit"
"RTN","PRCHPCAR",42,0)
 S:PRCHTYPE="P" DIR(0)="SO^1:F.C.P. Edit;2:Change VENDOR;3:AUTHORITY Edit;4:LINE ITEM Add;5:LINE ITEM Delete;6:LINE ITEM Edit;7:F.O.B. Point"
"RTN","PRCHPCAR",43,0)
 S:PRCHTYPE="D" DIR(0)="SO^1:Change VENDOR;2:AUTHORITY Edit;3:LINE ITEM Add;4:LINE ITEM Delete;5:LINE ITEM Edit;6:F.O.B. Point;7:SHIP TO Edit;8:Edit MAIL INVOICE TO;9:EST. SHIPPING Edit;10:PROMPT PAYMENT Edit"
"RTN","PRCHPCAR",44,0)
 S DIR("A")="Select TYPE OF AMENDMENT NUMBER"
"RTN","PRCHPCAR",45,0)
 D ^DIR
"RTN","PRCHPCAR",46,0)
 I PRCHTYPE="S" S:$G(Y)=4 Y=6
"RTN","PRCHPCAR",47,0)
 I PRCHTYPE="D",$G(Y) S Y=Y+1
"RTN","PRCHPCAR",48,0)
 S Y=$S(Y=1:30,Y=2:31,Y=3:34,Y=4:21,Y=5:22,Y=6:23,Y=7:35,Y=8:20,Y=9:25,Y=10:29,Y=11:33,1:-1)
"RTN","PRCHPCAR",49,0)
 QUIT
"RTN","PRCHPCAR",50,0)
DIRREQ ;Ask type of amendments for purchase card and delivery orders
"RTN","PRCHPCAR",51,0)
 ;
"RTN","PRCHPCAR",52,0)
 N PRCHTYPE,DIR
"RTN","PRCHPCAR",53,0)
 S PRCHTYPE=$P($G(^PRC(442,PRCHPO,23)),U,11)
"RTN","PRCHPCAR",54,0)
 Q:PRCHTYPE=""
"RTN","PRCHPCAR",55,0)
 S:PRCHTYPE="S" DIR(0)="SO^1:F.C.P. Edit;2:Change FEDERAL VENDOR"
"RTN","PRCHPCAR",56,0)
 S:PRCHTYPE="P" DIR(0)="SO^1:F.C.P. Edit;2:Change FEDERAL VENDOR;3:LINE ITEM Add;4:LINE ITEM Delete;5:LINE ITEM Edit"
"RTN","PRCHPCAR",57,0)
 S:PRCHTYPE="D" DIR(0)="SO^1:Change FEDERAL VENDOR;2:LINE ITEM Add;3:LINE ITEM Delete;4:LINE ITEM Edit;5:SHIP TO Edit;6:Edit MAIL INVOICE TO;7:EST. SHIPPING Edit"
"RTN","PRCHPCAR",58,0)
 S DIR("A")="Select TYPE OF AMENDMENT NUMBER"
"RTN","PRCHPCAR",59,0)
 D ^DIR
"RTN","PRCHPCAR",60,0)
 I PRCHTYPE="D",$G(Y) S Y=Y+1
"RTN","PRCHPCAR",61,0)
 S Y=$S(Y=1:30,Y=2:31,Y=3:21,Y=4:22,Y=5:23,Y=6:20,Y=7:25,Y=8:29,1:-1)
"RTN","PRCHPCAR",62,0)
 QUIT
"RTN","PRCHPCAR",63,0)
CANPC ;Cancel a purchase card order
"RTN","PRCHPCAR",64,0)
 W ! S DIC="^PRC(442,",DIC(0)="AEQM"
"RTN","PRCHPCAR",65,0)
 S DIC("A")="Select PURCHASE CARD ORDER NUMBER: "
"RTN","PRCHPCAR",66,0)
 S DIC("S")="I $P($G(^(7)),U,2)<9,$P($G(^(1)),U,10)=DUZ,$P($G(^(0)),U,2)=25,($P($G(^(23)),U,11)=""P""!($P($G(^(23)),U,11)=""S""))"
"RTN","PRCHPCAR",67,0)
 D ^DIC Q:+Y<0  K DIC
"RTN","PRCHPCAR",68,0)
 S %A="Are sure you want to cancel this order",%B="",%=2
"RTN","PRCHPCAR",69,0)
 D ^PRCFYN I %<1!(%=2) K %A,%B,% Q
"RTN","PRCHPCAR",70,0)
 S DA=+Y,DIE="^PRC(442,",DR=".5///^S X=45" D ^DIE K DIE,DR
"RTN","PRCHPCAR",71,0)
 D C2237^PRCH442A
"RTN","PRCHPCAR",72,0)
 K DA,%A,%B,%
"RTN","PRCHPCAR",73,0)
 QUIT
"RTN","PRCHPCAR",74,0)
CANDO ;Cancel a delivery order
"RTN","PRCHPCAR",75,0)
 W ! S DIC="^PRC(442,",DIC(0)="AEQM"
"RTN","PRCHPCAR",76,0)
 S DIC("A")="Select DELIVERY ORDER NUMBER: "
"RTN","PRCHPCAR",77,0)
 S DIC("S")="I $P($G(^(7)),U,2)<9,$P($G(^(23)),U,11)=""D"""
"RTN","PRCHPCAR",78,0)
 D ^DIC Q:+Y<0  K DIC
"RTN","PRCHPCAR",79,0)
 S %A="Are sure you want to cancel this order",%B="",%=2
"RTN","PRCHPCAR",80,0)
 D ^PRCFYN I %<1!(%=2) K %A,%B,% Q
"RTN","PRCHPCAR",81,0)
 S DA=+Y,DIE="^PRC(442,",DR=".5///^S X=45" D ^DIE K DIE,DR
"RTN","PRCHPCAR",82,0)
 D C2237^PRCH442A
"RTN","PRCHPCAR",83,0)
 K DA,%A,%B,%
"RTN","PRCHPCAR",84,0)
 QUIT
"RTN","PRCHPCAR",85,0)
AOCANPC ;Approving Official Cancel a purchase card order
"RTN","PRCHPCAR",86,0)
 N DIC,Y,NREC,X
"RTN","PRCHPCAR",87,0)
 W ! S DIC="^PRC(442,",DIC(0)="AEQM"
"RTN","PRCHPCAR",88,0)
 S DIC("A")="Select PURCHASE CARD ORDER NUMBER: "
"RTN","PRCHPCAR",89,0)
 S DIC("S")="I $P($G(^(7)),U,2)<9,$P($G(^(0)),U,2)=25,($P($G(^(23)),U,11)=""P""!($P($G(^(23)),U,11)=""S""))"
"RTN","PRCHPCAR",90,0)
 D ^DIC Q:+Y<0  K DIC
"RTN","PRCHPCAR",91,0)
 S %A="Are sure you want to cancel this order",%B="",%=2
"RTN","PRCHPCAR",92,0)
 D ^PRCFYN I %<1!(%=2) K %A,%B,% Q
"RTN","PRCHPCAR",93,0)
 S DA=+Y,DIE="^PRC(442,",DR=".5///^S X=45" D ^DIE K DIE,DR
"RTN","PRCHPCAR",94,0)
 D C2237^PRCH442A
"RTN","PRCHPCAR",95,0)
 K DA,%A,%B,%
"RTN","PRCHPCAR",96,0)
 QUIT
"RTN","PRCIREC")
0^4^B1330183^n/a
"RTN","PRCIREC",1,0)
PRCIREC ;WISC/SWS-PRCIREC continued ;9/7/06  14:22
"RTN","PRCIREC",2,0)
V ;;5.1;IFCAP;**113**;Oct 20, 2000;Build 4
"RTN","PRCIREC",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCIREC",4,0)
 ;This routine serves as the input transform for the field Final Charge in File ^PRCH(440.6
"RTN","PRCIREC",5,0)
 Q
"RTN","PRCIREC",6,0)
START S MYIEN=$P($G(^PRCH(440.6,DA,1)),U,1)
"RTN","PRCIREC",7,0)
 I '$G(MYIEN) Q
"RTN","PRCIREC",8,0)
 S VALUE2=$P($P($G(^PRC(442,MYIEN,0)),U,1),"-",2),VALUE3=0,BFLAG=0
"RTN","PRCIREC",9,0)
 F  S VALUE3=$O(^PRCH(440.6,"C",VALUE2,VALUE3)) Q:'VALUE3!(BFLAG=1)  D
"RTN","PRCIREC",10,0)
 .I VALUE3'=DA D
"RTN","PRCIREC",11,0)
 ..I $P($G(^PRCH(440.6,VALUE3,1)),U,4)="Y" D
"RTN","PRCIREC",12,0)
 ...S BFLAG=1
"RTN","PRCIREC",13,0)
 ...K MSG
"RTN","PRCIREC",14,0)
 ...S MSG(1)="Sorry, there is already a final charge for this PC Order."
"RTN","PRCIREC",15,0)
 ...S MSG(2)="You need to remove the first final charge to continue."
"RTN","PRCIREC",16,0)
 ...S MSG(2,"F")="!"
"RTN","PRCIREC",17,0)
 ...S MSG(3)=""
"RTN","PRCIREC",18,0)
 ...S MSG(3,"F")="!"
"RTN","PRCIREC",19,0)
 ...D EN^DDIOL(.MSG)
"RTN","PRCIREC",20,0)
 ...K MSG,X
"RTN","PRCIREC",21,0)
 ...S BFLAG=1
"RTN","PRCIREC",22,0)
 K BFLAG
"RTN","PRCIREC",23,0)
 Q
"RTN","PRCOT07")
0^5^B1178396^n/a
"RTN","PRCOT07",1,0)
PRCOT07 ;SF/SWS-PREINSTALL *ADD NEW OPTION ;4-26-94/3:45 PM
"RTN","PRCOT07",2,0)
V ;;5.1;IFCAP;**113**;Oct 20, 2000;Build 4
"RTN","PRCOT07",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCOT07",4,0)
 Q
"RTN","PRCOT07",5,0)
FINDREC N DIC,Y,NREC,MREC,DIE,X
"RTN","PRCOT07",6,0)
 D BMES^XPDUTL("Adding new option to APPROVING OFFICIAL MENU.")
"RTN","PRCOT07",7,0)
 S DIC="^DIC(19,",X="PRCH AO CANCEL INCOM PC ORDER"
"RTN","PRCOT07",8,0)
 D ^DIC
"RTN","PRCOT07",9,0)
 I Y'=-1  S NREC=+Y
"RTN","PRCOT07",10,0)
FINDMNU S (DIC,Y)=""
"RTN","PRCOT07",11,0)
 S DIC="^DIC(19,",X="PRCH APPROVE"
"RTN","PRCOT07",12,0)
 D ^DIC
"RTN","PRCOT07",13,0)
 I Y'=-1  S MREC=+Y
"RTN","PRCOT07",14,0)
UPDMNU S (DIC,Y)=""
"RTN","PRCOT07",15,0)
 S (BFLAG,NTHIS)=0
"RTN","PRCOT07",16,0)
 F  S NTHIS=$O(^DIC(19,MREC,10,NTHIS))  Q:'NTHIS!(BFLAG=1)  D
"RTN","PRCOT07",17,0)
 . S MYIEN=$G(^DIC(19,MREC,10,NTHIS,0))
"RTN","PRCOT07",18,0)
 . I MYIEN=NREC  S BFLAG=1
"RTN","PRCOT07",19,0)
 I BFLAG=0  D
"RTN","PRCOT07",20,0)
 . S DIC="^DIC(19,"_MREC_",10,",DIC(0)="",DIC("P")="19.01IP"
"RTN","PRCOT07",21,0)
 . S X=NREC
"RTN","PRCOT07",22,0)
 . S DA(1)=MREC
"RTN","PRCOT07",23,0)
 . D FILE^DICN
"RTN","PRCOT07",24,0)
CLNREC K BFLAG,NTHIS,MREC,NREC
"RTN","PRCOT07",25,0)
 Q
"VER")
8.0^22.0
"^DD",440.6,440.6,44,0)
FINAL CHARGE^RSX^Y:YES;N:NO;^1;4^I X="Y" D START^PRCIREC
"^DD",440.6,440.6,44,21,0)
^.001^1^1^3060201^^^^
"^DD",440.6,440.6,44,21,1,0)
This is the FINAL CHARGE data field.
"^DD",440.6,440.6,44,"DT")
3070502
"BLD",5340,6)
^97
**END**
**END**
