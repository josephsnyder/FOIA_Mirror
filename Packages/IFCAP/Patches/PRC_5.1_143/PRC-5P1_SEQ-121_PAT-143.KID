Released PRC*5.1*143 SEQ #121
Extracted from mail message
**KIDS**:PRC*5.1*143^

**INSTALL NAME**
PRC*5.1*143
"BLD",6069,0)
PRC*5.1*143^IFCAP^0^3100323^y
"BLD",6069,1,0)
^^13^13^3100323^
"BLD",6069,1,1,0)
This patch will address the following 3 issues:
"BLD",6069,1,2,0)
 
"BLD",6069,1,3,0)
1. When site transfers funds from one Control Point to another they 
"BLD",6069,1,4,0)
   receive the message "'No Records To Print' when trying to review 
"BLD",6069,1,5,0)
   the entry.
"BLD",6069,1,6,0)
 
"BLD",6069,1,7,0)
2. When user edits an incomplete detailed Purchase Card Order, the 
"BLD",6069,1,8,0)
   existing Cost Center value may not be displayed.
"BLD",6069,1,9,0)
 
"BLD",6069,1,10,0)
3. SHIP TO ADDRESS inconsistent between information entered during
"BLD",6069,1,11,0)
   Prosthetics GUI order entry and reprinting order in IFCAP using 
"BLD",6069,1,12,0)
   options REPRINT PURCHASE CARD ORDER or DISPLAY PURCHASE 
"BLD",6069,1,13,0)
   ORDER/REQUISITION.
"BLD",6069,4,0)
^9.64PA^^
"BLD",6069,6.3)
3
"BLD",6069,"ABPKG")
n
"BLD",6069,"KRN",0)
^9.67PA^779.2^20
"BLD",6069,"KRN",.4,0)
.4
"BLD",6069,"KRN",.401,0)
.401
"BLD",6069,"KRN",.402,0)
.402
"BLD",6069,"KRN",.403,0)
.403
"BLD",6069,"KRN",.5,0)
.5
"BLD",6069,"KRN",.84,0)
.84
"BLD",6069,"KRN",3.6,0)
3.6
"BLD",6069,"KRN",3.8,0)
3.8
"BLD",6069,"KRN",9.2,0)
9.2
"BLD",6069,"KRN",9.8,0)
9.8
"BLD",6069,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6069,"KRN",9.8,"NM",1,0)
PRCBSTF^^0^B20812904
"BLD",6069,"KRN",9.8,"NM",2,0)
PRCHNPO3^^0^B39512916
"BLD",6069,"KRN",9.8,"NM",3,0)
PRCHDP1^^0^B28389827
"BLD",6069,"KRN",9.8,"NM",4,0)
PRCHFPT1^^0^B29746380
"BLD",6069,"KRN",9.8,"NM","B","PRCBSTF",1)

"BLD",6069,"KRN",9.8,"NM","B","PRCHDP1",3)

"BLD",6069,"KRN",9.8,"NM","B","PRCHFPT1",4)

"BLD",6069,"KRN",9.8,"NM","B","PRCHNPO3",2)

"BLD",6069,"KRN",19,0)
19
"BLD",6069,"KRN",19.1,0)
19.1
"BLD",6069,"KRN",101,0)
101
"BLD",6069,"KRN",409.61,0)
409.61
"BLD",6069,"KRN",771,0)
771
"BLD",6069,"KRN",779.2,0)
779.2
"BLD",6069,"KRN",870,0)
870
"BLD",6069,"KRN",8989.51,0)
8989.51
"BLD",6069,"KRN",8989.52,0)
8989.52
"BLD",6069,"KRN",8994,0)
8994
"BLD",6069,"KRN","B",.4,.4)

"BLD",6069,"KRN","B",.401,.401)

"BLD",6069,"KRN","B",.402,.402)

"BLD",6069,"KRN","B",.403,.403)

"BLD",6069,"KRN","B",.5,.5)

"BLD",6069,"KRN","B",.84,.84)

"BLD",6069,"KRN","B",3.6,3.6)

"BLD",6069,"KRN","B",3.8,3.8)

"BLD",6069,"KRN","B",9.2,9.2)

"BLD",6069,"KRN","B",9.8,9.8)

"BLD",6069,"KRN","B",19,19)

"BLD",6069,"KRN","B",19.1,19.1)

"BLD",6069,"KRN","B",101,101)

"BLD",6069,"KRN","B",409.61,409.61)

"BLD",6069,"KRN","B",771,771)

"BLD",6069,"KRN","B",779.2,779.2)

"BLD",6069,"KRN","B",870,870)

"BLD",6069,"KRN","B",8989.51,8989.51)

"BLD",6069,"KRN","B",8989.52,8989.52)

"BLD",6069,"KRN","B",8994,8994)

"BLD",6069,"QUES",0)
^9.62^^
"BLD",6069,"REQB",0)
^9.611^1^1
"BLD",6069,"REQB",1,0)
PRC*5.1*115^2
"BLD",6069,"REQB","B","PRC*5.1*115",1)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
143^3100323
"PKG",455,22,1,"PAH",1,1,0)
^^13^13^3100323
"PKG",455,22,1,"PAH",1,1,1,0)
This patch will address the following 3 issues:
"PKG",455,22,1,"PAH",1,1,2,0)
 
"PKG",455,22,1,"PAH",1,1,3,0)
1. When site transfers funds from one Control Point to another they 
"PKG",455,22,1,"PAH",1,1,4,0)
   receive the message "'No Records To Print' when trying to review 
"PKG",455,22,1,"PAH",1,1,5,0)
   the entry.
"PKG",455,22,1,"PAH",1,1,6,0)
 
"PKG",455,22,1,"PAH",1,1,7,0)
2. When user edits an incomplete detailed Purchase Card Order, the 
"PKG",455,22,1,"PAH",1,1,8,0)
   existing Cost Center value may not be displayed.
"PKG",455,22,1,"PAH",1,1,9,0)
 
"PKG",455,22,1,"PAH",1,1,10,0)
3. SHIP TO ADDRESS inconsistent between information entered during
"PKG",455,22,1,"PAH",1,1,11,0)
   Prosthetics GUI order entry and reprinting order in IFCAP using 
"PKG",455,22,1,"PAH",1,1,12,0)
   options REPRINT PURCHASE CARD ORDER or DISPLAY PURCHASE 
"PKG",455,22,1,"PAH",1,1,13,0)
   ORDER/REQUISITION.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PRCBSTF")
0^1^B20812904^B20681231
"RTN","PRCBSTF",1,0)
PRCBSTF ;WISC@ALTOONA/CLH-TRANSFER FUNDS TO ANOTHER FCP ; 05/01/94  10:40 AM
"RTN","PRCBSTF",2,0)
V ;;5.1;IFCAP;**143**;Oct 20, 2000;Build 3
"RTN","PRCBSTF",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCBSTF",4,0)
GETTRAN ;GET TEMP TRANS NUMBER
"RTN","PRCBSTF",5,0)
 S PRCF("X")="ABFS" D ^PRCFSITE Q:'%
"RTN","PRCBSTF",6,0)
 D WAIT^PRCFYN S DIC="^PRCF(421.6,",DLAYGO=421.6,DIC(0)="XOLM",X=PRC("SITE")_"-"_^%ZOSF("VOL")_"-"_($J#1000000000),PRCBT=0
"RTN","PRCBSTF",7,0)
 S:'$D(COUNT) COUNT=0 D ^DIC K DIC Q:+Y<0  I $P(Y,"^",3)="" S COUNT=COUNT+1 Q:COUNT>3  S DIK="^PRCF(421.6,",DA=+Y D ^DIK K DIK G GETTRAN
"RTN","PRCBSTF",8,0)
 S (TDA,DA)=+Y,PRCBT=1,PRCB("AMOUNT")="",PRCB("ANAMT")=""
"RTN","PRCBSTF",9,0)
 S DIE=421.6,DR="[PRCB READER FILE EDIT]"
"RTN","PRCBSTF",10,0)
EDIT D ^DIE I $D(Y) S %A="Do you want to quit and delete this entry",%B="",%=1 D ^PRCFYN G:%=2 EDIT S DIK="^PRCF(421.6," D ^DIK G OUT
"RTN","PRCBSTF",11,0)
 K X,X1 S X=$P(^PRCF(421.6,TDA,0),"^",2,9) F I=1:1:8 I $P(X,"^",I)="" S X1=1
"RTN","PRCBSTF",12,0)
 I $D(X1) W !,"Not all required data has been entered. Re-edit transaction." G EDIT
"RTN","PRCBSTF",13,0)
 S %A="Do you want to review this entry",%B="",%=1 D ^PRCFYN G:%<0 KILL D:%=1 DISP
"RTN","PRCBSTF",14,0)
QPOST ;GET FIRST SEQUENCE NUMBER FROM FILE 421
"RTN","PRCBSTF",15,0)
 S %A="Are you ready to post this transaction",%B="",%=1 D ^PRCFYN G:%'=1 KILL
"RTN","PRCBSTF",16,0)
 D WAIT^PRCFYN
"RTN","PRCBSTF",17,0)
 D POST I $G(PRCQT) G GETTRAN
"RTN","PRCBSTF",18,0)
 S DIK="^PRCF(421.6,",DA=TDA D ^DIK
"RTN","PRCBSTF",19,0)
 S %A="Make another transfer",%B="",%=1 D ^PRCFYN G:%=1 GETTRAN
"RTN","PRCBSTF",20,0)
 G OUT
"RTN","PRCBSTF",21,0)
POST ;post transfer
"RTN","PRCBSTF",22,0)
 S PRCQT=""
"RTN","PRCBSTF",23,0)
SEQNUM1 D SEQNUM^PRCBE I '$D(X) S PRCQT=1 QUIT
"RTN","PRCBSTF",24,0)
 S DIC="^PRCF(421,",DLAYGO=421,DIC(0)="LOX" D ^DIC I $P(Y,"^",3)'=1 G SEQNUM1
"RTN","PRCBSTF",25,0)
 S SEQ1DA=+Y K DIC,DLAYGO
"RTN","PRCBSTF",26,0)
SEQNUM2 ;GET SECOND SEQUENCE NUMBER FROM FILE 421
"RTN","PRCBSTF",27,0)
 D SEQNUM^PRCBE
"RTN","PRCBSTF",28,0)
 S DIC="^PRCF(421,",DLAYGO=421,DIC(0)="LOX" D ^DIC I $P(Y,"^",3)'=1 G SEQNUM2
"RTN","PRCBSTF",29,0)
 S SEQ2DA=+Y K DLAYGO,DIC
"RTN","PRCBSTF",30,0)
 ; Corrected SACC violation on locks for PRC*5*242
"RTN","PRCBSTF",31,0)
 L +^PRCF(421,SEQ1DA):5 I '$T W !,$C(7),"Another user is editing this entry" K SEQ1DA Q 
"RTN","PRCBSTF",32,0)
 L +^PRCF(421,SEQ2DA):5 I '$T W !,$C(7),"Another user is editing this entry" K SEQ2DA L -^PRCF(421,SEQ1DA) Q 
"RTN","PRCBSTF",33,0)
 ;
"RTN","PRCBSTF",34,0)
 S TEMP=^PRCF(421,SEQ1DA,0)
"RTN","PRCBSTF",35,0)
 S $P(TEMP,"^",2)=PRCB("FRCP"),$P(TEMP,"^",6)=PRCB("TDT"),$P(TEMP,"^",PRCB("QTR")+6)="-"_PRCB("AMOUNT"),$P(TEMP,"^",20)=0
"RTN","PRCBSTF",36,0)
 S $P(TEMP,"^",22)=SEQ2DA
"RTN","PRCBSTF",37,0)
 S $P(^PRCF(421,SEQ1DA,4),"^",PRCB("QTR"))=0,$P(^(4),"^",5,6)=-PRCB("ANAMT")_"^"_PRCB("RNR"),^PRCF(421,"AL",PRCF("SIFY"),0,SEQ1DA)="",^PRCF(421,"AC",PRCF("SIFY")_"-"_+PRCB("FRCP"),SEQ1DA)=""
"RTN","PRCBSTF",38,0)
 I $G(TDA) S %X="^PRCF(421.6,TDA,1,",%Y="^PRCF(421,SEQ1DA,1," D %XY^%RCR
"RTN","PRCBSTF",39,0)
 I $D(PRCDES) D
"RTN","PRCBSTF",40,0)
 . N A,X,Y
"RTN","PRCBSTF",41,0)
 . S A="421;^PRCF(421,;"_SEQ1DA_";17~421.01;^PRCF(421,"_SEQ1DA_",1,;"
"RTN","PRCBSTF",42,0)
 . S X=PRCDES D ADD^PRC0B1(.X,.Y,A) K ^PRCF(421,SEQ1DA,1,"B")
"RTN","PRCBSTF",43,0)
 . QUIT
"RTN","PRCBSTF",44,0)
 S ^PRCF(421,SEQ1DA,0)=TEMP D EDIT^PRC0B(.X,"421;^PRCF(421,;"_SEQ1DA,"1.6///"_PRC("BBFY"))
"RTN","PRCBSTF",45,0)
 S TEMP2=^PRCF(421,SEQ2DA,0)
"RTN","PRCBSTF",46,0)
 S $P(TEMP2,"^",2)=PRCB("TOCP"),$P(TEMP2,"^",6)=PRCB("TDT"),$P(TEMP2,"^",PRCB("QTR")+6)=PRCB("AMOUNT"),$P(TEMP2,"^",20)=0
"RTN","PRCBSTF",47,0)
 S $P(TEMP2,"^",22)=SEQ1DA
"RTN","PRCBSTF",48,0)
 S $P(^PRCF(421,SEQ2DA,4),"^",PRCB("QTR"))=0,$P(^(4),"^",5,6)=PRCB("ANAMT")_"^"_PRCB("RNR"),^PRCF(421,"AL",PRCF("SIFY"),0,SEQ2DA)="",^PRCF(421,"AC",PRCF("SIFY")_"-"_+PRCB("TOCP"),SEQ2DA)=""
"RTN","PRCBSTF",49,0)
 I $G(TDA) S %X="^PRCF(421.6,TDA,1,",%Y="^PRCF(421,SEQ2DA,1," D %XY^%RCR
"RTN","PRCBSTF",50,0)
 I $D(PRCDES) D
"RTN","PRCBSTF",51,0)
 . N A,X,Y
"RTN","PRCBSTF",52,0)
 . S A="421;^PRCF(421,;"_SEQ2DA_";17~421.01;^PRCF(421,"_SEQ2DA_",1,;"
"RTN","PRCBSTF",53,0)
 . S X=PRCDES D ADD^PRC0B1(.X,.Y,A) K ^PRCF(421,SEQ2DA,1,"B")
"RTN","PRCBSTF",54,0)
 . QUIT
"RTN","PRCBSTF",55,0)
 S ^PRCF(421,SEQ2DA,0)=TEMP2 D EDIT^PRC0B(.X,"421;^PRCF(421,;"_SEQ2DA,"1.6///"_PRC("BBFY"))
"RTN","PRCBSTF",56,0)
 L -^PRCF(421,SEQ1DA),-^PRCF(421,SEQ2DA)
"RTN","PRCBSTF",57,0)
 W !!,"Finished.  The following transactions have been created",!,"in file 421 (Fund Distribution):"
"RTN","PRCBSTF",58,0)
 W !,"                            ",$P(^PRCF(421,SEQ1DA,0),"^")
"RTN","PRCBSTF",59,0)
 W !,"                            ",$P(^PRCF(421,SEQ2DA,0),"^")
"RTN","PRCBSTF",60,0)
 W !!
"RTN","PRCBSTF",61,0)
 QUIT
"RTN","PRCBSTF",62,0)
 ;
"RTN","PRCBSTF",63,0)
OUT K %F,COUNT,D0,DA,DIC,DIE,DIK,DR,PRCB("AMOUNT"),PRCB("FRCP"),PRCB("QTR"),PRCB("TOCP"),PRCB("TRANS"),SEQ1DA,SEQ2DA,TDA,TEMP,TEMP2,ZX
"RTN","PRCBSTF",64,0)
 K PRCBT,PRCB("TDT"),PRCB("ANAMT"),PRCB("LAST"),PRCB("MDIV"),PRCB("RNR")
"RTN","PRCBSTF",65,0)
 Q
"RTN","PRCBSTF",66,0)
KILL S %A="Then I will delete this entry",%A(1)="Are you sure you want this deleted",%B="",%=1 D ^PRCFYN G:%'=1 QPOST
"RTN","PRCBSTF",67,0)
 S DIK="^PRCF(421.6,",DA=TDA D ^DIK S X="  <Entry Deleted>*" D MSG^PRCFQ G OUT
"RTN","PRCBSTF",68,0)
DISP S IOP=ION,DIC="^PRCF(421.6,",(TO,FR)=PRC("SITE")_"-"_^%ZOSF("VOL")_"-"_($J#1000000000),L=0,BY=".01",FLDS="[PRCB READER DISP]" D EN1^DIP
"RTN","PRCBSTF",69,0)
 S %A="Do you want to edit this entry",%B="",%=2 D ^PRCFYN Q:%'=1
"RTN","PRCBSTF",70,0)
 S DIE="^PRCF(421.6,",DR="[PRCB READER FILE EDIT]",DA=TDA D ^DIE K DIE
"RTN","PRCBSTF",71,0)
 Q
"RTN","PRCHDP1")
0^3^B28389827^B25706480
"RTN","PRCHDP1",1,0)
PRCHDP1 ;WISC/RSD/RHD-DISPLAY A P.O. ;2/17/98  15:49
"RTN","PRCHDP1",2,0)
 ;;5.1;IFCAP;**143**;Oct 20, 2000;Build 3
"RTN","PRCHDP1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHDP1",4,0)
 S PRCHD0=$G(^PRC(442,D0,0)),PRCHD1=$G(^(1)),X=0
"RTN","PRCHDP1",5,0)
 N PRCHSIT1
"RTN","PRCHDP1",6,0)
 S PRCHDSIT=$P(PRCHD0,"-",1)
"RTN","PRCHDP1",7,0)
 S PRCHSIT1=$S($P($G(^PRC(442,D0,23)),U,7)]"":$P(^(23),U,7),1:$P(PRCHD0,"-"))
"RTN","PRCHDP1",8,0)
 S PRCHDSHP="" Q:PRCHD0']""  S:'$D(PRCHPO) PRCHPO=D0
"RTN","PRCHDP1",9,0)
 I PRCHD1']"",$D(^PRC(442,D0,4,1,0)) S DIC="^PRC(442,",DA=PRCHPO D EN^DIQ Q
"RTN","PRCHDP1",10,0)
 Q:PRCHD1']""  S PRCHDS=0 I +$P(PRCHD0,U,2)'=4,$P(PRCHD1,U,12)="" S PRCHDSHP=$G(^PRC(411,PRCHSIT1,1,+$P(PRCHD1,U,3),0))
"RTN","PRCHDP1",11,0)
 I '$T,$P(PRCHD1,U,12)]"" S PRCHDSHP=$G(^PRC(440.2,$P(PRCHD1,U,12),0)),PRCHDS=1 I +PRCHDSHP>0 S $P(PRCHDSHP,U,1)=$E($P($G(^DPT(+PRCHDSHP,0)),U,1),1,21)
"RTN","PRCHDP1",12,0)
 S IOP="HOME",%ZIS="",PRCHDST=$G(^PRC(411,PRCHDSIT,0)),PRCHDHSP=$G(^(3)) D ^%ZIS W:$Y>0 @IOF
"RTN","PRCHDP1",13,0)
 S PRCHTYPE=$P($G(^PRC(442,D0,23)),U,11)
"RTN","PRCHDP1",14,0)
 I PRCHTYPE="P"!(PRCHTYPE="S") S PRCHTYPE="P"
"RTN","PRCHDP1",15,0)
 W !,$S($G(PRCHTYPE)="P":"PC ORDER: ",$G(PRCHTYPE)="D":"DELIVER ORDER: ",$D(PRCHNRQ):"REQUISITION: ",1:"PURCHASE ORDER: ")_$P(PRCHD0,U,1),?37,"STATUS: " I +$G(^PRC(442,D0,7))>0 W $E($P($G(^PRCD(442.3,+^(7),0)),U,1),1,34)
"RTN","PRCHDP1",16,0)
 W !,"M.O.P.: ",$P($G(^PRCD(442.5,+$P(PRCHD0,U,2),0)),U,1),?37,"LAST PARTIAL RECD.: " S X=0 I $D(^PRC(442,D0,11,0)) S I=0 F  S I=$O(^PRC(442,D0,11,I)) Q:I=""!(I'>0)  S X=I,Y=+^(I,0)
"RTN","PRCHDP1",17,0)
 S:X>0 X=X_"  "_$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3) W:X>0 X W !,?37,"REQUESTING SERVICE: ",$S($D(^DIC(49,+$P(PRCHD1,U,2),0)):$P(^(0),U,1),1:"")
"RTN","PRCHDP1",18,0)
 N PRCHDV1 S PRCHDV=$G(^PRC(440,+PRCHD1,0)),PRCHDV1=$P(PRCHDV,U,1)
"RTN","PRCHDP1",19,0)
 I PRCHDV1="SIMPLIFIED",$P($G(^PRC(442,PRCHPO,24)),U,2)'="" S PRCHDV1=$P($G(^PRC(442,PRCHPO,24)),U,2)
"RTN","PRCHDP1",20,0)
 W !,"VENDOR:",?9,PRCHDV1
"RTN","PRCHDP1",21,0)
 W ?48,"SHIP TO: ",$P(PRCHDSHP,U,1)
"RTN","PRCHDP1",22,0)
 ;
"RTN","PRCHDP1",23,0)
 ; Make sure that the station number is defined for Prosthetics users.
"RTN","PRCHDP1",24,0)
 S PRC("SITE")=PRCHDSIT
"RTN","PRCHDP1",25,0)
 D FTYP^PRCHFPNT S V(1)=$P(PRCHDV,U,2),V=2,S=1 S:'PRCHDS S(S)=PRCHFTYP,S=S+1
"RTN","PRCHDP1",26,0)
 I $P(PRCHDV,U,3)]"" S V(V)=$P(PRCHDV,U,3),V=V+1 S:$P(PRCHDV,U,4)]"" V(V)=$P(PRCHDV,U,4),V=V+1 S:$P(PRCHDV,U,5)]"" V(V)=$P(PRCHDV,U,5),V=V+1
"RTN","PRCHDP1",27,0)
 S V(V)=$S($P(PRCHDV,U,6)]"":($P(PRCHDV,U,6)_", "),1:"   ")_$P($G(^DIC(5,+$P(PRCHDV,U,7),0)),U,2)_"  "_$P(PRCHDV,U,8),V=V+1
"RTN","PRCHDP1",28,0)
 S:$P(PRCHDV,U,10)]"" V(V)=$P(PRCHDV,U,10),V=V+1
"RTN","PRCHDP1",29,0)
 I $D(^PRC(440,+PRCHD1,2)),$P(^(2),U,1)]"" S V(V)="ACCT # "_$P(^(2),U,1)
"RTN","PRCHDP1",30,0)
 I $P(PRCHDST,U,19)="Y",$D(^PRC(440,+PRCHD1,3)),$P(^(3),U,4)'="" S V(6)="FMS Vendor Code: "_$P(^(3),U,4)_$P(^(3),U,5)
"RTN","PRCHDP1",31,0)
 I $P(PRCHD1,U,4)="Y" S V(8)=" VERBAL PURCHASE ORDER" S:$P(PRCHD1,U,5)="Y" V(8)=" CONFIRMATION COPY"
"RTN","PRCHDP1",32,0)
 S PRCHEDI=$G(^PRC(440,+PRCHD1,3)) I PRCHEDI]"",$P(PRCHEDI,U,2)="Y",$P($G(^PRC(442,D0,12)),U,16)'="n" D  S V(8)=PRCHEDIT_" DO NOT MAIL"
"RTN","PRCHDP1",33,0)
 .S PRCHEDIT="",PRCHEDIT=$P($G(^PRC(442,D0,12)),U,14)
"RTN","PRCHDP1",34,0)
 .S PRCHEDIT=$S(PRCHEDIT'="":"*EDI EMERGENCY ORDER-"_$P($G(^PRC(443.4,PRCHEDIT,0)),U)_"*",1:"*EDI ORDER*") Q
"RTN","PRCHDP1",35,0)
 K PRCHEDI,PRCHEDIT
"RTN","PRCHDP1",36,0)
 S:$P(PRCHDSHP,U,2)]"" S(S)=$P(PRCHDSHP,U,2),S=S+1 S:$P(PRCHDSHP,U,3)]"" S(S)=$P(PRCHDSHP,U,3),S=S+1 S:$P(PRCHDSHP,U,4)]"" S(S)=$P(PRCHDSHP,U,4),S=S+1
"RTN","PRCHDP1",37,0)
 S S(S)=$S($P(PRCHDSHP,U,5)]"":($E($P(PRCHDSHP,U,5),1,12)_", "),1:"   ")_$P($G(^DIC(5,+$P(PRCHDSHP,U,6),0)),U,2)_"  "_$P(PRCHDSHP,U,7),S=S+2
"RTN","PRCHDP1",38,0)
 I $P(PRCHDSHP,U,8)]"",'PRCHDS S S(S)="DELIVERY HOURS:",S=S+1,S(S)=$P(PRCHDSHP,U,8)
"RTN","PRCHDP1",39,0)
 ;S:$P($G(^PRC(442,D0,23)),"^",11)="S" V(1)=""
"RTN","PRCHDP1",40,0)
 I $P(PRCHDV,U)="SIMPLIFIED",$P($G(^PRC(442,PRCHPO,24)),U,2)'="" S V(1)=""
"RTN","PRCHDP1",41,0)
 F I=1:1:7 W ! W:$D(V(I)) ?9,V(I) W:$D(S(I)) ?57,S(I)
"RTN","PRCHDP1",42,0)
 W ! W:$D(V(8)) V(8) W:$D(S(8)) ?57,S(8) W !
"RTN","PRCHDP1",43,0)
 I $P(PRCHD1,U,11)]"" W ?38,"DELIVERY LOCATION: ",$P(PRCHD1,U,11),!
"RTN","PRCHDP1",44,0)
 F I=1:1:80 W "_"
"RTN","PRCHDP1",45,0)
 I $P($G(^PRC(442,D0,24)),U,3)="RMPR" D  K RMPRPO,RMPR664,RMPRR3
"RTN","PRCHDP1",46,0)
 . S RMPRPO=$P($P($G(^PRC(442,D0,0)),U),"-",2) Q:RMPRPO=""
"RTN","PRCHDP1",47,0)
 . S RMPR664=$O(^RMPR(664,"G",RMPRPO,0)) Q:RMPR664'>0
"RTN","PRCHDP1",48,0)
 . S RMPRR3=$G(^RMPR(664,RMPR664,3)) I $P(RMPRR3,U)="",$P(RMPRR3,U,4)="" Q
"RTN","PRCHDP1",49,0)
 . W !,"Prosthetics Delivery information:"
"RTN","PRCHDP1",50,0)
 . W !,?7,"Delivery To: ",$E($P(RMPRR3,U),1,50)
"RTN","PRCHDP1",51,0)
 . W !,?9,"Attention: ",$E($P(RMPRR3,U,4),1,50)
"RTN","PRCHDP1",52,0)
 . W ! F I=1:1:80 W "_"
"RTN","PRCHDP1",53,0)
FOB W !,"FOB POINT: ",$S("O"=$E($P(PRCHD1,U,6)):"ORIGIN","D"=$E($P(PRCHD1,U,6)):"DESTINATION",1:""),?29,"|","PROPOSAL: " S DIWL=1,DIWR=16,DIWF="",X=$P(PRCHD1,U,8) K ^UTILITY($J,"W") D DIWP^PRCUTL($G(DA))
"RTN","PRCHDP1",54,0)
 K ^TMP($J,"W") S %X="^UTILITY($J,""W"",",%Y="^TMP($J,""W""," D %XY^%RCR
"RTN","PRCHDP1",55,0)
 W ?40,$G(^TMP($J,"W",1,1,0)),?57,"|AUTHORITY: ",!,"COST CENTER: ",$P(PRCHD0,U,5),?29,"|",?40,$G(^TMP($J,"W",1,2,0)),?57,"|  "
"RTN","PRCHDP1",56,0)
 S Y=0 F I=1:1 S Y=$O(^PRC(442,D0,14,Y)) Q:'Y  W:I>1 "," W $P($G(^PRC(442.4,+^(Y,0),0)),U,2)
"RTN","PRCHDP1",57,0)
 W !,"TYPE: ",$P(PRCHD1,U,14) D TY W X,?29,"|",?40,$G(^TMP($J,"W",1,3,0)),?57,"|"_$S($P($G(^PRC(442,D0,23)),U,11)'="":"BUYER",1:"AGENT")_":"
"RTN","PRCHDP1",58,0)
DIS W !,"DELIVER ON/BEFORE " S Y=$P(PRCHD0,U,10) D DT W ?29,"|","CONTRACT: "
"RTN","PRCHDP1",59,0)
 S Y=+$P(PRCHD1,U,10),Y=$P($G(^VA(200,Y,0)),U,1) W ?57,"|  ",$P(Y,",",2)," ",$P(Y,",",1)
"RTN","PRCHDP1",60,0)
 W !,"DISCOUNT TERM: " S X=0 I $D(^PRC(442,D0,5,0)) F I=1:1:2 S X=$O(^PRC(442,D0,5,X)) Q:X=""!(X'>0)  W $P(^(X,0),U,4),$P(^(0),U,1) W:$P(^(0),U,1)=+$P(^(0),U,1) "%" W $P(^(0),U,2)," "
"RTN","PRCHDP1",61,0)
CON K Y S X=0 F I=1:1:3 S:(X'="") X=$O(^PRC(442,D0,2,"AC",X)) D:X'=""  D:I=2 APP W ?29,"|" W:$D(Y) ?38,$S($D(^(Y)):$J(^(Y),3),1:"") W:X'="" ?41,X W ?57,"|" D DAT:I=1,EST:I=2,TOT:I=3 W ! K Y
"RTN","PRCHDP1",62,0)
 .S:$D(^(X)) Y=$O(^(X,0))
"RTN","PRCHDP1",63,0)
 F I=1:1:80 W "-"
"RTN","PRCHDP1",64,0)
 G ^PRCHDP2
"RTN","PRCHDP1",65,0)
APP W "APP: ",$P(PRCHD0,U,4),"-",$P($P(PRCHD0,U,3)," ",1) Q
"RTN","PRCHDP1",66,0)
DAT W "DATE: " S Y=$P(PRCHD1,U,15) D DT Q
"RTN","PRCHDP1",67,0)
TOT W "TOTAL: ",$J($P(PRCHD0,U,15),8,2) Q
"RTN","PRCHDP1",68,0)
EST S Y=$S($D(^PRC(442,D0,7)):$P(^(7),U,3),1:"") Q:Y'="Y"  W "ESTIMATED" Q
"RTN","PRCHDP1",69,0)
DT I Y W Y\100#100,"/",Y#100\1,"/",Y\10000+1700
"RTN","PRCHDP1",70,0)
 Q
"RTN","PRCHDP1",71,0)
TY S X=+$P(PRCHD1,U,7),X=$P($G(^PRCD(420.8,X,0)),U,1),X=$S(X=2:"PURCHASE ORDER",X="B":"DELIVERY & PURCHASE ORDER",X="":"",1:"DELIVERY ORDER")
"RTN","PRCHDP1",72,0)
 Q
"RTN","PRCHFPT1")
0^4^B29746380^B26421857
"RTN","PRCHFPT1",1,0)
PRCHFPT1 ;WISC/RSD/RHD-CONT. OF PRINT ;5/1/98  15:59
"RTN","PRCHFPT1",2,0)
 ;;5.1;IFCAP;**143**;Oct 20, 2000;Build 3
"RTN","PRCHFPT1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHFPT1",4,0)
 I $P($G(^PRC(442,D0,24)),U,3)="RMPR" D  K RMPRPO,RMPR664,RMPRR3
"RTN","PRCHFPT1",5,0)
 . S RMPRPO=$P($P($G(^PRC(442,D0,0)),U),"-",2) Q:RMPRPO=""
"RTN","PRCHFPT1",6,0)
 . S RMPR664=$O(^RMPR(664,"G",RMPRPO,0)) Q:RMPR664'>0
"RTN","PRCHFPT1",7,0)
 . S RMPRR3=$G(^RMPR(664,RMPR664,3)) I $P(RMPRR3,U)="",$P(RMPRR3,U,4)="" Q
"RTN","PRCHFPT1",8,0)
 . W !,"Prosthetics Delivery information:"
"RTN","PRCHFPT1",9,0)
 . W !,?7,"Delivery To: ",$P(RMPRR3,U)
"RTN","PRCHFPT1",10,0)
 . W !,?9,"Attention: ",$P(RMPRR3,U,4)
"RTN","PRCHFPT1",11,0)
 . W ?96 F I=1:1:96 W @IOBS
"RTN","PRCHFPT1",12,0)
 . W PRCHULN
"RTN","PRCHFPT1",13,0)
 S Y=0 I PRCHDES="R",PRCHFPT,$D(^PRC(442,D0,11,PRCHFPT,0)),$P(^(0),U,12)]"" S X=^(0) D RR^PRCHFPT4
"RTN","PRCHFPT1",14,0)
 D:'Y INV W !,"FOB POINT: ",$S("O"=$E($P(PRCH1,U,6)):"ORIGIN","D"=$E($P(PRCH1,U,6)):"DESTINATION",1:""),?34,"|","PROPOSAL: " S DIWL=1,DIWR=16,DIWF="",X=$P(PRCH1,U,8) K ^UTILITY($J,"W") D DIWP^PRCUTL($G(DA))
"RTN","PRCHFPT1",15,0)
 K ^TMP($J,"W") S %X="^UTILITY($J,""W"",DIWL,",%Y="^TMP($J,""W"",DIWL," D %XY^%RCR
"RTN","PRCHFPT1",16,0)
 W ?45,$G(^TMP($J,"W",1,1,0)),?64,"|",PRCHINV(1),!,"GOV'T BL #: ",$P(PRCH12,U,7),?34,"|",?45,$G(^TMP($J,"W",1,2,0)),?64,"|",PRCHINV(2)
"RTN","PRCHFPT1",17,0)
 W !,$P(PRCH1,U,14) D TY W X,?34,"|",?45,$G(^TMP($J,"W",1,3,0)),?64,"|",PRCHINV(3)
"RTN","PRCHFPT1",18,0)
 W !,"DELIVER ON/BEFORE " S Y=$P(PRCH0,U,10) D DT W ?34,"|","CONTRACT: "
"RTN","PRCHFPT1",19,0)
 W ?64,"|",PRCHINV(4),!
"RTN","PRCHFPT1",20,0)
 W "DISCOUNT TERM: " S PRCH=0 I $D(^PRC(442,D0,5,0)) F I=1:1:2 S PRCH=$O(^PRC(442,D0,5,PRCH)) Q:PRCH=""!(PRCH'>0)  W $P(^(PRCH,0),U,4),$P(^(0),U,1) W:$P(^(0),U,1)=+$P(^(0),U,1) "%" W $P(^(0),U,2)," "
"RTN","PRCHFPT1",21,0)
 K Y S PRCH=0
"RTN","PRCHFPT1",22,0)
 F I=1:1:3 S:PRCH'="" PRCH=$O(^PRC(442,D0,2,"AC",PRCH)) S:PRCH'="" Y=$O(^(PRCH,0)) W:I=2 "SHIP VIA: ",$P(PRCH12,U,8) W ?34,"|" W:$G(Y)'="" ?42,$S($D(^(Y)):$J(^(Y),3),1:"") W:PRCH'="" ?45,PRCH W ?64,"|" D  ; <<< rew
"RTN","PRCHFPT1",23,0)
 .W:$D(PRCHINV(I+4)) PRCHINV(I+4) W ! K Y
"RTN","PRCHFPT1",24,0)
 W $E(PRCHULN,1,34),"|",$E(PRCHULN,1,29),"|",$E(PRCHULN,1,31)
"RTN","PRCHFPT1",25,0)
 W ! W:$G(PRCHTYPE)'="S" ?59,"UNIT" W ?69,"TOTAL" W:PRCHDES="R" ?80,"QTY",?90,"AMT"
"RTN","PRCHFPT1",26,0)
 W !,"ITEM",?15,"DESCRIPTION" W:$G(PRCHTYPE)'="S" ?46,"QTY",?51,"UNIT",?59,"COST" W ?69,"COST"
"RTN","PRCHFPT1",27,0)
 W:PRCHDES="R" ?80,"REC",?90,"REC" W ?96 F I=1:1:96 W @IOBS
"RTN","PRCHFPT1",28,0)
 W PRCHULN K PRCHHSP,PRCHINV,PRCHSHP,PRCHST,S,V,^TMP($J,"P") S PRCHL=18,P=1,PRCH=0
"RTN","PRCHFPT1",29,0)
 ;
"RTN","PRCHFPT1",30,0)
CNTI S PRCH=$O(^PRC(442,D0,2,PRCH)) G:PRCH'>0 CNTD S LITEM=$G(^(PRCH,2)),PRCHLB=1,PRCHL1=$P(LITEM,U,4) S:$P(^(0),U,6)]"" PRCHL1=PRCHL1+1 S:$P(^(0),U,13)]"" PRCHL1=PRCHL1+1 S:$P(LITEM,U,9)]"" PRCHL1=PRCHL1+1 S:$P(LITEM,U,11)]"" PRCHL1=PRCHL1+1
"RTN","PRCHFPT1",31,0)
 S:$P($G(^PRC(442,D0,2,PRCH,2)),U,9)]""!($P($G(^(2)),U,11)]"") PRCHL1=PRCHL1+3 S:$P($G(^PRC(442,D0,2,PRCH,4)),U,12) PRCHL1=PRCHL1+1 S:P=1 PRCHL1=PRCHL1+3
"RTN","PRCHFPT1",32,0)
 D P:PRCHL-1<1 S ^TMP($J,"P",P,PRCH)=PRCHLB_U_PRCHL1,PRCHL=PRCHL-PRCHL1-1
"RTN","PRCHFPT1",33,0)
 G CNTI
"RTN","PRCHFPT1",34,0)
CNTD S (PRCHLE,PRCHLB,PRCH)=0 F J=0:0 S PRCH=$O(^PRC(442,D0,3,PRCH)) Q:PRCH=""!(PRCH'>0)  S:PRCHLB=0 PRCHLB=PRCH S PRCHLE=PRCH D P1:PRCHL-2<1 S ^TMP($J,"P",P,"D")=PRCHLB_U_PRCHLE,PRCHL=PRCHL-2
"RTN","PRCHFPT1",35,0)
 I $P(PRCH0,U,13)>0!($P(PRCH0,U,18)>0) D:PRCHL-3<1 P1 S ^TMP($J,"P",P,"E")=$P(PRCH0,U,13),PRCHL=PRCHL-3 I PRCHDES="R",PRCHDTA,PRCHFPT=1 S PRCHDTA=PRCHDTA+$P(PRCH0,U,13)
"RTN","PRCHFPT1",36,0)
 I $D(^PRC(442,D0,15)) F J=0:0 S J=$O(^PRC(442,D0,15,J)) Q:'J  S PRCHJ=^(J,0),PRCH="F"_J_U_+PRCHJ,PRCHLB=1,PRCHL1=$P(PRCHJ,U,2) D P:PRCHL-1<PRCHL1 S ^TMP($J,"P",P,PRCH)=PRCHLB_U_PRCHL1,PRCHL=PRCHL-PRCHL1-1
"RTN","PRCHFPT1",37,0)
 G REQ:'$D(^PRC(442,D0,4,0)) K ^UTILITY($J,"W") S PRCH="W",DIWL=1,DIWR=64,DIWF="",PRCHJ=0 F  S PRCHJ=$O(^PRC(442,D0,4,PRCHJ)) Q:PRCHJ=""  S X=^(PRCHJ,0) D DIWP^PRCUTL($G(DA))
"RTN","PRCHFPT1",38,0)
 K ^TMP($J,"PRCH") S %X="^UTILITY($J,""W"",DIWL,",%Y="^TMP($J,""PRCH"",1," D %XY^%RCR
"RTN","PRCHFPT1",39,0)
 S PRCHL1=+^UTILITY($J,"W",DIWL),PRCHLB=1 D P:PRCHL-1<PRCHL1 S ^TMP($J,"P",P,"W")=PRCHLB_U_PRCHL1,PRCHL=PRCHL-PRCHL1-1
"RTN","PRCHFPT1",40,0)
 ;
"RTN","PRCHFPT1",41,0)
REQ I $D(^PRC(442,D0,13,0)) S (PRCHLE,PRCHLB,PRCH)=0 F J=0:0 S PRCH=$O(^PRC(442,D0,13,PRCH)) Q:'PRCH  S:PRCHLB=0 I=3,PRCHLB=PRCH S PRCHLE=PRCH D P1:PRCHL-I<3 S ^TMP($J,"P",P,"X")=PRCHLB_U_PRCHLE,PRCHL=PRCHL-I,I=2
"RTN","PRCHFPT1",42,0)
 ;
"RTN","PRCHFPT1",43,0)
BOCLN S CHGSHP=$P($G(^PRC(442,D0,0)),U,13)
"RTN","PRCHFPT1",44,0)
 S (N,COUNT)=0 I $G(^PRC(442,D0,22,0))'="" F  S COUNT=$O(^PRC(442,D0,22,COUNT)) Q:COUNT=""!(COUNT'>0)  S BCT=$G(^(COUNT,0)) I $P(BCT,U,3)'=991 S N=N+1
"RTN","PRCHFPT1",45,0)
 S:CHGSHP>0 N=N+1
"RTN","PRCHFPT1",46,0)
 S N=N-2 S:N<1 N=0
"RTN","PRCHFPT1",47,0)
 S BOCPG=N\45,BOCPG=$S(N#45'=0:BOCPG+1,1:BOCPG) S:PRCHL-1<3 PRCHL=45 S P=P+BOCPG
"RTN","PRCHFPT1",48,0)
 G ^PRCHFPT2
"RTN","PRCHFPT1",49,0)
 ;
"RTN","PRCHFPT1",50,0)
P S PRCHL=45,P=P+1 Q
"RTN","PRCHFPT1",51,0)
 ;
"RTN","PRCHFPT1",52,0)
P1 S PRCHLB=PRCHLE,PRCHL=45,P=P+1 Q
"RTN","PRCHFPT1",53,0)
 ;
"RTN","PRCHFPT1",54,0)
DT I Y W Y\100#100,"/",Y#100\1,"/",Y\10000+1700 Q
"RTN","PRCHFPT1",55,0)
 Q
"RTN","PRCHFPT1",56,0)
 ;
"RTN","PRCHFPT1",57,0)
TY S X=+$P(PRCH1,U,7),X=$P($G(^PRCD(420.8,X,0)),U,1),X=$S(X=2:"PURCHASE ORDER",X="B":"DELIVERY & PURCHASE ORDER",X="":"",1:"DELIVERY ORDER")
"RTN","PRCHFPT1",58,0)
 Q
"RTN","PRCHFPT1",59,0)
 ;
"RTN","PRCHFPT1",60,0)
INV ;
"RTN","PRCHFPT1",61,0)
 I $P($G(^PRC(442,D0,0)),U,2)=25 D  Q
"RTN","PRCHFPT1",62,0)
 . N PRCA,PRCB,PRCC
"RTN","PRCHFPT1",63,0)
 . S PRCHINV(1)="** No Purchase Card Info",PRCHINV(2)="",PRCHINV(3)="",PRCHINV(4)=""
"RTN","PRCHFPT1",64,0)
 . S PRCA=$P($G(^PRC(442,D0,23)),U,8) Q:PRCA'>0
"RTN","PRCHFPT1",65,0)
 . S PRCB=$G(^PRC(440.5,PRCA,0)) Q:PRCB=""
"RTN","PRCHFPT1",66,0)
 . S PRCC=$P(PRCB,U,8) S:PRCC>0 PRCC=$P($G(^VA(200,PRCC,0)),U)
"RTN","PRCHFPT1",67,0)
 . S PRCA=$P(PRCB,U,11),PRCHINV(1)="PURCHASE CARD HOLDER"
"RTN","PRCHFPT1",68,0)
 . S PRCHINV(2)=" "_$E(PRCC,1,25),PRCHINV(3)="PURCHASE CARD NAME"
"RTN","PRCHFPT1",69,0)
 . S PRCHINV(4)=" "_$E(PRCA,1,25)
"RTN","PRCHFPT1",70,0)
 S PRCHINV(1)=" MAIL INVOICE TO:",PRCHINV(2)=" "_$P(PRCHINV,U,1),PRCHINV(3)=" "_$P(PRCHINV,U,2),X=4
"RTN","PRCHFPT1",71,0)
 S:$P(PRCHINV,U,3)]"" PRCHINV(X)=" "_$P(PRCHINV,U,3),X=X+1 S:$P(PRCHINV,U,4)]"" PRCHINV(X)=" "_$P(PRCHINV,U,4),X=X+1
"RTN","PRCHFPT1",72,0)
 S PRCHINV(X)=" "_$P(PRCHINV,U,5)_", "_$P($G(^DIC(5,+$P(PRCHINV,U,6),0)),U,2)_" "_$P(PRCHINV,U,7)
"RTN","PRCHFPT1",73,0)
 Q
"RTN","PRCHNPO3")
0^2^B39512916^B39295710
"RTN","PRCHNPO3",1,0)
PRCHNPO3 ;WISC/RSD/RHD/SC-CONT. OF NEW PO ; 4/23/99 1:39pm
"RTN","PRCHNPO3",2,0)
V ;;5.1;IFCAP;**112,115,143**;Oct 20, 2000;Build 3
"RTN","PRCHNPO3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHNPO3",4,0)
 ;
"RTN","PRCHNPO3",5,0)
 S PRCHSZ=1
"RTN","PRCHNPO3",6,0)
 ;
"RTN","PRCHNPO3",7,0)
EN0 W !,"Enter a 2237 reference number. The FCP,Cost Center,Service,Delivery",!?3,"Location" W:PRCHSZ " and Line Items" W " will be transferred into this Purchase Order."
"RTN","PRCHNPO3",8,0)
 W !!,?10,"The 2237 Fiscal Year and Quarter must be earlier or same",!,?10,"as the P.O. Date Fiscal Year and Quarter.",!
"RTN","PRCHNPO3",9,0)
 I $O(^PRC(442,PRCHPO,13,0)) W !?3,"This Purchase Order already contains:" F I=0:0 S I=$O(^PRC(442,PRCHPO,13,I)) Q:'I  I $D(^PRCS(410,I,0)) W !?3,$P(^(0),U,1)
"RTN","PRCHNPO3",10,0)
 I '$D(^PRC(442,PRCHPO,1)),$P(^(1),U,15)="" W !!,"Cannot precede without a P.O. DATE" G Q
"RTN","PRCHNPO3",11,0)
 ;
"RTN","PRCHNPO3",12,0)
EN K PRCHSY S PRCHD=$P(^PRC(442,PRCHPO,1),U,15),PRCHSP=$P(^(0),U,12)
"RTN","PRCHNPO3",13,0)
 ;screen-out the Issue Book order if status is 65--Assigned to PPM Clerk, for nois MWV-0293-20011
"RTN","PRCHNPO3",14,0)
 S DIC="^PRC(443,"
"RTN","PRCHNPO3",15,0)
 S DIC(0)="AQEMZ"
"RTN","PRCHNPO3",16,0)
 I $G(PRCHZZZ9)'=1 S DIC("S")="I $P(^(0),U,3)]"""",""65,72""'[$P(^(0),U,7),$D(^PRCS(410,+Y,0)),+^(0)=PRC(""SITE""),$P(^(0),U,2)=""O"",$P(^(0),U,4)'=5,$D(^(""IT"",""AB"")) D EN3^PRCHNPO6"
"RTN","PRCHNPO3",17,0)
 I $G(PRCHZZZ9)=1 S DIC("S")="I $P(^(0),U,3)]"""",$P(^(0),U,7)=65,$D(^PRCS(410,+Y,0)),+^(0)=PRC(""SITE""),$P(^(0),U,2)=""O"",$P(^(0),U,4)'=5,$D(^(""IT"",""AB"")) D EN3^PRCHNPO6"
"RTN","PRCHNPO3",18,0)
 D ^DIC K DIC G:Y<0 Q S PRCHSY=+Y,PRCHSY(0)=Y(0),Y(0)=^PRCS(410,+Y,0),PRCHSX=$P(Y(0),U,1) I $D(^(1)),$P(^(1),U,3)="EM" W $C(7),!,"*** EMERGENCY ***"
"RTN","PRCHNPO3",19,0)
 ;I $D(^PRCS(410,+Y,0)),$P(^(0),U,4)=5 W !?3,"This is an Issue Book Order, and it can't be processed into a Purchase Order." Q
"RTN","PRCHNPO3",20,0)
 ;
"RTN","PRCHNPO3",21,0)
EN1 S PRCHRFQT=$$DATE^PRC0C($P(Y(0),"^",11),"I"),PRCHRFQT=$P(PRCHRFQT,U,1,2)
"RTN","PRCHNPO3",22,0)
 S PRC("BBFY")=+$$DATE^PRC0C($P(^PRCS(410,+Y,3),"^",11),"I")
"RTN","PRCHNPO3",23,0)
 ;S PRCHCFQT=$$DATE^PRC0C($P(^PRC(420,PRC("SITE"),0),U,9),"I"),PRCHCFQT=$P(PRCHCFQT,U,1,2)
"RTN","PRCHNPO3",24,0)
 S PRCHPFQT=$$DATE^PRC0C($P(^PRC(442,PRCHPO,1),"^",15),"I"),PRCHPFQT=$P(PRCHPFQT,U,1,2)
"RTN","PRCHNPO3",25,0)
 I PRCHRFQT'=PRCHPFQT W !,?10,"The Fiscal Year and Quarter on this 2237 is not",!,?10,"compatible with the PO Date.",!,$C(7) K PRCHRFQT,PRCHPFQT G EN
"RTN","PRCHNPO3",26,0)
 K PRCHRFQT,PRCHPFQT
"RTN","PRCHNPO3",27,0)
 I $P(^PRC(442,PRCHPO,0),U,3)]"",+$P(^PRC(442,PRCHPO,0),U,3)'=+$P(^PRCS(410,PRCHSY,3),U,1) W !?3,"Fund Control Point for this 2237 doesn't match the existing FCP in P.O.",$C(7) G EN
"RTN","PRCHNPO3",28,0)
 I $P(^PRC(442,PRCHPO,0),U,5)]"",+$P(^PRC(442,PRCHPO,0),U,5)'=+$P(^PRCS(410,PRCHSY,3),U,3) W !?3,"Cost Center for this 2237 doesn't match the Cost Center in P.O.",$C(7) G EN
"RTN","PRCHNPO3",29,0)
 S X="",Z="" I $D(^PRC(420,PRC("SITE"),1,+^PRCS(410,PRCHSY,3),0)) S X=$P(^(0),U,12),Z=$P(^(0),U,18)
"RTN","PRCHNPO3",30,0)
 I X'=2 S:Z'="" $P(^PRC(442,PRCHPO,17),U,1)=$E(Z,1,3) I Z="" W $C(7),!?3,"Fund Control point is missing LOG Department Number!!" G EN
"RTN","PRCHNPO3",31,0)
 I X I PRCHN("MP")=4!((X=3)&(PRCHN("MP")=3)) S Y=$P(^PRCD(442.5,PRCHN("MP"),0),U,1) W $C(7),!?3,"This Fund Control Point is not valid for a "_Y_" order." G EN
"RTN","PRCHNPO3",32,0)
 S EN=0 I $D(^PRC(411,"UP",PRC("SITE"))) D  G EN:EN=1
"RTN","PRCHNPO3",33,0)
 .I $P($G(^PRCS(410,+Y,0)),U,10)="" W $C(7),!!?3,"This 2237 does not have a substation.",! S EN=1 Q
"RTN","PRCHNPO3",34,0)
 .I $P($G(^PRCS(410,+Y,0)),U,10)'=$P($G(^PRC(442,PRCHPO,23)),U,7) W $C(7),!!?3,"The substation on this 2237 does not match the substation entered",!?3,"on this "_$S($D(PRCHNRQ):"requisition.",1:"purchase order."),! S EN=1
"RTN","PRCHNPO3",35,0)
 D SPRMK^PRCHNPO6
"RTN","PRCHNPO3",36,0)
 ;
"RTN","PRCHNPO3",37,0)
N Q:'PRCHSZ  K ^TMP($J,"PRCHS"),PRCHSIT S J=0,K=1,PRCHSIT(K)="" G:$D(PRCHPOST) 1
"RTN","PRCHNPO3",38,0)
 W !?3,"Line Items: " R PRCHX:DTIME G Q:PRCHX["^"!(PRCHX=""),HLP:$E(PRCHX)="?",1:"Aa"[$E(PRCHX)
"RTN","PRCHNPO3",39,0)
 F  Q:'$F(PRCHX,",,")  S PRCHX=$P(PRCHX,",,",1)_","_$P(PRCHX,",,",2,99) ; *112 remove consecutive commas
"RTN","PRCHNPO3",40,0)
 S:$E(PRCHX)="," PRCHX=$E(PRCHX,2,$L(PRCHX)) ; *112 remove leading comma
"RTN","PRCHNPO3",41,0)
 S:$E(PRCHX,$L(PRCHX))="," PRCHX=$E(PRCHX,1,$L(PRCHX)-1) ; *112 remove trailing comma
"RTN","PRCHNPO3",42,0)
 F I=1:1 S X=$P(PRCHX,",",I) Q:X=""  I +X'=X S X(1)=$P(X,":",1),X(2)=$P(X,":",2) K:+X(1)'=X(1)!(+X(2)'=X(2))!'(X(1)<X(2)) PRCHX Q:'$D(PRCHX)  S $P(PRCHX,",",I)=X(1)_":1:"_X(2)
"RTN","PRCHNPO3",43,0)
 I '$D(PRCHX) W " ??",$C(7) G N
"RTN","PRCHNPO3",44,0)
 X "F I="_PRCHX_" D IT Q:'$O(^TMP($J,""PRCHS"",0))" G:'$O(^TMP($J,"PRCHS",0)) N S ^(0)=J
"RTN","PRCHNPO3",45,0)
 ;
"RTN","PRCHNPO3",46,0)
3 G 2:J=+^PRCS(410,PRCHSY,10),Q:'$O(^TMP($J,"PRCHS",0)) W !,"A new 2237 will now be created with the following items: " F K=0:0 S K=$O(PRCHSIT(K)) Q:'K  W !?3,PRCHSIT(K)
"RTN","PRCHNPO3",47,0)
 S %A="     Do you wish to proceed",%B="",%=1 D ^PRCFYN I %'=1 G N
"RTN","PRCHNPO3",48,0)
 Q:$D(PRCHG)  S PRCHSIT=J,PRCHS=PRCHSY D WAIT^DICD,^PRCHSP D:PRCHSY=-1 ERR D:PRCHSY=-3 ERR1 D:PRCHSY=-2 ERR2 G:PRCHSY<0 EN D EN4^PRCHNPO2
"RTN","PRCHNPO3",49,0)
 G EN
"RTN","PRCHNPO3",50,0)
 ;
"RTN","PRCHNPO3",51,0)
1 S I=0 F  S I=$O(^PRCS(410,PRCHSY,"IT","AB",I)) Q:I=""  D IT
"RTN","PRCHNPO3",52,0)
 S:$O(^TMP($J,"PRCHS",0)) ^(0)=J
"RTN","PRCHNPO3",53,0)
 G 3
"RTN","PRCHNPO3",54,0)
 ;
"RTN","PRCHNPO3",55,0)
2 Q:$D(PRCHG)  S PRCHSIT=J,PRCHS="" D WAIT^DICD,^PRCHSP1
"RTN","PRCHNPO3",56,0)
 D:PRCHSY=-1 ERR
"RTN","PRCHNPO3",57,0)
 D:PRCHSY=-2 ERR2
"RTN","PRCHNPO3",58,0)
 D:PRCHSY=-3 ERR1
"RTN","PRCHNPO3",59,0)
 G:PRCHSY<0 EN
"RTN","PRCHNPO3",60,0)
 D EN4^PRCHNPO2
"RTN","PRCHNPO3",61,0)
 G EN
"RTN","PRCHNPO3",62,0)
 ;
"RTN","PRCHNPO3",63,0)
IT I $D(^PRCS(410,PRCHSY,"IT","AB",I)),$D(^PRCS(410,PRCHSY,"IT",$O(^(I,0)),0)) S ^TMP($J,"PRCHS",I)="",J=J+1 S:$L(PRCHSIT(K))>72 K=K+1,PRCHSIT(K)="" S PRCHSIT(K)=PRCHSIT(K)_I_"," Q
"RTN","PRCHNPO3",64,0)
 W !?5,"** ",I," IS AN INVALID LINE ITEM NUMBER",$C(7) K ^TMP($J,"PRCHS")
"RTN","PRCHNPO3",65,0)
 Q
"RTN","PRCHNPO3",66,0)
 ;
"RTN","PRCHNPO3",67,0)
HLP W !?3,"ENTER A LINE ITEM NUMBER IN THE FOLLOWING FORMAT:  1,2,3,4 OR 1:4 ",!?5," OR ENTER 'A' FOR ALL LINE ITEMS " S DIC="^PRCS(410,+PRCHSY,""IT"",",DIC(0)="E",X="??",D="AB" D IX^DIC K DIC G N
"RTN","PRCHNPO3",68,0)
 Q
"RTN","PRCHNPO3",69,0)
 ;
"RTN","PRCHNPO3",70,0)
Q S (DA,D0)=PRCHPO K C,DIC,X,PRCH,PRCHD,PRCHS,PRCHSP,PRCHSIT,PRCHJ,PRCHK,PRCHSLI,PRCHSX,PRCHSY,PRCHSZ,PRCHX,^TMP($J,"PRCHS"),EN,Y
"RTN","PRCHNPO3",71,0)
 S:0 Y="@1" ;<<< Removed the SET Y="@1" from this routine and put it into the template PRCH2138. <<<
"RTN","PRCHNPO3",72,0)
 Q
"RTN","PRCHNPO3",73,0)
 ;
"RTN","PRCHNPO3",74,0)
DT S X="T" D ^%DT S DT=Y
"RTN","PRCHNPO3",75,0)
 Q
"RTN","PRCHNPO3",76,0)
 ;
"RTN","PRCHNPO3",77,0)
EN2 ;CHECKS FCP PARAMETERS & SET Y, CALLED FROM PRCH2138,PRCHIFREG
"RTN","PRCHNPO3",78,0)
 S PRCHN("SFC")=+$P(^PRC(442,DA,0),"^",19)
"RTN","PRCHNPO3",79,0)
 S $P(^PRC(442,DA,18),U,2)=$S((PRCHN("SFC")=2)&(PRCHN("MP")=12):"B",PRCHN("SFC")=2:"A",PRCHN("SFC")=3:"J",1:"")
"RTN","PRCHNPO3",80,0)
 S Y(0)=+$P(^PRC(442,DA,0),"^",3)
"RTN","PRCHNPO3",81,0)
 I $G(PRCHCC)'="",$G(Y(0))'="",'$D(^PRC(420,PRC("SITE"),1,+Y(0),2,+PRCHCC)) S PRCHCC="" K DE(2)
"RTN","PRCHNPO3",82,0)
 Q
"RTN","PRCHNPO3",83,0)
 ;
"RTN","PRCHNPO3",84,0)
ERR W !,$C(7),"Cannot get a transaction number at this time for the new transaction being split",!,"out.  Try again later!"
"RTN","PRCHNPO3",85,0)
 Q
"RTN","PRCHNPO3",86,0)
 ;
"RTN","PRCHNPO3",87,0)
ERR1 W !,$C(7),"Cannot find the 2237 you selected in file 410."
"RTN","PRCHNPO3",88,0)
 Q
"RTN","PRCHNPO3",89,0)
 ;
"RTN","PRCHNPO3",90,0)
ERR2 W !,$C(7),"Not continuing with this 2237."
"RTN","PRCHNPO3",91,0)
 Q
"RTN","PRCHNPO3",92,0)
 ;
"RTN","PRCHNPO3",93,0)
VENMSG ;message to alert users that vendors don't match and that IMF will
"RTN","PRCHNPO3",94,0)
 ;be updated.
"RTN","PRCHNPO3",95,0)
 W !!,"NOTE-Vendors on PO and 2237 don't match.  If you proceed IMF info"," will be used.  If there is no IMF entry for the item for this vendor one will ","be created."
"RTN","PRCHNPO3",96,0)
 N % S %=0
"RTN","PRCHNPO3",97,0)
 W !,"Would you like to proceed" D YN^DICN W !! I %'=1 S PRCHFLG=1
"RTN","PRCHNPO3",98,0)
 Q
"VER")
8.0^22.0
"BLD",6069,6)
^121
**END**
**END**
