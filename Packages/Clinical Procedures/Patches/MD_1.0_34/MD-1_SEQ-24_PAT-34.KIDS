Released MD*1*34 SEQ #24
Extracted from mail message
**KIDS**:MD*1.0*34^

**INSTALL NAME**
MD*1.0*34
"BLD",8593,0)
MD*1.0*34^CLINICAL PROCEDURES^0^3130619^y
"BLD",8593,1,0)
^^1^1^3130619^
"BLD",8593,1,1,0)
MODIFY AUTO-COMPLETE OF PROCEDURE TIME
"BLD",8593,4,0)
^9.64PA^^
"BLD",8593,6.3)
1
"BLD",8593,"KRN",0)
^9.67PA^779.2^20
"BLD",8593,"KRN",.4,0)
.4
"BLD",8593,"KRN",.401,0)
.401
"BLD",8593,"KRN",.402,0)
.402
"BLD",8593,"KRN",.403,0)
.403
"BLD",8593,"KRN",.5,0)
.5
"BLD",8593,"KRN",.84,0)
.84
"BLD",8593,"KRN",3.6,0)
3.6
"BLD",8593,"KRN",3.8,0)
3.8
"BLD",8593,"KRN",9.2,0)
9.2
"BLD",8593,"KRN",9.8,0)
9.8
"BLD",8593,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8593,"KRN",9.8,"NM",1,0)
MDHL7XXX^^0^B28032567
"BLD",8593,"KRN",9.8,"NM","B","MDHL7XXX",1)

"BLD",8593,"KRN",19,0)
19
"BLD",8593,"KRN",19.1,0)
19.1
"BLD",8593,"KRN",101,0)
101
"BLD",8593,"KRN",409.61,0)
409.61
"BLD",8593,"KRN",771,0)
771
"BLD",8593,"KRN",779.2,0)
779.2
"BLD",8593,"KRN",870,0)
870
"BLD",8593,"KRN",8989.51,0)
8989.51
"BLD",8593,"KRN",8989.52,0)
8989.52
"BLD",8593,"KRN",8994,0)
8994
"BLD",8593,"KRN","B",.4,.4)

"BLD",8593,"KRN","B",.401,.401)

"BLD",8593,"KRN","B",.402,.402)

"BLD",8593,"KRN","B",.403,.403)

"BLD",8593,"KRN","B",.5,.5)

"BLD",8593,"KRN","B",.84,.84)

"BLD",8593,"KRN","B",3.6,3.6)

"BLD",8593,"KRN","B",3.8,3.8)

"BLD",8593,"KRN","B",9.2,9.2)

"BLD",8593,"KRN","B",9.8,9.8)

"BLD",8593,"KRN","B",19,19)

"BLD",8593,"KRN","B",19.1,19.1)

"BLD",8593,"KRN","B",101,101)

"BLD",8593,"KRN","B",409.61,409.61)

"BLD",8593,"KRN","B",771,771)

"BLD",8593,"KRN","B",779.2,779.2)

"BLD",8593,"KRN","B",870,870)

"BLD",8593,"KRN","B",8989.51,8989.51)

"BLD",8593,"KRN","B",8989.52,8989.52)

"BLD",8593,"KRN","B",8994,8994)

"BLD",8593,"PRET")
 
"BLD",8593,"QUES",0)
^9.62^^
"BLD",8593,"REQB",0)
^9.611^1^1
"BLD",8593,"REQB",1,0)
MD*1.0*21^1
"BLD",8593,"REQB","B","MD*1.0*21",1)

"MBREQ")
0
"PKG",365,-1)
1^1
"PKG",365,0)
CLINICAL PROCEDURES^MD^Clinical Procedures
"PKG",365,20,0)
^9.402P^^
"PKG",365,22,0)
^9.49I^1^1
"PKG",365,22,1,0)
1.0^3090522^2980529^363
"PKG",365,22,1,"PAH",1,0)
34^3130619
"PKG",365,22,1,"PAH",1,1,0)
^^1^1^3130619
"PKG",365,22,1,"PAH",1,1,1,0)
MODIFY AUTO-COMPLETE OF PROCEDURE TIME
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","MDHL7XXX")
0^1^B28032567^B26957233
"RTN","MDHL7XXX",1,0)
MDHL7XXX ; HOIFO/DP - Loopback device for CP ;4/10/09  09:20
"RTN","MDHL7XXX",2,0)
 ;;1.0;CLINICAL PROCEDURES;**21,34**;Apr 01, 2004;Build 1
"RTN","MDHL7XXX",3,0)
 ; 06/19/13 KAM/BP Remedy Ticket 442635/MD*1*34  Modified the Process
"RTN","MDHL7XXX",4,0)
 ;          subroutine to look back 365 days instead of 5 days for 
"RTN","MDHL7XXX",5,0)
 ;          auto-complete of procedures
"RTN","MDHL7XXX",6,0)
 ; IA#  2263 [Supported] XPAR Call
"RTN","MDHL7XXX",7,0)
 ;      2693 [Subscription] TIU Extractions.
"RTN","MDHL7XXX",8,0)
 ;      2980 [Subscription] Calls to GMRCGUIB.
"RTN","MDHL7XXX",9,0)
 ;      3160 [Subscription] GMRCMED Call
"RTN","MDHL7XXX",10,0)
 ;      3067 [Private] Read fields in Consult file (#123) w/FM
"RTN","MDHL7XXX",11,0)
 ;      3468 [Subscription] GMRCCP API.
"RTN","MDHL7XXX",12,0)
 ;      3535 [Subscription] Calls to TIUSRVP.
"RTN","MDHL7XXX",13,0)
 ;      4508 [Subscription] Call to TIUSRVPT.
"RTN","MDHL7XXX",14,0)
 ;     10060 [Supported] New Person File (#200) Read w/FM.
"RTN","MDHL7XXX",15,0)
 ;     10103 [Supported] Calls to XLFDT
"RTN","MDHL7XXX",16,0)
 ;
"RTN","MDHL7XXX",17,0)
EN ; [Procedure] Main entry point
"RTN","MDHL7XXX",18,0)
 ; wait 10 seconds and then produce some results in the CP RESULTS file
"RTN","MDHL7XXX",19,0)
 ; Variables STUDY and INST passed in via taskman
"RTN","MDHL7XXX",20,0)
 H 10 ; Wait for the study to update
"RTN","MDHL7XXX",21,0)
 N MDFDA,MDIEN,MDERR K ^TMP($J)
"RTN","MDHL7XXX",22,0)
 L +(^MDD(703.1,"B")):15 E  Q
"RTN","MDHL7XXX",23,0)
 F  D  Q:'$D(^MDD(703.1,"B",X))
"RTN","MDHL7XXX",24,0)
 .S X="127001_"_(+$H)_$E($P($H,",",2)_"00000",1,5)
"RTN","MDHL7XXX",25,0)
 S MDFDA(703.1,"+1,",.01)=X
"RTN","MDHL7XXX",26,0)
 D UPDATE^DIE("","MDFDA","MDIEN","MDERR")
"RTN","MDHL7XXX",27,0)
 L -(^MDD(703.1,"B"))
"RTN","MDHL7XXX",28,0)
 S MDIEN=+$G(MDIEN(1),-1)_"," Q:+MDIEN<0
"RTN","MDHL7XXX",29,0)
 ; Proceed to build the report here using MDIEN in file 703.1
"RTN","MDHL7XXX",30,0)
 S MDFDA(703.1,MDIEN,.02)=$P(^MDD(702,STUDY,0),U,1)
"RTN","MDHL7XXX",31,0)
 S MDFDA(703.1,MDIEN,.03)=$$NOW^XLFDT()
"RTN","MDHL7XXX",32,0)
 S MDFDA(703.1,MDIEN,.04)=INST
"RTN","MDHL7XXX",33,0)
 D:+$$GET1^DIQ(702.09,INST_",",.13,"I")  ; Bi-Directional?
"RTN","MDHL7XXX",34,0)
 .S MDFDA(703.1,MDIEN,.05)=STUDY
"RTN","MDHL7XXX",35,0)
 ;
"RTN","MDHL7XXX",36,0)
 ;; New Loopback Method -- BEGIN
"RTN","MDHL7XXX",37,0)
 S MDFDA(703.1,MDIEN,.09)="P"
"RTN","MDHL7XXX",38,0)
 S MDFDA(703.11,"+2,"_MDIEN,.01)="3"
"RTN","MDHL7XXX",39,0)
 S MDFDA(703.11,"+2,"_MDIEN,.1)="\\vhaishmul14\uploads\body-box-study_19960228_000.pdf"
"RTN","MDHL7XXX",40,0)
 D UPDATE^DIE("","MDFDA","MDIEN","MDERR")
"RTN","MDHL7XXX",41,0)
 ;; New Loopback Method -- END
"RTN","MDHL7XXX",42,0)
 ;
"RTN","MDHL7XXX",43,0)
 ; New High Volume Procedure code begin
"RTN","MDHL7XXX",44,0)
 N MDSR S MDSR=$$NTIU^MDRPCW1(+STUDY,+MDIEN)
"RTN","MDHL7XXX",45,0)
 ; New High Volume Procedure end 
"RTN","MDHL7XXX",46,0)
 ;; Original Loopback Method -- BEGIN
"RTN","MDHL7XXX",47,0)
 ;S MDFDA(703.11,"+2,"_MDIEN,.01)="1"
"RTN","MDHL7XXX",48,0)
 ;D UPDATE^DIE("","MDFDA","MDIEN","MDERR")
"RTN","MDHL7XXX",49,0)
 ;S MDIEN=+MDIEN(2)_","_MDIEN
"RTN","MDHL7XXX",50,0)
 ;S MDFDA(703.11,MDIEN,.2)=$NA(MDFDA(703.11,MDIEN,.2))
"RTN","MDHL7XXX",51,0)
 ;D GETS^DIQ(702,STUDY_",",".01;.011;.02;.03;.04;.05;.06;.07;.08;.09;.091;.1;.11;.12;.991","ENR",$NA(^TMP($J)))
"RTN","MDHL7XXX",52,0)
 ;S X="" F  S X=$O(^TMP($J,702,STUDY_",",X)) Q:X=""  D
"RTN","MDHL7XXX",53,0)
 ;.S Y=$O(MDFDA(703.11,MDIEN,.2,""),-1)+1
"RTN","MDHL7XXX",54,0)
 ;.S MDFDA(703.11,MDIEN,.2,Y)=X_": "_$G(^TMP($J,702,STUDY_",",X,"E"))
"RTN","MDHL7XXX",55,0)
 ;S MDFDA(703.1,$P(MDIEN,",",2,3),.09)="P"
"RTN","MDHL7XXX",56,0)
 ;D UPDATE^DIE("","MDFDA","MDIEN","MDERR")
"RTN","MDHL7XXX",57,0)
 ;; Original Loopback Method -- END
"RTN","MDHL7XXX",58,0)
 ;
"RTN","MDHL7XXX",59,0)
 K ^TMP($J)
"RTN","MDHL7XXX",60,0)
 Q
"RTN","MDHL7XXX",61,0)
 ;
"RTN","MDHL7XXX",62,0)
TEST ; Queue up the study creator
"RTN","MDHL7XXX",63,0)
 N DIC
"RTN","MDHL7XXX",64,0)
 S DIC=702,DIC(0)="AEQM",DIC("A")="Select Study to create a report for: "
"RTN","MDHL7XXX",65,0)
 D ^DIC Q:+Y<1
"RTN","MDHL7XXX",66,0)
 S STUDY=+Y,INST=+$P(^MDD(702,+Y,0),U,11)
"RTN","MDHL7XXX",67,0)
 D LOOPBACK(STUDY,INST)
"RTN","MDHL7XXX",68,0)
 Q
"RTN","MDHL7XXX",69,0)
 ;
"RTN","MDHL7XXX",70,0)
LOOPBACK(STUDY,INST) ; Queue up the Loopback process
"RTN","MDHL7XXX",71,0)
 N ZTSAVE,ZTRTN,ZTIO,ZTDESC,ZTDTH,ZTSK
"RTN","MDHL7XXX",72,0)
 S ZTSAVE("STUDY")=STUDY,ZTSAVE("INST")=INST
"RTN","MDHL7XXX",73,0)
 S ZTRTN="EN^MDHL7XXX"
"RTN","MDHL7XXX",74,0)
 S ZTIO=""
"RTN","MDHL7XXX",75,0)
 S ZTDESC="CP Loopback test"
"RTN","MDHL7XXX",76,0)
 S ZTDTH=$$NOW^XLFDT()
"RTN","MDHL7XXX",77,0)
 D ^%ZTLOAD
"RTN","MDHL7XXX",78,0)
 Q
"RTN","MDHL7XXX",79,0)
PROCESS ; Process Device Results
"RTN","MDHL7XXX",80,0)
 N MDADD,MDADAR,MDARAD,MDWA,MDALRT,MDAPU,MDCONRS,MDCST,MDCX,MDFD,MDFDA,MDL,MDL1,MDHR,MDHVL,MDKK,MDMAXD,MDMG,MDRR,MDSTU,MDSTAT,MDTIUER,MDX,MDX4
"RTN","MDHL7XXX",81,0)
 S MDMAXD=DT+.24,(MDRR,MDARAD,MDTIUER)="" K ^TMP("MDTIUST",$J)
"RTN","MDHL7XXX",82,0)
 D GETLST^XPAR(.MDHVL,"SYS","MD GET HIGH VOLUME")
"RTN","MDHL7XXX",83,0)
 S MDAPU="CLINICAL,DEVICE PROXY SERVICE"
"RTN","MDHL7XXX",84,0)
 S MDFD=$$FIND1^DIC(200,,"X",MDAPU,"B")
"RTN","MDHL7XXX",85,0)
 F MDKK=0:0 S MDKK=$O(MDHVL(MDKK)) Q:MDKK<1  S:+$P($G(MDHVL(MDKK)),"^") MDHR(+$P($G(MDHVL(MDKK)),"^"))=$P($G(MDHVL(MDKK)),"^",2)
"RTN","MDHL7XXX",86,0)
 ;
"RTN","MDHL7XXX",87,0)
 ;06/19/13 KAM/BP 442635/MD*1*34 Changed next line from -5 to -365
"RTN","MDHL7XXX",88,0)
 ;
"RTN","MDHL7XXX",89,0)
 S MDL=$$FMADD^XLFDT(DT,-365,0,0)  F  S MDL=$O(^MDD(702,"ASD",MDL)) Q:MDL<1!(MDL>MDMAXD)  F MDL1=0:0 S MDL1=$O(^MDD(702,"ASD",MDL,MDL1)) Q:MDL1<1  S MDX=$G(^MDD(702,MDL1,0)) D
"RTN","MDHL7XXX",90,0)
 .Q:$G(MDHR(+$P(MDX,"^",4)))=""  S MDCX=$G(MDHR(+$P(MDX,"^",4)))
"RTN","MDHL7XXX",91,0)
 .Q:$P($G(^MDS(702.01,+$P(MDX,U,4),0)),U,6)=2
"RTN","MDHL7XXX",92,0)
 .S MDCST=$P(MDX,"^",5) Q:'+MDCST
"RTN","MDHL7XXX",93,0)
 .Q:'+$P(MDX,"^",6)
"RTN","MDHL7XXX",94,0)
 .K ^TMP("MDTIUST",$J),MDWA
"RTN","MDHL7XXX",95,0)
 .S MDWA(1202)=MDFD,MDWA(1204)=MDFD,MDWA(1302)=MDFD
"RTN","MDHL7XXX",96,0)
 .S MDWA("TEXT",1,0)="** DOCUMENT IN VISTA IMAGING **"
"RTN","MDHL7XXX",97,0)
 .S MDWA("TEXT",2,0)="SEE FULL REPORT IN VISTA IMAGING",MDWA("TEXT",3,0)=""
"RTN","MDHL7XXX",98,0)
 .D EXTRACT^TIULQ($P(MDX,U,6),"^TMP(""MDTIUST"",$J)",MDTIUER,".01;.05","E")
"RTN","MDHL7XXX",99,0)
 .I $G(^TMP("MDTIUST",$J,$P(MDX,U,6),.05,"E"))'="COMPLETED"&('+$P(MDCX,";",2)) D  Q
"RTN","MDHL7XXX",100,0)
 ..Q:$P(MDX,"^",9)'=3
"RTN","MDHL7XXX",101,0)
 ..I +$P(MDCX,";",1) S MDCONRS=$$CPDOC^GMRCCP(+MDCST,+$P(MDX,"^",6),2) Q
"RTN","MDHL7XXX",102,0)
 ..I '+$P(MDCX,";",1) D UPDATE^TIUSRVP(.MDRR,+$P(MDX,"^",6),.MDWA,1) D:+MDRR'<1 ADMNCLOS^TIUSRVPT(.MDARAD,+$P(MDX,"^",6),"M",MDFD) K MDWA D MEDCOMP^GMRCMED(+MDCST,$P(MDX,"^",6)_";TIU(8925,",DT,MDFD,$P(MDX,"^",3))
"RTN","MDHL7XXX",103,0)
 ..Q
"RTN","MDHL7XXX",104,0)
 .S MDSTU=MDL1 K MDWA
"RTN","MDHL7XXX",105,0)
 .S MDSTAT=$$GET1^DIQ(123,+MDCST_",",8,"E") I MDSTAT="COMPLETE" Q:$P(MDX,"^",9)=3  K MDFDA S MDFDA(702,MDSTU_",",.09)=3 D FILE^DIE("","MDFDA") K MDFDA Q
"RTN","MDHL7XXX",106,0)
 .I +$P(MDCX,";",2) D  Q
"RTN","MDHL7XXX",107,0)
 ..D GID(MDSTU,.MDADAR)
"RTN","MDHL7XXX",108,0)
 ..Q:$G(MDADAR(1))=""
"RTN","MDHL7XXX",109,0)
 ..S MDADD=$$SFILE^GMRCGUIB(+MDCST,4,"Y",MDFD,MDFD,.MDADAR,"N","",$G(^MDD(702,+MDSTU,3)))
"RTN","MDHL7XXX",110,0)
 ..S MDCONRS=$$CPDOC^GMRCCP(+MDCST,+$P(MDX,"^",6),2) Q
"RTN","MDHL7XXX",111,0)
 .S MDGET=$O(^MDD(703.1,"ASTUDYID",MDL1,""),-1) Q:'MDGET  S MDDAT=$P($G(^MDD(703.1,MDGET,0)),"^",3)
"RTN","MDHL7XXX",112,0)
 .D MEDCOMP^GMRCMED(+MDCST,$P(MDX,"^",6)_";TIU(8925,",MDDAT,MDFD,$P(MDX,"^",3))
"RTN","MDHL7XXX",113,0)
 .K ^TMP("MDTIUST",$J)
"RTN","MDHL7XXX",114,0)
 .I $P(MDX,"^",9)'=3 K MDFDA S MDFDA(702,MDSTU_",",.09)=3 D FILE^DIE("","MDFDA") K MDFDA
"RTN","MDHL7XXX",115,0)
 Q
"RTN","MDHL7XXX",116,0)
GID(STU,MDARY) ; Get the text array
"RTN","MDHL7XXX",117,0)
 N LOOP,MDRID,NODE S MDRID=0,LOOP=""
"RTN","MDHL7XXX",118,0)
 F  S LOOP=$O(^MDD(703.1,"ASTUDYID",STU,LOOP),-1) Q:LOOP<1!(+MDRID)  I +$P($G(^MDD(703.1,+LOOP,.4,0)),"^",3) S MDRID=+LOOP,NODE=$$GET1^DIQ(703.1,MDRID_",",.4,"","MDARY")
"RTN","MDHL7XXX",119,0)
 I +MDRID K MDFDA S MDFDA(703.1,MDRID_",",.4)="@" D FILE^DIE("","MDFDA") K MDFDA
"RTN","MDHL7XXX",120,0)
 Q
"VER")
8.0^22.0
"BLD",8593,6)
^24
**END**
**END**

