Released MD*1*14 SEQ #8
Extracted from mail message
**KIDS**:MD*1.0*14^

**INSTALL NAME**
MD*1.0*14
"BLD",6560,0)
MD*1.0*14^CLINICAL PROCEDURES^0^3080123^y
"BLD",6560,1,0)
^^2^2^3071031^^^^
"BLD",6560,1,1,0)
Please refer to the National Patch Module for the detail of this
"BLD",6560,1,2,0)
patch build.
"BLD",6560,4,0)
^9.64PA^702^1
"BLD",6560,4,702,0)
702
"BLD",6560,4,702,2,0)
^9.641^702^1
"BLD",6560,4,702,2,702,0)
CP TRANSACTION  (File-top level)
"BLD",6560,4,702,2,702,1,0)
^9.6411^.09^2
"BLD",6560,4,702,2,702,1,.09,0)
TRANSACTION STATUS
"BLD",6560,4,702,2,702,1,.14,0)
SCHEDULED DATE/TIME
"BLD",6560,4,702,222)
y^y^p^^^^n^^n
"BLD",6560,4,702,224)

"BLD",6560,4,"APDD",702,702)

"BLD",6560,4,"APDD",702,702,.09)

"BLD",6560,4,"APDD",702,702,.14)

"BLD",6560,4,"B",702,702)

"BLD",6560,6)
11^
"BLD",6560,6.3)
20
"BLD",6560,"INID")
^y
"BLD",6560,"INIT")
MDPOST14
"BLD",6560,"KRN",0)
^9.67PA^8989.52^19
"BLD",6560,"KRN",.4,0)
.4
"BLD",6560,"KRN",.401,0)
.401
"BLD",6560,"KRN",.402,0)
.402
"BLD",6560,"KRN",.403,0)
.403
"BLD",6560,"KRN",.5,0)
.5
"BLD",6560,"KRN",.84,0)
.84
"BLD",6560,"KRN",3.6,0)
3.6
"BLD",6560,"KRN",3.8,0)
3.8
"BLD",6560,"KRN",9.2,0)
9.2
"BLD",6560,"KRN",9.8,0)
9.8
"BLD",6560,"KRN",9.8,"NM",0)
^9.68A^8^6
"BLD",6560,"KRN",9.8,"NM",1,0)
MDWOR^^0^B34141861
"BLD",6560,"KRN",9.8,"NM",2,0)
MDWORC^^0^B13681232
"BLD",6560,"KRN",9.8,"NM",3,0)
MDWORSR^^0^B40172880
"BLD",6560,"KRN",9.8,"NM",5,0)
MDWSETUP^^0^B67128950
"BLD",6560,"KRN",9.8,"NM",7,0)
MDWCHK^^0^B15776924
"BLD",6560,"KRN",9.8,"NM",8,0)
MDKUTL^^0^B5317629
"BLD",6560,"KRN",9.8,"NM","B","MDKUTL",8)

"BLD",6560,"KRN",9.8,"NM","B","MDWCHK",7)

"BLD",6560,"KRN",9.8,"NM","B","MDWOR",1)

"BLD",6560,"KRN",9.8,"NM","B","MDWORC",2)

"BLD",6560,"KRN",9.8,"NM","B","MDWORSR",3)

"BLD",6560,"KRN",9.8,"NM","B","MDWSETUP",5)

"BLD",6560,"KRN",19,0)
19
"BLD",6560,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",6560,"KRN",19,"NM",1,0)
MD SCHEDULED STUDIES^^0
"BLD",6560,"KRN",19,"NM",2,0)
MD STUDY CHECK-IN^^0
"BLD",6560,"KRN",19,"NM",3,0)
MD AUTO CHECK-IN SETUP^^0
"BLD",6560,"KRN",19,"NM","B","MD AUTO CHECK-IN SETUP",3)

"BLD",6560,"KRN",19,"NM","B","MD SCHEDULED STUDIES",1)

"BLD",6560,"KRN",19,"NM","B","MD STUDY CHECK-IN",2)

"BLD",6560,"KRN",19.1,0)
19.1
"BLD",6560,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6560,"KRN",101,0)
101
"BLD",6560,"KRN",101,"NM",0)
^9.68A^4^4
"BLD",6560,"KRN",101,"NM",1,0)
OR EVSEND GMRC^^2
"BLD",6560,"KRN",101,"NM",2,0)
GMRC EVSEND OR^^2
"BLD",6560,"KRN",101,"NM",3,0)
MD RECEIVE GMRC^^0
"BLD",6560,"KRN",101,"NM",4,0)
MD RECEIVE OR^^0
"BLD",6560,"KRN",101,"NM","B","GMRC EVSEND OR",2)

"BLD",6560,"KRN",101,"NM","B","MD RECEIVE GMRC",3)

"BLD",6560,"KRN",101,"NM","B","MD RECEIVE OR",4)

"BLD",6560,"KRN",101,"NM","B","OR EVSEND GMRC",1)

"BLD",6560,"KRN",409.61,0)
409.61
"BLD",6560,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",6560,"KRN",771,0)
771
"BLD",6560,"KRN",870,0)
870
"BLD",6560,"KRN",8989.51,0)
8989.51
"BLD",6560,"KRN",8989.51,"NM",0)
^9.68A^4^4
"BLD",6560,"KRN",8989.51,"NM",1,0)
MD CHECK-IN PROCEDURE LIST^^0
"BLD",6560,"KRN",8989.51,"NM",2,0)
MD CLINIC QUICK LIST^^0
"BLD",6560,"KRN",8989.51,"NM",3,0)
MD CLINICS WITH MULT PROC^^0
"BLD",6560,"KRN",8989.51,"NM",4,0)
MD USE APPT WITH PROCEDURE^^0
"BLD",6560,"KRN",8989.51,"NM","B","MD CHECK-IN PROCEDURE LIST",1)

"BLD",6560,"KRN",8989.51,"NM","B","MD CLINIC QUICK LIST",2)

"BLD",6560,"KRN",8989.51,"NM","B","MD CLINICS WITH MULT PROC",3)

"BLD",6560,"KRN",8989.51,"NM","B","MD USE APPT WITH PROCEDURE",4)

"BLD",6560,"KRN",8989.52,0)
8989.52
"BLD",6560,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",6560,"KRN",8994,0)
8994
"BLD",6560,"KRN","B",.4,.4)

"BLD",6560,"KRN","B",.401,.401)

"BLD",6560,"KRN","B",.402,.402)

"BLD",6560,"KRN","B",.403,.403)

"BLD",6560,"KRN","B",.5,.5)

"BLD",6560,"KRN","B",.84,.84)

"BLD",6560,"KRN","B",3.6,3.6)

"BLD",6560,"KRN","B",3.8,3.8)

"BLD",6560,"KRN","B",9.2,9.2)

"BLD",6560,"KRN","B",9.8,9.8)

"BLD",6560,"KRN","B",19,19)

"BLD",6560,"KRN","B",19.1,19.1)

"BLD",6560,"KRN","B",101,101)

"BLD",6560,"KRN","B",409.61,409.61)

"BLD",6560,"KRN","B",771,771)

"BLD",6560,"KRN","B",870,870)

"BLD",6560,"KRN","B",8989.51,8989.51)

"BLD",6560,"KRN","B",8989.52,8989.52)

"BLD",6560,"KRN","B",8994,8994)

"BLD",6560,"QUES",0)
^9.62^^
"BLD",6560,"REQB",0)
^9.611^1^1
"BLD",6560,"REQB",1,0)
MD*1.0*4^2
"BLD",6560,"REQB","B","MD*1.0*4",1)

"FIA",702)
CP TRANSACTION
"FIA",702,0)
^MDD(702,
"FIA",702,0,0)
702PIAO
"FIA",702,0,1)
y^y^p^^^^n^^n
"FIA",702,0,10)

"FIA",702,0,11)

"FIA",702,0,"RLRO")

"FIA",702,0,"VR")
1.0^MD
"FIA",702,702)
1
"FIA",702,702,.09)

"FIA",702,702,.14)

"INIT")
MDPOST14
"KRN",19,12830,-1)
0^1
"KRN",19,12830,0)
MD SCHEDULED STUDIES^Scheduled Studies^^R^^^^^^^^CLINICAL PROCEDURES
"KRN",19,12830,1,0)
^19.06^3^3^3071203^^^^
"KRN",19,12830,1,1,0)
This option is tasked to run daily.  It will process the
"KRN",19,12830,1,2,0)
HL7 messages that need to be sent to the device on a daily
"KRN",19,12830,1,3,0)
basis for CP studies.
"KRN",19,12830,25)
EN1^MDWORSR
"KRN",19,12830,200.9)
y
"KRN",19,12830,"U")
SCHEDULED STUDIES
"KRN",19,12831,-1)
0^2
"KRN",19,12831,0)
MD STUDY CHECK-IN^Study Check-in^^R^^^^^^^^CLINICAL PROCEDURES
"KRN",19,12831,1,0)
^19.06^3^3^3071203^^
"KRN",19,12831,1,1,0)
This option is tasked to run daily.  It checks-in CP studies
"KRN",19,12831,1,2,0)
for procedures that require multiple encounters such as
"KRN",19,12831,1,3,0)
Hemodialysis, Respiratory Therapy, and Sleep Studies.
"KRN",19,12831,25)
CLINICPT^MDWORSR
"KRN",19,12831,200.9)
y
"KRN",19,12831,"U")
STUDY CHECK-IN
"KRN",19,12832,-1)
0^3
"KRN",19,12832,0)
MD AUTO CHECK-IN SETUP^Auto Study Check-In Setup^^R^^^^^^^^CLINICAL PROCEDURES
"KRN",19,12832,1,0)
^19.06^8^8^3071203^^^
"KRN",19,12832,1,1,0)
This option is used to populate the XPAR parameters MD USE
"KRN",19,12832,1,2,0)
APPT WITH PROCEDURE, MD CHECK-IN PROCEDURE LIST, MD CLINIC
"KRN",19,12832,1,3,0)
QUICK LIST, and MD CLINICS WITH MULT PROC.  The four XPAR
"KRN",19,12832,1,4,0)
parameters are used for the auto study check-in.  Users
"KRN",19,12832,1,5,0)
can use the option to indicate whether their site use
"KRN",19,12832,1,6,0)
and schedule appointments.  They can populate a list of
"KRN",19,12832,1,7,0)
procedures and associated clinics that need a CP study
"KRN",19,12832,1,8,0)
checked-in.
"KRN",19,12832,25)
EN1^MDWSETUP
"KRN",19,12832,"U")
AUTO STUDY CHECK-IN SETUP
"KRN",101,3778,-1)
2^2
"KRN",101,3778,0)
GMRC EVSEND OR^Consults event sent to OE/RR^^X^4558^^^^^^^66
"KRN",101,3778,10,0)
^101.01PA^4^3
"KRN",101,3778,10,4,0)
5797^^^
"KRN",101,3778,10,4,"^")
MD RECEIVE GMRC
"KRN",101,3794,-1)
2^1
"KRN",101,3794,0)
OR EVSEND GMRC^OE/RR => CONSULTS MESSAGE EVENT^^X^4558^^^^^^^
"KRN",101,3794,10,0)
^101.01PA^5^5
"KRN",101,3794,10,5,0)
5796^^^
"KRN",101,3794,10,5,"^")
MD RECEIVE OR
"KRN",101,5796,-1)
0^4
"KRN",101,5796,0)
MD RECEIVE OR^Clinical Procedures receives order msgs from CPRS^^A^^^^^^^^CLINICAL PROCEDURES
"KRN",101,5796,1,0)
^101.06^1^1^3070523^^^
"KRN",101,5796,1,1,0)
This protocol receives order messages from CPRS. (IA 3135)
"KRN",101,5796,20)
D EN^MDWOR(.XQORMSG)
"KRN",101,5796,99)
61003,52710
"KRN",101,5797,-1)
0^3
"KRN",101,5797,0)
MD RECEIVE GMRC^Clinical Procedures receives messages from Consult^^A^^^^^^^^CLINICAL PROCEDURES
"KRN",101,5797,1,0)
^101.06^1^1^3070523^^^^
"KRN",101,5797,1,1,0)
This protocol receives messages from Consult. (IA 3140)
"KRN",101,5797,20)
D EN^MDWORC(.XQORMSG)
"KRN",101,5797,99)
61003,52710
"KRN",8989.51,527,-1)
0^2
"KRN",8989.51,527,0)
MD CLINIC QUICK LIST^Clinic Quick List For CP^1^Clinic^Procedure
"KRN",8989.51,527,1)
P^702.01^Select a procedure for the clinic.
"KRN",8989.51,527,6)
P^44^Enter clinics that need CP studies to be checked-in.
"KRN",8989.51,527,20,0)
^8989.512^4^4^3071210^^^^
"KRN",8989.51,527,20,1,0)
List of clinics used as a source to get a list of patients
"KRN",8989.51,527,20,2,0)
that need to have CP studies checked-in.  This only applies
"KRN",8989.51,527,20,3,0)
to studies with procedures that have multiple results such
"KRN",8989.51,527,20,4,0)
as Hemodialysis, Respiratory Therapy, and sleep studies.
"KRN",8989.51,527,30,0)
^8989.513I^1^1
"KRN",8989.51,527,30,1,0)
1^4.2
"KRN",8989.51,528,-1)
0^1
"KRN",8989.51,528,0)
MD CHECK-IN PROCEDURE LIST^Check-in Procedure List^1^Procedure^Schedule Appointment?
"KRN",8989.51,528,1)
S^0:None;1:Outpatient;2:Inpatient;3:Both^Enter 0 for None, 1 for Outpatient, 2 for Inpatient, or 3 for both.
"KRN",8989.51,528,6)
P^702.01^Enter procedures that needs the study to be auto checked-in.
"KRN",8989.51,528,8)
I +$P(^MDS(702.01,+Y,0),"^",9)>0
"KRN",8989.51,528,20,0)
^8989.512^2^2^3071203^^^^
"KRN",8989.51,528,20,1,0)
This parameter contains a list of procedures that will be used
"KRN",8989.51,528,20,2,0)
to auto check-in the CP studies during the procedures request in CPRS.
"KRN",8989.51,528,30,0)
^8989.513I^1^1
"KRN",8989.51,528,30,1,0)
1^4.2
"KRN",8989.51,529,-1)
0^4
"KRN",8989.51,529,0)
MD USE APPT WITH PROCEDURE^Use Appointment With Procedure^0^^Use appointment with procedure^0
"KRN",8989.51,529,1)
Y
"KRN",8989.51,529,20,0)
^8989.512^2^2^3071210^^^^
"KRN",8989.51,529,20,1,0)
Enter "Y" or "N" for Yes/No on whether your site selects the appointment
"KRN",8989.51,529,20,2,0)
scheduled for outpatients during the procedure request in CPRS.
"KRN",8989.51,529,30,0)
^8989.513I^1^1
"KRN",8989.51,529,30,1,0)
1^4.2
"KRN",8989.51,530,-1)
0^3
"KRN",8989.51,530,0)
MD CLINICS WITH MULT PROC^Clinics With Multiple Procedures^1^Procedure^Clinic
"KRN",8989.51,530,1)
P^44^Enter a clinic for the procedure.
"KRN",8989.51,530,6)
P^702.01^Enter a procedure.
"KRN",8989.51,530,7)

"KRN",8989.51,530,8)
I +$P(^MDS(702.01,+Y,0),"^",9)>0
"KRN",8989.51,530,20,0)
^8989.512^2^2^3071203^^
"KRN",8989.51,530,20,1,0)
If you have a clinic for multiple procedures, populate this
"KRN",8989.51,530,20,2,0)
parameter with the procedure and associate it to a clinic.
"KRN",8989.51,530,30,0)
^8989.513I^1^1
"KRN",8989.51,530,30,1,0)
1^4.2
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",407,-1)
1^1
"PKG",407,0)
CLINICAL PROCEDURES^MD^Clinical Procedures
"PKG",407,20,0)
^9.402P^^
"PKG",407,22,0)
^9.49I^1^1
"PKG",407,22,1,0)
1.0^3070222^3080107^4558
"PKG",407,22,1,"PAH",1,0)
14^3080123^4558
"PKG",407,22,1,"PAH",1,1,0)
^^2^2^3080123
"PKG",407,22,1,"PAH",1,1,1,0)
Please refer to the National Patch Module for the detail of this
"PKG",407,22,1,"PAH",1,1,2,0)
patch build.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","MDKUTL")
0^8^B5317629^n/a
"RTN","MDKUTL",1,0)
MDKUTL ; HOIFO/DP - Renal Utilities ;11/29/07  14:45
"RTN","MDKUTL",2,0)
 ;;1.0;CLINICAL PROCEDURES;**14**;Apr 01, 2004;Build 20
"RTN","MDKUTL",3,0)
 ; Reference IA #10045 [Supported] XUSHSHP call
"RTN","MDKUTL",4,0)
 ;              #2241 [Supported] DECRYP^XUSRB1 call
"RTN","MDKUTL",5,0)
 ;              #10060 [Supported] FILE 200 references   
"RTN","MDKUTL",6,0)
 ;
"RTN","MDKUTL",7,0)
CP(STUDY) ; Check to see if the CP Study is logged
"RTN","MDKUTL",8,0)
 N DFN,MDFDA,MDIEN
"RTN","MDKUTL",9,0)
 S DFN=$P(^MDD(702,STUDY,0),U)
"RTN","MDKUTL",10,0)
 D:'$D(^MDK(704.202,STUDY,0))  ; Build study record (1..1) with file 702
"RTN","MDKUTL",11,0)
 .S MDFDA(704.202,"+1,",.01)=STUDY
"RTN","MDKUTL",12,0)
 .;S MDFDA(704.202,"+1,",.02)=DFN
"RTN","MDKUTL",13,0)
 .S MDFDA(704.202,"+1,",.09)=1
"RTN","MDKUTL",14,0)
 .S MDIEN(1)=STUDY
"RTN","MDKUTL",15,0)
 .D UPDATE^DIE("","MDFDA","MDIEN")
"RTN","MDKUTL",16,0)
 .K MDFDA,MDIEN
"RTN","MDKUTL",17,0)
 D:'$D(^MDK(704.201,DFN,0))  ; Build access point record (1..1) with file 2
"RTN","MDKUTL",18,0)
 .S MDFDA(704.201,"+1,",.01)=DFN
"RTN","MDKUTL",19,0)
 .S MDIEN(1)=DFN
"RTN","MDKUTL",20,0)
 .D UPDATE^DIE("","MDFDA","MDIEN")
"RTN","MDKUTL",21,0)
 .K MDFDA,MDIEN
"RTN","MDKUTL",22,0)
 Q
"RTN","MDKUTL",23,0)
UPD(STUDY,NOTEID) ; Add entries to update CP_TRANSACTION_TIU_HISTORY
"RTN","MDKUTL",24,0)
 N MDCHK,MDFDA,MDIEN
"RTN","MDKUTL",25,0)
 Q:$G(STUDY)=""
"RTN","MDKUTL",26,0)
 Q:$G(NOTEID)=""
"RTN","MDKUTL",27,0)
 S MDCHK=$O(^MDD(702.001,"ASTUDY",+STUDY,NOTEID,0)) Q:+MDCHK
"RTN","MDKUTL",28,0)
 D NOW^%DTC
"RTN","MDKUTL",29,0)
 S MDFDA(702.001,"+1,",.01)=STUDY
"RTN","MDKUTL",30,0)
 S MDFDA(702.001,"+1,",.02)=NOTEID
"RTN","MDKUTL",31,0)
 S MDFDA(702.001,"+1,",.03)=%
"RTN","MDKUTL",32,0)
 D UPDATE^DIE("","MDFDA")
"RTN","MDKUTL",33,0)
 K %,X,MDFDA,MDIEN
"RTN","MDKUTL",34,0)
 Q
"RTN","MDKUTL",35,0)
 ;
"RTN","MDKUTL",36,0)
RPC(RESULTS,OPTION,P1,P2,P3,P4,P5,P6) ; [Procedure] Main RPC call
"RTN","MDKUTL",37,0)
 ; RPC: [MDK UTILITIES]
"RTN","MDKUTL",38,0)
 ;
"RTN","MDKUTL",39,0)
 D CLEAN^DILF
"RTN","MDKUTL",40,0)
 S RESULTS=$NA(^TMP("MDKUTL",$J)) K @RESULTS
"RTN","MDKUTL",41,0)
 I $T(@OPTION)="" D  Q
"RTN","MDKUTL",42,0)
 .S @RESULTS@(0)="-1^Error in RPC: MDK UTILITIES at "_OPTION_U_$T(+0)
"RTN","MDKUTL",43,0)
 D @OPTION S:'$D(@RESULTS) @RESULTS@(0)="-1^No return"
"RTN","MDKUTL",44,0)
 D CLEAN^DILF
"RTN","MDKUTL",45,0)
 Q
"RTN","MDKUTL",46,0)
 ;
"RTN","MDKUTL",47,0)
ESIG ; [Procedure] Verify users electronic signature
"RTN","MDKUTL",48,0)
 I $G(P1)="" D  Q
"RTN","MDKUTL",49,0)
 .S @RESULTS@(0)="-1^Must supply electronic signature code"
"RTN","MDKUTL",50,0)
 S X=$$DECRYP^XUSRB1(P1)
"RTN","MDKUTL",51,0)
 D HASH^XUSHSHP
"RTN","MDKUTL",52,0)
 I X'=$$GET1^DIQ(200,DUZ_",",20.4,"I") S @RESULTS@(0)="-1^E-Sig Invalid^"
"RTN","MDKUTL",53,0)
 E  S @RESULTS@(0)="1^E-Sig Verifed^"_X
"RTN","MDKUTL",54,0)
 Q
"RTN","MDKUTL",55,0)
 ;
"RTN","MDKUTL",56,0)
LOCK ; [Procedure] Lock a record
"RTN","MDKUTL",57,0)
 L @("+"_$$ROOT^DILFD(P1)_(+P2)_"):2")
"RTN","MDKUTL",58,0)
 I '$T S @RESULTS@(0)="-1^Lock *NOT* acquired" Q
"RTN","MDKUTL",59,0)
 E  S @RESULTS@(0)="1^Lock acquired"
"RTN","MDKUTL",60,0)
 Q
"RTN","MDKUTL",61,0)
 ;
"RTN","MDKUTL",62,0)
UNLOCK ; [Procedure] Unlock a record
"RTN","MDKUTL",63,0)
 L @("-"_$$ROOT^DILFD(P1)_(+P2)_")")
"RTN","MDKUTL",64,0)
 S @RESULTS@(0)="1^Lock released"
"RTN","MDKUTL",65,0)
 Q
"RTN","MDKUTL",66,0)
 ;
"RTN","MDPOST14")
0^^B424736^n/a
"RTN","MDPOST14",1,0)
MDPOST14 ;HOIFO/NCA-CREATE ASD Cross Reference ;8:34 AM  9 Jun 2005
"RTN","MDPOST14",2,0)
 ;;1.0;CLINICAL PROCEDURES;**14**;Apr 01, 2004;Build 20
"RTN","MDPOST14",3,0)
 N MDERR,MDLP,MDVSTD,MDV,MDX
"RTN","MDPOST14",4,0)
 Q:$D(^MDD(702,"ASD"))
"RTN","MDPOST14",5,0)
 D MES^XPDUTL("MDPOST-Create Cross Reference for Scheduled Date/Time...")
"RTN","MDPOST14",6,0)
 K DIK S DIK="^MDD(702,",DIK(1)=".14^ASD" D ENALL^DIK
"RTN","MDPOST14",7,0)
 K DIK
"RTN","MDPOST14",8,0)
 Q
"RTN","MDWCHK")
0^7^B15776924^n/a
"RTN","MDWCHK",1,0)
MDWCHK ; HOIFO/NCA - Create CP Studies for Existing Procedures ;12/13/07  15:52
"RTN","MDWCHK",2,0)
 ;;1.0;CLINICAL PROCEDURES;**14**;Apr 01,2004;Build 20
"RTN","MDWCHK",3,0)
 ; Reference IA #10103 [Supported] XLFDT call
"RTN","MDWCHK",4,0)
 ;               10035 [Supported] Access DPT file (#2)
"RTN","MDWCHK",5,0)
 ;               10061 [Supported] VADPT call
"RTN","MDWCHK",6,0)
 ;               5062  [Private] Use of GMR(123,"ACP"
"RTN","MDWCHK",7,0)
 ;
"RTN","MDWCHK",8,0)
START ; Convert procedure to procedures.
"RTN","MDWCHK",9,0)
 N MDAP,MDCPR,MDFD,MDFDA,MDFLG,MDFR,MDHEMO,MDHL7,MDHOLD,MDIEN,MDIENS,MDINST,MDJ1,MDL,MDLP,MDMAXD,MDNDT,MDNOW,MDNVS,MDP,MDST,MDX,MDY
"RTN","MDWCHK",10,0)
 Q:$G(MDCP)=""
"RTN","MDWCHK",11,0)
 Q:$G(MDUSR)=""
"RTN","MDWCHK",12,0)
 N MDY,X,Y,MDIEN,MDINST K ^TMP("MDPAT",$J) S MDMAXD=DT+.24,MDP=MDCP,MDFLG=0,MDAP=""
"RTN","MDWCHK",13,0)
 S MDY=+$G(MDSAP)
"RTN","MDWCHK",14,0)
 S MDL="" F  S MDL=$O(^GMR(123,"ACP",MDP,MDL)) Q:MDL<1  S MDJ1=0 F  S MDJ1=$O(^GMR(123,"ACP",MDP,MDL,MDJ1)) Q:MDJ1<1  D
"RTN","MDWCHK",15,0)
 .Q:$D(^TMP("MDPAT",$J,MDL))
"RTN","MDWCHK",16,0)
 .S MDFD=$O(^MDD(702,"ACON",+MDJ1,0)) Q:+MDFD>0
"RTN","MDWCHK",17,0)
 .S MDST=$$GET1^DIQ(123,+MDJ1_",",8,"E")
"RTN","MDWCHK",18,0)
 .Q:MDST'["PENDING"&(MDST'["ACTIVE")&(MDST'["SCHEDULED")
"RTN","MDWCHK",19,0)
 .S ^TMP("MDPAT",$J,MDL)="",MDAP=""
"RTN","MDWCHK",20,0)
 .S:'MDY MDAP=$$NOW^XLFDT()_"^"_$P($G(^MDS(702.01,+MDP,0)),"^",5)
"RTN","MDWCHK",21,0)
 .I $G(^DPT(MDL,.1))'=""&(MDY=1) S MDAP=$$NOW^XLFDT()_"^"_$P($G(^MDS(702.01,+MDP,0)),"^",5) Q:$P($G(^MDS(702.01,+MDP,0)),"^",5)=""
"RTN","MDWCHK",22,0)
 .I $G(^DPT(MDL,.1))=""&(MDY=2) S MDAP=$$NOW^XLFDT()_"^"_$P($G(^MDS(702.01,+MDP,0)),"^",5) Q:$P($G(^MDS(702.01,+MDP,0)),"^",5)=""
"RTN","MDWCHK",23,0)
 .I MDAP=""&(+$G(MDCL)>0) S MDAP=$$GETAPPT(MDL,MDCL)
"RTN","MDWCHK",24,0)
 .Q:'+MDAP
"RTN","MDWCHK",25,0)
 .S MDHEMO=$P($G(^MDS(702.01,+MDCP,0)),"^",6)
"RTN","MDWCHK",26,0)
 .S MDNDT=$S($P(MDAP,"^",1)="":$$NOW^XLFDT(),1:$P(MDAP,"^",1))
"RTN","MDWCHK",27,0)
 .S MDNVS=$S($P(MDAP,"^",1)="":$$NOW^XLFDT(),1:"A;"_$P(MDAP,"^",1)_";"_$P(MDAP,"^",2))
"RTN","MDWCHK",28,0)
 .I $E(MDAP,1)="A" Q:$P(MDAP,";",3)=""
"RTN","MDWCHK",29,0)
 .K MDFDA,MDIEN
"RTN","MDWCHK",30,0)
 .S MDFDA(702,"+1,",.01)=MDL
"RTN","MDWCHK",31,0)
 .S MDFDA(702,"+1,",.02)=$$NOW^XLFDT()
"RTN","MDWCHK",32,0)
 .S MDFDA(702,"+1,",.03)=MDUSR
"RTN","MDWCHK",33,0)
 .S MDFDA(702,"+1,",.04)=MDCP
"RTN","MDWCHK",34,0)
 .S MDFDA(702,"+1,",.05)=MDJ1
"RTN","MDWCHK",35,0)
 .S MDFDA(702,"+1,",.07)=MDNVS
"RTN","MDWCHK",36,0)
 .S MDINST=+$$GINST^MDWORSR(MDCP) Q:'MDINST
"RTN","MDWCHK",37,0)
 .S:MDNDT>MDMAXD MDFDA(702,"+1,",.09)=0
"RTN","MDWCHK",38,0)
 .S MDFDA(702,"+1,",.11)=+MDINST
"RTN","MDWCHK",39,0)
 .S MDFDA(702,"+1,",.14)=MDNDT
"RTN","MDWCHK",40,0)
 .D UPDATE^DIE("","MDFDA","MDIEN","MDERR") K MDFDA
"RTN","MDWCHK",41,0)
 .Q:MDNDT>MDMAXD
"RTN","MDWCHK",42,0)
 .S MDIENS=MDIEN(1)_"," I +MDHEMO=2 S MDHOLD=$P($G(^MDD(702,MDIEN(1),0)),"^",7),MDNOW=$$NOW^XLFDT(),$P(^MDD(702,MDIEN(1),0),"^",7)=$S(MDNOW>MDNDT:MDNDT,1:MDNOW)
"RTN","MDWCHK",43,0)
 .S MDHL7=$$SUB^MDHL7B(MDIEN(1))
"RTN","MDWCHK",44,0)
 .I +MDHL7=-1 S MDFDA(702,MDIENS,.09)=2,MDFDA(702,MDIENS,.08)=$P(MDHL7,U,2)
"RTN","MDWCHK",45,0)
 .I +MDHL7=1 S MDFDA(702,MDIENS,.09)=5,MDFDA(702,MDIENS,.08)=""
"RTN","MDWCHK",46,0)
 .D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR")
"RTN","MDWCHK",47,0)
 .Q:'+$G(MDIENS)
"RTN","MDWCHK",48,0)
 .I MDHEMO=2 D CP^MDKUTL(+MDIENS) K MDFDA S:$G(MDHOLD)'="" MDFDA(702,+MDIENS_",",.07)=MDHOLD S MDFDA(702,+MDIENS_",",.09)=5 D FILE^DIE("","MDFDA","MDERR")
"RTN","MDWCHK",49,0)
 .Q
"RTN","MDWCHK",50,0)
 K ^TMP("MDPAT",$J)
"RTN","MDWCHK",51,0)
 Q
"RTN","MDWCHK",52,0)
GETAPPT(MDPAT,MDDA) ; Get appointment
"RTN","MDWCHK",53,0)
 N DFN,MDALP,MDARES K ^UTILITY("VASD",$J) S DFN=MDPAT
"RTN","MDWCHK",54,0)
 S X1=DT,X2=365 D C^%DTC S VASD("T")=X+.24,VASD("F")=DT,VASD("W")="129",VASD("C",+MDDA)=+MDDA D SDA^VADPT
"RTN","MDWCHK",55,0)
 S MDARES=0 F MDALP=0:0 S MDALP=$O(^UTILITY("VASD",$J,MDALP)) Q:MDALP<1  S MDARES=$G(^(MDALP,"I")) Q
"RTN","MDWCHK",56,0)
 K ^UTILITY("VASD",$J),VASD,X1,X2,X
"RTN","MDWCHK",57,0)
 Q MDARES
"RTN","MDWCHK",58,0)
CHELP ; Help Message for the Schedule Appointment prompt
"RTN","MDWCHK",59,0)
 W !!,"REQUIRED field for the procedure to have auto CP study check-in."
"RTN","MDWCHK",60,0)
 W !,"Enter a ""^"" will exit completely."
"RTN","MDWCHK",61,0)
 W !!,"Enter 0 if you do not schedule appointments."
"RTN","MDWCHK",62,0)
 W !,"      1 if you only schedule appointments for outpatients."
"RTN","MDWCHK",63,0)
 W !,"      2 if you only schedule appointments for inpatients."
"RTN","MDWCHK",64,0)
 W !,"      3 if you schedule appointments for both 1 and 2."
"RTN","MDWCHK",65,0)
 Q
"RTN","MDWCHK",66,0)
PHELP ; Help Message for Procedure prompt
"RTN","MDWCHK",67,0)
 W !,"Enter a CP Definition for the procedure to"
"RTN","MDWCHK",68,0)
 W !,"have auto CP study check-in.",!
"RTN","MDWCHK",69,0)
 K MDLST D GETLST^XPAR(.MDLST,"SYS","MD CHECK-IN PROCEDURE LIST")
"RTN","MDWCHK",70,0)
 F MDLP=0:0 S MDLP=$O(MDLST(MDLP)) Q:MDLP<1  I +$G(MDLST(MDLP)) W !,$P($G(^MDS(702.01,+MDLST(MDLP),0)),"^",1)
"RTN","MDWCHK",71,0)
 K MDLST
"RTN","MDWCHK",72,0)
 Q
"RTN","MDWOR")
0^1^B34141861^n/a
"RTN","MDWOR",1,0)
MDWOR ; HOIFO/NCA - Main Routine to Decode HL7 ;5/23/07  10:49
"RTN","MDWOR",2,0)
 ;;1.0;CLINICAL PROCEDURES;**14**;Apr 01,2004;Build 20
"RTN","MDWOR",3,0)
 ; Reference IA# 2263 [Supported] XPAR calls
"RTN","MDWOR",4,0)
 ;               3071 [Subscription] Call $$PKGID^ORX8.
"RTN","MDWOR",5,0)
 ;               3468 [Subscription] Call GMRCCP.
"RTN","MDWOR",6,0)
 ;               10035 [Supported] Access Patient file DPT
"RTN","MDWOR",7,0)
 ;               10040 [Supported] Hospital Location File SC
"RTN","MDWOR",8,0)
 ;               10103 [Supported] XLFDT calls
"RTN","MDWOR",9,0)
 ;
"RTN","MDWOR",10,0)
EN(MDMSG) ; Entry Point for CPRS and pass MSG in MDMSG
"RTN","MDWOR",11,0)
 N DFN,MDCON,MDCPROC,MDCANC,MDCANR,MDIFN,MDINST,MDINT,MDFLG,MDL,MDIN,MDINP,MDINST,MDLOC,MDNAM,MDOBC,MDOBX,MDOPRO,MDPROC,MDPAT
"RTN","MDWOR",12,0)
 N MDPROV,MDREQ,MDQTIM,MDSINP,MDVSTD,MDX S MDVSTD=""
"RTN","MDWOR",13,0)
 S (MDINP,MDFLG,MDCANC,MDOBC)=0 F MDL=0:0 S MDL=$O(MDMSG(MDL)) Q:MDL<1!(MDFLG)  S MDX=$G(MDMSG(MDL)) D
"RTN","MDWOR",14,0)
 .I $E(MDX,1,3)="MSH" D MSH Q
"RTN","MDWOR",15,0)
 .I $E(MDX,1,3)="PID" D PID Q
"RTN","MDWOR",16,0)
 .I $E(MDX,1,3)="PV1" D PV1 Q
"RTN","MDWOR",17,0)
 .I $E(MDX,1,3)="ORC" D ORC Q
"RTN","MDWOR",18,0)
 .I $E(MDX,1,3)="OBR" D OBR Q
"RTN","MDWOR",19,0)
 .I $E(MDX,1,3)="OBX" D:MDOBC<1 OBX Q
"RTN","MDWOR",20,0)
 .Q
"RTN","MDWOR",21,0)
 I 'MDFLG,'MDCANC S MDATA="+1,^"_MDPROC_"^"_+MDCON_"^"_MDINST_"^"_MDVSTD D CHKIN(MDFN,MDREQ,MDPROV,MDATA,MDVSTD)
"RTN","MDWOR",22,0)
 Q
"RTN","MDWOR",23,0)
MSH ; Decode MSH
"RTN","MDWOR",24,0)
 I $P(MDX,"|",2)'="^~\&" S MDFLG=1 Q
"RTN","MDWOR",25,0)
 I $P(MDX,"|",3)'="ORDER ENTRY" S MDFLG=1 Q
"RTN","MDWOR",26,0)
 I $P(MDX,"|",9)'="ORM" S MDFLG=1 Q
"RTN","MDWOR",27,0)
 Q
"RTN","MDWOR",28,0)
PID ; Check PID
"RTN","MDWOR",29,0)
 S MDNAM=$P(MDX,"|",6),DFN=$P(MDX,"|",4)
"RTN","MDWOR",30,0)
 I '$D(^DPT("B",$E(MDNAM,1,30),DFN)) S MDFLG=1
"RTN","MDWOR",31,0)
 S MDFN=DFN
"RTN","MDWOR",32,0)
 Q
"RTN","MDWOR",33,0)
PV1 ; Check PV1
"RTN","MDWOR",34,0)
 S MDPAT=$P(MDX,"|",3) I MDPAT'?1U!("IO"'[MDPAT) S MDFLG=1 Q
"RTN","MDWOR",35,0)
 I MDPAT="I" S MDINP=1
"RTN","MDWOR",36,0)
 S MDLOC=+$P(MDX,"|",4) I $G(^SC(MDLOC,0))="" S MDFLG=1 Q
"RTN","MDWOR",37,0)
 S:MDINP>0 MDLOC=""
"RTN","MDWOR",38,0)
 Q
"RTN","MDWOR",39,0)
ORC ; Check ORC
"RTN","MDWOR",40,0)
 I $P(MDX,"|",2)="NW" D NEW Q
"RTN","MDWOR",41,0)
 I $P(MDX,"|",2)="DC" D CANCEL Q
"RTN","MDWOR",42,0)
 S MDFLG=1
"RTN","MDWOR",43,0)
 Q
"RTN","MDWOR",44,0)
OBX ; Check OBX
"RTN","MDWOR",45,0)
 N %,ANSWER,MDCV,MDOBX
"RTN","MDWOR",46,0)
 S MDOBX=$P(MDX,"|",6)
"RTN","MDWOR",47,0)
 I '+$$GET^XPAR("SYS","MD USE APPT WITH PROCEDURE",1) S MDOBC=MDOBC+1 Q
"RTN","MDWOR",48,0)
 S MDVSTD=$P(MDOBX,"Visit Date: ",2)
"RTN","MDWOR",49,0)
 S MDCV=$P(MDVSTD," ",1,2)
"RTN","MDWOR",50,0)
 I MDCV=""!(MDCV["UNKNOWN") S MDFLG=1 Q
"RTN","MDWOR",51,0)
 S MDVSTD=$P(MDCV," ")_"@"_$P(MDCV," ",2)
"RTN","MDWOR",52,0)
 D DT^DILF("T",MDVSTD,.ANSWER)
"RTN","MDWOR",53,0)
 S:ANSWER<0 ANSWER=""
"RTN","MDWOR",54,0)
 S MDVSTD=ANSWER I MDVSTD="" S MDFLG=1 Q
"RTN","MDWOR",55,0)
 I +MDLOC>0 S MDVSTD="A;"_MDVSTD_";"_MDLOC
"RTN","MDWOR",56,0)
 E  D NOW^%DTC S MDVSTD=%
"RTN","MDWOR",57,0)
 S MDOBC=MDOBC+1
"RTN","MDWOR",58,0)
 Q
"RTN","MDWOR",59,0)
NEW ; New Order Segment
"RTN","MDWOR",60,0)
 S MDIFN=+$P(MDX,"|",3) I 'MDIFN S MDFLG=1 Q
"RTN","MDWOR",61,0)
 S MDPROV=+$P(MDX,"|",11) I 'MDPROV S MDFLG=1 Q
"RTN","MDWOR",62,0)
 S MDQTIM=$P(MDX,"|",8),MDQTIM=$P(MDQTIM,"^",6)
"RTN","MDWOR",63,0)
 S MDREQ=$P(MDX,"|",16) S MDREQ=$$FMDTE(MDREQ) I 'MDREQ S MDFLG=1 Q
"RTN","MDWOR",64,0)
 S MDREQ=$S(MDQTIM="Z24":$$FMADD^XLFDT(MDREQ,0,24),MDQTIM="Z48":$$FMADD^XLFDT(MDREQ,0,48),MDQTIM="Z72":$$FMADD^XLFDT(MDREQ,0,72),MDQTIM="ZW":$$FMADD^XLFDT(MDREQ,7),MDQTIM="ZM":$$FMADD^XLFDT(MDREQ,30),1:MDREQ)
"RTN","MDWOR",65,0)
 ; Retrieve Consult Number
"RTN","MDWOR",66,0)
 N MDFDA
"RTN","MDWOR",67,0)
 S MDCON=$$PKGID^ORX8(MDIFN) I 'MDCON S MDFLG=1 Q
"RTN","MDWOR",68,0)
 Q
"RTN","MDWOR",69,0)
OBR ; Check OBR
"RTN","MDWOR",70,0)
 S MDPROC=$P(MDX,"|",5)
"RTN","MDWOR",71,0)
 I $E($P(MDPROC,"^",6),3,5)'["PRC" S MDFLG=1 Q
"RTN","MDWOR",72,0)
 S MDCPROC=$P(MDPROC,"^",4) I 'MDCPROC S MDFLG=1 Q
"RTN","MDWOR",73,0)
 ; Get Procedure for CP IEN
"RTN","MDWOR",74,0)
 S MDPROC=$$CPROC^GMRCCP(MDCPROC) I 'MDPROC S MDFLG=1 Q
"RTN","MDWOR",75,0)
 S MDSINP=$$HIGHV(MDPROC) I '+MDSINP S MDFLG=1 Q
"RTN","MDWOR",76,0)
 S (MDINST,MDINT)=0 F MDIN=0:0 S MDIN=$O(^MDS(702.01,MDPROC,.1,MDIN)) Q:MDIN<1!(+MDINST)  S MDINT=+$G(^(MDIN,0)) D
"RTN","MDWOR",77,0)
 .I +$$GET1^DIQ(702.09,+MDINT,".13","I") S MDINST=MDINT Q
"RTN","MDWOR",78,0)
 I +$P(MDSINP,"^",2)=2 D  Q
"RTN","MDWOR",79,0)
 .I +MDINP S MDVSTD="",MDOBC=MDOBC+1 Q
"RTN","MDWOR",80,0)
 .S MDVSTD=MDREQ,MDOBC=MDOBC+1 Q
"RTN","MDWOR",81,0)
 I +$P(MDSINP,"^",2)=3 D  Q
"RTN","MDWOR",82,0)
 .I +MDINP S MDVSTD="",MDOBC=MDOBC+1 Q
"RTN","MDWOR",83,0)
 I +$P(MDSINP,"^",2)=1 D  Q
"RTN","MDWOR",84,0)
 .I '+MDINP S MDVSTD="" Q
"RTN","MDWOR",85,0)
 .S MDVSTD=MDREQ,MDOBC=MDOBC+1 Q
"RTN","MDWOR",86,0)
 I +MDINP&('$P(^MDS(702.01,MDPROC,0),"^",5)) S MDFLG=1 Q
"RTN","MDWOR",87,0)
 I +MDINP S MDVSTD=MDREQ,MDOBC=MDOBC+1 Q
"RTN","MDWOR",88,0)
 S MDVSTD=MDREQ,MDOBC=MDOBC+1 Q
"RTN","MDWOR",89,0)
 Q
"RTN","MDWOR",90,0)
CANCEL ; Cancel/Discontinue
"RTN","MDWOR",91,0)
 K MDR S MDIFN=+$P(MDX,"|",3),MDCON=+$P(MDX,"|",4),MDCANC=1
"RTN","MDWOR",92,0)
 I 'MDIFN S MDFLG=1 Q
"RTN","MDWOR",93,0)
 I 'MDCON S MDFLG=1 Q
"RTN","MDWOR",94,0)
 S MDPROV=+$P(MDX,"|",13) I 'MDPROV S MDFLG=1 Q
"RTN","MDWOR",95,0)
 S MDREQ=$P(MDX,"|",16) I 'MDREQ S MDFLG=1 Q
"RTN","MDWOR",96,0)
 S MDINST=$O(^MDD(702,"ACON",MDCON,0)) Q:'MDINST
"RTN","MDWOR",97,0)
 Q:$G(^MDD(702,+MDINST,0))=""
"RTN","MDWOR",98,0)
 I "5"[$P(^MDD(702,+MDINST,0),U,9) S MDCANR=$$CANCEL^MDHL7B(+MDINST)
"RTN","MDWOR",99,0)
 N MDFDA S MDFDA(702,MDINST_",",.09)=6
"RTN","MDWOR",100,0)
 D FILE^DIE("K","MDFDA") K MDFDA
"RTN","MDWOR",101,0)
 N MDHEMO S MDHEMO=+$$GET1^DIQ(702,+MDINST,".04:.06","I")
"RTN","MDWOR",102,0)
 Q:MDHEMO<2
"RTN","MDWOR",103,0)
 Q:$G(^MDK(704.202,+MDINST,0))=""
"RTN","MDWOR",104,0)
 S MDFDA(704.202,+MDINST_",",.09)=0
"RTN","MDWOR",105,0)
 D FILE^DIE("","MDFDA")
"RTN","MDWOR",106,0)
 K ^MDK(704.202,"AS",1,+MDINST)
"RTN","MDWOR",107,0)
 S ^MDK(704.202,"AS",0,+MDINST)=""
"RTN","MDWOR",108,0)
 Q
"RTN","MDWOR",109,0)
CHKIN(MDFN,MDREQ,MDPROV,MDATA,MDVSTD) ; [Procedure] Check In Study
"RTN","MDWOR",110,0)
 N MDX1,MDFDA,MDIEN,MDIENS,MDERR,MDHL7,MDHOLD,MDSCHD,MDMAXD,MDXY,MDNOW
"RTN","MDWOR",111,0)
 F MDX1=2:1:5 D
"RTN","MDWOR",112,0)
 .I $P(MDATA,U,MDX1)]"" S MDFDA(702,$P(MDATA,U,1),$P("^.04^.05^.11^.07",U,MDX1))=$P(MDATA,U,MDX1)
"RTN","MDWOR",113,0)
 ; Remove code after instrument testing available
"RTN","MDWOR",114,0)
 ; End of code removal after instrument available for testin
"RTN","MDWOR",115,0)
 S MDSCHD=$S($L(MDVSTD,";")=1:MDVSTD,1:$P(MDVSTD,";",2)),MDMAXD=DT+.24
"RTN","MDWOR",116,0)
 S MDFDA(702,$P(MDATA,U,1),.09)=$S(MDSCHD="":0,MDSCHD>MDMAXD:0,1:5)  ; Status = Checked-In
"RTN","MDWOR",117,0)
 I $P(MDATA,U,1)="+1," D
"RTN","MDWOR",118,0)
 .S MDFDA(702,"+1,",.01)=MDFN
"RTN","MDWOR",119,0)
 .S MDFDA(702,"+1,",.02)=$$NOW^XLFDT()
"RTN","MDWOR",120,0)
 .S MDFDA(702,"+1,",.03)=MDPROV
"RTN","MDWOR",121,0)
 .S:+MDSCHD MDFDA(702,"+1,",.14)=MDSCHD
"RTN","MDWOR",122,0)
 .D UPDATE^DIE("","MDFDA","MDIEN","MDERR") Q:$D(MDERR)
"RTN","MDWOR",123,0)
 .Q:MDSCHD>MDMAXD!(MDSCHD="")
"RTN","MDWOR",124,0)
 .S MDIENS=MDIEN(1)_",",MDXY=+$P(MDATA,U,2),MDHOLD="" I +MDXY D
"RTN","MDWOR",125,0)
 ..Q:$P(^MDS(702.01,MDXY,0),U,6)'=2
"RTN","MDWOR",126,0)
 ..S MDHOLD=$P($G(^MDD(702,MDIEN(1),0)),"^",7),MDNOW=$$NOW^XLFDT()
"RTN","MDWOR",127,0)
 ..S $P(^MDD(702,MDIEN(1),0),"^",7)=$S(MDNOW>MDSCHD:MDSCHD,1:MDNOW)
"RTN","MDWOR",128,0)
 .S MDHL7=$$SUB^MDHL7B(MDIEN(1))
"RTN","MDWOR",129,0)
 .I +MDHL7=-1 S MDFDA(702,MDIENS,.09)=2,MDFDA(702,MDIENS,.08)=$P(MDHL7,U,2)
"RTN","MDWOR",130,0)
 .I +MDHL7=1 S MDFDA(702,MDIENS,.09)=5,MDFDA(702,MDIENS,.08)=""
"RTN","MDWOR",131,0)
 .D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR")
"RTN","MDWOR",132,0)
 Q:MDSCHD>MDMAXD!(MDSCHD="")
"RTN","MDWOR",133,0)
 D:+$G(MDIENS)
"RTN","MDWOR",134,0)
 .S MDXY=+$P(MDATA,U,2) Q:'MDXY
"RTN","MDWOR",135,0)
 .I $P(^MDS(702.01,MDXY,0),U,6)=2 D  Q  ; Renal Check-In
"RTN","MDWOR",136,0)
 ..D CP^MDKUTL(+MDIENS)
"RTN","MDWOR",137,0)
 ..S:$G(MDHOLD)'="" MDFDA(702,+MDIENS_",",.07)=MDHOLD
"RTN","MDWOR",138,0)
 ..S MDFDA(702,+MDIENS_",",.09)=5
"RTN","MDWOR",139,0)
 ..D FILE^DIE("","MDFDA","MDERR")
"RTN","MDWOR",140,0)
 Q
"RTN","MDWOR",141,0)
FMDTE(DATE) ; Convert HL-7 formatted date to a Fileman formatted date
"RTN","MDWOR",142,0)
 N X
"RTN","MDWOR",143,0)
 S X="" I DATE D
"RTN","MDWOR",144,0)
 .S X=$$HL7TFM^XLFDT(DATE,"L")
"RTN","MDWOR",145,0)
 Q X
"RTN","MDWOR",146,0)
HIGHV(MDHV) ; Return flag indicator whether procedure is use for auto check-in
"RTN","MDWOR",147,0)
 N MDANS,MDK,MDKY,MDLST S MDANS=0
"RTN","MDWOR",148,0)
 D GETLST^XPAR(.MDLST,"SYS","MD CHECK-IN PROCEDURE LIST")
"RTN","MDWOR",149,0)
 F MDK=0:0 S MDK=$O(MDLST(MDK)) Q:MDK<1  S MDKY=$G(MDLST(MDK)) D
"RTN","MDWOR",150,0)
 .I MDHV=+$P(MDKY,"^") S MDANS=MDKY
"RTN","MDWOR",151,0)
 Q MDANS
"RTN","MDWORC")
0^2^B13681232^n/a
"RTN","MDWORC",1,0)
MDWORC ; HOIFO/NCA - Main Routine to Decode HL7 from Consult ;1/8/08  15:00
"RTN","MDWORC",2,0)
 ;;1.0;CLINICAL PROCEDURES;**14**;Apr 01,2004;Build 20
"RTN","MDWORC",3,0)
 ; Reference IA #10035 [Supported] Access Patient file DPT
"RTN","MDWORC",4,0)
 ;               10040 [Supported] Hospital Location File SC
"RTN","MDWORC",5,0)
 ;               10103 [Supported] XLFDT calls
"RTN","MDWORC",6,0)
EN(MDMSG) ; Entry Point for Consult and pass MSG in MDMSG
"RTN","MDWORC",7,0)
 N DFN,MDCON,MDCPROC,MDCANC,MDCANR,MDFN,MDIFN,MDINST,MDFLG,MDL,MDLOC,MDNAM,MDPROC,MDPAT,MDPROV,MDREQ,MDX
"RTN","MDWORC",8,0)
 S (MDFLG,MDCANC)=0 F MDL=0:0 S MDL=$O(MDMSG(MDL)) Q:MDL<1!(MDFLG)  S MDX=$G(MDMSG(MDL)) D
"RTN","MDWORC",9,0)
 .I $E(MDX,1,3)="MSH" D MSH Q
"RTN","MDWORC",10,0)
 .I $E(MDX,1,3)="PID" D PID Q
"RTN","MDWORC",11,0)
 .I $E(MDX,1,3)="PV1" D PV1 Q
"RTN","MDWORC",12,0)
 .I $E(MDX,1,3)="ORC" D ORC Q
"RTN","MDWORC",13,0)
 .I $E(MDX,1,3)="NTE" Q
"RTN","MDWORC",14,0)
 .Q
"RTN","MDWORC",15,0)
 Q
"RTN","MDWORC",16,0)
MSH ; Decode MSH
"RTN","MDWORC",17,0)
 I $P(MDX,"|",2)'="^~\&" S MDFLG=1 Q
"RTN","MDWORC",18,0)
 I $P(MDX,"|",3)'="CONSULTS" S MDFLG=1 Q
"RTN","MDWORC",19,0)
 I $P(MDX,"|",9)'="ORM" S MDFLG=1 Q
"RTN","MDWORC",20,0)
 Q
"RTN","MDWORC",21,0)
PID ; Check PID
"RTN","MDWORC",22,0)
 S MDNAM=$P(MDX,"|",6),DFN=$P(MDX,"|",4)
"RTN","MDWORC",23,0)
 I '$D(^DPT("B",$E(MDNAM,1,30),DFN)) S MDFLG=1
"RTN","MDWORC",24,0)
 S MDFN=DFN
"RTN","MDWORC",25,0)
 Q
"RTN","MDWORC",26,0)
PV1 ; Check PV1
"RTN","MDWORC",27,0)
 S MDPAT=$P(MDX,"|",3) I MDPAT'?1U!("IO"'[MDPAT) S MDFLG=1 Q
"RTN","MDWORC",28,0)
 S MDLOC=+$P(MDX,"|",4) I $G(^SC(MDLOC,0))="" S MDFLG=1 Q
"RTN","MDWORC",29,0)
 Q
"RTN","MDWORC",30,0)
ORC ; Check ORC
"RTN","MDWORC",31,0)
 I $P(MDX,"|",2)'="OD",($P(MDX,"|",2)'="OC"),($P(MDX,"|",2)'="XX") Q
"RTN","MDWORC",32,0)
 I $P(MDX,"|",2)="XX" D RESUBM
"RTN","MDWORC",33,0)
 D CANCEL
"RTN","MDWORC",34,0)
 Q
"RTN","MDWORC",35,0)
CANCEL ; Cancel/Discontinue
"RTN","MDWORC",36,0)
 K MDR S MDIFN=+$P(MDX,"|",3),MDCON=+$P(MDX,"|",4)
"RTN","MDWORC",37,0)
 I 'MDIFN S MDFLG=1 Q
"RTN","MDWORC",38,0)
 I 'MDCON S MDFLG=1 Q
"RTN","MDWORC",39,0)
 I $P(MDX,"|",6)'="CA",($P(MDX,"|",6)'="DC") Q
"RTN","MDWORC",40,0)
 S MDPROV=+$P(MDX,"|",13) I 'MDPROV S MDFLG=1 Q
"RTN","MDWORC",41,0)
 S MDREQ=$P(MDX,"|",16) I 'MDREQ S MDFLG=1 Q
"RTN","MDWORC",42,0)
 S MDINST=$O(^MDD(702,"ACON",MDCON,0)) Q:'MDINST
"RTN","MDWORC",43,0)
 Q:$G(^MDD(702,+MDINST,0))=""
"RTN","MDWORC",44,0)
 I "5"[$P(^MDD(702,+MDINST,0),U,9) S MDCANR=$$CANCEL^MDHL7B(+MDINST)
"RTN","MDWORC",45,0)
 N MDFDA S MDFDA(702,+MDINST_",",.09)=6,MDCANC=1
"RTN","MDWORC",46,0)
 D FILE^DIE("K","MDFDA") K MDFDA
"RTN","MDWORC",47,0)
 N MDHEMO S MDHEMO=+$$GET1^DIQ(702,+MDINST,".04:.06","I")
"RTN","MDWORC",48,0)
 Q:MDHEMO<2
"RTN","MDWORC",49,0)
 Q:$G(^MDK(704.202,+MDINST,0))=""
"RTN","MDWORC",50,0)
 S MDFDA(704.202,+MDINST_",",.09)=0
"RTN","MDWORC",51,0)
 D FILE^DIE("","MDFDA")
"RTN","MDWORC",52,0)
 K ^MDK(704.202,"AS",1,+MDINST)
"RTN","MDWORC",53,0)
 S ^MDK(704.202,"AS",0,+MDINST)=""
"RTN","MDWORC",54,0)
 Q
"RTN","MDWORC",55,0)
RESUBM ; Resubmit a cancelled order
"RTN","MDWORC",56,0)
 N MDERR,MDHL7,MDHOLD,MDMAXD,MDNOW,MDSCHD,MDVSTD,MDXY
"RTN","MDWORC",57,0)
 Q:$P(MDX,"|",2)'="XX"
"RTN","MDWORC",58,0)
 K MDR S MDIFN=+$P(MDX,"|",3),MDCON=+$P(MDX,"|",4)
"RTN","MDWORC",59,0)
 I 'MDIFN S MDFLG=1 Q
"RTN","MDWORC",60,0)
 I 'MDCON S MDFLG=1 Q
"RTN","MDWORC",61,0)
 S MDPROV=+$P(MDX,"|",11) I 'MDPROV S MDFLG=1 Q
"RTN","MDWORC",62,0)
 S MDREQ=$P(MDX,"|",16) S:MDREQ MDREQ=$$FMDTE^MDWOR(MDREQ) I 'MDREQ S MDFLG=1 Q
"RTN","MDWORC",63,0)
 S MDINST=$O(^MDD(702,"ACON",MDCON,0)) Q:'MDINST
"RTN","MDWORC",64,0)
 S MDVSTD=$P($G(^MDD(702,MDINST,0)),"^",7)
"RTN","MDWORC",65,0)
 S MDSCHD=$S($L(MDVSTD,";")=1:MDVSTD,1:$P(MDVSTD,";",2)),MDMAXD=DT+.24
"RTN","MDWORC",66,0)
 Q:$$GET1^DIQ(702,MDINST_",",.09,"I")'=6
"RTN","MDWORC",67,0)
 N MDFDA,MDIENS,MDERR
"RTN","MDWORC",68,0)
 S MDFDA(702,MDINST_",",.07)=MDVSTD
"RTN","MDWORC",69,0)
 S MDFDA(702,MDINST_",",.09)=$S(MDSCHD>MDMAXD:0,1:5)
"RTN","MDWORC",70,0)
 D FILE^DIE("K","MDFDA") S MDHOLD="" K MDFDA
"RTN","MDWORC",71,0)
 Q:MDSCHD>MDMAXD
"RTN","MDWORC",72,0)
 S MDXY=$P(^MDD(702,MDINST,0),"^",4)
"RTN","MDWORC",73,0)
 I $P($G(^MDS(702.01,+MDXY,0)),"^",6)=2 S MDHOLD=$P(^MDD(702,MDINST,0),"^",7),MDNOW=$$NOW^XLFDT(),$P(^MDD(702,MDINST,0),"^",7)=$S(MDNOW>MDSCHD:MDSCHD,1:MDNOW)
"RTN","MDWORC",74,0)
 S MDIENS=MDINST_",",MDHL7=$$SUB^MDHL7B(+MDIENS)
"RTN","MDWORC",75,0)
 I +MDHL7=-1 S MDFDA(702,MDIENS,.09)=2,MDFDA(702,MDIENS,.08)=$P(MDHL7,U,2)
"RTN","MDWORC",76,0)
 I +MDHL7=1 S MDFDA(702,MDIENS,.09)=5,MDFDA(702,MDIENS,.08)=""
"RTN","MDWORC",77,0)
 D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR") K MDFDA,MDERR
"RTN","MDWORC",78,0)
 N MDHEMO S MDHEMO=+$$GET1^DIQ(702,+MDIENS,".04:.06","I")
"RTN","MDWORC",79,0)
 Q:MDHEMO<2
"RTN","MDWORC",80,0)
 S:$G(MDHOLD)'="" $P(^MDD(702,MDINST,0),"^",7)=MDHOLD
"RTN","MDWORC",81,0)
 Q:$G(^MDK(704.202,+MDINST,0))=""
"RTN","MDWORC",82,0)
 S MDFDA(704.202,+MDINST_",",.09)=1
"RTN","MDWORC",83,0)
 D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR") K MDFDA,MDERR
"RTN","MDWORC",84,0)
 K ^MDK(704.202,"AS",0,+MDINST)
"RTN","MDWORC",85,0)
 S ^MDK(704.202,"AS",1,+MDINST)=""
"RTN","MDWORC",86,0)
 Q
"RTN","MDWORSR")
0^3^B40172880^n/a
"RTN","MDWORSR",1,0)
MDWORSR ; HOIFO/NCA - Daily Schedule Studies;7/2/04  12:39 ;5/17/07  16:09
"RTN","MDWORSR",2,0)
 ;;1.0;CLINICAL PROCEDURES;**14**;Apr 01,2004;Build 20
"RTN","MDWORSR",3,0)
 ; Reference IA# 2263 [Supported] XPAR calls
"RTN","MDWORSR",4,0)
 ;               3067 [Private] Read fields in Consult file (#123) w/FM
"RTN","MDWORSR",5,0)
 ;               3468 [Subscription] Call GMRCCP
"RTN","MDWORSR",6,0)
 ;               3869 [Subscription] SDAMA202 calls
"RTN","MDWORSR",7,0)
 ;               10035 [Supported] Patient File Access
"RTN","MDWORSR",8,0)
 ;               10103 [Supported] XLFDT calls
"RTN","MDWORSR",9,0)
 ;
"RTN","MDWORSR",10,0)
EN1 ; Entry Point to process scheduled studies
"RTN","MDWORSR",11,0)
 N MDCON,MDERR,MDFDA,MDHOLD,MDL,MDL1,MDMAXD,MDNOW,MDSTAT,MDX,MDXY
"RTN","MDWORSR",12,0)
 S MDMAXD=DT+.24
"RTN","MDWORSR",13,0)
 S MDL=DT F  S MDL=$O(^MDD(702,"ASD",MDL)) Q:MDL<1!(MDL>MDMAXD)  F MDL1=0:0 S MDL1=$O(^MDD(702,"ASD",MDL,MDL1)) Q:MDL1<1  S MDX=$G(^MDD(702,MDL1,0)) D
"RTN","MDWORSR",14,0)
 .K MDFDA
"RTN","MDWORSR",15,0)
 .S MDCON=+$P(MDX,"^",5) Q:'MDCON
"RTN","MDWORSR",16,0)
 .S MDSTAT=$$GET1^DIQ(123,MDCON_",",8,"E")
"RTN","MDWORSR",17,0)
 .Q:MDSTAT="DISCONTINUED"!(MDSTAT="CANCELLED")
"RTN","MDWORSR",18,0)
 .Q:+$P(MDX,"^",9)>0
"RTN","MDWORSR",19,0)
 .S MDIENS=MDL1_",",MDXY=+$P(MDX,"^",4),MDHOLD="" I MDXY D
"RTN","MDWORSR",20,0)
 ..Q:$P(^MDS(702.01,MDXY,0),U,6)'=2
"RTN","MDWORSR",21,0)
 ..S MDHOLD=$P($G(^MDD(702,+MDL1,0)),"^",7),MDNOW=$$NOW^XLFDT()
"RTN","MDWORSR",22,0)
 ..S $P(^MDD(702,+MDL1,0),"^",7)=$S(MDNOW>MDL:MDL,1:MDNOW)
"RTN","MDWORSR",23,0)
 .S MDHL7=$$SUB^MDHL7B(MDL1)
"RTN","MDWORSR",24,0)
 .I +MDHL7=-1 S MDFDA(702,MDIENS,.09)=2,MDFDA(702,MDIENS,.08)=$P(MDHL7,U,2)
"RTN","MDWORSR",25,0)
 .I +MDHL7=1 S MDFDA(702,MDIENS,.02)=$$NOW^XLFDT(),MDFDA(702,MDIENS,.09)=5,MDFDA(702,MDIENS,.08)=""
"RTN","MDWORSR",26,0)
 .D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR")
"RTN","MDWORSR",27,0)
 .S MDXY=+$P(MDX,"^",4) Q:'MDXY
"RTN","MDWORSR",28,0)
 .I $P(^MDS(702.01,MDXY,0),U,6)=2 D  Q  ; Renal Check-In
"RTN","MDWORSR",29,0)
 ..D CP^MDKUTL(+MDIENS)
"RTN","MDWORSR",30,0)
 ..S:$G(MDHOLD)'="" MDFDA(702,MDIENS,.07)=MDHOLD
"RTN","MDWORSR",31,0)
 ..S MDFDA(702,MDIENS,.09)=5
"RTN","MDWORSR",32,0)
 ..D FILE^DIE("","MDFDA","MDERR")
"RTN","MDWORSR",33,0)
 Q
"RTN","MDWORSR",34,0)
CLINICPT ; Check-in CP study with multiple results
"RTN","MDWORSR",35,0)
 N MD,MDCDT,MDCL,MDCOM,MDCON,MDDT,MDDX,MDEND,MDERR,MDFDA,MDHEMO,MDHL7,MDIEN,MDIENS,MDK,MDLP,MDLST,MDMULT,MDNODE,MDNUM,MDPT,MDRET,MDSCHD,MDVSTR,MDY,MDY1,MDYR,X,X1,X2
"RTN","MDWORSR",36,0)
 N MDHOLD,MDLST1,MDLST2,MDNEW S MDDT=DT\1,MDEND=DT+.24 N MDINP K ^TMP($J,"SDAMA202","GETPLIST"),^TMP("MDSTATUS",$J) S MDCOM=0,MDHOLD=""
"RTN","MDWORSR",37,0)
 S MDNUM=$$GET^XPAR("SYS","MD COMPL PROC DISPLAY DAYS",1)
"RTN","MDWORSR",38,0)
 I +MDNUM>0 S X1=DT,X2=-MDNUM D C^%DTC S MDCOM=X
"RTN","MDWORSR",39,0)
 D GETLST^XPAR(.MDLST,"SYS","MD CLINIC QUICK LIST")
"RTN","MDWORSR",40,0)
 D GETLST^XPAR(.MDLST1,"SYS","MD CLINICS WITH MULT PROC")
"RTN","MDWORSR",41,0)
 F MDLP=0:0 S MDLP=$O(^MDD(702,"AS",0,MDLP)) Q:MDLP<1  D
"RTN","MDWORSR",42,0)
 .S MDY=$G(^MDD(702,MDLP,0)) Q:+$P(MDY,"^",9)>0
"RTN","MDWORSR",43,0)
 .Q:$P(MDY,"^",7)'=""
"RTN","MDWORSR",44,0)
 .Q:'+$P(MDY,"^",5)!($P(MDY,"^",6)'="")
"RTN","MDWORSR",45,0)
 .Q:'+MDY
"RTN","MDWORSR",46,0)
 .I '+$G(^TMP("MDSTATUS",$J,+MDY,+$P(MDY,"^",4))) S ^TMP("MDSTATUS",$J,+MDY,+$P(MDY,"^",4))=+MDLP
"RTN","MDWORSR",47,0)
 .Q
"RTN","MDWORSR",48,0)
 ; Combine clinics with multiple procedures to regular clinics
"RTN","MDWORSR",49,0)
 S MDLST2=$S(+MDLST>0:MDLST,1:0)
"RTN","MDWORSR",50,0)
 I MDLST1>0 K MDY F MDK=0:0 S MDK=$O(MDLST1(MDK)) Q:MDK<1  I $G(MDLST1(MDK))'="" S MDY=$P($G(MDLST1(MDK)),"^",2)_"^"_+$G(MDLST1(MDK)),MDLST2=MDLST2+1,MDLST(MDLST2)=MDY
"RTN","MDWORSR",51,0)
 ; Match new studies with 0 status to appointments
"RTN","MDWORSR",52,0)
 N MDXX K MDY F MDK=0:0 S MDK=$O(MDLST(MDK)) Q:MDK<1  S MDY=$G(MDLST(MDK)) I +$P(MDY,"^",2)>0 S MDCL=+MDY D
"RTN","MDWORSR",53,0)
 .K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","MDWORSR",54,0)
 .D GETPLIST^SDAMA202(+MDY,"1;4;","R",MDDT,MDEND,.MDRET,"")
"RTN","MDWORSR",55,0)
 .F MD=0:0 S MD=$O(^TMP($J,"SDAMA202","GETPLIST",MD)) Q:'MD  D
"RTN","MDWORSR",56,0)
 ..S MDY1=+$G(^TMP($J,"SDAMA202","GETPLIST",MD,4)) Q:MDY1<1
"RTN","MDWORSR",57,0)
 ..S MDSCHD=+$G(^TMP($J,"SDAMA202","GETPLIST",MD,1))
"RTN","MDWORSR",58,0)
 ..S MDDX=+$G(^TMP("MDSTATUS",$J,MDY1,+$P(MDY,"^",2))) Q:'MDDX
"RTN","MDWORSR",59,0)
 ..S MDMULT=+$$GET1^DIQ(702,+MDDX,".04:.12","I")
"RTN","MDWORSR",60,0)
 ..S MDHEMO=+$$GET1^DIQ(702,+MDDX,".04:.06","I"),MDIENS=+MDDX_","
"RTN","MDWORSR",61,0)
 ..S MDFDA(702,MDIENS,.02)=$$NOW^XLFDT()
"RTN","MDWORSR",62,0)
 ..S MDFDA(702,MDIENS,.07)="A;"_MDSCHD_";"_MDCL
"RTN","MDWORSR",63,0)
 ..S MDFDA(702,MDIENS,.14)=MDSCHD
"RTN","MDWORSR",64,0)
 ..D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR") K MDFDA
"RTN","MDWORSR",65,0)
 ..I MDHEMO=2 S MDHOLD=$P($G(^MDD(702,+MDIENS,0)),"^",7),MDNEW=$$NOW^XLFDT(),$P(^MDD(702,+MDIENS,0),"^",7)=$S(MDNEW>MDSCHD:MDSCHD,1:MDNEW)
"RTN","MDWORSR",66,0)
 ..S MDHL7=$$SUB^MDHL7B(+MDIENS)
"RTN","MDWORSR",67,0)
 ..I +MDHL7=-1 S MDFDA(702,MDIENS,.09)=2,MDFDA(702,MDIENS,.08)=$P(MDHL7,U,2)
"RTN","MDWORSR",68,0)
 ..I +MDHL7=1 S MDFDA(702,MDIENS,.09)=5,MDFDA(702,MDIENS,.08)=""
"RTN","MDWORSR",69,0)
 ..D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR")
"RTN","MDWORSR",70,0)
 ..Q:'+$G(MDIENS)
"RTN","MDWORSR",71,0)
 ..I MDHEMO=2 D CP^MDKUTL(+MDIENS) S:$G(MDHOLD)'="" MDFDA(702,+MDIENS_",",.07)=MDHOLD S MDFDA(702,+MDIENS_",",.09)=5 D FILE^DIE("","MDFDA","MDERR") K MDFDA
"RTN","MDWORSR",72,0)
 ..Q
"RTN","MDWORSR",73,0)
 .Q
"RTN","MDWORSR",74,0)
 ; Match the rest of appointments with previous studies
"RTN","MDWORSR",75,0)
 N MDGET,MDINST S X1=DT,X2=-365 D C^%DTC S MDCDT=X
"RTN","MDWORSR",76,0)
 F MDK=0:0 S MDK=$O(MDLST(MDK)) Q:MDK<1  S MDY=$G(MDLST(MDK)) I +$P(MDY,"^",2)>0 S MDCL=+MDY D
"RTN","MDWORSR",77,0)
 .K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","MDWORSR",78,0)
 .D GETPLIST^SDAMA202(+MDY,"1;4;","R",MDDT,MDEND,.MDRET,"")
"RTN","MDWORSR",79,0)
 .F MD=0:0 S MD=$O(^TMP($J,"SDAMA202","GETPLIST",MD)) Q:'MD  D
"RTN","MDWORSR",80,0)
 ..S MDINP=0
"RTN","MDWORSR",81,0)
 ..S MDY1=+$G(^TMP($J,"SDAMA202","GETPLIST",MD,4)) Q:MDY1<1
"RTN","MDWORSR",82,0)
 ..S MDSCHD=+$G(^TMP($J,"SDAMA202","GETPLIST",MD,1))
"RTN","MDWORSR",83,0)
 ..S MDPT=MDY1 Q:+$$GSTUDY(MDPT,MDSCHD)
"RTN","MDWORSR",84,0)
 ..S MDDX=$$GETC(MDPT,+$P(MDY,"^",2)) Q:'+MDDX
"RTN","MDWORSR",85,0)
 ..S MDNODE=$G(^MDD(702,+MDDX,0))
"RTN","MDWORSR",86,0)
 ..S:$G(^DPT(MDY1,.105))'="" MDINP=1
"RTN","MDWORSR",87,0)
 ..S MDCON=$P(MDNODE,"^",5) Q:'MDCON
"RTN","MDWORSR",88,0)
 ..S MDVSTR=$P(MDNODE,"^",7) Q:MDVSTR=""
"RTN","MDWORSR",89,0)
 ..S MDMULT=+$$GET1^DIQ(702,+MDDX,".04:.12","I")
"RTN","MDWORSR",90,0)
 ..S MDHEMO=+$$GET1^DIQ(702,+MDDX,".04:.06","I")
"RTN","MDWORSR",91,0)
 ..S MDYR=$S(MDMULT<1:MDCOM,1:MDCDT)
"RTN","MDWORSR",92,0)
 ..Q:$P(MDNODE,"^",2)<MDYR
"RTN","MDWORSR",93,0)
 ..Q:'+$P(MDNODE,"^",6)
"RTN","MDWORSR",94,0)
 ..Q:'$P(MDNODE,"^",9)
"RTN","MDWORSR",95,0)
 ..Q:$P(MDNODE,"^",9)>3
"RTN","MDWORSR",96,0)
 ..Q:MDMULT'=1&(MDHEMO<2)
"RTN","MDWORSR",97,0)
 ..Q:$P(MDVSTR,";",2)=MDSCHD
"RTN","MDWORSR",98,0)
 ..S MDINST=+$$GINST(+$P(MDNODE,"^",4)) Q:'MDINST
"RTN","MDWORSR",99,0)
 ..K MDFDA,MDERR,MDIEN
"RTN","MDWORSR",100,0)
 ..S MDFDA(702,"+1,",.01)=MDY1
"RTN","MDWORSR",101,0)
 ..S MDFDA(702,"+1,",.02)=$$NOW^XLFDT()
"RTN","MDWORSR",102,0)
 ..S MDFDA(702,"+1,",.03)=$P(MDNODE,"^",3)
"RTN","MDWORSR",103,0)
 ..S MDFDA(702,"+1,",.04)=$P(MDNODE,"^",4)
"RTN","MDWORSR",104,0)
 ..S MDFDA(702,"+1,",.05)=MDCON
"RTN","MDWORSR",105,0)
 ..S MDFDA(702,"+1,",.07)="A;"_MDSCHD_";"_MDCL
"RTN","MDWORSR",106,0)
 ..S MDFDA(702,"+1,",.11)=+MDINST
"RTN","MDWORSR",107,0)
 ..S MDFDA(702,"+1,",.14)=MDSCHD
"RTN","MDWORSR",108,0)
 ..D UPDATE^DIE("","MDFDA","MDIEN","MDERR") Q:$D(MDERR)  K MDFDA
"RTN","MDWORSR",109,0)
 ..S MDIENS=MDIEN(1)_"," I MDHEMO=2 S MDHOLD=$P($G(^MDD(702,MDIEN(1),0)),"^",7),MDNOW=$$NOW^XLFDT(),$P(^MDD(702,MDIEN(1),0),"^",7)=$S(MDNOW>MDSCHD:MDSCHD,1:MDNOW)
"RTN","MDWORSR",110,0)
 ..S MDHL7=$$SUB^MDHL7B(MDIEN(1))
"RTN","MDWORSR",111,0)
 ..I +MDHL7=-1 S MDFDA(702,MDIENS,.09)=2,MDFDA(702,MDIENS,.08)=$P(MDHL7,U,2)
"RTN","MDWORSR",112,0)
 ..I +MDHL7=1 S MDFDA(702,MDIENS,.09)=5,MDFDA(702,MDIENS,.08)=""
"RTN","MDWORSR",113,0)
 ..D:$D(MDFDA) FILE^DIE("","MDFDA","MDERR")
"RTN","MDWORSR",114,0)
 ..Q:'+$G(MDIENS)
"RTN","MDWORSR",115,0)
 ..I MDHEMO=2 D CP^MDKUTL(+MDIENS) K MDFDA S:$G(MDHOLD)'="" MDFDA(702,+MDIENS_",",.07)=MDHOLD S MDFDA(702,+MDIENS_",",.09)=5 D FILE^DIE("","MDFDA","MDERR")
"RTN","MDWORSR",116,0)
 K ^TMP($J,"SDAMA202","GETPLIST"),^TMP("MDSTATUS",$J),MDFDA
"RTN","MDWORSR",117,0)
 Q
"RTN","MDWORSR",118,0)
GETC(MDPAT,MDDA) ; Get consult date
"RTN","MDWORSR",119,0)
 N MDX,MDCF S MDCF=0 K ^TMP("MDTMP",$J) D CPLIST^GMRCCP(MDPAT,+MDDA,$NA(^TMP("MDTMP",$J)))
"RTN","MDWORSR",120,0)
 S MDX=$O(^TMP("MDTMP",$J,""),-1) Q:'+MDX 0
"RTN","MDWORSR",121,0)
 I "saprc"'[$P($G(^TMP("MDTMP",$J,MDX)),U,4) S MDX=$O(^TMP("MDTMP",$J,MDX),-1) Q:'+MDX 0
"RTN","MDWORSR",122,0)
 I "saprc"[$P($G(^TMP("MDTMP",$J,MDX)),U,4) S MDCF=$P($G(^TMP("MDTMP",$J,MDX)),U,5)_"^"_$P($G(^TMP("MDTMP",$J,MDX)),U,1)
"RTN","MDWORSR",123,0)
 K ^TMP("MDTMP",$J)
"RTN","MDWORSR",124,0)
 Q $S(+MDCF:+$O(^MDD(702,"ACON",+MDCF,""),-1)_"^"_$P(MDCF,"^",2),1:0)
"RTN","MDWORSR",125,0)
GINST(MDDA) ; Get instrument from CP Definition
"RTN","MDWORSR",126,0)
 N MDIN,MDINT,Y1 S (MDINT,Y1)=0
"RTN","MDWORSR",127,0)
 F MDIN=0:0 S MDIN=$O(^MDS(702.01,+MDDA,.1,MDIN)) Q:MDIN<1!(+Y1)  S MDINT=+$G(^(MDIN,0)) I +$$GET1^DIQ(702.09,MDINT,".13","I") S Y1=MDINT
"RTN","MDWORSR",128,0)
 Q Y1
"RTN","MDWORSR",129,0)
GSTUDY(MDPAT,MDDA) ;Get study for scheduled date/time
"RTN","MDWORSR",130,0)
 N MDIN,Y1 S Y1=0
"RTN","MDWORSR",131,0)
 F MDIN=0:0 S MDIN=$O(^MDD(702,"ASD",MDDA,MDIN)) Q:MDIN<1!(Y1>0)  D
"RTN","MDWORSR",132,0)
 .S:$P($G(^MDD(702,MDIN,0)),"^")=MDPAT Y1=1
"RTN","MDWORSR",133,0)
 Q Y1
"RTN","MDWSETUP")
0^5^B67128950^n/a
"RTN","MDWSETUP",1,0)
MDWSETUP ; HOIFO/NCA - Auto Study Check-In Setup ;12/13/07  22:39
"RTN","MDWSETUP",2,0)
 ;;1.0;CLINICAL PROCEDURES;**14**;Apr 01, 2004;Build 20
"RTN","MDWSETUP",3,0)
EN1 ; [Procedure]
"RTN","MDWSETUP",4,0)
 ; This post conversion routine will place the Medicine Enter/Edit 
"RTN","MDWSETUP",5,0)
 ; options out of order
"RTN","MDWSETUP",6,0)
 ; Reference IA # 2263 [Supported] XPAR parameter calls
"RTN","MDWSETUP",7,0)
 ;               10040 [Supported] Accessing Hospital Location file (#44)
"RTN","MDWSETUP",8,0)
 ;               10103 [Supported] XLFDT call
"RTN","MDWSETUP",9,0)
 ;
"RTN","MDWSETUP",10,0)
 N MDANS,MDAPT,MDAR,MDCL,MDCNOD,MDCP,MDCT,MDCTR,MDDEF,MDDFLT,MDERR,MDFLAG,MDFRST,MDLP,MDLST,MDLST1,MDLST2,MDNODE,MDNXT
"RTN","MDWSETUP",11,0)
 N MDPREC,MDS,MDSAP,MDSED,MDSEL,MDX,MDX1,MDY,MDY1
"RTN","MDWSETUP",12,0)
 S MDDEF=$$GET^XPAR("SYS","MD USE APPT WITH PROCEDURE",1),MDDEF=$S(+MDDEF:"YES",1:"NO")
"RTN","MDWSETUP",13,0)
 D DEL^XPAR("SYS","MD USE APPT WITH PROCEDURE",1)
"RTN","MDWSETUP",14,0)
 K DIR S DIR(0)="YA",DIR("A")="Use Appointment with procedure? ",DIR("B")=MDDEF,DIR("?")="Enter either 'Y' or 'N'."
"RTN","MDWSETUP",15,0)
 S DIR("?",1)="Default should be 'N' as most sites do not schedule procedures"
"RTN","MDWSETUP",16,0)
 S DIR("?",2)="before the order is entered.  Select 'Y' if the procedure appointment"
"RTN","MDWSETUP",17,0)
 S DIR("?",3)="is scheduled before the order is entered and the ordering provider"
"RTN","MDWSETUP",18,0)
 S DIR("?",4)="selects the appointment for the procedure."
"RTN","MDWSETUP",19,0)
 D ^DIR K DIR Q:$D(DIRUT)!$D(DIROUT)!(Y<0)
"RTN","MDWSETUP",20,0)
 D EN^XPAR("SYS","MD USE APPT WITH PROCEDURE",1,Y)
"RTN","MDWSETUP",21,0)
 D GETLST^XPAR(.MDLST,"SYS","MD CHECK-IN PROCEDURE LIST")
"RTN","MDWSETUP",22,0)
 D GETLST^XPAR(.MDLST1,"SYS","MD CLINIC QUICK LIST")
"RTN","MDWSETUP",23,0)
 D GETLST^XPAR(.MDLST2,"SYS","MD CLINICS WITH MULT PROC")
"RTN","MDWSETUP",24,0)
 K ^TMP("MDPROC",$J),^TMP("MDPARAM",$J) S (MDCT,MDCTR)=0
"RTN","MDWSETUP",25,0)
 ; Get procedure parameter list
"RTN","MDWSETUP",26,0)
 F MDLP=0:0 S MDLP=$O(MDLST(MDLP)) Q:MDLP<1  I +$G(MDLST(MDLP)) S MDX=$P($G(^MDS(702.01,+$G(MDLST(MDLP)),0)),"^",1) D
"RTN","MDWSETUP",27,0)
 . Q:MDX=""  S MDY=+$P($G(MDLST(MDLP)),"^",2)
"RTN","MDWSETUP",28,0)
 . S ^TMP("MDPROC",$J,MDX,+$G(MDLST(MDLP)))=MDY_"^"_$S(MDY=1:"Outpatient",MDY=2:"Inpatient",MDY=3:"Both",1:"None")
"RTN","MDWSETUP",29,0)
 ; Get Clinic Quick List
"RTN","MDWSETUP",30,0)
 F MDLP=0:0 S MDLP=$O(MDLST1(MDLP)) Q:MDLP<1  S MDX1=+$P($G(MDLST1(MDLP)),"^",2) I +MDX1 D
"RTN","MDWSETUP",31,0)
 . S MDX=$P($G(^MDS(702.01,MDX1,0)),"^",1) Q:MDX=""
"RTN","MDWSETUP",32,0)
 . S MDY=+$G(MDLST1(MDLP)) Q:'MDY
"RTN","MDWSETUP",33,0)
 . S MDCNOD=$G(^TMP("MDPROC",$J,MDX,MDX1)) Q:MDCNOD=""
"RTN","MDWSETUP",34,0)
 . S MDY1=$$GET1^DIQ(44,MDY_",",.01),MDCTR=MDCTR+1
"RTN","MDWSETUP",35,0)
 . S:$G(MDCTR(MDY))="" MDCTR(MDY)=0 S MDCTR(MDY)=MDCTR(MDY)+1
"RTN","MDWSETUP",36,0)
 . S ^TMP("MDPARAM",$J,MDX,MDY1)=MDX1_"^"_MDY_"^"_MDCNOD
"RTN","MDWSETUP",37,0)
 ; Get clinic with multiple procedures
"RTN","MDWSETUP",38,0)
 F MDLP=0:0 S MDLP=$O(MDLST2(MDLP)) Q:MDLP<1  I +$G(MDLST2(MDLP)) S MDX=$P($G(^MDS(702.01,+$G(MDLST2(MDLP)),0)),"^",1) D
"RTN","MDWSETUP",39,0)
 . S MDY=$P($G(MDLST2(MDLP)),"^",2),MDY1=$$GET1^DIQ(44,MDY_",",.01)
"RTN","MDWSETUP",40,0)
 . Q:$G(^TMP("MDPARAM",$J,MDX,MDY1))'=""
"RTN","MDWSETUP",41,0)
 . S MDCNOD=$G(^TMP("MDPROC",$J,MDX,+$G(MDLST2(MDLP))))
"RTN","MDWSETUP",42,0)
 . S:MDCNOD="" MDCNOD=0_"^None"
"RTN","MDWSETUP",43,0)
 . S ^TMP("MDPARAM",$J,MDX,MDY1)=+$G(MDLST2(MDLP))_"^"_MDY_"^"_MDCNOD
"RTN","MDWSETUP",44,0)
 . S:$G(MDCTR(MDY))="" MDCTR(MDY)=0 S MDCTR=MDCTR+1,MDCTR(MDY)=MDCTR(MDY)+1
"RTN","MDWSETUP",45,0)
 S MDPREC=$NA(^TMP("MDPROC",$J)) K MDLST,MDLST1,MDLST2
"RTN","MDWSETUP",46,0)
 F  S MDPREC=$Q(@MDPREC) Q:MDPREC=""  Q:$QS(MDPREC,1)'="MDPROC"  D
"RTN","MDWSETUP",47,0)
 . I '$D(^TMP("MDPARAM",$J,$QS(MDPREC,3))) S MDCTR=MDCTR+1,^TMP("MDPARAM",$J,$QS(MDPREC,3),"None")=$QS(MDPREC,4)_"^^"_@MDPREC
"RTN","MDWSETUP",48,0)
QURY ; Query the procedure parameter list
"RTN","MDWSETUP",49,0)
 I MDCTR<1 G A1
"RTN","MDWSETUP",50,0)
 N MDN S MDPREC=$NA(^TMP("MDPARAM",$J)),(MDANS,MDN)="" D HDR
"RTN","MDWSETUP",51,0)
 F  S MDPREC=$Q(@MDPREC) Q:MDPREC=""  Q:$QS(MDPREC,1)'="MDPARAM"  D
"RTN","MDWSETUP",52,0)
 . Q:MDANS="^"
"RTN","MDWSETUP",53,0)
 . S MDAPT=@MDPREC,MDAPT=$P(MDAPT,"^",4)
"RTN","MDWSETUP",54,0)
 . I $Y>(IOSL-2) K DIR S DIR(0)="E" D ^DIR K DIR D:Y HDR I $D(DIRUT)!$D(DIROUT)!(Y<0) S MDANS="^" Q
"RTN","MDWSETUP",55,0)
 . I MDN'=$QS(MDPREC,3) W !,$E($QS(MDPREC,3),1,25),?27,MDAPT,?55,$E($QS(MDPREC,4),1,25) S MDN=$QS(MDPREC,3) Q
"RTN","MDWSETUP",56,0)
 . W !?55,$E($QS(MDPREC,4),1,25)
"RTN","MDWSETUP",57,0)
A1 ; Ask for procedure parameter
"RTN","MDWSETUP",58,0)
 W !!,"Procedure: " R X:DTIME G:'$T!("^"[X) KIL
"RTN","MDWSETUP",59,0)
 I X["?" D PHELP^MDWCHK
"RTN","MDWSETUP",60,0)
 K DIC S DIC="^MDS(702.01,",DIC(0)="EQMZ",DIC("S")="I +$P(^(0),U,9)>0"
"RTN","MDWSETUP",61,0)
 D ^DIC K DIC G A1:"^"[X!$D(DTOUT),A1:Y<1
"RTN","MDWSETUP",62,0)
 S MDSEL=Y,MDCP=+MDSEL
"RTN","MDWSETUP",63,0)
 G:'$D(^TMP("MDPARAM",$J,Y(0,0))) A2
"RTN","MDWSETUP",64,0)
 S MDFRST=$O(^TMP("MDPARAM",$J,Y(0,0),"")) G:MDFRST="" A2
"RTN","MDWSETUP",65,0)
 S MDX1=$P($G(^TMP("MDPARAM",$J,Y(0,0),MDFRST)),"^",3)
"RTN","MDWSETUP",66,0)
 S MDNXT=$O(^TMP("MDPARAM",$J,Y(0,0),MDFRST)),MDDFLT="",MDFLAG=0
"RTN","MDWSETUP",67,0)
 I MDNXT="" S MDDFLT=$G(^TMP("MDPARAM",$J,Y(0,0),MDFRST)),MDNODE=MDFRST G E1
"RTN","MDWSETUP",68,0)
 I MDNXT'="" D  Q:+MDFLAG
"RTN","MDWSETUP",69,0)
 . W ! S MDLP="",MDCT=0 F  S MDLP=$O(^TMP("MDPARAM",$J,Y(0,0),MDLP)) Q:MDLP=""  D
"RTN","MDWSETUP",70,0)
 . . S MDCT=MDCT+1 W !,MDCT_") ",Y(0,0),"  ",MDLP S MDAR(MDCT)=MDLP
"RTN","MDWSETUP",71,0)
 . W ! K DIR S DIR(0)="NAO^1:"_MDCT,DIR("A")="Select 1-"_MDCT_": ",DIR("?")="Select from 1-"_MDCT D ^DIR
"RTN","MDWSETUP",72,0)
 . I X="" S MDSED=MDSEL,MDSAP=MDX1,MDFLAG=1 Q
"RTN","MDWSETUP",73,0)
 . K DIR G:$D(DIRUT)!$D(DIROUT)!(Y<1) KIL S MDS=Y
"RTN","MDWSETUP",74,0)
 . S MDNODE=$G(MDAR(MDS))
"RTN","MDWSETUP",75,0)
 . S MDDFLT=$G(^TMP("MDPARAM",$J,$P(MDSEL,"^",2),MDNODE))
"RTN","MDWSETUP",76,0)
E1 ; Edit the procedure
"RTN","MDWSETUP",77,0)
 W !!,"Procedure: ",$P(MDSEL,"^",2)_"// " R X:DTIME G:'$T!(X=U) KIL
"RTN","MDWSETUP",78,0)
 I X["?"!(X'="")&(X'="@") W !,"Hit Return to accept the procedure",!,"Enter ""@"" to delete the procedure.",!,"Enter a ""^"" will exit completely." G E1
"RTN","MDWSETUP",79,0)
 I X="@" D  G A1
"RTN","MDWSETUP",80,0)
 . I MDNXT="" D EN^XPAR("SYS","MD CHECK-IN PROCEDURE LIST",$P(MDSEL,"^",2),"@")
"RTN","MDWSETUP",81,0)
 . D:+$G(MDCTR(+$P(MDDFLT,"^",2)))>1 EN^XPAR("SYS","MD CLINICS WITH MULT PROC","`"_$P(MDSEL,"^",1),"@")
"RTN","MDWSETUP",82,0)
 . D:MDNODE'["None" EN^XPAR("SYS","MD CLINIC QUICK LIST","`"_+$P(MDDFLT,"^",2),"@")
"RTN","MDWSETUP",83,0)
 . K MDLST2 D GETLST^XPAR(.MDLST2,"SYS","MD CLINICS WITH MULT PROC")
"RTN","MDWSETUP",84,0)
 . S MDLP="" F  S MDLP=$O(MDLST2(MDLP)) Q:MDLP=""  I +$G(MDLST2(MDLP))=+$P(MDSEL,"^",1) D
"RTN","MDWSETUP",85,0)
 . . I $P($G(MDLST2(MDLP)),"^",2)=+$P(MDDFLT,"^",2) D EN^XPAR("SYS","MD CLINICS WITH MULT PROC","`"_+$P(MDSEL,"^",1),"@")
"RTN","MDWSETUP",86,0)
 . K ^TMP("MDPARAM",$J,$P(MDSEL,"^",2),MDNODE)
"RTN","MDWSETUP",87,0)
 . S:+$P(MDDFLT,"^",2) MDCTR(+$P(MDDFLT,"^",2))=MDCTR(+$P(MDDFLT,"^",2))-1
"RTN","MDWSETUP",88,0)
 . W " ..Procedure deleted"
"RTN","MDWSETUP",89,0)
 S MDSED=MDSEL
"RTN","MDWSETUP",90,0)
E2 ; Ask whether appointment scheduled
"RTN","MDWSETUP",91,0)
 K DIR S DIR(0)="SA^0:None;1:Outpatient;2:Inpatient;3:Both",DIR("A")="Schedule Appointment?: ",DIR("B")=+$P(MDDFLT,"^",3)
"RTN","MDWSETUP",92,0)
 S DIR("?")="^D CHELP^MDWCHK"
"RTN","MDWSETUP",93,0)
 D ^DIR K DIR
"RTN","MDWSETUP",94,0)
 G:$D(DIRUT)!$D(DIROUT)!(Y<0) KIL S MDSAP=Y
"RTN","MDWSETUP",95,0)
 I $G(MDDFLT)'="" D EN^XPAR("SYS","MD CHECK-IN PROCEDURE LIST",$P(MDSEL,"^",2),"@")
"RTN","MDWSETUP",96,0)
 D EN^XPAR("SYS","MD CHECK-IN PROCEDURE LIST","`"_+MDSED,+MDSAP)
"RTN","MDWSETUP",97,0)
 I MDSAP'=+$P(MDDFLT,"^",3) S MDLP="" F  S MDLP=$O(^TMP("MDPARAM",$J,$P(MDSED,"^",2),MDLP)) Q:MDLP=""  S MDX=$G(^(MDLP)) I $P(MDX,"^",3)'=+MDSAP D
"RTN","MDWSETUP",98,0)
 . S $P(MDX,"^",3,4)=+MDSAP_"^"_$S(MDSAP=1:"Outpatient",MDSAP=2:"Inpatient",MDSAP=3:"Both",1:"None")
"RTN","MDWSETUP",99,0)
 . S ^TMP("MDPARAM",$J,$P(MDSED,"^",2),MDLP)=MDX
"RTN","MDWSETUP",100,0)
 I MDNODE["None" G A3
"RTN","MDWSETUP",101,0)
E3 ; Edit the location
"RTN","MDWSETUP",102,0)
 W !,"Clinic: ",MDNODE_"// " R X:DTIME G:'$T!(X=U) KIL
"RTN","MDWSETUP",103,0)
 I X["?"!(X'="")&(X'="@") W !,"Hit Return to accept the clinic",!,"Enter ""@"" to delete the clinic from the procedure.",!,"Enter a ""^"" will exit completely." G E3
"RTN","MDWSETUP",104,0)
 I X="" G A4
"RTN","MDWSETUP",105,0)
 I X="@" D  G A4
"RTN","MDWSETUP",106,0)
 . D EN^XPAR("SYS","MD CLINIC QUICK LIST","`"_+$P(MDDFLT,"^",2),"@")
"RTN","MDWSETUP",107,0)
 . S:+$P(MDDFLT,"^",2) MDCTR(+$P(MDDFLT,"^",2))=MDCTR(+$P(MDDFLT,"^",2))-1
"RTN","MDWSETUP",108,0)
 . K MDLST2 D GETLST^XPAR(.MDLST2,"SYS","MD CLINICS WITH MULT PROC")
"RTN","MDWSETUP",109,0)
 . S MDLP="" F  S MDLP=$O(MDLST2(MDLP)) Q:MDLP=""  I +$G(MDLST2(MDLP))=+$P(MDSEL,"^",1) D
"RTN","MDWSETUP",110,0)
 . . I $P($G(MDLST2(MDLP)),"^",2)=+$P(MDDFLT,"^",2) D EN^XPAR("SYS","MD CLINICS WITH MULT PROC","`"_+$P(MDSEL,"^",1),"@")
"RTN","MDWSETUP",111,0)
 . K ^TMP("MDPARAM",$J,$P(MDSEL,"^",2),MDNODE),MDLST2
"RTN","MDWSETUP",112,0)
 . I $G(MDNXT)="" S $P(MDDFLT,"^",2)="",^TMP("MDPARAM",$J,$P(MDSEL,"^",2),"None")=MDDFLT
"RTN","MDWSETUP",113,0)
 . W " ..Value deleted"
"RTN","MDWSETUP",114,0)
 S MDCL=+$P(MDDFLT,"^",2)_"^"_MDNODE
"RTN","MDWSETUP",115,0)
 K MDCL,MDSEL
"RTN","MDWSETUP",116,0)
 G A4
"RTN","MDWSETUP",117,0)
A2 ; Ask if site schedule appointments
"RTN","MDWSETUP",118,0)
 K DIR S DIR(0)="SA^0:None;1:Outpatient;2:Inpatient;3:Both",DIR("A")="Schedule Appointment?: ",DIR("?")="^D CHELP^MDWCHK"
"RTN","MDWSETUP",119,0)
 D ^DIR K DIR
"RTN","MDWSETUP",120,0)
 I $D(DIRUT)!$D(DIROUT)!(Y<0) W "...Procedure removed" G KIL
"RTN","MDWSETUP",121,0)
 S MDSAP=Y
"RTN","MDWSETUP",122,0)
 D EN^XPAR("SYS","MD CHECK-IN PROCEDURE LIST","`"_+MDSEL,+MDSAP)
"RTN","MDWSETUP",123,0)
 S ^TMP("MDPARAM",$J,$P(MDSEL,"^",2),"None")=+MDSEL_"^^"_MDSAP_"^"_$S(MDSAP=1:"Outpatient",MDSAP=2:"Inpatient",MDSAP=3:"Both",1:"None")
"RTN","MDWSETUP",124,0)
 I 'MDSAP S MDCL="" D TASK G A1
"RTN","MDWSETUP",125,0)
A3 ; Ask for clinic value
"RTN","MDWSETUP",126,0)
 W !,"Clinic: " R X:DTIME G:'$T!(X=U) KIL
"RTN","MDWSETUP",127,0)
 I X["?" D CLHELP
"RTN","MDWSETUP",128,0)
 I X="" S MDCL="" D:'+MDSAP TASK G A1
"RTN","MDWSETUP",129,0)
 K DIC S DIC="^SC(",DIC(0)="EQMZ"
"RTN","MDWSETUP",130,0)
 D ^DIC K DIC G A3:"^"[X!$D(DTOUT),A3:Y<1
"RTN","MDWSETUP",131,0)
 S MDCL=Y D TASK
"RTN","MDWSETUP",132,0)
 K ^TMP("MDPARAM",$J,$P(MDSEL,"^",2),"None")
"RTN","MDWSETUP",133,0)
 S ^TMP("MDPARAM",$J,$P(MDSEL,"^",2),$P(MDCL,"^",2))=+MDSEL_"^"_+MDCL_"^"_MDSAP_"^"_$S(MDSAP=1:"Outpatient",MDSAP=2:"Inpatient",MDSAP=3:"Both",1:"None")
"RTN","MDWSETUP",134,0)
 S:$G(MDCTR(+MDCL))="" MDCTR(+MDCL)=0 S MDCTR(+MDCL)=MDCTR(+MDCL)+1
"RTN","MDWSETUP",135,0)
 I +$G(MDCTR(+MDCL))>1 D EN^XPAR("SYS","MD CLINICS WITH MULT PROC","`"_+MDSEL,"`"_+MDCL) G A4
"RTN","MDWSETUP",136,0)
 D EN^XPAR("SYS","MD CLINIC QUICK LIST","`"_+MDCL,"`"_+MDSEL)
"RTN","MDWSETUP",137,0)
A4 ; Ask for another Clinic
"RTN","MDWSETUP",138,0)
 K DIR W ! S DIR(0)="YA",DIR("A")="Enter another clinic for the same procedure? ",DIR("B")="NO",DIR("?")="Enter either 'Y' or 'N', if you want to assign more than one clinic."
"RTN","MDWSETUP",139,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DIROUT)!(Y<0) A4
"RTN","MDWSETUP",140,0)
 I +Y G A3
"RTN","MDWSETUP",141,0)
 G A1
"RTN","MDWSETUP",142,0)
KIL ; Clean Up TMP global arrays and exit
"RTN","MDWSETUP",143,0)
 K DIROUT,DIRUT,MDCL,MDSEL,X,Y
"RTN","MDWSETUP",144,0)
 K ^TMP("MDPROC",$J),^TMP("MDPARAM",$J)
"RTN","MDWSETUP",145,0)
 Q
"RTN","MDWSETUP",146,0)
TASK ; Queue a task to process previous requests
"RTN","MDWSETUP",147,0)
 K IO("Q"),ZTUCI,ZTDTH,ZTIO,ZTSAVE S ZTRTN="START^MDWCHK",ZTREQ="@",ZTSAVE("ZTREQ")="",ZTIO="",ZTDTH=$$NOW^XLFDT()
"RTN","MDWSETUP",148,0)
 S ZTDESC="Check-In Studies for "_$P($G(^MDS(702.01,+MDCP,0)),"^",1)
"RTN","MDWSETUP",149,0)
 S ZTSAVE("MDCP")="",ZTSAVE("MDCL")="",MDUSR=DUZ,ZTSAVE("MDUSR")="",ZTSAVE("MDSAP")=""
"RTN","MDWSETUP",150,0)
 D ^%ZTLOAD K ZTSK
"RTN","MDWSETUP",151,0)
 Q
"RTN","MDWSETUP",152,0)
CLHELP ; Help Message for Clinic prompt
"RTN","MDWSETUP",153,0)
 W !,"Only required, if appointments are scheduled for the procedure."
"RTN","MDWSETUP",154,0)
 W !,"Enter the clinic used for scheduling the procedure."
"RTN","MDWSETUP",155,0)
 I +MDCP,$D(^TMP("MDPARAM",$J)) D
"RTN","MDWSETUP",156,0)
 .W ! S MDLP="" F  S MDLP=$O(^TMP("MDPARAM",$J,$P($G(^MDS(702.01,+MDCP,0)),"^",1),MDLP)) Q:MDLP=""  I MDLP'["None" W !,MDLP
"RTN","MDWSETUP",157,0)
 W !
"RTN","MDWSETUP",158,0)
 Q
"RTN","MDWSETUP",159,0)
HDR ; Parameter List Header
"RTN","MDWSETUP",160,0)
 W @IOF,!!,"Procedure",?27,"Schedule Appt.",?55,"Clinic"
"RTN","MDWSETUP",161,0)
 W !,"---------",?27,"--------------",?55,"------"
"RTN","MDWSETUP",162,0)
 Q
"VER")
8.0^22.0
"^DD",702,702,.09,0)
TRANSACTION STATUS^S^0:New;1:Submitted;2:Error;3:Complete;4:Ready to Complete;5:Pending Instrument Data;6:Cancelled;^0;9^Q
"^DD",702,702,.09,.1)
Status
"^DD",702,702,.09,1,0)
^.1
"^DD",702,702,.09,1,1,0)
702^AS
"^DD",702,702,.09,1,1,1)
S ^MDD(702,"AS",$E(X,1,30),DA)=""
"^DD",702,702,.09,1,1,2)
K ^MDD(702,"AS",$E(X,1,30),DA)
"^DD",702,702,.09,1,1,"%D",0)
^.101^2^2^3061205^^
"^DD",702,702,.09,1,1,"%D",1,0)
It is a cross reference on the status of the CP study and it
"^DD",702,702,.09,1,1,"%D",2,0)
is used for quick look up.
"^DD",702,702,.09,1,1,"DT")
3040826
"^DD",702,702,.09,3)
Status of this transaction.
"^DD",702,702,.09,21,0)
^.001^49^49^3061205^^^^
"^DD",702,702,.09,21,1,0)
This field contains the status of this transaction. Available statuses 
"^DD",702,702,.09,21,2,0)
are listed below with a description of each.
"^DD",702,702,.09,21,3,0)
 
"^DD",702,702,.09,21,4,0)
0: New                                                                        
"^DD",702,702,.09,21,5,0)
This transaction has been created by an external application and needs to 
"^DD",702,702,.09,21,6,0)
be checked-in with the CPUser application and submitted to an instrument.
"^DD",702,702,.09,21,7,0)
An example of this status would be a consent form scanned in via the
"^DD",702,702,.09,21,8,0)
VistA Imaging Capture Workstation that creates a CP Study record 
"^DD",702,702,.09,21,9,0)
stub with a TIU document but allows further input with the CPUser 
"^DD",702,702,.09,21,10,0)
application.
"^DD",702,702,.09,21,11,0)
 
"^DD",702,702,.09,21,12,0)
1: Submitted                                                      
"^DD",702,702,.09,21,13,0)
This transaction has been submitted to the VistA Imaging Background 
"^DD",702,702,.09,21,14,0)
Processor and is awaiting the copy process to place the attachments for 
"^DD",702,702,.09,21,15,0)
the study on the VistA Imaging server.  A study in this status is not 
"^DD",702,702,.09,21,16,0)
accessible until VistA Imaging returns a status of Complete or Error and 
"^DD",702,702,.09,21,17,0)
logs any errors encountered in the submission process.
"^DD",702,702,.09,21,18,0)
 
"^DD",702,702,.09,21,19,0)
2: Error                                                               
"^DD",702,702,.09,21,20,0)
This transaction has encountered an error while being submitted to VistA 
"^DD",702,702,.09,21,21,0)
Imaging.  The error may be due to the TIU note creation or a problem with 
"^DD",702,702,.09,21,22,0)
the attachments sent to the VistA Imaging server. Error messages are 
"^DD",702,702,.09,21,23,0)
logged with the transaction and can be reviewed by users when opening the 
"^DD",702,702,.09,21,24,0)
transaction in an error status.
"^DD",702,702,.09,21,25,0)
 
"^DD",702,702,.09,21,26,0)
3: Complete                                                             
"^DD",702,702,.09,21,27,0)
This transaction has completed the process and has successfully created a 
"^DD",702,702,.09,21,28,0)
TIU note for interpretation on the selected Consult and if any 
"^DD",702,702,.09,21,29,0)
attachments were included they have been successfully copied to the VistA 
"^DD",702,702,.09,21,30,0)
Imaging server.
"^DD",702,702,.09,21,31,0)
 
"^DD",702,702,.09,21,32,0)
4: Ready to Complete                                                    
"^DD",702,702,.09,21,33,0)
This transaction has been checked in and alternatively, if submitted to a 
"^DD",702,702,.09,21,34,0)
bi-directional instrument, has received the data back from the 
"^DD",702,702,.09,21,35,0)
instrument.  Users may open these transactions and view the 
"^DD",702,702,.09,21,36,0)
Consult/Procedure order as well as assign instrument results to the 
"^DD",702,702,.09,21,37,0)
study.  Once these steps have been done this study can be submitted to 
"^DD",702,702,.09,21,38,0)
VistA Imaging.
"^DD",702,702,.09,21,39,0)
 
"^DD",702,702,.09,21,40,0)
5: Pending Instrument Data                                             
"^DD",702,702,.09,21,41,0)
This transaction has been submitted to a bi-directional instrument and is 
"^DD",702,702,.09,21,42,0)
awaiting that instrument to return the results of the procedure.  
"^DD",702,702,.09,21,43,0)
Transactions in this status should not be opened until the instrument has 
"^DD",702,702,.09,21,44,0)
returned the results, assigned them to the study, and marked it as Ready 
"^DD",702,702,.09,21,45,0)
to Complete.
"^DD",702,702,.09,21,46,0)
                                                                      
"^DD",702,702,.09,21,47,0)
6: Cancelled
"^DD",702,702,.09,21,48,0)
This transaction has been cancelled when the procedure request in
"^DD",702,702,.09,21,49,0)
Consult Report Tracking and CPRS has been cancelled or discontinued.
"^DD",702,702,.09,"DT")
3050404
"^DD",702,702,.14,0)
SCHEDULED DATE/TIME^D^^3;1^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",702,702,.14,1,0)
^.1
"^DD",702,702,.14,1,1,0)
702^ASD
"^DD",702,702,.14,1,1,1)
S ^MDD(702,"ASD",$E(X,1,30),DA)=""
"^DD",702,702,.14,1,1,2)
K ^MDD(702,"ASD",$E(X,1,30),DA)
"^DD",702,702,.14,1,1,3)
This is the scheduled date/time needed for sending HL7 message.
"^DD",702,702,.14,1,1,"%D",0)
^^3^3^3070517^
"^DD",702,702,.14,1,1,"%D",1,0)
This cross reference contains the scheduled date/time as to when
"^DD",702,702,.14,1,1,"%D",2,0)
the HL7 message should be sent to the device for the CP transaction.
"^DD",702,702,.14,1,1,"%D",3,0)
It is used for easy look up to process the study.
"^DD",702,702,.14,1,1,"DT")
3070517
"^DD",702,702,.14,21,0)
^^2^2^3070517^
"^DD",702,702,.14,21,1,0)
This field contains the date/time when the HL7 message
"^DD",702,702,.14,21,2,0)
should be sent by CP to the device for this CP transaction.
"^DD",702,702,.14,"DT")
3070517
"BLD",6560,6)
^8
**END**
**END**
