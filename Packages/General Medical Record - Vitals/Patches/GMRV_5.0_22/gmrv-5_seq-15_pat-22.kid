Released GMRV*5*22 SEQ #15
Extracted from mail message
**KIDS**:GMRV*5.0*22^

**INSTALL NAME**
GMRV*5.0*22
"BLD",6786,0)
GMRV*5.0*22^GEN. MED. REC. - VITALS^0^3080708^y
"BLD",6786,1,0)
^^2^2^3071105^
"BLD",6786,1,1,0)
Vitals Measurement GUI Updates
"BLD",6786,1,2,0)
MISCELLANEOUS MAINTENANCE ISSUES
"BLD",6786,4,0)
^9.64PA^^
"BLD",6786,6.3)
22
"BLD",6786,"ABNS",0)
^9.66A^^
"BLD",6786,"ABPKG")
n^n
"BLD",6786,"INID")
^y
"BLD",6786,"INIT")
EN^GMV22PST
"BLD",6786,"KRN",0)
^9.67PA^8989.52^19
"BLD",6786,"KRN",.4,0)
.4
"BLD",6786,"KRN",.401,0)
.401
"BLD",6786,"KRN",.402,0)
.402
"BLD",6786,"KRN",.403,0)
.403
"BLD",6786,"KRN",.5,0)
.5
"BLD",6786,"KRN",.84,0)
.84
"BLD",6786,"KRN",3.6,0)
3.6
"BLD",6786,"KRN",3.8,0)
3.8
"BLD",6786,"KRN",9.2,0)
9.2
"BLD",6786,"KRN",9.8,0)
9.8
"BLD",6786,"KRN",9.8,"NM",0)
^9.68A^6^5
"BLD",6786,"KRN",9.8,"NM",2,0)
GMVRPCP^^0^B29107373
"BLD",6786,"KRN",9.8,"NM",3,0)
GMVRPCHL^^0^B30986483
"BLD",6786,"KRN",9.8,"NM",4,0)
GMVGETD^^0^B12427237
"BLD",6786,"KRN",9.8,"NM",5,0)
GMV22PST^^0^B25913830
"BLD",6786,"KRN",9.8,"NM",6,0)
GMVRPCM^^0^B78998924
"BLD",6786,"KRN",9.8,"NM","B","GMV22PST",5)

"BLD",6786,"KRN",9.8,"NM","B","GMVGETD",4)

"BLD",6786,"KRN",9.8,"NM","B","GMVRPCHL",3)

"BLD",6786,"KRN",9.8,"NM","B","GMVRPCM",6)

"BLD",6786,"KRN",9.8,"NM","B","GMVRPCP",2)

"BLD",6786,"KRN",19,0)
19
"BLD",6786,"KRN",19.1,0)
19.1
"BLD",6786,"KRN",101,0)
101
"BLD",6786,"KRN",409.61,0)
409.61
"BLD",6786,"KRN",771,0)
771
"BLD",6786,"KRN",870,0)
870
"BLD",6786,"KRN",8989.51,0)
8989.51
"BLD",6786,"KRN",8989.52,0)
8989.52
"BLD",6786,"KRN",8994,0)
8994
"BLD",6786,"KRN",8994,"NM",0)
^9.68A^2^2
"BLD",6786,"KRN",8994,"NM",1,0)
GMV WARD LOCATION^^0
"BLD",6786,"KRN",8994,"NM",2,0)
GMV LOCATION SELECT^^0
"BLD",6786,"KRN",8994,"NM","B","GMV LOCATION SELECT",2)

"BLD",6786,"KRN",8994,"NM","B","GMV WARD LOCATION",1)

"BLD",6786,"KRN","B",.4,.4)

"BLD",6786,"KRN","B",.401,.401)

"BLD",6786,"KRN","B",.402,.402)

"BLD",6786,"KRN","B",.403,.403)

"BLD",6786,"KRN","B",.5,.5)

"BLD",6786,"KRN","B",.84,.84)

"BLD",6786,"KRN","B",3.6,3.6)

"BLD",6786,"KRN","B",3.8,3.8)

"BLD",6786,"KRN","B",9.2,9.2)

"BLD",6786,"KRN","B",9.8,9.8)

"BLD",6786,"KRN","B",19,19)

"BLD",6786,"KRN","B",19.1,19.1)

"BLD",6786,"KRN","B",101,101)

"BLD",6786,"KRN","B",409.61,409.61)

"BLD",6786,"KRN","B",771,771)

"BLD",6786,"KRN","B",870,870)

"BLD",6786,"KRN","B",8989.51,8989.51)

"BLD",6786,"KRN","B",8989.52,8989.52)

"BLD",6786,"KRN","B",8994,8994)

"BLD",6786,"QUES",0)
^9.62^^
"BLD",6786,"REQB",0)
^9.611^1^1
"BLD",6786,"REQB",1,0)
GMRV*5.0*3^2
"BLD",6786,"REQB","B","GMRV*5.0*3",1)

"INIT")
EN^GMV22PST
"KRN",8994,459,-1)
0^1
"KRN",8994,459,0)
GMV WARD LOCATION^WARDLOC^GMVGETD^4^R^0^^1
"KRN",8994,459,1,0)
^^2^2^3061108^
"KRN",8994,459,1,1,0)
This procedure extracts MAS ward locations from the Ward Location file
"KRN",8994,459,1,2,0)
(#42).
"KRN",8994,459,2,0)
^8994.02A^1^1
"KRN",8994,459,2,1,0)
DUMMY^1^1^0^1
"KRN",8994,459,2,1,1,0)
^^2^2^3061108^
"KRN",8994,459,2,1,1,1,0)
When this input parameter is set to the letter "P", only wards that have 
"KRN",8994,459,2,1,1,2,0)
patients will be returned. Otherwise, all active wards will be returned.
"KRN",8994,459,2,"B","DUMMY",1)

"KRN",8994,459,2,"PARAMSEQ",1,1)

"KRN",8994,459,3,0)
^8994.03^31^31^3061108^^
"KRN",8994,459,3,1,0)
Returns the global array name containing a list of MAS wards (i.e., 
"KRN",8994,459,3,2,0)
^TMP($J,"GWARD")).
"KRN",8994,459,3,3,0)
 
"KRN",8994,459,3,4,0)
^TMP($J,"GWARD",n)=piece1^piece2^piece3
"KRN",8994,459,3,5,0)
 where:
"KRN",8994,459,3,6,0)
  piece1 = ward IEN (FILE 42)
"KRN",8994,459,3,7,0)
  piece2 = ward name (FILE 42, Field .01)
"KRN",8994,459,3,8,0)
  piece3 = hospital location IEN (FILE 44)
"KRN",8994,459,3,9,0)
  n is a sequential number starting at 1.
"KRN",8994,459,3,10,0)
 
"KRN",8994,459,3,11,0)
Example:
"KRN",8994,459,3,12,0)
 > S DUMMY="P" 
"KRN",8994,459,3,13,0)
 > D WARDLOC^GMVGETD(.RESULT,DUMMY) ZW RESULT
"KRN",8994,459,3,14,0)
 > RESULT="^TMP(540221719,"GWARD")"
"KRN",8994,459,3,15,0)
 > D ^%G
"KRN",8994,459,3,16,0)
 > Global ^TMP($J,"GWARD"
"KRN",8994,459,3,17,0)
 > ^TMP(540221719,"GWARD",1)=2^1AS^2
"KRN",8994,459,3,18,0)
                          2)=1^2-AS^1
"KRN",8994,459,3,19,0)
                          3)=13^2-ASM^67
"KRN",8994,459,3,20,0)
                          4)=25^214-2 DOM^149
"KRN",8994,459,3,21,0)
                          5)=3^3AS^128
"KRN",8994,459,3,22,0)
                          6)=4^4AS-1^4
"KRN",8994,459,3,23,0)
                          7)=22^4B^153
"KRN",8994,459,3,24,0)
                          8)=23^4C^155
"KRN",8994,459,3,25,0)
                          9)=24^4D^154
"KRN",8994,459,3,26,0)
                          10)=12^5NM^63
"KRN",8994,459,3,27,0)
                          11)=6^6AS^10
"KRN",8994,459,3,28,0)
                          12)=7^7AS^11
"KRN",8994,459,3,29,0)
                          13)=8^DOM^23
"KRN",8994,459,3,30,0)
                          14)=10^MICU^36
"KRN",8994,459,3,31,0)
                          15)=5^NHCU^5
"KRN",8994,2338,-1)
0^2
"KRN",8994,2338,0)
GMV LOCATION SELECT^RPC^GMVRPCHL^4^S^0^^1
"KRN",8994,2338,1,0)
^8994.01^4^4^3061108^^
"KRN",8994,2338,1,1,0)
Select a hospital location by name, from a patient appointment or from a
"KRN",8994,2338,1,2,0)
patient admission. Can also generate a list of active clinics.
"KRN",8994,2338,1,3,0)
 
"KRN",8994,2338,1,4,0)
This remote procedure is documented in Integration Agreement 4461.
"KRN",8994,2338,2,0)
^8994.02A^2^2
"KRN",8994,2338,2,1,0)
OPTION^1^10^1^1
"KRN",8994,2338,2,1,1,0)
^^1^1^3051206^
"KRN",8994,2338,2,1,1,1,0)
Routine tag line in GMVRPCHL to call.
"KRN",8994,2338,2,2,0)
DATA^1^100^1^2
"KRN",8994,2338,2,2,1,0)
^8994.021^1^1^3061108^^^^
"KRN",8994,2338,2,2,1,1,0)
Other data as required for the call.
"KRN",8994,2338,2,"B","DATA",2)

"KRN",8994,2338,2,"B","OPTION",1)

"KRN",8994,2338,2,"PARAMSEQ",1,1)

"KRN",8994,2338,2,"PARAMSEQ",2,2)

"KRN",8994,2338,3,0)
^^151^151^3061108^
"KRN",8994,2338,3,1,0)
This remote procedure call allows the user to select a hospital location. 
"KRN",8994,2338,3,2,0)
The entry point is RPC^GMVRPCHL. It has input parameters of RESULTS, 
"KRN",8994,2338,3,3,0)
OPTION and DATA (ex. RPC^GMVRPCHL(.RESULTS,OPTION,DATA).
"KRN",8994,2338,3,4,0)
 
"KRN",8994,2338,3,5,0)
The RESULTS variable will contain the ^TMP("GMVHLOC",$J) global array 
"KRN",8994,2338,3,6,0)
reference. The ^TMP("GMVHLOC",$J) global array contains the results.
"KRN",8994,2338,3,7,0)
 
"KRN",8994,2338,3,8,0)
The OPTION variable identifies a line label in the GMVRPCHL routine that 
"KRN",8994,2338,3,9,0)
will be invoked to process the call.
"KRN",8994,2338,3,10,0)
 
"KRN",8994,2338,3,11,0)
The DATA variable contains any additional values needed by the OPTION 
"KRN",8994,2338,3,12,0)
variable to process the call.
"KRN",8994,2338,3,13,0)
 
"KRN",8994,2338,3,14,0)
 1) When the OPTION value is NAME, this RPC will do a file lookup.
"KRN",8994,2338,3,15,0)
 
"KRN",8994,2338,3,16,0)
 The DATA value is a three part value separated by carets(^). The first 
"KRN",8994,2338,3,17,0)
 part is a file number. The second part is a value to look up. The third
"KRN",8994,2338,3,18,0)
 part is the field or fields to do the look up on. If the third piece is
"KRN",8994,2338,3,19,0)
 not defined, the lookup is done on the .01 field of the file.
"KRN",8994,2338,3,20,0)
 
"KRN",8994,2338,3,21,0)
 The TMP global contains:
"KRN",8994,2338,3,22,0)
  ^TMP("GMVHLOC",$J,0)=piece1
"KRN",8994,2338,3,23,0)
  ^TMP("GMVHLOC",$J,n)=piece2^piece3
"KRN",8994,2338,3,24,0)
 
"KRN",8994,2338,3,25,0)
   where piece1 = number of entries found
"KRN",8994,2338,3,26,0)
         piece2 = file number, a semi-colon and record IEN
"KRN",8994,2338,3,27,0)
         piece3 = field value
"KRN",8994,2338,3,28,0)
 
"KRN",8994,2338,3,29,0)
 Example:
"KRN",8994,2338,3,30,0)
 >S OPTION="NAME",DATA="44^OUTPATIENT^.01"    
"KRN",8994,2338,3,31,0)
 >D RPC^GMVRPCHL(.RESULT,OPTION,DATA) ZW RESULT
"KRN",8994,2338,3,32,0)
 >RESULT="^TMP("GMVHLOC",539052767)"
"KRN",8994,2338,3,33,0)
 >D ^%G
"KRN",8994,2338,3,34,0)
 >Global ^TMP("GMVHLOC",$J
"KRN",8994,2338,3,35,0)
 >^TMP("GMVHLOC",539052767,0)=3
"KRN",8994,2338,3,36,0)
                          1)=44;75^OUTPATIENT NUC MED
"KRN",8994,2338,3,37,0)
                          2)=44;74^OUTPATIENT RADIOLOGY
"KRN",8994,2338,3,38,0)
                          3)=44;80^OUTPATIENT ULTRASOUND
"KRN",8994,2338,3,39,0)
 
"KRN",8994,2338,3,40,0)
 
"KRN",8994,2338,3,41,0)
 2) When the OPTION value is APPT, this RPC will return a list of clinic 
"KRN",8994,2338,3,42,0)
 appointments for the patient.
"KRN",8994,2338,3,43,0)
 
"KRN",8994,2338,3,44,0)
 The DATA value is a four part value separated by carets(^). The first 
"KRN",8994,2338,3,45,0)
 piece is DFN. The second piece is the start date of the search. If 
"KRN",8994,2338,3,46,0)
 not defined, this value defaults to 365 days prior to today. The third 
"KRN",8994,2338,3,47,0)
 piece is the end date of the search. If not defined, the value defaults 
"KRN",8994,2338,3,48,0)
 to today. Both dates are in FileMan internal format. The fourth piece is
"KRN",8994,2338,3,49,0)
 a string of numbers to indicate what types of appointments to return. If
"KRN",8994,2338,3,50,0)
 not defined, the value defaults to "123456789" (i.e., all appointment
"KRN",8994,2338,3,51,0)
 types) where:
"KRN",8994,2338,3,52,0)
 
"KRN",8994,2338,3,53,0)
 1 - Active/Kept
"KRN",8994,2338,3,54,0)
 2 - Inpatient appts. only
"KRN",8994,2338,3,55,0)
 3 - No-shows 
"KRN",8994,2338,3,56,0)
 4 - No-shows, auto-rebook
"KRN",8994,2338,3,57,0)
 5 - Cancelled by clinic
"KRN",8994,2338,3,58,0)
 6 - Cancelled by clinic, auto rebook
"KRN",8994,2338,3,59,0)
 7 - Cancelled by patient
"KRN",8994,2338,3,60,0)
 8 - Cancelled by patient, auto rebook
"KRN",8994,2338,3,61,0)
 9 - No action taken
"KRN",8994,2338,3,62,0)
 
"KRN",8994,2338,3,63,0)
 The TMP global contains:
"KRN",8994,2338,3,64,0)
  ^TMP("GMVHLOC",$J,0)=piece1
"KRN",8994,2338,3,65,0)
  ^TMP("GMVHLOC",$J,n)=piece2^piece3^piece4^piece5^piece6^piece7
"KRN",8994,2338,3,66,0)
                       ^piece8^piece9^
"KRN",8994,2338,3,67,0)
 
"KRN",8994,2338,3,68,0)
   where piece1 = number of entries found
"KRN",8994,2338,3,69,0)
         piece2 = date/time of appt (FM internal)
"KRN",8994,2338,3,70,0)
         piece3 = date/time of appt (external)
"KRN",8994,2338,3,71,0)
         piece4 = hospital location IEN (FILE 44)
"KRN",8994,2338,3,72,0)
         piece5 = hospital location name (FILE 44, Field .01)
"KRN",8994,2338,3,73,0)
         piece6 = appt status (internal)
"KRN",8994,2338,3,74,0)
         piece7 = appt status (external)
"KRN",8994,2338,3,75,0)
         piece8 = appt type (internal)
"KRN",8994,2338,3,76,0)
         piece9 = appt type (external)
"KRN",8994,2338,3,77,0)
 
"KRN",8994,2338,3,78,0)
 Example:
"KRN",8994,2338,3,79,0)
 > S OPTION="APPT",DATA="78^3051201^3051206^"   
"KRN",8994,2338,3,80,0)
 > D RPC^GMVRPCHL(.RESULT,OPTION,DATA) ZW RESULT
"KRN",8994,2338,3,81,0)
 > RESULT="^TMP("GMVHLOC",539052767)"
"KRN",8994,2338,3,82,0)
 > D ^%G
"KRN",8994,2338,3,83,0)
 > Global ^TMP("GMVHLOC",$J
"KRN",8994,2338,3,84,0)
 > ^TMP("GMVHLOC",539052767,0)=1
"KRN",8994,2338,3,85,0)
                            1)=3051206.1^DEC 6,2005@10:00^88^WEIGHT 
"KRN",8994,2338,3,86,0)
                               CLINIC^^^9^REGULAR
"KRN",8994,2338,3,87,0)
 
"KRN",8994,2338,3,88,0)
 3) When the OPTION value is ADMIT, this RPC will return a list of 
"KRN",8994,2338,3,89,0)
 hospital admissions for the patient specified.
"KRN",8994,2338,3,90,0)
 
"KRN",8994,2338,3,91,0)
 The DATA value is the patient's DFN.
"KRN",8994,2338,3,92,0)
 
"KRN",8994,2338,3,93,0)
 The TMP global contains:
"KRN",8994,2338,3,94,0)
  ^TMP("GMVHLOC",$J,0)=piece1
"KRN",8994,2338,3,95,0)
  ^TMP("GMVHLOC",$J,n)=piece2^piece3^piece4^piece5^piece6
"KRN",8994,2338,3,96,0)
 
"KRN",8994,2338,3,97,0)
   where piece1 = number of entries found
"KRN",8994,2338,3,98,0)
         piece2 = date/time of admission (external) 
"KRN",8994,2338,3,99,0)
         piece3 = hospital location IEN (FILE 44)
"KRN",8994,2338,3,100,0)
         piece4 = hospital location name (FILE 44, Field .01)
"KRN",8994,2338,3,101,0)
         piece5 = type of movement (FILE 405.1, Field .01)
"KRN",8994,2338,3,102,0)
         piece6 = movement IEN (FILE 405)
"KRN",8994,2338,3,103,0)
 
"KRN",8994,2338,3,104,0)
 Example:
"KRN",8994,2338,3,105,0)
 > S OPTION="ADMIT",DATA=134
"KRN",8994,2338,3,106,0)
 > D RPC^GMVRPCHL(.RESULT,OPTION,DATA) ZW RESULT
"KRN",8994,2338,3,107,0)
 > RESULT="^TMP("GMVHLOC",539052767)"
"KRN",8994,2338,3,108,0)
 > D ^%G
"KRN",8994,2338,3,109,0)
 > Global ^TMP("GMVHLOC",$J
"KRN",8994,2338,3,110,0)
 > ^TMP("GMVHLOC",539052767,0)=1 
"KRN",8994,2338,3,111,0)
                            1)=Apr 09, 2001 1:48:43 pm^67^
"KRN",8994,2338,3,112,0)
                               2-ASM^DIRECT^1712 
"KRN",8994,2338,3,113,0)
 
"KRN",8994,2338,3,114,0)
 
"KRN",8994,2338,3,115,0)
 4) When the OPTION value is CLINIC, this RPC will return a list of 
"KRN",8994,2338,3,116,0)
 active clinics.
"KRN",8994,2338,3,117,0)
 
"KRN",8994,2338,3,118,0)
 The DATA value is FROM^MAXIMUM^DIRECTION.
"KRN",8994,2338,3,119,0)
    Where:
"KRN",8994,2338,3,120,0)
          FROM = Value to begin the search (optional). Default is 
"KRN",8994,2338,3,121,0)
                 null (i.e., start with the first entry in the B x-ref).
"KRN",8994,2338,3,122,0)
       MAXIMUM = Maximum number of entries to return. (optional) 
"KRN",8994,2338,3,123,0)
                 Default is 100.
"KRN",8994,2338,3,124,0)
     DIRECTION = Direction of search (optional). 1 means forward and -1 
"KRN",8994,2338,3,125,0)
                 means backwards. Default is 1.
"KRN",8994,2338,3,126,0)
 
"KRN",8994,2338,3,127,0)
 The TMP global contains:
"KRN",8994,2338,3,128,0)
  ^TMP("GMVHLOC",$J,0)=piece1
"KRN",8994,2338,3,129,0)
  ^TMP("GMVHLOC",$J,n)=piece2^piece3
"KRN",8994,2338,3,130,0)
            
"KRN",8994,2338,3,131,0)
   where piece1 = number of entries found
"KRN",8994,2338,3,132,0)
         piece2 = 44;ien (44, a semi-colon and the entry number)
"KRN",8994,2338,3,133,0)
         piece3 = location name (FILE 44, Field .01)
"KRN",8994,2338,3,134,0)
         n is a sequential number starting with zero
"KRN",8994,2338,3,135,0)
                  
"KRN",8994,2338,3,136,0)
 Example:
"KRN",8994,2338,3,137,0)
 > S OPTION="CLINIC",DATA="A^5^1"                           
"KRN",8994,2338,3,138,0)
 > K RESULTS D RPC^GMVRPCHL(.RESULTS,OPTION,DATA) ZW RESULTS
"KRN",8994,2338,3,139,0)
 > RESULTS="^TMP("GMVHLOC",540221719)"
"KRN",8994,2338,3,140,0)
 > D ^%G
"KRN",8994,2338,3,141,0)
 > Global ^TMP("GMVHLOC",$J
"KRN",8994,2338,3,142,0)
 > ^TMP("GMVHLOC",540221719,0)=5
"KRN",8994,2338,3,143,0)
                            1)=44;140^ANDY'S AUDIO NON-COUNT CLINIC
"KRN",8994,2338,3,144,0)
                            2)=44;139^ANDY'S AUDIOLOGY COUNT CLINIC
"KRN",8994,2338,3,145,0)
                            3)=44;76^AUDIOLOGY AND SPEECH PATHOLOGY
"KRN",8994,2338,3,146,0)
                            4)=44;87^BARB'S CLINIC
"KRN",8994,2338,3,147,0)
                            5)=44;217^BOISE OUTPATIENT
"KRN",8994,2338,3,148,0)
 
"KRN",8994,2338,3,149,0)
If an error is encountered for NAME, ADMIT, APPT or CLINIC, a "-1"
"KRN",8994,2338,3,150,0)
followed by a caret and the error message text (i.e., -1^error message) is
"KRN",8994,2338,3,151,0)
returned in RESULT(0).
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",44,-1)
1^1
"PKG",44,0)
GEN. MED. REC. - VITALS^GMRV^Vitals/Measurements Module of General Medical Record.
"PKG",44,20,0)
^9.402P^^
"PKG",44,22,0)
^9.49I^1^1
"PKG",44,22,1,0)
5.0^3021029
"PKG",44,22,1,"PAH",1,0)
22^3080708
"PKG",44,22,1,"PAH",1,1,0)
^^2^2^3080708
"PKG",44,22,1,"PAH",1,1,1,0)
Vitals Measurement GUI Updates
"PKG",44,22,1,"PAH",1,1,2,0)
MISCELLANEOUS MAINTENANCE ISSUES
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","GMV22PST")
0^5^B25913830^n/a
"RTN","GMV22PST",1,0)
GMV22PST ;HOIFO/FT-POST INSTALLATION FOR GMRV*5*22 ; 10/4/07 7:54am
"RTN","GMV22PST",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**22**;Oct 31, 2002;Build 22
"RTN","GMV22PST",3,0)
 ;
"RTN","GMV22PST",4,0)
 ; This routine uses the following IAs:
"RTN","GMV22PST",5,0)
 ; #2263  - XPAR calls                  (supported)
"RTN","GMV22PST",6,0)
 ; #10141 - XPDUTL calls                (supported)
"RTN","GMV22PST",7,0)
 ;
"RTN","GMV22PST",8,0)
EN ; Main entry point
"RTN","GMV22PST",9,0)
 D XPAR,DLL,STANDING,TEMPLATE,WEBLINK
"RTN","GMV22PST",10,0)
 Q
"RTN","GMV22PST",11,0)
XPAR ; Setup preliminary parameters. This subroutine is called during the
"RTN","GMV22PST",12,0)
 ; KIDS installation process.
"RTN","GMV22PST",13,0)
 ;
"RTN","GMV22PST",14,0)
 ; Variables:
"RTN","GMV22PST",15,0)
 ;  GMV:    [Private] Scratch
"RTN","GMV22PST",16,0)
 ;  GMVGUI: [Private] Current version of GUI being installed
"RTN","GMV22PST",17,0)
 ;  GMVLST: [Private] Scratch List
"RTN","GMV22PST",18,0)
 ;
"RTN","GMV22PST",19,0)
 ; NEW private variables
"RTN","GMV22PST",20,0)
 N GMV,GMVGUI,GMVLST
"RTN","GMV22PST",21,0)
 ; Announce my intentions
"RTN","GMV22PST",22,0)
 D BMES^XPDUTL("Updating system parameters.")
"RTN","GMV22PST",23,0)
 ; Set current client version
"RTN","GMV22PST",24,0)
 S GMVGUI="5.0.22.7"
"RTN","GMV22PST",25,0)
 ; Deactivate all previous versions from XPAR
"RTN","GMV22PST",26,0)
 D GETLST^XPAR(.GMVLST,"SYS","GMV GUI VERSION")
"RTN","GMV22PST",27,0)
 F GMV=0:0 S GMV=$O(GMVLST(GMV)) Q:'GMV  D
"RTN","GMV22PST",28,0)
 .D EN^XPAR("SYS","GMV GUI VERSION",$P(GMVLST(GMV),"^",1),0)
"RTN","GMV22PST",29,0)
 .Q
"RTN","GMV22PST",30,0)
 ; Add and/or activate current client versions
"RTN","GMV22PST",31,0)
 D EN^XPAR("SYS","GMV GUI VERSION","VITALS.EXE:"_GMVGUI,1)
"RTN","GMV22PST",32,0)
 D EN^XPAR("SYS","GMV GUI VERSION","VITALSMANAGER.EXE:"_GMVGUI,1)
"RTN","GMV22PST",33,0)
 Q
"RTN","GMV22PST",34,0)
STANDING ; Disassociate STANDING qualifier from WEIGHT vital type
"RTN","GMV22PST",35,0)
 N GMVCAT,GMVDA,GMVERR,GMVFDA,GMVIENS,GMVQUAL,GMVT
"RTN","GMV22PST",36,0)
 D BMES^XPDUTL("Checking STANDING qualifier...")
"RTN","GMV22PST",37,0)
 S GMVT=$O(^GMRD(120.51,"B","WEIGHT",0))
"RTN","GMV22PST",38,0)
 Q:'GMVT
"RTN","GMV22PST",39,0)
 S GMVQUAL=$O(^GMRD(120.52,"B","STANDING",0))
"RTN","GMV22PST",40,0)
 Q:'GMVQUAL
"RTN","GMV22PST",41,0)
 S GMVCAT=$O(^GMRD(120.53,"B","METHOD",0))
"RTN","GMV22PST",42,0)
 Q:'GMVCAT
"RTN","GMV22PST",43,0)
 I $D(^GMRD(120.52,GMVQUAL,1,"B",GMVT)) D
"RTN","GMV22PST",44,0)
 .S GMVDA=$O(^GMRD(120.52,GMVQUAL,1,"B",GMVT,0))
"RTN","GMV22PST",45,0)
 .Q:'GMVDA
"RTN","GMV22PST",46,0)
 .N DA,DIK
"RTN","GMV22PST",47,0)
 .S DA(1)=GMVQUAL,DA=GMVDA
"RTN","GMV22PST",48,0)
 .S DIK="^GMRD(120.52,DA(1),1,"
"RTN","GMV22PST",49,0)
 .D ^DIK
"RTN","GMV22PST",50,0)
 .Q
"RTN","GMV22PST",51,0)
 I $D(^GMRD(120.53,GMVCAT,1,"B",GMVT)) D
"RTN","GMV22PST",52,0)
 .S GMVDA=$O(^GMRD(120.53,GMVCAT,1,"B",GMVT,0))
"RTN","GMV22PST",53,0)
 .Q:'GMVDA
"RTN","GMV22PST",54,0)
 .S GMVIENS=GMVDA_","_GMVCAT_","
"RTN","GMV22PST",55,0)
 .S GMVFDA(120.531,GMVIENS,.07)="@"
"RTN","GMV22PST",56,0)
 .D FILE^DIE("","GMVFDA","GMVERR")
"RTN","GMV22PST",57,0)
 .;I
"RTN","GMV22PST",58,0)
 .Q
"RTN","GMV22PST",59,0)
 Q
"RTN","GMV22PST",60,0)
TEMPLATE ; remove STANDING from template if used with WEIGHT and METHOD
"RTN","GMV22PST",61,0)
 N GMV,GMV1,GMV2,GMVCQ,GMVDESC,GMVI,GMVJ,GMVLIST,GMVMETHD,GMVNEW,GMVNODE,GMVOLD,GMVORIG,GMVSTAND,GMVWT,GMVX,GMVY
"RTN","GMV22PST",62,0)
 D BMES^XPDUTL("Checking input template definitions...")
"RTN","GMV22PST",63,0)
 S GMVWT=$O(^GMRD(120.51,"C","WT",0))
"RTN","GMV22PST",64,0)
 Q:'GMVWT
"RTN","GMV22PST",65,0)
 S GMVMETHD=$O(^GMRD(120.53,"B","METHOD",0))
"RTN","GMV22PST",66,0)
 Q:'GMVMETHD
"RTN","GMV22PST",67,0)
 S GMVSTAND=$O(^GMRD(120.52,"B","STANDING",0))
"RTN","GMV22PST",68,0)
 Q:'GMVSTAND
"RTN","GMV22PST",69,0)
 K ^TMP($J)
"RTN","GMV22PST",70,0)
 S GMVLIST=$NA(^TMP($J))
"RTN","GMV22PST",71,0)
 D ENVAL^XPAR(.GMVLIST,"GMV TEMPLATE","","",1)
"RTN","GMV22PST",72,0)
 Q:'$D(^TMP($J))
"RTN","GMV22PST",73,0)
 S GMVCQ=GMVMETHD_","_GMVSTAND
"RTN","GMV22PST",74,0)
 S GMV1="" ; ien;file
"RTN","GMV22PST",75,0)
 F  S GMV1=$O(^TMP($J,GMV1)) Q:GMV1=""  D
"RTN","GMV22PST",76,0)
 .S GMV2="" ;template name
"RTN","GMV22PST",77,0)
 .F  S GMV2=$O(^TMP($J,GMV1,GMV2)) Q:GMV2=""  D
"RTN","GMV22PST",78,0)
 ..S (GMVNODE,GMVORIG)=$G(^TMP($J,GMV1,GMV2))
"RTN","GMV22PST",79,0)
 ..Q:GMVNODE=""
"RTN","GMV22PST",80,0)
 ..Q:GMVNODE'[GMVCQ  ;ignore templates that don't matter
"RTN","GMV22PST",81,0)
 ..S GMVDESC=$P(GMVNODE,"|",1) ;template description
"RTN","GMV22PST",82,0)
 ..S GMVNODE=$P(GMVNODE,"|",2)
"RTN","GMV22PST",83,0)
 ..K GMV ;array of vital types
"RTN","GMV22PST",84,0)
 ..F GMVI=1:1 Q:$P(GMVNODE,";",GMVI)=""  S GMV(GMVI)=$P(GMVNODE,";",GMVI)
"RTN","GMV22PST",85,0)
 ..S GMVI=0
"RTN","GMV22PST",86,0)
 ..F  S GMVI=$O(GMV(GMVI)) Q:'GMVI  D
"RTN","GMV22PST",87,0)
 ...S GMVX=GMV(GMVI)
"RTN","GMV22PST",88,0)
 ...Q:GMVX=""
"RTN","GMV22PST",89,0)
 ...S GMVY=$P(GMVX,":",1,2) ;vital ien:metric indicator
"RTN","GMV22PST",90,0)
 ...S GMVX=$P(GMVX,":",3) ;~categories,qualifiers~
"RTN","GMV22PST",91,0)
 ...Q:GMVX=""
"RTN","GMV22PST",92,0)
 ...S GMVNEW=""
"RTN","GMV22PST",93,0)
 ...F GMVJ=1:1 Q:$P(GMVX,"~",GMVJ)=""  D
"RTN","GMV22PST",94,0)
 ....S GMVOLD=$P(GMVX,"~",GMVJ) ;each category & qualifier combo
"RTN","GMV22PST",95,0)
 ....I $P(GMVY,":",1)=GMVWT,GMVOLD=GMVCQ Q 
"RTN","GMV22PST",96,0)
 ....S GMVNEW=GMVNEW_GMVOLD_"~"
"RTN","GMV22PST",97,0)
 ...I $E(GMVNEW,$L(GMVNEW))="~" S GMVNEW=$E(GMVNEW,1,($L(GMVNEW)-1))
"RTN","GMV22PST",98,0)
 ...S:GMVNEW]"" GMVNEW=GMVY_":"_GMVNEW
"RTN","GMV22PST",99,0)
 ...S:GMVNEW="" GMVNEW=GMVY
"RTN","GMV22PST",100,0)
 ...S GMV(GMVI)=GMVNEW
"RTN","GMV22PST",101,0)
 ..S GMVI=0,GMVNODE=GMVDESC_"|"
"RTN","GMV22PST",102,0)
 ..F  S GMVI=$O(GMV(GMVI)) Q:'GMVI  D
"RTN","GMV22PST",103,0)
 ...S GMVNODE=GMVNODE_GMV(GMVI)_";"
"RTN","GMV22PST",104,0)
 ...Q
"RTN","GMV22PST",105,0)
 ..I $E(GMVNODE,$L(GMVNODE))=";" S GMVNODE=$E(GMVNODE,1,($L(GMVNODE)-1))
"RTN","GMV22PST",106,0)
 ..I $E(GMVNODE,$L(GMVNODE))="|" S GMVNODE=$E(GMVNODE,1,($L(GMVNODE)-1))
"RTN","GMV22PST",107,0)
 ..I GMVNODE=GMVORIG Q  ;no change in template
"RTN","GMV22PST",108,0)
 ..W !,GMVNODE
"RTN","GMV22PST",109,0)
 ..W !,GMVORIG,!
"RTN","GMV22PST",110,0)
 ..D EN^XPAR(GMV1,"GMV TEMPLATE",GMV2,GMVNODE,.GMVERR)
"RTN","GMV22PST",111,0)
 ..Q
"RTN","GMV22PST",112,0)
 .Q
"RTN","GMV22PST",113,0)
 K ^TMP($J)
"RTN","GMV22PST",114,0)
 Q
"RTN","GMV22PST",115,0)
WEBLINK ; Update web link used by HELP menu
"RTN","GMV22PST",116,0)
 ; Don't change weblink if site has replaced our weblink with something
"RTN","GMV22PST",117,0)
 ; else (i.e., their own)
"RTN","GMV22PST",118,0)
 N GMVNEW,GMVOLD
"RTN","GMV22PST",119,0)
 S GMVOLD="http://vista.med.va.gov/ClinicalSpecialties/vitals/"
"RTN","GMV22PST",120,0)
 S GMVNEW="http://vista.med.va.gov/ClinicalSpecialties/vitals/index.asp"
"RTN","GMV22PST",121,0)
 D RPC^GMVPAR(.GMVX,"GETPAR","SYS","GMV WEBLINK") ;get current link
"RTN","GMV22PST",122,0)
 I $G(^TMP($J,0))=GMVOLD D
"RTN","GMV22PST",123,0)
 .D EN^XPAR("SYS","GMV WEBLINK",1,GMVNEW)
"RTN","GMV22PST",124,0)
 .Q
"RTN","GMV22PST",125,0)
 Q
"RTN","GMV22PST",126,0)
DLL ;
"RTN","GMV22PST",127,0)
 ; Variables:
"RTN","GMV22PST",128,0)
 ;  GMV:    [Private] Scratch
"RTN","GMV22PST",129,0)
 ;  GMVDLL: [Private] Current version of DLL being installed
"RTN","GMV22PST",130,0)
 ;  GMVLST: [Private] Scratch List
"RTN","GMV22PST",131,0)
 ;
"RTN","GMV22PST",132,0)
 ; New private variables
"RTN","GMV22PST",133,0)
 N GMV,GMVDLL,GMVLST
"RTN","GMV22PST",134,0)
 ; Announce my intentions
"RTN","GMV22PST",135,0)
 D BMES^XPDUTL("Updating DLL parameter.")
"RTN","GMV22PST",136,0)
 ; Deactivate all previous versions from XPAR
"RTN","GMV22PST",137,0)
 D GETLST^XPAR(.GMVLST,"SYS","GMV DLL VERSION")
"RTN","GMV22PST",138,0)
 F GMV=0:0 S GMV=$O(GMVLST(GMV)) Q:'GMV  D
"RTN","GMV22PST",139,0)
 .D EN^XPAR("SYS","GMV DLL VERSION",$P(GMVLST(GMV),"^",1),0)
"RTN","GMV22PST",140,0)
 ; Add and/or activate current client versions
"RTN","GMV22PST",141,0)
 S GMVDLL="GMV_VITALSVIEWENTER.DLL:v. 03/14/06 16:35" ;patch 3
"RTN","GMV22PST",142,0)
 D EN^XPAR("SYS","GMV DLL VERSION",GMVDLL,1)
"RTN","GMV22PST",143,0)
 S GMVDLL="GMV_VITALSVIEWENTER.DLL:v. 05/12/08 08:44" ;patch 22
"RTN","GMV22PST",144,0)
 D EN^XPAR("SYS","GMV DLL VERSION",GMVDLL,1)
"RTN","GMV22PST",145,0)
 Q
"RTN","GMVGETD")
0^4^B12427237^B11418226
"RTN","GMVGETD",1,0)
GMVGETD ;HOIFO/YH,FT-EXTRACTS WARD/ROOM-BED/PT AND PT VITALS ;5/10/07
"RTN","GMVGETD",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**3,22**;Oct 31, 2002;Build 22
"RTN","GMVGETD",3,0)
 ;
"RTN","GMVGETD",4,0)
 ; This routine uses the following IAs:
"RTN","GMVGETD",5,0)
 ; #1380  - ^DG(405.4 references   (controlled)
"RTN","GMVGETD",6,0)
 ; #1377  - ^DIC(42 references     (controlled)
"RTN","GMVGETD",7,0)
 ; #10035 - FILE 2 references      (supported)
"RTN","GMVGETD",8,0)
 ; #10039 - FILE 42 references     (supported)
"RTN","GMVGETD",9,0)
 ; #10103 - ^XLFDT calls           (supported)
"RTN","GMVGETD",10,0)
 ;
"RTN","GMVGETD",11,0)
 ; This routine supports the following IAs:
"RTN","GMVGETD",12,0)
 ; #4416 - GMV EXTRACT REC RPC is called at GETVM  (private)
"RTN","GMVGETD",13,0)
 ; #4358 - GMV LATEST VM RPC is called at GETLAT (private)
"RTN","GMVGETD",14,0)
 ;
"RTN","GMVGETD",15,0)
GETVM(RESULT,GMRVDATA) ;GMV EXTRACT REC [RPC entry point]
"RTN","GMVGETD",16,0)
 ;RETURNS VITALS/MEASUREMENTS FOR A PARTICULAR PATIENT A FOR GIVEN DATE/TIME SPAN IN RESULT ARRAY.
"RTN","GMVGETD",17,0)
 ;GMRVDATA = DFN^END DATE VITAL TAKEN^VITAL TYPE (OPTIONAL)^START DATE VITAL TAKEN
"RTN","GMVGETD",18,0)
 N GMVDAYS,DFN,GMRVSDT,GMRVFDT,GMVTYPE S DFN=+$P(GMRVDATA,"^"),GMRVSDT=+$P(GMRVDATA,"^",2),GMVDAYS=$P(GMRVDATA,"^",4),GMVTYPE=$P(GMRVDATA,"^",3) K ^TMP($J,"GRPC")
"RTN","GMVGETD",19,0)
 S GMRVFDT=$P(GMRVSDT,".",1)_".2400"
"RTN","GMVGETD",20,0)
 I GMVDAYS'="" S GMRVSDT=$P(GMVDAYS,".",1)
"RTN","GMVGETD",21,0)
 S:GMVTYPE'="" GMVTYPE(1)=$P(^GMRD(120.51,$O(^GMRD(120.51,"C",GMVTYPE,0)),0),"^")
"RTN","GMVGETD",22,0)
 D EN1^GMVGETD1
"RTN","GMVGETD",23,0)
 I '$D(^TMP($J,"GRPC")) S ^TMP($J,"GRPC",1)="0^NO "_$S(GMVTYPE'="":GMVTYPE(1),1:"VITALS/MEASUREMENTS ")_" ENTERED WITHIN THIS PERIOD"
"RTN","GMVGETD",24,0)
 S RESULT=$NA(^TMP($J,"GRPC"))
"RTN","GMVGETD",25,0)
 K GMRDT,GMRVARY,GMRVITY,GMRVX,GMRZZ
"RTN","GMVGETD",26,0)
 Q
"RTN","GMVGETD",27,0)
GETLAT(RESULT,GMRDFN) ;GMV LATEST VM [RPC entry point]
"RTN","GMVGETD",28,0)
 ; RETURNS THE LATEST VITALS/MEASUREMENTS FOR A GIVEN PATIENT(GMRDFN)
"RTN","GMVGETD",29,0)
 ; IN RESULT ARRAY.
"RTN","GMVGETD",30,0)
 K ^TMP($J,"GRPC") D EN1^GMVLAT0(GMRDFN)
"RTN","GMVGETD",31,0)
 S RESULT=$NA(^TMP($J,"GRPC"))
"RTN","GMVGETD",32,0)
 Q
"RTN","GMVGETD",33,0)
WARDLOC(RESULT,DUMMY) ;GMV WARD LOCATION [RPC entry point]
"RTN","GMVGETD",34,0)
 ;RETURNS MAS WARD LOCATIONS IN RESULT ARRAY
"RTN","GMVGETD",35,0)
 K ^TMP($J,"GWARD"),^TMP($J,"GMRV") N GMRWARD,GINDEX,GN,GMR
"RTN","GMVGETD",36,0)
 S DUMMY=$G(DUMMY)
"RTN","GMVGETD",37,0)
 S DUMMY=$$UP^XLFSTR(DUMMY)
"RTN","GMVGETD",38,0)
 S DUMMY=$S(DUMMY="P":"P",1:"A")
"RTN","GMVGETD",39,0)
 D LIST^DIC(42,"","","","*","","","","I '$$INACT42^GMVUT2(+Y)","","^TMP($J,""GMRV"")")
"RTN","GMVGETD",40,0)
 S GINDEX=+$P($G(^TMP($J,"GMRV","DILIST",0)),"^")
"RTN","GMVGETD",41,0)
 I GINDEX>0 D
"RTN","GMVGETD",42,0)
 . S (GMR,GN)=0 F  S GN=$O(^TMP($J,"GMRV","DILIST",1,GN)) Q:GN'>0  D
"RTN","GMVGETD",43,0)
 . . S GMRWARD(1)=^TMP($J,"GMRV","DILIST",1,GN),GMRWARD=+^TMP($J,"GMRV","DILIST",2,GN)
"RTN","GMVGETD",44,0)
 . . I DUMMY="P" D  Q
"RTN","GMVGETD",45,0)
 . . . I $O(^DPT("CN",GMRWARD(1),0))>0 S GMR=GMR+1,^TMP($J,"GWARD",GMR)=GMRWARD_"^"_GMRWARD(1)_U_^DIC(42,GMRWARD,44)
"RTN","GMVGETD",46,0)
 . . I DUMMY="A" D
"RTN","GMVGETD",47,0)
 . . . S GMR=GMR+1,^TMP($J,"GWARD",GMR)=GMRWARD_"^"_GMRWARD(1)_U_^DIC(42,GMRWARD,44)
"RTN","GMVGETD",48,0)
 K ^TMP($J,"GMRV") S RESULT=$NA(^TMP($J,"GWARD"))
"RTN","GMVGETD",49,0)
 Q
"RTN","GMVGETD",50,0)
WARDPT(RESULT,GMRWARD) ;GMV WARD PT [RPC entry point]
"RTN","GMVGETD",51,0)
 ;RETURNS A LIST OF PATIENTS ADMITTED TO A GIVEN MAS WARD(GMRWARD) IN RESULT ARRAY.
"RTN","GMVGETD",52,0)
 Q:'$D(^DPT("CN",GMRWARD))
"RTN","GMVGETD",53,0)
 N OUT,GN,DFN,DFN1,GMVPAT
"RTN","GMVGETD",54,0)
 K ^TMP($J,"GMRPT")
"RTN","GMVGETD",55,0)
 S (GN,DFN)=0 F  S DFN=$O(^DPT("CN",GMRWARD,DFN)) Q:DFN'>0  D
"RTN","GMVGETD",56,0)
 . I $D(^DPT(DFN,0)) D
"RTN","GMVGETD",57,0)
 . . S GMVPAT=""
"RTN","GMVGETD",58,0)
 . . D PTINFO^GMVUTL3(.GMVPAT,DFN)
"RTN","GMVGETD",59,0)
 . . S OUT($P(^DPT(DFN,0),"^"),DFN)=DFN_"^"_$P(^DPT(DFN,0),"^")_"^"_GMVPAT
"RTN","GMVGETD",60,0)
 I '$D(OUT) Q
"RTN","GMVGETD",61,0)
 S DFN=""
"RTN","GMVGETD",62,0)
 F  S DFN=$O(OUT(DFN)) Q:DFN=""  D
"RTN","GMVGETD",63,0)
 .S DFN1=0
"RTN","GMVGETD",64,0)
 .F  S DFN1=$O(OUT(DFN,DFN1)) Q:'DFN1  D
"RTN","GMVGETD",65,0)
 ..S GN=GN+1,^TMP($J,"GMRPT",GN)=OUT(DFN,DFN1)
"RTN","GMVGETD",66,0)
 ..Q
"RTN","GMVGETD",67,0)
 .Q
"RTN","GMVGETD",68,0)
 S RESULT=$NA(^TMP($J,"GMRPT"))
"RTN","GMVGETD",69,0)
 Q
"RTN","GMVGETD",70,0)
ROOMBED(RESULT,GMRWARD) ;GMV ROOM/BED [RPC entry point]
"RTN","GMVGETD",71,0)
 ;RETURNS A LIST OF ROOMS/BEDS FOR A GIVEN MAS WARD(GMRWARD) IN RESULT ARRAY.
"RTN","GMVGETD",72,0)
 Q:'$D(^DIC(42,"B",GMRWARD))
"RTN","GMVGETD",73,0)
 N GN,GROOM,GWARD,GMVTMP K ^TMP($J,"GROOM")
"RTN","GMVGETD",74,0)
 S (GN,GROOM)=0,GWARD=$O(^DIC(42,"B",GMRWARD,0)) I GWARD'>0 S ^TMP($J,"GROOM",1)="NO ROOM" G QUIT
"RTN","GMVGETD",75,0)
 F  S GROOM=$O(^DG(405.4,"W",GWARD,GROOM)) Q:GROOM'>0  I $D(^DG(405.4,GROOM)) D 
"RTN","GMVGETD",76,0)
 . S GMVTMP($P($P(^DG(405.4,GROOM,0),"^"),"-",1))=GROOM
"RTN","GMVGETD",77,0)
 . ;S GN=GN+1,^TMP($J,"GROOM",GN)=GROOM_"^"_$P(^DG(405.4,GROOM,0),"^")
"RTN","GMVGETD",78,0)
 . Q
"RTN","GMVGETD",79,0)
 S GROOM="",GN=0
"RTN","GMVGETD",80,0)
 F  S GROOM=$O(GMVTMP(GROOM)) Q:GROOM=""  D
"RTN","GMVGETD",81,0)
 . S GN=GN+1,^TMP($J,"GROOM",GN)=GMVTMP(GROOM)_"^"_GROOM
"RTN","GMVGETD",82,0)
 . Q
"RTN","GMVGETD",83,0)
QUIT S RESULT=$NA(^TMP($J,"GROOM"))
"RTN","GMVGETD",84,0)
 Q
"RTN","GMVRPCHL")
0^3^B30986483^B17869735
"RTN","GMVRPCHL",1,0)
GMVRPCHL ;HIOFO/FT-RPC FOR HOSPITAL LOCATION SELECTION ;12/7/05  10:32
"RTN","GMVRPCHL",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**3,22**;Oct 31, 2002;Build 22
"RTN","GMVRPCHL",3,0)
 ;
"RTN","GMVRPCHL",4,0)
 ; This routine uses the following IAs:
"RTN","GMVRPCHL",5,0)
 ;  #1378 - DGPM references        (controlled)
"RTN","GMVRPCHL",6,0)
 ;  #2965 - FILE 405.1 references  (controlled)
"RTN","GMVRPCHL",7,0)
 ; #10039 - FILE 42 references     (supported)
"RTN","GMVRPCHL",8,0)
 ; #10040 - FILE 44 references     (supported)
"RTN","GMVRPCHL",9,0)
 ; #10061 - ^VADPT calls           (supported)
"RTN","GMVRPCHL",10,0)
 ; #10103 - ^XLFDT calls           (supported)
"RTN","GMVRPCHL",11,0)
 ;
"RTN","GMVRPCHL",12,0)
 ; This routine supports the following IAs:
"RTN","GMVRPCHL",13,0)
 ; #4461 - GMV LOCATION SELECT RPC is called at RPC  (private)
"RTN","GMVRPCHL",14,0)
 ;
"RTN","GMVRPCHL",15,0)
RPC(RESULTS,OPTION,DATA) ; [Procedure] Main RPC call tag
"RTN","GMVRPCHL",16,0)
 ; RPC: [GMV LOCATION SELECT]
"RTN","GMVRPCHL",17,0)
 ;
"RTN","GMVRPCHL",18,0)
 ; Input parameters
"RTN","GMVRPCHL",19,0)
 ;  1. RESULTS [Reference/Required] RPC Return array
"RTN","GMVRPCHL",20,0)
 ;  2. OPTION [Literal/Required] RPC Option to execute
"RTN","GMVRPCHL",21,0)
 ;  3. DATA [Literal/Required] Other data as required for call
"RTN","GMVRPCHL",22,0)
 ;
"RTN","GMVRPCHL",23,0)
 S RESULTS=$NA(^TMP("GMVHLOC",$J)) K @RESULTS
"RTN","GMVRPCHL",24,0)
 D:$T(@OPTION)]"" @OPTION
"RTN","GMVRPCHL",25,0)
 S:'$D(@RESULTS) @RESULTS@(0)="-1^No results returned"
"RTN","GMVRPCHL",26,0)
 D CLEAN^DILF,KVAR^VADPT
"RTN","GMVRPCHL",27,0)
 Q
"RTN","GMVRPCHL",28,0)
NAME ; Return list of clinics and wards by name
"RTN","GMVRPCHL",29,0)
 ; DATA=pieceA^pieceB^pieceC
"RTN","GMVRPCHL",30,0)
 ;  where pieceA - file number (required)
"RTN","GMVRPCHL",31,0)
 ;        pieceB - value to begin search with (required)
"RTN","GMVRPCHL",32,0)
 ;        pieceC - field(s) to do the look-up on (optional, defaults to .01 field)
"RTN","GMVRPCHL",33,0)
 ;
"RTN","GMVRPCHL",34,0)
 ; RESULTS(0)=piece1^piece2
"RTN","GMVRPCHL",35,0)
 ; RESULTS(n)=piece3
"RTN","GMVRPCHL",36,0)
 ;  where piece1 - -1 if error OR number of entries found
"RTN","GMVRPCHL",37,0)
 ;        piece2 - error message if piece1=-1
"RTN","GMVRPCHL",38,0)
 ;        piece3 - field values requested.
"RTN","GMVRPCHL",39,0)
 ;             n - sequential number starting with 1
"RTN","GMVRPCHL",40,0)
 ; 
"RTN","GMVRPCHL",41,0)
 N GMVSCRN,GMVFLD,X
"RTN","GMVRPCHL",42,0)
 S DATA=$G(DATA)
"RTN","GMVRPCHL",43,0)
 I +DATA'>0 D  Q
"RTN","GMVRPCHL",44,0)
 .S @RESULTS@(0)="-1^Not a valid file number"
"RTN","GMVRPCHL",45,0)
 .Q
"RTN","GMVRPCHL",46,0)
 S GMVSCRN=$S(+DATA=44:"I $P(^(0),U,3)'=""Z""",1:"")
"RTN","GMVRPCHL",47,0)
 I $P(DATA,"^",3)="" S GMVFLD="@;.01"
"RTN","GMVRPCHL",48,0)
 E  S GMVFLD="@;"_$P(DATA,"^",3)
"RTN","GMVRPCHL",49,0)
 S GMVFLD=$P(GMVFLD,";",1,5) ; Limit lookup to 4 display fields
"RTN","GMVRPCHL",50,0)
 D FIND^DIC(+DATA,"",GMVFLD,"P",$P(DATA,"^",2),"","",GMVSCRN)
"RTN","GMVRPCHL",51,0)
 I $D(^TMP("DIERR",$J)) D  Q
"RTN","GMVRPCHL",52,0)
 .S @RESULTS@(0)="-1^"_$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","GMVRPCHL",53,0)
 .Q
"RTN","GMVRPCHL",54,0)
 I ^TMP("DILIST",$J,0)<1 D  Q
"RTN","GMVRPCHL",55,0)
 .S @RESULTS@(0)="-1^No entries found matching '"_$P(DATA,U,2)_"'."
"RTN","GMVRPCHL",56,0)
 .Q
"RTN","GMVRPCHL",57,0)
 ;I ^TMP("DILIST",$J,0)>60 D  Q
"RTN","GMVRPCHL",58,0)
 ;.S @RESULTS@(0)="-1^Too many matches found, please be more specific."
"RTN","GMVRPCHL",59,0)
 ;.Q
"RTN","GMVRPCHL",60,0)
 F X=0:0 S X=$O(^TMP("DILIST",$J,X)) Q:'X  D
"RTN","GMVRPCHL",61,0)
 .S @RESULTS@(X)=+DATA_";"_^TMP("DILIST",$J,X,0)
"RTN","GMVRPCHL",62,0)
 .Q
"RTN","GMVRPCHL",63,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","GMVRPCHL",64,0)
 Q
"RTN","GMVRPCHL",65,0)
APPT ; Get patient appointments using SDA^VADPT
"RTN","GMVRPCHL",66,0)
 ; DATA=GMVDFN^GMVFROM^GMVTO^GMVFLAG
"RTN","GMVRPCHL",67,0)
 ;         GMVDFN - DFN (required)
"RTN","GMVRPCHL",68,0)
 ;        GMVFROM - Start date of search (optional)
"RTN","GMVRPCHL",69,0)
 ;          GMVTO - End date of search (optional)
"RTN","GMVRPCHL",70,0)
 ;        GMVFLAG - kind of appt flag (optional)
"RTN","GMVRPCHL",71,0)
 ; RESULTS(0)=piece1^piece2
"RTN","GMVRPCHL",72,0)
 ; RESULTS(n)=piece3^piece4^piece5^piece6^piece7^piece8^piece9^piece10
"RTN","GMVRPCHL",73,0)
 ;
"RTN","GMVRPCHL",74,0)
 ;  where piece1 - -1 if an error OR the number of records returned
"RTN","GMVRPCHL",75,0)
 ;        piece2 - an error message if piece1 = -1
"RTN","GMVRPCHL",76,0)
 ;        piece3 - appointment date/time (FM internal)
"RTN","GMVRPCHL",77,0)
 ;        piece4 - appointment date/time (external)
"RTN","GMVRPCHL",78,0)
 ;        piece5 - clinic (internal)
"RTN","GMVRPCHL",79,0)
 ;        piece6 - clinic (external)
"RTN","GMVRPCHL",80,0)
 ;        piece7 - status (internal)
"RTN","GMVRPCHL",81,0)
 ;        piece8 - status (external)
"RTN","GMVRPCHL",82,0)
 ;        piece9 - appointment type (external)
"RTN","GMVRPCHL",83,0)
 ;        piece10 - appointment type (external)
"RTN","GMVRPCHL",84,0)
 ;              n - a sequential number starting with 1 
"RTN","GMVRPCHL",85,0)
 ;        
"RTN","GMVRPCHL",86,0)
 N GMVARRAY,GMVCNT,GMVE,GMVI,GMVLOOP,GMVDFN,GMVFROM,GMVTO,GMVFLAG
"RTN","GMVRPCHL",87,0)
 N DFN,VAERR,VASD
"RTN","GMVRPCHL",88,0)
 S DATA=$G(DATA)
"RTN","GMVRPCHL",89,0)
 S GMVDFN=$P(DATA,U,1),GMVFROM=$P(DATA,U,2),GMVTO=$P(DATA,U,3),GMVFLAG=$P(DATA,U,4)
"RTN","GMVRPCHL",90,0)
 S GMVDFN=+$G(GMVDFN)
"RTN","GMVRPCHL",91,0)
 I '$G(GMVDFN) S @RESULTS@(0)="-1^Patient ID is missing" Q
"RTN","GMVRPCHL",92,0)
 I $G(GMVFROM)="" S GMVFROM=$$FMADD^XLFDT(DT,-365)
"RTN","GMVRPCHL",93,0)
 I $G(GMVTO)="" S GMVTO=DT_".235959"
"RTN","GMVRPCHL",94,0)
 S:GMVFLAG="" VASD("W")="123456789"
"RTN","GMVRPCHL",95,0)
 S DFN=GMVDFN,VASD("T")=GMVTO,VASD("F")=GMVFROM
"RTN","GMVRPCHL",96,0)
 D SDA^VADPT
"RTN","GMVRPCHL",97,0)
 I $G(VAERR)=1 S @RESULTS@(0)="-1^DFN or ^DPT(DFN,0) is not defined" Q
"RTN","GMVRPCHL",98,0)
 S @RESULTS@(0)=0
"RTN","GMVRPCHL",99,0)
 I '$D(^UTILITY("VASD",$J)) Q
"RTN","GMVRPCHL",100,0)
 S (GMVCNT,GMVLOOP)=0
"RTN","GMVRPCHL",101,0)
 F  S GMVLOOP=$O(^UTILITY("VASD",$J,GMVLOOP)) Q:'GMVLOOP  D
"RTN","GMVRPCHL",102,0)
 .S GMVE=$G(^UTILITY("VASD",$J,GMVLOOP,"E"))
"RTN","GMVRPCHL",103,0)
 .S GMVI=$G(^UTILITY("VASD",$J,GMVLOOP,"I"))
"RTN","GMVRPCHL",104,0)
 .Q:'$P(GMVI,U,1)
"RTN","GMVRPCHL",105,0)
 .S GMVCNT=GMVCNT+1
"RTN","GMVRPCHL",106,0)
 .S GMVARRAY(9999999.999999-$P(GMVI,U,1))=$P(GMVI,U,1)_U_$P(GMVE,U,1)_U_$P(GMVI,U,2)_U_$P(GMVE,U,2)_U_$P(GMVI,U,3)_U_$P(GMVE,U,3)_U_$P(GMVI,U,4)_U_$P(GMVE,U,4)
"RTN","GMVRPCHL",107,0)
 .Q
"RTN","GMVRPCHL",108,0)
 S $P(@RESULTS@(0),U,1)=GMVCNT
"RTN","GMVRPCHL",109,0)
 K ^UTILITY("VASD",$J)
"RTN","GMVRPCHL",110,0)
 S (GMVCNT,GMVLOOP)=0
"RTN","GMVRPCHL",111,0)
 F  S GMVLOOP=$O(GMVARRAY(GMVLOOP)) Q:'GMVLOOP  D
"RTN","GMVRPCHL",112,0)
 .S GMVCNT=GMVCNT+1
"RTN","GMVRPCHL",113,0)
 .S @RESULTS@(GMVCNT)=$G(GMVARRAY(GMVLOOP))
"RTN","GMVRPCHL",114,0)
 .Q
"RTN","GMVRPCHL",115,0)
 Q
"RTN","GMVRPCHL",116,0)
ADMIT ; return a list of admissions
"RTN","GMVRPCHL",117,0)
 ; DATA=DFN
"RTN","GMVRPCHL",118,0)
 ; RESULTS(0)=piece1
"RTN","GMVRPCHL",119,0)
 ; RESULTS(n)=piece2^piece3^piece4^piece5^piece6
"RTN","GMVRPCHL",120,0)
 ;   where piece1 - number of records returned
"RTN","GMVRPCHL",121,0)
 ;         piece2 - movement date/time (external)
"RTN","GMVRPCHL",122,0)
 ;         piece3 - location ien (FILE 44)
"RTN","GMVRPCHL",123,0)
 ;         piece4 - location name (FILE 44, Field .01)
"RTN","GMVRPCHL",124,0)
 ;         piece5 - type of move
"RTN","GMVRPCHL",125,0)
 ;         PIECE6 - movement ien
"RTN","GMVRPCHL",126,0)
 ;              n - a sequential number starting with 1
"RTN","GMVRPCHL",127,0)
 ;
"RTN","GMVRPCHL",128,0)
 N DFN,TIM,MOV,X0,MTIM,XTYP,XLOC,HLOC,ILST
"RTN","GMVRPCHL",129,0)
 S DFN=DATA,ILST=0,TIM=""
"RTN","GMVRPCHL",130,0)
 I '$G(DFN) Q
"RTN","GMVRPCHL",131,0)
 F  S TIM=$O(^DGPM("ATID1",DFN,TIM)) Q:TIM'>0  D
"RTN","GMVRPCHL",132,0)
 .S MOV=0
"RTN","GMVRPCHL",133,0)
 .F  S MOV=$O(^DGPM("ATID1",DFN,TIM,MOV)) Q:MOV'>0  D
"RTN","GMVRPCHL",134,0)
 ..S X0=$G(^DGPM(MOV,0)) I X0']"" Q
"RTN","GMVRPCHL",135,0)
 ..S MTIM=$P(X0,U),MTIM=$$FMTE^XLFDT(MTIM,"1P")
"RTN","GMVRPCHL",136,0)
 ..S XTYP=$P($G(^DG(405.1,+$P(X0,U,4),0)),U,1)
"RTN","GMVRPCHL",137,0)
 ..S XLOC=$P($G(^DIC(42,+$P(X0,U,6),0)),U,1),HLOC=+$G(^(44))
"RTN","GMVRPCHL",138,0)
 ..S ILST=ILST+1,@RESULTS@(ILST)=MTIM_U_HLOC_U_XLOC_U_XTYP_U_MOV
"RTN","GMVRPCHL",139,0)
 ..Q
"RTN","GMVRPCHL",140,0)
 .Q
"RTN","GMVRPCHL",141,0)
 S @RESULTS@(0)=ILST
"RTN","GMVRPCHL",142,0)
 Q
"RTN","GMVRPCHL",143,0)
CLINIC ; Return list of active clinics
"RTN","GMVRPCHL",144,0)
 ;     DATA = GMVFROM^GMVMAX^GMVDIR
"RTN","GMVRPCHL",145,0)
 ;   Where:
"RTN","GMVRPCHL",146,0)
 ;   GMVFROM - Value to begin the search (optional). Default is null (i.e., start
"RTN","GMVRPCHL",147,0)
 ;             with the first entry in the B x-ref).
"RTN","GMVRPCHL",148,0)
 ;   GMVMAX - Maximum number of entries to return. (optional) Default is 100.
"RTN","GMVRPCHL",149,0)
 ;   GMVDIR - Direction of search (optional). 1 means forward and -1 means backwards.
"RTN","GMVRPCHL",150,0)
 ;            Default is 1.   
"RTN","GMVRPCHL",151,0)
 ; Output
"RTN","GMVRPCHL",152,0)
 ;   RESULT(n)=piece1^piece2
"RTN","GMVRPCHL",153,0)
 ;   
"RTN","GMVRPCHL",154,0)
 ;   where n is a sequential number starting with zero
"RTN","GMVRPCHL",155,0)
 ;         piece1 - 44;ien (44, a semi-colon and the entry number)
"RTN","GMVRPCHL",156,0)
 ;         piece2 - location name (FILE 44, Field .01)
"RTN","GMVRPCHL",157,0)
 ;         
"RTN","GMVRPCHL",158,0)
 ;   ex:
"RTN","GMVRPCHL",159,0)
 ;   RESULTS(0)=n 
"RTN","GMVRPCHL",160,0)
 ;   RESULTS(1)=44;123^TEST CLINIC
"RTN","GMVRPCHL",161,0)
 ;   
"RTN","GMVRPCHL",162,0)
 ;   If no entries are found, then RESULTS(0)="-1^NO ENTRIES FOUND"
"RTN","GMVRPCHL",163,0)
 ;
"RTN","GMVRPCHL",164,0)
 N GMVACTIV,GMVCNT,GMVDIR,GMVFROM,GMVIEN,GMVLAST,GMVLOCS,GMVLOOP,GMVMAX,GMVNAME,GMVNODE,GMVX
"RTN","GMVRPCHL",165,0)
 S GMVFROM=$P(DATA,U,1),GMVMAX=+$P(DATA,U,2),GMVDIR=$P(DATA,U,3)
"RTN","GMVRPCHL",166,0)
 S:'GMVMAX GMVMAX=100
"RTN","GMVRPCHL",167,0)
 S GMVDIR=$S(GMVDIR=-1:-1,1:1)
"RTN","GMVRPCHL",168,0)
 I GMVFROM]"" D  ;get entry before or after GMVFROM
"RTN","GMVRPCHL",169,0)
 .S:GMVDIR=1 GMVLAST=$O(^SC("B",GMVFROM),-1)
"RTN","GMVRPCHL",170,0)
 .S:GMVDIR=-1 GMVLAST=$O(^SC("B",GMVFROM))
"RTN","GMVRPCHL",171,0)
 .S GMVFROM=$G(GMVLAST)
"RTN","GMVRPCHL",172,0)
 .Q
"RTN","GMVRPCHL",173,0)
 S GMVCNT=0,GMVNAME=GMVFROM
"RTN","GMVRPCHL",174,0)
 F  S GMVNAME=$O(^SC("B",GMVNAME),GMVDIR) Q:GMVNAME=""!(GMVCNT=GMVMAX)  D
"RTN","GMVRPCHL",175,0)
 .S GMVIEN=0
"RTN","GMVRPCHL",176,0)
 .F  S GMVIEN=$O(^SC("B",GMVNAME,GMVIEN)) Q:'GMVIEN!(GMVCNT=GMVMAX)  D
"RTN","GMVRPCHL",177,0)
 ..S GMVNODE=$G(^SC(GMVIEN,0))
"RTN","GMVRPCHL",178,0)
 ..Q:$P(GMVNODE,U,1)=""  ;no name
"RTN","GMVRPCHL",179,0)
 ..Q:$P(GMVNODE,U,3)'="C"
"RTN","GMVRPCHL",180,0)
 ..D  Q  ;clinics
"RTN","GMVRPCHL",181,0)
 ...Q:+$G(^SC(GMVIEN,"OOS"))  ;out of service
"RTN","GMVRPCHL",182,0)
 ...S GMVACTIV=$G(^SC(GMVIEN,"I"))
"RTN","GMVRPCHL",183,0)
 ...I GMVACTIV Q:DT>+GMVACTIV&($P(GMVACTIV,U,2)=""!(DT<$P(GMVACTIV,U,2)))
"RTN","GMVRPCHL",184,0)
 ...S GMVCNT=GMVCNT+1
"RTN","GMVRPCHL",185,0)
 ...S @RESULTS@(GMVCNT)="44;"_GMVIEN_U_$P(^SC(GMVIEN,0),U)
"RTN","GMVRPCHL",186,0)
 ...Q
"RTN","GMVRPCHL",187,0)
 ..Q
"RTN","GMVRPCHL",188,0)
 .Q
"RTN","GMVRPCHL",189,0)
 I GMVCNT=0 S @RESULTS@(0)="-1^NO ENTRIES FOUND"
"RTN","GMVRPCHL",190,0)
 I GMVCNT>0 S @RESULTS@(0)=GMVCNT
"RTN","GMVRPCHL",191,0)
 Q
"RTN","GMVRPCM")
0^6^B78998924^B72972413
"RTN","GMVRPCM",1,0)
GMVRPCM ; HOIFO/DP - RPC for Vitals Manager ;07/25/05 9:10am
"RTN","GMVRPCM",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**1,8,13,3,22**;Oct 31, 2002;Build 22
"RTN","GMVRPCM",3,0)
 ; Integration Agreements:
"RTN","GMVRPCM",4,0)
 ; #10040 [Supported] File 44 references
"RTN","GMVRPCM",5,0)
 ; #10076 [Supported] XUSEC Calls
"RTN","GMVRPCM",6,0)
 ; #2263 [Supported] XPAR Calls
"RTN","GMVRPCM",7,0)
 ; #2541 [Supported] XUPARAM Calls
"RTN","GMVRPCM",8,0)
 ; #2692 [Controlled] ORQPTQ1
"RTN","GMVRPCM",9,0)
 ; #3227 [Private] NURAPI Calls
"RTN","GMVRPCM",10,0)
 ; #4084 [Private] File 44 AC x-ref
"RTN","GMVRPCM",11,0)
 ; #4360 [Private] GMV MANAGER RPC
"RTN","GMVRPCM",12,0)
ADDQUAL ; [P] Add qualifier to vital/category
"RTN","GMVRPCM",13,0)
 S GMVVIT=+$P(DATA,";",1),GMVCAT=+$P(DATA,";",2),GMVQUAL=+$P(DATA,";",3)
"RTN","GMVRPCM",14,0)
 I $O(^GMRD(120.52,GMVQUAL,1,"B",GMVVIT,0)) D  Q
"RTN","GMVRPCM",15,0)
 .S @RESULTS@(0)="1^Qualifier already assigned."
"RTN","GMVRPCM",16,0)
 S GMVFDA(120.521,"+1,"_GMVQUAL_",",.01)=GMVVIT
"RTN","GMVRPCM",17,0)
 S GMVFDA(120.521,"+1,"_GMVQUAL_",",.02)=GMVCAT
"RTN","GMVRPCM",18,0)
 D UPDATE^DIE("","GMVFDA","GMVIEN","GMVERR")
"RTN","GMVRPCM",19,0)
 I $G(GMVIEN(1)) S @RESULTS@(0)=+GMVIEN(1)_"^Qualifier Assigned"
"RTN","GMVRPCM",20,0)
 E  S @RESULTS@(0)="-1^Unable to assign qualifier"
"RTN","GMVRPCM",21,0)
 Q
"RTN","GMVRPCM",22,0)
DELQUAL ; [P] Delete qualifier from vital/category
"RTN","GMVRPCM",23,0)
 S GMVVIT=+$P(DATA,";",1),GMVCAT=+$P(DATA,";",2),GMVQUAL=+$P(DATA,";",3)
"RTN","GMVRPCM",24,0)
 S X=$O(^GMRD(120.52,GMVQUAL,1,"B",GMVVIT,0))
"RTN","GMVRPCM",25,0)
 S GMVFDA(120.521,X_","_GMVQUAL_",",.01)="@"
"RTN","GMVRPCM",26,0)
 D FILE^DIE("","GMVFDA","GMVERR")
"RTN","GMVRPCM",27,0)
 I $D(GMVERR) S @RESULTS@(0)="-1^Unable to remove qualifier."
"RTN","GMVRPCM",28,0)
 E  S @RESULTS@(0)="1^Qualifier removed."
"RTN","GMVRPCM",29,0)
 Q
"RTN","GMVRPCM",30,0)
DELTEMP ; [P] Delete Template
"RTN","GMVRPCM",31,0)
 S GMVENT=$P(DATA,U,1),GMVNAME=$P(DATA,U,2)
"RTN","GMVRPCM",32,0)
 I $$GET^XPAR(GMVENT,"GMV TEMPLATE DEFAULT")=GMVNAME D
"RTN","GMVRPCM",33,0)
 .D DEL^XPAR(GMVENT,"GMV TEMPLATE DEFAULT",1)
"RTN","GMVRPCM",34,0)
 D DEL^XPAR(GMVENT,"GMV TEMPLATE",GMVNAME,.GMVERR)
"RTN","GMVRPCM",35,0)
 I '$G(GMVERR) S @RESULTS@(0)="1^Template Removed."
"RTN","GMVRPCM",36,0)
 E  S @RESULTS@(0)="-1^"_GMVERR
"RTN","GMVRPCM",37,0)
 Q
"RTN","GMVRPCM",38,0)
GETCATS ; [P] Return Listing of categories
"RTN","GMVRPCM",39,0)
 N GMVQI
"RTN","GMVRPCM",40,0)
 F GMVCAT=0:0 S GMVCAT=$O(^GMRD(120.52,"AA",DATA,GMVCAT)) Q:'GMVCAT  D
"RTN","GMVRPCM",41,0)
 .Q:$$ACTIVE^GMVUID(120.53,"",GMVCAT_",","")
"RTN","GMVRPCM",42,0)
 .S GMVQUAL="",X="" F  S X=$O(^GMRD(120.52,"AA",DATA,GMVCAT,X)) Q:X=""  D
"RTN","GMVRPCM",43,0)
 ..S GMVQI=$O(^GMRD(120.52,"AA",DATA,GMVCAT,X,0))
"RTN","GMVRPCM",44,0)
 ..Q:$$ACTIVE^GMVUID(120.52,"",GMVQI_",","")
"RTN","GMVRPCM",45,0)
 ..S GMVQUAL=GMVQUAL_$S(GMVQUAL]"":", ",1:"")_X
"RTN","GMVRPCM",46,0)
 .S Y=$O(@RESULTS@(""),-1)+1
"RTN","GMVRPCM",47,0)
 .S @RESULTS@(Y)=GMVCAT_U_$P(^GMRD(120.53,GMVCAT,0),U)_U_GMVQUAL
"RTN","GMVRPCM",48,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)_U_$P(^GMRD(120.51,DATA,0),U)
"RTN","GMVRPCM",49,0)
 Q
"RTN","GMVRPCM",50,0)
GETDATA ; [P] Generic fileman data call
"RTN","GMVRPCM",51,0)
 ; Variable DATA = File#^IENS^Field#
"RTN","GMVRPCM",52,0)
 S @RESULTS@(0)=$$GET1^DIQ($P(DATA,U,1),$P(DATA,U,2),$P(DATA,U,3))
"RTN","GMVRPCM",53,0)
 Q
"RTN","GMVRPCM",54,0)
GETDEF ; [P] Get Default Template
"RTN","GMVRPCM",55,0)
 I $G(DATA)]"" D  Q
"RTN","GMVRPCM",56,0)
 .S X=$$GET^XPAR($P(DATA,U),"GMV TEMPLATE DEFAULT")
"RTN","GMVRPCM",57,0)
 .I X="" S @RESULTS@(0)="-1^No Default Template"
"RTN","GMVRPCM",58,0)
 .E  S @RESULTS@(0)=X
"RTN","GMVRPCM",59,0)
 D ENVAL^XPAR(.GMV,"GMV TEMPLATE DEFAULT")
"RTN","GMVRPCM",60,0)
 S X="" F  S X=$O(GMV(X)) Q:X=""  D
"RTN","GMVRPCM",61,0)
 .S Y=$O(@RESULTS@(""),-1)+1
"RTN","GMVRPCM",62,0)
 .S @RESULTS@(Y)=X_U_GMV(X,1)
"RTN","GMVRPCM",63,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","GMVRPCM",64,0)
 Q
"RTN","GMVRPCM",65,0)
GETHILO ; [P] Returns an abnormal value
"RTN","GMVRPCM",66,0)
 S @RESULTS@(0)=+$$GET1^DIQ(120.57,"1,",DATA)
"RTN","GMVRPCM",67,0)
 Q
"RTN","GMVRPCM",68,0)
GETLIST ; [P] Return listing of file
"RTN","GMVRPCM",69,0)
 K GMVCNT,GMVLOOP,GMVRET,^TMP("DILIST",$J)
"RTN","GMVRPCM",70,0)
 S GMVSCRN=""
"RTN","GMVRPCM",71,0)
 I +DATA=44 S DATA2=$P(DATA,U,2),DATA=+DATA
"RTN","GMVRPCM",72,0)
 I DATA=120.51 D  ; Set screen for vitals list
"RTN","GMVRPCM",73,0)
 .S GMVSCRN="I $$VITALIEN^GMVUTL8()[("",""_+Y_"","")"
"RTN","GMVRPCM",74,0)
 I DATA=42 D  ; Screen for ward location
"RTN","GMVRPCM",75,0)
 .S GMVSCRN="I '$$INACT42^GMVUT2(+Y)"
"RTN","GMVRPCM",76,0)
 I DATA=44 D  Q  ; Clinics
"RTN","GMVRPCM",77,0)
 .N CNT S X=DATA2,CNT=0
"RTN","GMVRPCM",78,0)
 .F  S X=$O(^SC("AC","C",X)) Q:'X!(CNT>100)  D
"RTN","GMVRPCM",79,0)
 ..Q:+$G(^SC(X,"OOS"))
"RTN","GMVRPCM",80,0)
 ..S Y=$G(^SC(X,"I"))
"RTN","GMVRPCM",81,0)
 ..I Y Q:DT>+Y&($P(Y,U,2)=""!(DT<$P(Y,U,2)))
"RTN","GMVRPCM",82,0)
 ..S @RESULTS@($O(@RESULTS@(""),-1)+1)=DATA_";"_X_U_$P(^SC(X,0),U),CNT=CNT+1
"RTN","GMVRPCM",83,0)
 .S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","GMVRPCM",84,0)
 I DATA=100.21 D  Q  ; CPRS Teams
"RTN","GMVRPCM",85,0)
 .D TEAMS^ORQPTQ1(.GMVRET)
"RTN","GMVRPCM",86,0)
 .F X=0:0 S X=$O(GMVRET(X)) Q:'X  S @RESULTS@(X)=DATA_";"_GMVRET(X)
"RTN","GMVRPCM",87,0)
 .S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","GMVRPCM",88,0)
 I DATA=211.4 D  Q  ; NURS Locations
"RTN","GMVRPCM",89,0)
 .D ACTLOCS^NURAPI(.GMVRET)
"RTN","GMVRPCM",90,0)
 .F X=0:0 S X=$O(GMVRET(X)) Q:'X  S @RESULTS@(X)=DATA_";"_GMVRET(X)
"RTN","GMVRPCM",91,0)
 .S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","GMVRPCM",92,0)
 I DATA=120.52 D  S @RESULTS@(0)=GMVCNT_U_$$GET1^DID(DATA,"","","NAME") Q  ;qualifiers
"RTN","GMVRPCM",93,0)
 .S GMVCNT=0,GMVLOOP=""
"RTN","GMVRPCM",94,0)
 .F  S GMVLOOP=$O(^GMRD(120.52,"B",GMVLOOP)) Q:GMVLOOP=""  D
"RTN","GMVRPCM",95,0)
 ..S GMVIEN=0
"RTN","GMVRPCM",96,0)
 ..F  S GMVIEN=$O(^GMRD(120.52,"B",GMVLOOP,GMVIEN)) Q:'GMVIEN  D
"RTN","GMVRPCM",97,0)
 ...S GMVNAME=$P($G(^GMRD(120.52,GMVIEN,0)),U,1)
"RTN","GMVRPCM",98,0)
 ...Q:GMVNAME=""
"RTN","GMVRPCM",99,0)
 ...Q:$$ACTIVE^GMVUID(120.52,.01,GMVIEN_",","")  ;inactive vuid
"RTN","GMVRPCM",100,0)
 ...S GMVCNT=GMVCNT+1
"RTN","GMVRPCM",101,0)
 ...S @RESULTS@(GMVCNT)="120.52;"_GMVIEN_U_GMVNAME
"RTN","GMVRPCM",102,0)
 D LIST^DIC(DATA,"","@;.01","P","","","","",GMVSCRN)
"RTN","GMVRPCM",103,0)
 F X=0:0 S X=$O(^TMP("DILIST",$J,X)) Q:'X  D
"RTN","GMVRPCM",104,0)
 .S @RESULTS@(X)=DATA_";"_^TMP("DILIST",$J,X,0)
"RTN","GMVRPCM",105,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)_U_$$GET1^DID(DATA,"","","NAME")
"RTN","GMVRPCM",106,0)
 K ^TMP("DILIST",$J)
"RTN","GMVRPCM",107,0)
 Q
"RTN","GMVRPCM",108,0)
GETQUAL ; [P] Return qualifiers list
"RTN","GMVRPCM",109,0)
 ; DATA=VitalIEN;CatIEN
"RTN","GMVRPCM",110,0)
 ; Uses X-ref of ^GMRD(120.52,"AA",VitalIEN,CategoryIEN,QName,QIEN)
"RTN","GMVRPCM",111,0)
 S GMVIT=+$P(DATA,";",1),GMVCAT=+$P(DATA,";",2)
"RTN","GMVRPCM",112,0)
 I '$D(^GMRD(120.53,GMVCAT,0)) S @RESULTS@(0)="-1^No such category" Q
"RTN","GMVRPCM",113,0)
 I $$ACTIVE^GMVUID(120.53,"",GMVCAT_",","") S @RESULTS@(0)="-1^Inactive category" Q
"RTN","GMVRPCM",114,0)
 I '$D(^GMRD(120.51,GMVIT,0)) S @RESULTS@(0)="-1^No such vital" Q
"RTN","GMVRPCM",115,0)
 I $$ACTIVE^GMVUID(120.51,"",GMVIT_",","") S @RESULTS@(0)="-1^Inactive vital type" Q
"RTN","GMVRPCM",116,0)
 S GMVNAM=""
"RTN","GMVRPCM",117,0)
 F  S GMVNAM=$O(^GMRD(120.52,"AA",GMVIT,GMVCAT,GMVNAM)) Q:GMVNAM=""  D
"RTN","GMVRPCM",118,0)
 .S GMVIEN=$O(^GMRD(120.52,"AA",GMVIT,GMVCAT,GMVNAM,0))  ; Assume only one of this name
"RTN","GMVRPCM",119,0)
 .Q:$$ACTIVE^GMVUID(120.52,"",GMVIEN_",","")
"RTN","GMVRPCM",120,0)
 .S Y=$O(@RESULTS@(""),-1)+1
"RTN","GMVRPCM",121,0)
 .S @RESULTS@(Y)=GMVIEN_U_GMVNAM
"RTN","GMVRPCM",122,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)_U_$P(^GMRD(120.53,GMVCAT,0),U)
"RTN","GMVRPCM",123,0)
 Q
"RTN","GMVRPCM",124,0)
GETTEMP ; [P] Get Template List
"RTN","GMVRPCM",125,0)
 I $G(DATA)]"" D
"RTN","GMVRPCM",126,0)
 .S GMVENT=$$ENTITY($P(DATA,U,1)),GMVNAME=$P(DATA,U,2)
"RTN","GMVRPCM",127,0)
 .I GMVNAME="" D
"RTN","GMVRPCM",128,0)
 ..D GETLST^XPAR(.GMVTMP,GMVENT,"GMV TEMPLATE")
"RTN","GMVRPCM",129,0)
 ..F X=0:0 S X=$O(GMVTMP(X)) Q:'X  D
"RTN","GMVRPCM",130,0)
 ...S GMV(GMVENT,$P(GMVTMP(X),U,1))=$P(GMVTMP(X),U,2,10)
"RTN","GMVRPCM",131,0)
 .I GMVNAME]"" S GMV(GMVENT,GMVNAME)=$$GET^XPAR(GMVENT,"GMV TEMPLATE",GMVNAME)
"RTN","GMVRPCM",132,0)
 I $G(DATA)="" D ENVAL^XPAR(.GMV,"GMV TEMPLATE")
"RTN","GMVRPCM",133,0)
 S GMVENT="",GMVNAME=""
"RTN","GMVRPCM",134,0)
 F  S GMVENT=$O(GMV(GMVENT)) Q:GMVENT=""  D
"RTN","GMVRPCM",135,0)
 .S GMVROOT=$P(GMVENT,";",2),GMVTYPE=$$TYPE(GMVROOT),GMVIEN=+GMVENT
"RTN","GMVRPCM",136,0)
 .Q:GMVTYPE=0  ;unknown template type
"RTN","GMVRPCM",137,0)
 .Q:GMVROOT="VA(200,"&('$$GET^XPAR("SYS","GMV ALLOW USER TEMPLATES"))
"RTN","GMVRPCM",138,0)
 .I GMVROOT="VA(200,"&(GMVIEN'=DUZ) Q:'$D(^XUSEC("GMV MANAGER",DUZ))
"RTN","GMVRPCM",139,0)
 .F  S GMVNAME=$O(GMV(GMVENT,GMVNAME)) Q:GMVNAME=""  D
"RTN","GMVRPCM",140,0)
 ..S GMVOWNER=$P($G(@(U_GMVROOT_(+GMVIEN)_",0)"),"Unk"),U)
"RTN","GMVRPCM",141,0)
 ..S Y=$O(@RESULTS@(""),-1)+1
"RTN","GMVRPCM",142,0)
 ..S @RESULTS@(Y)=GMVTYPE_U_GMVENT_U_GMVOWNER_U_GMVNAME_U_GMV(GMVENT,GMVNAME)
"RTN","GMVRPCM",143,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","GMVRPCM",144,0)
 Q
"RTN","GMVRPCM",145,0)
LOOKUP ; [P] Does a lookup on a file
"RTN","GMVRPCM",146,0)
 N GMVSCRN
"RTN","GMVRPCM",147,0)
 S GMVSCRN=$S(+DATA=44:"I "_"""^C^W^"""_"[$P(^(0),U,3)",1:"")
"RTN","GMVRPCM",148,0)
 I $P(DATA,"^",3)="" S GMVFLD="@;.01"
"RTN","GMVRPCM",149,0)
 E  S GMVFLD="@;"_$P(DATA,"^",3)
"RTN","GMVRPCM",150,0)
 S GMVFLD=$P(GMVFLD,";",1,5) ; Limit lookup to 4 display fields
"RTN","GMVRPCM",151,0)
 D FIND^DIC(+DATA,"",GMVFLD,"P",$P(DATA,"^",2),61,,GMVSCRN)
"RTN","GMVRPCM",152,0)
 I ^TMP("DILIST",$J,0)<1 D  Q
"RTN","GMVRPCM",153,0)
 .S @RESULTS@(0)="-1^No entries found matching '"_$P(DATA,U,2)_"'."
"RTN","GMVRPCM",154,0)
 I ^TMP("DILIST",$J,0)>60 D  Q
"RTN","GMVRPCM",155,0)
 .S @RESULTS@(0)="-1^Too many matches found, please be more specific."
"RTN","GMVRPCM",156,0)
 F X=0:0 S X=$O(^TMP("DILIST",$J,X)) Q:'X  D
"RTN","GMVRPCM",157,0)
 .S @RESULTS@(X)=+DATA_";"_^TMP("DILIST",$J,X,0)
"RTN","GMVRPCM",158,0)
 S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","GMVRPCM",159,0)
 Q
"RTN","GMVRPCM",160,0)
NEWQUAL ; [P] Create New Qualifier
"RTN","GMVRPCM",161,0)
 S @RESULTS@(0)="-1^Use the New Term Rapid Turnaround (NTRT) process to add qualifiers"
"RTN","GMVRPCM",162,0)
 Q
"RTN","GMVRPCM",163,0)
NEWTEMP ; [P] New Template
"RTN","GMVRPCM",164,0)
 S GMVENT=$P(DATA,"^",1),GMVNAME=$P(DATA,"^",2),GMVDESC=$P(DATA,"^",3)
"RTN","GMVRPCM",165,0)
 S GMVENT=$$ENTITY(GMVENT)
"RTN","GMVRPCM",166,0)
 S GMVTYPE=$$TYPE($P(GMVENT,";",2))
"RTN","GMVRPCM",167,0)
 S GMVOWN=$P($G(@(U_$P(GMVENT,";",2)_+GMVENT_",0)"),"Unk"),U)
"RTN","GMVRPCM",168,0)
 S:GMVDESC="" GMVDESC="No Description"
"RTN","GMVRPCM",169,0)
 D ADD^XPAR(GMVENT,"GMV TEMPLATE",GMVNAME,GMVDESC,.GMVERR)
"RTN","GMVRPCM",170,0)
 I 'GMVERR S @RESULTS@(0)=GMVTYPE_U_GMVENT_U_GMVOWN_U_GMVNAME
"RTN","GMVRPCM",171,0)
 E  S @RESULTS@(0)="-1^"_GMVERR
"RTN","GMVRPCM",172,0)
 Q
"RTN","GMVRPCM",173,0)
RENTEMP ; [P] Rename a Template
"RTN","GMVRPCM",174,0)
 S GMVENT=$P(DATA,U,1),GMVOLD=$P(DATA,U,2),GMVNEW=$P(DATA,U,3)
"RTN","GMVRPCM",175,0)
 D REP^XPAR(GMVENT,"GMV TEMPLATE",GMVOLD,GMVNEW,.GMVERR)
"RTN","GMVRPCM",176,0)
 I 'GMVERR S @RESULTS@(0)="1^Renamed"
"RTN","GMVRPCM",177,0)
 E  S @RESULTS@(0)="-1^"_GMVERR Q
"RTN","GMVRPCM",178,0)
 ; Reset default template if this was a default template
"RTN","GMVRPCM",179,0)
 D:$$GET^XPAR(GMVENT,"GMV TEMPLATE DEFAULT")=GMVOLD
"RTN","GMVRPCM",180,0)
 .D EN^XPAR(GMVENT,"GMV TEMPLATE DEFAULT",1,GMVNEW)
"RTN","GMVRPCM",181,0)
 Q
"RTN","GMVRPCM",182,0)
RPC(RESULTS,OPTION,DATA) ; [Procedure] Main RPC call tag
"RTN","GMVRPCM",183,0)
 ; RPC: [GMV MANAGER]
"RTN","GMVRPCM",184,0)
 ;
"RTN","GMVRPCM",185,0)
 ; Input parameters
"RTN","GMVRPCM",186,0)
 ;  1. RESULTS [Reference/Required] RPC Return array
"RTN","GMVRPCM",187,0)
 ;  2. OPTION [Literal/Required] RPC Option to execute
"RTN","GMVRPCM",188,0)
 ;  3. DATA [Literal/Required] Other data as required for call
"RTN","GMVRPCM",189,0)
 ;
"RTN","GMVRPCM",190,0)
 N GMV,GMVCAT,GMVDESC,GMVENT,GMVERR,GMVFDA,GMVFLD,GMVIEN,GMVIT,GMVNAM,GMVNAME,GMVNEW,GMVOLD,GMVOWN,GMVOWNER,GMVQUAL,GMVROOT,GMVTYPE,GMVVAL,GMVVIT,GMVSCRN
"RTN","GMVRPCM",191,0)
 S RESULTS=$NA(^TMP("GMVMGR",$J)) K @RESULTS
"RTN","GMVRPCM",192,0)
 D:$T(@OPTION)]"" @OPTION
"RTN","GMVRPCM",193,0)
 S:'$D(@RESULTS) @RESULTS@(0)="-1^No results returned"
"RTN","GMVRPCM",194,0)
 D CLEAN^DILF
"RTN","GMVRPCM",195,0)
 Q
"RTN","GMVRPCM",196,0)
SETDATA ; [P] Save New Qualifier Name/Abbv
"RTN","GMVRPCM",197,0)
 S @RESULTS@(0)="-1^Use the New Term Rapid Turnaround (NTRT) process to add qualifiers"
"RTN","GMVRPCM",198,0)
 Q
"RTN","GMVRPCM",199,0)
SETDEF ; [P] Set Default Template
"RTN","GMVRPCM",200,0)
 D EN^XPAR($P(DATA,U),"GMV TEMPLATE DEFAULT",1,$P(DATA,U,2),.GMVERR)
"RTN","GMVRPCM",201,0)
 I '$G(GMVERR) S @RESULTS@(0)="1^Set As Default."
"RTN","GMVRPCM",202,0)
 E  S @RESULTS@(0)="-1^"_GMVERR
"RTN","GMVRPCM",203,0)
 Q
"RTN","GMVRPCM",204,0)
SETHILO ; [P] Set abnormal value
"RTN","GMVRPCM",205,0)
 L +(^GMRD(120.57,0)):5
"RTN","GMVRPCM",206,0)
 E  S @RESULTS@(0)="-1^Site File In Use." Q
"RTN","GMVRPCM",207,0)
 S GMVFLD=$P(DATA,"^",1),GMVVAL=$P(DATA,"^",2)
"RTN","GMVRPCM",208,0)
 S GMVFDA(120.57,"1,",GMVFLD)=GMVVAL
"RTN","GMVRPCM",209,0)
 D FILE^DIE("","GMVFDA","GMVERR")
"RTN","GMVRPCM",210,0)
 L -(^GMRD(120.57,0))
"RTN","GMVRPCM",211,0)
 S @RESULTS@(0)="1^Update Complete."
"RTN","GMVRPCM",212,0)
 Q
"RTN","GMVRPCM",213,0)
SETTEMP ; [P] Set Template data
"RTN","GMVRPCM",214,0)
 D EN^XPAR($P(DATA,U),"GMV TEMPLATE",$P(DATA,U,2),$P(DATA,U,3),.GMVERR)
"RTN","GMVRPCM",215,0)
 I '$G(GMVERR) S @RESULTS@(0)="1^Template Saved."
"RTN","GMVRPCM",216,0)
 E  S @RESULTS@(0)="-1^"_GMVERR
"RTN","GMVRPCM",217,0)
 Q
"RTN","GMVRPCM",218,0)
VALID ; [P] Verify data validity against fileman
"RTN","GMVRPCM",219,0)
 D VAL^DIE($P(DATA,U,1),$P(DATA,U,2),$P(DATA,U,3),"H",$P(DATA,U,4),.GMVRET)
"RTN","GMVRPCM",220,0)
 I GMVRET'="^" S @RESULTS@(0)="1^Valid Data"
"RTN","GMVRPCM",221,0)
 E  S @RESULTS@(0)="-1^"_^TMP("DIERR",$J,1,"TEXT",1)
"RTN","GMVRPCM",222,0)
 Q
"RTN","GMVRPCM",223,0)
ENTITY(X) ; [Function] Convert USR, SYS, and DIV entities
"RTN","GMVRPCM",224,0)
 ; Input parameters
"RTN","GMVRPCM",225,0)
 ;  1. X [Literal/Required] XPAR generic entity to transform to variable pointer format
"RTN","GMVRPCM",226,0)
 ;
"RTN","GMVRPCM",227,0)
 Q:X="USR" DUZ_";VA(200,"
"RTN","GMVRPCM",228,0)
 Q:X="SYS" $$FIND1^DIC(4.2,"","QX",$$KSP^XUPARAM("WHERE"))_";DIC(4.2,"
"RTN","GMVRPCM",229,0)
 Q:X="DIV" DUZ(2)_";DIC(4,"
"RTN","GMVRPCM",230,0)
 Q X
"RTN","GMVRPCM",231,0)
 ;
"RTN","GMVRPCM",232,0)
TYPE(X) ; [F] Returns the type of template
"RTN","GMVRPCM",233,0)
 ; Input parameters
"RTN","GMVRPCM",234,0)
 ;  1. X [Literal/Required] Variable pointer to evaluate
"RTN","GMVRPCM",235,0)
 ;
"RTN","GMVRPCM",236,0)
 Q:X="DIC(4.2," 1 ;Domain
"RTN","GMVRPCM",237,0)
 Q:X="DIC(4," 2 ;  Institution
"RTN","GMVRPCM",238,0)
 Q:X="SC(" 3 ;     Hospital Location
"RTN","GMVRPCM",239,0)
 Q:X="VA(200," 4 ; New Person
"RTN","GMVRPCM",240,0)
 Q 0 ;             Unknown
"RTN","GMVRPCM",241,0)
 ;
"RTN","GMVRPCM",242,0)
VT ;VitalTypeIENS
"RTN","GMVRPCM",243,0)
 N X,Y,Z
"RTN","GMVRPCM",244,0)
 S Y=0,@RESULTS@(0)="-1"
"RTN","GMVRPCM",245,0)
 F X="T","P","R","BP","HT","WT","PN","PO2","CVP","CG" D
"RTN","GMVRPCM",246,0)
 .S Z=$O(^GMRD(120.51,"C",X,0))
"RTN","GMVRPCM",247,0)
 .Q:'Z
"RTN","GMVRPCM",248,0)
 .S Y=Y+1,@RESULTS@(Y)=Z
"RTN","GMVRPCM",249,0)
 Q
"RTN","GMVRPCP")
0^2^B29107373^B28561668
"RTN","GMVRPCP",1,0)
GMVRPCP ;HOIFO/DP-RPC for GMV_PtSelect.pas ; 7/8/05 8:05am
"RTN","GMVRPCP",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**1,3,22**;Oct 31, 2002;Build 22
"RTN","GMVRPCP",3,0)
 ; Integration Agreements:
"RTN","GMVRPCP",4,0)
 ; IA# 510 [Controlled] Calls to set ^DISV
"RTN","GMVRPCP",5,0)
 ; IA# 3027 [Supported] Calls to DGSEC4
"RTN","GMVRPCP",6,0)
 ; IA# 3266 [Controlled] Calls to DOB^DPTLK1
"RTN","GMVRPCP",7,0)
 ; IA# 3267 [Controlled] Calls to SSN^DPTLK1
"RTN","GMVRPCP",8,0)
 ; IA# 3593 [Supported] Calls to DPTLK6
"RTN","GMVRPCP",9,0)
 ; IA# 4440 [Supported] XUPROD calls
"RTN","GMVRPCP",10,0)
 ; IA# 10035 [Supported] Calls for FILE 2 references.
"RTN","GMVRPCP",11,0)
 ; IA# 10039 [Supported] Reads of ^DIC(42,#,44)
"RTN","GMVRPCP",12,0)
 ; IA# 10040 [Supported] Reads of ^SC(
"RTN","GMVRPCP",13,0)
 ; IA# 10061 [Supported] Calls to VADPT
"RTN","GMVRPCP",14,0)
 ; IA# 10112 [Supported] VASITE calls
"RTN","GMVRPCP",15,0)
 ;
"RTN","GMVRPCP",16,0)
ADD(X) ; [Procedure] Add line to @RESULTS@(...
"RTN","GMVRPCP",17,0)
 ; Input parameters
"RTN","GMVRPCP",18,0)
 ;  1. X [Literal/Required] Data to add to @RESULTS@(...
"RTN","GMVRPCP",19,0)
 S @RESULTS@(+$O(@RESULTS@(""),-1)+1)=X
"RTN","GMVRPCP",20,0)
 Q
"RTN","GMVRPCP",21,0)
 ;
"RTN","GMVRPCP",22,0)
LOGSEC ; [Procedure] Log Security
"RTN","GMVRPCP",23,0)
 D NOTICE^DGSEC4(.GMVRET,DFN,DATA,3)
"RTN","GMVRPCP",24,0)
 S @RESULTS@(0)=$S(GMVRET:"1^Logged",1:"-1^Unable to log")
"RTN","GMVRPCP",25,0)
 Q
"RTN","GMVRPCP",26,0)
 ;
"RTN","GMVRPCP",27,0)
RPC(RESULTS,OPTION,DFN,DATA) ; [Procedure] Main RPC call tag
"RTN","GMVRPCP",28,0)
 ; RPC: [GMV PTSELECT]
"RTN","GMVRPCP",29,0)
 ; Input parameters
"RTN","GMVRPCP",30,0)
 ;  1. RESULTS [Literal/Required] RPC return array
"RTN","GMVRPCP",31,0)
 ;  2. OPTION [Literal/Required] Call method for RPC
"RTN","GMVRPCP",32,0)
 ;  3. DFN [Literal/Required] Patient IEN
"RTN","GMVRPCP",33,0)
 ;  4. DATA [Literal/Optional] Other data as required for call
"RTN","GMVRPCP",34,0)
 S RESULTS=$NA(^TMP("GMVPTSELECT",$J)) K @RESULTS
"RTN","GMVRPCP",35,0)
 D:$T(@OPTION)]"" @OPTION
"RTN","GMVRPCP",36,0)
 D:'$D(@RESULTS)
"RTN","GMVRPCP",37,0)
 .S @RESULTS@(0)="-1^No results returned"
"RTN","GMVRPCP",38,0)
 D CLEAN^DILF
"RTN","GMVRPCP",39,0)
 Q
"RTN","GMVRPCP",40,0)
 ;
"RTN","GMVRPCP",41,0)
HOSPLOC ; [Procedure] Return location as ptr to 44 or ""
"RTN","GMVRPCP",42,0)
 N VAIN
"RTN","GMVRPCP",43,0)
 D INP^VADPT S @RESULTS@(0)=+$G(^DIC(42,+VAIN(4),44),"")
"RTN","GMVRPCP",44,0)
 Q
"RTN","GMVRPCP",45,0)
 ;
"RTN","GMVRPCP",46,0)
PTHDR ; [Procedure] Patient Info for Header Displays
"RTN","GMVRPCP",47,0)
 I '$D(^DPT(+$G(DFN),0)) D  Q
"RTN","GMVRPCP",48,0)
 .S @RESULTS@(0)="-1^No Such DFN ["_$G(DFN,"<Null>")_"]"
"RTN","GMVRPCP",49,0)
 N GMVIENS
"RTN","GMVRPCP",50,0)
 S @RESULTS@(0)=+DFN,GMVIENS=(+DFN)_","
"RTN","GMVRPCP",51,0)
 S @RESULTS@(1)=$$GET1^DIQ(2,GMVIENS,.01)_"  "_$$GET1^DIQ(2,GMVIENS,.09)
"RTN","GMVRPCP",52,0)
 S @RESULTS@(2)="DOB: "_$$GET1^DIQ(2,GMVIENS,.03)_" "_$$GET1^DIQ(2,GMVIENS,.02)_", Age: "_$$GET1^DIQ(2,GMVIENS,.033)
"RTN","GMVRPCP",53,0)
 Q
"RTN","GMVRPCP",54,0)
 ;
"RTN","GMVRPCP",55,0)
PTLKUP ; [Procedure] Patient lookup handled separately for security
"RTN","GMVRPCP",56,0)
 N GMVIDX
"RTN","GMVRPCP",57,0)
 S GMVIDX=$S(DATA?9N.1"P":"SSN",1:"B^BS^BS5")
"RTN","GMVRPCP",58,0)
 D FIND^DIC(2,"","@;.01;.02;.03;.09","MP",DATA,60,GMVIDX)
"RTN","GMVRPCP",59,0)
 I $P(^TMP("DILIST",$J,0),U,3) D  Q
"RTN","GMVRPCP",60,0)
 .S @RESULTS@(0)="-1^Too many patients found matching '"_DATA_"'. Please be more specific."
"RTN","GMVRPCP",61,0)
 F GMV=0:0 S GMV=$O(^TMP("DILIST",$J,GMV)) Q:'GMV  D
"RTN","GMVRPCP",62,0)
 .S @RESULTS@(GMV)=$$PTREC(+^TMP("DILIST",$J,GMV,0))
"RTN","GMVRPCP",63,0)
 I '$D(@RESULTS) S @RESULTS@(0)="-1^No patients matching '"_DATA_"'"
"RTN","GMVRPCP",64,0)
 E  S @RESULTS@(0)=+$O(@RESULTS@(""),-1)
"RTN","GMVRPCP",65,0)
 Q
"RTN","GMVRPCP",66,0)
 ;
"RTN","GMVRPCP",67,0)
PTREC(DFN) ;
"RTN","GMVRPCP",68,0)
 ; Extrinsic to return a Pt Rec  in standard list format
"RTN","GMVRPCP",69,0)
 N GMV
"RTN","GMVRPCP",70,0)
 S GMV=$G(^DPT(DFN,0))
"RTN","GMVRPCP",71,0)
 S GMV="2;"_DFN_U_$P(GMV,U,1)_U_$P(GMV,U,2)_U_$P(GMV,U,3)_U_$P(GMV,U,9)
"RTN","GMVRPCP",72,0)
 S $P(GMV,U,10)=$$DOB^DPTLK1(DFN)
"RTN","GMVRPCP",73,0)
 S $P(GMV,U,11)=$$SSN^DPTLK1(DFN)
"RTN","GMVRPCP",74,0)
 Q GMV
"RTN","GMVRPCP",75,0)
 ;
"RTN","GMVRPCP",76,0)
SELECT ; [Procedure] Select patient
"RTN","GMVRPCP",77,0)
 ; Calls required utilities to check security and
"RTN","GMVRPCP",78,0)
 ; return associated warnings/alerts about a
"RTN","GMVRPCP",79,0)
 ; patient being selected.
"RTN","GMVRPCP",80,0)
 ; Variables:
"RTN","GMVRPCP",81,0)
 ;  IENS: [Private] Fileman IENS
"RTN","GMVRPCP",82,0)
 ;  GMVDFN: [Private] Scratch
"RTN","GMVRPCP",83,0)
 ;  GMVFLD: [Private] FIeld number
"RTN","GMVRPCP",84,0)
 ;  GMVID: [Private] Identifier array
"RTN","GMVRPCP",85,0)
 ;  GMVRET: [Private] Scratch
"RTN","GMVRPCP",86,0)
 ;  GMVX: [Private] Scratch
"RTN","GMVRPCP",87,0)
 ; New private variables
"RTN","GMVRPCP",88,0)
 NEW IENS,GMVCNT,GMVDFN,GMVFLD,GMVHLIEN,GMVI,GMVID,GMVIDS,GMVRET,GMVX,GMVIDIEN
"RTN","GMVRPCP",89,0)
 I '$D(^DPT(+$G(DFN),0))#2 S @RESULTS@(0)="-1^No such patient" Q
"RTN","GMVRPCP",90,0)
 S ^DISV(DUZ,"^DPT(")=DFN ;spacebar return
"RTN","GMVRPCP",91,0)
 S @RESULTS@(0)="1^Required Identifiers & messages"
"RTN","GMVRPCP",92,0)
 S IENS=DFN_","
"RTN","GMVRPCP",93,0)
 D FILE^DID(2,,"REQUIRED IDENTIFIERS","GMVIDS")
"RTN","GMVRPCP",94,0)
 F GMVX=0:0 S GMVX=$O(GMVIDS("REQUIRED IDENTIFIERS",GMVX)) Q:'GMVX  D
"RTN","GMVRPCP",95,0)
 .S GMVFLD=GMVIDS("REQUIRED IDENTIFIERS",GMVX,"FIELD")
"RTN","GMVRPCP",96,0)
 .S GMVID="$$PTID^"_$$GET1^DID(2,GMVFLD,"","LABEL")
"RTN","GMVRPCP",97,0)
 .S GMVID=GMVID_U_$$GET1^DIQ(2,IENS,GMVFLD)
"RTN","GMVRPCP",98,0)
 .D:GMVFLD=.03
"RTN","GMVRPCP",99,0)
 ..S GMVID=GMVID_" ("_$$GET1^DIQ(2,IENS,.033)_")"
"RTN","GMVRPCP",100,0)
 ..S GMVID=GMVID_U_$$DOB^DPTLK1(+IENS)
"RTN","GMVRPCP",101,0)
 .D:GMVFLD=.09
"RTN","GMVRPCP",102,0)
 ..S X=$P(GMVID,U,3),X=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10)
"RTN","GMVRPCP",103,0)
 ..S $P(GMVID,U,3)=X,$P(GMVID,U,4)=$$SSN^DPTLK1(+IENS)
"RTN","GMVRPCP",104,0)
 .S @RESULTS@($O(@RESULTS@(""),-1)+1)=GMVID
"RTN","GMVRPCP",105,0)
 ; Add ward and Room/Bed
"RTN","GMVRPCP",106,0)
 S GMVID="$$PTID^"_$$GET1^DID(2,.1,"","LABEL")
"RTN","GMVRPCP",107,0)
 S GMVID=GMVID_U_$$GET1^DIQ(2,IENS,.1)
"RTN","GMVRPCP",108,0)
 S GMVIDIEN=$P(GMVID,U,3)
"RTN","GMVRPCP",109,0)
 S GMVIDIEN=$$IDIEN(GMVIDIEN)
"RTN","GMVRPCP",110,0)
 S @RESULTS@($O(@RESULTS@(""),-1)+1)=GMVID
"RTN","GMVRPCP",111,0)
 S GMVID="$$PTID^"_$$GET1^DID(2,.101,"","LABEL")
"RTN","GMVRPCP",112,0)
 S GMVID=GMVID_U_$$GET1^DIQ(2,IENS,.101)
"RTN","GMVRPCP",113,0)
 S @RESULTS@($O(@RESULTS@(""),-1)+1)=GMVID
"RTN","GMVRPCP",114,0)
 ; ------- Clevland Alert -------
"RTN","GMVRPCP",115,0)
 K GMVRET
"RTN","GMVRPCP",116,0)
 D GUIBS5A^DPTLK6(.GMVRET,DFN) D:GMVRET(1)=1
"RTN","GMVRPCP",117,0)
 .D ADD("$$MSGHDR^2^SAME LAST NAME AND LAST 4")
"RTN","GMVRPCP",118,0)
 .S GMVX=1
"RTN","GMVRPCP",119,0)
 .F  S GMVX=$O(GMVRET(GMVX)) Q:'GMVX!(+$G(GMVRET(GMVX)))  D
"RTN","GMVRPCP",120,0)
 ..D ADD($P(GMVRET(GMVX),U,2))
"RTN","GMVRPCP",121,0)
 .D ADD(" ")
"RTN","GMVRPCP",122,0)
 .S GMVX=1
"RTN","GMVRPCP",123,0)
 .F  S GMVX=$O(GMVRET(GMVX)) Q:'GMVX  D:+GMVRET(GMVX)
"RTN","GMVRPCP",124,0)
 ..S GMVDFN=+$P(GMVRET(GMVX),U,2)
"RTN","GMVRPCP",125,0)
 ..D ADD($$GET1^DIQ(2,GMVDFN_",",.01)_"    "_$$DOB^DPTLK1(GMVDFN)_"    "_$$SSN^DPTLK1(GMVDFN))
"RTN","GMVRPCP",126,0)
 .D ADD(" ")
"RTN","GMVRPCP",127,0)
 .D ADD("Please review carefully before continuing")
"RTN","GMVRPCP",128,0)
 .D ADD("$$MSGEND")
"RTN","GMVRPCP",129,0)
 ; ------- Sensitive Record? -------
"RTN","GMVRPCP",130,0)
 K GMVRET
"RTN","GMVRPCP",131,0)
 D PTSEC^DGSEC4(.GMVRET,DFN) D:GMVRET(1)'=0
"RTN","GMVRPCP",132,0)
 .D:GMVRET(1)=3
"RTN","GMVRPCP",133,0)
 ..D ADD("$$MSGHDR^0^CAN'T ACCESS YOUR OWN RECORD!!")
"RTN","GMVRPCP",134,0)
 .D:GMVRET(1)=-1
"RTN","GMVRPCP",135,0)
 ..D ADD("$$MSGHDR^0^INCOMPLETE INFORMATION - CAN'T PROCEED")
"RTN","GMVRPCP",136,0)
 .D:GMVRET(1)=1
"RTN","GMVRPCP",137,0)
 ..D ADD("$$MSGHDR^1^SENSITIVE RECORD ACCESS")
"RTN","GMVRPCP",138,0)
 .D:GMVRET(1)'=-1&(GMVRET(1)'=3)&(GMVRET(1)'=1)
"RTN","GMVRPCP",139,0)
 ..D ADD("$$MSGHDR^3^SENSITIVE RECORD ACCESS")
"RTN","GMVRPCP",140,0)
 .S GMVX=1
"RTN","GMVRPCP",141,0)
 .F  S GMVX=$O(GMVRET(GMVX)) Q:'GMVX  D ADD($TR(GMVRET(GMVX),"*"," "))
"RTN","GMVRPCP",142,0)
 .D ADD("$$MSGEND")
"RTN","GMVRPCP",143,0)
 ; ------- Means Test Information? -------
"RTN","GMVRPCP",144,0)
 D GUIMTD^DPTLK6(.GMVRET,DFN) D:GMVRET(1)=1
"RTN","GMVRPCP",145,0)
 .D ADD("$$MSGHDR^1^NOTICE")
"RTN","GMVRPCP",146,0)
 .F GMVX=1:0 S GMVX=$O(GMVRET(GMVX)) Q:'GMVX  D ADD(GMVRET(GMVX))
"RTN","GMVRPCP",147,0)
 .D ADD("$$MSGEND")
"RTN","GMVRPCP",148,0)
 Q
"RTN","GMVRPCP",149,0)
 ;
"RTN","GMVRPCP",150,0)
IDIEN(GMVIEN) ;
"RTN","GMVRPCP",151,0)
 S GMVIEN=$G(GMVIEN)
"RTN","GMVRPCP",152,0)
 I GMVIEN="" Q ""
"RTN","GMVRPCP",153,0)
 S GMVIEN=$O(^DIC(42,"B",GMVIEN,0))
"RTN","GMVRPCP",154,0)
 I 'GMVIEN Q ""
"RTN","GMVRPCP",155,0)
 S GMVIEN=$P($G(^DIC(42,+GMVIEN,44)),"U",1)
"RTN","GMVRPCP",156,0)
 Q GMVIEN
"RTN","GMVRPCP",157,0)
 ;
"RTN","GMVRPCP",158,0)
CCOW ; Return CCOW site and production indicator
"RTN","GMVRPCP",159,0)
 S @RESULTS@(0)=$P($$SITE^VASITE(),"^",3)_"^"_$$PROD^XUPROD()
"RTN","GMVRPCP",160,0)
 Q
"RTN","GMVRPCP",161,0)
 ;
"VER")
8.0^22.0
"BLD",6786,6)
^15
**END**
**END**
