Released GMRV*5*25 SEQ #16
Extracted from mail message
**KIDS**:GMRV*5.0*25^

**INSTALL NAME**
GMRV*5.0*25
"BLD",7150,0)
GMRV*5.0*25^GEN. MED. REC. - VITALS^0^3090213^y
"BLD",7150,1,0)
^^2^2^3090213^^
"BLD",7150,1,1,0)
Please read the GMRV*5*25 patch description on FORUM for an explanation
"BLD",7150,1,2,0)
of what this patch does.
"BLD",7150,4,0)
^9.64PA^^
"BLD",7150,6.3)
4
"BLD",7150,"ABPKG")
n
"BLD",7150,"INIT")
QUEUE^GMVZEROS
"BLD",7150,"KRN",0)
^9.67PA^779.2^20
"BLD",7150,"KRN",.4,0)
.4
"BLD",7150,"KRN",.401,0)
.401
"BLD",7150,"KRN",.402,0)
.402
"BLD",7150,"KRN",.403,0)
.403
"BLD",7150,"KRN",.5,0)
.5
"BLD",7150,"KRN",.84,0)
.84
"BLD",7150,"KRN",3.6,0)
3.6
"BLD",7150,"KRN",3.8,0)
3.8
"BLD",7150,"KRN",9.2,0)
9.2
"BLD",7150,"KRN",9.8,0)
9.8
"BLD",7150,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7150,"KRN",9.8,"NM",1,0)
GMVZEROS^^0^B14692106
"BLD",7150,"KRN",9.8,"NM",2,0)
GMVDCSAV^^0^B19948030
"BLD",7150,"KRN",9.8,"NM","B","GMVDCSAV",2)

"BLD",7150,"KRN",9.8,"NM","B","GMVZEROS",1)

"BLD",7150,"KRN",19,0)
19
"BLD",7150,"KRN",19.1,0)
19.1
"BLD",7150,"KRN",101,0)
101
"BLD",7150,"KRN",409.61,0)
409.61
"BLD",7150,"KRN",771,0)
771
"BLD",7150,"KRN",779.2,0)
779.2
"BLD",7150,"KRN",870,0)
870
"BLD",7150,"KRN",8989.51,0)
8989.51
"BLD",7150,"KRN",8989.52,0)
8989.52
"BLD",7150,"KRN",8994,0)
8994
"BLD",7150,"KRN","B",.4,.4)

"BLD",7150,"KRN","B",.401,.401)

"BLD",7150,"KRN","B",.402,.402)

"BLD",7150,"KRN","B",.403,.403)

"BLD",7150,"KRN","B",.5,.5)

"BLD",7150,"KRN","B",.84,.84)

"BLD",7150,"KRN","B",3.6,3.6)

"BLD",7150,"KRN","B",3.8,3.8)

"BLD",7150,"KRN","B",9.2,9.2)

"BLD",7150,"KRN","B",9.8,9.8)

"BLD",7150,"KRN","B",19,19)

"BLD",7150,"KRN","B",19.1,19.1)

"BLD",7150,"KRN","B",101,101)

"BLD",7150,"KRN","B",409.61,409.61)

"BLD",7150,"KRN","B",771,771)

"BLD",7150,"KRN","B",779.2,779.2)

"BLD",7150,"KRN","B",870,870)

"BLD",7150,"KRN","B",8989.51,8989.51)

"BLD",7150,"KRN","B",8989.52,8989.52)

"BLD",7150,"KRN","B",8994,8994)

"BLD",7150,"QDEF")
^^^^^^^^^^
"BLD",7150,"QUES",0)
^9.62^^
"BLD",7150,"REQB",0)
^9.611^1^1
"BLD",7150,"REQB",1,0)
GMRV*5.0*3^2
"BLD",7150,"REQB","B","GMRV*5.0*3",1)

"INIT")
QUEUE^GMVZEROS
"MBREQ")
0
"PKG",44,-1)
1^1
"PKG",44,0)
GEN. MED. REC. - VITALS^GMRV^Vitals/Measurements Module of General Medical Record.
"PKG",44,20,0)
^9.402P^^
"PKG",44,22,0)
^9.49I^1^1
"PKG",44,22,1,0)
5.0^3021029
"PKG",44,22,1,"PAH",1,0)
25^3090213
"PKG",44,22,1,"PAH",1,1,0)
^^2^2^3090213
"PKG",44,22,1,"PAH",1,1,1,0)
Please read the GMRV*5*25 patch description on FORUM for an explanation
"PKG",44,22,1,"PAH",1,1,2,0)
of what this patch does.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMVDCSAV")
0^2^B19948030^B19942469
"RTN","GMVDCSAV",1,0)
GMVDCSAV ;HOIFO/DAD-VITALS COMPONENT: SAVE DATA ; 2/13/09 8:47AM
"RTN","GMVDCSAV",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**9,3,25**;Oct 31, 2002;Build 4
"RTN","GMVDCSAV",3,0)
 ;
"RTN","GMVDCSAV",4,0)
 ; This routine uses the following IAs:
"RTN","GMVDCSAV",5,0)
 ; #10103 - ^XLFDT calls           (supported)
"RTN","GMVDCSAV",6,0)
 ;
"RTN","GMVDCSAV",7,0)
 ; This routine supports the following IAs:
"RTN","GMVDCSAV",8,0)
 ; #3996 - GMV ADD VM RPC called at EN1  (private)
"RTN","GMVDCSAV",9,0)
 ; 
"RTN","GMVDCSAV",10,0)
 ; 01/28/2005 KAM GMRV*5*9 Record midnight with 1 second added
"RTN","GMVDCSAV",11,0)
 ;                         Stop adding second on multiple patent entry
"RTN","GMVDCSAV",12,0)
 ;
"RTN","GMVDCSAV",13,0)
EN1(RESULT,GMVDATA) ; GMV ADD VM [RPC entry point]
"RTN","GMVDCSAV",14,0)
 ; Saves vitals data
"RTN","GMVDCSAV",15,0)
 N GMVCNT,GMVD0,GMVFDA,GMVINUM,GMVQNUM,GMVRNUM,GMVIEN,GMVDUN
"RTN","GMVDCSAV",16,0)
 N GMVVNUM,GMVVMEAS,GMVVQUAL,GMVVREAS
"RTN","GMVDCSAV",17,0)
 D QUALTWO
"RTN","GMVDCSAV",18,0)
 Q
"RTN","GMVDCSAV",19,0)
 ;I $O(@GMVDATA@("V",0))>0 D VITMEA
"RTN","GMVDCSAV",20,0)
 ;I $O(@GMVDATA@("I",0))>0 D ENTERR
"RTN","GMVDCSAV",21,0)
 ;I $G(RESULT(0))="OK" D MSG("OK: Data saved")
"RTN","GMVDCSAV",22,0)
 ;Q
"RTN","GMVDCSAV",23,0)
 ;
"RTN","GMVDCSAV",24,0)
VITMEA ; *** Save vital measurement data ***
"RTN","GMVDCSAV",25,0)
 S GMVVNUM=0 K GMVFDA
"RTN","GMVDCSAV",26,0)
 S GMVCNT=+$O(@GMVDATA@("V",1E25),-1)
"RTN","GMVDCSAV",27,0)
 F  S GMVVNUM=$O(@GMVDATA@("V",GMVVNUM)) Q:GMVVNUM'>0  D
"RTN","GMVDCSAV",28,0)
 . S GMVVMEAS=$G(@GMVDATA@("V",GMVVNUM))
"RTN","GMVDCSAV",29,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.01)=GMVDTDUN ; Date time taken
"RTN","GMVDCSAV",30,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.02)=GMVDFN   ; Patient
"RTN","GMVDCSAV",31,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.03)=$P(GMVVMEAS,U) ;
"RTN","GMVDCSAV",32,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.04)=GMVDTENT  ; Date Time entered
"RTN","GMVDCSAV",33,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.05)=GMVHOSPL  ; Hospital
"RTN","GMVDCSAV",34,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",.06)=GMVENTBY  ; Entered by (DUZ)
"RTN","GMVDCSAV",35,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",1.2)=$P($P(GMVVMEAS,U,2),";",1) ; Rate
"RTN","GMVDCSAV",36,0)
 . S GMVFDA(120.5,"+"_GMVVNUM_",",1.4)=$P($P(GMVVMEAS,U,2),";",2) ; Sup 02
"RTN","GMVDCSAV",37,0)
 . S GMVQNUM=0
"RTN","GMVDCSAV",38,0)
 . F  S GMVQNUM=$O(@GMVDATA@("Q",GMVVNUM,GMVQNUM)) Q:GMVQNUM'>0  D
"RTN","GMVDCSAV",39,0)
 .. S GMVVQUAL=$G(@GMVDATA@("Q",GMVVNUM,GMVQNUM))
"RTN","GMVDCSAV",40,0)
 .. S GMVCNT=GMVCNT+1
"RTN","GMVDCSAV",41,0)
 .. S GMVFDA(120.505,"+"_GMVCNT_",","+"_GMVVNUM_",",.01)=GMVVQUAL
"RTN","GMVDCSAV",42,0)
 .. Q
"RTN","GMVDCSAV",43,0)
 . Q
"RTN","GMVDCSAV",44,0)
 D UPDATE^DIE("","GMVFDA"),FMERROR
"RTN","GMVDCSAV",45,0)
 S RESULT(0)="OK"
"RTN","GMVDCSAV",46,0)
 Q
"RTN","GMVDCSAV",47,0)
 ;
"RTN","GMVDCSAV",48,0)
ENTERR ; *** Save entered in error data ***
"RTN","GMVDCSAV",49,0)
 S GMVINUM=0 K GMVFDA
"RTN","GMVDCSAV",50,0)
 S GMVCNT=+$O(@GMVDATA@("I",1E25),-1)
"RTN","GMVDCSAV",51,0)
 F  S GMVINUM=$O(@GMVDATA@("I",GMVINUM)) Q:GMVINUM'>0  D
"RTN","GMVDCSAV",52,0)
 . S GMVD0=$G(@GMVDATA@("I",GMVINUM))
"RTN","GMVDCSAV",53,0)
 . S GMVFDA(120.5,GMVD0_",",2)=1
"RTN","GMVDCSAV",54,0)
 . S GMVFDA(120.5,GMVD0_",",3)=GMVERRBY
"RTN","GMVDCSAV",55,0)
 . S GMVRNUM=0
"RTN","GMVDCSAV",56,0)
 . F  S GMVRNUM=$O(@GMVDATA@("R",GMVINUM,GMVRNUM)) Q:GMVRNUM'>0  D
"RTN","GMVDCSAV",57,0)
 .. S GMVVREAS=$G(@GMVDATA@("R",GMVINUM,GMVRNUM))
"RTN","GMVDCSAV",58,0)
 .. S GMVCNT=GMVCNT+1
"RTN","GMVDCSAV",59,0)
 .. S GMVFDA(120.506,"+"_GMVCNT_","_GMVD0_",",.01)=GMVVREAS
"RTN","GMVDCSAV",60,0)
 .. Q
"RTN","GMVDCSAV",61,0)
 . Q
"RTN","GMVDCSAV",62,0)
 D UPDATE^DIE("","GMVFDA"),FMERROR
"RTN","GMVDCSAV",63,0)
 S RESULT(0)="OK"
"RTN","GMVDCSAV",64,0)
 Q
"RTN","GMVDCSAV",65,0)
QUALTWO ; Add a new entry to FILE 120.5
"RTN","GMVDCSAV",66,0)
 S GMVVNUM=0 K GMVFDA
"RTN","GMVDCSAV",67,0)
 S GMVVMEAS=$P(GMVDATA,"*",1) ; 
"RTN","GMVDCSAV",68,0)
 S GMVDTDUN=+$P(GMVVMEAS,"^",1) ; Date time
"RTN","GMVDCSAV",69,0)
 ;01/28/2005 KAM GMRV*5*9 Added next Line PAL-0105-60940 
"RTN","GMVDCSAV",70,0)
 I +$P(GMVDTDUN,".",2)'>0 S GMVDTDUN=$$FMADD^XLFDT(GMVDTDUN,"","","",1)
"RTN","GMVDCSAV",71,0)
 S GMVDFN=$P(GMVVMEAS,"^",2) ; Patient DFN
"RTN","GMVDCSAV",72,0)
 S GMVVTYP=$P(GMVVMEAS,"^",3) ; Vital type
"RTN","GMVDCSAV",73,0)
 S GMVDTDUN=$$CHKDT(GMVDTDUN,$P(GMVVTYP,";",1))
"RTN","GMVDCSAV",74,0)
 S GMVDTENT=$$NOW^XLFDT ; Current date time
"RTN","GMVDCSAV",75,0)
 S GMVHOSPL=$P(GMVVMEAS,"^",4) ; Hospital
"RTN","GMVDCSAV",76,0)
 S GMVENTBY=$P(GMVVMEAS,"^",5) ; DUZ
"RTN","GMVDCSAV",77,0)
 S GMVFDA(120.5,"+1,",.01)=GMVDTDUN ; Date time taken
"RTN","GMVDCSAV",78,0)
 S GMVFDA(120.5,"+1,",.02)=GMVDFN   ; Patient
"RTN","GMVDCSAV",79,0)
 S GMVFDA(120.5,"+1,",.03)=$P(GMVVTYP,";",1)   ; Vital Type
"RTN","GMVDCSAV",80,0)
 S GMVFDA(120.5,"+1,",.04)=GMVDTENT  ; Date Time entered
"RTN","GMVDCSAV",81,0)
 S GMVFDA(120.5,"+1,",.05)=GMVHOSPL  ; Hospital
"RTN","GMVDCSAV",82,0)
 S GMVFDA(120.5,"+1,",.06)=GMVENTBY  ; Entered by (DUZ)
"RTN","GMVDCSAV",83,0)
 S GMVFDA(120.5,"+1,",1.2)=$P(GMVVTYP,";",2) ; Rate
"RTN","GMVDCSAV",84,0)
 S GMVFDA(120.5,"+1,",1.4)=$P(GMVVTYP,";",3) ; Sup 02
"RTN","GMVDCSAV",85,0)
 S GMVIEN=""
"RTN","GMVDCSAV",86,0)
 D UPDATE^DIE("","GMVFDA","GMVIEN"),FMERROR
"RTN","GMVDCSAV",87,0)
 S GMVCNT=1
"RTN","GMVDCSAV",88,0)
 S GMVQUALS=$P(GMVDATA,"*",2)
"RTN","GMVDCSAV",89,0)
 F GMVLOOP=1:1:$L(GMVQUALS,":")+1 D
"RTN","GMVDCSAV",90,0)
 . S GMVVQUAL=$P(GMVQUALS,":",GMVLOOP)
"RTN","GMVDCSAV",91,0)
 . Q:GMVVQUAL=""
"RTN","GMVDCSAV",92,0)
 . S GMVCNT=GMVCNT+1
"RTN","GMVDCSAV",93,0)
 . D ADDQUAL^GMVGETQ(.GMVRES,GMVIEN(1)_"^"_GMVVQUAL)
"RTN","GMVDCSAV",94,0)
 . Q
"RTN","GMVDCSAV",95,0)
 Q 
"RTN","GMVDCSAV",96,0)
 ;
"RTN","GMVDCSAV",97,0)
CHKDT(GMVDT,GMVSAV) ;Check id there ios a vital entered for that date and time
"RTN","GMVDCSAV",98,0)
 N GMVA,GMVQ
"RTN","GMVDCSAV",99,0)
 S GMVQ=0
"RTN","GMVDCSAV",100,0)
 S GMVA=""
"RTN","GMVDCSAV",101,0)
 F  S GMVA=$O(^GMR(120.5,"B",GMVDT,GMVA)) Q:GMVA=""  D
"RTN","GMVDCSAV",102,0)
 . ;01/28/2005 KAM GMRV*5*9 Added next Line BHS-0504-10643 
"RTN","GMVDCSAV",103,0)
 . I GMVDFN'=$P($G(^GMR(120.5,GMVA,0)),U,2) Q
"RTN","GMVDCSAV",104,0)
 . S GMVTY=$P($G(^GMR(120.5,GMVA,0)),"^",3)
"RTN","GMVDCSAV",105,0)
 . I GMVTY=GMVSAV D
"RTN","GMVDCSAV",106,0)
 . . S GMVDT=$$FMADD^XLFDT(GMVDT,"","","",1)
"RTN","GMVDCSAV",107,0)
 . . Q
"RTN","GMVDCSAV",108,0)
 . Q
"RTN","GMVDCSAV",109,0)
 Q GMVDT
"RTN","GMVDCSAV",110,0)
MSG(X) ; *** Add a line to the message array ***
"RTN","GMVDCSAV",111,0)
 S (GMVMSG,RESULT(-1))=1+$G(RESULT(-1),0)
"RTN","GMVDCSAV",112,0)
 S RESULT(GMVMSG)=X
"RTN","GMVDCSAV",113,0)
 I $P(X,":")="ERROR" S RESULT(0)="ERROR"
"RTN","GMVDCSAV",114,0)
 Q
"RTN","GMVDCSAV",115,0)
 ;
"RTN","GMVDCSAV",116,0)
FMERROR ;
"RTN","GMVDCSAV",117,0)
 I $O(^TMP("DIERR",$J,0))>0 D
"RTN","GMVDCSAV",118,0)
 . N GMVER1,GMVER2
"RTN","GMVDCSAV",119,0)
 . S GMVER1=0
"RTN","GMVDCSAV",120,0)
 . F  S GMVER1=$O(^TMP("DIERR",$J,GMVER1)) Q:GMVER1'>0  D
"RTN","GMVDCSAV",121,0)
 .. S GMVER2=0
"RTN","GMVDCSAV",122,0)
 .. F  S GMVER2=$O(^TMP("DIERR",$J,GMVER1,"TEXT",GMVER2)) Q:GMVER2'>0  D
"RTN","GMVDCSAV",123,0)
 ... D MSG("ERROR: "_$G(^TMP("DIERR",$J,GMVER1,"TEXT",GMVER2)))
"RTN","GMVDCSAV",124,0)
 ... Q
"RTN","GMVDCSAV",125,0)
 .. Q
"RTN","GMVDCSAV",126,0)
 . Q
"RTN","GMVDCSAV",127,0)
 D CLEAN^DILF
"RTN","GMVDCSAV",128,0)
 Q
"RTN","GMVZEROS")
0^1^B14692106^n/a
"RTN","GMVZEROS",1,0)
GMVZEROS ;HIOFO/FT - LOOK FOR TRAILING ZEROES IN FILE 120.5, FIELD .01 ;08/27/08 16:07
"RTN","GMVZEROS",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**25**;Oct 31, 2002;Build 4
"RTN","GMVZEROS",3,0)
 ;
"RTN","GMVZEROS",4,0)
 ; This routine uses the following IAs:
"RTN","GMVZEROS",5,0)
 ; #2320  - ^%ZISH calls             (supported)
"RTN","GMVZEROS",6,0)
 ; #10063 - ^%ZTLOAD                 (supported)
"RTN","GMVZEROS",7,0)
 ; #10070 - ^XMD calls               (supported)
"RTN","GMVZEROS",8,0)
 ; #10103 - ^XLFDT calls             (supported)
"RTN","GMVZEROS",9,0)
 ;
"RTN","GMVZEROS",10,0)
QUEUE ;Queue job as a background task
"RTN","GMVZEROS",11,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSK
"RTN","GMVZEROS",12,0)
 D EN^DDIOL("Starting FIX^GMVZEROS as a background task.","","!?5")
"RTN","GMVZEROS",13,0)
 S ZTDESC="GMRV*5.0*25 D/T REPAIR UTILITY",ZTIO=""
"RTN","GMVZEROS",14,0)
 S ZTRTN="FIX^GMVZEROS",ZTDTH=$$NOW^XLFDT()
"RTN","GMVZEROS",15,0)
 D ^%ZTLOAD
"RTN","GMVZEROS",16,0)
 D EN^DDIOL("Task "_ZTSK_" has started. I'll send you a MailMan message when I finish.","","!?5")
"RTN","GMVZEROS",17,0)
 Q
"RTN","GMVZEROS",18,0)
 ;
"RTN","GMVZEROS",19,0)
FIX ;Search for string dates and repair them.
"RTN","GMVZEROS",20,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMVZEROS",21,0)
 N DA,DIE,DR,X,Y,ZTSTOP
"RTN","GMVZEROS",22,0)
 N GMVBAD,GMVCNT,GMVDATE,GMVEND,GMVIEN,GMVFILE,GMVFOUND,GMVLINE,GMVPATH,GMVSTART,GMVTEXT,GMVTOTAL
"RTN","GMVZEROS",23,0)
 N POP
"RTN","GMVZEROS",24,0)
 S DIE=120.5,GMVLINE=1
"RTN","GMVZEROS",25,0)
 S GMVTEXT(GMVLINE)="Starting search for string dates in FILE 120.5 at "_$$FMTE^XLFDT($$NOW^XLFDT,"5Z")
"RTN","GMVZEROS",26,0)
 S (GMVBAD,GMVCNT,GMVIEN,GMVFOUND,GMVTOTAL)=0
"RTN","GMVZEROS",27,0)
 ; set host file name and directory path
"RTN","GMVZEROS",28,0)
 S GMVFILE="GMRV_5_25.DAT"
"RTN","GMVZEROS",29,0)
 S GMVPATH=$$PWD^%ZISH ;current directory
"RTN","GMVZEROS",30,0)
 ; Open up device to print to
"RTN","GMVZEROS",31,0)
 D OPEN^%ZISH("VITAL",GMVPATH,GMVFILE,"A") ;'A' for append
"RTN","GMVZEROS",32,0)
 I POP D  Q  ;send email if device cannot be opened
"RTN","GMVZEROS",33,0)
 .S GMVLINE=GMVLINE+1
"RTN","GMVZEROS",34,0)
 .S GMVTEXT(GMVLINE)="Could not open file "_GMVFILE_" in path "_GMVPATH_"."
"RTN","GMVZEROS",35,0)
 .S GMVLINE=GMVLINE+1
"RTN","GMVZEROS",36,0)
 .S GMVTEXT(GMVLINE)="Stopping at "_$$FMTE^XLFDT($$NOW^XLFDT,"5Z")
"RTN","GMVZEROS",37,0)
 .D EMAIL(.GMVTEXT)
"RTN","GMVZEROS",38,0)
 .Q
"RTN","GMVZEROS",39,0)
 U IO
"RTN","GMVZEROS",40,0)
 ; from this point on, the Write commands are writing to the host file.
"RTN","GMVZEROS",41,0)
 F  S GMVIEN=+$O(^GMR(120.5,GMVIEN)) Q:GMVIEN=0!($G(ZTSTOP)=1)  D
"RTN","GMVZEROS",42,0)
 .S GMVTOTAL=GMVTOTAL+1
"RTN","GMVZEROS",43,0)
 .S GMVCNT=GMVCNT+1
"RTN","GMVZEROS",44,0)
 .I GMVCNT>10000 D  ;check if user wants to stop the job
"RTN","GMVZEROS",45,0)
 ..S GMVCNT=0
"RTN","GMVZEROS",46,0)
 ..Q:'$D(ZTQUEUED)  ;not a background task
"RTN","GMVZEROS",47,0)
 ..I $$S^%ZTLOAD D
"RTN","GMVZEROS",48,0)
 ...S ZTSTOP=1 ;set TaskMan variable equal to 1 to stop task
"RTN","GMVZEROS",49,0)
 ...W !,"Task stopped at "_$$FMTE^XLFDT($$NOW^XLFDT,"5Z")
"RTN","GMVZEROS",50,0)
 ...W !,"Stopped at record "_GMVIEN
"RTN","GMVZEROS",51,0)
 ...K ZTREQ ;keep record of task in task log
"RTN","GMVZEROS",52,0)
 .S GMVDATE=$P(^GMR(120.5,GMVIEN,0),U,1)
"RTN","GMVZEROS",53,0)
 .I GMVDATE'=+GMVDATE D
"RTN","GMVZEROS",54,0)
 ..I $$DTCHECK(+GMVDATE,"TX")=0 D  Q  ;not a real date/time
"RTN","GMVZEROS",55,0)
 ...W !,"IEN="_GMVIEN,?15,GMVDATE_" is not a real date/time. No action taken."
"RTN","GMVZEROS",56,0)
 ...S GMVBAD=GMVBAD+1
"RTN","GMVZEROS",57,0)
 ..S GMVFOUND=GMVFOUND+1
"RTN","GMVZEROS",58,0)
 ..W !,"IEN="_GMVIEN,?15,GMVDATE_" changed to "_+GMVDATE
"RTN","GMVZEROS",59,0)
 ..S DR=".01///"_+GMVDATE,DA=GMVIEN
"RTN","GMVZEROS",60,0)
 ..D ^DIE
"RTN","GMVZEROS",61,0)
 W !!,"# of Records changed: "_GMVFOUND
"RTN","GMVZEROS",62,0)
 D CLOSE^%ZISH("VITAL")
"RTN","GMVZEROS",63,0)
 S GMVLINE=GMVLINE+1
"RTN","GMVZEROS",64,0)
 S GMVTEXT(GMVLINE)="Finished at "_$$FMTE^XLFDT($$NOW^XLFDT,"5Z")
"RTN","GMVZEROS",65,0)
 S GMVLINE=GMVLINE+1
"RTN","GMVZEROS",66,0)
 S GMVTEXT(GMVLINE)="Records checked: "_GMVTOTAL
"RTN","GMVZEROS",67,0)
 S GMVLINE=GMVLINE+1
"RTN","GMVZEROS",68,0)
 S GMVTEXT(GMVLINE)="Records changed: "_GMVFOUND
"RTN","GMVZEROS",69,0)
 S GMVLINE=GMVLINE+1
"RTN","GMVZEROS",70,0)
 S GMVTEXT(GMVLINE)="Records that could not be changed: "_GMVBAD
"RTN","GMVZEROS",71,0)
 S GMVLINE=GMVLINE+1
"RTN","GMVZEROS",72,0)
 S GMVTEXT(GMVLINE)="The "_GMVFILE_" file in the "_GMVPATH_" directory contains"
"RTN","GMVZEROS",73,0)
 S GMVLINE=GMVLINE+1
"RTN","GMVZEROS",74,0)
 S GMVTEXT(GMVLINE)="a list of entries changed and those that could not be changed."
"RTN","GMVZEROS",75,0)
 D EMAIL(.GMVTEXT)
"RTN","GMVZEROS",76,0)
 Q
"RTN","GMVZEROS",77,0)
 ;
"RTN","GMVZEROS",78,0)
DTCHECK(GMVDT,GMVPDT) ; Is GMVDT a real date/time?
"RTN","GMVZEROS",79,0)
 ;  Input:   GMVDT - date/time (FM internal format)(req)
"RTN","GMVZEROS",80,0)
 ;          GMVPDT - %DT value (opt - default is 'TX')
"RTN","GMVZEROS",81,0)
 ; Output:  1 = Yes
"RTN","GMVZEROS",82,0)
 ;          0 = No
"RTN","GMVZEROS",83,0)
 N %DT,X,Y
"RTN","GMVZEROS",84,0)
 S GMVDT=$G(GMVDT),GMVPDT=$G(GMVPDT)
"RTN","GMVZEROS",85,0)
 I $G(GMVDT)="" Q 0
"RTN","GMVZEROS",86,0)
 I $G(GMVPDT)="" S GMVPDT="TX"
"RTN","GMVZEROS",87,0)
 S X=GMVDT
"RTN","GMVZEROS",88,0)
 S %DT=GMVPDT
"RTN","GMVZEROS",89,0)
 D ^%DT
"RTN","GMVZEROS",90,0)
 I Y=-1 Q 0
"RTN","GMVZEROS",91,0)
 Q 1
"RTN","GMVZEROS",92,0)
 ;
"RTN","GMVZEROS",93,0)
EMAIL(GMVTXT) ; Send a MailMan message
"RTN","GMVZEROS",94,0)
 N DIFROM,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","GMVZEROS",95,0)
 S XMSUB="GMRV*5.0*25 D/T REPAIR UTILITY"
"RTN","GMVZEROS",96,0)
 S XMY(DUZ)="",XMDUZ=.5
"RTN","GMVZEROS",97,0)
 S XMTEXT="GMVTXT("
"RTN","GMVZEROS",98,0)
 D ^XMD
"RTN","GMVZEROS",99,0)
 Q
"VER")
8.0^22.0
"BLD",7150,6)
^16
**END**
**END**
